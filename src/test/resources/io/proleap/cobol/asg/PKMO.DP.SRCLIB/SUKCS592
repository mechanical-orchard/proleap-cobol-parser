000100 IDENTIFICATION DIVISION.                                         00010000
000200*-----------------------*                                         00020000
000300 PROGRAM-ID.    SUKCS592.                                         00030000
000400 AUTHOR.        LARRY SCHLEICHER.                                 00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  JAN, 2002.                                        00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*---------------------------------------------------------------* 00090000
001000*    S592 - AUDIT CARTON DETAIL LIST.                           * 00100000
001100*                                                               * 00110000
001200*    THIS PROGRAM GENERATES A LIST OF THE AUDITS.  THE          * 00120000
001300*    ASSOCIATED SOURCE, OPER UNIT, PO AND RECEIVER, LINE/PACK,  * 00130000
001400*    SKU, REQUEST DATE, PROCESS STATUS, ERROR PERCENT AND       * 00140000
001500*    DEFERRED IND WILL BE DISPLAYED.  THE APPROPRIATE PROGRAM   * 00150000
001600*    IS INVOKED WHEN THE OPERATOR SELECTS ONE OR MORE ITEMS AND * 00160000
001700*    PRESSES A FUNCTION KEY.                                    * 00170000
001800*                                                               * 00180000
      *---------------------------------------------------------------* 00190000
      *    CHANGES                                                     *00200000
      *    MADE BY: VENKATESH SHANMUGAM  PR#5148D                      *00210000
      *    DATE:    11/20/2013                                         *00220000
      *                                                                *00230000
      *              ADDED A LOGIC TO FIND OUT THE WHETHER THE AUDIT   *00240000
      *              NUMBER IS PART OF COMBINED AUDIT OR NOT.          *00250000
      *              THE TOGGLE FUNTION KEY WAS ALSO ADDED TO TOGGLE   *00260000
      *              BETWEEN TWO AUDITS OF THE COMBINED AUDIT.         *00270000
      *              THE ERROR MESSAGE WAS DISPLAYED IF THE TOGGLE FN  *00280000
      *              IS APPLIED FOR A NON-COMBINED AUDIT OR IF THE     *00290000
      *              RFID AUDIT IS ASSOCIATED WITH MULTIPLE QC AUDITS  *00300000
      *              CHANGES TAGGED VSH 11/21/2013                     *00310000
      *                                                                *00320000
      *---------------------------------------------------------------* 00330000
      *    CHANGES                                                     *00340000
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                      *00350000
      *    DATE:    01/03/2014                                         *00360000
      *                                                                *00370000
      *              ADDED A LOGIC TO POPULATE RFID TAGGED QUNATITY    *00380000
      *              TO UNIT QUANTITY FIELD FOR A SYSTEM GENARATED     *00390000
      *              AUDIT AND FOR RFID PO EXCEPTION.                  *00400000
      *              CHANGES TAGGED SBJ 01/03/2014                     *00410000
      *                                                                *00420000
001600*----------------------------------------------------------------*00430000
      *    CHANGES                                                     *00431000
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                      *00432000
      *    DATE:    04/23/2014                                         *00433000
      *                                                                *00434000
      *              ADDED A QUERY TO THE MANUAL AUDIT CURSOR TO FETCH *00435000
      *              UPCS WHICH ARE SHORT AND ARE NOT RECEIVED AT ALL. *00436000
      *              THIS IS DONE TO SHOW THE UPCS ON THE SCREE AFTER  *00437000
      *              THE CHANGES DONE TO CREATE OVER/SHORTS FOR MANUAL *00437100
      *              AUDITS WHICH WILL MAKE THEM APPEAR ON THE CICS    *00437200
      *              REPORTS.                                          *00437300
      *              CHANGES TAGGED SB 04/23/2014                      *00438000
      *                                                                *00439000
001600*----------------------------------------------------------------*00439100
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00439341
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00439441
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00439541
001130*                                                                 00439642
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00439742
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00439842
263968*---------------------------------------------------------------* 00439941
002000 ENVIRONMENT DIVISION.                                            00440000
002100                                                                  00450000
002200 DATA DIVISION.                                                   00460000
002300                                                                  00470000
002400 WORKING-STORAGE SECTION.                                         00480000
002500                                                                  00490000
002600 01  DK-DB2-KEYS.                                                 00500000
002700     05  DK-ENT-ID                      PIC S9(09)  COMP.         00510000
002800     05  DK-AUDIT-NBR                   PIC S9(09)  COMP.         00520000
002900     05  DK-SHIPT-UNIT-ID               PIC S9(18)V COMP-3.       00530000
003000     05  DK-AUDIT-STATUS                PIC  X(01)  VALUE SPACES. 00540000
003100     05  DK-OPER-UNT-ID                 PIC S9(04)  COMP.         00550000
003200     05  DK-PO                          PIC S9(09)  COMP.         00560000
003300     05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP.         00570000
003400     05  DK-DATE-FROM-TIMESTAMP         PIC  X(26)  VALUE SPACES. 00580000
003500     05  DK-DATE-TO-TIMESTAMP           PIC  X(26)  VALUE SPACES. 00590000
003600     05  DK-DEPT-NBR                    PIC S9(04)  COMP-3.       00600000
003700     05  DK-DEPT                        PIC  X(03)  VALUE SPACES. 00610000
003800                                                                  00620000
003900 01  PC-PROGRAM-CONSTANTS.                                        00630000
004000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00640000
004100                                                    'SU592A  '.   00650000
004200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00660000
004300                                                    'SUKM592 '.   00670000
004400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00680000
004500                                                    'SUKCS592'.   00690000
004600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00700000
004700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00710000
004800     05  PC-CRIT-SPEC-FORMAT      PIC  X(01)  VALUE '1'.          00720000
004900     05  PC-LIST-FORMAT           PIC  X(01)  VALUE '2'.          00730000
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00740000
005100                                                    COMP SYNC.    00750000
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00760000
005300                                                    COMP SYNC.    00770000
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00780000
005500                                                    +1000000      00790000
005600                                                    COMP-3.       00800000
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00810000
005800                                                    COMP SYNC.    00820000
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00830000
006000                                                    COMP-3.       00840000
006100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00850000
006200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00860000
006300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00870000
006400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00880000
006500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00890000
006600     05  PC-01                          PIC  X(02)  VALUE '01'.   00900000
006700     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00910000
006800     05  PC-N                      PIC  X(01)  VALUE  'N'.        00920000
006900     05  PC-E                      PIC  X(01)  VALUE  'E'.        00930000
007000     05  PC-MAX-DATE               PIC  X(10)  VALUE '9999-09-09'.00940000
007100     05  PC-MULT-ERRORS            PIC  X(15)  VALUE              00950000
007200                                    'MULTIPLE ERRORS'.            00960000
007300     05  PC-NO-ERRORS              PIC  X(15)  VALUE              00970000
007400                                    'NO ERRORS      '.            00980000
007500     05  PC-PASS                   PIC  X(10)  VALUE              00990000
007600                                    'PASS      '.                 01000000
007700     05  PC-FAIL                   PIC  X(10)  VALUE              01010000
007800                                    'FAIL      '.                 01020000
007900     05  PC-IN-PROCESS             PIC  X(10)  VALUE              01030000
008000                                    'IN PROCESS'.                 01040000
008100     05  PC-PROMPT                 PIC  X(10)  VALUE              01050000
008200                                    'PROMPT    '.                 01060000
008300     05  PC-NOT-NEEDED             PIC  X(10)  VALUE              01070000
008400                                    'NOT NEEDED'.                 01080000
008500     05  PC-MANUAL                 PIC  X(06)  VALUE 'MANUAL'.    01090000
008600     05  PC-SYSTEM                 PIC  X(06)  VALUE 'SYSTEM'.    01100000
008700     05  PC-ALL-SYSTEM             PIC  X(06)  VALUE 'ALL   '.    01110000
008800     05  PC-ALL                    PIC  X(10)  VALUE              01120000
008900                                    'ALL       '.                 01130000
009000     05  PC-BULK-CSPK              PIC  X(10)  VALUE              01140000
009100                                    'BULK/CSEPK'.                 01150000
009200     05  PC-PRE-PACK               PIC  X(10)  VALUE              01160000
009300                                    'PRE-PACK  '.                 01170000
009400     05  PC-PBS                    PIC  X(10)  VALUE              01180000
009500                                    'PBS       '.                 01190000
      * CLP                                                             01200000
009400     05  PC-RFID                   PIC  X(10)  VALUE              01210000
009500                                    'RFID      '.                 01220000
      * CLP                                                             01230000
009600*                                                                 01240000
009700******************************************************************01250000
009800*   SYSTEM MESSAGES                                              *01260000
009900******************************************************************01270000
010000* 00005 - INVALID VALUE                                          *01280000
010100* 00008 - MUST BE NUMERIC                                        *01290000
010200* 00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED    *01300000
010300* 00051 - NO END OF RANGE HAS BEEN SPECIFIED                     *01310000
010400* 00052 - END OF RANGE PRECEDES START OF RANGE                   *01320000
010500* 00053 - NO START OF RANGE HAS BEEN SPECIFIED                   *01330000
010600* 00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED     *01340000
010700* 00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED       *01350000
010800* 00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION         *01360000
010900* 00069 - TOP OF LIST                                            *01370000
011000* 00070 - BOTTOM OF LIST                                         *01380000
011100* 00101 - VALUE MUST BE GREATER THAN ZERO AND LESS THAN 100,000,0*01390000
011200* 00148 - DATA DOES NOT EXIST                                    *01400000
011300* 00279 - MORE ITEMS TO DISPLAY                                  *01410000
011400* 00302 - DATA ENTERED IN THE 'KEY' FIELD IS INVALID             *01420000
011500* 99901 - INVALID COMMAND WAS ENTERED                            *01430000
011600******************************************************************01440000
011700     05  PC-TSYMSG-NUMBERS.                                       01450000
011800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01460000
011900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01470000
012000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01480000
012100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01490000
012200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01500000
012300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01510000
012400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01520000
012500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01530000
012600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01540000
012700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01550000
012800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01560000
012900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01570000
013000         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01580000
013100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01590000
013200         10  PC-TSYMSG-00302            PIC  9(05)  VALUE 00302.  01600000
013300         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01610000
      *VSH 11/21/13 - BEGIN PR#5148D                                    01620000
015700         10  PC-TSYMSG-03739            PIC  9(05)  VALUE 03739.  01630000
015700         10  PC-TSYMSG-03740            PIC  9(05)  VALUE 03740.  01640000
      *VSH 11/21/13 - END PR#5148D                                      01650000
013400*                                                                 01660000
013500 01  PS-PROGRAM-SWITCHES.                                         01670000
013600     05  PS-SYS-GEN-AUDIT-SW            PIC  X(01)  VALUE 'Y'.    01680000
013700         88  PS-SYS-GEN-AUDIT                       VALUE 'Y'.    01690000
013800         88  PS-NOT-SYS-GEN-AUDIT                   VALUE 'N'.    01700000
013900     05  PS-MULTIPLE-ERRORS-SW          PIC  X(01)  VALUE ' '.    01710000
014000         88  PS-MULTIPLE-ERRORS                     VALUE 'Y'.    01720000
014100         88  PS-NOT-MULTIPLE-ERRORS                 VALUE 'N'.    01730000
014200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01740000
014300         88  PS-NO-ERROR                            VALUE 'Y'.    01750000
014400         88  PS-ERROR                               VALUE 'N'.    01760000
014500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01770000
014600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01780000
014700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01790000
014800     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01800000
014900         88  PS-DONE                                VALUE 'Y'.    01810000
015000         88  PS-NOT-DONE                            VALUE 'N'.    01820000
015100     05  PS-END-OF-RANKINGS-SW          PIC  X(01)  VALUE 'N'.    01830000
015200         88  PS-END-OF-RANKINGS                     VALUE 'Y'.    01840000
015300         88  PS-NOT-END-OF-RANKINGS                 VALUE 'N'.    01850000
015400     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.    01860000
015500         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    01870000
015600         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    01880000
015700     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01890000
015800         88  PS-LIST-END                            VALUE  'Y'.   01900000
015900         88  PS-NO-LIST-END                         VALUE  'N'.   01910000
      *SBJ 01/03/14 - BEGIN PR#5148D                                    01920000
           05  PS-PO-EXCEPTION-SW             PIC  X(01)  VALUE  'N'.   01930000
               88  PS-RFID-PO-EXCEPTION                   VALUE  'Y'.   01940000
               88  PS-NO-RFID-PO-EXCEPTION                VALUE  'N'.   01950000
      *SBJ 01/03/14 - END PR#5148D                                      01960000
016000*                                                                 01970000
016100 01  PV-PROGRAM-VARIABLES.                                        01980000
016200     05  PV-STORE                       PIC  X(04).               01990000
016300     05  FILLER REDEFINES PV-STORE.                               02000000
016400         10 PV-STORE-N                  PIC  9(04).               02010000
016500     05  PV-INNER-PACK-QTY              PIC  ZZZZZZZZZZ.          02020000
016600     05  PV-OPER-UNIT                   PIC  Z(04).               02030000
016700     05  PV-SCANNED-UNIT-QTY            PIC S9(09)  VALUE +0      02040000
016800                                                    COMP.         02050000
016700     05  PV-RFID-TAGGED-QTY             PIC S9(09)  VALUE +0      02060000
016800                                                    COMP.         02070000
016700     05  PV-RFID-TAGGED-QTY2            PIC S9(09)  VALUE +0      02080000
016800                                                    COMP.         02090000
016900     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      02100000
017000                                                    COMP SYNC.    02110000
017100     05  PV-SUB                         PIC S9(04)  VALUE +0      02120000
017200                                                    COMP SYNC.    02130000
017300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02140000
017400                                                    COMP SYNC.    02150000
017500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02160000
017600                                                    COMP-3.       02170000
017700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02180000
017800                                                    COMP-3.       02190000
017900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02200000
018000                                                    COMP-3.       02210000
018100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02220000
018200                                                    COMP-3.       02230000
018300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02240000
018400                                                    COMP-3.       02250000
018500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02260000
018600                                                    COMP-3.       02270000
018700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02280000
018800                                                    COMP-3.       02290000
018900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02300000
019000                                                    COMP SYNC.    02310000
019100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02320000
019200                                                    COMP SYNC.    02330000
019300     05  PV-ITEM                        PIC S9(04)  VALUE +0      02340000
019400                                                    COMP SYNC.    02350000
019500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02360000
019600                                                    COMP SYNC.    02370000
019700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02380000
019800                                                    COMP SYNC.    02390000
019900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02400000
020000                                                    COMP SYNC.    02410000
020100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02420000
020200                                                    COMP SYNC.    02430000
020300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02440000
020400                                                    COMP SYNC.    02450000
020500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02460000
020600                                                    COMP SYNC.    02470000
020700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02480000
020800                                                    COMP SYNC.    02490000
020900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02500000
021000                                                    COMP SYNC.    02510000
021100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02520000
021200                                                    COMP SYNC.    02530000
021300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02540000
021400                                                    COMP SYNC.    02550000
021500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02560000
021600                                                    COMP SYNC.    02570000
021700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02580000
021800                                                    COMP SYNC.    02590000
021900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02600000
022000                                                    COMP SYNC.    02610000
022100     05  PV-BULK-VND-RNKG-CDE           PIC  X(06).               02620000
022200     05  PV-PREPACK-VND-RNKG-CDE        PIC  X(06).               02630000
022300     05  PV-PBS-VND-RNKG-CDE            PIC  X(06).               02640000
022400     05  PV-COUNT-DEPT-RANKGS           PIC S9(04)  COMP.         02650000
022500     05  PV-ENT-ID                      PIC ZZZZZZZZ9.            02660000
022600     05  PV-DEPT-NBR                    PIC ZZZ9.                 02670000
022700     05  PV-PO-RECEIVER.                                          02680000
022800         10  PV-PO-NBR                  PIC ZZZZZZZZ9.            02690000
022900         10  FILLER                     PIC X(1)  VALUE '-'.      02700000
023000         10  PV-RECEIVER                PIC 999.                  02710000
023100     05  PV-REQ-DATE.                                             02720000
023200         10  PV-REQ-DATE-MM             PIC 9(02).                02730000
023300         10  FILLER                     PIC X(1)  VALUE '-'.      02740000
023400         10  PV-REQ-DATE-DD             PIC 9(02).                02750000
023500         10  FILLER                     PIC X(1)  VALUE '-'.      02760000
023600         10  PV-REQ-DATE-YY             PIC 9(02).                02770000
023700     05  PV-FROM-DATE-TIME.                                       02780000
023800         10  PV-FROM-DATE-YY            PIC 9(04).                02790000
023900         10  FILLER                     PIC X(1)  VALUE '-'.      02800000
024000         10  PV-FROM-DATE-MM            PIC 9(02).                02810000
024100         10  FILLER                     PIC X(1)  VALUE '-'.      02820000
024200         10  PV-FROM-DATE-DD            PIC 9(02).                02830000
024300         10  FILLER                     PIC X(16)                 02840000
024400                  VALUE '-01.01.01.000001'.                       02850000
024500     05  PV-TO-DATE-TIME.                                         02860000
024600         10  PV-TO-DATE-YY              PIC 9(04).                02870000
024700         10  FILLER                     PIC X(1)  VALUE '-'.      02880000
024800         10  PV-TO-DATE-MM              PIC 9(02).                02890000
024900         10  FILLER                     PIC X(1)  VALUE '-'.      02900000
025000         10  PV-TO-DATE-DD              PIC 9(02).                02910000
025100         10  FILLER                     PIC X(16)                 02920000
025200                  VALUE '-23.59.59.999999'.                       02930000
025300     05  PV-DISPLAY-DATE.                                         02940000
025400         10  PV-DISPLAY-DATE-MM         PIC 9(02).                02950000
025500         10  FILLER                     PIC X(1)  VALUE '/'.      02960000
025600         10  PV-DISPLAY-DATE-DD         PIC 9(02).                02970000
025700         10  FILLER                     PIC X(1)  VALUE '/'.      02980000
025800         10  PV-DISPLAY-DATE-YY         PIC 9(04).                02990000
025900     05  PV-DISP-UPC                    PIC  9(15) VALUE ZEROES.  03000000
026000     05  PV-DISP-SHIPT-UNIT-ID          PIC  9(18).               03010000
026100     05  PV-DISP-AUDIT-NBR              PIC  9(09).               03020000
026200     05  PV-DISP-ENT-ID                 PIC  9(09).               03030000
026300     05  PV-DISP-OPER-UNT-ID            PIC  9(04).               03040000
026400     05  PV-STATUS-CDE                  PIC  X(1)  VALUE SPACES.  03050000
026400     05  PV-UNION-TYPE                  PIC  X(1)  VALUE SPACES.  03051024
019500     05  PV-DISP-SKU-STR-SQL-CDE        PIC  9(9).                03060000
019700     05  PV-DISP-UPC-SQL-CDE            PIC  9(9).                03070000
      *VSH 11/21/13 - BEGIN PR#5148D                                    03080000
           05  PV-REQ-DATE-MDCY.                                        03090000
               10  PV-REQ-DATE-MDCY-MM        PIC 9(02).                03100000
               10  FILLER                     PIC X(1)  VALUE '-'.      03110000
               10  PV-REQ-DATE-MDCY-DD        PIC 9(02).                03120000
               10  FILLER                     PIC X(1)  VALUE '-'.      03130000
               10  PV-REQ-DATE-MDCY-CCYY      PIC 9(04).                03140000
                                                                        03150000
                                                                        03160000
           05  PV-REQ-TIME.                                             03170000
               10  PV-REQ-TIME-HR             PIC 9(02).                03180000
               10  FILLER                     PIC X(1)  VALUE ':'.      03190000
               10  PV-REQ-TIME-MN             PIC 9(02).                03200000
      *VSH 11/21/13 - END PR#5148D                                      03210000
                                                                        03220000
026500******************************************************************03230000
026600**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03240000
026700**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03250000
026800**  APPLICATION-SPECIFIC COMMAREA.                              **03260000
026900******************************************************************03270000
027000 01  LQW-LIST-QUEUE-WORK-AREA.                                    03280000
027100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03290000
027200     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           03300000
027300                                        INDEXED BY LQW-IDX.       03310000
027400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03320000
027500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03330000
027600         10  LQW-SELECTED-SW            PIC  X(01).               03340000
027700             88  LQW-SELECT                         VALUE 'S'.    03350000
027800             88  LQW-DESELECT                       VALUE ' '.    03360000
027900         10  LQW-ACTION                 PIC  X(03).               03370000
028000         10  LQW-UPC                    PIC S9(15)                03380000
028100                                        COMP-3.                   03390000
028200         10  LQW-INTR-UPC               PIC S9(09)                03400000
028300                                        COMP.                     03410000
028400         10  LQW-LINE-NBR               PIC S9(09)                03420000
028500                                        COMP.                     03430000
028600         10  LQW-EXP-UNITS              PIC S9(09)                03440000
028700                                        COMP.                     03450000
028800         10  LQW-AUDIT-UNITS            PIC S9(09)                03460000
028900                                        COMP.                     03470000
029000         10  LQW-RETAIL                 PIC  S9(5)V99             03480000
029100                                        COMP-3.                   03490000
029200         10  LQW-ERROR-DESC             PIC  X(15).               03500000
029300         10  LQW-PASS-FAIL-IND          PIC  X(01).               03510000
029400                                                                  03520000
029500                                                                  03530000
029600*---------------------------------------------------------------* 03540000
029700*  SELECTION QUEUE LAYOUT                                       * 03550000
029800*---------------------------------------------------------------* 03560000
029900     COPY SUWS028.                                                03570000
030000                                                                  03580000
030100*------------------------------------------------------------     03590000
030200*  SELECTION QUEUE LAYOUT FOR STORE UNIT ADJUSTMENT SCREENS       03600000
030300*------------------------------------------------------------     03610000
030400     COPY SUWS039.                                                03620000
030500                                                                  03630000
030600*---------------------------------------------------------------* 03640000
030700*  RECORD LAYOUT FOR THE AUDIT CARTON LIST TEMP STORAGE QUEUE.  * 03650000
030800*---------------------------------------------------------------* 03660000
030900                                                                  03670000
031000     COPY SUWS030.                                                03680000
031100                                                                  03690000
031200*----------------------------------------------------------------*03700000
031300**  SECURITY SUBROUTINE PARAMETERS                                03710000
031400*----------------------------------------------------------------*03720000
031500     COPY DPWS008.                                                03730000
031600*---------------------------------------------------------------* 03740000
031700*    MAP LAYOUT                                                 * 03750000
031800*---------------------------------------------------------------* 03760000
031900     COPY SUKM592.                                                03770000
032000*                                                                 03780000
032100 01  MR-OCCURS-LAYOUT                   REDEFINES  SU592AO.       03790000
032200     05  FILLER                         PIC X(311).               03800000
032300     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          03810000
032400         10  MR-SELECTL                 PIC S9(04) COMP.          03820000
032500         10  MR-SELECTA                 PIC  X(01).               03830000
032600         10  MR-SELECTC                 PIC  X(01).               03840000
032700         10  MR-SELECTH                 PIC  X(01).               03850000
032800         10  MR-SELECTI                 PIC  X(01).               03860000
032900                                                                  03870000
033000         10  MR-ACTIONL                 PIC S9(04) COMP.          03880000
033100         10  MR-ACTIONA                 PIC  X(01).               03890000
033200         10  MR-ACTIONC                 PIC  X(01).               03900000
033300         10  MR-ACTIONH                 PIC  X(01).               03910000
033400         10  MR-ACTION                  PIC  X(03).               03920000
033500                                                                  03930000
033600         10  MR-UPCL                    PIC S9(04) COMP.          03940000
033700         10  MR-UPCA                    PIC  X(01).               03950000
033800         10  MR-UPCC                    PIC  X(01).               03960000
033900         10  MR-UPCH                    PIC  X(01).               03970000
034000         10  MR-UPC-X.                                            03980000
034100             15  MR-UPC                 PIC ZZZZZZZZZZZZZZ9.      03990000
034200                                                                  04000000
034300         10  MR-LINE-NBRL               PIC S9(04) COMP.          04010000
034400         10  MR-LINE-NBRA               PIC  X(01).               04020000
034500         10  MR-LINE-NBRC               PIC  X(01).               04030000
034600         10  MR-LINE-NBRH               PIC  X(01).               04040000
034700         10  MR-LINE-NBR-X.                                       04050000
034800             15  MR-LINE-NBR            PIC ZZZZ.                 04060000
034900                                                                  04070000
035000         10  MR-EXPTD-UNITSL            PIC S9(04) COMP.          04080000
035100         10  MR-EXPTD-UNITSA            PIC  X(01).               04090000
035200         10  MR-EXPTD-UNITSC            PIC  X(01).               04100000
035300         10  MR-EXPTD-UNITSH            PIC  X(01).               04110000
035400         10  MR-EXPTD-UNITS-X.                                    04120000
035500             15  MR-EXPTD-UNITS         PIC  ZZZZZZZZ9.           04130000
035600                                                                  04140000
035700         10  MR-AUDIT-UNITSL            PIC S9(04) COMP.          04150000
035800         10  MR-AUDIT-UNITSA            PIC  X(01).               04160000
035900         10  MR-AUDIT-UNITSC            PIC  X(01).               04170000
036000         10  MR-AUDIT-UNITSH            PIC  X(01).               04180000
036100         10  MR-AUDIT-UNITS-X.                                    04190000
036200             15  MR-AUDIT-UNITS         PIC  ZZZZZZZZ9.           04200000
036300                                                                  04210000
036400         10  MR-RETAILL                 PIC S9(04) COMP.          04220000
036500         10  MR-RETAILA                 PIC  X(01).               04230000
036600         10  MR-RETAILC                 PIC  X(01).               04240000
036700         10  MR-RETAILH                 PIC  X(01).               04250000
036800         10  MR-RETAIL-X.                                         04260000
036900             15  MR-RETAIL              PIC  Z,ZZZ,ZZ9.99.        04270000
037000                                                                  04280000
037100         10  MR-ERROR-DESCL             PIC S9(04) COMP.          04290000
037200         10  MR-ERROR-DESCA             PIC  X(01).               04300000
037300         10  MR-ERROR-DESCC             PIC  X(01).               04310000
037400         10  MR-ERROR-DESCH             PIC  X(01).               04320000
037500         10  MR-ERROR-DESC              PIC  X(15).               04330000
037600                                                                  04340000
037700                                                                  04350000
037800         10  MR-ERROR-INDL              PIC S9(04) COMP.          04360000
037900         10  MR-ERROR-INDA              PIC  X(01).               04370000
038000         10  MR-ERROR-INDC              PIC  X(01).               04380000
038100         10  MR-ERROR-INDH              PIC  X(01).               04390000
038200         10  MR-ERROR-IND               PIC  X(01).               04400000
038300                                                                  04410000
038400                                                                  04420000
038500*---------------------------------------------------------------* 04430000
038600* COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE              * 04440000
038700*---------------------------------------------------------------* 04450000
038800     COPY XLWS001.                                                04460000
038900                                                                  04470000
039000*---------------------------------------------------------------* 04480000
039100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04490000
039200*---------------------------------------------------------------* 04500000
039300                                                                  04510000
039400     COPY DPWS015.                                                04520000
039500                                                                  04530000
039600*---------------------------------------------------------------* 04540000
039700*    FUNCTION KEYS COPYBOOK.                                    * 04550000
039800*---------------------------------------------------------------* 04560000
039900                                                                  04570000
040000     COPY DPWS016.                                                04580000
040100                                                                  04590000
040200*---------------------------------------------------------------* 04600000
040300*    NUMERIC EDIT LAYOUT.                                       * 04610000
040400*---------------------------------------------------------------* 04620000
040500                                                                  04630000
040600     COPY DPWS010I.                                               04640000
040700*---------------------------------------------------------------* 04650000
040800*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 04660042
040900*---------------------------------------------------------------* 04670000
041000                                                                  04680000
041100     COPY DPWS030.                                                04690000
041100     COPY DPWS930.                                                04691042
041200*---------------------------------------------------------------* 04700000
041300*    STANDARD COMMAREA.                                         * 04710000
041400*---------------------------------------------------------------* 04720000
041500                                                                  04730000
041600     COPY DPWS020.                                                04740000
041700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04750000
041800                                                                  04760000
041900*---------------------------------------------------------------* 04770000
042000* INTER-APPLICATION COMMAREA.                                   * 04780000
042100*   SUWS023 - IS THE INPUT LAYOUT WHEN COMING FROM THE MANUAL   * 04790000
042200*             AUDIT CRIT SPEC.                                  * 04800000
042300*   SUWS027 - IS THE INPUT LAYOUT WHEN COMING FROM THE AUDITED  * 04810000
042400*             CARTON LIST SCREEN.                               * 04820000
042500*   SUWS029 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04830000
042600*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04840000
042700*---------------------------------------------------------------* 04850000
042800                                                                  04860000
042900         10  INTER-APPL-COMM-AREA       PIC X(200).               04870000
043000     COPY SUWS023.                                                04880000
043100     COPY SUWS027.                                                04890000
043200     COPY SUWS029.                                                04900000
043300     COPY SUWS038.                                                04910000
043400*---------------------------------------------------------------* 04920000
043500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04930000
043600*---------------------------------------------------------------* 04940000
043700         10  ASC-SPECIFIC-COMMAREA.                               04950000
043800             15  ASC-LIST-KEYS.                                   04960000
043900                 20  ASC-PACKAGING-TYPE              PIC  X(02).  04970000
044000                 20  ASC-REQUEST-DATE                PIC  X(08).  04980000
044100                 20  ASC-REQUEST-MDCY                PIC  X(10).  04990000
044200                 20  ASC-REQUEST-TIME                PIC  X(05).  05000000
044300                 20  ASC-PROCESS-STATUS              PIC  X(01).  05010000
044400                 20  ASC-PO                          PIC  9(09).  05020000
044500                 20  ASC-RECEIVER-SEQ                PIC  9(03).  05030000
044600                 20  ASC-PO-RECEIVER.                             05040000
044700                     25  ASC-PO-NBR                PIC ZZZZZZZZ9. 05050000
044800                     25  ASC-DASH-FILLER            PIC X(1).     05060000
044900                     25  ASC-RECEIVER                PIC 999.     05070000
045000                 20  ASC-SOURCE                      PIC  X(06).  05080000
045100                 20  ASC-VENDOR-NAME                 PIC  X(30).  05090000
045200                 20  ASC-ENT-ID.                                  05100000
045300                     25  ASC-ENT-ID-N                PIC 9(09).   05110000
045400                 20  ASC-DEPARTMENT-DESC             PIC  X(30).  05120000
045500                 20  ASC-DEPT-NBR.                                05130000
045600                     25  ASC-DEPT-NBR-N              PIC  9(04).  05140000
045700                 20  ASC-AUDIT-TYPE                  PIC  X(01).  05150000
045800                 20  ASC-AUDIT-STATUS                PIC  X(01).  05160000
045900                 20  ASC-OPER-UNIT-ID                PIC  9(04).  05170000
046000                 20  ASC-OPER-DESC                   PIC  X(30).  05180000
046100                 20  ASC-FROM-DATE-MM                PIC  9(02).  05190000
046200                 20  ASC-FROM-DATE-DD                PIC  9(02).  05200000
046300                 20  ASC-FROM-DATE-YY                PIC  9(04).  05210000
046400                 20  ASC-TO-DATE-MM                  PIC  9(02).  05220000
046500                 20  ASC-TO-DATE-DD                  PIC  9(02).  05230000
046600                 20  ASC-TO-DATE-YY                  PIC  9(04).  05240000
046700                 20  ASC-AUDIT-NBR                   PIC  Z(09).  05250000
046800                 20  ASC-CARTON-ID                   PIC  9(18).  05260000
046900                 20  ASC-STORE-NBR                   PIC S9(04).  05270000
      *VSH 11/21/13 - BEGIN PR#5148D                                    05280000
                   15  ASC-COUNT                     PIC S9(04)  COMP.  05290000
                   15  ASC-RFID-AUD-CNTL-NBR         PIC S9(09)  COMP.  05300000
      *VSH 11/21/13 - END PR#5148D                                      05310000
                   15  ASC-OTHER-AUDIT               PIC S9(09)  COMP.  05320000
                   15  ASC-OTHER-AUDIT-DB            PIC S9(09)  COMP.  05330000
      *VSH 11/21/13 - BEGIN PR#5148D                                    05340000
                   15  ASC-AUD-CARTON-COUNT          PIC S9(04)  COMP.  05350000
                   15  ASC-RFID-AUDIT-IND                  PIC  X(01).  05360000
                       88  ASC-RFID-AUD                       VALUE 'Y'.05370000
                       88  ASC-NOT-RFID-AUD                   VALUE 'N'.05380000
      *VSH 11/21/13 - END PR#5148D                                      05390000
                   15  ASC-MULTIPLE-AUDITS-IND   PIC  X(01).            05400000
                       88  ASC-MULTIPLE-AUD                   VALUE 'Y'.05410000
                       88  ASC-NOT-MULTIPLE-AUD               VALUE 'N'.05420000
047000             15  ASC-FORMAT-IND                      PIC X(01).   05430000
047100                 88  ASC-CRIT-SPEC-FORMAT            VALUE '1'.   05440000
047200                 88  ASC-LIST-FORMAT                 VALUE '2'.   05450000
047300             15  ASC-BLK-SUB                         PIC S9(04)   05460000
047400                                                          COMP    05470000
047500                                                          SYNC.   05480000
047600             15  ASC-ITEM-SUB                        PIC S9(04)   05490000
047700                                                          COMP    05500000
047800                                                          SYNC.   05510000
047900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05520000
048000                                                          COMP-3. 05530000
048100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05540000
048200                                                          COMP-3. 05550000
048300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05560000
048400                                                          COMP-3. 05570000
048500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05580000
048600                                                          COMP-3. 05590000
048700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05600000
048800                                                          COMP-3. 05610000
048900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05620000
049000                                                          COMP    05630000
049100                                                          SYNC.   05640000
049200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05650000
049300                                                          COMP-3. 05660000
049400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05670000
049500                                                          COMP-3. 05680000
049600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05690000
049700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05700000
049800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05710000
049900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05720000
050000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05730000
050100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05740000
050200             15  ASC-LIST-QUEUE-NAME.                             05750000
050300                 20  ASC-LIST-TERM-ID                PIC  X(04).  05760000
050400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05770000
050500                                                          COMP-3. 05780000
050600                 20  ASC-LIST-SEQ                    PIC  9(01).  05790000
050700*                                                                 05800000
050800             15  ASC-SEL-QUEUE-NAME.                              05810000
050900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05820000
051000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05830000
051100                                                          COMP-3. 05840000
051200                 20  ASC-SEL-SEQ                     PIC  9(01).  05850000
051300*                                                                 05860000
051400             15  ASC-SEL-QUEUE-NAME-IN.                           05870000
051500                 20  ASC-SEL-TERM-ID-IN  PIC X(04).               05880000
051600                 20  ASC-SEL-TASK-NUMBER-IN                       05890000
051700                                      PIC S9(05) COMP-3.          05900000
051800                 20  ASC-SEL-SEQ-IN      PIC 9(01).               05910000
051900*                                                                 05920000
052000             15  ASC-USE-SELECTION-QUEUE-IND                      05930000
052100                                           PIC  X(01).            05940000
052200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 05950000
052300             15  ASC-START-ITEM-REQUEST.                          05960000
052400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05970000
052500             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    05980000
052600             15  ASC-SEL-SUB               PIC S9(04)  COMP.      05990000
052700             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      06000000
052800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06010000
052900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06020000
053000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06030000
053100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06040000
053200                                                                  06050000
053300                 20  ASC-ITEM-ARRAY.                              06060000
053400                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        06070000
053500                         30  ASC-LIST-ITEM-NUMBER                 06080000
053600                                                     PIC S9(09)   06090000
053700                                                     COMP-3.      06100000
053800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  06110000
053900                             88  ASC-VALID-SELECT    VALUE ' '    06120000
054000                                                           'S'    06130000
054100                                                           'B'    06140000
054200                                                           'E'.   06150000
054300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   06160000
054400                             88  ASC-TEMP-SELECT     VALUE 'S'.   06170000
054500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   06180000
054600                             88  ASC-TEMP-END        VALUE 'E'.   06190000
054700                         30  ASC-SELECTED-SW         PIC  X(01).  06200000
054800                             88  ASC-NO-SELECT       VALUE ' '.   06210000
054900                             88  ASC-SELECT          VALUE 'S'.   06220000
055000                             88  ASC-BEGIN           VALUE 'B'.   06230000
055100                             88  ASC-END             VALUE 'E'.   06240000
055200                         30  ASC-ACTION              PIC  X(03).  06250000
055300                         30  ASC-TBL-UPC             PIC S9(15)   06260000
055400                                                     COMP-3.      06270000
055500                         30  ASC-TBL-INTR-UPC        PIC S9(09)   06280000
055600                                                     COMP.        06290000
055700                         30  ASC-TBL-LINE-NBR        PIC S9(09)   06300000
055800                                                     COMP.        06310000
055900                         30  ASC-TBL-EXP-UNITS       PIC S9(09)   06320000
056000                                                     COMP.        06330000
056100                         30  ASC-TBL-AUDIT-UNITS     PIC S9(09)   06340000
056200                                                     COMP.        06350000
056300                         30  ASC-TBL-RETAIL          PIC  S9(5)V9906360000
056400                                                     COMP-3.      06370000
056500                         30  ASC-TBL-ERROR-DESC      PIC  X(15).  06380000
056600                         30  ASC-TBL-PASS-FAIL-IND   PIC  X(01).  06390000
056700                                                                  06400000
056800*---------------------------------------------------------------* 06410000
056900*    ABEND PROCESSING COPYBOOK.                                 * 06420000
057000*---------------------------------------------------------------* 06430000
057200     COPY DPWS013.                                                06440000
057300                                                                  06450000
058100*---------------------------------------------------------------* 06460000
058200*    DB2 AREA FOR THE SHIPPING UNIT CROSS REFERENCE TABLE       * 06470000
058300*---------------------------------------------------------------* 06480000
058400     EXEC SQL                                                     06490000
058500          INCLUDE TSULBXF                                         06500000
058600     END-EXEC.                                                    06510000
058700                                                                  06520000
058800*---------------------------------------------------------------* 06530000
058900*  DCLGEN FOR THE DB2 DEPARTMENT TABLE                            06540000
059000*---------------------------------------------------------------* 06550000
059100     EXEC SQL                                                     06560000
059200         INCLUDE TVNDDPT                                          06570000
059300     END-EXEC.                                                    06580000
059400*---------------------------------------------------------------* 06590000
059500*  DCLGEN FOR THE DB2 PURCHASE ITEM TABLE                         06600000
059600*---------------------------------------------------------------* 06610000
059700     EXEC SQL                                                     06620000
059800         INCLUDE TPURITM                                          06630000
059900     END-EXEC.                                                    06640000
060000*---------------------------------------------------------------* 06650000
060100*    DB2 DCLGEN FOR THE XLT_UPC TABLE                             06660000
060200*----------------------------------------------------------------*06670000
060300     EXEC SQL                                                     06680000
060400         INCLUDE XLT00006                                         06690000
060500     END-EXEC.                                                    06700000
060600*---------------------------------------------------------------* 06710000
060700*    DB2 DCLGEN FOR THE XLT_SKU TABLE                             06720000
060800*----------------------------------------------------------------*06730000
060900     EXEC SQL                                                     06740000
061000         INCLUDE XLT00003                                         06750000
061100     END-EXEC.                                                    06760000
061200*----------------------------------------------------------------*06770000
061300*    DB2 DCLGEN FOR THE MERCHANDISE AREA TABLE                    06780000
061400*----------------------------------------------------------------*06790000
061500     EXEC SQL                                                     06800000
061600          INCLUDE TMDSEAR                                         06810000
061700     END-EXEC.                                                    06820000
061800                                                                  06830000
061900*----------------------------------------------------------------*06840000
062000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT UPC  06850000
062100*  TABLE                                                          06860000
062200*----------------------------------------------------------------*06870000
062300     EXEC SQL                                                     06880000
062400         INCLUDE TSHUUPC                                          06890000
062500     END-EXEC.                                                    06900000
062600                                                                  06910000
062700*----------------------------------------------------------------*06920000
062800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE AUDIT SHIPPING UPC 06930000
062900*  TABLE                                                          06940000
063000*----------------------------------------------------------------*06950000
063100     EXEC SQL                                                     06960000
063200         INCLUDE TSUAUPC                                          06970000
063300     END-EXEC.                                                    06980000
063400*----------------------------------------------------------------*06990000
063500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE AUDIT SHIPPING TRAN07000000
063600*  TABLE                                                          07010000
063700*----------------------------------------------------------------*07020000
063800     EXEC SQL                                                     07030000
063900         INCLUDE TSUATRN                                          07040000
064000     END-EXEC.                                                    07050000
064100*----------------------------------------------------------------*07060000
064200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      07070000
064300*  CONTENT AUDIT TABLE (TSUEXCP)                                  07080000
064400*----------------------------------------------------------------*07090000
064500     EXEC SQL                                                     07100000
064600         INCLUDE TSUEXCP                                          07110000
064700     END-EXEC.                                                    07120000
064800*----------------------------------------------------------------*07130000
064900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE VIOLATION CODE     07140000
065000*  TABLE (TVILNCD)                                                07150000
065100*----------------------------------------------------------------*07160000
065200     EXEC SQL                                                     07170000
065300         INCLUDE TVILNCD                                          07180000
065400     END-EXEC.                                                    07190000
065500                                                                  07200000
065600*----------------------------------------------------------------*07210000
065700*    DB2 DCLGEN FOR THE VENDOR PO AUDIT REQUEST TABLE             07220000
065800*    (SUT_PO_AUD_REQ)                                             07230000
065900*----------------------------------------------------------------*07240000
066000     EXEC SQL                                                     07250000
066100          INCLUDE SUT00015                                        07260000
066200     END-EXEC.                                                    07270000
065600*----------------------------------------------------------------*07280000
065700*    DB2 DCLGEN FOR THE VENDOR PO AUDIT EXCEPTION TABLE           07290000
065800*    (SUT_PO_AUD_EXC)                                             07300000
065900*----------------------------------------------------------------*07310000
066000     EXEC SQL                                                     07320000
066100          INCLUDE SUT00014                                        07330000
066200     END-EXEC.                                                    07340000
060600*---------------------------------------------------------------* 07350000
060700*    DB2 DCLGEN FOR THE XLT_LOC TABLE                             07360000
060800*----------------------------------------------------------------*07370000
060900     EXEC SQL                                                     07380000
061000         INCLUDE XLT00010                                         07390000
061100     END-EXEC.                                                    07400000
066300*----------------------------------------------------------------*07410000
066400*    DB2 SQL COMMUNICATION AREA                                   07420000
066500*----------------------------------------------------------------*07430000
066600     EXEC SQL                                                     07440000
066700          INCLUDE SQLCA                                           07450000
066800     END-EXEC.                                                    07460000
067000                                                                  07470000
067100*---------------------------------------------------------------* 07480000
067200*    CURSOR FOR ALL AUDITS FOR AN OPER ID AND STATUS            * 07490000
067300*---------------------------------------------------------------* 07500000
067300*GB 07/01/14 CHANGE FOR MULITPLE INSTANCES OF SAME ITEMS BEING    07500135
067300*   RETURNED FROM CURSOR, ADDED LOGIC TO LEFT OUTER JOIN OF       07500235
067300*   CURSOR TO RETURN ONLY SINGLE ROW                              07500335
067300*-                                                              * 07500435
067300*--ADDED NEW FIELD TO CURSOR TO HELP IDENTIFY PART OF THE CURSOR  07500535
067300*--THAT IS RETURING THE DATA, CURRENTLY LAST ELEMENT BEING        07500635
067300*--RETURNED, AFTER INTR_UPC_ID                                    07500735
067300*--'A' PORTION OF CURSOR                                          07500835
067300*      RETURNS ACTUAL SCANNED UPC'S EXPECTED IN THE CARTON        07500935
067300*      SCN_TYP_CDE <> 'E'                                         07501035
067300*      SCN_TYP_CDE = 'S' ARE SCANNED ROWS                         07501135
067300*--'B' PORTION OF CURSOR                                          07501235
067300*      RETURNS UPC ROWS THAT WERE EXPECTED IN THE CARTON          07501335
067300*      BUT WERE NOT SCANNED AS PART OF THE CARTON AUDIT           07501435
067300*      THE 'E' ROWS ARE CREATED AND AUDIT CARTON CLOSE AND        07501535
      *      ARE EXCEPTION ROWS                                         07501638
067300*--'C' PORTION OF CURSOR                                          07501735
067300*      RETURNS UPC ROWS THAT WERE SCANNED AS PART OF THE          07501835
067300*      CARTON AUDIT, UPC NOT IN THE CARTON (TSHUUPC), BUT         07501935
067300*      DOES EXIST ON THE PO (TPURITM)                             07502035
067300*      SUB SELECT FOR LINE NUMBER TO RETURN ONLY ONE ROW          07502135
067300*      IF ITEM APPEARS MULTIPLE TIMES ON PO, ALSO SUBSELECT       07502235
067300*      FOR STATUS CODE. THIS WILL RETURN THE ACTIVE ROW IF        07502335
067300*      ONE EXISTS, OTHERWISE RETURN THE CANCELLED ROW             07502435
067300*--'D' PORTION OF CURSOR                                          07502535
067300*      WILL RETURN SCANNED UPC, THAT ARE NOT IN THE CARTON        07502636
067300*      (TSHUUPC) AND ALSO NOT FOUND ON XLT_UPC                    07502736
067300*--'E' PORTION OF CURSOR                                          07502836
067300*      WILL RETURN UPC'S THAT HAVE EXCEPTIONS                     07502936
067300*---------------------------------------------------------------* 07504036
067500     EXEC SQL                                                     07510000
067600          DECLARE AUD-DETAIL-SYS-CSR CURSOR                       07520000
067700                                                                  07530000
067800         FOR SELECT DISTINCT                                      07540000
067900                A.UPC_NBR                                         07550000
068000             ,  A.UPC_RTL_AMT                                     07560000
068100             ,  'S'                                               07570000
068200             ,  SUM(A.SCND_UNT_QTY)                               07580000
068200*            ,  SUM(A.RFID_TGD_QTY)                               07590000
068300             ,  B.TRN_LNE_NBR                                     07600000
068400             ,  B.SHPD_QTY                                        07610000
068500             ,  B.UPC_NBR                                         07620000
068600             ,  C.INTR_UPC_ID                                     07630000
068600             ,  'A'                                               07631023
068700          FROM                                                    07640000
068800                TSUAUPC        A                                  07650000
068900            ,   TSHUUPC        B                                  07660000
069000            ,   XLT_UPC        C                                  07670000
069100            ,   XLT_UPC        D                                  07680000
069200          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               07690000
069300            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           07700000
069400            AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              07710000
069500            AND A.UPC_NBR           = C.UPC_NBR                   07720000
069600            AND B.UPC_NBR           = D.UPC_NBR                   07730000
069700            AND C.INTR_UPC_ID       = D.INTR_UPC_ID               07740000
069800            AND A.SCN_TYP_CDE      <> 'E'                         07750000
069900                                                                  07760000
070000          GROUP BY A.UPC_NBR                                      07770000
070100                ,  A.UPC_RTL_AMT                                  07780000
070200                ,  B.TRN_LNE_NBR                                  07790000
070300                ,  B.SHPD_QTY                                     07800000
070400                ,  B.UPC_NBR                                      07810000
070500                ,  C.INTR_UPC_ID                                  07820000
070600                                                                  07830000
070700       UNION                                                      07840000
070800                                                                  07850000
070900         SELECT DISTINCT                                          07860000
071000                A.UPC_NBR                                         07870000
071100             ,  A.UPC_RTL_AMT                                     07880000
071200             ,  'E'                                               07890000
071300             ,  SUM(A.SCND_UNT_QTY)                               07900000
071300*            ,  SUM(A.RFID_TGD_QTY)                               07910000
071400             ,  B.TRN_LNE_NBR                                     07920000
071500             ,  B.SHPD_QTY                                        07930000
071600             ,  B.UPC_NBR                                         07940000
071700             ,  C.INTR_UPC_ID                                     07950000
071700             ,  'B'                                               07951023
071800          FROM                                                    07960000
071900                TSUAUPC        A                                  07970000
072000            ,   TSHUUPC        B                                  07980000
072100            ,   XLT_UPC        C                                  07990000
072200            ,   XLT_UPC        D                                  08000000
072300          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               08010000
072400            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           08020000
072500            AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              08030000
072600            AND A.UPC_NBR           = C.UPC_NBR                   08040000
072700            AND B.UPC_NBR           = D.UPC_NBR                   08050000
072800            AND C.INTR_UPC_ID       = D.INTR_UPC_ID               08060000
072900            AND A.SCN_TYP_CDE       = 'E'                         08070000
073000            AND A.UPC_NBR       NOT IN                            08080000
073100                (SELECT G.UPC_NBR                                 08090000
073200                   FROM TSUAUPC  G                                08100000
073300                  WHERE G.AUD_CNTL_NBR      = :DK-AUDIT-NBR       08110000
073400                    AND G.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID   08120000
073500                    AND G.SCN_TYP_CDE      <> 'E')                08130000
073600                                                                  08140000
073700          GROUP BY A.UPC_NBR                                      08150000
073800                ,  A.UPC_RTL_AMT                                  08160000
073900                ,  B.TRN_LNE_NBR                                  08170000
074000                ,  B.SHPD_QTY                                     08180000
074100                ,  B.UPC_NBR                                      08190000
074200                ,  C.INTR_UPC_ID                                  08200000
074300                                                                  08210000
074400       UNION                                                      08220000
074500                                                                  08230000
074600              SELECT DISTINCT                                     08240000
074700                T1.UPC_NBR                                        08250000
074800             ,  T1.UPC_RTL_AMT                                    08260000
074900             ,  'S'                                               08270000
075000             ,  SUM(T1.SCND_UNT_QTY)                              08280000
075000*            ,  SUM(T1.RFID_TGD_QTY)                              08290000
075100             ,  COALESCE(T2.APP_PO_LNE_NBR,0)                     08300000
075200             ,  0                                                 08310000
075300             ,  T1.UPC_NBR                                        08320000
075400             ,  T1.INTR_UPC_ID                                    08330000
075400             ,  'C'                                               08331023
075500          FROM                                                    08340000
075600          ( SELECT                                                08350000
075700                B.UPC_NBR                                         08360000
075800             ,  B.UPC_RTL_AMT                                     08370000
075900             ,  B.SCND_UNT_QTY                                    08380000
075900*            ,  B.RFID_TGD_QTY                                    08390000
076000             ,  D.ITM_NBR                                         08400000
076100             ,  A.TRN_NBR                                         08410000
076200             ,  C.INTR_UPC_ID                                     08420000
076300          FROM  TSUATRN     A                                     08430000
076400              , TSUAUPC     B                                     08440000
076500              , XLT_UPC     C                                     08450000
076600              , XLT_SKU     D                                     08460000
076700          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               08470000
076800            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           08480000
076900            AND A.AUD_CNTL_NBR      = B.AUD_CNTL_NBR              08490000
077000            AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              08500000
077100            AND B.SCN_TYP_CDE      <> 'E'                         08510000
077200            AND B.UPC_NBR           = C.UPC_NBR                   08520000
077300            AND C.INTR_UPC_ID       = D.INTR_UPC_ID               08530000
077400            AND C.INTR_UPC_ID   NOT IN                            08540000
077500                (SELECT F.INTR_UPC_ID                             08550000
077600                   FROM TSHUUPC  E                                08560000
077700                      , XLT_UPC  F                                08570000
077800                  WHERE B.SHIPT_UNT_ID   = E.SHIPT_UNT_ID         08580000
077900                    AND E.UPC_NBR        = F.UPC_NBR)             08590000
078000                ) AS T1                                           08600000
078100                                                                  08610000
078200          LEFT OUTER JOIN                                         08620000
078300          (SELECT D.APP_PO_LNE_NBR                                08630000
078400              ,   D.ITM_NBR                                       08640000
078500              ,   D.PO_NBR                                        08650000
078600              ,   D.VER_STATUS_CDE                                08660000
078700             FROM TPURITM     D                                   08670025
                  WHERE D.APP_PO_LNE_NBR =                              08671025
                     (SELECT (MIN(G.APP_PO_LNE_NBR ) )                  08672025
                       FROM  TPURITM     G                              08673039
                       WHERE D.PO_NBR = G.PO_NBR                        08674028
                        AND D.ITM_NBR = G.ITM_NBR                       08675032
                        AND G.VER_STATUS_CDE   = 'A'                    08675132
                        AND G.STATUS_CDE =                              08676032
                            (SELECT (MIN(H.STATUS_CDE ) )               08677032
                             FROM TPURITM     H                         08678032
                             WHERE H.PO_NBR = G.PO_NBR                  08679032
                              AND H.ITM_NBR = G.ITM_NBR                 08679132
                              AND H.VER_STATUS_CDE   = 'A')))           08679232
  8800            AS T2                                                 08680023
078900            ON  T1.ITM_NBR          = T2.ITM_NBR                  08690000
079000            AND T1.TRN_NBR          = T2.PO_NBR                   08700000
079100            AND T2.VER_STATUS_CDE   = 'A'                         08710000
079200          GROUP BY T1.UPC_NBR                                     08720000
079300                ,  T1.UPC_RTL_AMT                                 08730000
079400                ,  T2.APP_PO_LNE_NBR                              08740000
079500                ,  T1.INTR_UPC_ID                                 08750000
079600       UNION                                                      08760000
079700                                                                  08770000
079800              SELECT DISTINCT                                     08780000
079900                A.UPC_NBR                                         08790000
080000             ,  A.UPC_RTL_AMT                                     08800000
080100             ,  'S'                                               08810000
080200             ,  SUM(A.SCND_UNT_QTY)                               08820000
080200*            ,  SUM(A.RFID_TGD_QTY)                               08830000
080300             ,  0                                                 08840000
080400             ,  0                                                 08850000
080500             ,  A.UPC_NBR                                         08860000
080600             ,  0                                                 08870000
080600             , 'D'                                                08871023
080700          FROM                                                    08880000
080800                TSUAUPC        A                                  08890000
080900          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               08900000
081000            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           08910000
081100            AND A.SCN_TYP_CDE      <> 'E'                         08920000
081200            AND A.UPC_NBR       NOT IN                            08930000
081300                (SELECT B.UPC_NBR                                 08940000
081400                   FROM TSHUUPC  B                                08950000
081500                  WHERE A.UPC_NBR        = B.UPC_NBR              08960000
081600                    AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID         08970000
081700                )                                                 08980000
081800            AND A.UPC_NBR       NOT IN                            08990000
081900                (SELECT C.UPC_NBR                                 09000000
082000                   FROM XLT_UPC  C                                09010000
082100                  WHERE A.UPC_NBR        = C.UPC_NBR              09020000
082200                )                                                 09030000
082300          GROUP BY A.UPC_NBR                                      09040000
082400                ,  A.UPC_RTL_AMT                                  09050000
082500       UNION                                                      09060000
082600          SELECT DISTINCT                                         09070000
082700                A.UPC_NBR                                         09080000
082800             ,  0                                                 09090000
082900             , 'E'                                                09100000
083000             ,  COUNT(*)                                          09110000
083000*            ,  COUNT(*)                                          09120000
083100             ,  0                                                 09130000
083200             ,  0                                                 09140000
083300             ,  0                                                 09150000
083400             ,  0                                                 09160000
083400             , 'E'                                                09161023
083500          FROM                                                    09170000
083600                TSUEXCP        A                                  09180000
083700          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               09190000
083800            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           09200000
083900            AND NOT EXISTS                                        09210000
084000                (SELECT *                                         09220000
084100                   FROM TSUAUPC  B                                09230000
084200                  WHERE A.AUD_CNTL_NBR   = B.AUD_CNTL_NBR         09240000
084300                    AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID         09250000
084400                    AND A.UPC_NBR        = B.UPC_NBR)             09260000
084500                                                                  09270000
084600          GROUP BY A.UPC_NBR                                      09280000
084700                                                                  09290000
084800       ORDER BY 5                                                 09300000
084900             ,  1                                                 09310000
085000             ,  3                                                 09320000
085100                                                                  09330000
085200     END-EXEC.                                                    09340000
085300                                                                  09350000
085400     EXEC SQL                                                     09360000
085500          DECLARE AUD-DETAIL-MAN-CSR CURSOR                       09370000
085600                                                                  09380000
085700         FOR SELECT DISTINCT                                      09390000
085800                A.UPC_NBR                                         09400000
085900             ,  A.UPC_RTL_AMT                                     09410000
086000             ,  'S'                                               09420000
086100             ,  SUM(A.SCND_UNT_QTY)                               09430000
086100*            ,  SUM(A.RFID_TGD_QTY)                               09440000
086200             ,  B.TRN_LNE_NBR                                     09450000
086300             ,  B.SHPD_QTY                                        09460000
086400             ,  B.UPC_NBR                                         09470000
086500             ,  C.INTR_UPC_ID                                     09480000
086500             ,  'A'                                               09481034
086600          FROM                                                    09490000
086700                TSUAUPC        A                                  09500000
086800            ,   TSHUUPC        B                                  09510000
086900            ,   XLT_UPC        C                                  09520000
087000            ,   XLT_UPC        D                                  09530000
087100          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               09540000
087200            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           09550000
087300            AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              09560000
087400            AND A.UPC_NBR           = C.UPC_NBR                   09570000
087500            AND B.UPC_NBR           = D.UPC_NBR                   09580000
087600            AND C.INTR_UPC_ID       = D.INTR_UPC_ID               09590000
087700            AND A.SCN_TYP_CDE      <> 'E'                         09600000
087800                                                                  09610000
087900          GROUP BY A.UPC_NBR                                      09620000
088000                ,  A.UPC_RTL_AMT                                  09630000
088100                ,  B.TRN_LNE_NBR                                  09640000
088200                ,  B.SHPD_QTY                                     09650000
088300                ,  B.UPC_NBR                                      09660000
088400                ,  C.INTR_UPC_ID                                  09670000
088500                                                                  09680000
088600       UNION                                                      09690000
088700                                                                  09700000
088800         SELECT DISTINCT                                          09710000
088900                B.UPC_NBR                                         09720000
089000             ,  99                                                09730000
089100             ,  'E'                                               09740000
089200             ,  SUM(B.SHPD_QTY)                                   09750000
089200*            ,  SUM(B.SHPD_QTY)                                   09760000
089300             ,  B.TRN_LNE_NBR                                     09770000
089400             ,  B.SHPD_QTY                                        09780000
089500             ,  B.UPC_NBR                                         09790000
089600             ,  C.INTR_UPC_ID                                     09800000
086500             ,  'B'                                               09801034
089700          FROM                                                    09810000
089800                TSHUUPC        B                                  09820000
089900             ,  XLT_UPC        C                                  09830000
090000          WHERE B.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           09840000
090100            AND B.UPC_NBR       = C.UPC_NBR                       09850000
090200            AND C.INTR_UPC_ID   NOT IN                            09860000
090300                (SELECT H.INTR_UPC_ID                             09870000
090400                   FROM TSUAUPC  G                                09880000
090500                     ,  XLT_UPC  H                                09890000
090600                  WHERE G.AUD_CNTL_NBR      = :DK-AUDIT-NBR       09900000
090700                    AND G.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID   09910000
090800                    AND G.UPC_NBR           = H.UPC_NBR)          09920000
090900                                                                  09930000
091000          GROUP BY B.UPC_NBR                                      09940000
091100                ,  B.TRN_LNE_NBR                                  09950000
091200                ,  B.SHPD_QTY                                     09960000
091200                ,  B.SHPD_QTY                                     09970000
091300                ,  B.UPC_NBR                                      09980000
091400                ,  C.INTR_UPC_ID                                  09990000
091500                                                                  10000000
091600       UNION                                                      10010000
091700                                                                  10020000
091800              SELECT DISTINCT                                     10030000
091900                T1.UPC_NBR                                        10040000
092000             ,  T1.UPC_RTL_AMT                                    10050000
092100             ,  'S'                                               10060000
092200             ,  SUM(T1.SCND_UNT_QTY)                              10070000
092200*            ,  SUM(T1.RFID_TGD_QTY)                              10080000
092300             ,  COALESCE(T2.APP_PO_LNE_NBR,0)                     10090000
092400             ,  0                                                 10100000
092500             ,  T1.UPC_NBR                                        10110000
092600             ,  T1.INTR_UPC_ID                                    10120000
086500             ,  'C'                                               10121034
092700          FROM                                                    10130000
092800          ( SELECT                                                10140000
092900                B.UPC_NBR                                         10150000
093000             ,  B.UPC_RTL_AMT                                     10160000
093100             ,  B.SCND_UNT_QTY                                    10170000
093100*            ,  B.RFID_TGD_QTY                                    10180000
093200             ,  D.ITM_NBR                                         10190000
093300             ,  A.TRN_NBR                                         10200000
093400             ,  C.INTR_UPC_ID                                     10210000
093500          FROM  TSUATRN     A                                     10220000
093600              , TSUAUPC     B                                     10230000
093700              , XLT_UPC     C                                     10240000
093800              , XLT_SKU     D                                     10250000
093900          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               10260000
094000            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           10270000
094100            AND A.AUD_CNTL_NBR      = B.AUD_CNTL_NBR              10280000
094200            AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              10290000
094300            AND B.SCN_TYP_CDE      <> 'E'                         10300000
094400            AND B.UPC_NBR           = C.UPC_NBR                   10310000
094500            AND C.INTR_UPC_ID       = D.INTR_UPC_ID               10320000
094600            AND C.INTR_UPC_ID   NOT IN                            10330000
094700                (SELECT F.INTR_UPC_ID                             10340000
094800                   FROM TSHUUPC  E                                10350000
094900                    ,   XLT_UPC  F                                10360000
095000                  WHERE E.UPC_NBR        = F.UPC_NBR              10370000
095100                    AND B.SHIPT_UNT_ID   = E.SHIPT_UNT_ID)        10380000
095200                ) AS T1                                           10390000
095300                                                                  10400000
095400          LEFT OUTER JOIN                                         10410000
078300          (SELECT D.APP_PO_LNE_NBR                                10411033
078400              ,   D.ITM_NBR                                       10412033
078500              ,   D.PO_NBR                                        10413033
078600              ,   D.VER_STATUS_CDE                                10414033
078700             FROM TPURITM     D                                   10415033
                  WHERE D.APP_PO_LNE_NBR =                              10416033
                     (SELECT (MIN(G.APP_PO_LNE_NBR ) )                  10417033
                       FROM TPURITM     G                               10418039
                       WHERE D.PO_NBR = G.PO_NBR                        10419033
                        AND D.ITM_NBR = G.ITM_NBR                       10419133
                        AND G.VER_STATUS_CDE   = 'A'                    10419233
                        AND G.STATUS_CDE =                              10419333
                            (SELECT (MIN(H.STATUS_CDE ) )               10419433
                             FROM TPURITM     H                         10419533
                             WHERE H.PO_NBR = G.PO_NBR                  10419633
                              AND H.ITM_NBR = G.ITM_NBR                 10419733
                              AND H.VER_STATUS_CDE   = 'A')))           10419833
096000            AS T2                                                 10470000
096100            ON  T1.ITM_NBR          = T2.ITM_NBR                  10480000
096200            AND T1.TRN_NBR          = T2.PO_NBR                   10490000
096300            AND T2.VER_STATUS_CDE   = 'A'                         10500000
096400          GROUP BY T1.UPC_NBR                                     10510000
096500                ,  T1.UPC_RTL_AMT                                 10520000
096600                ,  T2.APP_PO_LNE_NBR                              10530000
096700                ,  T1.INTR_UPC_ID                                 10540000
096800       UNION                                                      10550000
096900                                                                  10560000
097000              SELECT DISTINCT                                     10570000
097100                A.UPC_NBR                                         10580000
097200             ,  A.UPC_RTL_AMT                                     10590000
097300             ,  'S'                                               10600000
097400             ,  SUM(A.SCND_UNT_QTY)                               10610000
097400*            ,  SUM(A.RFID_TGD_QTY)                               10620000
097500             ,  0                                                 10630000
097600             ,  0                                                 10640000
097700             ,  A.UPC_NBR                                         10650000
097800             ,  0                                                 10660000
086500             ,  'D'                                               10661034
097900          FROM                                                    10670000
098000                TSUAUPC        A                                  10680000
098100          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               10690000
098200            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           10700000
098300            AND A.SCN_TYP_CDE      <> 'E'                         10710000
098400            AND A.UPC_NBR       NOT IN                            10720000
098500                (SELECT B.UPC_NBR                                 10730000
098600                   FROM TSHUUPC  B                                10740000
098700                  WHERE A.UPC_NBR        = B.UPC_NBR              10750000
098800                    AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID         10760000
098900                )                                                 10770000
099000            AND A.UPC_NBR       NOT IN                            10780000
099100                (SELECT C.UPC_NBR                                 10790000
099200                   FROM XLT_UPC  C                                10800000
099300                  WHERE A.UPC_NBR        = C.UPC_NBR              10810000
099400                )                                                 10820000
099500          GROUP BY A.UPC_NBR                                      10830000
099600                ,  A.UPC_RTL_AMT                                  10840000
099700       UNION                                                      10850000
099800          SELECT DISTINCT                                         10860000
099900                A.UPC_NBR                                         10870000
100000             ,  0                                                 10880000
100100             , 'E'                                                10890000
100200             ,  COUNT(*)                                          10900000
100200*            ,  COUNT(*)                                          10910000
100300             ,  0                                                 10920000
100400             ,  0                                                 10930000
100500             ,  0                                                 10940000
100600             ,  0                                                 10950000
086500             ,  'E'                                               10951034
100700          FROM                                                    10960000
100800                TSUEXCP        A                                  10970000
100900          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               10980000
101000            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           10990000
101100            AND NOT EXISTS                                        11000000
101200                (SELECT *                                         11010000
101300                   FROM TSUAUPC  B                                11020000
101400                  WHERE A.AUD_CNTL_NBR   = B.AUD_CNTL_NBR         11030000
101500                    AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID         11040000
101600                    AND A.UPC_NBR        = B.UPC_NBR)             11050000
101700                                                                  11060000
101800          GROUP BY A.UPC_NBR                                      11070000
      *SB 04/23/14 - BEGIN PR#5148D                                     11070100
                UNION                                                   11071000
                SELECT DISTINCT B.UPC_NBR                               11071100
                             ,  99                                      11071200
                             ,  'E'                                     11071300
                             ,  0                                       11071400
                             ,  B.TRN_LNE_NBR                           11071800
                             ,  B.SHPD_QTY                              11071900
                             ,  B.UPC_NBR                               11072000
                             ,  C.INTR_UPC_ID                           11072100
                             ,  'F'                                     11072234
                          FROM                                          11072300
                                TSHUUPC   B                             11072400
                             ,  XLT_UPC   C                             11072500
                             ,  TSUEXCP   D                             11072600
                             ,  TSUAUPC   E                             11072700
                WHERE B.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID               11072800
                  AND E.AUD_CNTL_NBR  = :DK-AUDIT-NBR                   11072900
                  AND E.UPC_NBR       = D.UPC_NBR                       11073000
                  AND D.UPC_NBR       = C.UPC_NBR                       11073100
                  AND B.UPC_NBR       = C.UPC_NBR                       11073200
                  AND E.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  11073300
                  AND B.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                  11073400
                  AND D.VILN_GP_CDE   = 'VA'                            11073500
                  AND D.VILN_GP_SEQ_NBR = 30                            11073600
                  AND D.SCN_TMST      = E.SCN_TMST                      11073700
                  AND D.AUD_CNTL_NBR  = E.AUD_CNTL_NBR                  11073800
                  AND B.UPC_NBR NOT IN                                  11073900
                      (SELECT G.UPC_NBR                                 11074000
                         FROM TSUAUPC  G                                11074100
                        WHERE G.AUD_CNTL_NBR      = :DK-AUDIT-NBR       11074300
                          AND G.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID   11074400
                          AND G.SCN_TYP_CDE = 'S')                      11074600
               GROUP BY B.UPC_NBR                                       11074800
                     ,  B.TRN_LNE_NBR                                   11074900
                     ,  B.SHPD_QTY                                      11075000
                     ,  B.UPC_NBR                                       11075100
                     ,  C.INTR_UPC_ID                                   11076000
      *SB 04/23/14 - END   PR#5148D                                     11077000
102000       ORDER BY 5                                                 11090000
102100             ,  1                                                 11100000
102200             ,  3                                                 11110000
102300                                                                  11120000
102400     END-EXEC.                                                    11130000
102500                                                                  11140000
102600 LINKAGE SECTION.                                                 11150000
102700                                                                  11160000
102800 01  DFHCOMMAREA.                                                 11170000
102900     05  FILLER                         OCCURS  1 TO 4072 TIMES   11180000
103000                                        DEPENDING ON EIBCALEN.    11190000
103100         10  FILLER                     PIC X.                    11200000
103200                                                                  11210000
103300 PROCEDURE DIVISION.                                              11220000
103400******************************************************************11230000
103500**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **11240000
103600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **11250000
103700**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **11260000
103800******************************************************************11270000
103900 0000-MAIN-MODULE.                                                11280000
104000     INITIALIZE DP030-CICS-API-FIELDS.                            11290000
104100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       11300000
104200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          11310000
104300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         11320000
104400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       11330000
104500     MOVE LENGTH OF SU592AI        TO DP030-MAP-LENGTH (1).       11340000
104600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     11350000
104700     PERFORM 0001-CALL-CICS-ARCH-API.                             11360000
104800*                                                                 11370000
104900     PERFORM 1000-CONTROL-PROCESSING                              11380000
105000*                                                                 11390000
105100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     11400000
105200     PERFORM 0001-CALL-CICS-ARCH-API.                             11410000
105300                                                                  11420000
105400******************************************************************11430000
105500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **11440000
105600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **11450000
105700******************************************************************11460000
105800 0001-CALL-CICS-ARCH-API.                                         11470000
105900*    CALL 'DPKCS030' USING DFHEIBLK                               11480042
105900     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      11481042
106000                           DFHCOMMAREA                            11490000
106100                           DP030-CICS-API-FIELDS                  11500000
106200                           DP020-STANDARD-COMMAREA                11510000
106300                           SU592AI.                               11520000
106400*                                                                 11530000
106500     IF  DP030-RC-CALL-SUCCESSFUL                                 11540000
106600         CONTINUE                                                 11550000
106700     ELSE                                                         11560000
106800         SET DP013-NO-ROLLBACK                                    11570000
106900             DP013-XCTL-DISPLAY-RESTART                           11580000
107000             DP013-CICS-ABEND      TO TRUE                        11590000
107100         MOVE '0001-CALL-CICS-ARCH-API'                           11600000
107200                                   TO DP013-PARAGRAPH             11610000
107300*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX11620042
107400*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      11630042
107300         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O11631042
107400-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      11632042
107500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      11640000
107600         PERFORM DP013-0000-PROCESS-ABEND                         11650000
107700     END-IF.                                                      11660000
107800*----------------------------------------------------------------*11670000
107900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *11680000
108000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *11690000
108100*                                                                *11700000
108200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *11710000
108300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *11720000
108400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *11730000
108500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *11740000
108600*----------------------------------------------------------------*11750000
108700                                                                  11760000
108800 1000-CONTROL-PROCESSING.                                         11770000
108900                                                                  11780000
109000     EVALUATE TRUE                                                11790000
109100         WHEN DP020-NEXT-ACT-INITIAL                              11800000
109200             INITIALIZE ASC-SPECIFIC-COMMAREA                     11810000
109300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            11820000
109400                                      ASC-SEL-TERM-ID             11830000
109500             MOVE DP020-SRC-TASK-NUMBER                           11840000
109600                                   TO ASC-LIST-TASK-NUMBER        11850000
109700                                      ASC-SEL-TASK-NUMBER         11860000
109800             MOVE PC-LIST-QUEUE-SEQ                               11870000
109900                                   TO ASC-LIST-SEQ                11880000
110000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 11890000
110100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 11900000
110200***-----$TEMPLATE NOTE$-------------------------------------------11910000
110300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,11920000
110400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  11930000
110500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.11940000
110600***---------------------------------------------------------------11950000
110700             IF  PS-COMMAREA-NOT-VALID                            11960000
110800***              MOVE PC-TSYMSG-99901                             11970000
110900***                                TO DP020-MSG-NUMBER            11980000
111000***              SET DP020-MSG-FATAL                              11990000
111100***                                TO TRUE                        12000000
111200                 SET DP020-NEXT-ACT-APPL-ERROR                    12010000
111300                                   TO TRUE                        12020000
111400             ELSE                                                 12030000
111500                 PERFORM 4000-BUILD-INITIAL-PANEL                 12040000
111600             END-IF                                               12050000
111700                                                                  12060000
111800         WHEN DP020-NEXT-ACT-READ-MAP                             12070000
111900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        12080000
112000                                   TO PV-TOP-ITEM                 12090000
112100             PERFORM 2000-PROCESS-PANEL                           12100000
112200                                                                  12110000
112300         WHEN DP020-NEXT-ACT-RETURN                               12120000
112400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        12130000
112500                                   TO PV-TOP-ITEM                 12140000
112600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    12150000
112700             PERFORM 2050-DELETE-LIST-QUEUE                       12160000
112800             PERFORM 4000-BUILD-INITIAL-PANEL                     12170000
112900*            PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 12180000
113000*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12190000
113100                                                                  12200000
113200         WHEN OTHER                                               12210000
113300             SET DP013-LOGIC-ABEND TO TRUE                        12220000
113400             SET DP013-NO-ROLLBACK TO TRUE                        12230000
113500             MOVE '1000-CONTROL-PROCESSING'                       12240000
113600                                   TO DP013-PARAGRAPH             12250000
113700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    12260000
113800                                   TO DP013-MESSAGE-TEXT(1)       12270000
113900             PERFORM DP013-0000-PROCESS-ABEND                     12280000
114000     END-EVALUATE.                                                12290000
114100                                                                  12300000
114200*----------------------------------------------------------------*12310000
114300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *12320000
114400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *12330000
114500*----------------------------------------------------------------*12340000
114700 1100-PROCESS-INTER-APPL-COMM.                                    12350000
114800                                                                  12360000
114900     SET PS-COMMAREA-VALID         TO TRUE.                       12370000
115000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     12380000
115100                                                                  12390000
115200     EVALUATE DP020-INT-APPL-FORMAT-IND                           12400000
115300         WHEN PC-CRIT-SPEC-FORMAT                                 12410000
115400             SET ASC-CRIT-SPEC-FORMAT TO TRUE                     12420000
115500             MOVE SU023-AUDIT-STATUS    TO ASC-PROCESS-STATUS     12430000
115600             EVALUATE TRUE                                        12440000
115700                 WHEN SU023-SYSTEM                                12450000
115800                     MOVE 'SYS'   TO ASC-SOURCE                   12460000
115900                 WHEN SU023-MANUAL                                12470000
116000                     MOVE 'MAN'   TO ASC-SOURCE                   12480000
116100                 WHEN SU023-ALL                                   12490000
116200                     MOVE 'ALL'   TO ASC-SOURCE                   12500000
116300             END-EVALUATE                                         12510000
116400*            MOVE SU023-AUDIT-NBR       TO ASC-AUDIT-NBR          12520000
116500             MOVE SU023-CRTN-AUDT       TO ASC-AUDIT-NBR          12530000
116600             MOVE SU023-OPER-UNIT-ID-N  TO ASC-OPER-UNIT-ID       12540000
116700             MOVE SU023-PO              TO ASC-PO                 12550000
116800                                           ASC-PO-NBR             12560000
116900             MOVE SU023-RECEIVER-SEQ    TO ASC-RECEIVER-SEQ       12570000
117000                                           ASC-RECEIVER           12580000
117100             MOVE '-'                   TO ASC-DASH-FILLER        12590000
117200*            MOVE SU023-REQUEST-DATE    TO ASC-REQUEST-DATE       12600000
117300*            MOVE SU023-REQUEST-MDCY    TO ASC-REQUEST-MDCY       12610000
117400*            MOVE SU023-REQUEST-TIME    TO ASC-REQUEST-TIME       12620000
117500             MOVE SU023-CARTON-ID       TO ASC-CARTON-ID          12630000
117600             IF ASC-OPER-UNIT-ID > 0                              12640000
117700                 MOVE ASC-OPER-UNIT-ID        TO DK-OPER-UNT-ID   12650000
117800                 PERFORM 1500-SELECT-OPER-DESC                    12660000
117900                 MOVE XLT00010-LOC-NM         TO ASC-OPER-DESC    12670000
118000             END-IF                                               12680000
118100                                                                  12690000
118200         WHEN PC-LIST-FORMAT                                      12700000
118300             SET ASC-LIST-FORMAT TO TRUE                          12710000
118400             MOVE SU027-AUDIT-NBR       TO ASC-AUDIT-NBR          12720000
118500             MOVE SU027-REQUEST-DATE    TO ASC-REQUEST-DATE       12730000
118600             MOVE SU027-REQUEST-MDCY    TO ASC-REQUEST-MDCY       12740000
118700             MOVE SU027-REQUEST-TIME    TO ASC-REQUEST-TIME       12750000
118800             MOVE SU027-PROCESS-STATUS  TO ASC-PROCESS-STATUS     12760000
118900             MOVE SU027-PO-RECEIVER     TO ASC-PO-RECEIVER        12770000
119000             MOVE SU027-SOURCE          TO ASC-SOURCE             12780000
119100             MOVE SU027-OPER-UNIT-ID    TO ASC-OPER-UNIT-ID       12790000
119200             MOVE SU027-OPER-DESC       TO ASC-OPER-DESC          12800000
119300             MOVE SU027-PACKAGING-TYPE  TO ASC-PACKAGING-TYPE     12810000
119400             MOVE SU027-ENT-ID          TO ASC-ENT-ID             12820000
119500             MOVE SU027-VENDOR-NAME     TO ASC-VENDOR-NAME        12830000
119600             MOVE SU027-DEPT-NBR        TO ASC-DEPT-NBR-N         12840000
119700             MOVE SU027-DEPARTMENT-DESC TO ASC-DEPARTMENT-DESC    12850000
119800                                                                  12860000
119900             SET ASC-USE-SELECTION-QUEUE TO TRUE                  12870000
120000             MOVE SU027-NUMBER-OF-SELECTED-ITEMS                  12880000
120100                                   TO ASC-NUMBER-OF-SELECTED-ITEMS12890000
120200             MOVE SU027-NUMBER-OF-TS-ITEMS                        12900000
120300                                   TO ASC-NUMBER-OF-TS-ITEMS      12910000
120400             MOVE SU027-SEL-QUEUE-NAME                            12920000
120500                                   TO ASC-SEL-QUEUE-NAME-IN       12930000
120600             PERFORM 1120-PREPARE-LIST-ENTRY                      12940000
120700                                                                  12950000
120800         WHEN OTHER                                               12960000
120900             IF  DP020-NAV-KEY-DATA > SPACE                       12970000
121000                 PERFORM 1110-EDIT-NAV-KEY                        12980000
121100             ELSE                                                 12990000
121200                 MOVE PC-TSYMSG-00148                             13000000
121300                                   TO DP020-MSG-NUMBER            13010000
121400                 SET DP020-MSG-FATAL                              13020000
121500                     DP020-NEXT-ACT-APPL-ERROR                    13030000
121600                                   TO TRUE                        13040000
121700             END-IF                                               13050000
121800     END-EVALUATE.                                                13060000
121900                                                                  13070000
122000******************************************************************13080000
122100** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **13090000
122200** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **13100000
122300** ACCEPTED.                                                    **13110000
122400******************************************************************13120000
122500 1110-EDIT-NAV-KEY.                                               13130000
122600     IF  ASC-ENT-ID > SPACE                                       13140000
122700         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       13150000
122800         MOVE LENGTH OF ASC-ENT-ID                                13160000
122900                                   TO DP010I-MAXIMUM-DIGITS       13170000
123000         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     13180000
123100         SET DP010I-NEGATIVE-NOT-ALLOWED                          13190000
123200                                   TO TRUE                        13200000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13211041
263968              USING DP010I-NUMERIC-EDIT-AREA                      13212041
123400         IF  DP010I-ERROR-DETECTED                                13220000
123500             SET PS-ERROR                                         13230000
123600                 DP020-MSG-FATAL   TO TRUE                        13240000
123700*            -- INVALID DATA IN KEY FIELD ---                     13250000
123800             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            13260000
123900             SET DP020-NEXT-ACT-APPL-ERROR                        13270000
124000                                   TO TRUE                        13280000
124100         ELSE                                                     13290000
124200             MOVE DP010I-NUMERIC-FIELD                            13300000
124300                                   TO ASC-ENT-ID-N                13310000
124400         END-IF                                                   13320000
124500     END-IF.                                                      13330000
124600*----------------------------------------------------------------*13340000
124700* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *13350000
124800* STORAGE QUEUE PASSED FROM THE LIST.                            *13360000
124900*----------------------------------------------------------------*13370000
125000 1120-PREPARE-LIST-ENTRY.                                         13380000
125100     MOVE SU028-MAX-ITEMS          TO ASC-SEL-SUB.                13390000
125200     MOVE ZERO                     TO ASC-SEL-ITEM.               13400000
125300     PERFORM 1130-GET-NEXT-RECORD.                                13410000
125400                                                                  13420000
098600******************************************************************13430000
      *VSH 11/21/13 - BEGIN PR#5148D                                    13440000
098700 1250-MOD-QTY-IND.                                                13450000
098800                                                                  13460000
           INITIALIZE ASC-RFID-AUDIT-IND                                13470000
           INITIALIZE ASC-COUNT                                         13480000
098900     MOVE ASC-AUDIT-NBR  TO DK-AUDIT-NBR.                         13490000
099000     MOVE 0              TO ASC-OTHER-AUDIT.                      13500000
099100     EXEC SQL                                                     13510000
               SELECT VALUE(RWRK_AUD_CNTL_NBR,0)                        13520000
                     ,PO_PREPK_ID                                       13530000
                     ,PKGNG_TYP_CDE                                     13540000
                     ,AUD_STAT_CDE                                      13550000
                     ,PO_LNE_NBR                                        13560000
                     ,CRE_TMST                                          13570000
               INTO  :SUT00015-RWRK-AUD-CNTL-NBR                        13580000
                    ,:SUT00015-PO-PREPK-ID                              13590000
                    ,:SUT00015-PKGNG-TYP-CDE                            13600000
                    ,:SUT00015-AUD-STAT-CDE                             13610000
                    ,:SUT00015-PO-LNE-NBR                               13620000
                    ,:SUT00015-CRE-TMST                                 13630000
099400         FROM   SUT_PO_AUD_REQ                                    13640000
099500         WHERE                                                    13650000
099600             AUD_CNTL_NBR   = :DK-AUDIT-NBR                       13660000
099700     END-EXEC.                                                    13670000
099800                                                                  13680000
099900     EVALUATE TRUE                                                13690000
100000         WHEN SQLCODE = +0                                        13700000
                   IF SUT00015-PKGNG-TYP-CDE = 'RF' AND                 13710000
                      SUT00015-PO-PREPK-ID       < 0                    13720000
      *               ITS A RFID AUDIT                                  13730000
                      PERFORM 4432-QC-RFID-COMB-COUNT                   13740000
                      SET ASC-RFID-AUD          TO TRUE                 13750000
                   END-IF                                               13760000
                   IF (DK-AUDIT-NBR > 0 AND                             13770000
                      (SUT00015-RWRK-AUD-CNTL-NBR > 0 OR ASC-COUNT > 0))13780000
      *               ITS A QC AND RFID AUDIT                           13790000
                       SET ASC-MULTIPLE-AUD      TO TRUE                13800000
                       MOVE SUT00015-AUD-STAT-CDE TO ASC-PROCESS-STATUS 13810000
                       MOVE SUT00015-PKGNG-TYP-CDE TO ASC-PACKAGING-TYPE13820000
                       MOVE SUT00015-CRE-TMST(1:04) TO                  13830000
                                            PV-REQ-DATE-MDCY-CCYY       13840000
                       MOVE SUT00015-CRE-TMST(6:02) TO                  13850000
                                            PV-REQ-DATE-MDCY-MM         13860000
                       MOVE SUT00015-CRE-TMST(9:02) TO                  13870000
                                            PV-REQ-DATE-MDCY-DD         13880000
                       MOVE SUT00015-CRE-TMST(12:02) TO                 13890000
                                            PV-REQ-TIME-HR              13900000
                       MOVE SUT00015-CRE-TMST(15:02) TO                 13910000
                                            PV-REQ-TIME-MN              13920000
                       MOVE PV-REQ-DATE-MDCY TO ASC-REQUEST-MDCY        13930000
                       MOVE PV-REQ-TIME TO ASC-REQUEST-TIME             13940000
                                                                        13950000
                       IF ASC-RFID-AUD                                  13960000
                         IF ASC-COUNT = 1                               13970000
      *                    ITS A RFID AND HAS ONLY ONE QA AUDIT         13980000
      *                     ASSOCIATE WITH IT                           13990000
                          PERFORM 4433-RFID-AUD-CNTL-NBR                14000000
                          PERFORM 4434-CARTON-MULTP-AUD                 14010000
                          MOVE ASC-RFID-AUD-CNTL-NBR TO ASC-OTHER-AUDIT 14020000
                         ELSE                                           14030000
                            IF ASC-COUNT > 1                            14040000
                               PERFORM 4435-CARTON-MULTP-AUD-QC         14050000
                            END-IF                                      14060000
                         END-IF                                         14070000
                       ELSE                                             14080000
                          MOVE SUT00015-RWRK-AUD-CNTL-NBR               14090000
                                                TO ASC-OTHER-AUDIT      14100000
                       END-IF                                           14110000
                   ELSE                                                 14120000
                       SET ASC-NOT-MULTIPLE-AUD  TO TRUE                14130000
                   END-IF                                               14140000
                                                                        14150000
100200         WHEN SQLCODE = +100                                      14160000
                    SET ASC-NOT-MULTIPLE-AUD     TO TRUE                14170000
100400         WHEN SQLWARN0 NOT = SPACES                               14180000
100500         WHEN SQLCODE < +0                                        14190000
100600         WHEN SQLCODE > ZERO                                      14200000
100700             MOVE '1250-MOD-QTY-IND'                              14210000
100800                             TO DP013-PARAGRAPH                   14220000
100900             MOVE 'SELECT MOD QTY IND'                            14230000
101000                             TO DP013-MESSAGE-TEXT (1)            14240000
101100             MOVE SQLCA      TO DP013-SQLCA                       14250000
101200             MOVE 'SUT_PO_AUD_REQ' TO DP013-DB2-TABLE-NAME (1)    14260000
101300             SET DP013-DB2-ABEND                                  14270000
101400                             TO TRUE                              14280000
101500             SET DP013-XCTL-DISPLAY-RESTART                       14290000
101600                             TO TRUE                              14300000
101700             PERFORM DP013-0000-PROCESS-ABEND                     14310000
101800     END-EVALUATE.                                                14320000
101900*                                                                 14330000
      *VSH 11/21/13 - END PR#5148D                                      14340000
125500 1400-SELECT-DEPARTMENT.                                          14350000
125600                                                                  14360000
125700     EXEC SQL                                                     14370000
125800         SELECT A.ENT_ID                                          14380000
125900             ,  B.MDSEAR_DESC                                     14390000
126000          INTO  :VNDDPT-ENT-ID                                    14400000
126100             ,  :MDSEAR-DESC                                      14410000
126200          FROM  TVNDDPT A                                         14420000
126300             ,  TMDSEAR B                                         14430000
126400          WHERE A.ENT_ID         = :DK-ENT-ID                     14440000
126500            AND A.DEPT_NBR       = :DK-DEPT                       14450000
126600            AND A.DEPT_NBR       = B.DEPT_NBR                     14460000
126700            AND B.MDSELV_CDE     = 'DPT'                          14470000
126800            AND B.OPERCO_NBR     = '03'                           14480000
126900            AND (B.STRT_DTE     <= CURRENT DATE AND               14490000
127000                 B.END_DTE       > CURRENT DATE)                  14500000
127100     END-EXEC.                                                    14510000
127200                                                                  14520000
127300     EVALUATE TRUE                                                14530000
127400         WHEN SQLCODE = +0                                        14540000
127500             CONTINUE                                             14550000
127600                                                                  14560000
127700         WHEN SQLCODE = +100                                      14570000
127800             MOVE SPACES           TO MDSEAR-DESC                 14580000
127900                                                                  14590000
128000         WHEN SQLWARN0 NOT = SPACE                                14600000
128100         WHEN SQLCODE < +0                                        14610000
128200         WHEN SQLCODE > +0                                        14620000
128300             MOVE '1400-SELECT-DEPARTMENT'                        14630000
128400                             TO DP013-PARAGRAPH                   14640000
128500             MOVE 'VALIDATE THE DEPT NUMBER'                      14650000
128600                             TO DP013-MESSAGE-TEXT (1)            14660000
128700             MOVE SQLCA      TO DP013-SQLCA                       14670000
128800             MOVE 'TVNDDPT'  TO DP013-DB2-TABLE-NAME (1)          14680000
128900             MOVE 'TMDSEAR'  TO DP013-DB2-TABLE-NAME (2)          14690000
129000             MOVE DK-ENT-ID  TO PV-DISP-ENT-ID                    14700000
129100             STRING 'ENT-ID = '                                   14710000
129200                    PV-DISP-ENT-ID                                14720000
129300                    ' DEPT = '                                    14730000
129400                    DK-DEPT                                       14740000
129500                       DELIMITED BY SIZE                          14750000
129600                           INTO DP013-MESSAGE-TEXT (2)            14760000
129700             SET DP013-DB2-ABEND                                  14770000
129800                             TO TRUE                              14780000
129900             SET DP013-XCTL-DISPLAY-RESTART                       14790000
130000                             TO TRUE                              14800000
130100             PERFORM DP013-0000-PROCESS-ABEND                     14810000
130200     END-EVALUATE.                                                14820000
130300                                                                  14830000
130400 1500-SELECT-OPER-DESC.                                           14840000
130500                                                                  14850000
130600     EXEC SQL                                                     14860000
130700        SELECT                                                    14870000
130800             LOC_NM                                               14880000
130900          INTO                                                    14890000
131000             :XLT00010-LOC-NM                                     14900000
131100          FROM  XLT_LOC                                           14910000
131200        WHERE  LOC_TYP_CDE    = :PC-DC                            14920000
131300          AND  LOC_NBR        = :DK-OPER-UNT-ID                   14930000
131400          AND  E_BUS_IND      = :PC-N                             14940000
131500          AND  OPN_DTE        < CURRENT DATE + 1 DAY              14950000
131500          AND  CLO_DTE        = :PC-MAX-DATE                      14960000
132000     END-EXEC.                                                    14970000
132100                                                                  14980000
132200     EVALUATE TRUE                                                14990000
132300         WHEN SQLCODE = ZERO                                      15000000
132400             CONTINUE                                             15010000
132500         WHEN SQLCODE = +100                                      15020000
132600             MOVE SPACES   TO XLT00010-LOC-NM                     15030000
132700                                                                  15040000
132800         WHEN SQLWARN0 NOT = SPACES                               15050000
132900         WHEN SQLCODE < +0                                        15060000
133000         WHEN SQLCODE > ZERO                                      15070000
133100             MOVE '1500-SELECT-OPER-DESC'    TO DP013-PARAGRAPH   15080000
133300             MOVE 'SELECT OPER UNIT'     TO DP013-MESSAGE-TEXT (1)15090000
133500             MOVE SQLCA      TO DP013-SQLCA                       15100000
133600             MOVE 'XLT_LOC'  TO DP013-DB2-TABLE-NAME (1)          15110000
133700             MOVE DK-OPER-UNT-ID  TO PV-DISP-OPER-UNT-ID          15120000
133800             STRING 'OPER = '                                     15130000
133900                    PV-DISP-OPER-UNT-ID                           15140000
134000                            DELIMITED BY SIZE                     15150000
134100                           INTO DP013-MESSAGE-TEXT (2)            15160000
134200             SET DP013-DB2-ABEND                                  15170000
134300                             TO TRUE                              15180000
134400             SET DP013-XCTL-DISPLAY-RESTART                       15190000
134500                             TO TRUE                              15200000
134600             PERFORM DP013-0000-PROCESS-ABEND                     15210000
134700     END-EVALUATE.                                                15220000
134800*----------------------------------------------------------------*15230000
134900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *15240000
135000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *15250000
135100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *15260000
135200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *15270000
135300* FUNCTION KEYS CAN GET THIS FAR.                                *15280000
135400*----------------------------------------------------------------*15290000
135500                                                                  15300000
135600 2000-PROCESS-PANEL.                                              15310000
135700     EVALUATE TRUE                                                15320000
135800         WHEN DP020-SRC-AID = DP016-CLEAR                         15330000
135900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    15340000
136000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15350000
136100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15360000
136200                                                                  15370000
136300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    15380000
136400             MOVE ASC-ENT-ID-N     TO DK-ENT-ID                   15390000
136500             MOVE ASC-DEPT-NBR-N   TO DK-AUDIT-NBR                15400000
136600             PERFORM 2050-DELETE-LIST-QUEUE                       15410000
136700             PERFORM 4000-BUILD-INITIAL-PANEL                     15420000
136800                                                                  15430000
136900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             15440000
137000             IF ASC-USE-SELECTION-QUEUE                           15450000
137100                 IF ASC-CRIT-SPEC-FORMAT                          15460000
137200                    MOVE '1' TO DP020-INT-APPL-FORMAT-IND         15470000
137300                 END-IF                                           15480000
137400                 IF ASC-LIST-FORMAT                               15490000
137500                    MOVE '2' TO DP020-INT-APPL-FORMAT-IND         15500000
137600                 END-IF                                           15510000
137700                 PERFORM 1130-GET-NEXT-RECORD                     15520000
137800                 IF PS-LIST-END                                   15530000
137900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         15540000
138000                     SET PS-NO-LIST-END TO TRUE                   15550000
138100                 ELSE                                             15560000
138200                     PERFORM 2050-DELETE-LIST-QUEUE               15570000
138300                     PERFORM 3200-RESET-ATTRIBUTES                15580000
138400                     PERFORM 4000-BUILD-INITIAL-PANEL             15590000
138500                 END-IF                                           15600000
138600              ELSE                                                15610000
138700*                --- BOTTOM OF LIST ---                           15620000
138800                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         15630000
138900                 SET DP020-MSG-INFORMATIONAL TO TRUE              15640000
139000             END-IF                                               15650000
139100                                                                  15660000
139200         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             15670000
139300             IF ASC-USE-SELECTION-QUEUE                           15680000
139400                 IF ASC-CRIT-SPEC-FORMAT                          15690000
139500                    MOVE '1' TO DP020-INT-APPL-FORMAT-IND         15700000
139600                 END-IF                                           15710000
139700                 IF ASC-LIST-FORMAT                               15720000
139800                    MOVE '2' TO DP020-INT-APPL-FORMAT-IND         15730000
139900                 END-IF                                           15740000
140000                 PERFORM 1140-GET-PREV-RECORD                     15750000
140100                 IF PS-LIST-END                                   15760000
140200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         15770000
140300                     SET PS-NO-LIST-END TO TRUE                   15780000
140400                 ELSE                                             15790000
140500                     PERFORM 2050-DELETE-LIST-QUEUE               15800000
140600                     PERFORM 3200-RESET-ATTRIBUTES                15810000
140700                     PERFORM 4000-BUILD-INITIAL-PANEL             15820000
140800                 END-IF                                           15830000
140900             ELSE                                                 15840000
141000                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         15850000
141100                 SET DP020-MSG-INFORMATIONAL TO TRUE              15860000
141200             END-IF                                               15870000
141300                                                                  15880000
141400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    15890000
141500             PERFORM 2140-DESELECT-ALL-ITEMS                      15900000
141600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15910000
141700                                                                  15920000
141800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  15930000
141900             PERFORM 2150-SELECT-ALL-ITEMS                        15940000
142000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15950000
142100                                                                  15960000
142200         WHEN OTHER                                               15970000
142300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 15980000
142400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15990000
142500             IF  PS-NO-ERROR                                      16000000
142600                 SET DP030-CONTINUE-GO                            16010000
142700                                 TO TRUE                          16020000
142800                 PERFORM 2100-CHECK-FUNCTION-KEY                  16030000
142900             ELSE                                                 16040000
143000                 SET DP030-OVERRIDE-GO                            16050000
143100                                 TO TRUE                          16060000
143200             END-IF                                               16070000
143300     END-EVALUATE.                                                16080000
143400                                                                  16090000
143500*----------------------------------------------------------------*16100000
143600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *16110000
143700*----------------------------------------------------------------*16120000
143800 2050-DELETE-LIST-QUEUE.                                          16130000
143900                                                                  16140000
144000     EXEC CICS                                                    16150000
144100         DELETEQ TS                                               16160000
144200             QUEUE (ASC-LIST-QUEUE-NAME)                          16170000
144300             RESP  (PV-CICS-RESP)                                 16180000
144400     END-EXEC.                                                    16190000
144500                                                                  16200000
144600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       16210000
144700        (PV-CICS-RESP = DFHRESP(QIDERR))                          16220000
144800         CONTINUE                                                 16230000
144900     ELSE                                                         16240000
145000         SET DP013-CICS-ABEND      TO TRUE                        16250000
145100         SET DP013-NO-ROLLBACK     TO TRUE                        16260000
145200                                                                  16270000
145300         MOVE '2050-DELETE-LIST-QUEUE'                            16280000
145400                                   TO DP013-PARAGRAPH             16290000
145500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    16300000
145600                                   TO DP013-MESSAGE-TEXT (1)      16310000
145700         PERFORM DP013-0000-PROCESS-ABEND                         16320000
145800     END-IF.                                                      16330000
145900                                                                  16340000
146000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  16350000
146100                                                                  16360000
146200*----------------------------------------------------------------*16370000
146300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*16380000
146400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *16390000
146500* CICS ARCHITECTURE API.                                         *16400000
146600*----------------------------------------------------------------*16410000
146700 2100-CHECK-FUNCTION-KEY.                                         16420000
146800     EVALUATE TRUE                                                16430000
146900                                                                  16440000
147000*F23 - STORE UNIT ADJ TRANS (LOCAL-FUNC-02)                       16450000
147100                                                                  16460000
147200        WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)               16470000
147300            IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               16480000
147400                INITIALIZE SU038-INTER-APPL-COMMAREA              16490000
147500                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 16500000
147600                           TO SU038-NUMBER-OF-SELECTED-ITEMS      16510000
147700                MOVE ASC-AUDIT-NBR     TO SU038-AUDIT             16520000
147800                MOVE ASC-PO-RECEIVER   TO SU038-PO-RCVR           16530000
147900                MOVE ASC-OPER-UNIT-ID  TO SU038-OPER-UNT-ID       16540000
148000                MOVE ASC-OPER-DESC     TO SU038-OPER-NAME         16550000
148100                MOVE ASC-CARTON-ID     TO SU038-SML               16560000
148200                MOVE 'A'               TO SU038-UNT-ADJ-TYP       16570000
148300                MOVE 'A'               TO SU038-FAIL-SUCCSS       16580000
148400                MOVE ASC-STORE-NBR     TO SU038-STR-NBR           16590000
148500                PERFORM 5010-PREPARE-SEL-QUEUE                    16600000
148600            ELSE                                                  16610000
148700                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              16620000
148800                SET DP030-OVERRIDE-GO  TO TRUE                    16630000
148900                MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER        16640000
149000                SET DP020-MSG-WARNING  TO TRUE                    16650000
149100            END-IF                                                16660000
149200                                                                  16670000
149300*F24 - ERROR INFO  (LOCAL-FUNC-01)                                16680000
149400                                                                  16690000
149500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              16700000
149600             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              16710000
149700                 INITIALIZE SU029-INTER-APPL-COMMAREA             16720000
149800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                16730000
149900                            TO SU029-NUMBER-OF-SELECTED-ITEMS     16740000
150000                 MOVE ASC-AUDIT-NBR TO SU029-AUDIT-NBR            16750000
150100                 MOVE ASC-CARTON-ID    TO SU029-CARTON-ID         16760000
150200                 MOVE ASC-OPER-UNIT-ID TO SU029-OPER-UNIT-ID      16770000
150300                 MOVE ASC-ENT-ID-N     TO SU029-ENT-ID            16780000
150400                 MOVE ASC-DEPT-NBR-N   TO SU029-DEPT-NBR          16790000
150500                 MOVE ASC-SOURCE       TO SU029-SOURCE            16800000
150600                 MOVE ASC-PROCESS-STATUS                          16810000
150700                                      TO SU029-PROCESS-STATUS     16820000
150800                 MOVE ASC-PO-RECEIVER TO SU029-PO-RECEIVER        16830000
150900                 MOVE ASC-REQUEST-MDCY                            16840000
151000                                      TO SU029-REQUEST-MDCY       16850000
151100                                                                  16860000
151200                 PERFORM 5000-PREPARE-SEL-QUEUE                   16870000
151300             ELSE                                                 16880000
151400                 SET DP030-OVERRIDE-GO                            16890000
151500                                   TO TRUE                        16900000
151600                 MOVE PC-TSYMSG-00057                             16910000
151700                                   TO DP020-MSG-NUMBER            16920000
151800                 SET DP020-MSG-WARNING                            16930000
151900                                   TO TRUE                        16940000
152000             END-IF                                               16950000
152100                                                                  16960000
      *VSH 11/21/13 - BEGIN PR#5148D                                    16970000
               WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              16980000
                   IF ASC-MULTIPLE-AUD                                  16990000
      *               IF ASC-RFID-AUD AND ASC-COUNT > 1                 17000000
      *                  AND ASC-AUD-CARTON-COUNT > 1                   17010000
      *                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           17020000
      *                  SET DP030-OVERRIDE-GO TO TRUE                  17030000
      *                  MOVE PC-TSYMSG-03740 TO DP020-MSG-NUMBER       17040000
      *                  SET DP020-MSG-WARNING TO TRUE                  17050000
      *               ELSE                                              17060000
                         MOVE ASC-OTHER-AUDIT   TO DK-AUDIT-NBR         17070000
                         MOVE ASC-AUDIT-NBR     TO ASC-OTHER-AUDIT      17080000
                         MOVE DK-AUDIT-NBR      TO ASC-AUDIT-NBR        17090000
                         PERFORM 2050-DELETE-LIST-QUEUE                 17100000
                         PERFORM 3200-RESET-ATTRIBUTES                  17110000
                         PERFORM 4000-BUILD-INITIAL-PANEL               17120000
      *               END-IF                                            17130000
                   ELSE                                                 17140000
                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              17150000
                      SET DP030-OVERRIDE-GO TO TRUE                     17160000
                      MOVE PC-TSYMSG-03739 TO DP020-MSG-NUMBER          17170000
                      SET DP020-MSG-WARNING TO TRUE                     17180000
                   END-IF                                               17190000
      *VSH 11/21/13 - END PR#5148D                                      17200000
152200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  17210000
152300             MOVE +1               TO PV-TOP-ITEM                 17220000
152400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17230000
152500                                                                  17240000
152600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   17250000
152700             PERFORM 2110-BROWSE-BACKWARD                         17260000
152800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17270000
152900                                                                  17280000
153000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   17290000
153100             PERFORM 2120-BROWSE-FORWARD                          17300000
153200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17310000
153300                                                                  17320000
153400         WHEN DP020-SRC-AID = DP016-ENTER                         17330000
153500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   17340000
153600             IF  PS-ERROR                                         17350000
153700                 CONTINUE                                         17360000
153800             ELSE                                                 17370000
153900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             17380000
154000             END-IF                                               17390000
154100                                                                  17400000
154200         WHEN OTHER                                               17410000
154300             PERFORM 2050-DELETE-LIST-QUEUE                       17420000
154400             PERFORM 4000-BUILD-INITIAL-PANEL                     17430000
154500             PERFORM 3200-RESET-ATTRIBUTES                        17440000
154600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 17450000
154700**LS         SET DP013-NO-ROLLBACK                                17460000
154800**LS             DP013-XCTL-DISPLAY-RESTART                       17470000
154900**LS             DP013-CICS-ABEND  TO TRUE                        17480000
155000**LS         MOVE '2100-CHECK-FUNCTION-KEY'                       17490000
155100**LS                               TO DP013-PARAGRAPH             17500000
155200**LS         MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      17510000
155300**LS                               TO DP013-MESSAGE-TEXT (1)      17520000
155400**LS         PERFORM DP013-0000-PROCESS-ABEND                     17530000
155500     END-EVALUATE.                                                17540000
155600                                                                  17550000
155700*----------------------------------------------------------------*17560000
155800* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     17570000
155900*----------------------------------------------------------------*17580000
156000 2105-RACF-ACCESS.                                                17590000
156100                                                                  17600000
156200      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  17610000
156300      SET DP008-ACCESS-TYPE-USE          TO TRUE                  17620000
156400                                                                  17630000
156500      EXEC CICS                                                   17640000
156600         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 17650000
156700              COMMAREA (DP008-SECURITY-COMMAREA)                  17660000
156800              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             17670000
156900      END-EXEC                                                    17680000
157000                                                                  17690000
157100      IF DP008-CALL-SUCCESSFUL                                    17700000
157200         IF DP008-ACCESS-ALLOWED                                  17710000
157300             SET PS-ACCESS-ALLOWED TO TRUE                        17720000
157400         ELSE                                                     17730000
157500             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    17740000
157600         END-IF                                                   17750000
157700     ELSE                                                         17760000
157800         MOVE '2105-RACF-ACCESS'                                  17770000
157900                               TO DP013-PARAGRAPH                 17780000
158000          MOVE 'UNABLE TO ACCESS CICS'                            17790000
158100                               TO DP013-MESSAGE-TEXT (1)          17800000
158200          MOVE SQLCA                 TO DP013-SQLCA               17810000
158300          SET DP013-DB2-ABEND                                     17820000
158400              DP013-XCTL-DISPLAY-RESTART                          17830000
158500                               TO TRUE                            17840000
158600          PERFORM DP013-0000-PROCESS-ABEND                        17850000
158700      END-IF.                                                     17860000
158800                                                                  17870000
158900*                                                                 17880000
159000*----------------------------------------------------------------*17890000
159100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *17900000
159200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *17910000
159300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *17920000
159400*    MESSAGE.                                                    *17930000
159500*----------------------------------------------------------------*17940000
159600                                                                  17950000
159700 2110-BROWSE-BACKWARD.                                            17960000
159800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    17970000
159900         GIVING PV-TOP-ITEM.                                      17980000
160000*                                                                 17990000
160100     IF  ((PV-TOP-ITEM < +1)                                      18000000
160200       OR (PV-TOP-ITEM = +1))                                     18010000
160300         MOVE +1                   TO PV-TOP-ITEM                 18020000
160400*        -- TOP OF LIST --                                        18030000
160500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            18040000
160600         SET DP020-MSG-INFORMATIONAL TO TRUE                      18050000
160700     END-IF.                                                      18060000
160800                                                                  18070000
160900*----------------------------------------------------------------*18080000
161000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *18090000
161100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *18100000
161200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *18110000
161300*----------------------------------------------------------------*18120000
161400                                                                  18130000
161500 2120-BROWSE-FORWARD.                                             18140000
161600                                                                  18150000
161700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              18160000
161800         GIVING PV-TOP-ITEM.                                      18170000
161900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   18180000
162000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            18190000
162100                                   TO PV-TOP-ITEM                 18200000
162200*        -- BOTTOM OF LIST --                                     18210000
162300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            18220000
162400         SET DP020-MSG-INFORMATIONAL                              18230000
162500                                   TO TRUE                        18240000
162600     ELSE                                                         18250000
162700         COMPUTE PV-BOTTOM-ITEM =                                 18260000
162800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 18270000
162900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            18280000
163000*            -- BOTTOM OF LIST --                                 18290000
163100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            18300000
163200             SET DP020-MSG-INFORMATIONAL                          18310000
163300                                   TO TRUE                        18320000
163400         END-IF                                                   18330000
163500     END-IF.                                                      18340000
163600                                                                  18350000
163700*----------------------------------------------------------------*18360000
163800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *18370000
163900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *18380000
164000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *18390000
164100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *18400000
164200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *18410000
164300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *18420000
164400*----------------------------------------------------------------*18430000
164500                                                                  18440000
164600 2130-CHECK-FOR-JUMP-BROWSE.                                      18450000
164700     SET PS-NO-ERROR               TO TRUE.                       18460000
164800     IF (ASC-START-ITEM-REQUEST = SPACE)                          18470000
164900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            18480000
165000                                   TO PV-TOP-ITEM                 18490000
165100     ELSE                                                         18500000
165200         MOVE ASC-START-ITEM-REQUEST                              18510000
165300                                   TO DP010I-UNEDITED-FIELD       18520000
165400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       18530000
165500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     18540000
165600         SET DP010I-NEGATIVE-NOT-ALLOWED                          18550000
165700                                   TO TRUE                        18560000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         18571041
263968              USING DP010I-NUMERIC-EDIT-AREA                      18572041
165900                                                                  18580000
166000         IF  NOT DP010I-ERROR-DETECTED                            18590000
166100             MOVE DP010I-NUMERIC-FIELD                            18600000
166200                                   TO  ASC-START-ITEM-REQUEST-N   18610000
166300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  18620000
166400                 IF  ASC-START-ITEM-REQUEST-N >                   18630000
166500                                          ASC-NUMBER-OF-ITEMS-READ18640000
166600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         18650000
166700                     COMPUTE PV-TOP-ITEM =                        18660000
166800                             ASC-NUMBER-OF-ITEMS-READ             18670000
166900                             - PC-ITEMS-PER-PANEL + 1             18680000
167000                     IF  PV-TOP-ITEM < +1                         18690000
167100                         MOVE +1   TO PV-TOP-ITEM                 18700000
167200                         MOVE PC-TSYMSG-00070                     18710000
167300                                   TO DP020-MSG-NUMBER            18720000
167400                         SET DP020-MSG-INFORMATIONAL              18730000
167500                                   TO TRUE                        18740000
167600                     END-IF                                       18750000
167700                 ELSE                                             18760000
167800                     MOVE ASC-START-ITEM-REQUEST-N                18770000
167900                                   TO PV-TOP-ITEM                 18780000
168000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      18790000
168100                     COMPUTE PV-BOTTOM-ITEM =                     18800000
168200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     18810000
168300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ18820000
168400*                        -- BOTTOM OF LIST --                     18830000
168500                         MOVE PC-TSYMSG-00070                     18840000
168600                                   TO DP020-MSG-NUMBER            18850000
168700                         SET DP020-MSG-INFORMATIONAL              18860000
168800                                   TO TRUE                        18870000
168900                     END-IF                                       18880000
169000                 END-IF                                           18890000
169100             ELSE                                                 18900000
169200*                --- VALUE OUT OF RANGE ----                      18910000
169300                 MOVE PC-TSYMSG-00101                             18920000
169400                                   TO DP020-MSG-NUMBER            18930000
169500                 MOVE -1           TO ASTRTITL                    18940000
169600                 SET DP030-SET-CURSOR-APPL-1                      18950000
169700                                   TO TRUE                        18960000
169800                 MOVE DP015-REVERSE                               18970000
169900                                   TO ASTRTITH                    18980000
170000                 MOVE DP015-RED    TO ASTRTITC                    18990000
170100                 MOVE DP015-UNP-NUM-BRT-MDT                       19000000
170200                                   TO ASTRTITA                    19010000
170300                 SET DP020-MSG-FATAL                              19020000
170400                                   TO TRUE                        19030000
170500                 SET PS-ERROR      TO TRUE                        19040000
170600             END-IF                                               19050000
170700                                                                  19060000
170800         ELSE                                                     19070000
170900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            19080000
171000             MOVE -1               TO ASTRTITL                    19090000
171100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  19100000
171200             MOVE DP015-REVERSE    TO ASTRTITH                    19110000
171300             MOVE DP015-RED        TO ASTRTITC                    19120000
171400             MOVE DP015-UNP-NUM-BRT-MDT                           19130000
171500                                   TO ASTRTITA                    19140000
171600             SET DP020-MSG-FATAL   TO TRUE                        19150000
171700             SET PS-ERROR          TO TRUE                        19160000
171800         END-IF                                                   19170000
171900     END-IF.                                                      19180000
172000                                                                  19190000
172100*----------------------------------------------------------------*19200000
172200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *19210000
172300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *19220000
172400*----------------------------------------------------------------*19230000
172500 2140-DESELECT-ALL-ITEMS.                                         19240000
172600     MOVE +1                       TO ASC-BLK-SUB.                19250000
172700                                                                  19260000
172800     PERFORM 2141-CLEAR-SELECTED-INDS                             19270000
172900         VARYING ASC-ITEM-SUB                                     19280000
173000         FROM 1 BY 1                                              19290000
173100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19300000
173200                                                                  19310000
173300     ADD +1                        TO ASC-BLK-SUB.                19320000
173400                                                                  19330000
173500     PERFORM 2141-CLEAR-SELECTED-INDS                             19340000
173600         VARYING ASC-ITEM-SUB                                     19350000
173700         FROM 1 BY 1                                              19360000
173800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19370000
173900                                                                  19380000
174000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19390000
174100                                   TO PV-LIST-ITEM-NUMBER.        19400000
174200                                                                  19410000
174300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19420000
174400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19430000
174500                                                                  19440000
174600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19450000
174700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      19460000
174800         MOVE +1                   TO ASC-BLK-SUB                 19470000
174900                                                                  19480000
175000         PERFORM 5100-WRITE-TEMP-STORAGE                          19490000
175100                                                                  19500000
175200         MOVE +1                   TO PV-BLOCK-NUMBER             19510000
175300                                                                  19520000
175400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19530000
175500             PV-FIRST-BLOCK-IN-ARRAY - 1                          19540000
175600                                                                  19550000
175700         PERFORM                                                  19560000
175800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19570000
175900                                                                  19580000
176000             PERFORM 4410-READ-TEMP-STORAGE                       19590000
176100                                                                  19600000
176200             PERFORM 2141-CLEAR-SELECTED-INDS                     19610000
176300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 19620000
176400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19630000
176500                                                                  19640000
176600             PERFORM 5100-WRITE-TEMP-STORAGE                      19650000
176700                                                                  19660000
176800             ADD +1                TO PV-BLOCK-NUMBER             19670000
176900                                                                  19680000
177000         END-PERFORM                                              19690000
177100                                                                  19700000
177200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19710000
177300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19720000
177400                                                                  19730000
177500         PERFORM                                                  19740000
177600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19750000
177700                   ASC-HIGHEST-BLOCK-WRITTEN                      19760000
177800                                                                  19770000
177900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19780000
178000                                   TO PV-BLOCK-NUMBER             19790000
178100                                                                  19800000
178200             PERFORM 4410-READ-TEMP-STORAGE                       19810000
178300                                                                  19820000
178400             PERFORM 2141-CLEAR-SELECTED-INDS                     19830000
178500                 VARYING ASC-ITEM-SUB                             19840000
178600                 FROM 1 BY 1                                      19850000
178700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19860000
178800                                                                  19870000
178900             PERFORM 5100-WRITE-TEMP-STORAGE                      19880000
179000                                                                  19890000
179100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19900000
179200                                                                  19910000
179300         END-PERFORM                                              19920000
179400                                                                  19930000
179500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19940000
179600                                   TO PV-BLOCK-NUMBER             19950000
179700                                                                  19960000
179800         PERFORM 4410-READ-TEMP-STORAGE                           19970000
179900     END-IF.                                                      19980000
180000                                                                  19990000
180100                                                                  20000000
180200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 20010000
180300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.20020000
180400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  20030000
180500                                                                  20040000
180600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        20050000
180700                                                                  20060000
180800*----------------------------------------------------------------*20070000
180900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *20080000
181000*----------------------------------------------------------------*20090000
181100                                                                  20100000
181200 2141-CLEAR-SELECTED-INDS.                                        20110000
181300                                                                  20120000
181400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           20130000
181500             NOT EQUAL ZERO                                       20140000
181600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20150000
181700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20160000
181800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    20170000
181900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  20180000
182000                                   TO TRUE                        20190000
182100         END-IF                                                   20200000
182200     END-IF.                                                      20210000
182300                                                                  20220000
182400*----------------------------------------------------------------*20230000
182500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *20240000
182600*  FOR ALL ITEMS.                                                *20250000
182700*----------------------------------------------------------------*20260000
182800                                                                  20270000
182900 2150-SELECT-ALL-ITEMS.                                           20280000
183000                                                                  20290000
183100     MOVE +1                       TO ASC-BLK-SUB.                20300000
183200                                                                  20310000
183300     PERFORM 2151-SET-SELECTED-INDS                               20320000
183400         VARYING ASC-ITEM-SUB                                     20330000
183500         FROM 1 BY 1                                              20340000
183600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20350000
183700                                                                  20360000
183800     ADD +1                        TO ASC-BLK-SUB.                20370000
183900                                                                  20380000
184000     PERFORM 2151-SET-SELECTED-INDS                               20390000
184100         VARYING ASC-ITEM-SUB                                     20400000
184200         FROM 1 BY 1                                              20410000
184300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20420000
184400                                                                  20430000
184500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20440000
184600                                   TO PV-LIST-ITEM-NUMBER.        20450000
184700                                                                  20460000
184800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20470000
184900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20480000
185000                                                                  20490000
185100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     20500000
185200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    20510000
185300         MOVE +1                   TO ASC-BLK-SUB                 20520000
185400                                                                  20530000
185500         PERFORM 5100-WRITE-TEMP-STORAGE                          20540000
185600                                                                  20550000
185700         MOVE +1                   TO PV-BLOCK-NUMBER             20560000
185800                                                                  20570000
185900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20580000
186000             PV-FIRST-BLOCK-IN-ARRAY - 1                          20590000
186100                                                                  20600000
186200         PERFORM                                                  20610000
186300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       20620000
186400                                                                  20630000
186500             PERFORM 4410-READ-TEMP-STORAGE                       20640000
186600                                                                  20650000
186700             PERFORM 2151-SET-SELECTED-INDS                       20660000
186800                 VARYING ASC-ITEM-SUB                             20670000
186900                 FROM 1 BY 1                                      20680000
187000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20690000
187100                                                                  20700000
187200             PERFORM 5100-WRITE-TEMP-STORAGE                      20710000
187300                                                                  20720000
187400             ADD +1                TO PV-BLOCK-NUMBER             20730000
187500                                                                  20740000
187600         END-PERFORM                                              20750000
187700                                                                  20760000
187800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20770000
187900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20780000
188000                                                                  20790000
188100         PERFORM                                                  20800000
188200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20810000
188300                   ASC-HIGHEST-BLOCK-WRITTEN                      20820000
188400                                                                  20830000
188500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20840000
188600                                   TO PV-BLOCK-NUMBER             20850000
188700                                                                  20860000
188800             PERFORM 4410-READ-TEMP-STORAGE                       20870000
188900                                                                  20880000
189000             PERFORM 2151-SET-SELECTED-INDS                       20890000
189100                 VARYING ASC-ITEM-SUB                             20900000
189200                 FROM 1 BY 1                                      20910000
189300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20920000
189400                                                                  20930000
189500             PERFORM 5100-WRITE-TEMP-STORAGE                      20940000
189600                                                                  20950000
189700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20960000
189800                                                                  20970000
189900         END-PERFORM                                              20980000
190000                                                                  20990000
190100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21000000
190200                                   TO PV-BLOCK-NUMBER             21010000
190300                                                                  21020000
190400         PERFORM 4410-READ-TEMP-STORAGE                           21030000
190500     END-IF.                                                      21040000
190600                                                                  21050000
190700                                                                  21060000
190800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             21070000
190900                       ASC-NUMBER-OF-SELECTED-ITEMS.              21080000
191000                                                                  21090000
191100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        21100000
191200                                                                  21110000
191300*----------------------------------------------------------------*21120000
191400*    MARK EACH ITEM AS BEING SELECTED.                           *21130000
191500*----------------------------------------------------------------*21140000
191600                                                                  21150000
191700 2151-SET-SELECTED-INDS.                                          21160000
191800                                                                  21170000
191900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           21180000
192000             NOT EQUAL ZERO                                       21190000
192100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             21200000
192200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             21210000
192300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        21220000
192400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  21230000
192500                               TO  TRUE                           21240000
192600         END-IF                                                   21250000
192700     END-IF.                                                      21260000
192800******************************************************************21270000
192900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **21280000
193000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **21290000
193100******************************************************************21300000
193200 2200-MOVE-SCREEN-TO-COMMAREA.                                    21310000
193300                                                                  21320000
193400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             21330000
193500     MOVE +1                       TO PV-SUB.                     21340000
193600*                                                                 21350000
193700     PERFORM 3100-SET-SUBSCRIPTS.                                 21360000
193800     IF  ASTRTITL > ZERO                                          21370000
193900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          21380000
194000     ELSE                                                         21390000
194100         IF  ASTRTITF = DP015-ERASE-EOF                           21400000
194200             INITIALIZE ASC-START-ITEM-REQUEST                    21410000
194300         END-IF                                                   21420000
194400     END-IF.                                                      21430000
194500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          21440000
194600         VARYING PV-SUB                                           21450000
194700         FROM 1 BY 1                                              21460000
194800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      21470000
194900******************************************************************21480000
195000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**21490000
195100******************************************************************21500000
195200 2210-MOVE-LINES-TO-COMMAREA.                                     21510000
195300     IF  MR-SELECTL (PV-SUB) > ZERO                               21520000
195400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             21530000
195500         MOVE MR-SELECTI (PV-SUB)                                 21540000
195600                                   TO ASC-TEMP-SELECTED-SW        21550000
195700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21560000
195800     ELSE                                                         21570000
195900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                21580000
196000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     21590000
196100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        21600000
196200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21610000
196300         END-IF                                                   21620000
196400     END-IF.                                                      21630000
196500     ADD +1                        TO ASC-ITEM-SUB.               21640000
196600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21650000
196700         ADD +1                    TO ASC-BLK-SUB                 21660000
196800         MOVE +1                   TO ASC-ITEM-SUB                21670000
196900     END-IF.                                                      21680000
197000                                                                  21690000
197100 1130-GET-NEXT-RECORD.                                            21700000
197200     ADD +1                        TO ASC-SEL-SUB.                21710000
197300     IF  ASC-SEL-SUB > SU028-MAX-ITEMS                            21720000
197400         ADD +1                    TO ASC-SEL-ITEM                21730000
197500         MOVE +1                   TO ASC-SEL-SUB                 21740000
197600     END-IF.                                                      21750000
197700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                21760000
197800         PERFORM 9100-READ-SEL-QUEUE                              21770000
197900         IF  SU028-ITEM (ASC-SEL-SUB) > ZERO                      21780000
198000             MOVE SU028-CARTON     (ASC-SEL-SUB)                  21790000
198100                                   TO ASC-CARTON-ID               21800000
198200*            MOVE SU028-AUDIT-NBR  (ASC-SEL-SUB)                  21810000
198300*                                  TO ASC-AUDIT-NBR               21820000
198400             SET SU028-INQ (ASC-SEL-SUB)                          21830000
198500                                   TO TRUE                        21840000
198600             PERFORM 9200-REWRITE-SEL-QUEUE                       21850000
198700         ELSE                                                     21860000
198800             SUBTRACT +1 FROM ASC-SEL-SUB                         21870000
198900*            --- BOTTOM OF LIST ---                               21880000
199000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            21890000
199100             SET DP020-MSG-INFORMATIONAL                          21900000
199200                                   TO TRUE                        21910000
199300         END-IF                                                   21920000
199400     ELSE                                                         21930000
199500         SUBTRACT +1 FROM ASC-SEL-ITEM                            21940000
199600         MOVE SU028-MAX-ITEMS      TO ASC-SEL-SUB                 21950000
199700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            21960000
199800         SET DP020-MSG-INFORMATIONAL                              21970000
199900                                   TO TRUE                        21980000
200000     END-IF.                                                      21990000
200100                                                                  22000000
200200 1140-GET-PREV-RECORD.                                            22010000
200300     SUBTRACT +1                 FROM ASC-SEL-SUB.                22020000
200400     IF ASC-SEL-SUB < +1                                          22030000
200500         SUBTRACT +1             FROM ASC-SEL-ITEM                22040000
200600         MOVE SU028-MAX-ITEMS      TO ASC-SEL-SUB                 22050000
200700     END-IF.                                                      22060000
200800                                                                  22070000
200900     IF ASC-SEL-ITEM > ZERO                                       22080000
201000         PERFORM 9100-READ-SEL-QUEUE                              22090000
201100         MOVE SU028-CARTON     (ASC-SEL-SUB)                      22100000
201200                               TO ASC-CARTON-ID                   22110000
201300*        MOVE SU028-AUDIT-NBR  (ASC-SEL-SUB)                      22120000
201400*                              TO ASC-AUDIT-NBR                   22130000
201500         SET SU028-INQ (ASC-SEL-SUB) TO TRUE                      22140000
201600         PERFORM 9200-REWRITE-SEL-QUEUE                           22150000
201700     ELSE                                                         22160000
201800             MOVE +1 TO  ASC-SEL-SUB                              22170000
201900                         ASC-SEL-ITEM                             22180000
202000*            --- TOP OF LIST ---                                  22190000
202100             MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER            22200000
202200             SET DP020-MSG-INFORMATIONAL                          22210000
202300                                   TO TRUE                        22220000
202400     END-IF.                                                      22230000
202500                                                                  22240000
202600******************************************************************22250000
202700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **22260000
202800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **22270000
202900******************************************************************22280000
203000 3000-EDIT-DATA-IN-COMMAREA.                                      22290000
203100     SET PS-NO-ERROR               TO TRUE.                       22300000
203200     PERFORM 3200-RESET-ATTRIBUTES.                               22310000
203300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     22320000
203400**                                                                22330000
203500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              22340000
203600* EDITTING IS DONE FROM THE BOTTOM UP.                            22350000
203700**                                                                22360000
203800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       22370000
203900         ASC-ITEMS-DISPLAYED - 1.                                 22380000
204000     PERFORM 3100-SET-SUBSCRIPTS.                                 22390000
204100     PERFORM 3300-EDIT-SELECTIONS                                 22400000
204200         VARYING PV-SUB                                           22410000
204300         FROM PV-SUB BY -1                                        22420000
204400         UNTIL PV-SUB < +1                                        22430000
204500*                                                                 22440000
204600     IF  PS-NO-ERROR                                              22450000
204700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        22460000
204800     END-IF.                                                      22470000
204900*                                                                 22480000
205000     IF  ((PS-NO-ERROR)                                           22490000
205100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   22500000
205200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    22510000
205300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  22520000
205400     END-IF.                                                      22530000
205500                                                                  22540000
205600*----------------------------------------------------------------*22550000
205700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *22560000
205800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*22570000
205900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *22580000
206000*                                                                *22590000
206100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *22600000
206200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *22610000
206300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *22620000
206400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *22630000
206500*----------------------------------------------------------------*22640000
206600                                                                  22650000
206700 3100-SET-SUBSCRIPTS.                                             22660000
206800                                                                  22670000
206900     COMPUTE ASC-ITEM-SUB =                                       22680000
207000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        22690000
207100                                                                  22700000
207200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         22710000
207300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22720000
207400                                                                  22730000
207500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               22740000
207600     ELSE                                                         22750000
207700         MOVE +1                     TO ASC-BLK-SUB               22760000
207800     END-IF.                                                      22770000
207900******************************************************************22780000
208000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **22790000
208100******************************************************************22800000
208200                                                                  22810000
208300 3200-RESET-ATTRIBUTES.                                           22820000
208400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   22830000
208500     MOVE DP015-GREEN              TO ASTRTITC.                   22840000
208600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   22850000
208700*                                                                 22860000
208800     PERFORM                                                      22870000
208900         VARYING PV-SUB                                           22880000
209000         FROM 1 BY 1                                              22890000
209100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        22900000
209200         MOVE DP015-UNP-ALP-NOR-OFF                               22910000
209300                                   TO MR-SELECTA (PV-SUB)         22920000
209400         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         22930000
209500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         22940000
209600     END-PERFORM.                                                 22950000
209700******************************************************************22960000
209800** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **22970000
209900** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **22980000
210000** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **22990000
210100** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **23000000
210200******************************************************************23010000
210300 3300-EDIT-SELECTIONS.                                            23020000
210400     EVALUATE TRUE                                                23030000
210500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23040000
210600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         23050000
210700                 CONTINUE                                         23060000
210800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         23070000
210900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        23080000
211000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   23090000
211100                 MOVE ASC-TEMP-SELECTED-SW                        23100000
211200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23110000
211300                                TO ASC-SELECTED-SW                23120000
211400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23130000
211500             END-IF                                               23140000
211600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23150000
211700                 = SPACE                                          23160000
211800             EVALUATE TRUE                                        23170000
211900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       23180000
212000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS23190000
212100                     MOVE SPACE TO ASC-SELECTED-SW                23200000
212200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23210000
212300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        23220000
212400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    23230000
212500                     MOVE SPACE TO ASC-SELECTED-SW                23240000
212600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23250000
212700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          23260000
212800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      23270000
212900                     MOVE SPACE TO ASC-SELECTED-SW                23280000
213000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23290000
213100             END-EVALUATE                                         23300000
213200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           23310000
213300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23320000
213400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    23330000
213500             END-IF                                               23340000
213600             PERFORM 3310-EDIT-RANGE                              23350000
213700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             23360000
213800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23370000
213900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    23380000
214000             END-IF                                               23390000
214100             PERFORM 3310-EDIT-RANGE                              23400000
214200         WHEN OTHER                                               23410000
214300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           23420000
214400             SET DP020-MSG-FATAL    TO TRUE                       23430000
214500             MOVE -1                TO MR-SELECTL (PV-SUB)        23440000
214600             SET DP030-SET-CURSOR-APPL-1                          23450000
214700                                    TO TRUE                       23460000
214800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        23470000
214900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        23480000
215000             SET PS-ERROR TO TRUE                                 23490000
215100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23500000
215200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     23510000
215300                 MOVE SPACE         TO ASC-SELECTED-SW            23520000
215400                                        (ASC-BLK-SUB ASC-ITEM-SUB)23530000
215500             END-IF                                               23540000
215600     END-EVALUATE.                                                23550000
215700                                                                  23560000
215800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 23570000
215900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23580000
216000     IF  ASC-ITEM-SUB < 1                                         23590000
216100         SUBTRACT +1 FROM ASC-BLK-SUB                             23600000
216200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                23610000
216300     END-IF.                                                      23620000
216400******************************************************************23630000
216500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **23640000
216600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **23650000
216700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**23660000
216800** THE ENDING.                                                  **23670000
216900******************************************************************23680000
217000 3310-EDIT-RANGE.                                                 23690000
217100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                23700000
217200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   23710000
217300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)23720000
217400                                   TO ASC-SELECTED-SW             23730000
217500                                        (ASC-BLK-SUB ASC-ITEM-SUB)23740000
217600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 23750000
217700         ELSE                                                     23760000
217800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     23770000
217900                 CONTINUE                                         23780000
218000             ELSE                                                 23790000
218100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        23800000
218200                 MOVE PC-TSYMSG-00054                             23810000
218300                                   TO DP020-MSG-NUMBER            23820000
218400                 SET DP020-MSG-FATAL                              23830000
218500                                   TO TRUE                        23840000
218600                 MOVE -1           TO MR-SELECTL (PV-SUB)         23850000
218700                 SET DP030-SET-CURSOR-APPL-1                      23860000
218800                                   TO TRUE                        23870000
218900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         23880000
219000                 MOVE DP015-UNDERLINE                             23890000
219100                                   TO MR-SELECTH (PV-SUB)         23900000
219200                 SET PS-ERROR      TO TRUE                        23910000
219300             END-IF                                               23920000
219400         END-IF                                                   23930000
219500     ELSE                                                         23940000
219600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23950000
219700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23960000
219800                                   TO ASC-SELECTED-SW             23970000
219900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23980000
220000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   23990000
220100         ELSE                                                     24000000
220200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       24010000
220300                 CONTINUE                                         24020000
220400             ELSE                                                 24030000
220500*                -- ONLY ONE END-OF-RANGE ALLOWED --              24040000
220600                 MOVE PC-TSYMSG-00055                             24050000
220700                                   TO DP020-MSG-NUMBER            24060000
220800                 SET DP020-MSG-FATAL                              24070000
220900                                   TO TRUE                        24080000
221000                 MOVE -1           TO MR-SELECTL (PV-SUB)         24090000
221100                 SET DP030-SET-CURSOR-APPL-1                      24100000
221200                                   TO TRUE                        24110000
221300                 SET PS-ERROR      TO TRUE                        24120000
221400             END-IF                                               24130000
221500         END-IF                                                   24140000
221600     END-IF.                                                      24150000
221700*                                                                 24160000
221800******************************************************************24170000
221900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **24180000
222000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **24190000
222100******************************************************************24200000
222200 3400-CHECK-RANGE-SEQUENCE.                                       24210000
222300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24220000
222400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      24230000
222500       AND  ASC-START-OF-SELECTED-RANGE >                         24240000
222600                                         ASC-END-OF-SELECTED-RANGE24250000
222700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                24260000
222800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 24270000
222900         SET DP020-MSG-FATAL TO TRUE                              24280000
223000         SET PS-ERROR TO TRUE                                     24290000
223100         PERFORM 3410-POSITION-AT-ERROR                           24300000
223200     END-IF.                                                      24310000
223300******************************************************************24320000
223400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **24330000
223500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **24340000
223600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **24350000
223700******************************************************************24360000
223800 3410-POSITION-AT-ERROR.                                          24370000
223900     SET DP030-SET-CURSOR-APPL-1                                  24380000
224000                                   TO TRUE.                       24390000
224100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24400000
224200                    - PV-TOP-ITEM + 1.                            24410000
224300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24420000
224400         CONTINUE                                                 24430000
224500     ELSE                                                         24440000
224600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24450000
224700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24460000
224800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24470000
224900     END-IF.                                                      24480000
225000*                                                                 24490000
225100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24500000
225200                    - PV-TOP-ITEM + 1.                            24510000
225300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24520000
225400         CONTINUE                                                 24530000
225500     ELSE                                                         24540000
225600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24550000
225700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24560000
225800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24570000
225900     END-IF.                                                      24580000
226000                                                                  24590000
226100*----------------------------------------------------------------*24600000
226200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *24610000
226300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *24620000
226400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *24630000
226500*----------------------------------------------------------------*24640000
226600                                                                  24650000
226700 3500-MARK-RANGE-AS-SELECTED.                                     24660000
226800     MOVE +1                       TO  ASC-BLK-SUB.               24670000
226900     PERFORM 3510-MARK-SELECTED-INDS                              24680000
227000         VARYING ASC-ITEM-SUB                                     24690000
227100         FROM 1 BY 1                                              24700000
227200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24710000
227300                                                                  24720000
227400     ADD +1                        TO ASC-BLK-SUB.                24730000
227500     PERFORM 3510-MARK-SELECTED-INDS                              24740000
227600         VARYING ASC-ITEM-SUB                                     24750000
227700         FROM 1 BY 1                                              24760000
227800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24770000
227900                                                                  24780000
228000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               24790000
228100                                   TO  PV-LIST-ITEM-NUMBER.       24800000
228200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            24810000
228300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         24820000
228400               PC-ITEMS-PER-PANEL).                               24830000
228500                                                                  24840000
228600     MOVE ASC-START-OF-SELECTED-RANGE                             24850000
228700                                   TO PV-START-OF-SELECTED-RANGE. 24860000
228800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            24870000
228900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  24880000
229000               PC-ITEMS-PER-PANEL).                               24890000
229100                                                                  24900000
229200     MOVE ASC-END-OF-SELECTED-RANGE                               24910000
229300                                   TO  PV-END-OF-SELECTED-RANGE.  24920000
229400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             24930000
229500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    24940000
229600               PC-ITEMS-PER-PANEL).                               24950000
229700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             24960000
229800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             24970000
229900                                                                  24980000
230000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    24990000
230100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        25000000
230200         MOVE +1                   TO ASC-BLK-SUB                 25010000
230300         PERFORM 5100-WRITE-TEMP-STORAGE                          25020000
230400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         25030000
230500             PV-FIRST-BLOCK-IN-ARRAY - 1                          25040000
230600                                                                  25050000
230700         PERFORM                                                  25060000
230800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      25070000
230900                   PV-PREV-BLOCK-IN-ARRAY                         25080000
231000             MOVE PV-FIRST-BLOCK-IN-RANGE                         25090000
231100                                   TO PV-BLOCK-NUMBER             25100000
231200             PERFORM 4410-READ-TEMP-STORAGE                       25110000
231300             PERFORM 3510-MARK-SELECTED-INDS                      25120000
231400                 VARYING ASC-ITEM-SUB                             25130000
231500                 FROM 1 BY 1                                      25140000
231600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          25150000
231700             PERFORM 5100-WRITE-TEMP-STORAGE                      25160000
231800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     25170000
231900         END-PERFORM                                              25180000
232000                                                                  25190000
232100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         25200000
232200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     25210000
232300         PERFORM                                                  25220000
232400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       25230000
232500                   PV-LAST-BLOCK-IN-RANGE                         25240000
232600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          25250000
232700                                   TO PV-BLOCK-NUMBER             25260000
232800             PERFORM 4410-READ-TEMP-STORAGE                       25270000
232900             PERFORM 3510-MARK-SELECTED-INDS                      25280000
233000                 VARYING ASC-ITEM-SUB                             25290000
233100                 FROM 1 BY 1                                      25300000
233200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          25310000
233300             PERFORM 5100-WRITE-TEMP-STORAGE                      25320000
233400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      25330000
233500         END-PERFORM                                              25340000
233600                                                                  25350000
233700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             25360000
233800                                   TO PV-BLOCK-NUMBER             25370000
233900         PERFORM 4410-READ-TEMP-STORAGE                           25380000
234000     END-IF.                                                      25390000
234100                                                                  25400000
234200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 25410000
234300                                      ASC-END-OF-SELECTED-RANGE.  25420000
234400                                                                  25430000
234500*----------------------------------------------------------------*25440000
234600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *25450000
234700*----------------------------------------------------------------*25460000
234800                                                                  25470000
234900 3510-MARK-SELECTED-INDS.                                         25480000
235000                                                                  25490000
235100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         25500000
235200                                ASC-ITEM-SUB) >                   25510000
235300         ASC-START-OF-SELECTED-RANGE)                             25520000
235400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         25530000
235500                                ASC-ITEM-SUB) =                   25540000
235600         ASC-START-OF-SELECTED-RANGE)                             25550000
235700                                                                  25560000
235800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     25570000
235900                                    ASC-ITEM-SUB) <               25580000
236000             ASC-END-OF-SELECTED-RANGE)                           25590000
236100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     25600000
236200                                    ASC-ITEM-SUB) =               25610000
236300             ASC-END-OF-SELECTED-RANGE)                           25620000
236400                                                                  25630000
236500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          25640000
236600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   25650000
236700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   25660000
236800                               TO TRUE                            25670000
236900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              25680000
237000                               TO TRUE                            25690000
237100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    25700000
237200             END-IF                                               25710000
237300         END-IF                                                   25720000
237400     END-IF.                                                      25730000
237500                                                                  25740000
237600*----------------------------------------------------------------*25750000
237700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *25760000
237800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *25770000
237900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *25780000
238000*    DISPLAY THE PANEL TO USER.                                  *25790000
238100*----------------------------------------------------------------*25800000
238200                                                                  25810000
238300 4000-BUILD-INITIAL-PANEL.                                        25820000
238400                                                                  25830000
238500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            25840000
238600                                 ASC-BLOCK-ENTRIES (2).           25850000
238700     MOVE +1                 TO ASC-BLK-SUB.                      25860000
238800     SET ASC-ITEMS-LEFT-ON-DB                                     25870000
238900                             TO TRUE.                             25880000
239000                                                                  25890000
239100     MOVE +0                 TO ASC-ITEM-SUB                      25900000
239200                                ASC-NUMBER-OF-ITEMS-READ          25910000
239300                                ASC-NUMBER-OF-SELECTED-ITEMS      25920000
239400                                ASC-HIGHEST-BLOCK-WRITTEN         25930000
239500                                ASC-START-OF-SELECTED-RANGE       25940000
239600                                ASC-END-OF-SELECTED-RANGE         25950000
239700                                ASC-ITEM-AT-TOP-OF-PANEL.         25960000
239800     PERFORM 4100-PREPARE-CURSOR.                                 25970000
239900     PERFORM 4050-SELECT-AUDIT.                                   25980000
      *VSH 11/21/13 - BEGIN PR#5148D                                    25990000
           PERFORM 1250-MOD-QTY-IND.                                    26000000
      *VSH 11/21/13 - END PR#5148D                                      26010000
240000     PERFORM 4010-OPEN-CURSOR.                                    26020000
240100                                                                  26030000
240200     PERFORM 4300-READ-ITEMS-FROM-DB.                             26040000
240300                                                                  26050000
240400     PERFORM 4020-CLOSE-CURSOR.                                   26060000
240500                                                                  26070000
240600     MOVE +1                   TO  PV-TOP-ITEM                    26080000
240700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          26090000
240800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    26100000
240900         SET DP020-MSG-FATAL   TO  TRUE                           26110000
241000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               26120000
241100     ELSE                                                         26130000
241200         MOVE -1               TO MR-SELECTL (1)                  26140000
241300         SET DP030-SET-CURSOR-APPL-1                              26150000
241400                               TO TRUE                            26160000
241500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     26170000
241600     END-IF.                                                      26180000
241700                                                                  26190000
241800*----------------------------------------------------------------*26200000
241900* OPEN THE AUDIT DETAIL CURSOR.                                  *26210000
242000*----------------------------------------------------------------*26220000
242100                                                                  26230000
242200 4010-OPEN-CURSOR.                                                26240000
242300     PERFORM                                                      26250000
242400         WITH TEST AFTER                                          26260000
242500         VARYING PV-RETRY-COUNTER                                 26270000
242600         FROM 1 BY 1                                              26280000
242700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26290000
242800                   OR (SQLCODE = ZERO))                           26300000
242900                                                                  26310000
243000         IF PS-SYS-GEN-AUDIT                                      26320000
243100             EXEC SQL                                             26330000
243200                  OPEN AUD-DETAIL-SYS-CSR                         26340000
243300             END-EXEC                                             26350000
243400         ELSE                                                     26360000
243500             EXEC SQL                                             26370000
243600                  OPEN AUD-DETAIL-MAN-CSR                         26380000
243700             END-EXEC                                             26390000
243800         END-IF                                                   26400000
243900                                                                  26410000
244000         EVALUATE TRUE                                            26420000
244100             WHEN SQLCODE = ZERO                                  26430000
244200             WHEN SQLCODE = -904                                  26440000
244300             WHEN SQLCODE = -913                                  26450000
244400                 CONTINUE                                         26460000
244500             WHEN SQLWARN0 NOT = SPACES                           26470000
244600             WHEN SQLCODE < ZERO                                  26480000
244700             WHEN SQLCODE > ZERO                                  26490000
244800                 MOVE '4010-OPEN-CURSOR'                          26500000
244900                                   TO DP013-PARAGRAPH             26510000
245000                 MOVE 'OPEN AUDIT DETAIL CURSOR - '               26520000
245100                                   TO DP013-MESSAGE-TEXT (1)      26530000
245200                 MOVE SQLCA        TO DP013-SQLCA                 26540000
245300                 MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)     26550000
245400                 MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)     26560000
245500                 MOVE DK-AUDIT-NBR   TO PV-DISP-AUDIT-NBR         26570000
245600                 MOVE DK-SHIPT-UNIT-ID                            26580000
245700                                     TO PV-DISP-SHIPT-UNIT-ID     26590000
245800                 STRING 'SHIPT UNIT = '                           26600000
245900                     PV-DISP-SHIPT-UNIT-ID                        26610000
246000                        'AUDIT NBR = '                            26620000
246100                     PV-DISP-AUDIT-NBR                            26630000
246200                           DELIMITED BY SIZE                      26640000
246300                             INTO DP013-MESSAGE-TEXT (2)          26650000
246400                 SET DP013-DB2-ABEND                              26660000
246500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26670000
246600                 PERFORM DP013-0000-PROCESS-ABEND                 26680000
246700         END-EVALUATE                                             26690000
246800     END-PERFORM.                                                 26700000
246900*                                                                 26710000
247000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26720000
247100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             26730000
247200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   26740000
247300                                   TO DP013-MESSAGE-TEXT (1)      26750000
247400         MOVE SQLCA                TO DP013-SQLCA                 26760000
247500         MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)             26770000
247600         MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)             26780000
247700         SET DP013-DB2-ABEND                                      26790000
247800             DP013-XCTL-DISPLAY-RESTART                           26800000
247900                                   TO TRUE                        26810000
248000         PERFORM DP013-0000-PROCESS-ABEND                         26820000
248100     END-IF.                                                      26830000
248200                                                                  26840000
248300*----------------------------------------------------------------*26850000
248400* CLOSE THE AUDIT DETAIL CURSOR                                  *26860000
248500*----------------------------------------------------------------*26870000
248600                                                                  26880000
248700 4020-CLOSE-CURSOR.                                               26890000
248800                                                                  26900000
248900     IF PS-SYS-GEN-AUDIT                                          26910000
249000         EXEC SQL                                                 26920000
249100              CLOSE AUD-DETAIL-SYS-CSR                            26930000
249200         END-EXEC                                                 26940000
249300     ELSE                                                         26950000
249400         EXEC SQL                                                 26960000
249500              CLOSE AUD-DETAIL-MAN-CSR                            26970000
249600         END-EXEC                                                 26980000
249700     END-IF.                                                      26990000
249800                                                                  27000000
249900     EVALUATE TRUE                                                27010000
250000         WHEN SQLCODE = ZERO                                      27020000
250100             CONTINUE                                             27030000
250200         WHEN SQLWARN0 NOT = SPACES                               27040000
250300         WHEN SQLCODE < ZERO                                      27050000
250400         WHEN SQLCODE > ZERO                                      27060000
250500             MOVE '4020-CLOSE-CURSOR'                             27070000
250600                               TO DP013-PARAGRAPH                 27080000
250700             MOVE 'CLOSE THE AUDIT DETAIL CURSOR'                 27090000
250800                               TO DP013-MESSAGE-TEXT (1)          27100000
250900             MOVE SQLCA        TO DP013-SQLCA                     27110000
251000             MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)         27120000
251100             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (2)         27130000
251200             MOVE DK-AUDIT-NBR   TO PV-DISP-AUDIT-NBR             27140000
251300             MOVE DK-SHIPT-UNIT-ID                                27150000
251400                                 TO PV-DISP-SHIPT-UNIT-ID         27160000
251500             STRING 'SHIPT UNIT = '                               27170000
251600                     PV-DISP-SHIPT-UNIT-ID                        27180000
251700                        'AUDIT NBR = '                            27190000
251800                     PV-DISP-AUDIT-NBR                            27200000
251900                       DELIMITED BY SIZE                          27210000
252000                         INTO DP013-MESSAGE-TEXT (2)              27220000
252100             SET DP013-DB2-ABEND                                  27230000
252200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27240000
252300             PERFORM DP013-0000-PROCESS-ABEND                     27250000
252400     END-EVALUATE.                                                27260000
252500                                                                  27270000
252600 4050-SELECT-AUDIT.                                               27280000
252700     EXEC SQL                                                     27290000
252800          SELECT AUD_CNTL_NBR                                     27300000
252900          INTO  :SUT00015-AUD-CNTL-NBR                            27310000
253000          FROM   SUT_PO_AUD_REQ                                   27320000
253100          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-NBR                   27330000
253200     END-EXEC                                                     27340000
253300                                                                  27350000
253400     EVALUATE TRUE                                                27360000
253500         WHEN SQLCODE = ZERO                                      27370000
253600             SET PS-SYS-GEN-AUDIT TO TRUE                         27380000
253700         WHEN SQLCODE = +100                                      27390000
253800             SET PS-NOT-SYS-GEN-AUDIT TO TRUE                     27400000
253900         WHEN SQLWARN0 NOT = SPACES                               27410000
254000         WHEN SQLCODE < ZERO                                      27420000
254100         WHEN SQLCODE > ZERO                                      27430000
254200             MOVE '4050-SELECT-AUDIT'                             27440000
254300                               TO DP013-PARAGRAPH                 27450000
254400             MOVE 'SELECT AUDIT '                                 27460000
254500                               TO DP013-MESSAGE-TEXT (1)          27470000
254600             MOVE SQLCA        TO DP013-SQLCA                     27480000
254700             MOVE 'SUT00015'  TO DP013-DB2-TABLE-NAME (1)         27490000
254800             MOVE DK-AUDIT-NBR   TO PV-DISP-AUDIT-NBR             27500000
254900             STRING  'AUDIT NBR = '                               27510000
255000                  PV-DISP-AUDIT-NBR                               27520000
255100                       DELIMITED BY SIZE                          27530000
255200                         INTO DP013-MESSAGE-TEXT (2)              27540000
255300             SET DP013-DB2-ABEND                                  27550000
255400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27560000
255500             PERFORM DP013-0000-PROCESS-ABEND                     27570000
255600     END-EVALUATE.                                                27580000
255700                                                                  27590000
255800*----------------------------------------------------------------*27600000
255900*    SET UP THE HOST VARIABLES.                                  *27610000
256000*----------------------------------------------------------------*27620000
256100                                                                  27630000
256200 4100-PREPARE-CURSOR.                                             27640000
256300                                                                  27650000
256400     MOVE ASC-AUDIT-NBR          TO DK-AUDIT-NBR.                 27660000
256500     MOVE ASC-CARTON-ID          TO DK-SHIPT-UNIT-ID.             27670000
256600                                                                  27680000
256700*----------------------------------------------------------------*27690000
256800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *27700000
256900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *27710000
257000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *27720000
257100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *27730000
257200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *27740000
257300*                                                                *27750000
257400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *27760000
257500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *27770000
257600*    UPON INITIALIZATION.                                        *27780000
257700*----------------------------------------------------------------*27790000
257800                                                                  27800000
257900 4300-READ-ITEMS-FROM-DB.                                         27810000
258000                                                                  27820000
258100     PERFORM                                                      27830000
258200         VARYING PV-READ-COUNT                                    27840000
258300         FROM 1 BY 1                                              27850000
258400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    27860000
258500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         27870000
258600                                                                  27880000
258700         PERFORM 4310-FETCH                                       27890000
258900         IF  ASC-ITEMS-LEFT-ON-DB                                 27910000
259000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                27920000
259100                 ADD +1            TO ASC-ITEM-SUB                27930000
259200             ELSE                                                 27940000
259300                 ADD +1            TO ASC-BLK-SUB                 27950000
259400                 MOVE +1           TO ASC-ITEM-SUB                27960000
259500                                                                  27970000
259600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         27980000
259700                     MOVE +1       TO ASC-BLK-SUB                 27990000
259800                     SET ASC-BLOCK-MODIFIED (1)                   28000000
259900                                   TO TRUE                        28010000
260000                     PERFORM 5100-WRITE-TEMP-STORAGE              28020000
260100                     MOVE ASC-BLOCK-ENTRIES                       28030000
260200                               (PC-MAX-BLOCKS-IN-ARRAY)           28040000
260300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 28050000
260400                     ADD +1        TO ASC-BLK-SUB                 28060000
260500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   28070000
260600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      28080000
260700                                   TO TRUE                        28090000
260800                 END-IF                                           28100000
260900             END-IF                                               28110000
261000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    28120000
261100             MOVE ASC-NUMBER-OF-ITEMS-READ                        28130000
261200                                   TO ASC-LIST-ITEM-NUMBER        28140000
261300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28150000
261400             MOVE SUAUPC-UPC-NBR        TO ASC-TBL-UPC            28160000
261500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28170000
261600             MOVE XLT00006-INTR-UPC-ID  TO ASC-TBL-INTR-UPC       28180000
261700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28190000
261800             MOVE SHUUPC-TRN-LNE-NBR    TO ASC-TBL-LINE-NBR       28200000
261900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28210000
262000             MOVE SHUUPC-SHPD-QTY       TO ASC-TBL-EXP-UNITS      28220000
262100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28230000
      *SBJ 01/03/14 - BEGIN PR#5148D                                    28240000
CHECK *            IF PS-SYS-GEN-AUDIT                                  28250000
CHECK *               IF ASC-RFID-AUD                                   28260000
CHECK *                  PERFORM 4600-FETCH-NOTAG-QTY                   28270000
CHECK *                  MOVE PV-RFID-TAGGED-QTY TO ASC-TBL-AUDIT-UNITS 28280000
CHECK *                                       (ASC-BLK-SUB ASC-ITEM-SUB)28290000
CHECK *               ELSE                                              28300000
                         MOVE PV-SCANNED-UNIT-QTY TO ASC-TBL-AUDIT-UNITS28310000
                                              (ASC-BLK-SUB ASC-ITEM-SUB)28320000
CHECK *               END-IF                                            28330000
CHECK *            ELSE                                                 28340000
CHECK *               PERFORM 8000-CHECK-PO-EXCEPTION                   28350000
CHECK *               IF PS-RFID-PO-EXCEPTION                           28360000
CHECK *                  MOVE PV-RFID-TAGGED-QTY TO ASC-TBL-AUDIT-UNITS 28370000
CHECK *                                       (ASC-BLK-SUB ASC-ITEM-SUB)28380000
CHECK *               ELSE                                              28390000
CHECK *                  MOVE PV-SCANNED-UNIT-QTY TO ASC-TBL-AUDIT-UNITS28400000
CHECK *                                       (ASC-BLK-SUB ASC-ITEM-SUB)28410000
CHECK *               END-IF                                            28420000
CHECK *            END-IF                                               28430000
      *SBJ 01/03/14 - END PR#5148D                                      28440000
262400             MOVE SPACES                TO ASC-TBL-PASS-FAIL-IND  28450000
262500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28460000
262600             IF PS-NOT-SYS-GEN-AUDIT AND                          28470000
262700                SUAUPC-SCN-TYP-CDE   = 'E' AND                    28480000
262800                SUAUPC-UPC-RTL-AMT = 99                           28490000
262900                 PERFORM 4500-CALL-XLKUT-DOMAIN                   28500000
263000             ELSE                                                 28510000
263100                 MOVE SUAUPC-UPC-RTL-AMT    TO ASC-TBL-RETAIL     28520000
263200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28530000
263300                 SET PS-NOT-MULTIPLE-ERRORS TO TRUE               28540000
263400                 PERFORM 4360-SELECT-ERRORS                       28550000
263500                 IF PS-MULTIPLE-ERRORS                            28560000
263600                     MOVE PC-MULT-ERRORS    TO ASC-TBL-ERROR-DESC 28570000
263700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28580000
263800                 END-IF                                           28590000
263900             END-IF                                               28600000
264000             IF  SUAUPC-SCN-TYP-CDE   = PC-E                      28610000
264100                 MOVE ZEROES            TO ASC-TBL-AUDIT-UNITS    28620000
264200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28630000
264300             END-IF                                               28640000
264400         END-IF                                                   28650000
264500     END-PERFORM.                                                 28660000
264600                                                                  28670000
264700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          28680000
264800         MOVE +1               TO ASC-BLK-SUB                     28690000
264900         PERFORM 5100-WRITE-TEMP-STORAGE                          28700000
265000         ADD +1                TO ASC-BLK-SUB                     28710000
265100         PERFORM 5100-WRITE-TEMP-STORAGE                          28720000
265200                                                                  28730000
265300         MOVE 1                TO ASC-BLK-SUB                     28740000
265400                                  PV-BLOCK-NUMBER                 28750000
265500         PERFORM 4410-READ-TEMP-STORAGE                           28760000
265600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             28770000
265700             MOVE 2            TO ASC-BLK-SUB                     28780000
265800                                  PV-BLOCK-NUMBER                 28790000
265900             PERFORM 4410-READ-TEMP-STORAGE                       28800000
266000         END-IF                                                   28810000
266100     END-IF.                                                      28820000
266200                                                                  28830000
266300*----------------------------------------------------------------*28840000
266400*    FETCH THE AUDIT DETAIL-CURSOR                               *28850000
266500*----------------------------------------------------------------*28860000
266600                                                                  28870000
266700 4310-FETCH.                                                      28880000
266800                                                                  28890000
266900     IF PS-SYS-GEN-AUDIT                                          28900000
267000         EXEC SQL                                                 28910000
267100              FETCH AUD-DETAIL-SYS-CSR                            28920000
267200              INTO  :SUAUPC-UPC-NBR                               28930000
267300                 ,  :SUAUPC-UPC-RTL-AMT                           28940000
267400                 ,  :SUAUPC-SCN-TYP-CDE                           28950000
267500                 ,  :PV-SCANNED-UNIT-QTY                          28960000
267500*                ,  :PV-RFID-TAGGED-QTY                           28970000
267600                 ,  :SHUUPC-TRN-LNE-NBR                           28980000
267700                 ,  :SHUUPC-SHPD-QTY                              28990000
267800                 ,  :SHUUPC-UPC-NBR                               29000000
267900                 ,  :XLT00006-INTR-UPC-ID                         29010000
267900                 ,  :PV-UNION-TYPE                                29011024
268000         END-EXEC                                                 29020000
268100     ELSE                                                         29030000
268200         EXEC SQL                                                 29040000
268300              FETCH AUD-DETAIL-MAN-CSR                            29050000
268400              INTO  :SUAUPC-UPC-NBR                               29060000
268500                 ,  :SUAUPC-UPC-RTL-AMT                           29070000
268600                 ,  :SUAUPC-SCN-TYP-CDE                           29080000
268700                 ,  :PV-SCANNED-UNIT-QTY                          29090000
268700*                ,  :PV-RFID-TAGGED-QTY                           29100000
268800                 ,  :SHUUPC-TRN-LNE-NBR                           29110000
268900                 ,  :SHUUPC-SHPD-QTY                              29120000
269000                 ,  :SHUUPC-UPC-NBR                               29130000
269100                 ,  :XLT00006-INTR-UPC-ID                         29140000
267900                 ,  :PV-UNION-TYPE                                29141034
269200         END-EXEC                                                 29150000
269300     END-IF.                                                      29160000
269400                                                                  29170000
269500     EVALUATE TRUE                                                29180000
269600         WHEN SQLCODE = ZERO                                      29190000
269700         WHEN SQLCODE = +100                                      29200000
269800            CONTINUE                                              29210000
269900         WHEN SQLWARN0 NOT = SPACE                                29220000
270000         WHEN SQLCODE NOT = ZERO                                  29230000
270100            MOVE '4310-FETCH-CURSOR'                              29240000
270200                        TO DP013-PARAGRAPH                        29250000
270300            MOVE 'FETCH AUDIT CURSOR'                             29260000
270400                        TO DP013-MESSAGE-TEXT (1)                 29270000
270500            MOVE 'TSUAUPC '                                       29280000
270600                        TO DP013-DB2-TABLE-NAME (1)               29290000
270700            MOVE 'TSHUUPC '                                       29300000
270800                        TO DP013-DB2-TABLE-NAME (2)               29310000
270900            MOVE DK-AUDIT-NBR   TO PV-DISP-AUDIT-NBR              29320000
271000            MOVE DK-SHIPT-UNIT-ID                                 29330000
271100                                TO PV-DISP-SHIPT-UNIT-ID          29340000
271200            STRING 'SHIPT UNIT = '                                29350000
271300                PV-DISP-SHIPT-UNIT-ID                             29360000
271400                    'AUDIT NBR = '                                29370000
271500                 PV-DISP-AUDIT-NBR                                29380000
271600                      DELIMITED BY SIZE                           29390000
271700                        INTO DP013-MESSAGE-TEXT (2)               29400000
271800            MOVE SQLCA       TO DP013-SQLCA                       29410000
271900            SET DP013-DB2-ABEND                                   29420000
272000                             TO TRUE                              29430000
272100            PERFORM DP013-0000-PROCESS-ABEND                      29440000
272200     END-EVALUATE                                                 29450000
272300                                                                  29460000
272400     IF  SQLCODE EQUAL +100                                       29470000
272500         SET ASC-NO-ITEMS-LEFT-ON-DB                              29480000
272600                                   TO TRUE                        29490000
272700     END-IF.                                                      29500000
272800                                                                  29510000
272900 4360-SELECT-ERRORS.                                              29520000
273000                                                                  29530000
273100     EXEC SQL                                                     29540000
273200              SELECT DISTINCT                                     29550000
273300                C.VILN_CDE_SHRT_DESC                              29560000
273400             ,  C.FALR_IND                                        29570000
273500          INTO  :VILNCD-VILN-CDE-SHRT-DESC                        29580000
273600             ,  :VILNCD-FALR-IND                                  29590000
273700         FROM   TSUAUPC        A                                  29600000
273800             ,  TSUEXCP        B                                  29610000
273900             ,  TVILNCD        C                                  29620000
274000          WHERE A.AUD_CNTL_NBR      = :DK-AUDIT-NBR               29630000
274100            AND A.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID           29640000
274200            AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR             29650000
274300            AND A.SCN_TMST           = B.SCN_TMST                 29660000
274400            AND B.UPC_NBR           = :SUAUPC-UPC-NBR             29670000
274500            AND B.VILN_GP_CDE       = C.VILN_GP_CDE               29680000
274600            AND B.VILN_GP_SEQ_NBR   = C.VILN_GP_SEQ_NBR           29690000
274700                                                                  29700000
274800     END-EXEC.                                                    29710000
274900                                                                  29720000
275000     EVALUATE TRUE                                                29730000
275100         WHEN SQLCODE = ZERO                                      29740000
275200              MOVE VILNCD-VILN-CDE-SHRT-DESC                      29750000
275300                                    TO ASC-TBL-ERROR-DESC         29760000
275400                                  (ASC-BLK-SUB ASC-ITEM-SUB)      29770000
275500              IF  VILNCD-FALR-IND  =  'Y'                         29780000
275600                  MOVE 'F'      TO ASC-TBL-PASS-FAIL-IND          29790000
275700                                  (ASC-BLK-SUB ASC-ITEM-SUB)      29800000
275800              ELSE                                                29810000
275900                  MOVE ' '      TO ASC-TBL-PASS-FAIL-IND          29820000
276000                                  (ASC-BLK-SUB ASC-ITEM-SUB)      29830000
276100              END-IF                                              29840000
276200         WHEN SQLCODE = -811                                      29850000
276300              SET PS-MULTIPLE-ERRORS TO TRUE                      29860000
276400              IF  VILNCD-FALR-IND  =  'Y'                         29870000
276500                  MOVE 'F'      TO ASC-TBL-PASS-FAIL-IND          29880000
276600                                  (ASC-BLK-SUB ASC-ITEM-SUB)      29890000
276700              ELSE                                                29900000
276800                  MOVE ' '      TO ASC-TBL-PASS-FAIL-IND          29910000
276900                                  (ASC-BLK-SUB ASC-ITEM-SUB)      29920000
277000              END-IF                                              29930000
277100                                                                  29940000
277200         WHEN SQLCODE = +100                                      29950000
277300              CONTINUE                                            29960000
277400                                                                  29970000
277500         WHEN SQLWARN0 NOT = SPACE                                29980000
277600         WHEN SQLCODE NOT = ZERO                                  29990000
277700              MOVE '4360-SELECT-ERRORS'                           30000000
277800                               TO DP013-PARAGRAPH                 30010000
277900              MOVE 'SELECT ERRORS'                                30020000
278000                               TO DP013-MESSAGE-TEXT (1)          30030000
278100              MOVE 'TSUAUPC '  TO DP013-DB2-TABLE-NAME (1)        30040000
278200              MOVE 'TSUEXCP '  TO DP013-DB2-TABLE-NAME (2)        30050000
278300              MOVE 'TVILNCD '  TO DP013-DB2-TABLE-NAME (3)        30060000
278400              MOVE SQLCA       TO DP013-SQLCA                     30070000
278500              MOVE DK-AUDIT-NBR   TO PV-DISP-AUDIT-NBR            30080000
278600              MOVE DK-SHIPT-UNIT-ID                               30090000
278700                                  TO PV-DISP-SHIPT-UNIT-ID        30100000
278800              MOVE SUAUPC-UPC-NBR TO PV-DISP-UPC                  30110000
278900              STRING 'SHIPT UNIT = '                              30120000
279000                     PV-DISP-SHIPT-UNIT-ID                        30130000
279100                     ' AUDIT NBR = '                              30140000
279200                     PV-DISP-AUDIT-NBR                            30150000
279300                     ' UPC NBR = '                                30160000
279400                     PV-DISP-UPC                                  30170000
279500                        DELIMITED BY SIZE                         30180000
279600                          INTO DP013-MESSAGE-TEXT (2)             30190000
279700              SET DP013-DB2-ABEND                                 30200000
279800                               TO TRUE                            30210000
279900              PERFORM DP013-0000-PROCESS-ABEND                    30220000
280000     END-EVALUATE.                                                30230000
280100                                                                  30240000
280400*----------------------------------------------------------------*30280930
280500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *30281030
280600*----------------------------------------------------------------*30290000
280700                                                                  30300000
280800 4400-MOVE-COMMAREA-TO-SCREEN.                                    30310000
280900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             30320000
281000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          30330000
281100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          30340000
281200             MOVE +1    TO ASC-BLK-SUB                            30350000
281300             PERFORM 5100-WRITE-TEMP-STORAGE                      30360000
281400             ADD +1     TO ASC-BLK-SUB                            30370000
281500             PERFORM 5100-WRITE-TEMP-STORAGE                      30380000
281600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             30390000
281700                 GIVING PV-BLOCK-NUMBER                           30400000
281800                 REMAINDER PV-REMAINDER                           30410000
281900             IF  PV-REMAINDER > ZERO                              30420000
282000                 ADD +1 TO PV-BLOCK-NUMBER                        30430000
282100             END-IF                                               30440000
282200             MOVE +1    TO ASC-BLK-SUB                            30450000
282300             PERFORM 4410-READ-TEMP-STORAGE                       30460000
282400             ADD +1     TO ASC-BLK-SUB                            30470000
282500                           PV-BLOCK-NUMBER                        30480000
282600             PERFORM 4410-READ-TEMP-STORAGE                       30490000
282700     END-IF.                                                      30500000
282800     MOVE +1            TO ASC-BLK-SUB.                           30510000
282900     COMPUTE ASC-ITEM-SUB =                                       30520000
283000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              30530000
283100         + PC-ITEMS-PER-PANEL).                                   30540000
283200*                                                                 30550000
283300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        30560000
283400         ADD +1         TO ASC-BLK-SUB                            30570000
283500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            30580000
283600     END-IF.                                                      30590000
283700*                                                                 30600000
283800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           30610000
283900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                30620000
284000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        30630000
284100     PERFORM 4420-FORMAT-LIST-LINES                               30640000
284200         VARYING PV-SUB                                           30650000
284300         FROM PC-ITEMS-PER-PANEL BY -1                            30660000
284400         UNTIL PV-SUB < +1.                                       30670000
284500     MOVE ASC-AUDIT-NBR            TO AAUDITO.                    30680000
284600     MOVE ASC-REQUEST-MDCY         TO AREQDTEO.                   30690000
284700                                                                  30700000
284800     EVALUATE ASC-PROCESS-STATUS                                  30710000
284900        WHEN 'P' MOVE PC-PASS          TO AAUDSTAO                30720000
285000        WHEN 'F' MOVE PC-FAIL          TO AAUDSTAO                30730000
285100        WHEN 'I' MOVE PC-IN-PROCESS    TO AAUDSTAO                30740000
285200        WHEN 'N' MOVE PC-NOT-NEEDED    TO AAUDSTAO                30750000
285300        WHEN 'R' MOVE PC-PROMPT        TO AAUDSTAO                30760000
285400        WHEN 'A' MOVE PC-ALL           TO AAUDSTAO                30770000
285500     END-EVALUATE.                                                30780000
285600                                                                  30790000
285700     MOVE ASC-CARTON-ID            TO ACARTONO.                   30800000
285800     MOVE ASC-PO-RECEIVER          TO APORCVRO.                   30810000
285900                                                                  30820000
286000     EVALUATE ASC-SOURCE                                          30830000
286100         WHEN 'MAN' MOVE PC-MANUAL     TO ASOURCEO                30840000
286200         WHEN 'SYS' MOVE PC-SYSTEM     TO ASOURCEO                30850000
286300         WHEN 'ALL' MOVE PC-ALL-SYSTEM TO ASOURCEO                30860000
286400     END-EVALUATE.                                                30870000
286500                                                                  30880000
286600     MOVE ASC-OPER-UNIT-ID         TO PV-OPER-UNIT.               30890000
286700     MOVE PV-OPER-UNIT             TO AOPRUNTO.                   30900000
286800     MOVE ASC-OPER-DESC            TO AOPRDSCO.                   30910000
286900     EVALUATE ASC-PACKAGING-TYPE                                  30920000
287000        WHEN 'BC' MOVE PC-BULK-CSPK    TO APKGTYPO                30930000
287100        WHEN 'PP' MOVE PC-PRE-PACK     TO APKGTYPO                30940000
287200        WHEN 'PS' MOVE PC-PBS          TO APKGTYPO                30950000
      *CLP                                                              30960000
287200        WHEN 'RF' MOVE PC-RFID         TO APKGTYPO                30970000
      *CLP                                                              30980000
287300        WHEN 'AL' MOVE PC-ALL          TO APKGTYPO                30990000
287400     END-EVALUATE.                                                31000000
287500     PERFORM 7000-SELECT-TSUATRN.                                 31010000
           IF SQLCODE = ZERO                                            31020000
287600         PERFORM 7100-SELECT-TSULBXF                              31030000
287700         IF SULBXF-CART-LBL-TYP-CDE = 'P'                         31040000
287800             MOVE 'P2L '      TO PV-STORE                         31050000
287900             MOVE ZEROES      TO ASC-STORE-NBR                    31060000
288000         ELSE                                                     31070000
288100             IF PV-STATUS-CDE = 'A'                               31080000
288200                MOVE SULBXF-DEST-OPER-UNT-ID  TO PV-STORE-N       31090000
288300                                             ASC-STORE-NBR        31100000
288400             ELSE                                                 31110000
288500                 MOVE SPACES      TO PV-STORE                     31120000
288600                 MOVE ZEROES      TO ASC-STORE-NBR                31130000
288700             END-IF                                               31140000
288800         END-IF                                                   31150000
288800     END-IF                                                       31160000
                                                                        31170000
288900     MOVE SUATRN-INPK-QTY              TO PV-INNER-PACK-QTY       31180000
289000     MOVE PV-INNER-PACK-QTY            TO AINPKQTO                31190000
289100     MOVE PV-STORE                     TO ASTOREO                 31200000
289200                                                                  31210000
289300     IF ASC-ENT-ID-N > 0                                          31220000
289400         MOVE ASC-ENT-ID-N             TO PV-ENT-ID               31230000
289500         MOVE PV-ENT-ID                TO AVENDIDO                31240000
289600     ELSE                                                         31250000
289700         MOVE SPACES                   TO AVENDIDO                31260000
289800     END-IF.                                                      31270000
289900     MOVE ASC-VENDOR-NAME          TO AVENDNMO.                   31280000
290000     IF ASC-DEPT-NBR-N > 0                                        31290000
290100         MOVE ASC-DEPT-NBR-N           TO PV-DEPT-NBR             31300000
290200         MOVE PV-DEPT-NBR              TO ADEPTO                  31310000
290300     ELSE                                                         31320000
290400         MOVE SPACES                   TO ADEPTO                  31330000
290500     END-IF.                                                      31340000
290600     MOVE ASC-DEPARTMENT-DESC      TO ADPTDSCO.                   31350000
290700                                                                  31360000
290800     COMPUTE ASC-ITEMS-DISPLAYED =                                31370000
290900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          31380000
291000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    31390000
291100                                      ASTRTITO.                   31400000
291200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    31410000
291300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    31420000
291400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            31430000
291500                                   TO ASELITO.                    31440000
291600*                                                                 31450000
291700     IF  DP020-MSG-NUMBER-X = SPACE                               31460000
291800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  31470000
291900*            --- MORE ITEMS TO DISPLAY ----                       31480000
292000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            31490000
292100             SET DP020-MSG-INFORMATIONAL TO TRUE                  31500000
292200         END-IF                                                   31510000
292300     END-IF.                                                      31520000
292400*----------------------------------------------------------------*31530000
292500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *31540000
292600*----------------------------------------------------------------*31550000
292700                                                                  31560000
292800 4410-READ-TEMP-STORAGE.                                          31570000
292900                                                                  31580000
293000     EXEC CICS                                                    31590000
293100         READQ TS                                                 31600000
293200             QUEUE (ASC-LIST-QUEUE-NAME)                          31610000
293300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31620000
293400             ITEM  (PV-BLOCK-NUMBER)                              31630000
293500             RESP  (PV-CICS-RESP)                                 31640000
293600     END-EXEC.                                                    31650000
293700                                                                  31660000
293800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       31670000
293900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     31680000
294000         CONTINUE                                                 31690000
294100     ELSE                                                         31700000
294200         SET DP013-CICS-ABEND     TO TRUE                         31710000
294300         SET DP013-NO-ROLLBACK    TO TRUE                         31720000
294400         MOVE '4410-READ-TEMP-STORAGE'                            31730000
294500                                  TO DP013-PARAGRAPH              31740000
294600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      31750000
294700                                  TO DP013-MESSAGE-TEXT(1)        31760000
294800         PERFORM DP013-0000-PROCESS-ABEND                         31770000
294900     END-IF.                                                      31780000
295000                                                                  31790000
295100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             31800000
295200*                                                                 31810000
295300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         31820000
295400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               31830000
295500     END-IF.                                                      31840000
295600                                                                  31850000
295700*----------------------------------------------------------------*31860000
295800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *31870000
295900*----------------------------------------------------------------*31880000
296000                                                                  31890000
296100 4420-FORMAT-LIST-LINES.                                          31900000
296200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      31910000
296300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                31920000
296400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           31930000
296500         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           31940000
296600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           31950000
296700                                    MR-ACTION (PV-SUB)            31960000
296800                                    MR-UPC-X (PV-SUB)             31970000
296900                                    MR-LINE-NBR-X (PV-SUB)        31980000
297000                                    MR-EXPTD-UNITS-X (PV-SUB)     31990000
297100                                    MR-AUDIT-UNITS-X (PV-SUB)     32000000
297200                                    MR-RETAIL-X (PV-SUB)          32010000
297300                                    MR-ERROR-DESC (PV-SUB)        32020000
297400                                    MR-ERROR-IND (PV-SUB)         32030000
297500     ELSE                                                         32040000
297600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      32050000
297700                                                   > SPACE        32060000
297800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 32070000
297900                                 TO MR-SELECTI (PV-SUB)           32080000
298000         ELSE                                                     32090000
298100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      32100000
298200                                 TO MR-SELECTI (PV-SUB)           32110000
298300         END-IF                                                   32120000
298400*                                                                 32130000
298500         IF  DP030-SET-CURSOR-TRAILER                             32140000
298600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)32150000
298700                 > SPACE)                                         32160000
298800               OR (PV-SUB = 1))                                   32170000
298900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               32180000
299000                MOVE -1          TO MR-SELECTL (PV-SUB)           32190000
299100             END-IF                                               32200000
299200         END-IF                                                   32210000
299300*                                                                 32220000
299400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           32230000
299500             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           32240000
299600                                 TO MR-ACTION (PV-SUB)            32250000
299700             MOVE ASC-TBL-UPC (ASC-BLK-SUB ASC-ITEM-SUB)          32260000
299800                                 TO MR-UPC (PV-SUB)               32270000
299900             MOVE ASC-TBL-LINE-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)    32280000
300000                                 TO MR-LINE-NBR (PV-SUB)          32290000
300100             MOVE ASC-TBL-EXP-UNITS  (ASC-BLK-SUB ASC-ITEM-SUB)   32300000
300200                                 TO MR-EXPTD-UNITS (PV-SUB)       32310000
300300             MOVE ASC-TBL-AUDIT-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)  32320000
300400                                 TO MR-AUDIT-UNITS (PV-SUB)       32330000
300500             MOVE ASC-TBL-RETAIL  (ASC-BLK-SUB ASC-ITEM-SUB)      32340000
300600                                 TO MR-RETAIL (PV-SUB)            32350000
300700             MOVE ASC-TBL-ERROR-DESC  (ASC-BLK-SUB ASC-ITEM-SUB)  32360000
300800                                 TO MR-ERROR-DESC (PV-SUB)        32370000
300900             MOVE ASC-TBL-PASS-FAIL-IND                           32380000
301000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  32390000
301100                                 TO MR-ERROR-IND (PV-SUB)         32400000
301200         END-IF                                                   32410000
301300     END-IF.                                                      32420000
301400     SUBTRACT +1 FROM ASC-ITEM-SUB                                32430000
301500     IF  ASC-ITEM-SUB < + 1                                       32440000
301600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  32450000
301700         MOVE +1                 TO ASC-BLK-SUB                   32460000
301800     END-IF.                                                      32470000
301900******************************************************************32480000
302000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **32490000
302100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **32500000
302200** ISSUE A WARNING.                                             **32510000
302300******************************************************************32520000
302400 4430-CHECK-FOR-BEGIN-AND-END.                                    32530000
302500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       32540000
302600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     32550000
302700*            -- NO END-OF-RANGE SPECFIED ---                      32560000
302800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            32570000
302900             SET DP020-MSG-WARNING TO TRUE                        32580000
303000             PERFORM 4431-POSITION-AT-WARNING                     32590000
303100         END-IF                                                   32600000
303200     ELSE                                                         32610000
303300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     32620000
303400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                32630000
303500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            32640000
303600             SET DP020-MSG-WARNING TO TRUE                        32650000
303700             PERFORM 4431-POSITION-AT-WARNING                     32660000
303800         END-IF                                                   32670000
303900     END-IF.                                                      32680000
304000******************************************************************32690000
304100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **32700000
304200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **32710000
304300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **32720000
304400** POSITION THE CURSOR THERE.                                   **32730000
304500******************************************************************32740000
304600 4431-POSITION-AT-WARNING.                                        32750000
304700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 32760000
304800                    - PV-TOP-ITEM + 1.                            32770000
304900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      32780000
305000         CONTINUE                                                 32790000
305100     ELSE                                                         32800000
305200         SET DP030-SET-CURSOR-APPL-1                              32810000
305300                                   TO TRUE                        32820000
305400         MOVE -1                   TO MR-SELECTL (PV-SUB)         32830000
305500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         32840000
305600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         32850000
305700     END-IF.                                                      32860000
305800*                                                                 32870000
305900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   32880000
306000                    - PV-TOP-ITEM + 1.                            32890000
306100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      32900000
306200         CONTINUE                                                 32910000
306300     ELSE                                                         32920000
306400         SET DP030-SET-CURSOR-APPL-1                              32930000
306500                                   TO TRUE                        32940000
306600         MOVE -1                   TO MR-SELECTL (PV-SUB)         32950000
306700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         32960000
306800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         32970000
306900     END-IF.                                                      32980000
307000                                                                  32990000
307100                                                                  33000000
      *VSH 11/21/13 - BEGIN PR#5148D                                    33010000
       4432-QC-RFID-COMB-COUNT.                                         33020000
                                                                        33030000
           EXEC SQL                                                     33040000
               SELECT VALUE(COUNT(*), 0)                                33050000
                INTO :ASC-COUNT                                         33060000
                FROM SUT_PO_AUD_REQ                                     33070000
                WHERE RWRK_AUD_CNTL_NBR = :DK-AUDIT-NBR                 33080000
           END-EXEC.                                                    33090000
                                                                        33100000
           EVALUATE TRUE                                                33110000
               WHEN SQLCODE = ZERO                                      33120000
               WHEN SQLCODE = +100                                      33130000
               WHEN SQLCODE = -811                                      33140000
                   CONTINUE                                             33150000
               WHEN SQLWARN0 NOT = SPACES                               33160000
               WHEN SQLCODE < +0                                        33170000
               WHEN SQLCODE > ZERO                                      33180000
                   MOVE '4432-QC-RFID-COMB-COUNT'                       33190000
                                   TO DP013-PARAGRAPH                   33200000
                   MOVE 'SELECT SUT_PO_AUD_REQ'                         33210000
                                   TO DP013-MESSAGE-TEXT (1)            33220000
                   MOVE SQLCA      TO DP013-SQLCA                       33230000
                   MOVE 'SUT_PO_AUD_REQ'  TO DP013-DB2-TABLE-NAME (1)   33240000
                   SET DP013-DB2-ABEND                                  33250000
                                   TO TRUE                              33260000
                   SET DP013-XCTL-DISPLAY-RESTART                       33270000
                                   TO TRUE                              33280000
                   PERFORM DP013-0000-PROCESS-ABEND                     33290000
           END-EVALUATE.                                                33300000
      *                                                                 33310000
       4433-RFID-AUD-CNTL-NBR.                                          33320000
                                                                        33330000
           EXEC SQL                                                     33340000
               SELECT AUD_CNTL_NBR                                      33350000
                INTO :ASC-RFID-AUD-CNTL-NBR                             33360000
                FROM SUT_PO_AUD_REQ                                     33370000
                WHERE RWRK_AUD_CNTL_NBR = :DK-AUDIT-NBR                 33380000
           END-EXEC.                                                    33390000
                                                                        33400000
           EVALUATE TRUE                                                33410000
               WHEN SQLCODE = ZERO                                      33420000
               WHEN SQLCODE = +100                                      33430000
               WHEN SQLCODE = -811                                      33440000
                   CONTINUE                                             33450000
               WHEN SQLWARN0 NOT = SPACES                               33460000
               WHEN SQLCODE < +0                                        33470000
               WHEN SQLCODE > ZERO                                      33480000
                   MOVE '4433-QC-RFID-COMB-COUNT'                       33490000
                                   TO DP013-PARAGRAPH                   33500000
                   MOVE 'SELECT SUT_PO_AUD_REQ'                         33510000
                                   TO DP013-MESSAGE-TEXT (1)            33520000
                   MOVE SQLCA      TO DP013-SQLCA                       33530000
                   MOVE 'SUT_PO_AUD_REQ'  TO DP013-DB2-TABLE-NAME (1)   33540000
                   SET DP013-DB2-ABEND                                  33550000
                                   TO TRUE                              33560000
                   SET DP013-XCTL-DISPLAY-RESTART                       33570000
                                   TO TRUE                              33580000
                   PERFORM DP013-0000-PROCESS-ABEND                     33590000
           END-EVALUATE.                                                33600000
      *                                                                 33610000
       4434-CARTON-MULTP-AUD.                                           33620000
                                                                        33630000
           EXEC SQL                                                     33640000
               SELECT COUNT(*)                                          33650000
                INTO :ASC-AUD-CARTON-COUNT                              33660000
                FROM TSUATRN                                            33670000
                WHERE SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID                 33680000
                  AND AUD_CNTL_NBR <> :DK-AUDIT-NBR                     33690000
           END-EXEC.                                                    33700000
                                                                        33710000
           EVALUATE TRUE                                                33720000
               WHEN SQLCODE = ZERO                                      33730000
               WHEN SQLCODE = +100                                      33740000
               WHEN SQLCODE = -811                                      33750000
                   CONTINUE                                             33760000
               WHEN SQLWARN0 NOT = SPACES                               33770000
               WHEN SQLCODE < +0                                        33780000
               WHEN SQLCODE > ZERO                                      33790000
                   MOVE '4434-CARTON-MULTP-AUD'                         33800000
                                   TO DP013-PARAGRAPH                   33810000
                   MOVE 'SELECT TSUATRN'                                33820000
                                   TO DP013-MESSAGE-TEXT (1)            33830000
                   MOVE SQLCA      TO DP013-SQLCA                       33840000
                   MOVE 'TSUATRN'         TO DP013-DB2-TABLE-NAME (1)   33850000
                   SET DP013-DB2-ABEND                                  33860000
                                   TO TRUE                              33870000
                   SET DP013-XCTL-DISPLAY-RESTART                       33880000
                                   TO TRUE                              33890000
                   PERFORM DP013-0000-PROCESS-ABEND                     33900000
           END-EVALUATE.                                                33910000
      *                                                                 33920000
      *                                                                 33930000
       4435-CARTON-MULTP-AUD-QC.                                        33940000
                                                                        33950000
           EXEC SQL                                                     33960000
               SELECT AUD_CNTL_NBR                                      33970000
                INTO :ASC-OTHER-AUDIT                                   33980000
                FROM TSUATRN                                            33990000
                WHERE SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID                 34000000
                  AND AUD_CNTL_NBR <> :DK-AUDIT-NBR                     34010000
           END-EXEC.                                                    34020000
                                                                        34030000
           EVALUATE TRUE                                                34040000
               WHEN SQLCODE = ZERO                                      34050000
               WHEN SQLCODE = +100                                      34060000
               WHEN SQLCODE = -811                                      34070000
                   CONTINUE                                             34080000
               WHEN SQLWARN0 NOT = SPACES                               34090000
               WHEN SQLCODE < +0                                        34100000
               WHEN SQLCODE > ZERO                                      34110000
                   MOVE '4435-CARTON-MULTP-AUD-QC'                      34120000
                                   TO DP013-PARAGRAPH                   34130000
                   MOVE 'SELECT TSUATRN'                                34140000
                                   TO DP013-MESSAGE-TEXT (1)            34150000
                   MOVE SQLCA      TO DP013-SQLCA                       34160000
                   MOVE 'TSUATRN'         TO DP013-DB2-TABLE-NAME (1)   34170000
                   SET DP013-DB2-ABEND                                  34180000
                                   TO TRUE                              34190000
                   SET DP013-XCTL-DISPLAY-RESTART                       34200000
                                   TO TRUE                              34210000
                   PERFORM DP013-0000-PROCESS-ABEND                     34220000
           END-EVALUATE.                                                34230000
      *                                                                 34240000
      *VSH 11/21/13 - END PR#5148D                                      34250000
304000******************************************************************34260000
307200 4500-CALL-XLKUT-DOMAIN.                                          34270000
307200                                                                  34280000
307300     INITIALIZE XL001-ITEM-COMMAREA.                              34290000
307400                                                                  34300000
307500     MOVE SUAUPC-UPC-NBR        TO XL001-KEY-UPC-NBR.             34310000
307600                                                                  34320000
307700     SET  XL001-BY-UPC-NBR                                        34330000
307800          XL001-SELECT-SKU-STR  TO TRUE.                          34340000
307900                                                                  34350000
308000     CALL XL001-VSM-PGM USING  DFHEIBLK                           34360000
308100                               XL001-COMMAREA                     34370000
308200                               XL001-ITEM-COMMAREA.               34380000
308300     EVALUATE TRUE                                                34390000
308400                                                                  34400000
308500         WHEN XL001-SKU-STR-SQLCODE = +0                          34410000
308600             MOVE XL001-UNT-RTL-AMT      TO  ASC-TBL-RETAIL       34420000
308700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  34430000
308800                                                                  34440000
308900         WHEN XL001-SKU-SQLCODE = +100                            34450000
309000             MOVE ZEROES                 TO  ASC-TBL-RETAIL       34460000
309100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  34470000
309200                                                                  34480000
309300                                                                  34490000
309400         WHEN XL001-INVALID-ACCESS                                34500000
309500             MOVE '4500-CALL-XLKUT-DOMAIN'                        34510000
309600                             TO DP013-PARAGRAPH                   34520000
309700             MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'            34530000
309800                             TO DP013-MESSAGE-TEXT (1)            34540000
310300             MOVE XL001-SKU-STR-SQLCODE                           34550000
310300                             TO PV-DISP-SKU-STR-SQL-CDE           34560000
310300             MOVE XL001-UPC-SQLCODE                               34570000
310300                             TO PV-DISP-UPC-SQL-CDE               34580000
309900             MOVE SUAUPC-UPC-NBR                                  34590000
310000                             TO PV-DISP-UPC                       34600000
310600             STRING ' UPC NBR = '                                 34610000
310700                    PV-DISP-UPC                                   34620000
310800                       DELIMITED BY SIZE                          34630000
310900                         INTO DP013-MESSAGE-TEXT (2)              34640000
248000             STRING  'SUKCS592 - ERROR IN PROGRAM: '              34650000
248100                     XL001-RETURN-CODE                            34660000
248200                        DELIMITED BY SIZE                         34670000
248300                                    INTO DP013-MESSAGE-TEXT (3)   34680000
249600             STRING ' SKU-STOR SQL = '                            34690000
249700                     PV-DISP-SKU-STR-SQL-CDE                      34700000
250000                    ' UPC SQL = '                                 34710000
250100                     PV-DISP-UPC-SQL-CDE                          34720000
250200                        DELIMITED BY SIZE                         34730000
250300                                    INTO DP013-MESSAGE-TEXT (4)   34740000
310400             MOVE 'XLV_SKU'  TO DP013-DB2-TABLE-NAME (1)          34750000
310300             MOVE SQLCA      TO DP013-SQLCA                       34760000
311000             SET DP013-DB2-ABEND                                  34770000
311100                 DP013-XCTL-DISPLAY-RESTART                       34780000
311200                             TO TRUE                              34790000
311300             PERFORM DP013-0000-PROCESS-ABEND                     34800000
311400                                                                  34810000
311500         WHEN OTHER                                               34820000
311600             MOVE '4500-CALL-XLKUT-DOMAIN'                        34830000
311700                             TO DP013-PARAGRAPH                   34840000
311800             MOVE 'UNSUCCESSFUL SELECT ON XLV TABLE'              34850000
311900                             TO DP013-MESSAGE-TEXT (1)            34860000
310300             MOVE XL001-SKU-STR-SQLCODE                           34870000
310300                             TO PV-DISP-SKU-STR-SQL-CDE           34880000
310300             MOVE XL001-UPC-SQLCODE                               34890000
310300                             TO PV-DISP-UPC-SQL-CDE               34900000
312600             MOVE SUAUPC-UPC-NBR TO PV-DISP-UPC                   34910000
312700             STRING ' UPC NBR = '                                 34920000
312800                    PV-DISP-UPC                                   34930000
312900                       DELIMITED BY SIZE                          34940000
313000                         INTO DP013-MESSAGE-TEXT (2)              34950000
248000             STRING  'SUKCS592 - DB2 ERROR IN PROGRAM: '          34960000
248100                     XL001-RETURN-CODE                            34970000
248200                        DELIMITED BY SIZE                         34980000
248300                                    INTO DP013-MESSAGE-TEXT (3)   34990000
249600             STRING ' SKU-STOR SQL = '                            35000000
249700                     PV-DISP-SKU-STR-SQL-CDE                      35010000
250000                    ' UPC SQL = '                                 35020000
250100                     PV-DISP-UPC-SQL-CDE                          35030000
250200                        DELIMITED BY SIZE                         35040000
250300                                    INTO DP013-MESSAGE-TEXT (4)   35050000
312300             MOVE 'XLV_SKU'  TO DP013-DB2-TABLE-NAME (1)          35060000
312400             MOVE SQLCA      TO DP013-SQLCA                       35070000
313100             SET DP013-DB2-ABEND                                  35080000
313200                 DP013-XCTL-DISPLAY-RESTART                       35090000
313300                             TO TRUE                              35100000
313400             PERFORM DP013-0000-PROCESS-ABEND                     35110000
313500     END-EVALUATE.                                                35120000
                                                                        35130000
304000******************************************************************35140000
      *SBJ 01/14/14 - BEGIN PR#5148D                                    35150000
       4600-FETCH-NOTAG-QTY.                                            35160000
                                                                        35170000
           MOVE 0 TO PV-RFID-TAGGED-QTY2.                               35180000
                                                                        35190000
           EXEC SQL                                                     35200000
                SELECT  SUM(A.SCND_UNT_QTY) - SUM(A.RFID_TGD_QTY)       35210000
                INTO   :PV-RFID-TAGGED-QTY2                             35220000
                FROM    TSUAUPC A                                       35230000
                     ,  TSUEXCP B                                       35240000
                WHERE                                                   35250000
                    A.AUD_CNTL_NBR       = :DK-AUDIT-NBR                35260000
                AND A.SHIPT_UNT_ID       = :DK-SHIPT-UNIT-ID            35270000
                AND A.UPC_NBR            = :SUAUPC-UPC-NBR              35280000
                AND A.SCN_TYP_CDE        = 'E'                          35290000
                AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR               35300000
                AND A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID               35310000
                AND A.SCN_TMST           = B.SCN_TMST                   35320000
                AND B.VILN_GP_CDE        = 'VA'                         35330000
                AND B.VILN_GP_SEQ_NBR    = 42                           35340000
           END-EXEC.                                                    35350000
                                                                        35360000
           EVALUATE SQLCODE                                             35370000
             WHEN 0                                                     35380000
                  ADD PV-RFID-TAGGED-QTY2 TO PV-RFID-TAGGED-QTY         35390000
             WHEN 100                                                   35400000
             WHEN -305                                                  35410000
                  CONTINUE                                              35420000
             WHEN OTHER                                                 35430000
                  MOVE '4600-FETCH-NOTAG-QTY'                           35440000
                                  TO DP013-PARAGRAPH                    35450000
                  MOVE 'SELECT TSUAUPC'                                 35460000
                                  TO DP013-MESSAGE-TEXT (1)             35470000
                  MOVE SQLCA      TO DP013-SQLCA                        35480000
                  MOVE 'TSUAUPC'         TO DP013-DB2-TABLE-NAME (1)    35490000
                  MOVE 'TSUEXCP'         TO DP013-DB2-TABLE-NAME (2)    35500000
                  SET DP013-DB2-ABEND                                   35510000
                                  TO TRUE                               35520000
                  SET DP013-XCTL-DISPLAY-RESTART                        35530000
                                  TO TRUE                               35540000
                  PERFORM DP013-0000-PROCESS-ABEND                      35550000
           END-EVALUATE.                                                35560000
                                                                        35570000
      *SBJ 01/14/14 - BEGIN PR#5148D                                    35580000
                                                                        35590000
313600*----------------------------------------------------------------*35600000
313700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *35610000
313800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *35620000
313900* FOR THE SELECTED ITEMS QUEUE.                                  *35630000
314000*                                                                *35640000
314100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *35650000
314200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *35660000
314300* THE ARRAY IS FULL.                                             *35670000
314400*----------------------------------------------------------------*35680000
314500                                                                  35690000
314600 5000-PREPARE-SEL-QUEUE.                                          35700000
314700                                                                  35710000
314800     MOVE +1                   TO  ASC-BLK-SUB.                   35720000
314900     PERFORM 5100-WRITE-TEMP-STORAGE.                             35730000
315000     ADD +1                    TO  ASC-BLK-SUB.                   35740000
315100     PERFORM 5100-WRITE-TEMP-STORAGE.                             35750000
315200                                                                  35760000
315300     MOVE ASC-SEL-QUEUE-NAME   TO  SU029-SEL-QUEUE-NAME.          35770000
315400     PERFORM 6010-DELETE-SEL-QUEUE.                               35780000
315500                                                                  35790000
315600     SET ASC-UPDATE-TSQ        TO  TRUE.                          35800000
315700                                                                  35810000
315800     SET SU030-IDX             TO  1.                             35820000
315900     MOVE ZERO                 TO SU029-NUMBER-OF-TS-ITEMS.       35830000
316000     INITIALIZE SU030-SELECTED-ITEM-ARRAY.                        35840000
316100                                                                  35850000
316200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           35860000
316300             VARYING PV-ITEM                                      35870000
316400             FROM 1 BY 1                                          35880000
316500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     35890000
316600                                                                  35900000
316700     IF  SU030-IDX > 1                                            35910000
316800         PERFORM 5205-WRITE-SEL-QUEUE                             35920000
316900         ADD +1                TO SU029-NUMBER-OF-TS-ITEMS        35930000
317000     END-IF.                                                      35940000
317100                                                                  35950000
317200*----------------------------------------------------------------*35960000
317300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *35970000
317400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *35980000
317500* FOR THE SELECTED ITEMS QUEUE.                                  *35990000
317600*                                                                *36000000
317700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *36010000
317800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *36020000
317900* THE ARRAY IS FULL.                                             *36030000
318000*----------------------------------------------------------------*36040000
318100                                                                  36050000
318200 5010-PREPARE-SEL-QUEUE.                                          36060000
318300                                                                  36070000
318400     MOVE +1                   TO  ASC-BLK-SUB.                   36080000
318500     PERFORM 5100-WRITE-TEMP-STORAGE.                             36090000
318600     ADD +1                    TO  ASC-BLK-SUB.                   36100000
318700     PERFORM 5100-WRITE-TEMP-STORAGE.                             36110000
318800                                                                  36120000
318900     MOVE ASC-SEL-QUEUE-NAME   TO  SU038-SEL-QUEUE-NAME.          36130000
319000     PERFORM 6010-DELETE-SEL-QUEUE.                               36140000
319100                                                                  36150000
319200     SET ASC-UPDATE-TSQ        TO  TRUE.                          36160000
319300                                                                  36170000
319400     SET SU039-IDX             TO  1.                             36180000
319500     MOVE ZERO                 TO SU038-NUMBER-OF-TS-ITEMS.       36190000
319600     INITIALIZE SU039-SELECTED-ITEM-ARRAY.                        36200000
319700                                                                  36210000
319800     PERFORM 5300-FILL-SEL-QUEUE-RECORD                           36220000
319900             VARYING PV-ITEM                                      36230000
320000             FROM 1 BY 1                                          36240000
320100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     36250000
320200                                                                  36260000
320300     IF  SU039-IDX > 1                                            36270000
320400         PERFORM 5305-WRITE-SEL-QUEUE                             36280000
320500         ADD +1                TO SU038-NUMBER-OF-TS-ITEMS        36290000
320600     END-IF.                                                      36300000
320700                                                                  36310000
320800*----------------------------------------------------------------*36320000
320900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *36330000
321000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *36340000
321100*----------------------------------------------------------------*36350000
321200                                                                  36360000
321300 5100-WRITE-TEMP-STORAGE.                                         36370000
321400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     36380000
321500                                   TO PV-LIST-ITEM-NUMBER.        36390000
321600     COMPUTE PV-BLOCK-NUMBER =                                    36400000
321700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    36410000
321800                                                                  36420000
321900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             36430000
322000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             36440000
322100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      36450000
322200             PERFORM 5105-REWRITE-ASC-LISTQ                       36460000
322300         END-IF                                                   36470000
322400     ELSE                                                         36480000
322500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       36490000
322600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            36500000
322700         PERFORM 5110-WRITE-ASC-LISTQ                             36510000
322800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   36520000
322900     END-IF.                                                      36530000
323000                                                                  36540000
323100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             36550000
323200******************************************************************36560000
323300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **36570000
323400** SPECIFIC COMMAREA.                                           **36580000
323500******************************************************************36590000
323600 5105-REWRITE-ASC-LISTQ.                                          36600000
323700     EXEC CICS                                                    36610000
323800         WRITEQ TS                                                36620000
323900             QUEUE (ASC-LIST-QUEUE-NAME)                          36630000
324000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               36640000
324100             ITEM  (PV-BLOCK-NUMBER)                              36650000
324200             REWRITE                                              36660000
324300             RESP  (PV-CICS-RESP)                                 36670000
324400     END-EXEC.                                                    36680000
324500                                                                  36690000
324600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           36700000
324700         CONTINUE                                                 36710000
324800     ELSE                                                         36720000
324900         SET DP013-CICS-ABEND            TO TRUE                  36730000
325000         SET DP013-NO-ROLLBACK           TO TRUE                  36740000
325100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       36750000
325200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     36760000
325300                                         TO DP013-MESSAGE-TEXT(1) 36770000
325400         PERFORM DP013-0000-PROCESS-ABEND                         36780000
325500     END-IF.                                                      36790000
325600                                                                  36800000
325700******************************************************************36810000
325800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **36820000
325900** SPECIFIC COMMAREA.                                           **36830000
326000******************************************************************36840000
326100 5110-WRITE-ASC-LISTQ.                                            36850000
326200     EXEC CICS                                                    36860000
326300         WRITEQ TS                                                36870000
326400             QUEUE (ASC-LIST-QUEUE-NAME)                          36880000
326500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               36890000
326600             ITEM  (PV-BLOCK-NUMBER)                              36900000
326700             RESP  (PV-CICS-RESP)                                 36910000
326800     END-EXEC.                                                    36920000
326900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      36930000
327000         SET DP013-CICS-ABEND      TO TRUE                        36940000
327100         SET DP013-NO-ROLLBACK     TO TRUE                        36950000
327200         MOVE '5110-WRITE-ASC-LISTQ'                              36960000
327300                                   TO DP013-PARAGRAPH             36970000
327400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           36980000
327500                                   TO DP013-MESSAGE-TEXT(1)       36990000
327600         PERFORM DP013-0000-PROCESS-ABEND                         37000000
327700     END-IF.                                                      37010000
327800                                                                  37020000
327900*----------------------------------------------------------------*37030000
328000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *37040000
328100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *37050000
328200*----------------------------------------------------------------*37060000
328300                                                                  37070000
328400 5120-REWRITE-LIST-QUEUE.                                         37080000
328500     EXEC CICS                                                    37090000
328600          WRITEQ TS                                               37100000
328700              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     37110000
328800              FROM    (SU029-INTER-APPL-COMMAREA)                 37120000
328900              ITEM    (ASC-SEL-ITEM)                              37130000
329000              RESP    (PV-CICS-RESP)                              37140000
329100              REWRITE                                             37150000
329200     END-EXEC.                                                    37160000
329300*             FROM    (SU029-SELECT-RECORD)                       37170000
329400                                                                  37180000
329500     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    37190000
329600         SET DP013-CICS-ABEND                                     37200000
329700             DP013-NO-ROLLBACK     TO TRUE                        37210000
329800         MOVE '5120-REWRITE-LIST-QUEUE'                           37220000
329900                                   TO DP013-PARAGRAPH             37230000
330000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   37240000
330100                                   TO DP013-MESSAGE-TEXT (1)      37250000
330200         PERFORM DP013-0000-PROCESS-ABEND                         37260000
330300     END-IF.                                                      37270000
330400                                                                  37280000
330500                                                                  37290000
330600 5200-FILL-SEL-QUEUE-RECORD.                                      37300000
330700                                                                  37310000
330800     PERFORM 6112-READ-LIST-QUEUE.                                37320000
330900                                                                  37330000
331000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37340000
331100         PERFORM                                                  37350000
331200         VARYING LQW-IDX                                          37360000
331300         FROM 1 BY 1                                              37370000
331400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            37380000
331500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          37390000
331600                                                                  37400000
331700             IF  LQW-SELECT (LQW-IDX)                             37410000
331800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              37420000
331900                                   TO SU030-ITEM (SU030-IDX)      37430000
332000                 MOVE LQW-UPC (LQW-IDX)                           37440000
332100                                   TO SU030-UPC-NBR    (SU030-IDX)37450000
332200                 MOVE LQW-INTR-UPC (LQW-IDX)                      37460000
332300                                   TO SU030-INTR-UPC   (SU030-IDX)37470000
332400                 MOVE SPACE        TO SU030-ACTION-SW (SU030-IDX) 37480000
332500                 SET SU030-IDX UP BY 1                            37490000
332600                 IF  SU030-IDX > SU030-MAX-ITEMS                  37500000
332700                     PERFORM 5205-WRITE-SEL-QUEUE                 37510000
332800                     ADD +1        TO SU029-NUMBER-OF-TS-ITEMS    37520000
332900                     INITIALIZE SU030-SELECTED-ITEM-ARRAY         37530000
333000                     SET SU030-IDX TO  1                          37540000
333100                 END-IF                                           37550000
333200             END-IF                                               37560000
333300         END-PERFORM                                              37570000
333400     END-IF.                                                      37580000
333500                                                                  37590000
333600*----------------------------------------------------------------*37600000
333700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *37610000
333800*----------------------------------------------------------------*37620000
333900                                                                  37630000
334000 5205-WRITE-SEL-QUEUE.                                            37640000
334100                                                                  37650000
334200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            37660000
334300                                   TO SU030-SELECTED-ITEMS.       37670000
334400                                                                  37680000
334500     EXEC CICS                                                    37690000
334600          WRITEQ TS                                               37700000
334700              QUEUE (ASC-SEL-QUEUE-NAME)                          37710000
334800              FROM  (SU030-SELECT-RECORD)                         37720000
334900              ITEM  (PV-SEL-QUEUE-ITEM)                           37730000
335000              RESP  (PV-CICS-RESP)                                37740000
335100     END-EXEC.                                                    37750000
335200                                                                  37760000
335300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37770000
335400         CONTINUE                                                 37780000
335500     ELSE                                                         37790000
335600         SET DP013-CICS-ABEND      TO TRUE                        37800000
335700         SET DP013-NO-ROLLBACK     TO TRUE                        37810000
335800         MOVE '5205-WRITE-SEL-QUEUE'                              37820000
335900                                   TO DP013-PARAGRAPH             37830000
336000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          37840000
336100                                   TO DP013-MESSAGE-TEXT(1)       37850000
336200         PERFORM DP013-0000-PROCESS-ABEND                         37860000
336300     END-IF.                                                      37870000
336400                                                                  37880000
336500 5300-FILL-SEL-QUEUE-RECORD.                                      37890000
336600                                                                  37900000
336700     PERFORM 6112-READ-LIST-QUEUE.                                37910000
336800                                                                  37920000
336900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37930000
337000         PERFORM                                                  37940000
337100         VARYING LQW-IDX                                          37950000
337200         FROM 1 BY 1                                              37960000
337300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            37970000
337400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          37980000
337500                                                                  37990000
337600             IF  LQW-SELECT (LQW-IDX)                             38000000
337700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              38010000
337800                                        TO SU039-ITEM (SU039-IDX) 38020000
337900                 MOVE LQW-UPC (LQW-IDX) TO SU039-UPC  (SU039-IDX) 38030000
338000                 MOVE LQW-LINE-NBR (LQW-IDX)                      38040000
338100                                   TO SU039-LINE      (SU039-IDX) 38050000
338200                 MOVE SPACE        TO SU039-ACTION-SW (SU039-IDX) 38060000
338300                 SET SU039-IDX UP BY 1                            38070000
338400                 IF  SU039-IDX > SU039-MAX-ITEMS                  38080000
338500                     PERFORM 5305-WRITE-SEL-QUEUE                 38090000
338600                     ADD +1        TO SU038-NUMBER-OF-TS-ITEMS    38100000
338700                     INITIALIZE SU039-SELECTED-ITEM-ARRAY         38110000
338800                     SET SU039-IDX TO  1                          38120000
338900                 END-IF                                           38130000
339000             END-IF                                               38140000
339100         END-PERFORM                                              38150000
339200     END-IF.                                                      38160000
339300                                                                  38170000
339400*----------------------------------------------------------------*38180000
339500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *38190000
339600*----------------------------------------------------------------*38200000
339700 5305-WRITE-SEL-QUEUE.                                            38210000
339800                                                                  38220000
339900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            38230000
340000                                   TO SU039-SELECTED-ITEMS.       38240000
340100                                                                  38250000
340200     EXEC CICS                                                    38260000
340300          WRITEQ TS                                               38270000
340400              QUEUE (ASC-SEL-QUEUE-NAME)                          38280000
340500              FROM  (SU039-SELECT-RECORD)                         38290000
340600              ITEM  (PV-SEL-QUEUE-ITEM)                           38300000
340700              RESP  (PV-CICS-RESP)                                38310000
340800     END-EXEC.                                                    38320000
340900                                                                  38330000
341000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38340000
341100         CONTINUE                                                 38350000
341200     ELSE                                                         38360000
341300         SET DP013-CICS-ABEND      TO TRUE                        38370000
341400         SET DP013-NO-ROLLBACK     TO TRUE                        38380000
341500         MOVE '5305-WRITE-SEL-QUEUE'                              38390000
341600                                   TO DP013-PARAGRAPH             38400000
341700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          38410000
341800                                   TO DP013-MESSAGE-TEXT(1)       38420000
341900         PERFORM DP013-0000-PROCESS-ABEND                         38430000
342000     END-IF.                                                      38440000
342100                                                                  38450000
342200******************************************************************38460000
342300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **38470000
342400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **38480000
342500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **38490000
342600** THE USER.                                                    **38500000
342700******************************************************************38510000
342800 6000-REFRESH-PANEL-FROM-TEMP.                                    38520000
342900     IF  ASC-UPDATE-TSQ                                           38530000
343000         SET ASC-NO-TSQ-UPDATE TO TRUE                            38540000
343100         MOVE ZERO                 TO PV-SAVE-ITEM                38550000
343200                                      PV-SEL-QUEUE-ITEM           38560000
343300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        38570000
343400                                   TO PV-HOLD-SELECTED-ITEMS      38580000
343500         MOVE +1                   TO PV-ITEMS-PROCESSED          38590000
343600         PERFORM 6100-UPDATE-TSQ                                  38600000
343700             UNTIL PV-ITEMS-PROCESSED >                           38610000
343800                                     PV-HOLD-SELECTED-ITEMS       38620000
343900         PERFORM 6010-DELETE-SEL-QUEUE                            38630000
344000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         38640000
344100                    ASC-BLOCK-ENTRIES (2)                         38650000
344200     END-IF.                                                      38660000
344300                                                                  38670000
344400*----------------------------------------------------------------*38680000
344500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *38690000
344600*----------------------------------------------------------------*38700000
344700 6010-DELETE-SEL-QUEUE.                                           38710000
344800                                                                  38720000
344900     EXEC CICS                                                    38730000
345000         DELETEQ TS                                               38740000
345100             QUEUE (ASC-SEL-QUEUE-NAME)                           38750000
345200             RESP  (PV-CICS-RESP)                                 38760000
345300     END-EXEC.                                                    38770000
345400*                                                                 38780000
345500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      38790000
345600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         38800000
345700         CONTINUE                                                 38810000
345800     ELSE                                                         38820000
345900         SET DP013-CICS-ABEND TO TRUE                             38830000
346000         SET DP013-NO-ROLLBACK TO TRUE                            38840000
346100         MOVE '6010-DELETE-SEL-QUEUE'                             38850000
346200                        TO DP013-PARAGRAPH                        38860000
346300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         38870000
346400                        TO DP013-MESSAGE-TEXT (1)                 38880000
346500         PERFORM DP013-0000-PROCESS-ABEND                         38890000
346600     END-IF.                                                      38900000
346700                                                                  38910000
346800*----------------------------------------------------------------*38920000
346900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *38930000
347000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *38940000
347100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *38950000
347200*    THE TEMP QUEUE.                                             *38960000
347300*----------------------------------------------------------------*38970000
347400                                                                  38980000
347500 6100-UPDATE-TSQ.                                                 38990000
347600                                                                  39000000
347700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             39010000
347800     PERFORM 6105-READ-SEL-QUEUE.                                 39020000
347900     PERFORM                                                      39030000
348000*        VARYING SU028-IDX                                        39040000
348100         VARYING SU030-IDX                                        39050000
348200         FROM 1 BY 1                                              39060000
348300         UNTIL ((PV-ITEMS-PROCESSED >                             39070000
348400                              PV-HOLD-SELECTED-ITEMS)             39080000
348500         OR (SU028-IDX GREATER THAN SU028-MAX-ITEMS))             39090000
348600*        IF  SU028-ACTION-SW (SU028-IDX) > SPACE                  39100000
348700         IF  SU030-ACTION-SW (SU030-IDX) > SPACE                  39110000
348800             PERFORM 6110-PROCESS-ITEMS                           39120000
348900         END-IF                                                   39130000
349000         ADD +1                TO PV-ITEMS-PROCESSED              39140000
349100     END-PERFORM.                                                 39150000
349200     PERFORM 6111-WRITE-LIST-QUEUE.                               39160000
349300*----------------------------------------------------------------*39170000
349400*    READ THE LIST QUEUE RECORD.                                 *39180000
349500*----------------------------------------------------------------*39190000
349600                                                                  39200000
349700 6105-READ-SEL-QUEUE.                                             39210000
349800                                                                  39220000
349900     EXEC CICS                                                    39230000
350000          READQ TS                                                39240000
350100              QUEUE (ASC-SEL-QUEUE-NAME)                          39250000
350200              INTO  (SU030-SELECT-RECORD)                         39260000
350300              ITEM  (PV-SEL-QUEUE-ITEM)                           39270000
350400              RESP  (PV-CICS-RESP)                                39280000
350500     END-EXEC.                                                    39290000
350600*             INTO  (SU028-SELECT-RECORD)                         39300000
350700*                                                                 39310000
350800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39320000
350900         CONTINUE                                                 39330000
351000     ELSE                                                         39340000
351100         SET DP013-CICS-ABEND      TO  TRUE                       39350000
351200         SET DP013-NO-ROLLBACK     TO  TRUE                       39360000
351300         MOVE '6105-READ-SEL-QUEUE'                               39370000
351400                                   TO  DP013-PARAGRAPH            39380000
351500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           39390000
351600                                   TO  DP013-MESSAGE-TEXT(1)      39400000
351700         PERFORM DP013-0000-PROCESS-ABEND                         39410000
351800     END-IF.                                                      39420000
351900                                                                  39430000
352000*----------------------------------------------------------------*39440000
352100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*39450000
352200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*39460000
352300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *39470000
352400*----------------------------------------------------------------*39480000
352500                                                                  39490000
352600 6110-PROCESS-ITEMS.                                              39500000
352700                                                                  39510000
352800*    COMPUTE PV-ITEM = 1 + ((SU028-ITEM (SU028-IDX) - 1)          39520000
352900*    COMPUTE PV-ITEM = 1 + ((SU030-ITEM (SU028-IDX) - 1)          39530000
353000     COMPUTE PV-ITEM = 1 + ((SU030-ITEM (SU030-IDX) - 1)          39540000
353100                     / PC-ITEMS-PER-PANEL).                       39550000
353200                                                                  39560000
353300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           39570000
353400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          39580000
353500             PERFORM 6111-WRITE-LIST-QUEUE                        39590000
353600         END-IF                                                   39600000
353700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    39610000
353800                                                                  39620000
353900         PERFORM 6112-READ-LIST-QUEUE                             39630000
354000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               39640000
354100             CONTINUE                                             39650000
354200         END-IF                                                   39660000
354300     END-IF.                                                      39670000
354400                                                                  39680000
354500*    COMPUTE PV-SUB = (SU028-ITEM (SU028-IDX)                     39690000
354600     COMPUTE PV-SUB = (SU030-ITEM (SU030-IDX)                     39700000
354700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              39710000
354800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         39720000
354900     MOVE LQW-SELECTED-SW (PV-SUB)                                39730000
355000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  39740000
355100     EVALUATE TRUE                                                39750000
355200         WHEN SU030-INQ (SU030-IDX)                               39760000
355300              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             39770000
355400                                                                  39780000
355500         WHEN SU030-UPD (SU030-IDX)                               39790000
355600              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             39800000
355700                                                                  39810000
355800         WHEN SU030-DEL (SU030-IDX)                               39820000
355900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             39830000
356000                                                                  39840000
356100         WHEN SU030-ERR (SU030-IDX)                               39850000
356200              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             39860000
356300     END-EVALUATE.                                                39870000
356400                                                                  39880000
356500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                39890000
356600                                                                  39900000
356700*----------------------------------------------------------------*39910000
356800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *39920000
356900*----------------------------------------------------------------*39930000
357000                                                                  39940000
357100 6111-WRITE-LIST-QUEUE.                                           39950000
357200                                                                  39960000
357300     EXEC CICS                                                    39970000
357400         WRITEQ TS                                                39980000
357500             QUEUE (ASC-LIST-QUEUE-NAME)                          39990000
357600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     40000000
357700             ITEM  (PV-SAVE-ITEM)                                 40010000
357800             REWRITE                                              40020000
357900             RESP  (PV-CICS-RESP)                                 40030000
358000     END-EXEC.                                                    40040000
358100*                                                                 40050000
358200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          40060000
358300         CONTINUE                                                 40070000
358400     ELSE                                                         40080000
358500         SET DP013-CICS-ABEND  TO  TRUE                           40090000
358600         SET DP013-NO-ROLLBACK TO  TRUE                           40100000
358700         MOVE '6111-WRITE-LIST-QUEUE'                             40110000
358800                               TO  DP013-PARAGRAPH                40120000
358900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  40130000
359000                               TO  DP013-MESSAGE-TEXT(1)          40140000
359100         PERFORM DP013-0000-PROCESS-ABEND                         40150000
359200     END-IF.                                                      40160000
359300                                                                  40170000
359400*----------------------------------------------------------------*40180000
359500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*40190000
359600*----------------------------------------------------------------*40200000
359700                                                                  40210000
359800 6112-READ-LIST-QUEUE.                                            40220000
359900                                                                  40230000
360000     EXEC CICS                                                    40240000
360100         READQ TS                                                 40250000
360200             QUEUE (ASC-LIST-QUEUE-NAME)                          40260000
360300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     40270000
360400             ITEM  (PV-ITEM)                                      40280000
360500             RESP  (PV-CICS-RESP)                                 40290000
360600     END-EXEC.                                                    40300000
360700*                                                                 40310000
360800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          40320000
360900         CONTINUE                                                 40330000
361000     ELSE                                                         40340000
361100         SET DP013-CICS-ABEND        TO TRUE                      40350000
361200         SET DP013-NO-ROLLBACK       TO TRUE                      40360000
361300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           40370000
361400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    40380000
361500                                     TO DP013-MESSAGE-TEXT(1)     40390000
361600         PERFORM DP013-0000-PROCESS-ABEND                         40400000
361700     END-IF.                                                      40410000
361800                                                                  40420000
361900 7000-SELECT-TSUATRN.                                             40430000
362000     MOVE ASC-AUDIT-NBR          TO DK-AUDIT-NBR.                 40440000
362100     MOVE ASC-CARTON-ID          TO DK-SHIPT-UNIT-ID.             40450000
362200                                                                  40460000
362300     EXEC SQL                                                     40470000
362400          SELECT INPK_QTY                                         40480000
362500           INTO :SUATRN-INPK-QTY                                  40490000
362600          FROM  TSUATRN                                           40500000
362700          WHERE AUD_CNTL_NBR      = :DK-AUDIT-NBR                 40510000
362800            AND SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID             40520000
362900     END-EXEC.                                                    40530000
363000                                                                  40540000
363100                                                                  40550000
363200     EVALUATE TRUE                                                40560000
363300         WHEN SQLCODE = ZERO                                      40570000
363400              CONTINUE                                            40580000
363300         WHEN SQLCODE = +100                                      40590000
240800             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                40600000
240900             SET DP020-MSG-FATAL   TO  TRUE                       40610000
241000             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           40620000
363500         WHEN SQLWARN0 NOT = SPACE                                40630000
363600         WHEN SQLCODE NOT = ZERO                                  40640000
363700              MOVE '7000-SELECT-TSUATRN'                          40650000
363800                               TO DP013-PARAGRAPH                 40660000
363900              MOVE 'SELECT INPK QTY'                              40670000
364000                               TO DP013-MESSAGE-TEXT (1)          40680000
364100              MOVE 'TSUATRN '  TO DP013-DB2-TABLE-NAME (1)        40690000
364200              MOVE SQLCA       TO DP013-SQLCA                     40700000
364300              MOVE DK-SHIPT-UNIT-ID  TO PV-DISP-SHIPT-UNIT-ID     40710000
364400              MOVE DK-AUDIT-NBR      TO PV-DISP-AUDIT-NBR         40720000
364500              STRING 'SHIPT UNIT = '                              40730000
364600                     PV-DISP-SHIPT-UNIT-ID                        40740000
364500                     '/ AUDIT NBR = '                             40750000
364600                     PV-DISP-AUDIT-NBR                            40760000
364700                           DELIMITED BY SIZE                      40770000
364800                             INTO DP013-MESSAGE-TEXT (2)          40780000
364900              SET DP013-DB2-ABEND                                 40790000
365000                               TO TRUE                            40800000
365100              PERFORM DP013-0000-PROCESS-ABEND                    40810000
365200     END-EVALUATE.                                                40820000
365300                                                                  40830000
365400 7100-SELECT-TSULBXF.                                             40840000
365500                                                                  40850000
365600     EXEC SQL                                                     40860000
365700          SELECT CART_LBL_TYP_CDE                                 40870000
365800               , DEST_OPER_UNT_ID                                 40880000
365900            INTO :SULBXF-CART-LBL-TYP-CDE                         40890000
366000               , :SULBXF-DEST-OPER-UNT-ID                         40900000
366100          FROM   TSULBXF                                          40910000
366200          WHERE SHIPT_UNT_ID     = :DK-SHIPT-UNIT-ID              40920000
366300            AND STAT_CDE         = 'A'                            40930000
366400     END-EXEC.                                                    40940000
366500                                                                  40950000
366600     EVALUATE TRUE                                                40960000
366700         WHEN SQLCODE = ZERO                                      40970000
366800              MOVE 'A' TO PV-STATUS-CDE                           40980000
366900         WHEN SQLCODE = +100                                      40990000
367000              MOVE 'I' TO PV-STATUS-CDE                           41000000
367100         WHEN SQLWARN0 NOT = SPACE                                41010000
367200         WHEN SQLCODE NOT = ZERO                                  41020000
367300              MOVE '7100-SELECT-TSULBXF'                          41030000
367400                               TO DP013-PARAGRAPH                 41040000
367500              MOVE 'SELECT CROSS REFERENCE TABLE'                 41050000
367600                               TO DP013-MESSAGE-TEXT (1)          41060000
367700              MOVE 'TSULBXF '  TO DP013-DB2-TABLE-NAME (1)        41070000
367800              MOVE DK-SHIPT-UNIT-ID  TO PV-DISP-SHIPT-UNIT-ID     41080000
367900              STRING 'SHIPT UNIT = '                              41090000
368000                     PV-DISP-SHIPT-UNIT-ID                        41100000
368100                           DELIMITED BY SIZE                      41110000
368200                             INTO DP013-MESSAGE-TEXT (2)          41120000
368300              MOVE SQLCA       TO DP013-SQLCA                     41130000
368400              SET DP013-DB2-ABEND                                 41140000
368500                               TO TRUE                            41150000
368600              PERFORM DP013-0000-PROCESS-ABEND                    41160000
368700     END-EVALUATE.                                                41170000
368800                                                                  41180000
       8000-CHECK-PO-EXCEPTION.                                         41190000
                                                                        41200000
           INITIALIZE DCLSUT00014.                                      41210000
           MOVE ASC-PO-NBR      TO SUT00014-PO-NBR.                     41220000
           MOVE ASC-OPER-UNIT-ID TO SUT00014-OPER-UNT-ID.               41230000
                                                                        41240000
           EXEC SQL                                                     41250000
               SELECT DISTINCT                                          41260040
                      AUD_TYP_CDE                                       41261040
               INTO   :SUT00014-AUD-TYP-CDE                             41270000
               FROM  SUT_PO_AUD_EXC                                     41280000
               WHERE PO_NBR      = :SUT00014-PO-NBR                     41290000
               AND   OPER_UNT_ID = :SUT00014-OPER-UNT-ID                41300000
               AND   AUD_TYP_CDE = 'R'                                  41310000
           END-EXEC.                                                    41320000
                                                                        41330000
372300     EVALUATE SQLCODE                                             41340000
372400         WHEN 0                                                   41350000
                   SET PS-RFID-PO-EXCEPTION    TO TRUE                  41360000
372400         WHEN 100                                                 41370000
372500             SET PS-NO-RFID-PO-EXCEPTION TO TRUE                  41380000
372700         WHEN OTHER                                               41390000
373000             MOVE '8000-CHECK-PO-EXCEPTION'                       41400000
373100                             TO DP013-PARAGRAPH                   41410000
373200             MOVE 'SELECT AUDIT EXCEPTION'                        41420000
373300                             TO DP013-MESSAGE-TEXT (1)            41430000
373400             MOVE SQLCA      TO DP013-SQLCA                       41440000
373500             MOVE 'SUT00014' TO DP013-DB2-TABLE-NAME (1)          41450000
373600             MOVE 'SUT_PO_AUD_EXC' TO DP013-DB2-TABLE-NAME (2)    41460000
373700             SET DP013-DB2-ABEND                                  41470000
373800                             TO TRUE                              41480000
373900             SET DP013-XCTL-DISPLAY-RESTART                       41490000
374000                             TO TRUE                              41500000
374100             PERFORM DP013-0000-PROCESS-ABEND                     41510000
374200     END-EVALUATE.                                                41520000
368900                                                                  41530000
369000*----------------------------------------------------------------*41540000
369100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *41550000
369200*----------------------------------------------------------------*41560000
369300                                                                  41570000
369400 9100-READ-SEL-QUEUE.                                             41580000
369500     EXEC CICS                                                    41590000
369600         READQ TS                                                 41600000
369700             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        41610000
369800             INTO  (SU028-SELECT-RECORD)                          41620000
369900             ITEM  (ASC-SEL-ITEM)                                 41630000
370000             RESP  (PV-CICS-RESPONSE)                             41640000
370100     END-EXEC.                                                    41650000
370200                                                                  41660000
370300     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   41670000
370400         CONTINUE                                                 41680000
370500     ELSE                                                         41690000
370600         SET DP013-LOGIC-ABEND                                    41700000
370700             DP013-NO-ROLLBACK     TO TRUE                        41710000
370800         MOVE '9100-READ-SEL-QUEUE'                               41720000
370900                                   TO DP013-PARAGRAPH             41730000
371000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   41740000
371100                                   TO DP013-MESSAGE-TEXT (1)      41750000
371200         PERFORM DP013-0000-PROCESS-ABEND                         41760000
371300     END-IF.                                                      41770000
371400*----------------------------------------------------------------*41780000
371500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *41790000
371600*----------------------------------------------------------------*41800000
371700 9200-REWRITE-SEL-QUEUE.                                          41810000
371800     EXEC CICS                                                    41820000
371900          WRITEQ TS                                               41830000
372000              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      41840000
372100              FROM   (SU028-SELECT-RECORD)                        41850000
372200              ITEM   (ASC-SEL-ITEM)                               41860000
372300              RESP   (PV-CICS-RESPONSE)                           41870000
372400              REWRITE                                             41880000
372500     END-EXEC.                                                    41890000
372600                                                                  41900000
372700     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               41910000
372800         SET DP013-CICS-ABEND                                     41920000
372900             DP013-NO-ROLLBACK     TO TRUE                        41930000
373000         MOVE '9200-REWRITE-SEL-QUEUE'                            41940000
373100                                   TO DP013-PARAGRAPH             41950000
373200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   41960000
373300                                   TO DP013-MESSAGE-TEXT (1)      41970000
373400         PERFORM DP013-0000-PROCESS-ABEND                         41980000
373500     END-IF.                                                      41990000
373600                                                                  42000000
373700*----------------------------------------------------------------*42010000
373800*    ABEND PROCESSOR MODULE                                      *42020000
373900*----------------------------------------------------------------*42030000
374000                                                                  42040000
374100     COPY DPPD013.                                                42050000
