000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - UPDATE TRAILER LOCATION'.                   00020000
000210                                                                  00021000
000300 PROGRAM-ID.             PCKRF899.                                00030000
000400 AUTHOR.                 DENNIS STEFFEN.                          00040000
000500 INSTALLATION.           KOHLS.                                   00050000
000600 DATE-WRITTEN.           MAY, 2001.                               00060000
000700 DATE-COMPILED.                                                   00070000
001100 ENVIRONMENT DIVISION.                                            00110000
001200 DATA DIVISION.                                                   00120000
001300                                                                  00130000
001400 WORKING-STORAGE SECTION.                                         00140000
001500                                                                  00150000
001600 01  PC-PROGRAM-CONSTANTS.                                        00160000
001700     05  PC-TRANID                    PIC X(04) VALUE 'E899'.     00170000
001800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF899'. 00180000
001900     05  PC-DUMMY-TIMESTAMP           PIC X(26) VALUE             00190000
002000            '9999-09-09-09.09.09.999999'.                         00200000
002100     05  PC-LOW-TIMESTAMP             PIC X(26) VALUE             00210000
002200            '0001-01-01-00.00.00.000000'.                         00220000
002300                                                                  00230000
002400                                                                  00240000
002500* ERROR MESSAGES                                                 *00250000
002600     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00260000
002700                                           'UNRECOGNIZED PF KEY'. 00270000
002800     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00280000
002900                                           'ENTER THROUGH MENU '. 00290000
003000     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00300000
003100                                           'TRANS NOT AVAILABLE'. 00310000
003200     05  PC-WRONG-FACILITY            PIC X(19) VALUE             00320000
003300                                           'WRG FCLTY - F2 CONF'. 00330000
003400                                                                  00340000
003500 01  PS-PROGRAM-SWITCHES.                                         00350000
003600     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00360000
003700         88  PS-ERRORS-YES                        VALUE 'Y'.      00370000
003800         88  PS-ERRORS-NO                         VALUE 'N'.      00380000
003900     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00390000
004000         88  PS-XCTL-E871                       VALUE 'E871'.     00400000
004100         88  PS-XCTL-E873                       VALUE 'E873'.     00410000
004200         88  PS-XCTL-E877                       VALUE 'E877'.     00420000
004300     05  PS-VALID-INPUT-SW            PIC X(01) VALUE 'N'.        00430000
004400         88  PS-VALID-INPUT                       VALUE 'Y'.      00440000
004500         88  PS-INVALID-INPUT                     VALUE 'N'.      00450000
004600     05  PS-TRLR-OPEN-SW              PIC X(04) VALUE SPACES.     00460000
004700         88  PS-TRLR-OPEN-THIS-DOOR             VALUE 'THIS'.     00470000
004800         88  PS-TRLR-OPEN-DIFF-DOOR             VALUE 'DIFF'.     00480000
004900     05  PC-STORE-DOOR-CSR-SW         PIC X(01) VALUE 'N'.        00490000
005000         88  PS-END-STORE-DOOR-CSR              VALUE 'Y'.        00500000
005100         88  PS-NOT-END-STORE-DOOR-CSR          VALUE 'N'.        00510000
005200     05  PS-DOOR-DEST-EDIT-SW         PIC X(01) VALUE 'Y'.        00520000
005300         88  PS-SKIP-DOOR-DEST-EDITS            VALUE 'N'.        00530000
005400         88  PS-DO-DOOR-DEST-EDITS              VALUE 'Y'.        00540000
005500     05  PS-DIVERT-DOOR-SW            PIC X(01) VALUE 'Y'.        00550000
005600         88  PS-DIVERT-DOOR-YES                 VALUE 'Y'.        00560000
005700         88  PS-DIVERT-DOOR-NO                  VALUE 'N'.        00570000
005800     05  PS-SERIAL-SW                 PIC X(01) VALUE 'N'.        00580000
005900         88  PS-SERIAL-NO                       VALUE 'N'.        00590000
006000         88  PS-SERIAL-YES                      VALUE 'Y'.        00600000
006100     05  PS-ACTIVE-TRIP-SW            PIC X(01) VALUE 'N'.        00610000
006200         88  PS-ACTIVE-TRIP-EXISTS              VALUE 'Y'.        00620000
006300         88  PS-NO-ACTIVE-TRIP-EXISTS           VALUE 'N'.        00630000
006400                                                                  00640000
006500 01  PV-PROGRAM-VARIABLES.                                        00650000
006600     05  PV-DOOR-COUNT                PIC S9(03) COMP-3.          00660000
006700     05  PV-DB2-COUNT                 PIC S9(03) COMP-3.          00670000
006800     05  PV-TRIP-STAT-DESC            PIC X(10)  VALUE SPACES.    00680000
006900     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00690000
007000                                                     COMP SYNC.   00700000
007100     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00710000
007200     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00720000
007300                                                     COMP SYNC.   00730000
007400     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00740000
007500                                                                  00750000
007600 01  PV-LOG-MSG.                                                  00760000
007700     05  FILLER                       PIC X(12) VALUE             00770000
007800         ' E899 ERROR '.                                          00780000
007900     05  FILLER                       PIC X(06) VALUE             00790000
008000         'USER= '.                                                00800000
008100     05  PV-USER-ID                   PIC X(08) VALUE SPACES.     00810000
008200     05  FILLER                       PIC X(10) VALUE             00820000
008300         ' SQLCODE= '.                                            00830000
008400     05  PV-SQLCODE                   PIC -9(03).                 00840000
008500     05  FILLER                       PIC X(06) VALUE             00850000
008600         ' ERR= '.                                                00860000
008700     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       00870000
008800     05  FILLER                       PIC X(07) VALUE             00880000
008900         ' DOOR= '.                                               00890000
009000     05  PV-DISPLAY-DOOR              PIC X(04) VALUE ZEROES.     00900000
009100/                                                                 00910000
009200 01  PV-EDITING-FIELDS.                                           00920000
009300     05  PV-SCREEN-SERIAL-NBR         PIC X(09).                  00930000
009400                                                                  00940000
009500/                                                                 00950000
009600 01  CA-COMMAREA.                                                 00960000
009700     COPY PCWS233.                                                00970000
009800     05  CA-PRIVATE-COMMAREA          PIC X(100).                 00980000
009900     05  CA-REDEFINED-COMMAREA REDEFINES CA-PRIVATE-COMMAREA.     00990000
010000         10  CA-CURR-DOOR             PIC X(04).                  01000000
010100         10  CA-CURR-SERIAL-NBR       PIC 9(09).                  01010000
010200/                                                                 01020000
010300*  MAP LAYOUT                                                     01030000
010400     COPY PCKM899.                                                01040000
010500                                                                  01050000
010600* HELP SCREEN COMMAREA                                            01060000
010700     COPY PCWS192.                                                01070000
010800* HELP SCREEN WORK AREA                                           01080000
010900     COPY PCWS188.                                                01090000
011000/                                                                 01100000
011100     COPY DPWS010I.                                               01110000
011200*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01120000
011300     COPY DPWS015.                                                01130000
011400                                                                  01140000
011500*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01150000
011600     COPY DFHAID.                                                 01160000
011700                                                                  01170000
011800*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01180000
011900     COPY DPWS013.                                                01190000
012000/                                                                 01200000
012100*    TRAILER ID MASTER                                            01210000
012200     EXEC SQL                                                     01220000
012300         INCLUDE TCNTRID                                          01230000
012400     END-EXEC.                                                    01240000
012500                                                                  01250000
012600*    FACILTY AREA MASTER                                          01260000
012700     EXEC SQL                                                     01270000
012800         INCLUDE TFLAREA                                          01280000
012900     END-EXEC.                                                    01290000
013000                                                                  01300000
013100*    OUTBOUND TRAILER TRIP                                        01310000
013200     EXEC SQL                                                     01320000
013300         INCLUDE TSUOBTR                                          01330000
013400     END-EXEC.                                                    01340000
013500                                                                  01350000
013600*    OUTBOUND TRAILER TRIP STATUS                                 01360000
013700     EXEC SQL                                                     01370000
013800         INCLUDE TSUOBTS                                          01380000
013900     END-EXEC.                                                    01390000
014000                                                                  01400000
014100*    OUTBOUND TRAILER TRIP STATUS CODES                           01410000
014200     EXEC SQL                                                     01420000
014300         INCLUDE TSUOBSC                                          01430000
014400     END-EXEC.                                                    01440000
014500                                                                  01450000
014600/                                                                 01460000
014700     EXEC SQL                                                     01470000
014800         INCLUDE SQLCA                                            01480000
014900     END-EXEC.                                                    01490000
015000                                                                  01500000
015100 LINKAGE SECTION.                                                 01510000
015200 01  DFHCOMMAREA.                                                 01520000
015300     05  FILLER                         OCCURS  1 TO 4072 TIMES   01530000
015400                                      DEPENDING ON EIBCALEN.      01540000
015500         10  FILLER                   PIC X.                      01550000
015600/                                                                 01560000
015700 PROCEDURE DIVISION.                                              01570000
015800 0000-PROGRAM-MAINLINE.                                           01580000
015900                                                                  01590000
016000     INITIALIZE CA-COMMAREA                                       01600000
016100     MOVE DFHCOMMAREA                 TO CA-COMMAREA              01610000
016200                                                                  01620000
016300     EVALUATE TRUE                                                01630000
016400         WHEN EIBCALEN = ZERO                                     01640000
016500             MOVE PC-ENTER-THROUGH-MENU-MSG                       01650000
016600                                      TO PV-MESSAGE-AREA          01660000
016700             PERFORM 8110-RETURN                                  01670000
016800                                                                  01680000
016900         WHEN EIBTRNID = 'Z278'                                   01690000
017000*            RETURNING FROM F1 HELP INFO SCREEN                   01700000
017100             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01710000
017200             MOVE PC192-HOST-SAVE-AREA                            01720000
017300                                      TO CA-COMMAREA              01730000
017400             SET PC233-PROCESS-SCREEN TO TRUE                     01740000
017500             MOVE PC192-HOST-SAVE-MAP TO PC899AO                  01750000
017600             PERFORM 8000-SEND-MAP                                01760000
017700             PERFORM 8100-RETURN-TRANID                           01770000
017800                                                                  01780000
017900         WHEN PC233-INITIALIZE-SCREEN                             01790000
018000         WHEN EIBAID = DFHCLEAR                                   01800000
018100             SET PC233-PROCESS-SCREEN TO TRUE                     01810000
018200             PERFORM 1000-INITIALIZE                              01820000
018300             PERFORM 8000-SEND-MAP                                01830000
018400             PERFORM 8100-RETURN-TRANID                           01840000
018500                                                                  01850000
018600         WHEN EIBAID = DFHPF3                                     01860000
018700             MOVE PC233-ROOT-PROGRAM  TO PV-TRANSFER-PROGRAM      01870000
018800             PERFORM 8200-XCTL                                    01880000
018900                                                                  01890000
019000         WHEN EIBAID = DFHPF4                                     01900000
019100*            EDIT AND UPDATE IF GOOD                              01910000
019200             PERFORM 8020-RECEIVE-MAP                             01920000
019300             PERFORM 2100-EDIT-INPUT                              01930000
019400             IF PS-ERRORS-NO                                      01940000
019500                 PERFORM 3000-UPDATE-LOCATION                     01950000
019600                 IF PS-ERRORS-NO                                  01960000
019700                     MOVE 'LOCATION UPDATED'                      01970000
019800                                      TO PC233-RETURN-MSG         01980000
019900                     MOVE 'PCKRF898'  TO PV-TRANSFER-PROGRAM      01990000
020000                     SET PC233-PROCESS-SCREEN                     02000000
020100                                      TO TRUE                     02010000
020200                     PERFORM 8200-XCTL                            02020000
020300                 ELSE                                             02030000
020400                     PERFORM 8010-SEND-DATA-ONLY                  02040000
020500                     PERFORM 8100-RETURN-TRANID                   02050000
020600                 END-IF                                           02060000
020700             ELSE                                                 02070000
020800                 IF PS-XCTL-E871                                  02080000
020900                     PERFORM 8210-XCTL-ERROR-SCREEN               02090000
021000                 ELSE                                             02100000
021100                     PERFORM 8010-SEND-DATA-ONLY                  02110000
021200                     PERFORM 8100-RETURN-TRANID                   02120000
021300                 END-IF                                           02130000
021400             END-IF                                               02140000
021500                                                                  02150000
021600         WHEN EIBAID = DFHPF9                                     02160001
021700             MOVE 'PCKRF743'          TO PV-TRANSFER-PROGRAM      02170000
021800             SET PC233-PROCESS-SCREEN TO TRUE                     02180000
021900             PERFORM 8200-XCTL                                    02190000
022000                                                                  02200000
022100         WHEN EIBAID = DFHPF6                                     02210000
022200             MOVE 'PCKRF744'          TO PV-TRANSFER-PROGRAM      02220000
022300             SET PC233-PROCESS-SCREEN TO TRUE                     02230000
022400             PERFORM 8200-XCTL                                    02240000
022500                                                                  02250000
022600         WHEN EIBAID = DFHENTER                                   02260000
022700*            EDIT ONLY                                            02270000
022800             PERFORM 8020-RECEIVE-MAP                             02280000
022900             PERFORM 2100-EDIT-INPUT                              02290000
023000             IF PS-ERRORS-NO                                      02300000
023100                 PERFORM 2205-GET-TRAILER-INFO                    02310000
023200             END-IF                                               02320000
023300                                                                  02330000
023400             IF PS-ERRORS-YES                                     02340000
023500                 IF PS-XCTL-E871                                  02350000
023600                     PERFORM 8210-XCTL-ERROR-SCREEN               02360000
023700                 ELSE                                             02370000
023800                     PERFORM 8010-SEND-DATA-ONLY                  02380000
023900                     PERFORM 8100-RETURN-TRANID                   02390000
024000                 END-IF                                           02400000
024100             ELSE                                                 02410000
024200                 PERFORM 8010-SEND-DATA-ONLY                      02420000
024300                 PERFORM 8100-RETURN-TRANID                       02430000
024400             END-IF                                               02440000
024500                                                                  02450000
024600         WHEN EIBAID = DFHPF1                                     02460000
024700             PERFORM 8020-RECEIVE-MAP                             02470000
024800             MOVE PC899AO             TO PC192-HOST-SAVE-MAP      02480000
024900             PERFORM 1200-HELP-SCREEN                             02490000
025000                                                                  02500000
025100         WHEN OTHER                                               02510000
025200             PERFORM 8020-RECEIVE-MAP                             02520000
025300             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      02530000
025400                                      TO AMSGLNO                  02540000
025500             PERFORM 8000-SEND-MAP                                02550000
025600             PERFORM 8100-RETURN-TRANID                           02560000
025700     END-EVALUATE.                                                02570000
025800                                                                  02580000
025900     GOBACK.                                                      02590000
026000                                                                  02600000
026100 1000-INITIALIZE.                                                 02610000
026200                                                                  02620000
026300     INITIALIZE CA-REDEFINED-COMMAREA                             02630000
026400                PC233-ERROR-FIELDS                                02640000
026500     MOVE PC233-MENU-PROGRAM          TO PV-TRANSFER-PROGRAM      02650000
026600                                                                  02660000
026700     MOVE PC-TRANID                   TO PC233-TRAN-ID            02670000
026800                                                                  02680000
026900     MOVE PC233-USER-ID               TO PV-USER-ID.              02690000
027000                                                                  02700000
027100     MOVE PC233-SERIAL-NBR            TO ASERIALO.                02710000
027200     MOVE PC233-TRAILER-STATUS        TO ASTATUSO.                02720000
027300     MOVE PC233-TRLR-PRKG-SLOT-NBR    TO ASLOTO                   02730000
027400     MOVE PC233-TRLR-PRKG-LOC-DESC    TO ALOCO.                   02740000
027500                                                                  02750000
027600 1200-HELP-SCREEN.                                                02760000
027700     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02770000
027800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       02780000
027900     COPY PCPD188.                                                02790000
028000     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02800000
028100     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02810000
028200     PERFORM 8220-XCTL-TO-HELP.                                   02820000
028300                                                                  02830000
028400/                                                                 02840000
028500 2100-EDIT-INPUT.                                                 02850000
028600                                                                  02860000
028700     SET PS-ERRORS-NO                 TO TRUE.                    02870000
028800     MOVE SPACES                      TO AMSGLNO                  02880000
028900     IF ALOCA = DP015-ERASE-EOF                                   02890000
029000         MOVE SPACES                  TO PC233-TRLR-PRKG-LOC-DESC 02900000
029100     ELSE                                                         02910000
029200         MOVE ALOCI                   TO PC233-TRLR-PRKG-LOC-DESC 02920000
029300     END-IF                                                       02930000
029400                                                                  02940000
029500     IF ASLOTA = DP015-ERASE-EOF                                  02950000
029600         MOVE SPACES                  TO PC233-TRLR-PRKG-SLOT-NBR 02960000
029700     ELSE                                                         02970000
029800         MOVE ASLOTI                  TO PC233-TRLR-PRKG-SLOT-NBR 02980000
029900     END-IF                                                       02990000
030000                                                                  03000000
030100     INSPECT PC233-TRLR-PRKG-LOC-DESC REPLACING ALL               03010000
030200         LOW-VALUES BY SPACES                                     03020000
030300     INSPECT PC233-TRLR-PRKG-SLOT-NBR REPLACING ALL               03030000
030400         LOW-VALUES BY SPACES                                     03040000
030500                                                                  03050000
030600     IF PC233-TRLR-PRKG-LOC-DESC = SPACES                         03060000
030700        AND PC233-TRLR-PRKG-SLOT-NBR = SPACES                     03070000
030800         SET PS-ERRORS-YES            TO TRUE                     03080000
030900         MOVE 'SLOT OR DESC REQD'     TO AMSGLNO                  03090000
031000     END-IF.                                                      03100000
031100                                                                  03110000
031200                                                                  03120000
031300 2205-GET-TRAILER-INFO.                                           03130000
031400     PERFORM 7000-SELECT-TRAILER-INFO.                            03140000
031500     IF PS-ACTIVE-TRIP-EXISTS                                     03150000
031600         MOVE SUOBSC-STAT-SHRT-DESC   TO ASTATUSO                 03160000
031700                                         PC233-ERROR-TRLR-STATUS  03170000
031800         MOVE SUOBTS-TRLR-PRKG-LOC-DESC                           03180000
031900                                      TO ALOCO                    03190000
032000                                         PC233-TRLR-PRKG-LOC-DESC 03200000
032100     ELSE                                                         03210000
032200         MOVE 'INVALID SER NBR    '   TO AMSGLNO                  03220000
032300         MOVE SPACES                  TO PC233-TRAILER            03230000
032400                                         ASTATUSO                 03240000
032500     END-IF.                                                      03250000
032600                                                                  03260000
032700     PERFORM 7010-SELECT-TFLAREA.                                 03270000
032800     IF SQLCODE = +100                                            03280000
032900         SET PS-ERRORS-YES            TO TRUE                     03290000
033000         MOVE 'INVALID SLOT NBR'      TO AMSGLNO                  03300000
033100     ELSE                                                         03310000
033200         MOVE FLAREA-FCLTY-AREA-DESC  TO ALOCO                    03320000
033300     END-IF.                                                      03330000
033400/                                                                 03340000
033500 3000-UPDATE-LOCATION.                                            03350000
033600     PERFORM 7100-SELECT-TSUOBTS                                  03360000
033700     IF PS-ERRORS-NO                                              03370000
033800         MOVE PC233-TRLR-PRKG-LOC-DESC                            03380000
033900                                      TO SUOBTS-TRLR-PRKG-LOC-DESC03390000
033910                                         PC233-TRLR-PRKG-LOC-DESC 03391000
034000         MOVE PC233-TRLR-PRKG-SLOT-NBR                            03400000
034100                                      TO SUOBTS-TRLR-PRKG-SLOT-NBR03410000
034110                                         PC233-TRLR-PRKG-SLOT-NBR 03411000
034200         PERFORM 7110-INSERT-TSUOBTS                              03420000
034300     END-IF.                                                      03430000
034400                                                                  03440000
034500 7000-SELECT-TRAILER-INFO.                                        03450000
034600                                                                  03460000
034700     INITIALIZE SUOBTS-OTBND-TRIP-ID                              03470000
034800                CNTRID-TRLR-ID                                    03480000
034900                SUOBTS-TRIP-STAT-CDE                              03490000
035000                SUOBTS-TRLR-PRKG-LOC-DESC                         03500000
035100                SUOBSC-STAT-SHRT-DESC                             03510000
035200                                                                  03520000
035300     EXEC SQL                                                     03530000
035400       SELECT                                                     03540000
035500           OBTS.OTBND_TRIP_ID                                     03550000
035600       ,   TRID.TRLR_ID                                           03560000
035700       ,   OBTS.TRIP_STAT_CDE                                     03570000
035800       ,   OBTS.TRLR_PRKG_LOC_DESC                                03580000
035810       ,   OBSC.STAT_SHRT_DESC                                    03581000
036700       INTO                                                       03670000
036800           :SUOBTS-OTBND-TRIP-ID                                  03680000
036900       ,   :CNTRID-TRLR-ID                                        03690000
037000       ,   :SUOBTS-TRIP-STAT-CDE                                  03700000
037100       ,   :SUOBTS-TRLR-PRKG-LOC-DESC                             03710000
037200       ,   :SUOBSC-STAT-SHRT-DESC                                 03720000
037300       FROM TSUOBTS OBTS                                          03730000
037400       ,    TSUOBTR OBTR                                          03740000
037500       ,    TCNTRID TRID                                          03750000
037600       ,    TSUOBSC OBSC                                          03760000
037700       WHERE                                                      03770000
037800           OBTR.ORGN_OPER_UNT_ID    = :PC233-OPER-UNT-ID          03780000
037900       AND OBTR.TRLR_SRL_NBR        = :PC233-SERIAL-NBR           03790000
038000       AND OBTR.TRIP_ACTV_CDE       = 'A'                         03800000
038100       AND OBTR.TRLR_SRL_NBR        = TRID.TRLR_SRL_NBR           03810000
038200       AND OBTS.OTBND_TRIP_ID       = OBTR.OTBND_TRIP_ID          03820000
038300       AND OBSC.TRIP_STAT_CDE       = OBTS.TRIP_STAT_CDE          03830000
038400                                                                  03840000
038500       AND OBTS.OTBND_STAT_TMST =                                 03850000
038600           (SELECT MAX(OBTS1.OTBND_STAT_TMST)                     03860000
038700               FROM TSUOBTS OBTS1                                 03870000
038800               WHERE                                              03880000
038900               OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)          03890000
039000                                                                  03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300     EVALUATE TRUE                                                03930000
039400         WHEN SQLCODE = ZERO                                      03940000
039500             SET PS-ACTIVE-TRIP-EXISTS                            03950000
039600                                      TO TRUE                     03960000
039700         WHEN SQLCODE = +100                                      03970000
039800             SET PS-ERRORS-YES                                    03980000
039900                 PS-NO-ACTIVE-TRIP-EXISTS                         03990000
040000                                      TO TRUE                     04000000
040100         WHEN SQLCODE = -904                                      04010000
040200         WHEN SQLCODE = -913                                      04020000
040300         WHEN SQLCODE = -911                                      04030000
040400             MOVE 1                   TO PV-ERROR-NBR             04040000
040500             PERFORM 9903-WRITE-CICS-LOG                          04050000
040600             PERFORM 9000-SOFT-ABORT                              04060000
040700         WHEN SQLWARN0 NOT = SPACES                               04070000
040800         WHEN SQLCODE NOT EQUAL ZERO                              04080000
040900             MOVE 2                   TO PV-ERROR-NBR             04090000
041000                                         PC233-ERROR-NBR          04100000
041100             PERFORM 9903-WRITE-CICS-LOG                          04110000
041200             MOVE '7000-SELECT-TRAILER-INFO'                      04120000
041300                                      TO PC233-PARAGRAPH          04130000
041400             MOVE 'PCKRF899 - CHECK TRLR AT ANOTHER DOOR'         04140000
041500                                      TO PC233-MESSAGE-TEXT(1)    04150000
041600             MOVE SQLCA               TO PC233-SQLCA              04160000
041700             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  04170000
041800             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  04180000
041900             SET PC233-ABEND          TO TRUE                     04190000
042000             MOVE 99                  TO PC233-PGM-MSG-NBR        04200000
042100             PERFORM 8210-XCTL-ERROR-SCREEN                       04210000
042200     END-EVALUATE.                                                04220000
042300/                                                                 04230000
042400 7010-SELECT-TFLAREA.                                             04240000
042500                                                                  04250000
042600     EXEC SQL                                                     04260000
042700         SELECT FCLTY_AREA_DESC                                   04270000
042800         INTO :FLAREA-FCLTY-AREA-DESC                             04280000
042900         FROM TFLAREA                                             04290000
043000         WHERE                                                    04300000
043100             OPER_UNT_ID              = :PC233-OPER-UNT-ID        04310000
043200         AND FCLTY_ID                 = 1                         04320000
043300         AND FCLTY_LOC_TYP_CDE        = 'PS'                      04330000
043400         AND STRIP(FCLTY_AREA_ID)                                 04340000
043500                       = STRIP(:PC233-TRLR-PRKG-SLOT-NBR)         04350000
043600     END-EXEC.                                                    04360000
043700                                                                  04370000
043800     EVALUATE TRUE                                                04380000
043900         WHEN SQLCODE = ZERO                                      04390000
044000         WHEN SQLCODE = +100                                      04400000
044100         WHEN SQLCODE = -811                                      04410000
044200             CONTINUE                                             04420000
044300         WHEN SQLCODE = -904                                      04430000
044400         WHEN SQLCODE = -913                                      04440000
044500         WHEN SQLCODE = -911                                      04450000
044600             MOVE 3                   TO PV-ERROR-NBR             04460000
044700             PERFORM 9903-WRITE-CICS-LOG                          04470000
044800             PERFORM 9000-SOFT-ABORT                              04480000
044900         WHEN SQLWARN0 NOT = SPACES                               04490000
045000         WHEN SQLCODE NOT EQUAL ZERO                              04500000
045100             MOVE 4                   TO PV-ERROR-NBR             04510000
045200                                         PC233-ERROR-NBR          04520000
045300             PERFORM 9903-WRITE-CICS-LOG                          04530000
045400             MOVE '7010-SELECT-TFLAREA'                           04540000
045500                                      TO PC233-PARAGRAPH          04550000
045600             MOVE 'PCKRF899 - VALIDATE PARKING SLOT'              04560000
045700                                      TO PC233-MESSAGE-TEXT(1)    04570000
045800             MOVE SQLCA               TO PC233-SQLCA              04580000
045900             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  04590000
046000             SET PC233-ABEND          TO TRUE                     04600000
046100             MOVE 99                  TO PC233-PGM-MSG-NBR        04610000
046200             PERFORM 8210-XCTL-ERROR-SCREEN                       04620000
046300     END-EVALUATE.                                                04630000
046400                                                                  04640000
046500 7100-SELECT-TSUOBTS.                                             04650000
046600                                                                  04660000
046700     EXEC SQL                                                     04670000
046800         SELECT                                                   04680000
046900             OTBND_TRIP_ID                                        04690000
047000         ,   TRIP_STAT_CDE                                        04700000
047100         ,   DOOR_ID                                              04710000
047200         ,   TRLR_SEAL_ID                                         04720000
047300         ,   SHIP_SCAC_CDE                                        04730000
047400         ,   SHIP_DRV_LAST_NM                                     04740000
047500         ,   SHIP_DRV_FRST_NM                                     04750000
047600         ,   SHIP_DRV_ID                                          04760000
047700         ,   TRLR_PRKG_LOC_DESC                                   04770000
047800         ,   TRLR_PRKG_SLOT_NBR                                   04780000
047900         ,   FINCL_POST_TMST                                      04790000
048000                                                                  04800000
048100         INTO                                                     04810000
048200                                                                  04820000
048300           :SUOBTS-OTBND-TRIP-ID                                  04830000
048400         , :SUOBTS-TRIP-STAT-CDE                                  04840000
048500         , :SUOBTS-DOOR-ID                                        04850000
048600         , :SUOBTS-TRLR-SEAL-ID                                   04860000
048700         , :SUOBTS-SHIP-SCAC-CDE                                  04870000
048800         , :SUOBTS-SHIP-DRV-LAST-NM                               04880000
048900         , :SUOBTS-SHIP-DRV-FRST-NM                               04890000
049000         , :SUOBTS-SHIP-DRV-ID                                    04900000
049100         , :SUOBTS-TRLR-PRKG-LOC-DESC                             04910000
049200         , :SUOBTS-TRLR-PRKG-SLOT-NBR                             04920000
049300         , :SUOBTS-FINCL-POST-TMST                                04930000
049400                                                                  04940000
049500     FROM TSUOBTS OBTS                                            04950000
049600                                                                  04960000
049700         WHERE OTBND_TRIP_ID          = :PC233-TRIP-ID            04970000
049800         AND OTBND_STAT_TMST          =                           04980000
049900         (                                                        04990000
050000          SELECT                                                  05000000
050100            MAX(OBTS1.OTBND_STAT_TMST)                            05010000
050200            FROM TSUOBTS OBTS1                                    05020000
050300            WHERE OBTS.OTBND_TRIP_ID = OBTS1.OTBND_TRIP_ID        05030000
050400         )                                                        05040000
050500     END-EXEC.                                                    05050000
050600                                                                  05060000
050700                                                                  05070000
050800     EVALUATE TRUE                                                05080000
050900         WHEN SQLCODE = ZERO                                      05090000
051000             CONTINUE                                             05100000
051100         WHEN SQLCODE = +100                                      05110000
051200             SET PS-ERRORS-YES        TO TRUE                     05120000
051300             MOVE 'TRLR NOT FOUND'    TO AMSGLNO                  05130000
051400         WHEN SQLCODE = -904                                      05140000
051500         WHEN SQLCODE = -913                                      05150000
051600         WHEN SQLCODE = -911                                      05160000
051700             MOVE 3                   TO PV-ERROR-NBR             05170000
051800             PERFORM 9903-WRITE-CICS-LOG                          05180000
051900             PERFORM 9000-SOFT-ABORT                              05190000
052000         WHEN SQLWARN0 NOT = SPACES                               05200000
052100         WHEN SQLCODE NOT EQUAL ZERO                              05210000
052200             MOVE 4                   TO PV-ERROR-NBR             05220000
052300                                         PC233-ERROR-NBR          05230000
052400             PERFORM 9903-WRITE-CICS-LOG                          05240000
052500             MOVE '7100-SELECT-TSUOBTS'                           05250000
052600                                      TO PC233-PARAGRAPH          05260000
052700             MOVE 'PCKRF899 - SELECT TRAILER TRIP'                05270000
052800                                      TO PC233-MESSAGE-TEXT(1)    05280000
052900             MOVE SQLCA               TO PC233-SQLCA              05290000
053000             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  05300000
053100             SET PC233-ABEND          TO TRUE                     05310000
053200             MOVE 99                  TO PC233-PGM-MSG-NBR        05320000
053300             PERFORM 8210-XCTL-ERROR-SCREEN                       05330000
053400     END-EVALUATE.                                                05340000
053500/                                                                 05350000
053600 7110-INSERT-TSUOBTS.                                             05360000
053700                                                                  05370000
053800     EXEC SQL                                                     05380000
053900         INSERT INTO TSUOBTS                                      05390000
054000         (                                                        05400000
054100             OTBND_TRIP_ID                                        05410000
054200         ,   OTBND_STAT_TMST                                      05420000
054300         ,   TRIP_STAT_CDE                                        05430000
054400         ,   STAT_OPER_UNT_ID                                     05440000
054500         ,   OTBND_STAT_USR_ID                                    05450000
054600         ,   DOOR_ID                                              05460000
054700         ,   TRLR_SEAL_ID                                         05470000
054800         ,   SHIP_SCAC_CDE                                        05480000
054900         ,   SHIP_DRV_LAST_NM                                     05490000
055000         ,   SHIP_DRV_FRST_NM                                     05500000
055100         ,   SHIP_DRV_ID                                          05510000
055200         ,   TRLR_PRKG_LOC_DESC                                   05520000
055300         ,   TRLR_PRKG_SLOT_NBR                                   05530000
055400         ,   FINCL_POST_TMST                                      05540000
055410         ,   CPCTY_PCT                                            05541000
055420         ,   UNUSD_PLLT_QTY                                       05542000
055430         ,   LOD_BR_QTY                                           05543000
055500         )                                                        05550000
055600                                                                  05560000
055700         VALUES                                                   05570000
055800         (                                                        05580000
055900           :SUOBTS-OTBND-TRIP-ID                                  05590000
056000         , CURRENT TIMESTAMP                                      05600000
056100         , :SUOBTS-TRIP-STAT-CDE                                  05610000
056200         , :PC233-OPER-UNT-ID                                     05620000
056300         , :PC233-USER-ID                                         05630000
056400         , :SUOBTS-DOOR-ID                                        05640000
056500         , :SUOBTS-TRLR-SEAL-ID                                   05650000
056600         , :SUOBTS-SHIP-SCAC-CDE                                  05660000
056700         , :SUOBTS-SHIP-DRV-LAST-NM                               05670000
056800         , :SUOBTS-SHIP-DRV-FRST-NM                               05680000
056900         , :SUOBTS-SHIP-DRV-ID                                    05690000
057000         , :SUOBTS-TRLR-PRKG-LOC-DESC                             05700000
057100         , :SUOBTS-TRLR-PRKG-SLOT-NBR                             05710000
057200         , :SUOBTS-FINCL-POST-TMST                                05720000
057210         , 0                                                      05721000
057220         , 0                                                      05722000
057230         , 0                                                      05723000
057300                                                                  05730000
057400         )                                                        05740000
057500     END-EXEC.                                                    05750000
057600                                                                  05760000
057700                                                                  05770000
057800     EVALUATE TRUE                                                05780000
057900         WHEN SQLCODE = ZERO                                      05790000
058000             CONTINUE                                             05800000
058100         WHEN SQLCODE = -904                                      05810000
058200         WHEN SQLCODE = -913                                      05820000
058300         WHEN SQLCODE = -911                                      05830000
058400             MOVE 3                   TO PV-ERROR-NBR             05840000
058500             PERFORM 9903-WRITE-CICS-LOG                          05850000
058600             PERFORM 9000-SOFT-ABORT                              05860000
058700         WHEN SQLWARN0 NOT = SPACES                               05870000
058800         WHEN SQLCODE NOT EQUAL ZERO                              05880000
058900             MOVE 4                   TO PV-ERROR-NBR             05890000
059000                                         PC233-ERROR-NBR          05900000
059100             PERFORM 9903-WRITE-CICS-LOG                          05910000
059200             MOVE '7105-INSERT-TSUOBTS'                           05920000
059300                                      TO PC233-PARAGRAPH          05930000
059400             MOVE 'PCKRF899 - SELECT TRAILER TRIP'                05940000
059500                                      TO PC233-MESSAGE-TEXT(1)    05950000
059600             MOVE SQLCA               TO PC233-SQLCA              05960000
059700             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  05970000
059800             SET PC233-ABEND          TO TRUE                     05980000
059900             MOVE 99                  TO PC233-PGM-MSG-NBR        05990000
060000             PERFORM 8210-XCTL-ERROR-SCREEN                       06000000
060100     END-EVALUATE.                                                06010000
060200     EXEC SQL                                                     06020000
060300         UPDATE TSUOBTS OBTS                                      06030000
060400         SET TRLR_PRKG_LOC_DESC       = :PC233-TRLR-PRKG-LOC-DESC 06040000
060500       ,     TRLR_PRKG_SLOT_NBR       = :PC233-TRLR-PRKG-SLOT-NBR 06050000
060600         WHERE OTBND_TRIP_ID          = :PC233-TRIP-ID            06060000
060700         AND OTBND_STAT_TMST          =                           06070000
060800         (                                                        06080000
060900          SELECT                                                  06090000
061000            MAX(OBTS1.OTBND_STAT_TMST)                            06100000
061100            FROM TSUOBTS OBTS1                                    06110000
061200            WHERE OBTS.OTBND_TRIP_ID = OBTS1.OTBND_TRIP_ID        06120000
061300         )                                                        06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600     EVALUATE TRUE                                                06160000
061700         WHEN SQLCODE = ZERO                                      06170000
061800         WHEN SQLCODE = +100                                      06180000
061900         WHEN SQLCODE = -811                                      06190000
062000             CONTINUE                                             06200000
062100         WHEN SQLCODE = -904                                      06210000
062200         WHEN SQLCODE = -913                                      06220000
062300         WHEN SQLCODE = -911                                      06230000
062400             MOVE 3                   TO PV-ERROR-NBR             06240000
062500             PERFORM 9903-WRITE-CICS-LOG                          06250000
062600             PERFORM 9000-SOFT-ABORT                              06260000
062700         WHEN SQLWARN0 NOT = SPACES                               06270000
062800         WHEN SQLCODE NOT EQUAL ZERO                              06280000
062900             MOVE 4                   TO PV-ERROR-NBR             06290000
063000                                         PC233-ERROR-NBR          06300000
063100             PERFORM 9903-WRITE-CICS-LOG                          06310000
063200             MOVE '7100-UPDATE-TSUOBTS'                           06320000
063300                                      TO PC233-PARAGRAPH          06330000
063400             MOVE 'PCKRF899 - UPDATE TRAILER TRIP'                06340000
063500                                      TO PC233-MESSAGE-TEXT(1)    06350000
063600             MOVE SQLCA               TO PC233-SQLCA              06360000
063700             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  06370000
063800             SET PC233-ABEND          TO TRUE                     06380000
063900             MOVE 99                  TO PC233-PGM-MSG-NBR        06390000
064000             PERFORM 8210-XCTL-ERROR-SCREEN                       06400000
064100     END-EVALUATE.                                                06410000
064200/                                                                 06420000
064300 8000-SEND-MAP.                                                   06430000
064400                                                                  06440000
064500     MOVE -1                          TO ASLOTL                   06450000
064600     EXEC CICS                                                    06460000
064700         SEND MAP       ('PC899A')                                06470000
064800              MAPSET    ('PCKM899')                               06480000
064900              ERASE                                               06490000
065000              CURSOR                                              06500000
065100              RESP      (PV-CICS-RESPONSE)                        06510000
065200     END-EXEC.                                                    06520000
065300                                                                  06530000
065400     EVALUATE TRUE                                                06540000
065500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06550000
065600             CONTINUE                                             06560000
065700         WHEN OTHER                                               06570000
065800             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          06580000
065900             MOVE 'PCKRF899 - UNABLE TO SEND MAP'                 06590000
066000                                      TO DP013-MESSAGE-TEXT (1)   06600000
066100             SET DP013-CICS-ABEND                                 06610000
066200                 DP013-ROLLBACK       TO TRUE                     06620000
066300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06630000
066400     END-EVALUATE.                                                06640000
066500                                                                  06650000
066600 8010-SEND-DATA-ONLY.                                             06660000
066700                                                                  06670000
066800     MOVE -1                          TO ASLOTL                   06680000
066900     EXEC CICS                                                    06690000
067000         SEND MAP       ('PC899A')                                06700000
067100              MAPSET    ('PCKM899')                               06710000
067200              CURSOR                                              06720000
067300              DATAONLY                                            06730000
067400              RESP      (PV-CICS-RESPONSE)                        06740000
067500     END-EXEC.                                                    06750000
067600                                                                  06760000
067700     EVALUATE TRUE                                                06770000
067800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06780000
067900             CONTINUE                                             06790000
068000         WHEN OTHER                                               06800000
068100             MOVE '8010-SEND-DATA-ONLY'                           06810000
068200                                      TO DP013-PARAGRAPH          06820000
068300             MOVE 'PCKRF899 - UNABLE TO SEND DATA'                06830000
068400                                      TO DP013-MESSAGE-TEXT (1)   06840000
068500             SET DP013-CICS-ABEND                                 06850000
068600                 DP013-ROLLBACK       TO TRUE                     06860000
068700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06870000
068800     END-EVALUATE.                                                06880000
068900                                                                  06890000
069000 8020-RECEIVE-MAP.                                                06900000
069100                                                                  06910000
069200     EXEC CICS                                                    06920000
069300         RECEIVE MAP    ('PC899A')                                06930000
069400                 MAPSET ('PCKM899')                               06940000
069500                 RESP   (PV-CICS-RESPONSE)                        06950000
069600     END-EXEC.                                                    06960000
069700                                                                  06970000
069800     EVALUATE TRUE                                                06980000
069900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06990000
070000             CONTINUE                                             07000000
070100         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                07010000
070200             CONTINUE                                             07020000
070300         WHEN OTHER                                               07030000
070400            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          07040000
070500            MOVE 'PCKRF899 - UNABLE TO RECEIVE MAP'               07050000
070600                                      TO DP013-MESSAGE-TEXT (1)   07060000
070700            SET DP013-LOGIC-ABEND     TO TRUE                     07070000
070800            SET DP013-ROLLBACK        TO TRUE                     07080000
070900            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                07090000
071000     END-EVALUATE.                                                07100000
071100                                                                  07110000
071200 8100-RETURN-TRANID.                                              07120000
071300                                                                  07130000
071400     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       07140000
071500     EXEC CICS                                                    07150000
071600         RETURN TRANSID  (PC-TRANID)                              07160000
071700                COMMAREA (CA-COMMAREA)                            07170000
071800                LENGTH   (PV-COMMAREA-LENGTH)                     07180000
071900                RESP     (PV-CICS-RESPONSE)                       07190000
072000     END-EXEC.                                                    07200000
072100                                                                  07210000
072200     EVALUATE TRUE                                                07220000
072300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07230000
072400             CONTINUE                                             07240000
072500         WHEN OTHER                                               07250000
072600             MOVE '8100-RETURN-TRANIND'                           07260000
072700                                      TO DP013-PARAGRAPH          07270000
072800             MOVE 'PCKRF899 - UNABLE TO RETURN TO TRANID'         07280000
072900                 TO DP013-MESSAGE-TEXT (1)                        07290000
073000             SET DP013-CICS-ABEND     TO TRUE                     07300000
073100             SET DP013-ROLLBACK       TO TRUE                     07310000
073200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07320000
073300     END-EVALUATE.                                                07330000
073400                                                                  07340000
073500 8110-RETURN.                                                     07350000
073600                                                                  07360000
073700     EXEC CICS                                                    07370000
073800         SEND FROM (PV-MESSAGE-AREA)                              07380000
073900              LENGTH (19)                                         07390000
074000              ERASE                                               07400000
074100     END-EXEC.                                                    07410000
074200                                                                  07420000
074300     EXEC CICS                                                    07430000
074400         RETURN                                                   07440000
074500     END-EXEC.                                                    07450000
074600                                                                  07460000
074700 8200-XCTL.                                                       07470000
074800     SET PC233-INITIALIZE-SCREEN      TO TRUE.                    07480000
074900     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      07490000
075000     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       07500000
075100                                                                  07510000
075200     EXEC CICS                                                    07520000
075300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    07530000
075400               COMMAREA  (CA-COMMAREA)                            07540000
075500               LENGTH    (PV-COMMAREA-LENGTH)                     07550000
075600               RESP      (PV-CICS-RESPONSE)                       07560000
075700     END-EXEC.                                                    07570000
075800                                                                  07580000
075900     EVALUATE TRUE                                                07590000
076000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07600000
076100             CONTINUE                                             07610000
076200         WHEN OTHER                                               07620000
076300             MOVE '8200-XCTL'                                     07630000
076400                                      TO DP013-PARAGRAPH          07640000
076500             MOVE 'PCKRF899 - UNABLE TO XCTL TO PROGRAM: '        07650000
076600                                      TO DP013-MESSAGE-TEXT (1)   07660000
076700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   07670000
076800             SET DP013-CICS-ABEND                                 07680000
076900                 DP013-ROLLBACK       TO TRUE                     07690000
077000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07700000
077100             MOVE PC-TRANS-UNAVAILABLE-MSG                        07710000
077200                                      TO AMSGLNO                  07720000
077300             SET PC233-PROCESS-SCREEN TO TRUE                     07730000
077400             PERFORM 8000-SEND-MAP                                07740000
077500             PERFORM 8100-RETURN-TRANID                           07750000
077600     END-EVALUATE.                                                07760000
077700                                                                  07770000
077800 8210-XCTL-ERROR-SCREEN.                                          07780000
077900     IF NOT PC233-ABEND                                           07790000
078000         SET PC233-INITIALIZE-SCREEN  TO TRUE                     07800000
078100     END-IF                                                       07810000
078200     IF PC233-PGM-MSG-NBR = ZERO                                  07820000
078300         MOVE 2                       TO PC233-PGM-MSG-NBR        07830000
078400     END-IF                                                       07840000
078500                                                                  07850000
078600     MOVE DFHEIBLK                    TO PC233-DFHEIBLK.          07860000
078700     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      07870000
078800     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       07880000
078900     MOVE 'PCKRF871'                  TO PV-TRANSFER-PROGRAM      07890000
079000                                                                  07900000
079100     EXEC CICS                                                    07910000
079200         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    07920000
079300               COMMAREA  (CA-COMMAREA)                            07930000
079400               LENGTH    (PV-COMMAREA-LENGTH)                     07940000
079500               RESP      (PV-CICS-RESPONSE)                       07950000
079600     END-EXEC.                                                    07960000
079700                                                                  07970000
079800     EVALUATE TRUE                                                07980000
079900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07990000
080000             CONTINUE                                             08000000
080100         WHEN OTHER                                               08010000
080200             MOVE '8200-XCTL'                                     08020000
080300                                      TO DP013-PARAGRAPH          08030000
080400             MOVE 'PCKRF899 - UNABLE TO XCTL TO PROGRAM: '        08040000
080500                                      TO DP013-MESSAGE-TEXT (1)   08050000
080600             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08060000
080700             SET DP013-CICS-ABEND                                 08070000
080800                 DP013-ROLLBACK       TO TRUE                     08080000
080900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08090000
081000             MOVE PC-TRANS-UNAVAILABLE-MSG                        08100000
081100                                      TO AMSGLNO                  08110000
081200             SET PC233-PROCESS-SCREEN TO TRUE                     08120000
081300             PERFORM 8000-SEND-MAP                                08130000
081400             PERFORM 8100-RETURN-TRANID                           08140000
081500     END-EVALUATE.                                                08150000
081600                                                                  08160000
081700*                                                                 08170000
081800 8220-XCTL-TO-HELP.                                               08180000
081900                                                                  08190000
082000     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       08200000
082100                                                                  08210000
082200     EXEC CICS                                                    08220000
082300         XCTL                                                     08230000
082400             PROGRAM   (PV-TRANSFER-PROGRAM)                      08240000
082500             COMMAREA  (PC192-COMMAREA)                           08250000
082600             LENGTH    (PV-COMMAREA-LENGTH)                       08260000
082700             RESP      (PV-CICS-RESPONSE)                         08270000
082800     END-EXEC.                                                    08280000
082900                                                                  08290000
083000     EVALUATE TRUE                                                08300000
083100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08310000
083200              CONTINUE                                            08320000
083300         WHEN OTHER                                               08330000
083400             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          08340000
083500             MOVE 'PCKRF899 - UNABLE TO XCTL TO PROGRAM: '        08350000
083600                                      TO DP013-MESSAGE-TEXT (1)   08360000
083700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08370000
083800             SET DP013-CICS-ABEND                                 08380000
083900                 DP013-ROLLBACK       TO TRUE                     08390000
084000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08400000
084100             MOVE PC-TRANS-UNAVAILABLE-MSG                        08410000
084200                                      TO AMSGLNO                  08420000
084300             SET PC233-PROCESS-SCREEN TO TRUE                     08430000
084400             PERFORM 8000-SEND-MAP                                08440000
084500             PERFORM 8100-RETURN-TRANID                           08450000
084600     END-EVALUATE.                                                08460000
084700/                                                                 08470000
084800 9000-SOFT-ABORT.                                                 08480000
084900                                                                  08490000
085000     EXEC CICS                                                    08500000
085100         SYNCPOINT ROLLBACK                                       08510000
085200     END-EXEC                                                     08520000
085300                                                                  08530000
085400     MOVE 1                           TO PC233-PGM-MSG-NBR        08540000
085500     MOVE SQLCODE                     TO PC233-SQLCODE            08550000
085600     PERFORM 8210-XCTL-ERROR-SCREEN.                              08560000
085700                                                                  08570000
085800                                                                  08580000
085900 9903-WRITE-CICS-LOG.                                             08590000
086000                                                                  08600000
086100     MOVE SQLCODE                     TO PV-SQLCODE               08610000
086200     MOVE PC233-USER-ID               TO PV-USER-ID               08620000
086300                                                                  08630000
086400     EXEC CICS                                                    08640000
086500         WRITEQ TD                                                08650000
086600             QUEUE  ('CSSL')                                      08660000
086700             FROM   (PV-LOG-MSG)                                  08670000
086800             RESP   (PV-CICS-RESPONSE)                            08680000
086900     END-EXEC.                                                    08690000
087000                                                                  08700000
087100 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  08710000
087200                                                                  08720000
087300     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           08730000
087400     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          08740000
087500     INITIALIZE DP013-SRC-TASK-NUMBER                             08750000
087600                DP013-STACK.                                      08760000
087700     SET DP013-LINK-RETURN            TO TRUE.                    08770000
087800                                                                  08780000
087900     EXEC CICS                                                    08790000
088000         LINK                                                     08800000
088100             PROGRAM   (DP013-NAME)                               08810000
088200             COMMAREA  (DP013-PARAMETERS)                         08820000
088300             LENGTH    (DP013-LENGTH)                             08830000
088400     END-EXEC.                                                    08840000
