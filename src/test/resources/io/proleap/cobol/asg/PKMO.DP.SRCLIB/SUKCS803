000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    SUKCS803.                                         00020001
000300 AUTHOR.        Cognizant.                                        00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  MAY 2016.                                         00050001
000600 DATE-COMPILED.                                                   00060001
000700*---------------------------------------------------------------  00070001
000800*    S803 - getCartonDetails  WEBSERVICE TRANSACTION              00080001
000900*---------------------------------------------------------------  00090001
001000                                                                  00100001
001100 ENVIRONMENT DIVISION.                                            00110001
001200                                                                  00120001
001300 DATA DIVISION.                                                   00130001
001400                                                                  00140001
001500 WORKING-STORAGE SECTION.                                         00150001
001600   01  DK-DB2-KEYS.                                               00160001
001610       15  DK-SHIPT-UNT-ID           PIC S9(18)V COMP-3.          00161001
001620       15  DK-CHLD-MSTR-SHIPT-ID     PIC S9(18)V COMP-3.          00162001
001630       15  DK-UPC-NBR                PIC S9(15)V COMP-3.          00163001
001640       15  DK-STORE-NBR              PIC S9(04)  COMP SYNC.       00164001
001641       15  DK-PO-NBR                 PIC S9(09)  COMP VALUE 0.    00164118
001650   01  PS-PROGRAM-SWITCHES.                                       00165001
001660     05  PS-EO-CTN-CONTENTS-CSR-SW   PIC  X(01) VALUE 'N'.        00166001
001670         88 PS-EO-CTN-CONTENTS-CSR              VALUE 'Y'.        00167001
001680         88 PS-NO-EO-CTN-CONTENTS-CSR           VALUE 'N'.        00168001
001690     05  PS-FIRST-READ-SW            PIC  X(01) VALUE 'N'.        00169001
001700         88 PS-FIRST-READ                       VALUE 'Y'.        00170001
001701         88 PS-NO-FIRST-READ                    VALUE 'N'.        00170101
001702     05  PS-NO-MORE-MSTR-SW          PIC  X(01) VALUE 'N'.        00170201
001703         88 PS-NO-MORE-MSTR                     VALUE 'Y'.        00170301
001704         88 PS-MORE-MSTR                        VALUE 'N'.        00170401
001705   01  PC-PROGRAM-CONSTANTS.                                      00170501
001706******************************************************************00170601
001707* 1044.  RESPONSE SUCCESSFUL                                      00170701
001708* 1570.  A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK          00170801
001709* 3781.  MORE UPC NUMBERS AVAILABLE                               00170901
001710* 3782.  CARTON ID REQUIRED                                       00171001
001711* 3783.  UPC DETAILS NOT FOUND FOR THE INPUT CARTON ID            00171101
001712* 3784.  INVALID CARTON ID                                        00171201
001713* 3786.  MULTIPLE CARTONS ASSIGNED - PLEASE SCAN BARCODE ON 4X4   00171301
001714*        LABEL                                                    00171401
001715* 3787.  FUNCTION IS CURRENTLY UNAVAILABLE                        00171501
001716******************************************************************00171601
001717     05  PC-TSYMSG-NUMBERS.                                       00171701
001718         10  PC-TSYMSG-01044         PIC  9(05) VALUE  01044.     00171801
001719         10  PC-TSYMSG-01570         PIC  9(05) VALUE  01570.     00171901
001720         10  PC-TSYMSG-03781         PIC  9(05) VALUE  03781.     00172001
001721         10  PC-TSYMSG-03782         PIC  9(05) VALUE  03782.     00172101
001722         10  PC-TSYMSG-03783         PIC  9(05) VALUE  03783.     00172201
001723         10  PC-TSYMSG-03784         PIC  9(05) VALUE  03784.     00172301
001724         10  PC-TSYMSG-03786         PIC  9(05) VALUE  03786.     00172401
001725         10  PC-TSYMSG-03787         PIC  9(05) VALUE  03787.     00172501
001726         10  PC-TSYMSG-03793         PIC  9(05) VALUE  03793.     00172601
001727     05  PC-MAX-ITEMS                PIC S9(04)  VALUE +300       00172701
001728                                                     COMP SYNC.   00172801
001729   01  PV-PROGRAM-VARIABLES.                                      00172901
001730     05  PV-TSYMSG-NUMBER            PIC  9(05) VALUE  0.         00173001
001740     05  PV-CARTON-DISP              PIC  9(20) VALUE  0.         00174001
001750     05  PV-TRIP-DISP                PIC  9(09) VALUE  0.         00175001
001760     05  PV-STYLID-DISP              PIC  9(09) VALUE  0.         00176001
001770     05  PV-SQLCODE                  PIC  9(09) VALUE  0.         00177001
001780     05  PV-PO-DISP                  PIC  9(09) VALUE  0.         00178001
001790     05  PV-XFER-ID-DISP             PIC  9(09) VALUE  0.         00179001
001800     05  PV-UPC-DISP                 PIC  9(15) VALUE  0.         00180001
001900     05  PV-INT-UPC-DISP             PIC  9(09) VALUE  0.         00190001
001910     05  PV-SAVE-TRN-NBR             PIC S9(09) COMP.             00191001
001911     05  PV-SAVE-TRN-NBR2            PIC S9(09) COMP VALUE 0.     00191119
001912     05  PV-SAVE-OPC-SET-IND         PIC  X(01) VALUE SPACE.      00191207
001920     05  PV-TRN-NBR-COMP             PIC S9(10) COMP VALUE        00192001
001921                                                      ZEROES.     00192101
001922     05  PV-TRN-NBR                  PIC 9(10) VALUE ZEROES.      00192201
001923     05  PV-TRN-NBR-N REDEFINES PV-TRN-NBR.                       00192301
001924         10  PV-TRN-STORE             PIC 9(04).                  00192401
001925         10  PV-TRN-SEQUENCE          PIC 9(06).                  00192501
001926     05  PV-TRIP-NULL-IND            PIC S9(04)  VALUE ZEROS      00192601
001927                                                 COMP SYNC.       00192701
001928     05  PV-SHIPT-UNT-ID             PIC S9(18)V COMP-3.          00192801
001929     05  PV-PRNT-CART-ID             PIC S9(18)V COMP-3.          00192901
001930     05  PV-CICS-MSG-AREA.                                        00193001
001931         10 PV-PROGRAM-NAME          PIC  X(10) VALUE             00193101
001932                                               ' SUKCS803 '.      00193201
001933         10 PV-LOG-TIME              PIC  X(15) VALUE SPACES.     00193301
001934         10 PV-PARA-NAME             PIC  X(25) VALUE SPACES.     00193401
001935         10 PV-ERROR-MSG             PIC  X(78) VALUE SPACES.     00193501
001936     05  PV-COMMAREA-LENGTH          PIC S9(04)  VALUE +0         00193601
001937                                                     COMP SYNC.   00193701
001938     05  PV-CICS-RESPONSE            PIC S9(08)  VALUE ZEROS      00193801
001939                                                  COMP SYNC.      00193901
001940     05  PV-ITEM-IDX                 PIC S9(04)  VALUE ZEROS      00194001
001941                                                     COMP SYNC.   00194101
001942     05  PV-READ-COUNT               PIC S9(04)  VALUE +0         00194201
001943                                                     COMP SYNC.   00194301
001944     05  PV-TMST.                                                 00194401
001945         10 PV-TMST-DATE             PIC X(10).                   00194501
001946         10 PV-TMST-T                PIC X(01) VALUE 'T'.         00194601
001947         10 PV-TMST-TIME             PIC X(08).                   00194701
001948     05  PV-TRLR-TMST.                                            00194801
001949         10 PV-TRLR-DATE             PIC X(10).                   00194901
001950         10 PV-TRLR-FIL1             PIC X(01).                   00195001
001951         10 PV-TRLR-TIME             PIC X(08).                   00195101
001952         10 PV-TRLR-DOT              PIC X(01).                   00195201
001953         10 PV-TRLR-MS               PIC X(06).                   00195301
001954     05  PV-CURR-TIMESTAMP           PIC X(26).                   00195401
001955     05  PV-CURR-TMST-DATE-HHMM   REDEFINES                       00195501
001956         PV-CURR-TIMESTAMP.                                       00195601
001957         10  PV-CURR-YEAR            PIC X(04).                   00195701
001958         10  FILLER                  PIC X(01).                   00195801
001959         10  PV-CURR-MONTH           PIC X(02).                   00195901
001960         10  FILLER                  PIC X(01).                   00196001
001961         10  PV-CURR-DAY             PIC X(02).                   00196101
001962         10  FILLER                  PIC X(01).                   00196201
001963         10  PV-CURR-HOUR            PIC X(02).                   00196301
001964         10  FILLER                  PIC X(01).                   00196401
001965         10  PV-CURR-MIN             PIC X(02).                   00196501
001966         10  FILLER                  PIC X(01).                   00196601
001967         10  PV-CURR-SEC             PIC X(02).                   00196701
001968         10  FILLER                  PIC X(07).                   00196801
001969     05  PV-CSSL-TMST.                                            00196901
001970         10  PV-CSSL-MONTH           PIC X(02).                   00197001
001971         10  FILLER                  PIC X(01) VALUE '-'.         00197101
001972         10  PV-CSSL-DAY             PIC X(02).                   00197201
001973         10  FILLER                  PIC X(01) VALUE SPACE.       00197301
001974         10  PV-CSSL-HOUR            PIC X(02).                   00197401
001975         10  FILLER                  PIC X(01) VALUE ':'.         00197501
001976         10  PV-CSSL-MIN             PIC X(02).                   00197601
001977         10  FILLER                  PIC X(01) VALUE ':'.         00197701
001978         10  PV-CSSL-SEC             PIC X(02).                   00197801
001979         10  FILLER                  PIC X(01) VALUE SPACE.       00197901
001980     05  PV-DISP-CRTN                pic 9(20) value zeroes.      00198002
001981     05  PV-DISP-UPC                 pic 9(18) value zeroes.      00198102
001982                                                                  00198202
001990*INPUT                                                            00199001
002000      COPY SURD120.                                               00200001
002010*OUTPUT                                                           00201001
002020      COPY SURD121.                                               00202001
002030                                                                  00203001
002040      COPY DPRD507I.                                              00204001
002050                                                                  00205001
002060     EXEC SQL                                                     00206001
002070         INCLUDE SQLCA                                            00207001
002080     END-EXEC.                                                    00208001
002090                                                                  00209001
002100     EXEC SQL                                                     00210001
002200          INCLUDE TKRPRPM                                         00220001
002300     END-EXEC.                                                    00230001
002400                                                                  00240001
002500     EXEC SQL                                                     00250001
002600          INCLUDE TPURITM                                         00260001
002700     END-EXEC.                                                    00270001
002800                                                                  00280001
002900     EXEC SQL                                                     00290001
003000          INCLUDE TTFMSTR                                         00300001
003100     END-EXEC.                                                    00310001
003200                                                                  00320001
003300     EXEC SQL                                                     00330001
003400          INCLUDE TTFCUST                                         00340001
003500     END-EXEC.                                                    00350001
003600                                                                  00360001
003700     EXEC SQL                                                     00370001
003800          INCLUDE XLV00000                                        00380001
003900     END-EXEC.                                                    00390001
004000                                                                  00400001
004100     EXEC SQL                                                     00410001
004200          INCLUDE XLV00002                                        00420001
004300     END-EXEC.                                                    00430001
004400                                                                  00440001
004500     EXEC SQL                                                     00450001
004600          INCLUDE XLT00006                                        00460001
004700     END-EXEC.                                                    00470001
004800                                                                  00480001
004900     EXEC SQL                                                     00490001
005000          INCLUDE SUT00024                                        00500001
005100     END-EXEC.                                                    00510001
005200                                                                  00520001
005300     EXEC SQL                                                     00530001
005400          INCLUDE SUT00028                                        00540001
005500     END-EXEC.                                                    00550001
005600                                                                  00560001
005700     EXEC SQL                                                     00570001
005800          INCLUDE SUT00099                                        00580001
005900     END-EXEC.                                                    00590001
006000                                                                  00600001
006100     EXEC SQL                                                     00610001
006200          INCLUDE SUT00027                                        00620001
006300     END-EXEC.                                                    00630001
006400                                                                  00640001
006500     EXEC SQL                                                     00650001
006600          INCLUDE SUT00121                                        00660001
006700     END-EXEC.                                                    00670001
006800                                                                  00680001
006900     EXEC SQL                                                     00690001
007000          INCLUDE TSUCRDV                                         00700001
007100     END-EXEC.                                                    00710001
007200                                                                  00720001
007300     EXEC SQL                                                     00730001
007400          INCLUDE TSUCDOT                                         00740001
007500     END-EXEC.                                                    00750001
007600                                                                  00760001
007700     EXEC SQL                                                     00770001
007800          INCLUDE TMDARVS                                         00780001
007900     END-EXEC.                                                    00790001
008000                                                                  00800001
008100     EXEC SQL                                                     00810001
008200          INCLUDE TSUOBTS                                         00820001
008300     END-EXEC.                                                    00830001
008400                                                                  00840001
008500     EXEC SQL                                                     00850001
008600          INCLUDE TSUOBTR                                         00860001
008700     END-EXEC.                                                    00870001
008800                                                                  00880001
008900     EXEC SQL                                                     00890001
009000          INCLUDE TCNTRID                                         00900001
009100     END-EXEC.                                                    00910001
009200                                                                  00920001
009210     EXEC SQL                                                     00921006
009220          INCLUDE TPURCHS                                         00922006
009230     END-EXEC.                                                    00923006
009240                                                                  00924006
009250     EXEC SQL                                                     00925006
009260          INCLUDE TSEASET                                         00926006
009270     END-EXEC.                                                    00927006
009280                                                                  00928006
009290     EXEC SQL                                                     00929010
009291          INCLUDE WST00008                                        00929111
009292     END-EXEC.                                                    00929210
009293                                                                  00929310
009294     EXEC SQL                                                     00929410
009295          INCLUDE WST00009                                        00929511
009296     END-EXEC.                                                    00929610
009297                                                                  00929710
009298     EXEC SQL                                                     00929811
009299          INCLUDE WST00010                                        00929911
009300     END-EXEC.                                                    00930011
009301                                                                  00930111
009310     EXEC SQL                                                     00931011
009400         DECLARE CTN-CONTENTS-CSR CURSOR FOR                      00940001
009500         SELECT                                                   00950001
009600              A.UPC_NBR                                           00960001
009700         ,    A.SHPD_UNT_QTY                                      00970001
009800         ,    A.TRN_NBR                                           00980001
009900         ,    A.TRN_LNE_NBR                                       00990001
010000         ,    A.RCVR_SEQ_NBR                                      01000001
010100         ,    A.TRN_TYP_CDE                                       01010001
010200         FROM                                                     01020001
010300               SUT_OTBND_UPC A                                    01030001
010400        WHERE  A.SHIPT_UNT_ID      = :DK-SHIPT-UNT-ID             01040001
010500          AND  A.UPC_NBR          >= :DK-UPC-NBR                  01050001
010600       ORDER BY 1                                                 01060001
010700       WITH UR                                                    01070001
010800     END-EXEC.                                                    01080001
010900                                                                  01090001
011000*----------------------------------------------------------------*01100001
011100 LINKAGE SECTION.                                                 01110001
011200                                                                  01120001
011300 01  DFHCOMMAREA.                                                 01130001
011400     05  FILLER                         OCCURS  1 TO 32000 TIMES  01140001
011500                                        DEPENDING ON EIBCALEN.    01150001
011600         10  FILLER                     PIC X.                    01160001
011700                                                                  01170001
011800 PROCEDURE DIVISION.                                              01180001
011900***************************************************************** 01190001
012000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01200001
012100***************************************************************** 01210001
012200 0000-MAIN-MODULE.                                                01220001
012300                                                                  01230001
012400     PERFORM 1000-INITIALIZE.                                     01240001
012500     PERFORM 1100-CHECK-WEBSERV-AVAIL.                            01250001
012600     IF EIBCALEN > 0                                              01260001
012700                                                                  01270001
012800        MOVE DFHCOMMAREA(1:20)     TO SU120-GET-CARTON-DETAILS    01280001
012900                                                                  01290001
013000        IF SU120-CARTON-ID GREATER THAN ZEROES                    01300001
013100                                                                  01310001
013200           PERFORM 2000-GET-STORE-NUMBER                          01320001
013300           PERFORM 2500-GET-UPC-DETAILS                           01330001
013400                                                                  01340001
013500        ELSE                                                      01350001
013600                                                                  01360001
013700           MOVE PC-TSYMSG-03782       TO PV-TSYMSG-NUMBER         01370001
013800           MOVE 'CARTON ID REQUIRED'  TO PV-ERROR-MSG             01380001
013900           MOVE '0000-MAIN-MODULE  '  TO PV-PARA-NAME             01390001
014000           PERFORM 9995-CSSL-LOG-RETURN                           01400001
014100                                                                  01410001
014200        END-IF                                                    01420001
014300     END-IF.                                                      01430001
014400                                                                  01440001
014500     PERFORM 9000-RETURN-TRAN                                     01450001
014600        .                                                         01460001
014700*----------------------------------------------------------------*01470001
014800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01480001
014900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01490001
015000*----------------------------------------------------------------*01500001
015100                                                                  01510001
015200 1000-INITIALIZE.                                                 01520001
015300     INITIALIZE SU120-GET-CARTON-DETAILS                          01530001
015400                SU121-OUT-CARTON-DETAILS                          01540001
015500                PV-SAVE-TRN-NBR.                                  01550001
015600                                                                  01560001
015700      EXEC SQL                                                    01570001
015800        SELECT                                                    01580001
015900              CURRENT TIMESTAMP                                   01590001
016000        INTO                                                      01600001
016100             :PV-CURR-TIMESTAMP                                   01610001
016200        FROM SYSIBM.SYSDUMMY1                                     01620001
016300      END-EXEC.                                                   01630001
016400                                                                  01640001
016500     EVALUATE TRUE                                                01650001
016600                                                                  01660001
016700         WHEN SQLCODE = ZERO                                      01670001
016800                                                                  01680001
016900            MOVE  PV-CURR-MONTH    TO PV-CSSL-MONTH               01690001
017000            MOVE  PV-CURR-DAY      TO PV-CSSL-DAY                 01700001
017100            MOVE  PV-CURR-HOUR     TO PV-CSSL-HOUR                01710001
017200            MOVE  PV-CURR-MIN      TO PV-CSSL-MIN                 01720001
017300            MOVE  PV-CURR-SEC      TO PV-CSSL-SEC                 01730001
017400            MOVE  PV-CSSL-TMST     TO PV-LOG-TIME                 01740001
017500                                                                  01750001
017600         WHEN SQLCODE NOT = ZERO                                  01760001
017700                                                                  01770001
017800              MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 01780001
017900              MOVE SQLCODE                    TO PV-SQLCODE       01790001
018000              MOVE '1000-INITIALIZE '         TO PV-PARA-NAME     01800001
018100                                                                  01810001
018200              STRING 'DB2 IS NOT ACTIVE, SQLCODE:'                01820001
018300              PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     01830001
018400                                                                  01840001
018500              PERFORM 9995-CSSL-LOG-RETURN                        01850001
018600                                                                  01860001
018700     END-EVALUATE.                                                01870001
018800 1100-CHECK-WEBSERV-AVAIL.                                        01880001
018900                                                                  01890001
019000      EXEC SQL                                                    01900001
019100        SELECT FUNC_TXT                                           01910001
019200          INTO :KRPRPM-FUNC-TXT                                   01920001
019300          FROM TKRPRPM                                            01930001
019400        WHERE LOC_ID            = 90                              01940001
019500          AND INTFC_SYS_CDE     = 'KHL'                           01950001
019600          AND SYS_PRC_FUNC_CDE  = 'STWEB3'                        01960001
019700          AND FUNC_PRC_STAT_CDE = 'AC'                            01970001
019800          AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              01980001
019900          AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              01990001
020000          AND FUNC_TXT          = 'Y'                             02000001
020100        WITH UR                                                   02010001
020200      END-EXEC.                                                   02020001
020300                                                                  02030001
020400     EVALUATE TRUE                                                02040001
020500         WHEN SQLCODE = ZERO                                      02050001
020600                                                                  02060001
020700                  CONTINUE                                        02070001
020800                                                                  02080001
020900         WHEN SQLCODE = +100                                      02090001
021000                                                                  02100001
021100              MOVE PC-TSYMSG-03787           TO PV-TSYMSG-NUMBER  02110001
021200              MOVE 'WEB SERVICE getCartonDetails NOT AVAILABLE '  02120001
021300                                               TO PV-ERROR-MSG    02130001
021400              MOVE '1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME    02140001
021500              PERFORM 9995-CSSL-LOG-RETURN                        02150001
021600                                                                  02160001
021700         WHEN SQLCODE NOT = ZERO                                  02170001
021800                                                                  02180001
021900              MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 02190001
022000              MOVE SQLCODE                    TO PV-SQLCODE       02200001
022100              MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME     02210001
022200              STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        02220001
022300              PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     02230001
022400              PERFORM 9995-CSSL-LOG-RETURN                        02240001
022500                                                                  02250001
022600     END-EVALUATE.                                                02260001
022700 2000-GET-STORE-NUMBER.                                           02270001
022800                                                                  02280001
022900      MOVE SU120-CARTON-ID      TO DK-SHIPT-UNT-ID                02290001
023000                                   PV-CARTON-DISP.                02300001
023100      MOVE SU120-LAST-UPC-NBR   TO DK-UPC-NBR.                    02310001
023200                                                                  02320001
023300      IF SU120-LAST-UPC-NBR > 0                                   02330001
023400         ADD +1                 TO DK-UPC-NBR                     02340001
023500      END-IF.                                                     02350001
023600                                                                  02360001
023700      EXEC SQL                                                    02370001
023800          SELECT  A.DEST_LOC_NBR                                  02380001
023900                , A.CART_SRC_CDE                                  02390001
024000                , A.CRE_DTE                                       02400001
024100                , A.CRE_TM                                        02410001
024200                , A.OTBND_TRIP_ID                                 02420001
024210                , A.ORIG_CART_ID                                  02421016
024300            INTO  :SUT00024-DEST-LOC-NBR                          02430001
024400                , :SUT00024-CART-SRC-CDE                          02440001
024500                , :SUT00024-CRE-DTE                               02450001
024600                , :SUT00024-CRE-TM                                02460001
024700                , :SUT00024-OTBND-TRIP-ID :PV-TRIP-NULL-IND       02470001
024710                , :SUT00024-ORIG-CART-ID                          02471016
024800            FROM  SUT_OTBND_CART A                                02480001
024900           WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID              02490001
024910             AND  A.MSTR_CART_IND = 'N'                           02491001
024911             AND  A.ACTV_IND      = 'Y'                           02491101
024912          WITH UR                                                 02491201
024913      END-EXEC.                                                   02491301
024914                                                                  02491401
024915      EVALUATE TRUE                                               02491501
024916         WHEN SQLCODE = ZERO                                      02491601
024917                                                                  02491701
024918            MOVE SUT00024-DEST-LOC-NBR  TO SU121-STORE-NBR        02491801
024919                                           DK-STORE-NBR           02491901
024920*CHANGES START                                                    02492001
024930            IF PV-TRIP-NULL-IND = -1                              02493001
024940                                                                  02494001
024950               MOVE 0                      TO SU121-TRIP-ID       02495001
024960                                              SU121-SHIP-NODE     02496001
024970                                              SU121-TRLR-SRL-NBR  02497001
024980               MOVE SPACES                 TO SU121-TRLR-SEAL-ID  02498001
024990                                              SU121-TRAILER-ID    02499001
025000                                              SU121-TRLR-SCAC-CDE 02500001
025100                                                                  02510001
025200            ELSE                                                  02520001
025300                                                                  02530001
025400               MOVE SUT00024-OTBND-TRIP-ID TO SU121-TRIP-ID       02540001
025500               PERFORM 2200-FIND-TRAILER-ID                       02550001
025600                                                                  02560001
025700            END-IF                                                02570001
025800                                                                  02580001
025900            MOVE SUT00024-CART-SRC-CDE TO SU121-SML-TYPE          02590001
025910            MOVE SUT00024-ORIG-CART-ID TO SU121-VENDOR-CART-ID    02591016
025920            MOVE DK-SHIPT-UNT-ID       TO SU121-SML-CARTON-ID     02592018
026000            MOVE SUT00024-CRE-DTE      TO PV-TMST-DATE            02600001
026100            MOVE SUT00024-CRE-TM       TO PV-TMST-TIME            02610001
026200            MOVE PV-TMST               TO SU121-SML-CRE-TMST      02620001
026300                                                                  02630001
026400            PERFORM 4200-GET-TRLR-TMST                            02640001
026410            PERFORM 4000-FIND-PARENT-CARTON                       02641001
026420                                                                  02642001
026430            MOVE PV-PRNT-CART-ID       TO SU121-PARENT-SML        02643001
026440                                                                  02644001
026450            PERFORM 4400-CHECK-CARTON-RECEIVED                    02645001
026460*CHANGES END                                                      02646001
026461                                                                  02646119
026462            PERFORM 5000-CHECK-EFC-RCVD                           02646219
026470                                                                  02647001
026480         WHEN SQLCODE = 100                                       02648001
026490                                                                  02649001
026500            PERFORM 2100-GET-STORE-NBR-VEND                       02650001
026600                                                                  02660001
026700         WHEN SQLCODE NOT = ZERO                                  02670001
026800                                                                  02680001
026810            MOVE SQLCODE    TO PV-SQLCODE                         02681001
026820                                                                  02682001
026830            STRING 'SELECT SUT_OTBND_CART FAILED WITH SQLCODE:'   02683001
026840                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02684001
026850                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02685001
026860                                                                  02686001
026870            MOVE ' 2000-GET-STORE-NUMBER ' TO PV-PARA-NAME        02687001
026880            PERFORM 9995-CSSL-LOG-RETURN                          02688001
026890                                                                  02689001
026900      END-EVALUATE                                                02690001
027000      .                                                           02700001
027100 2100-GET-STORE-NBR-VEND.                                         02710001
027200                                                                  02720001
027210      EXEC SQL                                                    02721001
027220          SELECT  A.DEST_LOC_NBR                                  02722001
027230                , A.SHIPT_UNT_ID                                  02723001
027240                , A.CART_SRC_CDE                                  02724001
027250                , A.CRE_DTE                                       02725001
027260                , A.CRE_TM                                        02726001
027261                , A.OTBND_TRIP_ID                                 02726101
027262            INTO  :SUT00024-DEST-LOC-NBR                          02726201
027263                , :SUT00024-SHIPT-UNT-ID                          02726301
027264                , :SUT00024-CART-SRC-CDE                          02726401
027265                , :SUT00024-CRE-DTE                               02726501
027266                , :SUT00024-CRE-TM                                02726601
027267                , :SUT00024-OTBND-TRIP-ID  :PV-TRIP-NULL-IND      02726701
027268            FROM  SUT_OTBND_CART A                                02726801
027269           WHERE  A.ORIG_CART_ID  = :DK-SHIPT-UNT-ID              02726901
027270             AND  A.MSTR_CART_IND = 'N'                           02727001
027280             AND  A.ACTV_IND      = 'Y'                           02728001
027290          WITH UR                                                 02729001
027291      END-EXEC                                                    02729101
027292                                                                  02729201
027293      EVALUATE TRUE                                               02729301
027294         WHEN SQLCODE = ZERO                                      02729401
027295                                                                  02729501
027296            MOVE SUT00024-DEST-LOC-NBR   TO SU121-STORE-NBR       02729601
027297                                            DK-STORE-NBR          02729701
027298            MOVE DK-SHIPT-UNT-ID         TO SU121-VENDOR-CART-ID  02729817
027299            MOVE SUT00024-SHIPT-UNT-ID   TO DK-SHIPT-UNT-ID       02729901
027300                                            SU121-SML-CARTON-ID   02730018
027301*CHANGES START                                                    02730101
027302            IF PV-TRIP-NULL-IND = -1                              02730201
027310                                                                  02731001
027311               MOVE 0                      TO SU121-TRIP-ID       02731101
027312                                              SU121-SHIP-NODE     02731201
027313                                              SU121-TRLR-SRL-NBR  02731301
027314               MOVE SPACES                 TO SU121-TRLR-SEAL-ID  02731401
027315                                              SU121-TRAILER-ID    02731501
027316                                              SU121-TRLR-SCAC-CDE 02731601
027317                                                                  02731701
027318            ELSE                                                  02731801
027319                                                                  02731901
027320               MOVE SUT00024-OTBND-TRIP-ID TO SU121-TRIP-ID       02732001
027321               PERFORM 2200-FIND-TRAILER-ID                       02732101
027322                                                                  02732201
027323            END-IF                                                02732301
027324                                                                  02732401
027325            MOVE SUT00024-CART-SRC-CDE    TO SU121-SML-TYPE       02732501
027327            MOVE SUT00024-CRE-DTE         TO PV-TMST-DATE         02732701
027328            MOVE SUT00024-CRE-TM          TO PV-TMST-TIME         02732801
027329            MOVE PV-TMST                  TO SU121-SML-CRE-TMST   02732901
027330                                                                  02733001
027331            PERFORM 4200-GET-TRLR-TMST                            02733101
027332            PERFORM 4000-FIND-PARENT-CARTON                       02733201
027333                                                                  02733301
027334            MOVE PV-PRNT-CART-ID          TO SU121-PARENT-SML     02733401
027335                                                                  02733520
027336            PERFORM 5000-CHECK-EFC-RCVD                           02733619
027337                                                                  02733701
027338*CHANGES END                                                      02733801
027339                                                                  02733901
027340         WHEN SQLCODE = -811                                      02734001
027341                                                                  02734101
027342            MOVE PC-TSYMSG-03786         TO PV-TSYMSG-NUMBER      02734201
027343            STRING 'MULTIPLE DESTINATION LOC FOUND FOR CARTON ID:'02734301
027344                PV-CARTON-DISP     DELIMITED BY SIZE INTO         02734401
027345                                                 PV-ERROR-MSG     02734501
027346            MOVE '2100-GET-STORE-NBR-VEND' TO PV-PARA-NAME        02734601
027347            PERFORM 9995-CSSL-LOG-RETURN                          02734701
027348                                                                  02734801
027349         WHEN SQLCODE = 100                                       02734901
027350                                                                  02735001
027351            PERFORM 2050-CHECK-MASTER-CARTON                      02735101
027352                                                                  02735201
027353         WHEN SQLCODE NOT = ZERO                                  02735301
027354                                                                  02735401
027355            MOVE SQLCODE    TO PV-SQLCODE                         02735501
027356                                                                  02735601
027357            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02735701
027358            STRING 'SELECT SUT_OTBND_CART FAILED WITH SQLCODE:'   02735801
027359                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02735901
027360                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02736001
027361                                                                  02736101
027362            MOVE ' 2100-GET-STORE-NBR-VEND'  TO PV-PARA-NAME      02736201
027363            PERFORM 9995-CSSL-LOG-RETURN                          02736301
027364                                                                  02736401
027365      END-EVALUATE                                                02736501
027366      .                                                           02736601
027367*CHANGES START                                                    02736701
027368 2050-CHECK-MASTER-CARTON.                                        02736801
027369                                                                  02736901
027370      EXEC SQL                                                    02737001
027371          SELECT  A.DEST_LOC_NBR                                  02737101
027372                , A.CART_SRC_CDE                                  02737201
027373                , A.CRE_DTE                                       02737301
027380                , A.CRE_TM                                        02738001
027381            INTO  :SUT00024-DEST-LOC-NBR                          02738101
027382                , :SUT00024-CART-SRC-CDE                          02738201
027383                , :SUT00024-CRE-DTE                               02738301
027384                , :SUT00024-CRE-TM                                02738401
027385            FROM  SUT_OTBND_CART A                                02738501
027386           WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID              02738601
027387             AND  A.MSTR_CART_IND = 'Y'                           02738701
027388          WITH UR                                                 02738801
027389      END-EXEC.                                                   02738901
027390                                                                  02739001
027391      EVALUATE TRUE                                               02739101
027392         WHEN SQLCODE = ZERO                                      02739201
027393                                                                  02739301
027394            MOVE SUT00024-DEST-LOC-NBR  TO SU121-STORE-NBR        02739401
027395            MOVE SUT00024-CART-SRC-CDE  TO SU121-SML-TYPE         02739501
027396            MOVE SUT00024-CRE-DTE       TO PV-TMST-DATE           02739601
027397            MOVE SUT00024-CRE-TM        TO PV-TMST-TIME           02739701
027398            MOVE PV-TMST                TO SU121-SML-CRE-TMST     02739801
027399                                                                  02739901
027400            PERFORM 4500-FIND-TRIP-ID                             02740001
027401                                                                  02740101
027402            MOVE PC-TSYMSG-03793        TO PV-TSYMSG-NUMBER       02740201
027403                                                                  02740301
027404            PERFORM 9000-RETURN-TRAN                              02740401
027405                                                                  02740501
027406         WHEN SQLCODE = 100                                       02740601
027407                                                                  02740701
027408            MOVE PC-TSYMSG-03784         TO PV-TSYMSG-NUMBER      02740801
027409            STRING 'INVALID CARTON ID ENTERED, INPUT CARTON ID:'  02740901
027410                PV-CARTON-DISP     DELIMITED BY SIZE INTO         02741001
027420                                                 PV-ERROR-MSG     02742001
027430            MOVE '2050-CHECK-MASTER-CARTON' TO PV-PARA-NAME       02743001
027431            PERFORM 9995-CSSL-LOG-RETURN                          02743101
027432                                                                  02743201
027433                                                                  02743301
027434         WHEN SQLCODE NOT = ZERO                                  02743401
027435                                                                  02743501
027436            MOVE SQLCODE    TO PV-SQLCODE                         02743601
027437                                                                  02743701
027438            STRING 'SELECT SUT_OTBND_CART FAILED WITH SQLCODE:'   02743801
027439                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02743901
027440                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02744001
027441                                                                  02744101
027442            MOVE ' 2050-CHECK-MASTER-CARTON' TO PV-PARA-NAME      02744201
027443            PERFORM 9995-CSSL-LOG-RETURN                          02744301
027444                                                                  02744401
027445      END-EVALUATE                                                02744501
027446      .                                                           02744601
027447 2200-FIND-TRAILER-ID.                                            02744701
027448                                                                  02744801
027449      MOVE SUT00024-OTBND-TRIP-ID  TO SUOBTS-OTBND-TRIP-ID        02744901
027450                                      PV-TRIP-DISP.               02745001
027460                                                                  02746001
027461      EXEC SQL                                                    02746100
027462         SELECT                                                   02746200
027463            OBTS.TRLR_SEAL_ID                                     02746300
027464           ,OBTR.ORGN_OPER_UNT_ID                                 02746400
027465           ,OBTR.TRLR_SRL_NBR                                     02746500
027466           ,TRID.SCAC_CDE                                         02746600
027467           ,TRID.TRLR_ID                                          02746700
027468          INTO                                                    02746800
027469            :SUOBTS-TRLR-SEAL-ID                                  02746900
027470           ,:SUOBTR-ORGN-OPER-UNT-ID                              02747000
027480           ,:SUOBTR-TRLR-SRL-NBR                                  02748000
027481           ,:CNTRID-SCAC-CDE                                      02748100
027482           ,:CNTRID-TRLR-ID                                       02748200
027483          FROM                                                    02748300
027484              TSUOBTS OBTS                                        02748400
027485            , TSUOBTR OBTR                                        02748500
027486            , TCNTRID TRID                                        02748600
027487          WHERE                                                   02748700
027488                OBTS.OTBND_TRIP_ID = :SUOBTS-OTBND-TRIP-ID        02748800
027489            AND OBTS.OTBND_TRIP_ID = OBTR.OTBND_TRIP_ID           02748900
027490            AND OBTR.TRIP_ACTV_CDE = 'A'                          02749000
027491            AND OBTS.TRIP_STAT_CDE = 'DS'                         02749100
027492            AND OBTR.TRLR_SRL_NBR  = TRID.TRLR_SRL_NBR            02749200
027493          WITH UR                                                 02749300
027494      END-EXEC.                                                   02749400
027495      EVALUATE TRUE                                               02749500
027496         WHEN SQLCODE = ZERO                                      02749600
027497                                                                  02749700
027498            MOVE SUOBTS-TRLR-SEAL-ID     TO SU121-TRLR-SEAL-ID    02749800
027499            MOVE SUOBTR-ORGN-OPER-UNT-ID TO SU121-SHIP-NODE       02749900
027500            MOVE SUOBTR-TRLR-SRL-NBR     TO SU121-TRLR-SRL-NBR    02750000
027501            MOVE CNTRID-SCAC-CDE         TO SU121-TRLR-SCAC-CDE   02750100
027502            MOVE CNTRID-TRLR-ID          TO SU121-TRAILER-ID      02750200
027503                                                                  02750300
027504         WHEN SQLCODE = 100                                       02750400
027505                                                                  02750500
027506            MOVE SPACES                  TO SU121-TRLR-SEAL-ID    02750600
027507            MOVE 0                       TO SU121-SHIP-NODE       02750700
027508                                            SU121-TRLR-SRL-NBR    02750800
027509            MOVE SPACES                  TO SU121-TRLR-SCAC-CDE   02750900
027510                                            SU121-TRAILER-ID      02751000
027520                                                                  02752000
027521         WHEN SQLCODE NOT = ZERO                                  02752100
027522                                                                  02752200
027523            MOVE SQLCODE    TO PV-SQLCODE                         02752300
027524                                                                  02752400
027525            STRING 'SELECT TSUOBTS FAILED WITH SQLCODE:'          02752500
027526                   PV-SQLCODE ' TRIP#' PV-TRIP-DISP               02752600
027527                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02752700
027528                                                                  02752800
027529            MOVE ' 2200-FIND-TRAILER-ID '  TO PV-PARA-NAME        02752900
027530            PERFORM 9995-CSSL-LOG-RETURN                          02753000
027531                                                                  02753100
027532      END-EVALUATE                                                02753200
027533      .                                                           02753300
027534*CHANGES END                                                      02753400
027535 2500-GET-UPC-DETAILS.                                            02753500
027536                                                                  02753600
027537         PERFORM 2600-OPEN-CTN-CONTENTS-CSR.                      02753700
027538         PERFORM 2700-FETCH-UPC-FROM-DB.                          02753800
027539         PERFORM 2800-CLOSE-CTN-CONTENTS-CSR.                     02753900
027540                                                                  02754000
027541 2600-OPEN-CTN-CONTENTS-CSR.                                      02754100
027542                                                                  02754200
027543         EXEC SQL                                                 02754300
027544            OPEN CTN-CONTENTS-CSR                                 02754400
027545         END-EXEC.                                                02754500
027546                                                                  02754600
027547      EVALUATE TRUE                                               02754700
027548         WHEN SQLCODE = ZERO                                      02754800
027549                                                                  02754900
027550            CONTINUE                                              02755000
027551                                                                  02755100
027552         WHEN SQLCODE NOT = ZERO                                  02755200
027553                                                                  02755300
027554            MOVE SQLCODE    TO PV-SQLCODE                         02755400
027555                                                                  02755500
027556            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02755600
027557            STRING 'OPEN CTN-CONTENTS-CSR FAILED WITH SQLCODE:'   02755700
027558             PV-SQLCODE DELIMITED BY SIZE INTO PV-ERROR-MSG       02755800
027559                                                                  02755900
027560            MOVE '2600-OPEN-CTN-CONTENTS-CSR' TO PV-PARA-NAME     02756000
027561            PERFORM 9995-CSSL-LOG-RETURN                          02756100
027562                                                                  02756200
027563      END-EVALUATE                                                02756300
027564      .                                                           02756400
027565 2700-FETCH-UPC-FROM-DB.                                          02756500
027566                                                                  02756600
027567      MOVE +1                       TO PV-ITEM-IDX                02756700
027568                                                                  02756800
027569      SET PS-NO-EO-CTN-CONTENTS-CSR TO TRUE                       02756900
027570      SET PS-FIRST-READ             TO TRUE                       02757000
027571       PERFORM                                                    02757100
027572           VARYING PV-READ-COUNT                                  02757200
027573           FROM 1 BY 1                                            02757300
027574           UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                  02757400
027575              OR (PS-EO-CTN-CONTENTS-CSR))                        02757500
027576                                                                  02757600
027577           PERFORM 2750-FETCH-CTN-CONTENTS-CSR                    02757700
027578           ADD +1                   TO PV-ITEM-IDX                02757800
027579                                                                  02757900
027580       END-PERFORM.                                               02758000
027581                                                                  02758100
027582       IF PS-NO-EO-CTN-CONTENTS-CSR                               02758200
027583                                                                  02758300
027584          MOVE PC-TSYMSG-03781      TO PV-TSYMSG-NUMBER           02758400
027585                                                                  02758500
027586       END-IF.                                                    02758600
027587                                                                  02758700
027588 2750-FETCH-CTN-CONTENTS-CSR.                                     02758800
027589                                                                  02758900
027590         EXEC SQL                                                 02759000
027591           FETCH CTN-CONTENTS-CSR                                 02759100
027592            INTO  :SUT00028-UPC-NBR                               02759200
027593                , :SUT00028-SHPD-UNT-QTY                          02759300
027594                , :SUT00028-TRN-NBR                               02759400
027595                , :SUT00028-TRN-LNE-NBR                           02759500
027596                , :SUT00028-RCVR-SEQ-NBR                          02759600
027597                , :SUT00028-TRN-TYP-CDE                           02759700
027598         END-EXEC.                                                02759800
027599                                                                  02759900
027600      EVALUATE TRUE                                               02760000
027601         WHEN SQLCODE = ZERO                                      02760100
027602                                                                  02760200
027603            SET PS-NO-FIRST-READ  TO TRUE                         02760300
027604            MOVE SUT00028-UPC-NBR TO SU121-UPC-NBR(PV-ITEM-IDX)   02760400
027605            MOVE SUT00028-SHPD-UNT-QTY                            02760500
027606                                  TO SU121-QUANTITY(PV-ITEM-IDX)  02760600
027607            MOVE SUT00028-TRN-NBR TO SU121-PO-NUMBER(PV-ITEM-IDX) 02760700
027608                                     DK-PO-NBR                    02760808
027609            MOVE SUT00028-TRN-LNE-NBR                             02760908
027610                                TO SU121-PO-LNE-NBR(PV-ITEM-IDX)  02761008
027611            MOVE SUT00028-RCVR-SEQ-NBR                            02761108
027612                                TO SU121-RCVR-SEQ-NBR(PV-ITEM-IDX)02761208
027613                                                                  02761308
027614            PERFORM 2850-FIND-SKU-INTR-UPC                        02761408
027615                                                                  02761508
027616            IF SUT00028-TRN-TYP-CDE = 'PO'                        02761608
027617                                                                  02761708
027618               MOVE 'N'           TO SU121-XFER-IND               02761808
027619                                                                  02761908
027620               PERFORM 2900-SELECT-TPURITM                        02762008
027621               PERFORM 2910-SELECT-RETAIL-AMT                     02762108
027622                                                                  02762208
027623            ELSE                                                  02762308
027624                                                                  02762408
027625               PERFORM 2950-SELECT-COST-RETAIL                    02762508
027626                                                                  02762608
027627               IF SUT00028-TRN-TYP-CDE = 'FX'                     02762708
027628                                                                  02762808
027629                  MOVE 'Y'        TO SU121-XFER-IND               02762908
027630                                                                  02763008
027631                  PERFORM 3000-FIND-XFER-ID                       02763108
027632                                                                  02763208
027633               ELSE                                               02763308
027634                                                                  02763408
027635                  MOVE 'N'        TO SU121-XFER-IND               02763508
027636                                                                  02763608
027637               END-IF                                             02763708
027638            END-IF                                                02763808
027639                                                                  02763908
027640             IF DK-PO-NBR = PV-SAVE-TRN-NBR2                      02764008
027641                                                                  02764108
027642                MOVE PV-SAVE-OPC-SET-IND TO                       02764212
027643                                 SU121-OPC-SET-IND(PV-ITEM-IDX)   02764312
027644                                                                  02764408
027645             ELSE                                                 02764508
027646                MOVE DK-PO-NBR           TO PV-SAVE-TRN-NBR2      02764608
027647                PERFORM 5280-GET-OPC-SET-CDE                      02764708
027648                                                                  02764808
027649             END-IF                                               02764908
027650            MOVE PC-TSYMSG-01044  TO PV-TSYMSG-NUMBER             02765008
027651            ADD +1    TO SU121-UPC-COUNT                          02765108
027652                                                                  02765208
027653         WHEN SQLCODE = 100                                       02765308
027654                                                                  02765408
027655            IF PS-FIRST-READ                                      02765508
027656                                                                  02765608
027657               MOVE PC-TSYMSG-03783      TO PV-TSYMSG-NUMBER      02765708
027658               STRING 'UPC DETAILS NOT FOUND FOR CARTON ID:'      02765808
027659               PV-CARTON-DISP  DELIMITED BY SIZE INTO             02765908
027660                                            PV-ERROR-MSG          02766008
027661               MOVE ' 2750-FETCH-CTN-CONTENTS-CSR'                02766108
027662                                         TO PV-PARA-NAME          02766208
027663               PERFORM 2800-CLOSE-CTN-CONTENTS-CSR                02766308
027664               PERFORM 9995-CSSL-LOG-RETURN                       02766408
027665                                                                  02766508
027666            END-IF                                                02766608
027667                                                                  02766708
027668            SET PS-EO-CTN-CONTENTS-CSR   TO TRUE                  02766808
027669                                                                  02766908
027670         WHEN SQLCODE NOT = ZERO                                  02767008
027671                                                                  02767108
027672            MOVE SQLCODE    TO PV-SQLCODE                         02767208
027673                                                                  02767308
027674            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02767408
027675            STRING 'FETCH CTN-CONTENTS-CSR FAILED WITH SQLCODE:'  02767508
027676             PV-SQLCODE ' SML#' PV-CARTON-DISP                    02767608
027677                        DELIMITED BY SIZE INTO PV-ERROR-MSG       02767708
027678                                                                  02767808
027679            MOVE '2750-FETCH-CTN-CONTENTS-CSR' TO PV-PARA-NAME    02767908
027680            PERFORM 9995-CSSL-LOG-RETURN                          02768008
027681                                                                  02768108
027682      END-EVALUATE                                                02768208
027683      .                                                           02768308
027684 2800-CLOSE-CTN-CONTENTS-CSR.                                     02768408
027685                                                                  02768508
027686         EXEC SQL                                                 02768608
027687           CLOSE CTN-CONTENTS-CSR                                 02768708
027688         END-EXEC.                                                02768808
027689                                                                  02768908
027690      EVALUATE TRUE                                               02769008
027691         WHEN SQLCODE = ZERO                                      02769108
027692                                                                  02769208
027693            CONTINUE                                              02769308
027694                                                                  02769408
027695         WHEN SQLCODE NOT = ZERO                                  02769508
027696                                                                  02769608
027697            MOVE SQLCODE    TO PV-SQLCODE                         02769708
027698                                                                  02769808
027699            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02769908
027700            STRING 'CLOSE CTN-CONTENTS-CSR FAILED WITH SQLCODE:'  02770008
027701             PV-SQLCODE DELIMITED BY SIZE INTO PV-ERROR-MSG       02770108
027702                                                                  02770208
027703            MOVE '2800-CLOSE-CTN-CONTENTS-CSR' TO PV-PARA-NAME    02770308
027704            PERFORM 9995-CSSL-LOG-RETURN                          02770408
027705                                                                  02770508
027706      END-EVALUATE                                                02770608
027707      .                                                           02770708
027708 2850-FIND-SKU-INTR-UPC.                                          02770808
027709                                                                  02770908
027710      EXEC SQL                                                    02771008
027711         SELECT                                                   02771108
027712             XSKU.SKU_NBR                                         02771208
027713           , XSKU.STYL_ID                                         02771308
027714           , XUPC.INTR_UPC_ID                                     02771408
027715          INTO                                                    02771508
027716             :XLV00000-SKU-NBR                                    02771608
027717           , :XLV00000-STYL-ID                                    02771708
027718           , :XLT00006-INTR-UPC-ID                                02771808
027719          FROM                                                    02771908
027720                XLT_UPC       XUPC                                02772008
027721               ,XLV_SKU       XSKU                                02772108
027722          WHERE                                                   02772208
027723               XUPC.UPC_NBR          = :SUT00028-UPC-NBR          02772308
027724           AND XUPC.INTR_UPC_ID      = XSKU.INTR_UPC_ID           02772408
027725           AND NOT XSKU.SKU_STAT_CDE IN ('00', '98')              02772508
027726           WITH UR                                                02772608
027727      END-EXEC.                                                   02772708
027728                                                                  02772808
027729      EVALUATE TRUE                                               02772908
027730         WHEN SQLCODE = ZERO                                      02773008
027731                                                                  02773108
027732            MOVE XLV00000-SKU-NBR TO SU121-SKU-NBR (PV-ITEM-IDX)  02773208
027733            MOVE XLV00000-STYL-ID TO SU121-STYL-ID (PV-ITEM-IDX)  02773308
027734                                                                  02773408
027735            PERFORM 2860-FIND-STYL-CTG                            02773508
027736                                                                  02773608
027737         WHEN SQLCODE = 100                                       02773708
027738                                                                  02773808
027739            MOVE 0                TO SU121-SKU-NBR (PV-ITEM-IDX)  02773908
027740                                     XLT00006-INTR-UPC-ID         02774008
027741                                     SU121-STYL-ID (PV-ITEM-IDX)  02774108
027742                                  SU121-CTG-SEQ-NBR (PV-ITEM-IDX) 02774208
027743                                                                  02774308
027744         WHEN SQLCODE NOT = ZERO                                  02774408
027745                                                                  02774508
027746            MOVE SQLCODE                  TO PV-SQLCODE           02774608
027747            MOVE SUT00028-UPC-NBR         TO PV-UPC-DISP          02774708
027748            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02774808
027749                                                                  02774908
027750            STRING 'SELECT XLT_UPC FAILED WITH SQLCODE:'          02775008
027751             PV-SQLCODE ' UPC:' PV-UPC-DISP                       02775108
027752                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02775208
027753                                                                  02775308
027754            MOVE '2850-FIND-SKU-INTR-UPC' TO PV-PARA-NAME         02775408
027755            PERFORM 9995-CSSL-LOG-RETURN                          02775508
027756                                                                  02775608
027757      END-EVALUATE                                                02775708
027758      .                                                           02775808
027759 2860-FIND-STYL-CTG.                                              02775908
027760                                                                  02776008
027761      EXEC SQL                                                    02776108
027762         SELECT DISTINCT                                          02776208
027763             A.RMS_STYL_ID                                        02776308
027764           , A.CTG_SEQ_NBR                                        02776408
027765          INTO                                                    02776508
027766             :MDARVS-RMS-STYL-ID                                  02776608
027767           , :MDARVS-CTG-SEQ-NBR                                  02776708
027768          FROM                                                    02776808
027769                TMDARVS A                                         02776908
027770          WHERE                                                   02777008
027771               A.RMS_STYL_ID   = :XLV00000-STYL-ID                02777108
027772           AND A.ACTV_IND      = 'Y'                              02777208
027773           WITH UR                                                02777308
027774      END-EXEC.                                                   02777408
027775                                                                  02777508
027776      EVALUATE TRUE                                               02777608
027777         WHEN SQLCODE = ZERO                                      02777708
027778                                                                  02777808
027779            MOVE MDARVS-CTG-SEQ-NBR TO                            02777908
027780                                SU121-CTG-SEQ-NBR (PV-ITEM-IDX)   02778008
027781                                                                  02778108
027782         WHEN SQLCODE = 100                                       02778208
027783                                                                  02778308
027784            MOVE 0           TO SU121-CTG-SEQ-NBR (PV-ITEM-IDX)   02778408
027785                                                                  02778508
027786         WHEN SQLCODE NOT = ZERO                                  02778608
027787                                                                  02778708
027788            MOVE SQLCODE                  TO PV-SQLCODE           02778808
027789            MOVE XLV00000-STYL-ID         TO PV-STYLID-DISP       02778908
027790            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02779008
027791                                                                  02779108
027792            STRING 'SELECT TMDARVS FAILED WITH SQLCODE:'          02779208
027793             PV-SQLCODE ' STYL ID:' PV-STYLID-DISP                02779308
027794                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02779408
027795                                                                  02779508
027796            MOVE '2860-FIND-STYL-CTG' TO PV-PARA-NAME             02779608
027797            PERFORM 9995-CSSL-LOG-RETURN                          02779708
027798                                                                  02779808
027799      END-EVALUATE                                                02779908
027800      .                                                           02780008
027801 2900-SELECT-TPURITM.                                             02780108
027802                                                                  02780208
027803         EXEC SQL                                                 02780308
027804           SELECT                                                 02780408
027805                UNT_COST_AMT                                      02780508
027806             INTO                                                 02780608
027807                :PURITM-UNT-COST-AMT                              02780708
027808             FROM TPURITM                                         02780808
027809             WHERE PO_NBR              = :SUT00028-TRN-NBR        02780908
027810               AND APP_PO_LNE_NBR      = :SUT00028-TRN-LNE-NBR    02781008
027811               AND VER_STATUS_CDE      = 'A'                      02781108
027812           WITH UR                                                02781208
027813         END-EXEC.                                                02781308
027814                                                                  02781408
027815      EVALUATE TRUE                                               02781508
027816         WHEN SQLCODE = ZERO                                      02781608
027817                                                                  02781708
027818            MOVE PURITM-UNT-COST-AMT                              02781808
027819                               TO SU121-UNT-COST-AMT(PV-ITEM-IDX) 02781908
027820                                                                  02782008
027821         WHEN SQLCODE = 100                                       02782108
027822                                                                  02782208
027823            MOVE 0             TO SU121-UNT-COST-AMT(PV-ITEM-IDX) 02782308
027824                                                                  02782408
027825         WHEN SQLCODE NOT = ZERO                                  02782508
027826                                                                  02782608
027827            MOVE SQLCODE                  TO PV-SQLCODE           02782708
027828            MOVE SUT00028-TRN-NBR         TO PV-PO-DISP           02782808
027829            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02782908
027830                                                                  02783008
027831            STRING 'SELECT TPURITM FAILED WITH SQLCODE:'          02783108
027832             PV-SQLCODE ' PO:' PV-PO-DISP                         02783208
027833                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02783308
027834                                                                  02783408
027835            MOVE '2900-SELECT-TPURITM ' TO PV-PARA-NAME           02783508
027836            PERFORM 9995-CSSL-LOG-RETURN                          02783608
027837                                                                  02783708
027838      END-EVALUATE                                                02783808
027839      .                                                           02783908
027840 2910-SELECT-RETAIL-AMT.                                          02784008
027841                                                                  02784108
027842         EXEC SQL                                                 02784208
027843           SELECT                                                 02784308
027844                UNT_RTL_AMT                                       02784408
027845             INTO                                                 02784508
027846                :XLV00002-UNT-RTL-AMT                             02784608
027847             FROM XLV_SKU_STR                                     02784708
027848             WHERE INTR_UPC_ID         = :XLT00006-INTR-UPC-ID    02784808
027849               AND STR_NBR             = :DK-STORE-NBR            02784908
027850           WITH UR                                                02785008
027851         END-EXEC.                                                02785108
027852                                                                  02785208
027853      EVALUATE TRUE                                               02785308
027854         WHEN SQLCODE = ZERO                                      02785408
027855                                                                  02785508
027856            MOVE XLV00002-UNT-RTL-AMT                             02785608
027857                                TO SU121-UNT-RTL-AMT(PV-ITEM-IDX) 02785708
027858                                                                  02785808
027859         WHEN SQLCODE = 100                                       02785908
027860                                                                  02786008
027861            PERFORM 2920-SELECT-RTL-CORP                          02786108
027862                                                                  02786208
027863         WHEN SQLCODE NOT = ZERO                                  02786308
027864                                                                  02786408
027865            MOVE SQLCODE                  TO PV-SQLCODE           02786508
027866            MOVE XLT00006-INTR-UPC-ID     TO PV-INT-UPC-DISP      02786608
027867            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02786708
027868                                                                  02786808
027869            STRING 'SELECT XLV_SKU_STR FAILED WITH SQLCODE:'      02786908
027870             PV-SQLCODE ' INTR UPC:' PV-INT-UPC-DISP              02787008
027871                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02787108
027872                                                                  02787208
027873            MOVE '2910-SELECT-RETAIL-AMT ' TO PV-PARA-NAME        02787308
027874            PERFORM 9995-CSSL-LOG-RETURN                          02787408
027875                                                                  02787508
027876      END-EVALUATE                                                02787608
027877      .                                                           02787708
027878 2920-SELECT-RTL-CORP.                                            02787808
027879                                                                  02787908
027880         EXEC SQL                                                 02788008
027881           SELECT                                                 02788108
027882                UNT_RTL_AMT                                       02788208
027883             INTO                                                 02788308
027884                :XLV00002-UNT-RTL-AMT                             02788408
027885             FROM XLV_SKU_STR                                     02788508
027886             WHERE INTR_UPC_ID         = :XLT00006-INTR-UPC-ID    02788608
027887               AND STR_NBR             = 0                        02788708
027888           WITH UR                                                02788808
027889         END-EXEC.                                                02788908
027890                                                                  02789008
027891      EVALUATE TRUE                                               02789108
027892         WHEN SQLCODE = ZERO                                      02789208
027893                                                                  02789308
027894            MOVE XLV00002-UNT-RTL-AMT                             02789408
027895                               TO SU121-UNT-RTL-AMT(PV-ITEM-IDX)  02789508
027896                                                                  02789608
027897         WHEN SQLCODE = 100                                       02789708
027898                                                                  02789808
027899            MOVE 0             TO SU121-UNT-RTL-AMT(PV-ITEM-IDX)  02789908
027900                                                                  02790008
027901         WHEN SQLCODE NOT = ZERO                                  02790108
027902                                                                  02790208
027903            MOVE SQLCODE                  TO PV-SQLCODE           02790308
027904            MOVE XLT00006-INTR-UPC-ID     TO PV-INT-UPC-DISP      02790408
027905            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02790508
027906                                                                  02790608
027907            STRING 'SELECT XLV_SKU_STR FAILED WITH SQLCODE:'      02790708
027908             PV-SQLCODE ' INTR UPC:' PV-INT-UPC-DISP              02790808
027909                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02790908
027910                                                                  02791008
027911            MOVE '2920-SELECT-RTL-CORP  ' TO PV-PARA-NAME         02791108
027912            PERFORM 9995-CSSL-LOG-RETURN                          02791208
027913                                                                  02791308
027914      END-EVALUATE                                                02791408
027915      .                                                           02791508
027916 2950-SELECT-COST-RETAIL.                                         02791608
027917                                                                  02791708
027918         EXEC SQL                                                 02791808
027919           SELECT                                                 02791908
027920                UNT_COST_AMT                                      02792008
027921              , UNT_RTL_AMT                                       02792108
027922             INTO                                                 02792208
027923                :XLV00002-UNT-COST-AMT                            02792308
027924              , :XLV00002-UNT-RTL-AMT                             02792408
027925             FROM XLV_SKU_STR                                     02792508
027926             WHERE INTR_UPC_ID         = :XLT00006-INTR-UPC-ID    02792608
027927               AND STR_NBR             = :DK-STORE-NBR            02792708
027928           WITH UR                                                02792808
027929         END-EXEC.                                                02792908
027930                                                                  02793008
027931      EVALUATE TRUE                                               02793108
027932         WHEN SQLCODE = ZERO                                      02793208
027933                                                                  02793308
027934            MOVE XLV00002-UNT-COST-AMT                            02793408
027935                                TO SU121-UNT-COST-AMT(PV-ITEM-IDX)02793508
027936            MOVE XLV00002-UNT-RTL-AMT                             02793608
027937                                TO SU121-UNT-RTL-AMT(PV-ITEM-IDX) 02793708
027938                                                                  02793808
027939         WHEN SQLCODE = 100                                       02793908
027940                                                                  02794008
027941            PERFORM 2960-SELECT-CORP-COST-RTL                     02794108
027942                                                                  02794208
027943         WHEN SQLCODE NOT = ZERO                                  02794308
027944                                                                  02794408
027945            MOVE SQLCODE                  TO PV-SQLCODE           02794508
027946            MOVE XLT00006-INTR-UPC-ID     TO PV-INT-UPC-DISP      02794608
027947            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02794708
027948                                                                  02794808
027949            STRING 'SELECT XLV_SKU_STR FAILED WITH SQLCODE:'      02794908
027950             PV-SQLCODE ' INTR UPC:' PV-INT-UPC-DISP              02795008
027951                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02795108
027952                                                                  02795208
027953            MOVE '2950-SELECT-COST-RETAIL ' TO PV-PARA-NAME       02795308
027954            PERFORM 9995-CSSL-LOG-RETURN                          02795408
027955                                                                  02795508
027956      END-EVALUATE                                                02795608
027957      .                                                           02795708
027958 2960-SELECT-CORP-COST-RTL.                                       02795808
027959                                                                  02795908
027960         EXEC SQL                                                 02796008
027961           SELECT                                                 02796108
027962                UNT_COST_AMT                                      02796208
027963              , UNT_RTL_AMT                                       02796308
027964             INTO                                                 02796408
027965                :XLV00002-UNT-COST-AMT                            02796508
027966              , :XLV00002-UNT-RTL-AMT                             02796608
027967             FROM XLV_SKU_STR                                     02796708
027968             WHERE INTR_UPC_ID         = :XLT00006-INTR-UPC-ID    02796808
027969               AND STR_NBR             = 0                        02796908
027970            WITH UR                                               02797008
027971         END-EXEC.                                                02797108
027972                                                                  02797208
027973      EVALUATE TRUE                                               02797308
027974         WHEN SQLCODE = ZERO                                      02797408
027975                                                                  02797508
027976            MOVE XLV00002-UNT-COST-AMT                            02797608
027977                                TO SU121-UNT-COST-AMT(PV-ITEM-IDX)02797708
027978            MOVE XLV00002-UNT-RTL-AMT                             02797808
027979                                TO SU121-UNT-RTL-AMT(PV-ITEM-IDX) 02797908
027980                                                                  02798008
027981         WHEN SQLCODE = 100                                       02798108
027982                                                                  02798208
027983            MOVE 0             TO SU121-UNT-COST-AMT(PV-ITEM-IDX) 02798308
027984                                  SU121-UNT-RTL-AMT(PV-ITEM-IDX)  02798408
027985                                                                  02798508
027986         WHEN SQLCODE NOT = ZERO                                  02798608
027987                                                                  02798708
027988            MOVE SQLCODE                  TO PV-SQLCODE           02798808
027989            MOVE XLT00006-INTR-UPC-ID     TO PV-INT-UPC-DISP      02798908
027990            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02799008
027991                                                                  02799108
027992            STRING 'SELECT XLV_SKU_STR FAILED WITH SQLCODE:'      02799208
027993             PV-SQLCODE ' INTR UPC:' PV-INT-UPC-DISP              02799308
027994                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02799408
027995                                                                  02799508
027996            MOVE '2960-SELECT-CORP-COST-RTL' TO PV-PARA-NAME      02799608
027997            PERFORM 9995-CSSL-LOG-RETURN                          02799708
027998                                                                  02799808
027999      END-EVALUATE                                                02799908
028000      .                                                           02800008
028001 3000-FIND-XFER-ID.                                               02800108
028002                                                                  02800208
028003       IF SUT00028-TRN-NBR = PV-SAVE-TRN-NBR                      02800308
028004                                                                  02800408
028005          CONTINUE                                                02800508
028006                                                                  02800608
028007       ELSE                                                       02800708
028008                                                                  02800808
028009          MOVE SUT00028-TRN-NBR    TO PV-TRN-NBR-COMP             02800908
028010                                      PV-SAVE-TRN-NBR             02801008
028011          MOVE PV-TRN-NBR-COMP     TO PV-TRN-NBR                  02801108
028012          MOVE PV-TRN-STORE        TO TFMSTR-FR-STR-NBR           02801208
028013          MOVE PV-TRN-SEQUENCE     TO TFMSTR-XFER-SEQ-NBR         02801308
028014                                                                  02801408
028015          PERFORM 3100-READ-TTFMSTR                               02801508
028016                                                                  02801608
028017       END-IF.                                                    02801708
028018                                                                  02801808
028019 3100-READ-TTFMSTR.                                               02801908
028020                                                                  02802008
028021         EXEC SQL                                                 02802108
028022           SELECT                                                 02802208
028023                XFER_DKEY_ID                                      02802308
028024              , XFER_TYP_CDE                                      02802408
028025             INTO                                                 02802508
028026                :TFMSTR-XFER-DKEY-ID                              02802608
028027              , :TFMSTR-XFER-TYP-CDE                              02802708
028028             FROM TTFMSTR                                         02802808
028029             WHERE FR_STR_NBR   = :TFMSTR-FR-STR-NBR              02802908
028030               AND XFER_SEQ_NBR = :TFMSTR-XFER-SEQ-NBR            02803008
028031            WITH UR                                               02803108
028032         END-EXEC.                                                02803208
028033                                                                  02803308
028034      EVALUATE TRUE                                               02803408
028035         WHEN SQLCODE = ZERO                                      02803508
028036                                                                  02803608
028037            MOVE TFMSTR-XFER-DKEY-ID                              02803708
028038                               TO SU121-XFER-NBR                  02803808
028039            IF TFMSTR-XFER-TYP-CDE = 05                           02803908
028040                                                                  02804008
028041               MOVE 'Y'        TO SU121-CUST-REQ-IND              02804108
028042                                                                  02804208
028043               PERFORM 3200-READ-TTFCUST                          02804308
028044                                                                  02804408
028045            ELSE                                                  02804508
028046                                                                  02804608
028047               MOVE 'N'        TO SU121-CUST-REQ-IND              02804708
028048                                                                  02804808
028049            END-IF                                                02804908
028050                                                                  02805008
028051         WHEN SQLCODE = 100                                       02805108
028052                                                                  02805208
028053            MOVE 0             TO SU121-XFER-NBR                  02805308
028054            MOVE SPACES        TO SU121-CUST-REQ-IND              02805408
028055                                  SU121-CUST-NAME                 02805508
028056                                                                  02805608
028057         WHEN SQLCODE NOT = ZERO                                  02805708
028058                                                                  02805808
028059            MOVE SQLCODE                  TO PV-SQLCODE           02805908
028060            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02806008
028061                                                                  02806108
028062            STRING 'SELECT TTFMSTR FAILED WITH SQLCODE:'          02806208
028063             PV-SQLCODE 'TRN NBR:' PV-TRN-NBR                     02806308
028064                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02806408
028065                                                                  02806508
028066            MOVE '3100-READ-TTFMSTR'      TO PV-PARA-NAME         02806608
028067            PERFORM 9995-CSSL-LOG-RETURN                          02806708
028068                                                                  02806808
028069      END-EVALUATE                                                02806908
028070      .                                                           02807008
028071 3200-READ-TTFCUST.                                               02807108
028072                                                                  02807208
028073         EXEC SQL                                                 02807308
028074           SELECT                                                 02807408
028075                CUST_NM                                           02807508
028076             INTO                                                 02807608
028077                :TFCUST-CUST-NM                                   02807708
028078             FROM TTFCUST                                         02807808
028079             WHERE XFER_DKEY_ID = :TFMSTR-XFER-DKEY-ID            02807908
028080            WITH UR                                               02808008
028081         END-EXEC.                                                02808108
028082                                                                  02808208
028083      EVALUATE TRUE                                               02808308
028084         WHEN SQLCODE = ZERO                                      02808408
028085                                                                  02808508
028086            MOVE TFCUST-CUST-NM TO SU121-CUST-NAME                02808608
028087                                                                  02808708
028088         WHEN SQLCODE = 100                                       02808808
028089                                                                  02808908
028090            MOVE SPACES         TO SU121-CUST-NAME                02809008
028091                                                                  02809108
028092         WHEN SQLCODE NOT = ZERO                                  02809208
028093                                                                  02809308
028094            MOVE SQLCODE                  TO PV-SQLCODE           02809408
028095            MOVE TFMSTR-XFER-DKEY-ID      TO PV-XFER-ID-DISP      02809508
028096            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02809608
028097                                                                  02809708
028098            STRING 'SELECT TTFCUST FAILED WITH SQLCODE:'          02809808
028099             PV-SQLCODE 'XFER ID:' PV-XFER-ID-DISP                02809908
028100                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02810008
028101                                                                  02810108
028102            MOVE '3200-READ-TTFCUST'      TO PV-PARA-NAME         02810208
028103            PERFORM 9995-CSSL-LOG-RETURN                          02810308
028104                                                                  02810408
028105      END-EVALUATE                                                02810508
028106      .                                                           02810608
028107*CHANGES START                                                    02810708
028108 4000-FIND-PARENT-CARTON.                                         02810808
028109                                                                  02810908
028110      MOVE ZEROES                TO PV-SHIPT-UNT-ID               02811008
028111                                    PV-PRNT-CART-ID.              02811108
028112      EXEC SQL                                                    02811208
028113         SELECT                                                   02811308
028114             A.MSTR_SHIPT_UNT_ID                                  02811408
028115           , A.ACTN_TYP_CDE                                       02811508
028116          INTO                                                    02811608
028117              :SUT00099-MSTR-SHIPT-UNT-ID                         02811708
028118            , :SUT00099-ACTN-TYP-CDE                              02811808
028119          FROM                                                    02811908
028120                SUT_MSTR_SHIPT_CNT A                              02812008
028121          WHERE                                                   02812108
028122               A.CHLD_SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID           02812208
028123           AND A.CRE_TMST IN                                      02812308
028124             (SELECT MAX(B.CRE_TMST)                              02812408
028125              FROM SUT_MSTR_SHIPT_CNT B                           02812508
028126              WHERE                                               02812608
028127                    A.CHLD_SHIPT_UNT_ID = B.CHLD_SHIPT_UNT_ID)    02812708
028128           WITH UR                                                02812808
028129      END-EXEC.                                                   02812908
028130                                                                  02813008
028131      EVALUATE TRUE                                               02813108
028132         WHEN SQLCODE = ZERO                                      02813208
028133                                                                  02813308
028134            IF SUT00099-ACTN-TYP-CDE = 'ACM' OR 'RTM'             02813408
028135                                                                  02813508
028136               MOVE SUT00099-MSTR-SHIPT-UNT-ID TO                 02813608
028137                                         DK-CHLD-MSTR-SHIPT-ID    02813708
028138                                         PV-PRNT-CART-ID          02813808
028139               MOVE 'N'                   TO PS-NO-MORE-MSTR-SW   02813908
028140                                                                  02814008
028141               PERFORM 4100-FIND-PRNT-CART-ID UNTIL               02814108
028142                                             PS-NO-MORE-MSTR      02814208
028143                                                                  02814308
028144            ELSE                                                  02814408
028145                                                                  02814508
028146               MOVE DK-SHIPT-UNT-ID TO PV-PRNT-CART-ID            02814608
028147                                                                  02814708
028148            END-IF                                                02814808
028149                                                                  02814908
028150         WHEN SQLCODE = +100                                      02815008
028151                                                                  02815108
028152            MOVE DK-SHIPT-UNT-ID TO PV-PRNT-CART-ID               02815208
028153                                                                  02815308
028154         WHEN SQLCODE NOT = ZERO                                  02815408
028155                                                                  02815508
028156            MOVE SQLCODE                  TO PV-SQLCODE           02815608
028157            MOVE DK-SHIPT-UNT-ID          TO PV-CARTON-DISP       02815708
028158            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02815808
028159                                                                  02815908
028160            STRING                                                02816008
028161            'SELECT SUT_MSTR_SHIPT_CNT FAILED WITH SQLCODE:'      02816108
028162             PV-SQLCODE ' CARTON:' PV-CARTON-DISP                 02816208
028163                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02816308
028164                                                                  02816408
028165            MOVE '4100-FIND-PRNT-CART-ID' TO PV-PARA-NAME         02816508
028166            PERFORM 9995-CSSL-LOG-RETURN                          02816608
028167                                                                  02816708
028168      END-EVALUATE                                                02816808
028169      .                                                           02816908
028170                                                                  02817008
028171 4100-FIND-PRNT-CART-ID.                                          02817108
028172                                                                  02817208
028173      EXEC SQL                                                    02817308
028174         SELECT                                                   02817408
028175             A.MSTR_SHIPT_UNT_ID                                  02817508
028176           , A.ACTN_TYP_CDE                                       02817608
028177          INTO                                                    02817708
028178              :SUT00099-MSTR-SHIPT-UNT-ID                         02817808
028179            , :SUT00099-ACTN-TYP-CDE                              02817908
028180          FROM                                                    02818008
028181                SUT_MSTR_SHIPT_CNT A                              02818108
028182          WHERE                                                   02818208
028183               A.CHLD_MSTR_SHIPT_ID  = :DK-CHLD-MSTR-SHIPT-ID     02818308
028184            AND A.CRE_TMST IN                                     02818408
028185             (SELECT MAX(B.CRE_TMST)                              02818508
028186              FROM SUT_MSTR_SHIPT_CNT B                           02818608
028187              WHERE                                               02818708
028188                   A.CHLD_MSTR_SHIPT_ID = B.CHLD_MSTR_SHIPT_ID)   02818808
028189           WITH UR                                                02818908
028190      END-EXEC.                                                   02819008
028191                                                                  02819108
028192      EVALUATE TRUE                                               02819208
028193         WHEN SQLCODE = ZERO                                      02819308
028194                                                                  02819408
028195            IF SUT00099-ACTN-TYP-CDE = 'AMM'                      02819508
028196                                                                  02819608
028197               MOVE SUT00099-MSTR-SHIPT-UNT-ID TO                 02819708
028198                                         DK-CHLD-MSTR-SHIPT-ID    02819808
028199                                         PV-PRNT-CART-ID          02819908
028200                                                                  02820008
028201            ELSE                                                  02820108
028202                                                                  02820208
028203               SET PS-NO-MORE-MSTR TO TRUE                        02820308
028204                                                                  02820408
028205            END-IF                                                02820508
028206                                                                  02820608
028207         WHEN SQLCODE = +100                                      02820708
028208                                                                  02820808
028209            SET PS-NO-MORE-MSTR TO TRUE                           02820908
028210                                                                  02821008
028211         WHEN SQLCODE NOT = ZERO                                  02821108
028212                                                                  02821208
028213            MOVE SQLCODE                  TO PV-SQLCODE           02821308
028214            MOVE DK-CHLD-MSTR-SHIPT-ID    TO PV-CARTON-DISP       02821408
028215            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02821508
028216                                                                  02821608
028217            STRING                                                02821708
028218            'SELECT SUT_MSTR_SHIPT_CNT FAILED WITH SQLCODE:'      02821808
028219             PV-SQLCODE ' CARTON:' PV-CARTON-DISP                 02821908
028220                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02822008
028221                                                                  02822108
028222            MOVE '4100-FIND-PRNT-CART-ID' TO PV-PARA-NAME         02822208
028223            PERFORM 9995-CSSL-LOG-RETURN                          02822308
028224                                                                  02822408
028225      END-EVALUATE                                                02822508
028226      .                                                           02822608
028227 4200-GET-TRLR-TMST.                                              02822708
028228                                                                  02822808
028229      EXEC SQL                                                    02822908
028230         SELECT                                                   02823008
028231             A.CRE_TMST                                           02823108
028232          INTO                                                    02823208
028233              :SUT00027-CRE-TMST                                  02823308
028234          FROM                                                    02823408
028235                SUT_OTBND_LOC A                                   02823508
028236          WHERE                                                   02823608
028237               A.SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID                02823708
028238           AND A.SCN_CDE        = 'SHON'                          02823808
028239           AND A.ACTV_CDE       = 'A'                             02823908
028240           WITH UR                                                02824008
028241      END-EXEC.                                                   02824108
028242                                                                  02824208
028243      EVALUATE TRUE                                               02824308
028244         WHEN SQLCODE = ZERO                                      02824408
028245                                                                  02824508
028246            MOVE SUT00027-CRE-TMST TO PV-TRLR-TMST                02824608
028247            MOVE PV-TRLR-DATE      TO PV-TMST-DATE                02824708
028248            MOVE PV-TRLR-TIME      TO PV-TMST-TIME                02824808
028249            MOVE PV-TMST           TO SU121-SML-TRLR-TMST         02824908
028250                                                                  02825008
028251         WHEN SQLCODE = +100                                      02825108
028252                                                                  02825208
028253            PERFORM 4300-GET-TRLR-DVRT-TMST                       02825308
028254                                                                  02825408
028255         WHEN SQLCODE NOT = ZERO                                  02825508
028256                                                                  02825608
028257            MOVE SQLCODE                  TO PV-SQLCODE           02825708
028258            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02825808
028259                                                                  02825908
028260            STRING 'SELECT SUT_OTBND_LOC FAILED WITH SQLCODE:'    02826008
028261             PV-SQLCODE ' CARTON:' PV-CARTON-DISP                 02826108
028262                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02826208
028263                                                                  02826308
028264            MOVE '4200-GET-TRLR-TMST' TO PV-PARA-NAME             02826408
028265            PERFORM 9995-CSSL-LOG-RETURN                          02826508
028266                                                                  02826608
028267      END-EVALUATE                                                02826708
028268      .                                                           02826808
028269 4300-GET-TRLR-DVRT-TMST.                                         02826908
028270                                                                  02827008
028271      EXEC SQL                                                    02827108
028272         SELECT A.DIVERT_TMST                                     02827208
028273           INTO :SUCRDV-DIVERT-TMST                               02827308
028274           FROM TSUCRDV A                                         02827408
028275          WHERE A.SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID               02827508
028276           AND  A.ACTV_CDE       = 'A'                            02827608
028277           AND  A.DIVERT_TMST    =                                02827708
028278              (SELECT MAX(C.DIVERT_TMST)                          02827808
028279                 FROM TSUCRDV C                                   02827908
028280                    , TSUCDOT D                                   02828008
028281                WHERE A.SHIPT_UNT_ID  = C.SHIPT_UNT_ID            02828108
028282                  AND C.ACTV_CDE      = 'A'                       02828208
028283                  AND D.OTBND_TRIP_ID = :SUT00024-OTBND-TRIP-ID   02828308
028284                  AND C.DIVERT_TMST  >= D.STRT_DIVERT_TMST        02828408
028285                  AND C.DIVERT_TMST  <= D.END_DIVERT_TMST         02828508
028286                  AND C.DOOR_ID       = D.DOOR_ID)                02828608
028287           WITH UR                                                02828700
028288      END-EXEC.                                                   02828800
028289                                                                  02828900
028290      EVALUATE TRUE                                               02829000
028291         WHEN SQLCODE = ZERO                                      02829100
028292                                                                  02829200
028293            MOVE SUCRDV-DIVERT-TMST TO PV-TRLR-TMST               02829300
028294            MOVE PV-TRLR-DATE       TO PV-TMST-DATE               02829400
028295            MOVE PV-TRLR-TIME       TO PV-TMST-TIME               02829500
028296            MOVE PV-TMST            TO SU121-SML-TRLR-TMST        02829600
028297                                                                  02829700
028298         WHEN SQLCODE = +100                                      02829800
028299                                                                  02829900
028300            MOVE SPACES             TO SU121-SML-TRLR-TMST        02830000
028301                                                                  02830100
028302         WHEN SQLCODE NOT = ZERO                                  02830200
028303                                                                  02830300
028304            MOVE SQLCODE                  TO PV-SQLCODE           02830400
028305            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     02830500
028306                                                                  02830600
028307            STRING 'SELECT TSUCRDV FAILED WITH SQLCODE:'          02830700
028308             PV-SQLCODE ' CARTON:' PV-CARTON-DISP                 02830800
028309                      DELIMITED BY SIZE INTO PV-ERROR-MSG         02830900
028310                                                                  02831000
028311            MOVE '4300-GET-TRLR-DVRT-TMST' TO PV-PARA-NAME        02831100
028312            PERFORM 9995-CSSL-LOG-RETURN                          02831200
028313                                                                  02831300
028314      END-EVALUATE.                                               02831401
028315                                                                  02831501
028316 4400-CHECK-CARTON-RECEIVED.                                      02831600
028317                                                                  02831700
028318      EXEC SQL                                                    02831800
028319          SELECT                                                  02831900
028320                  A.SHIPT_UNT_ID                                  02832000
028321            INTO                                                  02832100
028322                  :SUT00121-SHIPT-UNT-ID                          02832200
028323            FROM  SUT_OTBND_STR_SCN A                             02832300
028324           WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID              02832400
028325             AND  A.ACTV_IND      = 'Y'                           02832500
028326          WITH UR                                                 02832600
028327      END-EXEC.                                                   02832700
028328                                                                  02832800
028329      EVALUATE TRUE                                               02832900
028330         WHEN SQLCODE = ZERO                                      02833000
028331                                                                  02833100
028332            MOVE 'Y'                 TO SU121-CARTON-RECEIVED     02833200
028333                                                                  02833300
028334         WHEN SQLCODE = 100                                       02833400
028335                                                                  02833500
028336            MOVE 'N'                 TO SU121-CARTON-RECEIVED     02833600
028337                                                                  02833700
028338         WHEN SQLCODE = -811                                      02833800
028339                                                                  02833900
028340            MOVE 'Y'                 TO SU121-CARTON-RECEIVED     02834000
028341                                                                  02834100
028342         WHEN SQLCODE NOT = ZERO                                  02834200
028343                                                                  02834300
028344            MOVE SQLCODE    TO PV-SQLCODE                         02834400
028345            MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02834500
028346            STRING                                                02834600
028347             'SELECT SUT_OTBND_STR_SCAN FAILED WITH SQLCODE:'     02834700
028348                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02834800
028349                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02834900
028350                                                                  02835000
028351            MOVE '4400-CHECK-CARTON-RECEIVED' TO PV-PARA-NAME     02835100
028352            PERFORM 9995-CSSL-LOG-RETURN                          02835200
028353                                                                  02835300
028354      END-EVALUATE.                                               02835401
028355                                                                  02835501
028356 4500-FIND-TRIP-ID.                                               02835600
028357                                                                  02835700
028358      EXEC SQL                                                    02835800
028359          SELECT                                                  02835900
028360                  A.OTBND_TRIP_ID                                 02836000
028361            INTO                                                  02836100
028362                  :SUT00024-OTBND-TRIP-ID :PV-TRIP-NULL-IND       02836200
028363            FROM  SUT_OTBND_CART      A                           02836300
028364                , SUT_MSTR_SHIPT_CNT  B                           02836400
028365           WHERE  B.MSTR_SHIPT_UNT_ID = :DK-SHIPT-UNT-ID          02836500
028366             AND  A.SHIPT_UNT_ID      = B.CHLD_SHIPT_UNT_ID       02836600
028367             AND  B.ACTN_TYP_CDE      = 'ACM'                     02836700
028368             AND  B.CRE_TMST IN                                   02836800
028369                (SELECT MAX(C.CRE_TMST)                           02836900
028370                  FROM SUT_MSTR_SHIPT_CNT C                       02837000
028371                 WHERE                                            02837100
028372                    B.CHLD_SHIPT_UNT_ID = C.CHLD_SHIPT_UNT_ID)    02837200
028373             AND  A.ACTV_IND      = 'Y'                           02837300
028374             FETCH FIRST 1 ROW ONLY                               02837400
028375          WITH UR                                                 02837500
028376      END-EXEC.                                                   02837600
028377                                                                  02837700
028378      EVALUATE TRUE                                               02837800
028379         WHEN SQLCODE = ZERO                                      02837900
028380                                                                  02838000
028381            IF PV-TRIP-NULL-IND = -1                              02838100
028382                                                                  02838200
028383               MOVE 0                      TO SU121-TRIP-ID       02838300
028384                                              SU121-SHIP-NODE     02838400
028385                                              SU121-TRLR-SRL-NBR  02838500
028386               MOVE SPACES                 TO SU121-TRLR-SEAL-ID  02838600
028387                                              SU121-TRAILER-ID    02838700
028388                                              SU121-TRLR-SCAC-CDE 02838800
028389                                                                  02838900
028390            ELSE                                                  02839000
028391                                                                  02839100
028392               MOVE SUT00024-OTBND-TRIP-ID TO SU121-TRIP-ID       02839200
028393               PERFORM 2200-FIND-TRAILER-ID                       02839300
028394                                                                  02839400
028395            END-IF                                                02839500
028396                                                                  02839600
028397         WHEN SQLCODE = 100                                       02839700
028398                                                                  02839800
028399            MOVE ZERO TO DK-CHLD-MSTR-SHIPT-ID                    02839904
028400            PERFORM 4600-FIND-CHILD-MASTER                        02840000
028401                                                                  02840100
028402         WHEN SQLCODE NOT = ZERO                                  02840200
028403                                                                  02840300
028404            MOVE SQLCODE    TO PV-SQLCODE                         02840400
028405            MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02840500
028406            STRING                                                02840600
028407             'SELECT SUT_MSTR_SHIPT_CNT FAILED WITH SQLCODE:'     02840700
028408                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02840800
028409                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02840900
028410                                                                  02841000
028411            MOVE '4500-FIND-TRIP-ID'       TO PV-PARA-NAME        02841100
028412            PERFORM 9995-CSSL-LOG-RETURN                          02841200
028413                                                                  02841300
028414      END-EVALUATE                                                02841400
028415      .                                                           02841500
028416 4600-FIND-CHILD-MASTER.                                          02841600
028417                                                                  02841700
028418      EXEC SQL                                                    02841800
028419          SELECT                                                  02841900
028420                  A.CHLD_MSTR_SHIPT_ID                            02842000
028421            INTO                                                  02842100
028422                  :SUT00099-CHLD-MSTR-SHIPT-ID                    02842200
028423            FROM                                                  02842300
028424                  SUT_MSTR_SHIPT_CNT  A                           02842400
028425           WHERE  A.MSTR_SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID         02842500
028426             AND  A.CHLD_MSTR_SHIPT_ID > :DK-CHLD-MSTR-SHIPT-ID   02842600
028427             AND  A.ACTN_TYP_CDE       = 'AMM'                    02842700
028428             AND  A.CRE_TMST IN                                   02842800
028429                (SELECT MAX(B.CRE_TMST)                           02842900
028430                  FROM SUT_MSTR_SHIPT_CNT B                       02843000
028431                 WHERE                                            02843100
028432                    B.CHLD_MSTR_SHIPT_ID = A.CHLD_MSTR_SHIPT_ID)  02843205
028433             ORDER BY 1                                           02843300
028434             FETCH FIRST 1 ROW ONLY                               02843400
028435          WITH UR                                                 02843500
028436      END-EXEC.                                                   02843600
028437                                                                  02843700
028438      EVALUATE TRUE                                               02843800
028439         WHEN SQLCODE = ZERO                                      02843900
028440                                                                  02844000
028441            MOVE SUT00099-CHLD-MSTR-SHIPT-ID TO DK-SHIPT-UNT-ID   02844100
028442                                            DK-CHLD-MSTR-SHIPT-ID 02844200
028443                                                                  02844300
028444            PERFORM 4500-FIND-TRIP-ID                             02844400
028445                                                                  02844500
028446         WHEN SQLCODE = 100                                       02844600
028447                                                                  02844700
028448            MOVE 0                           TO SU121-TRIP-ID     02844800
028449                                                                  02844900
028450         WHEN SQLCODE NOT = ZERO                                  02845000
028451                                                                  02845100
028452            MOVE SQLCODE    TO PV-SQLCODE                         02845200
028453            MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02845300
028454            STRING                                                02845400
028455             'SELECT SUT_MSTR_SHIPT_CNT FAILED WITH SQLCODE:'     02845500
028456                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02845600
028457                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02845700
028458                                                                  02845800
028459            MOVE '4500-FIND-CHILD-MASTER'  TO PV-PARA-NAME        02845900
028460            PERFORM 9995-CSSL-LOG-RETURN                          02846000
028461                                                                  02846100
028462      END-EVALUATE                                                02846200
028463      .                                                           02846300
028464*CHANGES END                                                      02846400
028465                                                                  02846519
028466                                                                  02846619
028467***************************************************************   02846719
028468* CHECK IF THE CARTON WAS ORIGINALLY RECEIVED BY AN EFC       *   02846819
028469* IF CARTON WAS ALREADY RECEIVED BY AN EFC THE STORE NEEDS    *   02846920
028470* TO LOOK FOR AN ADDITIONAL SML LABEL THAT WILL HAVE A STORE  *   02847019
028471* BARCODE ON IT. THE SML FOR THE STORE WOULD HAVE BEEN CREATED*   02847119
028472* BY A CENTRAL STOCK PULL BY THE EFC.                         *   02847219
028473* DMH- 4/14/2020                                              *   02847319
028474***************************************************************   02847419
028475 5000-CHECK-EFC-RCVD.                                             02847519
028476      MOVE SU121-SML-CARTON-ID     TO DK-SHIPT-UNT-ID             02847620
028477                                      PV-CARTON-DISP.             02847720
028481                                                                  02848120
028482      EXEC SQL                                                    02848220
028483          SELECT  B.SCN_CDE                                       02848321
028487            INTO  :SUT00027-SCN-CDE                               02848720
028491            FROM  SUT_OTBND_CART A                                02849120
028492               ,  SUT_OTBND_LOC  B                                02849220
028493           WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID              02849320
028494             AND  A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                02849420
028495             AND  B.SCN_CDE       = 'ERDM'                        02849520
028496          WITH UR                                                 02849620
028497      END-EXEC.                                                   02849720
028498                                                                  02849820
028499      EVALUATE TRUE                                               02849920
028500         WHEN SQLCODE = ZERO                                      02850020
028501                                                                  02850120
028502            MOVE PC-TSYMSG-03784         TO PV-TSYMSG-NUMBER      02850220
028510            STRING 'PREVIOUSLY RCVD EFC CARTON ENTERED - SML:  '  02851020
028511                PV-CARTON-DISP     DELIMITED BY SIZE INTO         02851120
028512                                                 PV-ERROR-MSG     02851220
028513            MOVE '5000-CHECK-EFC-RCVD     ' TO PV-PARA-NAME       02851320
028514            PERFORM 9995-CSSL-LOG-RETURN                          02851420
028515                                                                  02851520
028516                                                                  02851620
028517                                                                  02851720
028518         WHEN SQLCODE = 100                                       02851820
028519                                                                  02851920
028520              continue                                            02852020
028523         WHEN SQLCODE NOT = ZERO                                  02852320
028524                                                                  02852420
028525            MOVE SQLCODE    TO PV-SQLCODE                         02852520
028526                                                                  02852620
028527            STRING 'SELECT SUT_OTBND_CART FAILED WITH SQLCODE:'   02852720
028528                   PV-SQLCODE ' SML#' PV-CARTON-DISP              02852820
028529                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02852920
028530                                                                  02853020
028531            MOVE ' 5000-CHECK-EFC-RCVD     ' TO PV-PARA-NAME      02853120
028532            PERFORM 9995-CSSL-LOG-RETURN                          02853220
028533                                                                  02853320
028534      END-EVALUATE.                                               02853420
028537                                                                  02853719
028538                                                                  02853819
028539***************************************************************   02853919
028540 5280-GET-OPC-SET-CDE.                                            02854019
028541                                                                  02854119
028542     EXEC SQL                                                     02854219
028543         SELECT G.SEASET_SHRT_NM                                  02854319
028544           INTO :SEASET-SEASET-SHRT-NM                            02854419
028545           FROM  WST_INTGRTN_TYP  A                               02854519
028546                ,WST_ATTR_DEFN    B                               02854619
028547                ,WST_ATTR_ELEM    C                               02854719
028548                ,WST_ATTR_ELEM    D                               02854819
028549                ,WST_ATTR_ELEM    E                               02854919
028550                ,WST_ATTR_ELEM    F                               02855019
028551                ,TSEASET          G                               02855119
028552                ,TPURCHS          H                               02855219
028553            WHERE A.INTGRTN_TYP_CDE   = 'OPCMFST'                 02855319
028554              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         02855419
028555              AND B.ATTR_DEFN_SEQ_NBR = 1                         02855519
028556              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         02855619
028557              AND C.ATTR_DEFN_SEQ_NBR = 1                         02855719
028558              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         02855819
028559              AND D.ATTR_DEFN_SEQ_NBR = 2                         02855919
028560              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         02856019
028561              AND E.ATTR_DEFN_SEQ_NBR = 3                         02856119
028562              AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE         02856219
028563              AND F.ATTR_DEFN_SEQ_NBR = 4                         02856319
028564              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       02856419
028565              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       02856519
028566              AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR       02856619
028567              AND C.ATTR_ELEM_TXT     = G.SEASET_TYP_CDE          02856719
028568              AND D.ATTR_ELEM_TXT     = 'ACTIVE'                  02856819
028569              AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP         02856919
028570              AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP         02857019
028571              AND G.SEASET_SHRT_NM    = H.SEASET_SHRT_NM          02857119
028572              AND G.SEASET_YR         = H.SEASET_YR               02857219
028573              AND H.PO_NBR            = :DK-PO-NBR                02857319
028574              AND H.VER_STATUS_CDE    = 'A'                       02857419
028575     END-EXEC.                                                    02857519
028576                                                                  02857619
028577     EVALUATE TRUE                                                02857719
028578         WHEN SQLCODE = ZERO                                      02857819
028579         WHEN SQLCODE = -811                                      02857919
028580             MOVE 'Y'       TO SU121-OPC-SET-IND(PV-ITEM-IDX)     02858019
028581                               PV-SAVE-OPC-SET-IND                02858119
028582                                                                  02858219
028583         WHEN SQLCODE = +100                                      02858319
028584             MOVE 'N'       TO SU121-OPC-SET-IND(PV-ITEM-IDX)     02858419
028585                               PV-SAVE-OPC-SET-IND                02858519
028586                                                                  02858619
028587         WHEN SQLWARN0 NOT = SPACES                               02858719
028588         WHEN SQLCODE < ZERO                                      02858819
028589         WHEN SQLCODE > ZERO                                      02858919
028590            MOVE SQLCODE    TO PV-SQLCODE                         02859019
028591            MOVE DK-PO-NBR  TO PV-PO-DISP                         02859119
028592            MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER      02859219
028593            STRING                                                02859319
028594             'SELECT OPC SET CODE FAILED WITH SQLCODE:'           02859419
028595                   PV-SQLCODE ' PO#' PV-PO-DISP                   02859519
028596                 DELIMITED BY SIZE INTO       PV-ERROR-MSG        02859619
028597                                                                  02859719
028598            MOVE '5280-GET-OPC-SET-CDE'    TO PV-PARA-NAME        02859819
028599            PERFORM 9995-CSSL-LOG-RETURN                          02859919
028600                                                                  02860019
028601     END-EVALUATE.                                                02860119
028602                                                                  02860219
028603 9990-CSSL-LOG.                                                   02860319
028604                                                                  02860419
028605      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     02860519
028606                                                                  02860619
028607      EXEC CICS                                                   02860719
028608           WRITEQ TD                                              02860819
028609            QUEUE   ('CSSL')                                      02860919
028610             FROM   (PV-CICS-MSG-AREA)                            02861019
028611             NOHANDLE                                             02861119
028612      END-EXEC.                                                   02861219
028613                                                                  02861319
028614* DMH 10/25/17 - BEGIN                                            02861419
028615      INITIALIZE  PV-CICS-MSG-AREA.                               02861519
028616      MOVE  SU120-CARTON-ID     TO PV-DISP-CRTN                   02861619
028617      MOVE  SU120-LAST-UPC-NBR  TO PV-DISP-UPC                    02861719
028618      STRING ' SUKCS803-'                                         02861819
028619             ' CRTN:' PV-DISP-CRTN                                02861919
028620             ' UPC:'  PV-DISP-UPC                                 02862019
028621                      DELIMITED BY SIZE                           02862119
028622                 INTO PV-CICS-MSG-AREA.                           02862219
028623                                                                  02862319
028624      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     02862419
028625                                                                  02862519
028626      EXEC CICS                                                   02862619
028627           WRITEQ TD                                              02862719
028628            QUEUE   ('CSSL')                                      02862819
028629             FROM   (PV-CICS-MSG-AREA)                            02862919
028630           LENGTH   (PV-COMMAREA-LENGTH)                          02863019
028631             RESP   (PV-CICS-RESPONSE)                            02863119
028632      END-EXEC.                                                   02863219
028633                                                                  02863319
028634* DMH 10/25/17 - BEGIN                                            02863419
028635                                                                  02863519
028636                                                                  02863619
028637 9995-CSSL-LOG-RETURN.                                            02863719
028638                                                                  02863819
028639     PERFORM 9990-CSSL-LOG.                                       02863919
028640                                                                  02864019
028641     PERFORM 9000-RETURN-TRAN.                                    02864119
028642                                                                  02864219
028643 9000-RETURN-TRAN.                                                02864319
028644                                                                  02864419
028645     MOVE PV-TSYMSG-NUMBER         TO DP507I-MSG-NUMBER           02864519
028646                                      SU121-MSG-ID.               02864619
028647                                                                  02864719
028648     PERFORM 9010-READ-SYSTEM-MESSAGE.                            02864819
028649     MOVE DP507I-MSG-TEXT          TO SU121-MSG-TEXT              02864919
028650     MOVE SU121-OUT-CARTON-DETAILS TO DFHCOMMAREA.                02865019
028651                                                                  02865119
028652     EXEC CICS RETURN END-EXEC                                    02865219
028653     .                                                            02865319
028654 9010-READ-SYSTEM-MESSAGE.                                        02865419
028655     EXEC CICS READ                                               02865519
028656               DATASET ('DPSYSMSG')                               02865619
028657               RIDFLD  (DP507I-MSG-NUMBER)                        02865719
028658               INTO    (DP507I-MESSAGES-INPUT-RECORD)             02865819
028659               RESP    (PV-CICS-RESPONSE)                         02865919
028660     END-EXEC.                                                    02866019
028700*                                                                 02870000
028800     IF  PV-CICS-RESPONSE NOT = 0                                 02880000
028900         MOVE ' ** ABEND **   UNABLE TO TRANSLATE MESSAGE NUMBER' 02890000
029000                                TO DP507I-MSG-TEXT                02900000
029100     END-IF.                                                      02910000
029200                                                                  02920000
