000100*------------------------------------------------------------     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------------------------------------------     00030000
000400 PROGRAM-ID.    EPKUT216.                                         00040001
000500 AUTHOR.        MEDHA CHOUDHURY.                                  00050000
000600 DATE-WRITTEN.  FEB 21, 2009.                                     00060002
000700                                                                  00070000
000800*------------------------------------------------------------     00080000
000810*    THIS PROGRAM WILL READ IN THE NEW CUSTOMER INCENTIVE     *   00081002
000900*    SORTED FILE AND WILL COMPARE THE MOST RECENT UPDATED         00090002
001000*    INTFC_ID WITH THE FOLLOWING RECORD AND WILL ELIMINATE        00100002
001010*    DUPLICATE UPDATES KEEPING THE MOST RECENT UPDATE.            00101002
001020*    POS 2009 FALL - PRICING INFRASTRUCTURE PROJECT WR# 35484 *   00102002
001100*------------------------------------------------------------     00110000
001200*------------------------------------------------------------ *   00120002
001300*  INPUT:                                                     *   00130002
001400*        CUST-INCTV-EXTRACT-FILE          EPRD216             *   00140002
001500*                                                             *   00150002
001600*  OUTPUT:                                                    *   00160002
001700*        CUST-INCTV-UPDATED-FILE          EPRD216             *   00170002
001800*-------------------------------------------------------------*   00180002
001900* HISTORY LOG:                                                *   00190002
002000*                                                             *   00200002
002100*-------------------------------------------------------------*   00210002
002200* DATE: FEB 21 2009                                           *   00220002
002300* WR/IR#: WR #35484                                           *   00230002
002400* PROGRAMMER: MEDHA CHOUDHURY                                 *   00240002
002500* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00250002
002600*-------------------------------------------------------------*   00260002
002700* DATE:                                                       *   00270002
002800* WR/IR#:                                                     *   00280002
002900* PROGRAMMER:                                                 *   00290002
003000* DESCRIPTION:                                                *   00300002
003100*                                                             *   00310002
003200****************************************************************  00320002
003300 ENVIRONMENT DIVISION.                                            00330002
003400****************************************************************  00340002
003500 CONFIGURATION SECTION.                                           00350002
003600 SOURCE-COMPUTER. IBM-3090.                                       00360002
003700 OBJECT-COMPUTER. IBM-3090.                                       00370002
003800                                                                  00380002
003900 INPUT-OUTPUT SECTION.                                            00390002
004000                                                                  00400002
004100 FILE-CONTROL.                                                    00410002
004200     SELECT CUST-INCTV-EXTRACT-FILE                               00420002
004300       ASSIGN TO INP01.                                           00430002
004400                                                                  00440002
004500     SELECT CUST-INCTV-UPDATED-FILE                               00450002
004600       ASSIGN TO OUT01.                                           00460002
004700                                                                  00470002
004800****************************************************************  00480002
004900 DATA DIVISION.                                                   00490002
005000****************************************************************  00500002
005100 FILE SECTION.                                                    00510002
005200                                                                  00520002
005300 FD  CUST-INCTV-EXTRACT-FILE                                      00530002
005400     RECORDING MODE IS F                                          00540002
005500     LABEL RECORDS ARE STANDARD                                   00550002
005600     DATA RECORD IS CINCTV-DATA-RECORD.                           00560002
005700                                                                  00570002
005800 01  CINCTV-DATA-RECORD                            PIC X(350).    00580002
005900*  COPYBOOK IS EPRD216                                            00590002
006000                                                                  00600002
006100 FD  CUST-INCTV-UPDATED-FILE                                      00610002
006200     RECORDING MODE IS F                                          00620002
006300     LABEL RECORDS ARE STANDARD                                   00630002
006400     DATA RECORD IS CINCTV-UPDT-RECORD.                           00640002
006500                                                                  00650002
006600 01  CINCTV-UPDT-RECORD                            PIC X(350).    00660002
006700*  COPYBOOK IS EPRD216                                            00670002
006800                                                                  00680002
006900*-------------------------------------------------------------    00690002
007000 WORKING-STORAGE SECTION.                                         00700002
007100*-------------------------------------------------------------    00710002
007200 01  AC-ABEND-CODE                  PIC S9(04) VALUE ZERO         00720002
007300                                               COMP SYNC.         00730002
007500     88  AC-4008-INVALID-EMPTY-INPUT           VALUE +4008.       00750002
007600     88  AC-4013-DB2-ERROR                     VALUE +4013.       00760002
007700                                                                  00770002
007800*-------------------------------------------------------------    00780002
007900* PC- PROGRAM CONSTANTS                                           00790002
008000*-------------------------------------------------------------    00800002
008100 01  PC-PROGRAM-CONSTANTS.                                        00810002
008200     05  PC-PROGRAM-NAME            PIC  X(08) VALUE 'EPKUT216'.  00820002
009000                                                                  00900002
009100*-------------------------------------------------------------    00910002
009200* PS- PROGRAM SWITCHES                                            00920002
009300*-------------------------------------------------------------    00930002
009400 01  PS-PROGRAM-SWITCHES.                                         00940002
009500     05  PS-END-OF-CINC-SW            PIC  X(01) VALUE 'N'.       00950002
009600         88  PS-END-OF-CINC-FILE                 VALUE 'Y'.       00960002
009700         88  PS-NOT-END-CINC-FILE                VALUE 'N'.       00970002
009710     05  PS-END-OF-CINC-UPD-SW        PIC  X(01) VALUE 'N'.       00971002
009720         88  PS-END-OF-CINC-UPD-FILE             VALUE 'Y'.       00972002
009730         88  PS-NOT-END-CINC-UPD-FILE            VALUE 'N'.       00973002
009800     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       00980002
009900         88  PS-END-OF-PROCESSING                VALUE 'Y'.       00990002
010000         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       01000002
010700                                                                  01070002
010800* ------------------------------------------------------------    01080002
010900*  COUNTERS                                                       01090002
011000* ------------------------------------------------------------    01100002
011100 01  PV-COUNTERS.                                                 01110002
011200     05  PV-CINC-RECS-READ            PIC  9(09) VALUE ZERO.      01120002
011300     05  PV-CINC-REC-WRITEN           PIC  9(09) VALUE ZERO.      01130002
011310     05  PV-DUP-REC-ELIMINATED        PIC  9(09) VALUE ZERO.      01131002
011400*-------------------------------------------------------------    01140002
011500* PV- PROGRAM VARIABLES                                           01150002
011600*-------------------------------------------------------------    01160002
011700 01  PV-PROGRAM-VARIABLES.                                        01170002
011800     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01180002
011900     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACES.    01190002
012000     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACES.    01200002
012100     05  PV-DB2-OPERATION             PIC  X(10) VALUE SPACES.    01210002
012200     05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.   01220002
012300                                                                  01230002
012310*  THIS WILL HOLD THE DATA FROM THE MOST RECENT UPDATE(READ FIRST)01231003
012400     05  PV-CUST-INCTV-KEY-RECENT.                                01240003
012500         10  PV-CUR-SYS-OF-REC-ID     PIC 9(10) VALUE ZERO.       01250002
012510         10  PV-CUR-MDSE-LNE-ID       PIC 9(10) VALUE ZERO.       01251003
012600         10  PV-CUR-STR-GRP-TYP       PIC 9(05) VALUE ZERO.       01260002
012700         10  PV-CUR-STR-GRP-ID        PIC 9(10) VALUE ZERO.       01270002
012800         10  PV-CUR-SYS-SUB-ID        PIC 9(10) VALUE ZERO.       01280002
013100                                                                  01310002
013101*  THIS WILL HOLD THE UPDATE DATA IN DESCENDING SEQUENCE          01310113
013110     05  PV-CUST-INCTV-KEY-PRIOR.                                 01311003
013120         10  PV-PRE-SYS-OF-REC-ID     PIC 9(10) VALUE ZERO.       01312003
013130         10  PV-PRE-MDSE-LNE-ID       PIC 9(10) VALUE ZERO.       01313003
013140         10  PV-PRE-STR-GRP-TYP       PIC 9(05) VALUE ZERO.       01314003
013150         10  PV-PRE-STR-GRP-ID        PIC 9(10) VALUE ZERO.       01315003
013160         10  PV-PRE-SYS-SUB-ID        PIC 9(10) VALUE ZERO.       01316003
013170                                                                  01317003
013200*-------------------------------------------------------------    01320002
013300*  COPY BOOK FOR CUSTOMER INCENTIVE EXTRACT FILE                  01330003
013400*-------------------------------------------------------------    01340002
013500     COPY EPRD216.                                                01350002
013600                                                                  01360002
013700*-------------------------------------------------------------    01370002
013800*  COPY BOOK FOR CUSTOMER INCENTIVE UPDATE FILE                   01380003
013810*  (THIS COPY WILL HOLD THE LAST UPDATED RECORD AND WILL BE       01381003
013820*   USED TO COMPARE THE NEXT RECORD READ)                         01382003
013900*-------------------------------------------------------------    01390002
014000     COPY EPRD216 REPLACING EP216 BY PV216.                       01400002
014200                                                                  01420002
014300****************************************************************  01430002
014400 PROCEDURE DIVISION.                                              01440002
014500****************************************************************  01450002
014600 0000-MAINLINE.                                                   01460002
014700                                                                  01470002
014800     PERFORM 1000-INITIALIZATION.                                 01480002
014900                                                                  01490002
015000     PERFORM 2000-PROCESS-CINCTV-FILE                             01500002
015100       UNTIL PS-END-OF-PROCESSING.                                01510002
015200                                                                  01520002
015300     PERFORM 9200-WRAPUP.                                         01530002
015400                                                                  01540002
015500     GOBACK.                                                      01550002
015600                                                                  01560002
015700*0000-EXIT.                                                       01570002
015900                                                                  01590002
016000*----------------------------------------------------------       01600002
016100* 1000-INITIALIZATION.                                            01610002
016200*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           01620002
016300*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      01630002
016400*     FILES.                                                      01640002
016500*----------------------------------------------------------       01650002
016600 1000-INITIALIZATION.                                             01660002
016700                                                                  01670002
016800     INITIALIZE PS-PROGRAM-SWITCHES.                              01680002
016900     INITIALIZE PV-PROGRAM-VARIABLES.                             01690002
017000     INITIALIZE PV-COUNTERS.                                      01700002
017100                                                                  01710002
017200     DISPLAY '****************************************'.          01720002
017300     DISPLAY '**          EPKUT216 STARTED          **'.          01730002
017400     DISPLAY '****************************************'.          01740002
017500                                                                  01750002
017600     PERFORM 1100-OPEN-FILES.                                     01760002
017700                                                                  01770002
017710     SET PS-NOT-END-CINC-FILE  TO TRUE.                           01771006
017720                                                                  01772006
017800     PERFORM 6000-READ-CUST-INCTV-EXT.                            01780002
017900                                                                  01790002
018000     IF PS-END-OF-CINC-FILE                                       01800002
018100        DISPLAY '                                    '            01810002
018200        DISPLAY '***    NO INPUT RECORDS TO PROCESS     ***'      01820002
018300        DISPLAY '                                    '            01830002
018400        SET PS-END-OF-PROCESSING TO TRUE                          01840002
018410     ELSE                                                         01841003
018420        MOVE EP216-CUST-INCTV-RECORD TO PV216-CUST-INCTV-RECORD   01842003
018430        PERFORM 6000-READ-CUST-INCTV-EXT                          01843003
018440        PERFORM 1200-CHECK-FILE-STATUS                            01844011
018500     END-IF.                                                      01850002
018600                                                                  01860002
018800*1000-EXIT.                                                       01880002
019000                                                                  01900002
019100*----------------------------------------------------------       01910002
019200* 1100-OPEN-FILES.                                                01920002
019300*     OPEN THE INPUT AND OUTPUT FILES                             01930002
019400*----------------------------------------------------------       01940002
019500 1100-OPEN-FILES.                                                 01950002
019600                                                                  01960002
019700     OPEN INPUT CUST-INCTV-EXTRACT-FILE.                          01970002
019800                                                                  01980002
019900     OPEN OUTPUT CUST-INCTV-UPDATED-FILE.                         01990002
020300                                                                  02030002
020400*1100-EXIT.                                                       02040002
020600                                                                  02060002
020601*----------------------------------------------------------       02060111
020602* 1200-CHECK-FILE-STATUS                                          02060211
020603*     OPEN THE INPUT AND OUTPUT FILES                             02060311
020604*----------------------------------------------------------       02060411
020605 1200-CHECK-FILE-STATUS.                                          02060511
020606                                                                  02060611
020607     EVALUATE TRUE                                                02060711
020608         WHEN PS-END-OF-CINC-FILE                                 02060811
020609             SET PS-END-OF-PROCESSING TO TRUE                     02060911
020610             DISPLAY ' ONLY ONE RECORD IN INPUT FILE '            02061011
020611             PERFORM 6100-WRITE-CUST-INCTV-REC                    02061111
020612         WHEN PS-NOT-END-CINC-FILE                                02061211
020613             SET PS-NOT-END-OF-PROCESSING  TO TRUE                02061311
020614     END-EVALUATE.                                                02061411
020615                                                                  02061511
020617*1200-EXIT.                                                       02061711
020619                                                                  02061911
020620*----------------------------------------------------------       02062011
020621* 2000-PROCESS-CINCTV-FILE                                        02062102
020630*     PROCESS THE INPUT RECORDS AND BASED ON THE CONDITIONS       02063002
020640*     WRITE THE DATA OUT TO EACH OF THE FOUR FILES                02064002
020650*----------------------------------------------------------       02065002
020660 2000-PROCESS-CINCTV-FILE.                                        02066002
020670                                                                  02067002
020680     PERFORM 2100-LOAD-KEY-VALUES.                                02068003
020696                                                                  02069607
020697     EVALUATE TRUE                                                02069703
020698         WHEN PV-CUST-INCTV-KEY-RECENT = PV-CUST-INCTV-KEY-PRIOR  02069803
020699            ADD 1 TO PV-DUP-REC-ELIMINATED                        02069903
020700            DISPLAY ' KEY DROPPED ' PV-CUST-INCTV-KEY-PRIOR       02070003
020701         WHEN PV-CUR-SYS-OF-REC-ID = PV-PRE-SYS-OF-REC-ID         02070108
020702          AND PV-CUR-MDSE-LNE-ID   = PV-PRE-MDSE-LNE-ID           02070208
020703          AND PV-CUR-STR-GRP-TYP   = PV-PRE-STR-GRP-TYP           02070308
020704          AND PV-CUR-STR-GRP-ID    = PV-PRE-STR-GRP-ID            02070408
020705          AND PV-CUR-SYS-SUB-ID  NOT = PV-PRE-SYS-SUB-ID          02070508
020706          AND EP216-INCTV-TYP-CDE = 'SP'                          02070608
020707            ADD 1 TO PV-DUP-REC-ELIMINATED                        02070708
020708            DISPLAY ' KEY DROPPED ' PV-CUST-INCTV-KEY-PRIOR       02070808
020709         WHEN OTHER                                               02070908
020710            PERFORM 6100-WRITE-CUST-INCTV-REC                     02071008
020711            MOVE EP216-CUST-INCTV-RECORD TO                       02071108
020712                                       PV216-CUST-INCTV-RECORD    02071208
020713     END-EVALUATE.                                                02071308
020714                                                                  02071408
020715     PERFORM 6000-READ-CUST-INCTV-EXT.                            02071508
020716                                                                  02071608
020717     IF PS-END-OF-CINC-FILE                                       02071708
020718        PERFORM 6100-WRITE-CUST-INCTV-REC                         02071808
020719        SET PS-END-OF-PROCESSING TO TRUE                          02071908
020720     END-IF.                                                      02072008
020721                                                                  02072108
020722*2000-EXIT.                                                       02072208
020724                                                                  02072408
020725*----------------------------------------------------------       02072508
020726* 2100-LOAD-KEY-VALUES.                                           02072608
020727*    THIS PARAGRAPH WILL LOAD THE TEMPORARY VARIABLE WITH THE     02072708
020728*    VALUES READ FROM THE FILE.                                   02072808
020729*----------------------------------------------------------       02072908
020730 2100-LOAD-KEY-VALUES.                                            02073008
020731                                                                  02073108
020732     MOVE PV216-SYS-OF-REC-ID       TO PV-CUR-SYS-OF-REC-ID.      02073208
020733     MOVE PV216-INCTV-MDSE-SET-ID   TO PV-CUR-MDSE-LNE-ID.        02073308
020734     MOVE PV216-STR-GRP-TYP-CDE     TO PV-CUR-STR-GRP-TYP.        02073408
020735     MOVE PV216-STR-GRP-ID          TO PV-CUR-STR-GRP-ID.         02073508
020736     MOVE PV216-SYS-REC-SUB-ID      TO PV-CUR-SYS-SUB-ID.         02073608
020737                                                                  02073708
020738     MOVE EP216-SYS-OF-REC-ID       TO PV-PRE-SYS-OF-REC-ID.      02073808
020739     MOVE EP216-INCTV-MDSE-SET-ID   TO PV-PRE-MDSE-LNE-ID.        02073908
020740     MOVE EP216-STR-GRP-TYP-CDE     TO PV-PRE-STR-GRP-TYP.        02074008
020741     MOVE EP216-STR-GRP-ID          TO PV-PRE-STR-GRP-ID.         02074108
020742     MOVE EP216-SYS-REC-SUB-ID      TO PV-PRE-SYS-SUB-ID.         02074208
020743                                                                  02074303
020744*2100-EXIT.                                                       02074403
020745 EJECT.                                                           02074503
020746                                                                  02074603
020747                                                                  02074703
020750*----------------------------------------------------------       02075003
020800* 6000-READ-CUST-INCTV-EXT.                                       02080002
020900*     READ THE INPUT CUSTOMER INCENTIVE EXTRACT FILE.             02090002
021000*----------------------------------------------------------       02100002
021100 6000-READ-CUST-INCTV-EXT.                                        02110002
021200                                                                  02120002
021300     READ CUST-INCTV-EXTRACT-FILE                                 02130002
021400         INTO EP216-CUST-INCTV-RECORD                             02140002
021500       AT END                                                     02150002
021600          SET PS-END-OF-CINC-FILE TO TRUE                         02160002
021700     END-READ                                                     02170002
021800                                                                  02180002
021900     IF PS-NOT-END-CINC-FILE                                      02190002
022000        ADD +1 TO PV-CINC-RECS-READ                               02200002
022100     END-IF.                                                      02210002
022200                                                                  02220002
022300*6000-EXIT.                                                       02230002
022500                                                                  02250002
022510*----------------------------------------------------------       02251003
022520* 6100-WRITE-CUST-INCTV-REC.                                      02252003
022530*     READ THE INPUT CUSTOMER INCENTIVE EXTRACT FILE.             02253003
022540*----------------------------------------------------------       02254003
022550 6100-WRITE-CUST-INCTV-REC.                                       02255003
022560                                                                  02256003
022570     WRITE CINCTV-UPDT-RECORD                                     02257005
022580         FROM PV216-CUST-INCTV-RECORD.                            02258003
022597                                                                  02259703
022598     ADD 1 TO PV-CINC-REC-WRITEN.                                 02259803
022599                                                                  02259903
022600*6000-EXIT.                                                       02260003
022602                                                                  02260203
022700******************************************************************02270002
022800*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *02280002
022900******************************************************************02290002
023000 9200-WRAPUP.                                                     02300002
023100     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.02310002
023200                                                                  02320002
023300     PERFORM 9920-DISPLAY-TOTALS.                                 02330002
023400                                                                  02340002
023500     DISPLAY '****************************************'.          02350002
023600     DISPLAY '**          EPKUT216 END              **'.          02360002
023700     DISPLAY '****************************************'.          02370002
023800                                                                  02380002
023900     CLOSE CUST-INCTV-EXTRACT-FILE                                02390002
023910           CUST-INCTV-UPDATED-FILE.                               02391002
024000                                                                  02400002
024600*9200-EXIT.  EXIT.                                                02460002
024700******************************************************************02470002
024800*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   02480002
024900******************************************************************02490002
025000 9910-ABEND.                                                      02500002
025100                                                                  02510002
025200     PERFORM 9920-DISPLAY-TOTALS.                                 02520002
025300                                                                  02530002
025400     DISPLAY '** ABEND           **'.                             02540002
025500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02550002
025600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02560002
025700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       02570002
025800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       02580002
025900                                                                  02590002
026000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         02600002
026100                                                                  02610002
026200*9910-EXIT.  EXIT.                                                02620002
026300******************************************************************02630002
026400*     DISPLAY END OF JOB TOTALS                                  *02640002
026500******************************************************************02650002
026600 9920-DISPLAY-TOTALS.                                             02660002
026700                                                                  02670002
026800     DISPLAY '****************************************'.          02680002
026900     DISPLAY '**     STATISTICS  FOR  CINCTV FILE   **'.          02690002
027000     DISPLAY '****************************************'.          02700002
027100                                                                  02710002
027200     DISPLAY '** CINCTV EXTRACT RECORDS READ  ====> '             02720002
027300             PV-CINC-RECS-READ                                    02730002
027400             ' **'.                                               02740002
027500     DISPLAY '** CINCTV RECORDS WRITEN ====> '                    02750002
027600             PV-CINC-REC-WRITEN                                   02760002
027700             ' **'.                                               02770002
027800     DISPLAY '** DUPLICATE RECORDS ELIMINATED ====> '             02780002
027900             PV-DUP-REC-ELIMINATED                                02790002
028000             ' **'.                                               02800002
028700     DISPLAY '****************************************'.          02870002
028800                                                                  02880002
028900*9920-EXIT.  EXIT.                                                02890002
029000                                                                  02900002
