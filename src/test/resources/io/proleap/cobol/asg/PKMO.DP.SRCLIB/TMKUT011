000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TMKUT011.                                00050000
000600 AUTHOR.                 VIRGENE LENNEMAN.                        00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            02/06/98.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM WILL CREATE A FILE OF THE NUMBER OF RECEIVERS     *00120000
001300* VERIFIED AND THE NUMBER OF RECEIVERS VERIFIED THAT WERE IN     *00130000
001400* TROUBLE FOR A VENDOR AND VENDOR/DEPARTMENT                     *00140000
001500*                                                                *00150000
001600*----------------------------------------------------------------*00160000
001700                                                                  00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000******************************************************************00200000
002100                                                                  00210000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100      SELECT EXTRACT-TRBL-FILE-IN       ASSIGN TO INP01.          00310000
003200                                                                  00320000
003300      SELECT RECEIVER-FILE-OUT          ASSIGN TO OUT01.          00330000
003400                                                                  00340000
003500******************************************************************00350000
003600 DATA DIVISION.                                                   00360000
003700******************************************************************00370000
003800                                                                  00380000
003900 FILE SECTION.                                                    00390000
004000 FD  EXTRACT-TRBL-FILE-IN                                         00400000
004100     LABEL RECORDS ARE STANDARD                                   00410000
004200     BLOCK CONTAINS 0 RECORDS                                     00420000
004300     RECORDING MODE IS F                                          00430000
004400     RECORD CONTAINS 400 CHARACTERS                               00440002
004500     DATA RECORD IS TE-TRBL-EXTRACT-RCD-IN.                       00450000
004600                                                                  00460000
004700 01  TE-TRBL-EXTRACT-RCD-IN          PIC X(400).                  00470001
004800                                                                  00480000
004900                                                                  00490000
005000 FD  RECEIVER-FILE-OUT                                            00500000
005100     LABEL RECORDS ARE STANDARD                                   00510000
005200     BLOCK CONTAINS 0 RECORDS                                     00520000
005300     RECORDING MODE IS F                                          00530000
005400     RECORD CONTAINS 50  CHARACTERS                               00540002
005500     DATA RECORD IS RECEIVER-RECORD.                              00550000
005600                                                                  00560000
005700 01  RECEIVER-RECORD                 PIC X(50).                   00570001
005800*------------------------------------------------------*          00580000
005900 WORKING-STORAGE SECTION.                                         00590000
006000*------------------------------------------------------*          00600000
006100 01 PA-PROGRAM-ACCUMULATORS.                                      00610000
041800    05  PA-VRFYD-RCVRS-VND           PIC S9(9)  COMP-3.           02420000
041800    05  PA-VRFYD-RCVRS-INTRBL-VND    PIC S9(9)  COMP-3.           02420000
041800    05  PA-VRFYD-RCVRS-DEPT          PIC S9(9)  COMP-3.           02420000
041800    05  PA-VRFYD-RCVRS-INTRBL-DEPT   PIC S9(9)  COMP-3.           02420000
041800    05  PA-PO-RECVD-QTY-VND          PIC S9(9)  COMP-3.           02420000
041800    05  PA-PO-RECVD-QTY-DEPT         PIC S9(9)  COMP-3.           02420000
041800    05  PA-PO-IN-TRBL-QTY-VND        PIC S9(9)  COMP-3.           02420000
041800    05  PA-PO-IN-TRBL-QTY-DEPT       PIC S9(9)  COMP-3.           02420000
009100                                                                  00720000
006100 01 PC-PROGRAM-CONSTANTS.                                         00610000
006200    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT011'.  00620000
006300    05 PC-DEFAULT-CC-DATE            PIC X(10) VALUE '1999-99-99'.00630000
005200    05 PC-DEFAULT-TIMESTAMP          PIC X(26) VALUE              00580205
005300                                     '9999-09-09-09.09.09.999999'.      05
006600    05 PC-A                          PIC X(01) VALUE 'A'.         00660003
006600    05 PC-T                          PIC X(01) VALUE 'T'.         00660003
007600    05 PC-VE                         PIC X(02) VALUE 'VE'.        00670003
009100                                                                  00720000
014700 01 PS-PROGRAM-SWITCHES.                                          00860000
015100    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE 'N'.     00900000
015200       88 PS-EOF                                   VALUE 'Y'.     00910000
015300       88 PS-NOT-EOF                               VALUE 'N'.     00920000
015100    05 PS-END-OF-CURSOR-SW           PIC X(01)     VALUE 'N'.     00900000
015200       88 PS-EOC                                   VALUE 'Y'.     00910000
015300       88 PS-NOT-EOC                               VALUE 'N'.     00920000
015600    05 PS-CURSOR-READ-SW             PIC X(01)     VALUE 'Y'.     00950001
015700       88 PS-CURSOR-READ-OK                        VALUE 'Y'.     00960001
015800    05 PS-FIRST-TIME-SW              PIC X(01)     VALUE 'Y'.     00970002
015900       88 PS-FIRST-TIME                            VALUE 'Y'.     00980002
016000       88 PS-NOT-FIRST-TIME                        VALUE 'N'.     00990002
015800    05 PS-TROUBLE-SW                 PIC X(01)     VALUE 'N'.     00970002
015900       88 PS-IN-TRBL                               VALUE 'Y'.     00980002
016000       88 PS-NOT-IN-TRBL                           VALUE 'N'.     00990002
018200                                                                  01060000
023600                                                                  01072106
023700 01 PV-PROGRAM-VARIABLES.                                         01073006
023800    05  PV-ABEND-CODE                PIC  9(04)    VALUE ZEROS.   01080000
029800    05  PV-PARA-NAME                 PIC  X(30)    VALUE SPACE.   01630000
030700    05  PV-BEG-DATE.                                              01720004
030800        10 PV-BEG-YYYY.                                           01730004
030900           15 PV-BEG-CC              PIC  9(02)    VALUE 0.       01740004
031000           15 PV-BEG-YY              PIC  9(02)    VALUE 0.       01750004
034700        10 FILLER                    PIC X(01)     VALUE '-'.     02120000
031100        10 PV-BEG-MM                 PIC  9(02)    VALUE 0.       01760004
034700        10 FILLER                    PIC X(01)     VALUE '-'.     02120000
031200        10 PV-BEG-DD                 PIC  9(02)    VALUE 0.       01770004
030700    05  PV-BEG-EXTRACT-DATE          PIC X(10).                   01720004
031300    05  PV-END-DATE.                                              01780000
031400        10 PV-END-YYYY.                                           01790000
031500           15 PV-END-CC              PIC  9(02)    VALUE 0.       01800000
031600           15 PV-END-YY              PIC  9(02)    VALUE 0.       01810000
034700        10 FILLER                    PIC X(01)     VALUE '-'.     02120000
031700        10 PV-END-MM                 PIC  9(02)    VALUE 0.       01820000
034700        10 FILLER                    PIC X(01)     VALUE '-'.     02120000
031800        10 PV-END-DD                 PIC  9(02)    VALUE 0.       01830000
030700    05  PV-END-EXTRACT-DATE          PIC X(10).                   01720004
035100    05  PV-DISPLAY-RSN-CDE           PIC 9(9)      VALUE ZEROS.           
035200    05  PV-ABEND-PARA-NAME           PIC X(30)     VALUE SPACE.   02160000
035300    05  PV-DB2-OPERATION-MSG-1       PIC X(40)     VALUE SPACE.   02170000
035400    05  PV-DB2-TABLE-NAME            PIC X(12)     VALUE SPACE.   02180000
035500    05  PV-SQLCODE                   PIC Z(8)9-.                  02190000
035600    05  PV-PARAGRAPH-NAME            PIC X(30)     VALUE SPACE.   02200000
035700    05  PV-CURRENT-KEY.                                           02210000
041800        10  PV-CURR-ENT              PIC S9(09) VALUE 0 COMP.     02420000
041800        10  PV-CURR-DEPT             PIC  X(03) VALUE SPACES.     02420000
035700    05  PV-PREVIOUS-KEY.                                          02210000
041800        10  PV-PREV-ENT              PIC S9(09) VALUE 0 COMP.     02420000
041800        10  PV-PREV-DEPT             PIC  X(03) VALUE SPACES.     02420000
041800    05  PV-RCVR-IN-TRBL-CNT          PIC S9(09) VALUE 0 COMP-3.   02420000
041800    05  PV-RCD-FETCH-COUNT           PIC S9(09) VALUE ZEROS.      02420000
041800    05  PV-RCD-WRITTEN               PIC S9(09) VALUE ZEROS.      02420000
041800    05  PV-CURR-PO                   PIC S9(09) VALUE 0 COMP.     02420000
041800    05  PV-PREV-PO                   PIC S9(09) VALUE 0 COMP.     02420000
041800                                                                  02420000
041800                                                                  02420000
041800                                                                  02420000
041900*** FILE LAYOUT AREA OF OUTPUT FILE                               02430000
009200 01  WS-RECEIVER-RECORD.                                          00730006
009300     05  RCV-RECEIPT-ENT-ID          PIC S9(09) COMP.             00740006
009400     05  RCV-RECEIPT-DEPT-NBR        PIC  X(03) VALUE SPACES.     00750006
009900     05  RCV-RECEIPT-RCVRS-VRFYD-QTY PIC S9(09) COMP-3.                 06
010000     05  RCV-RECEIPT-VRFYD-TRBL-QTY  PIC S9(09) COMP-3.                   
010000     05  RCV-RECEIPT-PO-RECVD-QTY    PIC S9(09) COMP-3.                   
010000     05  RCV-RECEIPT-PO-IN-TRBL-QTY  PIC S9(09) COMP-3.                   
010700     05  FILLER                      PIC  X(23) VALUE SPACES.     00840006
010800                                                                  00720000
041900*** FILE LAYOUT AREA OF TROUBLE EXTRACT FILE                      02430000
042000     COPY TMRD001.                                                02440000
042100                                                                  02450000
042200*** DB2 MESSAGE AREAS ****                                        02460000
042300     COPY DPWS004.                                                02470000
042400                                                                  02480000
042500     EXEC SQL                                                     02490000
042600          INCLUDE SQLCA                                           02500000
042700     END-EXEC.                                                    02510000
042800                                                                  02520000
042900     EXEC SQL                                                     02530000
043000          INCLUDE TTRBNTF                                         02540000
043100     END-EXEC.                                                    02550000
043110                                                                  02520000
043120     EXEC SQL                                                     02530000
043130          INCLUDE TTRBRSN                                         02540000
043140     END-EXEC.                                                    02550000
043150                                                                  02520000
043160     EXEC SQL                                                     02530000
043170          INCLUDE TRECEIV                                         02540000
043180     END-EXEC.                                                    02550000
043200                                                                  02560000
043201     EXEC SQL                                                     02530000
043202          INCLUDE TPURCHS                                         02540000
043203     END-EXEC.                                                    02550000
043204                                                                  02560000
043300     EXEC SQL                                                           00
043400          DECLARE TRECEIV-READ-CRS CURSOR FOR                     02580000
043500             SELECT A.ORD_NBR                                     02590000
043600                  , A.REC_SEQ_NBR                                 02600000
043700                  , A.IN_TRBL_TMST                                02610000
043700                  , A.IN_TRBL_HOUR_CNT                            02610000
043700                  , A.IN_TRBL_MIN_CNT                             02610000
043700                  , B.ENT_ID                                      02610000
043700                  , B.DEPT_NBR                                    02610000
043800             FROM   TRECEIV A                                     02620000
043800                  , TPURCHS B                                     02620000
043900             WHERE  A.STATUS_CDE = :PC-VE                               00
043900               AND  A.VER_STATUS_CDE =:PC-A                             00
043900               AND  B.VER_STATUS_CDE =:PC-A                             00
044000               AND  DATE(A.VERFYD_TMST)   >= :PV-BEG-EXTRACT-DATE       00
044000               AND  DATE(A.VERFYD_TMST)   <= :PV-END-EXTRACT-DATE       00
044000               AND  A.ORD_NBR        = B.PO_NBR                         00
044100             ORDER BY B.ENT_ID, B.DEPT_NBR,                       02650000
044100                      A.ORD_NBR, A.REC_SEQ_NBR                    02650000
044200     END-EXEC.                                                    02550000
044210                                                                  02560000
044330                                                                  02660000
044400 PROCEDURE DIVISION.                                              02680000
044500                                                                        00
044600 0000-MAINLINE-PROCESSING.                                        02700000
044700                                                                  02710000
044800     PERFORM 0100-INITIALIZATION.                                 02720000
044900                                                                  02730000
045000     PERFORM 0300-MAIN-LOOP                                       02740000
045100         UNTIL PS-EOC.                                            02750000
045200                                                                  02760000
045300     PERFORM 9000-END-OF-PROGRAM.                                 02770000
045400                                                                  02780000
045500     STOP RUN.                                                    02790000
045600                                                                  02820000
045700 0100-INITIALIZATION.                                             02830000
046100     OPEN INPUT  EXTRACT-TRBL-FILE-IN.                            02870000
046200     OPEN OUTPUT RECEIVER-FILE-OUT.                               02880000
046300                                                                  02890000
046300     INITIALIZE PA-PROGRAM-ACCUMULATORS                           02890000
046300                WS-RECEIVER-RECORD.                               02890000
046300                                                                  02890000
046400     PERFORM 7000-READ-INPUT-FILE.                                02900000
046500                                                                  02910000
046600     IF  PS-EOF                                                   02920000
046700         NEXT SENTENCE                                            02930000
046800     ELSE                                                         02940000
046900         MOVE TM001-BEGIN-YYYY TO PV-BEG-YYYY                     02950004
047100         MOVE TM001-BEGIN-MM   TO PV-BEG-MM                       02970004
047300         MOVE TM001-BEGIN-DD   TO PV-BEG-DD                       02990004
047500         MOVE TM001-END-YYYY   TO PV-END-YYYY                     03010004
047700         MOVE TM001-END-MM     TO PV-END-MM                       03030004
047900         MOVE TM001-END-DD     TO PV-END-DD                       03050004
047900         MOVE PV-BEG-DATE      TO PV-BEG-EXTRACT-DATE             03050004
047900         MOVE PV-END-DATE      TO PV-END-EXTRACT-DATE             03050004
048000         CLOSE EXTRACT-TRBL-FILE-IN                               03060004
048000         PERFORM 0200-OPEN-TRECEIV-CRS                            03060004
048300     END-IF.                                                      03090000
048400                                                                  03100000
059140 0200-OPEN-TRECEIV-CRS.                                           03660000
059300        EXEC SQL                                                  03680000
059400             OPEN TRECEIV-READ-CRS                                03690000
059500        END-EXEC.                                                 03700000
059600                                                                  03710000
059700        EVALUATE TRUE                                             03720000
059800           WHEN SQLCODE = ZERO                                    03730000
059900                CONTINUE                                          03740000
060000           WHEN OTHER                                             03750000
060100                MOVE '0200-OPEN-TRECEIV-CRS' TO PV-ABEND-PARA-NAME03760000
060300                MOVE 'OPEN CURSOR'       TO PV-DB2-OPERATION-MSG-103780000
060400                MOVE 'TRECEIV'           TO PV-DB2-TABLE-NAME     03790000
060500                PERFORM 9998-SQL-ABEND                            03800000
060600        END-EVALUATE.                                             03810000
060700                                                                  03820000
064800 0300-MAIN-LOOP.                                                  04230000
064900     PERFORM 0400-FETCH-TRECEIV-CRS.                              04240002
060700     IF PS-NOT-EOC                                                03820000
060700******************  SAME VENDOR AND DEPT                          03820000
060700         IF PV-CURRENT-KEY EQUAL PV-PREVIOUS-KEY                  03820000
060700             IF PV-CURR-PO EQUAL PV-PREV-PO                       03820000
060700                 PERFORM 1000-SAME-VND-DEPT                       03820000
060700             ELSE                                                 03820000
064700                 ADD +1 TO PA-PO-RECVD-QTY-VND                    04220000
064700                           PA-PO-RECVD-QTY-DEPT                   04220000
064700                 IF PS-IN-TRBL                                    04220000
064700                     ADD +1 TO PA-PO-IN-TRBL-QTY-VND              04220000
064700                               PA-PO-IN-TRBL-QTY-DEPT             04220000
064700                     SET PS-NOT-IN-TRBL TO TRUE                   04220000
064700                     MOVE PV-CURR-PO TO PV-PREV-PO                04220000
060700                     PERFORM 1000-SAME-VND-DEPT                   03820000
060700                 ELSE                                             03820000
064700                     MOVE PV-CURR-PO TO PV-PREV-PO                04220000
060700                     PERFORM 1000-SAME-VND-DEPT                   03820000
064700                 END-IF                                           04220000
064700             END-IF                                               04220000
060700         ELSE                                                     03820000
060700******************  EITHER VENDOR AND/OR DEPT CHANGED             03820000
060700             IF PS-FIRST-TIME                                     03820000
060700                 SET PS-NOT-FIRST-TIME   TO TRUE                  03820000
060700                 MOVE PV-CURR-PO TO PV-PREV-PO                    03820000
060700                 PERFORM 1000-SAME-VND-DEPT                       03820000
060700             ELSE                                                 03820000
060700                 PERFORM 1100-CHK-VENDOR                          03820000
060700             END-IF                                               03820000
060700         END-IF                                                   03820000
060700     ELSE                                                         03820000
060700         PERFORM 0500-CLOSE-TRECEIV-CRS                           03820000
060600     END-IF.                                                      03810000
060700                                                                  03820000
060800 0400-FETCH-TRECEIV-CRS.                                          03830001
061000        EXEC SQL                                                  03850001
061100          FETCH TRECEIV-READ-CRS                                  03860001
061200           INTO  :RECEIV-ORD-NBR                                  03870001
061300                ,:RECEIV-REC-SEQ-NBR                              03880001
061400                ,:RECEIV-IN-TRBL-TMST                             03890001
061400                ,:RECEIV-IN-TRBL-HOUR-CNT                         03890001
061400                ,:RECEIV-IN-TRBL-MIN-CNT                          03890001
061400                ,:PURCHS-ENT-ID                                   03890001
061400                ,:PURCHS-DEPT-NBR                                 03890001
061500        END-EXEC.                                                 03900001
061600                                                                  03910001
061700       EVALUATE TRUE                                              03920001
061800            WHEN SQLCODE = ZERO                                   03930001
061900                ADD +1                TO PV-RCD-FETCH-COUNT       03940001
061900                MOVE PURCHS-ENT-ID    TO PV-CURR-ENT              03940001
061900                MOVE PURCHS-DEPT-NBR  TO PV-CURR-DEPT             03940001
061900                MOVE RECEIV-ORD-NBR   TO PV-CURR-PO               03940001
062000            WHEN SQLCODE = +100                                   03950001
062100                SET PS-EOC            TO TRUE                     03960001
062200            WHEN OTHER                                            03970001
062300                MOVE '0400-FETCH-TRECEIV-CRS' TO                  03980001
062400                     PV-ABEND-PARA-NAME                           03990001
062500                MOVE 'FETCH TRECEIV-READ-CRS'                     04000001
062600                                         TO PV-DB2-OPERATION-MSG-104010001
062700                MOVE 'TRECEIV'           TO PV-DB2-TABLE-NAME     04020001
062800                PERFORM 9998-SQL-ABEND                            04030001
062900        END-EVALUATE.                                             04040001
063000                                                                  04050001
063100                                                                  04060001
063200 0500-CLOSE-TRECEIV-CRS.                                          04070000
063300        EXEC SQL                                                  04080000
063400            CLOSE TRECEIV-READ-CRS                                04090000
063500        END-EXEC.                                                 04100000
063600                                                                  04110000
063700        EVALUATE TRUE                                             04120000
063800           WHEN SQLCODE = ZERO                                    04130000
063900                CONTINUE                                          04140000
064000           WHEN OTHER                                             04150000
064100                MOVE '0500-CLOSE-TRECEIV-CRS' TO                  04160000
064200                     PV-ABEND-PARA-NAME                           04170000
064300                MOVE 'CLOSE CURSOR'      TO PV-DB2-OPERATION-MSG-104180000
064400                MOVE 'TRECEIV'           TO PV-DB2-TABLE-NAME     04190000
064500                PERFORM 9998-SQL-ABEND                            04200000
064600        END-EVALUATE.                                             04210000
064700                                                                  04220000
047000 1000-SAME-VND-DEPT.                                              07480000
064700     ADD +1 TO PA-VRFYD-RCVRS-VND                                 04220000
064700               PA-VRFYD-RCVRS-DEPT.                               04220000
064700     MOVE PURCHS-ENT-ID     TO RCV-RECEIPT-ENT-ID.                04220000
064700     MOVE PURCHS-DEPT-NBR   TO RCV-RECEIPT-DEPT-NBR.              04220000
064700                                                                  04220000
064700     IF RECEIV-IN-TRBL-TMST = PC-DEFAULT-TIMESTAMP                04220000
064700         AND RECEIV-IN-TRBL-HOUR-CNT = ZEROS                      04220000
064700         AND RECEIV-IN-TRBL-MIN-CNT = ZEROS                       04220000
064700         CONTINUE                                                 04220000
064700     ELSE                                                         04220000
064700         PERFORM 1200-CHK-TROUBLE                                 04220000
064700         IF PV-RCVR-IN-TRBL-CNT = 0                               04220000
064700********     SET PS-NOT-IN-TRBL TO TRUE                           04220000
064700             CONTINUE                                             04220000
064700         ELSE                                                     04220000
064700             ADD +1 TO PA-VRFYD-RCVRS-INTRBL-VND                  04220000
064700                       PA-VRFYD-RCVRS-INTRBL-DEPT                 04220000
064700             SET PS-IN-TRBL TO TRUE                               04220000
064700         END-IF                                                   04220000
064700     END-IF.                                                      04220000
064700                                                                  04220000
064700                                                                  04220000
064700     MOVE PV-CURRENT-KEY    TO PV-PREVIOUS-KEY.                   04220000
064700                                                                  04220000
064700 1100-CHK-VENDOR.                                                 07480000
064700     IF PV-CURR-ENT = PV-PREV-ENT                                 04220000
064700******************  SAME VENDOR, MUST BE NEW DEPARTMENT           03820000
064700         PERFORM 1110-CHK-DEPT                                    04220000
064700     ELSE                                                         04220000
064700******************  DIFFERENT VENDOR AND DEPARTMENT               03820000
064700         ADD +1 TO PA-PO-RECVD-QTY-VND                            04220000
064700                   PA-PO-RECVD-QTY-DEPT                           04220000
064700         IF PS-IN-TRBL                                            04220000
064700             ADD +1 TO PA-PO-IN-TRBL-QTY-VND                      04220000
064700                       PA-PO-IN-TRBL-QTY-DEPT                     04220000
064700             SET PS-NOT-IN-TRBL TO TRUE                           04220000
064700         END-IF                                                   04220000
064700         MOVE PV-CURR-PO TO PV-PREV-PO                            04220000
064700         PERFORM 8000-WRITE-VND-DEPT-RECS                         04220000
064700         PERFORM 1300-RESET-VND                                   04220000
064700         PERFORM 1400-RESET-DEPT                                  04220000
064700         PERFORM 1000-SAME-VND-DEPT                               04220000
064700     END-IF.                                                      04220000
064700                                                                  04220000
064700 1110-CHK-DEPT.                                                   04220000
064700     IF PV-CURR-DEPT = PV-PREV-DEPT                               04220000
064700******************  SAME DEPARTMENT WITHIN VENDOR                 03820000
064700         CONTINUE                                                 04220000
064700     ELSE                                                         04220000
064700******************  DIFFERENT DEPARTMENT WITHIN VENDOR            03820000
064700         ADD +1 TO PA-PO-RECVD-QTY-VND                            04220000
064700                   PA-PO-RECVD-QTY-DEPT                           04220000
064700         IF PS-IN-TRBL                                            04220000
064700             ADD +1 TO PA-PO-IN-TRBL-QTY-VND                      04220000
064700                       PA-PO-IN-TRBL-QTY-DEPT                     04220000
064700             SET PS-NOT-IN-TRBL TO TRUE                           04220000
064700         END-IF                                                   04220000
064700         MOVE PV-CURR-PO TO PV-PREV-PO                            04220000
064700         MOVE PA-VRFYD-RCVRS-DEPT TO RCV-RECEIPT-RCVRS-VRFYD-QTY  04220000
064700         MOVE PA-VRFYD-RCVRS-INTRBL-DEPT TO                       04220000
064700                                     RCV-RECEIPT-VRFYD-TRBL-QTY   04220000
064700         MOVE PA-PO-RECVD-QTY-DEPT TO RCV-RECEIPT-PO-RECVD-QTY    04220000
064700         MOVE PA-PO-IN-TRBL-QTY-DEPT TO                           04220000
064700                                     RCV-RECEIPT-PO-IN-TRBL-QTY   04220000
064700         PERFORM 8500-WRITE-OUTPUT-FILE                           04220000
064700         PERFORM 1400-RESET-DEPT                                  04220000
064700         PERFORM 1000-SAME-VND-DEPT                               04220000
064700     END-IF.                                                      04220000
064700                                                                  04220000
064700                                                                  04220000
064700 1200-CHK-TROUBLE.                                                07480000
064700     EXEC SQL                                                     04220000
064700         SELECT COUNT (*)                                         04220000
064700           INTO :PV-RCVR-IN-TRBL-CNT                              04220000
064700           FROM TTRBNTF A                                         04220000
064700              , TTRBRSN B                                         04220000
064700          WHERE (A.PO_NBR       = :RECEIV-ORD-NBR                 04220000
064700            AND A.REC_SEQ_NBR  = :RECEIV-REC-SEQ-NBR              04220000
064700            AND A.TRBL_RSN_CDE = B.TRBL_RSN_CDE                   04220000
064700            AND B.NOTIF_IND    = :PC-T)                           04220000
064700     END-EXEC.                                                    04040001
064700                                                                  04220000
064700           EVALUATE TRUE                                          03920001
064700               WHEN SQLCODE = ZERO                                03930001
064700                   CONTINUE                                       03940001
064700               WHEN OTHER                                         03970001
064700                   MOVE '1200-CHK-TROUBLE' TO PV-ABEND-PARA-NAME  03980001
064700                   MOVE 'COUNT TROUBLE' TO PV-DB2-OPERATION-MSG-1 04000001
064700                   MOVE 'TTRBNTF'          TO PV-DB2-TABLE-NAME   04020001
064700                   PERFORM 9998-SQL-ABEND                         04030001
064700           END-EVALUATE.                                          04040001
063000                                                                  04050001
064700 1300-RESET-VND.                                                  04220000
064700     INITIALIZE PA-VRFYD-RCVRS-VND                                04220000
064700                PA-VRFYD-RCVRS-INTRBL-VND                         04220000
064700                PA-PO-RECVD-QTY-VND                               04220000
064700                PA-PO-IN-TRBL-QTY-VND.                            04220000
064700                                                                  04220000
064700 1400-RESET-DEPT.                                                 04220000
064700     INITIALIZE PA-VRFYD-RCVRS-DEPT                               04220000
064700                PA-VRFYD-RCVRS-INTRBL-DEPT                        04220000
064700                PA-PO-RECVD-QTY-DEPT                              04220000
064700                PA-PO-IN-TRBL-QTY-DEPT.                           04220000
064700                                                                  04220000
064700                                                                  04220000
047000 7000-READ-INPUT-FILE.                                            07480000
147200      READ EXTRACT-TRBL-FILE-IN INTO TM001-TROUBLE-EXT-RECORD     07500000
147400           AT END  SET PS-EOF TO TRUE.                            07520000
147700                                                                  07550000
148300                                                                  07610000
064700 8000-WRITE-VND-DEPT-RECS.                                        04220000
064700         MOVE PV-PREV-ENT         TO RCV-RECEIPT-ENT-ID.          04220000
064700         MOVE PV-PREV-DEPT        TO RCV-RECEIPT-DEPT-NBR.        04220000
064700         MOVE PA-VRFYD-RCVRS-DEPT TO RCV-RECEIPT-RCVRS-VRFYD-QTY. 04220000
064700         MOVE PA-VRFYD-RCVRS-INTRBL-DEPT TO                       04220000
064700                                     RCV-RECEIPT-VRFYD-TRBL-QTY.  04220000
064700         MOVE PA-PO-RECVD-QTY-DEPT TO RCV-RECEIPT-PO-RECVD-QTY.   04220000
064700         MOVE PA-PO-IN-TRBL-QTY-DEPT TO                           04220000
064700                                     RCV-RECEIPT-PO-IN-TRBL-QTY.  04220000
064700         PERFORM 8500-WRITE-OUTPUT-FILE.                          04220000
064700         MOVE PV-PREV-ENT         TO RCV-RECEIPT-ENT-ID.          04220000
064700         MOVE ZEROS        TO RCV-RECEIPT-DEPT-NBR.               04220000
064700         MOVE PA-VRFYD-RCVRS-VND TO RCV-RECEIPT-RCVRS-VRFYD-QTY.  04220000
064700         MOVE PA-VRFYD-RCVRS-INTRBL-VND TO                        04220000
064700                                     RCV-RECEIPT-VRFYD-TRBL-QTY.  04220000
064700         MOVE PA-PO-RECVD-QTY-VND  TO RCV-RECEIPT-PO-RECVD-QTY.   04220000
064700         MOVE PA-PO-IN-TRBL-QTY-VND TO                            04220000
064700                                     RCV-RECEIPT-PO-IN-TRBL-QTY.  04220000
064700         PERFORM 8500-WRITE-OUTPUT-FILE.                          04220000
064700                                                                  04220000
064700                                                                  04220000
148400                                                                  07620000
148500 8500-WRITE-OUTPUT-FILE.                                          07630000
148700         WRITE RECEIVER-RECORD FROM  WS-RECEIVER-RECORD.          07650000
149000         ADD +1 TO PV-RCD-WRITTEN.                                07660206
149200         INITIALIZE WS-RECEIVER-RECORD.                           07680000
149200                                                                  07680000
149300 9000-END-OF-PROGRAM.                                             07690000
149400******* WRITE OUT LAST VENDOR/DEPT RECORDS                        07700000
150100     PERFORM 8000-WRITE-VND-DEPT-RECS.                                  03
150200                                                                  07700000
150300     CLOSE RECEIVER-FILE-OUT.                                     07710000
150500                                                                          
150600     DISPLAY '**  RECORDS READ =========== '                              
150700             PV-RCD-FETCH-COUNT.                                          
151200     DISPLAY '**  RECORDS WRITTEN ======== '                              
151300             PV-RCD-WRITTEN.                                              
151600                                                                        02
152100 9998-SQL-ABEND.                                                  07740000
152200     MOVE SQLCODE     TO PV-SQLCODE.                              07750000
152300     DISPLAY '** ABEND           ** = SQLABEND'.                  07760000
152400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          07770000
152500     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME        07780000
152600     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        07790000
152700     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   07800000
152800     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               07810000
152900     COPY DPPD004.                                                07820000
153000                                                                  07830000
153100     MOVE +4013                  TO PV-ABEND-CODE.                07840000
153200     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       07850000
153300                                                                  07860000
153400*********** END OF TMKUT011 SOURCE CODE ************************* 07870000
