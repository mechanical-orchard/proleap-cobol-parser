000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400                                                                  00040099
000500 PROGRAM-ID.             ARKUT093.                                00050099
000600 AUTHOR.                 LIHUA LIANG.                             00060099
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070099
000800 DATE-WRITTEN.           12-26-2005.                              00080099
000900 DATE-COMPILED.                                                   00090099
001000                                                                  00100099
001100******************************************************************00110099
001200*         ***  THIS PROGRAM IS COPIED FROM ARKUT090  ***         *00120099
001300*  IT HAS BEEN MODIFIED TO REMOVE THE CONSOLIDATION OF E-COMM    *00130099
001400*  PURCHASES INTO A SINGLE STORE NUMBER.  THIS WAS DONE SO THAT  *00140099
001500*  THE TAX AUDIT AND REPORTS WOULD NOT BE CONSOLIDATED.  ANY     *00150099
001600*  CHANGES MADE TO ARKUT090 SHOULD ALSO BE MADE TO THIS PROGRAM. *00160099
001700******************************************************************00170099
001800                                                                  00180099
001900******************************************************************00190099
002000*       THIS PROGRAM WILL SEQUENTIALLY PROCESS EDITED A/R        *00200099
002100*  TRANSACTIONS, AND REFORMAT THEM INTO THE FORMAT REQUIRED BY   *00210099
002200*  SELECT.  TWO FILES ARE CREATED TO BE SENT TO THE SELECT       *00220099
002300*  SYSTEM:  A SALES CHECK DETAIL FILE, AND A TRANSACTION POSTING *00230099
002400*  FILE.                                                         *00240099
002500******************************************************************00250099
002600*  10/18/2012 TY HOPP - REMOVED 'IF' STATEMENT TO ALLOW PASSING   00260099
002700*             OF A RETURN PRICE SALES ADJUSTMENT 8165.            00270099
002800*             CHANGE MARKED TDH001.                               00280099
002900******************************************************************00290099
003000*  11/15/2012 COGNIZANT                                           00300099
003100*             REPLACED AR001-TRANSACTION-DATE WITH AR001-TRN-DTE  00310099
003200*             IN 2110-CREATE-HEADER AND 2300-PROCESS-POSTING-ONLY 00320099
003300*             WHICH IS NEWLY ADDED FIELD IN ARRD001 COPY BOOK.    00330099
003400******************************************************************00340099
003500*  01/31/2013 TY HOPP                                             00350099
003600*             INCREASE CD-CLASS-IDX AND PC-MAX-DEPT-CLASSES TO    00360099
003700*             40000.  CHANGE MARKED TDH002.                       00370099
003800******************************************************************00380099
003900* 06/20/2013 JOE GARDETTO                                         00390099
004000*    -ADDED LOGIC TO USE THE NEWLY ADDED EMPLOYEE DISCOUNT        00400099
004100*     SOURCE CODE ON THE INPUT AR FILE TO BYPASS RECALCULATING    00410099
004200*     TAXES WHEN THE DISCOUT SOURCE IS P FOR POS.                 00420099
004300*     (JPGFX1)                                                    00430099
004400*    -ADDED LOGIC TO INCLUDE ORDER NUMBER IN THE BREAK LOGIC      00440099
004500*     FOR PROCESSING A NEW TRANSACTION.                           00450099
004600*     (JPGFX3)                                                    00460099
004700******************************************************************00470099
004800* 10/02/2013 JOE GARDETTO                                         00480099
004900*    -ADDED LOGIC TO PREVENT ZERO TAX ITEMS FROM BEING ADDED TO   00490099
005000*     THE TAX AUDIT FILE.  THIS WAS CAUSING TXKUT009 TO ABEND     00500099
005100*     IN JOB TXK030. (JPGFX4)                                     00510099
005200******************************************************************00520099
005300* 11/11/2013 JOE GARDETTO                                         00530099
005400*    -ADDED LOGIC TO PREVENT TRANSACTIONS WHERE ASSOCIATE DISCOUNT00540099
005500*     IS TAKEN AT POS FROM BEING INCLUDED ON THE TAX AUDIT FILE.  00550099
005600*     (JPGFX5) CHG0070860                                         00560099
005700******************************************************************00570099
005800* 02/17/2014 COGNIZANT                                            00580099
005900*    -INCREASED RECORD LENGTH OF INPUT FILE TO 311. SINCE THE     00590099
006000*     COPYBOOK ARRD001 IS MODIFIED AND ADDED WITH ADDITIONAL      00600099
006100*     FIELDS.                                                     00610099
006200******************************************************************00620099
006300* 06/20/2014 BARB SCHULTZ - ADDED A TABLE FOR THE ZIP CODE FOR    00630099
006400*     EACH STORE AND MOVED THAT ZIP CODE TO THE TAX FILE IF       00640099
006500*     ITS A BOPUS TRANSACTION.                                    00650099
006600******************************************************************00660099
006700* 10/23/2014 JOE GARDETTO                                         00670099
006800*     CHG0086844                                                  00680099
006900*    -CHANGE LOGIC THAT CHECKS EMPL DISCOUNT SOURCE TO CHECK EACH 00690099
007000*     LINE ITEM.                                                  00700099
007100*    -CHANGE LOGIC FOR STATE ROUNDING METHOD TO USE STATE CODE ON 00710099
007200*     INPUT FILE WHEN AVAILABLE.                                  00720099
007300*    -CHANGE LOGIC TO INITIALIZE PT-TAX-RATE-TABLE AND            00730099
007400*     PV-TRAN-TAX-RT-CTR FOR EACH LINE ITEM ON ECOM ORDERS TO     00740099
007500*     PREVENT ROUNDING DIFFERENCE WITH ARKUT093.                  00750099
007600*    -REMOVED LOGIC FOR CHECK DETAIL FILE. NOT USED IN THIS PGM.  00760099
007700******************************************************************00770099
007800* 01/08/2015 BARB SCHULTZ - DO NOT WRITE OUT A TAX RECORD FOR     00780099
007900*     WAYFAIR ITEMS.                                              00790099
008000******************************************************************00800099
008100* 06/17/2015 KUNDAN PAUL                                          00810099
008200*     CHG0114621                                                  00820099
008300*    -ADDED A SIX DIGIT BIN NUMBER BEFORE ACCOUNT NUMBER TO       00830099
008400*     HANDLE BOTH 12 DIGIT AND 18 DIGIT ACCOUNT NUMBER            00840099
008500******************************************************************00850099
008600* 10/16/2015 MADHURA PETHE                                        00860099
008700*     CHG0125942                                                  00870099
008800*    -FIXING INC2055729                                           00880099
008900*     APPLE PAY TRANSACTIONS ARE NOT SHOWING UP ON ARK080 REPORT  00890099
009000******************************************************************00900099
009100* 01/09/2017 BARB SCHULTZ                                         00910099
009200*     CHG0160001                                                  00920099
009300*    -CHANGE LENGTH OF INPUT FILE TO 385 FROM 311.                00930099
009400*    -ADDED PARAGRAPH 2295-PROCESS-FEE-ITEM.                      00940099
009500*    -MOVED AR001-FEE-PRD-CDE TO TX006-TAXWARE-PROD-CDE           00950099
009600*    -CHANGED AR001-NET-CHARGED-AMOUNT TO AR001-SBJCT-TO-TAX-AMT  00960099
009700*        IN NUMEROUS PLACES                                       00970099
009800******************************************************************00980099
009900 ENVIRONMENT DIVISION.                                            00990099
010000******************************************************************01000099
010100                                                                  01010099
010200 CONFIGURATION SECTION.                                           01020099
010300                                                                  01030099
010400 SOURCE-COMPUTER.        IBM-3090.                                01040099
010500 OBJECT-COMPUTER.        IBM-3090.                                01050099
010600                                                                  01060099
010700 INPUT-OUTPUT SECTION.                                            01070099
010800                                                                  01080099
010900 FILE-CONTROL.                                                    01090099
011000                                                                  01100099
011100     SELECT AR-TRANSACTION-FILE                                   01110099
011200         ASSIGN TO INP01.                                         01120099
011300                                                                  01130099
011400     SELECT POSTING-TRANS-FILE-1                                  01140099
011500         ASSIGN TO OUT02.                                         01150099
011600                                                                  01160099
011700     SELECT POSTING-TRANS-FILE-2                                  01170099
011800         ASSIGN TO OUT03.                                         01180099
011900                                                                  01190099
012000     SELECT POSTING-TRANS-FILE-3                                  01200099
012100         ASSIGN TO OUT04.                                         01210099
012200                                                                  01220099
012300     SELECT POSTING-TRANS-FILE-4                                  01230099
012400         ASSIGN TO OUT05.                                         01240099
012500                                                                  01250099
012600     SELECT POSTING-TRANS-FILE-5                                  01260099
012700         ASSIGN TO OUT06.                                         01270099
012800                                                                  01280099
012900     SELECT POSTING-TRANS-FILE-6                                  01290099
013000         ASSIGN TO OUT07.                                         01300099
013100                                                                  01310099
013200     SELECT POSTING-TRANS-FILE-7                                  01320099
013300         ASSIGN TO OUT08.                                         01330099
013400                                                                  01340099
013500     SELECT POSTING-TRANS-FILE-8                                  01350099
013600         ASSIGN TO OUT09.                                         01360099
013700                                                                  01370099
013800******************************************************************01380099
013900 DATA DIVISION.                                                   01390099
014000******************************************************************01400099
014100                                                                  01410099
014200 FILE SECTION.                                                    01420099
014300                                                                  01430099
014400 FD  AR-TRANSACTION-FILE                                          01440099
014500     RECORDING MODE IS F                                          01450099
014600     LABEL RECORDS ARE STANDARD                                   01460099
014700     BLOCK CONTAINS 0 RECORDS                                     01470099
014800     RECORD CONTAINS 385 CHARACTERS                               01480099
014900     DATA RECORD IS AT-AR-TRANSACTION-RECORD.                     01490099
015000                                                                  01500099
015100 01  AT-AR-TRANSACTION-RECORD    PIC X(385).                      01510099
015200                                                                  01520099
015300 FD  POSTING-TRANS-FILE-1                                         01530099
015400     RECORDING MODE IS F                                          01540099
015500     LABEL RECORDS ARE STANDARD                                   01550099
015600     BLOCK CONTAINS 0 RECORDS                                     01560099
015700     RECORD CONTAINS 157 CHARACTERS.                              01570099
015800                                                                  01580099
015900 01  POSTING-TRANS-RECORD-1      PIC X(157).                      01590099
016000                                                                  01600099
016100 FD  POSTING-TRANS-FILE-2                                         01610099
016200     RECORDING MODE IS F                                          01620099
016300     LABEL RECORDS ARE STANDARD                                   01630099
016400     BLOCK CONTAINS 0 RECORDS                                     01640099
016500     RECORD CONTAINS 157 CHARACTERS.                              01650099
016600                                                                  01660099
016700 01  POSTING-TRANS-RECORD-2      PIC X(157).                      01670099
016800                                                                  01680099
016900 FD  POSTING-TRANS-FILE-3                                         01690099
017000     RECORDING MODE IS F                                          01700099
017100     LABEL RECORDS ARE STANDARD                                   01710099
017200     BLOCK CONTAINS 0 RECORDS                                     01720099
017300     RECORD CONTAINS 157 CHARACTERS.                              01730099
017400                                                                  01740099
017500 01  POSTING-TRANS-RECORD-3      PIC X(157).                      01750099
017600                                                                  01760099
017700 FD  POSTING-TRANS-FILE-4                                         01770099
017800     RECORDING MODE IS F                                          01780099
017900     LABEL RECORDS ARE STANDARD                                   01790099
018000     BLOCK CONTAINS 0 RECORDS                                     01800099
018100     RECORD CONTAINS 157 CHARACTERS.                              01810099
018200                                                                  01820099
018300 01  POSTING-TRANS-RECORD-4      PIC X(157).                      01830099
018400                                                                  01840099
018500 FD  POSTING-TRANS-FILE-5                                         01850099
018600     RECORDING MODE IS F                                          01860099
018700     LABEL RECORDS ARE STANDARD                                   01870099
018800     BLOCK CONTAINS 0 RECORDS                                     01880099
018900     RECORD CONTAINS 157 CHARACTERS.                              01890099
019000                                                                  01900099
019100 01  POSTING-TRANS-RECORD-5      PIC X(157).                      01910099
019200                                                                  01920099
019300 FD  POSTING-TRANS-FILE-6                                         01930099
019400     RECORDING MODE IS F                                          01940099
019500     LABEL RECORDS ARE STANDARD                                   01950099
019600     BLOCK CONTAINS 0 RECORDS                                     01960099
019700     RECORD CONTAINS 157 CHARACTERS.                              01970099
019800                                                                  01980099
019900 01  POSTING-TRANS-RECORD-6      PIC X(157).                      01990099
020000                                                                  02000099
020100 FD  POSTING-TRANS-FILE-7                                         02010099
020200     RECORDING MODE IS F                                          02020099
020300     LABEL RECORDS ARE STANDARD                                   02030099
020400     BLOCK CONTAINS 0 RECORDS                                     02040099
020500     RECORD CONTAINS 157 CHARACTERS.                              02050099
020600                                                                  02060099
020700 01  POSTING-TRANS-RECORD-7      PIC X(157).                      02070099
020800                                                                  02080099
020900 FD  POSTING-TRANS-FILE-8                                         02090099
021000     RECORDING MODE IS F                                          02100099
021100     LABEL RECORDS ARE STANDARD                                   02110099
021200     BLOCK CONTAINS 0 RECORDS                                     02120099
021300     RECORD CONTAINS 157 CHARACTERS.                              02130099
021400                                                                  02140099
021500 01  POSTING-TRANS-RECORD-8      PIC X(157).                      02150099
021600                                                                  02160099
021700 WORKING-STORAGE SECTION.                                         02170099
021800                                                                  02180099
021900*                                                                 02190099
022000*  ACCOUNTS RECEIVABLE TRANSACTION FILE RECORD LAYOUT             02200099
022100*                                                                 02210099
022200                                                                  02220099
022300     COPY ARRD001.                                                02230099
022400                                                                  02240099
022500*                                                                 02250099
022600*  POSTING TRANSACTION FILE                                       02260099
022700*                                                                 02270099
022800                                                                  02280099
022900     COPY ARRD021.                                                02290099
023000                                                                  02300099
023100*                                                                 02310099
023200*  AR CONSTANTS                                                   02320099
023300*                                                                 02330099
023400                                                                  02340099
023500     COPY ARWS004.                                                02350099
023600                                                                  02360099
023700*                                                                 02370099
023800*  PARAMETER LIST FOR THE CALENDAR SUBROUTINE (DPKUT500)          02380099
023900*                                                                 02390099
024000                                                                  02400099
024100     COPY DPWS500.                                                02410099
024200                                                                  02420099
024300*                                                                 02430099
024400*  VARIABLES TO FORMAT SQLCA                                      02440099
024500*                                                                 02450099
024600                                                                  02460099
024700     COPY DPWS004.                                                02470099
024800                                                                  02480099
024900 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          02490099
025000                                              COMP SYNC.          02500099
025100     88  AC-INVLD-DATA-ON-DATASET-ERROR       VALUE +4008.        02510099
025200     88  AC-DB2-ERROR                         VALUE +4013.        02520099
025300                                                                  02530099
025400 01  PS-PROGRAM-SWITCHES.                                         02540099
025500     05  PS-END-OF-TRANS-FILE-IND                                 02550099
025600                                 PIC X(1)     VALUE 'N'.          02560099
025700         88  PS-END-OF-TRANS-FILE             VALUE 'Y'.          02570099
025800     05  PS-FIRST-RECORD-IND     PIC X(1)     VALUE 'Y'.          02580099
025900         88  PS-FIRST-RECORD                  VALUE 'Y'.          02590099
026000         88  PS-NOT-FIRST-RECORD              VALUE 'N'.          02600099
026100     05  PS-END-OF-CLASS-CURSOR-IND                               02610099
026200                                 PIC X(1)     VALUE 'N'.          02620099
026300         88  PS-END-OF-CLASS-CURSOR           VALUE 'Y'.          02630099
026400     05  PS-END-OF-STORE-CURSOR-IND                               02640099
026500                                 PIC X(1)     VALUE 'N'.          02650099
026600         88  PS-END-OF-STORE-CURSOR           VALUE 'Y'.          02660099
026700     05  PS-END-OF-STR-CURSOR-IND                                 02670099
026800                                 PIC X(1)     VALUE 'N'.          02680099
026900         88  PS-END-OF-STR-CURSOR             VALUE 'Y'.          02690099
027000     05  PS-RATE-MATCH-SW        PIC X(01)    VALUE 'N'.          02700099
027100         88  PS-RATE-MATCH-FOUND              VALUE 'Y'.          02710099
027200         88  PS-RATE-NOT-FOUND                VALUE 'N'.          02720099
027300     05  PS-EMPLOYEE-DISC-CALC-SW    PIC X(1) VALUE SPACE.        02730099
027400         88  PS-EMPLOYEE-DISC-NOT-CALC        VALUE 'N'.          02740099
027500         88  PS-EMPLOYEE-DISC-CALC            VALUE 'Y'.          02750099
027600     05  PS-ASSOC-CASH-SW            PIC X(1) VALUE SPACE.        02760099
027700         88  PS-ASSOC-CASH                    VALUE 'Y'.          02770099
027800         88  PS-NOT-ASSOC-CASH                VALUE 'N'.          02780099
027900     05  PS-END-OF-STR-TABLE-SWITCH PIC X(1)  VALUE 'N'.          02790099
028000         88  PS-NOT-END-OF-STR-TABLE          VALUE 'N'.          02800099
028100         88  PS-END-OF-STR-TABLE              VALUE 'Y'.          02810099
028200     05  PS-H-CARD-NO-RECEIVED       PIC   X(01).                 02820099
028300         88  PS-H-RECEIVED-18-DIGIT-NO        VALUE 'T'.          02830099
028400         88  PS-H-RECEIVED-12-DIGIT-NO        VALUE 'Y'.          02840099
028500         88  PS-H-RECEIVED-10-DIGIT-NO        VALUE 'N'.          02850099
028600                                                                  02860099
028700 01  PC-PROGRAM-CONSTANTS.                                        02870099
028800     05  PC-NBR-OF-POST-FILES    PIC 9(2)     VALUE 8.            02880099
028900     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'ARKUT093'.   02890099
029000*TDH002                                                           02900099
029100*    05  PC-MAX-DEPT-CLASSES     PIC 9(5)     VALUE 20000.        02910099
029200     05  PC-MAX-DEPT-CLASSES     PIC 9(5)     VALUE 40000.        02920099
029300     05  PC-MAX-TRAN-TAX-RATES   PIC 9(5)     VALUE 20.           02930099
029400     05  PC-SALES-CHECK-DETAIL-LENGTHS.                           02940099
029500         10  PC-SCD-HEADER-LENGTH                                 02950099
029600                                 PIC 9(4)     VALUE 111.          02960099
029700         10  PC-SCD-MDSE-LENGTH  PIC 9(4)     VALUE  97.          02970099
029800         10  PC-SCD-OTHER-LENGTH PIC 9(4)     VALUE  44.          02980099
029900         10  PC-SCD-TENDER-LENGTH                                 02990099
030000                                 PIC 9(4)     VALUE  72.          03000099
030100     05  PC-EFC-LOC-873          PIC 9(4)     VALUE 873.          03010099
030200                                                                  03020099
030300 01  PA-PROGRAM-ACCUMULATORS.                                     03030099
030400     05  PA-INPUT-RCDS-READ      PIC S9(11)   VALUE 0 COMP-3.     03040099
030500     05  PA-POSTING-FILE-1       PIC S9(11)   VALUE 0 COMP-3.     03050099
030600     05  PA-POSTING-FILE-2       PIC S9(11)   VALUE 0 COMP-3.     03060099
030700     05  PA-POSTING-FILE-3       PIC S9(11)   VALUE 0 COMP-3.     03070099
030800     05  PA-POSTING-FILE-4       PIC S9(11)   VALUE 0 COMP-3.     03080099
030900     05  PA-POSTING-FILE-5       PIC S9(11)   VALUE 0 COMP-3.     03090099
031000     05  PA-POSTING-FILE-6       PIC S9(11)   VALUE 0 COMP-3.     03100099
031100     05  PA-POSTING-FILE-7       PIC S9(11)   VALUE 0 COMP-3.     03110099
031200     05  PA-POSTING-FILE-8       PIC S9(11)   VALUE 0 COMP-3.     03120099
031300     05  PA-WAYFAIR-ITEM         PIC S9(11)   VALUE 0 COMP-3.     03130099
031400                                                                  03140099
031500 01  PV-PROGRAM-VARIABLES.                                        03150099
031600     05  PV-LAST-DB2-ACTION      PIC X(45)    VALUE SPACES.       03160099
031700         88  PV-OPEN-CLASS-CURSOR             VALUE               03170099
031800             'OPEN THE CLASS CURSOR - XST_SUB_CL           '.     03180099
031900         88  PV-FETCH-CLASS-ROW               VALUE               03190099
032000             'FETCH ROW FROM CLASS CURSOR - XST_SUB_CL     '.     03200099
032100         88  PV-CLOSE-CLASS-CURSOR            VALUE               03210099
032200             'CLOSE THE CLASS CURSOR - XST_SUB_CL          '.     03220099
032300         88  PV-STORE-COUNT-ERR               VALUE               03230099
032400             'SELECT COUNT OF STORES - XST_LOC             '.     03240099
032500         88  PV-OPEN-STORE-CURSOR             VALUE               03250099
032600             'OPEN THE STORE CURSOR - XST_LOC              '.     03260099
032700         88  PV-FETCH-STORE-ROW               VALUE               03270099
032800             'FETCH ROW FROM STORE CURSOR - XST_LOC        '.     03280099
032900         88  PV-CLOSE-STORE-CURSOR            VALUE               03290099
033000             'CLOSE THE STORE CURSOR - XST_LOC             '.     03300099
033100         88  PV-SELECT-ROUND-ROW              VALUE               03310099
033200             'SELECT ROW FROM XST_LOC & TSTATE             '.     03320099
033300         88  PV-SELECT-ROUND-ROW-ST           VALUE               03330099
033400             'SELECT ROW FROM TSTATE                       '.     03340099
033500         88  PV-TEPITM-COUNT-ERR              VALUE               03350099
033600             'SELECT COUNT OF ZERO TAX - TEPITM            '.     03360099
033700         88  PV-OPEN-STR-CURSOR               VALUE               03370099
033800             'OPEN THE STR CURSOR - XST_LOC              '.       03380099
033900         88  PV-FETCH-STR-ROW                 VALUE               03390099
034000             'FETCH ROW FROM STR CURSOR - XST_LOC        '.       03400099
034100         88  PV-CLOSE-STR-CURSOR              VALUE               03410099
034200             'CLOSE THE STR CURSOR - XST_LOC             '.       03420099
034300     05  PV-SAVE-AREA.                                            03430099
034400         10  PV-SAVE-TRANS-DATE  PIC 9(6)     VALUE ZERO.         03440099
034500         10  PV-SAVE-TRANS-TIME  PIC 9(4)     VALUE ZERO.         03450099
034600         10  PV-SAVE-TERM-NUM    PIC X(4)     VALUE SPACES.       03460099
034700         10  PV-SAVE-TRANS-NUM   PIC X(4)     VALUE SPACES.       03470099
034800         10  PV-SAVE-TNDR-SEQ-NBR PIC S9(04)  VALUE ZERO          03480099
034900                                                    COMP.         03490099
035000         10  PV-SAVE-TRANS-SOURCE                                 03500099
035100                                 PIC X(1)     VALUE SPACES.       03510099
035200         10  PV-SAVE-KIND-OF-TRANS                                03520099
035300                                 PIC X(1)     VALUE SPACES.       03530099
035400            88  PV-SAVE-TRANS-HAS-MERCHANDISE VALUE 'M'.          03540099
035500            88  PV-SAVE-TRANS-POSTING-ONLY    VALUE 'P'.          03550099
035600         10  PV-SAVE-EMPLOYEE-IND                                 03560099
035700                                 PIC X(1)     VALUE SPACES.       03570099
035800             88  PV-SAVE-EMPLOYEE             VALUE 'E'.          03580099
035900             88  PV-SAVE-NON-EMPLOYEE         VALUE 'N'.          03590099
036000         10  PV-SAVE-STORE-NMBR  PIC 9(4)     VALUE ZERO.         03600099
036100         10  PV-XST00001-LOC-NBR PIC 9(4)     VALUE ZERO.         03610099
036200         10  PV-SAVE-TX-RND-MTHD PIC X(1)     VALUE SPACES.       03620099
036300         10  PV-SAVE-TAX-RATE-PCT                                 03630099
036400                                 PIC S9V9(5)  COMP-3              03640099
036500                                              VALUE ZERO.         03650099
036600         10  PV-SAVE-TOTAL-TAX   PIC S9(7)V99 COMP-3              03660099
036700                                              VALUE ZERO.         03670099
036800         10  PV-SAVE-ORD-NBR                                      03680099
036900                                 PIC X(40)    VALUE SPACES.       03690099
037000     05  PV-STORE-NUMBER         PIC 9(4)     VALUE ZERO.         03700099
037100     05  PV-STR-NBR-N            PIC 9(4)     VALUE ZERO.         03710099
037200     05  PV-STR-NBR-A            PIC X(4)     VALUE SPACES.       03720099
037300     05  PV-TERM-NUMBER          PIC 9(4)     VALUE ZERO.         03730099
037400     05  PV-TRANS-NUMBER         PIC 9(4)     VALUE ZERO.         03740099
037500     05  PV-SEQ-NBR              PIC 9(4)     VALUE ZERO.         03750099
037600     05  PV-TRANS-DATE           PIC 9(8)     VALUE ZERO.         03760099
037700     05  FILLER REDEFINES PV-TRANS-DATE.                          03770099
037800         10  PV-TRANS-CC         PIC 9(2).                        03780099
037900         10  PV-TRANS-YY         PIC 9(2).                        03790099
038000         10  PV-TRANS-MM         PIC 9(2).                        03800099
038100         10  PV-TRANS-DD         PIC 9(2).                        03810099
038200     05  PV-LINE-NUMBER          PIC 9(3)     VALUE ZERO.         03820099
038300     05  PV-DESCRIPTION          PIC X(17)    VALUE SPACES.       03830099
038400     05  PV-POSTING-TOTAL-AMT    PIC S9(7)V99 COMP-3              03840099
038500                                              VALUE ZERO.         03850099
038600     05  PV-NON-DISC-TOTAL-AMT   PIC S9(7)V99 COMP-3              03860099
038700                                              VALUE ZERO.         03870099
038800     05  PV-TRAN-TAX-RT-CTR      PIC S9(4)    COMP                03880099
038900                                              VALUE ZERO.         03890099
039000     05  PV-DB2-POS-DATE         PIC X(10).                       03900099
039100                                                                  03910099
039200     05  PV-DB2-FORMAT-DATE.                                      03920099
039300         10  PV-DB2-POS-CC       PIC 9(2).                        03930099
039400         10  PV-DB2-POS-YY       PIC 9(2).                        03940099
039500         10  FILLER              PIC X(1)      VALUE '-'.         03950099
039600         10  PV-DB2-POS-MM       PIC 9(2).                        03960099
039700         10  FILLER              PIC X(1)      VALUE '-'.         03970099
039800         10  PV-DB2-POS-DD       PIC 9(2).                        03980099
039900     05  PV-STORE-COUNT          PIC S9(5)     COMP-3             03990099
040000                                               VALUE ZERO.        04000099
040100     05  PV-ZERO-TAX-ITEM-COUNT  PIC S9(5)     COMP-3             04010099
040200                                               VALUE ZERO.        04020099
040300     05  PV-STORES-PER-FILE      PIC S9(5)     COMP-3             04030099
040400                                               VALUE ZERO.        04040099
040500     05  PV-FILE-NUMBER          PIC 9(2)      VALUE ZERO.        04050099
040600     05  PV-REMAINDER            PIC 9(2)      VALUE ZERO.        04060099
040700     05  PV-STORE-COUNTER        PIC S9(5)     COMP-3             04070099
040800                                               VALUE ZERO.        04080099
040900     05  PV-DEPT-CLASS-CTR       PIC 9(5)     VALUE ZERO COMP-3.  04090099
041000     05  PV-TEMP-TAX-CHAR        PIC X(10)    VALUE SPACES.       04100099
041100     05  PV-TEMP-TAX-NUM         PIC 9(10)    VALUE ZERO.         04110099
041200     05  PV-LINE-ITEM-TAX        PIC S9(7)V99 VALUE ZERO COMP-3.  04120099
041300     05  PV-WORK-TAX-AMT         PIC S9(7)V99 VALUE ZERO COMP-3.  04130099
041400     05  PV-LI-NET-TAXABLE-AMT   PIC S9(7)V99 VALUE ZERO COMP-3.  04140099
041500     05  PV-LI-ORIG-N-TXBL-AMT   PIC S9(7)V99 VALUE ZERO COMP-3.  04150099
041900     05  PV-EMP-DISC-TAX-ADJ     PIC S9(9)V99 VALUE ZERO COMP-3.  04190099
042000     05  PV-ORIG-TAXABLE-AMT     PIC S9(9)V99 VALUE ZERO COMP-3.  04200099
042100     05  PV-TOT-ORIG-TAX-AMT     PIC S9(9)V99 VALUE ZERO COMP-3.  04210099
042200     05  PV-DISPLAY-TAXABLE-AMT  PIC ZZZ,ZZZ,ZZZ.99-.             04220099
042300     05  PV-DISPLAY-TAX-AMT      PIC ZZZ,ZZZ,ZZZ.99-.             04230099
042400***************************************************************** 04240099
042500* THE AMOUNTS BELOW ARE USED AS IN THE FOLLOWING EXAMPLE:       * 04250099
042600*   RECEIPT:              EMPLOYEE DISCOUNT:                    * 04260099
042700*   19.99 CLOCK           10%    2.00                           * 04270099
042800*   25.00 SHIRT           15%    3.75                           * 04280099
042900*   -5.00 COUPON                 -.64                           * 04290099
043000*    2.00 TAX                     .26                           * 04300099
043100*  --------------         ------------                          * 04310099
043200*   41.99                        5.37                           * 04320099
043300*                                                               * 04330099
043400* TOTAL DISCOUNT AMT = (2.00 + 3.75) = 5.75                     * 04340099
043500* TOTAL TAX DISCOUNT AMT = (2.00 + 3.75) = 5.75                 * 04350099
043600* TOTAL ORIGINAL AMT = (19.99 + 25.00) = 44.99                  * 04360099
043700* TOTAL TAXABLE ORIGINAL AMT = (19.99 + 25.00) = 44.99          * 04370099
043800* TOTAL COUPON AMT   = -5.00                                    * 04380099
043900* COUPON ADJUST AMT  = (5.75/44.99) * -5.00 = -.64              * 04390099
044000*                    = TOTAL DISCOUNT AMT/TOTAL ORIGINAL AMT    * 04400099
044100*                      * TOTAL COUPON AMT                       * 04410099
044200* TAX ADJUST AMT     = (2.00 + 3.75 - .64)                      * 04420099
044300*                      / (19.99 + 25.00 - 5.00) * 2.00 = .26    * 04430099
044400*                    = (TOTAL TAX DISCOUNT AMT +                * 04440099
044500*                       COUPON ADJUST AMT)                      * 04450099
044600*                     / (TOTAL TAXABLE ORIGINAL AMT +           * 04460099
044700*                        TOTAL COUPON AMT)                      * 04470099
044800*                     * ORIGINAL TAX AMT                        * 04480099
044900* FINAL DISCOUNT AMT = 5.37                                     * 04490099
045000***************************************************************** 04500099
045100     05  PV-EMPLOYEE-DISCOUNT-CALC-AMTS.                          04510099
045200*        PV-TOTAL-DISCOUNT-AMT IS THE ACCUMULATED EMPLOYEE        04520099
045300*        DISCOUNT AMOUNT FOR THE ENTIRE TRANSACTION.              04530099
045400         10  PV-TOTAL-DISCOUNT-AMT                                04540099
045500                                 PIC S9(7)V99 COMP-3              04550099
045600                                              VALUE ZERO.         04560099
045700*        PV-EMPLOYEE-DISCOUNT IS THE EMPLOYEE DISCOUNT            04570099
045800*        PER ITEM.                                                04580099
045900         10  PV-EMP-DISC-SRC-CDE PIC X        VALUE SPACE.        04590099
046000         10  PV-EMPLOYEE-DISCOUNT                                 04600099
046100                                 PIC S9(7)V99 COMP-3              04610099
046200                                              VALUE ZERO.         04620099
046300         10  PV-TOTAL-ORIGINAL-AMT                                04630099
046400                                 PIC S9(7)V99 COMP-3              04640099
046500                                              VALUE ZERO.         04650099
046600         10  PV-TOTAL-COUPON-AMT PIC S9(7)V99 COMP-3              04660099
046700                                              VALUE ZERO.         04670099
046800         10  PV-ORIGINAL-TAX-AMT PIC S9(7)V99 COMP-3              04680099
046900                                              VALUE ZERO.         04690099
047000         10  PV-NON-DISC-TAX-AMT PIC S9(7)V99 COMP-3              04700099
047100                                              VALUE ZERO.         04710099
047200         10  PV-TAX-ADJUST-AMT   PIC S9(7)V99 COMP-3              04720099
047300                                              VALUE ZERO.         04730099
047400         10  PV-FINAL-DISCOUNT-AMT                                04740099
047500                                 PIC S9(7)V99 COMP-3              04750099
047600                                              VALUE ZERO.         04760099
047700     05  PV-M-NET-TAXABLE-AMT    PIC   9(07)V99.                  04770099
047800                                                                  04780099
047900 01  CC-CONTROL-CARD.                                             04790099
048000     05  CC-CONTROL-CARD-DISPLAY.                                 04800099
048100         10  CC-POS-DATE-MDY     PIC 9(8)     VALUE ZERO.         04810099
048200         10  FILLER              REDEFINES CC-POS-DATE-MDY.       04820099
048300             15  CC-POS-MONTH    PIC 9(2).                        04830099
048400             15  CC-POS-DAY      PIC 9(2).                        04840099
048500             15  CC-POS-CENTURY  PIC 9(2).                        04850099
048600             15  CC-POS-YEAR     PIC 9(2).                        04860099
048700     05  FILLER                  PIC X(72)    VALUE SPACES.       04870099
048800                                                                  04880099
048900                                                                  04890099
049000 01  CD-CLASS-DESCRIPTION-TABLE.                                  04900099
049100*TDH002                                                           04910099
049200*    05  CD-CLASS-DESC-ENTRY     OCCURS 20000 TIMES               04920099
049300     05  CD-CLASS-DESC-ENTRY     OCCURS 40000 TIMES               04930099
049400                                 ASCENDING KEY IS CD-DEPT-NUMBER  04940099
049500                                                  CD-CLASS-NUMBER 04950099
049600                                 INDEXED BY CD-CLASS-IDX.         04960099
049700         10  CD-DEPT-NUMBER      PIC 9(03).                       04970099
049800         10  CD-CLASS-NUMBER     PIC 9(02).                       04980099
049900         10  CD-CLASS-POS-DESC   PIC X(17).                       04990099
050000                                                                  05000099
050100***************************************************************** 05010099
050200*    *** POSTING FILE TABLE ***                                 * 05020099
050300*    THIS TABLE IS USED TO SPLIT THE POSTING TRANSACTION FILE   * 05030099
050400*    INTO A NUMBER OF SEPARATE FILES, FOR FASTER PROCESSING ON  * 05040099
050500*    THE TANDEM.                                                * 05050099
050600*    THE TABLE HAS AN ENTRY FOR EACH POSTING FILE.  IT WILL     * 05060099
050700*    CONTAIN THE BEGINNING AND ENDING STORE NUMBERS FOR EACH    * 05070099
050800*    FILE.                                                      * 05080099
050900***************************************************************** 05090099
051000                                                                  05100099
051100 01  PT-POSTING-FILE-TABLE.                                       05110099
051200     05  PT-POSTING-FILE-ENTRY   OCCURS 1 TO 20 TIMES             05120099
051300                                 DEPENDING ON                     05130099
051400                                 PC-NBR-OF-POST-FILES             05140099
051500                                 INDEXED BY PT-FILE-IDX.          05150099
051600         10  PT-BEGIN-STORE      PIC 9(4).                        05160099
051700         10  PT-END-STORE        PIC 9(4).                        05170099
051800*---------------------------------------------------------        05180099
051900* SALES TAX RATE TOTALS TABLE FOR TRANSACTION                     05190099
052000*---------------------------------------------------------        05200099
052100 01  PT-TAX-RATE-TABLE.                                           05210099
052200     05  PT-TAX-RATES            OCCURS 20 TIMES                  05220099
052300                                 INDEXED BY TR-INDEX.             05230099
052400         10  PT-TAX-RATE         PIC S9(1)V9(5) COMP-3            05240099
052500                                              VALUE ZERO.         05250099
052600         10  PT-TAXABLE-AMT-TOT  PIC S9(7)V99   COMP-3            05260099
052700                                              VALUE ZERO.         05270099
052800         10  PT-TAX-AMT-TOT      PIC S9(7)V99   COMP-3            05280099
052900                                              VALUE ZERO.         05290099
053000*                                                                 05300099
053100*  SQL AND COBOL DECLARATIONS FOR XST_SUB_CL TABLE                05310099
053200*                                                                 05320099
053300     EXEC SQL                                                     05330099
053400         INCLUDE XST00014                                         05340099
053500     END-EXEC.                                                    05350099
053600                                                                  05360099
053700*                                                                 05370099
053800*  SQL AND COBOL DECLARATIONS FOR XST_LOC                         05380099
053900*                                                                 05390099
054000                                                                  05400099
054100     EXEC SQL                                                     05410099
054200         INCLUDE XST00001                                         05420099
054300     END-EXEC.                                                    05430099
054400                                                                  05440099
054500*                                                                 05450099
054600*  SQL AND COBOL DECLARATIONS FOR THE TEPITM TABLE                05460099
054700*                                                                 05470099
054800     EXEC SQL                                                     05480099
054900         INCLUDE TEPITM                                           05490099
055000     END-EXEC.                                                    05500099
055100                                                                  05510099
055200*                                                                 05520099
055300*  SQL AND COBOL DECLARATIONS FOR THE STATE TABLE (TSTATE)        05530099
055400*                                                                 05540099
055500     EXEC SQL                                                     05550099
055600         INCLUDE TSTATE                                           05560099
055700     END-EXEC.                                                    05570099
055800                                                                  05580099
055900*                                                                 05590099
056000*                                                                 05600099
056100*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                05610099
056200*                                                                 05620099
056300     EXEC SQL                                                     05630099
056400         INCLUDE SQLCA                                            05640099
056500     END-EXEC.                                                    05650099
056600                                                                  05660099
056700*                                                                 05670099
056800*  CURSOR USED TO RETRIEVE THE CLASS POS DESCRIPTIONS.            05680099
056900*                                                                 05690099
057000                                                                  05700099
057100     EXEC SQL                                                     05710099
057200         DECLARE CLASS_CURSOR CURSOR FOR                          05720099
057300         SELECT   DEPT_NBR                                        05730099
057400                 ,SUB_CL_NBR                                      05740099
057500                 ,POS_MDSE_DESC                                   05750099
057600             FROM XST_SUB_CL                                      05760099
057700         ORDER BY DEPT_NBR                                        05770099
057800                 ,SUB_CL_NBR                                      05780099
057900         WITH UR                                                  05790099
058000     END-EXEC.                                                    05800099
058100                                                                  05810099
058200*                                                                 05820099
058300*  CURSOR USED TO RETRIEVE THE STORE NUMBER RANGES.               05830099
058400*                                                                 05840099
058500                                                                  05850099
058600     EXEC SQL                                                     05860099
058700         DECLARE STORE_CURSOR CURSOR FOR                          05870099
058800             SELECT LOC_NBR                                       05880099
058900                 FROM XST_LOC                                     05890099
059000                WHERE ((:PV-DB2-POS-DATE                          05900099
059100                       BETWEEN OPN_DTE AND CLO_DTE) OR            05910099
059200                       (:PV-DB2-POS-DATE >= OPN_DTE AND           05920099
059300                       CLO_DTE IS NULL))                          05930099
059400                  AND LOC_TYP_CDE = 'DS'                          05940099
059500                 ORDER BY LOC_NBR                                 05950099
059600     END-EXEC.                                                    05960099
059700*                                                                 05970099
059800*  CURSOR USED TO RETRIEVE THE ZIP CODES OF EVERY STORE           05980099
059900*                                                                 05990099
060000                                                                  06000099
060100     EXEC SQL                                                     06010099
060200         DECLARE STR_CURSOR CURSOR FOR                            06020099
060300         SELECT LOC_NBR                                           06030099
060400              , ZIP_10_CDE                                        06040099
060500         FROM XST_LOC                                             06050099
060600         WHERE ((:PV-DB2-POS-DATE                                 06060099
060700                  BETWEEN OPN_DTE AND CLO_DTE) OR                 06070099
060800                (:PV-DB2-POS-DATE >= OPN_DTE AND                  06080099
060900                        CLO_DTE IS NULL))                         06090099
061000           AND LOC_TYP_CDE = 'DS'                                 06100099
061100         ORDER BY LOC_NBR                                         06110099
061200         WITH UR                                                  06120099
061300     END-EXEC.                                                    06130099
061400                                                                  06140099
061500******************************************************************06150099
061600 PROCEDURE DIVISION.                                              06160099
061700******************************************************************06170099
061800                                                                  06180099
061900 0000-MAINLINE.                                                   06190099
062000                                                                  06200099
062100     PERFORM 1000-INITIALIZE.                                     06210099
062200                                                                  06220099
062300     PERFORM 2000-PROCESS-TRANSACTION                             06230099
062400       UNTIL PS-END-OF-TRANS-FILE.                                06240099
062500                                                                  06250099
062600     PERFORM 9000-EOJ-ROUTINE.                                    06260099
062700                                                                  06270099
062800     GOBACK.                                                      06280099
062900******************************************************************06290099
063000*  SET UP FOR PROGRAM PROCESSING BY ACCEPTING, DISPLAYING, AND   *06300099
063100*  VALIDATING THE CONTROL CARD, COMPUTING APPLICABLE DISCOUNT    *06310099
063200*  PERCENTAGES, OPENING ALL FILES, AND READING THE               *06320099
063300*  FIRST ACCOUNTS RECEIVABLE TRANSACTION RECORD.                 *06330099
063400******************************************************************06340099
063500                                                                  06350099
063600 1000-INITIALIZE.                                                 06360099
063700                                                                  06370099
063800     ACCEPT CC-CONTROL-CARD.                                      06380099
063900     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD = ('       06390099
064000               CC-CONTROL-CARD-DISPLAY  ')'.                      06400099
064100                                                                  06410099
064200     PERFORM 1100-VALIDATE-CONTROL-CARD.                          06420099
064300                                                                  06430099
064400     OPEN INPUT  AR-TRANSACTION-FILE                              06440099
064500          OUTPUT POSTING-TRANS-FILE-1                             06450099
064600                 POSTING-TRANS-FILE-2                             06460099
064700                 POSTING-TRANS-FILE-3                             06470099
064800                 POSTING-TRANS-FILE-4                             06480099
064900                 POSTING-TRANS-FILE-5                             06490099
065000                 POSTING-TRANS-FILE-6                             06500099
065100                 POSTING-TRANS-FILE-7                             06510099
065200                 POSTING-TRANS-FILE-8.                            06520099
065300                                                                  06530099
065400     PERFORM 1200-LOAD-CLASS-DESCRIPTIONS.                        06540099
065500                                                                  06550099
065600     PERFORM 1300-LOAD-POSTING-FILE-TABLE.                        06560099
065700                                                                  06570099
065800     PERFORM 7000-READ-TRANSACTION-FILE.                          06580099
065900                                                                  06590099
066000******************************************************************06600099
066100*  VALIDATE THE CONTROL CARD.  ENSURE THAT A VALID P.O.S. DATE   *06610099
066200*  HAS BEEN PROVIDED.  ENSURE THAT ALL DISCOUNT PERCENTAGES      *06620099
066300*  ARE NUMERIC, ARE GREATER THAN ZERO, AND ARE PRECEEDED BY THE  *06630099
066400*  APPROPRIATE IDENTIFYING LITERAL.                              *06640099
066500******************************************************************06650099
066600                                                                  06660099
066700 1100-VALIDATE-CONTROL-CARD.                                      06670099
066800                                                                  06680099
066900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06690099
067000     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     06700099
067100     SET DPG52-LK-DTE-GREG-CC        TO TRUE.                     06710099
067200     MOVE CC-POS-DATE-MDY            TO DPG52-LK-DATE-INPUT.      06720099
067300                                                                  06730099
067400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06740099
067500                                             DPG54 DPG55 DPG56.   06750099
067600     IF DPG54-DATE-INVALID                                        06760099
067700        DISPLAY '*** ABEND ***'                                   06770099
067800        DISPLAY '*** PROGRAM = ARKUT093'                          06780099
067900        DISPLAY '*** PARA = 1100-VALIDATE-CONTROL-CARD'           06790099
068000        DISPLAY '*** BAD RESPONSE FROM DATE ROUTINE ***'          06800099
068100        MOVE +4008  TO   ABEND-CODE                               06810099
068200        CALL 'ILBOABN0' USING ABEND-CODE                          06820099
068300     END-IF.                                                      06830099
068400                                                                  06840099
068500******************************************************************06850099
068600*  LOAD THE CLASS DESCRIPTIONS FROM MBS TABLES INTO AN INTERNAL  *06860099
068700*  TABLE IN WORKING-STORAGE.                                     *06870099
068800******************************************************************06880099
068900                                                                  06890099
069000 1200-LOAD-CLASS-DESCRIPTIONS.                                    06900099
069100                                                                  06910099
069200     MOVE HIGH-VALUES TO CD-CLASS-DESCRIPTION-TABLE.              06920099
069300                                                                  06930099
069400     EXEC SQL                                                     06940099
069500         OPEN CLASS_CURSOR                                        06950099
069600     END-EXEC.                                                    06960099
069700                                                                  06970099
069800     IF SQLCODE NOT = ZERO                                        06980099
069900         SET PV-OPEN-CLASS-CURSOR TO TRUE                         06990099
070000         PERFORM 9100-DB2-ERROR                                   07000099
070100     END-IF.                                                      07010099
070200                                                                  07020099
070300     PERFORM 1210-FETCH-CLASS-CURSOR.                             07030099
070400                                                                  07040099
070500     SET CD-CLASS-IDX TO 1.                                       07050099
070600     PERFORM 1205-PROCESS-CLASS-CURSOR                            07060099
070700         UNTIL PS-END-OF-CLASS-CURSOR                             07070099
070800         OR PV-DEPT-CLASS-CTR > PC-MAX-DEPT-CLASSES.              07080099
070900                                                                  07090099
071000     EXEC SQL                                                     07100099
071100         CLOSE CLASS_CURSOR                                       07110099
071200     END-EXEC.                                                    07120099
071300                                                                  07130099
071400     IF SQLCODE NOT = ZERO                                        07140099
071500         SET PV-CLOSE-CLASS-CURSOR TO TRUE                        07150099
071600         PERFORM 9100-DB2-ERROR                                   07160099
071700     END-IF.                                                      07170099
071800     IF PV-DEPT-CLASS-CTR > PC-MAX-DEPT-CLASSES                   07180099
071900         PERFORM 9400-CLASS-MAX-ERROR                             07190099
072000     END-IF.                                                      07200099
072100                                                                  07210099
072200******************************************************************07220099
072300*  PROCESS THE CLASS CURSOR, CREATING AN INTERNAL TABLE          *07230099
072400******************************************************************07240099
072500 1205-PROCESS-CLASS-CURSOR.                                       07250099
072600                                                                  07260099
072700     MOVE XST00014-DEPT-NBR      TO CD-DEPT-NUMBER                07270099
072800                                    (CD-CLASS-IDX).               07280099
072900     MOVE XST00014-SUB-CL-NBR    TO CD-CLASS-NUMBER               07290099
073000                                    (CD-CLASS-IDX).               07300099
073100     MOVE XST00014-POS-MDSE-DESC TO CD-CLASS-POS-DESC             07310099
073200                                    (CD-CLASS-IDX).               07320099
073300     SET CD-CLASS-IDX UP BY 1.                                    07330099
073400                                                                  07340099
073500     PERFORM 1210-FETCH-CLASS-CURSOR.                             07350099
073600                                                                  07360099
073700******************************************************************07370099
073800*  FETCH THE CLASS CURSOR.                                       *07380099
073900******************************************************************07390099
074000 1210-FETCH-CLASS-CURSOR.                                         07400099
074100                                                                  07410099
074200     EXEC SQL                                                     07420099
074300         FETCH CLASS_CURSOR                                       07430099
074400             INTO :XST00014-DEPT-NBR                              07440099
074500                 ,:XST00014-SUB-CL-NBR                            07450099
074600                 ,:XST00014-POS-MDSE-DESC                         07460099
074700     END-EXEC.                                                    07470099
074800                                                                  07480099
074900     IF SQLCODE = ZERO                                            07490099
075000         ADD +1 TO PV-DEPT-CLASS-CTR                              07500099
075100     ELSE                                                         07510099
075200         IF SQLCODE = +100                                        07520099
075300             SET PS-END-OF-CLASS-CURSOR TO TRUE                   07530099
075400         ELSE                                                     07540099
075500             SET PV-FETCH-CLASS-ROW TO TRUE                       07550099
075600             PERFORM 9100-DB2-ERROR                               07560099
075700         END-IF                                                   07570099
075800     END-IF.                                                      07580099
075900                                                                  07590099
076000******************************************************************07600099
076100*    LOAD THE TABLE OF STORE NUMBER RANGES FOR EACH POSTING FILE.*07610099
076200******************************************************************07620099
076300                                                                  07630099
076400 1300-LOAD-POSTING-FILE-TABLE.                                    07640099
076500                                                                  07650099
076600     MOVE SPACES              TO PT-POSTING-FILE-TABLE.           07660099
076700                                                                  07670099
076800     MOVE CC-POS-MONTH        TO PV-DB2-POS-MM.                   07680099
076900     MOVE CC-POS-DAY          TO PV-DB2-POS-DD.                   07690099
077000     MOVE CC-POS-YEAR         TO PV-DB2-POS-YY.                   07700099
077100     MOVE CC-POS-CENTURY      TO PV-DB2-POS-CC.                   07710099
077200     MOVE PV-DB2-FORMAT-DATE  TO PV-DB2-POS-DATE.                 07720099
077300                                                                  07730099
077400     EXEC SQL                                                     07740099
077500         SELECT COUNT(*)                                          07750099
077600         INTO :PV-STORE-COUNT                                     07760099
077700         FROM XST_LOC                                             07770099
077800         WHERE ((:PV-DB2-POS-DATE                                 07780099
077900                  BETWEEN OPN_DTE AND CLO_DTE) OR                 07790099
078000                (:PV-DB2-POS-DATE >= OPN_DTE AND                  07800099
078100                  CLO_DTE IS NULL))                               07810099
078200               AND LOC_TYP_CDE = 'DS'                             07820099
078300     END-EXEC.                                                    07830099
078400                                                                  07840099
078500     IF SQLCODE NOT = ZERO                                        07850099
078600         SET PV-STORE-COUNT-ERR TO TRUE                           07860099
078700         PERFORM 9100-DB2-ERROR                                   07870099
078800     END-IF.                                                      07880099
078900                                                                  07890099
079000     DIVIDE PV-STORE-COUNT BY PC-NBR-OF-POST-FILES                07900099
079100         GIVING PV-STORES-PER-FILE                                07910099
079200         REMAINDER PV-REMAINDER                                   07920099
079300     END-DIVIDE.                                                  07930099
079400                                                                  07940099
079500     IF PV-REMAINDER > ZERO                                       07950099
079600         ADD 1 TO PV-STORES-PER-FILE                              07960099
079700     END-IF.                                                      07970099
079800                                                                  07980099
079900     EXEC SQL                                                     07990099
080000         OPEN STORE_CURSOR                                        08000099
080100     END-EXEC.                                                    08010099
080200                                                                  08020099
080300     IF SQLCODE NOT = ZERO                                        08030099
080400         SET PV-OPEN-STORE-CURSOR TO TRUE                         08040099
080500         PERFORM 9100-DB2-ERROR                                   08050099
080600     END-IF.                                                      08060099
080700                                                                  08070099
080800     PERFORM VARYING PT-FILE-IDX FROM 1 BY 1                      08080099
080900             UNTIL PT-FILE-IDX > PC-NBR-OF-POST-FILES             08090099
081000                   OR PS-END-OF-STORE-CURSOR                      08100099
081100         PERFORM 1310-FETCH-STORE-CURSOR                          08110099
081200         MOVE XST00001-LOC-NBR TO PT-BEGIN-STORE (PT-FILE-IDX)    08120099
081300         PERFORM VARYING PV-STORE-COUNTER FROM 2 BY 1             08130099
081400                 UNTIL PV-STORE-COUNTER > PV-STORES-PER-FILE      08140099
081500                       OR PS-END-OF-STORE-CURSOR                  08150099
081600             PERFORM 1310-FETCH-STORE-CURSOR                      08160099
081700             IF PS-END-OF-STORE-CURSOR                            08170099
081800                 CONTINUE                                         08180099
081900             ELSE                                                 08190099
082000                 MOVE XST00001-LOC-NBR                            08200099
082100                               TO PT-END-STORE (PT-FILE-IDX)      08210099
082200             END-IF                                               08220099
082300         END-PERFORM                                              08230099
082400     END-PERFORM.                                                 08240099
082500                                                                  08250099
082600     EXEC SQL                                                     08260099
082700         CLOSE STORE_CURSOR                                       08270099
082800     END-EXEC.                                                    08280099
082900                                                                  08290099
083000     IF SQLCODE NOT = ZERO                                        08300099
083100         SET PV-CLOSE-STORE-CURSOR TO TRUE                        08310099
083200         PERFORM 9100-DB2-ERROR                                   08320099
083300     END-IF.                                                      08330099
083400                                                                  08340099
083500******************************************************************08350099
083600*  FETCH THE STORE CURSOR.                                       *08360099
083700******************************************************************08370099
083800                                                                  08380099
083900 1310-FETCH-STORE-CURSOR.                                         08390099
084000                                                                  08400099
084100     EXEC SQL                                                     08410099
084200         FETCH STORE_CURSOR                                       08420099
084300             INTO :XST00001-LOC-NBR                               08430099
084400     END-EXEC.                                                    08440099
084500                                                                  08450099
084600     EVALUATE SQLCODE                                             08460099
084700         WHEN ZERO                                                08470099
084800             CONTINUE                                             08480099
084900         WHEN +100                                                08490099
085000             SET PS-END-OF-STORE-CURSOR TO TRUE                   08500099
085100         WHEN OTHER                                               08510099
085200             SET PV-FETCH-STORE-ROW TO TRUE                       08520099
085300             PERFORM 9100-DB2-ERROR                               08530099
085400     END-EVALUATE.                                                08540099
085500                                                                  08550099
085600                                                                  08560099
085700******************************************************************08570099
085800*  PROCESS A TRANSACTION INPUT RECORD.                           *08580099
085900******************************************************************08590099
086000                                                                  08600099
086100 2000-PROCESS-TRANSACTION.                                        08610099
086200                                                                  08620099
086300     IF PS-FIRST-RECORD                                           08630099
086400         PERFORM 2100-PROCESS-NEW-TRANS                           08640099
086500         SET PS-NOT-FIRST-RECORD TO TRUE                          08650099
086600     ELSE                                                         08660099
086700         IF AR001-TRANSACTION-DATE    = PV-SAVE-TRANS-DATE   AND  08670099
086800            AR001-TRANSACTION-TIME    = PV-SAVE-TRANS-TIME   AND  08680099
086900            AR001-STORE-NUMBER        = PV-SAVE-STORE-NMBR   AND  08690099
087000            AR001-TERMINAL-NUMBER     = PV-SAVE-TERM-NUM     AND  08700099
087100            AR001-TRANSACTION-NUMBER  = PV-SAVE-TRANS-NUM    AND  08710099
087200            AR001-TNDR-SEQ-NBR        = PV-SAVE-TNDR-SEQ-NBR AND  08720099
087300            AR001-TRANSACTION-SOURCE  = PV-SAVE-TRANS-SOURCE AND  08730099
087400            AR001-ORD-NBR             = PV-SAVE-ORD-NBR AND       08740099
087500            PV-SAVE-TRANS-HAS-MERCHANDISE                         08750099
087600             PERFORM 2200-PROCESS-MERCHANDISE                     08760099
087700         ELSE                                                     08770099
087800             IF PV-SAVE-TRANS-HAS-MERCHANDISE                     08780099
087900                 PERFORM 2400-UPDATE-POSTING-TRANS                08790099
088000                 PERFORM 7200-WRITE-POSTING-TRANS                 08800099
088100                 IF PV-SAVE-EMPLOYEE                              08810099
088200                     PERFORM 2500-CREATE-EMPL-DISCOUNT            08820099
088300                 END-IF                                           08830099
088400             END-IF                                               08840099
088500             PERFORM 2100-PROCESS-NEW-TRANS                       08850099
088600         END-IF                                                   08860099
088700     END-IF.                                                      08870099
088800                                                                  08880099
088900     PERFORM 7000-READ-TRANSACTION-FILE.                          08890099
089000                                                                  08900099
089100******************************************************************08910099
089200*  PROCESS A NEW TRANSACTION.                                    *08920099
089300******************************************************************08930099
089400                                                                  08940099
089500 2100-PROCESS-NEW-TRANS.                                          08950099
089600                                                                  08960099
089700*  IF TRANSACTION IS FOR DIFFERENT STORE,                         08970099
089800*  LOOK UP SALES TAX ROUNDING METHOD .                            08980099
089900*                                                                 08990099
090000     IF AR001-STORE-NUMBER NOT = PV-SAVE-STORE-NMBR               09000099
090100        MOVE AR001-STORE-NUMBER TO PV-SAVE-STORE-NMBR             09010099
090200     END-IF.                                                      09020099
090300                                                                  09030099
090400     MOVE ZERO                      TO PV-POSTING-TOTAL-AMT       09040099
090500                                       PV-NON-DISC-TOTAL-AMT      09050099
090600                                       PV-SAVE-TOTAL-TAX          09060099
090700                                       PV-TRAN-TAX-RT-CTR.        09070099
090800                                                                  09080099
090900     INITIALIZE PV-EMPLOYEE-DISCOUNT-CALC-AMTS                    09090099
091000                PT-TAX-RATE-TABLE.                                09100099
091100                                                                  09110099
091200     MOVE AR001-TRANSACTION-DATE    TO PV-SAVE-TRANS-DATE.        09120099
091300     MOVE AR001-TRANSACTION-TIME    TO PV-SAVE-TRANS-TIME.        09130099
091400     MOVE AR001-TERMINAL-NUMBER     TO PV-SAVE-TERM-NUM.          09140099
091500     MOVE AR001-TRANSACTION-NUMBER  TO PV-SAVE-TRANS-NUM.         09150099
091600     MOVE AR001-TNDR-SEQ-NBR        TO PV-SAVE-TNDR-SEQ-NBR.      09160099
091700     MOVE AR001-TRANSACTION-SOURCE  TO PV-SAVE-TRANS-SOURCE.      09170099
091800     MOVE AR001-ORD-NBR             TO PV-SAVE-ORD-NBR.           09180099
091900                                                                  09190099
092000     IF AR001-NON-EMPLOYEE                                        09200099
092100         SET PV-SAVE-NON-EMPLOYEE   TO TRUE                       09210099
092200     ELSE                                                         09220099
092300         SET PV-SAVE-EMPLOYEE       TO TRUE                       09230099
092400     END-IF.                                                      09240099
092500                                                                  09250099
092600     IF AR001-ASSOC-CASH = 'Y'                                    09260099
092700         SET PS-ASSOC-CASH TO TRUE                                09270099
092800     ELSE                                                         09280099
092900         SET PS-NOT-ASSOC-CASH TO TRUE                            09290099
093000     END-IF.                                                      09300099
093100                                                                  09310099
093200     IF AR001-POS-CHARGE OR                                       09320099
093300        AR001-POS-RETURN OR                                       09330099
093400        AR001-MIXED-MODE-OR-PRICE-ADJ                             09340099
093500         SET PV-SAVE-TRANS-HAS-MERCHANDISE TO TRUE                09350099
093600         PERFORM 2110-POSTING-TRAN-DETAILS                        09360099
093700         PERFORM 2200-PROCESS-MERCHANDISE                         09370099
093800     ELSE                                                         09380099
093900         SET PV-SAVE-TRANS-POSTING-ONLY    TO TRUE                09390099
094000         PERFORM 2300-PROCESS-POSTING-ONLY                        09400099
094100     END-IF.                                                      09410099
094200                                                                  09420099
094300******************************************************************09430099
094400*  POPULATE POSTING RECORD WITH THE TRANSACTION DETAILS          *09440099
094500******************************************************************09450099
094600                                                                  09460099
094700 2110-POSTING-TRAN-DETAILS.                                       09470099
094800                                                                  09480099
094900     IF AR001-BIN-NUMBER > SPACES                                 09490099
095000        SET PS-H-RECEIVED-18-DIGIT-NO    TO TRUE                  09500099
095100     ELSE                                                         09510099
095200       IF AR001-ACCOUNT-NUMBER-11-12 NUMERIC                      09520099
095300           IF AR001-ACCOUNT-NUMBER-11-12 > ZERO OR                09530099
095400              AR001-POS-TRANSACTION                               09540099
095500               SET PS-H-RECEIVED-12-DIGIT-NO    TO TRUE           09550099
095600           ELSE                                                   09560099
095700               SET PS-H-RECEIVED-10-DIGIT-NO    TO TRUE           09570099
095800           END-IF                                                 09580099
095900       ELSE                                                       09590099
096000           SET PS-H-RECEIVED-10-DIGIT-NO    TO TRUE               09600099
096100       END-IF                                                     09610099
096200     END-IF.                                                      09620099
096300                                                                  09630099
096400     MOVE SPACES                  TO AR021-AR-POSTING-RECORD.     09640099
096500     MOVE AR001-BIN-NUMBER        TO AR021-BIN-NUMBER.            09650099
096600     MOVE AR001-ORD-NBR           TO AR021-ECOMM-ORDER-NBR.       09660099
096700     MOVE AR001-STORE-NUMBER      TO PV-STORE-NUMBER.             09670099
096800     MOVE PV-STORE-NUMBER         TO AR021-MERCHANT-ID.           09680099
096900     IF AR001-POS-TRANSACTION                                     09690099
097000         SET AR021-SS-ORIG-TRANS   TO TRUE                        09700099
097100     ELSE                                                         09710099
097200         SET AR021-SS-ORIG-TRANS-REVERSAL TO TRUE                 09720099
097300     END-IF.                                                      09730099
097400     MOVE ZERO                    TO AR021-DEPT-ID.               09740099
097500     MOVE AR001-TERMINAL-NUMBER   TO PV-TERM-NUMBER.              09750099
097600     MOVE PV-TERM-NUMBER          TO AR021-POS-ID.                09760099
097700     MOVE AR001-TRN-DTE(1:2)      TO PV-TRANS-MM.                 09770099
097800     MOVE AR001-TRN-DTE(3:2)      TO PV-TRANS-DD.                 09780099
097900     MOVE AR001-TRN-DTE(5:2)      TO PV-TRANS-YY.                 09790099
098000     IF PV-TRANS-YY < 80                                          09800099
098100         MOVE 20                  TO PV-TRANS-CC                  09810099
098200     ELSE                                                         09820099
098300         MOVE 19                  TO PV-TRANS-CC                  09830099
098400     END-IF.                                                      09840099
098500     MOVE PV-TRANS-DATE           TO AR021-ENTRY-DATE.            09850099
098600     MOVE AR001-TRANSACTION-NUMBER                                09860099
098700                                  TO PV-TRANS-NUMBER.             09870099
098800     MOVE PV-TRANS-NUMBER         TO AR021-REF-NO.                09880099
098900     ADD 1                        TO PV-SEQ-NBR.                  09890099
099000     MOVE PV-SEQ-NBR              TO AR021-REF-SEQ.               09900099
099100     MOVE AR001-TRANSACTION-TIME TO AR021-TIME.                   09910099
099200     IF PS-H-RECEIVED-18-DIGIT-NO OR                              09920099
099300        PS-H-RECEIVED-12-DIGIT-NO                                 09930099
099400*          * CARD NUMBER IS KNOWN *                               09940099
099500           MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                     09950099
099600                                    TO AR021-CARD-ACCOUNT         09960099
099700                                       AR021-ACCOUNT-NUMBER       09970099
099800           MOVE AR001-ACCOUNT-NUMBER-11-12                        09980099
099900                                    TO AR021-CARD-LEVEL-OF-ISSUE  09990099
100000           MOVE AR004-DEFAULT-ACCOUNT-TYPE                        10000099
100100                                    TO AR021-ACCOUNT-TYPE         10010099
100200     ELSE                                                         10020099
100300*          * CARD NUMBER IS NOT KNOWN, USE ACCOUNT NUMBER *       10030099
100400           MOVE ZEROS               TO AR021-CARD-NO              10040099
100500           MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                     10050099
100600                                    TO AR021-ACCOUNT-NUMBER       10060099
100700           MOVE AR004-DEFAULT-ACCOUNT-TYPE                        10070099
100800                                    TO AR021-ACCOUNT-TYPE         10080099
100900     END-IF.                                                      10090099
101000     MOVE AR004-ISSUER            TO AR021-ISSUER.                10100099
101100     MOVE AR004-CARD-AGREEMENT    TO AR021-CARD-AGREEMENT.        10110099
101200     MOVE AR001-AUTH-NUMBER       TO AR021-AUTH-CODE.             10120099
101300     IF AR001-REFERRAL-TYPE IS NUMERIC                            10130099
101400         MOVE AR001-REFERRAL-TYPE                                 10140099
101500                                  TO AR021-REFERRAL-TYPE          10150099
101600     ELSE                                                         10160099
101700         MOVE ZERO                TO AR021-REFERRAL-TYPE          10170099
101800     END-IF.                                                      10180099
101900     MOVE ZERO                    TO AR021-AMOUNT                 10190099
102000                                     AR021-TRANS-TYPE.            10200099
102100                                                                  10210099
102200******************************************************************10220099
102300*  PROCESS THE INDIVIDUAL MERCHANDISE ITEM OF A TRANSACTION.     *10230099
102400******************************************************************10240099
102500                                                                  10250099
102600 2200-PROCESS-MERCHANDISE.                                        10260099
102700     IF AR001-SHIP-ADDR-ST > SPACES                               10270099
102800         PERFORM 2720-LOOKUP-STORE-INFO-BY-ST                     10280099
102900         MOVE TSTATE-ST-TX-RND-MTHD-CDE TO PV-SAVE-TX-RND-MTHD    10290099
103000     ELSE                                                         10300099
103100         PERFORM 2700-LOOKUP-STORE-INFO                           10310099
103200     END-IF.                                                      10320099
103300     IF AR001-ORD-NBR > SPACES                                    10330099
103400         MOVE ZERO TO PV-TRAN-TAX-RT-CTR                          10340099
103500         INITIALIZE PT-TAX-RATE-TABLE                             10350099
103600     END-IF.                                                      10360099
103700                                                                  10370099
103800     EVALUATE TRUE                                                10380099
103900         WHEN AR001-SALES-TAX-ITEM                                10390099
104000             PERFORM 2220-PROCESS-TAX                             10400099
104100         WHEN AR001-TLCD-ITEM                                     10410099
104200             PERFORM 2230-PROCESS-TLCD                            10420099
104300**  GIFT CARDS WERE CHANGED TO A 981 DEPT BY PROGRAM ARKUT058 SO  10430099
104400**  THE GIFT CERTIFICATES AND GIFT CARDS WOULD GET SUMMARIZED     10440099
104500**  TOGETHER ON THE STATEMENT, EVEN THOUGH THIS 'WHEN' IS CHECKING10450099
104600**  FOR BOTH DEPARTMENTS.                                         10460099
104700         WHEN AR001-BOTH-GIFT-ITEM                                10470099
104800             IF (AR001-POS-RETURN OR                              10480099
104900                 AR001-MIXED-MODE-OR-PRICE-ADJ)                   10490099
105000                 MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT          10500099
105100                 MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT          10510099
105200                 MULTIPLY -1 BY AR001-SBJCT-TO-TX-AMT             10520099
105300                 MULTIPLY -1 BY AR001-EMPL-DISC-TRN-AMT           10530099
105400             END-IF                                               10540099
105500             PERFORM 2240-PROCESS-GIFT-CARD-PURCH                 10550099
105600         WHEN AR001-OTHER-TENDER                                  10560099
105700             PERFORM 2250-PROCESS-OTHER-TENDER                    10570099
105800         WHEN AR001-SCANNING-PENALTY-ITEM                         10580099
105900             PERFORM 2270-PROCESS-SCANNING-PENALTY                10590099
106000         WHEN AR001-SHIPPING-ITEM                                 10600099
106100             PERFORM 2280-PROCESS-SHIPPING-ITEM                   10610099
106200         WHEN AR001-GIFT-WRAP-ITEM                                10620099
106300             PERFORM 2290-PROCESS-GIFT-WRAP-ITEM                  10630099
106400         WHEN AR001-FEE-ITEM                                      10640099
106500             PERFORM 2295-PROCESS-FEE-ITEM                        10650099
106600         WHEN OTHER                                               10660099
106700             PERFORM 2210-PROCESS-REGULAR-MDSE-ITEM               10670099
106800     END-EVALUATE.                                                10680099
106900                                                                  10690099
107000******************************************************************10700099
107100*  PROCESS A REGULAR MERCHANDISE ITEM.                           *10710099
107200******************************************************************10720099
107300                                                                  10730099
107400 2210-PROCESS-REGULAR-MDSE-ITEM.                                  10740099
107500                                                                  10750099
107600     MOVE ZERO TO PV-M-NET-TAXABLE-AMT.                           10760099
107700     MOVE ZERO TO PV-LINE-ITEM-TAX.                               10770099
107800     MOVE ZERO TO PV-LI-NET-TAXABLE-AMT.                          10780099
107900                                                                  10790099
108000     IF (AR001-POS-RETURN OR                                      10800099
108100         AR001-MIXED-MODE-OR-PRICE-ADJ)                           10810099
108200         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  10820099
108300         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  10830099
108400         MULTIPLY -1 BY AR001-SBJCT-TO-TX-AMT                     10840099
108500         MULTIPLY -1 BY AR001-EMPL-DISC-TRN-AMT                   10850099
108600     END-IF.                                                      10860099
108700                                                                  10870099
108800     PERFORM 2600-GET-DESCRIPTION.                                10880099
108900                                                                  10890099
109000     EVALUATE TRUE                                                10900099
109100         WHEN AR001-NON-EMPLOYEE                                  10910099
109200         WHEN AR001-EMPL-DISC-TRN-AMT = ZERO                      10920099
109300         WHEN AR001-POS-RETURN AND AR001-GIFT-RCPT-CDE = 'Y'      10930099
109400         WHEN AR001-POS-CHARGE AND AR001-GIFT-RCPT-CDE = 'Y' AND  10940099
109500              AR001-TRN-STAT-CDE = 'R'                            10950099
109600             MOVE AR001-SBJCT-TO-TX-AMT    TO                     10960099
109700                  PV-LI-NET-TAXABLE-AMT                           10970099
109800                  PV-LI-ORIG-N-TXBL-AMT                           10980099
109900                  PV-M-NET-TAXABLE-AMT                            10990099
110000             SET PS-EMPLOYEE-DISC-NOT-CALC TO TRUE                11000099
110100         WHEN AR001-MIXED-MODE-OR-PRICE-ADJ AND                   11010099
110200              AR001-GIFT-RCPT-CDE = 'Y'     AND                   11020099
110300              AR001-SBJCT-TO-TX-AMT    < 0                        11030099
110400             MOVE AR001-TRANSACTION-AMOUNT TO                     11040099
110500                  PV-LI-NET-TAXABLE-AMT                           11050099
110600                  PV-LI-ORIG-N-TXBL-AMT                           11060099
110700                  PV-M-NET-TAXABLE-AMT                            11070099
110800             SET PS-EMPLOYEE-DISC-NOT-CALC TO TRUE                11080099
110900         WHEN OTHER                                               11090099
111000             PERFORM 2211-CALCULATE-EMPL-DISCOUNT                 11100099
111100             SET PS-EMPLOYEE-DISC-CALC TO TRUE                    11110099
111200     END-EVALUATE.                                                11120099
111300                                                                  11130099
111400*** CALCULATE SALES TAX PER LINE ITEM ***                         11140099
111500                                                                  11150099
111600     IF AR001-EMP-DISC-SRC-CDE = 'S'                              11160099
111700         PERFORM 2225-COMPUTE-LINE-ITEM-TAX                       11170099
111800     ELSE                                                         11180099
111900         MOVE AR001-TAX-AMOUNT   TO PV-LINE-ITEM-TAX              11190099
112000     END-IF.                                                      11200099
112100                                                                  11210099
112200     IF PS-EMPLOYEE-DISC-CALC                                     11220099
112300         ADD PV-LINE-ITEM-TAX TO PV-SAVE-TOTAL-TAX                11230099
112400     ELSE                                                         11240099
112500         ADD PV-LINE-ITEM-TAX TO PV-NON-DISC-TAX-AMT              11250099
112600     END-IF.                                                      11260099
112700                                                                  11270099
112800*** POSTING TOTAL ***                                             11280099
112900     ADD AR001-TRANSACTION-AMOUNT                                 11290099
113000                                TO PV-POSTING-TOTAL-AMT.          11300099
113100                                                                  11310099
113200******************************************************************11320099
113300*  HANDLE TAX ADJUSTMENT FOR ASSOC DISCOUNT.                     *11330099
113400******************************************************************11340099
113500 2211-CALCULATE-EMPL-DISCOUNT.                                    11350099
113600                                                                  11360099
113700     MOVE AR001-EMP-DISC-AMT     TO PV-EMPLOYEE-DISCOUNT.         11370099
113800     MOVE AR001-EMP-DISC-SRC-CDE TO PV-EMP-DISC-SRC-CDE.          11380099
113900                                                                  11390099
114000*   USING NET CHARGED AMOUNT HERE TO MAKE SURE THE MARKDOWN       11400099
114100*   CANCEL IS BACK IN THE TAXABLE AMOUNT                          11410099
114200                                                                  11420099
114300     MOVE AR001-SBJCT-TO-TX-AMT    TO PV-LI-NET-TAXABLE-AMT.      11430099
114400                                                                  11440099
114500     MOVE PV-LI-NET-TAXABLE-AMT                                   11450099
114600          TO PV-M-NET-TAXABLE-AMT.                                11460099
114700                                                                  11470099
114800     COMPUTE PV-LI-ORIG-N-TXBL-AMT = AR001-SBJCT-TO-TX-AMT        11480099
114900                                   + (AR001-EMP-DISC-AMT * -1).   11490099
115000                                                                  11500099
115100     COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED =                      11510099
115200             PV-TOTAL-DISCOUNT-AMT +                              11520099
115300             PV-EMPLOYEE-DISCOUNT                                 11530099
115400     END-COMPUTE                                                  11540099
115500                                                                  11550099
115600     ADD AR001-TRANSACTION-AMOUNT                                 11560099
115700                             TO PV-TOTAL-ORIGINAL-AMT             11570099
115800*** NON-DISCOUNTABLE TOTAL ***                                    11580099
115900     IF  AR001-EMP-DISC-AMT = ZERO                                11590099
116000         ADD AR001-TRANSACTION-AMOUNT                             11600099
116100                             TO PV-NON-DISC-TOTAL-AMT             11610099
116200     END-IF.                                                      11620099
116300******************************************************************11630099
116400*  PROCESS THE SALES TAX ITEM.                                   *11640099
116500*** EMPLOYEE DISCOUNT ***                                         11650099
116600*   EMPLOYEE DISCOUNT DOES NOT APPLY TO TAX                       11660099
116700******************************************************************11670099
116800                                                                  11680099
116900 2220-PROCESS-TAX.                                                11690099
117000                                                                  11700099
117100     IF (AR001-POS-RETURN OR                                      11710099
117200         AR001-MIXED-MODE-OR-PRICE-ADJ)                           11720099
117300         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  11730099
117400     END-IF.                                                      11740099
117500                                                                  11750099
117600*** POSTING TOTAL ***                                             11760099
117700     ADD AR001-TRANSACTION-AMOUNT                                 11770099
117800                                TO PV-POSTING-TOTAL-AMT.          11780099
117900                                                                  11790099
118000     IF PV-SAVE-EMPLOYEE                                          11800099
118100         ADD AR001-TRANSACTION-AMOUNT TO                          11810099
118200             PV-ORIGINAL-TAX-AMT                                  11820099
118300             PV-TOT-ORIG-TAX-AMT                                  11830099
118400     END-IF.                                                      11840099
118500                                                                  11850099
118600******************************************************************11860099
118700*  COMPUTE LINE ITEM SALES TAX AMOUNT WITH EMP DISC INCLUDED     *11870099
118800******************************************************************11880099
118900                                                                  11890099
119000 2225-COMPUTE-LINE-ITEM-TAX.                                      11900099
119100                                                                  11910099
119200**** DETERMINE THE TAX RATE TO USE FOR THIS ITEM                 *11920099
119300**** USE REGULAR TAX RATE UNLESS THERE IS A THRESHOLD AND        *11930099
119400**** NET TAXABLE AMOUNT FOR LINE ITEM IS UNDER THE THRESHOLD.    *11940099
119500     MOVE AR001-TAX-RATE-PCT TO PV-SAVE-TAX-RATE-PCT.             11950099
119600     IF AR001-TAX-THRESH-AMOUNT NOT = ZERO                        11960099
119700        IF PV-M-NET-TAXABLE-AMT    <                              11970099
119800           AR001-TAX-THRESH-AMOUNT                                11980099
119900           MOVE AR001-TAX-RATE-BELOW-THRESH TO                    11990099
120000                PV-SAVE-TAX-RATE-PCT                              12000099
120100        END-IF                                                    12010099
120200     END-IF.                                                      12020099
120300                                                                  12030099
120400**** IF THE TAX RATE IS GREATER THAN ZERO, SEARCH THE TAX RATE    12040099
120500**** TABLE FOR THE TAX RATE.  IF THE RATE DOES NOT EXIST IN THE   12050099
120600**** TABLE, INSERT IT.                                            12060099
120700     IF PV-SAVE-TAX-RATE-PCT > ZERO                               12070099
120800         SET TR-INDEX TO 1                                        12080099
120900         SEARCH PT-TAX-RATES                                      12090099
121000            AT END                                                12100099
121100               MOVE 'N' TO PS-RATE-MATCH-SW                       12110099
121200            WHEN PT-TAX-RATE (TR-INDEX) = PV-SAVE-TAX-RATE-PCT    12120099
121300               ADD  PV-LI-NET-TAXABLE-AMT TO                      12130099
121400                    PT-TAXABLE-AMT-TOT (TR-INDEX)                 12140099
121500               PERFORM 2226-CALC-LI-TAX                           12150099
121600               MOVE 'Y' TO PS-RATE-MATCH-SW                       12160099
121700         END-SEARCH                                               12170099
121800                                                                  12180099
121900         IF PS-RATE-NOT-FOUND                                     12190099
122000             ADD 1 TO PV-TRAN-TAX-RT-CTR                          12200099
122100             IF PV-TRAN-TAX-RT-CTR > PC-MAX-TRAN-TAX-RATES        12210099
122200                 PERFORM 9200-TRAN-TAX-ERROR                      12220099
122300             ELSE                                                 12230099
122400                 SET TR-INDEX TO PV-TRAN-TAX-RT-CTR               12240099
122500                 MOVE PV-LI-NET-TAXABLE-AMT TO                    12250099
122600                      PT-TAXABLE-AMT-TOT (TR-INDEX)               12260099
122700                 MOVE PV-SAVE-TAX-RATE-PCT TO                     12270099
122800                      PT-TAX-RATE (TR-INDEX)                      12280099
122900                 PERFORM 2226-CALC-LI-TAX                         12290099
123000             END-IF                                               12300099
123100         END-IF                                                   12310099
123200      END-IF.                                                     12320099
123300                                                                  12330099
123400******************************************************************12340099
123500* 2226-CALC-LI-TAX                                                12350099
123600* A)CALCULATE THE TOTAL TAX FOR THE TAX RATE BY MULTIPLYING THE   12360099
123700*   TAX RATE BY THE TOTAL AMOUNT FOR THE TAX RATE.                12370099
123800* B)ROUND THE CALCULATION IN STEP A BASED ON THE ROUNDING METHOD  12380099
123900*   INDICATED FOR THE STATE.                                      12390099
124000*   - TAX ROUNDING METHOD 1 INDICATES TO ALWAYS ROUND UP.         12400099
124100*   - TAX ROUNDING METHOD 5 INDICATES STANDARD ROUNDING.          12410099
124200* C)DETERMINE THE TAX RATE FOR THE LINE ITEM BY SUBTRACTING THE   12420099
124300*   OLD TAX TOTAL FROM THE NEW TAX TOTAL.                         12430099
124400******************************************************************12440099
124500                                                                  12450099
124600 2226-CALC-LI-TAX.                                                12460099
124700                                                                  12470099
124800     IF PV-SAVE-TX-RND-MTHD = '1'                                 12480099
124900        COMPUTE PV-WORK-TAX-AMT =                                 12490099
125000                PT-TAXABLE-AMT-TOT (TR-INDEX) *                   12500099
125100                PV-SAVE-TAX-RATE-PCT                              12510099
125200        END-COMPUTE                                               12520099
125300        COMPUTE PV-TEMP-TAX-NUM =                                 12530099
125400                PT-TAXABLE-AMT-TOT (TR-INDEX) *                   12540099
125500                PV-SAVE-TAX-RATE-PCT *                            12550099
125600                1000                                              12560099
125700        END-COMPUTE                                               12570099
125800        MOVE PV-TEMP-TAX-NUM TO PV-TEMP-TAX-CHAR                  12580099
125900        IF PV-TEMP-TAX-CHAR (10:1) NOT = '0'                      12590099
126000           EVALUATE TRUE                                          12600099
126100              WHEN PV-WORK-TAX-AMT < 0                            12610099
126200                  SUBTRACT .01 FROM PV-WORK-TAX-AMT               12620099
126300              WHEN PV-WORK-TAX-AMT > 0                            12630099
126400                  ADD      .01 TO   PV-WORK-TAX-AMT               12640099
126500           END-EVALUATE                                           12650099
126600        END-IF                                                    12660099
126700     ELSE                                                         12670099
126800        COMPUTE PV-WORK-TAX-AMT ROUNDED =                         12680099
126900                PT-TAXABLE-AMT-TOT (TR-INDEX) *                   12690099
127000                PV-SAVE-TAX-RATE-PCT                              12700099
127100        END-COMPUTE                                               12710099
127200     END-IF.                                                      12720099
127300     COMPUTE PV-LINE-ITEM-TAX =                                   12730099
127400             PV-WORK-TAX-AMT -                                    12740099
127500             PT-TAX-AMT-TOT (TR-INDEX)                            12750099
127600     END-COMPUTE.                                                 12760099
127700     MOVE PV-WORK-TAX-AMT  TO PT-TAX-AMT-TOT (TR-INDEX).          12770099
127800                                                                  12780099
127900******************************************************************12790099
128000*  PROCESS A TRANSACTION LEVEL CASH DISCOUNT.                    *12800099
128100*  (THIS WOULD BE A KOHLS COUPON OR SENIOR CITIZEN DISCOUNT.)    *12810099
128200******************************************************************12820099
128300                                                                  12830099
128400 2230-PROCESS-TLCD.                                               12840099
128500                                                                  12850099
128600     IF (AR001-POS-RETURN OR                                      12860099
128700         AR001-MIXED-MODE-OR-PRICE-ADJ)                           12870099
128800         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  12880099
128900     END-IF.                                                      12890099
129000     IF AR001-MERCHANDISE-ID = AR004-SENIOR-DISCOUNT-SKU          12900099
129100         MOVE 'SENIOR DISCOUNT'  TO PV-DESCRIPTION                12910099
129200     ELSE                                                         12920099
129300         PERFORM 2600-GET-DESCRIPTION                             12930099
129400     END-IF.                                                      12940099
129500                                                                  12950099
129600*** POSTING TOTAL ***                                             12960099
129700     ADD AR001-TRANSACTION-AMOUNT                                 12970099
129800                                TO PV-POSTING-TOTAL-AMT.          12980099
129900                                                                  12990099
130000     IF AR001-NON-EMPLOYEE                                        13000099
130100         CONTINUE                                                 13010099
130200     ELSE                                                         13020099
130300         ADD AR001-TRANSACTION-AMOUNT                             13030099
130400                                 TO PV-TOTAL-COUPON-AMT           13040099
130500     END-IF.                                                      13050099
130600                                                                  13060099
130700******************************************************************13070099
130800*  PROCESS THE PURCHASE OF A GIFT CARD.                          *13080099
130900******************************************************************13090099
131000                                                                  13100099
131100 2240-PROCESS-GIFT-CARD-PURCH.                                    13110099
131200                                                                  13120099
131300     MOVE ZERO TO PV-LINE-ITEM-TAX.                               13130099
131400                                                                  13140099
131500     MOVE 'GIFT CARD'           TO PV-DESCRIPTION.                13150099
131600                                                                  13160099
131700*** POSTING TOTAL ***                                             13170099
131800     ADD AR001-TRANSACTION-AMOUNT                                 13180099
131900                                TO PV-POSTING-TOTAL-AMT.          13190099
132000                                                                  13200099
132100     IF AR001-NON-EMPLOYEE OR AR001-TNDR-TYP-CDE > SPACES         13210099
132200         CONTINUE                                                 13220099
132300     ELSE                                                         13230099
132400         MOVE AR001-EMP-DISC-AMT TO PV-EMPLOYEE-DISCOUNT          13240099
132500                                                                  13250099
132600         COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED =                  13260099
132700                 PV-TOTAL-DISCOUNT-AMT +                          13270099
132800                 PV-EMPLOYEE-DISCOUNT                             13280099
132900                                                                  13290099
133000         ADD AR001-TRANSACTION-AMOUNT                             13300099
133100                                 TO PV-TOTAL-ORIGINAL-AMT         13310099
133200*** NON-DISCOUNTABLE TOTAL ***                                    13320099
133300         IF  PV-EMPLOYEE-DISCOUNT = 0                             13330099
133400             ADD AR001-TRANSACTION-AMOUNT                         13340099
133500                                 TO PV-NON-DISC-TOTAL-AMT         13350099
133600         END-IF                                                   13360099
133700     END-IF.                                                      13370099
133800                                                                  13380099
133900******************************************************************13390099
134000*  PROCESS THE REDEMPTION OF A GIFT CERTIFICATE.                 *13400099
134100******************************************************************13410099
134200                                                                  13420099
134300 2250-PROCESS-OTHER-TENDER.                                       13430099
134400                                                                  13440099
134500     IF (AR001-POS-RETURN OR                                      13450099
134600         AR001-MIXED-MODE-OR-PRICE-ADJ)                           13460099
134700         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  13470099
134800     END-IF.                                                      13480099
134900                                                                  13490099
135000*** POSTING TOTAL ***                                             13500099
135100     ADD AR001-TRANSACTION-AMOUNT                                 13510099
135200                                TO PV-POSTING-TOTAL-AMT.          13520099
135300                                                                  13530099
135400******************************************************************13540099
135500*  PROCESS A SCANNING PENALTY ITEM.                              *13550099
135600******************************************************************13560099
135700                                                                  13570099
135800 2270-PROCESS-SCANNING-PENALTY.                                   13580099
135900                                                                  13590099
136000     IF (AR001-POS-RETURN OR                                      13600099
136100         AR001-MIXED-MODE-OR-PRICE-ADJ)                           13610099
136200         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  13620099
136300     END-IF.                                                      13630099
136400     PERFORM 2600-GET-DESCRIPTION.                                13640099
136500                                                                  13650099
136600*** POSTING TOTAL ***                                             13660099
136700     ADD AR001-TRANSACTION-AMOUNT                                 13670099
136800                                TO PV-POSTING-TOTAL-AMT.          13680099
136900                                                                  13690099
137000******************************************************************13700099
137100*  PROCESS A SHIPPING ITEM.                                      *13710099
137200******************************************************************13720099
137300 2280-PROCESS-SHIPPING-ITEM.                                      13730099
137400                                                                  13740099
137500     IF  AR001-POS-RETURN OR AR001-MIXED-MODE-OR-PRICE-ADJ        13750099
137600         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  13760099
137700         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  13770099
137800         MULTIPLY -1 BY AR001-SBJCT-TO-TX-AMT                     13780099
137900     END-IF.                                                      13790099
138000     PERFORM 2600-GET-DESCRIPTION.                                13800099
138100                                                                  13810099
138200*** POSTING TOTAL ***                                             13820099
138300     ADD AR001-TRANSACTION-AMOUNT                                 13830099
138400                                TO PV-POSTING-TOTAL-AMT.          13840099
138500     ADD AR001-TRANSACTION-AMOUNT                                 13850099
138600                                TO PV-NON-DISC-TOTAL-AMT.         13860099
138700                                                                  13870099
138800     ADD AR001-TAX-AMOUNT       TO PV-NON-DISC-TAX-AMT.           13880099
138900                                                                  13890099
139000     IF AR001-NON-EMPLOYEE                                        13900099
139100         CONTINUE                                                 13910099
139200     ELSE                                                         13920099
139300*** WRITE OUT THE TAX AUDIT FILE ***                              13930099
139400         MOVE AR001-TAX-AMOUNT          TO PV-LINE-ITEM-TAX       13940099
139500         MOVE AR001-SBJCT-TO-TX-AMT     TO PV-LI-NET-TAXABLE-AMT  13950099
139600                                           PV-LI-ORIG-N-TXBL-AMT  13960099
139700         MOVE ZERO                      TO PV-EMPLOYEE-DISCOUNT   13970099
139800     END-IF.                                                      13980099
139900                                                                  13990099
140000******************************************************************14000099
140100*  PROCESS A GIFT WRAP ITEM.                                     *14010099
140200******************************************************************14020099
140300 2290-PROCESS-GIFT-WRAP-ITEM.                                     14030099
140400                                                                  14040099
140500     IF  AR001-POS-RETURN OR AR001-MIXED-MODE-OR-PRICE-ADJ        14050099
140600         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  14060099
140700         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  14070099
140800         MULTIPLY -1 BY AR001-SBJCT-TO-TX-AMT                     14080099
140900     END-IF.                                                      14090099
141000     PERFORM 2600-GET-DESCRIPTION.                                14100099
141100                                                                  14110099
141200*** POSTING TOTAL ***                                             14120099
141300     ADD AR001-TRANSACTION-AMOUNT                                 14130099
141400                                TO PV-POSTING-TOTAL-AMT.          14140099
141500     ADD AR001-TRANSACTION-AMOUNT                                 14150099
141600                                TO PV-NON-DISC-TOTAL-AMT.         14160099
141700                                                                  14170099
141800     ADD AR001-TAX-AMOUNT       TO PV-NON-DISC-TAX-AMT.           14180099
141900                                                                  14190099
142000     IF AR001-NON-EMPLOYEE                                        14200099
142100         CONTINUE                                                 14210099
142200     ELSE                                                         14220099
142300*** WRITE OUT THE TAX AUDIT FILE ***                              14230099
142400         MOVE AR001-TAX-AMOUNT          TO PV-LINE-ITEM-TAX       14240099
142500         MOVE AR001-SBJCT-TO-TX-AMT     TO PV-LI-NET-TAXABLE-AMT  14250099
142600                                           PV-LI-ORIG-N-TXBL-AMT  14260099
142700         MOVE ZERO                      TO PV-EMPLOYEE-DISCOUNT   14270099
142800     END-IF.                                                      14280099
142900                                                                  14290099
143000******************************************************************14300099
143100*  PROCESS A FEE ITEM.                                           *14310099
143200******************************************************************14320099
143300 2295-PROCESS-FEE-ITEM.                                           14330099
143400                                                                  14340099
143500     IF  AR001-POS-RETURN OR AR001-MIXED-MODE-OR-PRICE-ADJ        14350099
143600         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  14360099
143700         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  14370099
143800         MULTIPLY -1 BY AR001-SBJCT-TO-TX-AMT                     14380099
143900     END-IF.                                                      14390099
144000     MOVE AR001-FEE-DESC        TO PV-DESCRIPTION.                14400099
144100                                                                  14410099
144200*** POSTING TOTAL ***                                             14420099
144300     ADD AR001-TRANSACTION-AMOUNT                                 14430099
144400                                TO PV-POSTING-TOTAL-AMT.          14440099
144500     ADD AR001-TRANSACTION-AMOUNT                                 14450099
144600                                TO PV-NON-DISC-TOTAL-AMT.         14460099
144700                                                                  14470099
144800     ADD AR001-TAX-AMOUNT       TO PV-NON-DISC-TAX-AMT.           14480099
144900                                                                  14490099
145000     IF AR001-NON-EMPLOYEE                                        14500099
145100         CONTINUE                                                 14510099
145200     ELSE                                                         14520099
145300*** WRITE OUT THE TAX AUDIT FILE ***                              14530099
145400         MOVE AR001-TAX-AMOUNT          TO PV-LINE-ITEM-TAX       14540099
145500         MOVE AR001-SBJCT-TO-TX-AMT     TO PV-LI-NET-TAXABLE-AMT  14550099
145600                                           PV-LI-ORIG-N-TXBL-AMT  14560099
145700         MOVE ZERO                      TO PV-EMPLOYEE-DISCOUNT   14570099
145800     END-IF.                                                      14580099
145900                                                                  14590099
146000******************************************************************14600099
146100*  CREATE A POSTING FILE RECORD FOR A TRANSACTION THAT HAS NO    *14610099
146200*  MERCHANDISE DETAIL.                                           *14620099
146300******************************************************************14630099
146400                                                                  14640099
146500 2300-PROCESS-POSTING-ONLY.                                       14650099
146600                                                                  14660099
146700     MOVE SPACES                  TO AR021-AR-POSTING-RECORD.     14670099
146800     MOVE AR001-STORE-NUMBER      TO PV-STORE-NUMBER.             14680099
146900     MOVE PV-STORE-NUMBER         TO AR021-MERCHANT-ID.           14690099
147000     IF AR001-POS-TRANSACTION                                     14700099
147100         SET AR021-SS-ORIG-TRANS  TO TRUE                         14710099
147200     ELSE                                                         14720099
147300         SET AR021-SS-ORIG-TRANS-REVERSAL                         14730099
147400                                  TO TRUE                         14740099
147500     END-IF.                                                      14750099
147600     MOVE ZERO                    TO AR021-DEPT-ID.               14760099
147700     MOVE AR001-TERMINAL-NUMBER   TO PV-TERM-NUMBER.              14770099
147800     MOVE PV-TERM-NUMBER          TO AR021-POS-ID.                14780099
147900     MOVE AR001-TRN-DTE(1:2)      TO PV-TRANS-MM.                 14790099
148000     MOVE AR001-TRN-DTE(3:2)      TO PV-TRANS-DD.                 14800099
148100     MOVE AR001-TRN-DTE(5:2)      TO PV-TRANS-YY.                 14810099
148200     IF PV-TRANS-YY < 80                                          14820099
148300         MOVE 20                  TO PV-TRANS-CC                  14830099
148400     ELSE                                                         14840099
148500         MOVE 19                  TO PV-TRANS-CC                  14850099
148600     END-IF.                                                      14860099
148700     MOVE PV-TRANS-DATE           TO AR021-ENTRY-DATE.            14870099
148800     MOVE AR001-TRANSACTION-NUMBER                                14880099
148900                                  TO PV-TRANS-NUMBER.             14890099
149000     MOVE ZERO                    TO AR021-REF-SEQ.               14900099
149100     MOVE PV-TRANS-NUMBER         TO AR021-REF-NO.                14910099
149200     MOVE AR001-TRANSACTION-TIME TO AR021-TIME.                   14920099
149300     MOVE AR001-BIN-NUMBER       TO AR021-BIN-NUMBER.             14930099
149400                                                                  14940099
149500     EVALUATE TRUE                                                14950099
149600         WHEN AR001-PAYMENT                                       14960099
149700             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   14970099
149800                                  TO AR021-CARD-NO                14980099
149900             MOVE AR001-ACCOUNT-NUMBER-11-12                      14990099
150000                                  TO AR021-CARD-LEVEL-OF-ISSUE    15000099
150100             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   15010099
150200                                  TO AR021-ACCOUNT-NUMBER         15020099
150300             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      15030099
150400                                  TO AR021-ACCOUNT-TYPE           15040099
150500                                                                  15050099
150600         WHEN AR001-ACCOUNT-NUMBER-11-12 NUMERIC                  15060099
150700            AND AR001-POS-TRANSACTION                             15070099
150800             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   15080099
150900                                  TO AR021-CARD-ACCOUNT           15090099
151000                                     AR021-ACCOUNT-NUMBER         15100099
151100             MOVE AR001-ACCOUNT-NUMBER-11-12                      15110099
151200                                  TO AR021-CARD-LEVEL-OF-ISSUE    15120099
151300             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      15130099
151400                                  TO AR021-ACCOUNT-TYPE           15140099
151500                                                                  15150099
151600         WHEN AR001-ACCOUNT-NUMBER-11-12 NUMERIC                  15160099
151700             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   15170099
151800                                  TO AR021-CARD-ACCOUNT           15180099
151900                                     AR021-ACCOUNT-NUMBER         15190099
152000             MOVE AR001-ACCOUNT-NUMBER-11-12                      15200099
152100                                  TO AR021-CARD-LEVEL-OF-ISSUE    15210099
152200             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      15220099
152300                                  TO AR021-ACCOUNT-TYPE           15230099
152400                                                                  15240099
152500         WHEN OTHER                                               15250099
152600             MOVE ZEROS           TO AR021-CARD-NO                15260099
152700             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   15270099
152800                                  TO AR021-ACCOUNT-NUMBER         15280099
152900             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      15290099
153000                                  TO AR021-ACCOUNT-TYPE           15300099
153100                                                                  15310099
153200     END-EVALUATE.                                                15320099
153300                                                                  15330099
153400     MOVE AR004-ISSUER            TO AR021-ISSUER.                15340099
153500     MOVE AR004-CARD-AGREEMENT    TO AR021-CARD-AGREEMENT.        15350099
153600     MOVE AR001-AUTH-NUMBER       TO AR021-AUTH-CODE.             15360099
153700     IF AR001-REFERRAL-TYPE IS NUMERIC                            15370099
153800         MOVE AR001-REFERRAL-TYPE                                 15380099
153900                                  TO AR021-REFERRAL-TYPE          15390099
154000     ELSE                                                         15400099
154100         MOVE ZERO                TO AR021-REFERRAL-TYPE          15410099
154200     END-IF.                                                      15420099
154300                                                                  15430099
154400     EVALUATE TRUE                                                15440099
154500         WHEN AR001-DEBIT-ADJUSTMENT                              15450099
154600             MOVE AR001-TRANSACTION-AMOUNT                        15460099
154700                                  TO AR021-AMOUNT                 15470099
154800             MOVE AR004-TRANS-DEBIT-ADJ-CD                        15480099
154900                                  TO AR021-TRANS-TYPE             15490099
155000         WHEN AR001-PAYMENT                                       15500099
155100             IF AR001-POS-TRANSACTION                             15510099
155200                 MOVE AR001-TRANSACTION-AMOUNT                    15520099
155300                                  TO AR021-AMOUNT                 15530099
155400                 MOVE AR004-TRANS-STORE-PAYMENT-CD                15540099
155500                                  TO AR021-TRANS-TYPE             15550099
155600             ELSE                                                 15560099
155700                 IF AR001-LATE-VOID-TRANSACTION                   15570099
155800                    COMPUTE AR001-TRANSACTION-AMOUNT =            15580099
155900                            AR001-TRANSACTION-AMOUNT * -1         15590099
156000                    END-COMPUTE                                   15600099
156100                    MOVE AR001-TRANSACTION-AMOUNT                 15610099
156200                                  TO AR021-AMOUNT                 15620099
156300                    MOVE AR004-TRANS-LATE-VOID-CD                 15630099
156400                                  TO AR021-TRANS-TYPE             15640099
156500                 ELSE                                             15650099
156600                    MOVE AR001-TRANSACTION-AMOUNT                 15660099
156700                                  TO AR021-AMOUNT                 15670099
156800                    MOVE AR004-TRANS-SA-PAY-CR-ADJ-CD             15680099
156900                                  TO AR021-TRANS-TYPE             15690099
157000                 END-IF                                           15700099
157100             END-IF                                               15710099
157200     END-EVALUATE.                                                15720099
157300                                                                  15730099
157400     PERFORM 7200-WRITE-POSTING-TRANS.                            15740099
157500                                                                  15750099
157600******************************************************************15760099
157700*  UPDATE THE POSTING TRANSACTION RECORD WHICH WAS PREVIOUSLY    *15770099
157800*  CREATED FOR THIS TRANSACTION.  ADD THE APPROPRIATE AMOUNT     *15780099
157900*  AND TRANSACTION TYPE TO THE RECORD.                           *15790099
158000******************************************************************15800099
158100                                                                  15810099
158200 2400-UPDATE-POSTING-TRANS.                                       15820099
158300                                                                  15830099
158400     IF PV-POSTING-TOTAL-AMT >= ZERO                              15840099
158500         IF AR021-SS-ORIG-TRANS                                   15850099
158600             MOVE AR004-TRANS-STORE-SLS-CD                        15860099
158700                                  TO AR021-TRANS-TYPE             15870099
158800         ELSE                                                     15880099
158900             MOVE AR004-TRANS-SLS-AUD-SLS-ADJ-CD                  15890099
159000                                  TO AR021-TRANS-TYPE             15900099
159100         END-IF                                                   15910099
159200     ELSE                                                         15920099
159300         IF AR021-SS-ORIG-TRANS                                   15930099
159400             MOVE AR004-TRANS-STORE-RET-CD                        15940099
159500                                  TO AR021-TRANS-TYPE             15950099
159600         ELSE                                                     15960099
159700             MOVE AR004-TRANS-SLS-AUD-RET-ADJ-CD                  15970099
159800                                  TO AR021-TRANS-TYPE             15980099
159900         END-IF                                                   15990099
160000     END-IF.                                                      16000099
160100                                                                  16010099
160200     IF PV-POSTING-TOTAL-AMT < ZERO                               16020099
160300         MULTIPLY -1 BY PV-POSTING-TOTAL-AMT                      16030099
160400     END-IF.                                                      16040099
160500     MOVE PV-POSTING-TOTAL-AMT    TO AR021-AMOUNT.                16050099
160600                                                                  16060099
160700******************************************************************16070099
160800*  CREATE A POSTING FILE RECORD FOR EMPLOYEE DISCOUNT.           *16080099
160900*  SEE COMMENTS IN WORKING STORAGE FOR AN EXAMPLE OF THIS        *16090099
161000*  CALCULATION.                                                  *16100099
161100*  IF TOTAL TRANSACTION AMOUNT OR TOTAL AMOUNT PLUS COUPON ARE   *16110099
161200*  EQUAL TO ZERO, THERE WILL BE NO EMPLOYEE DISCOUNT (CAN'T DO   *16120099
161300*  DISCOUNT ON A ZERO AMOUNT).                                   *16130099
161400******************************************************************16140099
161500                                                                  16150099
161600 2500-CREATE-EMPL-DISCOUNT.                                       16160099
161700                                                                  16170099
161800***** COMPUTE TAX ADJUSTMENT AMOUNT                               16180099
161900          IF PS-ASSOC-CASH                                        16190099
162000              MOVE 0 TO PV-TAX-ADJUST-AMT                         16200099
162100          ELSE                                                    16210099
162200              COMPUTE PV-TAX-ADJUST-AMT ROUNDED                   16220099
162300                    = PV-ORIGINAL-TAX-AMT                         16230099
162400                    - PV-SAVE-TOTAL-TAX                           16240099
162500                    - PV-NON-DISC-TAX-AMT                         16250099
162600              END-COMPUTE                                         16260099
162700          END-IF                                                  16270099
162800*****                                                             16280099
162900***** COMPUTE FINAL DISCOUNT                                      16290099
163000*****                                                             16300099
163100         COMPUTE PV-FINAL-DISCOUNT-AMT                            16310099
163200               = (PV-TOTAL-DISCOUNT-AMT * -1)                     16320099
163300                 + PV-TAX-ADJUST-AMT                              16330099
163400         END-COMPUTE                                              16340099
163500                                                                  16350099
163600         IF PV-FINAL-DISCOUNT-AMT >= ZERO                         16360099
163700             MOVE AR004-TRANS-EMPL-DISC-SLS-CD                    16370099
163800                                TO AR021-TRANS-TYPE               16380099
163900         ELSE                                                     16390099
164000             MOVE AR004-TRANS-EMPL-DISC-RET-CD                    16400099
164100                                TO AR021-TRANS-TYPE               16410099
164200             MULTIPLY -1 BY PV-FINAL-DISCOUNT-AMT                 16420099
164300         END-IF                                                   16430099
164400                                                                  16440099
164500         MOVE PV-FINAL-DISCOUNT-AMT TO AR021-AMOUNT               16450099
164600         MOVE PV-EMP-DISC-SRC-CDE   TO AR021-EMP-DISC-SRC-CDE     16460099
164700                                                                  16470099
164800         IF AR021-AMOUNT = ZERO                                   16480099
164900             CONTINUE                                             16490099
165000         ELSE                                                     16500099
165100             PERFORM 7200-WRITE-POSTING-TRANS                     16510099
165200         END-IF.                                                  16520099
165300                                                                  16530099
165400******************************************************************16540099
165500*  GET THE POS DESCRIPTION OF THE DEPT/CLASS FROM THE TABLE      *16550099
165600*  IN WORKING-STORAGE.                                           *16560099
165700******************************************************************16570099
165800                                                                  16580099
165900 2600-GET-DESCRIPTION.                                            16590099
166000                                                                  16600099
166100     SEARCH ALL CD-CLASS-DESC-ENTRY                               16610099
166200         AT END                                                   16620099
166300             MOVE 'MISCELLANEOUS' TO PV-DESCRIPTION               16630099
166400         WHEN CD-DEPT-NUMBER  (CD-CLASS-IDX)                      16640099
166500                                 = AR001-ITEM-DEPARTMENT          16650099
166600          AND CD-CLASS-NUMBER (CD-CLASS-IDX)                      16660099
166700                                 = AR001-ITEM-CLASS               16670099
166800             MOVE CD-CLASS-POS-DESC (CD-CLASS-IDX)                16680099
166900                                TO PV-DESCRIPTION                 16690099
167000     END-SEARCH.                                                  16700099
167100                                                                  16710099
167200******************************************************************16720099
167300*  LOOKUP THE SALES TAX ROUNDING METHOD FROM THE TSTATE TABLE    *16730099
167400******************************************************************16740099
167500                                                                  16750099
167600 2700-LOOKUP-STORE-INFO.                                          16760099
167700     IF AR001-ORD-NBR > SPACES                                    16770099
167800         MOVE PC-EFC-LOC-873     TO XST00001-LOC-NBR              16780099
167900     ELSE                                                         16790099
168000         MOVE AR001-ORG-STR-NBR  TO XST00001-LOC-NBR              16800099
168100     END-IF.                                                      16810099
168200                                                                  16820099
168300     EXEC SQL                                                     16830099
168400         SELECT B.ST_TX_RND_MTHD_CDE                              16840099
168500           INTO :TSTATE-ST-TX-RND-MTHD-CDE                        16850099
168600           FROM XST_LOC A                                         16860099
168700           JOIN TSTATE  B                                         16870099
168800             ON A.ST_CDE  = B.STATE_CODE                          16880099
168900          WHERE A.LOC_NBR = :XST00001-LOC-NBR                     16890099
169000            WITH UR                                               16900099
169100     END-EXEC.                                                    16910099
169200                                                                  16920099
169300     EVALUATE SQLCODE                                             16930099
169400         WHEN ZERO                                                16940099
169500             MOVE TSTATE-ST-TX-RND-MTHD-CDE TO                    16950099
169600                  PV-SAVE-TX-RND-MTHD                             16960099
169700         WHEN OTHER                                               16970099
169800             MOVE XST00001-LOC-NBR TO PV-XST00001-LOC-NBR         16980099
169900             DISPLAY 'STORE NUMBER: ' PV-XST00001-LOC-NBR         16990099
170000             SET PV-SELECT-ROUND-ROW TO TRUE                      17000099
170100             PERFORM 9100-DB2-ERROR                               17010099
170200     END-EVALUATE.                                                17020099
170300                                                                  17030099
170400******************************************************************17040099
170500*  LOOKUP THE SALES TAX ROUNDING METHOD FROM THE TSTATE TABLE    *17050099
170600*  USING THE SHIP-TO STATE CODE IF AVAILABLE                     *17060099
170700******************************************************************17070099
170800 2720-LOOKUP-STORE-INFO-BY-ST.                                    17080099
170900     MOVE AR001-SHIP-ADDR-ST TO TSTATE-STATE-CODE.                17090099
171000                                                                  17100099
171100     EXEC SQL                                                     17110099
171200         SELECT B.ST_TX_RND_MTHD_CDE                              17120099
171300           INTO :TSTATE-ST-TX-RND-MTHD-CDE                        17130099
171400           FROM TSTATE B                                          17140099
171500          WHERE B.STATE_CODE = :TSTATE-STATE-CODE                 17150099
171600            WITH UR                                               17160099
171700     END-EXEC.                                                    17170099
171800                                                                  17180099
171900     EVALUATE SQLCODE                                             17190099
172000         WHEN ZERO                                                17200099
172100             CONTINUE                                             17210099
172200         WHEN OTHER                                               17220099
172300             DISPLAY 'STATE CODE: ' TSTATE-STATE-CODE             17230099
172400             SET PV-SELECT-ROUND-ROW-ST TO TRUE                   17240099
172500             PERFORM 9100-DB2-ERROR                               17250099
172600     END-EVALUATE.                                                17260099
172700                                                                  17270099
172800******************************************************************17280099
172900*  READ AN ACCOUNTS RECEIVABLE TRANSACTION RECORD.               *17290099
173000******************************************************************17300099
173100                                                                  17310099
173200 7000-READ-TRANSACTION-FILE.                                      17320099
173300     READ AR-TRANSACTION-FILE                                     17330099
173400         INTO AR001-AR-TRANSACTION-RECORD                         17340099
173500         AT END                                                   17350099
173600             SET PS-END-OF-TRANS-FILE TO TRUE                     17360099
173700         NOT AT END                                               17370099
173800             ADD +1 TO PA-INPUT-RCDS-READ                         17380099
173900     END-READ.                                                    17390099
174000                                                                  17400099
174100******************************************************************17410099
174200*  WRITE POSTING TRANSACTION RECORD.                             *17420099
174300******************************************************************17430099
174400                                                                  17440099
174500 7200-WRITE-POSTING-TRANS.                                        17450099
174600                                                                  17460099
174700     SET PT-FILE-IDX TO 1.                                        17470099
174800     SEARCH PT-POSTING-FILE-ENTRY VARYING PT-FILE-IDX             17480099
174900         AT END                                                   17490099
175000             MOVE PC-NBR-OF-POST-FILES TO PV-FILE-NUMBER          17500099
175100         WHEN (AR021-STORE-NO >= PT-BEGIN-STORE (PT-FILE-IDX)     17510099
175200           AND AR021-STORE-NO <= PT-END-STORE   (PT-FILE-IDX))    17520099
175300             SET PV-FILE-NUMBER TO PT-FILE-IDX                    17530099
175400     END-SEARCH.                                                  17540099
175500                                                                  17550099
175600     EVALUATE TRUE                                                17560099
175700         WHEN PV-FILE-NUMBER = 1                                  17570099
175800             WRITE POSTING-TRANS-RECORD-1                         17580099
175900                                FROM AR021-AR-POSTING-RECORD      17590099
176000             ADD +1 TO PA-POSTING-FILE-1                          17600099
176100         WHEN PV-FILE-NUMBER = 2                                  17610099
176200             WRITE POSTING-TRANS-RECORD-2                         17620099
176300                                FROM AR021-AR-POSTING-RECORD      17630099
176400             ADD +1 TO PA-POSTING-FILE-2                          17640099
176500         WHEN PV-FILE-NUMBER = 3                                  17650099
176600             WRITE POSTING-TRANS-RECORD-3                         17660099
176700                                FROM AR021-AR-POSTING-RECORD      17670099
176800             ADD +1 TO PA-POSTING-FILE-3                          17680099
176900         WHEN PV-FILE-NUMBER = 4                                  17690099
177000             WRITE POSTING-TRANS-RECORD-4                         17700099
177100                                FROM AR021-AR-POSTING-RECORD      17710099
177200             ADD +1 TO PA-POSTING-FILE-4                          17720099
177300         WHEN PV-FILE-NUMBER = 5                                  17730099
177400             WRITE POSTING-TRANS-RECORD-5                         17740099
177500                                FROM AR021-AR-POSTING-RECORD      17750099
177600             ADD +1 TO PA-POSTING-FILE-5                          17760099
177700         WHEN PV-FILE-NUMBER = 6                                  17770099
177800             WRITE POSTING-TRANS-RECORD-6                         17780099
177900                                FROM AR021-AR-POSTING-RECORD      17790099
178000             ADD +1 TO PA-POSTING-FILE-6                          17800099
178100         WHEN PV-FILE-NUMBER = 7                                  17810099
178200             WRITE POSTING-TRANS-RECORD-7                         17820099
178300                                FROM AR021-AR-POSTING-RECORD      17830099
178400             ADD +1 TO PA-POSTING-FILE-7                          17840099
178500         WHEN PV-FILE-NUMBER = 8                                  17850099
178600             WRITE POSTING-TRANS-RECORD-8                         17860099
178700                                FROM AR021-AR-POSTING-RECORD      17870099
178800             ADD +1 TO PA-POSTING-FILE-8                          17880099
178900     END-EVALUATE.                                                17890099
179000                                                                  17900099
179100******************************************************************17910099
179200*  PROCESS LAST POSTING IF THE LAST TRANSACTION HAD MERCHANDISE. *17920099
179300*  CLOSE ALL FILES.                                              *17930099
179400******************************************************************17940099
179500                                                                  17950099
179600 9000-EOJ-ROUTINE.                                                17960099
179700                                                                  17970099
179800     IF PV-SAVE-TRANS-HAS-MERCHANDISE                             17980099
179900         PERFORM 2400-UPDATE-POSTING-TRANS                        17990099
180000         PERFORM 7200-WRITE-POSTING-TRANS                         18000099
180100         IF PV-SAVE-EMPLOYEE                                      18010099
180200             PERFORM 2500-CREATE-EMPL-DISCOUNT                    18020099
180300         END-IF                                                   18030099
180400     END-IF.                                                      18040099
180500                                                                  18050099
180600     PERFORM 9050-DISPLAY-TOTALS.                                 18060099
180700                                                                  18070099
180800     CLOSE AR-TRANSACTION-FILE                                    18080099
180900           POSTING-TRANS-FILE-1                                   18090099
181000           POSTING-TRANS-FILE-2                                   18100099
181100           POSTING-TRANS-FILE-3                                   18110099
181200           POSTING-TRANS-FILE-4                                   18120099
181300           POSTING-TRANS-FILE-5                                   18130099
181400           POSTING-TRANS-FILE-6                                   18140099
181500           POSTING-TRANS-FILE-7                                   18150099
181600           POSTING-TRANS-FILE-8.                                  18160099
181700                                                                  18170099
181800 9050-DISPLAY-TOTALS.                                             18180099
181900                                                                  18190099
184200     DISPLAY 'INPUT RECORDS READ ' PA-INPUT-RCDS-READ.            18420099
184300     DISPLAY 'POSTING FILE 1     ' PA-POSTING-FILE-1.             18430099
184400     DISPLAY 'POSTING FILE 2     ' PA-POSTING-FILE-2.             18440099
184500     DISPLAY 'POSTING FILE 3     ' PA-POSTING-FILE-3.             18450099
184600     DISPLAY 'POSTING FILE 4     ' PA-POSTING-FILE-4.             18460099
184700     DISPLAY 'POSTING FILE 5     ' PA-POSTING-FILE-5.             18470099
184800     DISPLAY 'POSTING FILE 6     ' PA-POSTING-FILE-6.             18480099
184900     DISPLAY 'POSTING FILE 7     ' PA-POSTING-FILE-7.             18490099
185000     DISPLAY 'POSTING FILE 8     ' PA-POSTING-FILE-8.             18500099
185200                                                                  18520099
185300******************************************************************18530099
185400*  FORMAT A DB2 ERROR MESSAGE, AND ABEND THE PROGRAM.            *18540099
185500******************************************************************18550099
185600                                                                  18560099
185700 9100-DB2-ERROR.                                                  18570099
185800     DISPLAY '** ABEND **'.                                       18580099
185900     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - SQL ERROR'.             18590099
186000     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - ATTEMPTING TO '         18600099
186100               PV-LAST-DB2-ACTION.                                18610099
186200                                                                  18620099
186300*                                                                 18630099
186400*  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     18640099
186500*  THE CALLED MODULE DSNTIAR.                                     18650099
186600*                                                                 18660099
186700                                                                  18670099
186800     COPY DPPD004.                                                18680099
186900                                                                  18690099
187000     SET AC-DB2-ERROR TO TRUE.                                    18700099
187100     CALL 'ILBOABN0' USING ABEND-CODE.                            18710099
187200                                                                  18720099
187300******************************************************************18730099
187400*  FORMAT AN ERROR MESSAGE, AND ABEND THE PROGRAM.               *18740099
187500*  THIS WILL BE CALLED IF MORE THAN 20 TAX RATES ARE ON 1        *18750099
187600*  TRANSACTION.                                                  *18760099
187700******************************************************************18770099
187800                                                                  18780099
187900 9200-TRAN-TAX-ERROR.                                             18790099
188000     DISPLAY '** ABEND **'.                                       18800099
188100     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MAX OF '                18810099
188200             PC-MAX-TRAN-TAX-RATES ' TAX RATES FOR '.             18820099
188300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' ONE TRANSACTION '         18830099
188400               'HAS BEEN EXCEEDED'.                               18840099
188500                                                                  18850099
188600     DISPLAY PC-CURRENT-PROGRAM-NAME  ' IF VALID, INCREASE'       18860099
188700               ' PC-MAX-TRAN-TAX-RATES IN THE PROGRAM.'           18870099
188800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' LAST TRANSACTION='.       18880099
188900     DISPLAY PC-CURRENT-PROGRAM-NAME  ' ACCT #:'                  18890099
189000               AR001-ACCOUNT-NUMBER.                              18900099
189100     DISPLAY PC-CURRENT-PROGRAM-NAME  ' STORE/TERM/TRAN:'         18910099
189200               AR001-STORE-NUMBER '/'                             18920099
189300               AR001-TERMINAL-NUMBER '/'                          18930099
189400               AR001-TRANSACTION-NUMBER                           18940099
189500     SET AC-INVLD-DATA-ON-DATASET-ERROR TO TRUE.                  18950099
189600     CALL 'ILBOABN0' USING ABEND-CODE.                            18960099
189700                                                                  18970099
189800******************************************************************18980099
189900*  FORMAT AN ERROR MESSAGE, AND ABEND THE PROGRAM.               *18990099
190000*  THIS WILL BE CALLED WHEN MORE THAN 20000 ROWS ARE RETURNED    *19000099
190100*  FROM CLASS_CURSOR.  CHANGED TO 25000                          *19010099
190200******************************************************************19020099
190300                                                                  19030099
190400 9400-CLASS-MAX-ERROR.                                            19040099
190500     DISPLAY '** ABEND **'.                                       19050099
190600     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MAX OF '                19060099
190700             PC-MAX-DEPT-CLASSES    ' HAS BEEN EXCEEDED'.         19070099
190800                                                                  19080099
190900     DISPLAY PC-CURRENT-PROGRAM-NAME  ' IF VALID, INCREASE'       19090099
191000               ' PC-MAX-DEPT-CLASSES IN THE PROGRAM'.             19100099
191100     SET AC-INVLD-DATA-ON-DATASET-ERROR TO TRUE.                  19110099
191200     CALL 'ILBOABN0' USING ABEND-CODE.                            19120099
191300                                                                  19130099
