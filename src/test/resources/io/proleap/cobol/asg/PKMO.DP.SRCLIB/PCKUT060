000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'EXTRACT SE UNLOAD FILE DELETIONS'.                                
000300                                                                          
000400 PROGRAM-ID.             PCKUT060.                                        
000500 AUTHOR.                 DENNIS STEFFEN.                                  
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
000700 DATE-WRITTEN            NOVEMBER, 2005.                                  
000800 DATE-COMPILED.                                                           
000900                                                                          
001000 ENVIRONMENT DIVISION.                                                    
001100 CONFIGURATION SECTION.                                                   
001200                                                                          
001300 SOURCE-COMPUTER.        IBM-3090.                                        
001400 OBJECT-COMPUTER.        IBM-3090.                                        
001500                                                                          
001600 INPUT-OUTPUT SECTION.                                                    
001700                                                                          
001800 FILE-CONTROL.                                                            
001900                                                                          
002000     SELECT PURGE-SUMMARY-FILE                                            
002100         ASSIGN TO INP01.                                                 
002200                                                                          
002300     SELECT SE-DETAIL-FILE                                                
002400         ASSIGN TO INP02.                                                 
002500                                                                          
002600     SELECT SE-ARCHIVE-FILE                                               
002700         ASSIGN TO OUT01.                                                 
002800                                                                          
002900     SELECT REPORT-EXTRACT-FILE                                           
003000         ASSIGN TO OUT02.                                                 
003100                                                                          
003200 DATA DIVISION.                                                           
003300 FILE SECTION.                                                            
003400                                                                          
003500                                                                          
003600 FD  PURGE-SUMMARY-FILE                                                   
003700     RECORDING MODE IS F                                                  
003800     LABEL RECORDS ARE STANDARD                                           
003900     BLOCK CONTAINS 0 RECORDS.                                            
004000                                                                          
004100*    PCRD050                                                              
004200 01  PURGE-SUMMARY-RECORD             PIC  X(080).                        
004300                                                                          
004400 FD  SE-DETAIL-FILE                                                       
004500     RECORDING MODE IS F                                                  
004600     LABEL RECORDS ARE STANDARD                                           
004700     BLOCK CONTAINS 0 RECORDS.                                            
004800                                                                          
004900*    PCRD048                                                              
005000 01  ALL-TYPE-SE-RECORD               PIC  X(160).                        
005100                                                                          
005200 FD  SE-ARCHIVE-FILE                                                      
005300     RECORDING MODE IS F                                                  
005400     LABEL RECORDS ARE STANDARD                                           
005500     BLOCK CONTAINS 0 RECORDS.                                            
005600                                                                          
005700 01  SE-ARCHIVE-REC                   PIC X(160).                         
005800                                                                          
005900                                                                          
006000 FD  REPORT-EXTRACT-FILE                                                  
006100     RECORDING MODE IS F                                                  
006200     LABEL RECORDS ARE STANDARD                                           
006300     BLOCK CONTAINS 0 RECORDS.                                            
006400                                                                          
006500*    PCRD047                                                              
006600 01  REPORT-EXTRACT-RECORD            PIC X(080).                         
006700                                                                          
006800 WORKING-STORAGE SECTION.                                                 
006900                                                                          
007000 01  FILLER.                                                              
007100     05  FILLER                      PIC  X(36)    VALUE                  
007200         ' ***** WORKING STORAGE PGM=PCKUT060 '.                          
007300     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.           
007400                                                                          
007500 01  PV-WHEN-COMPILED.                                                    
007600     05  PV-COMPILE-DATE          PIC X(08).                              
007700     05  PV-COMPILE-TIME          PIC X(08).                              
007800                                                                          
007900 01  PS-SWITCHES.                                                         
008000     05  PS-EOF-DETAIL-SW             PIC X(01) VALUE 'N'.                
008100         88  PS-EOF-DETAIL-YES                  VALUE 'Y'.                
008200         88  PS-EOF-DETAIL-NO                   VALUE 'N'.                
008300     05  PS-EOF-PC050-SW              PIC X(01) VALUE 'N'.                
008400         88  PS-EOF-PC050-YES                   VALUE 'Y'.                
008500         88  PS-EOF-PC050-NO                    VALUE 'N'.                
008600                                                                          
008700     05  PS-END-CSR-SW                PIC X(01) VALUE 'N'.                
008800         88  PS-END-CSR-YES                     VALUE 'Y'.                
008900         88  PS-END-CSR-NO                      VALUE 'N'.                
009000     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.                
009100         88  PS-ERROR-YES                       VALUE 'Y'.                
009200         88  PS-ERROR-NO                        VALUE 'N'.                
009300                                                                          
009400 01  PV-CONTROL-KEYS.                                                     
009500     05  PV-SUMMRY-KEY.                                                   
009600         10  PV-SUMMRY-PO-NBR         PIC S9(09) COMP VALUE ZERO.         
009700         10  PV-SUMMRY-REC-SEQ-NBR    PIC S9(09) COMP VALUE ZERO.         
009800         10  PV-SUMMRY-INTR-UPC-ID    PIC S9(15) COMP VALUE ZERO.         
009900         10  PV-SUMMRY-LOC-NBR        PIC S9(04) COMP VALUE ZERO.         
010000     05  PV-DETAIL-KEY.                                                   
010100         10  PV-DETAIL-PO-NBR         PIC S9(09) COMP VALUE ZERO.         
010200         10  PV-DETAIL-REC-SEQ-NBR    PIC S9(09) COMP VALUE ZERO.         
010300         10  PV-DETAIL-INTR-UPC-ID    PIC S9(15) COMP VALUE ZERO.         
010400         10  PV-DETAIL-LOC-NBR        PIC S9(04) COMP VALUE ZERO.         
010500                                                                          
010600                                                                          
010700 01  PV-MISC-STUFF.                                                       
010800     05  PV-COMP3                     PIC S9(15) COMP-3                   
010900                                                 VALUE ZERO.              
011000     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.            
011100     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.             
011200     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.              
011300     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO               
011400                                                   COMP SYNC.             
011500     05  PV-SUB                       PIC S9(05) COMP-3                   
011600                                              VALUE ZERO.                 
011700     05  PV-READ-COUNTER              PIC S9(09) COMP-3                   
011800                                              VALUE ZERO.                 
011900     05  GT-ALL-COUNT                 PIC S9(13) COMP-3                   
012000                                              VALUE ZERO.                 
012100     05  GT-PURGE-COUNT               PIC S9(13) COMP-3                   
012200                                              VALUE ZERO.                 
012300     05  GT-KEEP-COUNT                PIC S9(13) COMP-3                   
012400                                              VALUE ZERO.                 
012500     05  PV-READ-PC050-COUNTER        PIC S9(09) COMP-3                   
012600                                              VALUE ZERO.                 
012700     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3                   
012800                                              VALUE ZERO.                 
012900     05  PV-WRITE-2-COUNTER           PIC S9(09) COMP-3                   
013000                                              VALUE ZERO.                 
013100     05  PV-WRITE-OUT04-COUNTER       PIC S9(09) COMP-3                   
013200                                              VALUE ZERO.                 
013300     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZZ,ZZ9.                
013400     05  PV-DISP-LOC                  PIC ZZZ9.                           
013500     05  PV-DISP-NBR-2                PIC ZZZ,ZZZ,ZZZ,ZZ9.                
013600     05  PV-DISP-NBR-3                PIC ZZZ,ZZZ,ZZZ,ZZ9.                
013700     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.             
013800     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.             
013900     05  PV-TMST                      PIC X(26).                          
014000                                                                          
014100 01  PC-CONSTANTS.                                                        
014200     05  PC-ILBOABN0                 PIC  X(08)    VALUE                  
014300                                                   'ILBOABN0'.            
014400 01  ABEND-CODE                       PIC S9(04)     VALUE +0             
014500                                                     COMP SYNC.           
014600     88  ABEND-4001-WRITE-ERROR                      VALUE +4001.         
014700     88  ABEND-4002-READ-ERROR                       VALUE +4002.         
014800     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003.         
014900     88  ABEND-4004-TABLE-ERROR                      VALUE +4004.         
015000     88  ABEND-4005-OPEN-ERROR                       VALUE +4005.         
015100     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006.         
015200     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007.         
015300     88  ABEND-4008-DATS-ERROR                       VALUE +4008.         
015400     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009.         
015500     88  ABEND-4013-DB2-ERROR                        VALUE +4013.         
015600                                                                          
015700*    PURGE HEADERS FROM PCKUT057 - INP01                                  
015800     COPY PCRD050.                                                        
015900                                                                          
016000*    INVENTORY DETAIL FILE - INP02                                        
016100     COPY PCRD048.                                                        
016200                                                                          
016300*    DETAIL PURGE RECORDS TO MATCH HEADERS - OUT01                        
016400*    COPY PCRD048.                                                        
016500                                                                          
016600*    REPORT EXTRACT - OUT02                                               
016700     COPY PCRD049.                                                        
016800/                                                                         
016900     EXEC SQL                                                             
017000         INCLUDE SQLCA                                                    
017100     END-EXEC.                                                            
017200                                                                          
017300     COPY SQLCA2.                                                         
017400                                                                          
017500     COPY DPWS004.                                                        
017600/                                                                         
017700*    USED TO WRITE REPORT EXTRACT PCRD049                                 
017800 01  PT-LOC-TABLE.                                                        
017900     05  PT-LOC-ELEMENT OCCURS 9999 TIMES INDEXED BY PT-IDX.              
018000         10  PT-STORE                 PIC S9(04) COMP.                    
018100         10  PT-INV-DTE               PIC  X(10).                         
018200         10  PT-PLND-INV-DTE          PIC  X(10).                         
018300                                                                          
018400*     FROM PCRD048                                                        
018500         10  PT-FIN-BK-DTE            PIC  X(10).                         
018600         10  PT-FIN-DTE-ADJ-QTY       PIC S9(04) COMP.                    
018700         10  PT-FIN-BK-DTE-ADJ        PIC  X(10).                         
018800         10  PT-BEGIN-DTE             PIC  X(10).                         
018900         10  PT-END-DTE               PIC  X(10).                         
019000                                                                          
019100                                                                          
019200                                                                          
019300*    BUILT FROM INP02 MATCHING DETAIL RECS                                
019400 01  PT-TOT-TABLE.                                                        
019500     05  PT-TOT-ELEMENT OCCURS 9999 TIMES INDEXED BY PT-TOT-IDX.          
019600         10  PT-LOC                   PIC S9(04) COMP.                    
019700         10  PT-ALL-TOT               PIC S9(11) COMP.                    
019800         10  PT-PURGE-TOT             PIC S9(11) COMP.                    
019900         10  PT-KEEP-TOT              PIC S9(11) COMP.                    
020000         10  PT-MIN-DTE               PIC X(10).                          
020100         10  PT-MAX-DTE               PIC X(10).                          
020200         10  PT-MIN-DTE-ALL           PIC X(10).                          
020300         10  PT-MAX-DTE-ALL           PIC X(10).                          
020400/                                                                         
020500 PROCEDURE DIVISION.                                                      
020600                                                                          
020700     PERFORM 1000-INITIALIZATION.                                         
020800                                                                          
020900     PERFORM 2000-PROCESS UNTIL PS-EOF-DETAIL-YES                         
021000                             OR PS-EOF-PC050-YES                          
021100                            OR PS-ERROR-YES                               
021200                                                                          
021300     PERFORM 9000-QUIT.                                                   
021400                                                                          
021500     GOBACK.                                                              
021600                                                                          
021700 1000-INITIALIZATION.                                                     
021800     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.          
021900     DISPLAY 'START PCKUT060'                                             
022000     MOVE WHEN-COMPILED               TO PV-WHEN-COMPILED                 
022100                                         PGM-COMPILED                     
022200     DISPLAY SPACES                                                       
022300     DISPLAY 'COMPILE DATE: ' PV-COMPILE-DATE                             
022400             ' ' PV-COMPILE-TIME                                          
022500                                                                          
022600     INITIALIZE PT-LOC-TABLE                                              
022700                PT-TOT-TABLE.                                             
022800                                                                          
022900     PERFORM VARYING PT-TOT-IDX FROM 1 BY 1                               
023000         UNTIL PT-TOT-IDX > 9999                                          
023100             MOVE '0001-01-01'    TO PT-MAX-DTE (PT-TOT-IDX)              
023200                                     PT-MAX-DTE-ALL (PT-TOT-IDX)          
023300             MOVE '9999-09-09'    TO PT-MIN-DTE (PT-TOT-IDX)              
023400                                     PT-MIN-DTE-ALL (PT-TOT-IDX)          
023500     END-PERFORM                                                          
023600                                                                          
023700     EXEC SQL                                                             
023800         SET :PV-TMST = CURRENT TIMESTAMP                                 
023900     END-EXEC                                                             
024000                                                                          
024100     OPEN INPUT SE-DETAIL-FILE                                            
024200                PURGE-SUMMARY-FILE                                        
024300     OPEN OUTPUT                                                          
024400          SE-ARCHIVE-FILE                                                 
024500          REPORT-EXTRACT-FILE                                             
024600                                                                          
024700     IF PS-ERROR-NO                                                       
024800         PERFORM 8000-READ-PURGE-SUMMARY                                  
024900         IF PS-EOF-PC050-YES                                              
025000             DISPLAY SPACES                                               
025100             DISPLAY ALL '*'                                              
025200             DISPLAY '  INV STORES FILE IS EMPTY '                        
025300             DISPLAY ALL '*'                                              
025400             DISPLAY SPACES                                               
025500             SET PS-ERROR-YES         TO TRUE                             
025600         END-IF                                                           
025700     END-IF                                                               
025800                                                                          
025900     IF PS-ERROR-NO                                                       
026000         PERFORM 3000-TABLIZE-PC050                                       
026100         MOVE PV-SUMMRY-KEY           TO PV-DETAIL-KEY                    
026200     END-IF.                                                              
026300                                                                          
026400     IF PS-ERROR-NO                                                       
026500         PERFORM 8050-READ-SE-DTL                                         
026600         IF PS-EOF-DETAIL-YES                                             
026700             DISPLAY SPACES                                               
026800             DISPLAY '!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'                    
026900             DISPLAY '*******************************'                    
027000             DISPLAY PV-ABEND-PARAGRAPH                                   
027100             DISPLAY '  DETAIL FILE IS EMPTY '                            
027200             DISPLAY '  BIG BIG TROUBLE          '                        
027300             DISPLAY '*******************************'                    
027400             DISPLAY '!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'                    
027500             DISPLAY SPACES                                               
027600             SET ABEND-4002-READ-ERROR  TO TRUE                           
027700             CALL 'ILBOABN0' USING ABEND-CODE                             
027800     END-IF.                                                              
027900                                                                          
028000/                                                                         
028100 2000-PROCESS.                                                            
028200                                                                          
028300     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.          
028400                                                                          
028500     EVALUATE TRUE                                                        
028600         WHEN PV-SUMMRY-KEY = PV-DETAIL-KEY                               
028700                                                                          
028800*            OUT01                                                        
028900             PERFORM 2100-LOAD-TABLE                                      
029000             PERFORM 8100-WRITE-ARCHIVE                                   
029100             PERFORM 8050-READ-SE-DTL                                     
029200         WHEN PV-SUMMRY-KEY > PV-DETAIL-KEY                               
029300             ADD 1                    TO PV-WRITE-2-COUNTER               
029400                               PT-KEEP-TOT(PC048-LOC-NBR)                 
029500                                                                          
029600             PERFORM 8050-READ-SE-DTL                                     
029700                                                                          
029800         WHEN OTHER                                                       
029900                                                                          
030000             PERFORM 8000-READ-PURGE-SUMMARY                              
030100                                                                          
030200*   WHEN THE SUMMARY IS AT END-OF-FILE, WHATEVER DETAIL                   
030300*   IS SITTING IN STORAGE HAS TO BE CONSIDERED A MISMATCH.                
030400*   THEREFORE ADD TO THE KEEP COUNTER FOR THE FINAL DISPLAYS              
030500                                                                          
030600             IF PS-EOF-PC050-YES                                          
030700                 ADD 1                TO PV-WRITE-2-COUNTER               
030800                               PT-KEEP-TOT(PC048-LOC-NBR)                 
030900             END-IF                                                       
031000     END-EVALUATE.                                                        
031100                                                                          
031200 2100-LOAD-TABLE.                                                         
031300                                                                          
031400                                                                          
031500     SET PT-IDX                       TO PC048-LOC-NBR                    
031600     MOVE PC048-INV-DTE               TO PT-INV-DTE (PT-IDX)              
031700                                                                          
031800     MOVE PC048-PLND-INV-DTE          TO PT-PLND-INV-DTE(PT-IDX)          
031900     MOVE PC048-FIN-BK-DTE            TO PT-FIN-BK-DTE (PT-IDX)           
032000     MOVE PC048-FIN-DTE-ADJ-QTY       TO                                  
032100                                       PT-FIN-DTE-ADJ-QTY (PT-IDX)        
032200                                                                          
032300     MOVE PC048-FIN-BK-DTE-ADJ        TO PT-FIN-BK-DTE-ADJ(PT-IDX)        
032400                                                                          
032500     MOVE PC048-BEGIN-DTE             TO PT-BEGIN-DTE (PT-IDX)            
032600     MOVE PC048-END-DTE               TO PT-END-DTE (PT-IDX).             
032700                                                                          
032800/                                                                         
032900 3000-TABLIZE-PC050.                                                      
033000     MOVE PC050-LOC-NBR               TO PT-STORE                         
033100                                   (PC050-LOC-NBR)                        
033200     MOVE PC050-LOC-INV-DTE           TO PT-INV-DTE                       
033300                                   (PC050-LOC-NBR).                       
033400                                                                          
033500 8000-READ-PURGE-SUMMARY.                                                 
033600                                                                          
033700     MOVE '8000-READ-PURGE-SUMMARY' TO PV-ABEND-PARAGRAPH.                
033800                                                                          
033900     READ PURGE-SUMMARY-FILE                                              
034000         INTO                                                             
034100             PC050-SE-SUMMARY-REC                                         
034200         AT END                                                           
034300             SET PS-EOF-PC050-YES     TO TRUE                             
034400         NOT AT END                                                       
034500             ADD 1                    TO PV-READ-PC050-COUNTER            
034600             MOVE PC050-PO-NBR        TO PV-SUMMRY-PO-NBR                 
034700             MOVE PC050-RCVR-SEQ-NBR  TO PV-SUMMRY-REC-SEQ-NBR            
034800             MOVE PC050-INTR-UPC-ID   TO PV-COMP3                         
034900             MOVE PV-COMP3            TO PV-SUMMRY-INTR-UPC-ID            
035000             MOVE PC050-LOC-NBR       TO PV-SUMMRY-LOC-NBR                
035100                                                                          
035200             PERFORM 3000-TABLIZE-PC050                                   
035300                                                                          
035400     END-READ.                                                            
035500                                                                          
035600 8050-READ-SE-DTL.                                                        
035700                                                                          
035800     MOVE '8050-READ-SE-DTL   '   TO PV-ABEND-PARAGRAPH.                  
035900                                                                          
036000     READ SE-DETAIL-FILE                                                  
036100         INTO                                                             
036200             PC048-SE-ARCHIVE-REC                                         
036300         AT END                                                           
036400             DISPLAY 'DETAIL-END-OF-FILE'                                 
036500             SET PS-EOF-DETAIL-YES    TO TRUE                             
036600         NOT AT END                                                       
036700             MOVE PC048-PO-NBR        TO PV-DETAIL-PO-NBR                 
036800             MOVE PC048-RCVR-SEQ-NBR  TO PV-DETAIL-REC-SEQ-NBR            
036900             MOVE PC048-INTR-UPC-ID   TO PV-COMP3                         
037000             MOVE PV-COMP3            TO PV-DETAIL-INTR-UPC-ID            
037100             MOVE PC048-LOC-NBR       TO PV-DETAIL-LOC-NBR                
037200                                                                          
037300             MOVE PC048-LOC-NBR       TO PT-LOC                           
037400                                         (PC048-LOC-NBR)                  
037500             ADD 1                    TO PV-READ-COUNTER                  
037600                                         PT-ALL-TOT(PC048-LOC-NBR)        
037700             IF PC048-IN-TRNST-TRN-TMST(1:10) <                           
037800                               PT-MIN-DTE-ALL (PC048-LOC-NBR)             
037900                 MOVE PC048-IN-TRNST-TRN-TMST(1:10)                       
038000                             TO PT-MIN-DTE-ALL (PC048-LOC-NBR)            
038100             END-IF                                                       
038200                                                                          
038300             IF PC048-IN-TRNST-TRN-TMST(1:10) >                           
038400                               PT-MAX-DTE-ALL (PC048-LOC-NBR)             
038500                 MOVE PC048-IN-TRNST-TRN-TMST(1:10)                       
038600                             TO PT-MAX-DTE-ALL (PC048-LOC-NBR)            
038700             END-IF                                                       
038800                                                                          
038900     END-READ.                                                            
039000                                                                          
039100 8060-READ-SE-DTL-TO-END.                                                 
039200                                                                          
039300     MOVE '8060-READ-SE-DTL-TO-END'   TO PV-ABEND-PARAGRAPH.              
039400                                                                          
039500     READ SE-DETAIL-FILE                                                  
039600         INTO                                                             
039700             PC048-SE-ARCHIVE-REC                                         
039800         AT END                                                           
039900             SET PS-EOF-DETAIL-YES    TO TRUE                             
040000         NOT AT END                                                       
040100                                                                          
040200             MOVE PC048-LOC-NBR       TO PT-LOC                           
040300                                         (PC048-LOC-NBR)                  
040400             ADD 1                    TO PV-READ-COUNTER                  
040500                                         PT-ALL-TOT(PC048-LOC-NBR)        
040600                                         PV-WRITE-2-COUNTER               
040700                                         PT-KEEP-TOT                      
040800                                         (PC048-LOC-NBR)                  
040900     END-READ.                                                            
041000                                                                          
041100 8100-WRITE-ARCHIVE.                                                      
041200*    OUT01                                                                
041300     MOVE '8100-WRITE-ARCHIVE  '  TO PV-ABEND-PARAGRAPH.                  
041400     WRITE                                                                
041500         SE-ARCHIVE-REC                                                   
041600         FROM PC048-SE-ARCHIVE-REC                                        
041700     END-WRITE.                                                           
041800     ADD 1                            TO PV-WRITE-1-COUNTER               
041900                                 PT-PURGE-TOT(PC048-LOC-NBR).             
042000     IF PC048-IN-TRNST-TRN-TMST(1:10) <                                   
042100                               PT-MIN-DTE (PC048-LOC-NBR)                 
042200         MOVE PC048-IN-TRNST-TRN-TMST(1:10)                               
042300                             TO PT-MIN-DTE (PC048-LOC-NBR)                
042400     END-IF                                                               
042500                                                                          
042600     IF PC048-IN-TRNST-TRN-TMST(1:10) >                                   
042700                               PT-MAX-DTE (PC048-LOC-NBR)                 
042800         MOVE PC048-IN-TRNST-TRN-TMST(1:10)                               
042900                             TO PT-MAX-DTE (PC048-LOC-NBR)                
043000     END-IF.                                                              
043100                                                                          
043200                                                                          
043300 8200-WRITE-REPORT-EXTRACT.                                               
043400                                                                          
043500     MOVE '8200-WRITE-REPORT-EXTRACT' TO PV-ABEND-PARAGRAPH.              
043600     WRITE                                                                
043700         REPORT-EXTRACT-RECORD                                            
043800         FROM PC049-SE-PURGE-RPT-REC                                      
043900     END-WRITE.                                                           
044000     ADD 1                            TO PV-WRITE-OUT04-COUNTER.          
044100/                                                                         
044200 9000-QUIT.                                                               
044300                                                                          
044400     PERFORM 8060-READ-SE-DTL-TO-END UNTIL                                
044500                 PS-EOF-DETAIL-YES                                        
044600                                                                          
044700     DISPLAY SPACES.                                                      
044800                                                                          
044900     MOVE PV-READ-COUNTER             TO PV-DISP-NBR                      
045000     DISPLAY 'STORE EXPECTED RECORDS READ          = '                    
045100                                          PV-DISP-NBR                     
045200                                                                          
045300     MOVE PV-WRITE-1-COUNTER          TO PV-DISP-NBR                      
045400     DISPLAY 'STORE EXPECTED RECORDS TO BE DELETED = '                    
045500                                                 PV-DISP-NBR              
045600                                                                          
045700     MOVE PV-WRITE-2-COUNTER          TO PV-DISP-NBR                      
045800     DISPLAY 'STORE EXPECTED RECORDS TO BE KEPT    = '                    
045900                                                 PV-DISP-NBR              
046000                                                                          
046100     PERFORM 9001-PRINT-TOTALS-TABLE.                                     
046200                                                                          
046300     MOVE PV-WRITE-OUT04-COUNTER      TO PV-DISP-NBR                      
046400                                                                          
046500     DISPLAY 'REPORT RECORDS WRITTEN               = '                    
046600                                                 PV-DISP-NBR.             
046700                                                                          
046800 9001-PRINT-TOTALS-TABLE.                                                 
046900                                                                          
047000     DISPLAY SPACES                                                       
047100     DISPLAY SPACES                                                       
047200                                                                          
047300     DISPLAY 'STORE        PURGE             KEEP           '             
047400     ' TOTAL      PURGE DATE RANGE         '                              
047500     '  FILE DATE RANGE          INV DTE'.                                
047600                                                                          
047700     PERFORM VARYING PV-SUB FROM 1 BY 1                                   
047800             UNTIL PV-SUB > 9999                                          
047900*        SET PT-IDX                   TO PT-TOT-IDX                       
048000         IF PT-STORE(PV-SUB) > ZERO                                       
048100             AND PT-INV-DTE (PV-SUB) > SPACES                             
048200             INITIALIZE PC049-SE-PURGE-RPT-REC                            
048300             INSPECT PT-MIN-DTE (PV-SUB)                                  
048400                     REPLACING ALL '9999-09-09' BY SPACES                 
048500             INSPECT PT-MAX-DTE (PV-SUB)                                  
048600                     REPLACING ALL '0001-01-01' BY SPACES                 
048700             INSPECT PT-MIN-DTE-ALL (PV-SUB)                              
048800                     REPLACING ALL '9999-09-09' BY SPACES                 
048900             INSPECT PT-MAX-DTE-ALL (PV-SUB)                              
049000                     REPLACING ALL '0001-01-01' BY SPACES                 
049100                                                                          
049200             MOVE PT-STORE(PV-SUB) TO PV-DISP-LOC                         
049300                                        PC049-LOC-NBR                     
049400             MOVE PT-ALL-TOT (PV-SUB) TO PV-DISP-NBR                      
049500                                             PC049-ALL-TOT                
049600             MOVE PT-PURGE-TOT(PV-SUB) TO PV-DISP-NBR-2                   
049700                                              PC049-PURGE-TOT             
049800             MOVE PT-KEEP-TOT(PV-SUB) TO PV-DISP-NBR-3                    
049900                                             PC049-KEEP-TOT               
050000             MOVE PT-MIN-DTE (PV-SUB) TO PC049-MIN-DTE                    
050100             MOVE PT-MAX-DTE (PV-SUB) TO PC049-MAX-DTE                    
050200             MOVE PT-MIN-DTE-ALL (PV-SUB)                                 
050300                                      TO PC049-MIN-DTE-ALL                
050400             MOVE PT-MAX-DTE-ALL (PV-SUB)                                 
050500                                      TO PC049-MAX-DTE-ALL                
050600             MOVE PT-INV-DTE (PV-SUB)                                     
050700                                      TO PC049-INV-DTE                    
050800                                                                          
050900             DISPLAY PV-DISP-LOC  ' '                                     
051000                     PV-DISP-NBR-2 '  '                                   
051100                     PV-DISP-NBR-3 '  '                                   
051200                     PV-DISP-NBR '  '                                     
051300                     PT-MIN-DTE (PV-SUB) '   '                            
051400                     PT-MAX-DTE (PV-SUB) '    '                           
051500                     PT-MIN-DTE-ALL (PV-SUB) '   '                        
051600                     PT-MAX-DTE-ALL (PV-SUB) '    '                       
051700                     PT-INV-DTE (PV-SUB)                                  
051800                                                                          
051900             ADD PT-ALL-TOT (PV-SUB) TO GT-ALL-COUNT                      
052000             ADD PT-PURGE-TOT(PV-SUB) TO GT-PURGE-COUNT                   
052100             ADD PT-KEEP-TOT(PV-SUB) TO GT-KEEP-COUNT                     
052200             PERFORM 8200-WRITE-REPORT-EXTRACT                            
052300         END-IF                                                           
052400     END-PERFORM                                                          
052500                                                                          
052600     INITIALIZE PC049-SE-PURGE-RPT-REC                                    
052700     MOVE 9999                        TO PC049-LOC-NBR                    
052800     MOVE GT-ALL-COUNT                TO PV-DISP-NBR                      
052900                                         PC049-ALL-TOT                    
053000     MOVE GT-PURGE-COUNT              TO PV-DISP-NBR-2                    
053100                                         PC049-PURGE-TOT                  
053200     MOVE GT-KEEP-COUNT               TO PV-DISP-NBR-3                    
053300                                         PC049-KEEP-TOT                   
053400     PERFORM 8200-WRITE-REPORT-EXTRACT                                    
053500                                                                          
053600     DISPLAY '-----        -----        ------        ------ '            
053700     DISPLAY SPACES                                                       
053800             DISPLAY '       '                                            
053900                     PV-DISP-NBR-2 '   '                                  
054000                     PV-DISP-NBR-3 '   '                                  
054100                     PV-DISP-NBR                                          
054200                                                                          
054300     CLOSE SE-DETAIL-FILE                                                 
054400           PURGE-SUMMARY-FILE                                             
054500           SE-ARCHIVE-FILE                                                
054600           REPORT-EXTRACT-FILE.                                           
054700/                                                                         
054800 9100-SQL-ABEND.                                                          
054900******************************************************************        
055000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL            
055100*  ERROR OR WARNING CODE OCCURS.                                          
055200******************************************************************        
055300     DISPLAY '9100-SQL-ABEND'.                                            
055400     DISPLAY '** ABEND     **'.                                           
055500     DISPLAY '** PROGRAM   ** = ' 'PCKUT060'.                             
055600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.                     
055700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
055800     DISPLAY '**              ** = '                                      
055900     MOVE SQLCODE TO PV-SQL-CODE.                                         
056000     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                            
056100     MOVE +4013 TO PV-ABEND-CODE.                                         
056200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
056300                                                                          
056400******************************************************************        
056500*  THIS MODULE PERFORMS THE SQL WARNING.                         *        
056600******************************************************************        
056700                                                                          
056800 9800-SQL-WARNING.                                                        
056900                                                                          
057000     MOVE SQLCODE               TO SQLCODE2.                              
057100     MOVE SQLERRD(3)            TO SQLERRD3.                              
057200     DISPLAY '** ABEND **       ** = SQLWARNING'.                         
057300     DISPLAY '** PROGRAM        ** = PCKUT051'.                           
057400     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.                
057500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
057600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
057700                                                                          
057800     COPY DPPD004.                                                        
057900     SET ABEND-4013-DB2-ERROR   TO TRUE                                   
058000     CALL 'ILBOABN0' USING ABEND-CODE.                                    
058100/                                                                         
058200******************************************************************        
058300* THIS MODULE PERFORMS THE SQL ERROR.                            *        
058400******************************************************************        
058500                                                                          
058600 9900-SQL-ERROR.                                                          
058700                                                                          
058800     MOVE SQLCODE               TO SQLCODE2.                              
058900     MOVE SQLERRD(3)            TO SQLERRD3.                              
059000     DISPLAY '** ABEND **       ** = SQLERROR'.                           
059100     DISPLAY '** PROGRAM        ** = PCKUT051'.                           
059200     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.                
059300     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION                 
059400     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1               
059500     DISPLAY SPACES                                                       
059600                                                                          
059700     COPY DPPD004.                                                        
059800     SET ABEND-4013-DB2-ERROR   TO TRUE                                   
059900     CALL 'ILBOABN0' USING ABEND-CODE.                                    
