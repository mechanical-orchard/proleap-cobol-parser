000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      CEKSP003.                                       00020000
000300 AUTHOR.          CHRISTINE TWIEHAUS.                             00030000
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
000500 DATE-WRITTEN.    JULY  2010.                                     00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800* INSERT PUT TO CENTRAL STOCK TABLES:                             00080000
000900*        TCEPLIT, TCEPLRQ, TCEPLDS, TCEPLST                       00090000
001000******************************************************************00100000
001100* SPECIAL COMPILE/STAGING NOTE!                                   00110000
001200* -----------------------------                                   00120000
001300******************************************************************00130000
001400* 07/12/10 - CHRISTINE TWIEHAUS                       WR#38786   *00140000
001500*            INITIAL IMPLEMENTATION                              *00150000
001600******************************************************************00160000
001610******************************************************************00161039
001620* 04/06/12 - RON KRIER                                           *00162039
001630*            ALL REGULAR DISPLAYS IN THE PROGRAM HAVE BEEN       *00163039
001631*            COMMENTED OUT PER A SUGGESTION FROM RICK TULLOCH    *00163139
001632*            BECAUSE OF AN ERROR THAT WAS BEING SEEN WHEN THE    *00163239
001633*            FIRST DISPLAY WAS WRITTEN - WAS GETTING AN ERROR    *00163339
001634*            THAT THE DB2PWLMP COULD NOT OPEN A FILE TO LOG      *00163439
001635*            THE DISPLAY.                                        *00163539
001640******************************************************************00164039
001700 ENVIRONMENT DIVISION.                                            00170000
001800 CONFIGURATION SECTION.                                           00180000
001900 SOURCE-COMPUTER. IBM-3090.                                       00190000
002000 OBJECT-COMPUTER. IBM-3090.                                       00200000
002100                                                                  00210000
002200 INPUT-OUTPUT SECTION.                                            00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 FILE SECTION.                                                    00270000
002800                                                                  00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000******************************************************************00300000
003100* PROGRAM CONSTANTS                                               00310000
003200******************************************************************00320000
003300 01  PC-PROGRAM-CONSTANTS.                                        00330000
003400     05  PC-PROGRAM-NAME             PIC  X(08)  VALUE 'CEKSP003'.00340000
003500     05  PC-DELIMITER-COMMA          PIC  X(01)  VALUE ','.       00350000
003600                                                                  00360000
003700******************************************************************00370000
003800* PROGRAM VARIBLES                                                00380000
003900******************************************************************00390000
004000 01  PV-PROGRAM-VARIBLES.                                         00400000
004100     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00410000
004200     05  PV-INFO-LINE                PIC  X(40)  VALUE SPACES.    00420021
004300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00430000
004400     05  PV-OPERATION-MSG-1          PIC  X(40)  VALUE SPACES.    00440000
004500     05  PV-WS-CTR                   PIC  9(05)  VALUE ZEROS.     00450006
004600     05  PV-HOLD-SQLCODE             PIC  9(09)  VALUE ZEROES.    00460000
004700     05  PV-SQLCODE-OUT              PIC  9(09)  VALUE ZEROES.    00470008
004800     05  PV-SKU                      PIC  S9(9)  COMP.            00480008
004900     05  PV-SRC-TYP-CDE              PIC  X(02).                  00490008
005000     05  PV-DB2-TIMESTAMP            PIC  X(26)  VALUE SPACES.    00500008
005100                                                                  00510000
005200     05  PV-CNSTK-REQ-PL-NBR         PIC  S9(09) COMP.            00520008
005300     05  PV-PL-LNE-NBR               PIC  S9(04) COMP.            00530008
005400     05  PV-ITM-NBR                  PIC  S9(15)V COMP-3.         00540008
005500     05  PV-CNSTK-LOC-ID             PIC  S9(04) COMP.            00550008
005600     05  PV-NULL-IND-3               PIC  S9(04) VALUE +0         00560008
005700                                                 COMP.            00570008
005800     05  PV-SRC-REF-NBR              PIC   X(15) VALUE SPACES.    00580008
005900     05  PV-CRE-BY-USR-ID            PIC   X(08).                 00590008
006000     05  PV-REQ-PL-QTY               PIC  S9(09) COMP.            00600008
006100     05  PV-REQ-PL-QTY-SUM           PIC  S9(09) COMP.            00610008
006200     05  PV-UNT-RTL-AMT              PIC  S9(05)V9(2) COMP-3.     00620008
006300     05  PV-STR-NBR                  PIC  S9(04) COMP.            00630008
006400     05  PV-DWNLD-RDM-STAT-CDE       PIC   X(01).                 00640008
006500     05  PV-ACTL-DISTRB-QTY          PIC  S9(09) COMP.            00650008
006600     05  PV-EXPRT-PRC-BTCH-ID        PIC   X(03).                 00660008
006700     05  PV-COUNTER                  PIC  S9(09) COMP.            00670008
006800                                                                  00680000
006900     05  PV-VARCHAR.                                              00690000
007000         49 PV-VARCHAR-LEN           PIC S9(04)  COMP.            00700008
007100         49 PV-VARCHAR-TEXT          PIC  X(22000).               00710008
007200                                                                  00720008
007300     05  PV-DISP-LOC                 PIC  9(04).                  00730008
007400     05  PV-DISP-PULL                PIC  9(09).                  00740008
007500     05  PV-DISP-SKU                 PIC  9(09).                  00750008
007510     05  PV-DISP-LINE                PIC  9(04).                  00751024
007520     05  PV-DISP-OUT-SKU             PIC  9(09).                  00752032
007530     05  PV-DISP-OUT-LOC             PIC  9(09).                  00753032
007540     05  PV-DISP-MESSAGE             PIC  9(09).                  00754032
007600******************************************************************00760000
007700* PROGRAM SWITCHES                                                00770000
007800******************************************************************00780000
007900 01  PS-PROGRAM-SWITCHES.                                         00790000
008000     05  PS-DISPLAY-SW               PIC  X(01)  VALUE 'N'.       00800020
008100         88  PS-DISPLAY-YES                      VALUE 'Y'.       00810000
008200         88  PS-DISPLAY-NO                       VALUE 'N'.       00820000
008300     05  PS-UNSTRING-SW              PIC  X(01)  VALUE 'Y'.       00830000
008400         88  PS-UNSTRING                         VALUE 'Y'.       00840000
008500         88  PS-DONE-UNSTRING                    VALUE 'N'.       00850000
008600     05  PS-TCEPLRQ-ROW-EXISTS-SW    PIC  X(01)  VALUE 'N'.       00860000
008700         88  PS-TCEPLRQ-ROW-EXISTS               VALUE 'Y'.       00870000
008800         88  PS-TCEPLRQ-ROW-EXISTS-NO            VALUE 'N'.       00880000
008810     05  PS-TCEPLIT-PROCESSED-SW     PIC  X(01)  VALUE 'N'.       00881028
008820         88  PS-TCEPLIT-PROCESSED                VALUE 'Y'.       00882028
008830         88  PS-TCEPLIT-PROCESSED-NO             VALUE 'N'.       00883028
008900     05  PS-NEW-ROW-CREATED-SW       PIC  X(01)  VALUE 'N'.       00890000
009000         88  PS-NEW-ROW-CREATED                  VALUE 'Y'.       00900000
009100         88  PS-NEW-ROW-CREATED-NO               VALUE 'N'.       00910000
009200     05  PS-ABEND-SW                 PIC  X(01)  VALUE 'N'.       00920000
009300         88  PS-ABEND                            VALUE 'Y'.       00930000
009400         88  PS-NO-ABEND                         VALUE 'N'.       00940000
009500     05  PS-SQL-ERROR-SW             PIC  X(01)  VALUE 'N'.       00950000
009600         88  PS-SQL-ERROR-YES                    VALUE 'Y'.       00960000
009700         88  PS-SQL-ERROR-NO                     VALUE 'N'.       00970000
009800                                                                  00980008
009900     05  WS-SHIFT-INFORMATION.                                    00990000
010000         10  WS-STR-NBR              PIC  X(04).                  01000008
010100         10  WS-STR-NBR-N            PIC  X(04).                  01010008
010200         10  WS-ACTL-PL-QTY          PIC  X(05).                  01020008
010300         10  WS-ACTL-PL-QTY-N        PIC  X(05).                  01030008
010400         10  WS-SHIFT-CNTR-ST        PIC  9(02) VALUE ZEROES.     01040008
010500         10  WS-SHIFT-CNTR-END       PIC  9(02) VALUE ZEROES.     01050008
010600                                                                  01060000
010700 01  PA-INPUT-TABLE.                                              01070000
010800     05  PA-INPUT         OCCURS 2000 TIMES INDEXED BY IN-SUB.    01080000
010900         10  PA-STR-NBR                PIC   X(04).               01090000
011000         10  PA-ACTL-PL-QTY            PIC   9(05).               01100000
011100         10  PA-ACTL-PL-QTY-X    REDEFINES                        01110000
011200             PA-ACTL-PL-QTY            PIC   X(05).               01120000
011300                                                                  01130000
011400 01  ABEND-CODE                      PIC S9(04)  COMP VALUE +0.   01140000
011500     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     01150000
011600                                                                  01160000
011700******************************************************************01170000
011800* MSG   ERROR MESSAGE TO BE DISPLAYED IN THE STORED PROCEDURE     01180000
011900*       ADDRESS SPACE                                             01190000
012000******************************************************************01200000
012100 01  MSG-ERROR-DISPLAY.                                           01210000
012200     05  FILLER                      PIC  X(05)  VALUE 'ERROR'.   01220000
012300     05  FILLER                      PIC  X(01)  VALUE SPACES.    01230000
012400     05  FILLER                      PIC  X(01)  VALUE '-'.       01240000
012500     05  FILLER                      PIC  X(01)  VALUE SPACES.    01250000
012600     05  MSG-STORED-PROCEDURE-NAME   PIC  X(08)  VALUE SPACES.    01260000
012700     05  FILLER                      PIC  X(01)  VALUE SPACES.    01270000
012800     05  MSG-SKU                     PIC  X(08)  VALUE SPACES.    01280000
012900     05  FILLER                      PIC  X(01)  VALUE ':'.       01290000
013000     05  FILLER                      PIC  X(02)  VALUE SPACES.    01300000
013100                                                                  01310000
013200******************************************************************01320000
013300* COPYBOOKS                                                       01330000
013400***VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01340000
013500     COPY DPWS004.                                                01350000
013600                                                                  01360000
013700******************************************************************01370000
013800***DB2 MESSAGE AREA                                               01380000
013900     COPY SQLCA2.                                                 01390000
014000                                                                  01400000
014100******************************************************************01410000
014200* TABLE INCLUSIONS                                                01420000
014300******************************************************************01430000
014400     EXEC SQL INCLUDE SQLCA    END-EXEC.                          01440000
014500                                                                  01450000
014600* CE - CENTRAL STOCK PULL REQUEST LOCATION ITEMS                  01460000
014700     EXEC SQL                                                     01470008
014800          INCLUDE TCEPLIT                                         01480008
014900     END-EXEC.                                                    01490008
015000                                                                  01500000
015100* CE - CE - CENTRAL STOCK PULL REQUESTS                           01510000
015200     EXEC SQL                                                     01520008
015300          INCLUDE TCEPLRQ                                         01530008
015400     END-EXEC.                                                    01540008
015500                                                                  01550000
015600* CE - CENTRAL,STOCK PULL ITEM STORE                              01560000
015700     EXEC SQL                                                     01570008
015800          INCLUDE TCEPLDS                                         01580008
015900     END-EXEC.                                                    01590008
016000                                                                  01600000
016100* CE - CENTRAL STOCK PULL REQUEST STATUS                          01610000
016200     EXEC SQL                                                     01620008
016300          INCLUDE TCEPLST                                         01630008
016400     END-EXEC.                                                    01640008
016500                                                                  01650008
016600* **SKU STORE VIEW                       *                        01660000
016700     EXEC SQL                                                     01670008
016800          INCLUDE XLV00002                                        01680008
016900     END-EXEC.                                                    01690008
017000                                                                  01700000
017100* ***SKU STORE TABLE                     *                        01710000
017200     EXEC SQL                                                     01720008
017300          INCLUDE XLT00003                                        01730008
017400     END-EXEC.                                                    01740008
017500                                                                  01750008
017600* PARM TABLE FOR DETERMINE IF DISPLAYS ARE USED                   01760000
017700     EXEC SQL                                                     01770008
017800          INCLUDE TKRPRPM                                         01780008
017900     END-EXEC.                                                    01790008
018000                                                                  01800000
018100******************************************************************01810000
018200 LINKAGE SECTION.                                                 01820000
018300******************************************************************01830000
018400 01  LS-CNSTK-LOC-ID               PIC  S9(04) COMP.              01840000
018500 01  LS-SKU                        PIC  S9(09) COMP.              01850000
018600 01  LS-CNSTK-REQ-PL-NBR           PIC  S9(09) COMP.              01860000
018700 01  LS-CRE-BY-USR-ID              PIC   X(08).                   01870000
018800 01  LS-SRC-TYP-CDE                PIC   X(02).                   01880000
018900 01  LS-TABLE                      PIC   X(22000).                01890000
019000                                                                  01900000
019100 01  LS-OUT-SKU                    PIC  S9(09) COMP.              01910000
019200 01  LS-OUT-CNSTK-LOC-ID           PIC  S9(09) COMP.              01920000
019300 01  LS-OUT-MESSAGE-CODE           PIC  S9(09) COMP.              01930000
019400                                                                  01940000
019500 PROCEDURE DIVISION USING   LS-CNSTK-LOC-ID                       01950000
019600                          , LS-SKU                                01960000
019700                          , LS-CNSTK-REQ-PL-NBR                   01970000
019800                          , LS-CRE-BY-USR-ID                      01980000
019900                          , LS-SRC-TYP-CDE                        01990000
020000                          , LS-TABLE                              02000000
020100                          , LS-OUT-SKU                            02010000
020200                          , LS-OUT-CNSTK-LOC-ID                   02020000
020300                          , LS-OUT-MESSAGE-CODE.                  02030000
020400                                                                  02040000
020500******************************************************************02050000
020600*                                                                *02060008
020700******************************************************************02070008
020800 0000-MAINLINE.                                                   02080000
020900                                                                  02090000
021000     EXEC SQL                                                     02100000
021100         SELECT FUNC_TXT                                          02110000
021200           INTO :PS-DISPLAY-SW                                    02120000
021300          FROM TKRPRPM                                            02130000
021400         WHERE LOC_ID            =  90                            02140021
021410           AND INTFC_SYS_CDE     = 'KHL'                          02141021
021420           AND SYS_PRC_FUNC_CDE  = 'CESPDS'                       02142021
021430           AND FUNC_PRC_STAT_CDE = 'AC'                           02143021
021440           AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP             02144021
021450           AND FUNC_END_TMST    >=  CURRENT TIMESTAMP             02145021
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700     MOVE  '0000-MAINLINE' TO PV-PARAGRAPH-NAME.                  02170008
021800                                                                  02180008
021900* 4/6/12 COMMENT OUT DISPLAY - SEE MESSAGE AT TOP OF PROGRAM      02190040
021901*                                                                 02190140
021902*    DISPLAY ' CEKSP003 - START - DISPLAY:'                       02190240
021910*             PS-DISPLAY-SW.                                      02191038
021920                                                                  02192021
022000*    PERFORM 9900-DISPLAY-PARAMETERS.                             02200038
022100                                                                  02210008
022200                                                                  02220000
022300     PERFORM 0100-INITIALIZATION.                                 02230000
022400                                                                  02240000
022500* TCEPLRQ & TCEPLST                                               02250012
022600     PERFORM 0200-PROCESS-PULL-REQUEST.                           02260012
022700                                                                  02270012
022800* TCEPLIT                                                         02280012
022900     IF  PS-SQL-ERROR-NO                                          02290012
023000         PERFORM 0300-PROCESS-PULL-ITEM                           02300012
023100     END-IF.                                                      02310012
023200                                                                  02320012
023300* TCEPLDS                                                         02330012
023400     IF  PS-SQL-ERROR-NO                                          02340012
023500         PERFORM 0400-PROCESS-PULL-DISTRO                         02350012
023600     END-IF.                                                      02360012
023700                                                                  02370008
023710     MOVE LS-OUT-SKU           TO  PV-DISP-OUT-SKU.               02371032
023720     MOVE LS-OUT-CNSTK-LOC-ID  TO  PV-DISP-OUT-LOC.               02372032
023730     MOVE LS-OUT-MESSAGE-CODE  TO  PV-DISP-MESSAGE.               02373032
023800                                                                  02380032
023801* 4/6/12 COMMENT OUT DISPLAY - SEE MESSAGE AT TOP OF PROGRAM      02380140
023802*                                                                 02380240
023803*    DISPLAY 'CEKSP003 PROCESSED- '                               02380338
023804*            PV-DISP-LOC      ' '                                 02380438
023805*            PV-DISP-PULL     ' '                                 02380538
023806*            PV-DISP-SKU      ' - OUT:'                           02380638
023807*            PV-DISP-OUT-SKU ' '                                  02380738
023808*            PV-DISP-OUT-LOC ' '                                  02380838
023809*            PV-DISP-MESSAGE.                                     02380938
023810*    DISPLAY '        '.                                          02381038
023811                                                                  02381131
023820                                                                  02382031
023900     MOVE SQLCODE TO PV-HOLD-SQLCODE.                             02390008
024000     IF PS-DISPLAY-YES                                            02400008
024100         DISPLAY 'OUTPUT= ' LS-OUT-SKU ' '                        02410008
024200                 LS-OUT-CNSTK-LOC-ID ' '                          02420008
024300                 PV-HOLD-SQLCODE                                  02430008
024400     END-IF.                                                      02440008
024500                                                                  02450008
024600     IF PS-DISPLAY-YES                                            02460008
024700         MOVE '0000-MAINLINE GOBACK' TO PV-PARAGRAPH-NAME         02470008
024800         MOVE '***ENDING PROGRAM***' TO PV-INFO-LINE              02480008
024900         PERFORM 9900-DISPLAY-PARAMETERS                          02490008
025000     END-IF.                                                      02500008
025100     GOBACK.                                                      02510008
025200                                                                  02520008
025300******************************************************************02530000
025400* INITIALIZATION AREA - SETUP QUEUES FOR PROCESSING               02540000
025500******************************************************************02550000
025600 0100-INITIALIZATION.                                             02560000
025700     IF PS-DISPLAY-YES                                            02570000
025800         MOVE '0100-INITIALIZATION' TO PV-PARAGRAPH-NAME          02580000
025900         MOVE '***STARTING INIT  ***' TO PV-INFO-LINE             02590000
026000         PERFORM 9900-DISPLAY-PARAMETERS                          02600008
026100     END-IF.                                                      02610000
026200                                                                  02620008
026300     MOVE +0                    TO PV-REQ-PL-QTY-SUM              02630012
026400                                   PV-PL-LNE-NBR                  02640012
026500     MOVE 'Y'                   TO PS-UNSTRING-SW                 02650012
026600                                   PS-TCEPLRQ-ROW-EXISTS-SW       02660012
026700     MOVE 'N'                   TO PS-SQL-ERROR-SW                02670012
026800                                                                  02680012
026900     SET PS-NEW-ROW-CREATED-NO  TO TRUE                           02690012
027000                                                                  02700008
027100     MOVE LS-CNSTK-LOC-ID       TO PV-CNSTK-LOC-ID                02710012
027200                                   LS-OUT-CNSTK-LOC-ID            02720012
027300                                   PV-DISP-LOC.                   02730012
027400                                                                  02740008
027500     MOVE LS-SKU                TO PV-SKU                         02750012
027600                                   LS-OUT-SKU                     02760012
027700                                   PV-DISP-SKU.                   02770012
027800                                                                  02780008
027900     MOVE LS-CNSTK-REQ-PL-NBR   TO PV-CNSTK-REQ-PL-NBR            02790012
028000                                   PV-DISP-PULL.                  02800012
028100                                                                  02810008
028200     MOVE LS-CRE-BY-USR-ID      TO PV-CRE-BY-USR-ID.              02820012
028300     MOVE LS-SRC-TYP-CDE        TO PV-SRC-TYP-CDE.                02830012
028400     MOVE LS-TABLE              TO PV-VARCHAR.                    02840012
028500                                                                  02850000
028600***  ALWAYS DISPLAY THE PULL NUMBER THAT IS BEING PROCESSED       02860008
028700                                                                  02870038
028701* 4/6/12 COMMENT OUT DISPLAY - SEE MESSAGE AT TOP OF PROGRAM      02870140
028702*                                                                 02870240
028710*    DISPLAY 'CEKSP003 NEW PULL - '                               02871038
028800*            PV-DISP-LOC      ' '                                 02880038
028900*            PV-DISP-PULL     ' '                                 02890038
029000*            PV-DISP-SKU      ' '                                 02900038
029100*            LS-CRE-BY-USR-ID ' '                                 02910038
029200*            LS-SRC-TYP-CDE.                                      02920038
029500                                                                  02950000
029600                                                                  02960000
030300******************************************************************03030012
030400* PROCESS PULL REQUEST - TCEPLRQ AND TCEPLST                     *03040012
030500******************************************************************03050012
030600 0200-PROCESS-PULL-REQUEST.                                       03060012
030700                                                                  03070012
030800     PERFORM 2000-SELECT-TCEPLRQ.                                 03080012
031200                                                                  03120012
031300*** PULL STATUS - TCEPLST                                         03130012
031400                                                                  03140012
031500     IF  PS-SQL-ERROR-NO                                          03150012
031700         IF  PS-SQL-ERROR-NO                                      03170012
031800             PERFORM 2500-COMMIT                                  03180012
031900         END-IF                                                   03190012
032000     END-IF.                                                      03200012
032100                                                                  03210012
032200                                                                  03220012
032300******************************************************************03230012
032400*                                                                *03240012
032500******************************************************************03250012
032600 0300-PROCESS-PULL-ITEM.                                          03260012
032700                                                                  03270012
032800*** DETERMINE LINE NUMBER FOR PULL                                03280012
032900                                                                  03290012
033000     IF  PS-SQL-ERROR-NO                                          03300012
033100         IF  PS-TCEPLRQ-ROW-EXISTS                                03310012
033200             PERFORM 7000-MAX-PL-LNE-NBR                          03320012
033300         ELSE                                                     03330012
033400             MOVE +1  TO PV-PL-LNE-NBR                            03340012
033500         END-IF                                                   03350012
033600     END-IF.                                                      03360012
033700                                                                  03370012
033800                                                                  03380012
033900     PERFORM 7050-SELECT-ITEM-NUMBER.                             03390012
034000     PERFORM 7100-SELECT-UNIT-RETAIL.                             03400012
034100                                                                  03410012
034200                                                                  03420012
034300* UNSTRING VARCHAR FIELD                                          03430012
034400* THIS WILL CONTAIN STORE NUMBERS AND PULL UNITS                  03440012
034500* UP TO 2000 STORES                                               03450012
034600* ALSO CALCULATES THE TOTAL REQUESTED QUANTITY FOR PULL           03460012
034700                                                                  03470012
034800     PERFORM 0500-UNSTRING.                                       03480012
034900                                                                  03490012
035100*** PULL ITEM/LINE - TCEPLIT                                      03510012
035101                                                                  03510128
035110     SET  PS-TCEPLIT-PROCESSED-NO  TO  TRUE                       03511028
035200                                                                  03520012
035300     IF  PS-SQL-ERROR-NO                                          03530012
035400         PERFORM 2200-INSERT-TCEPLIT                              03540012
035500           UNTIL  PS-TCEPLIT-PROCESSED                            03550028
035700              OR PS-SQL-ERROR-YES                                 03570015
035800                                                                  03580015
035900         IF  PS-SQL-ERROR-NO                                      03590015
036000             PERFORM 2500-COMMIT                                  03600015
036100         END-IF                                                   03610015
036200     END-IF.                                                      03620015
036300                                                                  03630015
036400                                                                  03640015
036500******************************************************************03650015
036600*  PULL STORE DISTRIBUTION - TCEPLDS                             *03660015
036700******************************************************************03670015
036800 0400-PROCESS-PULL-DISTRO.                                        03680015
036900                                                                  03690015
037000                                                                  03700015
037100     SET IN-SUB TO 1.                                             03710015
037200     IF  PS-DISPLAY-YES                                           03720015
037300         DISPLAY 'QTY 1 =' PA-ACTL-PL-QTY (1)                     03730015
037400         DISPLAY 'QTY 2 =' PA-ACTL-PL-QTY (2)                     03740015
037500     END-IF.                                                      03750015
037600                                                                  03760015
037700     PERFORM 1000-PROCESS-STORES                                  03770015
037800             VARYING IN-SUB                                       03780015
037900                FROM 1 BY 1                                       03790015
038000               UNTIL IN-SUB > 2000                                03800015
038100                  OR PA-STR-NBR(IN-SUB) = '0000'                  03810015
038110                  OR PA-STR-NBR(IN-SUB) = '    '                  03811037
038200                  OR PS-SQL-ERROR-YES.                            03820015
038300                                                                  03830012
038400     IF PS-SQL-ERROR-NO                                           03840012
038500         PERFORM 2500-COMMIT                                      03850012
038600     ELSE                                                         03860012
038700         PERFORM 2600-ROLLBACK                                    03870012
038800     END-IF.                                                      03880012
038900                                                                  03890012
039000******************************************************************03900000
039100* TAKE 22000 BYTE INPUT & FORMAT IT INTO A TABLE OCCURRING 2000   03910000
039200******************************************************************03920000
039300 0500-UNSTRING.                                                   03930000
039310                                                                  03931026
039320     IF PS-DISPLAY-YES                                            03932026
039330         MOVE '0500-UNSTRING       ' TO PV-PARAGRAPH-NAME         03933026
039340         PERFORM 9900-DISPLAY-PARAMETERS                          03934026
039350     END-IF.                                                      03935026
039400                                                                  03940000
039500     MOVE 1 TO PV-WS-CTR.                                         03950000
039600                                                                  03960008
039700     PERFORM VARYING IN-SUB                                       03970000
039800                FROM 1 BY 1                                       03980000
039900               UNTIL PV-WS-CTR  >  22000                          03990008
040000                  OR IN-SUB     >  2000                           04000008
040100                  OR PS-DONE-UNSTRING                             04010008
040200                                                                  04020000
040300         UNSTRING PV-VARCHAR-TEXT                                 04030008
040400                  DELIMITED BY PC-DELIMITER-COMMA                 04040008
040500             INTO WS-STR-NBR                                      04050008
040600                  WS-ACTL-PL-QTY                                  04060008
040700             WITH POINTER PV-WS-CTR                               04070008
040800         END-UNSTRING                                             04080008
040900                                                                  04090000
041000**       DISPLAY 'PV-WS-CTR'   PV-WS-CTR                          04100008
041100         MOVE '0000'   TO   WS-STR-NBR-N                          04110008
041200         MOVE '00000'  TO   WS-ACTL-PL-QTY-N                      04120008
041300         MOVE +4       TO   WS-SHIFT-CNTR-END                     04130008
041400                                                                  04140008
041500         PERFORM                                                  04150008
041600             VARYING WS-SHIFT-CNTR-ST                             04160008
041700                FROM 4 BY -1                                      04170008
041800               UNTIL WS-SHIFT-CNTR-ST < 1                         04180008
041900                  IF WS-STR-NBR(WS-SHIFT-CNTR-ST:1) > SPACE       04190008
042000                     MOVE WS-STR-NBR(WS-SHIFT-CNTR-ST:1)          04200008
042100                       TO WS-STR-NBR-N(WS-SHIFT-CNTR-END:1)       04210008
042200                     SUBTRACT +1 FROM WS-SHIFT-CNTR-END           04220008
042300                  END-IF                                          04230008
042400         END-PERFORM                                              04240008
042500                                                                  04250008
042600         MOVE +5 TO WS-SHIFT-CNTR-END                             04260008
042700         PERFORM                                                  04270008
042800             VARYING WS-SHIFT-CNTR-ST                             04280008
042900                FROM 5 BY -1                                      04290008
043000               UNTIL WS-SHIFT-CNTR-ST < 1                         04300008
043100                  IF WS-ACTL-PL-QTY(WS-SHIFT-CNTR-ST:1) > SPACE   04310008
043200                     MOVE WS-ACTL-PL-QTY(WS-SHIFT-CNTR-ST:1)      04320008
043300                       TO WS-ACTL-PL-QTY-N(WS-SHIFT-CNTR-END:1)   04330008
043400                     SUBTRACT +1 FROM WS-SHIFT-CNTR-END           04340008
043500                  END-IF                                          04350008
043600         END-PERFORM                                              04360008
043700                                                                  04370008
043800         MOVE WS-STR-NBR-N     TO  PA-STR-NBR (IN-SUB)            04380008
043900         MOVE WS-ACTL-PL-QTY-N TO  PA-ACTL-PL-QTY (IN-SUB)        04390008
044000                                                                  04400008
044100* CALCULATE PULL ITEM QUANTITY                                    04410008
044110         IF  PA-STR-NBR (IN-SUB) = '0000' OR SPACES               04411041
044111             SET PS-DONE-UNSTRING TO TRUE                         04411141
044130         ELSE                                                     04413041
044200         IF  PA-ACTL-PL-QTY-X (IN-SUB) NUMERIC                    04420008
044300             MOVE PA-ACTL-PL-QTY (IN-SUB) TO PV-REQ-PL-QTY        04430008
044400             COMPUTE PV-REQ-PL-QTY-SUM =                          04440008
044500                     PV-REQ-PL-QTY-SUM +                          04450008
044600                     PV-REQ-PL-QTY                                04460008
044700         ELSE                                                     04470008
044800             MOVE ZEROS               TO  PV-REQ-PL-QTY           04480008
044900                                          PA-ACTL-PL-QTY(IN-SUB)  04490008
045000         END-IF                                                   04500008
045010         END-IF                                                   04501041
045100                                                                  04510008
045700                                                                  04570008
045800     IF PS-DISPLAY-YES                                            04580008
045900          DISPLAY 'STORE=' PA-STR-NBR     (IN-SUB)                04590026
046000                  '  QTY=' PA-ACTL-PL-QTY (IN-SUB)                04600027
046010                  '  WAS UNSTRUNG'                                04601026
046100     END-IF                                                       04610008
046200                                                                  04620008
046300     END-PERFORM.                                                 04630008
046900                                                                  04690008
047000******************************************************************04700008
047100* EDIT INPUT - IF GOOD, SELECT QUANTITY AND FORMAT OUTPUT         04710008
047200******************************************************************04720008
047300 1000-PROCESS-STORES.                                             04730008
047400                                                                  04740008
047410     MOVE '1000-PROCESS-STORES' TO PV-PARAGRAPH-NAME.             04741022
047420                                                                  04742022
047500     IF  PA-STR-NBR (IN-SUB) NUMERIC                              04750008
047600         MOVE PA-STR-NBR (IN-SUB)      TO PV-STR-NBR              04760008
047700                                          XLV00002-STR-NBR        04770008
047800         MOVE PA-ACTL-PL-QTY (IN-SUB)  TO PV-REQ-PL-QTY           04780008
047900                                                                  04790008
048000         PERFORM 2300-INSERT-TCEPLDS                              04800008
048100     ELSE                                                         04810000
048200         MOVE ZEROS                    TO PV-STR-NBR              04820000
048300     END-IF.                                                      04830008
048400                                                                  04840000
048500                                                                  04850008
048600     IF PS-DISPLAY-YES                                            04860000
048700         MOVE '1000-PROCESS-INPUT  ' TO PV-PARAGRAPH-NAME         04870000
048800         PERFORM 9900-DISPLAY-PARAMETERS                          04880008
048900     END-IF.                                                      04890000
049000                                                                  04900008
049100                                                                  04910008
049200******************************************************************04920008
049300* CHECK TO SEE IF PULL IS ALREADY IN TCEPLRQ                      04930008
049400*     - IF PULL NOT IN DATABASE - INSERT AND COMMIT               04940008
049500*     - IF PULL ALREADY IN DATABASE - PROCEED TO PROCESS LINES    04950008
049600******************************************************************04960008
049700 2000-SELECT-TCEPLRQ.                                             04970008
049800                                                                  04980008
049900     MOVE '2000-SELECT-TCEPLRQ'   TO PV-PARAGRAPH-NAME            04990008
050000                                                                  05000008
050200     SET PS-TCEPLRQ-ROW-EXISTS-NO TO TRUE                         05020018
050210                                                                  05021018
050300     EXEC SQL                                                     05030008
050400         SELECT  CNSTK_REQ_PL_NBR                                 05040012
050500           INTO :CEPLRQ-CNSTK-REQ-PL-NBR                          05050012
050600           FROM  TCEPLRQ                                          05060012
050700           WHERE CNSTK_REQ_PL_NBR = :PV-CNSTK-REQ-PL-NBR          05070012
050800     END-EXEC.                                                    05080008
050900                                                                  05090008
051000     EVALUATE TRUE                                                05100008
051100         WHEN SQLCODE = ZERO                                      05110008
051200              SET PS-TCEPLRQ-ROW-EXISTS TO TRUE                   05120008
051300                                                                  05130008
051400         WHEN SQLCODE = +100                                      05140008
051500              PERFORM 2100-INSERT-TCEPLRQ                         05150008
051600                                                                  05160008
051700         WHEN OTHER                                               05170008
051800             SET PS-SQL-ERROR-YES TO TRUE                         05180008
051900             PERFORM Z900-DISPLAY-SQL-ERROR                       05190008
052000             MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE              05200008
052100                                                                  05210012
052200     END-EVALUATE.                                                05220008
052300                                                                  05230008
052400     IF PS-DISPLAY-YES                                            05240008
052500         MOVE SQLCODE         TO PV-SQLCODE-OUT                   05250008
052600         STRING 'CHECK PULL EXISTS SQL:'                          05260021
052700                PV-SQLCODE-OUT                 DELIMITED BY SIZE  05270021
052800                                      INTO PV-INFO-LINE           05280021
052900         MOVE '2000-SELECT-TCEPLRQ ' TO PV-PARAGRAPH-NAME         05290008
053000         PERFORM 9900-DISPLAY-PARAMETERS                          05300010
053100     END-IF.                                                      05310008
053200                                                                  05320008
053300                                                                  05330000
053400******************************************************************05340000
053500* INSERT INTO TCEPLRQ                                             05350012
053600******************************************************************05360000
053700 2100-INSERT-TCEPLRQ.                                             05370000
053800                                                                  05380000
053900     MOVE '2100-INSERT-TCEPLRQ'   TO PV-PARAGRAPH-NAME            05390000
054000                                                                  05400000
054100     EXEC SQL                                                     05410000
054200         INSERT                                                   05420000
054300           INTO TCEPLRQ                                           05430008
054400                       ( CNSTK_REQ_PL_NBR                         05440000
054500                        ,CNSTK_LOC_ID                             05450000
054600                        ,SRC_REF_NBR                              05460000
054700                        ,SRC_TYP_CDE                              05470000
054800                        ,STAT_CDE )                               05480000
054900         VALUES                                                   05490008
055000                       (:PV-CNSTK-REQ-PL-NBR                      05500008
055100                       ,:PV-CNSTK-LOC-ID                          05510008
055200                       ,:PV-SRC-REF-NBR                           05520008
055300                       ,:PV-SRC-TYP-CDE                           05530008
055400                       ,'NW' )                                    05540008
055500     END-EXEC.                                                    05550008
055600                                                                  05560008
055700     EVALUATE TRUE                                                05570008
055800         WHEN SQLCODE = ZERO                                      05580008
055801              MOVE ZERO            TO LS-OUT-MESSAGE-CODE         05580117
055802              MOVE ZERO            TO CEPLST-PL-LNE-NBR           05580217
055803              PERFORM 2400-INSERT-TCEPLST                         05580317
055804                                                                  05580417
055805              MOVE 1 TO PV-PL-LNE-NBR                             05580515
055807              PERFORM 2500-COMMIT                                 05580715
055808                                                                  05580815
055810         WHEN SQLCODE = -803                                      05581015
055820              SET PS-TCEPLRQ-ROW-EXISTS TO TRUE                   05582015
056100                                                                  05610008
056600         WHEN SQLCODE = -911                                      05660008
056610         WHEN SQLCODE = -913                                      05661015
056700              MOVE SQLCODE         TO LS-OUT-MESSAGE-CODE         05670012
056800              SET PS-SQL-ERROR-YES TO TRUE                        05680008
056900                                                                  05690008
057000         WHEN OTHER                                               05700008
057100              MOVE SQLCODE         TO LS-OUT-MESSAGE-CODE         05710012
057200              SET PS-SQL-ERROR-YES TO TRUE                        05720008
057300     END-EVALUATE.                                                05730008
057400                                                                  05740012
057500     IF PS-DISPLAY-YES                                            05750008
057600         MOVE SQLCODE         TO PV-SQLCODE-OUT                   05760008
057700         STRING 'INSERT TCEPLRQ SQL:'                             05770021
057800                PV-SQLCODE-OUT             DELIMITED BY SIZE      05780021
057900                                      INTO PV-INFO-LINE           05790021
058000         MOVE '2100-INSERT-TCEPLRQ ' TO PV-PARAGRAPH-NAME         05800008
058100         PERFORM 9900-DISPLAY-PARAMETERS                          05810008
058200     END-IF.                                                      05820008
058300                                                                  05830008
058400                                                                  05840008
058500******************************************************************05850008
058600* INSERT INTO TCEPLIT A STOCK PULL                                05860008
058700******************************************************************05870008
058800 2200-INSERT-TCEPLIT.                                             05880008
058900     MOVE '2200-INSERT-TCEPLIT'   TO PV-PARAGRAPH-NAME            05890008
058901                                                                  05890126
058910     IF PS-DISPLAY-YES                                            05891026
058920         DISPLAY 'CEKSP003-INSERT TCEPLIT '                       05892041
058930                 'LOC:' PV-CNSTK-LOC-ID ' '                       05893026
058940                 'PULL:' PV-CNSTK-REQ-PL-NBR ' '                  05894026
058950                 'ITM_NBR:' PV-ITM-NBR ' '                        05895026
058960     END-IF.                                                      05896026
058970                                                                  05897026
059000                                                                  05900008
059100     IF  PS-DISPLAY-YES                                           05910008
059200         DISPLAY 'CNSTK_REQ_PL_NBR: ' PV-CNSTK-REQ-PL-NBR         05920012
059300         DISPLAY 'PL_LNE_NBR:       ' PV-PL-LNE-NBR               05930012
059400         DISPLAY 'ITM_NBR:          ' PV-ITM-NBR                  05940012
059500         DISPLAY 'ACTL_PL_QTY:      ' PV-REQ-PL-QTY               05950012
059600         DISPLAY 'UNT_RTL_AMT:      ' PV-UNT-RTL-AMT              05960012
059700     END-IF                                                       05970008
059800                                                                  05980008
059900     EXEC SQL                                                     05990008
060000         INSERT                                                   06000008
060100           INTO TCEPLIT                                           06010008
060200                      ( CNSTK_REQ_PL_NBR                          06020008
060300                       ,PL_LNE_NBR                                06030008
060400                       ,ITM_NBR                                   06040008
060500                       ,PL_REQ_QTY                                06050008
060600                       ,ACTL_PL_QTY                               06060008
060700                       ,STAT_CDE                                  06070008
060800                       ,UNT_RTL_AMT                               06080008
060900                       ,EXPRT_PRC_BTCH_ID                         06090008
061000                       ,DWNLD_RDM_STAT_CDE )                      06100008
061100         VALUES                                                   06110008
061200                      (:PV-CNSTK-REQ-PL-NBR                       06120008
061300                      ,:PV-PL-LNE-NBR                             06130008
061400                      ,:PV-ITM-NBR                                06140008
061500                      ,:PV-REQ-PL-QTY-SUM                         06150008
061600                      , NULL                                      06160008
061700                      ,'NW'                                       06170008
061800                      ,:PV-UNT-RTL-AMT                            06180008
061900                      ,'   '                                      06190008
062000                      ,' '              )                         06200008
062100                                                                  06210000
062200     END-EXEC.                                                    06220000
062310                                                                  06231026
062320     IF  PS-DISPLAY-YES                                           06232026
062330         MOVE SQLCODE             TO LS-OUT-MESSAGE-CODE          06233026
062340         DISPLAY 'CNSTK_REQ_PL_NBR:' PV-CNSTK-REQ-PL-NBR          06234026
062350                 ' PL_LNE_NBR:'      PV-PL-LNE-NBR                06235026
062360                 ' ITM_NBR:'         PV-ITM-NBR                   06236026
062370                 ' ACTL_PL_QTY:'     PV-REQ-PL-QTY                06237026
062380                 ' UNT_RTL_AMT:'     PV-UNT-RTL-AMT               06238026
062390                 ' SQL:'             LS-OUT-MESSAGE-CODE          06239026
062391     END-IF                                                       06239126
062392                                                                  06239226
062400     EVALUATE TRUE                                                06240000
062500         WHEN SQLCODE = ZERO                                      06250000
062600              MOVE SQLCODE         TO LS-OUT-MESSAGE-CODE         06260015
062601              MOVE PV-PL-LNE-NBR   TO CEPLST-PL-LNE-NBR           06260117
062602              SET  PS-TCEPLIT-PROCESSED  TO  TRUE                 06260228
062610              PERFORM 2400-INSERT-TCEPLST                         06261017
062700                                                                  06270012
062800         WHEN SQLCODE = -911                                      06280000
062810         WHEN SQLCODE = -913                                      06281015
063000              MOVE SQLCODE         TO LS-OUT-MESSAGE-CODE         06300015
063010              SET PS-SQL-ERROR-YES TO TRUE                        06301015
063100                                                                  06310012
063200         WHEN SQLCODE = -803                                      06320015
063201                                                                  06320136
063210              MOVE PV-CNSTK-LOC-ID       TO  PV-DISP-LOC          06321036
063220              MOVE PV-CNSTK-REQ-PL-NBR   TO  PV-DISP-PULL         06322036
063230              MOVE PV-PL-LNE-NBR         TO  PV-DISP-LINE         06323036
063240                                                                  06324038
063241* 4/6/12 COMMENT OUT DISPLAY - SEE MESSAGE AT TOP OF PROGRAM      06324140
063242*                                                                 06324240
063250*             DISPLAY 'CEKSP003 - TCEPLIT EXISTS: '               06325041
063260*                      PV-DISP-LOC    '-'                         06326038
063270*                      PV-DISP-PULL   '-'                         06327038
063280*                      PV-DISP-LINE   '-'                         06328038
063290*                      PV-ITM-NBR                                 06329038
063291*                     '  GET NEXT LINE '                          06329138
063292                                                                  06329236
063300              PERFORM 7000-MAX-PL-LNE-NBR                         06330012
063400                                                                  06340012
063500         WHEN OTHER                                               06350000
063600              MOVE SQLCODE         TO LS-OUT-MESSAGE-CODE         06360015
063610              SET PS-SQL-ERROR-YES TO TRUE                        06361015
063700                                                                  06370012
063800     END-EVALUATE.                                                06380000
063900                                                                  06390008
064000     IF  PS-SQL-ERROR-YES                                         06400008
064100         DISPLAY 'CEKSP003 - INSERT TCEPLIT'                      06410008
064200         DISPLAY 'CS LOCATION:     ' PV-CNSTK-LOC-ID              06420008
064300         DISPLAY 'CNSTK_REQ_PL_NBR:' PV-CNSTK-REQ-PL-NBR          06430008
064400         DISPLAY 'ITM_NBR:         ' PV-ITM-NBR                   06440008
064410         DISPLAY 'SQLCODE:         ' LS-OUT-MESSAGE-CODE          06441023
064500         DISPLAY ' '                                              06450008
064600     END-IF                                                       06460001
064700                                                                  06470008
064800     IF PS-DISPLAY-YES                                            06480000
064900         MOVE SQLCODE           TO PV-SQLCODE-OUT                 06490012
065000         STRING 'INSERT TCEPLIT SQL:'                             06500021
065100                PV-SQLCODE-OUT     DELIMITED BY SIZE              06510012
065200                              INTO PV-INFO-LINE                   06520012
065300         MOVE '2200-INSERT-TCEPLIT ' TO PV-PARAGRAPH-NAME         06530000
065400         PERFORM 9900-DISPLAY-PARAMETERS                          06540008
065500     END-IF.                                                      06550000
065600                                                                  06560000
065700                                                                  06570012
065800******************************************************************06580000
065900* INSERT INTO TCEPLDS A STOCK PULL                                06590000
066000******************************************************************06600000
066100 2300-INSERT-TCEPLDS.                                             06610000
066200     MOVE '2300-INSERT-TCEPLDS'   TO PV-PARAGRAPH-NAME            06620000
066300                                                                  06630000
066400     EXEC SQL                                                     06640000
066500         INSERT                                                   06650000
066600           INTO TCEPLDS                                           06660008
066700                       ( CNSTK_REQ_PL_NBR                         06670000
066800                        ,PL_LNE_NBR                               06680000
066900                        ,STR_NBR                                  06690000
067000                        ,REQ_ORD_QTY                              06700000
067100                        ,ACTL_DISTRB_QTY )                        06710000
067200         VALUES                                                   06720008
067300                       (:PV-CNSTK-REQ-PL-NBR                      06730008
067400                       ,:PV-PL-LNE-NBR                            06740008
067500                       ,:PV-STR-NBR                               06750008
067600                       ,:PV-REQ-PL-QTY                            06760008
067700                       , NULL            )                        06770008
067800                                                                  06780000
067900     END-EXEC.                                                    06790000
068000                                                                  06800000
068010* -803 ALREADY EXISTS - MOVE ONTO NEXT STORE                      06801017
068020* DO NOT CREATE ERROR                                             06802017
068030* MIGHT HAVE TO REVISIT THIS-803 LOGIC                            06803017
068040                                                                  06804017
068100     EVALUATE TRUE                                                06810000
068200         WHEN SQLCODE = ZERO                                      06820000
068300             MOVE SQLCODE      TO LS-OUT-MESSAGE-CODE             06830000
068400                                                                  06840012
068500         WHEN SQLCODE = -803                                      06850017
068600              CONTINUE                                            06860017
068700                                                                  06870017
068800         WHEN SQLCODE = -911                                      06880000
068810         WHEN SQLCODE = -913                                      06881015
068900              SET PS-SQL-ERROR-YES TO TRUE                        06890000
069000              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             06900000
069100                                                                  06910012
069200         WHEN OTHER                                               06920000
069300              SET  PS-SQL-ERROR-YES TO TRUE                       06930000
069400              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             06940000
069500     END-EVALUATE.                                                06950005
069600                                                                  06960038
069610* 4/6/12 COMMENT OUT DISPLAY - SEE MESSAGE AT TOP OF PROGRAM      06961040
069620*                                                                 06962040
069700*    IF PS-SQL-ERROR-YES                                          06970038
069800*        DISPLAY 'CS LOCATION:       ' PV-CNSTK-LOC-ID            06980038
069900*        DISPLAY 'CNSTK_REQ_PL_NBR:  ' PV-CNSTK-REQ-PL-NBR        06990038
070000*        DISPLAY 'ITM_NBR:           ' PV-ITM-NBR                 07000038
070100*        DISPLAY 'STORE NUM:         ' PV-STR-NBR                 07010038
070200*    END-IF                                                       07020038
070300                                                                  07030012
070400     IF PS-DISPLAY-YES                                            07040000
070500         MOVE SQLCODE             TO PV-SQLCODE-OUT               07050012
070600         STRING 'INSERT TCEPLDS SQL:'                             07060021
070700                PV-SQLCODE-OUT       DELIMITED BY SIZE            07070021
070800                                INTO PV-INFO-LINE                 07080021
070900         MOVE '2300-INSERT-TCEPLDS ' TO PV-PARAGRAPH-NAME         07090000
071000         PERFORM 9900-DISPLAY-PARAMETERS                          07100008
071100     END-IF.                                                      07110000
071200                                                                  07120000
071300                                                                  07130012
071400******************************************************************07140000
071500* INSERT INTO TCEPLST A STOCK PULL                                07150000
071600******************************************************************07160000
071700 2400-INSERT-TCEPLST.                                             07170000
071800     MOVE '2400-INSERT-TCEPLST'   TO PV-PARAGRAPH-NAME            07180000
071900                                                                  07190000
072000     EXEC SQL                                                     07200000
072100          INSERT                                                  07210012
072200            INTO TCEPLST                                          07220012
072300                        ( CNSTK_REQ_PL_NBR                        07230012
072400                         ,PL_LNE_NBR                              07240012
072500                         ,CRE_TMST                                07250012
072600                         ,STAT_CDE                                07260012
072700                         ,CRE_BY_USR_ID   )                       07270012
072800          VALUES                                                  07280012
072900                        (:PV-CNSTK-REQ-PL-NBR                     07290012
073000                        ,:CEPLST-PL-LNE-NBR                       07300012
073100                        , CURRENT TIMESTAMP                       07310012
073200                        ,'NW'                                     07320012
073300                        ,:PV-CRE-BY-USR-ID )                      07330012
073400     END-EXEC.                                                    07340000
073500                                                                  07350000
073600     EVALUATE TRUE                                                07360000
073700         WHEN SQLCODE = ZERO                                      07370000
073900              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             07390000
074000                                                                  07400012
074100         WHEN SQLCODE = -911                                      07410000
074110         WHEN SQLCODE = -913                                      07411015
074200              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             07420000
074300              SET  PS-SQL-ERROR-YES TO TRUE                       07430000
074400                                                                  07440012
074500         WHEN OTHER                                               07450000
074600              SET  PS-SQL-ERROR-YES TO TRUE                       07460000
074700              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             07470000
074800     END-EVALUATE.                                                07480000
074900                                                                  07490038
074910* 4/6/12 COMMENT OUT DISPLAY - SEE MESSAGE AT TOP OF PROGRAM      07491040
074920*                                                                 07492040
075000*    IF PS-SQL-ERROR-YES                                          07500038
075100*        DISPLAY 'CS LOCATION:      ' PV-CNSTK-LOC-ID             07510038
075200*        DISPLAY 'CNSTK_REQ_PL_NBR: ' PV-CNSTK-REQ-PL-NBR         07520038
075300*        DISPLAY 'ITM_NBR:          ' PV-ITM-NBR                  07530038
075400*        DISPLAY 'STORE NUM:        ' PV-STR-NBR                  07540038
075500*    END-IF                                                       07550038
075600                                                                  07560012
075700     IF PS-DISPLAY-YES                                            07570000
075710         MOVE CEPLST-PL-LNE-NBR  TO PV-DISP-LINE                  07571024
075800         MOVE SQLCODE         TO PV-SQLCODE-OUT                   07580000
075900         STRING 'INSERT TCEPLST SQL:'                             07590021
076000                PV-SQLCODE-OUT   DELIMITED BY SIZE                07600012
076100                            INTO PV-INFO-LINE                     07610012
076200         MOVE '2400-INSERT-TCEPLST ' TO PV-PARAGRAPH-NAME         07620000
076300                                                                  07630012
076400         PERFORM 9900-DISPLAY-PARAMETERS                          07640008
076410         DISPLAY ' STATUS PULL:' PV-CNSTK-REQ-PL-NBR              07641024
076420                 ' LINE: '       PV-DISP-LINE                     07642024
076600     END-IF.                                                      07660000
076700                                                                  07670000
076800******************************************************************07680000
076900* COMMIT ALL 4 ABOVE INSERTS IF ALL HAD SQLCODE = 00              07690000
077000******************************************************************07700000
077100 2500-COMMIT.                                                     07710000
077200                                                                  07720000
077300     EXEC SQL                                                     07730000
077400       COMMIT                                                     07740000
077500     END-EXEC.                                                    07750000
077600                                                                  07760000
077700     EVALUATE TRUE                                                07770000
077800         WHEN SQLCODE = ZERO                                      07780000
077900         WHEN SQLCODE = +100                                      07790000
078000              CONTINUE                                            07800000
078100         WHEN OTHER                                               07810000
078200              CONTINUE                                            07820000
078300     END-EVALUATE.                                                07830000
078400                                                                  07840012
078500     IF PS-DISPLAY-YES                                            07850000
078600         MOVE SQLCODE           TO PV-SQLCODE-OUT                 07860012
078610         STRING 'INSERT TCEPLST SQL:'                             07861021
078620                PV-SQLCODE-OUT   DELIMITED BY SIZE                07862021
078630                            INTO PV-INFO-LINE                     07863021
079000         MOVE '2500-COMMIT         ' TO PV-PARAGRAPH-NAME         07900000
079100         PERFORM 9900-DISPLAY-PARAMETERS                          07910008
079200     END-IF.                                                      07920000
079300******************************************************************07930000
079400* ROLLBACK IF THERE'S A SQL ERRO                                  07940000
079500******************************************************************07950000
079600 2600-ROLLBACK.                                                   07960000
079700                                                                  07970000
079800     EXEC SQL                                                     07980000
079900         ROLLBACK                                                 07990000
080000     END-EXEC.                                                    08000000
080100                                                                  08010000
080200     EVALUATE TRUE                                                08020000
080300         WHEN SQLCODE = ZERO                                      08030000
080400         WHEN SQLCODE = +100                                      08040000
080500              CONTINUE                                            08050000
080600         WHEN OTHER                                               08060000
080700              CONTINUE                                            08070000
080800     END-EVALUATE.                                                08080000
080900     IF PS-DISPLAY-YES                                            08090000
081000         MOVE SQLCODE         TO PV-SQLCODE-OUT                   08100000
081100         STRING 'SQL CODE : '                  DELIMITED BY SIZE, 08110000
081200                PV-SQLCODE-OUT                 DELIMITED BY SIZE  08120000
081300                                      INTO PV-INFO-LINE           08130000
081400         MOVE '2600-ROLLBACK       ' TO PV-PARAGRAPH-NAME         08140000
081500         PERFORM 9900-DISPLAY-PARAMETERS                          08150008
081600     END-IF.                                                      08160000
081700                                                                  08170000
081800******************************************************************08180000
081900* FOR ALL PULLS EXCEPT INITIAL GET OLDEST PL_LNE_NBR AND INCREMENT08190000
082000******************************************************************08200000
082100 7000-MAX-PL-LNE-NBR.                                             08210000
082200     MOVE '7000-MAX-PL-LNE-NBR'   TO PV-PARAGRAPH-NAME            08220000
082300                                                                  08230000
082400                                                                  08240000
082500     EXEC SQL                                                     08250000
082600          SELECT   MAX(PL_LNE_NBR)                                08260012
082700            INTO  :PV-PL-LNE-NBR :PV-NULL-IND-3                   08270012
082800            FROM   TCEPLIT                                        08280012
082900           WHERE   CNSTK_REQ_PL_NBR  =  :PV-CNSTK-REQ-PL-NBR      08290012
083000     END-EXEC.                                                    08300000
083100                                                                  08310000
083200     EVALUATE TRUE                                                08320000
083300         WHEN SQLCODE = ZERO                                      08330000
083400         WHEN SQLCODE = +100                                      08340000
083500              ADD 1 TO PV-PL-LNE-NBR                              08350000
083600              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08360000
083700                                                                  08370012
083800         WHEN SQLCODE = -911                                      08380000
083810         WHEN SQLCODE = -913                                      08381015
083900              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08390000
084000              SET PS-SQL-ERROR-YES TO TRUE                        08400000
084100                                                                  08410012
084200         WHEN OTHER                                               08420000
084300              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08430000
084400              SET PS-SQL-ERROR-YES TO TRUE                        08440000
084500                                                                  08450012
084600     END-EVALUATE.                                                08460000
084700                                                                  08470000
084800     IF PS-DISPLAY-YES                                            08480000
084900         MOVE SQLCODE         TO PV-SQLCODE-OUT                   08490000
085000         STRING 'MAX LINE SQL:'                                   08500021
085100                PV-SQLCODE-OUT             DELIMITED BY SIZE      08510021
085200                                      INTO PV-INFO-LINE           08520000
085300         MOVE '7000-MAX-PL-LNE-NBR ' TO PV-PARAGRAPH-NAME         08530000
085400         PERFORM 9900-DISPLAY-PARAMETERS                          08540008
085410         MOVE  PV-PL-LNE-NBR  TO  PV-DISP-LINE                    08541025
085420         DISPLAY 'CEKSP003-MAX LINE '                             08542041
085430                 'LOC:' PV-CNSTK-LOC-ID ' '                       08543025
085440                 'PULL:' PV-CNSTK-REQ-PL-NBR ' '                  08544025
085450                 'LINE:' PV-DISP-LINE        ' '                  08545025
085460                 'ITM_NBR:' PV-ITM-NBR ' '                        08546025
085470                 'SQL:'     PV-SQLCODE-OUT                        08547025
085480         DISPLAY ' '                                              08548025
085500     END-IF.                                                      08550000
085600                                                                  08560000
085700                                                                  08570012
085800******************************************************************08580008
085900*                                                                *08590008
086000******************************************************************08600008
086100 7050-SELECT-ITEM-NUMBER.                                         08610000
086200                                                                  08620012
086300     MOVE '7050-SELECT-ITEM-NUMBER' TO PV-PARAGRAPH-NAME          08630000
086400                                                                  08640000
086500     EXEC SQL                                                     08650000
086600             SELECT   DISTINCT                                    08660012
086700                      ITM_NBR                                     08670012
086800                     ,INTR_UPC_ID                                 08680012
086900               INTO                                               08690012
087000                     :PV-ITM-NBR                                  08700012
087100                    ,:XLT00003-INTR-UPC-ID                        08710012
087200               FROM                                               08720012
087300                      XLT_SKU                                     08730012
087400              WHERE   SKU_NBR   =  :PV-SKU                        08740012
087410              WITH UR                                             08741019
087500     END-EXEC.                                                    08750000
087600                                                                  08760000
087700     EVALUATE TRUE                                                08770000
087800         WHEN SQLCODE = ZERO                                      08780000
087900             MOVE ZERO         TO LS-OUT-MESSAGE-CODE             08790000
088000                                                                  08800012
088100         WHEN SQLCODE = +100                                      08810000
088110              MOVE 0 TO PV-ITM-NBR                                08811034
088120                        XLT00003-INTR-UPC-ID                      08812034
088130              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08813034
088140              MOVE PV-SKU  TO PV-DISP-SKU                         08814034
088150              DISPLAY 'CEKSP003 - UNKNOWN SKU:'                   08815041
088160                       PV-DISP-SKU                                08816034
088170                       '  PULL:'                                  08817034
088180                       PV-DISP-PULL                               08818035
088190              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08819034
088191                                                                  08819134
088200         WHEN SQLCODE = -911                                      08820000
088210         WHEN SQLCODE = -913                                      08821015
088300              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08830000
088400                                                                  08840012
088500         WHEN OTHER                                               08850000
088600              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             08860000
088700     END-EVALUATE.                                                08870000
088800                                                                  08880012
088900     IF PS-DISPLAY-YES                                            08890000
089000         MOVE SQLCODE          TO PV-SQLCODE-OUT                  08900012
089100         STRING 'SELECT ITEM SQL:'                                08910021
089200                PV-SQLCODE-OUT    DELIMITED BY SIZE               08920021
089300                             INTO PV-INFO-LINE                    08930021
089400         MOVE '7050-SELECT-ITEM-NUMBER' TO PV-PARAGRAPH-NAME      08940000
089500         PERFORM 9900-DISPLAY-PARAMETERS                          08950008
089600     END-IF.                                                      08960000
089700                                                                  08970000
089800                                                                  08980012
089900******************************************************************08990008
090000*                                                                *09000008
090100******************************************************************09010008
090200 7100-SELECT-UNIT-RETAIL.                                         09020000
090300                                                                  09030012
090400     MOVE '7100-SELECT-UNIT-RETAIL' TO PV-PARAGRAPH-NAME          09040000
090500                                                                  09050000
090600     EXEC SQL                                                     09060000
090700          SELECT  DISTINCT                                        09070012
090800                  UNT_RTL_AMT                                     09080012
090900                , GP_QTY                                          09090012
091000                , GP_AMT                                          09100012
091100            INTO                                                  09110012
091200                 :XLV00002-UNT-RTL-AMT                            09120012
091300                ,:XLV00002-GP-QTY                                 09130012
091400                ,:XLV00002-GP-AMT                                 09140012
091500            FROM                                                  09150012
091600                  XLV_SKU_STR                                     09160012
091700           WHERE STR_NBR       = 0                                09170012
091800             AND INTR_UPC_ID   = :XLT00003-INTR-UPC-ID            09180012
091810            WITH UR                                               09181019
091900     END-EXEC.                                                    09190000
092000                                                                  09200000
092100     EVALUATE TRUE                                                09210000
092200         WHEN SQLCODE = ZERO                                      09220000
092300                                                                  09230012
092400           MOVE ZERO         TO LS-OUT-MESSAGE-CODE               09240000
092500           IF  XLV00002-GP-QTY > 1                                09250012
092600               COMPUTE PV-UNT-RTL-AMT  =                          09260012
092700                       XLV00002-GP-AMT / XLV00002-GP-QTY          09270012
092800           ELSE                                                   09280000
092900               MOVE  XLV00002-UNT-RTL-AMT                         09290012
093000                 TO  PV-UNT-RTL-AMT                               09300000
093100           END-IF                                                 09310000
093200                                                                  09320012
093300     END-EVALUATE.                                                09330000
093400                                                                  09340000
093500     EVALUATE TRUE                                                09350000
093600         WHEN SQLCODE = ZERO                                      09360000
093700             MOVE ZERO         TO LS-OUT-MESSAGE-CODE             09370000
093800                                                                  09380012
093900         WHEN SQLCODE = +100                                      09390000
094000         WHEN SQLCODE = -911                                      09400000
094010         WHEN SQLCODE = -913                                      09401015
094100              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             09410000
094200                                                                  09420012
094300         WHEN OTHER                                               09430000
094400              MOVE SQLCODE     TO LS-OUT-MESSAGE-CODE             09440000
094500     END-EVALUATE.                                                09450000
094600                                                                  09460012
094700     IF PS-DISPLAY-YES                                            09470000
094800         MOVE SQLCODE          TO PV-SQLCODE-OUT                  09480012
094900         STRING 'SELECT RETAIL SQL:'                              09490021
095000                PV-SQLCODE-OUT    DELIMITED BY SIZE               09500021
095100                             INTO PV-INFO-LINE                    09510021
095200                                                                  09520000
095300         MOVE '7100-SELECT-UNIT-RETAIL' TO PV-PARAGRAPH-NAME      09530000
095400         PERFORM 9900-DISPLAY-PARAMETERS                          09540008
095500     END-IF.                                                      09550000
095600                                                                  09560008
095700******************************************************************09570008
095800*                                                                *09580008
095900******************************************************************09590008
096000 9900-DISPLAY-PARAMETERS.                                         09600000
096100                                                                  09610000
096200     EXEC SQL                                                     09620000
096300         SET :PV-DB2-TIMESTAMP      = CURRENT TIMESTAMP           09630000
096400     END-EXEC.                                                    09640000
096500                                                                  09650000
096600     DISPLAY ' '.                                                 09660000
096700     DISPLAY '* CEKSP003: ' PV-DB2-TIMESTAMP                      09670021
096800             '-'            PV-PARAGRAPH-NAME                     09680021
096900             '-'            PV-INFO-LINE.                         09690021
097100     DISPLAY ' '.                                                 09710000
097110                                                                  09711021
097200     MOVE SPACES TO PV-INFO-LINE.                                 09720000
097300                                                                  09730000
097400******************************************************************09740000
097500*      Z900-DISPLAY-SQL-ERROR                                     09750008
097600*  ==> PROCESSES:                                                 09760008
097700*      - DISPLAYS THE SQL ERROR                                   09770008
097800*      - SETS THE SWITCH TO INDICATE THAT THERE IS AN ABEND/E     09780008
097900*        SITUATION                                                09790008
098000******************************************************************09800000
098100 Z900-DISPLAY-SQL-ERROR.                                          09810000
098200                                                                  09820000
098300     MOVE PC-PROGRAM-NAME      TO MSG-STORED-PROCEDURE-NAME.      09830000
098400     MOVE PV-SKU               TO MSG-SKU.                        09840000
098500     DISPLAY MSG-ERROR-DISPLAY '**  PARAGRAPH **  = '             09850000
098600             PV-PARAGRAPH-NAME.                                   09860000
098700     DISPLAY 'PV-CNSTK-REQ-PL-NBR='     PV-CNSTK-REQ-PL-NBR.      09870000
098800     DISPLAY ' PV-PL-LNE-NB='           PV-PL-LNE-NBR.            09880000
098900     DISPLAY ' PV-ITM-NBR='             PV-ITM-NBR.               09890000
099000     DISPLAY ' PV-REQ-PL-QTY='          PV-REQ-PL-QTY.            09900000
099100     DISPLAY ' PV-UNT-RTL-AMT='         PV-UNT-RTL-AMT.           09910000
099200                                                                  09920000
099300     MOVE SQLCODE                     TO PV-HOLD-SQLCODE.         09930000
099400     DISPLAY ' SQLCODE     = '  PV-HOLD-SQLCODE.                  09940000
099500     SET PS-ABEND                  TO TRUE.                       09950000
099600                                                                  09960000
099700*************************************************************     09970008
099800** THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STAT     09980008
099900** MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        09990008
100000** 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABL     10000008
100100** FORMAT.                                                        10010008
100200*************************************************************     10020008
100300           COPY DPPD004.                                          10030000
100400                                                                  10040000
