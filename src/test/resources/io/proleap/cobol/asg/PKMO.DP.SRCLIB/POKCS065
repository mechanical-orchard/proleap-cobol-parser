00001 *-----------------------*                                         07/10/95
00002  IDENTIFICATION DIVISION.                                         POKCS065
00003 *-----------------------*                                            LV002
00004  PROGRAM-ID.    POKCS065.                                         POKCS065
00005  AUTHOR.        TIM SMITH.                                        POKCS065
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          POKCS065
00007  DATE-WRITTEN.  09-27-94.                                         POKCS065
00008  DATE-COMPILED.                                                   POKCS065
00009                                                                   POKCS065
00010 *---------------------------------------------------------------* POKCS065
00011 *    W065 - RECEIPT AGING LIST.                                 * POKCS065
00012 *                                                               * POKCS065
00013 *    THIS PROGRAM LISTS IN-PROCESS RECEIVERS BASED ON CRITERIA  * POKCS065
00014 *    SPECIFIED IN THE CRIT SPEC(POKCS064).                      * POKCS065
00015 *---------------------------------------------------------------* POKCS065
C98147*    11/07/14   LINDA FRIESS       TKMA394     CHG0098147                 
C98147*    EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA.                  
C98147*---------------------------------------------------------------*         
076319* DATE  10/27/2021                                                        
076320*            - CHANGE CALL OF 'DPKUT100' TO                     *         
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 *         
076322*              MAKING THE CALL DYNAMIC VS STATIC                *         
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126                
076312*                                                               *         
076318*---------------------------------------------------------------*         
CICS  *  CHANGED 11/14/2022    BY BARB SCHULTZ    WR: CHG0278485                
CICS  *                                                               *         
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   *         
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    *         
CICS  *---------------------------------------------------------------*         
00016  EJECT                                                            POKCS065
00017  ENVIRONMENT DIVISION.                                            POKCS065
00018                                                                   POKCS065
00019  DATA DIVISION.                                                   POKCS065
00020                                                                   POKCS065
00021  WORKING-STORAGE SECTION.                                         POKCS065
00022                                                                   POKCS065
00023  01  DK-DB2-KEYS.                                                 POKCS065
00024      15  DK-DMM-LNAME                   PIC  X(18)  VALUE SPACES. POKCS065
00025      15  DK-DMM-FNAME                   PIC  X(12)  VALUE SPACES. POKCS065
00026      15  DK-BUYER-LNAME                 PIC  X(18)  VALUE SPACES. POKCS065
00027      15  DK-BUYER-FNAME                 PIC  X(12)  VALUE SPACES. POKCS065
00028      15  DK-DEPT-NBR                    PIC  X(03)  VALUE SPACE.  POKCS065
00029      15  DK-PO-NBR                      PIC S9(09)  VALUE +0      POKCS065
00030                                                     COMP.         POKCS065
00031      15  DK-REC-SEQ-NBR                 PIC S9(09)  VALUE +0      POKCS065
00032                                                     COMP.         POKCS065
00033      15  DK-DMA-NBR                     PIC  X(02)  VALUE SPACE.  POKCS065
00034      15  DK-DAYS1                       PIC S9(09)  VALUE +0      POKCS065
00035                                                     COMP-3.       POKCS065
00036      15  DK-DAYS2                       PIC S9(09)  VALUE +0      POKCS065
00037                                                     COMP-3.       POKCS065
00038      15  DK-MDSEAR-DKEY                 PIC S9(06)  VALUE +0      POKCS065
00039                                                     COMP-3.       POKCS065
00040                                                                   POKCS065
00041  01  PC-PROGRAM-CONSTANTS.                                        POKCS065
00042      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         POKCS065
00043                                                     'PO065A  '.   POKCS065
00044      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         POKCS065
00045                                                     'POKM065 '.   POKCS065
00046      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         POKCS065
00047                                                     'POKCS065'.   POKCS065
00048      05  PC-DEFAULT-TIMESTAMP           PIC  X(26)  VALUE         POKCS065
00049          '9999-09-09-09.09.09.999999'.                               CL**2
00050      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      POKCS065
00051      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      POKCS065
00052      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    POKCS065
00053      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     POKCS065
00054                                                     COMP SYNC.    POKCS065
00055      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      POKCS065
00056                                                     COMP SYNC.    POKCS065
00057      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         POKCS065
00058                                                     +1000000      POKCS065
00059                                                     COMP-3.       POKCS065
00060      05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      POKCS065
00061                                                     COMP SYNC.    POKCS065
00062      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       POKCS065
00063                                                     COMP-3.       POKCS065
00064      05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    POKCS065
00065      05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  POKCS065
00066      05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  POKCS065
00067      05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  POKCS065
00068      05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  POKCS065
00069 *                                                                 POKCS065
00070      05  PC-TSYMSG-NUMBERS.                                       POKCS065
00071          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  POKCS065
00072          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  POKCS065
00073          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  POKCS065
00074          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  POKCS065
00075          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  POKCS065
00076          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  POKCS065
00077          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  POKCS065
00078          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  POKCS065
00079          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  POKCS065
00080          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  POKCS065
00081          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  POKCS065
00082          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  POKCS065
00083          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  POKCS065
00084          10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00279.  POKCS065
00085          10  PC-TSYMSG-00733            PIC  9(05)  VALUE 00733.  POKCS065
00086          10  PC-TSYMSG-00960            PIC  9(05)  VALUE 00960.  POKCS065
00087          10  PC-TSYMSG-00962            PIC  9(05)  VALUE 00962.  POKCS065
00088          10  PC-TSYMSG-00963            PIC  9(05)  VALUE 00963.  POKCS065
00089          10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  POKCS065
00090 *                                                                 POKCS065
00091  01  PS-PROGRAM-SWITCHES.                                         POKCS065
00092      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    POKCS065
00093          88  PS-NO-ERROR                            VALUE 'Y'.    POKCS065
00094          88  PS-ERROR                               VALUE 'N'.    POKCS065
00095      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    POKCS065
00096          88  PS-COMMAREA-VALID                      VALUE 'Y'.    POKCS065
00097          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    POKCS065
00098      05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    POKCS065
00099          88  PS-DONE                                VALUE 'Y'.    POKCS065
00100          88  PS-NOT-DONE                            VALUE 'N'.    POKCS065
00101 *                                                                 POKCS065
00102  01  PV-PROGRAM-VARIABLES.                                        POKCS065
00103      05  PV-SUB                         PIC S9(04)  VALUE +0      POKCS065
00104                                                     COMP SYNC.    POKCS065
00105      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      POKCS065
00106                                                     COMP SYNC.    POKCS065
00107      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      POKCS065
00108                                                     COMP-3.       POKCS065
00109      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      POKCS065
00110                                                     COMP-3.       POKCS065
00111      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      POKCS065
00112                                                     COMP-3.       POKCS065
00113      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      POKCS065
00114                                                     COMP-3.       POKCS065
00115      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      POKCS065
00116                                                     COMP-3.       POKCS065
00117      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      POKCS065
00118                                                     COMP-3.       POKCS065
00119      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      POKCS065
00120                                                     COMP-3.       POKCS065
00121      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      POKCS065
00122                                                     COMP SYNC.    POKCS065
00123      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      POKCS065
00124                                                     COMP SYNC.    POKCS065
00125      05  PV-ITEM                        PIC S9(04)  VALUE +0      POKCS065
00126                                                     COMP SYNC.    POKCS065
00127      05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      POKCS065
00128                                                     COMP SYNC.    POKCS065
00129      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      POKCS065
00130                                                     COMP SYNC.    POKCS065
00131      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      POKCS065
00132                                                     COMP SYNC.    POKCS065
00133      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      POKCS065
00134                                                     COMP SYNC.    POKCS065
00135      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      POKCS065
00136                                                     COMP SYNC.    POKCS065
00137      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      POKCS065
00138                                                     COMP SYNC.    POKCS065
00139      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      POKCS065
00140                                                     COMP SYNC.    POKCS065
00141      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      POKCS065
00142                                                     COMP SYNC.    POKCS065
00143      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      POKCS065
00144                                                     COMP SYNC.    POKCS065
00145      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      POKCS065
00146                                                     COMP SYNC.    POKCS065
00147      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      POKCS065
00148                                                     COMP SYNC.    POKCS065
00149      05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      POKCS065
00150                                                     COMP SYNC.    POKCS065
00151      05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      POKCS065
00152                                                     COMP SYNC.    POKCS065
00153      05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      POKCS065
00154                                                     COMP-3.       POKCS065
00155      05  PV-DAYS-IN-DC                  PIC S9(09)  VALUE +0      POKCS065
00156                                                     COMP-3.       POKCS065
00157      05  PV-UNITS                       PIC S9(09)  VALUE +0      POKCS065
00158                                                     COMP.         POKCS065
00159      05  PV-NUM3                        PIC 9(03)   VALUE 0.      POKCS065
C98147     05  PV-NUM8                        PIC 9(08)   VALUE 0.      POKCS065
00161      05  PV-DATE.                                                 POKCS065
00162          10  PV-DATE-CC                 PIC X(02)   VALUE SPACES. POKCS065
00163          10  PV-DATE-YY                 PIC X(02)   VALUE SPACES. POKCS065
00164          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00165          10  PV-DATE-MM                 PIC X(02)   VALUE SPACES. POKCS065
00166          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00167          10  PV-DATE-DD                 PIC X(02)   VALUE SPACES. POKCS065
00168      05  PV-TMST.                                                 POKCS065
00169          10  PV-TMST-CC                 PIC X(02)   VALUE SPACES. POKCS065
00170          10  PV-TMST-YY                 PIC X(02)   VALUE SPACES. POKCS065
00171          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00172          10  PV-TMST-MM                 PIC X(02)   VALUE SPACES. POKCS065
00173          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00174          10  PV-TMST-DD                 PIC X(02)   VALUE SPACES. POKCS065
00175          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00176          10  PV-TMST-HH                 PIC X(02)   VALUE SPACES. POKCS065
00177          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00178          10  PV-TMST-MI                 PIC X(02)   VALUE SPACES. POKCS065
00179          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00180          10  PV-TMST-SS                 PIC X(02)   VALUE SPACES. POKCS065
00181          10  FILLER                     PIC X(01)   VALUE SPACES. POKCS065
00182          10  PV-TMST-NN                 PIC X(06)   VALUE SPACES. POKCS065
00183 ******************************************************************POKCS065
00184 **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **POKCS065
00185 **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **POKCS065
00186 **  APPLICATION-SPECIFIC COMMAREA.                              **POKCS065
00187 ******************************************************************POKCS065
00188  01  LQW-LIST-QUEUE-WORK-AREA.                                    POKCS065
00189      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  POKCS065
00190      05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           POKCS065
00191                                         INDEXED BY LQW-IDX.       POKCS065
00192          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       POKCS065
00193          10  LQW-DAYS                   PIC  9(03).               POKCS065
00194          10  LQW-REC-DATE               PIC  X(06).               POKCS065
00195          10  LQW-DC                     PIC  X(03).               POKCS065
00196          10  LQW-DPT                    PIC  X(03).               POKCS065
C98147         10  LQW-PO                     PIC  9(08).               POKCS065
00198          10  LQW-REC-SEQ                PIC  X(03).               POKCS065
00199          10  LQW-VENDOR                 PIC  X(10).               POKCS065
00200          10  LQW-SHIP-DATE              PIC  X(06).               POKCS065
00201          10  LQW-CAN-DATE               PIC  X(06).               POKCS065
00202          10  LQW-CARTONS                PIC  9(04).               POKCS065
00203          10  LQW-UNITS                  PIC  9(05).               POKCS065
00204          10  LQW-TROUBLE                PIC  X(01).               POKCS065
00205                                                                   POKCS065
00206      EJECT                                                        POKCS065
00207 *---------------------------------------------------------------* POKCS065
00208 *    MAP LAYOUT                                                 * POKCS065
00209 *---------------------------------------------------------------* POKCS065
00210                                                                   POKCS065
00211      COPY POKM065.                                                POKCS065
00212 *                                                                 POKCS065
00213  01  MR-OCCURS-LAYOUT                   REDEFINES  PO065AO.       POKCS065
00214      05  FILLER                         PIC X(42).                POKCS065
00215      05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          POKCS065
00216                                                                   POKCS065
00217          10  MR-DAYSL                   PIC S9(04) COMP.          POKCS065
00218          10  MR-DAYSA                   PIC  X(01).               POKCS065
00219          10  MR-DAYSC                   PIC  X(01).               POKCS065
00220          10  MR-DAYSH                   PIC  X(01).               POKCS065
00221          10  MR-DAYS-X.                                           POKCS065
00222              15  MR-DAYS                PIC  ZZ9.                 POKCS065
00223                                                                   POKCS065
00224          10  MR-REC-DATEL               PIC S9(04) COMP.          POKCS065
00225          10  MR-REC-DATEA               PIC  X(01).               POKCS065
00226          10  MR-REC-DATEC               PIC  X(01).               POKCS065
00227          10  MR-REC-DATEH               PIC  X(01).               POKCS065
00228          10  MR-REC-DATE                PIC  X(06).               POKCS065
00229                                                                   POKCS065
00230          10  MR-DCL                     PIC S9(04) COMP.          POKCS065
00231          10  MR-DCA                     PIC  X(01).               POKCS065
00232          10  MR-DCC                     PIC  X(01).               POKCS065
00233          10  MR-DCH                     PIC  X(01).               POKCS065
00234          10  MR-DC                      PIC  X(03).               POKCS065
00235                                                                   POKCS065
00236          10  MR-DPTL                    PIC S9(04) COMP.          POKCS065
00237          10  MR-DPTA                    PIC  X(01).               POKCS065
00238          10  MR-DPTC                    PIC  X(01).               POKCS065
00239          10  MR-DPTH                    PIC  X(01).               POKCS065
00240          10  MR-DPT                     PIC  X(03).               POKCS065
00241                                                                   POKCS065
00242          10  MR-POL                     PIC S9(04) COMP.          POKCS065
00243          10  MR-POA                     PIC  X(01).               POKCS065
00244          10  MR-POC                     PIC  X(01).               POKCS065
00245          10  MR-POH                     PIC  X(01).               POKCS065
00246          10  MR-PO-X.                                             POKCS065
C98147             15  MR-PO                  PIC  ZZZZZZZ9.            POKCS065
00248                                                                   POKCS065
00249          10  MR-RECL                    PIC S9(04) COMP.          POKCS065
00250          10  MR-RECA                    PIC  X(01).               POKCS065
00251          10  MR-RECC                    PIC  X(01).               POKCS065
00252          10  MR-RECH                    PIC  X(01).               POKCS065
00253          10  MR-REC-X.                                            POKCS065
00254              15  MR-REC                 PIC  ZZ9.                 POKCS065
00255                                                                   POKCS065
00256          10  MR-VNDL                    PIC S9(04) COMP.          POKCS065
00257          10  MR-VNDA                    PIC  X(01).               POKCS065
00258          10  MR-VNDC                    PIC  X(01).               POKCS065
00259          10  MR-VNDH                    PIC  X(01).               POKCS065
00260          10  MR-VND                     PIC  X(10).               POKCS065
00261                                                                   POKCS065
00262          10  MR-SHIP-DATEL              PIC S9(04) COMP.          POKCS065
00263          10  MR-SHIP-DATEA              PIC  X(01).               POKCS065
00264          10  MR-SHIP-DATEC              PIC  X(01).               POKCS065
00265          10  MR-SHIP-DATEH              PIC  X(01).               POKCS065
00266          10  MR-SHIP-DATE               PIC  X(06).               POKCS065
00267                                                                   POKCS065
00268          10  MR-CAN-DATEL               PIC S9(04) COMP.          POKCS065
00269          10  MR-CAN-DATEA               PIC  X(01).               POKCS065
00270          10  MR-CAN-DATEC               PIC  X(01).               POKCS065
00271          10  MR-CAN-DATEH               PIC  X(01).               POKCS065
00272          10  MR-CAN-DATE                PIC  X(06).               POKCS065
00273                                                                   POKCS065
00281          10  MR-UNTSL                   PIC S9(04) COMP.          POKCS065
00282          10  MR-UNTSA                   PIC  X(01).               POKCS065
00283          10  MR-UNTSC                   PIC  X(01).               POKCS065
00284          10  MR-UNTSH                   PIC  X(01).               POKCS065
00285          10  MR-UNTS-X.                                           POKCS065
00286              15  MR-UNTS                PIC  ZZZZ9.               POKCS065
00287                                                                   POKCS065
00288          10  MR-TRBL                    PIC S9(04) COMP.          POKCS065
00289          10  MR-TRBA                    PIC  X(01).               POKCS065
00290          10  MR-TRBC                    PIC  X(01).               POKCS065
00291          10  MR-TRBH                    PIC  X(01).               POKCS065
00292          10  MR-TRB                     PIC  X(01).               POKCS065
                                                                                
00288          10  MR-PCKTL                   PIC S9(04) COMP.          POKCS065
00289          10  MR-PCKTA                   PIC  X(01).               POKCS065
00290          10  MR-PCKTC                   PIC  X(01).               POKCS065
00291          10  MR-PCKTH                   PIC  X(01).               POKCS065
00292          10  MR-PCKT                    PIC  X(01).               POKCS065
00293      EJECT                                                        POKCS065
00294 *---------------------------------------------------------------* POKCS065
00295 *    ATTRIBUTE SETTINGS COPYBOOK.                               * POKCS065
00296 *---------------------------------------------------------------* POKCS065
00297                                                                   POKCS065
00298      COPY DPWS015.                                                POKCS065
00299                                                                   POKCS065
00300 *---------------------------------------------------------------* POKCS065
00301 *    FUNCTION KEYS COPYBOOK.                                    * POKCS065
00302 *---------------------------------------------------------------* POKCS065
00303                                                                   POKCS065
00304      COPY DPWS016.                                                POKCS065
00305                                                                   POKCS065
00306 *---------------------------------------------------------------* POKCS065
00307 *    NUMERIC EDIT LAYOUT.                                       * POKCS065
00308 *---------------------------------------------------------------* POKCS065
00309                                                                   POKCS065
00310      COPY DPWS010I.                                               POKCS065
00311  EJECT                                                            POKCS065
00312 *---------------------------------------------------------------* POKCS065
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * POKCS065
00314 *---------------------------------------------------------------* POKCS065
00315                                                                   POKCS065
00316      COPY DPWS030.                                                POKCS065
CICS       COPY DPWS930.                                                POKCS065
00317  EJECT                                                            POKCS065
00318 *---------------------------------------------------------------* POKCS065
00319 *    STANDARD COMMAREA.                                         * POKCS065
00320 *---------------------------------------------------------------* POKCS065
00321                                                                   POKCS065
00322      COPY DPWS020.                                                POKCS065
00323      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                POKCS065
00324                                                                   POKCS065
00325 *---------------------------------------------------------------* POKCS065
00326 * INTER-APPLICATION COMMAREA.                                   * POKCS065
00327 *---------------------------------------------------------------* POKCS065
00328                                                                   POKCS065
00329          10  INTER-APPL-COMM-AREA       PIC X(200).               POKCS065
00330      COPY POWS064.                                                POKCS065
00331 *---------------------------------------------------------------* POKCS065
00332 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * POKCS065
00333 *---------------------------------------------------------------* POKCS065
00334          10  ASC-SPECIFIC-COMMAREA.                               POKCS065
00335              15  ASC-LIST-KEYS.                                   POKCS065
00336                  20  ASC-KEY-DMM-LNAME               PIC  X(18).  POKCS065
00337                  20  ASC-KEY-DMM-FNAME               PIC  X(12).  POKCS065
00338                  20  ASC-KEY-BUYER-LNAME             PIC  X(18).  POKCS065
00339                  20  ASC-KEY-BUYER-FNAME             PIC  X(12).  POKCS065
00340                  20  ASC-KEY-DEPT-NBR                PIC  X(03).  POKCS065
00341                  20  ASC-KEY-DAYS1                   PIC  9(03).  POKCS065
00342                  20  ASC-KEY-DAYS2                   PIC  9(03).  POKCS065
00343              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                POKCS065
00344                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  POKCS065
00345                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   POKCS065
00346                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   POKCS065
00347                                                                   POKCS065
00348                  20  ASC-ITEM-ARRAY.                              POKCS065
00349                      25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        POKCS065
00350                          30  ASC-LIST-ITEM-NUMBER                 POKCS065
00351                                                      PIC S9(09)   POKCS065
00352                                                      COMP-3.      POKCS065
00353                          30  ASC-DAYS                PIC  9(03).  POKCS065
00354                          30  ASC-REC-DATE.                        POKCS065
00355                              40  ASC-REC-DATE-MM     PIC  X(02).  POKCS065
00356                              40  ASC-REC-DATE-DD     PIC  X(02).  POKCS065
00357                              40  ASC-REC-DATE-YY     PIC  X(02).  POKCS065
00358                          30  ASC-DC                  PIC  X(03).  POKCS065
00359                          30  ASC-DPT                 PIC  X(03).  POKCS065
C98147                         30  ASC-PO                  PIC  9(08).  POKCS065
00361                          30  ASC-REC-SEQ             PIC  X(03).  POKCS065
00362                          30  ASC-VENDOR              PIC  X(10).  POKCS065
00363                          30  ASC-SHIP-DATE.                       POKCS065
00364                              40  ASC-SHIP-DATE-MM    PIC  X(02).  POKCS065
00365                              40  ASC-SHIP-DATE-DD    PIC  X(02).  POKCS065
00366                              40  ASC-SHIP-DATE-YY    PIC  X(02).  POKCS065
00367                          30  ASC-CAN-DATE.                        POKCS065
00368                              40  ASC-CAN-DATE-MM     PIC  X(02).  POKCS065
00369                              40  ASC-CAN-DATE-DD     PIC  X(02).  POKCS065
00370                              40  ASC-CAN-DATE-YY     PIC  X(02).  POKCS065
00372                          30  ASC-UNITS               PIC  9(05).  POKCS065
00373                          30  ASC-TROUBLE             PIC  X(01).  POKCS065
                               30  ASC-PACK-TYP            PIC  X(01).          
00374                                                                   POKCS065
00375              15  ASC-BLK-SUB                         PIC S9(04)   POKCS065
00376                                                           COMP    POKCS065
00377                                                           SYNC.   POKCS065
00378              15  ASC-ITEM-SUB                        PIC S9(04)   POKCS065
00379                                                           COMP    POKCS065
00380                                                           SYNC.   POKCS065
00381              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   POKCS065
00382                                                           COMP-3. POKCS065
00383              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   POKCS065
00384                                                           COMP-3. POKCS065
00385              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   POKCS065
00386                                                           COMP-3. POKCS065
00387              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   POKCS065
00388                                                           COMP-3. POKCS065
00389              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   POKCS065
00390                                                           COMP    POKCS065
00391                                                           SYNC.   POKCS065
00392              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  POKCS065
00393                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   POKCS065
00394                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   POKCS065
00395              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  POKCS065
00396                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   POKCS065
00397                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   POKCS065
00398              15  ASC-LIST-QUEUE-NAME.                             POKCS065
00399                  20  ASC-LIST-TERM-ID                PIC  X(04).  POKCS065
00400                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   POKCS065
00401                                                           COMP-3. POKCS065
00402                  20  ASC-LIST-SEQ                    PIC  9(01).  POKCS065
00403              15  ASC-SEL-QUEUE-NAME.                              POKCS065
00404                  20  ASC-SEL-TERM-ID                 PIC  X(04).  POKCS065
00405                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)   POKCS065
00406                                                           COMP-3. POKCS065
00407                  20  ASC-SEL-SEQ                     PIC  9(01).  POKCS065
00408                                                                   POKCS065
00409              15  ASC-CURSOR-SW                       PIC  X(01).  POKCS065
00410                  88  ASC-NO-CURSOR                   VALUE 'Z'.   POKCS065
00411                  88  ASC-DMM-CURSOR                  VALUE 'D'.   POKCS065
00412                  88  ASC-BUYER-CURSOR                VALUE 'B'.   POKCS065
00413                  88  ASC-DEPT-CURSOR                 VALUE 'P'.   POKCS065
00414              15  ASC-START-ITEM-REQUEST.                          POKCS065
00415                  20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  POKCS065
00416              15  ASC-MDSEAR-DKEY                     PIC S9(06)   POKCS065
00417                                                      COMP-3.      POKCS065
00418      EJECT                                                        POKCS065
00419 *---------------------------------------------------------------* POKCS065
00420 *    ABEND PROCESSING COPYBOOK.                                 * POKCS065
00421 *---------------------------------------------------------------* POKCS065
00422                                                                   POKCS065
00423      COPY DPWS013.                                                POKCS065
00424                                                                   POKCS065
00425  EJECT                                                            POKCS065
00426 *---------------------------------------------------------------* POKCS065
00427 *    DB2 AREA FOR TRECEIV                                       * POKCS065
00428 *---------------------------------------------------------------* POKCS065
00429      EXEC SQL                                                     POKCS065
00430           INCLUDE TRECEIV                                         POKCS065
00431      END-EXEC.                                                    POKCS065
00432 *---------------------------------------------------------------* POKCS065
00433 *    DB2 AREA FOR TRECITM                                       * POKCS065
00434 *---------------------------------------------------------------* POKCS065
00435      EXEC SQL                                                     POKCS065
00436           INCLUDE TRECITM                                         POKCS065
00437      END-EXEC.                                                    POKCS065
00438 *---------------------------------------------------------------* POKCS065
00439 *    DB2 AREA FOR TPURCHS                                       * POKCS065
00440 *---------------------------------------------------------------* POKCS065
00441      EXEC SQL                                                     POKCS065
00442           INCLUDE TPURCHS                                         POKCS065
00443      END-EXEC.                                                    POKCS065
00444 *---------------------------------------------------------------* POKCS065
00445 *    DB2 AREA FOR TPLNSHP                                       * POKCS065
00446 *---------------------------------------------------------------* POKCS065
00447      EXEC SQL                                                     POKCS065
00448           INCLUDE TPLNSHP                                         POKCS065
00449      END-EXEC.                                                    POKCS065
00450 *---------------------------------------------------------------* POKCS065
00451 *    DB2 AREA FOR TENTNME                                       * POKCS065
00452 *---------------------------------------------------------------* POKCS065
00453      EXEC SQL                                                     POKCS065
00454           INCLUDE TENTNME                                         POKCS065
00455      END-EXEC.                                                    POKCS065
00456 *---------------------------------------------------------------* POKCS065
00457 *    DB2 AREA FOR TMDSEAR                                       * POKCS065
00458 *---------------------------------------------------------------* POKCS065
00459      EXEC SQL                                                     POKCS065
00460           INCLUDE TMDSEAR                                         POKCS065
00461      END-EXEC.                                                    POKCS065
00462 *---------------------------------------------------------------* POKCS065
00463 *    DB2 AREA FOR TRSPBAR                                       * POKCS065
00464 *---------------------------------------------------------------* POKCS065
00465      EXEC SQL                                                     POKCS065
00466           INCLUDE TRSPBAR                                         POKCS065
00467      END-EXEC.                                                    POKCS065
00468 *---------------------------------------------------------------* POKCS065
00469 *    DB2 AREA FOR TWORKER                                       * POKCS065
00470 *---------------------------------------------------------------* POKCS065
00471      EXEC SQL                                                     POKCS065
00472           INCLUDE TWORKER                                         POKCS065
00473      END-EXEC.                                                    POKCS065
00474 *---------------------------------------------------------------* POKCS065
00475 *    DB2 AREA FOR TTRBNTF                                       * POKCS065
00476 *---------------------------------------------------------------* POKCS065
00477      EXEC SQL                                                     POKCS065
00478           INCLUDE TTRBNTF                                         POKCS065
00479      END-EXEC.                                                    POKCS065
00480 *---------------------------------------------------------------* POKCS065
00481 *    DB2 AREA FOR COMMUNICATIONS                                * POKCS065
00482 *---------------------------------------------------------------* POKCS065
00483      EXEC SQL                                                     POKCS065
00484           INCLUDE SQLCA                                           POKCS065
00485      END-EXEC.                                                    POKCS065
00486                                                                   POKCS065
00487 *---------------------------------------------------------------* POKCS065
00488 *    CURSOR WHEN DEPT NUMBER IS ENTERED                         * POKCS065
00489 *---------------------------------------------------------------* POKCS065
00490                                                                   POKCS065
00491      EXEC SQL                                                     POKCS065
00492           DECLARE DEPT-CSR CURSOR                                 POKCS065
00493           FOR SELECT                                              POKCS065
00494               A.ORD_NBR,                                          POKCS065
00495               A.REC_SEQ_NBR,                                      POKCS065
00496               A.CURR_OPER_UNT_ID,                                 POKCS065
00497               A.REC_TMST,                                         POKCS065
00500               A.EXPTED_ITM_QTY,                                   POKCS065
00501               A.ACTL_ITM_QTY,                                     POKCS065
                    B.PKGNG_CDE,                                                
00502               B.DEPT_NBR,                                         POKCS065
00503               C.DONT_SHIP_BEF_DTE,                                POKCS065
00504               C.CAN_IFNOT_SHIP_DTE,                               POKCS065
00505               C.EXT_CAN_DTE,                                      POKCS065
00506               D.ENT_NAME_DESC,                                    POKCS065
00507               DAYS(CURRENT TIMESTAMP) -                           POKCS065
00508               DAYS(A.REC_TMST)                                    POKCS065
00509           FROM                                                    POKCS065
00510                 TRECEIV A,                                        POKCS065
00511                 TPURCHS B,                                        POKCS065
00512                 TPLNSHP C,                                        POKCS065
00513                 TENTNME D                                         POKCS065
00514           WHERE                                                   POKCS065
00515               ((A.REC_TMST + :DK-DAYS2 DAYS) >=                   POKCS065
00516                CURRENT TIMESTAMP)                                 POKCS065
00517             AND ((CURRENT TIMESTAMP - :DK-DAYS1 DAYS) >=          POKCS065
00518                  A.REC_TMST)                                      POKCS065
00519             AND A.REC_TMST < :PC-DEFAULT-TIMESTAMP                POKCS065
00520             AND A.VER_STATUS_CDE = 'A'                            POKCS065
00521             AND A.STATUS_CDE IN ('IP', 'CM')                      POKCS065
00522             AND A.ORD_NBR        = B.PO_NBR                       POKCS065
00523             AND B.VER_STATUS_CDE = 'A'                            POKCS065
00524             AND B.DEPT_NBR       = :DK-DEPT-NBR                   POKCS065
00525             AND B.DIR_STR_IND    = 'N'                            POKCS065
00526             AND B.PO_NBR         = C.PO_NBR                       POKCS065
00527             AND C.VER_STATUS_CDE = 'A'                            POKCS065
00528             AND B.ENT_ID         = D.ENT_ID                       POKCS065
00529             AND D.TYPE_CDE       = '04'                           POKCS065
00530           ORDER BY  13 DESC, 8, 1                                 POKCS065
00531                                                                   POKCS065
00532      END-EXEC.                                                    POKCS065
00533                                                                   POKCS065
00534 *---------------------------------------------------------------* POKCS065
00535 *    CURSOR WHEN DMM NAME IS ENTERED                            * POKCS065
00536 *---------------------------------------------------------------* POKCS065
00537                                                                   POKCS065
00538      EXEC SQL                                                     POKCS065
00539           DECLARE DMM-CSR  CURSOR                                 POKCS065
00540           FOR SELECT                                              POKCS065
00541               A.ORD_NBR,                                          POKCS065
00542               A.REC_SEQ_NBR,                                      POKCS065
00543               A.CURR_OPER_UNT_ID,                                 POKCS065
00544               A.REC_TMST,                                         POKCS065
00547               A.EXPTED_ITM_QTY,                                   POKCS065
00548               A.ACTL_ITM_QTY,                                     POKCS065
                    B.PKGNG_CDE,                                                
00549               B.DEPT_NBR,                                         POKCS065
00550               C.DONT_SHIP_BEF_DTE,                                POKCS065
00551               C.CAN_IFNOT_SHIP_DTE,                               POKCS065
00552               C.EXT_CAN_DTE,                                      POKCS065
00553               D.ENT_NAME_DESC,                                    POKCS065
00554               DAYS(CURRENT TIMESTAMP) -                           POKCS065
00555               DAYS(A.REC_TMST)                                    POKCS065
00556           FROM                                                    POKCS065
00557                 TRECEIV A,                                        POKCS065
00558                 TPURCHS B,                                        POKCS065
00559                 TPLNSHP C,                                        POKCS065
00560                 TENTNME D,                                        POKCS065
00561                 TMDSEAR E                                         POKCS065
00562           WHERE                                                   POKCS065
00563               ((A.REC_TMST + :DK-DAYS2 DAYS) >=                   POKCS065
00564                CURRENT TIMESTAMP)                                 POKCS065
00565             AND ((CURRENT TIMESTAMP - :DK-DAYS1 DAYS) >=          POKCS065
00566                  A.REC_TMST)                                      POKCS065
00567             AND A.REC_TMST < :PC-DEFAULT-TIMESTAMP                POKCS065
00568             AND A.VER_STATUS_CDE = 'A'                            POKCS065
00569             AND A.STATUS_CDE IN ('IP', 'CM')                      POKCS065
00570             AND A.ORD_NBR        = B.PO_NBR                       POKCS065
00571             AND B.VER_STATUS_CDE = 'A'                            POKCS065
00572             AND B.DIR_STR_IND    = 'N'                            POKCS065
00573             AND B.PO_NBR         = C.PO_NBR                       POKCS065
00574             AND C.VER_STATUS_CDE = 'A'                            POKCS065
00575             AND B.ENT_ID         = D.ENT_ID                       POKCS065
00576             AND D.TYPE_CDE       = '04'                           POKCS065
00577             AND E.OPERCO_NBR     = '03'                           POKCS065
00578             AND CURRENT DATE BETWEEN                              POKCS065
00579                 E.STRT_DTE AND E.END_DTE                          POKCS065
00580             AND E.DMA_NBR        = :DK-DMA-NBR                    POKCS065
00581             AND E.MDSELV_CDE     = 'DPT'                          POKCS065
00582             AND E.DEPT_NBR       = B.DEPT_NBR                     POKCS065
00583           ORDER BY  13 DESC, 8, 1                                 POKCS065
00584                                                                   POKCS065
00585      END-EXEC.                                                    POKCS065
00586 *---------------------------------------------------------------* POKCS065
00587 *    CURSOR WHEN BUYER NAME IS ENTERED                          * POKCS065
00588 *---------------------------------------------------------------* POKCS065
00589                                                                   POKCS065
00590      EXEC SQL                                                     POKCS065
00591           DECLARE BUYER-CSR CURSOR                                POKCS065
00592           FOR SELECT                                              POKCS065
00593               A.ORD_NBR,                                          POKCS065
00594               A.REC_SEQ_NBR,                                      POKCS065
00595               A.CURR_OPER_UNT_ID,                                 POKCS065
00596               A.REC_TMST,                                         POKCS065
00599               A.EXPTED_ITM_QTY,                                   POKCS065
00600               A.ACTL_ITM_QTY,                                     POKCS065
                    B.PKGNG_CDE,                                                
00601               B.DEPT_NBR,                                         POKCS065
00602               C.DONT_SHIP_BEF_DTE,                                POKCS065
00603               C.CAN_IFNOT_SHIP_DTE,                               POKCS065
00604               C.EXT_CAN_DTE,                                      POKCS065
00605               D.ENT_NAME_DESC,                                    POKCS065
00606               DAYS(CURRENT TIMESTAMP) -                           POKCS065
00607               DAYS(A.REC_TMST)                                    POKCS065
00608           FROM                                                    POKCS065
00609                 TRECEIV A,                                        POKCS065
00610                 TPURCHS B,                                        POKCS065
00611                 TPLNSHP C,                                        POKCS065
00612                 TENTNME D,                                        POKCS065
00613                 TMDSEAR E,                                        POKCS065
00614                 TRSPBAR F                                         POKCS065
00615           WHERE                                                   POKCS065
00616               ((A.REC_TMST + :DK-DAYS2 DAYS) >=                   POKCS065
00617                CURRENT TIMESTAMP)                                 POKCS065
00618             AND ((CURRENT TIMESTAMP - :DK-DAYS1 DAYS) >=          POKCS065
00619                  A.REC_TMST)                                      POKCS065
00620             AND A.REC_TMST < :PC-DEFAULT-TIMESTAMP                POKCS065
00621             AND A.VER_STATUS_CDE = 'A'                            POKCS065
00622             AND A.STATUS_CDE IN ('IP', 'CM')                      POKCS065
00623             AND A.ORD_NBR        = B.PO_NBR                       POKCS065
00624             AND B.VER_STATUS_CDE = 'A'                            POKCS065
00625             AND B.DIR_STR_IND    = 'N'                            POKCS065
00626             AND B.PO_NBR         = C.PO_NBR                       POKCS065
00627             AND C.VER_STATUS_CDE = 'A'                            POKCS065
00628             AND B.ENT_ID         = D.ENT_ID                       POKCS065
00629             AND D.TYPE_CDE       = '04'                           POKCS065
00630             AND E.OPERCO_NBR     = '03'                           POKCS065
00631             AND CURRENT DATE BETWEEN                              POKCS065
00632                 E.STRT_DTE AND E.END_DTE                          POKCS065
00633             AND E.MDSELV_CDE     = 'DPT'                          POKCS065
00634             AND E.DEPT_NBR       = B.DEPT_NBR                     POKCS065
00635             AND E.MDSEAR_DKEY    = F.MDSEAR_DKEY                  POKCS065
00636             AND F.RSPLVL_CDE     = 'BYR'                          POKCS065
00637             AND F.WORKER_LAST_NAME = :DK-BUYER-LNAME              POKCS065
00638             AND F.WORKER_FIR_NAME LIKE :DK-BUYER-FNAME            POKCS065
00639             AND CURRENT DATE BETWEEN                              POKCS065
00640                 F.WORKER_STRT_DTE AND F.WORKER_END_DTE            POKCS065
00641           ORDER BY  13 DESC, 8, 1                                 POKCS065
00642                                                                   POKCS065
00643      END-EXEC.                                                    POKCS065
00644  EJECT                                                            POKCS065
00645  LINKAGE SECTION.                                                 POKCS065
00646                                                                   POKCS065
00647  01  DFHCOMMAREA.                                                 POKCS065
00648      05  FILLER                         OCCURS  1 TO 4072 TIMES   POKCS065
00649                                         DEPENDING ON EIBCALEN.    POKCS065
00650          10  FILLER                     PIC X.                    POKCS065
00651                                                                   POKCS065
00652  EJECT                                                            POKCS065
00653  PROCEDURE DIVISION.                                              POKCS065
00654 ******************************************************************POKCS065
00655 **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **POKCS065
00656 **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **POKCS065
00657 **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **POKCS065
00658 ******************************************************************POKCS065
00659  0000-MAIN-MODULE.                                                POKCS065
00660      INITIALIZE DP030-CICS-API-FIELDS.                            POKCS065
00661      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       POKCS065
00662      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          POKCS065
00663      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         POKCS065
00664      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       POKCS065
00665      MOVE LENGTH OF PO065AI        TO DP030-MAP-LENGTH (1).       POKCS065
00666      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     POKCS065
00667      PERFORM 0001-CALL-CICS-ARCH-API.                             POKCS065
00668 *                                                                 POKCS065
00669      PERFORM 1000-CONTROL-PROCESSING                              POKCS065
00670 *                                                                 POKCS065
00671      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     POKCS065
00672      PERFORM 0001-CALL-CICS-ARCH-API.                             POKCS065
00673                                                                   POKCS065
00674 ******************************************************************POKCS065
00675 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **POKCS065
00676 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **POKCS065
00677 ******************************************************************POKCS065
00678  0001-CALL-CICS-ARCH-API.                                         POKCS065
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      POKCS065
00680                                     DFHCOMMAREA                   POKCS065
00681                                     DP030-CICS-API-FIELDS         POKCS065
00682                                     DP020-STANDARD-COMMAREA       POKCS065
00683                                     PO065AI.                      POKCS065
00684 *                                                                 POKCS065
00685      IF  DP030-RC-CALL-SUCCESSFUL                                 POKCS065
00686          CONTINUE                                                 POKCS065
00687      ELSE                                                         POKCS065
00688          SET DP013-NO-ROLLBACK                                    POKCS065
00689              DP013-XCTL-DISPLAY-RESTART                           POKCS065
00690              DP013-CICS-ABEND      TO TRUE                        POKCS065
00691          MOVE '0001-CALL-CICS-ARCH-API'                           POKCS065
00692                                    TO DP013-PARAGRAPH             POKCS065
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OPOKCS065
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      POKCS065
00695          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      POKCS065
00696          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
00697      END-IF.                                                      POKCS065
00698 *----------------------------------------------------------------*POKCS065
00699 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *POKCS065
00700 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *POKCS065
00701 *                                                                *POKCS065
00702 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *POKCS065
00703 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *POKCS065
00704 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *POKCS065
00705 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *POKCS065
00706 *----------------------------------------------------------------*POKCS065
00707                                                                   POKCS065
00708  1000-CONTROL-PROCESSING.                                         POKCS065
00709                                                                   POKCS065
00710      EVALUATE TRUE                                                POKCS065
00711          WHEN DP020-NEXT-ACT-INITIAL                              POKCS065
00712              INITIALIZE ASC-SPECIFIC-COMMAREA                     POKCS065
00713              MOVE EIBTRMID         TO ASC-LIST-TERM-ID            POKCS065
00714                                       ASC-SEL-TERM-ID             POKCS065
00715              MOVE DP020-SRC-TASK-NUMBER                           POKCS065
00716                                    TO ASC-LIST-TASK-NUMBER        POKCS065
00717                                       ASC-SEL-TASK-NUMBER         POKCS065
00718              MOVE PC-LIST-QUEUE-SEQ                               POKCS065
00719                                    TO ASC-LIST-SEQ                POKCS065
00720              MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 POKCS065
00721              PERFORM 1100-PROCESS-INTER-APPL-COMM                 POKCS065
00722 ***-----$TEMPLATE NOTE$-------------------------------------------POKCS065
00723 *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,POKCS065
00724 *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  POKCS065
00725 *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.POKCS065
00726 ***---------------------------------------------------------------POKCS065
00727              IF  PS-COMMAREA-NOT-VALID                            POKCS065
00728 ***              MOVE PC-TSYMSG-99901                             POKCS065
00729 ***                                TO DP020-MSG-NUMBER            POKCS065
00730 ***              SET DP020-MSG-FATAL                              POKCS065
00731 ***                                TO TRUE                        POKCS065
00732                  SET DP020-NEXT-ACT-APPL-ERROR                    POKCS065
00733                                    TO TRUE                        POKCS065
00734              ELSE                                                 POKCS065
00735                  PERFORM 4000-BUILD-INITIAL-PANEL                 POKCS065
00736              END-IF                                               POKCS065
00737                                                                   POKCS065
00738          WHEN DP020-NEXT-ACT-READ-MAP                             POKCS065
00739              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        POKCS065
00740                                    TO PV-TOP-ITEM                 POKCS065
00741              PERFORM 2000-PROCESS-PANEL                           POKCS065
00742                                                                   POKCS065
00743          WHEN OTHER                                               POKCS065
00744              SET DP013-LOGIC-ABEND TO TRUE                        POKCS065
00745              SET DP013-NO-ROLLBACK TO TRUE                        POKCS065
00746              MOVE '1000-CONTROL-PROCESSING'                       POKCS065
00747                                    TO DP013-PARAGRAPH             POKCS065
00748              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    POKCS065
00749                                    TO DP013-MESSAGE-TEXT(1)       POKCS065
00750              PERFORM DP013-0000-PROCESS-ABEND                     POKCS065
00751      END-EVALUATE.                                                POKCS065
00752                                                                   POKCS065
00753  EJECT                                                            POKCS065
00754 *----------------------------------------------------------------*POKCS065
00755 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *POKCS065
00756 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *POKCS065
00757 *----------------------------------------------------------------*POKCS065
00758                                                                   POKCS065
00759  1100-PROCESS-INTER-APPL-COMM.                                    POKCS065
00760                                                                   POKCS065
00761      SET PS-COMMAREA-VALID         TO TRUE.                       POKCS065
00762      MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     POKCS065
00763      MOVE PO064-DMM-LNAME          TO ASC-KEY-DMM-LNAME           POKCS065
00764                                       DK-DMM-LNAME.               POKCS065
00765      MOVE PO064-DMM-FNAME          TO ASC-KEY-DMM-FNAME           POKCS065
00766                                       DK-DMM-FNAME.               POKCS065
00767      MOVE PO064-BUYER-LNAME        TO ASC-KEY-BUYER-LNAME         POKCS065
00768                                       DK-BUYER-LNAME.             POKCS065
00769      MOVE PO064-BUYER-FNAME        TO ASC-KEY-BUYER-FNAME         POKCS065
00770                                       DK-BUYER-FNAME.             POKCS065
00771      MOVE PO064-DEPT-NBR           TO ASC-KEY-DEPT-NBR            POKCS065
00772                                       DK-DEPT-NBR.                POKCS065
00773      MOVE PO064-DAYS1              TO ASC-KEY-DAYS1               POKCS065
00774                                       DK-DAYS1.                   POKCS065
00775      IF PO064-DAYS2 = ZERO                                        POKCS065
00776          MOVE 999                  TO DK-DAYS2                    POKCS065
00777                                       ASC-KEY-DAYS2               POKCS065
00778      ELSE                                                         POKCS065
00779          MOVE PO064-DAYS2          TO DK-DAYS2                    POKCS065
00780                                       ASC-KEY-DAYS2               POKCS065
00781      END-IF.                                                      POKCS065
00782 *                                                                 POKCS065
00783      IF PO064-DEPT-NBR  > SPACES                                  POKCS065
00784          PERFORM 1130-VALIDATE-DEPT                               POKCS065
00785          IF  PV-DB2-COUNT = +0                                    POKCS065
00786              MOVE PC-TSYMSG-00588                                 POKCS065
00787                                  TO DP020-MSG-NUMBER              POKCS065
00788              SET PS-ERROR                                         POKCS065
00789                  PS-COMMAREA-NOT-VALID                            POKCS065
00790                  DP020-MSG-FATAL TO TRUE                          POKCS065
00791          END-IF                                                   POKCS065
00792      END-IF.                                                      POKCS065
00793 *                                                                 POKCS065
00794      IF PO064-DMM-LNAME > SPACES                                  POKCS065
00795          IF PO064-DMM-FNAME > SPACES                              POKCS065
00796              PERFORM 1140-VALIDATE-DMM-FULL-NAME                  POKCS065
00797              IF  SQLCODE = +100                                   POKCS065
00798                  MOVE PC-TSYMSG-00733                             POKCS065
00799                                  TO DP020-MSG-NUMBER              POKCS065
00800                  SET PS-ERROR                                     POKCS065
00801                      PS-COMMAREA-NOT-VALID                        POKCS065
00802                      DP020-MSG-FATAL TO TRUE                      POKCS065
00803              ELSE                                                 POKCS065
00804                  MOVE RSPBAR-MDSEAR-DKEY TO ASC-MDSEAR-DKEY       POKCS065
00805                                             DK-MDSEAR-DKEY        POKCS065
00806              END-IF                                               POKCS065
00807          ELSE                                                     POKCS065
00808              PERFORM 1150-VALIDATE-DMM-LAST-NAME                  POKCS065
00809              IF  PV-DB2-COUNT = +0                                POKCS065
00810                  MOVE PC-TSYMSG-00733                             POKCS065
00811                                  TO DP020-MSG-NUMBER              POKCS065
00812                  SET PS-ERROR                                     POKCS065
00813                      PS-COMMAREA-NOT-VALID                        POKCS065
00814                      DP020-MSG-FATAL TO TRUE                      POKCS065
00815              ELSE                                                 POKCS065
00816                  IF PV-DB2-COUNT > +1                             POKCS065
00817                      MOVE PC-TSYMSG-00960                         POKCS065
00818                                  TO DP020-MSG-NUMBER              POKCS065
00819                      SET PS-ERROR                                 POKCS065
00820                          PS-COMMAREA-NOT-VALID                    POKCS065
00821                          DP020-MSG-FATAL TO TRUE                  POKCS065
00822                  ELSE                                             POKCS065
00823                      PERFORM 1180-GET-MDSEAR-DKEY                 POKCS065
00824                      MOVE RSPBAR-MDSEAR-DKEY TO ASC-MDSEAR-DKEY   POKCS065
00825                                                 DK-MDSEAR-DKEY    POKCS065
00826                  END-IF                                           POKCS065
00827              END-IF                                               POKCS065
00828          END-IF                                                   POKCS065
00829      END-IF.                                                      POKCS065
00830 *                                                                 POKCS065
00831      IF PO064-BUYER-LNAME > SPACES                                POKCS065
00832          IF PO064-BUYER-FNAME > SPACES                            POKCS065
00833              PERFORM 1160-VALIDATE-BUYER-FULL-NAME                POKCS065
00834              IF  PV-DB2-COUNT = 0                                 POKCS065
00835                  MOVE PC-TSYMSG-00962                             POKCS065
00836                                  TO DP020-MSG-NUMBER              POKCS065
00837                  SET PS-ERROR                                     POKCS065
00838                      PS-COMMAREA-NOT-VALID                        POKCS065
00839                      DP020-MSG-FATAL TO TRUE                      POKCS065
00840              END-IF                                               POKCS065
00841          ELSE                                                     POKCS065
00842              PERFORM 1170-VALIDATE-BUYER-LAST-NAME                POKCS065
00843              IF  PV-DB2-COUNT = +0                                POKCS065
00844                  MOVE PC-TSYMSG-00962                             POKCS065
00845                                  TO DP020-MSG-NUMBER              POKCS065
00846                  SET PS-ERROR                                     POKCS065
00847                      PS-COMMAREA-NOT-VALID                        POKCS065
00848                      DP020-MSG-FATAL TO TRUE                      POKCS065
00849              ELSE                                                 POKCS065
00850                  IF PV-DB2-COUNT > +1                             POKCS065
00851                      MOVE PC-TSYMSG-00963                         POKCS065
00852                                  TO DP020-MSG-NUMBER              POKCS065
00853                      SET PS-ERROR                                 POKCS065
00854                          PS-COMMAREA-NOT-VALID                    POKCS065
00855                          DP020-MSG-FATAL TO TRUE                  POKCS065
00856                  END-IF                                           POKCS065
00857              END-IF                                               POKCS065
00858          END-IF                                                   POKCS065
00859      END-IF.                                                      POKCS065
00860                                                                   POKCS065
00861 *----------------------------------------------------------------*POKCS065
00862 * VALIDATE THE DEPT NUMBER PASSED FROM THE CRIT SPEC.            *POKCS065
00863 *----------------------------------------------------------------*POKCS065
00864  1130-VALIDATE-DEPT.                                              POKCS065
00865                                                                   POKCS065
00866      MOVE +0                    TO PV-DB2-COUNT.                  POKCS065
00867                                                                   POKCS065
00868      PERFORM                                                      POKCS065
00869          WITH TEST AFTER                                          POKCS065
00870          VARYING PV-RETRY-COUNTER                                 POKCS065
00871          FROM 1 BY 1                                              POKCS065
00872          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
00873              OR (SQLCODE = +0)                                    POKCS065
00874              OR (SQLCODE = +100))                                 POKCS065
00875                                                                   POKCS065
00876          EXEC SQL                                                 POKCS065
00877               SELECT COUNT(*)                                     POKCS065
00878                 INTO :PV-DB2-COUNT                                POKCS065
00879                 FROM TMDSEAR                                      POKCS065
00880                WHERE DEPT_NBR   = :DK-DEPT-NBR                    POKCS065
00881                  AND OPERCO_NBR = '03'                            POKCS065
00882                  AND MDSELV_CDE = 'DPT'                           POKCS065
00883                  AND STRT_DTE  <= CURRENT DATE                    POKCS065
00884                  AND END_DTE   >= CURRENT DATE                    POKCS065
00885          END-EXEC                                                 POKCS065
00886                                                                   POKCS065
00887          EVALUATE TRUE                                            POKCS065
00888              WHEN SQLCODE = +0                                    POKCS065
00889              WHEN SQLCODE = +100                                  POKCS065
00890              WHEN SQLCODE = -904                                  POKCS065
00891              WHEN SQLCODE = -913                                  POKCS065
00892                   CONTINUE                                        POKCS065
00893                                                                   POKCS065
00894              WHEN SQLWARN0 NOT = SPACES                           POKCS065
00895              WHEN SQLCODE < +0                                    POKCS065
00896              WHEN SQLCODE > +0                                    POKCS065
00897                   MOVE '1130-VALIDATE-DEPT'                       POKCS065
00898                                   TO DP013-PARAGRAPH              POKCS065
00899                   MOVE 'UNSUCCESSFUL COUNT ON DEPARTMENT'         POKCS065
00900                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
00901                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
00902                   MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
00903                   SET DP013-DB2-ABEND                             POKCS065
00904                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
00905                                   TO TRUE                         POKCS065
00906                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
00907          END-EVALUATE                                             POKCS065
00908      END-PERFORM.                                                 POKCS065
00909                                                                   POKCS065
00910      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
00911          MOVE '1130-VALIDATE-DEPT'                                POKCS065
00912                                   TO DP013-PARAGRAPH              POKCS065
00913          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TMDSEAR'          POKCS065
00914                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
00915          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
00916          MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
00917          SET DP013-DB2-ABEND                                      POKCS065
00918              DP013-XCTL-DISPLAY-RESTART                           POKCS065
00919                                   TO TRUE                         POKCS065
00920          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
00921      END-IF.                                                      POKCS065
00922                                                                   POKCS065
00923 *----------------------------------------------------------------*POKCS065
00924 * VALIDATE THE DMM NAME (FIRST AND LAST NAME)                    *POKCS065
00925 *----------------------------------------------------------------*POKCS065
00926  1140-VALIDATE-DMM-FULL-NAME.                                     POKCS065
00927                                                                   POKCS065
00928      PERFORM                                                      POKCS065
00929          WITH TEST AFTER                                          POKCS065
00930          VARYING PV-RETRY-COUNTER                                 POKCS065
00931          FROM 1 BY 1                                              POKCS065
00932          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
00933              OR (SQLCODE = +0)                                    POKCS065
00934              OR (SQLCODE = +100))                                 POKCS065
00935                                                                   POKCS065
00936          EXEC SQL                                                 POKCS065
00937               SELECT MDSEAR_DKEY                                  POKCS065
00938                 INTO :RSPBAR-MDSEAR-DKEY                          POKCS065
00939                 FROM TRSPBAR                                      POKCS065
00940                WHERE OPERCO_NBR = '03'                            POKCS065
00941                  AND WORKER_LAST_NAME = :DK-DMM-LNAME             POKCS065
00942                  AND WORKER_FIR_NAME  = :DK-DMM-FNAME             POKCS065
00943                  AND RSPLVL_CDE = 'DMM'                           POKCS065
00944                  AND CURRENT DATE BETWEEN                         POKCS065
00945                      WORKER_STRT_DTE AND                          POKCS065
00946                      WORKER_END_DTE                               POKCS065
00947          END-EXEC                                                 POKCS065
00948                                                                   POKCS065
00949          EVALUATE TRUE                                            POKCS065
00950              WHEN SQLCODE = +0                                    POKCS065
00951              WHEN SQLCODE = +100                                  POKCS065
00952              WHEN SQLCODE = -904                                  POKCS065
00953              WHEN SQLCODE = -913                                  POKCS065
00954                   CONTINUE                                        POKCS065
00955                                                                   POKCS065
00956              WHEN SQLWARN0 NOT = SPACES                           POKCS065
00957              WHEN SQLCODE < +0                                    POKCS065
00958              WHEN SQLCODE > +0                                    POKCS065
00959                   MOVE '1140-VALIDATE-DMM-FULL-NAME'              POKCS065
00960                                   TO DP013-PARAGRAPH              POKCS065
00961                   MOVE 'UNSUCCESSFUL COUNT ON TRSPBAR'            POKCS065
00962                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
00963                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
00964                   MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
00965                   SET DP013-DB2-ABEND                             POKCS065
00966                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
00967                                   TO TRUE                         POKCS065
00968                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
00969          END-EVALUATE                                             POKCS065
00970      END-PERFORM.                                                 POKCS065
00971                                                                   POKCS065
00972      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
00973          MOVE '1140-VALIDATE-DMM-FULL-NAME'                       POKCS065
00974                                   TO DP013-PARAGRAPH              POKCS065
00975          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TRSPBAR'          POKCS065
00976                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
00977          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
00978          MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
00979          SET DP013-DB2-ABEND                                      POKCS065
00980              DP013-XCTL-DISPLAY-RESTART                           POKCS065
00981                                   TO TRUE                         POKCS065
00982          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
00983      END-IF.                                                      POKCS065
00984                                                                   POKCS065
00985 *----------------------------------------------------------------*POKCS065
00986 * VALIDATE THE DMM NAME (LAST NAME ONLY)                         *POKCS065
00987 *----------------------------------------------------------------*POKCS065
00988  1150-VALIDATE-DMM-LAST-NAME.                                     POKCS065
00989                                                                   POKCS065
00990      MOVE +0                      TO PV-DB2-COUNT.                POKCS065
00991                                                                   POKCS065
00992      PERFORM                                                      POKCS065
00993          WITH TEST AFTER                                          POKCS065
00994          VARYING PV-RETRY-COUNTER                                 POKCS065
00995          FROM 1 BY 1                                              POKCS065
00996          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
00997              OR (SQLCODE = +0)                                    POKCS065
00998              OR (SQLCODE = +100))                                 POKCS065
00999                                                                   POKCS065
01000          EXEC SQL                                                 POKCS065
01001               SELECT COUNT(*)                                     POKCS065
01002                 INTO :PV-DB2-COUNT                                POKCS065
01003                 FROM TRSPBAR                                      POKCS065
01004                WHERE OPERCO_NBR = '03'                            POKCS065
01005                  AND WORKER_LAST_NAME = :DK-DMM-LNAME             POKCS065
01006                  AND RSPLVL_CDE = 'DMM'                           POKCS065
01007                  AND CURRENT DATE BETWEEN                         POKCS065
01008                      WORKER_STRT_DTE AND                          POKCS065
01009                      WORKER_END_DTE                               POKCS065
01010          END-EXEC                                                 POKCS065
01011                                                                   POKCS065
01012          EVALUATE TRUE                                            POKCS065
01013              WHEN SQLCODE = +0                                    POKCS065
01014              WHEN SQLCODE = +100                                  POKCS065
01015              WHEN SQLCODE = -904                                  POKCS065
01016              WHEN SQLCODE = -913                                  POKCS065
01017                   CONTINUE                                        POKCS065
01018                                                                   POKCS065
01019              WHEN SQLWARN0 NOT = SPACES                           POKCS065
01020              WHEN SQLCODE < +0                                    POKCS065
01021              WHEN SQLCODE > +0                                    POKCS065
01022                   MOVE '1150-VALIDATE-DMM-LAST-NAME'              POKCS065
01023                                   TO DP013-PARAGRAPH              POKCS065
01024                   MOVE 'UNSUCCESSFUL COUNT ON TRSPBAR'            POKCS065
01025                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01026                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
01027                   MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
01028                   SET DP013-DB2-ABEND                             POKCS065
01029                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
01030                                   TO TRUE                         POKCS065
01031                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
01032          END-EVALUATE                                             POKCS065
01033      END-PERFORM.                                                 POKCS065
01034                                                                   POKCS065
01035      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
01036          MOVE '1150-VALIDATE-DMM-LAST-NAME'                       POKCS065
01037                                   TO DP013-PARAGRAPH              POKCS065
01038          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TRSPBAR'          POKCS065
01039                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01040          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
01041          MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
01042          SET DP013-DB2-ABEND                                      POKCS065
01043              DP013-XCTL-DISPLAY-RESTART                           POKCS065
01044                                   TO TRUE                         POKCS065
01045          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01046      END-IF.                                                      POKCS065
01047 *----------------------------------------------------------------*POKCS065
01048 * VALIDATE THE BUYER NAME (FIRST AND LAST NAME)                  *POKCS065
01049 *----------------------------------------------------------------*POKCS065
01050  1160-VALIDATE-BUYER-FULL-NAME.                                   POKCS065
01051                                                                   POKCS065
01052      MOVE +0                     TO PV-DB2-COUNT                  POKCS065
01053                                                                   POKCS065
01054      PERFORM                                                      POKCS065
01055          WITH TEST AFTER                                          POKCS065
01056          VARYING PV-RETRY-COUNTER                                 POKCS065
01057          FROM 1 BY 1                                              POKCS065
01058          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
01059              OR (SQLCODE = +0)                                    POKCS065
01060              OR (SQLCODE = +100))                                 POKCS065
01061                                                                   POKCS065
01062          EXEC SQL                                                 POKCS065
01063               SELECT COUNT(*)                                     POKCS065
01064                 INTO :PV-DB2-COUNT                                POKCS065
01065                 FROM TRSPBAR                                      POKCS065
01066                WHERE OPERCO_NBR = '03'                            POKCS065
01067                  AND RSPLVL_CDE = 'BYR'                           POKCS065
01068                  AND WORKER_LAST_NAME = :DK-BUYER-LNAME           POKCS065
01069                  AND WORKER_FIR_NAME  = :DK-BUYER-FNAME           POKCS065
01070                  AND CURRENT DATE BETWEEN                         POKCS065
01071                      WORKER_STRT_DTE AND                          POKCS065
01072                      WORKER_END_DTE                               POKCS065
01073          END-EXEC                                                 POKCS065
01074                                                                   POKCS065
01075          EVALUATE TRUE                                            POKCS065
01076              WHEN SQLCODE = +0                                    POKCS065
01077              WHEN SQLCODE = +100                                  POKCS065
01078              WHEN SQLCODE = -904                                  POKCS065
01079              WHEN SQLCODE = -913                                  POKCS065
01080                   CONTINUE                                        POKCS065
01081                                                                   POKCS065
01082              WHEN SQLWARN0 NOT = SPACES                           POKCS065
01083              WHEN SQLCODE < +0                                    POKCS065
01084              WHEN SQLCODE > +0                                    POKCS065
01085                   MOVE '1160-VALIDATE-BUYER-FULL-NAME'            POKCS065
01086                                   TO DP013-PARAGRAPH              POKCS065
01087                   MOVE 'UNSUCCESSFUL COUNT ON TRSPBAR'            POKCS065
01088                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01089                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
01090                   MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
01091                   SET DP013-DB2-ABEND                             POKCS065
01092                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
01093                                   TO TRUE                         POKCS065
01094                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
01095          END-EVALUATE                                             POKCS065
01096      END-PERFORM.                                                 POKCS065
01097                                                                   POKCS065
01098      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
01099          MOVE '1160-VALIDATE-BUYER-FULL-NAME'                     POKCS065
01100                                   TO DP013-PARAGRAPH              POKCS065
01101          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TRSPBAR'          POKCS065
01102                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01103          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
01104          MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
01105          SET DP013-DB2-ABEND                                      POKCS065
01106              DP013-XCTL-DISPLAY-RESTART                           POKCS065
01107                                   TO TRUE                         POKCS065
01108          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01109      END-IF.                                                      POKCS065
01110                                                                   POKCS065
01111 *----------------------------------------------------------------*POKCS065
01112 * VALIDATE THE BUYER NAME (LAST NAME).                           *POKCS065
01113 *----------------------------------------------------------------*POKCS065
01114  1170-VALIDATE-BUYER-LAST-NAME.                                   POKCS065
01115                                                                   POKCS065
01116      MOVE +0                     TO PV-DB2-COUNT                  POKCS065
01117                                                                   POKCS065
01118      PERFORM                                                      POKCS065
01119          WITH TEST AFTER                                          POKCS065
01120          VARYING PV-RETRY-COUNTER                                 POKCS065
01121          FROM 1 BY 1                                              POKCS065
01122          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
01123              OR (SQLCODE = +0)                                    POKCS065
01124              OR (SQLCODE = +100))                                 POKCS065
01125                                                                   POKCS065
01126          EXEC SQL                                                 POKCS065
01127               SELECT COUNT(DISTINCT(WORKER_NBR))                  POKCS065
01128                 INTO :PV-DB2-COUNT                                POKCS065
01129                 FROM TRSPBAR                                      POKCS065
01130                WHERE OPERCO_NBR = '03'                            POKCS065
01131                  AND RSPLVL_CDE = 'BYR'                           POKCS065
01132                  AND WORKER_LAST_NAME = :DK-BUYER-LNAME           POKCS065
01133                  AND CURRENT DATE BETWEEN                         POKCS065
01134                      WORKER_STRT_DTE AND                          POKCS065
01135                      WORKER_END_DTE                               POKCS065
01136          END-EXEC                                                 POKCS065
01137                                                                   POKCS065
01138          EVALUATE TRUE                                            POKCS065
01139              WHEN SQLCODE = +0                                    POKCS065
01140              WHEN SQLCODE = +100                                  POKCS065
01141              WHEN SQLCODE = -904                                  POKCS065
01142              WHEN SQLCODE = -913                                  POKCS065
01143                   CONTINUE                                        POKCS065
01144                                                                   POKCS065
01145              WHEN SQLWARN0 NOT = SPACES                           POKCS065
01146              WHEN SQLCODE < +0                                    POKCS065
01147              WHEN SQLCODE > +0                                    POKCS065
01148                   MOVE '1170-VALIDATE-BUYER-LAST-NAME'            POKCS065
01149                                   TO DP013-PARAGRAPH              POKCS065
01150                   MOVE 'UNSUCCESSFUL COUNT ON TRSPBAR'            POKCS065
01151                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01152                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
01153                   MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
01154                   SET DP013-DB2-ABEND                             POKCS065
01155                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
01156                                   TO TRUE                         POKCS065
01157                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
01158          END-EVALUATE                                             POKCS065
01159      END-PERFORM.                                                 POKCS065
01160                                                                   POKCS065
01161      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
01162          MOVE '1170-VALIDATE-BUYER-LAST-NAME'                     POKCS065
01163                                   TO DP013-PARAGRAPH              POKCS065
01164          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TRSPBAR'          POKCS065
01165                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01166          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
01167          MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
01168          SET DP013-DB2-ABEND                                      POKCS065
01169              DP013-XCTL-DISPLAY-RESTART                           POKCS065
01170                                   TO TRUE                         POKCS065
01171          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01172      END-IF.                                                      POKCS065
01173 *----------------------------------------------------------------*POKCS065
01174 * RETRIEVE THE MERCHANDISE AREA DB KEY, USED TO RETRIEVE THE     *POKCS065
01175 * DMA NUMBER.                                                    *POKCS065
01176 *----------------------------------------------------------------*POKCS065
01177  1180-GET-MDSEAR-DKEY.                                            POKCS065
01178                                                                   POKCS065
01179      MOVE +0                      TO PV-DB2-COUNT.                POKCS065
01180                                                                   POKCS065
01181      PERFORM                                                      POKCS065
01182          WITH TEST AFTER                                          POKCS065
01183          VARYING PV-RETRY-COUNTER                                 POKCS065
01184          FROM 1 BY 1                                              POKCS065
01185          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
01186              OR (SQLCODE = +0)                                    POKCS065
01187              OR (SQLCODE = +100))                                 POKCS065
01188                                                                   POKCS065
01189          EXEC SQL                                                 POKCS065
01190               SELECT MDSEAR_DKEY                                  POKCS065
01191                 INTO :RSPBAR-MDSEAR-DKEY                          POKCS065
01192                 FROM TRSPBAR                                      POKCS065
01193                WHERE OPERCO_NBR = '03'                            POKCS065
01194                  AND WORKER_LAST_NAME = :DK-DMM-LNAME             POKCS065
01195                  AND RSPLVL_CDE = 'DMM'                           POKCS065
01196                  AND CURRENT DATE BETWEEN                         POKCS065
01197                      WORKER_STRT_DTE AND                          POKCS065
01198                      WORKER_END_DTE                               POKCS065
01199          END-EXEC                                                 POKCS065
01200                                                                   POKCS065
01201          EVALUATE TRUE                                            POKCS065
01202              WHEN SQLCODE = +0                                    POKCS065
01203              WHEN SQLCODE = +100                                  POKCS065
01204              WHEN SQLCODE = -904                                  POKCS065
01205              WHEN SQLCODE = -913                                  POKCS065
01206                   CONTINUE                                        POKCS065
01207                                                                   POKCS065
01208              WHEN SQLWARN0 NOT = SPACES                           POKCS065
01209              WHEN SQLCODE < +0                                    POKCS065
01210              WHEN SQLCODE > +0                                    POKCS065
01211                   MOVE '1180-GET-MDSEAR-DKEY'                     POKCS065
01212                                   TO DP013-PARAGRAPH              POKCS065
01213                   MOVE 'UNSUCCESSFUL COUNT ON TRSPBAR'            POKCS065
01214                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01215                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
01216                   MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
01217                   SET DP013-DB2-ABEND                             POKCS065
01218                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
01219                                   TO TRUE                         POKCS065
01220                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
01221          END-EVALUATE                                             POKCS065
01222      END-PERFORM.                                                 POKCS065
01223                                                                   POKCS065
01224      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
01225          MOVE '1180-GET-MDSEAR-DKEY'                              POKCS065
01226                                   TO DP013-PARAGRAPH              POKCS065
01227          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TRSPBAR'          POKCS065
01228                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01229          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
01230          MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
01231          SET DP013-DB2-ABEND                                      POKCS065
01232              DP013-XCTL-DISPLAY-RESTART                           POKCS065
01233                                   TO TRUE                         POKCS065
01234          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01235      END-IF.                                                      POKCS065
01236                                                                   POKCS065
01237  EJECT                                                            POKCS065
01238 *----------------------------------------------------------------*POKCS065
01239 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *POKCS065
01240 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *POKCS065
01241 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *POKCS065
01242 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *POKCS065
01243 * FUNCTION KEYS CAN GET THIS FAR.                                *POKCS065
01244 *----------------------------------------------------------------*POKCS065
01245                                                                   POKCS065
01246  2000-PROCESS-PANEL.                                              POKCS065
01247      EVALUATE TRUE                                                POKCS065
01248          WHEN DP020-SRC-AID = DP016-CLEAR                         POKCS065
01249              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    POKCS065
01250              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS065
01251                                                                   POKCS065
01252          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    POKCS065
01253              MOVE ASC-KEY-DMM-LNAME                               POKCS065
01254                                    TO DK-DMM-LNAME                POKCS065
01255              MOVE ASC-KEY-DMM-FNAME                               POKCS065
01256                                    TO DK-DMM-FNAME                POKCS065
01257              MOVE ASC-KEY-BUYER-LNAME                             POKCS065
01258                                    TO DK-BUYER-LNAME              POKCS065
01259              MOVE ASC-KEY-BUYER-FNAME                             POKCS065
01260                                    TO DK-BUYER-FNAME              POKCS065
01261              MOVE ASC-KEY-DEPT-NBR TO DK-DEPT-NBR                 POKCS065
01262              MOVE ASC-KEY-DAYS1    TO DK-DAYS1                    POKCS065
01263              MOVE ASC-KEY-DAYS2    TO DK-DAYS2                    POKCS065
01264              MOVE ASC-MDSEAR-DKEY  TO DK-MDSEAR-DKEY              POKCS065
01265              PERFORM 2050-DELETE-LIST-QUEUE                       POKCS065
01266              PERFORM 4000-BUILD-INITIAL-PANEL                     POKCS065
01267                                                                   POKCS065
01268          WHEN OTHER                                               POKCS065
01269              IF  PS-NO-ERROR                                      POKCS065
01270                  SET DP030-CONTINUE-GO                            POKCS065
01271                                  TO TRUE                          POKCS065
01272                  PERFORM 2100-CHECK-FUNCTION-KEY                  POKCS065
01273              ELSE                                                 POKCS065
01274                  SET DP030-OVERRIDE-GO                            POKCS065
01275                                  TO TRUE                          POKCS065
01276              END-IF                                               POKCS065
01277      END-EVALUATE.                                                POKCS065
01278  EJECT                                                            POKCS065
01279 *----------------------------------------------------------------*POKCS065
01280 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *POKCS065
01281 *----------------------------------------------------------------*POKCS065
01282  2050-DELETE-LIST-QUEUE.                                          POKCS065
01283                                                                   POKCS065
01284      EXEC CICS                                                    POKCS065
01285          DELETEQ TS                                               POKCS065
01286              QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS065
01287              RESP  (PV-CICS-RESP)                                 POKCS065
01288      END-EXEC.                                                    POKCS065
01289                                                                   POKCS065
01290      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       POKCS065
01291         (PV-CICS-RESP = DFHRESP(QIDERR))                          POKCS065
01292          CONTINUE                                                 POKCS065
01293      ELSE                                                         POKCS065
01294          SET DP013-CICS-ABEND      TO TRUE                        POKCS065
01295          SET DP013-NO-ROLLBACK     TO TRUE                        POKCS065
01296                                                                   POKCS065
01297          MOVE '2050-DELETE-LIST-QUEUE'                            POKCS065
01298                                    TO DP013-PARAGRAPH             POKCS065
01299          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    POKCS065
01300                                    TO DP013-MESSAGE-TEXT (1)      POKCS065
01301          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01302      END-IF.                                                      POKCS065
01303                                                                   POKCS065
01304      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  POKCS065
01305  EJECT                                                            POKCS065
01306 *----------------------------------------------------------------*POKCS065
01307 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*POKCS065
01308 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *POKCS065
01309 * CICS ARCHITECTURE API.                                         *POKCS065
01310 *----------------------------------------------------------------*POKCS065
01311  2100-CHECK-FUNCTION-KEY.                                         POKCS065
01312      EVALUATE TRUE                                                POKCS065
01313                                                                   POKCS065
01314          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  POKCS065
01315              MOVE +1               TO PV-TOP-ITEM                 POKCS065
01316              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS065
01317                                                                   POKCS065
01318          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   POKCS065
01319              PERFORM 2110-BROWSE-BACKWARD                         POKCS065
01320              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS065
01321                                                                   POKCS065
01322          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   POKCS065
01323              PERFORM 2120-BROWSE-FORWARD                          POKCS065
01324              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS065
01325                                                                   POKCS065
01326          WHEN DP020-SRC-AID = DP016-ENTER                         POKCS065
01327              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   POKCS065
01328              IF  PS-ERROR                                         POKCS065
01329                  CONTINUE                                         POKCS065
01330              ELSE                                                 POKCS065
01331                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             POKCS065
01332              END-IF                                               POKCS065
01333                                                                   POKCS065
01334          WHEN OTHER                                               POKCS065
01335              SET DP013-NO-ROLLBACK                                POKCS065
01336                  DP013-XCTL-DISPLAY-RESTART                       POKCS065
01337                  DP013-CICS-ABEND  TO TRUE                        POKCS065
01338              MOVE '2100-CHECK-FUNCTION-KEY'                       POKCS065
01339                                    TO DP013-PARAGRAPH             POKCS065
01340              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      POKCS065
01341                                    TO DP013-MESSAGE-TEXT (1)      POKCS065
01342              PERFORM DP013-0000-PROCESS-ABEND                     POKCS065
01343      END-EVALUATE.                                                POKCS065
01344 *                                                                 POKCS065
01345 *----------------------------------------------------------------*POKCS065
01346 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *POKCS065
01347 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *POKCS065
01348 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *POKCS065
01349 *    MESSAGE.                                                    *POKCS065
01350 *----------------------------------------------------------------*POKCS065
01351                                                                   POKCS065
01352  2110-BROWSE-BACKWARD.                                            POKCS065
01353      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    POKCS065
01354          GIVING PV-TOP-ITEM.                                      POKCS065
01355 *                                                                 POKCS065
01356      IF  ((PV-TOP-ITEM < +1)                                      POKCS065
01357        OR (PV-TOP-ITEM = +1))                                     POKCS065
01358          MOVE +1                   TO PV-TOP-ITEM                 POKCS065
01359 *        -- TOP OF LIST --                                        POKCS065
01360          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            POKCS065
01361          SET DP020-MSG-INFORMATIONAL TO TRUE                      POKCS065
01362      END-IF.                                                      POKCS065
01363                                                                   POKCS065
01364  EJECT                                                            POKCS065
01365 *----------------------------------------------------------------*POKCS065
01366 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *POKCS065
01367 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *POKCS065
01368 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *POKCS065
01369 *----------------------------------------------------------------*POKCS065
01370                                                                   POKCS065
01371  2120-BROWSE-FORWARD.                                             POKCS065
01372                                                                   POKCS065
01373      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              POKCS065
01374          GIVING PV-TOP-ITEM.                                      POKCS065
01375      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   POKCS065
01376          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            POKCS065
01377                                    TO PV-TOP-ITEM                 POKCS065
01378 *        -- BOTTOM OF LIST --                                     POKCS065
01379          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            POKCS065
01380          SET DP020-MSG-INFORMATIONAL                              POKCS065
01381                                    TO TRUE                        POKCS065
01382      ELSE                                                         POKCS065
01383          COMPUTE PV-BOTTOM-ITEM =                                 POKCS065
01384              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 POKCS065
01385          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            POKCS065
01386 *            -- BOTTOM OF LIST --                                 POKCS065
01387              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            POKCS065
01388              SET DP020-MSG-INFORMATIONAL                          POKCS065
01389                                    TO TRUE                        POKCS065
01390          END-IF                                                   POKCS065
01391      END-IF.                                                      POKCS065
01392  EJECT                                                            POKCS065
01393 *----------------------------------------------------------------*POKCS065
01394 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *POKCS065
01395 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *POKCS065
01396 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *POKCS065
01397 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *POKCS065
01398 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *POKCS065
01399 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *POKCS065
01400 *----------------------------------------------------------------*POKCS065
01401                                                                   POKCS065
01402  2130-CHECK-FOR-JUMP-BROWSE.                                      POKCS065
01403      SET PS-NO-ERROR               TO TRUE.                       POKCS065
01404      IF (ASC-START-ITEM-REQUEST = SPACE)                          POKCS065
01405          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            POKCS065
01406                                    TO PV-TOP-ITEM                 POKCS065
01407      ELSE                                                         POKCS065
01408          MOVE ASC-START-ITEM-REQUEST                              POKCS065
01409                                    TO DP010I-UNEDITED-FIELD       POKCS065
01410          MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       POKCS065
01411          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     POKCS065
01412          SET DP010I-NEGATIVE-NOT-ALLOWED                          POKCS065
01413                                    TO TRUE                        POKCS065
26422          CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
26423                          USING DP010I-NUMERIC-EDIT-AREA                   
01415                                                                   POKCS065
01416          IF  NOT DP010I-ERROR-DETECTED                            POKCS065
01417              MOVE DP010I-NUMERIC-FIELD                            POKCS065
01418                                    TO  ASC-START-ITEM-REQUEST-N   POKCS065
01419              IF  ASC-START-ITEM-REQUEST-N > ZERO                  POKCS065
01420                  IF  ASC-START-ITEM-REQUEST-N >                   POKCS065
01421                                           ASC-NUMBER-OF-ITEMS-READPOKCS065
01422                      MOVE SPACE TO ASC-START-ITEM-REQUEST         POKCS065
01423                      COMPUTE PV-TOP-ITEM =                        POKCS065
01424                              ASC-NUMBER-OF-ITEMS-READ             POKCS065
01425                              - PC-ITEMS-PER-PANEL + 1             POKCS065
01426                      IF  PV-TOP-ITEM < +1                         POKCS065
01427                          MOVE +1   TO PV-TOP-ITEM                 POKCS065
01428                          MOVE PC-TSYMSG-00070                     POKCS065
01429                                    TO DP020-MSG-NUMBER            POKCS065
01430                          SET DP020-MSG-INFORMATIONAL              POKCS065
01431                                    TO TRUE                        POKCS065
01432                      END-IF                                       POKCS065
01433                  ELSE                                             POKCS065
01434                      MOVE ASC-START-ITEM-REQUEST-N                POKCS065
01435                                    TO PV-TOP-ITEM                 POKCS065
01436                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      POKCS065
01437                      COMPUTE PV-BOTTOM-ITEM =                     POKCS065
01438                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     POKCS065
01439                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READPOKCS065
01440 *                        -- BOTTOM OF LIST --                     POKCS065
01441                          MOVE PC-TSYMSG-00070                     POKCS065
01442                                    TO DP020-MSG-NUMBER            POKCS065
01443                          SET DP020-MSG-INFORMATIONAL              POKCS065
01444                                    TO TRUE                        POKCS065
01445                      END-IF                                       POKCS065
01446                  END-IF                                           POKCS065
01447              ELSE                                                 POKCS065
01448 *                --- VALUE OUT OF RANGE ----                      POKCS065
01449                  MOVE PC-TSYMSG-00101                             POKCS065
01450                                    TO DP020-MSG-NUMBER            POKCS065
01451                  MOVE -1           TO ASTRTITL                    POKCS065
01452                  SET DP030-SET-CURSOR-APPL-1                      POKCS065
01453                                    TO TRUE                        POKCS065
01454                  MOVE DP015-REVERSE                               POKCS065
01455                                    TO ASTRTITH                    POKCS065
01456                  MOVE DP015-RED    TO ASTRTITC                    POKCS065
01457                  MOVE DP015-UNP-NUM-BRT-MDT                       POKCS065
01458                                    TO ASTRTITA                    POKCS065
01459                  SET DP020-MSG-FATAL                              POKCS065
01460                                    TO TRUE                        POKCS065
01461                  SET PS-ERROR      TO TRUE                        POKCS065
01462              END-IF                                               POKCS065
01463                                                                   POKCS065
01464          ELSE                                                     POKCS065
01465              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            POKCS065
01466              MOVE -1               TO ASTRTITL                    POKCS065
01467              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  POKCS065
01468              MOVE DP015-REVERSE    TO ASTRTITH                    POKCS065
01469              MOVE DP015-RED        TO ASTRTITC                    POKCS065
01470              MOVE DP015-UNP-NUM-BRT-MDT                           POKCS065
01471                                    TO ASTRTITA                    POKCS065
01472              SET DP020-MSG-FATAL   TO TRUE                        POKCS065
01473              SET PS-ERROR          TO TRUE                        POKCS065
01474          END-IF                                                   POKCS065
01475      END-IF.                                                      POKCS065
01476  EJECT                                                            POKCS065
01477 *----------------------------------------------------------------*POKCS065
01478 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *POKCS065
01479 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*POKCS065
01480 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *POKCS065
01481 *                                                                *POKCS065
01482 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *POKCS065
01483 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *POKCS065
01484 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *POKCS065
01485 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *POKCS065
01486 *----------------------------------------------------------------*POKCS065
01487                                                                   POKCS065
01488  3100-SET-SUBSCRIPTS.                                             POKCS065
01489                                                                   POKCS065
01490      COMPUTE ASC-ITEM-SUB =                                       POKCS065
01491          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        POKCS065
01492                                                                   POKCS065
01493      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         POKCS065
01494          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            POKCS065
01495                                                                   POKCS065
01496          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               POKCS065
01497      ELSE                                                         POKCS065
01498          MOVE +1                     TO ASC-BLK-SUB               POKCS065
01499      END-IF.                                                      POKCS065
01500 ******************************************************************POKCS065
01501 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **POKCS065
01502 ******************************************************************POKCS065
01503                                                                   POKCS065
01504  3200-RESET-ATTRIBUTES.                                           POKCS065
01505      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   POKCS065
01506      MOVE DP015-GREEN              TO ASTRTITC.                   POKCS065
01507      MOVE DP015-UNDERLINE          TO ASTRTITH.                   POKCS065
01508  EJECT                                                            POKCS065
01509 *----------------------------------------------------------------*POKCS065
01510 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *POKCS065
01511 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *POKCS065
01512 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *POKCS065
01513 *    DISPLAY THE PANEL TO USER.                                  *POKCS065
01514 *----------------------------------------------------------------*POKCS065
01515                                                                   POKCS065
01516  4000-BUILD-INITIAL-PANEL.                                        POKCS065
01517                                                                   POKCS065
01518      INITIALIZE                  ASC-BLOCK-ENTRIES (1)            POKCS065
01519                                  ASC-BLOCK-ENTRIES (2).           POKCS065
01520      MOVE +1                 TO ASC-BLK-SUB.                      POKCS065
01521      SET ASC-ITEMS-LEFT-ON-DB                                     POKCS065
01522                              TO TRUE.                             POKCS065
01523                                                                   POKCS065
01524      MOVE +0                 TO ASC-ITEM-SUB                      POKCS065
01525                                 ASC-NUMBER-OF-ITEMS-READ          POKCS065
01526                                 ASC-HIGHEST-BLOCK-WRITTEN         POKCS065
01527                                 ASC-ITEM-AT-TOP-OF-PANEL.         POKCS065
01528      PERFORM 4100-PREPARE-CURSOR                                  POKCS065
01529                                                                   POKCS065
01530      PERFORM 4010-OPEN-CURSOR.                                    POKCS065
01531                                                                   POKCS065
01532      PERFORM 4300-READ-ITEMS-FROM-DB.                             POKCS065
01533                                                                   POKCS065
01534      PERFORM 4020-CLOSE-CURSOR.                                   POKCS065
01535                                                                   POKCS065
01536      MOVE +1                   TO  PV-TOP-ITEM.                   POKCS065
01537      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          POKCS065
01538          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    POKCS065
01539          SET DP020-MSG-FATAL   TO  TRUE                           POKCS065
01540          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               POKCS065
01541      ELSE                                                         POKCS065
01542          MOVE -1               TO MR-DAYSL   (1)                  POKCS065
01543          SET DP030-SET-CURSOR-APPL-1                              POKCS065
01544                                TO TRUE                            POKCS065
01545          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     POKCS065
01546      END-IF.                                                      POKCS065
01547  EJECT                                                            POKCS065
01548 *----------------------------------------------------------------*POKCS065
01549 *----------------------------------------------------------------*POKCS065
01550                                                                   POKCS065
01551  4010-OPEN-CURSOR.                                                POKCS065
01552      PERFORM                                                      POKCS065
01553          WITH TEST AFTER                                          POKCS065
01554          VARYING PV-RETRY-COUNTER                                 POKCS065
01555          FROM 1 BY 1                                              POKCS065
01556          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
01557                    OR (SQLCODE = ZERO))                           POKCS065
01558          EVALUATE TRUE                                            POKCS065
01559              WHEN ASC-DMM-CURSOR                                  POKCS065
01560                  MOVE 'CURSOR:  DMM-CSR'                          POKCS065
01561                                    TO DP013-MESSAGE-TEXT (2)      POKCS065
01562                  EXEC SQL                                         POKCS065
01563                       OPEN DMM-CSR                                POKCS065
01564                  END-EXEC                                         POKCS065
01565                                                                   POKCS065
01566              WHEN ASC-BUYER-CURSOR                                POKCS065
01567                  MOVE 'CURSOR:  BUYER-CSR'                        POKCS065
01568                                    TO DP013-MESSAGE-TEXT (2)      POKCS065
01569                  EXEC SQL                                         POKCS065
01570                       OPEN BUYER-CSR                              POKCS065
01571                  END-EXEC                                         POKCS065
01572                                                                   POKCS065
01573              WHEN ASC-DEPT-CURSOR                                 POKCS065
01574                  MOVE 'CURSOR:  DEPT-CSR'                         POKCS065
01575                                    TO DP013-MESSAGE-TEXT (2)      POKCS065
01576                  EXEC SQL                                         POKCS065
01577                       OPEN DEPT-CSR                               POKCS065
01578                  END-EXEC                                         POKCS065
01579          END-EVALUATE                                             POKCS065
01580                                                                   POKCS065
01581          EVALUATE TRUE                                            POKCS065
01582              WHEN SQLCODE = ZERO                                  POKCS065
01583              WHEN SQLCODE = -904                                  POKCS065
01584              WHEN SQLCODE = -913                                  POKCS065
01585                  CONTINUE                                         POKCS065
01586              WHEN SQLWARN0 NOT = SPACES                           POKCS065
01587              WHEN SQLCODE < ZERO                                  POKCS065
01588              WHEN SQLCODE > ZERO                                  POKCS065
01589                  MOVE '4010-OPEN-CURSOR'                          POKCS065
01590                                    TO DP013-PARAGRAPH             POKCS065
01591                  MOVE 'OPEN CURSOR - '                            POKCS065
01592                                    TO DP013-MESSAGE-TEXT (1)      POKCS065
01593                  MOVE SQLCA        TO DP013-SQLCA                 POKCS065
01594                  MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)    POKCS065
01595                  MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    POKCS065
01596                  MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (3)    POKCS065
01597                  MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)    POKCS065
01598                  SET DP013-DB2-ABEND                              POKCS065
01599                      DP013-XCTL-DISPLAY-RESTART TO TRUE           POKCS065
01600                  PERFORM DP013-0000-PROCESS-ABEND                 POKCS065
01601          END-EVALUATE                                             POKCS065
01602      END-PERFORM.                                                 POKCS065
01603 *                                                                 POKCS065
01604      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
01605          MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             POKCS065
01606          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   POKCS065
01607                                    TO DP013-MESSAGE-TEXT (1)      POKCS065
01608          MOVE SQLCA                TO DP013-SQLCA                 POKCS065
01609          MOVE 'TRECEIV '           TO DP013-DB2-TABLE-NAME (1)    POKCS065
01610          MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (2)    POKCS065
01611          MOVE 'TPLNSHP '           TO DP013-DB2-TABLE-NAME (3)    POKCS065
01612          MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (4)    POKCS065
01613          SET DP013-DB2-ABEND                                      POKCS065
01614              DP013-XCTL-DISPLAY-RESTART                           POKCS065
01615                                    TO TRUE                        POKCS065
01616          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01617      END-IF.                                                      POKCS065
01618                                                                   POKCS065
01619  EJECT                                                            POKCS065
01620 *----------------------------------------------------------------*POKCS065
01621 * CLOSE THE TMESSAGE CURSOR.                                     *POKCS065
01622 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *POKCS065
01623 *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *POKCS065
01624 *   USER.                                                        *POKCS065
01625 *----------------------------------------------------------------*POKCS065
01626                                                                   POKCS065
01627  4020-CLOSE-CURSOR.                                               POKCS065
01628      EVALUATE TRUE                                                POKCS065
01629          WHEN ASC-DMM-CURSOR                                      POKCS065
01630              EXEC SQL                                             POKCS065
01631                  CLOSE DMM-CSR                                    POKCS065
01632              END-EXEC                                             POKCS065
01633                                                                   POKCS065
01634          WHEN ASC-BUYER-CURSOR                                    POKCS065
01635              EXEC SQL                                             POKCS065
01636                  CLOSE BUYER-CSR                                  POKCS065
01637              END-EXEC                                             POKCS065
01638                                                                   POKCS065
01639          WHEN ASC-DEPT-CURSOR                                     POKCS065
01640              EXEC SQL                                             POKCS065
01641                  CLOSE DEPT-CSR                                   POKCS065
01642              END-EXEC                                             POKCS065
01643      END-EVALUATE.                                                POKCS065
01644 *                                                                 POKCS065
01645      EVALUATE TRUE                                                POKCS065
01646          WHEN SQLCODE = ZERO                                      POKCS065
01647              CONTINUE                                             POKCS065
01648          WHEN SQLWARN0 NOT = SPACES                               POKCS065
01649          WHEN SQLCODE < ZERO                                      POKCS065
01650          WHEN SQLCODE > ZERO                                      POKCS065
01651              MOVE '4020-CLOSE-CURSOR'                             POKCS065
01652                                TO DP013-PARAGRAPH                 POKCS065
01653              MOVE 'CLOSE CURSOR '                                 POKCS065
01654                                TO DP013-MESSAGE-TEXT (1)          POKCS065
01655              MOVE SQLCA        TO DP013-SQLCA                     POKCS065
01656              MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        POKCS065
01657              MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)        POKCS065
01658              MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (3)        POKCS065
01659              MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)        POKCS065
01660              SET DP013-DB2-ABEND                                  POKCS065
01661                  DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS065
01662              PERFORM DP013-0000-PROCESS-ABEND                     POKCS065
01663      END-EVALUATE.                                                POKCS065
01664                                                                   POKCS065
01665  EJECT                                                            POKCS065
01666 *----------------------------------------------------------------*POKCS065
01667 *    SET UP THE HOST VARIABLES.                                  *POKCS065
01668 *----------------------------------------------------------------*POKCS065
01669                                                                   POKCS065
01670  4100-PREPARE-CURSOR.                                             POKCS065
01671                                                                   POKCS065
01672      SET ASC-NO-CURSOR         TO TRUE.                           POKCS065
01673                                                                   POKCS065
01674      IF  DK-DMM-LNAME > SPACES                                    POKCS065
01675          SET ASC-DMM-CURSOR    TO TRUE                            POKCS065
01676          PERFORM 4110-GET-DMA-NBR                                 POKCS065
01677          MOVE MDSEAR-DMA-NBR   TO DK-DMA-NBR                      POKCS065
01678      ELSE                                                         POKCS065
01679          IF  DK-BUYER-LNAME > SPACES                              POKCS065
01680              SET ASC-BUYER-CURSOR                                 POKCS065
01681                                TO TRUE                            POKCS065
01682              IF DK-BUYER-FNAME = SPACES                           POKCS065
01683                  MOVE ALL '%'  TO DK-BUYER-FNAME                  POKCS065
01684              END-IF                                               POKCS065
01685          ELSE                                                     POKCS065
01686              SET ASC-DEPT-CURSOR                                  POKCS065
01687                                TO TRUE                            POKCS065
01688          END-IF                                                   POKCS065
01689      END-IF.                                                      POKCS065
01690                                                                   POKCS065
01691 *----------------------------------------------------------------*POKCS065
01692 * RETRIEVE THE DMA NUMBER WHICH IS USED IN DMM-CSR.              *POKCS065
01693 *----------------------------------------------------------------*POKCS065
01694  4110-GET-DMA-NBR.                                                POKCS065
01695                                                                   POKCS065
01696      PERFORM                                                      POKCS065
01697          WITH TEST AFTER                                          POKCS065
01698          VARYING PV-RETRY-COUNTER                                 POKCS065
01699          FROM 1 BY 1                                              POKCS065
01700          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
01701              OR (SQLCODE = +0)                                    POKCS065
01702              OR (SQLCODE = +100))                                 POKCS065
01703                                                                   POKCS065
01704          EXEC SQL                                                 POKCS065
01705               SELECT DMA_NBR                                      POKCS065
01706                 INTO :MDSEAR-DMA-NBR                              POKCS065
01707                 FROM TMDSEAR                                      POKCS065
01708                WHERE OPERCO_NBR = '03'                            POKCS065
01709                  AND MDSEAR_DKEY = :DK-MDSEAR-DKEY                POKCS065
01710                  AND MDSELV_CDE  = 'DMA'                          POKCS065
01711                  AND CURRENT DATE BETWEEN                         POKCS065
01712                      STRT_DTE AND                                 POKCS065
01713                      END_DTE                                      POKCS065
01714          END-EXEC                                                 POKCS065
01715                                                                   POKCS065
01716          EVALUATE TRUE                                            POKCS065
01717              WHEN SQLCODE = +0                                    POKCS065
01718              WHEN SQLCODE = +100                                  POKCS065
01719              WHEN SQLCODE = -904                                  POKCS065
01720              WHEN SQLCODE = -913                                  POKCS065
01721                   CONTINUE                                        POKCS065
01722                                                                   POKCS065
01723              WHEN SQLWARN0 NOT = SPACES                           POKCS065
01724              WHEN SQLCODE < +0                                    POKCS065
01725              WHEN SQLCODE > +0                                    POKCS065
01726                   MOVE '4110-GET-DMA-NBR'                         POKCS065
01727                                   TO DP013-PARAGRAPH              POKCS065
01728                   MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR'           POKCS065
01729                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01730                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
01731                   MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
01732                   SET DP013-DB2-ABEND                             POKCS065
01733                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
01734                                   TO TRUE                         POKCS065
01735                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
01736          END-EVALUATE                                             POKCS065
01737      END-PERFORM.                                                 POKCS065
01738                                                                   POKCS065
01739      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
01740          MOVE '4110-GET-DMA-NBR'                                  POKCS065
01741                                   TO DP013-PARAGRAPH              POKCS065
01742          MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TMDSEAR'         POKCS065
01743                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
01744          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
01745          MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
01746          SET DP013-DB2-ABEND                                      POKCS065
01747              DP013-XCTL-DISPLAY-RESTART                           POKCS065
01748                                   TO TRUE                         POKCS065
01749          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
01750      END-IF.                                                      POKCS065
01751                                                                   POKCS065
01752  EJECT                                                            POKCS065
01753 *----------------------------------------------------------------*POKCS065
01754 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *POKCS065
01755 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *POKCS065
01756 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *POKCS065
01757 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *POKCS065
01758 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *POKCS065
01759 *                                                                *POKCS065
01760 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *POKCS065
01761 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *POKCS065
01762 *    UPON INITIALIZATION.                                        *POKCS065
01763 *----------------------------------------------------------------*POKCS065
01764                                                                   POKCS065
01765  4300-READ-ITEMS-FROM-DB.                                         POKCS065
01766                                                                   POKCS065
01767      PERFORM                                                      POKCS065
01768          VARYING PV-READ-COUNT                                    POKCS065
01769          FROM 1 BY 1                                              POKCS065
01770          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    POKCS065
01771             OR (ASC-NO-ITEMS-LEFT-ON-DB))                         POKCS065
01772                                                                   POKCS065
01773          PERFORM 4310-FETCH                                       POKCS065
01774                                                                   POKCS065
01775          IF  ASC-ITEMS-LEFT-ON-DB                                 POKCS065
01776              IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                POKCS065
01777                  ADD +1            TO ASC-ITEM-SUB                POKCS065
01778              ELSE                                                 POKCS065
01779                  ADD +1            TO ASC-BLK-SUB                 POKCS065
01780                  MOVE +1           TO ASC-ITEM-SUB                POKCS065
01781                                                                   POKCS065
01782                  IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         POKCS065
01783                      MOVE +1       TO ASC-BLK-SUB                 POKCS065
01784                      SET ASC-BLOCK-MODIFIED (1)                   POKCS065
01785                                    TO TRUE                        POKCS065
01786                      PERFORM 5100-WRITE-TEMP-STORAGE              POKCS065
01787                      MOVE ASC-BLOCK-ENTRIES                       POKCS065
01788                                (PC-MAX-BLOCKS-IN-ARRAY)           POKCS065
01789                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) POKCS065
01790                      ADD +1        TO ASC-BLK-SUB                 POKCS065
01791                      INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   POKCS065
01792                      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      POKCS065
01793                                    TO TRUE                        POKCS065
01794                  END-IF                                           POKCS065
01795              END-IF                                               POKCS065
01796              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    POKCS065
01797              MOVE ASC-NUMBER-OF-ITEMS-READ                        POKCS065
01798                                    TO ASC-LIST-ITEM-NUMBER        POKCS065
01799                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01800              PERFORM 4320-FORMAT-SCREEN-FIELDS                    POKCS065
01801          END-IF                                                   POKCS065
01802      END-PERFORM.                                                 POKCS065
01803                                                                   POKCS065
01804      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          POKCS065
01805          MOVE +1               TO ASC-BLK-SUB                     POKCS065
01806          PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS065
01807          ADD +1                TO ASC-BLK-SUB                     POKCS065
01808          PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS065
01809                                                                   POKCS065
01810          MOVE 1                TO ASC-BLK-SUB                     POKCS065
01811                                   PV-BLOCK-NUMBER                 POKCS065
01812          PERFORM 4410-READ-TEMP-STORAGE                           POKCS065
01813          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             POKCS065
01814              MOVE 2            TO ASC-BLK-SUB                     POKCS065
01815                                   PV-BLOCK-NUMBER                 POKCS065
01816              PERFORM 4410-READ-TEMP-STORAGE                       POKCS065
01817          END-IF                                                   POKCS065
01818      END-IF.                                                      POKCS065
01819  EJECT                                                            POKCS065
01820 *----------------------------------------------------------------*POKCS065
01821 *    FETCH THE CURSORS.                                          *POKCS065
01822 *----------------------------------------------------------------*POKCS065
01823                                                                   POKCS065
01824  4310-FETCH.                                                      POKCS065
01825                                                                   POKCS065
01826      EVALUATE TRUE                                                POKCS065
01827          WHEN ASC-DMM-CURSOR                                      POKCS065
01828                                                                   POKCS065
01829               EXEC SQL                                            POKCS065
01830                    FETCH DMM-CSR                                  POKCS065
01831                    INTO                                           POKCS065
01832                         :RECEIV-ORD-NBR,                          POKCS065
01833                         :RECEIV-REC-SEQ-NBR,                      POKCS065
01834                         :RECEIV-CURR-OPER-UNT-ID,                 POKCS065
01835                         :RECEIV-REC-TMST,                         POKCS065
01838                         :RECEIV-EXPTED-ITM-QTY,                   POKCS065
01839                         :RECEIV-ACTL-ITM-QTY,                     POKCS065
                              :PURCHS-PKGNG-CDE,                                
01840                         :PURCHS-DEPT-NBR,                         POKCS065
01841                         :PLNSHP-DONT-SHIP-BEF-DTE,                POKCS065
01842                         :PLNSHP-CAN-IFNOT-SHIP-DTE,               POKCS065
01843                         :PLNSHP-EXT-CAN-DTE,                      POKCS065
01844                         :ENTNME-ENT-NAME-DESC,                    POKCS065
01845                         :PV-DAYS-IN-DC                            POKCS065
01846               END-EXEC                                            POKCS065
01847                                                                   POKCS065
01848          WHEN ASC-BUYER-CURSOR                                    POKCS065
01849               EXEC SQL                                            POKCS065
01850                    FETCH BUYER-CSR                                POKCS065
01851                    INTO                                           POKCS065
01852                         :RECEIV-ORD-NBR,                          POKCS065
01853                         :RECEIV-REC-SEQ-NBR,                      POKCS065
01854                         :RECEIV-CURR-OPER-UNT-ID,                 POKCS065
01855                         :RECEIV-REC-TMST,                         POKCS065
01858                         :RECEIV-EXPTED-ITM-QTY,                   POKCS065
01859                         :RECEIV-ACTL-ITM-QTY,                     POKCS065
                              :PURCHS-PKGNG-CDE,                                
01860                         :PURCHS-DEPT-NBR,                         POKCS065
01861                         :PLNSHP-DONT-SHIP-BEF-DTE,                POKCS065
01862                         :PLNSHP-CAN-IFNOT-SHIP-DTE,               POKCS065
01863                         :PLNSHP-EXT-CAN-DTE,                      POKCS065
01864                         :ENTNME-ENT-NAME-DESC,                    POKCS065
01865                         :PV-DAYS-IN-DC                            POKCS065
01866               END-EXEC                                            POKCS065
01867                                                                   POKCS065
01868          WHEN ASC-DEPT-CURSOR                                     POKCS065
01869               EXEC SQL                                            POKCS065
01870                    FETCH DEPT-CSR                                 POKCS065
01871                    INTO                                           POKCS065
01872                         :RECEIV-ORD-NBR,                          POKCS065
01873                         :RECEIV-REC-SEQ-NBR,                      POKCS065
01874                         :RECEIV-CURR-OPER-UNT-ID,                 POKCS065
01875                         :RECEIV-REC-TMST,                         POKCS065
01878                         :RECEIV-EXPTED-ITM-QTY,                   POKCS065
01879                         :RECEIV-ACTL-ITM-QTY,                     POKCS065
                              :PURCHS-PKGNG-CDE,                                
01880                         :PURCHS-DEPT-NBR,                         POKCS065
01881                         :PLNSHP-DONT-SHIP-BEF-DTE,                POKCS065
01882                         :PLNSHP-CAN-IFNOT-SHIP-DTE,               POKCS065
01883                         :PLNSHP-EXT-CAN-DTE,                      POKCS065
01884                         :ENTNME-ENT-NAME-DESC,                    POKCS065
01885                         :PV-DAYS-IN-DC                            POKCS065
01886               END-EXEC                                            POKCS065
01887      END-EVALUATE.                                                POKCS065
01888                                                                   POKCS065
01889      EVALUATE TRUE                                                POKCS065
01890          WHEN SQLCODE = ZERO                                      POKCS065
01891          WHEN SQLCODE = +100                                      POKCS065
01892               CONTINUE                                            POKCS065
01893          WHEN SQLWARN0 NOT = SPACE                                POKCS065
01894          WHEN SQLCODE NOT = ZERO                                  POKCS065
01895               MOVE '4310-FETCH-CURSOR'                            POKCS065
01896                                TO DP013-PARAGRAPH                 POKCS065
01897               MOVE 'FETCH MESSAGE CURSOR'                         POKCS065
01898                                TO DP013-MESSAGE-TEXT (1)          POKCS065
01899               MOVE SQLCA       TO DP013-SQLCA                     POKCS065
01900               SET DP013-DB2-ABEND                                 POKCS065
01901                                TO TRUE                            POKCS065
01902               PERFORM DP013-0000-PROCESS-ABEND                    POKCS065
01903      END-EVALUATE.                                                POKCS065
01904                                                                   POKCS065
01905      IF  SQLCODE EQUAL +100                                       POKCS065
01906          SET ASC-NO-ITEMS-LEFT-ON-DB                              POKCS065
01907                                    TO TRUE                        POKCS065
01908      END-IF.                                                      POKCS065
01909                                                                   POKCS065
01910 *----------------------------------------------------------------*POKCS065
01911 *                                                                *POKCS065
01912 *----------------------------------------------------------------*POKCS065
01913  4320-FORMAT-SCREEN-FIELDS.                                       POKCS065
01914                                                                   POKCS065
01915      MOVE PV-DAYS-IN-DC            TO ASC-DAYS                    POKCS065
01916                                      (ASC-BLK-SUB ASC-ITEM-SUB).  POKCS065
01917 *                                                                 POKCS065
01918      MOVE RECEIV-REC-TMST          TO PV-TMST.                    POKCS065
01919      MOVE PV-TMST-MM               TO ASC-REC-DATE-MM             POKCS065
01920                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01921      MOVE PV-TMST-DD               TO ASC-REC-DATE-DD             POKCS065
01922                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01923      MOVE PV-TMST-YY               TO ASC-REC-DATE-YY             POKCS065
01924                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01925 *                                                                 POKCS065
01926      MOVE RECEIV-CURR-OPER-UNT-ID  TO PV-NUM3.                    POKCS065
01927      MOVE PV-NUM3                  TO ASC-DC                      POKCS065
01928                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01929 *                                                                 POKCS065
01930      MOVE PURCHS-DEPT-NBR          TO ASC-DPT                     POKCS065
01931                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01932 *                                                                 POKCS065
C98147     MOVE RECEIV-ORD-NBR           TO PV-NUM8.                    POKCS065
C98147     MOVE PV-NUM8                  TO ASC-PO                      POKCS065
01935                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01936 *                                                                 POKCS065
01937      MOVE RECEIV-REC-SEQ-NBR       TO PV-NUM3.                    POKCS065
01938      MOVE PV-NUM3                  TO ASC-REC-SEQ                 POKCS065
01939                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01940 *                                                                 POKCS065
01941      MOVE ENTNME-ENT-NAME-DESC     TO ASC-VENDOR                  POKCS065
01942                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01943 *                                                                 POKCS065
01944      MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DATE.                    POKCS065
01945      MOVE PV-DATE-MM               TO ASC-SHIP-DATE-MM            POKCS065
01946                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01947      MOVE PV-DATE-DD               TO ASC-SHIP-DATE-DD            POKCS065
01948                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01949      MOVE PV-DATE-YY               TO ASC-SHIP-DATE-YY            POKCS065
01950                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01951 *                                                                 POKCS065
01952      IF PLNSHP-EXT-CAN-DTE > '0001-01-01'                         POKCS065
01953          MOVE PLNSHP-EXT-CAN-DTE   TO PV-DATE                     POKCS065
01954          MOVE PV-DATE-MM           TO ASC-CAN-DATE-MM             POKCS065
01955                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01956          MOVE PV-DATE-DD           TO ASC-CAN-DATE-DD             POKCS065
01957                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01958          MOVE PV-DATE-YY           TO ASC-CAN-DATE-YY             POKCS065
01959                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01960      ELSE                                                         POKCS065
01961          MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                           POKCS065
01962                                    TO PV-DATE                     POKCS065
01963          MOVE PV-DATE-MM           TO ASC-CAN-DATE-MM             POKCS065
01964                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01965          MOVE PV-DATE-DD           TO ASC-CAN-DATE-DD             POKCS065
01966                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01967          MOVE PV-DATE-YY           TO ASC-CAN-DATE-YY             POKCS065
01968                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01969      END-IF.                                                      POKCS065
01970 *                                                                 POKCS065
01980      MOVE RECEIV-ORD-NBR               TO DK-PO-NBR.              POKCS065
01981      MOVE RECEIV-REC-SEQ-NBR           TO DK-REC-SEQ-NBR.         POKCS065
01982      PERFORM 4325-SUM-UNITS.                                      POKCS065
01983      MOVE PV-UNITS                 TO ASC-UNITS                   POKCS065
01984                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01985 *                                                                 POKCS065
01986      PERFORM 4330-CHECK-FOR-TROUBLE.                              POKCS065
01987      IF PV-DB2-COUNT > 0                                          POKCS065
01988          MOVE 'Y'                      TO ASC-TROUBLE             POKCS065
01989                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01990      ELSE                                                         POKCS065
01991          MOVE 'N'                      TO ASC-TROUBLE             POKCS065
01992                                       (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS065
01993      END-IF.                                                      POKCS065
      *                                                                         
           MOVE PURCHS-PKGNG-CDE             TO ASC-PACK-TYP                    
01992                                       (ASC-BLK-SUB ASC-ITEM-SUB). POKCS065
01994  EJECT                                                            POKCS065
01995 *----------------------------------------------------------------*POKCS065
01996 * SUM THE NUMBER OF UNITS ON THE RECEIVER.                       *POKCS065
01997 *----------------------------------------------------------------*POKCS065
01998  4325-SUM-UNITS.                                                  POKCS065
01999                                                                   POKCS065
02000      MOVE +0                    TO PV-UNITS.                      POKCS065
02001                                                                   POKCS065
02002      PERFORM                                                      POKCS065
02003          WITH TEST AFTER                                          POKCS065
02004          VARYING PV-RETRY-COUNTER                                 POKCS065
02005          FROM 1 BY 1                                              POKCS065
02006          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
02007              OR (SQLCODE = +0)                                    POKCS065
02008              OR (SQLCODE = +100)                                  POKCS065
02009              OR (SQLCODE = -305))                                 POKCS065
02010                                                                   POKCS065
02011          EXEC SQL                                                 POKCS065
02012               SELECT SUM(PKSL_ITM_QTY)                            POKCS065
02013                 INTO :PV-UNITS                                    POKCS065
02014                 FROM TRECITM                                      POKCS065
02015                WHERE ORD_NBR        = :DK-PO-NBR                  POKCS065
02016                  AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             POKCS065
02017                  AND VER_STATUS_CDE = 'A'                         POKCS065
02018          END-EXEC                                                 POKCS065
02019                                                                   POKCS065
02020          EVALUATE TRUE                                            POKCS065
02021                                                                   POKCS065
02022              WHEN SQLCODE = +0                                    POKCS065
02023              WHEN SQLCODE = +100                                  POKCS065
02024              WHEN SQLCODE = -904                                  POKCS065
02025              WHEN SQLCODE = -913                                  POKCS065
02026              WHEN SQLCODE = -305                                  POKCS065
02027                   CONTINUE                                        POKCS065
02028                                                                   POKCS065
02029              WHEN SQLWARN0 NOT = SPACES                           POKCS065
02030              WHEN SQLCODE < +0                                    POKCS065
02031              WHEN SQLCODE > +0                                    POKCS065
02032                   MOVE '4325-SUM-UNITS'                           POKCS065
02033                                   TO DP013-PARAGRAPH              POKCS065
02034                   MOVE 'UNSUCCESSFUL SUM ON TRECITM'              POKCS065
02035                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
02036                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
02037                   MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
02038                   SET DP013-DB2-ABEND                             POKCS065
02039                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
02040                                   TO TRUE                         POKCS065
02041                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
02042          END-EVALUATE                                             POKCS065
02043      END-PERFORM.                                                 POKCS065
02044                                                                   POKCS065
02045      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
02046          MOVE '4325-SUM-UNITS'                                    POKCS065
02047                                   TO DP013-PARAGRAPH              POKCS065
02048          MOVE 'MAX RETRIES EXCEEDED ON SUM ON TRECITM'            POKCS065
02049                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
02050          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
02051          MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
02052          SET DP013-DB2-ABEND                                      POKCS065
02053              DP013-XCTL-DISPLAY-RESTART                           POKCS065
02054                                   TO TRUE                         POKCS065
02055          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
02056      END-IF.                                                      POKCS065
02057 *----------------------------------------------------------------*POKCS065
02058 * DETERMINE IF THE RECEIVER IS IN TROUBLE.                       *POKCS065
02059 *----------------------------------------------------------------*POKCS065
02060  4330-CHECK-FOR-TROUBLE.                                          POKCS065
02061                                                                   POKCS065
02062      MOVE +0                    TO PV-DB2-COUNT.                  POKCS065
02063                                                                   POKCS065
02064      PERFORM                                                      POKCS065
02065          WITH TEST AFTER                                          POKCS065
02066          VARYING PV-RETRY-COUNTER                                 POKCS065
02067          FROM 1 BY 1                                              POKCS065
02068          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS065
02069              OR (SQLCODE = +0)                                    POKCS065
02070              OR (SQLCODE = +100))                                 POKCS065
02071                                                                   POKCS065
02072          EXEC SQL                                                 POKCS065
02073               SELECT COUNT(*)                                     POKCS065
02074                 INTO :PV-DB2-COUNT                                POKCS065
02075                 FROM TTRBNTF                                      POKCS065
02076                WHERE PO_NBR      = :DK-PO-NBR                     POKCS065
02077                  AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                POKCS065
02078                  AND RESOLVED_IND IN ('N', 'I')                   POKCS065
02079          END-EXEC                                                 POKCS065
02080                                                                   POKCS065
02081          EVALUATE TRUE                                            POKCS065
02082              WHEN SQLCODE = +0                                    POKCS065
02083              WHEN SQLCODE = +100                                  POKCS065
02084              WHEN SQLCODE = -904                                  POKCS065
02085              WHEN SQLCODE = -913                                  POKCS065
02086                   CONTINUE                                        POKCS065
02087                                                                   POKCS065
02088              WHEN SQLWARN0 NOT = SPACES                           POKCS065
02089              WHEN SQLCODE < +0                                    POKCS065
02090              WHEN SQLCODE > +0                                    POKCS065
02091                   MOVE '4330-CHECK-FOR-TROUBLE'                   POKCS065
02092                                   TO DP013-PARAGRAPH              POKCS065
02093                   MOVE 'UNSUCCESSFUL COUNT ON TROUBLE'            POKCS065
02094                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
02095                   MOVE SQLCA      TO DP013-SQLCA                  POKCS065
02096                   MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     POKCS065
02097                   SET DP013-DB2-ABEND                             POKCS065
02098                       DP013-XCTL-DISPLAY-RESTART                  POKCS065
02099                                   TO TRUE                         POKCS065
02100                   PERFORM DP013-0000-PROCESS-ABEND                POKCS065
02101          END-EVALUATE                                             POKCS065
02102      END-PERFORM.                                                 POKCS065
02103                                                                   POKCS065
02104      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS065
02105          MOVE '4330-CHECK-FOR-TROUBLE'                            POKCS065
02106                                   TO DP013-PARAGRAPH              POKCS065
02107          MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TTRBNTF'          POKCS065
02108                                   TO DP013-MESSAGE-TEXT (1)       POKCS065
02109          MOVE SQLCA               TO DP013-SQLCA                  POKCS065
02110          MOVE 'TTRBNTF '          TO DP013-DB2-TABLE-NAME (1)     POKCS065
02111          SET DP013-DB2-ABEND                                      POKCS065
02112              DP013-XCTL-DISPLAY-RESTART                           POKCS065
02113                                   TO TRUE                         POKCS065
02114          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
02115      END-IF.                                                      POKCS065
02116 *----------------------------------------------------------------*POKCS065
02117 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *POKCS065
02118 *----------------------------------------------------------------*POKCS065
02119                                                                   POKCS065
02120  4400-MOVE-COMMAREA-TO-SCREEN.                                    POKCS065
02121      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             POKCS065
02122          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          POKCS065
02123          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          POKCS065
02124              MOVE +1    TO ASC-BLK-SUB                            POKCS065
02125              PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS065
02126              ADD +1     TO ASC-BLK-SUB                            POKCS065
02127              PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS065
02128              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             POKCS065
02129                  GIVING PV-BLOCK-NUMBER                           POKCS065
02130                  REMAINDER PV-REMAINDER                           POKCS065
02131              IF  PV-REMAINDER > ZERO                              POKCS065
02132                  ADD +1 TO PV-BLOCK-NUMBER                        POKCS065
02133              END-IF                                               POKCS065
02134              MOVE +1    TO ASC-BLK-SUB                            POKCS065
02135              PERFORM 4410-READ-TEMP-STORAGE                       POKCS065
02136              ADD +1     TO ASC-BLK-SUB                            POKCS065
02137                            PV-BLOCK-NUMBER                        POKCS065
02138              PERFORM 4410-READ-TEMP-STORAGE                       POKCS065
02139      END-IF.                                                      POKCS065
02140      MOVE +1            TO ASC-BLK-SUB.                           POKCS065
02141      COMPUTE ASC-ITEM-SUB =                                       POKCS065
02142          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              POKCS065
02143          + PC-ITEMS-PER-PANEL).                                   POKCS065
02144 *                                                                 POKCS065
02145      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        POKCS065
02146          ADD +1         TO ASC-BLK-SUB                            POKCS065
02147          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            POKCS065
02148      END-IF.                                                      POKCS065
02149 *                                                                 POKCS065
02150      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           POKCS065
02151          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                POKCS065
02152 *    PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        POKCS065
02153      PERFORM 4420-FORMAT-LIST-LINES                               POKCS065
02154          VARYING PV-SUB                                           POKCS065
02155          FROM PC-ITEMS-PER-PANEL BY -1                            POKCS065
02156          UNTIL PV-SUB < +1.                                       POKCS065
02157 *                                                                 POKCS065
02158      COMPUTE ASC-ITEMS-DISPLAYED =                                POKCS065
02159          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          POKCS065
02160      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    POKCS065
02161                                       ASTRTITO.                   POKCS065
02162      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    POKCS065
02163      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    POKCS065
02164 *                                                                 POKCS065
02165      IF  DP020-MSG-NUMBER-X = SPACE                               POKCS065
02166          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  POKCS065
02167 *            --- MORE ITEMS TO DISPLAY ----                       POKCS065
02168              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            POKCS065
02169              SET DP020-MSG-INFORMATIONAL TO TRUE                  POKCS065
02170          END-IF                                                   POKCS065
02171      END-IF.                                                      POKCS065
02172 *----------------------------------------------------------------*POKCS065
02173 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *POKCS065
02174 *----------------------------------------------------------------*POKCS065
02175                                                                   POKCS065
02176  4410-READ-TEMP-STORAGE.                                          POKCS065
02177                                                                   POKCS065
02178      EXEC CICS                                                    POKCS065
02179          READQ TS                                                 POKCS065
02180              QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS065
02181              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS065
02182              ITEM  (PV-BLOCK-NUMBER)                              POKCS065
02183              RESP  (PV-CICS-RESP)                                 POKCS065
02184      END-EXEC.                                                    POKCS065
02185                                                                   POKCS065
02186      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       POKCS065
02187        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     POKCS065
02188          CONTINUE                                                 POKCS065
02189      ELSE                                                         POKCS065
02190          SET DP013-CICS-ABEND     TO TRUE                         POKCS065
02191          SET DP013-NO-ROLLBACK    TO TRUE                         POKCS065
02192          MOVE '4410-READ-TEMP-STORAGE'                            POKCS065
02193                                   TO DP013-PARAGRAPH              POKCS065
02194          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      POKCS065
02195                                   TO DP013-MESSAGE-TEXT(1)        POKCS065
02196          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
02197      END-IF.                                                      POKCS065
02198                                                                   POKCS065
02199      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             POKCS065
02200 *                                                                 POKCS065
02201      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         POKCS065
02202          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               POKCS065
02203      END-IF.                                                      POKCS065
02204  EJECT                                                            POKCS065
02205 *----------------------------------------------------------------*POKCS065
02206 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *POKCS065
02207 *----------------------------------------------------------------*POKCS065
02208                                                                   POKCS065
02209  4420-FORMAT-LIST-LINES.                                          POKCS065
02210      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      POKCS065
02211          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                POKCS065
02212          MOVE SPACE              TO MR-DAYS-X (PV-SUB)            POKCS065
02213                                     MR-REC-DATE (PV-SUB)          POKCS065
02214                                     MR-DC (PV-SUB)                POKCS065
02215                                     MR-DPT (PV-SUB)               POKCS065
02216                                     MR-PO-X (PV-SUB)              POKCS065
02217                                     MR-REC-X (PV-SUB)             POKCS065
02218                                     MR-VND (PV-SUB)               POKCS065
02219                                     MR-SHIP-DATE (PV-SUB)         POKCS065
02220                                     MR-CAN-DATE (PV-SUB)          POKCS065
02222                                     MR-UNTS-X (PV-SUB)            POKCS065
02223                                     MR-TRB    (PV-SUB)            POKCS065
                                          MR-PCKT   (PV-SUB)                    
02224          MOVE DP015-BLUE         TO MR-TRBC   (PV-SUB)            POKCS065
02225      ELSE                                                         POKCS065
02226          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           POKCS065
02227              MOVE ASC-DAYS (ASC-BLK-SUB ASC-ITEM-SUB)             POKCS065
02228                                  TO MR-DAYS (PV-SUB)              POKCS065
02229              MOVE ASC-REC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS065
02230                                  TO MR-REC-DATE (PV-SUB)          POKCS065
02231              MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB)               POKCS065
02232                                  TO MR-DC (PV-SUB)                POKCS065
02233              MOVE ASC-DPT (ASC-BLK-SUB ASC-ITEM-SUB)              POKCS065
02234                                  TO MR-DPT (PV-SUB)               POKCS065
02235              MOVE ASC-PO (ASC-BLK-SUB ASC-ITEM-SUB)               POKCS065
02236                                  TO MR-PO (PV-SUB)                POKCS065
02237              MOVE ASC-REC-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)          POKCS065
02238                                  TO MR-REC (PV-SUB)               POKCS065
02239              MOVE ASC-VENDOR (ASC-BLK-SUB ASC-ITEM-SUB)           POKCS065
02240                                  TO MR-VND (PV-SUB)               POKCS065
02241              MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS065
02242                                  TO MR-SHIP-DATE (PV-SUB)         POKCS065
02243              MOVE ASC-CAN-DATE (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS065
02244                                  TO MR-CAN-DATE (PV-SUB)          POKCS065
02247              MOVE ASC-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS065
02248                                  TO MR-UNTS (PV-SUB)              POKCS065
02249              MOVE ASC-TROUBLE (ASC-BLK-SUB ASC-ITEM-SUB)          POKCS065
02250                                  TO MR-TRB (PV-SUB)               POKCS065
02249              MOVE ASC-PACK-TYP (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS065
02250                                  TO MR-PCKT (PV-SUB)              POKCS065
02251              IF MR-TRB (PV-SUB) = 'Y'                             POKCS065
02252                  MOVE DP015-RED  TO MR-TRBC (PV-SUB)              POKCS065
02253              ELSE                                                 POKCS065
02254                  MOVE DP015-BLUE TO MR-TRBC (PV-SUB)              POKCS065
02255              END-IF                                               POKCS065
02256          END-IF                                                   POKCS065
02257      END-IF.                                                      POKCS065
02258      SUBTRACT +1 FROM ASC-ITEM-SUB                                POKCS065
02259      IF  ASC-ITEM-SUB < + 1                                       POKCS065
02260          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  POKCS065
02261          MOVE +1                 TO ASC-BLK-SUB                   POKCS065
02262      END-IF.                                                      POKCS065
02263  EJECT                                                            POKCS065
02264 *----------------------------------------------------------------*POKCS065
02265 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *POKCS065
02266 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *POKCS065
02267 *----------------------------------------------------------------*POKCS065
02268                                                                   POKCS065
02269  5100-WRITE-TEMP-STORAGE.                                         POKCS065
02270      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     POKCS065
02271                                    TO PV-LIST-ITEM-NUMBER.        POKCS065
02272      COMPUTE PV-BLOCK-NUMBER =                                    POKCS065
02273          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS065
02274                                                                   POKCS065
02275      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             POKCS065
02276      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             POKCS065
02277          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      POKCS065
02278              PERFORM 5105-REWRITE-ASC-LISTQ                       POKCS065
02279          END-IF                                                   POKCS065
02280      ELSE                                                         POKCS065
02281          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       POKCS065
02282          ASC-HIGHEST-BLOCK-WRITTEN + 1                            POKCS065
02283          PERFORM 5110-WRITE-ASC-LISTQ                             POKCS065
02284          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   POKCS065
02285      END-IF.                                                      POKCS065
02286                                                                   POKCS065
02287      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             POKCS065
02288 ******************************************************************POKCS065
02289 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **POKCS065
02290 ** SPECIFIC COMMAREA.                                           **POKCS065
02291 ******************************************************************POKCS065
02292  5105-REWRITE-ASC-LISTQ.                                          POKCS065
02293      EXEC CICS                                                    POKCS065
02294          WRITEQ TS                                                POKCS065
02295              QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS065
02296              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS065
02297              ITEM  (PV-BLOCK-NUMBER)                              POKCS065
02298              REWRITE                                              POKCS065
02299              RESP  (PV-CICS-RESP)                                 POKCS065
02300      END-EXEC.                                                    POKCS065
02301                                                                   POKCS065
02302      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           POKCS065
02303          CONTINUE                                                 POKCS065
02304      ELSE                                                         POKCS065
02305          SET DP013-CICS-ABEND            TO TRUE                  POKCS065
02306          SET DP013-NO-ROLLBACK           TO TRUE                  POKCS065
02307          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       POKCS065
02308          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     POKCS065
02309                                          TO DP013-MESSAGE-TEXT(1) POKCS065
02310          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
02311      END-IF.                                                      POKCS065
02312                                                                   POKCS065
02313 ******************************************************************POKCS065
02314 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **POKCS065
02315 ** SPECIFIC COMMAREA.                                           **POKCS065
02316 ******************************************************************POKCS065
02317  5110-WRITE-ASC-LISTQ.                                            POKCS065
02318      EXEC CICS                                                    POKCS065
02319          WRITEQ TS                                                POKCS065
02320              QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS065
02321              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS065
02322              ITEM  (PV-BLOCK-NUMBER)                              POKCS065
02323              RESP  (PV-CICS-RESP)                                 POKCS065
02324      END-EXEC.                                                    POKCS065
02325      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      POKCS065
02326          SET DP013-CICS-ABEND      TO TRUE                        POKCS065
02327          SET DP013-NO-ROLLBACK     TO TRUE                        POKCS065
02328          MOVE '5110-WRITE-ASC-LISTQ'                              POKCS065
02329                                    TO DP013-PARAGRAPH             POKCS065
02330          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           POKCS065
02331                                    TO DP013-MESSAGE-TEXT(1)       POKCS065
02332          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
02333      END-IF.                                                      POKCS065
02334  EJECT                                                            POKCS065
02335 *----------------------------------------------------------------*POKCS065
02336 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*POKCS065
02337 *----------------------------------------------------------------*POKCS065
02338                                                                   POKCS065
02339  6112-READ-LIST-QUEUE.                                            POKCS065
02340                                                                   POKCS065
02341      EXEC CICS                                                    POKCS065
02342          READQ TS                                                 POKCS065
02343              QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS065
02344              INTO  (LQW-LIST-QUEUE-WORK-AREA)                     POKCS065
02345              ITEM  (PV-ITEM)                                      POKCS065
02346              RESP  (PV-CICS-RESP)                                 POKCS065
02347      END-EXEC.                                                    POKCS065
02348 *                                                                 POKCS065
02349      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS065
02350          CONTINUE                                                 POKCS065
02351      ELSE                                                         POKCS065
02352          SET DP013-CICS-ABEND        TO TRUE                      POKCS065
02353          SET DP013-NO-ROLLBACK       TO TRUE                      POKCS065
02354          MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           POKCS065
02355          MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    POKCS065
02356                                      TO DP013-MESSAGE-TEXT(1)     POKCS065
02357          PERFORM DP013-0000-PROCESS-ABEND                         POKCS065
02358      END-IF.                                                      POKCS065
02359                                                                   POKCS065
02360  EJECT                                                            POKCS065
02361 *----------------------------------------------------------------*POKCS065
02362 *    ABEND PROCESSOR MODULE                                      *POKCS065
02363 *----------------------------------------------------------------*POKCS065
02364                                                                   POKCS065
02365      COPY DPPD013.                                                POKCS065
02366                                                                   POKCS065
02367                                                                   POKCS065
02368                                                                   POKCS065
