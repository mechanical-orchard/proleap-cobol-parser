000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030000
000400 PROGRAM-ID.    EPKUT138.                                         00040000
000500 AUTHOR.        SANDY POTTER.                                     00050000
000600 DATE-WRITTEN.  MAY 10, 2004.                                     00060000
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900*          FPLU CONTROL CARD POPULATOR                            00090000
001000*----------------------------------------------------------       00100000
001100* THIS PROGRAM UPDATES CONTROL CARDS EPCC153 AND EPCC161.         00110000
001300* EPCC153 HOLDS THE CURRENT AND PREVIOUS RUN TIMESTAMPS FROM THE  00130000
001400* PRIOR RUN.  THE CURRENT VALUE IS MOVED TO THE PREVIOUS FIELD AND00140000
001500* A NEW CURRENT VALUE IS CAPTURED.                                00150000
001501* EPCC153 IS ONLY BEING USED TO KEEP TRACK OF START TIMES FROM            
001502* ONE RUN TO THE NEXT.  IT IS NOT PASSED OR USED IN ANY                   
001503* SUBSEQUENT JOBS.                                                        
001600* EPCC161 HOLDS THE CURRENT AND PREVIOUS NEW DAY PERM DATES       00160000
001700* FROM THE PRIOR RUN.  THE CURRENT VALUE IS MOVED TO THE PREVIOUS 00170000
001800* FIELD AND A NEW CURRENT VALUE IS DETERMINED.                    00180000
002200* EPCC009 HOLDS THE PREVIOUS RUN TIMESTAMPS FROM THE PRIOR RUN.   00220000
002201* THIS IS NEEDED BY JOB EPK354.                                   00230000
002202*----------------------------------------------------------       00240000
002203* HISTORY LOG:                                                    00250000
002204*----------------------------------------------------------       00260000
002205* DATE: 2009-08-31                                                00270000
002206* WR/IR#: 37103                                                   00280000
002207* PROGRAMMER: DEANNA BRANTNER                                     00290000
002208* DESCRIPTION: ADD A NEW DATE CARD FOR JOB EPK354.                00300000
002209*----------------------------------------------------------       00310000
002210* DATE: 2011-01-24                                                00270000
002211* WR/IR#: PBI11409/PKE6877                                        00280000
002212* PROGRAMMER: MARGARET MORRISON                                   00290000
002213* DESCRIPTION: REMOVE NT10 AND RED TICKET PROCESSING.             00300000
002214*----------------------------------------------------------       00310000
002215* DATE:                                                           00320000
002216* WR/IR#:                                                         00330000
002217* PROGRAMMER:                                                     00340000
002218* DESCRIPTION:                                                    00350000
002219*                                                                 00360000
002220*----------------------------------------------------------       00370000
002221 ENVIRONMENT DIVISION.                                            00380000
002222 CONFIGURATION SECTION.                                           00390000
002223 SOURCE-COMPUTER. IBM-3090.                                       00400000
002224 OBJECT-COMPUTER. IBM-3090.                                       00410000
002225                                                                  00420000
002226 INPUT-OUTPUT SECTION.                                            00430000
002227 FILE-CONTROL.                                                    00440000
002228                                                                  00450000
002229     SELECT CC-TOMORROW-FILE                                      00460000
002230            ASSIGN TO INP01.                                      00470000
002231     SELECT CC-DAYS-PERM-FILE                                     00480000
002232            ASSIGN TO INP02.                                      00490000
002235     SELECT CC-TIMESTAMP-FILE                                     00520000
002236       ASSIGN TO UPD01.                                           00530000
002237     SELECT CC-NEW-DAY-PERM-FILE                                  00540000
002238       ASSIGN TO UPD02.                                           00550000
002241     SELECT CC-PREV-TMSTMP-FILE                                   00580000
002242       ASSIGN TO UPD03.                                           00590000
002243                                                                  00600000
002244*----------------------------------------------------------       00610000
002245 DATA DIVISION.                                                   00620000
002246*----------------------------------------------------------       00630000
002247 FILE SECTION.                                                    00640000
002290                                                                  00650000
002300 FD  CC-TOMORROW-FILE                                             00660000
002400     RECORDING MODE F                                             00670000
002500     BLOCK CONTAINS 0 RECORDS                                     00680000
002600     LABEL RECORDS ARE OMITTED                                    00690000
002700     DATA RECORD IS CC-TOMORROW-FILE-RECORD.                      00700000
002800 01  CC-TOMORROW-RECORD              PIC X(80).                   00710000
002900                                                                  00720000
003000 FD  CC-DAYS-PERM-FILE                                            00730000
003010     RECORDING MODE F                                             00740000
003020     BLOCK CONTAINS 0 RECORDS                                     00750000
003030     LABEL RECORDS ARE OMITTED                                    00760000
003040     DATA RECORD IS CC-DAYS-PERM-FILE-RECORD.                     00770000
003050 01  CC-DAYS-PERM-RECORD             PIC X(80).                   00780000
003051                                                                  00790000
003059 FD  CC-TIMESTAMP-FILE                                            00870000
003060     RECORDING MODE IS F                                          00880000
003061     LABEL RECORDS ARE STANDARD                                   00890000
003062     RECORD CONTAINS 80 CHARACTERS                                00900000
003063     DATA RECORD IS CC-TIMESTAMP-RECORD.                          00910000
003064                                                                  00920000
003065 01  CC-TIMESTAMP-RECORD             PIC X(80).                   00930000
003066                                                                  00940000
003067 FD  CC-NEW-DAY-PERM-FILE                                         00950000
003068     RECORDING MODE IS F                                          00960000
003069     LABEL RECORDS ARE STANDARD                                   00970000
003070     RECORD CONTAINS 80 CHARACTERS                                00980000
003071     DATA RECORD IS CC-NEW-DAY-PERM-RECORD.                       00990000
003072                                                                  01000000
003073 01  CC-NEW-DAY-PERM-RECORD          PIC X(80).                   01010000
003074                                                                  01020000
003083 FD  CC-PREV-TMSTMP-FILE                                          01110000
003084     RECORDING MODE IS F                                          01120000
003085     LABEL RECORDS ARE STANDARD                                   01130000
003086     RECORD CONTAINS 80 CHARACTERS                                01140000
003087     DATA RECORD IS CC-PREV-TMSTMP-RECORD.                        01150000
003088                                                                  01160000
003089 01  CC-PREV-TMSTMP-RECORD           PIC X(80).                   01170000
003090                                                                  01180000
003091*---------------------------------------------------------        01190000
003092                                                                  01200000
003093 WORKING-STORAGE SECTION.                                         01210000
003094                                                                  01220000
003095 01  PV-ABEND-CODE                     PIC S9(04) VALUE ZERO      01230000
003096                                                  COMP SYNC.      01240000
003097     88  PV-CONTROL-CARD-ERROR                    VALUE +4003.    01250000
003098     88  PV-DB2-ERROR                             VALUE +4013.    01260000
003099     88  PV-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01270000
003100                                                                  01280000
003101*---------------------------------------------------------        01290000
003102* PC- PROGRAM CONSTANTS                                           01300000
003103*----------------------------------------------------------       01310000
003104 01  PC-PROGRAM-CONSTANTS.                                        01320000
003105     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT138'. 01330000
003106     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   01340000
003107                                                                  01350000
003108*----------------------------------------------------------       01360000
003109* PS- PROGRAM SWITCHES                                            01370000
003110*----------------------------------------------------------       01380000
003111 01  PS-PROGRAM-SWITCHES.                                         01390000
003112     05  PS-END-OF-FILE-SW            PIC X(01)  VALUE 'N'.       01400000
003113         88  PS-END-OF-FILE                      VALUE 'Y'.       01410000
003114         88  PS-MORE-RECORDS                     VALUE 'N'.       01420000
003200                                                                  01430000
003300*----------------------------------------------------------       01440000
003400* PV- PROGRAM VARIABLES                                           01450000
003500*----------------------------------------------------------       01460000
003600 01 PV-PROGRAM-VARIABLES.                                         01470000
003700    05  PV-PARAGRAPH-NAME             PIC X(30) VALUE SPACES.     01480000
003800    05  PV-OPERATION-MSG-1            PIC X(40) VALUE SPACES.     01490000
003900    05  PV-OPERATION-MSG-2            PIC X(40) VALUE SPACES.     01500000
003901    05  PV-DB2-OPERATION              PIC X(30) VALUE SPACE.      01510000
003902    05  PV-SQL-SUB                    PIC S9(4) VALUE +0 COMP.    01520000
003903    05  PV-SAVE-PREV-TIMESTAMP        PIC X(26) VALUE SPACES.     01530000
003904    05  PV-TIMESTAMP                  PIC X(26) VALUE SPACES.     01540000
003905    05  PV-SAVE-PREV-NEW-DAY          PIC X(10) VALUE SPACES.     01550000
003906    05  PV-CALC-NEW-DAY               PIC X(10) VALUE SPACES.     01560000
003907                                                                  01570000
003908*----------------------------------------------------------       01580000
003909* CONTROL CARD EPCC155 LAYOUT                                     01590000
003910*----------------------------------------------------------       01600000
003911     COPY EPWS112.                                                01610000
003912                                                                  01620000
003913*----------------------------------------------------------       01630000
003914* CONTROL CARDS EPCC159                                           01640000
003915*----------------------------------------------------------       01650000
003916     COPY EPWS159.                                                01660000
003917                                                                  01670000
003918*----------------------------------------------------------       01680000
003919* CONTROL CARD EPCC153 LAYOUT                                     01690000
003920*----------------------------------------------------------       01700000
003921     COPY EPWS105.                                                01710000
003922                                                                  01720000
003923*----------------------------------------------------------       01730000
003924* CONTROL CARD EPCC161 LAYOUT                                     01740000
003925*----------------------------------------------------------       01750000
003926     COPY EPWS161.                                                01760000
003927                                                                  01770000
003933*----------------------------------------------------------       01830000
003934* CONTROL CARD EPCC009 LAYOUT                                     01840000
003935*----------------------------------------------------------       01850000
003936     COPY EPWS001.                                                01860000
003937                                                                  01870000
003938*-----------------------------------------------------------      01880000
003939* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01890000
003940*-----------------------------------------------------------      01900000
003950     COPY DPWS004.                                                01910000
013200                                                                  01920000
013300*--------------------------------------------------------------*  01930000
013400* DATE ROUTINE COPY MEMBERS                                       01940000
013500*--------------------------------------------------------------*  01950000
013600     COPY DPWS500.                                                01960000
013601                                                                  01970000
013602*-----------------------------------------------------------      01980000
013603* DB2 ABEND COPYBOOK                                              01990000
013604*-----------------------------------------------------------      02000000
013605     COPY DPWS900.                                                02010000
013606                                                                  02020000
013607*-----------------------------------------------------------      02030000
013608* DB2 MESSAGE AREA                                                02040000
013609*-----------------------------------------------------------      02050000
013610     COPY SQLCA2.                                                 02060000
013611                                                                  02070000
013612*-----------------------------------------------------------      02080000
013613* DB2 COMMUNICATIONS AREA                                         02090000
013614*-----------------------------------------------------------      02100000
013615     EXEC SQL                                                     02110000
013616          INCLUDE SQLCA                                           02120000
013617     END-EXEC.                                                    02130000
013618                                                                  02140000
013619*----------------------------------------------------------       02150000
013620 PROCEDURE DIVISION.                                              02160000
013621*----------------------------------------------------------       02170000
013622 0000-MAINLINE.                                                   02180000
013623                                                                  02190000
013624     PERFORM 1000-INITIALIZATION.                                 02200000
013625                                                                  02210000
013626     PERFORM 2000-UPDT-TIMESTAMP.                                 02220000
013627                                                                  02230000
013628     PERFORM 2050-PREV-TIMESTAMP.                                 02240000
013629                                                                  02250000
013630     PERFORM 2100-PREP-NEW-DAY-PERM.                              02260000
013631                                                                  02270000
013632     PERFORM 2200-UPDT-NEW-DAY-PERM.                              02280000
013633                                                                  02290000
013638     PERFORM 9999-WRAPUP.                                         02340000
013639                                                                  02350000
013640     GOBACK.                                                      02360000
013641                                                                  02370000
013642*----------------------------------------------------------       02380000
013643* 1000-INITIALIZATION.                                            02390000
013644*    OPENS TIMESTAMP CONTROL CARD, EPCC153 AND READS THE RECORD.  02400000
013645*    SAVES THE CURRENT VALUE AND CLOSES THE FILE.                 02410000
013646*----------------------------------------------------------       02420000
013647 1000-INITIALIZATION.                                             02430000
018600                                                                  02440000
018900     DISPLAY '**** EPKUT138                           ****'.      02450000
018901     DISPLAY '**** CONTROL CARD VALUES BEFORE UPDATES ****'.      02460000
018902     DISPLAY '****                                    ****'.      02470000
018903                                                                  02480000
018904     SET PS-MORE-RECORDS TO TRUE.                                 02490000
018905     OPEN INPUT CC-TIMESTAMP-FILE.                                02500000
018906     INITIALIZE CC-EPCC105-CONTROL-CARD.                          02510000
018907                                                                  02520000
018908     PERFORM 8000-READ-TIMESTAMP-CARD.                            02530000
018909                                                                  02540000
062500     IF PS-END-OF-FILE                                            02550000
063000        MOVE '1000-INITIALIZATION'    TO PV-PARAGRAPH-NAME        02560000
063010        MOVE 'EMPTY EPCC153 CONTROL'  TO PV-OPERATION-MSG-1       02570000
063100        SET PV-CONTROL-CARD-ERROR     TO TRUE                     02580000
063200        PERFORM 9700-ABEND                                        02590000
063300     END-IF.                                                      02600000
063301                                                                  02610000
063302     CLOSE CC-TIMESTAMP-FILE.                                     02620000
063303                                                                  02630000
063304     MOVE CC-EPCC105-CRNT-TIMESTAMP TO PV-SAVE-PREV-TIMESTAMP.    02640000
063305     DISPLAY 'EPCC153 (TIMESTAMP) CONTROL CARD (EPWS105): '.      02650000
063306     DISPLAY CC-EPCC105-CONTROL-CARD-DISPLY.                      02660000
063307                                                                  02670000
063308     DISPLAY '**** CONTROL CARD VALUES BEFORE UPDATES ****'.      02680000
063309     DISPLAY '****                                    ****'.      02690000
063310                                                                  02700000
063311     SET PS-MORE-RECORDS TO TRUE.                                 02710000
063312     OPEN INPUT CC-PREV-TMSTMP-FILE.                              02720000
063313     INITIALIZE CC-EPCC009-CONTROL-CARD.                          02730000
063314                                                                  02740000
063315     PERFORM 8050-READ-TIMESTAMP-CARD.                            02750000
063316                                                                  02760000
063317     IF PS-END-OF-FILE                                            02770000
063318        MOVE '1000-INITIALIZATION'    TO PV-PARAGRAPH-NAME        02780000
063319        MOVE 'EMPTY EPCC009 CONTROL'  TO PV-OPERATION-MSG-1       02790000
063320        SET PV-CONTROL-CARD-ERROR     TO TRUE                     02800000
063321        PERFORM 9700-ABEND                                        02810000
063322     END-IF.                                                      02820000
063323                                                                  02830000
063324     CLOSE CC-PREV-TMSTMP-FILE.                                   02840000
063325                                                                  02850000
063326     DISPLAY 'EPCC009 (TIMESTAMP) CONTROL CARD: '.                02860000
063327     DISPLAY CC-EPCC009-PREV-TIMESTAMP.                           02870000
063328                                                                  02880000
063329*----------------------------------------------------------       02890000
063330* 2000-UPDT-TIMESTAMP.                                            02900000
063340*     UPDATES EPCC153 (EPWS105) CONTROL CARD WITH NEW TIMESTAMP   02910000
063350*     VALUES (CURRENT IS MOVED TO PREVIOUS AND NEW CURRENT IS     02920000
063351*     CAPTURED FROM DB2).                                         02930000
063352*     EPCC153 HOLDS THE CURRENT AND PREVIOUS RUN TIMESTAMPS FROM          
063353*     THE PRIOR RUN.  THE CURRENT VALUE IS MOVED TO THE PREVIOUS          
063354*     FIELD AND A NEW CURRENT VALUE IS CAPTURED.                          
063355*     EPCC153 IS ONLY BEING USED TO KEEP TRACK OF START TIMES FROM        
063356*     ONE RUN TO THE NEXT.  IT IS NOT PASSED TO OR USED IN ANY            
063357*     SUBSEQUENT JOBS.                                                    
063364*----------------------------------------------------------       02940000
063365 2000-UPDT-TIMESTAMP.                                             02950000
063366                                                                  02960000
063367     OPEN OUTPUT CC-TIMESTAMP-FILE.                               02970000
063368                                                                  02980000
063369     INITIALIZE CC-EPCC105-CONTROL-CARD.                          02990000
063370     SET CC-EPCC105-VALID-PREV-NM      TO TRUE.                   03000000
063371     SET CC-EPCC105-VALID-CRNT-NM      TO TRUE.                   03010000
063372                                                                  03020000
063373     PERFORM 9000-SELECT-DB2-TIMESTAMP.                           03030000
063374                                                                  03040000
063375     MOVE PV-SAVE-PREV-TIMESTAMP  TO CC-EPCC105-PREV-TIMESTAMP.   03050000
063376     MOVE PV-TIMESTAMP            TO CC-EPCC105-CRNT-TIMESTAMP.   03060000
063377                                                                  03070000
063378     PERFORM 8700-WRITE-TIMESTAMP-CARD.                           03080000
063379                                                                  03090000
063380     CLOSE CC-TIMESTAMP-FILE.                                     03100000
063381                                                                  03110000
063382*----------------------------------------------------------       03120000
063383*     UPDATES EPCC009 CONTROL CARD WITH NEW PREVIOUS TIME         03130000
063384*     STAMP VALUES FROM EPCC153 CONTROL CARD.                     03140000
063385*----------------------------------------------------------       03150000
063386 2050-PREV-TIMESTAMP.                                             03160000
063387                                                                  03170000
063388     OPEN OUTPUT CC-PREV-TMSTMP-FILE.                             03180000
063389                                                                  03190000
063390     INITIALIZE CC-EPCC009-PREV-TIMESTAMP.                        03200000
063391                                                                  03210000
063392     MOVE PV-SAVE-PREV-TIMESTAMP  TO CC-EPCC009-PREV-TIMESTAMP.   03220000
063393     MOVE ''''                    TO CC-EPCC009-CONTROL-FIRST     03230000
063394                                     CC-EPCC009-CONTROL-LAST.     03240000
063395                                                                  03250000
063396     PERFORM 8750-WRITE-PREV-TIMESTAMP.                           03260000
063397                                                                  03270000
063398     CLOSE CC-PREV-TMSTMP-FILE.                                   03280000
063399                                                                  03290000
063400*----------------------------------------------------------       03300000
063401* 2100-PREP-NEW-DAY-PERM.                                         03310000
063402*     OPENS AND READS CURRENT NEW DAY PERM CONTROL CARD.  SAVES   03320000
063410*     NEW DAY FROM THE PRIOR RUN AND CLOSES THE FILE.             03330000
063500*     CALCULATES THE NEXT NEW DAY BY ADDING THE NUMBER OF ADVANCE 03340000
063501*     DAYS FOR PERM TO TOMORROW'S DATE.  USES THE DATE ROUTINE.   03350000
063502*----------------------------------------------------------       03360000
063503 2100-PREP-NEW-DAY-PERM.                                          03370000
063504                                                                  03380000
063505     SET PS-MORE-RECORDS TO TRUE.                                 03390000
063506     OPEN INPUT CC-TOMORROW-FILE.                                 03400000
063507     INITIALIZE CC-EPCC112-CONTROL-CARD.                          03410000
063508     PERFORM 8100-READ-CC-TOMORROW-FILE.                          03420000
063509                                                                  03430000
063510     IF PS-END-OF-FILE                                            03440000
063511        MOVE '2100-PREP-NEW-DAY-PERM' TO PV-PARAGRAPH-NAME        03450000
063512        MOVE 'EMPTY EPCC155 CONTROL'  TO PV-OPERATION-MSG-1       03460000
063513        SET PV-CONTROL-CARD-ERROR     TO TRUE                     03470000
063514        PERFORM 9700-ABEND                                        03480000
063515     END-IF.                                                      03490000
063516     CLOSE CC-TOMORROW-FILE.                                      03500000
063517                                                                  03510000
063518     DISPLAY ' '.                                                 03520000
063519     DISPLAY 'EPCC155 (TOMORROW) CONTROL CARD (EPWS112): '.       03530000
063520     DISPLAY CC-EPCC112-CONTROL-CARD-DISPLY.                      03540000
063530                                                                  03550000
063531     SET PS-MORE-RECORDS TO TRUE.                                 03560000
063532     OPEN INPUT CC-DAYS-PERM-FILE                                 03570000
063533     INITIALIZE CC-EPCC159-CONTROL-CARD.                          03580000
063534     PERFORM 8200-READ-CC-DAYS-PERM-FILE.                         03590000
063535                                                                  03600000
063536     IF PS-END-OF-FILE                                            03610000
063537        MOVE '2100-PREP-NEW-DAY-PERM' TO PV-PARAGRAPH-NAME        03620000
063538        MOVE 'EMPTY EPCC159 CONTROL'  TO PV-OPERATION-MSG-1       03630000
063539        SET PV-CONTROL-CARD-ERROR     TO TRUE                     03640000
063540        PERFORM 9700-ABEND                                        03650000
063541     END-IF.                                                      03660000
063542     CLOSE CC-DAYS-PERM-FILE.                                     03670000
063543                                                                  03680000
063544     DISPLAY ' '.                                                 03690000
063545     DISPLAY 'EPCC159 (# DAYS PERM) CONTROL CARD (EPWS159): '.    03700000
063546     DISPLAY CC-EPCC159-CONTROL-CARD-DISPLY.                      03710000
063547                                                                  03720000
063548     SET PS-MORE-RECORDS TO TRUE.                                 03730000
063549     OPEN INPUT CC-NEW-DAY-PERM-FILE.                             03740000
063550     INITIALIZE CC-EPCC161-CONTROL-CARD.                          03750000
063560     PERFORM 8300-READ-NEW-DAY-PERM.                              03760000
063561                                                                  03770000
063562     IF PS-END-OF-FILE                                            03780000
063563        MOVE '2100-PREP-NEW-DAY-PERM' TO PV-PARAGRAPH-NAME        03790000
063564        MOVE 'EMPTY EPCC161 CONTROL'  TO PV-OPERATION-MSG-1       03800000
063565        SET PV-CONTROL-CARD-ERROR     TO TRUE                     03810000
063566        PERFORM 9700-ABEND                                        03820000
063567     END-IF.                                                      03830000
063568                                                                  03840000
063569     CLOSE CC-NEW-DAY-PERM-FILE.                                  03850000
063570                                                                  03860000
063571     MOVE CC-EPCC161-NEW-DATE   TO PV-SAVE-PREV-NEW-DAY.          03870000
063572     DISPLAY ' '.                                                 03880000
063573     DISPLAY 'EPCC161 (NEW DAY PERM) CONTROL CARD (EPWS161)'.     03890000
063574     DISPLAY CC-EPCC161-CONTROL-CARD-DISPLY.                      03900000
063575                                                                  03910000
063576     PERFORM 9100-CALL-DATE-ROUTINE.                              03920000
063577                                                                  03930000
063578*----------------------------------------------------------       03940000
063579* 2200-UPDT-NEW-DAY-PERM.                                         03950000
063580*     UPDATES EPCC161 (EPWS161) CONTROL CARD WITH NEW DAY         03960000
063590*     VALUES (NEXT NEW DAY IS MOVED TO PREVIOUS AND NEXT NEW DAY  03970000
063591*     IS POPULATED).                                              03980000
063592*----------------------------------------------------------       03990000
063593 2200-UPDT-NEW-DAY-PERM.                                          04000000
063594                                                                  04010000
063595     OPEN OUTPUT CC-NEW-DAY-PERM-FILE.                            04020000
063596                                                                  04030000
063597     INITIALIZE CC-EPCC161-CONTROL-CARD.                          04040000
063598     SET CC-EPCC161-VALID-NM1-PERM   TO TRUE.                     04050000
063599     SET CC-EPCC161-VALID-NM2        TO TRUE.                     04060000
063600                                                                  04070000
063601     MOVE PV-SAVE-PREV-NEW-DAY    TO CC-EPCC161-PREV-NEW-DATE.    04080000
063602     MOVE PV-CALC-NEW-DAY         TO CC-EPCC161-NEW-DATE.         04090000
063603                                                                  04100000
063604     PERFORM 8800-WRITE-NEW-DAY-PERM-CARD.                        04110000
063605                                                                  04120000
063606     CLOSE CC-NEW-DAY-PERM-FILE.                                  04130000
063607                                                                  04140000
063676*----------------------------------------------------------       04830000
063677* 8000-READ-TIMESTAMP-CARD.                                       04840000
063678*     READS IN THE TIMESTAMP (EPCC153/EPWS105) CONTROL CARD.      04850000
063679*----------------------------------------------------------       04860000
063680 8000-READ-TIMESTAMP-CARD.                                        04870000
063681                                                                  04880000
063682     READ CC-TIMESTAMP-FILE INTO CC-EPCC105-CONTROL-CARD          04890000
063683        AT END                                                    04900000
063684           SET PS-END-OF-FILE TO TRUE                             04910000
063685     END-READ.                                                    04920000
063686                                                                  04930000
063687*----------------------------------------------------------       04940000
063688*     READS IN THE TIMESTAMP (EPCC009) CONTROL CARD.              04950000
063689*----------------------------------------------------------       04960000
063690 8050-READ-TIMESTAMP-CARD.                                        04970000
063691                                                                  04980000
063692     READ CC-PREV-TMSTMP-FILE INTO CC-EPCC009-CONTROL-CARD        04990000
063693        AT END                                                    05000000
063694           SET PS-END-OF-FILE TO TRUE                             05010000
063695     END-READ.                                                    05020000
063696                                                                  05030000
063697*----------------------------------------------------------       05040000
063698* 8100-READ-CC-TOMORROW-FILE.                                     05050000
063699*     READS IN THE TOMORROW (EPCC155/EPWS112) CONTROL CARD.       05060000
063700*----------------------------------------------------------       05070000
063701 8100-READ-CC-TOMORROW-FILE.                                      05080000
063702                                                                  05090000
063703     READ CC-TOMORROW-FILE INTO CC-EPCC112-CONTROL-CARD           05100000
063704        AT END                                                    05110000
063705           SET PS-END-OF-FILE TO TRUE                             05120000
063706     END-READ.                                                    05130000
063707                                                                  05140000
063708*----------------------------------------------------------       05150000
063709* 8200-READ-CC-DAYS-PERM-FILE.                                    05160000
063710*     READS IN THE # DAYS IN ADVANCE FOR PERM (EPCC159/EPWS159)   05170000
063711*     CONTROL CARD.                                               05180000
063712*----------------------------------------------------------       05190000
063713 8200-READ-CC-DAYS-PERM-FILE.                                     05200000
063714                                                                  05210000
063715     READ CC-DAYS-PERM-FILE INTO CC-EPCC159-CONTROL-CARD          05220000
063716        AT END                                                    05230000
063717           SET PS-END-OF-FILE TO TRUE                             05240000
063718     END-READ.                                                    05250000
063719                                                                  05260000
063720*----------------------------------------------------------       05270000
063721* 8300-READ-NEW-DAY-PERM                                          05280000
063722*     READS IN THE NEW DAY FOR PERM (EPCC161/EPWS161)             05290000
063723*     CONTROL CARD.                                               05300000
063724*----------------------------------------------------------       05310000
063725 8300-READ-NEW-DAY-PERM.                                          05320000
063726                                                                  05330000
063727     READ CC-NEW-DAY-PERM-FILE INTO CC-EPCC161-CONTROL-CARD       05340000
063728        AT END                                                    05350000
063729           SET PS-END-OF-FILE TO TRUE                             05360000
063730     END-READ.                                                    05370000
063731                                                                  05380000
063756*----------------------------------------------------------       05630000
063757* 8700-WRITE-TIMESTAMP-CARD.                                      05640000
063758*     WRITES TIMESTAMP CONTROL CARD RECORD TO EPCC153 CONTROL     05650000
063759*     CARD FROM EPWS105 COPYBOOK.                                 05660000
063760*----------------------------------------------------------       05670000
063761 8700-WRITE-TIMESTAMP-CARD.                                       05680000
063762                                                                  05690000
063763     WRITE CC-TIMESTAMP-RECORD   FROM CC-EPCC105-CONTROL-CARD.    05700000
063764                                                                  05710000
063765*----------------------------------------------------------       05720000
063766*     WRITES TIMESTAMP CONTROL CARD RECORD TO EPCC009 CONTROL     05730000
063767*     CARD                                                        05740000
063768*----------------------------------------------------------       05750000
063769 8750-WRITE-PREV-TIMESTAMP.                                       05760000
063770                                                                  05770000
063771     WRITE CC-PREV-TMSTMP-RECORD FROM CC-EPCC009-CONTROL-CARD.    05780000
063772                                                                  05790000
063773*----------------------------------------------------------       05800000
063774* 8800-WRITE-NEW-DAY-PERM-CARD.                                   05810000
063775*     WRITES NEW DAY PERM CONTROL CARD RECORD TO EPCC161 CONTROL  05820000
063776*     CARD FROM EPWS161 COPYBOOK.                                 05830000
063777*----------------------------------------------------------       05840000
063778 8800-WRITE-NEW-DAY-PERM-CARD.                                    05850000
063779                                                                  05860000
063780     WRITE CC-NEW-DAY-PERM-RECORD                                 05870000
063781         FROM CC-EPCC161-CONTROL-CARD.                            05880000
063782                                                                  05890000
063793*----------------------------------------------------------       06000000
063794* 9000-SELECT-DB2-TIMESTAMP.                                      06010000
063795*     RETRIEVE TIMESTAMP FROM DB2.                                06020000
063796*----------------------------------------------------------       06030000
063797 9000-SELECT-DB2-TIMESTAMP.                                       06040000
063798                                                                  06050000
063799     EXEC SQL                                                     06060000
063800          SELECT CURRENT TIMESTAMP                                06070000
063801          INTO  :PV-TIMESTAMP                                     06080000
063802          FROM   SYSIBM.SYSDUMMY1                                 06090000
063803     END-EXEC.                                                    06100000
063804                                                                  06110000
063805     IF SQLCODE NOT EQUAL ZERO                                    06120000
063806        MOVE '9000-SELECT-DB2-TIME' TO PV-PARAGRAPH-NAME          06130000
063807        MOVE 'CANNOT GET CURRENT TIMESTAMP'                       06140000
063808                                    TO PV-DB2-OPERATION           06150000
063809        PERFORM 9800-SQL-ABEND                                    06160000
063810     END-IF.                                                      06170000
063811                                                                  06180000
063812*--------------------------------------------------------------*  06190000
063813* 9100-CALL-DATE-ROUTINE.                                         06200000
063814*                                                                 06210000
063815*--------------------------------------------------------------*  06220000
063816 9100-CALL-DATE-ROUTINE.                                          06230000
063817                                                                  06240000
063818     INITIALIZE DPG51 DPG52 DPG53                                 06250000
063819                DPG54 DPG55 DPG56.                                06260000
063820                                                                  06270000
063821     MOVE CC-EPCC159-ADVANCE-DAYS   TO DPG51-INCR-DECR-DAYS-9.    06280000
063822     MOVE CC-EPCC112-TOMORROW-DATE  TO DPG52-DB2-ISO-DATE-FMT.    06290000
063823                                                                  06300000
063824     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      06310000
063825     SET DPG51-INCREMENT-DATE       TO TRUE.                      06320000
063826     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      06330000
063827                                                                  06340000
063828     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06350000
063829                                             DPG54 DPG55 DPG56.   06360000
063830                                                                  06370000
063831     DISPLAY '>>> VALUE RETURNED FROM DATE ROUTINE:  '            06380000
063832             DPG55-DB2-ISO-DATE-FMT.                              06390000
063833                                                                  06400000
063834     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  06410000
063835        MOVE '9100-CALL-DATE-ROUTINE' TO PV-PARAGRAPH-NAME        06420000
063836        MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-1       06430000
063837        SET PV-CALENDAR-ROUTINE-ERROR TO TRUE                     06440000
063838        PERFORM 9700-ABEND                                        06450000
063839     END-IF.                                                      06460000
063840                                                                  06470000
063850*    CALCULATED DATE VALUE IS IN DPG55-DB2-ISO-DATE-FMT *         06480000
063851     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-CALC-NEW-DAY.              06490000
063852                                                                  06500000
063853*----------------------------------------------------------       06510000
063854* 9700-ABEND.                                                     06520000
063855*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  06530000
063856*----------------------------------------------------------       06540000
063857 9700-ABEND.                                                      06550000
063858                                                                  06560000
063859     DISPLAY '** ABEND           **'.                             06570000
063860     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          06580000
063861     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        06590000
063862     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       06600000
063863     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       06610000
063864     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06620000
063865                                                                  06630000
063866*---------------------------------------------------------        06640000
063867* 9800-SQL-ABEND.                                                 06650000
063868*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.06660000
063869*---------------------------------------------------------        06670000
063870 9800-SQL-ABEND.                                                  06680000
063871                                                                  06690000
063872     SET PV-DB2-ERROR TO TRUE.                                    06700000
063873                                                                  06710000
063874     DISPLAY '** ABEND     **'.                                   06720000
063875     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                06730000
063876     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              06740000
063877     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               06750000
063878                                                                  06760000
063879     COPY DPPD004.                                                06770000
063880     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06780000
063881                                                                  06790000
063882*----------------------------------------------------------       06800000
063883* 9999-WRAPUP.                                                    06810000
063884*     CLOSES ANY OPEN FILES AND DISPLAYS ANY NEEDED INFORMATION.  06820000
063885*----------------------------------------------------------       06830000
063886 9999-WRAPUP.                                                     06840000
063887                                                                  06850000
063888     DISPLAY '****                                   ****'.       06860000
063889     DISPLAY '**** CONTROL CARD VALUES AFTER UPDATES ****'.       06870000
063890     DISPLAY '****                                   ****'.       06880000
063891     DISPLAY 'EPCC153 (TIMESTAMP) CONTROL CARD (EPWS105): '.      06890000
063892     DISPLAY CC-EPCC105-CONTROL-CARD-DISPLY.                      06900000
063893                                                                  06910000
063894     DISPLAY ' '.                                                 06920000
063895     DISPLAY 'EPCC161 (NEW DAY PERM) CONTROL CARD (EPWS161)'.     06930000
063896     DISPLAY CC-EPCC161-CONTROL-CARD-DISPLY.                      06940000
063897                                                                  06950000
063902     DISPLAY 'EPCC009 (TIMESTAMP) CONTROL CARD (EPWS001): '.      07000000
063903     DISPLAY CC-EPCC009-CONTROL-CARD-DISPLY.                      07010000
063904                                                                  07020000
