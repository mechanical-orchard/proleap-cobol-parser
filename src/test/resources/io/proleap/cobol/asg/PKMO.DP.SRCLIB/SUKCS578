000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    SUKCS578.                                         00040001
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  DEC, 2001.                                        00070001
000800 DATE-COMPILED.                                                   00080001
000900*----------------------------------------------------------------*00090001
001000*    S578 - VENDOR RANKING CRITERIA SPECIFICATION                *00100001
001100*                                                                *00110001
001200*    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00120001
001300*    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00130001
001400*    DETAIL SCREEN.  THE VENDOR ID OR VENDOR ID AND DEPARTMENT   *00140001
001500*    ARE ENTERED.  THE ENTERED FIELDS ARE VALIDATED.  RACF IS    *00150001
001600*    CHECKED TO DETERMINE IF THE OPERATOR IS AUTHORIZED TO GO    *00160001
001700*    TO THE MAINTENANCE SCREENS.                                 *00170001
001800*----------------------------------------------------------------*00180001
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00182027
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00183027
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00184027
001130*                                                                 00184128
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00184228
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00184328
263968*---------------------------------------------------------------* 00185027
001900                                                                  00190001
002000                                                                  00200001
002100                                                                  00210001
002200 ENVIRONMENT DIVISION.                                            00220001
002300                                                                  00230001
002400 DATA DIVISION.                                                   00240001
002500                                                                  00250001
002600 WORKING-STORAGE SECTION.                                         00260001
002700*                                                                 00270001
002800 01  PC-PROGRAM-CONSTANTS.                                        00280001
002900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU578A  '. 00290001
003000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM578 '. 00300001
003100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS578'. 00310001
003200     05  PC-TSYMSG-NUMBERS.                                       00320001
003300         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00330001
003400         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00340001
003500         10  PC-TSYMSG-00489       PIC  9(05)  VALUE  00489.      00350001
003600         10  PC-TSYMSG-02844       PIC  9(05)  VALUE  02844.      00360001
003700         10  PC-TSYMSG-02850       PIC  9(05)  VALUE  02850.      00370001
003800*                                                                 00380001
003900/                                                                 00390002
004000 01  DK-DB2-KEYS.                                                 00400002
004100     05  DK-ENT-ID                    PIC S9(09) COMP VALUE +0.   00410002
004200     05  DK-DEPT-NBR                  PIC  X(03) VALUE SPACES.    00420002
004300                                                                  00430002
004400 01  PS-PROGRAM-SWITCHES.                                         00440001
004500     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00450001
004600         88  PS-ERROR                          VALUE  'Y'.        00460001
004700         88  PS-NO-ERROR                       VALUE  'N'.        00470001
004800     05  PS-ENT-ID-FOUND-SW        PIC  X(01)  VALUE  'N'.        00480001
004900         88  PS-ENT-ID-FOUND                   VALUE  'Y'.        00490001
005000         88  PS-NO-ENT-ID-FOUND                VALUE  'N'.        00500001
005100     05  PS-DEPT-FOUND-SW          PIC  X(01)  VALUE  'N'.        00510002
005200         88  PS-DEPT-FOUND                     VALUE  'Y'.        00520002
005300         88  PS-NO-DEPT-FOUND                  VALUE  'N'.        00530002
005400     05  PS-ACCESS-SW              PIC  X(01)  VALUE  'N'.        00540005
005500         88  PS-ACCESS-ALLOWED                 VALUE  'Y'.        00550005
005600         88  PS-ACCESS-NOT-ALLOWED             VALUE  'N'.        00560005
005700                                                                  00570001
005800 01  PM-PROGRAM-MESSAGES.                                         00580001
005900     05  PM-ABEND-INFO-A.                                         00590001
006000         10  FILLER                PIC X(15)   VALUE              00600001
006100                                   'DP020-SRC-AID: '.             00610001
006200         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00620001
006300         10  FILLER                PIC X(19)   VALUE              00630001
006400                                   '. DP020-FK-ACTION: '.         00640001
006500         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00650001
006600         10  FILLER                PIC X(22)   VALUE              00660001
006700                                   '. DP020-FK-DISPN-IND: '.      00670001
006800         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00680001
006900         10  FILLER                PIC X(01)   VALUE '.'.         00690001
007000         10  FILLER                PIC X(19)   VALUE SPACE.       00700001
007100                                                                  00710001
007200                                                                  00720001
007300*----------------------------------------------------------------*00730001
007400*    MAP LAYOUT                                                  *00740001
007500*----------------------------------------------------------------*00750001
007600                                                                  00760001
007700     COPY SUKM578.                                                00770005
007800     EJECT                                                        00780001
007900*----------------------------------------------------------------*00790001
008000*    ATTRIBUTE SETTINGS COPYBOOK.                                *00800001
008100*----------------------------------------------------------------*00810001
008200                                                                  00820001
008300     COPY DPWS015.                                                00830001
008400                                                                  00840001
008500*----------------------------------------------------------------*00850001
008600*    FUNCTION KEYS COPYBOOK                                      *00860001
008700*----------------------------------------------------------------*00870001
008800                                                                  00880001
008900*----------------------------------------------------------------*00890005
009000**  SECURITY SUBROUTINE PARAMETERS                                00900005
009100*----------------------------------------------------------------*00910005
009200     COPY DPWS008.                                                00920005
009300                                                                  00930005
009400     COPY DPWS016.                                                00940001
009500 EJECT                                                            00950001
009600/                                                                 00960001
009700*----------------------------------------------------------------*00970001
009800*    DB2 DCLGEN FOR THE EXTERNAL ENTERPRISE TABLE                 00980001
009900*----------------------------------------------------------------*00990001
010000     EXEC SQL                                                     01000001
010100          INCLUDE TEXTENT                                         01010001
010200     END-EXEC.                                                    01020001
010300*----------------------------------------------------------------*01030001
010400*    DB2 DCLGEN FOR THE ENTERPRISE NAME TABLE                     01040001
010500*----------------------------------------------------------------*01050001
010600     EXEC SQL                                                     01060001
010700          INCLUDE TENTNME                                         01070001
010800     END-EXEC.                                                    01080001
010900                                                                  01090001
011000*---------------------------------------------------------------* 01100002
011100*  DCLGEN FOR THE DB2 DEPARTMENT TABLE                            01110002
011200*---------------------------------------------------------------* 01120002
011300     EXEC SQL                                                     01130002
011400         INCLUDE TVNDDPT                                          01140002
011500     END-EXEC.                                                    01150002
011600*----------------------------------------------------------------*01160012
011700*    DB2 DCLGEN FOR THE MERCHANDISE AREA TABLE                    01170012
011800*----------------------------------------------------------------*01180012
011900     EXEC SQL                                                     01190012
012000          INCLUDE TMDSEAR                                         01200012
012100     END-EXEC.                                                    01210012
012200                                                                  01220012
012300*----------------------------------------------------------------*01230001
012400*    DB2 SQL COMMUNICATION AREA                                   01240001
012500*----------------------------------------------------------------*01250001
012600     EXEC SQL                                                     01260001
012700          INCLUDE SQLCA                                           01270001
012800     END-EXEC.                                                    01280001
012900                                                                  01290001
013000******************************************************************01300001
013100** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01310001
013200** SUB-ROUTINE (DPKUT100).                                      **01320001
013300******************************************************************01330001
013400     COPY DPWS010I.                                               01340001
013500 EJECT                                                            01350001
013600******************************************************************01360001
013800** PARAMTERS FOR CALLING CICS ARCHITECTURE API                  **01380028
013900******************************************************************01390001
014000     COPY DPWS030.                                                01400001
014000     COPY DPWS930.                                                01401028
014100 EJECT                                                            01410001
014200***************************************************************** 01420001
014300*    STANDARD COMMAREA.                                           01430001
014400***************************************************************** 01440001
014500                                                                  01450001
014600     COPY DPWS020.                                                01460001
014700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01470001
014800                                                                  01480001
014900***************************************************************** 01490001
015000*    INTER-APPLICATION COMMAREA.                                  01500001
015100***************************************************************** 01510001
015200                                                                  01520001
015300         10  INTER-APPL-COMM-AREA PIC X(200).                     01530001
015400     COPY SUWS017.                                                01540002
015500***************************************************************** 01550001
015600*    SPECIFIC COMMMAREA FOR SUKCS578.                             01560001
015700***************************************************************** 01570001
015800         10  ASC-SPECIFIC-COMMAREA.                               01580001
015900             15  ASC-ENT-ID.                                      01590002
016000                 20  ASC-ENT-ID-N            PIC  9(09).          01600002
016100             15  ASC-DEPT-NBR.                                    01610002
016200                 20  ASC-DEPT-NBR-N          PIC  9(04).          01620002
016300             15  ASC-DEPT-NBR-X-4 REDEFINES ASC-DEPT-NBR.         01630002
016400                 20  FILLER                  PIC  X(01).          01640002
016500                 20  ASC-DEPT-NBR-X-3        PIC  X(03).          01650002
016600             15  ASC-VENDOR-DESC             PIC  X(30).          01660002
016700             15  ASC-DEPT-DESC               PIC  X(30).          01670012
016800         10  FILLER                          PIC  X(2792).        01680012
016900     EJECT                                                        01690001
017000*----------------------------------------------------------------*01700001
017100*    ABEND PROCESSING COPYBOOK.                                  *01710001
017200*----------------------------------------------------------------*01720001
017300                                                                  01730001
017400     COPY DPWS013.                                                01740001
017500                                                                  01750001
017600                                                                  01760001
017700 EJECT                                                            01770001
017800 LINKAGE SECTION.                                                 01780001
017900                                                                  01790001
018000 01  DFHCOMMAREA.                                                 01800001
018100     05  FILLER                         OCCURS  1 TO 4072 TIMES   01810001
018200                                        DEPENDING ON EIBCALEN.    01820001
018300         10  FILLER                     PIC X.                    01830001
018400                                                                  01840001
018500                                                                  01850001
018600 PROCEDURE DIVISION.                                              01860001
018700***************************************************************** 01870001
018800** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01880001
018900** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01890001
019000** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01900001
019100**                                                             ** 01910001
019200** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01920001
019300** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01930001
019400***************************************************************** 01940001
019500 0000-MAIN-MODULE.                                                01950001
019600     INITIALIZE DP030-CICS-API-FIELDS.                            01960001
019700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01970001
019800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01980001
019900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01990001
020000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02000001
020100     MOVE LENGTH OF SU578AI        TO DP030-MAP-LENGTH (1).       02010002
020200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02020001
020300     PERFORM 0001-CALL-CICS-ARCH-API.                             02030001
020400*                                                                 02040001
020500     PERFORM 1000-CONTROL-PROCESSING                              02050001
020600*                                                                 02060001
020700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02070001
020800     PERFORM 0001-CALL-CICS-ARCH-API.                             02080001
020900                                                                  02090001
021000 0001-CALL-CICS-ARCH-API.                                         02100001
021100*    CALL 'DPKCS030' USING DFHEIBLK                               02110028
021100     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02111028
021200                           DFHCOMMAREA                            02120001
021300                           DP030-CICS-API-FIELDS                  02130001
021400                           DP020-STANDARD-COMMAREA                02140001
021500                           SU578AI.                               02150002
021600*                                                                 02160001
021700     IF  DP030-RC-CALL-SUCCESSFUL                                 02170001
021800         CONTINUE                                                 02180001
021900     ELSE                                                         02190001
022000         SET DP013-NO-ROLLBACK                                    02200001
022100             DP013-XCTL-DISPLAY-RESTART                           02210001
022200             DP013-CICS-ABEND      TO TRUE                        02220001
022300         MOVE 'BEFORE 0000-MAIN-MODULE'                           02230001
022400                                   TO DP013-PARAGRAPH             02240001
022500*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02250028
022600*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02260028
022500         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O02261028
022600-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02262028
022700         MOVE DP030-RETURN-CODE                                   02270001
022800                                   TO DP013-MESSAGE-TEXT (3)      02280001
022900         PERFORM DP013-0000-PROCESS-ABEND                         02290001
023000     END-IF.                                                      02300001
023100 EJECT                                                            02310001
023200*----------------------------------------------------------------*02320001
023300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02330001
023400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02340001
023500*----------------------------------------------------------------*02350001
023600                                                                  02360001
023700 1000-CONTROL-PROCESSING.                                         02370001
023800                                                                  02380001
023900     EVALUATE TRUE                                                02390001
024000         WHEN DP020-NEXT-ACT-INITIAL                              02400001
024100             INITIALIZE ASC-SPECIFIC-COMMAREA                     02410001
024200             PERFORM 4000-BUILD-INITIAL-PANEL                     02420001
024300                                                                  02430001
024400         WHEN DP020-NEXT-ACT-READ-MAP                             02440001
024500             PERFORM 2000-FKEY-PROCESSING                         02450001
024600                                                                  02460001
024700         WHEN DP020-NEXT-ACT-RETURN                               02470001
024800             INITIALIZE ASC-SPECIFIC-COMMAREA                     02480025
024900             PERFORM 4000-BUILD-INITIAL-PANEL                     02490025
025000                                                                  02500001
025100         WHEN OTHER                                               02510001
025200             SET DP013-LOGIC-ABEND                                02520001
025300                 DP013-NO-ROLLBACK TO TRUE                        02530001
025400             MOVE '1000-CONTROL-PROCESSING'                       02540001
025500                                   TO  DP013-PARAGRAPH            02550001
025600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02560001
025700                                   TO  DP013-MESSAGE-TEXT(1)      02570001
025800             MOVE DP020-NEXT-APPL-ACTIVITY                        02580001
025900                                   TO DP013-MESSAGE-TEXT(2)       02590001
026000             PERFORM DP013-0000-PROCESS-ABEND                     02600001
026100     END-EVALUATE.                                                02610001
026200                                                                  02620001
026300*----------------------------------------------------------------*02630001
026400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02640001
026500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02650001
026600* EDITS.                                                         *02660001
026700*----------------------------------------------------------------*02670001
026800                                                                  02680001
026900 2000-FKEY-PROCESSING.                                            02690001
027000                                                                  02700001
027100     EVALUATE TRUE                                                02710001
027200                                                                  02720001
027300         WHEN DP020-SRC-AID = DP016-CLEAR                         02730001
027400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02740001
027500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02750001
027600                                                                  02760001
027700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02770001
027800             INITIALIZE ASC-SPECIFIC-COMMAREA                     02780001
027900             PERFORM 4000-BUILD-INITIAL-PANEL                     02790001
028000             PERFORM 3200-RESET-ATTRIBUTES                        02800001
028100                                                                  02810001
028200         WHEN OTHER                                               02820001
028300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02830001
028400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02840001
028500             IF  PS-NO-ERROR                                      02850001
028600                 SET DP030-CONTINUE-GO TO TRUE                    02860001
028700                 PERFORM 2100-CHECK-FUNCTION-KEY                  02870001
028800             ELSE                                                 02880001
028900                 SET DP030-OVERRIDE-GO TO TRUE                    02890001
029000             END-IF                                               02900001
029100     END-EVALUATE.                                                02910001
029200******************************************************************02920001
029300** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02930001
029400** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02940001
029500** FROM THE CICS ARCHITECTURE API.                              **02950001
029600******************************************************************02960001
029700 2100-CHECK-FUNCTION-KEY.                                         02970001
029800     EVALUATE TRUE                                                02980001
029900         WHEN DP020-SRC-AID = DP016-ENTER                         02990001
030000             CONTINUE                                             03000001
030100                                                                  03010001
030200* F15 - UPDATE VENDOR RANK   (LOCAL-FUNC-01)                      03020002
030300*                                                                 03030001
030400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03040002
030500             IF ASC-ENT-ID > SPACE                                03050002
030600                 MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME           03060002
030700                 PERFORM 2105-RACF-ACCESS                         03070002
030800                 IF  PS-ACCESS-NOT-ALLOWED                        03080002
030900                     SET  PS-ERROR                                03090002
031000                          DP020-MSG-FATAL TO TRUE                 03100002
031100                     MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER     03110002
031200                     MOVE -1              TO AENTIDL              03120019
031300                     SET  DP030-SET-CURSOR-APPL-1 TO TRUE         03130002
031400                     SET  DP030-OVERRIDE-GO       TO TRUE         03140017
031500                 END-IF                                           03150002
031600                 IF PS-NO-ERROR                                   03160002
031700                     PERFORM 2110-PREPARE-INTER-APPL-COMM         03170002
031800                 END-IF                                           03180002
031900             ELSE                                                 03190002
032000                 SET PS-ERROR                                     03200002
032100                     DP020-MSG-FATAL   TO TRUE                    03210002
032200                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        03220002
032300                 MOVE DP015-UNP-ALP-BRT-OFF                       03230002
032400                                       TO AENTIDA                 03240019
032500                 MOVE DP015-RED        TO AENTIDC                 03250019
032600                 MOVE DP015-REVERSE    TO AENTIDH                 03260019
032700                 MOVE -1               TO AENTIDL                 03270019
032800                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              03280002
032900                 SET  DP030-OVERRIDE-GO       TO TRUE             03290017
033000             END-IF                                               03300002
033100                                                                  03310002
033200                                                                  03320002
033300* F17 - UPDATE VENDOR/DEPT RANK   (LOCAL-FUNC-02)                 03330002
033400*                                                                 03340002
033500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03350002
033600             IF ASC-ENT-ID > SPACE AND                            03360002
033700                ASC-DEPT-NBR > SPACES                             03370002
033800                 MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME           03380002
033900                 PERFORM 2105-RACF-ACCESS                         03390002
034000                 IF  PS-ACCESS-NOT-ALLOWED                        03400002
034100                     SET  PS-ERROR                                03410002
034200                          DP020-MSG-FATAL TO TRUE                 03420002
034300                     MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER     03430002
034400                     MOVE -1              TO AENTIDL              03440002
034500                     SET  DP030-SET-CURSOR-APPL-1 TO TRUE         03450002
034600                     SET  DP030-OVERRIDE-GO       TO TRUE         03460017
034700                 END-IF                                           03470002
034800                 IF PS-NO-ERROR                                   03480002
034900                     PERFORM 2110-PREPARE-INTER-APPL-COMM         03490002
035000                 END-IF                                           03500002
035100             ELSE                                                 03510002
035200                 IF ASC-ENT-ID = SPACE                            03520002
035300                     SET PS-ERROR                                 03530002
035400                         DP020-MSG-FATAL   TO TRUE                03540002
035500                     MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER    03550002
035600                     MOVE DP015-UNP-ALP-BRT-OFF                   03560002
035700                                           TO AENTIDA             03570002
035800                     MOVE DP015-RED        TO AENTIDC             03580002
035900                     MOVE DP015-REVERSE    TO AENTIDH             03590002
036000                     MOVE -1               TO AENTIDL             03600002
036100                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          03610002
036200                     SET  DP030-OVERRIDE-GO       TO TRUE         03620017
036300                 ELSE                                             03630002
036400                     SET PS-ERROR                                 03640002
036500                         DP020-MSG-FATAL   TO TRUE                03650002
036600                     MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER    03660002
036700                     MOVE DP015-UNP-ALP-BRT-OFF                   03670002
036800                                           TO ADEPTNBA            03680002
036900                     MOVE DP015-RED        TO ADEPTNBC            03690002
037000                     MOVE DP015-REVERSE    TO ADEPTNBH            03700002
037100                     MOVE -1               TO ADEPTNBL            03710002
037200                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          03720002
037300                     SET  DP030-OVERRIDE-GO       TO TRUE         03730017
037400                 END-IF                                           03740002
037500             END-IF                                               03750002
037600                                                                  03760002
037700                                                                  03770002
037800* F23 - VENDOR LIST (LOCAL-FUNC-03)                               03780002
037900*                                                                 03790002
038000         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              03800002
038100             IF ASC-VENDOR-DESC = SPACES OR                       03810022
038200                ASC-VENDOR-DESC = '*'                             03820022
038300                 SET PS-ERROR                                     03830022
038400                     DP020-MSG-FATAL   TO TRUE                    03840022
038500                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        03850022
038600                 MOVE DP015-UNP-ALP-BRT-OFF                       03860022
038700                                       TO AVENDNMA                03870022
038800                 MOVE DP015-RED        TO AVENDNMC                03880022
038900                 MOVE DP015-REVERSE    TO AVENDNMH                03890022
039000                 MOVE -1               TO AVENDNML                03900022
039100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              03910022
039200                 SET  DP030-OVERRIDE-GO       TO TRUE             03920022
039300             ELSE                                                 03930022
039400                 PERFORM 2110-PREPARE-INTER-APPL-COMM             03940022
039500             END-IF                                               03950022
039600                                                                  03960002
039700* F24 - DEPARTMENT LIST (LOCAL-FUNC-04)                           03970002
039800*                                                                 03980002
039900         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              03990002
040000             IF ASC-ENT-ID > SPACE                                04000024
040100                 PERFORM 2110-PREPARE-INTER-APPL-COMM             04010002
040200             ELSE                                                 04020002
040300                 SET PS-ERROR                                     04030002
040400                     DP020-MSG-FATAL   TO TRUE                    04040002
040500                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        04050002
040600                 MOVE DP015-UNP-ALP-BRT-OFF                       04060002
040700                                       TO AENTIDA                 04070024
040800                 MOVE DP015-RED        TO AENTIDC                 04080024
040900                 MOVE DP015-REVERSE    TO AENTIDH                 04090024
041000                 MOVE -1               TO AENTIDL                 04100024
041100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04110002
041200                 SET DP030-OVERRIDE-GO       TO TRUE              04120017
041300             END-IF                                               04130002
041400                                                                  04140002
041500         WHEN OTHER                                               04150002
041600             SET DP013-NO-ROLLBACK                                04160001
041700                 DP013-XCTL-DISPLAY-RESTART                       04170001
041800                 DP013-CICS-ABEND  TO TRUE                        04180001
041900             MOVE '2100-CHECK-FUNCTION-KEY'                       04190001
042000                                   TO DP013-PARAGRAPH             04200001
042100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04210001
042200                                   TO DP013-MESSAGE-TEXT (1)      04220001
042300             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 04230001
042400                                   TO DP013-MESSAGE-TEXT (2)      04240001
042500             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                04250001
042600             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 04260001
042700                                   TO PM-A-FK-ACTION              04270001
042800             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              04280001
042900                                   TO PM-A-FK-DISPN               04290001
043000             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      04300001
043100             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        04310001
043200                                   TO DP013-MESSAGE-TEXT (4)      04320001
043300             PERFORM DP013-0000-PROCESS-ABEND                     04330001
043400     END-EVALUATE.                                                04340001
043500                                                                  04350001
043600*----------------------------------------------------------------*04360001
043700* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     04370001
043800*----------------------------------------------------------------*04380001
043900 2105-RACF-ACCESS.                                                04390001
044000                                                                  04400001
044100      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  04410001
044200      SET DP008-ACCESS-TYPE-USE          TO TRUE                  04420001
044300                                                                  04430001
044400      EXEC CICS                                                   04440001
044500         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 04450001
044600              COMMAREA (DP008-SECURITY-COMMAREA)                  04460001
044700              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             04470001
044800      END-EXEC                                                    04480001
044900                                                                  04490001
045000      IF DP008-CALL-SUCCESSFUL                                    04500001
045100         IF DP008-ACCESS-ALLOWED                                  04510001
045200             SET PS-ACCESS-ALLOWED TO TRUE                        04520001
045300         ELSE                                                     04530001
045400             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    04540001
045500         END-IF                                                   04550001
045600     ELSE                                                         04560001
045700         MOVE '2105-RACF-ACCESS'                                  04570001
045800                               TO DP013-PARAGRAPH                 04580001
045900          MOVE 'UNABLE TO ACCESS CICS'                            04590001
046000                               TO DP013-MESSAGE-TEXT (1)          04600001
046100          MOVE SQLCA                 TO DP013-SQLCA               04610001
046200          SET DP013-DB2-ABEND                                     04620001
046300              DP013-XCTL-DISPLAY-RESTART                          04630001
046400                               TO TRUE                            04640001
046500          PERFORM DP013-0000-PROCESS-ABEND                        04650001
046600      END-IF.                                                     04660001
046700                                                                  04670001
046800******************************************************************04680001
046900** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **04690001
047000** INTER-APPLICATION COMMAREA.                                  **04700001
047100******************************************************************04710001
047200 2110-PREPARE-INTER-APPL-COMM.                                    04720001
047300     INITIALIZE SU017-INTER-APPL-COMMAREA.                        04730002
047400     MOVE ASC-ENT-ID-N             TO SU017-ENT-ID.               04740002
047500     MOVE ASC-DEPT-NBR-N           TO SU017-DEPT-NBR.             04750002
047600     MOVE ASC-VENDOR-DESC          TO SU017-VENDOR-DESC.          04760002
047700     MOVE ASC-DEPT-DESC            TO SU017-DEPT-DESC.            04770012
047800 EJECT                                                            04780001
047900*----------------------------------------------------------------*04790001
048000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04800001
048100* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04810001
048200* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04820001
048300*----------------------------------------------------------------*04830001
048400                                                                  04840001
048500 2200-MOVE-SCREEN-TO-COMMAREA.                                    04850001
048600     IF  AVENDNML > ZERO                                          04860013
048700         MOVE AVENDNMI             TO ASC-VENDOR-DESC             04870013
048800     ELSE                                                         04880001
048900         IF  AVENDNMF = DP015-ERASE-EOF                           04890013
049000             MOVE SPACE            TO ASC-VENDOR-DESC             04900013
049100         END-IF                                                   04910001
049200     END-IF.                                                      04920001
049300                                                                  04930001
049400     IF  AENTIDL  > ZERO                                          04940013
049500         MOVE AENTIDI              TO ASC-ENT-ID                  04950013
049600     ELSE                                                         04960013
049700         IF  AENTIDF  = DP015-ERASE-EOF                           04970013
049800             MOVE SPACE            TO ASC-ENT-ID                  04980013
049900         END-IF                                                   04990013
050000     END-IF.                                                      05000013
050100                                                                  05010013
050200     IF  ADEPTNBL > ZERO                                          05020001
050300         MOVE ADEPTNBI             TO ASC-DEPT-NBR                05030005
050400     ELSE                                                         05040001
050500         IF  ADEPTNBF = DP015-ERASE-EOF                           05050001
050600             MOVE SPACE            TO ASC-DEPT-NBR                05060001
050700         END-IF                                                   05070001
050800     END-IF.                                                      05080001
050900                                                                  05090001
051000*----------------------------------------------------------------*05100001
051100* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *05110001
051200* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *05120001
051300* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*05130001
051400* IN THE DESTINATION PROGRAM, NOT HERE.                          *05140001
051500*----------------------------------------------------------------*05150001
051600                                                                  05160001
051700 3000-EDIT-DATA-IN-COMMAREA.                                      05170001
051800     PERFORM 3200-RESET-ATTRIBUTES.                               05180001
051900                                                                  05190002
052000     IF  ASC-ENT-ID > SPACE                                       05200013
052100         MOVE ASC-ENT-ID           TO DP010I-UNEDITED-FIELD       05210002
052200         MOVE LENGTH OF ASC-ENT-ID TO DP010I-MAXIMUM-DIGITS       05220002
052300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     05230002
052400         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  05240002
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05251027
263968              USING DP010I-NUMERIC-EDIT-AREA                      05252027
052600         IF  DP010I-ERROR-DETECTED                                05260002
052700             SET PS-ERROR                                         05270002
052800                 DP020-MSG-FATAL   TO TRUE                        05280002
052900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            05290002
053000             MOVE DP015-UNP-ALP-BRT-OFF                           05300002
053100                                   TO AENTIDA                     05310002
053200             MOVE DP015-RED        TO AENTIDC                     05320002
053300             MOVE DP015-REVERSE    TO AENTIDH                     05330002
053400             MOVE -1               TO AENTIDL                     05340002
053500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05350002
053600         ELSE                                                     05360002
053700             MOVE DP010I-NUMERIC-FIELD                            05370002
053800                                   TO ASC-ENT-ID-N                05380002
053900                                      DK-ENT-ID                   05390002
054000             MOVE ASC-ENT-ID-N     TO AENTIDO                     05400023
054100             PERFORM 3100-VALIDATE-ENT-ID                         05410002
054200             IF PS-NO-ENT-ID-FOUND                                05420002
054300                 SET PS-ERROR                                     05430002
054400                     DP020-MSG-FATAL   TO TRUE                    05440002
054500                 MOVE PC-TSYMSG-02850  TO DP020-MSG-NUMBER        05450002
054600                 MOVE DP015-UNP-ALP-BRT-OFF                       05460002
054700                                       TO AENTIDA                 05470002
054800                 MOVE DP015-RED        TO AENTIDC                 05480002
054900                 MOVE DP015-REVERSE    TO AENTIDH                 05490002
055000                 MOVE -1               TO AENTIDL                 05500002
055100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05510002
055200             END-IF                                               05520002
055300         END-IF                                                   05530002
055400     END-IF.                                                      05540002
055500                                                                  05550002
055600     IF  ASC-DEPT-NBR > SPACE AND PS-NO-ERROR                     05560002
055700         MOVE ASC-DEPT-NBR         TO DP010I-UNEDITED-FIELD       05570001
055800         MOVE LENGTH OF ASC-DEPT-NBR TO DP010I-MAXIMUM-DIGITS     05580001
055900         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     05590001
056000         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  05600001
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05611027
263968              USING DP010I-NUMERIC-EDIT-AREA                      05612027
056200         IF  DP010I-ERROR-DETECTED                                05620001
056300             SET PS-ERROR                                         05630001
056400                 DP020-MSG-FATAL   TO TRUE                        05640001
056500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            05650001
056600             MOVE DP015-UNP-ALP-BRT-OFF                           05660001
056700                                   TO ADEPTNBA                    05670001
056800             MOVE DP015-RED        TO ADEPTNBC                    05680001
056900             MOVE DP015-REVERSE    TO ADEPTNBH                    05690001
057000             MOVE -1               TO ADEPTNBL                    05700001
057100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05710001
057200         ELSE                                                     05720001
057300             MOVE DP010I-NUMERIC-FIELD                            05730001
057400                                   TO ASC-DEPT-NBR-N              05740001
057500             MOVE ASC-DEPT-NBR     TO ADEPTNBO                    05750006
057600             MOVE ASC-DEPT-NBR-X-3 TO DK-DEPT-NBR                 05760002
057700             PERFORM 3150-VALIDATE-DEPT                           05770002
057800             IF PS-NO-DEPT-FOUND                                  05780009
057900                 SET PS-ERROR                                     05790002
058000                     DP020-MSG-FATAL   TO TRUE                    05800002
058100                 MOVE PC-TSYMSG-00489  TO DP020-MSG-NUMBER        05810002
058200                 MOVE DP015-UNP-ALP-BRT-OFF                       05820002
058300                                       TO ADEPTNBA                05830002
058400                 MOVE DP015-RED        TO ADEPTNBC                05840002
058500                 MOVE DP015-REVERSE    TO ADEPTNBH                05850002
058600                 MOVE -1               TO ADEPTNBL                05860002
058700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05870002
058800             ELSE                                                 05880012
058900                 MOVE MDSEAR-DESC      TO ASC-DEPT-DESC           05890012
059000             END-IF                                               05900012
059100         END-IF                                                   05910001
059200     END-IF.                                                      05920001
059300                                                                  05930001
059400*                                                                 05940001
059500     IF  PS-NO-ERROR                                              05950001
059600         MOVE -1                   TO AVENDNML                    05960016
059700         SET DP030-SET-CURSOR-APPL-1                              05970001
059800                                   TO TRUE                        05980001
059900     END-IF.                                                      05990001
060000                                                                  06000001
060100*----------------------------------------------------------------*06010001
060200* CHECK IF ENT ID IS VALID                                       *06020001
060300*----------------------------------------------------------------*06030001
060400 3100-VALIDATE-ENT-ID.                                            06040001
060500                                                                  06050001
060600     EXEC SQL                                                     06060001
060700          SELECT ENT_NAME_DESC                                    06070001
060800            INTO :ENTNME-ENT-NAME-DESC                            06080001
060900            FROM TEXTENT A                                        06090001
061000                ,TENTNME B                                        06100001
061100           WHERE A.ENT_ID      = :DK-ENT-ID                       06110004
061200             AND A.ENT_ID = B.ENT_ID                              06120001
061300             AND A.STATUS_CDE  = 'A'                              06130010
061400             AND B.TYPE_CDE    = '01'                             06140008
P40473           WITH UR                                                06141026
061500     END-EXEC.                                                    06150001
061600                                                                  06160001
061700     EVALUATE TRUE                                                06170001
061800         WHEN SQLCODE = +0                                        06180001
061900         WHEN SQLCODE = -811                                      06190001
062000             SET PS-ENT-ID-FOUND TO TRUE                          06200001
062100             MOVE ENTNME-ENT-NAME-DESC                            06210001
062200                               TO ASC-VENDOR-DESC                 06220001
062300                                  AVENDNMO                        06230008
062400         WHEN SQLCODE = +100                                      06240001
062500             SET PS-NO-ENT-ID-FOUND TO TRUE                       06250001
062600             MOVE ALL '?'      TO ASC-VENDOR-DESC                 06260001
062700                                  AVENDNMO                        06270005
062800         WHEN SQLWARN0 NOT = SPACES                               06280001
062900         WHEN SQLCODE < +0                                        06290001
063000         WHEN SQLCODE > +0                                        06300001
063100             MOVE '3100-VALIDATE-ENT-ID'                          06310020
063200                             TO DP013-PARAGRAPH                   06320001
063300             MOVE 'SELECT SCAC CODE'                              06330001
063400                             TO DP013-MESSAGE-TEXT (1)            06340001
063500             MOVE SQLCA      TO DP013-SQLCA                       06350001
063600             MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)          06360001
063700             SET DP013-DB2-ABEND                                  06370001
063800                             TO TRUE                              06380001
063900             SET DP013-XCTL-DISPLAY-RESTART                       06390001
064000                             TO TRUE                              06400001
064100             PERFORM DP013-0000-PROCESS-ABEND                     06410001
064200     END-EVALUATE.                                                06420001
064300                                                                  06430001
064400 3150-VALIDATE-DEPT.                                              06440002
064500                                                                  06450002
064600     EXEC SQL                                                     06460002
064700         SELECT A.ENT_ID                                          06470012
064800             ,  B.MDSEAR_DESC                                     06480012
064900          INTO  :VNDDPT-ENT-ID                                    06490002
065000             ,  :MDSEAR-DESC                                      06500012
065100          FROM  TVNDDPT A                                         06510012
065200             ,  TMDSEAR B                                         06520012
065300          WHERE A.ENT_ID         = :DK-ENT-ID                     06530012
065400           AND  A.DEPT_NBR       = :DK-DEPT-NBR                   06540012
065500            AND A.DEPT_NBR       = B.DEPT_NBR                     06550012
065600            AND B.MDSELV_CDE     = 'DPT'                          06560012
065700            AND B.OPERCO_NBR     = '03'                           06570012
065800            AND (B.STRT_DTE     <= CURRENT DATE AND               06580012
065900                 B.END_DTE       > CURRENT DATE)                  06590012
066000     END-EXEC.                                                    06600002
066100                                                                  06610002
066200     EVALUATE TRUE                                                06620002
066300         WHEN SQLCODE = +0                                        06630002
066400             SET PS-DEPT-FOUND TO TRUE                            06640002
066500                                                                  06650002
066600         WHEN SQLCODE = +100                                      06660002
066700             SET PS-NO-DEPT-FOUND TO TRUE                         06670002
066800                                                                  06680002
066900         WHEN SQLWARN0 NOT = SPACE                                06690002
067000         WHEN SQLCODE < +0                                        06700002
067100         WHEN SQLCODE > +0                                        06710002
067200             MOVE '3150-VALIDATE-DEPT'                            06720002
067300                             TO DP013-PARAGRAPH                   06730002
067400             MOVE 'VALIDATE THE DEPT NUMBER'                      06740021
067500                             TO DP013-MESSAGE-TEXT (1)            06750002
067600             MOVE SQLCA      TO DP013-SQLCA                       06760002
067700             MOVE 'TVNDDPT'  TO DP013-DB2-TABLE-NAME (1)          06770002
067800             MOVE 'TMDSEAR'  TO DP013-DB2-TABLE-NAME (1)          06780021
067900             SET DP013-DB2-ABEND                                  06790005
068000                             TO TRUE                              06800005
068100             SET DP013-XCTL-DISPLAY-RESTART                       06810005
068200                             TO TRUE                              06820005
068300             PERFORM DP013-0000-PROCESS-ABEND                     06830005
068400     END-EVALUATE.                                                06840002
068500                                                                  06850002
068600******************************************************************06860001
068700** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **06870001
068800** MAP.                                                         **06880001
068900******************************************************************06890001
069000 3200-RESET-ATTRIBUTES.                                           06900001
069100     MOVE DP015-UNP-ALP-NOR-OFF    TO AENTIDA                     06910001
069200                                      AVENDNMA                    06920013
069300                                      ADEPTNBA.                   06930001
069400     MOVE DP015-GREEN              TO AENTIDC                     06940001
069500                                      AVENDNMC                    06950013
069600                                      ADEPTNBC.                   06960001
069700     MOVE DP015-UNDERLINE          TO AENTIDH                     06970001
069800                                      AVENDNMH                    06980013
069900                                      ADEPTNBH.                   06990001
070000*                                                                 07000001
070100*----------------------------------------------------------------*07010001
070200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *07020001
070300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *07030001
070400*  IT HERE.                                                      *07040001
070500*----------------------------------------------------------------*07050001
070600 4000-BUILD-INITIAL-PANEL.                                        07060001
070700     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        07070001
070800     MOVE -1                       TO AVENDNML.                   07080013
070900     MOVE SPACES                   TO ASC-DEPT-NBR                07090015
071000                                      ASC-ENT-ID                  07100015
071100                                      ASC-VENDOR-DESC.            07110015
071200*                                                                 07120001
071300*----------------------------------------------------------------*07130001
071400*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07140001
071500*----------------------------------------------------------------*07150001
071600 4400-MOVE-COMMAREA-TO-SCREEN.                                    07160001
071700     MOVE ASC-ENT-ID-N             TO AENTIDO.                    07170023
071800     MOVE ASC-DEPT-NBR             TO ADEPTNBO.                   07180002
071900     MOVE ASC-VENDOR-DESC          TO AVENDNMO.                   07190002
072000 EJECT                                                            07200001
072100*----------------------------------------------------------------*07210001
072200*    ABEND PROCESSOR MODULE                                      *07220001
072300*----------------------------------------------------------------*07230001
072400                                                                  07240001
072500     COPY DPPD013.                                                07250001
