000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'WMS SHIPMENT CONTROL MODULE - BATCH VERSION'.             00020002
000300*                                                                 00030002
000400 PROGRAM-ID.   WSKUP305.                                          00040000
000500 AUTHOR.        JEAN KURKOWSKI.                                   00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  FEBRUARY 2007.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000800*****************************************************             00080100
000800* THIS IS THE BATCH VERSION OF WSKCS305                           00081000
000800*****************************************************             00082000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER. IBM-3090.                                       00110000
001200 OBJECT-COMPUTER. IBM-3090.                                       00120000
001300                                                                  00130000
001400 DATA DIVISION.                                                   00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600 01  PV-VARIABLES.                                                00160000
001700     05  PV-CURRENT-TIMESTAMP         PIC X(26) VALUE SPACES.     00170000
002000     05  PV-SQL-RETURN-CD             PIC S9(04) VALUE +0.        00190000
002100     05  PV-CNT-CURSOR                PIC S9(09) COMP VALUE +0.   00200000
002200     05  PV-SHIPMNT-NBR               PIC X(20)  VALUE SPACES.    00210000
002300     05  PV-SHIPMNT-NBR-R REDEFINES PV-SHIPMNT-NBR.               00220000
002400         10  PV-K                     PIC X(1).                   00230000
002500         10  PV-RANDOM-NBR            PIC 9(09).                  00240000
002600         10  PV-D                     PIC X(1).                   00250000
002700         10  PV-DUMMY-NBR             PIC 9(04).                  00260000
002800         10  PV-UNUSED                PIC X(05).                  00270000
002830     05  PV-MSG-AREA                     PIC  X(100) VALUE SPACE. 00282001
002860     05  PV-CRTN-CNT                  PIC S9(09)  COMP.           00285000
002861     05  PV-UCC128-CRTN-CNT           PIC S9(09)  COMP.           00286000
002870     05  PV-UCC128-TOT-UNTS           PIC S9(09)  COMP.           00287000
002880     05  PV-UCC128-TOT-OTPK-QTYS      PIC S9(09)  COMP.           00288000
002890     05  PV-UCC128-OTPK-QTY           PIC S9(09)V COMP-3.         00289000
002900     05  PV-UCC128-LINES-PER-CRTN        PIC S9(09)V COMP-3.      00290000
003000     05  PV-TRANSCRIBE-SUM               PIC S9(09)  COMP         00300000
003010                                                     VALUE ZEROES.00301000
003100     05  PV-PROCESS-QTY                  PIC  9(05)  VALUE ZEROES.00302000
003200     05  PV-CARTON-COUNT-CALC            PIC  9(04).              00303000
003300     05  PV-CARTON-COUNT-REM             PIC  9(04).              00304000
003301     05  PV-EXPTED-ITM-QTY               PIC S9(09)  COMP.        00305000
003302                                                                  00306000
003303                                                                  00307000
003304 01  WS-FIELDS.                                                   00308000
003305     05  WS-EXT-SHP-ID                PIC X(20).                  00309000
003306     05  WS-OLD-EXT-SHP-ID            PIC X(20).                  00310000
003307     05  WS-NEW-EXT-SHP-ID            PIC X(20).                  00320000
003308     05  WS-TRIP-ID                   PIC S9(09) COMP.            00330000
003400     05  WS-DWNLD-TMST                PIC X(26).                  00340000
003500     05  WS-RCPT-TMST                 PIC X(26).                  00350000
003600     05  WS-DMY-SEQ-NBR               PIC S9(04) COMP.            00360000
003610     05  WS-OPER-UNT-ID               PIC S9(04) COMP.            00361000
003610     05  WS-SQL-CNT                   PIC S9(09) COMP.            00362000
003700     05  WS-PO-NBR                    PIC S9(09) COMP.            00363000
003800     05  WS-RCVR-SEQ-NBR              PIC S9(09) COMP.            00364000
003900     05  WS-PREPK-ID                  PIC S9(04) COMP.            00365000
004000     05  WS-PO-LNE-NBR                PIC S9(09) COMP.            00366000
004100     05  WS-PKGNG-CDE                 PIC X(01).                  00367000
004110     05  WS-DWNLD-CDE                 PIC X(01).                  00368000
004200     05  WS-HOLD-PO-NBR               PIC S9(09) COMP.            00369000
004300     05  WS-HOLD-RCVR-SEQ-NBR         PIC S9(09) COMP.            00370000
004400     05  WS-HOLD-EXT-SHP-ID           PIC X(20).                  00380000
004410     05  WS-ORIG-EXT-SHP-ID           PIC X(20).                  00390000
004500     05  WS-SHIPT-ID                  PIC S9(09) COMP VALUE +0.   00400000
004510     05  WS-DISPLAY-1                 PIC -Z(08)9.                00410000
004520     05  WS-DISPLAY-2                 PIC -Z(08)9.                00420000
004530     05  WS-DISPLAY-3                 PIC -Z(03)9.                00430000
004540     05  WS-DISPLAY-4                 PIC -Z(08)9.                00440000
004541     05  WS-DISPLAY-5                 PIC -Z(14)9.                00450000
004542     05  WS-DISPLAY-6                 PIC -Z(03)9.                00451000
004543     05  WS-DISPLAY-PO-NBR            PIC -Z(08)9.                00452000
004544     05  WS-DISPLAY-RCVR-NBR          PIC -Z(08)9.                00453000
004545     05  WS-DISPLAY-LNE-NBR           PIC -Z(08)9.                00454000
004600                                                                  00455000
004700 01  DK-KEYS.                                                     00456000
004800     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE +0.   00457000
004900     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   00458000
005000     05  DK-RCVR-SEQ-NBR              PIC S9(09) COMP VALUE +0.   00459000
005100     05  DK-PREPK-ID                  PIC S9(04) COMP VALUE +0.   00460000
005200     05  DK-SKU-NBR                   PIC S9(08)V COMP-3          00470000
005300                                                      VALUE +0.   00480000
005400     05  DK-PO-LNE-NBR                PIC S9(09) COMP VALUE +0.   00490000
005500     05  DK-SHIPT-ID                  PIC S9(09) COMP VALUE +0.   00500000
005600     05  DK-EXT-SHP-ID                PIC  X(20) VALUE SPACE.     00510000
005700                                                                  00520000
003791 01  DN-DB2-NULL-INDICATORS.                                      00521010
003792     05  DN-VEH-NBR                 PIC S9(04) COMP VALUE ZEROES. 00522010
005700                                                                  00523010
005800 01  PS-SWITCHES.                                                 00530000
005900     05  PS-FIRST-RECORD-SW          PIC X(01)  VALUE 'Y'.        00540000
006000         88  PS-FIRST-RECORD-YES                VALUE 'Y'.        00550000
006100         88  PS-FIRST-RECORD-NO                 VALUE 'N'.        00560000
006101     05  PS-FIRST-DUMMY-REC-SW       PIC X(01)  VALUE 'Y'.        00570000
006102         88  PS-FIRST-DUMMY-REC-YES             VALUE 'Y'.        00580000
006103         88  PS-FIRST-DUMMY-REC-NO              VALUE 'N'.        00590000
006200     05  PS-DUMMY-HEADER             PIC X(01)  VALUE 'N'.        00600000
006300         88  PS-DUMMY-HEADER-YES                VALUE 'Y'.        00610000
006400         88  PS-DUMMY-HEADER-NO                 VALUE 'N'.        00620000
006200     05  PS-HEADER-EXIST-SW          PIC X(01)  VALUE 'N'.        00621011
006300         88  PS-HEADER-EXIST-YES                VALUE 'Y'.        00622011
006400         88  PS-HEADER-EXIST-NO                 VALUE 'N'.        00623011
006500     05  PS-APPT-SENT                PIC X(01)  VALUE 'N'.        00630000
006600         88  PS-APPT-SENT-YES                   VALUE 'Y'.        00640000
006700         88  PS-APPT-SENT-NO                    VALUE 'N'.        00650000
006800     05  PS-CHECK-ASN                PIC X(01)  VALUE 'Y'.        00660000
006900         88  PS-CHECK-ASN-YES                   VALUE 'Y'.        00670000
007000         88  PS-CHECK-ASN-NO                    VALUE 'N'.        00680000
006800     05  PS-MANUAL-UPDATE            PIC X(01)  VALUE 'N'.        00681011
006900         88  PS-MANUAL-UPDATE-YES               VALUE 'Y'.        00682011
007000         88  PS-MANUAL-UPDATE-NO                VALUE 'N'.        00683011
006800     05  PS-ASN-NEW-HEADER           PIC X(01)  VALUE 'N'.        00684011
006900         88  PS-ASN-NEW-HDR-YES                 VALUE 'Y'.        00685011
007000         88  PS-ASN-NEW-HDR-NO                  VALUE 'N'.        00686011
007001     05  PS-MULT-ASN                 PIC X(01)  VALUE 'Y'.        00690000
007002         88  PS-MULT-ASN-YES                    VALUE 'Y'.        00700000
007003         88  PS-MULT-ASN-NO                     VALUE 'N'.        00701000
007100     05  PS-IMMED-DOWNLOAD           PIC X(01)  VALUE 'N'.        00702000
007200         88  PS-IMMED-DOWNLOAD-YES              VALUE 'Y'.        00703000
007300         88  PS-IMMED-DOWNLOAD-NO               VALUE 'N'.        00704000
007400     05  PS-PACK-BY-STORE            PIC X(01)  VALUE 'N'.        00705000
007500         88  PS-PACK-BY-STORE-YES               VALUE 'Y'.        00706000
007600         88  PS-PACK-BY-STORE-NO                VALUE 'N'.        00707000
007700     05  PS-PBS-CASE-INVALID         PIC X(01)  VALUE 'N'.        00708000
007800         88  PS-PBS-CASE-INVALID-YES            VALUE 'Y'.        00709000
007900         88  PS-PBS-CASE-INVALID-NO             VALUE 'N'.        00710000
008000     05  PS-EOF-TRIP-ID-CSR          PIC X(01)  VALUE 'N'.        00720000
008100         88  PS-EOF-TRIP-ID-CSR-YES             VALUE 'Y'.        00730000
008200         88  PS-EOF-TRIP-ID-CSR-NO              VALUE 'N'.        00740000
008000     05  PS-EOF-TRIP-INACT-CSR       PIC X(01)  VALUE 'N'.        00741018
008100         88  PS-EOF-TRIP-INACT-CSR-YES          VALUE 'Y'.        00742018
008200         88  PS-EOF-TRIP-INACT-CSR-NO           VALUE 'N'.        00743018
008000     05  PS-EOF-TRIP-DWNLD-CSR       PIC X(01)  VALUE 'N'.        00744030
008100         88  PS-EOF-TRIP-DWNLD-CSR-YES          VALUE 'Y'.        00745030
008200         88  PS-EOF-TRIP-DWNLD-CSR-NO           VALUE 'N'.        00746030
008300     05  PS-EOF-SHIP-TO-CSR          PIC X(01)  VALUE 'N'.        00750000
008400         88  PS-EOF-SHIP-TO-CSR-YES             VALUE 'Y'.        00760000
008500         88  PS-EOF-SHIP-TO-CSR-NO              VALUE 'N'.        00770000
008600     05  PS-EOF-HDR-CSR-1            PIC X(01)  VALUE 'N'.        00780000
008700         88  PS-EOF-HDR-CSR-1-YES               VALUE 'Y'.        00790000
008800         88  PS-EOF-HDR-CSR-1-NO                VALUE 'N'.        00800000
008900     05  PS-EOF-RECV-ITM-CSR         PIC X(01)  VALUE 'N'.        00810000
009000         88  PS-EOF-RECV-ITM-CSR-YES            VALUE 'Y'.        00820000
009100         88  PS-EOF-RECV-ITM-CSR-NO             VALUE 'N'.        00830000
009200     05  PS-EOF-RCVR-LINE-CSR        PIC X(01)  VALUE 'N'.        00840000
009300         88  PS-EOF-RCVR-LINE-CSR-YES           VALUE 'Y'.        00850000
009400         88  PS-EOF-RCVR-LINE-CSR-NO            VALUE 'N'.        00860000
009500     05  PS-EOF-PO-RCVR-CSR          PIC X(01)  VALUE 'N'.        00870000
009600         88  PS-EOF-PO-RCVR-CSR-YES             VALUE 'Y'.        00880000
009700         88  PS-EOF-PO-RCVR-CSR-NO              VALUE 'N'.        00890000
009500     05  PS-EOF-PO-RCVR-CSR2         PIC X(01)  VALUE 'N'.        00900000
009600         88  PS-EOF-PO-RCVR-CSR2-YES            VALUE 'Y'.        00910000
009700         88  PS-EOF-PO-RCVR-CSR2-NO             VALUE 'N'.        00920000
009800     05  PS-EOF-HDR-CSR-2            PIC X(01)  VALUE 'N'.        00930000
009900         88  PS-EOF-HDR-CSR-2-YES               VALUE 'Y'.        00940000
010000         88  PS-EOF-HDR-CSR-2-NO                VALUE 'N'.        00950000
010100     05  PS-EOF-SKU-CSR              PIC X(01)  VALUE 'N'.        00960000
010200         88  PS-EOF-SKU-CSR-YES                 VALUE 'Y'.        00970000
010300         88  PS-EOF-SKU-CSR-NO                  VALUE 'N'.        00980000
010400     05  PS-EOF-DTL-CSR-1            PIC X(01)  VALUE 'N'.        00990000
010500         88  PS-EOF-DTL-CSR-1-YES               VALUE 'Y'.        01000000
010600         88  PS-EOF-DTL-CSR-1-NO                VALUE 'N'.        01010000
010700     05  PS-EOF-ACTIVE-REC-CSR       PIC X(01)  VALUE 'N'.        01020000
010800         88  PS-EOF-ACTIVE-REC-CSR-YES          VALUE 'Y'.        01030000
010900         88  PS-EOF-ACTIVE-REC-CSR-NO           VALUE 'N'.        01040000
010910     05  PS-EOF-DUMMY-CSR            PIC X(01)  VALUE 'N'.        01050000
010920         88  PS-EOF-DUMMY-CSR-YES               VALUE 'Y'.        01060000
010930         88  PS-EOF-DUMMY-CSR-NO                VALUE 'N'.        01070000
011000     05  PS-LOG-SWITCH-IND           PIC X(01)  VALUE 'N'.        01080001
011100         88 PS-LOG-SWITCH-NO                    VALUE 'N'.        01090001
011200         88 PS-LOG-SWITCH-YES                   VALUE 'Y'.        01100001
011300     05  PS-LNE-UCC128-DATA-IND       PIC X(01) VALUE 'N'.        01110000
011400         88  PS-LNE-UCC128-DATA-YES             VALUE 'Y'.        01120000
011401         88  PS-LNE-UCC128-DATA-NO              VALUE 'N'.        01130000
011402     05  PS-PBS-CARTON-DATA-IND       PIC X(01) VALUE 'N'.        01140000
011403         88  PS-PBS-CARTON-DATA-YES             VALUE 'Y'.        01140100
011404         88  PS-PBS-CARTON-DATA-NO              VALUE 'N'.        01140200
011402     05  PS-TRIP-HDR-EXIST-SW         PIC X(01) VALUE 'N'.        01140300
011403         88  PS-TRIP-HDR-EXIST-YES              VALUE 'Y'.        01140400
011404         88  PS-TRIP-HDR-EXIST-NO               VALUE 'N'.        01140500
011402     05  PS-DISTRO-TRBL-SW            PIC X(01) VALUE 'N'.        01140600
011403         88  PS-DISTRO-TRBL-YES                 VALUE 'Y'.        01140700
011404         88  PS-DISTRO-TRBL-NO                  VALUE 'N'.        01140800
011402     05  PS-XREF-HDR-EXIST-SW         PIC X(01) VALUE 'N'.        01140900
011403         88  PS-XREF-HDR-EXIST-YES              VALUE 'Y'.        01141000
011404         88  PS-XREF-HDR-EXIST-NO               VALUE 'N'.        01141100
011402     05  PS-HEADER-CREATED-SW         PIC X(01) VALUE 'N'.        01141210
011403         88  PS-HEADER-CREATED-YES              VALUE 'Y'.        01141310
011404         88  PS-HEADER-CREATED-NO               VALUE 'N'.        01141410
011402     05  PS-DETAIL-CREATED-SW         PIC X(01) VALUE 'N'.        01141510
011403         88  PS-DETAIL-CREATED-YES              VALUE 'Y'.        01141610
011404         88  PS-DETAIL-CREATED-NO               VALUE 'N'.        01141710
003387     05  PS-VALID-TRIP-SW             PIC X(01) VALUE 'N'.        01141810
003388         88  PS-VALID-TRIP                      VALUE 'Y'.        01141910
003389         88  PS-VALID-TRIP-NO                   VALUE 'N'.        01142010
003387     05  PS-CANCEL-SHPMT-SW           PIC X(01) VALUE 'N'.        01142122
003388         88  PS-CANCEL-SHPMT-NO                 VALUE 'N'.        01142222
003389         88  PS-CANCEL-SHPMT-YES                VALUE 'Y'.        01142322
011405                                                                  01142400
011406 01  PC-CONSTANTS.                                                01142500
011700     05  PC-DEFAULT-NINES            PIC X(26)  VALUE             01142600
011800                              '9999-09-09-09.09.09.999999'.       01142700
011900     05  PC-RANDOM-NBR-GENERATOR     PIC X(08)  VALUE             01142800
012000                                                 'DPKUT902'.      01142900
012100     05  PC-CASEPACK-SPLIT-MOD       PIC X(08)  VALUE             01143000
012200                                                 'PCKUT719'.      01144000
012300     05  PC-DOWNLOAD-MOD             PIC X(08)  VALUE 'WSKUP301'. 01144107
012400/                                                                 01145000
012500* * *  RANDOM NUMBER AREA.                                        01146000
012600     COPY DPWS902.                                                01147000
012700* * *  DOWNLOAD MODULE AREA                                       01148000
012800     COPY WSWS003.                                                01149000
012900* * *  MINI CASEPACK SPLIT AREA                                   01150000
013000     COPY PCWS251.                                                01160000
033323                                                                  01210000
033324* * * COMMUNICATIONS AREA FOR DB2                                 01220000
033325     EXEC SQL                                                     01230000
033326          INCLUDE SQLCA                                           01240000
033327     END-EXEC.                                                    01250000
033328* * * WST_SHPMT_XREF_HDR VIEW - WMS SHIPMENT XREF HEADER          01260000
033329     EXEC SQL                                                     01270000
033330         INCLUDE WST00001                                         01280000
033331     END-EXEC.                                                    01290000
033332* * * WST_SHPMT_XREF_DTL VIEW - WMS SHIPMENT XREF DETAIL          01300000
033333     EXEC SQL                                                     01310000
033334         INCLUDE WST00002                                         01320000
033335     END-EXEC.                                                    01330000
033336* * * WST_INTGRTN_TYP VIEW                                        01340000
033337     EXEC SQL                                                     01350000
033338         INCLUDE WST00008                                         01360000
033339     END-EXEC.                                                    01370000
033340* * * WST_ATTR_DEFN VIEW                                          01380000
033341     EXEC SQL                                                     01390000
033342         INCLUDE WST00009                                         01400000
033343     END-EXEC.                                                    01410000
033344* * * WST_ATTR_ELEM VIEW                                          01420000
033345     EXEC SQL                                                     01430000
033346         INCLUDE WST00010                                         01440000
033347     END-EXEC.                                                    01450000
033348* * * XLT_SKU VIEW                                                01460000
033349     EXEC SQL                                                     01470000
033350         INCLUDE XLT00003                                         01480000
033351     END-EXEC.                                                    01490000
033352* * * TVHTRIP VIEW - VEHICLE TRIP TABLE                           01500000
033353     EXEC SQL                                                     01510000
033354         INCLUDE TVHTRIP                                          01520000
033355     END-EXEC.                                                    01530000
033356* * * TSHIPMT VIEW - SHIPMENT TABLE                               01540000
033357     EXEC SQL                                                     01550000
033358         INCLUDE TSHIPMT                                          01560000
033359     END-EXEC.                                                    01570000
033360* * * TSHPTPO VIEW - SHIPMENT PO TABLE                            01580000
033361     EXEC SQL                                                     01590000
033362         INCLUDE TSHPTPO                                          01600000
033363     END-EXEC.                                                    01610000
033364* * * TRECEIV VIEW - RECEIVER TABLE                               01620000
033365     EXEC SQL                                                     01630000
033366         INCLUDE TRECEIV                                          01640000
033367     END-EXEC.                                                    01650000
033368* * * TRECITM VIEW - RECEIVER ITEM TABLE                          01660000
033369     EXEC SQL                                                     01670000
033370         INCLUDE TRECITM                                          01680000
033371     END-EXEC.                                                    01690000
033372* * * TRECDIS VIEW - RECEIPT DISTRIBUTION TABLE                   01700000
033373     EXEC SQL                                                     01710000
033374         INCLUDE TRECDIS                                          01720000
033375     END-EXEC.                                                    01730000
033376* * * TPURITM VIEW - PURCHASE ORDER LINE ITEM TABLE               01740000
033377     EXEC SQL                                                     01750000
033378         INCLUDE TPURITM                                          01760000
033379     END-EXEC.                                                    01770000
033380* * * TPKSLIP VIEW - PACK SLIP HEADER TABLE                       01780000
033381     EXEC SQL                                                     01790000
033382         INCLUDE TPKSLIP                                          01800000
033383     END-EXEC.                                                    01810000
033384* * * TINPKSU VIEW - INBOUND EDI PACKLIST/VENDOR SHIPMENT         01820000
033385     EXEC SQL                                                     01830000
033386         INCLUDE TINPKSU                                          01840000
033387     END-EXEC.                                                    01850000
033388* * * TSHUNLO VIEW - SHIPMENT UNIT LOCATION                       01860000
033389     EXEC SQL                                                     01870000
033390         INCLUDE TSHUNLO                                          01880000
033391     END-EXEC.                                                    01890000
033392* * * TSHUUPC VIEW - STATUS TYPE TABLE                            01900000
033393     EXEC SQL                                                     01910000
033394         INCLUDE TSHUUPC                                          01920000
033395     END-EXEC.                                                    01930000
033396                                                                  01940000
033397                                                                  01950000
033398**DECLARE THE TRIP_ID_CSR                                         01960000
033399     EXEC SQL                                                     01970000
033400          DECLARE TRIP-ID-CSR CURSOR FOR                          01980000
033401           SELECT  DISTINCT                                       01990000
033402                   H.EXT_SHP_ID                                   02000000
033403                  ,H.DWNLD_TMST                                   02010000
033404                  ,H.DMY_SEQ_NBR                                  02020000
033405                  ,H.CRE_TMST                                     02030000
033406           FROM    WST_SHPMT_XREF_HDR H                           02040000
033407                  ,WST_SHPMT_XREF_DTL D                           02050000
033408           WHERE   H.EXT_SHP_ID = D.EXT_SHP_ID                    02060000
033409           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   02070000
033410           AND     D.PO_NBR       = :DK-PO-NBR                    02080000
033411           AND     D.RCVR_SEQ_NBR = :DK-RCVR-SEQ-NBR              02090000
033411           AND     D.ACTV_CDE     = 'A'                           02091010
033412           ORDER BY H.CRE_TMST                                    02100000
033413     END-EXEC.                                                    02110000
033414                                                                  02120000
033415**DECLARE THE HDR_CSR_1                                           02130000
033416     EXEC SQL                                                     02140000
033417          DECLARE HDR-CSR-1 CURSOR FOR                            02150000
033418           SELECT  EXT_SHP_ID                                     02160000
033419                 , DWNLD_TMST                                     02170000
033420           FROM    WST_SHPMT_XREF_HDR                             02180000
033421           WHERE   INTR_TRIP_ID = :DK-TRIP-ID                     02190000
033422           AND     SOR_CDE      = 'RC'                            02200000
033423           AND     RCPT_TMST    = :PC-DEFAULT-NINES               02210000
033424     END-EXEC.                                                    02220000
033425                                                                  02230000
033426**DECLARE THE HDR_CSR_2                                           02240000
033427     EXEC SQL                                                     02250000
033428          DECLARE HDR-CSR-2 CURSOR FOR                            02260000
033429           SELECT  EXT_SHP_ID                                     02270000
033430           FROM    WST_SHPMT_XREF_HDR                             02280000
033431           WHERE   INTR_TRIP_ID = :DK-TRIP-ID                     02290000
033432           AND     SOR_CDE      = 'RC'                            02300000
033433           AND     RCPT_TMST    = :PC-DEFAULT-NINES               02310000
033433           AND     DWNLD_CDE   <> 'X'                             02311017
033434     END-EXEC.                                                    02320000
033435                                                                  02330000
033436**DECLARE THE SHIP_TO_CSR                                         02340000
033437     EXEC SQL                                                     02350000
033438          DECLARE SHIP-TO-CSR CURSOR FOR                          02360000
033439           SELECT  PO_NBR                                         02370000
033440                  ,REC_SEQ_NBR                                    02380000
033441           FROM    TSHPTPO                                        02390000
033442           WHERE   SHIPT_ID     = :DK-SHIPT-ID                    02400000
033443           AND     REC_SEQ_NBR  > 0                               02410000
033444     END-EXEC.                                                    02420000
033445                                                                  02430000
033446**DECLARE THE PO_RCVR_CSR                                         02440000
033447     EXEC SQL                                                     02450000
033448          DECLARE PO-RCVR-CSR CURSOR FOR                          02460000
033449           SELECT  DISTINCT                                       02470000
033450                   C.PO_NBR                                       02480000
033451                 , C.REC_SEQ_NBR                                  02490000
033452           FROM    TVHTRIP A                                      02500000
033453                 , TSHIPMT B                                      02510000
033454                 , TSHPTPO C                                      02520000
033455                 , TRECEIV D                                      02530000
033456           WHERE   A.TRIP_ID        = :DK-TRIP-ID                 02540000
033457           AND     A.TRIP_ID        = B.TRIP_ID                   02550000
033458           AND     C.SHIPT_ID       = B.SHIPT_ID                  02560000
033459           AND     C.PO_NBR         = D.ORD_NBR                   02570000
033460           AND     C.REC_SEQ_NBR    = D.REC_SEQ_NBR               02580000
033461           AND     D.VER_STATUS_CDE = 'A'                         02590000
033462           ORDER BY C.PO_NBR, C.REC_SEQ_NBR                       02600000
033463     END-EXEC.                                                    02610000
033464                                                                  02620000
033446**DECLARE THE PO_RCVR_CSR2                                        02630000
033447     EXEC SQL                                                     02640000
033448          DECLARE PO-RCVR-CSR2 CURSOR FOR                         02650000
033449           SELECT  DISTINCT                                       02660000
033450                   C.PO_NBR                                       02670000
033451                 , C.REC_SEQ_NBR                                  02680000
033454           FROM    TSHPTPO C                                      02690000
033455                 , TRECEIV D                                      02700000
033458           WHERE   C.SHIPT_ID       = :DK-SHIPT-ID                02710000
033459           AND     C.PO_NBR         = D.ORD_NBR                   02720000
033460           AND     C.REC_SEQ_NBR    = D.REC_SEQ_NBR               02730000
033461           AND     D.VER_STATUS_CDE = 'A'                         02740000
033462           ORDER BY C.PO_NBR, C.REC_SEQ_NBR                       02750000
033463     END-EXEC.                                                    02760000
033464                                                                  02770000
033465**DECLARE THE RECV_ITM_CSR                                        02780000
033466     EXEC SQL                                                     02790000
033467          DECLARE RECV-ITM-CSR CURSOR FOR                         02800000
033468           SELECT  ORD_LNE_NBR                                    02810000
033469           FROM    TRECITM                                        02820000
033470           WHERE   ORD_NBR        = :DK-PO-NBR                    02830000
033471           AND     REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              02840000
033472           AND     PREPK_ID       = :DK-PREPK-ID                  02850000
033473           AND     VER_STATUS_CDE = 'A'                           02860000
033474     END-EXEC.                                                    02870000
033475                                                                  02880000
033476**DECLARE THE RCVR_LINE_CSR                                       02890000
033477     EXEC SQL                                                     02900000
033478          DECLARE RCVR-LINE-CSR CURSOR FOR                        02910000
033479           SELECT  ORD_LNE_NBR                                    02920000
033480                 , PREPK_ID                                       02930000
033481           FROM    TRECITM                                        02940000
033482           WHERE   ORD_NBR        = :DK-PO-NBR                    02950000
033483           AND     REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              02960000
033484           AND     VER_STATUS_CDE = 'A'                           02970000
033485           ORDER BY PREPK_ID, ORD_LNE_NBR                         02980000
033486     END-EXEC.                                                    02990000
033487                                                                  03000000
033488**DECLARE THE SKU_CSR                                             03010000
033489     EXEC SQL                                                     03020000
033490          DECLARE SKU-CSR CURSOR FOR                              03030000
033491           SELECT  DISTINCT                                       03040000
033492                   B.PO_NBR                                       03050000
033493                 , D.SKU_NBR                                      03060000
033494           FROM    WST_SHPMT_XREF_DTL B                           03070000
033495                 , TPURITM C                                      03080000
033496                 , XLT_SKU D                                      03090000
033497           WHERE   B.EXT_SHP_ID     = :DK-EXT-SHP-ID              03100000
033498           AND     B.PO_NBR         = C.PO_NBR                    03110000
033499           AND     B.PO_LNE_NBR     = C.APP_PO_LNE_NBR            03120015
033500           AND     C.ITM_NBR        = D.ITM_NBR                   03130000
033501           AND     C.VER_STATUS_CDE = 'A'                         03140000
033536           AND     B.ACTV_CDE       = 'A'                         03141017
033502           GROUP BY B.PO_NBR, D.SKU_NBR                           03150000
033503     END-EXEC.                                                    03160000
033504                                                                  03170000
033505**DECLARE THE DTL_CSR_1                                           03180000
033506     EXEC SQL                                                     03190000
033507          DECLARE DTL-CSR-1 CURSOR FOR                            03200000
033508           SELECT  B.PO_NBR                                       03210000
033509                 , B.RCVR_SEQ_NBR                                 03220000
033510                 , B.PO_LNE_NBR                                   03230000
033511                 , B.PREPK_ID                                     03240000
033512           FROM    WST_SHPMT_XREF_DTL B                           03250000
033513                 , TPURITM C                                      03260000
033514                 , XLT_SKU D                                      03270000
033515           WHERE   B.EXT_SHP_ID     = :DK-EXT-SHP-ID              03280000
033516           AND     D.SKU_NBR        = :DK-SKU-NBR                 03290000
033517           AND     B.PO_NBR         = C.PO_NBR                    03300000
033518           AND     B.PO_LNE_NBR     = C.APP_PO_LNE_NBR            03310015
033519           AND     C.ITM_NBR        = D.ITM_NBR                   03320000
033520           AND     C.VER_STATUS_CDE = 'A'                         03330000
033521           AND     B.ASN_LVL_CDE    = 'C'                         03340000
033536           AND     B.ACTV_CDE       = 'A'                         03341017
033522     END-EXEC.                                                    03350000
033523                                                                  03351000
033524**DECLARE THE ACTIVE_REC_CSR                                      03352000
033525     EXEC SQL                                                     03353000
033526          DECLARE ACTIVE-REC-CSR CURSOR FOR                       03354000
033527           SELECT  PO_NBR                                         03354100
033528                 , RCVR_SEQ_NBR                                   03354200
033529                 , PO_LNE_NBR                                     03354300
033530                 , PREPK_ID                                       03354400
033531           FROM    WST_SHPMT_XREF_DTL                             03354500
033532           WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                03354600
033533           AND     PO_NBR         = :DK-PO-NBR                    03354700
033534           AND     PREPK_ID       = :DK-PREPK-ID                  03354800
033535           AND     RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              03354900
033536           AND     ACTV_CDE       = 'A'                           03355000
033537     END-EXEC.                                                    03355100
033538                                                                  03355200
033539**DECLARE THE DUMMY_CSR                                           03355300
033540     EXEC SQL                                                     03355400
033541          DECLARE DUMMY-CSR CURSOR FOR                            03355500
033542           SELECT  PO_NBR                                         03355600
033544                 , PO_LNE_NBR                                     03355700
033545                 , RCVR_SEQ_NBR                                   03355800
033546                 , PREPK_ID                                       03355900
033547                 , ASN_LVL_CDE                                    03356000
033550                 , DWNLD_CDE                                      03356100
033551                 , ACTV_CDE                                       03356200
033552           FROM    WST_SHPMT_XREF_DTL                             03356300
033553           WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                03356400
033554           AND     DWNLD_CDE     <> 'D'                           03356500
033555     END-EXEC.                                                    03356600
033556                                                                  03356700
033398**DECLARE THE TRIP_INACT_CSR                                      03356818
033399     EXEC SQL                                                     03356918
033400          DECLARE TRIP-INACT-CSR CURSOR FOR                       03357018
033401           SELECT  DISTINCT                                       03357118
033402                   H.EXT_SHP_ID                                   03357218
033406           FROM    WST_SHPMT_XREF_HDR H                           03357318
033407                  ,WST_SHPMT_XREF_DTL D                           03357418
033408           WHERE   H.EXT_SHP_ID = D.EXT_SHP_ID                    03357518
033409           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   03357618
033410           AND     D.PO_NBR       = :DK-PO-NBR                    03357718
033411           AND     D.RCVR_SEQ_NBR = :DK-RCVR-SEQ-NBR              03357818
033411           AND     D.ACTV_CDE     = 'I'                           03357918
232800           AND NOT EXISTS                                         03358018
232400              (SELECT *                                           03358118
232500               FROM   WST_SHPMT_XREF_DTL A                        03358218
232800               WHERE  D.EXT_SHP_ID   = A.EXT_SHP_ID               03358318
232800               AND    A.ACTV_CDE     = 'A')                       03358418
033413     END-EXEC.                                                    03358518
033414                                                                  03358618
033398**DECLARE THE TRIP-DWNLD-CSR                                      03358730
033399     EXEC SQL                                                     03358830
033400          DECLARE TRIP-DWNLD-CSR CURSOR FOR                       03358930
033402           SELECT  DISTINCT H.EXT_SHP_ID                          03359031
033406           FROM    WST_SHPMT_XREF_HDR H                           03359130
033407                  ,WST_SHPMT_XREF_DTL D                           03359230
033408           WHERE   H.EXT_SHP_ID = D.EXT_SHP_ID                    03359330
033409           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   03359430
033410           AND     D.PO_NBR       = :DK-PO-NBR                    03359530
033411           AND     D.RCVR_SEQ_NBR = :DK-RCVR-SEQ-NBR              03359630
033433           AND     H.DWNLD_TMST  <> :PC-DEFAULT-NINES             03359730
033413     END-EXEC.                                                    03359830
033414                                                                  03359930
033414                                                                  03360018
033566 LINKAGE SECTION.                                                 03360118
013100* * *  COMMAREA                                                   03360218
033320     COPY WSWS001.                                                03360318
033565******************************************************************03360418
033566 PROCEDURE DIVISION USING WS001-FIELDS.                           03360518
033567******************************************************************03360618
033568 0000-PROGRAM-MAINLINE.                                           03360718
033569                                                                  03360818
033574     INITIALIZE PV-MSG-AREA.                                      03360918
033575     STRING   ' ' WS001-SRC-TASK-NUMBER                           03361018
033576              ' WSKUP305 CALLED FROM '                            03361118
033577              WS001-CALLING-PROGRAM-NAME                          03361218
033578              DELIMITED BY SIZE                                   03361318
033579                                 INTO PV-MSG-AREA.                03361418
033580     PERFORM 7000-WRITE-TO-LOG.                                   03361518
033590                                                                  03361618
034300     PERFORM 0500-INITIALIZE.                                     03361718
034400     MOVE WS001-TRIP-ID               TO DK-TRIP-ID               03361818
034500                                         WS-TRIP-ID.              03361918
034600     MOVE WS001-PO-NBR                TO WS-PO-NBR                03362018
034700                                         DK-PO-NBR.               03362118
034800     MOVE WS001-RCVR-NBR              TO WS-RCVR-SEQ-NBR          03362218
034900                                         DK-RCVR-SEQ-NBR.         03362318
035000     MOVE WS001-PO-LNE-NBR            TO WS-PO-LNE-NBR            03363018
035100                                         DK-PO-LNE-NBR.           03370000
035200     MOVE WS001-PREPK-ID              TO WS-PREPK-ID              03380000
035300                                         DK-PREPK-ID.             03390000
035400     MOVE WS001-KOHLS-SHIPT-ID        TO WS-SHIPT-ID              03400000
035500                                         DK-SHIPT-ID.             03410000
035520     MOVE WS001-EXT-SHP-ID            TO DK-EXT-SHP-ID            03420000
035521                                         WS-EXT-SHP-ID.           03430000
035530     MOVE WS001-OPER-UNT-ID           TO WS-OPER-UNT-ID.          03440000
035600                                                                  03450000
035610     IF PS-LOG-SWITCH-YES                                         03460001
035700         INITIALIZE PV-MSG-AREA                                   03470001
035800         STRING   ' ' WS001-SRC-TASK-NUMBER                       03480000
035900                  ' WSKUP305-0000'                                03490000
036100                  ' FUNCTION IND='                                03500000
036200                  WS001-FUNCTION-IND                              03510000
036300                  DELIMITED BY SIZE                               03520000
036400                                 INTO PV-MSG-AREA                 03530001
036500         PERFORM 7000-WRITE-TO-LOG                                03540001
036600     END-IF.                                                      03550000
036700                                                                  03560000
036700* MAKE SURE THAT THE TRIP-ID IS SENT IN (IT SHOULD BE)            03570000
036700* IF NOT, THEN GET IT FROM THE SHIPT-ID                           03571010
036700* THE ONLY TRANSACTION WHERE WE DEFINATELY DO NOT HAVE A TRIP-ID  03572010
036700* IS THE CREATE-DUMMY TRANSACTIONS                                03573010
057902                                                                  03574010
057800     IF DK-TRIP-ID = 0                                            03580000
057900        PERFORM 2070-GET-TRIP-ID                                  03590000
057901     END-IF.                                                      03600000
057902                                                                  03610000
036700* MAKE SURE THAT THE TRIP IS NOT A DUMMY TRIP.  IF THE VEH-NBR    03611010
036700* IS LOADED ON THE TVHTRIP TABLE, THIS IS AN ACTUAL TRIP.         03612010
036700* RETURN TO CALLING PROGRAM FOR DUMMY TRIPS.                      03613010
044645                                                                  03614010
057900     PERFORM 2080-SELECT-TVHTRIP.                                 03615010
057800     IF PS-VALID-TRIP-NO                                          03616010
044642         SET WS001-SUCCESSFUL TO TRUE                             03617010
044642         PERFORM 9990-RETURN                                      03618010
057901     END-IF.                                                      03619010
044645                                                                  03620000
036700                                                                  03630000
044604     EVALUATE TRUE                                                03640000
044605         WHEN WS001-INSERT                                        03650000
044606             PERFORM 1000-INSERT                                  03660000
044607         WHEN WS001-SHIPMT-DETACH                                 03670000
044608             PERFORM 2000-SHIPMT-DETACH                           03680000
044609         WHEN WS001-PKSLIP-INACTIVE                               03690000
044610             PERFORM 3000-PKSLIP-INACTIVE                         03700000
044611         WHEN WS001-MANUAL-DOWNLOAD                               03710000
044612             PERFORM 4000-MANUAL-DOWNLOAD                         03720000
044613         WHEN WS001-CREATE-DUMMY                                  03730000
044614             PERFORM 8000-CREATE-DUMMY                            03740000
044615         WHEN OTHER                                               03750000
044616             SET WS001-ERROR              TO TRUE                 03760000
044617             MOVE '0000-PROGRAM-MAINLINE' TO WS001-PARAGRAPH-NAME 03770000
044619             MOVE 'UNKNOWN FUNCTION IND'  TO WS001-CRA-RET-MSG    03790000
044622             PERFORM 9999-ABEND                                   03820000
044623     END-EVALUATE.                                                03830000
044625                                                                  03830110
044625* IF A HEADER WAS CREATED, BUT NO DETAIL RECORDS WERE ADDED,      03831010
044625* THEN CHANGE THE DWNLD_CDE ON THE HEADER TO 'X'.                 03832010
044625* TURN OFF THE CHECK ASN INDICATOR                                03833010
044625* TURN OFF THE IMMED DOWNLOAD INDICATOR                           03834010
044625* NOTE:  THE ACTUAL UPDATE WILL NOW BE DOWN IN WSKUP302           03834122
044625                                                                  03835010
044625     IF PS-HEADER-CREATED-YES                                     03836010
044625        AND PS-DETAIL-CREATED-NO                                  03837010
044625*        MOVE WS-EXT-SHP-ID         TO DK-EXT-SHP-ID              03838022
044625*        PERFORM 2110-UPDATE-HDR-X                                03839022
044625         SET PS-CANCEL-SHPMT-YES    TO TRUE                       03839122
044625         SET PS-CHECK-ASN-NO        TO TRUE                       03839210
044625         SET PS-IMMED-DOWNLOAD-YES  TO TRUE                       03839328
044625     END-IF.                                                      03839428
044625                                                                  03839528
044626     IF PS-CHECK-ASN-YES                                          03850000
044627         SET PS-FIRST-DUMMY-REC-YES TO TRUE                       03860000
044628         PERFORM 5800-CHECK-ASN                                   03870000
044629     END-IF.                                                      03880000
044630                                                                  03890000
044631     IF PS-IMMED-DOWNLOAD-YES                                     03921010
044631**       IF A SECOND HEADER RECORD WAS CREATED TO SPLIT OUT       03922010
044631**       A SHIPMENT, THEN BOTH HAVE TO BE SENT TO WMS             03923010
044631         IF PS-ASN-NEW-HDR-YES                                    03924010
044632             MOVE WS-OLD-EXT-SHP-ID    TO WS-EXT-SHP-ID           03925010
044632             PERFORM 5700-CALL-DOWNLOAD-MOD                       03926010
044632             MOVE WS-NEW-EXT-SHP-ID    TO WS-EXT-SHP-ID           03927010
044632         END-IF                                                   03928010
044632         PERFORM 5700-CALL-DOWNLOAD-MOD                           03929010
044633     END-IF.                                                      03929110
044634                                                                  03930000
044635     PERFORM 9990-RETURN.                                         03940010
044645                                                                  04040000
044646/                                                                 04050000
044650 0500-INITIALIZE.                                                 04060000
045921     MOVE '0500-INITIALIZE'      TO WS001-PARAGRAPH-NAME.         04070000
045940                                                                  04080000
045941     SET WS001-SUCCESSFUL        TO TRUE.                         04090000
045942     INITIALIZE DCLWST00001                                       04100000
045943                DCLWST00002                                       04110000
045944                DCLXLT00003                                       04120000
045945                DCLTVHTRIP                                        04130000
045946                DCLTSHIPMT                                        04140000
045947                DCLTSHPTPO                                        04150000
045948                DCLTRECEIV                                        04160000
045949                DCLTRECITM                                        04170000
045950                DCLTPURITM                                        04180000
045951                DCLTPKSLIP                                        04190000
045952                DCLTINPKSU                                        04200000
045953                DCLTSHUNLO.                                       04210000
045954     INITIALIZE PV-VARIABLES.                                     04220000
045955     INITIALIZE PS-SWITCHES.                                      04230000
045956     SET PS-CHECK-ASN-YES        TO TRUE.                         04251010
045956     SET PS-ASN-NEW-HDR-NO       TO TRUE.                         04252010
045956     SET PS-HEADER-EXIST-NO      TO TRUE.                         04253010
045957     SET PS-IMMED-DOWNLOAD-NO    TO TRUE.                         04254010
045957     SET PS-HEADER-CREATED-NO    TO TRUE.                         04255010
045957     SET PS-DETAIL-CREATED-NO    TO TRUE.                         04256010
045957     SET PS-CANCEL-SHPMT-NO      TO TRUE.                         04257022
045958                                                                  04260000
045959     PERFORM 0510-GET-CURRENT-TIMESTAMP.                          04270000
045960     PERFORM 0520-CHECK-LOGGING.                                  04280002
045961                                                                  04290000
045962/                                                                 04300000
045963 0510-GET-CURRENT-TIMESTAMP.                                      04310000
045964                                                                  04320000
045965     MOVE '0510-GET-CURRENT-TIMESTAMP'                            04330000
045966                                 TO WS001-PARAGRAPH-NAME.         04340000
045967                                                                  04350000
045968     EXEC SQL                                                     04360000
045969         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            04370000
045970     END-EXEC.                                                    04380000
045971                                                                  04390000
045972/                                                                 04400000
045973 0520-CHECK-LOGGING.                                              04410002
045974                                                                  04420000
045975     MOVE '0520-CHECK-LOGGING'    TO WS001-PARAGRAPH-NAME.        04430002
045976                                                                  04440000
045977* READ PARM TO DETERMINE LOGGING                                  04450002
045978     EXEC SQL                                                     04460000
045979         SELECT  D.ATTR_ELEM_TXT                                  04470000
045980         INTO  :PS-LOG-SWITCH-IND                                 04480001
045981         FROM   WST_INTGRTN_TYP A                                 04490000
045982              , WST_ATTR_DEFN   B                                 04500000
045983              , WST_ATTR_ELEM   C                                 04510000
045984              , WST_ATTR_ELEM   D                                 04520000
045985         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   04530000
045986           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           04540000
045987           AND  B.ATTR_DEFN_SEQ_NBR = 1                           04550000
045988           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           04560000
045989           AND  C.ATTR_DEFN_SEQ_NBR = 1                           04570000
045990           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           04580000
045991           AND  D.ATTR_DEFN_SEQ_NBR = 2                           04590000
045992           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         04591000
045993           AND  C.ATTR_ELEM_TXT     = 'WSKUP305'                  04592000
045994     END-EXEC.                                                    04593000
045995                                                                  04594000
045996     EVALUATE TRUE                                                04595000
045997         WHEN SQLCODE = ZERO                                      04596000
045998             IF PS-LOG-SWITCH-YES                                 04597001
045999                 INITIALIZE PV-MSG-AREA                           04598001
046000                 STRING   ' ' WS001-SRC-TASK-NUMBER               04599000
046001                          ' WSKUP305-0520:'                       04600000
046002                          ' LOGGING: '                            04600102
046003                          PS-LOG-SWITCH-IND                       04600201
046004                          DELIMITED BY SIZE                       04600300
046005                          INTO PV-MSG-AREA                        04600401
046006                 PERFORM 7000-WRITE-TO-LOG                        04600501
046007             END-IF                                               04600600
046008         WHEN SQLCODE = -904                                      04600700
046009         WHEN SQLCODE = -913                                      04600800
046010         WHEN SQLCODE = -911                                      04600900
046011         WHEN SQLCODE = -803                                      04601000
046012             CONTINUE                                             04601100
046013         WHEN SQLWARN0 NOT = SPACES                               04601200
046014         WHEN SQLCODE NOT = ZERO                                  04601300
046015             INITIALIZE PV-MSG-AREA                               04601401
046016             MOVE SQLCODE               TO PV-SQL-RETURN-CD       04601500
046017             STRING   ' ' WS001-SRC-TASK-NUMBER                   04601600
046018                      ' WSKUP305-0520 ERROR:'                     04601700
046019                      ' SQL='                                     04601800
046020                      PV-SQL-RETURN-CD                            04601900
046021                      DELIMITED BY SIZE                           04602000
046022                                      INTO PV-MSG-AREA            04602101
046023             PERFORM 7000-WRITE-TO-LOG                            04602201
046024                                                                  04602300
046025             SET WS001-INVALID-SQL      TO TRUE                   04602400
046028             STRING 'SQL='                                        04602500
046029                  PV-SQL-RETURN-CD                                04602600
046030                  DELIMITED BY SIZE                               04602700
046031                                      INTO WS001-CRA-RET-MSG      04602800
046033             MOVE SQLCA                 TO WS001-SQLCA            04603000
046043             PERFORM 9999-ABEND                                   04604000
046044                                                                  04605000
047700     END-EVALUATE.                                                04606000
047800                                                                  04607000
047900/                                                                 04608000
048000 1000-INSERT.                                                     04609000
048001                                                                  04610000
048002     MOVE '1000-INSERT'          TO WS001-PARAGRAPH-NAME.         04620000
048003                                                                  04630000
048500* CHECK TO SEE IF THE TRIP-ID EXISTS ON THE HEADER                04640000
049400                                                                  04650000
049500     EXEC SQL                                                     04660000
049600         SELECT EXT_SHP_ID                                        04670000
049700            ,   DWNLD_TMST                                        04680000
049700            ,   DWNLD_CDE                                         04690000
049800            ,   RCPT_TMST                                         04700000
049900         INTO  :WST00001-EXT-SHP-ID                               04710000
050000            ,  :WST00001-DWNLD-TMST                               04720000
050000            ,  :WST00001-DWNLD-CDE                                04730000
050100            ,  :WST00001-RCPT-TMST                                04740000
050200         FROM  WST_SHPMT_XREF_HDR                                 04750000
050300        WHERE  INTR_TRIP_ID   = :DK-TRIP-ID                       04760000
050400          AND  SOR_CDE = 'RC'                                     04770000
050500     END-EXEC.                                                    04780000
050600                                                                  04790000
050700     EVALUATE TRUE                                                04800000
050800         WHEN SQLCODE = ZERO                                      04810000
050900* 1 RECORD ON TABLE                                               04820000
051000             MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID            04830000
051100                                         DK-EXT-SHP-ID            04840000
051200             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            04850000
051300             MOVE WST00001-RCPT-TMST  TO WS-RCPT-TMST             04860000
051300             MOVE WST00001-DWNLD-CDE  TO WS-DWNLD-CDE             04870000
051400             IF PS-LOG-SWITCH-YES                                 04880001
051401                 INITIALIZE PV-MSG-AREA                           04890001
051401                 MOVE DK-TRIP-ID TO WS-DISPLAY-1                  04891010
051410                 STRING   ' ' WS001-SRC-TASK-NUMBER               04900000
051500                          ' WSKUP305-1000:'                       04910010
051600                          ' SHPMT: '                              04920000
051700                          WS-EXT-SHP-ID                           04930000
051800                          ' TRIP: ' WS-DISPLAY-1                  04940010
052200                          DELIMITED BY SIZE                       04980000
052300                          INTO PV-MSG-AREA                        04990001
052400                 PERFORM 7000-WRITE-TO-LOG                        05000001
052500             END-IF                                               05010000
054200             SET PS-HEADER-EXIST-YES    TO TRUE                   05011010
052600             PERFORM 5200-EVAL-SHIP-STATUS                        05020000
052700         WHEN SQLCODE = +100                                      05030000
052800* NO RECORDS ON TABLE                                             05040000
052900*    CREATE THE RECORDS NOW                                       05050000
053000             MOVE WS-TRIP-ID           TO WST00001-INTR-TRIP-ID   05060000
053100             MOVE 0                    TO WST00001-DMY-SEQ-NBR    05070000
053110             MOVE 'N'                  TO WS-DWNLD-CDE            05080000
053200             SET PS-DUMMY-HEADER-NO    TO TRUE                    05090000
053300             PERFORM 5000-INSERT-HEADER                           05100000
053400                                                                  05110000
053500             PERFORM 5100-INSERT-DETAIL                           05120000
053600         WHEN SQLCODE = -811                                      05130000
053700* MULTIPLE RECORDS ON TABLE                                       05140000
053800*    THERE IS ALREADY A DUMMY RECORD                              05150000
053900             MOVE WST00001-EXT-SHP-ID   TO WS-EXT-SHP-ID          05160000
054000             MOVE WST00001-DWNLD-TMST   TO WS-DWNLD-TMST          05170000
054200             SET PS-HEADER-EXIST-YES    TO TRUE                   05180010
054200             SET PS-DUMMY-HEADER-YES    TO TRUE                   05190000
054210             MOVE 'N'                   TO WS-DWNLD-CDE           05200010
054300             PERFORM 5000-INSERT-HEADER                           05210000
054400                                                                  05220000
054500             PERFORM 5100-INSERT-DETAIL                           05230000
054510             SET PS-IMMED-DOWNLOAD-YES  TO TRUE                   05240027
054600         WHEN SQLCODE = -904                                      05250000
054700         WHEN SQLCODE = -913                                      05260000
054800         WHEN SQLCODE = -911                                      05270000
054900             CONTINUE                                             05280000
055000         WHEN SQLWARN0 NOT = SPACES                               05290000
055100         WHEN SQLCODE NOT = ZERO                                  05300000
057301             INITIALIZE PV-MSG-AREA                               05310001
057302             MOVE SQLCODE               TO PV-SQL-RETURN-CD       05320000
057303             STRING   ' ' WS001-SRC-TASK-NUMBER                   05330000
057304                      ' WSKUP305-1010 ERROR:'                     05340000
057305                      ' SQL='                                     05350000
057306                      PV-SQL-RETURN-CD                            05360000
057307                      DELIMITED BY SIZE                           05370000
057308                                      INTO PV-MSG-AREA            05380001
057309             PERFORM 7000-WRITE-TO-LOG                            05390001
057310                                                                  05400000
057311             SET WS001-INVALID-SQL      TO TRUE                   05410000
057313             STRING 'SQL='                                        05420000
057314                  PV-SQL-RETURN-CD                                05430000
057315                  DELIMITED BY SIZE                               05440000
057316                                      INTO WS001-CRA-RET-MSG      05450000
057318             MOVE SQLCA                 TO WS001-SQLCA            05470000
057328             PERFORM 9999-ABEND                                   05530000
057329     END-EVALUATE.                                                05540000
057330                                                                  05550000
057500/                                                                 05560000
057600 2000-SHIPMT-DETACH.                                              05570000
057601                                                                  05580000
057602     MOVE '2000-SHIPMT-DETACH'   TO WS001-PARAGRAPH-NAME.         05590000
057700                                                                  05600000
057903* FIND ALL OF THE PO/RCVRS THAT ARE ATTACHED TO THE SHIPMENT      05610000
057904     PERFORM 2010-OPEN-SHIP-TO-CSR.                               05620000
058000     PERFORM 2020-FETCH-SHIP-TO-CSR UNTIL                         05630000
058100             PS-EOF-SHIP-TO-CSR-YES.                              05640000
058200     PERFORM 2030-CLOSE-SHIP-TO-CSR.                              05650000
058700                                                                  05660000
058700     IF PS-XREF-HDR-EXIST-YES                                     05670000
058701         PERFORM 2100-CHECK-FOR-INACTIVE                          05680000
058702                                                                  05690000
058703         IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES                  05700000
058704             SET PS-APPT-SENT-NO          TO TRUE                 05710000
058705             SET PS-IMMED-DOWNLOAD-YES    TO TRUE                 05720000
058706         END-IF                                                   05730000
058706     END-IF.                                                      05740000
058707                                                                  05750000
058708/                                                                 05760000
058800 2010-OPEN-SHIP-TO-CSR.                                           05770000
058801                                                                  05780000
058802     MOVE '2010-OPEN-SHIP-TO-CSR'                                 05790000
058803                                 TO WS001-PARAGRAPH-NAME.         05800000
058900                                                                  05810000
059000     SET PS-FIRST-RECORD-YES          TO TRUE.                    05820000
059100     SET PS-EOF-SHIP-TO-CSR-NO        TO TRUE.                    05830000
059200                                                                  05840000
059900     EXEC SQL                                                     05850000
060000          OPEN SHIP-TO-CSR                                        05860000
060100     END-EXEC.                                                    05870000
060200                                                                  05880000
060300     EVALUATE TRUE                                                05890000
060400         WHEN SQLCODE = ZERO                                      05900000
060500             IF PS-LOG-SWITCH-YES                                 05910001
060501                 INITIALIZE PV-MSG-AREA                           05920001
060502                 MOVE DK-SHIPT-ID TO WS-DISPLAY-1                 05930000
060510                 STRING   ' ' WS001-SRC-TASK-NUMBER               05940000
060600                          ' WSKUP305-2010:'                       05950000
060700                          ' OPENED SHIP-TO-CSR'                   05960000
060710                          ' FOR SHIPT-ID=' WS-DISPLAY-1           05970000
060800                          DELIMITED BY SIZE                       05980000
060900                          INTO PV-MSG-AREA                        05990001
061000                 PERFORM 7000-WRITE-TO-LOG                        06000001
061100             END-IF                                               06010000
061200         WHEN SQLCODE = -904                                      06020000
061300         WHEN SQLCODE = -913                                      06030000
061400         WHEN SQLCODE = -911                                      06040000
061500              CONTINUE                                            06050000
061600         WHEN SQLWARN0 NOT = SPACES                               06060000
061700         WHEN SQLCODE NOT = ZERO                                  06070000
063102             INITIALIZE PV-MSG-AREA                               06080001
063103             MOVE SQLCODE               TO PV-SQL-RETURN-CD       06090000
063104             STRING   ' ' WS001-SRC-TASK-NUMBER                   06100000
063300                      ' WSKUP305-2010 ERROR:'                     06110000
063400                      ' SQL='                                     06120000
063500                      PV-SQL-RETURN-CD                            06130000
063600                      DELIMITED BY SIZE                           06140000
063700                      INTO PV-MSG-AREA                            06150001
063800             PERFORM 7000-WRITE-TO-LOG                            06160001
063909                                                                  06170000
063910             SET WS001-INVALID-SQL      TO TRUE                   06180000
063912             STRING 'SQL='                                        06190000
063913                  PV-SQL-RETURN-CD                                06200000
063914                  DELIMITED BY SIZE                               06210000
063915                                      INTO WS001-CRA-RET-MSG      06220000
063917             MOVE SQLCA                 TO WS001-SQLCA            06240000
063924             PERFORM 9999-ABEND                                   06280000
063925     END-EVALUATE.                                                06290000
063930                                                                  06300000
064100/                                                                 06310000
064300 2020-FETCH-SHIP-TO-CSR.                                          06320000
064301                                                                  06330000
064302     MOVE '2020-FETCH-SHIP-TO-CSR'                                06340000
064303                                 TO WS001-PARAGRAPH-NAME.         06350000
064400                                                                  06360000
064500* GET THE PO & LNE FOR THE ROWS ON TSHPTPO.  THE KEY IS SHIPT-ID. 06370000
064700                                                                  06380000
065300     EXEC SQL                                                     06390000
065400          FETCH SHIP-TO-CSR                                       06400000
065500          INTO                                                    06410000
065600                :SHPTPO-PO-NBR                                    06420000
065700               ,:SHPTPO-REC-SEQ-NBR                               06430000
065800     END-EXEC.                                                    06440000
065900                                                                  06450000
066000     EVALUATE TRUE                                                06460000
066100         WHEN SQLCODE = ZERO                                      06470000
066200              IF PS-FIRST-RECORD-YES                              06480000
066300                  MOVE SHPTPO-PO-NBR     TO WS-PO-NBR             06490000
066400                                            DK-PO-NBR             06500000
066500                  MOVE SHPTPO-REC-SEQ-NBR TO                      06510000
066600                                        WS-RCVR-SEQ-NBR           06520000
066700                                        DK-RCVR-SEQ-NBR           06530000
066800                  SET PS-FIRST-RECORD-NO TO TRUE                  06540000
066900                  IF PS-LOG-SWITCH-YES                            06550001
066901                      INITIALIZE PV-MSG-AREA                      06560001
066910                      MOVE WS-PO-NBR TO WS-DISPLAY-1              06570000
066920                      MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2        06580000
066930                      STRING   ' ' WS001-SRC-TASK-NUMBER          06590000
067000                               ' WSKUP305-2020:'                  06600000
067100                               ' FIRST RECORD-'                   06610000
067200                               ' PO NBR='                         06620000
067300                               WS-DISPLAY-1                       06630000
067400                               ' RCVR SEQ='                       06640000
067500                               WS-DISPLAY-2                       06650000
067600                               DELIMITED BY SIZE                  06660000
067700                               INTO PV-MSG-AREA                   06670001
067800                      PERFORM 7000-WRITE-TO-LOG                   06680001
067900                  END-IF                                          06690000
068000                  PERFORM 2040-GET-WMS-SHIPMENT                   06700000
071300                  IF PS-XREF-HDR-EXIST-YES                        06710000
071300                     IF WS-RCPT-TMST NOT = PC-DEFAULT-NINES       06720000
071500                        SET WS001-ERROR        TO TRUE            06730000
071700                        MOVE 'RECEIVED, UNABLE TO DETACH'         06740000
071800                                           TO WS001-CRA-RET-MSG   06750000
071810                        MOVE SQLCA           TO WS001-SQLCA       06760000
071820                        IF PS-LOG-SWITCH-YES                      06770001
071830                           INITIALIZE PV-MSG-AREA                 06780001
071860                           STRING   ' ' WS001-SRC-TASK-NUMBER     06790000
071870                                    ' WSKUP305-2020:'             06800000
071880                                    ' RECEIVED, UNABLE TO'        06810000
071890                                    ' DETACH'                     06820000
071903                                    DELIMITED BY SIZE             06830000
071904                                          INTO PV-MSG-AREA        06840001
071905                           PERFORM 7000-WRITE-TO-LOG              06850001
071906                        END-IF                                    06860000
071910                                                                  06870000
071980                        MOVE SQLCA                 TO WS001-SQLCA 06900000
071996                        PERFORM 9999-ABEND                        06970000
072000                     END-IF                                       06980000
072100                     MOVE WS-EXT-SHP-ID   TO DK-EXT-SHP-ID        06990000
072200                     PERFORM 2060-UPDATE-HDR-REC                  07000000
072300                  END-IF                                          07010000
072300              END-IF                                              07020000
072400                                                                  07030000
072400              IF PS-XREF-HDR-EXIST-YES                            07040000
072500                  MOVE SHPTPO-PO-NBR      TO DK-PO-NBR            07050000
072600                  MOVE SHPTPO-REC-SEQ-NBR TO DK-RCVR-SEQ-NBR      07060000
072700                  PERFORM 2050-UPDATE-DTL-REC                     07070000
072700              END-IF                                              07080000
072800         WHEN SQLCODE = -904                                      07090000
072900         WHEN SQLCODE = -913                                      07100000
073000         WHEN SQLCODE = -911                                      07110000
073100              CONTINUE                                            07120000
073200         WHEN SQLCODE = +100                                      07130000
073300              SET PS-EOF-SHIP-TO-CSR-YES TO TRUE                  07140000
073400         WHEN SQLWARN0 NOT = SPACES                               07150000
073500         WHEN SQLCODE NOT = ZERO                                  07160000
074902             INITIALIZE PV-MSG-AREA                               07170001
074903             MOVE SQLCODE               TO PV-SQL-RETURN-CD       07180000
074904             STRING   ' ' WS001-SRC-TASK-NUMBER                   07190000
075100                      ' WSKUP305-2020 ERROR:'                     07200000
075200                      ' SQL='                                     07210000
075300                      PV-SQL-RETURN-CD                            07220000
075400                      DELIMITED BY SIZE                           07230000
075500                      INTO PV-MSG-AREA                            07240001
075600             PERFORM 7000-WRITE-TO-LOG                            07250001
075709                                                                  07260000
075710             SET WS001-INVALID-SQL      TO TRUE                   07270000
075712             STRING 'SQL='                                        07280000
075713                  PV-SQL-RETURN-CD                                07290000
075714                  DELIMITED BY SIZE                               07300000
075715                                      INTO WS001-CRA-RET-MSG      07310000
075717             MOVE SQLCA                 TO WS001-SQLCA            07330000
075724             PERFORM 9999-ABEND                                   07390000
075725     END-EVALUATE.                                                07400000
075730                                                                  07410000
075900/                                                                 07420000
076100 2030-CLOSE-SHIP-TO-CSR.                                          07430000
076101                                                                  07440000
076102     MOVE '2030-CLOSE-SHIP-TO-CSR'                                07450000
076103                                 TO WS001-PARAGRAPH-NAME.         07460000
076200                                                                  07470000
077000     EXEC SQL                                                     07480000
077100          CLOSE SHIP-TO-CSR                                       07490000
077200     END-EXEC.                                                    07500000
077300                                                                  07510000
077400     EVALUATE TRUE                                                07520000
077500         WHEN SQLCODE = ZERO                                      07530000
077600             IF PS-LOG-SWITCH-YES                                 07540001
077601                 INITIALIZE PV-MSG-AREA                           07550001
077610                 STRING   ' ' WS001-SRC-TASK-NUMBER               07560000
077700                          ' WSKUP305-2030:'                       07570000
077800                          ' CLOSED SHIP-TO-CSR'                   07580000
077810                          DELIMITED BY SIZE                       07590000
077900                          INTO PV-MSG-AREA                        07600001
078000                 PERFORM 7000-WRITE-TO-LOG                        07610001
078100             END-IF                                               07620000
078200         WHEN SQLCODE = -904                                      07630000
078300         WHEN SQLCODE = -913                                      07640000
078400         WHEN SQLCODE = -911                                      07650000
078500              CONTINUE                                            07660000
078600         WHEN SQLWARN0 NOT = SPACES                               07670000
078700         WHEN SQLCODE NOT = ZERO                                  07680000
080102             INITIALIZE PV-MSG-AREA                               07690001
080103             MOVE SQLCODE               TO PV-SQL-RETURN-CD       07700000
080104             STRING   ' ' WS001-SRC-TASK-NUMBER                   07710000
080300                      ' WSKUP305-2030-ERROR:'                     07720000
080400                      ' SQL='                                     07730000
080500                      PV-SQL-RETURN-CD                            07740000
080600                      DELIMITED BY SIZE                           07750000
080700                      INTO PV-MSG-AREA                            07760001
080800             PERFORM 7000-WRITE-TO-LOG                            07770001
080909                                                                  07780000
080910             SET WS001-INVALID-SQL      TO TRUE                   07790000
080912             STRING 'SQL='                                        07800000
080913                  PV-SQL-RETURN-CD                                07810000
080914                  DELIMITED BY SIZE                               07820000
080915                                      INTO WS001-CRA-RET-MSG      07830000
080917             MOVE SQLCA                 TO WS001-SQLCA            07850000
080923             PERFORM 9999-ABEND                                   07890000
080924     END-EVALUATE.                                                07900000
080930                                                                  07910000
081100/                                                                 07920000
081200 2040-GET-WMS-SHIPMENT.                                           07930000
081201                                                                  07940000
081202     MOVE '2040-GET-WMS-SHIPMENT'                                 07950000
081203                                 TO WS001-PARAGRAPH-NAME.         07960000
081300                                                                  07970000
081400* FIND OUT WHAT WMS SHIPMENT THE TRIP/PO/RCVR IS ON               07980000
081500                                                                  07990000
082300     EXEC SQL                                                     08000000
082400         SELECT DISTINCT                                          08010000
082500             H.EXT_SHP_ID                                         08020000
082600         ,   H.DWNLD_TMST                                         08030000
082700         ,   H.RCPT_TMST                                          08040000
082800         INTO                                                     08050000
082900            :WST00001-EXT-SHP-ID                                  08060000
083000         ,  :WST00001-DWNLD-TMST                                  08070000
083100         ,  :WST00001-RCPT-TMST                                   08080000
083200         FROM                                                     08090000
083300             WST_SHPMT_XREF_HDR H                                 08100000
083400            ,WST_SHPMT_XREF_DTL D                                 08110000
083500         WHERE  H.EXT_SHP_ID    = D.EXT_SHP_ID                    08120000
083600           AND  H.INTR_TRIP_ID  = :DK-TRIP-ID                     08130000
083700           AND  D.PO_NBR        = :DK-PO-NBR                      08140000
083800           AND  D.RCVR_SEQ_NBR  = :DK-RCVR-SEQ-NBR                08150000
083900           AND  H.SOR_CDE       = 'RC'                            08160010
084000     END-EXEC.                                                    08170000
084100                                                                  08180000
084200     EVALUATE TRUE                                                08190000
084300         WHEN SQLCODE = ZERO                                      08200000
084400             MOVE WST00001-RCPT-TMST TO WS-RCPT-TMST              08210000
084500             MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID            08220000
084600                                         DK-EXT-SHP-ID            08230000
084700             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            08240000
084700             SET PS-XREF-HDR-EXIST-YES TO TRUE                    08250000
084800             IF PS-LOG-SWITCH-YES                                 08260001
084801                 INITIALIZE PV-MSG-AREA                           08270001
084810                 STRING   ' ' WS001-SRC-TASK-NUMBER               08280000
084900                          ' WSKUP305-2040:'                       08290000
085000                          ' RCPT TMST='                           08300000
085100                          WS-RCPT-TMST                            08310000
085200                          ' SHPMT='                               08320000
085300                          WS-EXT-SHP-ID                           08330000
085400                          ' DWNLD TMST='                          08340000
085500                          WS-DWNLD-TMST                           08350000
085510                          DELIMITED BY SIZE                       08360000
085600                          INTO PV-MSG-AREA                        08370001
085700                 PERFORM 7000-WRITE-TO-LOG                        08380001
085800             END-IF                                               08390000
085900         WHEN SQLCODE = -904                                      08400000
086000         WHEN SQLCODE = -913                                      08410000
086100         WHEN SQLCODE = -911                                      08420000
086200             CONTINUE                                             08430000
086300         WHEN SQLCODE = -811                                      08440000
086302             SET WS001-ERROR            TO TRUE                   08450000
086303             MOVE 'SQL=-811, UNABLE TO DETACH'                    08460000
086304                                        TO WS001-CRA-RET-MSG      08470000
086306             IF PS-LOG-SWITCH-YES                                 08480001
086307                 INITIALIZE PV-MSG-AREA                           08490001
086308                 STRING   ' ' WS001-SRC-TASK-NUMBER               08500000
086309                          ' WSKUP305-2040:'                       08510000
086310                          ' RETURN CD= -811,'                     08520000
086311                          ' UNABLE TO DETACH'                     08530000
086312                          DELIMITED BY SIZE                       08540000
086313                          INTO PV-MSG-AREA                        08550001
086314                 PERFORM 7000-WRITE-TO-LOG                        08560001
086315             END-IF                                               08570000
086316                                                                  08580000
086340             MOVE SQLCA                 TO WS001-SQLCA            08600000
086393             PERFORM 9999-ABEND                                   08635000
086400         WHEN SQLCODE = +100                                      08636000
086402* JAK 05/07/07 - IF +100, THEN JUST CONTINUE, NOT AN ERROR        08637000
084700             SET PS-XREF-HDR-EXIST-NO   TO TRUE                   08638000
146751             SET PS-CHECK-ASN-NO        TO TRUE                   08639000
044631             SET PS-IMMED-DOWNLOAD-NO   TO TRUE                   08640000
086402                                                                  08640100
086600         WHEN SQLWARN0 NOT = SPACES                               08650000
086700         WHEN SQLCODE NOT = ZERO                                  08660000
088102             INITIALIZE PV-MSG-AREA                               08670001
088103             MOVE SQLCODE               TO PV-SQL-RETURN-CD       08680000
088104             STRING   ' ' WS001-SRC-TASK-NUMBER                   08690000
088300                      ' WSKUP305-2040 ERROR:'                     08700000
088400                      ' SQL='                                     08710000
088500                      PV-SQL-RETURN-CD                            08720000
088600                      DELIMITED BY SIZE                           08730000
088700                      INTO PV-MSG-AREA                            08740001
088800             PERFORM 7000-WRITE-TO-LOG                            08750001
088901                                                                  08760000
088902             SET WS001-INVALID-SQL      TO TRUE                   08770000
088904             STRING 'SQL='                                        08780000
088905                  PV-SQL-RETURN-CD                                08790000
088906                  DELIMITED BY SIZE                               08800000
088907                                      INTO WS001-CRA-RET-MSG      08810000
088909             MOVE SQLCA                 TO WS001-SQLCA            08830000
088917             PERFORM 9999-ABEND                                   08891100
088918     END-EVALUATE.                                                08891200
088920*                                                                 08891300
089100/                                                                 08891400
089200 2050-UPDATE-DTL-REC.                                             08891500
089300                                                                  08891600
089301     MOVE '2050-UPDATE-DTL-REC'  TO WS001-PARAGRAPH-NAME.         08891700
089302                                                                  08891800
090200     EXEC SQL                                                     08891900
090300          UPDATE WST_SHPMT_XREF_DTL                               08892000
090400             SET ACTV_CDE         = 'I'                           08893000
090500             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                08894000
090600             AND   PO_NBR         = :DK-PO-NBR                    08895000
090700             AND   RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              08896000
090800     END-EXEC.                                                    08897000
090900                                                                  08898000
091000     EVALUATE TRUE                                                08899000
091100         WHEN SQLCODE = ZERO                                      08900000
091200             IF PS-LOG-SWITCH-YES                                 08910001
091300                 MOVE DK-PO-NBR TO WS-DISPLAY-1                   08920000
091301                 MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2             08930000
091302                 INITIALIZE PV-MSG-AREA                           08940001
091303                 STRING   ' ' WS001-SRC-TASK-NUMBER               08950000
091310                          ' WSKUP305-2050:'                       08960000
091400                          ' UPDATE WST_SHPMT_XREF_DTL'            08970000
091500                          ' FOR SHPMT='                           08980000
091600                          DK-EXT-SHP-ID                           08990000
091700                          ' PO NBR='                              09000000
091800                          WS-DISPLAY-1                            09010000
091900                          ' RCVR SEQ='                            09020000
092000                          WS-DISPLAY-2                            09030000
092010                          DELIMITED BY SIZE                       09040000
092100                          INTO PV-MSG-AREA                        09050001
092200                 PERFORM 7000-WRITE-TO-LOG                        09060001
092300             END-IF                                               09070000
092400         WHEN SQLCODE = -904                                      09080000
092500         WHEN SQLCODE = -913                                      09090000
092600         WHEN SQLCODE = -911                                      09100000
092700              CONTINUE                                            09110000
092800         WHEN SQLCODE = 100                                       09120000
092900         WHEN SQLWARN0 NOT = SPACES                               09130000
093000         WHEN SQLCODE NOT = ZERO                                  09140000
094402             INITIALIZE PV-MSG-AREA                               09150001
094403             MOVE SQLCODE               TO PV-SQL-RETURN-CD       09160000
094404             STRING   ' ' WS001-SRC-TASK-NUMBER                   09170000
094600                      ' WSKUP305-2050 ERROR:'                     09180000
094700                      ' SQL='                                     09190000
094800                      PV-SQL-RETURN-CD                            09200000
094900                      DELIMITED BY SIZE                           09210000
095000                      INTO PV-MSG-AREA                            09220001
095100             PERFORM 7000-WRITE-TO-LOG                            09230001
095201                                                                  09240000
095202             SET WS001-INVALID-SQL      TO TRUE                   09250000
095204             STRING 'SQL='                                        09260000
095205                  PV-SQL-RETURN-CD                                09270000
095206                  DELIMITED BY SIZE                               09280000
095207                                      INTO WS001-CRA-RET-MSG      09290000
095209             MOVE SQLCA                 TO WS001-SQLCA            09310000
095217             PERFORM 9999-ABEND                                   09370000
095218     END-EVALUATE.                                                09380000
095220                                                                  09390000
095400/                                                                 09400000
095500 2060-UPDATE-HDR-REC.                                             09410000
095600                                                                  09420000
095601     MOVE '2060-UPDATE-HDR-REC'  TO WS001-PARAGRAPH-NAME.         09430000
095602                                                                  09440000
096400     EXEC SQL                                                     09450000
096500          UPDATE WST_SHPMT_XREF_HDR                               09460000
096600             SET LAST_PRCG_TMST   = CURRENT TIMESTAMP             09470000
096700                ,DWNLD_CDE        = 'P'                           09480000
096800             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                09490000
096900     END-EXEC.                                                    09500000
097000                                                                  09510000
097100     EVALUATE TRUE                                                09520000
097200         WHEN SQLCODE = ZERO                                      09530000
097300             IF PS-LOG-SWITCH-YES                                 09540001
097301                 INITIALIZE PV-MSG-AREA                           09550001
097310                 STRING   ' ' WS001-SRC-TASK-NUMBER               09560000
097400                          ' WSKUP305-2060:'                       09570000
097500                          ' UPDATE WST_SHPMT_XREF_HDR'            09580000
097600                          ' FOR SHPMT='                           09590000
097700                          DK-EXT-SHP-ID                           09600000
097710                          DELIMITED BY SIZE                       09610000
097800                          INTO PV-MSG-AREA                        09620001
097900                 PERFORM 7000-WRITE-TO-LOG                        09630001
098000             END-IF                                               09640000
098100         WHEN SQLCODE = -904                                      09650000
098200         WHEN SQLCODE = -913                                      09660000
098300         WHEN SQLCODE = -911                                      09670000
098400              CONTINUE                                            09680000
098500         WHEN SQLWARN0 NOT = SPACES                               09690000
098600         WHEN SQLCODE NOT = ZERO                                  09700000
100002             INITIALIZE PV-MSG-AREA                               09710001
100003             MOVE SQLCODE               TO PV-SQL-RETURN-CD       09720000
100004             STRING   ' ' WS001-SRC-TASK-NUMBER                   09730000
100200                      ' WSKUP305-2060 ERROR:'                     09740000
100300                      ' SQL='                                     09750000
100400                      PV-SQL-RETURN-CD                            09760000
100500                      DELIMITED BY SIZE                           09770000
100600                      INTO PV-MSG-AREA                            09780001
100700             PERFORM 7000-WRITE-TO-LOG                            09790001
100801                                                                  09800000
100802             SET WS001-INVALID-SQL      TO TRUE                   09810000
100804             STRING 'SQL='                                        09820000
100805                  PV-SQL-RETURN-CD                                09830000
100806                  DELIMITED BY SIZE                               09840000
100807                                      INTO WS001-CRA-RET-MSG      09850000
100809             MOVE SQLCA                 TO WS001-SQLCA            09870000
100815             PERFORM 9999-ABEND                                   09930000
100816     END-EVALUATE.                                                09940000
100820                                                                  09950000
101000/                                                                 09960000
101100 2070-GET-TRIP-ID.                                                09970000
101101                                                                  09980000
101102     MOVE '2070-GET-TRIP-ID'     TO WS001-PARAGRAPH-NAME.         09990000
101200                                                                  10000000
102100     EXEC SQL                                                     10010000
102200         SELECT  TRIP_ID                                          10020000
102300         INTO                                                     10030000
102400                :SHIPMT-TRIP-ID                                   10040000
102500         FROM    TSHIPMT                                          10050000
102600         WHERE   SHIPT_ID         = :DK-SHIPT-ID                  10060000
102700     END-EXEC.                                                    10070000
102800                                                                  10080000
102900     EVALUATE TRUE                                                10090000
103000         WHEN SQLCODE = ZERO                                      10100000
103100             MOVE SHIPMT-TRIP-ID  TO WS-TRIP-ID                   10110000
103200                                     DK-TRIP-ID                   10120000
103300             IF PS-LOG-SWITCH-YES                                 10130001
103400                 MOVE WS-TRIP-ID TO WS-DISPLAY-1                  10140000
103401                 INITIALIZE PV-MSG-AREA                           10150001
103402                 STRING   ' ' WS001-SRC-TASK-NUMBER               10160000
103410                          ' WSKUP305-2070:'                       10170000
103500                          ' TRIP-ID='                             10180000
103600                          WS-DISPLAY-1                            10190000
103610                          DELIMITED BY SIZE                       10200000
103700                          INTO PV-MSG-AREA                        10210001
103800                 PERFORM 7000-WRITE-TO-LOG                        10220001
103900             END-IF                                               10230000
104000         WHEN SQLCODE = +100                                      10240000
104100         WHEN SQLCODE = -811                                      10250000
104200         WHEN SQLCODE = -904                                      10260000
104300         WHEN SQLCODE = -913                                      10270000
104400         WHEN SQLCODE = -911                                      10280000
104500             CONTINUE                                             10290000
104600         WHEN SQLWARN0 NOT = SPACES                               10300000
104700         WHEN SQLCODE NOT = ZERO                                  10310000
104800             MOVE SQLCODE               TO PV-SQL-RETURN-CD       10320000
106102             INITIALIZE PV-MSG-AREA                               10330001
106103             STRING   ' ' WS001-SRC-TASK-NUMBER                   10340000
106300                      ' WSKUP305-2070 ERROR:'                     10350000
106400                      ' SQL='                                     10360000
106500                      PV-SQL-RETURN-CD                            10370000
106600                      DELIMITED BY SIZE                           10380000
106700                      INTO PV-MSG-AREA                            10390001
106800             PERFORM 7000-WRITE-TO-LOG                            10400001
106901                                                                  10410000
106902             SET WS001-INVALID-SQL      TO TRUE                   10420000
106904             STRING 'SQL='                                        10430000
106905                  PV-SQL-RETURN-CD                                10440000
106906                  DELIMITED BY SIZE                               10450000
106907                                      INTO WS001-CRA-RET-MSG      10460000
106909             MOVE SQLCA                 TO WS001-SQLCA            10480000
106915             PERFORM 9999-ABEND                                   10540000
106916     END-EVALUATE.                                                10550000
106920*                                                                 10560000
107100/                                                                 10570000
101100 2080-SELECT-TVHTRIP.                                             10571010
101101                                                                  10572010
101102     MOVE '2080-SELECT-TVHTRIP'  TO WS001-PARAGRAPH-NAME.         10573010
101200                                                                  10574010
102100     EXEC SQL                                                     10575010
102200         SELECT   VEH_NBR                                         10576010
102300           INTO  :VHTRIP-VEH-NBR :DN-VEH-NBR                      10577010
102400           FROM   TVHTRIP                                         10578010
102500          WHERE   TRIP_ID    = :DK-TRIP-ID                        10579010
102700     END-EXEC.                                                    10579110
102800                                                                  10579210
102900     EVALUATE TRUE                                                10579410
103000         WHEN SQLCODE = ZERO                                      10579510
103100             IF DN-VEH-NBR = -1                                   10579610
103100                SET PS-VALID-TRIP-NO   TO TRUE                    10579710
103100             ELSE                                                 10579810
103100                SET PS-VALID-TRIP      TO TRUE                    10579910
103100             END-IF                                               10580010
103300             IF PS-LOG-SWITCH-YES                                 10580110
103400                 MOVE WS-TRIP-ID TO WS-DISPLAY-1                  10580210
103401                 INITIALIZE PV-MSG-AREA                           10580310
103402                 STRING   ' ' WS001-SRC-TASK-NUMBER               10580410
103410                          ' WSKUP305-2080:'                       10580510
103500                          ' TRIP-ID='                             10580610
103600                          WS-DISPLAY-1                            10580710
103500                          ' VALID TRIP=' PS-VALID-TRIP-SW         10580810
103610                          DELIMITED BY SIZE                       10580910
103700                          INTO PV-MSG-AREA                        10581010
103800                 PERFORM 7000-WRITE-TO-LOG                        10581110
103900             END-IF                                               10581210
104000         WHEN SQLCODE = +100                                      10581310
104100         WHEN SQLCODE = -811                                      10581410
104200         WHEN SQLCODE = -904                                      10581510
104300         WHEN SQLCODE = -913                                      10581610
104400         WHEN SQLCODE = -911                                      10581710
104500             CONTINUE                                             10581810
104600         WHEN SQLWARN0 NOT = SPACES                               10581910
104700         WHEN SQLCODE NOT = ZERO                                  10582010
104800             MOVE SQLCODE               TO PV-SQL-RETURN-CD       10582110
106102             INITIALIZE PV-MSG-AREA                               10582210
106103             STRING   ' ' WS001-SRC-TASK-NUMBER                   10582310
106300                      ' WSKUP305-2080 ERROR:'                     10582410
106400                      ' SQL='                                     10582510
106500                      PV-SQL-RETURN-CD                            10582610
106600                      DELIMITED BY SIZE                           10582710
106700                      INTO PV-MSG-AREA                            10582810
106800             PERFORM 7000-WRITE-TO-LOG                            10582910
106901                                                                  10583010
106902             SET WS001-INVALID-SQL      TO TRUE                   10583110
106904             STRING 'SQL='                                        10583210
106905                  PV-SQL-RETURN-CD                                10583310
106906                  DELIMITED BY SIZE                               10583410
106907                                      INTO WS001-CRA-RET-MSG      10583510
106909             MOVE SQLCA                 TO WS001-SQLCA            10583610
106915             PERFORM 9999-ABEND                                   10583710
106916     END-EVALUATE.                                                10583810
106920*                                                                 10583910
107100/                                                                 10584010
107300 2100-CHECK-FOR-INACTIVE.                                         10585000
107301                                                                  10590000
107302     MOVE '2100-CHECK-FOR-INACTIVE' TO WS001-PARAGRAPH-NAME.      10600000
107303                                                                  10610000
107304*  IF ALL OF THE DETAIL ROWS ARE MARKED INACTIVE,                 10620000
107305*  THEN WE WANT TO CHANGE THE DWNLD_CDE TO 'X'                    10630000
107306                                                                  10640000
107307     EXEC SQL                                                     10650000
107308         SELECT  H.EXT_SHP_ID                                     10660000
107309         INTO                                                     10670000
107310                :WST00001-EXT-SHP-ID                              10680000
107311         FROM    WST_SHPMT_XREF_HDR H                             10690000
107312               , WST_SHPMT_XREF_DTL D                             10700000
107313         WHERE   H.EXT_SHP_ID     = :DK-EXT-SHP-ID                10710000
107314         AND     H.EXT_SHP_ID     = D.EXT_SHP_ID                  10720000
107315         AND     D.ACTV_CDE       = 'A'                           10730000
107316     END-EXEC.                                                    10731000
107317                                                                  10731100
107318     EVALUATE TRUE                                                10731200
107319         WHEN SQLCODE = +100                                      10731300
107320             IF PS-LOG-SWITCH-YES                                 10731401
107321                 INITIALIZE PV-MSG-AREA                           10731501
107322                 STRING   ' ' WS001-SRC-TASK-NUMBER               10731600
107323                          ' WSKUP305-2100:'                       10731700
107324                          ' SHPMT='                               10731800
107325                          DK-EXT-SHP-ID                           10731900
107326                          DELIMITED BY SIZE                       10732000
107327                          INTO PV-MSG-AREA                        10732101
107328                 PERFORM 7000-WRITE-TO-LOG                        10732201
107329             END-IF                                               10732300
107330*            PERFORM 2110-UPDATE-HDR-X                            10732429
044625             SET PS-CANCEL-SHPMT-YES    TO TRUE                   10732522
107331         WHEN SQLCODE = ZERO                                      10732600
107332         WHEN SQLCODE = -811                                      10732700
107333         WHEN SQLCODE = -904                                      10732800
107334         WHEN SQLCODE = -913                                      10732900
107335         WHEN SQLCODE = -911                                      10733000
107336             CONTINUE                                             10733100
107337         WHEN SQLWARN0 NOT = SPACES                               10733200
107338         WHEN SQLCODE NOT = ZERO                                  10733300
107340             MOVE SQLCODE               TO PV-SQL-RETURN-CD       10733400
107346             INITIALIZE PV-MSG-AREA                               10733501
107347             STRING   ' ' WS001-SRC-TASK-NUMBER                   10733600
107348                      ' WSKUP305-2100 ERROR:'                     10733700
107349                      ' SQL='                                     10733800
107350                      PV-SQL-RETURN-CD                            10733900
107351                      DELIMITED BY SIZE                           10734000
107352                      INTO PV-MSG-AREA                            10734101
107353             PERFORM 7000-WRITE-TO-LOG                            10735001
107364                                                                  10736000
107365             SET WS001-INVALID-SQL      TO TRUE                   10736100
107366             STRING 'SQL='                                        10736200
107367                  PV-SQL-RETURN-CD                                10736300
107368                  DELIMITED BY SIZE                               10736400
107369                                      INTO WS001-CRA-RET-MSG      10736500
107371             MOVE SQLCA                 TO WS001-SQLCA            10736700
107379             PERFORM 9999-ABEND                                   10737500
107380     END-EVALUATE.                                                10737600
107381                                                                  10737700
107382/                                                                 10737800
107383*2110-UPDATE-HDR-X.                                               10737922
107384*                                                                 10738022
107385*    MOVE '2110-UPDATE-HDR-X'    TO WS001-PARAGRAPH-NAME.         10738122
107386*                                                                 10738222
107387*    EXEC SQL                                                     10738322
107388*         UPDATE WST_SHPMT_XREF_HDR                               10738422
107389*            SET DWNLD_CDE        = 'X'                           10738522
107390*            WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                10738622
107391*    END-EXEC.                                                    10738722
107392*                                                                 10738822
107393*    EVALUATE TRUE                                                10738922
107394*        WHEN SQLCODE = ZERO                                      10739022
107395*            IF PS-LOG-SWITCH-YES                                 10739122
107396*                INITIALIZE PV-MSG-AREA                           10739222
107397*                STRING   ' ' WS001-SRC-TASK-NUMBER               10739322
107398*                         ' WSKUP305-2110:'                       10739422
107399*                         ' UPDATE WST_SHPMT_XREF_HDR'            10739522
107400*                         ' FOR SHPMT='                           10739622
107401*                         DK-EXT-SHP-ID                           10739722
107402*                         DELIMITED BY SIZE                       10739822
107403*                         INTO PV-MSG-AREA                        10739922
107404*                PERFORM 7000-WRITE-TO-LOG                        10740022
107405*            END-IF                                               10740122
107406*        WHEN SQLCODE = -904                                      10740222
107407*        WHEN SQLCODE = -913                                      10740322
107408*        WHEN SQLCODE = -911                                      10740422
107409*             CONTINUE                                            10740522
107410*        WHEN SQLWARN0 NOT = SPACES                               10740622
107411*        WHEN SQLCODE NOT = ZERO                                  10740722
107413*            MOVE SQLCODE               TO PV-SQL-RETURN-CD       10740822
107419*            INITIALIZE PV-MSG-AREA                               10740922
107420*            STRING   ' ' WS001-SRC-TASK-NUMBER                   10741022
107421*                     ' WSKUP305-2110 ERROR:'                     10742022
107422*                     ' SQL='                                     10742122
107423*                     PV-SQL-RETURN-CD                            10742222
107424*                     DELIMITED BY SIZE                           10742322
107425*                     INTO PV-MSG-AREA                            10742422
107426*            PERFORM 7000-WRITE-TO-LOG                            10742522
107427*                                                                 10742622
107428*            SET WS001-INVALID-SQL      TO TRUE                   10742722
107429*            STRING 'SQL='                                        10742822
107430*                 PV-SQL-RETURN-CD                                10742922
107431*                 DELIMITED BY SIZE                               10743022
107432*                                     INTO WS001-CRA-RET-MSG      10743122
107434*            MOVE SQLCA                 TO WS001-SQLCA            10743322
107442*            PERFORM 9999-ABEND                                   10743922
107443*    END-EVALUATE.                                                10744022
107444*                                                                 10744122
107445/                                                                 10744200
107446 3000-PKSLIP-INACTIVE.                                            10744300
107447                                                                  10744400
107448     MOVE '3000-PKSLIP-INACTIVE' TO WS001-PARAGRAPH-NAME.         10744500
107449                                                                  10744600
107450* THE ASSUMPTION HERE IS THAT THE CALLING PROGRAM HAS ALREADY     10744700
107451* CHECKED TO MAKE SURE THAT RECEIVING HAS NOT BEGUN, SO WE ARE    10744800
107452* NOT CHECKING FOR THAT HERE.                                     10744900
107453                                                                  10745000
107453* SUMMARY OF PROCESSING FOR PACKSLIP INACTIVATE:                  10745100
107453*   - SET WS-DWNLD-TMST TO DEFAULT NINES.  IF NO ROWS ARE RETURNED10745221
107453*     FROM THE TRIP-ID-CSR, WE NEED THIS FIELD TO BE DEFAULTED,   10745321
107453*     SO THAT THE IMMED-DOWNLOAD SWITCH DOES NOT GET SET          10745421
107453*   - SELECT ALL ROWS FROM XREF TABLES FOR TRIP/PO/RCVR           10745500
107453*   - UPDATE ALL DETAIL ROWS TO INACTIVE, NOT DOWNLOADED          10745600
107453*   - IF THE SHIPMENT HAS BEEN DOWNLOADED PREVIOUSLY              10745700
107453*        THEN UPDATE THE HEADER ROW DWNLD-CDE TO P                10745800
107453*   - IF THERE ARE NO ROWS FOR THE TRIP/PO/RCVR                   10745900
107453*        THEN CHECK TO SEE IF THERE IS A HEADER FOR THE TRIP      10746000
107453*   - IF THERE IS NO HEADER FOR THE TRIP                          10746100
107453*        THEN INSERT A HEADER FOR THE TRIP                        10746200
107453*   - UPDATE/INSERT ALL VALID DETAIL ROWS, MAKING THEM ACTIVE     10746310
107453*   - IF ALL DETAIL ROWS FOR THE SHIPMENT ARE INACTIVE            10746410
107453*        THEN UPDATE THE HEADER ROW DWNLD-CDE TO X                10746510
107453*   - IF THE SHIPMENT HAS BEEN DOWNLOADED PREVIOUSLY              10746600
107453*        THEN DOWNLOAD AGAIN                                      10746700
107453                                                                  10746800
107453                                                                  10746900
107453     MOVE PC-DEFAULT-NINES            TO WS-DWNLD-TMST.           10747021
107460     PERFORM 3010-OPEN-TRIP-ID-CSR.                               10747100
107500     PERFORM 3020-FETCH-TRIP-ID-CSR UNTIL                         10747210
058100             PS-EOF-TRIP-ID-CSR-YES.                              10747310
107700     PERFORM 3030-CLOSE-TRIP-ID-CSR.                              10748000
107710                                                                  10749000
107710* CHECK TO SEE IS XREF HDR EXISTS FOR TRIP/PO/RCVR                10750000
107710* IF NOT, THEN CHECK FOR AN XREF HDR FOR THE TRIP                 10760000
107710* IF THAT DOES NOT EXIST, THEN INSERT A NEW XREF HDR              10770000
107710                                                                  10771000
107710     IF PS-FIRST-RECORD-YES                                       10772000
107710         SET PS-TRIP-HDR-EXIST-NO     TO TRUE                     10773000
107710         PERFORM 3060-CHECK-FOR-TRIP-HDR                          10774000
107710         IF PS-TRIP-HDR-EXIST-NO                                  10775000
107710             MOVE WS-TRIP-ID          TO WST00001-INTR-TRIP-ID    10776000
107710             MOVE 0                   TO WST00001-DMY-SEQ-NBR     10777000
107710             MOVE 'N'                 TO WS-DWNLD-CDE             10777100
107710             SET PS-DUMMY-HEADER-NO   TO TRUE                     10777200
107710             PERFORM 5000-INSERT-HEADER                           10777300
107710             MOVE WS-EXT-SHP-ID       TO DK-EXT-SHP-ID            10777410
107710         END-IF                                                   10777500
107710     ELSE                                                         10777600
107800         MOVE WS-HOLD-EXT-SHP-ID      TO WS-EXT-SHP-ID            10777700
107800                                         DK-EXT-SHP-ID            10777910
107800     END-IF.                                                      10778010
107710                                                                  10778110
107710* INSERT/UPDATE ANY DETAIL ROWS THAT ARE STILL ACTIVE             10778230
107900     PERFORM 5610-CHECK-FOR-PBS.                                  10778310
108000     IF PS-PACK-BY-STORE-YES                                      10779000
108100        PERFORM 5620-CHECK-FOR-PBS-ERRS                           10780000
108200     END-IF.                                                      10790000
108210                                                                  10800000
108300     PERFORM 5600-DETAIL-PO-RCVR.                                 10810000
117302     PERFORM 3100-CHECK-FOR-INACTIVE.                             10811018
117302     PERFORM 3150-CHECK-FOR-DOWNLOAD.                             10812030
108400                                                                  10820000
117303*    IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES                      10830028
146400*        SET PS-APPT-SENT-NO         TO TRUE                      10840028
146500*        SET PS-IMMED-DOWNLOAD-YES   TO TRUE                      10841028
146502*    END-IF.                                                      10842028
108500/                                                                 10843000
108600 3010-OPEN-TRIP-ID-CSR.                                           10844000
108601     MOVE '3010-OPEN-TRIP-ID-CSR'                                 10845000
108602                                 TO WS001-PARAGRAPH-NAME.         10846000
108700                                                                  10847000
108800     SET PS-FIRST-RECORD-YES          TO TRUE.                    10848000
108900     SET PS-EOF-TRIP-ID-CSR-NO        TO TRUE.                    10849000
109600                                                                  10850000
109700     EXEC SQL                                                     10860000
109800          OPEN TRIP-ID-CSR                                        10870000
109900     END-EXEC.                                                    10880000
110000                                                                  10890000
110100     EVALUATE TRUE                                                10900000
110200         WHEN SQLCODE = ZERO                                      10910000
110300             IF PS-LOG-SWITCH-YES                                 10920001
110301                 INITIALIZE PV-MSG-AREA                           10930001
110301                 MOVE DK-TRIP-ID        TO WS-DISPLAY-1           10931010
110301                 MOVE DK-PO-NBR         TO WS-DISPLAY-2           10932010
110301                 MOVE DK-RCVR-SEQ-NBR   TO WS-DISPLAY-4           10933010
110310                 STRING   ' ' WS001-SRC-TASK-NUMBER               10940000
110400                          ' WSKUP305-3010:'                       10950000
110500                          ' OPEN TRIP-ID-CSR'                     10960000
110500                          ' FOR TRIP=' WS-DISPLAY-1               10961010
110500                          ' PO=' WS-DISPLAY-2                     10962010
110500                          ' -' WS-DISPLAY-4                       10963010
110510                          DELIMITED BY SIZE                       10970000
110600                          INTO PV-MSG-AREA                        10980001
110700                 PERFORM 7000-WRITE-TO-LOG                        10990001
110800             END-IF                                               11000000
110900         WHEN SQLCODE = -904                                      11010000
111000         WHEN SQLCODE = -913                                      11020000
111100         WHEN SQLCODE = -911                                      11030000
111200              CONTINUE                                            11040000
111300         WHEN SQLWARN0 NOT = SPACES                               11050000
111400         WHEN SQLCODE NOT = ZERO                                  11060000
112200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       11070000
112802             INITIALIZE PV-MSG-AREA                               11080001
112803             STRING   ' ' WS001-SRC-TASK-NUMBER                   11090000
113000                      ' WSKUP305-3010 ERROR:'                     11100000
113100                      ' SQL='                                     11110000
113200                      PV-SQL-RETURN-CD                            11120000
113300                      DELIMITED BY SIZE                           11130000
113400                      INTO PV-MSG-AREA                            11140001
113500             PERFORM 7000-WRITE-TO-LOG                            11150001
113601                                                                  11160000
113602             SET WS001-INVALID-SQL      TO TRUE                   11170000
113603             STRING 'SQL='                                        11180000
113604                  PV-SQL-RETURN-CD                                11190000
113605                  DELIMITED BY SIZE                               11200000
113606                                      INTO WS001-CRA-RET-MSG      11210000
113608             MOVE SQLCA                 TO WS001-SQLCA            11230000
113614             PERFORM 9999-ABEND                                   11270000
113615     END-EVALUATE.                                                11280000
113620                                                                  11290000
113800/                                                                 11300000
113900 3020-FETCH-TRIP-ID-CSR.                                          11310000
113901                                                                  11320000
113902     MOVE '3020-FETCH-TRIP-ID-CSR'                                11330000
113903                                 TO WS001-PARAGRAPH-NAME.         11340000
113904                                                                  11350000
113905* GET DATA FROM WST_SHPMT_XREF_HDR & WST_SHPMT_XREF_DTL.          11360000
113906* KEYS ARE TRIP/PO/RCVR                                           11370000
113906* THERE COULD BE MULTIPLE ROWS RETURNED DUE TO DUMMY SHIPMENTS    11371010
114000                                                                  11380000
114900     EXEC SQL                                                     11390000
115000          FETCH TRIP-ID-CSR                                       11400000
115100          INTO                                                    11410000
115200                :WST00001-EXT-SHP-ID                              11420000
115300               ,:WST00001-DWNLD-TMST                              11430000
115400               ,:WST00001-DMY-SEQ-NBR                             11440000
115410               ,:WST00001-CRE-TMST                                11450000
115500     END-EXEC.                                                    11460000
115600                                                                  11470000
115700     EVALUATE TRUE                                                11480000
115800         WHEN SQLCODE = ZERO                                      11490000
115900             IF PS-FIRST-RECORD-YES                               11500000
116000                 MOVE WST00001-EXT-SHP-ID                         11510000
116100                                TO WS-HOLD-EXT-SHP-ID             11520000
116200                 SET PS-FIRST-RECORD-NO TO TRUE                   11530000
116300             END-IF                                               11540000
116400             MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID            11550000
116401                                         WS-EXT-SHP-ID            11560000
116402             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            11570000
116500             IF PS-LOG-SWITCH-YES                                 11580001
116501                 INITIALIZE PV-MSG-AREA                           11590001
116510                 STRING   ' ' WS001-SRC-TASK-NUMBER               11600000
116600                          ' WSKUP305-3020:'                       11610000
116700                          ' SHPMT='                               11620000
116800                          DK-EXT-SHP-ID                           11630000
116810                          DELIMITED BY SIZE                       11640000
116900                          INTO PV-MSG-AREA                        11650001
117000                 PERFORM 7000-WRITE-TO-LOG                        11660001
117100             END-IF                                               11670000
117200             PERFORM 3040-UPDATE-DTL-REC                          11680000
117210             IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES              11690000
117300                 PERFORM 3050-UPDATE-HDR-REC                      11700000
117301             END-IF                                               11710000
146503                                                                  11780000
146504         WHEN SQLCODE = -904                                      11790000
146505         WHEN SQLCODE = -913                                      11800000
146506         WHEN SQLCODE = -911                                      11810000
146507              CONTINUE                                            11820000
146508         WHEN SQLCODE = +100                                      11830000
146509              SET PS-EOF-TRIP-ID-CSR-YES TO TRUE                  11840000
146510         WHEN SQLWARN0 NOT = SPACES                               11850000
146511         WHEN SQLCODE NOT = ZERO                                  11860000
146513             MOVE SQLCODE               TO PV-SQL-RETURN-CD       11870000
146519             INITIALIZE PV-MSG-AREA                               11880001
146520             STRING   ' ' WS001-SRC-TASK-NUMBER                   11890000
146521                      ' WSKUP305-3020 ERROR:'                     11900000
146522                      ' SQL='                                     11910000
146523                      PV-SQL-RETURN-CD                            11920000
146524                      DELIMITED BY SIZE                           11930000
146525                      INTO PV-MSG-AREA                            11940001
146526             PERFORM 7000-WRITE-TO-LOG                            11950001
146528                                                                  11960000
146529             SET WS001-INVALID-SQL      TO TRUE                   11970000
146530             STRING 'SQL='                                        11980000
146531                  PV-SQL-RETURN-CD                                11990000
146532                  DELIMITED BY SIZE                               12000000
146533                                      INTO WS001-CRA-RET-MSG      12010000
146535             MOVE SQLCA                 TO WS001-SQLCA            12030000
146543             PERFORM 9999-ABEND                                   12110000
146544     END-EVALUATE.                                                12120000
146545                                                                  12130000
146546/                                                                 12140000
146547 3030-CLOSE-TRIP-ID-CSR.                                          12150000
146548                                                                  12160000
146549     MOVE '3030-CLOSE-TRIP-ID-CSR'                                12170000
146550                                 TO WS001-PARAGRAPH-NAME.         12180000
146551                                                                  12190000
146552     EXEC SQL                                                     12200000
146553          CLOSE TRIP-ID-CSR                                       12210000
146554     END-EXEC.                                                    12220000
146555                                                                  12230000
146556     EVALUATE TRUE                                                12240000
146557         WHEN SQLCODE = ZERO                                      12250000
146558             IF PS-LOG-SWITCH-YES                                 12260001
146559                 INITIALIZE PV-MSG-AREA                           12270001
146560                 STRING   ' ' WS001-SRC-TASK-NUMBER               12280000
146561                          ' WSKUP305-3030:'                       12290000
146562                          ' CLOSE TRIP-ID-CSR'                    12300000
146563                          DELIMITED BY SIZE                       12310000
146564                          INTO PV-MSG-AREA                        12320001
146565                 PERFORM 7000-WRITE-TO-LOG                        12330001
146566             END-IF                                               12340000
146567         WHEN SQLCODE = -904                                      12350000
146568         WHEN SQLCODE = -913                                      12360000
146569         WHEN SQLCODE = -911                                      12370000
146570              CONTINUE                                            12380000
146571         WHEN SQLWARN0 NOT = SPACES                               12390000
146572         WHEN SQLCODE NOT = ZERO                                  12400000
146574             MOVE SQLCODE               TO PV-SQL-RETURN-CD       12410000
146580             INITIALIZE PV-MSG-AREA                               12420001
146581             STRING   ' ' WS001-SRC-TASK-NUMBER                   12430000
146582                      ' WSKUP305-3030 ERROR:'                     12440000
146583                      ' SQL='                                     12450000
146584                      PV-SQL-RETURN-CD                            12460000
146585                      DELIMITED BY SIZE                           12470000
146586                      INTO PV-MSG-AREA                            12480001
146587             PERFORM 7000-WRITE-TO-LOG                            12490001
146589                                                                  12500000
146590             SET WS001-INVALID-SQL      TO TRUE                   12510000
146591             STRING 'SQL='                                        12520000
146592                  PV-SQL-RETURN-CD                                12530000
146593                  DELIMITED BY SIZE                               12540000
146594                                      INTO WS001-CRA-RET-MSG      12550000
146596             MOVE SQLCA                 TO WS001-SQLCA            12570000
146604             PERFORM 9999-ABEND                                   12610000
146605     END-EVALUATE.                                                12620000
146606                                                                  12630000
146607/                                                                 12640000
146608 3040-UPDATE-DTL-REC.                                             12650000
146609                                                                  12660000
146610     MOVE '3040-UPDATE-DTL-REC'  TO WS001-PARAGRAPH-NAME.         12670000
146611                                                                  12680000
146612     EXEC SQL                                                     12690000
146613          UPDATE WST_SHPMT_XREF_DTL                               12700000
146614             SET ACTV_CDE         = 'I'                           12710000
146615                ,DWNLD_CDE        = 'N'                           12720000
146616             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                12730000
146617             AND   PO_NBR         = :DK-PO-NBR                    12740000
146618             AND   RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              12750000
146619     END-EXEC.                                                    12760000
146620                                                                  12770000
146621     EVALUATE TRUE                                                12780000
146622         WHEN SQLCODE = ZERO                                      12790000
146623             IF PS-LOG-SWITCH-YES                                 12800001
146624                 MOVE DK-PO-NBR TO WS-DISPLAY-1                   12810000
146625                 MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2             12820000
146626                 INITIALIZE PV-MSG-AREA                           12830001
146627                 STRING   ' ' WS001-SRC-TASK-NUMBER               12840000
146628                          ' WSKUP305-3040:'                       12850000
146629                          ' UPDATE WST_SHPMT_XREF_DTL'            12860000
146630                          ' FOR SHPMT='                           12870000
146631                          DK-EXT-SHP-ID                           12880000
146632                          ' PO NBR='                              12890000
146633                          WS-DISPLAY-1                            12900000
146634                          ' RCVR SEQ='                            12910000
146635                          WS-DISPLAY-2                            12920000
146636                          DELIMITED BY SIZE                       12930000
146637                          INTO PV-MSG-AREA                        12940001
146638                 PERFORM 7000-WRITE-TO-LOG                        12950001
146639             END-IF                                               12960000
146640         WHEN SQLCODE = -904                                      12970000
146641         WHEN SQLCODE = -913                                      12980000
146642         WHEN SQLCODE = -911                                      12990000
146643              CONTINUE                                            13000000
146644         WHEN SQLWARN0 NOT = SPACES                               13010000
146645         WHEN SQLCODE NOT = ZERO                                  13020000
146647             MOVE SQLCODE               TO PV-SQL-RETURN-CD       13030000
146653             INITIALIZE PV-MSG-AREA                               13040001
146654             STRING   ' ' WS001-SRC-TASK-NUMBER                   13050000
146655                      ' WSKUP305-3040 ERROR:'                     13060000
146656                      ' SQL='                                     13070000
146657                      PV-SQL-RETURN-CD                            13080000
146658                      DELIMITED BY SIZE                           13090000
146659                      INTO PV-MSG-AREA                            13100001
146660             PERFORM 7000-WRITE-TO-LOG                            13110001
146662                                                                  13120000
146663             SET WS001-INVALID-SQL      TO TRUE                   13130000
146664             STRING 'SQL='                                        13140000
146665                  PV-SQL-RETURN-CD                                13150000
146666                  DELIMITED BY SIZE                               13160000
146667                                      INTO WS001-CRA-RET-MSG      13170000
146669             MOVE SQLCA                 TO WS001-SQLCA            13190000
146677             PERFORM 9999-ABEND                                   13250000
146678     END-EVALUATE.                                                13260000
146679                                                                  13270000
146680/                                                                 13280000
146681 3050-UPDATE-HDR-REC.                                             13290000
146682                                                                  13300000
146683     MOVE '3050-UPDATE-HDR-REC'  TO WS001-PARAGRAPH-NAME.         13310000
146684                                                                  13320000
146685     EXEC SQL                                                     13330000
146686          UPDATE WST_SHPMT_XREF_HDR                               13340000
146687             SET DWNLD_CDE        = 'P'                           13350000
146688             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                13360000
146689     END-EXEC.                                                    13370000
146690                                                                  13380000
146691     EVALUATE TRUE                                                13390000
146692         WHEN SQLCODE = ZERO                                      13400000
146693             IF PS-LOG-SWITCH-YES                                 13410001
146694                 INITIALIZE PV-MSG-AREA                           13420001
146695                 STRING   ' ' WS001-SRC-TASK-NUMBER               13430000
146696                          ' WSKUP305-3050:'                       13440000
146697                          ' UPDATE WST_SHPMT_XREF_HDR'            13450000
146698                          ' FOR SHPMT='                           13460000
146699                          DK-EXT-SHP-ID                           13470000
146700                          DELIMITED BY SIZE                       13480000
146701                          INTO PV-MSG-AREA                        13490001
146702                 PERFORM 7000-WRITE-TO-LOG                        13500001
146703             END-IF                                               13510000
146704         WHEN SQLCODE = -904                                      13520000
146705         WHEN SQLCODE = -913                                      13530000
146706         WHEN SQLCODE = -911                                      13540000
146707              CONTINUE                                            13550000
146708         WHEN SQLWARN0 NOT = SPACES                               13560000
146709         WHEN SQLCODE NOT = ZERO                                  13570000
146711             MOVE SQLCODE               TO PV-SQL-RETURN-CD       13580000
146717             INITIALIZE PV-MSG-AREA                               13590001
146718             STRING   ' ' WS001-SRC-TASK-NUMBER                   13600000
146719                      ' WSKUP305-3050 ERROR:'                     13610000
146720                      ' SQL='                                     13620000
146721                      PV-SQL-RETURN-CD                            13630000
146722                      DELIMITED BY SIZE                           13640000
146723                      INTO PV-MSG-AREA                            13650001
146724             PERFORM 7000-WRITE-TO-LOG                            13660001
146726                                                                  13670000
146727             SET WS001-INVALID-SQL      TO TRUE                   13680000
146728             STRING 'SQL='                                        13690000
146729                  PV-SQL-RETURN-CD                                13700000
146730                  DELIMITED BY SIZE                               13710000
146731                                      INTO WS001-CRA-RET-MSG      13720000
146733             MOVE SQLCA                 TO WS001-SQLCA            13740000
146739             PERFORM 9999-ABEND                                   13800000
146740     END-EVALUATE.                                                13810000
146741                                                                  13820000
146742/                                                                 13830000
146681 3060-CHECK-FOR-TRIP-HDR.                                         13840000
146682                                                                  13850000
146683     MOVE '3060-CHECK-FOR-TRIP-HDR' TO WS001-PARAGRAPH-NAME.      13860000
146684                                                                  13870000
146685     EXEC SQL                                                     13880000
146686          SELECT EXT_SHP_ID                                       13890000
146686          INTO   :WST00001-EXT-SHP-ID                             13900000
146687          FROM   WST_SHPMT_XREF_HDR                               13910000
146688          WHERE  INTR_TRIP_ID  = :DK-TRIP-ID                      13920000
146688          AND    SOR_CDE       = 'RC'                             13930000
146689     END-EXEC.                                                    13940000
146690                                                                  13950000
146691     EVALUATE TRUE                                                13960000
146692         WHEN SQLCODE = ZERO                                      13970000
146693             SET PS-TRIP-HDR-EXIST-YES TO TRUE                    13980000
146693             MOVE WST00001-EXT-SHP-ID  TO WS-EXT-SHP-ID           13981013
146693                                          DK-EXT-SHP-ID           13982013
146693             IF PS-LOG-SWITCH-YES                                 13990001
146694                 INITIALIZE PV-MSG-AREA                           14000001
157700                 MOVE DK-TRIP-ID TO WS-DISPLAY-1                  14010000
146695                 STRING   ' ' WS001-SRC-TASK-NUMBER               14020000
146696                          ' WSKUP305-3060:'                       14030000
146697                          ' FOUND XREF_HDR FOR TRIP='             14040000
146699                          WS-DISPLAY-1                            14050000
146700                          DELIMITED BY SIZE                       14060000
146701                          INTO PV-MSG-AREA                        14070001
146702                 PERFORM 7000-WRITE-TO-LOG                        14080001
146703             END-IF                                               14090000
146704         WHEN SQLCODE = +100                                      14100000
146704         WHEN SQLCODE = -904                                      14110000
146705         WHEN SQLCODE = -913                                      14120000
146706         WHEN SQLCODE = -911                                      14130000
146707              CONTINUE                                            14140000
146708         WHEN SQLWARN0 NOT = SPACES                               14150000
146709         WHEN SQLCODE NOT = ZERO                                  14160000
146711             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14170000
146717             INITIALIZE PV-MSG-AREA                               14180001
146718             STRING   ' ' WS001-SRC-TASK-NUMBER                   14190000
146719                      ' WSKUP305-3060 ERROR:'                     14200000
146720                      ' SQL='                                     14210000
146721                      PV-SQL-RETURN-CD                            14220000
146722                      DELIMITED BY SIZE                           14230000
146723                      INTO PV-MSG-AREA                            14240001
146724             PERFORM 7000-WRITE-TO-LOG                            14250001
146726                                                                  14260000
146727             SET WS001-INVALID-SQL      TO TRUE                   14270000
146728             STRING 'SQL='                                        14280000
146729                  PV-SQL-RETURN-CD                                14290000
146730                  DELIMITED BY SIZE                               14300000
146731                                      INTO WS001-CRA-RET-MSG      14310000
146733             MOVE SQLCA                 TO WS001-SQLCA            14330000
146739             PERFORM 9999-ABEND                                   14390000
146740     END-EVALUATE.                                                14400000
146741                                                                  14410000
146742/                                                                 14420000
146743 3100-CHECK-FOR-INACTIVE.                                         14421018
146741                                                                  14422018
146741* CHECK FOR ANY OF THE HEADERS FOR THIS TRIP/PO/RCVR WHERE        14423018
146741* ALL OF THE DETAIL ROWS ARE INACTIVE.  IF FOUND, THEN            14424018
146741* CHANGE THE DWNLD-CDE FOR THE HEADER TO 'X'.                     14425018
146741                                                                  14426018
146683     MOVE '3100-CHECK-FOR-INACTIVE' TO WS001-PARAGRAPH-NAME.      14427018
146684                                                                  14428018
107460     PERFORM 3110-OPEN-TRIP-INACT-CSR.                            14429018
107500     PERFORM 3120-FETCH-TRIP-INACT-CSR UNTIL                      14429118
058100             PS-EOF-TRIP-INACT-CSR-YES.                           14429218
107700     PERFORM 3130-CLOSE-TRIP-INACT-CSR.                           14429318
146742/                                                                 14429418
108600 3110-OPEN-TRIP-INACT-CSR.                                        14429518
108601     MOVE '3110-OPEN-TRIP-INACT-CSR'                              14429618
108602                                 TO WS001-PARAGRAPH-NAME.         14429718
108700                                                                  14429818
108900     SET PS-EOF-TRIP-INACT-CSR-NO     TO TRUE.                    14429918
109600                                                                  14430018
109700     EXEC SQL                                                     14430118
109800          OPEN TRIP-INACT-CSR                                     14430218
109900     END-EXEC.                                                    14430318
110000                                                                  14430418
110100     EVALUATE TRUE                                                14430518
110200         WHEN SQLCODE = ZERO                                      14430618
110300             IF PS-LOG-SWITCH-YES                                 14430718
110301                 INITIALIZE PV-MSG-AREA                           14430818
110301                 MOVE DK-TRIP-ID        TO WS-DISPLAY-1           14430918
110301                 MOVE DK-PO-NBR         TO WS-DISPLAY-2           14431018
110301                 MOVE DK-RCVR-SEQ-NBR   TO WS-DISPLAY-4           14431118
110310                 STRING   ' ' WS001-SRC-TASK-NUMBER               14431218
110400                          ' WSKUP305-3110:'                       14431318
110500                          ' OPEN TRIP-INACT-CSR'                  14431418
110500                          ' FOR TRIP=' WS-DISPLAY-1               14431518
110500                          ' PO=' WS-DISPLAY-2                     14431618
110500                          ' -' WS-DISPLAY-4                       14431718
110510                          DELIMITED BY SIZE                       14431818
110600                          INTO PV-MSG-AREA                        14431918
110700                 PERFORM 7000-WRITE-TO-LOG                        14432018
110800             END-IF                                               14432118
110900         WHEN SQLCODE = -904                                      14432218
111000         WHEN SQLCODE = -913                                      14432318
111100         WHEN SQLCODE = -911                                      14432418
111200              CONTINUE                                            14432518
111300         WHEN SQLWARN0 NOT = SPACES                               14432618
111400         WHEN SQLCODE NOT = ZERO                                  14432718
112200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14432818
112802             INITIALIZE PV-MSG-AREA                               14432918
112803             STRING   ' ' WS001-SRC-TASK-NUMBER                   14433018
113000                      ' WSKUP305-3110 ERROR:'                     14433118
113100                      ' SQL='                                     14433218
113200                      PV-SQL-RETURN-CD                            14433318
113300                      DELIMITED BY SIZE                           14433418
113400                      INTO PV-MSG-AREA                            14433518
113500             PERFORM 7000-WRITE-TO-LOG                            14433618
113601                                                                  14433718
113602             SET WS001-INVALID-SQL      TO TRUE                   14433818
113603             STRING 'SQL='                                        14433918
113604                  PV-SQL-RETURN-CD                                14434018
113605                  DELIMITED BY SIZE                               14434118
113606                                      INTO WS001-CRA-RET-MSG      14434218
113608             MOVE SQLCA                 TO WS001-SQLCA            14434418
113614             PERFORM 9999-ABEND                                   14434818
113615     END-EVALUATE.                                                14435618
113620                                                                  14435718
113800/                                                                 14435818
113900 3120-FETCH-TRIP-INACT-CSR.                                       14435918
113901                                                                  14436018
113902     MOVE '3120-FETCH-TRIP-INACT-CSR'                             14436118
113903                                 TO WS001-PARAGRAPH-NAME.         14436218
113904                                                                  14436318
113905* GET DATA FROM WST_SHPMT_XREF_HDR & WST_SHPMT_XREF_DTL.          14436418
113906* KEYS ARE TRIP/PO/RCVR                                           14436518
113906* THERE COULD BE MULTIPLE ROWS RETURNED DUE TO DUMMY SHIPMENTS    14436618
114000                                                                  14436718
114900     EXEC SQL                                                     14436818
115000          FETCH TRIP-INACT-CSR                                    14436918
115100          INTO                                                    14437018
115200                :WST00001-EXT-SHP-ID                              14437118
115200               ,:WST00001-DWNLD-TMST                              14437228
115500     END-EXEC.                                                    14437328
115600                                                                  14437428
115700     EVALUATE TRUE                                                14437528
115800         WHEN SQLCODE = ZERO                                      14437628
116400             MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID            14437728
116400                                         WS-EXT-SHP-ID            14437828
116400             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            14437928
116500             IF PS-LOG-SWITCH-YES                                 14438028
116501                 INITIALIZE PV-MSG-AREA                           14438128
116510                 STRING   ' ' WS001-SRC-TASK-NUMBER               14438228
116600                          ' WSKUP305-3120:'                       14438328
116700                          ' SHPMT='                               14438428
116800                          DK-EXT-SHP-ID                           14438528
116810                          DELIMITED BY SIZE                       14438628
116900                          INTO PV-MSG-AREA                        14438728
117000                 PERFORM 7000-WRITE-TO-LOG                        14438828
117100             END-IF                                               14438928
117200*            PERFORM 2110-UPDATE-HDR-X                            14439028
117200             SET PS-CANCEL-SHPMT-YES   TO TRUE                    14439128
117303             IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES              14439228
146400                 SET PS-APPT-SENT-NO         TO TRUE              14439328
146500                 PERFORM 5700-CALL-DOWNLOAD-MOD                   14439428
146400                 SET PS-IMMED-DOWNLOAD-NO    TO TRUE              14439528
145502             END-IF                                               14439628
146503                                                                  14439728
146504         WHEN SQLCODE = -904                                      14439828
146505         WHEN SQLCODE = -913                                      14439928
146506         WHEN SQLCODE = -911                                      14440028
146507              CONTINUE                                            14440128
146508         WHEN SQLCODE = +100                                      14440228
146509              SET PS-EOF-TRIP-INACT-CSR-YES TO TRUE               14440328
146510         WHEN SQLWARN0 NOT = SPACES                               14440428
146511         WHEN SQLCODE NOT = ZERO                                  14440528
146513             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14440628
146519             INITIALIZE PV-MSG-AREA                               14440728
146520             STRING   ' ' WS001-SRC-TASK-NUMBER                   14440828
146521                      ' WSKUP305-3120 ERROR:'                     14440928
146522                      ' SQL='                                     14441028
146523                      PV-SQL-RETURN-CD                            14441128
146524                      DELIMITED BY SIZE                           14441228
146525                      INTO PV-MSG-AREA                            14441328
146526             PERFORM 7000-WRITE-TO-LOG                            14441428
146528                                                                  14441528
146529             SET WS001-INVALID-SQL      TO TRUE                   14441628
146530             STRING 'SQL='                                        14441728
146531                  PV-SQL-RETURN-CD                                14441828
146532                  DELIMITED BY SIZE                               14441928
146533                                      INTO WS001-CRA-RET-MSG      14442028
146535             MOVE SQLCA                 TO WS001-SQLCA            14442128
146543             PERFORM 9999-ABEND                                   14442218
146544     END-EVALUATE.                                                14442318
146545                                                                  14442418
146546/                                                                 14442518
146547 3130-CLOSE-TRIP-INACT-CSR.                                       14442618
146548                                                                  14442718
146549     MOVE '3130-CLOSE-TRIP-INACT-CSR'                             14442818
146550                                 TO WS001-PARAGRAPH-NAME.         14442918
146551                                                                  14443018
146552     EXEC SQL                                                     14443118
146553          CLOSE TRIP-INACT-CSR                                    14443218
146554     END-EXEC.                                                    14443318
146503                                                                  14443418
146556     EVALUATE TRUE                                                14443518
146557         WHEN SQLCODE = ZERO                                      14443618
146558             IF PS-LOG-SWITCH-YES                                 14443718
146559                 INITIALIZE PV-MSG-AREA                           14443818
146560                 STRING   ' ' WS001-SRC-TASK-NUMBER               14443918
146561                          ' WSKUP305-3130:'                       14444018
146562                          ' CLOSE TRIP-INACT-CSR'                 14444118
146563                          DELIMITED BY SIZE                       14444218
146564                          INTO PV-MSG-AREA                        14444319
146565                 PERFORM 7000-WRITE-TO-LOG                        14444418
146566             END-IF                                               14444518
146567         WHEN SQLCODE = -904                                      14444618
146568         WHEN SQLCODE = -913                                      14444718
146569         WHEN SQLCODE = -911                                      14444818
146570              CONTINUE                                            14444918
146571         WHEN SQLWARN0 NOT = SPACES                               14445018
146572         WHEN SQLCODE NOT = ZERO                                  14445118
146574             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14445218
146580             INITIALIZE PV-MSG-AREA                               14445318
146581             STRING   ' ' WS001-SRC-TASK-NUMBER                   14445418
146582                      ' WSKUP305-3130 ERROR:'                     14445518
146583                      ' SQL='                                     14445618
146584                      PV-SQL-RETURN-CD                            14445718
146585                      DELIMITED BY SIZE                           14445818
146586                      INTO PV-MSG-AREA                            14445918
146587             PERFORM 7000-WRITE-TO-LOG                            14446018
146589                                                                  14446118
146590             SET WS001-INVALID-SQL      TO TRUE                   14446218
146591             STRING 'SQL='                                        14446318
146592                  PV-SQL-RETURN-CD                                14446418
146593                  DELIMITED BY SIZE                               14446518
146594                                      INTO WS001-CRA-RET-MSG      14446618
146596             MOVE SQLCA                 TO WS001-SQLCA            14446718
146604             PERFORM 9999-ABEND                                   14447118
146605     END-EVALUATE.                                                14447218
146606                                                                  14447318
146607/                                                                 14447418
146743 3150-CHECK-FOR-DOWNLOAD.                                         14447530
146741                                                                  14447630
146741* CHECK FOR ANY OF THE HEADERS FOR THIS TRIP/PO/RCVR WHERE        14447730
146741* IT HAS BEEN DOWNLOADED PREVIOUSLY.  FOR EACH ONE FOUND,         14447830
146741* CALL THE ASN DOWNLOAD MODULE.                                   14447930
146741                                                                  14448030
146683     MOVE '3150-CHECK-FOR-DOWNLOAD' TO WS001-PARAGRAPH-NAME.      14448130
146684                                                                  14448230
107460     PERFORM 3160-OPEN-TRIP-DWNLD-CSR.                            14448330
107500     PERFORM 3170-FETCH-TRIP-DWNLD-CSR UNTIL                      14448430
058100             PS-EOF-TRIP-DWNLD-CSR-YES.                           14448530
107700     PERFORM 3180-CLOSE-TRIP-DWNLD-CSR.                           14448630
146742/                                                                 14448730
108600 3160-OPEN-TRIP-DWNLD-CSR.                                        14448830
108601     MOVE '3160-OPEN-TRIP-DWNLD-CSR'                              14448930
108602                                 TO WS001-PARAGRAPH-NAME.         14449030
108700                                                                  14449130
108900     SET PS-EOF-TRIP-DWNLD-CSR-NO     TO TRUE.                    14449230
109600                                                                  14449330
109700     EXEC SQL                                                     14449430
109800          OPEN TRIP-DWNLD-CSR                                     14449530
109900     END-EXEC.                                                    14449630
110000                                                                  14449730
110100     EVALUATE TRUE                                                14449830
110200         WHEN SQLCODE = ZERO                                      14449930
110300             IF PS-LOG-SWITCH-YES                                 14450030
110301                 INITIALIZE PV-MSG-AREA                           14450130
110301                 MOVE DK-TRIP-ID        TO WS-DISPLAY-1           14450230
110301                 MOVE DK-PO-NBR         TO WS-DISPLAY-2           14450330
110301                 MOVE DK-RCVR-SEQ-NBR   TO WS-DISPLAY-4           14450430
110310                 STRING   ' ' WS001-SRC-TASK-NUMBER               14450530
110400                          ' WSKUP305-3160:'                       14450630
110500                          ' OPEN TRIP-DWNLD-CSR'                  14450730
110500                          ' FOR TRIP=' WS-DISPLAY-1               14450830
110500                          ' PO=' WS-DISPLAY-2                     14450930
110500                          ' -' WS-DISPLAY-4                       14451030
110510                          DELIMITED BY SIZE                       14451130
110600                          INTO PV-MSG-AREA                        14451230
110700                 PERFORM 7000-WRITE-TO-LOG                        14451330
110800             END-IF                                               14451430
110900         WHEN SQLCODE = -904                                      14451530
111000         WHEN SQLCODE = -913                                      14451630
111100         WHEN SQLCODE = -911                                      14451730
111200              CONTINUE                                            14451830
111300         WHEN SQLWARN0 NOT = SPACES                               14451930
111400         WHEN SQLCODE NOT = ZERO                                  14452030
112200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14452130
112802             INITIALIZE PV-MSG-AREA                               14452230
112803             STRING   ' ' WS001-SRC-TASK-NUMBER                   14452330
113000                      ' WSKUP305-3160 ERROR:'                     14452430
113100                      ' SQL='                                     14452530
113200                      PV-SQL-RETURN-CD                            14452630
113300                      DELIMITED BY SIZE                           14452730
113400                      INTO PV-MSG-AREA                            14452830
113500             PERFORM 7000-WRITE-TO-LOG                            14452930
113601                                                                  14453030
113602             SET WS001-INVALID-SQL      TO TRUE                   14453130
113603             STRING 'SQL='                                        14453230
113604                  PV-SQL-RETURN-CD                                14453330
113605                  DELIMITED BY SIZE                               14453430
113606                                      INTO WS001-CRA-RET-MSG      14453530
113608             MOVE SQLCA                 TO WS001-SQLCA            14453630
113614             PERFORM 9999-ABEND                                   14453730
113615     END-EVALUATE.                                                14453830
113620                                                                  14453930
113800/                                                                 14454030
113900 3170-FETCH-TRIP-DWNLD-CSR.                                       14454130
113901                                                                  14454230
113902     MOVE '3170-FETCH-TRIP-DWNLD-CSR'                             14454330
113903                                 TO WS001-PARAGRAPH-NAME.         14454430
113904                                                                  14454530
113905* GET DATA FROM WST_SHPMT_XREF_HDR & WST_SHPMT_XREF_DTL.          14454630
113906* KEYS ARE TRIP/PO/RCVR                                           14454730
113906* THERE COULD BE MULTIPLE ROWS RETURNED DUE TO DUMMY SHIPMENTS    14454830
114000                                                                  14454930
114900     EXEC SQL                                                     14455030
115000          FETCH TRIP-DWNLD-CSR                                    14455130
115100          INTO                                                    14455230
115200                :WST00001-EXT-SHP-ID                              14455330
115500     END-EXEC.                                                    14455530
115600                                                                  14455630
115700     EVALUATE TRUE                                                14455730
115800         WHEN SQLCODE = ZERO                                      14455830
116400             MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID            14455930
116400                                         WS-EXT-SHP-ID            14456030
116500             IF PS-LOG-SWITCH-YES                                 14456230
116501                 INITIALIZE PV-MSG-AREA                           14456330
116510                 STRING   ' ' WS001-SRC-TASK-NUMBER               14456430
116600                          ' WSKUP305-3170:'                       14456530
116700                          ' SHPMT='                               14456630
116800                          DK-EXT-SHP-ID                           14456730
116810                          DELIMITED BY SIZE                       14456830
116900                          INTO PV-MSG-AREA                        14456930
117000                 PERFORM 7000-WRITE-TO-LOG                        14457030
117100             END-IF                                               14457130
146400             SET PS-APPT-SENT-NO         TO TRUE                  14457530
146500             PERFORM 5700-CALL-DOWNLOAD-MOD                       14457630
146400             SET PS-IMMED-DOWNLOAD-NO    TO TRUE                  14457730
146503                                                                  14457930
146504         WHEN SQLCODE = -904                                      14458030
146505         WHEN SQLCODE = -913                                      14458130
146506         WHEN SQLCODE = -911                                      14458230
146507              CONTINUE                                            14458330
146508         WHEN SQLCODE = +100                                      14458430
146509              SET PS-EOF-TRIP-DWNLD-CSR-YES TO TRUE               14458530
146510         WHEN SQLWARN0 NOT = SPACES                               14458630
146511         WHEN SQLCODE NOT = ZERO                                  14458730
146513             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14458830
146519             INITIALIZE PV-MSG-AREA                               14458930
146520             STRING   ' ' WS001-SRC-TASK-NUMBER                   14459030
146521                      ' WSKUP305-3170 ERROR:'                     14459130
146522                      ' SQL='                                     14459230
146523                      PV-SQL-RETURN-CD                            14459330
146524                      DELIMITED BY SIZE                           14459430
146525                      INTO PV-MSG-AREA                            14459530
146526             PERFORM 7000-WRITE-TO-LOG                            14459630
146528                                                                  14459730
146529             SET WS001-INVALID-SQL      TO TRUE                   14459830
146530             STRING 'SQL='                                        14459930
146531                  PV-SQL-RETURN-CD                                14460030
146532                  DELIMITED BY SIZE                               14460130
146533                                      INTO WS001-CRA-RET-MSG      14460230
146535             MOVE SQLCA                 TO WS001-SQLCA            14460330
146543             PERFORM 9999-ABEND                                   14460430
146544     END-EVALUATE.                                                14460530
146545                                                                  14460630
146546/                                                                 14460730
146547 3180-CLOSE-TRIP-DWNLD-CSR.                                       14460830
146548                                                                  14460930
146549     MOVE '3180-CLOSE-TRIP-DWNLD-CSR'                             14461030
146550                                 TO WS001-PARAGRAPH-NAME.         14461130
146551                                                                  14461230
146552     EXEC SQL                                                     14461330
146553          CLOSE TRIP-DWNLD-CSR                                    14461430
146554     END-EXEC.                                                    14461530
146503                                                                  14461630
146556     EVALUATE TRUE                                                14461730
146557         WHEN SQLCODE = ZERO                                      14461830
146558             IF PS-LOG-SWITCH-YES                                 14461930
146559                 INITIALIZE PV-MSG-AREA                           14462030
146560                 STRING   ' ' WS001-SRC-TASK-NUMBER               14462130
146561                          ' WSKUP305-3180:'                       14462230
146562                          ' CLOSE TRIP-DWNLD-CSR'                 14462330
146563                          DELIMITED BY SIZE                       14462430
146564                          INTO PV-MSG-AREA                        14462530
146565                 PERFORM 7000-WRITE-TO-LOG                        14462630
146566             END-IF                                               14462730
146567         WHEN SQLCODE = -904                                      14462830
146568         WHEN SQLCODE = -913                                      14462930
146569         WHEN SQLCODE = -911                                      14463030
146570              CONTINUE                                            14463130
146571         WHEN SQLWARN0 NOT = SPACES                               14463230
146572         WHEN SQLCODE NOT = ZERO                                  14463330
146574             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14463430
146580             INITIALIZE PV-MSG-AREA                               14463530
146581             STRING   ' ' WS001-SRC-TASK-NUMBER                   14463630
146582                      ' WSKUP305-3180 ERROR:'                     14463730
146583                      ' SQL='                                     14463830
146584                      PV-SQL-RETURN-CD                            14463930
146585                      DELIMITED BY SIZE                           14464030
146586                      INTO PV-MSG-AREA                            14464130
146587             PERFORM 7000-WRITE-TO-LOG                            14464230
146589                                                                  14464330
146590             SET WS001-INVALID-SQL      TO TRUE                   14464430
146591             STRING 'SQL='                                        14464530
146592                  PV-SQL-RETURN-CD                                14464630
146593                  DELIMITED BY SIZE                               14464730
146594                                      INTO WS001-CRA-RET-MSG      14464830
146596             MOVE SQLCA                 TO WS001-SQLCA            14464930
146604             PERFORM 9999-ABEND                                   14465030
146605     END-EVALUATE.                                                14465130
146606                                                                  14465230
146607/                                                                 14465330
146743 4000-MANUAL-DOWNLOAD.                                            14465400
146744                                                                  14465500
146744**************************************************************    14465610
146744* MANUAL DOWNLOAD PROCESSING - SUMMARY                            14465710
146744*   - CHECK TO SEE IF THERE ARE ANY DUMMY SHIPMENTS FOR THIS TRIP 14465810
146744*     IF THERE ARE 1 OR MORE DUMMY SHIPMENTS, THEN SET THE        14465910
146744*     SWITCH TO INDICATE THAT NO UPDATING WILL BE DONE.           14466010
146744*                                                                 14466110
146744*   - OPEN THE HDR-CSR-1.  THIS CURSOR GETS THE EXT_SHP_ID FROM   14466210
146744*     WST_SHPMT_XREF_HDR FOR THE INPUT TRIP_ID, WHERE THE         14466310
146744*     SOR_CDE = 'RC' AND RECEIVING HAS NOT BEGUN.                 14466410
146744*                                                                 14466510
146744*   - IF THERE ARE NO RECORDS ON THE HDR FILE, THEN CREATE THE    14466610
146744*     HDR AND DTL ROWS.  SET THE CHECK-ASN SWITCH ON, SO THAT THE 14466710
146744*     SHIPMENT WILL BE SPLIT OUT IF THERE ARE BOTH CASE AND SKU   14466810
146744*     DATA ON THE SHIPMENT.  THE HEADER(S) WILL BE DOWNLOADED.    14466910
146744*                                                                 14467010
146744*   - IF THERE IS ONE RECORD ON THE HDR FILE, THEN CHECK TO SEE   14467110
146744*     IF THERE ARE ADDITIONAL PO'S THAT SHOULD BE ADDED TO THE    14467210
146744*     SHIPMENT.  SET THE CHECK-ASN SWITCH ON, SO THAT THE         14467310
146744*     SHIPMENT WILL BE SPLIT OUT IF THERE ARE BOTH CASE AND SKU   14467410
146744*     DATA ON THE SHIPMENT.  THE HEADER(S) WILL BE DOWNLOADED.    14467510
146744*                                                                 14467610
146744*   - IF THERE IS MORE THAN ONE RECORD ON THE HDR FILE (THIS      14467710
146744*     WILL BE AN ORIGINAL AND ONE OR MORE DUMMY SHIPMENTS),       14467810
146744*     DO NOT UPDATE OR INSERT TO ANY OF THE HEADERS.              14467910
146744*     THE HEADER(S) WILL BE DOWNLOADED.                           14468010
146744**************************************************************    14468110
146744                                                                  14468210
146745     MOVE '4000-MANUAL-DOWNLOAD' TO WS001-PARAGRAPH-NAME.         14468300
146751     SET PS-CHECK-ASN-NO              TO TRUE.                    14468410
146746                                                                  14468500
146746* CHECK TO SEE IF THERE ARE ANY DUMMY RECORDS FOR THIS SHIPMENT   14468610
146746* IF THERE ARE, THEN WE DO NOT WANT TO ADD PO'S TO THIS SHIPMENT  14468710
146746                                                                  14468810
146746     PERFORM 5010-GET-MAX-DMY-NBR.                                14468910
146746     IF WS-DMY-SEQ-NBR > 0                                        14469010
146746         SET PS-MANUAL-UPDATE-NO      TO TRUE                     14469110
146746     ELSE                                                         14469210
146746         SET PS-MANUAL-UPDATE-YES     TO TRUE                     14469310
146746     END-IF.                                                      14469410
146746                                                                  14469510
146747     PERFORM 4010-OPEN-HDR-CSR-1.                                 14470000
146748     PERFORM 4020-FETCH-HDR-CSR-1 UNTIL                           14480000
146749             PS-EOF-HDR-CSR-1-YES.                                14490000
146750     PERFORM 4030-CLOSE-HDR-CSR-1.                                14500000
146752                                                                  14520000
146753/                                                                 14530000
146754 4010-OPEN-HDR-CSR-1.                                             14540000
146755                                                                  14550000
146756     MOVE '4010-OPEN-HDR-CSR-1'  TO WS001-PARAGRAPH-NAME.         14560000
146757                                                                  14570000
146758     SET PS-EOF-HDR-CSR-1-NO        TO TRUE.                      14580000
146759                                                                  14590000
146760     EXEC SQL                                                     14600000
146761          OPEN HDR-CSR-1                                          14610000
146762     END-EXEC.                                                    14620000
146763                                                                  14630000
146764     EVALUATE TRUE                                                14640000
146765         WHEN SQLCODE = ZERO                                      14650000
146766             IF PS-LOG-SWITCH-YES                                 14660001
146767                 INITIALIZE PV-MSG-AREA                           14670001
146767                 MOVE DK-TRIP-ID         TO WS-DISPLAY-1          14671010
146768                 STRING   ' ' WS001-SRC-TASK-NUMBER               14680000
146769                          ' WSKUP305-4010:'                       14681000
146770                          ' OPEN HDR-CSR-1'                       14682000
146770                          ' FOR TRIP=' WS-DISPLAY-1               14682110
146771                          DELIMITED BY SIZE                       14683000
146772                          INTO PV-MSG-AREA                        14683101
146773                 PERFORM 7000-WRITE-TO-LOG                        14683201
146774             END-IF                                               14683300
146775         WHEN SQLCODE = -904                                      14683400
146776         WHEN SQLCODE = -913                                      14683500
146777         WHEN SQLCODE = -911                                      14683600
146778              CONTINUE                                            14683700
146779         WHEN SQLWARN0 NOT = SPACES                               14683800
146780         WHEN SQLCODE NOT = ZERO                                  14683900
146782               MOVE SQLCODE               TO PV-SQL-RETURN-CD     14684000
146788               INITIALIZE PV-MSG-AREA                             14684101
146789               STRING   ' ' WS001-SRC-TASK-NUMBER                 14684200
146790                        ' WSKUP305-4010 ERROR:'                   14684300
146791                        ' SQL='                                   14684400
146792                        PV-SQL-RETURN-CD                          14684500
146793                        DELIMITED BY SIZE                         14684600
146794                        INTO PV-MSG-AREA                          14684701
146795               PERFORM 7000-WRITE-TO-LOG                          14684801
146797                                                                  14684900
146798             SET WS001-INVALID-SQL      TO TRUE                   14685000
146799             STRING 'SQL='                                        14685100
146800                  PV-SQL-RETURN-CD                                14685200
146801                  DELIMITED BY SIZE                               14685300
146802                                      INTO WS001-CRA-RET-MSG      14685400
146804             MOVE SQLCA                 TO WS001-SQLCA            14685600
146810             PERFORM 9999-ABEND                                   14686000
146811     END-EVALUATE.                                                14686100
146812                                                                  14686200
146813     SET PS-FIRST-RECORD-YES        TO TRUE.                      14686300
146814                                                                  14686400
146815/                                                                 14686500
146816 4020-FETCH-HDR-CSR-1.                                            14686600
146817                                                                  14686700
146818     MOVE '4020-FETCH-HDR-CSR-1' TO WS001-PARAGRAPH-NAME.         14686800
146819                                                                  14686900
146820* GET EXT-SHP-ID FROM WST_SHPMT_XREF_HDR.  KEY IS TRIP-ID.        14687000
146822                                                                  14687100
146823     EXEC SQL                                                     14687200
146824          FETCH HDR-CSR-1                                         14687300
146825          INTO                                                    14687400
146826                :WST00001-EXT-SHP-ID                              14687500
146827              , :WST00001-DWNLD-TMST                              14687600
146828     END-EXEC.                                                    14687700
146829                                                                  14687800
146830     EVALUATE TRUE                                                14687900
146831         WHEN SQLCODE = ZERO                                      14688000
146832             IF PS-FIRST-RECORD-YES                               14688100
146836                 SET PS-FIRST-RECORD-NO TO TRUE                   14688500
146837             END-IF                                               14688600
146838             MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID            14688700
146839             IF PS-LOG-SWITCH-YES                                 14688801
146840                 INITIALIZE PV-MSG-AREA                           14688901
146841                 STRING   ' ' WS001-SRC-TASK-NUMBER               14689000
146842                          ' WSKUP305-4020:'                       14689100
146843                          ' SHPMT='                               14689200
146844                          WS-EXT-SHP-ID                           14689300
146845                          DELIMITED BY SIZE                       14689400
146846                          INTO PV-MSG-AREA                        14689501
146847                 PERFORM 7000-WRITE-TO-LOG                        14689601
146848             END-IF                                               14689700
146848* JAK 05/2007 - CHECK TO SEE IF THERE ARE ANY ADDITIONAL PO'S     14689810
147600             IF PS-MANUAL-UPDATE-YES                              14689910
147600                 PERFORM 5100-INSERT-DETAIL                       14690010
146849                 SET PS-CHECK-ASN-YES     TO TRUE                 14690110
147600             END-IF                                               14690210
146849             SET PS-APPT-SENT-NO      TO TRUE                     14690300
146850             SET PS-IMMED-DOWNLOAD-NO TO TRUE                     14690400
146851             PERFORM 5700-CALL-DOWNLOAD-MOD                       14690500
146852         WHEN SQLCODE = -904                                      14690600
146860         WHEN SQLCODE = -913                                      14690700
146900         WHEN SQLCODE = -911                                      14690800
147000              CONTINUE                                            14690900
147100         WHEN SQLCODE = +100                                      14691000
147200              SET PS-EOF-HDR-CSR-1-YES TO TRUE                    14691100
147300              IF PS-FIRST-RECORD-YES                              14691200
147400                  SET PS-DUMMY-HEADER-NO    TO TRUE               14691300
147410                  MOVE 'N'                  TO WS-DWNLD-CDE       14691400
147500                  PERFORM 5000-INSERT-HEADER                      14691500
147600                  PERFORM 5100-INSERT-DETAIL                      14692000
147700                  SET PS-APPT-SENT-YES      TO TRUE               14693000
147800                  SET PS-IMMED-DOWNLOAD-YES TO TRUE               14694000
147800                  SET PS-CHECK-ASN-YES      TO TRUE               14694110
147900              END-IF                                              14695000
148000         WHEN SQLWARN0 NOT = SPACES                               14696000
148100         WHEN SQLCODE NOT = ZERO                                  14697000
148900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14698000
149502             INITIALIZE PV-MSG-AREA                               14699001
149503             STRING   ' ' WS001-SRC-TASK-NUMBER                   14700000
149700                      ' WSKUP305-4020 ERROR:'                     14710000
149800                      ' SQL='                                     14720000
149900                      PV-SQL-RETURN-CD                            14730000
150000                      DELIMITED BY SIZE                           14740000
150100                      INTO PV-MSG-AREA                            14750001
150200             PERFORM 7000-WRITE-TO-LOG                            14760001
150301                                                                  14770000
150302             SET WS001-INVALID-SQL      TO TRUE                   14780000
150303             STRING 'SQL='                                        14790000
150304                  PV-SQL-RETURN-CD                                14800000
150305                  DELIMITED BY SIZE                               14810000
150306                                      INTO WS001-CRA-RET-MSG      14820000
150308             MOVE SQLCA                 TO WS001-SQLCA            14840000
150314             PERFORM 9999-ABEND                                   14900000
150315     END-EVALUATE.                                                14910000
150320                                                                  14920000
150500/                                                                 14930000
150600 4030-CLOSE-HDR-CSR-1.                                            14940000
150601                                                                  14950000
150602     MOVE '4030-CLOSE-HDR-CSR-1' TO WS001-PARAGRAPH-NAME.         14960000
150700                                                                  14970000
151500     EXEC SQL                                                     14980000
151600          CLOSE HDR-CSR-1                                         14990000
151700     END-EXEC.                                                    15000000
151800                                                                  15010000
151900     EVALUATE TRUE                                                15020000
152000         WHEN SQLCODE = ZERO                                      15030000
152100             IF PS-LOG-SWITCH-YES                                 15040001
152101                 INITIALIZE PV-MSG-AREA                           15050001
152110                 STRING   ' ' WS001-SRC-TASK-NUMBER               15060000
152200                          ' WSKUP305-4030:'                       15070000
152300                          ' CLOSE HDR-CSR-1'                      15080000
152310                          DELIMITED BY SIZE                       15090000
152400                          INTO PV-MSG-AREA                        15100001
152500                 PERFORM 7000-WRITE-TO-LOG                        15110001
152600             END-IF                                               15120000
152700         WHEN SQLCODE = -904                                      15130000
152800         WHEN SQLCODE = -913                                      15140000
152900         WHEN SQLCODE = -911                                      15150000
153000              CONTINUE                                            15160000
153100         WHEN SQLWARN0 NOT = SPACES                               15170000
153200         WHEN SQLCODE NOT = ZERO                                  15180000
154000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       15190000
154602             INITIALIZE PV-MSG-AREA                               15200001
154603             STRING   ' ' WS001-SRC-TASK-NUMBER                   15210000
154800                      ' WSKUP305-4030 ERROR:'                     15220000
154900                      ' SQL='                                     15230000
155000                      PV-SQL-RETURN-CD                            15240000
155100                      DELIMITED BY SIZE                           15250000
155200                      INTO PV-MSG-AREA                            15260001
155300             PERFORM 7000-WRITE-TO-LOG                            15270001
155401                                                                  15280000
155402             SET WS001-INVALID-SQL      TO TRUE                   15290000
155403             STRING 'SQL='                                        15300000
155404                  PV-SQL-RETURN-CD                                15310000
155405                  DELIMITED BY SIZE                               15320000
155406                                      INTO WS001-CRA-RET-MSG      15330000
155408             MOVE SQLCA                 TO WS001-SQLCA            15350000
155412             PERFORM 9999-ABEND                                   15390000
155413     END-EVALUATE.                                                15400000
155420                                                                  15410000
155600/                                                                 15420000
161500 5000-INSERT-HEADER.                                              16010000
161501                                                                  16020000
161502     MOVE '5000-INSERT-HEADER'        TO WS001-PARAGRAPH-NAME.    16030000
161600                                                                  16040000
161700     IF PS-DUMMY-HEADER-YES                                       16050000
161800         PERFORM 5010-GET-MAX-DMY-NBR                             16060000
161900         ADD 1                        TO WS-DMY-SEQ-NBR           16070000
162000         MOVE WS-EXT-SHP-ID           TO PV-SHIPMNT-NBR           16080000
162010         MOVE PV-SHIPMNT-NBR(1:10)    TO WS-ORIG-EXT-SHP-ID       16090000
162100         MOVE 'D'                     TO PV-D                     16100000
162200         MOVE WS-DMY-SEQ-NBR          TO PV-DUMMY-NBR             16110000
162300         MOVE PV-SHIPMNT-NBR          TO WST00001-EXT-SHP-ID      16120000
162400                                         WS-EXT-SHP-ID            16130000
162500         MOVE WS-DMY-SEQ-NBR          TO WST00001-DMY-SEQ-NBR     16140000
162600     ELSE                                                         16150000
162700         PERFORM 6000-CREATE-RANDOM-NBR                           16160000
162800                                                                  16170000
162900         INITIALIZE PV-SHIPMNT-NBR                                16180000
163000         MOVE DP902-RANDOM-NUMBER     TO PV-RANDOM-NBR            16190000
163100         MOVE 'K'                     TO PV-K                     16200000
163200         MOVE PV-SHIPMNT-NBR          TO WST00001-EXT-SHP-ID      16210000
163300                                         WS-EXT-SHP-ID            16220000
163400         MOVE 0                       TO WST00001-DMY-SEQ-NBR     16230000
163500     END-IF.                                                      16240000
163600                                                                  16250000
163700     MOVE WS-TRIP-ID           TO WST00001-INTR-TRIP-ID.          16260000
163800     MOVE 'RC'                 TO WST00001-SOR-CDE.               16270000
163900     MOVE WS001-OPER-UNT-ID    TO WST00001-DEST-LOC-NBR.          16280000
164000     MOVE WS-DWNLD-CDE         TO WST00001-DWNLD-CDE.             16290000
164100     MOVE PC-DEFAULT-NINES     TO WST00001-RCPT-TMST.             16300000
164200     MOVE WS001-USER-ID        TO WST00001-CRE-USR-ID.            16310000
164300     MOVE PV-CURRENT-TIMESTAMP TO WST00001-CRE-TMST.              16320000
164400     MOVE PC-DEFAULT-NINES     TO WST00001-DWNLD-TMST.            16330000
164500     MOVE PV-CURRENT-TIMESTAMP TO WST00001-LAST-PRCG-TMST.        16340000
164600     MOVE 'N'                  TO WST00001-PRC-CDE.               16350000
164700     MOVE 0                    TO WST00001-VER-NBR.               16360000
164710     MOVE WS001-CALLING-PROGRAM-NAME                              16370000
164720                               TO WST00001-CRE-PGM-CDE.           16380000
164800                                                                  16390000
164801     PERFORM 5020-WRITE-HEADER.                                   16400000
164802                                                                  16410000
164802* JAK 05/2007 - DO NOT UPDATE HEADER SEQ NBR                      16411009
164803*    IF PS-DUMMY-HEADER-YES                                       16420009
164804*        PERFORM 5030-UPDATE-ORIG-HDR                             16430009
164805*    END-IF.                                                      16440009
164806                                                                  16450000
178500/                                                                 16460000
178501 5010-GET-MAX-DMY-NBR.                                            16470000
178502                                                                  16480000
178503     MOVE '5010-GET-MAX-DMY-NBR' TO WS001-PARAGRAPH-NAME.         16490000
178504                                                                  16500000
178505     EXEC SQL                                                     16510000
178506         SELECT MAX (DMY_SEQ_NBR)                                 16520000
178507         INTO  :WS-DMY-SEQ-NBR                                    16530000
178508         FROM  WST_SHPMT_XREF_HDR                                 16540000
178509        WHERE  INTR_TRIP_ID   = :DK-TRIP-ID                       16550000
178510     END-EXEC.                                                    16560000
178511                                                                  16570000
178512     EVALUATE TRUE                                                16580000
178513         WHEN SQLCODE = ZERO                                      16590000
178514             IF PS-LOG-SWITCH-YES                                 16600001
178515                 MOVE WS-DMY-SEQ-NBR TO WS-DISPLAY-3              16610000
178516                 INITIALIZE PV-MSG-AREA                           16620001
178517                 STRING   ' ' WS001-SRC-TASK-NUMBER               16630000
178518                          ' WSKUP305-5010:'                       16640000
178519                          ' MAX DMY SEQ NBR='                     16650000
178520                          WS-DISPLAY-3                            16660000
178521                          ' SHPMT='                               16670000
178522                          WST00001-EXT-SHP-ID (1:10)              16680000
178523                          DELIMITED BY SIZE                       16690000
178524                          INTO PV-MSG-AREA                        16700001
178525                 PERFORM 7000-WRITE-TO-LOG                        16710001
178526             END-IF                                               16720000
178527         WHEN SQLCODE = +100                                      16730000
178527         WHEN SQLCODE = -305                                      16731010
178515                 MOVE 0              TO WS-DMY-SEQ-NBR            16732010
178528         WHEN SQLCODE = -811                                      16740000
178529         WHEN SQLCODE = -904                                      16750000
178530         WHEN SQLCODE = -913                                      16760000
178531         WHEN SQLCODE = -911                                      16770000
178532             CONTINUE                                             16780000
178533         WHEN SQLWARN0 NOT = SPACES                               16790000
178534         WHEN SQLCODE NOT = ZERO                                  16800000
178536             MOVE SQLCODE               TO PV-SQL-RETURN-CD       16810000
178542             INITIALIZE PV-MSG-AREA                               16820001
178543             STRING   ' ' WS001-SRC-TASK-NUMBER                   16830000
178544                      ' WSKUP305-5010 ERROR:'                     16840000
178545                      ' SQL='                                     16850000
178546                      PV-SQL-RETURN-CD                            16860000
178547                      DELIMITED BY SIZE                           16870000
178548                      INTO PV-MSG-AREA                            16880001
178549             PERFORM 7000-WRITE-TO-LOG                            16890001
178551                                                                  16900000
178552             SET WS001-INVALID-SQL      TO TRUE                   16910000
178553             STRING 'SQL='                                        16920000
178554                  PV-SQL-RETURN-CD                                16930000
178555                  DELIMITED BY SIZE                               16940000
178556                                      INTO WS001-CRA-RET-MSG      16950000
178558             MOVE SQLCA                 TO WS001-SQLCA            16970000
178564             PERFORM 9999-ABEND                                   17030000
178565     END-EVALUATE.                                                17040000
178566*                                                                 17050000
178567/                                                                 17060000
178568 5020-WRITE-HEADER.                                               17070000
178569                                                                  17080000
178570     EXEC SQL                                                     17090000
178571         INSERT INTO WST_SHPMT_XREF_HDR                           17100000
178572               (EXT_SHP_ID                                        17110000
178573              , INTR_TRIP_ID                                      17120000
178574              , SOR_CDE                                           17130000
178575              , DMY_SEQ_NBR                                       17140000
178576              , DEST_LOC_NBR                                      17150000
178577              , DWNLD_CDE                                         17160000
178578              , RCPT_TMST                                         17170000
178579              , CRE_USR_ID                                        17180000
178580              , CRE_TMST                                          17190000
178581              , DWNLD_TMST                                        17200000
178582              , LAST_PRCG_TMST                                    17210000
178583              , PRC_CDE                                           17220000
178584              , VER_NBR                                           17230000
178585              , CRE_PGM_CDE )                                     17240000
178586         VALUES                                                   17250000
178587              (:WST00001-EXT-SHP-ID                               17260000
178588             , :WST00001-INTR-TRIP-ID                             17270000
178589             , :WST00001-SOR-CDE                                  17280000
178590             , :WST00001-DMY-SEQ-NBR                              17290000
178591             , :WST00001-DEST-LOC-NBR                             17300000
178592             , :WST00001-DWNLD-CDE                                17310000
178593             , :WST00001-RCPT-TMST                                17320000
178594             , :WST00001-CRE-USR-ID                               17330000
178595             , :WST00001-CRE-TMST                                 17340000
178596             , :WST00001-DWNLD-TMST                               17350000
178597             , :WST00001-LAST-PRCG-TMST                           17360000
178598             , :WST00001-PRC-CDE                                  17370000
178599             , :WST00001-VER-NBR                                  17380000
178600             , :WST00001-CRE-PGM-CDE)                             17390000
178601    END-EXEC.                                                     17400000
178602                                                                  17410000
178603     EVALUATE TRUE                                                17420000
178604         WHEN SQLCODE = ZERO                                      17430000
178605              SET PS-HEADER-CREATED-YES  TO TRUE                  17431010
178605              IF PS-LOG-SWITCH-YES                                17440001
178606                  MOVE WST00001-INTR-TRIP-ID TO WS-DISPLAY-1      17441010
178606                  INITIALIZE PV-MSG-AREA                          17450001
178607                  STRING   ' ' WS001-SRC-TASK-NUMBER              17460000
178608                           ' WSKUP305-5020:'                      17470000
178609                           ' INSERT XREF_SHPMT_XREF_HDR'          17480000
178610                           ' FOR SHPMT='                          17490000
178611                           WST00001-EXT-SHP-ID                    17491010
178610                           ' TRIP=' WS-DISPLAY-1                  17492010
178612                           DELIMITED BY SIZE                      17510000
178613                           INTO PV-MSG-AREA                       17520001
178614                  PERFORM 7000-WRITE-TO-LOG                       17530001
178615              END-IF                                              17540000
178616         WHEN SQLCODE = -904                                      17550000
178617         WHEN SQLCODE = -913                                      17560000
178618         WHEN SQLCODE = -911                                      17570000
178619             CONTINUE                                             17580000
178620         WHEN SQLWARN0 NOT = SPACES                               17590000
178621         WHEN SQLCODE NOT = ZERO                                  17600000
178622             MOVE SQLCODE               TO PV-SQL-RETURN-CD       17610000
178627             INITIALIZE PV-MSG-AREA                               17620001
178628             STRING   ' ' WS001-SRC-TASK-NUMBER                   17630000
178629                      ' WSKUP305-5020 ERROR:'                     17640000
178630                      ' SQL='                                     17650000
178631                      PV-SQL-RETURN-CD                            17660000
178632                      DELIMITED BY SIZE                           17670000
178633                      INTO PV-MSG-AREA                            17680001
178634             PERFORM 7000-WRITE-TO-LOG                            17690001
178636                                                                  17700000
178637             SET WS001-INVALID-SQL      TO TRUE                   17710000
178638             STRING 'SQL='                                        17720000
178639                  PV-SQL-RETURN-CD                                17730000
178640                  DELIMITED BY SIZE                               17740000
178641                                      INTO WS001-CRA-RET-MSG      17750000
178643             MOVE SQLCA                 TO WS001-SQLCA            17770000
178649             PERFORM 9999-ABEND                                   17830000
178650     END-EVALUATE.                                                17840000
178651                                                                  17850000
178652/                                                                 17860000
178653*5030-UPDATE-ORIG-HDR.                                            17861010
178654                                                                  17862000
178655* UPDATE THE ORIGINAL SHIPMENT HEADER RECORD WITH THE LATEST      17863000
178656* DUMMY SEQUENCE NUMBER USED                                      17864000
178657                                                                  17865000
178658*    EXEC SQL                                                     17865110
178659*        UPDATE WST_SHPMT_XREF_HDR                                17865210
178660*        SET    DMY_SEQ_NBR = :WS-DMY-SEQ-NBR                     17865310
178661*        WHERE  EXT_SHP_ID  = :WS-ORIG-EXT-SHP-ID                 17865410
178662*   END-EXEC.                                                     17865510
178663*                                                                 17865610
178664*    EVALUATE TRUE                                                17865710
178665*        WHEN SQLCODE = ZERO                                      17865810
178666*             IF PS-LOG-SWITCH-YES                                17865910
178667*                 INITIALIZE PV-MSG-AREA                          17866010
178668*                 STRING   ' ' WS001-SRC-TASK-NUMBER              17866110
178669*                          ' WSKUP305-5030:'                      17866210
178670*                          ' UPDATE XREF_SHPMT_XREF_HDR'          17866310
178671*                          ' FOR SHPMT='                          17866410
178672*                          WS-ORIG-EXT-SHP-ID                     17866510
178673*                          DELIMITED BY SIZE                      17866610
178674*                          INTO PV-MSG-AREA                       17866710
178675*                 PERFORM 7000-WRITE-TO-LOG                       17866810
178676*             END-IF                                              17866910
178677*        WHEN SQLCODE = -904                                      17867010
178678*        WHEN SQLCODE = -913                                      17867110
178679*        WHEN SQLCODE = -911                                      17867210
178680*            CONTINUE                                             17867310
178681*        WHEN SQLWARN0 NOT = SPACES                               17867410
178682*        WHEN SQLCODE NOT = ZERO                                  17867510
178684*            MOVE SQLCODE               TO PV-SQL-RETURN-CD       17867610
178690*            INITIALIZE PV-MSG-AREA                               17867710
178691*            STRING   ' ' WS001-SRC-TASK-NUMBER                   17867810
178692*                     ' WSKUP305-5030 ERROR:'                     17867910
178693*                     ' SQL='                                     17868010
178694*                     PV-SQL-RETURN-CD                            17869010
178695*                     DELIMITED BY SIZE                           17869110
178696*                     INTO PV-MSG-AREA                            17869210
178697*            PERFORM 7000-WRITE-TO-LOG                            17869310
178699*                                                                 17869410
178700*            SET WS001-INVALID-SQL      TO TRUE                   17869510
178701*            STRING 'SQL='                                        17869610
178702*                 PV-SQL-RETURN-CD                                17869710
178703*                 DELIMITED BY SIZE                               17869810
178704*                                     INTO WS001-CRA-RET-MSG      17869910
178706*            MOVE SQLCA                 TO WS001-SQLCA            17870110
178712*            PERFORM 9999-ABEND                                   17870710
178713*    END-EVALUATE.                                                17870810
178714                                                                  17870900
178715/                                                                 17871000
178716 5100-INSERT-DETAIL.                                              17871100
178717                                                                  17871200
178720     MOVE '5100-INSERT-DETAIL'   TO WS001-PARAGRAPH-NAME.         17871300
178800                                                                  17871400
178900     EVALUATE TRUE                                                17871500
179000         WHEN WS-TRIP-ID > 0                                      17871600
179100          AND WS-PO-NBR = 0                                       17871700
179200          AND WS-RCVR-SEQ-NBR = 0                                 17871800
179300          AND WS-PO-LNE-NBR = 0                                   17871900
179400          AND WS-PREPK-ID = 0                                     17872000
179500             PERFORM 5300-DETAIL-TRIP                             17873000
179600         WHEN WS-TRIP-ID > 0                                      17874000
179700          AND WS-PO-NBR > 0                                       17875000
179800          AND WS-RCVR-SEQ-NBR > 0                                 17876000
179900          AND WS-PO-LNE-NBR = 0                                   17877000
180000          AND WS-PREPK-ID = 0                                     17878000
180100             PERFORM 5610-CHECK-FOR-PBS                           17879000
180200             IF PS-PACK-BY-STORE-YES                              17880000
180300                 PERFORM 5620-CHECK-FOR-PBS-ERRS                  17890000
180400             END-IF                                               17900000
180500             PERFORM 5600-DETAIL-PO-RCVR                          17910000
180600         WHEN WS-TRIP-ID > 0                                      17920000
180700           AND WS-PO-NBR > 0                                      17930000
180800           AND WS-RCVR-SEQ-NBR > 0                                17940000
180900           AND (WS-PO-LNE-NBR > 0                                 17950000
181000                OR WS-PREPK-ID > 0)                               17960000
181100             PERFORM 5610-CHECK-FOR-PBS                           17970000
181200             IF PS-PACK-BY-STORE-YES                              17980000
181300                 PERFORM 5620-CHECK-FOR-PBS-ERRS                  17990000
181400             END-IF                                               18000000
181500             PERFORM 5400-DETAIL-LINE-PACK                        18010000
181600     END-EVALUATE.                                                18020000
181700*                                                                 18030000
181800/                                                                 18040000
181900 5200-EVAL-SHIP-STATUS.                                           18050000
181901     MOVE '5200-EVAL-SHIP-STATUS'                                 18060000
181902                                 TO WS001-PARAGRAPH-NAME.         18070000
182000                                                                  18080000
182100* THIS IS A WS001-INSERT                                          18090000
182200* ONLY ONE RECORD WAS FOUND ON HEADER TABLE FOR THE TRIP-ID       18100000
182300                                                                  18110000
182400     IF WS-DWNLD-TMST = PC-DEFAULT-NINES                          18120000
182500* HAS NOT BEEN DOWNLOADED PREVIOUSLY                              18130000
183300         IF WS-DWNLD-CDE = 'X'                                    18140000
183300             MOVE 'N'                       TO WS-DWNLD-CDE       18150000
182600             PERFORM 5210-UPD-HDR-FOR-TRIP-AND-SHP                18160000
182900         END-IF                                                   18170000
182700         IF WS001-INSERT                                          18180000
182800             PERFORM 5100-INSERT-DETAIL                           18190000
182900         END-IF                                                   18200000
183000     ELSE                                                         18210000
183010* HAS BEEN DOWNLOADED PREVIOUSLY                                  18220000
183100         IF WS-RCPT-TMST = PC-DEFAULT-NINES                       18230000
183200* NO RECEIVING HAS BEGUN, CAN ATTACH MORE INFO TO TRAILER         18240000
183300             MOVE 'P'                       TO WS-DWNLD-CDE       18250000
183300             PERFORM 5210-UPD-HDR-FOR-TRIP-AND-SHP                18260000
183400             IF WS001-INSERT                                      18270000
183500                 MOVE WS-EXT-SHP-ID         TO PV-SHIPMNT-NBR     18280000
183600                 PERFORM 5100-INSERT-DETAIL                       18290000
183700             END-IF                                               18300000
183800             SET PS-APPT-SENT-NO            TO TRUE               18310000
183900*            SET PS-IMMED-DOWNLOAD-YES      TO TRUE               18320025
184000         ELSE                                                     18330000
184100* RECEIVING HAS BEGUN, DUMMY SHIPMENT IS NEEDED                   18340000
184200             IF WS001-INSERT                                      18350000
184300                 SET PS-DUMMY-HEADER-YES    TO TRUE               18360000
184310                 MOVE 'N'                   TO WS-DWNLD-CDE       18370000
184400                 PERFORM 5000-INSERT-HEADER                       18380000
184500                 PERFORM 5100-INSERT-DETAIL                       18390000
184510                 SET PS-IMMED-DOWNLOAD-YES  TO TRUE               18400027
184600             END-IF                                               18410000
184700         END-IF                                                   18420000
184800     END-IF.                                                      18430000
184900                                                                  18440000
185000/                                                                 18450000
185100 5210-UPD-HDR-FOR-TRIP-AND-SHP.                                   18460000
185101     MOVE '5210-UPD-HDR-FOR-TRIP-AND-SHP'                         18470000
185102                                 TO WS001-PARAGRAPH-NAME.         18480000
185200                                                                  18490000
186000     EXEC SQL                                                     18500000
186100          UPDATE WST_SHPMT_XREF_HDR                               18510000
186200             SET LAST_PRCG_TMST   = CURRENT TIMESTAMP             18520000
186300                ,DWNLD_CDE        = :WS-DWNLD-CDE                 18530000
186400             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                18540000
186500             AND   INTR_TRIP_ID   = :DK-TRIP-ID                   18550000
186600     END-EXEC.                                                    18560000
186700                                                                  18570000
186800     EVALUATE TRUE                                                18580000
186900         WHEN SQLCODE = ZERO                                      18590000
187000             IF PS-LOG-SWITCH-YES                                 18600001
187100                 MOVE DK-TRIP-ID TO WS-DISPLAY-1                  18610000
187101                 INITIALIZE PV-MSG-AREA                           18620001
187102                 STRING   ' ' WS001-SRC-TASK-NUMBER               18630000
187110                          ' WSKUP305-5210:'                       18640000
187200                          ' UPDATE WST_SHPMT_XREF_HDR '           18650000
187300                          ' FOR SHPMT='                           18660000
187400                          DK-EXT-SHP-ID                           18670000
187500                          ' TRIP ID='                             18680000
187600                          WS-DISPLAY-1                            18690000
187610                          DELIMITED BY SIZE                       18700000
187700                          INTO PV-MSG-AREA                        18710001
187800                 PERFORM 7000-WRITE-TO-LOG                        18720001
187900             END-IF                                               18730000
188000         WHEN SQLCODE = -904                                      18740000
188100         WHEN SQLCODE = -913                                      18750000
188200         WHEN SQLCODE = -911                                      18760000
188300              CONTINUE                                            18770000
188400         WHEN SQLWARN0 NOT = SPACES                               18780000
188500         WHEN SQLCODE NOT = ZERO                                  18790000
189300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       18800000
189902             INITIALIZE PV-MSG-AREA                               18810001
189903             STRING   ' ' WS001-SRC-TASK-NUMBER                   18820000
190100                      ' WSKUP305-5210 ERROR:'                     18830000
190200                      ' SQL='                                     18840000
190300                      PV-SQL-RETURN-CD                            18850000
190400                      DELIMITED BY SIZE                           18860000
190500                      INTO PV-MSG-AREA                            18870001
190600             PERFORM 7000-WRITE-TO-LOG                            18880001
190701                                                                  18890000
190702             SET WS001-INVALID-SQL      TO TRUE                   18900000
190703             STRING 'SQL='                                        18910000
190704                  PV-SQL-RETURN-CD                                18920000
190705                  DELIMITED BY SIZE                               18930000
190706                                      INTO WS001-CRA-RET-MSG      18940000
190708             MOVE SQLCA                 TO WS001-SQLCA            18960000
190714             PERFORM 9999-ABEND                                   19020000
190715     END-EVALUATE.                                                19030000
190720                                                                  19040000
191000/                                                                 19050000
191100 5300-DETAIL-TRIP.                                                19060000
191101                                                                  19070000
191102     MOVE '5300-DETAIL-TRIP'     TO WS001-PARAGRAPH-NAME.         19080000
191200                                                                  19090000
191300*  DO NOT HAVE THE PO/RCVR, IF IN HERE                            19100000
191300*  SELECT ALL PO/RCVR FOR THE TRIP/SHIPMENT                       19110000
191400                                                                  19120000
191400* IF COMING FROM RCKCS261, SELECT THE PO/RCVR USING THE           19130000
191400* SHIPT-ID, ELSE USE THE TRIP-ID.                                 19140000
191400                                                                  19140100
191400* IF THERE IS ALREADY A DUMMY RECORD IN EXISTENCE, AND THE        19140210
191400* SHIPT-ID WAS SENT IN BY THE CALLING PROGRAM, THEN ONLY          19140310
191400* PROCESS THE PO/RCVR ON THE SHIPT-ID, NOT THE TRIP-ID            19140410
191400                                                                  19140510
191400     IF WS001-CALLING-PROGRAM-NAME = 'RCKCS261'                   19140600
191400        OR (PS-HEADER-EXIST-YES AND                               19140710
191400            WS001-KOHLS-SHIPT-ID > 0)                             19140810
191500         PERFORM 5340-OPEN-PO-RCVR-CSR2                           19140900
191600         PERFORM 5350-FETCH-PO-RCVR-CSR2 UNTIL                    19141000
191700                     PS-EOF-PO-RCVR-CSR2-YES                      19141100
191800         PERFORM 5360-CLOSE-PO-RCVR-CSR2                          19141200
191400     ELSE                                                         19141300
191500         PERFORM 5310-OPEN-PO-RCVR-CSR                            19141400
191600         PERFORM 5320-FETCH-PO-RCVR-CSR UNTIL                     19141500
191700                     PS-EOF-PO-RCVR-CSR-YES                       19141600
191800         PERFORM 5330-CLOSE-PO-RCVR-CSR                           19142000
191400     END-IF.                                                      19143000
191900                                                                  19144000
191910/                                                                 19145000
192000 5310-OPEN-PO-RCVR-CSR.                                           19146000
192001                                                                  19147000
192002     MOVE '5310-OPEN-PO-RCVR-CSR'                                 19148000
192003                                 TO WS001-PARAGRAPH-NAME.         19149000
192100                                                                  19150000
192200     SET PS-EOF-PO-RCVR-CSR-NO        TO TRUE.                    19160000
192900                                                                  19170000
193000     EXEC SQL                                                     19180000
193100         OPEN PO-RCVR-CSR                                         19190000
193200     END-EXEC.                                                    19200000
193300                                                                  19210000
193400     EVALUATE TRUE                                                19220000
193500         WHEN SQLCODE = ZERO                                      19230000
193600             IF PS-LOG-SWITCH-YES                                 19240001
193601                 INITIALIZE PV-MSG-AREA                           19250001
146767                 MOVE DK-TRIP-ID         TO WS-DISPLAY-1          19251010
193610                 STRING   ' ' WS001-SRC-TASK-NUMBER               19260000
193700                          ' WSKUP305-5310:'                       19270000
193800                          ' OPEN PO-RCVR-CSR'                     19280000
193800                          ' FOR TRIP=' WS-DISPLAY-1               19281010
193810                          DELIMITED BY SIZE                       19290000
193900                          INTO PV-MSG-AREA                        19300001
194000                 PERFORM 7000-WRITE-TO-LOG                        19310001
194100             END-IF                                               19320000
194200         WHEN SQLCODE = -904                                      19330000
194300         WHEN SQLCODE = -913                                      19340000
194400         WHEN SQLCODE = -911                                      19350000
194500             CONTINUE                                             19360000
194600         WHEN SQLWARN0 NOT = SPACES                               19370000
194700         WHEN SQLCODE NOT = ZERO                                  19380000
195500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       19390000
196102             INITIALIZE PV-MSG-AREA                               19400001
196103             STRING   ' ' WS001-SRC-TASK-NUMBER                   19410000
196300                      ' WSKUP305-5310 ERROR:'                     19420000
196400                      ' SQL='                                     19430000
196500                      PV-SQL-RETURN-CD                            19440000
196600                      DELIMITED BY SIZE                           19450000
196700                      INTO PV-MSG-AREA                            19460001
196800             PERFORM 7000-WRITE-TO-LOG                            19470001
196901                                                                  19480000
196902             SET WS001-INVALID-SQL      TO TRUE                   19490000
196903             STRING 'SQL='                                        19500000
196904                  PV-SQL-RETURN-CD                                19510000
196905                  DELIMITED BY SIZE                               19520000
196906                                      INTO WS001-CRA-RET-MSG      19530000
196908             MOVE SQLCA                 TO WS001-SQLCA            19550000
196914             PERFORM 9999-ABEND                                   19590000
196915     END-EVALUATE.                                                19600000
196920                                                                  19610000
197200     SET PS-FIRST-RECORD-YES          TO TRUE.                    19620000
197300     MOVE 0                           TO WS-HOLD-PO-NBR.          19630000
197400     MOVE 0                           TO WS-HOLD-RCVR-SEQ-NBR.    19640000
197500                                                                  19650000
197600/                                                                 19660000
197700 5320-FETCH-PO-RCVR-CSR.                                          19670000
197701                                                                  19680000
197702     MOVE '5320-FETCH-PO-RCVR-CSR'                                19690000
197703                                 TO WS001-PARAGRAPH-NAME.         19700000
197800                                                                  19710000
197900* GET PO/REC FROM TVHTRIP, TSHIPMT, TSHPTPO, TRECIEV.  KEY=TRIP-ID19720000
198000                                                                  19730000
198700     EXEC SQL                                                     19740000
198800          FETCH PO-RCVR-CSR                                       19750000
198900          INTO                                                    19760000
199000                :SHPTPO-PO-NBR                                    19770000
199100               ,:SHPTPO-REC-SEQ-NBR                               19780000
199200     END-EXEC.                                                    19790000
199300                                                                  19800000
199400     EVALUATE TRUE                                                19810000
199500         WHEN SQLCODE = ZERO                                      19820000
199600             MOVE SHPTPO-PO-NBR      TO WS-PO-NBR                 19830000
199700                                        DK-PO-NBR                 19840000
199800             MOVE SHPTPO-REC-SEQ-NBR TO WS-RCVR-SEQ-NBR           19850000
199900                                        DK-RCVR-SEQ-NBR           19860000
200000             IF PS-LOG-SWITCH-YES                                 19870001
200001                 INITIALIZE PV-MSG-AREA                           19880001
200010                 MOVE WS-PO-NBR TO WS-DISPLAY-1                   19890000
200020                 MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2             19900000
200030                 STRING   ' ' WS001-SRC-TASK-NUMBER               19910000
200100                          ' WSKUP305-5320:'                       19920000
200200                          ' PO NBR='                              19930000
200300                          WS-DISPLAY-1                            19940000
200400                          ' RCVR SEQ NBR='                        19950000
200500                          WS-DISPLAY-2                            19960000
200510                          DELIMITED BY SIZE                       19970000
200600                          INTO PV-MSG-AREA                        19980001
200700                 PERFORM 7000-WRITE-TO-LOG                        19990001
200800             END-IF                                               20000000
200900             IF SHPTPO-PO-NBR NOT = WS-HOLD-PO-NBR                20010000
201000               OR SHPTPO-REC-SEQ-NBR NOT =                        20020000
201100                                      WS-HOLD-RCVR-SEQ-NBR        20030000
201200                 MOVE SHPTPO-PO-NBR TO WS-HOLD-PO-NBR             20040000
201300                 MOVE SHPTPO-REC-SEQ-NBR TO                       20050000
201400                                          WS-HOLD-RCVR-SEQ-NBR    20060000
201500                 IF PS-LOG-SWITCH-YES                             20070001
201600                     MOVE WS-HOLD-PO-NBR TO WS-DISPLAY-1          20080000
201601                     MOVE WS-HOLD-RCVR-SEQ-NBR TO WS-DISPLAY-2    20090000
201602                     INITIALIZE PV-MSG-AREA                       20100001
201603                     STRING   ' ' WS001-SRC-TASK-NUMBER           20110000
201610                              ' WSKUP305-5320:'                   20120000
201700                              ' HOLD PO NBR='                     20130000
201800                              WS-DISPLAY-1                        20140000
201900                              ' HOLD RCVR SEQ NBR='               20150000
202000                              WS-DISPLAY-2                        20160000
202010                              DELIMITED BY SIZE                   20170000
202100                              INTO PV-MSG-AREA                    20180001
202200                     PERFORM 7000-WRITE-TO-LOG                    20190001
202300                 END-IF                                           20200000
202400                 PERFORM 5610-CHECK-FOR-PBS                       20210000
202500                 IF PS-PACK-BY-STORE-YES                          20220000
202600                     PERFORM 5620-CHECK-FOR-PBS-ERRS              20230000
202700                 END-IF                                           20240000
202800             END-IF                                               20250000
202900             PERFORM 5600-DETAIL-PO-RCVR                          20260000
203000         WHEN SQLCODE = -904                                      20270000
203100         WHEN SQLCODE = -913                                      20280000
203200         WHEN SQLCODE = -911                                      20290000
203300             CONTINUE                                             20300000
203400         WHEN SQLCODE = +100                                      20310000
203500             SET PS-EOF-PO-RCVR-CSR-YES TO TRUE                   20320000
203600         WHEN SQLWARN0 NOT = SPACES                               20330000
203700         WHEN SQLCODE NOT = ZERO                                  20340000
204500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       20350000
205102             INITIALIZE PV-MSG-AREA                               20360001
205103             STRING   ' ' WS001-SRC-TASK-NUMBER                   20370000
205300                      ' WSKUP305-5320 ERROR:'                     20380000
205400                      ' SQL='                                     20390000
205500                      PV-SQL-RETURN-CD                            20400000
205600                      DELIMITED BY SIZE                           20410000
205700                      INTO PV-MSG-AREA                            20420001
205800             PERFORM 7000-WRITE-TO-LOG                            20430001
205901                                                                  20440000
205902             SET WS001-INVALID-SQL      TO TRUE                   20450000
205903             STRING 'SQL='                                        20460000
205904                  PV-SQL-RETURN-CD                                20470000
205905                  DELIMITED BY SIZE                               20480000
205906                                      INTO WS001-CRA-RET-MSG      20490000
205908             MOVE SQLCA                 TO WS001-SQLCA            20510000
205924             PERFORM 9999-ABEND                                   20592200
205925     END-EVALUATE.                                                20592300
205930                                                                  20592400
206100/                                                                 20592500
206300 5330-CLOSE-PO-RCVR-CSR.                                          20592600
206301                                                                  20592700
206302     MOVE '5330-CLOSE-PO-RCVR-CSR'                                20592800
206303                                 TO WS001-PARAGRAPH-NAME.         20592900
206400                                                                  20593000
207200     EXEC SQL                                                     20594000
207300          CLOSE PO-RCVR-CSR                                       20595000
207400     END-EXEC.                                                    20596000
207500                                                                  20597000
207600     EVALUATE TRUE                                                20598000
207700         WHEN SQLCODE = ZERO                                      20599000
207800             IF PS-LOG-SWITCH-YES                                 20600001
207801                 INITIALIZE PV-MSG-AREA                           20610001
207810                 STRING   ' ' WS001-SRC-TASK-NUMBER               20620000
207900                          ' WSKUP305-5330:'                       20630000
208000                          ' CLOSE PO-RCVR-CSR'                    20640000
208010                          DELIMITED BY SIZE                       20650000
208100                          INTO PV-MSG-AREA                        20660001
208200                 PERFORM 7000-WRITE-TO-LOG                        20670001
208300             END-IF                                               20680000
208400         WHEN SQLCODE = -904                                      20690000
208500         WHEN SQLCODE = -913                                      20700000
208600         WHEN SQLCODE = -911                                      20710000
208700              CONTINUE                                            20720000
208800         WHEN SQLWARN0 NOT = SPACES                               20730000
208900         WHEN SQLCODE NOT = ZERO                                  20740000
209700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       20750000
210302             INITIALIZE PV-MSG-AREA                               20760001
210303             STRING   ' ' WS001-SRC-TASK-NUMBER                   20770000
210500                      ' WSKUP305-5330 ERROR:'                     20780000
210600                      ' SQL='                                     20790000
210700                      PV-SQL-RETURN-CD                            20800000
210800                      DELIMITED BY SIZE                           20810000
210900                      INTO PV-MSG-AREA                            20820001
211000             PERFORM 7000-WRITE-TO-LOG                            20830001
211101                                                                  20840000
211102             SET WS001-INVALID-SQL      TO TRUE                   20850000
211103             STRING 'SQL='                                        20860000
211104                  PV-SQL-RETURN-CD                                20870000
211105                  DELIMITED BY SIZE                               20880000
211106                                      INTO WS001-CRA-RET-MSG      20890000
211108             MOVE SQLCA                 TO WS001-SQLCA            20910000
211120             PERFORM 9999-ABEND                                   20950000
211121     END-EVALUATE.                                                20960000
211130                                                                  20970000
211400/                                                                 20980000
192000 5340-OPEN-PO-RCVR-CSR2.                                          20990000
192001                                                                  21000000
192002     MOVE '5340-OPEN-PO-RCVR-CSR2'                                21010000
192003                                 TO WS001-PARAGRAPH-NAME.         21020000
192100                                                                  21030000
192200     SET PS-EOF-PO-RCVR-CSR2-NO       TO TRUE.                    21040000
192900                                                                  21050000
193000     EXEC SQL                                                     21060000
193100         OPEN PO-RCVR-CSR2                                        21070000
193200     END-EXEC.                                                    21080000
193300                                                                  21090000
193400     EVALUATE TRUE                                                21100000
193500         WHEN SQLCODE = ZERO                                      21110000
193600             IF PS-LOG-SWITCH-YES                                 21120001
193601                 INITIALIZE PV-MSG-AREA                           21130001
193601                 MOVE DK-SHIPT-ID    TO WS-DISPLAY-1              21131010
193610                 STRING   ' ' WS001-SRC-TASK-NUMBER               21140000
193700                          ' WSKUP305-5340:'                       21141000
193800                          ' OPEN PO-RCVR-CSR2'                    21142000
193800                          ' SHIPT-ID=' WS-DISPLAY-1               21142110
193810                          DELIMITED BY SIZE                       21143000
193900                          INTO PV-MSG-AREA                        21144001
194000                 PERFORM 7000-WRITE-TO-LOG                        21145001
194100             END-IF                                               21146000
194200         WHEN SQLCODE = -904                                      21147000
194300         WHEN SQLCODE = -913                                      21148000
194400         WHEN SQLCODE = -911                                      21149000
194500             CONTINUE                                             21150000
194600         WHEN SQLWARN0 NOT = SPACES                               21150100
194700         WHEN SQLCODE NOT = ZERO                                  21150200
195500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       21150300
196102             INITIALIZE PV-MSG-AREA                               21150401
196103             STRING   ' ' WS001-SRC-TASK-NUMBER                   21150500
196300                      ' WSKUP305-5340 ERROR:'                     21150600
196400                      ' SQL='                                     21150700
196500                      PV-SQL-RETURN-CD                            21150800
196600                      DELIMITED BY SIZE                           21150900
196700                      INTO PV-MSG-AREA                            21151001
196800             PERFORM 7000-WRITE-TO-LOG                            21151101
196901                                                                  21151200
196902             SET WS001-INVALID-SQL      TO TRUE                   21151300
196903             STRING 'SQL='                                        21151400
196904                  PV-SQL-RETURN-CD                                21151500
196905                  DELIMITED BY SIZE                               21151600
196906                                      INTO WS001-CRA-RET-MSG      21151700
196908             MOVE SQLCA                 TO WS001-SQLCA            21151900
196914             PERFORM 9999-ABEND                                   21152300
196915     END-EVALUATE.                                                21152400
196920                                                                  21152500
197200     SET PS-FIRST-RECORD-YES          TO TRUE.                    21152600
197300     MOVE 0                           TO WS-HOLD-PO-NBR.          21152700
197400     MOVE 0                           TO WS-HOLD-RCVR-SEQ-NBR.    21152800
197500                                                                  21152900
197600/                                                                 21153000
197700 5350-FETCH-PO-RCVR-CSR2.                                         21153100
197701                                                                  21153200
197702     MOVE '5350-FETCH-PO-RCVR-CSR2'                               21153300
197703                                 TO WS001-PARAGRAPH-NAME.         21153400
197800                                                                  21153500
197900* GET PO/REC FROM TSHPTPO, TRECIEV.  KEY=SHIPT-ID                 21153600
198000                                                                  21153700
198700     EXEC SQL                                                     21153800
198800          FETCH PO-RCVR-CSR2                                      21153900
198900          INTO                                                    21154000
199000                :SHPTPO-PO-NBR                                    21154100
199100               ,:SHPTPO-REC-SEQ-NBR                               21154200
199200     END-EXEC.                                                    21154300
199300                                                                  21154400
199400     EVALUATE TRUE                                                21154500
199500         WHEN SQLCODE = ZERO                                      21154600
199600             MOVE SHPTPO-PO-NBR      TO WS-PO-NBR                 21154700
199700                                        DK-PO-NBR                 21154800
199800             MOVE SHPTPO-REC-SEQ-NBR TO WS-RCVR-SEQ-NBR           21154900
199900                                        DK-RCVR-SEQ-NBR           21155000
200000             IF PS-LOG-SWITCH-YES                                 21155101
200001                 INITIALIZE PV-MSG-AREA                           21155201
200010                 MOVE WS-PO-NBR TO WS-DISPLAY-1                   21155300
200020                 MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2             21155400
200030                 STRING   ' ' WS001-SRC-TASK-NUMBER               21155500
200100                          ' WSKUP305-5350:'                       21155600
200200                          ' PO NBR='                              21155700
200300                          WS-DISPLAY-1                            21155800
200400                          ' RCVR SEQ NBR='                        21155900
200500                          WS-DISPLAY-2                            21156000
200510                          DELIMITED BY SIZE                       21156100
200600                          INTO PV-MSG-AREA                        21156201
200700                 PERFORM 7000-WRITE-TO-LOG                        21156301
200800             END-IF                                               21156400
200900             IF SHPTPO-PO-NBR NOT = WS-HOLD-PO-NBR                21156500
201000               OR SHPTPO-REC-SEQ-NBR NOT =                        21156600
201100                                      WS-HOLD-RCVR-SEQ-NBR        21156700
201200                 MOVE SHPTPO-PO-NBR TO WS-HOLD-PO-NBR             21156800
201300                 MOVE SHPTPO-REC-SEQ-NBR TO                       21156900
201400                                          WS-HOLD-RCVR-SEQ-NBR    21157000
201500                 IF PS-LOG-SWITCH-YES                             21157101
201600                     MOVE WS-HOLD-PO-NBR TO WS-DISPLAY-1          21157200
201601                     MOVE WS-HOLD-RCVR-SEQ-NBR TO WS-DISPLAY-2    21157300
201602                     INITIALIZE PV-MSG-AREA                       21157401
201603                     STRING   ' ' WS001-SRC-TASK-NUMBER           21157500
201610                              ' WSKUP305-5350:'                   21157600
201700                              ' HOLD PO NBR='                     21157700
201800                              WS-DISPLAY-1                        21157800
201900                              ' HOLD RCVR SEQ NBR='               21157900
202000                              WS-DISPLAY-2                        21158000
202010                              DELIMITED BY SIZE                   21158100
202100                              INTO PV-MSG-AREA                    21158201
202200                     PERFORM 7000-WRITE-TO-LOG                    21158301
202300                 END-IF                                           21158400
202400                 PERFORM 5610-CHECK-FOR-PBS                       21158500
202500                 IF PS-PACK-BY-STORE-YES                          21158600
202600                     PERFORM 5620-CHECK-FOR-PBS-ERRS              21158700
202700                 END-IF                                           21158800
202800             END-IF                                               21158900
202900             PERFORM 5600-DETAIL-PO-RCVR                          21159000
203000         WHEN SQLCODE = -904                                      21159100
203100         WHEN SQLCODE = -913                                      21159200
203200         WHEN SQLCODE = -911                                      21159300
203300             CONTINUE                                             21159400
203400         WHEN SQLCODE = +100                                      21159500
203500             SET PS-EOF-PO-RCVR-CSR2-YES TO TRUE                  21159600
203600         WHEN SQLWARN0 NOT = SPACES                               21159700
203700         WHEN SQLCODE NOT = ZERO                                  21159800
204500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       21159900
205102             INITIALIZE PV-MSG-AREA                               21160001
205103             STRING   ' ' WS001-SRC-TASK-NUMBER                   21160100
205300                      ' WSKUP305-5350 ERROR:'                     21160200
205400                      ' SQL='                                     21160300
205500                      PV-SQL-RETURN-CD                            21160400
205600                      DELIMITED BY SIZE                           21160500
205700                      INTO PV-MSG-AREA                            21160601
205800             PERFORM 7000-WRITE-TO-LOG                            21160701
205901                                                                  21160800
205902             SET WS001-INVALID-SQL      TO TRUE                   21160900
205903             STRING 'SQL='                                        21161000
205904                  PV-SQL-RETURN-CD                                21161100
205905                  DELIMITED BY SIZE                               21161200
205906                                      INTO WS001-CRA-RET-MSG      21161300
205908             MOVE SQLCA                 TO WS001-SQLCA            21161500
205924             PERFORM 9999-ABEND                                   21163200
205925     END-EVALUATE.                                                21163300
205930                                                                  21163400
206100/                                                                 21163500
206300 5360-CLOSE-PO-RCVR-CSR2.                                         21163600
206301                                                                  21163700
206302     MOVE '5360-CLOSE-PO-RCVR-CSR2'                               21163800
206303                                 TO WS001-PARAGRAPH-NAME.         21163900
206400                                                                  21164000
207200     EXEC SQL                                                     21164100
207300          CLOSE PO-RCVR-CSR2                                      21164200
207400     END-EXEC.                                                    21164300
207500                                                                  21164400
207600     EVALUATE TRUE                                                21164500
207700         WHEN SQLCODE = ZERO                                      21164600
207800             IF PS-LOG-SWITCH-YES                                 21164701
207801                 INITIALIZE PV-MSG-AREA                           21164801
207810                 STRING   ' ' WS001-SRC-TASK-NUMBER               21164900
207900                          ' WSKUP305-5360:'                       21165000
208000                          ' CLOSE PO-RCVR-CSR2'                   21165100
208010                          DELIMITED BY SIZE                       21165200
208100                          INTO PV-MSG-AREA                        21165301
208200                 PERFORM 7000-WRITE-TO-LOG                        21165401
208300             END-IF                                               21165500
208400         WHEN SQLCODE = -904                                      21165600
208500         WHEN SQLCODE = -913                                      21165700
208600         WHEN SQLCODE = -911                                      21165800
208700              CONTINUE                                            21165900
208800         WHEN SQLWARN0 NOT = SPACES                               21166000
208900         WHEN SQLCODE NOT = ZERO                                  21166100
209700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       21166200
210302             INITIALIZE PV-MSG-AREA                               21166301
210303             STRING   ' ' WS001-SRC-TASK-NUMBER                   21166400
210500                      ' WSKUP305-5360 ERROR:'                     21166500
210600                      ' SQL='                                     21166600
210700                      PV-SQL-RETURN-CD                            21166700
210800                      DELIMITED BY SIZE                           21166800
210900                      INTO PV-MSG-AREA                            21166901
211000             PERFORM 7000-WRITE-TO-LOG                            21167001
211101                                                                  21167100
211102             SET WS001-INVALID-SQL      TO TRUE                   21167200
211103             STRING 'SQL='                                        21167300
211104                  PV-SQL-RETURN-CD                                21167400
211105                  DELIMITED BY SIZE                               21167500
211106                                      INTO WS001-CRA-RET-MSG      21167600
211108             MOVE SQLCA                 TO WS001-SQLCA            21167800
211120             PERFORM 9999-ABEND                                   21168200
211121     END-EVALUATE.                                                21168300
211130                                                                  21168400
211400/                                                                 21168500
211500 5400-DETAIL-LINE-PACK.                                           21168600
211501                                                                  21168700
211502     MOVE '5400-DETAIL-LINE-PACK'                                 21168800
211503                                 TO WS001-PARAGRAPH-NAME.         21168900
211600                                                                  21169000
211700     IF WS001-PREPK-ID > 0                                        21170000
211800         PERFORM 5410-OPEN-RECV-ITM-CSR                           21180000
211900         PERFORM 5420-FETCH-RECV-ITM-CSR UNTIL                    21190000
212000                       PS-EOF-RECV-ITM-CSR-YES                    21200000
212100         PERFORM 5430-CLOSE-RECV-ITM-CSR                          21210000
212200     ELSE                                                         21220000
212300         PERFORM 5440-CHECK-SHIP-XREF-DTL                         21230000
212400     END-IF.                                                      21240000
212410                                                                  21241000
212500/                                                                 21242000
212600 5410-OPEN-RECV-ITM-CSR.                                          21243000
212601                                                                  21244000
212602     MOVE '5410-OPEN-RECV-ITM-CSR'                                21245000
212603                                 TO WS001-PARAGRAPH-NAME.         21246000
212700                                                                  21247000
212800     SET PS-EOF-RECV-ITM-CSR-NO        TO TRUE.                   21248000
212900                                                                  21249000
213600     EXEC SQL                                                     21250000
213700          OPEN RECV-ITM-CSR                                       21260000
213800     END-EXEC.                                                    21270000
213900                                                                  21280000
214000     EVALUATE TRUE                                                21290000
214100         WHEN SQLCODE = ZERO                                      21300000
214200             IF PS-LOG-SWITCH-YES                                 21310001
214201                 INITIALIZE PV-MSG-AREA                           21320001
146767                 MOVE DK-PO-NBR          TO WS-DISPLAY-1          21321010
146767                 MOVE DK-RCVR-SEQ-NBR    TO WS-DISPLAY-2          21322010
146767                 MOVE DK-PREPK-ID        TO WS-DISPLAY-3          21323010
214210                 STRING   ' ' WS001-SRC-TASK-NUMBER               21330000
214300                          ' WSKUP305-5410:'                       21340000
214400                          ' OPEN RECV-ITEM-CSR'                   21350000
214400                          ' FOR PO=' WS-DISPLAY-1                 21351010
214400                          '-' WS-DISPLAY-2                        21352010
214400                          ' PREPK=' WS-DISPLAY-3                  21353010
214410                          DELIMITED BY SIZE                       21360000
214500                          INTO PV-MSG-AREA                        21370001
214600                 PERFORM 7000-WRITE-TO-LOG                        21380001
214700             END-IF                                               21390000
214800         WHEN SQLCODE = -904                                      21400000
214900         WHEN SQLCODE = -913                                      21410000
215000         WHEN SQLCODE = -911                                      21420000
215100             CONTINUE                                             21430000
215200         WHEN SQLWARN0 NOT = SPACES                               21440000
215300         WHEN SQLCODE NOT = ZERO                                  21450000
216100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       21460000
216702             INITIALIZE PV-MSG-AREA                               21470001
216703             STRING   ' ' WS001-SRC-TASK-NUMBER                   21480000
216900                      ' WSKUP305-5410 ERROR:'                     21490000
217000                      ' SQL='                                     21500000
217100                      PV-SQL-RETURN-CD                            21510000
217200                      DELIMITED BY SIZE                           21520000
217300                      INTO PV-MSG-AREA                            21530001
217400             PERFORM 7000-WRITE-TO-LOG                            21540001
217501                                                                  21550000
217502             SET WS001-INVALID-SQL      TO TRUE                   21560000
217503             STRING 'SQL='                                        21570000
217504                  PV-SQL-RETURN-CD                                21580000
217505                  DELIMITED BY SIZE                               21590000
217506                                      INTO WS001-CRA-RET-MSG      21600000
217508             MOVE SQLCA                 TO WS001-SQLCA            21620000
217512             PERFORM 9999-ABEND                                   21660000
217513     END-EVALUATE.                                                21670000
217520                                                                  21680000
217700/                                                                 21690000
217900 5420-FETCH-RECV-ITM-CSR.                                         21700000
217901                                                                  21710000
217902     MOVE '5420-FETCH-RECV-ITM-CSR'                               21720000
217903                                 TO WS001-PARAGRAPH-NAME.         21730000
218000                                                                  21740000
218100* GET ORD LNE FROM TRECITM.  KEYS ARE PO/RCVR/PREPK.              21750000
218200                                                                  21760000
218900     EXEC SQL                                                     21770000
219000          FETCH RECV-ITM-CSR                                      21780000
219100          INTO                                                    21790000
219200                :RECITM-ORD-LNE-NBR                               21800000
219300     END-EXEC.                                                    21810000
219400                                                                  21820000
219500     EVALUATE TRUE                                                21830000
219600         WHEN SQLCODE = ZERO                                      21840000
219700              MOVE RECITM-ORD-LNE-NBR TO WS-PO-LNE-NBR            21850000
219800              IF PS-LOG-SWITCH-YES                                21860001
219900                  MOVE WS-PO-LNE-NBR TO WS-DISPLAY-1              21870000
219901                  INITIALIZE PV-MSG-AREA                          21880001
219902                  STRING   ' ' WS001-SRC-TASK-NUMBER              21890000
219910                           ' WSKUP305-5420:'                      21900000
220000                           ' PO LNE NBR='                         21910000
220100                           WS-DISPLAY-1                           21920000
220110                           DELIMITED BY SIZE                      21930000
220200                           INTO PV-MSG-AREA                       21940001
220300                  PERFORM 7000-WRITE-TO-LOG                       21950001
220400              END-IF                                              21960000
220500              PERFORM 5440-CHECK-SHIP-XREF-DTL                    21970000
220600         WHEN SQLCODE = -904                                      21980000
220700         WHEN SQLCODE = -913                                      21990000
220800         WHEN SQLCODE = -911                                      22000000
220900             CONTINUE                                             22010000
221000         WHEN SQLCODE = +100                                      22020000
221100             SET PS-EOF-RECV-ITM-CSR-YES TO TRUE                  22030000
221200         WHEN SQLWARN0 NOT = SPACES                               22040000
221300         WHEN SQLCODE NOT = ZERO                                  22050000
222100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       22060000
222702             INITIALIZE PV-MSG-AREA                               22070001
222703             STRING   ' ' WS001-SRC-TASK-NUMBER                   22080000
222900                      ' WSKUP305-5420 ERROR:'                     22090000
223000                      ' SQL='                                     22100000
223100                      PV-SQL-RETURN-CD                            22110000
223200                      DELIMITED BY SIZE                           22120000
223300                      INTO PV-MSG-AREA                            22130001
223400             PERFORM 7000-WRITE-TO-LOG                            22140001
223501                                                                  22150000
223502             SET WS001-INVALID-SQL      TO TRUE                   22160000
223503             STRING 'SQL='                                        22170000
223504                  PV-SQL-RETURN-CD                                22180000
223505                  DELIMITED BY SIZE                               22190000
223506                                      INTO WS001-CRA-RET-MSG      22200000
223508             MOVE SQLCA                 TO WS001-SQLCA            22220000
223520             PERFORM 9999-ABEND                                   22280000
223521     END-EVALUATE.                                                22290000
223530                                                                  22300000
223700/                                                                 22310000
223900 5430-CLOSE-RECV-ITM-CSR.                                         22320000
223901                                                                  22330000
223902     MOVE '5430-CLOSE-RECV-ITM-CSR'                               22340000
223903                                 TO WS001-PARAGRAPH-NAME.         22350000
224000                                                                  22360000
224800     EXEC SQL                                                     22370000
224900          CLOSE RECV-ITM-CSR                                      22380000
225000     END-EXEC.                                                    22390000
225100                                                                  22400000
225200     EVALUATE TRUE                                                22410000
225300         WHEN SQLCODE = ZERO                                      22420000
225400              IF PS-LOG-SWITCH-YES                                22430001
225401                  INITIALIZE PV-MSG-AREA                          22440001
225410                  STRING   ' ' WS001-SRC-TASK-NUMBER              22450000
225500                           ' WSKUP305-5430:'                      22460000
225600                           ' CLOSE RECV-ITM-CSR'                  22470000
225610                           DELIMITED BY SIZE                      22480000
225700                           INTO PV-MSG-AREA                       22490001
225800                  PERFORM 7000-WRITE-TO-LOG                       22500001
225900              END-IF                                              22510000
226000         WHEN SQLCODE = -904                                      22520000
226100         WHEN SQLCODE = -913                                      22530000
226200         WHEN SQLCODE = -911                                      22540000
226300             CONTINUE                                             22550000
226400         WHEN SQLWARN0 NOT = SPACES                               22560000
226500         WHEN SQLCODE NOT = ZERO                                  22570000
227300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       22580000
227902             INITIALIZE PV-MSG-AREA                               22590001
227903             STRING   ' ' WS001-SRC-TASK-NUMBER                   22600000
228100                      ' WSKUP305-5430 ERROR:'                     22610000
228200                      ' SQL='                                     22620000
228300                      PV-SQL-RETURN-CD                            22630000
228400                      DELIMITED BY SIZE                           22640000
228500                      INTO PV-MSG-AREA                            22650001
228600             PERFORM 7000-WRITE-TO-LOG                            22660001
228701                                                                  22670000
228702             SET WS001-INVALID-SQL      TO TRUE                   22680000
228703             STRING 'SQL='                                        22690000
228704                  PV-SQL-RETURN-CD                                22700000
228705                  DELIMITED BY SIZE                               22710000
228706                                      INTO WS001-CRA-RET-MSG      22720000
228708             MOVE SQLCA                 TO WS001-SQLCA            22740000
228712             PERFORM 9999-ABEND                                   22780000
228713     END-EVALUATE.                                                22790000
228720                                                                  22800000
228900/                                                                 22810000
229000 5440-CHECK-SHIP-XREF-DTL.                                        22820000
229001                                                                  22830000
229002     MOVE '5440-CHECK-SHIP-XREF-DTL'                              22840000
229003                                 TO WS001-PARAGRAPH-NAME.         22850000
229100                                                                  22860000
229200     IF PS-PACK-BY-STORE-YES                                      22870000
229300         IF PS-PBS-CARTON-DATA-YES                                22880000
229310             IF PS-PBS-CASE-INVALID-YES                           22890000
229400                 MOVE 'S'             TO WST00002-ASN-LVL-CDE     22900000
229500             ELSE                                                 22910000
229600                 MOVE 'C'             TO WST00002-ASN-LVL-CDE     22920000
229610             END-IF                                               22930000
229620         ELSE                                                     22940000
229621             MOVE 'S'                 TO WST00002-ASN-LVL-CDE     22950000
229630         END-IF                                                   22960000
229700     ELSE                                                         22970000
229800         INITIALIZE PC251-FIELDS                                  22980000
229900         PERFORM 5450-PROCESS-FOR-UCC128-DATA                     22990000
230000         PERFORM 5470-GET-TRANSCRIBE                              23000000
230001                                                                  23000100
230002         IF PC251-TOTAL-CARTONS = PV-TRANSCRIBE-SUM               23000200
230003             CONTINUE                                             23000300
230004         ELSE                                                     23000400
230005             SET PS-LNE-UCC128-DATA-NO TO TRUE                    23000500
230006         END-IF                                                   23000600
230007                                                                  23000700
230008         IF PS-LNE-UCC128-DATA-YES                                23000800
230009             PERFORM 5480-GET-OUTER-PK-QTY                        23000900
230010             PERFORM 5500-CASEPACK-SPLIT                          23001000
230011         END-IF                                                   23001100
230012                                                                  23001200
230013         IF PS-LNE-UCC128-DATA-YES                                23001300
230014           AND NOT PC251-PRE-PACK-ORDER                           23001400
230015             PERFORM 5465-CHECK-CRTN-MLT-LNES                     23001500
230016         END-IF                                                   23001600
230017                                                                  23001700
230018         IF PS-LNE-UCC128-DATA-YES                                23001800
230020             MOVE 'C'                 TO WST00002-ASN-LVL-CDE     23001900
230100         ELSE                                                     23002000
230200             MOVE 'S'                 TO WST00002-ASN-LVL-CDE     23003000
230300         END-IF                                                   23004000
230400     END-IF.                                                      23005000
230500                                                                  23006000
230600     MOVE WS-EXT-SHP-ID         TO WST00002-EXT-SHP-ID.           23007000
230700     MOVE WS-PO-NBR             TO WST00002-PO-NBR.               23008000
230800     MOVE WS-RCVR-SEQ-NBR       TO WST00002-RCVR-SEQ-NBR.         23009000
230900     MOVE WS-PO-LNE-NBR         TO WST00002-PO-LNE-NBR.           23010000
231000     MOVE WS-PREPK-ID           TO WST00002-PREPK-ID.             23020000
231100     MOVE WS001-USER-ID         TO WST00002-CRE-USR-ID.           23030000
231200     MOVE PV-CURRENT-TIMESTAMP  TO WST00002-CRE-TMST.             23040000
231300     MOVE 'N'                   TO WST00002-DWNLD-CDE.            23050000
231400     MOVE 'A'                   TO WST00002-ACTV-CDE.             23060000
164710     MOVE WS001-CALLING-PROGRAM-NAME                              23070000
231400                                TO WST00002-CRE-PGM-CDE.          23080000
231500                                                                  23090000
231505     PERFORM 5445-INSERT-SHIP-XREF-DTL.                           23100000
231507                                                                  23110000
231510/                                                                 23120000
231600 5445-INSERT-SHIP-XREF-DTL.                                       23130000
231700                                                                  23140000
231700* BEFORE DOING THE ACTUAL INSERT TO THE TABLE, CHECK TO           23150000
231700* MAKE SURE THAT THE PO/RCVR/LINE IS ON THE TRECDIS TABLE.        23160000
231700* IF IT IS NOT, THEN DO NOT INSERT TO WST_SHPMT_XREF_DTL.         23170000
231700* WS-SQL-CNT WILL BE ZERO IF A ROW IS FOUND ON TRECDIS.           23180000
231700                                                                  23190000
229002     MOVE '5445-INSERT-SHIP-XREF-DTL'                             23200000
229003                                 TO WS001-PARAGRAPH-NAME.         23210000
232300     EXEC SQL                                                     23220000
232400         SELECT COUNT(*)                                          23230000
232500         INTO   :WS-SQL-CNT                                       23240000
232500         FROM   TRECITM A                                         23250000
232600         WHERE  A.ORD_NBR        = :WST00002-PO-NBR               23260000
232700         AND    A.ORD_LNE_NBR    = :WST00002-PO-LNE-NBR           23270000
232800         AND    A.REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR         23280000
232800         AND    A.VER_STATUS_CDE = 'A'                            23281000
232800         AND NOT EXISTS                                           23282000
232400            (SELECT *                                             23283000
232500             FROM   TRECDIS B                                     23284000
232600             WHERE  B.ORD_NBR     = A.ORD_NBR                     23285000
232700             AND    B.ORD_LNE_NBR = A.ORD_LNE_NBR                 23286000
232800             AND    B.REC_SEQ_NBR = A.REC_SEQ_NBR)                23287000
234600     END-EXEC.                                                    23288000
234700                                                                  23289000
234800     EVALUATE TRUE                                                23290000
234900         WHEN SQLCODE = ZERO                                      23300000
235000             IF PS-LOG-SWITCH-YES                                 23310001
235700                AND WS-SQL-CNT = 0                                23311020
235001                 MOVE WST00002-PO-NBR       TO WS-DISPLAY-PO-NBR  23320000
235001                 MOVE WST00002-PO-LNE-NBR   TO WS-DISPLAY-1       23330000
235001                 MOVE WST00002-RCVR-SEQ-NBR TO WS-DISPLAY-2       23340000
235002                 INITIALIZE PV-MSG-AREA                           23360001
235003                 STRING   ' ' WS001-SRC-TASK-NUMBER               23370000
235100                          ' WSKUP305-5445:'                       23380000
235200                          ' LINE ON TRECDIS'                      23390000
235300                          ' FOR PO=' WS-DISPLAY-PO-NBR            23400000
235300                          ' RCVR=' WS-DISPLAY-2                   23410000
235300                          ' LINE=' WS-DISPLAY-1                   23420000
235410                          DELIMITED BY SIZE                       23440000
235500                          INTO PV-MSG-AREA                        23450001
235600                 PERFORM 7000-WRITE-TO-LOG                        23460001
235700             END-IF                                               23470000
235700             IF WS-SQL-CNT = 0                                    23480000
235700                 PERFORM 5447-INSERT-SHIP-XREF-DTL                23490000
235700             END-IF                                               23500000
235800         WHEN SQLCODE = -904                                      23510000
235900         WHEN SQLCODE = -913                                      23520000
236000         WHEN SQLCODE = -911                                      23530000
236100             CONTINUE                                             23540000
236400         WHEN SQLWARN0 NOT = SPACES                               23550000
236500         WHEN SQLCODE NOT = ZERO                                  23560000
237300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       23570000
237902             INITIALIZE PV-MSG-AREA                               23580001
237903             STRING   ' ' WS001-SRC-TASK-NUMBER                   23590000
238100                      ' WSKUP305-5445 ERROR:'                     23600000
238200                      ' SQL='                                     23610000
238300                      PV-SQL-RETURN-CD                            23620000
238400                      DELIMITED BY SIZE                           23630000
238500                      INTO PV-MSG-AREA                            23640001
238600             PERFORM 7000-WRITE-TO-LOG                            23650001
238701                                                                  23660000
238702             SET WS001-INVALID-SQL      TO TRUE                   23670000
238703             STRING 'SQL='                                        23680000
238704                  PV-SQL-RETURN-CD                                23690000
238705                  DELIMITED BY SIZE                               23700000
238706                                      INTO WS001-CRA-RET-MSG      23710000
238708             MOVE SQLCA                 TO WS001-SQLCA            23730000
238714             PERFORM 9999-ABEND                                   23790000
238715     END-EVALUATE.                                                23800000
238720*                                                                 23810000
238900/                                                                 23820000
231600 5447-INSERT-SHIP-XREF-DTL.                                       23830000
231700                                                                  23840000
231700* DO THE INSERT TO THE TABLE.  IF THE RECORD ALREADY EXISTS,      23841010
231700* THEN CALL 5530- WHICH WILL DO AN UPDATE INSTEAD.                23842010
231700* THE KEY TO THE TABLE IS EXT-SHP-ID/PO/RCVR/LINE/PREPK-ID        23843010
231700                                                                  23844010
229002     MOVE '5447-INSERT-SHIP-XREF-DTL'                             23850000
229003                                 TO WS001-PARAGRAPH-NAME.         23860000
232300     EXEC SQL                                                     23870000
232400         INSERT INTO WST_SHPMT_XREF_DTL                           23880000
232500               (EXT_SHP_ID                                        23890000
232600              , PO_NBR                                            23891000
232700              , PO_LNE_NBR                                        23892000
232800              , RCVR_SEQ_NBR                                      23893000
232900              , ASN_LVL_CDE                                       23894000
233000              , PREPK_ID                                          23895000
233100              , CRE_USR_ID                                        23896000
233200              , CRE_TMST                                          23897000
233300              , DWNLD_CDE                                         23898000
233400              , ACTV_CDE                                          23899000
233400              , CRE_PGM_CDE )                                     23899100
233500         VALUES                                                   23899200
233600              (:WST00002-EXT-SHP-ID                               23899300
233700             , :WST00002-PO-NBR                                   23899400
233800             , :WST00002-PO-LNE-NBR                               23899500
233900             , :WST00002-RCVR-SEQ-NBR                             23899600
234000             , :WST00002-ASN-LVL-CDE                              23899700
234100             , :WST00002-PREPK-ID                                 23899800
234200             , :WST00002-CRE-USR-ID                               23899900
234300             , :WST00002-CRE-TMST                                 23900000
234400             , :WST00002-DWNLD-CDE                                23900100
234500             , :WST00002-ACTV-CDE                                 23900200
234500             , :WST00002-CRE-PGM-CDE)                             23900300
234600     END-EXEC.                                                    23900400
234700                                                                  23900500
234800     EVALUATE TRUE                                                23900600
234900         WHEN SQLCODE = ZERO                                      23900700
178605             SET PS-DETAIL-CREATED-YES  TO TRUE                   23900810
235000             IF PS-LOG-SWITCH-YES                                 23900901
235001                 MOVE WST00002-PO-NBR TO WS-DISPLAY-1             23901000
235002                 INITIALIZE PV-MSG-AREA                           23901101
235003                 STRING   ' ' WS001-SRC-TASK-NUMBER               23901200
235100                          ' WSKUP305-5447:'                       23901300
235200                          ' INSERT WST_SHPMT_XREF_DTL'            23901400
235300                          ' FOR SHPMT='                           23901500
235400                          WST00002-EXT-SHP-ID                     23901600
235401                          ' PO NBR='                              23901700
235402                          WS-DISPLAY-1                            23901800
235410                          DELIMITED BY SIZE                       23901900
235500                          INTO PV-MSG-AREA                        23902001
235600                 PERFORM 7000-WRITE-TO-LOG                        23902101
235700             END-IF                                               23902200
235800         WHEN SQLCODE = -904                                      23902300
235900         WHEN SQLCODE = -913                                      23902400
236000         WHEN SQLCODE = -911                                      23902500
236100             CONTINUE                                             23902600
236200         WHEN SQLCODE = -803                                      23902700
236300             PERFORM 5530-UPDATE-SHIP-XREF-DTL                    23902800
236400         WHEN SQLWARN0 NOT = SPACES                               23902900
236500         WHEN SQLCODE NOT = ZERO                                  23903000
237300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       23903100
237902             INITIALIZE PV-MSG-AREA                               23903201
237903             STRING   ' ' WS001-SRC-TASK-NUMBER                   23903300
238100                      ' WSKUP305-5447 ERROR:'                     23903400
238200                      ' SQL='                                     23903500
238300                      PV-SQL-RETURN-CD                            23903600
238400                      DELIMITED BY SIZE                           23903700
238500                      INTO PV-MSG-AREA                            23903801
238600             PERFORM 7000-WRITE-TO-LOG                            23903901
238701                                                                  23904000
238702             SET WS001-INVALID-SQL      TO TRUE                   23904100
238703             STRING 'SQL='                                        23904200
238704                  PV-SQL-RETURN-CD                                23904300
238705                  DELIMITED BY SIZE                               23904400
238706                                      INTO WS001-CRA-RET-MSG      23904500
238708             MOVE SQLCA                 TO WS001-SQLCA            23904600
238714             PERFORM 9999-ABEND                                   23905200
238715     END-EVALUATE.                                                23905300
238720*                                                                 23905400
238900/                                                                 23905500
239000******************************************************************23905600
239100* CHECK IF THE PO RCVR HAS UCC128 DATA                           *23905700
239200******************************************************************23905800
239300 5450-PROCESS-FOR-UCC128-DATA.                                    23905900
239400                                                                  23906000
239500     MOVE '5450-PROCESS-FOR-UCC128-DATA' TO WS001-PARAGRAPH-NAME. 23907000
239600                                                                  23908000
239700     SET PS-LNE-UCC128-DATA-NO           TO TRUE.                 23909000
239800     PERFORM 5455-CHECK-UCC128-CRTN-DATA                          23910000
239900     IF PS-LNE-UCC128-DATA-YES                                    23920000
240000         PERFORM 5460-CHECK-UCC128-QTY-DATA                       23930000
240100     END-IF.                                                      23940000
240200                                                                  23950000
240300/                                                                 23960000
240400 5455-CHECK-UCC128-CRTN-DATA.                                     23970000
240500                                                                  23980000
240600     MOVE '5455-CHECK-UCC128-CRTN-DATA'                           23990000
240700                                 TO WS001-PARAGRAPH-NAME.         24000000
240800                                                                  24010000
240900     EXEC SQL                                                     24020000
241000          SELECT SUM(C.SHPD_QTY)                                  24030000
241100            INTO :PV-UCC128-CRTN-CNT                              24040000
241200            FROM TPKSLIP A                                        24050000
241300                ,TINPKSU B                                        24060000
241400                ,TSHUUPC C                                        24070000
241500           WHERE A.PO_NBR        = :WS-PO-NBR                     24080000
241600             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               24090000
241700             AND A.VER_STAT_CDE  = 'A'                            24100000
241800             AND A.PKSL_STAT_CDE = 'AC'                           24110000
241900             AND B.PO_NBR        = A.PO_NBR                       24120000
242000             AND B.SEQ_NBR       = A.SEQ_NBR                      24130000
242100             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 24140000
242200             AND C.TRN_NBR       = A.PO_NBR                       24150000
242300             AND C.TRN_LNE_NBR   = :WS-PO-LNE-NBR                 24160000
242400     END-EXEC.                                                    24170000
242500                                                                  24180000
242600                                                                  24190000
242700     EVALUATE TRUE                                                24200000
242800        WHEN SQLCODE = ZERO                                       24210000
242900            IF PV-UCC128-CRTN-CNT  >  0                           24220000
243000               SET PS-LNE-UCC128-DATA-YES TO TRUE                 24230000
243100               MOVE PV-UCC128-CRTN-CNT    TO PC251-TOTAL-CARTONS  24240000
243200            ELSE                                                  24250000
243300               MOVE ZEROES                TO PC251-TOTAL-CARTONS  24260000
243400               SET PS-LNE-UCC128-DATA-NO  TO TRUE                 24270000
243500            END-IF                                                24280000
243510            IF PS-LOG-SWITCH-YES                                  24290001
243520                MOVE PC251-TOTAL-CARTONS  TO WS-DISPLAY-1         24300000
243521                INITIALIZE PV-MSG-AREA                            24310001
243530                STRING   ' ' WS001-SRC-TASK-NUMBER                24320000
243540                         ' WSKUP305-5455:'                        24330000
243550                         ' UCC128 CRTN CNT=' WS-DISPLAY-1         24340000
243591                         DELIMITED BY SIZE                        24350000
243592                                      INTO PV-MSG-AREA            24351001
243593                PERFORM 7000-WRITE-TO-LOG                         24352001
243594            END-IF                                                24353000
243600        WHEN SQLCODE = -305                                       24354000
243700            SET PS-LNE-UCC128-DATA-NO   TO TRUE                   24355000
243800            MOVE ZEROES                 TO PC251-TOTAL-CARTONS    24356000
243900        WHEN SQLWARN0 NOT = SPACES                                24357000
243901        WHEN SQLCODE NOT = ZERO                                   24358000
243902            SET WS001-INVALID-SQL       TO TRUE                   24359000
243903            MOVE SQLCODE                TO PV-SQL-RETURN-CD       24360000
243904            STRING 'SQL='                                         24370000
243905                 PV-SQL-RETURN-CD                                 24380000
243906                 DELIMITED BY SIZE                                24390000
243907                                      INTO WS001-CRA-RET-MSG      24390100
243908            MOVE SQLCA                  TO WS001-SQLCA            24390200
243909            IF PS-LOG-SWITCH-YES                                  24390301
243910                MOVE WS-PO-NBR          TO WS-DISPLAY-PO-NBR      24390400
243920                MOVE WS-RCVR-SEQ-NBR    TO WS-DISPLAY-RCVR-NBR    24390500
243921                MOVE WS-PO-LNE-NBR      TO WS-DISPLAY-LNE-NBR     24390600
243922                INITIALIZE PV-MSG-AREA                            24390701
243923                STRING   ' ' WS001-SRC-TASK-NUMBER                24390800
243924                         ' WSKUP305-5455 ERROR:'                  24390900
243925                         ' SQL='                                  24391000
243926                         PV-SQL-RETURN-CD                         24392000
243927                         ' PO= ' WS-DISPLAY-PO-NBR                24392100
243928                         ' RCVR= ' WS-DISPLAY-RCVR-NBR            24392200
243929                         ' LNE= ' WS-DISPLAY-LNE-NBR              24392300
243930                         DELIMITED BY SIZE                        24392400
243931                                      INTO PV-MSG-AREA            24392501
243932                PERFORM 7000-WRITE-TO-LOG                         24392601
243933            END-IF                                                24392700
243934     END-EVALUATE.                                                24392800
243935                                                                  24392900
243936/                                                                 24393000
243937 5460-CHECK-UCC128-QTY-DATA.                                      24393100
243938                                                                  24393200
243939      MOVE '5460-CHECK-UCC128-QTY-DATA '                          24393300
243940                                 TO WS001-PARAGRAPH-NAME.         24393400
243941      EXEC SQL                                                    24393500
243950          SELECT SUM(C.SHPD_QTY)                                  24393600
243960                ,COUNT(DISTINCT C.SHPD_QTY)                       24393700
243970            INTO :PV-UCC128-TOT-UNTS                              24393800
243980                ,:PV-UCC128-TOT-OTPK-QTYS                         24393900
243990            FROM TPKSLIP A                                        24394000
244000                ,TINPKSU B                                        24395000
244100                ,TSHUUPC C                                        24396000
244200           WHERE A.PO_NBR        = :WS-PO-NBR                     24397000
244300             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               24398000
244400             AND A.VER_STAT_CDE  = 'A'                            24399000
244500             AND A.PKSL_STAT_CDE = 'AC'                           24400000
244600             AND B.PO_NBR        = A.PO_NBR                       24410000
244700             AND B.SEQ_NBR       = A.SEQ_NBR                      24420000
244800             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 24430000
244900             AND C.TRN_NBR       = A.PO_NBR                       24440000
245000             AND C.TRN_LNE_NBR   = :WS-PO-LNE-NBR                 24450000
245100      END-EXEC.                                                   24460000
245200                                                                  24470000
245300      EVALUATE TRUE                                               24480000
245400          WHEN SQLCODE = ZERO                                     24490000
245500              SET PS-LNE-UCC128-DATA-YES    TO TRUE               24500000
245510              IF PS-LOG-SWITCH-YES                                24510001
245511                  INITIALIZE PV-MSG-AREA                          24520001
245520                  MOVE PV-UCC128-TOT-UNTS   TO WS-DISPLAY-1       24530000
245550                  STRING  ' ' WS001-SRC-TASK-NUMBER               24540000
245560                          ' WSKUP305-5460:'                       24550000
245570                          ' UCC128 UNTS='                         24551000
245592                          WS-DISPLAY-1                            24552000
245597                          DELIMITED BY SIZE                       24553000
245598                                          INTO PV-MSG-AREA        24554001
245599                  PERFORM 7000-WRITE-TO-LOG                       24555001
245600              END-IF                                              24556000
245610          WHEN SQLCODE = -305                                     24557000
245700              SET PS-LNE-UCC128-DATA-NO  TO TRUE                  24558000
245800          WHEN SQLWARN0 NOT = SPACES                              24559000
245801          WHEN SQLCODE NOT = ZERO                                 24560000
245803              MOVE SQLCODE               TO PV-SQL-RETURN-CD      24570000
245809              MOVE WS-PO-NBR             TO WS-DISPLAY-PO-NBR     24580000
245810              MOVE WS-RCVR-SEQ-NBR       TO WS-DISPLAY-RCVR-NBR   24581000
245811              MOVE WS-PO-LNE-NBR         TO WS-DISPLAY-LNE-NBR    24581100
245812              INITIALIZE PV-MSG-AREA                              24581201
245813              STRING   ' ' WS001-SRC-TASK-NUMBER                  24581300
245814                       ' WSKUP305-5460 ERROR:'                    24581400
245815                       ' SQL='                                    24581500
245816                       PV-SQL-RETURN-CD                           24581600
245817                       ' PO= ' WS-DISPLAY-PO-NBR                  24581700
245818                       ' RCVR= ' WS-DISPLAY-RCVR-NBR              24581800
245819                       ' LNE= ' WS-DISPLAY-LNE-NBR                24581900
245820                       DELIMITED BY SIZE                          24582000
245821                                       INTO PV-MSG-AREA           24582101
245822              PERFORM 7000-WRITE-TO-LOG                           24582201
245824                                                                  24582300
245825             SET WS001-INVALID-SQL      TO TRUE                   24582400
245826             STRING 'SQL='                                        24582500
245827                  PV-SQL-RETURN-CD                                24582600
245828                  DELIMITED BY SIZE                               24582700
245829                                      INTO WS001-CRA-RET-MSG      24582800
245831             MOVE SQLCA                 TO WS001-SQLCA            24583000
245844             PERFORM 9999-ABEND                                   24584000
245845      END-EVALUATE.                                               24584100
245846                                                                  24584200
245847/                                                                 24584300
245848 5465-CHECK-CRTN-MLT-LNES.                                        24584400
245849                                                                  24584500
245850      MOVE '5465-CHECK-CRTN-MLT-LNES '                            24584600
245851                                 TO WS001-PARAGRAPH-NAME.         24584700
245852      EXEC SQL                                                    24584800
245869          SELECT COUNT(DISTINCT D.TRN_LNE_NBR)                    24584900
245870            INTO :PV-UCC128-LINES-PER-CRTN                        24585000
245880            FROM TPKSLIP A                                        24586000
245881                ,TINPKSU B                                        24587000
245882                ,TSHUUPC C                                        24588000
245883                ,TSHUUPC D                                        24588100
245884           WHERE A.PO_NBR        = :WS-PO-NBR                     24588200
245885             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               24588300
245887             AND A.VER_STAT_CDE  = 'A'                            24588400
245888             AND A.PKSL_STAT_CDE = 'AC'                           24588500
245889             AND B.PO_NBR        = A.PO_NBR                       24588600
245890             AND B.SEQ_NBR       = A.SEQ_NBR                      24588700
245891             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 24588800
245892             AND C.TRN_NBR       = B.PO_NBR                       24588900
245893             AND C.TRN_LNE_NBR   = :WS-PO-LNE-NBR                 24589000
245894             AND D.SHIPT_UNT_ID  = C.SHIPT_UNT_ID                 24589100
245895             AND D.TRN_NBR       = B.PO_NBR                       24589200
245896      END-EXEC.                                                   24589300
245897                                                                  24589400
245898      EVALUATE TRUE                                               24589500
245899          WHEN SQLCODE = ZERO                                     24589600
245900              IF PV-UCC128-LINES-PER-CRTN > 1                     24589700
245901                  SET PS-LNE-UCC128-DATA-NO     TO TRUE           24589800
245902              END-IF                                              24589900
245903              IF PS-LOG-SWITCH-YES                                24590001
245904                  INITIALIZE PV-MSG-AREA                          24590101
245905                  MOVE PV-UCC128-LINES-PER-CRTN TO WS-DISPLAY-1   24590200
245906                  STRING  ' ' WS001-SRC-TASK-NUMBER               24590300
245907                          ' WSKUP305-5465:'                       24590400
245908                          ' UCC128 LNES PER CRTN='                24590500
245909                          WS-DISPLAY-1                            24590600
245910                          DELIMITED BY SIZE                       24590700
245911                                          INTO PV-MSG-AREA        24590801
245912                  PERFORM 7000-WRITE-TO-LOG                       24590901
245913              END-IF                                              24591000
245916          WHEN SQLWARN0 NOT = SPACES                              24591100
245917          WHEN SQLCODE NOT = ZERO                                 24591200
245918              MOVE SQLCODE               TO PV-SQL-RETURN-CD      24591300
245919              MOVE WS-PO-NBR             TO WS-DISPLAY-PO-NBR     24591400
245920              MOVE WS-RCVR-SEQ-NBR       TO WS-DISPLAY-RCVR-NBR   24591500
245921              MOVE WS-PO-LNE-NBR         TO WS-DISPLAY-LNE-NBR    24591600
245922              INITIALIZE PV-MSG-AREA                              24591701
245923              STRING   ' ' WS001-SRC-TASK-NUMBER                  24591800
245924                       ' WSKUP305-5465 ERROR:'                    24591900
245925                       ' SQL='                                    24592000
245926                       PV-SQL-RETURN-CD                           24592100
245927                       ' PO= ' WS-DISPLAY-PO-NBR                  24592200
245928                       ' RCVR= ' WS-DISPLAY-RCVR-NBR              24592300
245929                       ' LNE= ' WS-DISPLAY-LNE-NBR                24592400
245930                       DELIMITED BY SIZE                          24592500
245931                                       INTO PV-MSG-AREA           24592601
245932              PERFORM 7000-WRITE-TO-LOG                           24592701
245933                                                                  24592800
245934             SET WS001-INVALID-SQL      TO TRUE                   24592900
245935             STRING 'SQL='                                        24593000
245936                  PV-SQL-RETURN-CD                                24593100
245937                  DELIMITED BY SIZE                               24593200
245938                                      INTO WS001-CRA-RET-MSG      24593300
245940             MOVE SQLCA                 TO WS001-SQLCA            24593500
245950             PERFORM 9999-ABEND                                   24594500
245951      END-EVALUATE.                                               24594600
245952                                                                  24594700
245953/                                                                 24594800
245954 5470-GET-TRANSCRIBE.                                             24594900
245955                                                                  24595000
245956     MOVE '5470-GET-TRANSCRIBE  '                                 24595100
245957                                 TO WS001-PARAGRAPH-NAME.         24595200
245959     IF PS-LOG-SWITCH-YES                                         24595301
245960         MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                      24595400
245961         MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR              24595500
245962         MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR                 24595600
245964         INITIALIZE PV-MSG-AREA                                   24595701
245965         STRING   ' ' WS001-SRC-TASK-NUMBER                       24595800
245966                  ' WSKUP305-5470: BEFORE:'                       24595900
245967                  ' PO= ' WS-DISPLAY-PO-NBR                       24596000
245968                  ' RCVR= ' WS-DISPLAY-RCVR-NBR                   24596100
245969                  ' LNE= ' WS-DISPLAY-LNE-NBR                     24596200
245971                  DELIMITED BY SIZE                               24596300
245972                  INTO PV-MSG-AREA                                24596401
245973         PERFORM 7000-WRITE-TO-LOG                                24596501
245974     END-IF.                                                      24596600
245975                                                                  24596700
245976     EXEC SQL                                                     24596800
245977        SELECT  SUM(EXPTED_ITM_QTY)                               24596900
245978          INTO :PV-TRANSCRIBE-SUM                                 24597000
245979          FROM  TRECDIS                                           24597100
245980      WHERE ORD_NBR        = :WS-PO-NBR                           24597200
245981        AND REC_SEQ_NBR    = :WS-RCVR-SEQ-NBR                     24597300
245990        AND ORD_LNE_NBR    = :WS-PO-LNE-NBR                       24597400
246000     END-EXEC.                                                    24597500
246100                                                                  24597600
246200     EVALUATE TRUE                                                24597700
246300         WHEN SQLCODE = ZERO                                      24597800
246410             IF PS-LOG-SWITCH-YES                                 24597901
246420                 MOVE PV-TRANSCRIBE-SUM    TO WS-DISPLAY-1        24598000
246421                 INITIALIZE PV-MSG-AREA                           24599001
246430                 STRING  ' ' WS001-SRC-TASK-NUMBER                24600000
246440                         ' WSKUP305-5470:'                        24610000
246450                         ' TRANSCRIBE UNTS='                      24620000
246460                         WS-DISPLAY-1                             24630000
246470                         DELIMITED BY SIZE                        24640000
246480                                         INTO PV-MSG-AREA         24641001
246490                 PERFORM 7000-WRITE-TO-LOG                        24642001
246491             END-IF                                               24643000
246500         WHEN SQLCODE = +100                                      24644000
246600         WHEN SQLCODE = -305                                      24645000
246700             MOVE ZEROES                   TO PV-TRANSCRIBE-SUM   24646000
246720*            IF PS-LOG-SWITCH-YES                                 24647013
246740*                MOVE SQLCODE              TO PV-SQL-RETURN-CD    24648013
246750*                INITIALIZE PV-MSG-AREA                           24649013
246760*                STRING  ' ' WS001-SRC-TASK-NUMBER                24650013
246770*                        ' WSKUP305-5470:'                        24660013
246791*                        ' SQLCODE='                              24670013
246792*                        PV-SQL-RETURN-CD                         24671013
246793*                        DELIMITED BY SIZE                        24672013
246794*                                        INTO PV-MSG-AREA         24673013
246795*                PERFORM 7000-WRITE-TO-LOG                        24674013
246796*            END-IF                                               24675013
246800         WHEN SQLWARN0 NOT = SPACES                               24676000
246801         WHEN SQLCODE NOT = ZERO                                  24677000
246803            MOVE SQLCODE               TO PV-SQL-RETURN-CD        24678000
246809            MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                   24679000
246810            MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR           24680000
246811            MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR              24681000
246812            INITIALIZE PV-MSG-AREA                                24681101
246813            STRING   ' ' WS001-SRC-TASK-NUMBER                    24681200
246814                     ' WSKUP305-5470 ERROR:'                      24681300
246815                     ' SQL='                                      24681400
246816                     PV-SQL-RETURN-CD                             24681500
246817                     ' PO= ' WS-DISPLAY-PO-NBR                    24681600
246818                     ' RCVR= ' WS-DISPLAY-RCVR-NBR                24681700
246819                     ' LNE= ' WS-DISPLAY-LNE-NBR                  24681800
246820                     DELIMITED BY SIZE                            24681900
246821                     INTO PV-MSG-AREA                             24682001
246830            PERFORM 7000-WRITE-TO-LOG                             24683001
246841                                                                  24684000
246842             SET WS001-INVALID-SQL      TO TRUE                   24684100
246843             STRING 'SQL='                                        24684200
246844                  PV-SQL-RETURN-CD                                24684300
246845                  DELIMITED BY SIZE                               24684400
246846                                      INTO WS001-CRA-RET-MSG      24684500
246848             MOVE SQLCA                 TO WS001-SQLCA            24684700
246858             PERFORM 9999-ABEND                                   24685300
246859     END-EVALUATE.                                                24685400
246860                                                                  24685500
246870/                                                                 24685600
246880 5480-GET-OUTER-PK-QTY.                                           24685700
246890                                                                  24685800
246900     MOVE '5480-GET-OUTER-PK-QTY'                                 24685900
247000                                 TO WS001-PARAGRAPH-NAME.         24686000
247100                                                                  24687000
247200     EXEC SQL                                                     24688000
247300        SELECT  A.ITM_NBR                                         24689000
247400              , A.CASE_PACK_QTY                                   24690000
247500              , A.PREPK_RATO_QTY                                  24700000
247600              , A.INNR_PACK_QTY                                   24710000
247700              , B.SKU_NBR                                         24720000
247800              , B.OUTR_PK_QTY                                     24730000
247900          INTO :RECITM-ITM-NBR                                    24740000
248000             , :RECITM-CASE-PACK-QTY                              24750000
248100             , :RECITM-PREPK-RATO-QTY                             24760000
248200             , :RECITM-INNR-PACK-QTY                              24770000
248300             , :XLT00003-SKU-NBR                                  24780000
248400             , :XLT00003-OUTR-PK-QTY                              24790000
248500          FROM  TRECITM A                                         24800000
248600             ,  XLT_SKU B                                         24810000
248700      WHERE A.ORD_NBR        = :WS-PO-NBR                         24820000
248800        AND A.REC_SEQ_NBR    = :WS-RCVR-SEQ-NBR                   24830000
248900        AND A.ORD_LNE_NBR    = :WS-PO-LNE-NBR                     24840000
249000        AND A.VER_STATUS_CDE = 'A'                                24850000
249100        AND A.ITM_NBR        = B.ITM_NBR                          24860000
249200     END-EXEC.                                                    24870000
249300                                                                  24880000
249400     EVALUATE TRUE                                                24890000
249500         WHEN SQLCODE = ZERO                                      24900000
249610             IF PS-LOG-SWITCH-YES                                 24910001
249620                 MOVE RECITM-ITM-NBR        TO WS-DISPLAY-5       24920000
249621                 MOVE RECITM-CASE-PACK-QTY  TO WS-DISPLAY-1       24930000
249622                 MOVE RECITM-PREPK-RATO-QTY TO WS-DISPLAY-2       24940000
249623                 MOVE RECITM-INNR-PACK-QTY  TO WS-DISPLAY-3       24950000
249624                 MOVE XLT00003-SKU-NBR      TO WS-DISPLAY-4       24960000
249625                 MOVE XLT00003-OUTR-PK-QTY  TO WS-DISPLAY-6       24961000
249626                 INITIALIZE PV-MSG-AREA                           24962001
249632                 STRING  ' ' WS001-SRC-TASK-NUMBER                24963000
249640                         ' WSKUP305-5480:'                        24964000
249650                         ' ITM NBR=' WS-DISPLAY-5                 24965000
249660                         ' CASE QTY=' WS-DISPLAY-1                24966000
249661                         ' PREPK QTY=' WS-DISPLAY-2               24966100
249662                         ' INNR QTY=' WS-DISPLAY-3                24966200
249663                         ' SKU NBR=' WS-DISPLAY-4                 24966300
249664                         ' OUTR QTY=' WS-DISPLAY-6                24966400
249670                         DELIMITED BY SIZE                        24966500
249680                                         INTO PV-MSG-AREA         24966601
249690                 PERFORM 7000-WRITE-TO-LOG                        24966701
249691             END-IF                                               24966800
249700         WHEN SQLCODE = +100                                      24966900
249800             CONTINUE                                             24967000
250000         WHEN SQLWARN0 NOT = SPACES                               24968000
250001         WHEN SQLCODE NOT = ZERO                                  24969000
250003            MOVE SQLCODE               TO PV-SQL-RETURN-CD        24970000
250009            MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                   24980000
250010            MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR           24990000
250011            MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR              25000000
250012            INITIALIZE PV-MSG-AREA                                25001001
250013            STRING   ' ' WS001-SRC-TASK-NUMBER                    25001100
250014                     ' WSKUP305-5480 ERROR:'                      25001200
250015                     ' SQL='                                      25001300
250016                     PV-SQL-RETURN-CD                             25001400
250017                     ' PO= ' WS-DISPLAY-PO-NBR                    25001500
250018                     ' RCVR= ' WS-DISPLAY-RCVR-NBR                25001600
250019                     ' LNE= ' WS-DISPLAY-LNE-NBR                  25001700
250020                     DELIMITED BY SIZE                            25001800
250021                     INTO PV-MSG-AREA                             25001901
250030            PERFORM 7000-WRITE-TO-LOG                             25002001
250041                                                                  25003000
250042             SET WS001-INVALID-SQL      TO TRUE                   25004000
250043             STRING 'SQL='                                        25004100
250044                  PV-SQL-RETURN-CD                                25004200
250045                  DELIMITED BY SIZE                               25004300
250046                                      INTO WS001-CRA-RET-MSG      25004400
250048             MOVE SQLCA                 TO WS001-SQLCA            25004600
250058             PERFORM 9999-ABEND                                   25005400
250059     END-EVALUATE.                                                25005500
250060                                                                  25005600
250061/                                                                 25005700
250062 5500-CASEPACK-SPLIT.                                             25005800
250063                                                                  25005900
250064     MOVE '5500-CASEPACK-SPLIT'  TO WS001-PARAGRAPH-NAME.         25006000
250065                                                                  25006100
250066     MOVE WS-PO-NBR                   TO PC251-PO-NBR.            25006200
250067     MOVE WS-RCVR-SEQ-NBR             TO PC251-RCVR-SEQ-NBR.      25006300
250068     MOVE WS-PO-LNE-NBR               TO PC251-PO-LNE-NBR.        25006400
250069     MOVE WS-PREPK-ID                 TO PC251-PREPK-ID.          25006500
250070     MOVE WS-PKGNG-CDE                TO PC251-PKGNG-CD.          25006600
250071     MOVE 'WSKUP305'                  TO PC251-CALLING-PROGRAM.   25006700
250072     MOVE WS-OPER-UNT-ID              TO PC251-OPER-UNT-ID.       25006800
250073     MOVE 1                           TO PC251-MOD-NBR.           25006900
250074     SET PC251-FUNC-LBL-CALC          TO TRUE.                    25007000
250075     SET PC251-PRT-SHUFFLED           TO TRUE.                    25007100
250076     SET PC251-CREATE-BOTH            TO TRUE.                    25007200
250077     CALL PC-CASEPACK-SPLIT-MOD  USING  PC251-FIELDS.             25007305
250077                                                                  25007405
250080     EVALUATE TRUE                                                25007600
250081         WHEN PC251-SUCCESSFUL                                    25007700
250082             PERFORM 5510-VALIDATE-LBL-CALC-CALL                  25007800
250083         WHEN OTHER                                               25007900
250084              MOVE PC251-ERROR-PARA-NBR  TO WS001-PARAGRAPH-NAME  25008000
250085              MOVE PC251-SQL-CODE        TO PV-SQL-RETURN-CD      25008100
250086              STRING 'BAD CALL 719,SQL= '                         25008200
250087                   PV-SQL-RETURN-CD                               25008300
250088                   DELIMITED BY SIZE                              25008400
250089                                       INTO WS001-CRA-RET-MSG     25008500
250100              MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                 25008600
250200              MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR         25008700
250201              MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR            25008800
250202              INITIALIZE PV-MSG-AREA                              25008901
250203              STRING   ' ' WS001-SRC-TASK-NUMBER                  25009000
250204                       ' WSKUP305-5500 ERROR:'                    25010000
250205                       ' SQL='                                    25020000
250206                       PV-SQL-RETURN-CD                           25020100
250207                    ' PO= ' WS-DISPLAY-PO-NBR                     25020200
250208                    ' RCVR= ' WS-DISPLAY-RCVR-NBR                 25020300
250209                    ' LNE= ' WS-DISPLAY-LNE-NBR                   25020400
250210                    DELIMITED BY SIZE                             25020500
250211                    INTO PV-MSG-AREA                              25020601
250212              PERFORM 7000-WRITE-TO-LOG                           25020701
250213             SET WS001-ERROR         TO TRUE                      25020800
250215                                                                  25020900
250222             MOVE SQLCA                 TO WS001-SQLCA            25022000
250230             PERFORM 9999-ABEND                                   25022400
250231     END-EVALUATE.                                                25022500
250232                                                                  25022600
250233/                                                                 25022700
250234 5510-VALIDATE-LBL-CALC-CALL.                                     25022800
250235                                                                  25022900
250236     MOVE '5510-VALIDATE-LBL-CALC-CALL' TO WS001-PARAGRAPH-NAME.  25023000
250237                                                                  25023100
250238     IF PC251-PRE-PACK-ORDER                                      25023200
250240         IF PC251-PREPK-UCC128-NO                                 25023300
250250             SET PS-LNE-UCC128-DATA-NO    TO TRUE                 25023400
250260         END-IF                                                   25023500
250270     END-IF.                                                      25023600
250280                                                                  25023700
250282     IF PS-LOG-SWITCH-YES                                         25023801
250283         INITIALIZE PV-MSG-AREA                                   25023901
250284         STRING      ' ' WS001-SRC-TASK-NUMBER                    25024000
250285                     ' WSKUP305-5510:'                            25025000
250286                     ' PRCS-QTY=' PC251-PRCS-QTY                  25026000
250287                     ' TRNS-QTY=' PC251-TRNS-QTY                  25027000
250288                     DELIMITED BY SIZE                            25028000
250289                                      INTO PV-MSG-AREA            25028101
250290         PERFORM 7000-WRITE-TO-LOG                                25028201
250291     END-IF.                                                      25028300
250292                                                                  25028400
250293*      IF PS-LNE-UCC128-DATA-NO                                   25028500
250300*         PERFORM 5520-CALCULATE-PROCESS-QTY                      25028600
250400*      END-IF.                                                    25028700
250500*                                                                 25028800
250600/                                                                 25028900
250700*5520-CALCULATE-PROCESS-QTY.                                      25029000
250800                                                                  25030000
250900*    MOVE '5520-CALCULATE-PROCESS-QTY ' TO WS001-PARAGRAPH-NAME.  25040000
251000                                                                  25050000
251100*    IF WS-PKGNG-CDE = 'M' OR WS-PKGNG-CDE = 'I'                  25060000
251200*        COMPUTE XLT00003-OUTR-PK-QTY =                           25070000
251300*                RECITM-CASE-PACK-QTY  *                          25080000
251400*                RECITM-PREPK-RATO-QTY                            25090000
251500*    END-IF.                                                      25100000
251600                                                                  25110000
251700*    IF XLT00003-OUTR-PK-QTY > 0 AND                              25120000
251800*       PV-UCC128-CRTN-CNT   > 0                                  25130000
251900*          MULTIPLY  PV-UCC128-CRTN-CNT                           25140000
252000*                BY  XLT00003-OUTR-PK-QTY                         25150000
252100*            GIVING  PV-PROCESS-QTY                               25160000
252200*    END-IF.                                                      25170000
252300                                                                  25180000
252400*    IF PV-TRANSCRIBE-SUM = PV-PROCESS-QTY                        25190000
252500*       CONTINUE                                                  25200000
252600*    ELSE                                                         25210000
252700                                                                  25220000
252800*       MOVE  ZEROES  TO  PV-CARTON-COUNT-CALC                    25230000
252900*                         PV-CARTON-COUNT-REM                     25240000
253000                                                                  25250000
253100*       IF  XLT00003-OUTR-PK-QTY      >  0                        25260000
253200*          DIVIDE  PV-TRANSCRIBE-SUM                              25270000
253300*              BY  XLT00003-OUTR-PK-QTY                           25280000
253400*          GIVING  PV-CARTON-COUNT-CALC                           25290000
253500*                  REMAINDER PV-CARTON-COUNT-REM                  25300000
253600*          END-DIVIDE                                             25310000
253700                                                                  25320000
253800*          IF  PV-CARTON-COUNT-REM  >  +0                         25330000
253900*              MOVE PV-UCC128-CRTN-CNT TO PC251-P2L-LBL-CNT       25340000
254000*          ELSE                                                   25350000
254100*              MOVE PV-CARTON-COUNT-CALC TO PC251-TOTAL-CARTONS   25360000
254200*                                           PC251-FCSE-LBL-CNT    25370000
254300*          END-IF                                                 25380000
254400                                                                  25390000
254500*      END-IF                                                     25400000
254600*    END-IF.                                                      25410000
254700                                                                  25420000
254800/                                                                 25430000
258902 5530-UPDATE-SHIP-XREF-DTL.                                       25440000
258903                                                                  25450000
258904     MOVE '5530-UPDATE-SHIP-XREF-DTL'                             25460000
258905                                 TO WS001-PARAGRAPH-NAME.         25470000
258906                                                                  25480000
258907     EXEC SQL                                                     25490000
258908           UPDATE WST_SHPMT_XREF_DTL                              25500000
258909              SET ASN_LVL_CDE      = :WST00002-ASN-LVL-CDE        25510000
258910                , PREPK_ID         = :WST00002-PREPK-ID           25520000
258911                , CRE_USR_ID       = :WST00002-CRE-USR-ID         25530000
258912                , CRE_TMST         = :WST00002-CRE-TMST           25540000
258913                , DWNLD_CDE        = :WST00002-DWNLD-CDE          25550000
258914                , ACTV_CDE         = :WST00002-ACTV-CDE           25560000
258915            WHERE EXT_SHP_ID     = :WST00002-EXT-SHP-ID           25570000
258916            AND   PO_NBR         = :WST00002-PO-NBR               25580000
258917            AND   RCVR_SEQ_NBR   = :WST00002-RCVR-SEQ-NBR         25590000
258918            AND   PO_LNE_NBR     = :WST00002-PO-LNE-NBR           25600000
258918            AND   PREPK_ID       = :WST00002-PREPK-ID             25601010
258919     END-EXEC.                                                    25610000
258920                                                                  25620000
258921     EVALUATE TRUE                                                25630000
258922         WHEN SQLCODE = ZERO                                      25640000
258923             IF PS-LOG-SWITCH-YES                                 25650001
258924                 MOVE WST00002-PO-NBR TO WS-DISPLAY-1             25660000
258925                 MOVE WST00002-RCVR-SEQ-NBR TO WS-DISPLAY-2       25670000
258926                 MOVE WST00002-PO-LNE-NBR TO WS-DISPLAY-4         25680000
258927                 INITIALIZE PV-MSG-AREA                           25690001
258928                 STRING   ' ' WS001-SRC-TASK-NUMBER               25700000
258929                          ' WSKUP305-5530:'                       25710000
258930                          ' UPDATE WST_SHPMT_XREF_DTL'            25720000
258931                          ' FOR SHPMT='                           25730000
258932                          WST00002-EXT-SHP-ID                     25740000
258939                          DELIMITED BY SIZE                       25810000
258940                          INTO PV-MSG-AREA                        25820001
258941                 PERFORM 7000-WRITE-TO-LOG                        25830001
258927                 INITIALIZE PV-MSG-AREA                           25831010
258928                 STRING   ' ' WS001-SRC-TASK-NUMBER               25832010
258929                          ' WSKUP305-5530:'                       25833010
258933                          ' PO NBR='                              25837010
258934                          WS-DISPLAY-1                            25838010
258935                          ' RCVR SEQ NBR='                        25839010
258936                          WS-DISPLAY-2                            25839110
258937                          ' PO LNE NBR='                          25839210
258938                          WS-DISPLAY-4                            25839310
258939                          DELIMITED BY SIZE                       25839410
258940                          INTO PV-MSG-AREA                        25839510
258941                 PERFORM 7000-WRITE-TO-LOG                        25839610
258942             END-IF                                               25840000
258943         WHEN SQLCODE = -904                                      25850000
258944         WHEN SQLCODE = -913                                      25860000
258945         WHEN SQLCODE = -911                                      25870000
258946             CONTINUE                                             25880000
258947         WHEN SQLWARN0 NOT = SPACES                               25890000
258948         WHEN SQLCODE NOT = ZERO                                  25891000
258950             MOVE SQLCODE               TO PV-SQL-RETURN-CD       25892000
258956             INITIALIZE PV-MSG-AREA                               25893001
258957             STRING   ' ' WS001-SRC-TASK-NUMBER                   25894000
258958                      ' WSKUP305-5530 ERROR:'                     25895000
258959                      ' SQL='                                     25895100
258960                      PV-SQL-RETURN-CD                            25895200
258961                      DELIMITED BY SIZE                           25895300
258962                      INTO PV-MSG-AREA                            25895401
258963             PERFORM 7000-WRITE-TO-LOG                            25895501
258965                                                                  25895600
258966             SET WS001-INVALID-SQL      TO TRUE                   25895700
258967             STRING 'SQL='                                        25895800
258968                  PV-SQL-RETURN-CD                                25895900
258969                  DELIMITED BY SIZE                               25896000
258970                                      INTO WS001-CRA-RET-MSG      25897000
258972             MOVE SQLCA                 TO WS001-SQLCA            25897200
258978             PERFORM 9999-ABEND                                   25897800
258979     END-EVALUATE.                                                25897900
258980                                                                  25898000
258981/                                                                 25898100
258982 5600-DETAIL-PO-RCVR.                                             25898200
258983                                                                  25898300
258984     MOVE '5600-DETAIL-PO-RCVR'  TO WS001-PARAGRAPH-NAME.         25898400
258985                                                                  25898500
258986     PERFORM 5630-OPEN-RCVR-LINE-CSR.                             25898600
258987     PERFORM 5640-FETCH-RCVR-LINE-CSR UNTIL                       25898700
258988                 PS-EOF-RCVR-LINE-CSR-YES.                        25898800
258989     PERFORM 5650-CLOSE-RCVR-LINE-CSR.                            25898900
258990                                                                  25899000
258991/                                                                 25899100
258992 5610-CHECK-FOR-PBS.                                              25899200
258993                                                                  25899300
258994     MOVE '5610-CHECK-FOR-PBS'   TO WS001-PARAGRAPH-NAME.         25899400
258995                                                                  25899500
258996     EXEC SQL                                                     25899600
258997         SELECT  PACK_BY_ST_IND                                   25899700
258998               , PKGNG_CDE                                        25899800
258999         INTO                                                     25899900
259000                :RECEIV-PACK-BY-ST-IND                            25900000
259001               ,:RECEIV-PKGNG-CDE                                 25900100
259002         FROM    TRECEIV                                          25900200
259003         WHERE   ORD_NBR        = :DK-PO-NBR                      25900300
259004         AND     REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR                25900400
259005         AND     VER_STATUS_CDE = 'A'                             25900500
259006     END-EXEC.                                                    25900600
259007                                                                  25900700
259008     EVALUATE TRUE                                                25900800
259009         WHEN SQLCODE = ZERO                                      25900900
259010             MOVE RECEIV-PKGNG-CDE   TO WS-PKGNG-CDE              25901000
259011             IF PS-LOG-SWITCH-YES                                 25901101
259012                 INITIALIZE PV-MSG-AREA                           25901201
259013                 STRING   ' ' WS001-SRC-TASK-NUMBER               25901300
259014                          ' WSKUP305-5610:'                       25901400
259015                          ' PKGNG CDE='                           25901500
259016                          WS-PKGNG-CDE                            25901600
259017                          DELIMITED BY SIZE                       25901700
259018                          INTO PV-MSG-AREA                        25901801
259019                 PERFORM 7000-WRITE-TO-LOG                        25901901
259020             END-IF                                               25902000
259021             IF RECEIV-PACK-BY-ST-IND = 'Y'                       25902100
259022                 SET PS-PACK-BY-STORE-YES TO TRUE                 25902200
259023                 PERFORM 5660-CHECK-FOR-CARTONS                   25902300
259024             END-IF                                               25902400
259025         WHEN SQLCODE = +100                                      25902500
259026         WHEN SQLCODE = -811                                      25902600
259027         WHEN SQLCODE = -904                                      25902700
259028         WHEN SQLCODE = -913                                      25902800
259029         WHEN SQLCODE = -911                                      25902900
259030             CONTINUE                                             25903000
259031         WHEN SQLWARN0 NOT = SPACES                               25903100
259032         WHEN SQLCODE NOT = ZERO                                  25903200
259033             SET WS001-INVALID-SQL      TO TRUE                   25903300
259034             MOVE SQLCODE               TO PV-SQL-RETURN-CD       25903400
259035             STRING 'SQL='                                        25903500
259036                  PV-SQL-RETURN-CD                                25903600
259037                  DELIMITED BY SIZE                               25903700
259038                                      INTO WS001-CRA-RET-MSG      25903800
259039             MOVE SQLCA                 TO WS001-SQLCA            25903900
259040             INITIALIZE PV-MSG-AREA                               25904001
259041             STRING   ' ' WS001-SRC-TASK-NUMBER                   25904100
259042                      ' WSKUP305-5610 ERROR:'                     25904200
259043                      ' SQL='                                     25904300
259044                      PV-SQL-RETURN-CD                            25904400
259045                      DELIMITED BY SIZE                           25904500
259046                      INTO PV-MSG-AREA                            25904601
259047             PERFORM 7000-WRITE-TO-LOG                            25904701
259048     END-EVALUATE.                                                25904800
259049*                                                                 25904900
259050/                                                                 25905000
259051 5620-CHECK-FOR-PBS-ERRS.                                         25905100
259052                                                                  25905200
259053     MOVE '5620-CHECK-FOR-PBS-ERRS'                               25905300
259054                                 TO WS001-PARAGRAPH-NAME.         25905400
259055                                                                  25905500
259056     EXEC SQL                                                     25905600
259057         SELECT  COUNT (*)                                        25905700
259058         INTO   :PV-CNT-CURSOR                                    25905800
259059         FROM    TPKSLIP A                                        25905900
259060               , TINPKSU B                                        25906000
259061               , TSHUNLO C                                        25906100
259062         WHERE   A.PO_NBR         = :DK-PO-NBR                    25906200
259063         AND     A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              25906300
259064         AND     A.SEQ_NBR        = B.SEQ_NBR                     25906400
259065         AND     A.PO_NBR         = B.PO_NBR                      25906500
259066         AND     B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                25906600
259067         AND     C.ACTV_CDE       = 'I'                           25906700
259068         AND     C.SCN_LOC_ID     IN                              25906800
259069                      ('PBSA','PBSB','PBSC','PBSD','PBSE')        25906900
259070     END-EXEC.                                                    25907000
259071                                                                  25907100
259072     EVALUATE TRUE                                                25907200
259073         WHEN SQLCODE = ZERO                                      25907300
259074             IF PV-CNT-CURSOR > 0                                 25907400
259075                SET PS-PBS-CASE-INVALID-YES TO TRUE               25907500
259076             END-IF                                               25907600
259077             IF PS-LOG-SWITCH-YES                                 25907701
259078                 INITIALIZE PV-MSG-AREA                           25907801
259079                 STRING   ' ' WS001-SRC-TASK-NUMBER               25907900
259080                          ' WSKUP305-5620:'                       25908000
259081                          ' PBS CASE IS INVALID'                  25908100
259082                          DELIMITED BY SIZE                       25908200
259083                          INTO PV-MSG-AREA                        25908301
259084                 PERFORM 7000-WRITE-TO-LOG                        25908401
259085             END-IF                                               25908500
259090         WHEN SQLCODE = +100                                      25908600
259100         WHEN SQLCODE = -811                                      25908700
259200         WHEN SQLCODE = -904                                      25908800
259300         WHEN SQLCODE = -913                                      25908900
259400         WHEN SQLCODE = -911                                      25909000
259500             CONTINUE                                             25910000
259600         WHEN SQLWARN0 NOT = SPACES                               25920000
259700         WHEN SQLCODE NOT = ZERO                                  25930000
260500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       25940000
261102             INITIALIZE PV-MSG-AREA                               25950001
261103             STRING   ' ' WS001-SRC-TASK-NUMBER                   25960000
261300                      ' WSKUP305-5620 ERROR:'                     25970000
261400                      ' SQL='                                     25980000
261500                      PV-SQL-RETURN-CD                            25990000
261600                      DELIMITED BY SIZE                           26000000
261700                      INTO PV-MSG-AREA                            26010001
261800             PERFORM 7000-WRITE-TO-LOG                            26020001
261901                                                                  26030000
261902             SET WS001-INVALID-SQL      TO TRUE                   26040000
261903             STRING 'SQL='                                        26050000
261904                  PV-SQL-RETURN-CD                                26060000
261905                  DELIMITED BY SIZE                               26070000
261906                                      INTO WS001-CRA-RET-MSG      26080000
261908             MOVE SQLCA                 TO WS001-SQLCA            26100000
261921             PERFORM 9999-ABEND                                   26191000
261922     END-EVALUATE.                                                26192000
261930*                                                                 26193000
262100/                                                                 26194000
262200 5630-OPEN-RCVR-LINE-CSR.                                         26195000
262300                                                                  26196000
262301     MOVE '5630-OPEN-RCVR-LINE-CSR'                               26197000
262302                                 TO WS001-PARAGRAPH-NAME.         26198000
262303                                                                  26199000
262400     SET PS-EOF-RCVR-LINE-CSR-NO        TO TRUE.                  26200000
263100                                                                  26210000
263200     EXEC SQL                                                     26220000
263300          OPEN RCVR-LINE-CSR                                      26230000
263400     END-EXEC.                                                    26240000
263500                                                                  26250000
263600     EVALUATE TRUE                                                26260000
263700         WHEN SQLCODE = ZERO                                      26270000
263800             IF PS-LOG-SWITCH-YES                                 26280001
263801                 INITIALIZE PV-MSG-AREA                           26290001
146767                 MOVE DK-PO-NBR          TO WS-DISPLAY-1          26291010
146767                 MOVE DK-RCVR-SEQ-NBR    TO WS-DISPLAY-2          26292010
263810                 STRING   ' ' WS001-SRC-TASK-NUMBER               26300000
263900                          ' WSKUP305-5630:'                       26310000
264000                          ' OPEN RCVR-LINE-CSR'                   26320000
264000                          ' FOR PO=' WS-DISPLAY-1                 26321010
264000                          '-' WS-DISPLAY-2                        26322010
264010                          DELIMITED BY SIZE                       26330000
264100                          INTO PV-MSG-AREA                        26340001
264200                 PERFORM 7000-WRITE-TO-LOG                        26350001
264300             END-IF                                               26360000
264400         WHEN SQLCODE = -904                                      26370000
264500         WHEN SQLCODE = -913                                      26380000
264600         WHEN SQLCODE = -911                                      26390000
264700             CONTINUE                                             26400000
264800         WHEN SQLWARN0 NOT = SPACES                               26410000
264900         WHEN SQLCODE NOT = ZERO                                  26420000
265700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       26430000
266302             INITIALIZE PV-MSG-AREA                               26440001
266303             STRING   ' ' WS001-SRC-TASK-NUMBER                   26450000
266304                      ' WSKUP305-5630 ERROR:'                     26460000
266305                      ' SQL='                                     26470000
266306                      PV-SQL-RETURN-CD                            26480000
266307                      DELIMITED BY SIZE                           26490000
266308                      INTO PV-MSG-AREA                            26500001
266309             PERFORM 7000-WRITE-TO-LOG                            26510001
267101                                                                  26520000
267102             SET WS001-INVALID-SQL      TO TRUE                   26530000
267103             STRING 'SQL='                                        26540000
267104                  PV-SQL-RETURN-CD                                26550000
267105                  DELIMITED BY SIZE                               26560000
267106                                      INTO WS001-CRA-RET-MSG      26570000
267108             MOVE SQLCA                 TO WS001-SQLCA            26590000
267118             PERFORM 9999-ABEND                                   26630000
267119     END-EVALUATE.                                                26640000
267120                                                                  26650000
267300/                                                                 26660000
267500 5640-FETCH-RCVR-LINE-CSR.                                        26670000
267501                                                                  26680000
267502     MOVE '5640-FETCH-RCVR-LINE-CSR'                              26690000
267503                                 TO WS001-PARAGRAPH-NAME.         26700000
267600                                                                  26710000
267700* GET ORD LNE/PREPK FROM TRECITM.  KEYS ARE PO/RCVR.              26720000
267800                                                                  26730000
268500     EXEC SQL                                                     26740000
268600          FETCH RCVR-LINE-CSR                                     26750000
268700          INTO                                                    26760000
268800                :RECITM-ORD-LNE-NBR                               26770000
268900              , :RECITM-PREPK-ID                                  26780000
269000     END-EXEC.                                                    26790000
269100                                                                  26800000
269200     EVALUATE TRUE                                                26810000
269300         WHEN SQLCODE = ZERO                                      26820000
269400              MOVE RECITM-ORD-LNE-NBR TO WS-PO-LNE-NBR            26830000
269500              MOVE RECITM-PREPK-ID    TO WS-PREPK-ID              26840000
269600              IF PS-LOG-SWITCH-YES                                26850001
269610                  INITIALIZE PV-MSG-AREA                          26860001
269700                  MOVE DK-PO-NBR     TO WS-DISPLAY-2              26870000
269701                  MOVE WS-PO-LNE-NBR TO WS-DISPLAY-1              26880000
269702                  MOVE WS-PREPK-ID   TO WS-DISPLAY-3              26890000
269703                  STRING   ' ' WS001-SRC-TASK-NUMBER              26900000
269710                           ' WSKUP305-5640:'                      26910000
269800                           ' PO NBR='                             26920000
269900                           WS-DISPLAY-2                           26930000
269901                           ' PO LNE NBR='                         26940000
269902                           WS-DISPLAY-1                           26950000
270000                           ' PREPK ID='                           26960000
270100                           WS-DISPLAY-3                           26970000
270110                           DELIMITED BY SIZE                      26980000
270200                           INTO PV-MSG-AREA                       26990001
270300                  PERFORM 7000-WRITE-TO-LOG                       27000001
270400              END-IF                                              27010000
270500              PERFORM 5440-CHECK-SHIP-XREF-DTL                    27020000
270600         WHEN SQLCODE = -904                                      27030000
270700         WHEN SQLCODE = -913                                      27040000
270800         WHEN SQLCODE = -911                                      27050000
270900             CONTINUE                                             27060000
271000         WHEN SQLCODE = +100                                      27070000
271100             SET PS-EOF-RCVR-LINE-CSR-YES TO TRUE                 27080000
271200         WHEN SQLWARN0 NOT = SPACES                               27090000
271300         WHEN SQLCODE NOT = ZERO                                  27100000
272100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       27110000
272702             INITIALIZE PV-MSG-AREA                               27120001
272703             STRING   ' ' WS001-SRC-TASK-NUMBER                   27130000
272900                      ' WSKUP305-5640 ERROR:'                     27140000
273000                      ' SQL='                                     27150000
273100                      PV-SQL-RETURN-CD                            27160000
273200                      DELIMITED BY SIZE                           27170000
273300                      INTO PV-MSG-AREA                            27180001
273400             PERFORM 7000-WRITE-TO-LOG                            27190001
273501                                                                  27200000
273502             SET WS001-INVALID-SQL      TO TRUE                   27210000
273503             STRING 'SQL='                                        27220000
273504                  PV-SQL-RETURN-CD                                27230000
273505                  DELIMITED BY SIZE                               27240000
273506                                      INTO WS001-CRA-RET-MSG      27250000
273508             MOVE SQLCA                 TO WS001-SQLCA            27270000
273518             PERFORM 9999-ABEND                                   27330000
273519     END-EVALUATE.                                                27340000
273520                                                                  27350000
273700/                                                                 27360000
273900 5650-CLOSE-RCVR-LINE-CSR.                                        27370000
273901                                                                  27380000
273902     MOVE '5650-CLOSE-RCVR-LINE-CSR'                              27390000
273903                                 TO WS001-PARAGRAPH-NAME.         27391000
274000                                                                  27392000
274800     EXEC SQL                                                     27393000
274900         CLOSE RCVR-LINE-CSR                                      27394000
275000     END-EXEC.                                                    27395000
275100                                                                  27396000
275200     EVALUATE TRUE                                                27397000
275300         WHEN SQLCODE = ZERO                                      27398000
275400              IF PS-LOG-SWITCH-YES                                27399001
275401                  INITIALIZE PV-MSG-AREA                          27400001
275410                  STRING   ' ' WS001-SRC-TASK-NUMBER              27410000
275500                           ' WSKUP305-5650:'                      27420000
275600                           ' CLOSE RCVR-LINE-CSR'                 27430000
275610                           DELIMITED BY SIZE                      27440000
275700                           INTO PV-MSG-AREA                       27450001
275800                  PERFORM 7000-WRITE-TO-LOG                       27460001
275900              END-IF                                              27470000
276000         WHEN SQLCODE = -904                                      27480000
276100         WHEN SQLCODE = -913                                      27490000
276200         WHEN SQLCODE = -911                                      27500000
276300             CONTINUE                                             27510000
276400         WHEN SQLWARN0 NOT = SPACES                               27520000
276500         WHEN SQLCODE NOT = ZERO                                  27530000
277300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       27540000
277902             INITIALIZE PV-MSG-AREA                               27550001
277903             STRING   ' ' WS001-SRC-TASK-NUMBER                   27560000
278100                      ' WSKUP305-5650 ERROR:'                     27570000
278200                      ' SQL='                                     27580000
278300                      PV-SQL-RETURN-CD                            27590000
278400                      DELIMITED BY SIZE                           27600000
278500                      INTO PV-MSG-AREA                            27610001
278600             PERFORM 7000-WRITE-TO-LOG                            27620001
278601                                                                  27630000
278602             SET WS001-INVALID-SQL      TO TRUE                   27640000
278603             STRING 'SQL='                                        27650000
278604                  PV-SQL-RETURN-CD                                27660000
278605                  DELIMITED BY SIZE                               27670000
278606                                      INTO WS001-CRA-RET-MSG      27680000
278608             MOVE SQLCA                 TO WS001-SQLCA            27700000
278614             PERFORM 9999-ABEND                                   27740000
278615     END-EVALUATE.                                                27750000
278620                                                                  27760000
279000     SET PS-PBS-CASE-INVALID-NO       TO TRUE.                    27770000
279100     SET PS-PACK-BY-STORE-NO          TO TRUE.                    27780000
279110                                                                  27790000
279200/                                                                 27800000
279210 5660-CHECK-FOR-CARTONS.                                          27810000
279220                                                                  27820000
279230     MOVE '5660-CHECK-FOR-CARTONS'                                27830000
279240                                 TO WS001-PARAGRAPH-NAME.         27840000
279250                                                                  27850000
279260     EXEC SQL                                                     27860000
279270          SELECT SUM(C.SHPD_QTY)                                  27870000
279280            INTO :PV-CRTN-CNT                                     27880000
279290            FROM TPKSLIP A                                        27890000
279291                ,TINPKSU B                                        27900000
279292                ,TSHUUPC C                                        27910000
279293           WHERE A.PO_NBR        = :WS-PO-NBR                     27920000
279294             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               27921000
279295             AND A.VER_STAT_CDE  = 'A'                            27922000
279296             AND A.PKSL_STAT_CDE = 'AC'                           27923000
279297             AND B.PO_NBR        = A.PO_NBR                       27924000
279298             AND B.SEQ_NBR       = A.SEQ_NBR                      27925000
279299             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 27926000
279300             AND C.TRN_NBR       = A.PO_NBR                       27927000
279302     END-EXEC.                                                    27928000
279303                                                                  27929000
279304                                                                  27930000
279305     EVALUATE TRUE                                                27930100
279306        WHEN SQLCODE = ZERO                                       27930200
279307            IF PV-CRTN-CNT  >  0                                  27930300
279308               SET PS-PBS-CARTON-DATA-YES TO TRUE                 27930400
279310            ELSE                                                  27930500
279312               SET PS-PBS-CARTON-DATA-NO  TO TRUE                 27930600
279313            END-IF                                                27930700
279314            IF PS-LOG-SWITCH-YES                                  27930801
279315                MOVE PV-CRTN-CNT          TO WS-DISPLAY-1         27930900
279316                INITIALIZE PV-MSG-AREA                            27931001
279317                STRING   ' ' WS001-SRC-TASK-NUMBER                27931100
279318                         ' WSKUP305-5660:'                        27931200
279319                         ' CRTN CNT=' WS-DISPLAY-1                27931300
279320                         DELIMITED BY SIZE                        27931400
279321                                      INTO PV-MSG-AREA            27931501
279322                PERFORM 7000-WRITE-TO-LOG                         27931601
279323            END-IF                                                27931700
279324        WHEN SQLCODE = -305                                       27931800
279325            SET PS-PBS-CARTON-DATA-NO  TO TRUE                    27931900
279328        WHEN SQLWARN0 NOT = SPACES                                27932000
279329        WHEN SQLCODE NOT = ZERO                                   27932100
279330            SET WS001-INVALID-SQL       TO TRUE                   27932200
279331            MOVE SQLCODE                TO PV-SQL-RETURN-CD       27932300
279332            STRING 'SQL='                                         27932400
279333                 PV-SQL-RETURN-CD                                 27932500
279334                 DELIMITED BY SIZE                                27932600
279335                                      INTO WS001-CRA-RET-MSG      27932700
279336            MOVE SQLCA                  TO WS001-SQLCA            27932800
279337            IF PS-LOG-SWITCH-YES                                  27932901
279338                MOVE WS-PO-NBR          TO WS-DISPLAY-PO-NBR      27933000
279339                MOVE WS-RCVR-SEQ-NBR    TO WS-DISPLAY-RCVR-NBR    27934000
279341                INITIALIZE PV-MSG-AREA                            27934101
279342                STRING   ' ' WS001-SRC-TASK-NUMBER                27934200
279343                         ' WSKUP305-5660 ERROR:'                  27934300
279344                         ' SQL='                                  27934400
279345                         PV-SQL-RETURN-CD                         27934500
279346                         ' PO= ' WS-DISPLAY-PO-NBR                27934600
279347                         ' RCVR= ' WS-DISPLAY-RCVR-NBR            27934700
279349                         DELIMITED BY SIZE                        27934800
279350                                      INTO PV-MSG-AREA            27934901
279351                PERFORM 7000-WRITE-TO-LOG                         27935001
279352            END-IF                                                27935100
279353     END-EVALUATE.                                                27935200
279354                                                                  27935300
279355/                                                                 27935400
279356 5700-CALL-DOWNLOAD-MOD.                                          27935500
279357                                                                  27935600
279358     MOVE '5700-CALL-DOWNLOAD-MOD'                                27935700
279360                                 TO WS001-PARAGRAPH-NAME.         27935800
279400                                                                  27935900
279500     INITIALIZE WS003-SHIPT-COMMAREA.                             27936000
279600     MOVE WS-TRIP-ID               TO WS003-TRIP-ID.              27937000
279700     MOVE WS-EXT-SHP-ID            TO WS003-WM-SHIPT-NBR.         27938000
279800     MOVE 'WSKUP305'               TO WS003-CALLING-PROGRAM-NAME. 27939000
279810     MOVE WS001-SRC-TASK-NUMBER    TO WS003-SRC-TASK-NUMBER.      27940000
279820     MOVE WS001-USER-ID            TO WS003-USERID.               27950000
279900     IF PS-APPT-SENT-YES                                          27960000
280000         SET WS003-APPOINTMENT-YES    TO TRUE                     27970000
280100     ELSE                                                         27980000
280200         SET WS003-APPOINTMENT-NO     TO TRUE                     27990000
280300     END-IF.                                                      28000000
279900     IF PS-CANCEL-SHPMT-YES                                       28001026
280000         SET WS003-CANCEL-SHPMT-YES   TO TRUE                     28002022
280100     ELSE                                                         28003022
280200         SET WS003-CANCEL-SHPMT-NO    TO TRUE                     28004022
280300     END-IF.                                                      28005022
280400                                                                  28010000
280401     IF PS-LOG-SWITCH-YES                                         28020001
280402         MOVE WS-TRIP-ID          TO WS-DISPLAY-1                 28030000
280403         INITIALIZE PV-MSG-AREA                                   28040001
280404         STRING   ' ' WS001-SRC-TASK-NUMBER                       28040100
280405                  ' WSKUP305-5700:'                               28040200
280406                  ' STARTING ASN DOWNLOAD PROCESS'                28040300
280407                  ' FOR SHPMT=' WS-EXT-SHP-ID                     28040400
280408                  ' TRIP=' WS-DISPLAY-1                           28040500
280409                  DELIMITED BY SIZE                               28040600
280410                                 INTO PV-MSG-AREA                 28040701
280411         PERFORM 7000-WRITE-TO-LOG                                28040801
280412     END-IF.                                                      28040900
280700                                                                  28044000
280900     CALL PC-DOWNLOAD-MOD          USING WS003-SHIPT-COMMAREA.    28045106
281210                                                                  28049000
281300/                                                                 28050000
281400 5800-CHECK-ASN.                                                  28060000
281401                                                                  28070000
281401***************************************************************   28071010
281401* CHECK-ASN - SUMMARY OF PROCESSING                               28072010
281401*   CHECK THE SHIPMENT - IF THERE ARE BOTH CASE LEVEL AND SKU     28073010
281401*   LEVEL RECEIVERS ON THE SHIPMENT, THEN THE SHIPMENT WILL       28074010
281401*   HAVE TO BE SPLIT INTO 2 SHIPMENTS - THE ORIGINAL AND A        28075010
281401*   DUMMY.                                                        28076010
281401*                                                                 28077010
281401*   THE CASE LEVEL DATA WILL BE MOVED TO THE DUMMY SHIPMENT (THE  28078010
281401*   ROWS ON THE DETAIL TABLE FOR THE ORIGINAL SHIPMENT WILL BE    28079010
281401*   SET TO INACTIVE.                                              28079110
281401*                                                                 28079210
281401*   THE SKU LEVEL DATA WILL REMAIN ON THE ORIGINAL SHIPMENT.      28079310
281401***************************************************************   28079410
281401                                                                  28079510
281402     MOVE '5800-CHECK-ASN'       TO WS001-PARAGRAPH-NAME.         28080000
281403                                                                  28090000
281500     PERFORM 5810-OPEN-HDR-CSR-2.                                 28100000
281600     PERFORM 5820-FETCH-HDR-CSR-2 UNTIL                           28110000
281700                 PS-EOF-HDR-CSR-2-YES.                            28120000
281800     PERFORM 5830-CLOSE-HDR-CSR-2.                                28130000
281900                                                                  28140000
281910/                                                                 28150000
282000 5810-OPEN-HDR-CSR-2.                                             28160000
282001                                                                  28170000
282002     MOVE '5810-OPEN-HDR-CSR-2'  TO WS001-PARAGRAPH-NAME.         28180000
282100                                                                  28190000
282200     SET PS-EOF-HDR-CSR-2-NO        TO TRUE.                      28200000
283000     EXEC SQL                                                     28210000
283100          OPEN HDR-CSR-2                                          28220000
283200     END-EXEC.                                                    28230000
283300                                                                  28240000
283400     EVALUATE TRUE                                                28250000
283500         WHEN SQLCODE = ZERO                                      28260000
283600              IF PS-LOG-SWITCH-YES                                28270001
283601                  INITIALIZE PV-MSG-AREA                          28280001
283601                  MOVE DK-TRIP-ID     TO WS-DISPLAY-1             28281010
283610                  STRING   ' ' WS001-SRC-TASK-NUMBER              28290000
283700                           ' WSKUP305-5810:'                      28300000
283800                           ' OPEN HDR-CSR-2'                      28310000
283800                           ' FOR TRIP=' WS-DISPLAY-1              28311010
283810                           DELIMITED BY SIZE                      28320000
283900                           INTO PV-MSG-AREA                       28330001
284000                  PERFORM 7000-WRITE-TO-LOG                       28340001
284100              END-IF                                              28350000
284200         WHEN SQLCODE = -904                                      28360000
284300         WHEN SQLCODE = -913                                      28370000
284400         WHEN SQLCODE = -911                                      28380000
284500             CONTINUE                                             28390000
284600         WHEN SQLWARN0 NOT = SPACES                               28400000
284700         WHEN SQLCODE NOT = ZERO                                  28410000
285500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       28420000
286102             INITIALIZE PV-MSG-AREA                               28430001
286103             STRING   ' ' WS001-SRC-TASK-NUMBER                   28440000
286300                      ' WSKUP305-5810 ERROR:'                     28450000
286400                      ' SQL='                                     28460000
286500                      PV-SQL-RETURN-CD                            28470000
286600                      DELIMITED BY SIZE                           28480000
286700                      INTO PV-MSG-AREA                            28490001
286800             PERFORM 7000-WRITE-TO-LOG                            28500001
286901                                                                  28510000
286902             SET WS001-INVALID-SQL      TO TRUE                   28520000
286903             STRING 'SQL='                                        28530000
286904                  PV-SQL-RETURN-CD                                28540000
286905                  DELIMITED BY SIZE                               28550000
286906                                      INTO WS001-CRA-RET-MSG      28560000
286908             MOVE SQLCA                 TO WS001-SQLCA            28580000
286914             PERFORM 9999-ABEND                                   28640000
286915     END-EVALUATE.                                                28650000
286920                                                                  28660000
287100/                                                                 28670000
287300 5820-FETCH-HDR-CSR-2.                                            28680000
287301                                                                  28690000
287302     MOVE '5820-FETCH-HDR-CSR-2' TO WS001-PARAGRAPH-NAME.         28700000
287400                                                                  28710000
287401* GET THE EXT-SHP-ID FOR THE ROWS ON WST_SHPMT_XREF_HDR           28720000
287402* AND WST_SHPMT_XREF_DTL.  THE KEY IS TRIP-ID.                    28730000
287403                                                                  28740000
288300     EXEC SQL                                                     28750000
288400          FETCH HDR-CSR-2                                         28760000
288500          INTO                                                    28770000
288600               :WST00001-EXT-SHP-ID                               28780000
288700     END-EXEC.                                                    28790000
288800                                                                  28800000
288900     EVALUATE TRUE                                                28810000
289000         WHEN SQLCODE = ZERO                                      28820000
289100              MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID           28830000
289200              IF PS-LOG-SWITCH-YES                                28840001
289210                  INITIALIZE PV-MSG-AREA                          28850001
289300                  STRING   ' ' WS001-SRC-TASK-NUMBER              28860000
289310                           ' WSKUP305-5820:'                      28870000
289400                           ' SHPMT='                              28880000
289500                           DK-EXT-SHP-ID                          28890000
289510                           DELIMITED BY SIZE                      28900000
289600                           INTO PV-MSG-AREA                       28910001
289700                  PERFORM 7000-WRITE-TO-LOG                       28920001
289800              END-IF                                              28930000
289900              PERFORM 5840-OPEN-SKU-CSR                           28940000
290000              PERFORM 5845-FETCH-SKU-CSR UNTIL                    28950000
290010                  PS-EOF-SKU-CSR-YES                              28960000
290100              PERFORM 5850-CLOSE-SKU-CSR                          28970000
290200         WHEN SQLCODE = -904                                      28980000
290300         WHEN SQLCODE = -913                                      28990000
290400         WHEN SQLCODE = -911                                      29000000
290500              CONTINUE                                            29010000
290600         WHEN SQLCODE = +100                                      29020000
290700              SET PS-EOF-HDR-CSR-2-YES TO TRUE                    29030000
290800         WHEN SQLWARN0 NOT = SPACES                               29040000
290900         WHEN SQLCODE NOT = ZERO                                  29050000
291700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       29060000
292302             INITIALIZE PV-MSG-AREA                               29070001
292303             STRING   ' ' WS001-SRC-TASK-NUMBER                   29080000
292500                      ' WSKUP305-5820 ERROR:'                     29090000
292600                      ' SQL='                                     29100000
292700                      PV-SQL-RETURN-CD                            29110000
292800                      DELIMITED BY SIZE                           29120000
292900                      INTO PV-MSG-AREA                            29130001
293000             PERFORM 7000-WRITE-TO-LOG                            29140001
293101                                                                  29150000
293102             SET WS001-INVALID-SQL      TO TRUE                   29160000
293103             STRING 'SQL='                                        29170000
293104                  PV-SQL-RETURN-CD                                29180000
293105                  DELIMITED BY SIZE                               29190000
293106                                      INTO WS001-CRA-RET-MSG      29200000
293108             MOVE SQLCA                 TO WS001-SQLCA            29220000
293114             PERFORM 9999-ABEND                                   29280000
293115     END-EVALUATE.                                                29290000
293120                                                                  29300000
293300/                                                                 29310000
293500 5830-CLOSE-HDR-CSR-2.                                            29320000
293501                                                                  29330000
293502     MOVE '5830-CLOSE-HDR-CSR-2' TO WS001-PARAGRAPH-NAME.         29340000
293600                                                                  29350000
294400     EXEC SQL                                                     29360000
294500          CLOSE HDR-CSR-2                                         29370000
294600     END-EXEC.                                                    29380000
294700                                                                  29390000
294800     EVALUATE TRUE                                                29400000
294900         WHEN SQLCODE = ZERO                                      29410000
295000              IF PS-LOG-SWITCH-YES                                29420001
295001                  INITIALIZE PV-MSG-AREA                          29430001
295010                  STRING   ' ' WS001-SRC-TASK-NUMBER              29440000
295100                           ' WSKUP305-5830:'                      29450000
295200                           ' CLOSE HDR-CSR-2'                     29460000
295210                           DELIMITED BY SIZE                      29470000
295300                           INTO PV-MSG-AREA                       29480001
295400                  PERFORM 7000-WRITE-TO-LOG                       29490001
295500              END-IF                                              29500000
295600         WHEN SQLCODE = -904                                      29510000
295700         WHEN SQLCODE = -913                                      29520000
295800         WHEN SQLCODE = -911                                      29530000
295900              CONTINUE                                            29540000
296000         WHEN SQLWARN0 NOT = SPACES                               29550000
296100         WHEN SQLCODE NOT = ZERO                                  29560000
296900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       29570000
297502             INITIALIZE PV-MSG-AREA                               29580001
297503             STRING   ' ' WS001-SRC-TASK-NUMBER                   29590000
297700                      ' WSKUP305-5830 ERROR:'                     29600000
297800                      ' SQL='                                     29610000
297900                      PV-SQL-RETURN-CD                            29620000
298000                      DELIMITED BY SIZE                           29630000
298100                      INTO PV-MSG-AREA                            29640001
298200             PERFORM 7000-WRITE-TO-LOG                            29650001
298201                                                                  29660000
298202             SET WS001-INVALID-SQL      TO TRUE                   29670000
298203             STRING 'SQL='                                        29680000
298204                  PV-SQL-RETURN-CD                                29690000
298205                  DELIMITED BY SIZE                               29700000
298206                                      INTO WS001-CRA-RET-MSG      29710000
298208             MOVE SQLCA                 TO WS001-SQLCA            29730000
298214             PERFORM 9999-ABEND                                   29790000
298215     END-EVALUATE.                                                29800000
298220                                                                  29810000
298500/                                                                 29820000
298600 5840-OPEN-SKU-CSR.                                               29830000
298700                                                                  29840000
298710     MOVE '5840-OPEN-SKU-CSR'    TO WS001-PARAGRAPH-NAME.         29850000
298800     SET PS-EOF-SKU-CSR-NO        TO TRUE.                        29860000
298900                                                                  29870000
299600     EXEC SQL                                                     29880000
299700          OPEN SKU-CSR                                            29890000
299800     END-EXEC.                                                    29900000
299900                                                                  29910000
300000     EVALUATE TRUE                                                29920000
300100         WHEN SQLCODE = ZERO                                      29930000
300200              IF PS-LOG-SWITCH-YES                                29940001
300201                  INITIALIZE PV-MSG-AREA                          29950001
300210                  STRING   ' ' WS001-SRC-TASK-NUMBER              29960000
300300                           ' WSKUP305-5840:'                      29970000
300400                           ' OPEN SKU-CSR'                        29980000
300410                           DELIMITED BY SIZE                      29990000
300500                           INTO PV-MSG-AREA                       30000001
300600                  PERFORM 7000-WRITE-TO-LOG                       30010001
300700              END-IF                                              30020000
300800         WHEN SQLCODE = -904                                      30030000
300900         WHEN SQLCODE = -913                                      30040000
301000         WHEN SQLCODE = -911                                      30050000
301100              CONTINUE                                            30060000
301200         WHEN SQLWARN0 NOT = SPACES                               30070000
301300         WHEN SQLCODE NOT = ZERO                                  30080000
302100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       30090000
302702             INITIALIZE PV-MSG-AREA                               30100001
302703             STRING   ' ' WS001-SRC-TASK-NUMBER                   30110000
302900                      ' WSKUP305-5840 ERROR:'                     30120000
303000                      ' SQL='                                     30130000
303100                      PV-SQL-RETURN-CD                            30140000
303200                      DELIMITED BY SIZE                           30150000
303300                      INTO PV-MSG-AREA                            30160001
303400             PERFORM 7000-WRITE-TO-LOG                            30170001
303501                                                                  30180000
303502             SET WS001-INVALID-SQL      TO TRUE                   30190000
303503             STRING 'SQL='                                        30200000
303504                  PV-SQL-RETURN-CD                                30210000
303505                  DELIMITED BY SIZE                               30220000
303506                                      INTO WS001-CRA-RET-MSG      30230000
303508             MOVE SQLCA                 TO WS001-SQLCA            30250000
303514             PERFORM 9999-ABEND                                   30310000
303515     END-EVALUATE.                                                30320000
303520                                                                  30330000
303700/                                                                 30340000
303900 5845-FETCH-SKU-CSR.                                              30350000
303901                                                                  30360000
303902     MOVE '5845-FETCH-SKU-CSR'   TO WS001-PARAGRAPH-NAME.         30370000
304000                                                                  30380000
304001* FOR THE EXT_SHP_ID RETRIEVED IN HDR-CSR-2, GET THE DETAIL ROWS  30390000
304002* FROM WST_SHPMT_XREF_DTL, ALONG WITH THE PO-NBR, AND SKU-NBR.    30400000
304003                                                                  30400100
304004* THEN CALL 5855 TO GET THE DISTINCT ASN LVL CDES.  IF MORE THAN 130400200
304005* ASN LVL CDE, IT MEANS THAT THE SKU-NBR IS IN BOTH CASES & PACKS.30400300
304006* WE ONLY WANT TO PROCESS THE ONES THAT ARE IN BOTH               30400400
304007                                                                  30400500
305501     EXEC SQL                                                     30400600
305502          FETCH SKU-CSR                                           30400700
305503          INTO                                                    30400800
305504                :WST00002-PO-NBR                                  30400900
305505              , :XLT00003-SKU-NBR                                 30401000
305506     END-EXEC.                                                    30402000
305600                                                                  30403000
305700     EVALUATE TRUE                                                30404000
305800         WHEN SQLCODE = ZERO                                      30405000
305900              MOVE XLT00003-SKU-NBR TO DK-SKU-NBR                 30406000
305910              MOVE WST00002-PO-NBR  TO DK-PO-NBR                  30407000
306000              IF PS-LOG-SWITCH-YES                                30408001
306100                  MOVE DK-SKU-NBR TO WS-DISPLAY-1                 30409000
306101                  INITIALIZE PV-MSG-AREA                          30410001
306102                  STRING   ' ' WS001-SRC-TASK-NUMBER              30420000
306110                           ' WSKUP305-5845:'                      30430000
306200                           ' SKU NBR='                            30440000
306300                           WS-DISPLAY-1                           30450000
306310                           DELIMITED BY SIZE                      30460000
306400                           INTO PV-MSG-AREA                       30470001
306500                  PERFORM 7000-WRITE-TO-LOG                       30480001
306600              END-IF                                              30490000
306601              PERFORM 5855-COUNT-ASN-FOR-SKU                      30500000
306602*             IF PV-CNT-CURSOR > 1                                30510000
306603              IF PS-MULT-ASN-YES                                  30520000
306700                  PERFORM 5860-OPEN-DTL-CSR-1                     30530000
306800                  PERFORM 5865-FETCH-DTL-CSR-1 UNTIL              30540000
306810                      PS-EOF-DTL-CSR-1-YES                        30550000
306900                  PERFORM 5870-CLOSE-DTL-CSR-1                    30560000
306910              END-IF                                              30570000
307000         WHEN SQLCODE = -904                                      30580000
307100         WHEN SQLCODE = -913                                      30590000
307200         WHEN SQLCODE = -911                                      30600000
307300              CONTINUE                                            30610000
307400         WHEN SQLCODE = +100                                      30620000
307500              SET PS-EOF-SKU-CSR-YES TO TRUE                      30630000
307600         WHEN SQLWARN0 NOT = SPACES                               30640000
307700         WHEN SQLCODE NOT = ZERO                                  30650000
308500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       30660000
309102             INITIALIZE PV-MSG-AREA                               30670001
309103             STRING   ' ' WS001-SRC-TASK-NUMBER                   30680000
309300                      ' WSKUP305-5845 ERROR:'                     30690000
309400                      ' SQL='                                     30700000
309500                      PV-SQL-RETURN-CD                            30710000
309600                      DELIMITED BY SIZE                           30720000
309700                      INTO PV-MSG-AREA                            30730001
309800             PERFORM 7000-WRITE-TO-LOG                            30740001
309901                                                                  30750000
309902             SET WS001-INVALID-SQL      TO TRUE                   30760000
309903             STRING 'SQL='                                        30770000
309904                  PV-SQL-RETURN-CD                                30780000
309905                  DELIMITED BY SIZE                               30790000
309906                                      INTO WS001-CRA-RET-MSG      30800000
309908             MOVE SQLCA                 TO WS001-SQLCA            30820000
309921             PERFORM 9999-ABEND                                   30920000
309922     END-EVALUATE.                                                30930000
309930                                                                  30940000
310100/                                                                 30950000
310300 5850-CLOSE-SKU-CSR.                                              30960000
310301                                                                  30970000
310302     MOVE '5850-CLOSE-SKU-CSR'   TO WS001-PARAGRAPH-NAME.         30980000
310400                                                                  30990000
311200     EXEC SQL                                                     31000000
311300          CLOSE SKU-CSR                                           31010000
311400     END-EXEC.                                                    31020000
311500                                                                  31030000
311600     EVALUATE TRUE                                                31040000
311700         WHEN SQLCODE = ZERO                                      31050000
311800              IF PS-LOG-SWITCH-YES                                31060001
311801                  INITIALIZE PV-MSG-AREA                          31070001
311810                  STRING   ' ' WS001-SRC-TASK-NUMBER              31080000
311900                           ' WSKUP305-5850:'                      31090000
312000                           ' CLOSE SKU-CSR'                       31100000
312110                           DELIMITED BY SIZE                      31110000
312120                           INTO PV-MSG-AREA                       31120001
312200                  PERFORM 7000-WRITE-TO-LOG                       31130001
312300              END-IF                                              31140000
312400         WHEN SQLCODE = -904                                      31150000
312500         WHEN SQLCODE = -913                                      31160000
312600         WHEN SQLCODE = -911                                      31170000
312700              CONTINUE                                            31180000
312800         WHEN SQLWARN0 NOT = SPACES                               31190000
312900         WHEN SQLCODE NOT = ZERO                                  31200000
313700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31210000
314302             INITIALIZE PV-MSG-AREA                               31220001
314303             STRING   ' ' WS001-SRC-TASK-NUMBER                   31230000
314500                      ' WSKUP305-5850 ERROR:'                     31240000
314600                      ' SQL='                                     31250000
314700                      PV-SQL-RETURN-CD                            31260000
314800                      DELIMITED BY SIZE                           31270000
314900                      INTO PV-MSG-AREA                            31280001
315000             PERFORM 7000-WRITE-TO-LOG                            31290001
315101                                                                  31300000
315102             SET WS001-INVALID-SQL      TO TRUE                   31310000
315103             STRING 'SQL='                                        31320000
315104                  PV-SQL-RETURN-CD                                31330000
315105                  DELIMITED BY SIZE                               31340000
315106                                      INTO WS001-CRA-RET-MSG      31350000
315108             MOVE SQLCA                 TO WS001-SQLCA            31370000
315118             PERFORM 9999-ABEND                                   31410000
315119     END-EVALUATE.                                                31420000
315120                                                                  31430000
315300/                                                                 31440000
315301 5855-COUNT-ASN-FOR-SKU.                                          31450000
315302     MOVE '5855-COUNT-ASN-FOR-SKU'                                31460000
315303                                 TO WS001-PARAGRAPH-NAME.         31470000
315304                                                                  31480000
315305* GET THE DISTINCT TYPES OF ASN-LVL-CDE.  IF MORE THAN 1 ROW      31490000
315306* IS RETURNED, THEN THE SKU-NBR IS SPLIT BETWEEN CASE AND SKU     31500000
315307                                                                  31510000
315308     EXEC SQL                                                     31520000
315309        SELECT  DISTINCT                                          31530000
315310                D.ASN_LVL_CDE                                     31531000
315311        INTO   :WST00002-ASN-LVL-CDE                              31531100
315312        FROM    WST_SHPMT_XREF_DTL D                              31531200
315313              , TPURITM C                                         31531300
315314              , XLT_SKU B                                         31531400
315315        WHERE   EXT_SHP_ID       = :DK-EXT-SHP-ID                 31531500
315316        AND     D.PO_NBR         = :DK-PO-NBR                     31531600
315317        AND     B.SKU_NBR        = :DK-SKU-NBR                    31531700
315318        AND     C.ITM_NBR        = B.ITM_NBR                      31531800
315319        AND     D.PO_LNE_NBR     = C.APP_PO_LNE_NBR               31531915
315320        AND     C.VER_STATUS_CDE = 'A'                            31532000
315321     END-EXEC.                                                    31532100
315322                                                                  31532200
315323     EVALUATE TRUE                                                31532300
315324         WHEN SQLCODE = ZERO                                      31532400
315325* 1 RECORD ON TABLE - NO NEED TO PROCESS THIS ONE                 31532500
315326             SET PS-MULT-ASN-NO          TO TRUE                  31532600
315327         WHEN SQLCODE = -811                                      31532700
315328* MULTIPLE RECORDS ON TABLE - THIS NEEDS TO BE PROCESSED          31532800
315329             SET PS-MULT-ASN-YES         TO TRUE                  31532900
315330         WHEN SQLCODE = -904                                      31533000
315331         WHEN SQLCODE = -913                                      31533100
315332         WHEN SQLCODE = -911                                      31533200
315333             CONTINUE                                             31533300
315334         WHEN SQLWARN0 NOT = SPACES                               31533400
315335         WHEN SQLCODE NOT = ZERO                                  31533500
315337             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31533600
315343             INITIALIZE PV-MSG-AREA                               31533701
315344             STRING   ' ' WS001-SRC-TASK-NUMBER                   31533800
315345                      ' WSKUP305-5855 ERROR:'                     31533900
315346                      ' SQL='                                     31534000
315347                      PV-SQL-RETURN-CD                            31534100
315348                      DELIMITED BY SIZE                           31534200
315349                      INTO PV-MSG-AREA                            31534301
315350             PERFORM 7000-WRITE-TO-LOG                            31534401
315352                                                                  31534500
315353             SET WS001-INVALID-SQL      TO TRUE                   31534600
315354             STRING 'SQL='                                        31534700
315355                  PV-SQL-RETURN-CD                                31534800
315356                  DELIMITED BY SIZE                               31534900
315357                                      INTO WS001-CRA-RET-MSG      31535000
315359             MOVE SQLCA                 TO WS001-SQLCA            31535200
315372             PERFORM 9999-ABEND                                   31537100
315373     END-EVALUATE.                                                31537200
315374                                                                  31537300
315380/                                                                 31537400
315400 5860-OPEN-DTL-CSR-1.                                             31537500
315401                                                                  31537600
315402     MOVE '5860-OPEN-DTL-CSR-1'  TO WS001-PARAGRAPH-NAME.         31537700
315500                                                                  31537800
315600     SET PS-EOF-DTL-CSR-1-NO        TO TRUE.                      31537900
316300                                                                  31538000
316400     EXEC SQL                                                     31539000
316500          OPEN DTL-CSR-1                                          31540000
316600     END-EXEC.                                                    31550000
316700                                                                  31560000
316800     EVALUATE TRUE                                                31570000
316900         WHEN SQLCODE = ZERO                                      31580000
317000              IF PS-LOG-SWITCH-YES                                31590001
317001                  INITIALIZE PV-MSG-AREA                          31600001
146767                  MOVE DK-SKU-NBR         TO WS-DISPLAY-1         31601010
317010                  STRING   ' ' WS001-SRC-TASK-NUMBER              31610000
317100                           ' WSKUP305-5860:'                      31620000
317200                           ' OPEN DTL-CSR-1'                      31630000
317200                           ' FOR SHPMT=' DK-EXT-SHP-ID            31631010
317200                           ' SKU=' WS-DISPLAY-1                   31632010
317210                           DELIMITED BY SIZE                      31640000
317300                           INTO PV-MSG-AREA                       31650001
317400                  PERFORM 7000-WRITE-TO-LOG                       31660001
317500              END-IF                                              31670000
317600         WHEN SQLCODE = -904                                      31680000
317700         WHEN SQLCODE = -913                                      31690000
317800         WHEN SQLCODE = -911                                      31700000
317900              CONTINUE                                            31710000
318000         WHEN SQLWARN0 NOT = SPACES                               31720000
318100         WHEN SQLCODE NOT = ZERO                                  31730000
318900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       31740000
319502             INITIALIZE PV-MSG-AREA                               31750001
319503             STRING   ' ' WS001-SRC-TASK-NUMBER                   31760000
319700                      ' WSKUP305-5860 ERROR:'                     31770000
319800                      ' SQL='                                     31780000
319900                      PV-SQL-RETURN-CD                            31790000
320000                      DELIMITED BY SIZE                           31800000
320100                      INTO PV-MSG-AREA                            31810001
320200             PERFORM 7000-WRITE-TO-LOG                            31820001
320201                                                                  31830000
320202             SET WS001-INVALID-SQL      TO TRUE                   31840000
320203             STRING 'SQL='                                        31850000
320204                  PV-SQL-RETURN-CD                                31860000
320205                  DELIMITED BY SIZE                               31870000
320206                                      INTO WS001-CRA-RET-MSG      31880000
320208             MOVE SQLCA                 TO WS001-SQLCA            31900000
320218             PERFORM 9999-ABEND                                   31940000
320219     END-EVALUATE.                                                31950000
320220                                                                  31960000
320500/                                                                 31970000
320700 5865-FETCH-DTL-CSR-1.                                            31980000
320701                                                                  31990000
320702     MOVE '5865-FETCH-DTL-CSR-1' TO WS001-PARAGRAPH-NAME.         32000000
320800                                                                  32010000
320801* USING THE EXT-SHP-ID FROM HDR-CSR-2, AND THE SKU-NBR FROM       32020000
320802* SKU-CSR, GET THE CASE LEVEL DATA (NOT THE SKU LEVEL DATA).      32030000
320803* THE CASE DATA WILL MOVE TO A DUMMY SHIPMENT, THE SKU LEVEL      32040000
320804* WILL REMAIN ON THE ORIGINAL SHIPMENT                            32050000
320805                                                                  32060000
321700     EXEC SQL                                                     32070000
321800          FETCH DTL-CSR-1                                         32080000
321900          INTO                                                    32090000
322000                :WST00002-PO-NBR                                  32100000
322100              , :WST00002-RCVR-SEQ-NBR                            32110000
322200              , :WST00002-PO-LNE-NBR                              32120000
322300              , :WST00002-PREPK-ID                                32130000
322400     END-EXEC.                                                    32140000
322500                                                                  32150000
322600     EVALUATE TRUE                                                32160000
322700         WHEN SQLCODE = ZERO                                      32170000
322800              MOVE WST00002-PO-NBR     TO DK-PO-NBR               32180000
322900              MOVE WST00002-RCVR-SEQ-NBR TO                       32190000
323000                                           DK-RCVR-SEQ-NBR        32200000
323100              MOVE WST00002-PO-LNE-NBR TO DK-PO-LNE-NBR           32210000
323200              MOVE WST00002-PREPK-ID   TO DK-PREPK-ID             32220000
323300              IF PS-LOG-SWITCH-YES                                32230001
323400                  MOVE DK-PO-NBR       TO WS-DISPLAY-1            32240000
323401                  MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2            32250000
323402                  MOVE DK-PREPK-ID     TO WS-DISPLAY-3            32260000
323403                  MOVE DK-PO-LNE-NBR   TO WS-DISPLAY-4            32270000
323404                  INITIALIZE PV-MSG-AREA                          32280001
323405                  STRING   ' ' WS001-SRC-TASK-NUMBER              32290000
323410                           ' WSKUP305-5865:'                      32300000
323500                           ' PO NBR='                             32310000
323600                           WS-DISPLAY-1                           32320000
323700                           ' RCVR SEQ NBR='                       32330000
323800                           WS-DISPLAY-2                           32340000
323900                           ' PO LNE NBR='                         32350000
324000                           WS-DISPLAY-4                           32360000
324100                           ' PREPK ID='                           32370000
324200                           WS-DISPLAY-3                           32380000
324210                           DELIMITED BY SIZE                      32390000
324300                           INTO PV-MSG-AREA                       32400001
324400                  PERFORM 7000-WRITE-TO-LOG                       32410001
324500              END-IF                                              32420000
324600              PERFORM 5900-SPLIT-SHPMNT                           32430000
324700         WHEN SQLCODE = -904                                      32440000
324800         WHEN SQLCODE = -913                                      32450000
324900         WHEN SQLCODE = -911                                      32460000
325000              CONTINUE                                            32470000
325100         WHEN SQLCODE = +100                                      32480000
325200              SET PS-EOF-DTL-CSR-1-YES TO TRUE                    32490000
325300         WHEN SQLWARN0 NOT = SPACES                               32500000
325400         WHEN SQLCODE NOT = ZERO                                  32510000
326200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       32520000
326802             INITIALIZE PV-MSG-AREA                               32530001
326803             STRING   ' ' WS001-SRC-TASK-NUMBER                   32540000
327000                      ' WSKUP305-5865 ERROR:'                     32550000
327100                      ' SQL='                                     32560000
327200                      PV-SQL-RETURN-CD                            32570000
327300                      DELIMITED BY SIZE                           32580000
327400                      INTO PV-MSG-AREA                            32590001
327500             PERFORM 7000-WRITE-TO-LOG                            32600001
327601                                                                  32610000
327602             SET WS001-INVALID-SQL      TO TRUE                   32620000
327603             STRING 'SQL='                                        32630000
327604                  PV-SQL-RETURN-CD                                32640000
327605                  DELIMITED BY SIZE                               32650000
327606                                      INTO WS001-CRA-RET-MSG      32660000
327608             MOVE SQLCA                 TO WS001-SQLCA            32680000
327621             PERFORM 9999-ABEND                                   32762000
327622     END-EVALUATE.                                                32762100
327630                                                                  32762200
327800/                                                                 32762300
328000 5870-CLOSE-DTL-CSR-1.                                            32762400
328001                                                                  32762500
328002     MOVE '5870-CLOSE-DTL-CSR-1' TO WS001-PARAGRAPH-NAME.         32762600
328100                                                                  32762700
328900     EXEC SQL                                                     32762800
329000          CLOSE DTL-CSR-1                                         32762900
329100     END-EXEC                                                     32763000
329200                                                                  32764000
329300     EVALUATE TRUE                                                32765000
329400         WHEN SQLCODE = ZERO                                      32766000
329500              IF PS-LOG-SWITCH-YES                                32767001
329501                  INITIALIZE PV-MSG-AREA                          32768001
329510                  STRING   ' ' WS001-SRC-TASK-NUMBER              32769000
329600                           ' WSKUP305-5870:'                      32770000
329700                           ' CLOSE DTL-CSR-1'                     32780000
329710                           DELIMITED BY SIZE                      32790000
329800                           INTO PV-MSG-AREA                       32800001
329900                  PERFORM 7000-WRITE-TO-LOG                       32810001
330000              END-IF                                              32820000
330100         WHEN SQLCODE = -904                                      32830000
330200         WHEN SQLCODE = -913                                      32840000
330300         WHEN SQLCODE = -911                                      32850000
330400              CONTINUE                                            32860000
330500         WHEN SQLWARN0 NOT = SPACES                               32870000
330600         WHEN SQLCODE NOT = ZERO                                  32880000
331400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       32890000
332002             INITIALIZE PV-MSG-AREA                               32900001
332003             STRING   ' ' WS001-SRC-TASK-NUMBER                   32910000
332200                      ' WSKUP305-5870 ERROR:'                     32920000
332300                      ' SQL='                                     32930000
332400                      PV-SQL-RETURN-CD                            32940000
332500                      DELIMITED BY SIZE                           32950000
332600                      INTO PV-MSG-AREA                            32960001
332700             PERFORM 7000-WRITE-TO-LOG                            32970001
332801                                                                  32980000
332802             SET WS001-INVALID-SQL      TO TRUE                   32990000
332803             STRING 'SQL='                                        33000000
332804                  PV-SQL-RETURN-CD                                33010000
332805                  DELIMITED BY SIZE                               33020000
332806                                      INTO WS001-CRA-RET-MSG      33030000
332808             MOVE SQLCA                 TO WS001-SQLCA            33050000
332818             PERFORM 9999-ABEND                                   33090000
332819     END-EVALUATE.                                                33100000
332820                                                                  33110000
333000/                                                                 33120000
333100 5900-SPLIT-SHPMNT.                                               33130000
333101                                                                  33140000
333102     MOVE '5900-SPLIT-SHPMNT'    TO WS001-PARAGRAPH-NAME.         33150000
333103                                                                  33160000
333200     PERFORM 5910-OPEN-ACTIVE-REC-CSR.                            33170000
333300     PERFORM 5920-FETCH-ACTIVE-REC-CSR UNTIL                      33180000
333400                 PS-EOF-ACTIVE-REC-CSR-YES.                       33190000
333500     PERFORM 5930-CLOSE-ACTIVE-REC-CSR.                           33200000
333600                                                                  33210000
333610/                                                                 33220000
333700 5910-OPEN-ACTIVE-REC-CSR.                                        33230000
333701                                                                  33240000
333702     MOVE '5910-OPEN-ACTIVE-REC-CSR'                              33250000
333703                                 TO WS001-PARAGRAPH-NAME.         33260000
333800                                                                  33270000
333900     SET PS-EOF-ACTIVE-REC-CSR-NO        TO TRUE.                 33280000
334000     SET PS-FIRST-RECORD-YES             TO TRUE.                 33290000
334600                                                                  33300000
334700     EXEC SQL                                                     33310000
334800          OPEN ACTIVE-REC-CSR                                     33320000
334900     END-EXEC                                                     33330000
335000                                                                  33340000
335100     EVALUATE TRUE                                                33350000
335200         WHEN SQLCODE = ZERO                                      33360000
335300              IF PS-LOG-SWITCH-YES                                33370001
335301                  INITIALIZE PV-MSG-AREA                          33380001
146767                  MOVE DK-PO-NBR          TO WS-DISPLAY-1         33381010
146767                  MOVE DK-PREPK-ID        TO WS-DISPLAY-3         33382010
335310                  STRING   ' ' WS001-SRC-TASK-NUMBER              33390000
335400                           ' WSKUP305-5910:'                      33400000
335500                           ' OPEN ACTIVE-REC-CSR'                 33410000
335500                           ' FOR SHPMT=' DK-EXT-SHP-ID            33411010
335500                           ' PO=' WS-DISPLAY-1                    33412010
335500                           ' PREPK=' WS-DISPLAY-3                 33413010
335510                           DELIMITED BY SIZE                      33420000
335600                           INTO PV-MSG-AREA                       33430001
335700                  PERFORM 7000-WRITE-TO-LOG                       33440001
335800              END-IF                                              33450000
335900         WHEN SQLCODE = -904                                      33460000
336000         WHEN SQLCODE = -913                                      33470000
336100         WHEN SQLCODE = -911                                      33480000
336200              CONTINUE                                            33490000
336300         WHEN SQLWARN0 NOT = SPACES                               33500000
336400         WHEN SQLCODE NOT = ZERO                                  33510000
337200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       33520000
337802             INITIALIZE PV-MSG-AREA                               33530001
337803             STRING   ' ' WS001-SRC-TASK-NUMBER                   33540000
338000                      ' WSKUP305-5910 ERROR:'                     33550000
338100                      ' SQL='                                     33560000
338200                      PV-SQL-RETURN-CD                            33570000
338300                      DELIMITED BY SIZE                           33580000
338400                      INTO PV-MSG-AREA                            33590001
338500             PERFORM 7000-WRITE-TO-LOG                            33600001
338601                                                                  33610000
338602             SET WS001-INVALID-SQL      TO TRUE                   33620000
338603             STRING 'SQL='                                        33630000
338604                  PV-SQL-RETURN-CD                                33640000
338605                  DELIMITED BY SIZE                               33650000
338606                                      INTO WS001-CRA-RET-MSG      33660000
338608             MOVE SQLCA                 TO WS001-SQLCA            33680000
338612             PERFORM 9999-ABEND                                   33720000
338613     END-EVALUATE.                                                33730000
338620                                                                  33740000
338800/                                                                 33750000
339000 5920-FETCH-ACTIVE-REC-CSR.                                       33760000
339001                                                                  33770000
339002     MOVE '5920-FETCH-ACTIVE-REC-CSR'                             33780000
339003                                 TO WS001-PARAGRAPH-NAME.         33790000
339004                                                                  33800000
339005* GET PO/RCVR/LNE/PREPK FROM WST_SHPMT_XREF_DTL.                  33810000
339006* KEYS ARE EXT-SHIP-ID/PO/PREPK/RCVR.                             33820000
339100                                                                  33830000
340000     EXEC SQL                                                     33840000
340100          FETCH ACTIVE-REC-CSR                                    33850000
340200          INTO                                                    33860000
340300                :WST00002-PO-NBR                                  33870000
340400              , :WST00002-RCVR-SEQ-NBR                            33880000
340500              , :WST00002-PO-LNE-NBR                              33890000
340510              , :WST00002-PREPK-ID                                33900000
340600     END-EXEC.                                                    33910000
340700                                                                  33920000
340800     EVALUATE TRUE                                                33930000
340900         WHEN SQLCODE = ZERO                                      33940000
341100              MOVE WST00002-PO-NBR          TO WS-PO-NBR          33950000
341200              MOVE WST00002-RCVR-SEQ-NBR    TO WS-RCVR-SEQ-NBR    33960000
341400              MOVE WST00002-PO-LNE-NBR      TO WS-PO-LNE-NBR      33970000
341401              MOVE WST00002-PREPK-ID        TO WS-PREPK-ID        33980000
341402                                                                  33990000
341600              IF PS-LOG-SWITCH-YES                                34000001
341610                  INITIALIZE PV-MSG-AREA                          34010001
341700                  MOVE WS-PO-NBR TO WS-DISPLAY-1                  34020000
341701                  MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2            34030000
341702                  MOVE WS-PO-LNE-NBR TO WS-DISPLAY-4              34040000
341703                  STRING   ' ' WS001-SRC-TASK-NUMBER              34050000
341710                               ' WSKUP305-5920:'                  34060000
341800                               ' PO NBR='                         34070000
341900                               WS-DISPLAY-1                       34080000
342000                               ' RCVR SEQ NBR='                   34090000
342100                               WS-DISPLAY-2                       34100000
342200                               ' PO LNE NBR='                     34110000
342300                               WS-DISPLAY-4                       34120000
342310                               DELIMITED BY SIZE                  34130000
342400                               INTO PV-MSG-AREA                   34140001
342500                  PERFORM 7000-WRITE-TO-LOG                       34150001
343000              END-IF                                              34160000
343001              IF PS-FIRST-DUMMY-REC-YES                           34170000
343002                  MOVE DK-EXT-SHP-ID        TO WS-OLD-EXT-SHP-ID  34180000
343003                  MOVE 'N'                  TO WS-DWNLD-CDE       34190000
343004                  SET PS-DUMMY-HEADER-YES   TO TRUE               34200000
343005                  PERFORM 5000-INSERT-HEADER                      34210000
343006                  SET PS-FIRST-DUMMY-REC-NO TO TRUE               34220000
343006                  SET PS-ASN-NEW-HDR-YES    TO TRUE               34221010
343007                  MOVE WS-EXT-SHP-ID        TO WS-NEW-EXT-SHP-ID  34230000
343008              END-IF                                              34240000
343009              MOVE WS-NEW-EXT-SHP-ID        TO DK-EXT-SHP-ID      34250000
343100              PERFORM 5100-INSERT-DETAIL                          34260000
343110              MOVE WS-OLD-EXT-SHP-ID        TO DK-EXT-SHP-ID      34270000
343200              PERFORM 5940-UPDATE-DETAIL                          34280000
343300         WHEN SQLCODE = -904                                      34290000
343400         WHEN SQLCODE = -913                                      34300000
343500         WHEN SQLCODE = -911                                      34310000
343600              CONTINUE                                            34320000
343700         WHEN SQLCODE = +100                                      34330000
343800              SET PS-EOF-ACTIVE-REC-CSR-YES TO TRUE               34340000
343900         WHEN SQLWARN0 NOT = SPACES                               34350000
344000         WHEN SQLCODE NOT = ZERO                                  34360000
344800             MOVE SQLCODE               TO PV-SQL-RETURN-CD       34370000
345402             INITIALIZE PV-MSG-AREA                               34380001
345403             STRING   ' ' WS001-SRC-TASK-NUMBER                   34390000
345600                      ' WSKUP305-5920 ERROR:'                     34400000
345700                      ' SQL='                                     34410000
345800                      PV-SQL-RETURN-CD                            34420000
345900                      DELIMITED BY SIZE                           34430000
346000                      INTO PV-MSG-AREA                            34440001
346100             PERFORM 7000-WRITE-TO-LOG                            34450001
346201                                                                  34460000
346202             SET WS001-INVALID-SQL      TO TRUE                   34470000
346203             STRING 'SQL='                                        34480000
346204                  PV-SQL-RETURN-CD                                34490000
346205                  DELIMITED BY SIZE                               34500000
346206                                      INTO WS001-CRA-RET-MSG      34510000
346208             MOVE SQLCA                 TO WS001-SQLCA            34530000
346218             PERFORM 9999-ABEND                                   34590000
346219     END-EVALUATE.                                                34600000
346220                                                                  34610000
346400/                                                                 34620000
346600 5930-CLOSE-ACTIVE-REC-CSR.                                       34630000
346601                                                                  34640000
346602     MOVE '5930-CLOSE-ACTIVE-REC-CSR'                             34650000
346603                                 TO WS001-PARAGRAPH-NAME.         34660000
346700                                                                  34670000
347500     EXEC SQL                                                     34680000
347600          CLOSE ACTIVE-REC-CSR                                    34690000
347700     END-EXEC.                                                    34700000
347800                                                                  34710000
347900     EVALUATE TRUE                                                34720000
348000         WHEN SQLCODE = ZERO                                      34730000
348100              IF PS-LOG-SWITCH-YES                                34740001
348101                  INITIALIZE PV-MSG-AREA                          34750001
348110                  STRING   ' ' WS001-SRC-TASK-NUMBER              34760000
348200                           ' WSKUP305-5930:'                      34770000
348300                           ' CLOSE ACTIVE-REC-CSR'                34780000
348310                           DELIMITED BY SIZE                      34790000
348400                           INTO PV-MSG-AREA                       34800001
348500                  PERFORM 7000-WRITE-TO-LOG                       34810001
348600              END-IF                                              34820000
348700         WHEN SQLCODE = -904                                      34830000
348800         WHEN SQLCODE = -913                                      34840000
348900         WHEN SQLCODE = -911                                      34850000
349000              CONTINUE                                            34860000
349100         WHEN SQLWARN0 NOT = SPACES                               34870000
349200         WHEN SQLCODE NOT = ZERO                                  34880000
350000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       34890000
350602             INITIALIZE PV-MSG-AREA                               34900001
350603             STRING   ' ' WS001-SRC-TASK-NUMBER                   34910000
350800                      ' WSKUP305-5930 ERROR:'                     34920000
350900                      ' SQL='                                     34930000
351000                      PV-SQL-RETURN-CD                            34940000
351100                      DELIMITED BY SIZE                           34950000
351200                      INTO PV-MSG-AREA                            34960001
351300             PERFORM 7000-WRITE-TO-LOG                            34970001
351401                                                                  34980000
351402             SET WS001-INVALID-SQL      TO TRUE                   34990000
351403             STRING 'SQL='                                        35000000
351404                  PV-SQL-RETURN-CD                                35010000
351405                  DELIMITED BY SIZE                               35020000
351406                                      INTO WS001-CRA-RET-MSG      35030000
351408             MOVE SQLCA                 TO WS001-SQLCA            35050000
351414             PERFORM 9999-ABEND                                   35090000
351415     END-EVALUATE.                                                35100000
351420                                                                  35110000
351600/                                                                 35120000
351700 5940-UPDATE-DETAIL.                                              35130000
351800                                                                  35140000
351801     MOVE '5940-UPDATE-DETAIL'   TO WS001-PARAGRAPH-NAME.         35150000
351802                                                                  35160000
352600     EXEC SQL                                                     35170000
352700          UPDATE WST_SHPMT_XREF_DTL                               35180000
352800             SET   ACTV_CDE       = 'I'                           35190000
352900           WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                35200000
353000             AND   PO_NBR         = :WS-PO-NBR                    35210000
353010             AND   PO_LNE_NBR     = :WS-PO-LNE-NBR                35220000
353100             AND   RCVR_SEQ_NBR   = :WS-RCVR-SEQ-NBR              35230000
353200             AND   PREPK_ID       = :WS-PREPK-ID                  35240000
353300             AND   ACTV_CDE       = 'A'                           35250000
353400     END-EXEC.                                                    35260000
353500                                                                  35270000
353600     EVALUATE TRUE                                                35280000
353700         WHEN SQLCODE = ZERO                                      35290000
353800              IF PS-LOG-SWITCH-YES                                35300001
353900                  MOVE DK-PO-NBR       TO WS-DISPLAY-1            35310000
353901                  MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2            35320000
353902                  MOVE DK-PREPK-ID     TO WS-DISPLAY-3            35330000
353903                 INITIALIZE PV-MSG-AREA                           35340001
353904                  STRING   ' ' WS001-SRC-TASK-NUMBER              35350000
353910                           ' WSKUP305-5940:'                      35360000
354000                           ' UPDATE WST_SHPMT_XREF_DTL'           35370023
354100                           ' FOR SHPMT='                          35380000
354200                           DK-EXT-SHP-ID                          35390000
354300                           ' PO NBR='                             35400000
354400                           WS-DISPLAY-1                           35410000
354500                           ' RCVR SEQ NBR='                       35420000
354600                           WS-DISPLAY-2                           35430000
354700                           ' PREPK ID='                           35440000
354800                           WS-DISPLAY-3                           35450000
354810                           DELIMITED BY SIZE                      35460000
354900                           INTO PV-MSG-AREA                       35470001
355000                  PERFORM 7000-WRITE-TO-LOG                       35480001
355100              END-IF                                              35490000
355200         WHEN SQLCODE = -904                                      35500000
355300         WHEN SQLCODE = -913                                      35510000
355400         WHEN SQLCODE = -911                                      35520000
355500              CONTINUE                                            35530000
355600         WHEN SQLWARN0 NOT = SPACES                               35540000
355700         WHEN SQLCODE NOT = ZERO                                  35550000
356500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       35560000
357102             INITIALIZE PV-MSG-AREA                               35570001
357103             STRING   ' ' WS001-SRC-TASK-NUMBER                   35580000
357300                      ' WSKUP305-5940 ERROR:'                     35590000
357400                      ' SQL='                                     35600000
357500                      PV-SQL-RETURN-CD                            35610000
357600                      DELIMITED BY SIZE                           35620000
357700                      INTO PV-MSG-AREA                            35630001
357800             PERFORM 7000-WRITE-TO-LOG                            35640001
357801                                                                  35650000
357802             SET WS001-INVALID-SQL      TO TRUE                   35660000
357803             STRING 'SQL='                                        35670000
357804                  PV-SQL-RETURN-CD                                35680000
357805                  DELIMITED BY SIZE                               35690000
357806                                      INTO WS001-CRA-RET-MSG      35700000
357808             MOVE SQLCA                 TO WS001-SQLCA            35720000
357814             PERFORM 9999-ABEND                                   35780000
357815     END-EVALUATE.                                                35781000
357820                                                                  35782000
358100/                                                                 35783000
358200 6000-CREATE-RANDOM-NBR.                                          35784000
358201                                                                  35785000
358202     MOVE '6000-CREATE-RANDOM-NBR'                                35786000
358203                                 TO WS001-PARAGRAPH-NAME.         35787000
358300                                                                  35788000
358400     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     35789000
358800     CALL PC-RANDOM-NBR-GENERATOR USING                           35820005
358800                            DP902-RANDNBR-ROUTINE-FIELDS.         35820105
358800                                                                  35821005
358900     IF DP902-SUCCESSFUL                                          35830000
359000         CONTINUE                                                 35840000
359100     ELSE                                                         35850000
359200         SET WS001-ERROR              TO TRUE                     35860000
359500         STRING 'DP902-RETURN-CODE='                              35870000
359600                DP902-RETURN-CODE                                 35880000
359700                DELIMITED BY SIZE                                 35890000
359800                                    INTO WS001-CRA-RET-MSG        35900000
359810         MOVE SQLCA                   TO WS001-SQLCA              35910000
359900     END-IF.                                                      35920000
360100                                                                  35930000
360110/                                                                 35940000
360200 7000-WRITE-TO-LOG.                                               35950001
360201                                                                  35960000
360202     MOVE '7000-WRITE-TO-LOG'                                     35970001
360203                                 TO WS001-PARAGRAPH-NAME.         35980000
361100                                                                  36080000
361100     DISPLAY PV-MSG-AREA.                                         36081001
361200     MOVE SPACES TO PV-MSG-AREA.                                  36090001
361210                                                                  36100000
361220/                                                                 36110000
361221 8000-CREATE-DUMMY.                                               36120000
361222                                                                  36121000
361223* GET ORIGINAL SHIPMENT                                           36122000
361224* ADD DUMMY SHIPMENT HEADER RECORD WITH DWNLD-CDE = P             36122100
361225* CHG ORIGINAL SHIPMENT HEADER TO HAVE DWNLD-CDE = C              36122200
361226* FOR EACH DETAIL RECORD WHERE THE DWNLD-CDE NOT = D              36122300
361227*     ADD DETAIL RECORD TO DUMMY SHIPMENT                         36122400
361228*     INACTIVATE DETAIL RECORD FOR ORIGINAL SHIPMENT              36122500
361229* SET IMMED-DWNLD-SWITCH, SO THAT THE DOWNLOAD MOD IS CALLED      36122600
361230                                                                  36122700
361231     PERFORM 8040-GET-HDR-INFO.                                   36122800
361240                                                                  36122900
361260     SET PS-DUMMY-HEADER-YES    TO TRUE.                          36123000
361261     MOVE 'P'                   TO WS-DWNLD-CDE.                  36124000
361270     PERFORM 5000-INSERT-HEADER.                                  36125000
361271     PERFORM 8060-UPDATE-HDR-REC.                                 36126000
361280                                                                  36127000
361282     PERFORM 8010-OPEN-DUMMY-CSR.                                 36128000
361283     PERFORM 8020-FETCH-DUMMY-CSR UNTIL                           36128100
361284             PS-EOF-DUMMY-CSR-YES.                                36128200
361285     PERFORM 8030-CLOSE-DUMMY-CSR.                                36128300
361286                                                                  36128400
361287     SET PS-IMMED-DOWNLOAD-YES  TO TRUE.                          36128500
361288     SET PS-CHECK-ASN-NO        TO TRUE.                          36128600
361290                                                                  36128700
361291/                                                                 36128800
361292 8010-OPEN-DUMMY-CSR.                                             36128900
361293                                                                  36129000
361294     MOVE '8010-OPEN-DUMMY-CSR'                                   36129100
361295                                 TO WS001-PARAGRAPH-NAME.         36129200
361296                                                                  36129300
361298     SET PS-EOF-DUMMY-CSR-NO          TO TRUE.                    36129400
361299                                                                  36129500
361300     EXEC SQL                                                     36129600
361301          OPEN DUMMY-CSR                                          36129700
361302     END-EXEC.                                                    36129800
361303                                                                  36129900
361304     EVALUATE TRUE                                                36130000
361305         WHEN SQLCODE = ZERO                                      36130100
361306             IF PS-LOG-SWITCH-YES                                 36130201
361307                 INITIALIZE PV-MSG-AREA                           36130301
361308                 STRING   ' ' WS001-SRC-TASK-NUMBER               36130400
361309                          ' WSKUP305-8010:'                       36130500
361310                          ' OPENED DUMMY-CSR'                     36130600
361311                          DELIMITED BY SIZE                       36130700
361312                          INTO PV-MSG-AREA                        36130801
361313                 PERFORM 7000-WRITE-TO-LOG                        36130901
361314             END-IF                                               36131000
361315         WHEN SQLCODE = -904                                      36131100
361316         WHEN SQLCODE = -913                                      36131200
361317         WHEN SQLCODE = -911                                      36131300
361318              CONTINUE                                            36131400
361319         WHEN SQLWARN0 NOT = SPACES                               36131500
361320         WHEN SQLCODE NOT = ZERO                                  36131600
361321             INITIALIZE PV-MSG-AREA                               36131701
361322             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36131800
361323             STRING   ' ' WS001-SRC-TASK-NUMBER                   36131900
361324                      ' WSKUP305-8010 ERROR:'                     36132000
361325                      ' SQL='                                     36132100
361326                      PV-SQL-RETURN-CD                            36132200
361327                      DELIMITED BY SIZE                           36132300
361328                      INTO PV-MSG-AREA                            36132401
361329             PERFORM 7000-WRITE-TO-LOG                            36132501
361330                                                                  36132600
361331             SET WS001-INVALID-SQL      TO TRUE                   36132700
361332             STRING 'SQL='                                        36132800
361333                  PV-SQL-RETURN-CD                                36132900
361334                  DELIMITED BY SIZE                               36133000
361335                                      INTO WS001-CRA-RET-MSG      36133100
361337             MOVE SQLCA                 TO WS001-SQLCA            36133300
361341             PERFORM 9999-ABEND                                   36133700
361342     END-EVALUATE.                                                36133800
361343                                                                  36133900
361344/                                                                 36134000
361345 8020-FETCH-DUMMY-CSR.                                            36134100
361346                                                                  36134200
361347     MOVE '8020-FETCH-DUMMY-CSR'                                  36134300
361348                                 TO WS001-PARAGRAPH-NAME.         36134400
361356                                                                  36134500
361357* GET ALL DATA FROM THE XREF DTL, KEY IS THE ORIG EXT-SHP-ID.     36134600
361358                                                                  36134700
361359     EXEC SQL                                                     36134800
361360          FETCH DUMMY-CSR                                         36134900
361361          INTO                                                    36135000
361362                :WST00002-PO-NBR                                  36136000
361364               ,:WST00002-PO-LNE-NBR                              36136100
361365               ,:WST00002-RCVR-SEQ-NBR                            36136200
361366               ,:WST00002-PREPK-ID                                36136300
361367               ,:WST00002-ASN-LVL-CDE                             36136400
361370               ,:WST00002-DWNLD-CDE                               36136500
361371               ,:WST00002-ACTV-CDE                                36136600
361372     END-EXEC.                                                    36136700
361380                                                                  36136800
361381     EVALUATE TRUE                                                36136900
361382         WHEN SQLCODE = ZERO                                      36137000
361383             IF PS-LOG-SWITCH-YES                                 36138001
361384                 INITIALIZE PV-MSG-AREA                           36138101
361385                 MOVE WST00002-PO-NBR       TO WS-DISPLAY-1       36138200
361386                 MOVE WST00002-PO-LNE-NBR   TO WS-DISPLAY-2       36138300
361387                 MOVE WST00002-RCVR-SEQ-NBR TO WS-DISPLAY-3       36138400
361388                 STRING   ' ' WS001-SRC-TASK-NUMBER               36138500
361389                          ' WSKUP305-8020:'                       36138600
361390                          ' PO='                                  36138700
361391                          WS-DISPLAY-1                            36138800
361392                          ' PO LNE='                              36138900
361393                          WS-DISPLAY-2                            36139000
361394                          ' RCVR='                                36139100
361395                          WS-DISPLAY-3                            36139200
361396                          DELIMITED BY SIZE                       36139300
361397                                          INTO PV-MSG-AREA        36139401
361398                 PERFORM 7000-WRITE-TO-LOG                        36139501
361399             END-IF                                               36139600
361423                                                                  36139700
361431            MOVE WS-EXT-SHP-ID          TO WST00002-EXT-SHP-ID    36139800
361432            MOVE WS001-USER-ID          TO WST00002-CRE-USR-ID    36139900
361433            MOVE PV-CURRENT-TIMESTAMP   TO WST00002-CRE-TMST      36140000
361434            MOVE 'N'                    TO WST00002-DWNLD-CDE     36141000
361435            MOVE 'A'                    TO WST00002-ACTV-CDE      36142000
164710            MOVE WS001-CALLING-PROGRAM-NAME                       36143000
231400                                        TO WST00002-CRE-PGM-CDE   36144000
361441            PERFORM 5447-INSERT-SHIP-XREF-DTL                     36144100
361442                                                                  36144200
361443            MOVE WST00002-PO-NBR        TO DK-PO-NBR              36144300
361444            MOVE WST00002-PO-LNE-NBR    TO DK-PO-LNE-NBR          36144400
361445            MOVE WST00002-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR        36144500
361446            PERFORM 8050-UPDATE-DTL-REC                           36144600
361447                                                                  36144700
361448         WHEN SQLCODE = -904                                      36144800
361449         WHEN SQLCODE = -913                                      36144900
361450         WHEN SQLCODE = -911                                      36145000
361451              CONTINUE                                            36145100
361452         WHEN SQLCODE = +100                                      36145200
361453              SET PS-EOF-DUMMY-CSR-YES TO TRUE                    36145300
361454         WHEN SQLWARN0 NOT = SPACES                               36145400
361455         WHEN SQLCODE NOT = ZERO                                  36145500
361456             INITIALIZE PV-MSG-AREA                               36145601
361457             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36145700
361458             STRING   ' ' WS001-SRC-TASK-NUMBER                   36145800
361459                      ' WSKUP305-8020 ERROR:'                     36145900
361460                      ' SQL='                                     36146000
361461                      PV-SQL-RETURN-CD                            36146100
361462                      DELIMITED BY SIZE                           36146200
361463                      INTO PV-MSG-AREA                            36146301
361464             PERFORM 7000-WRITE-TO-LOG                            36146401
361465                                                                  36146500
361466             SET WS001-INVALID-SQL      TO TRUE                   36146600
361467             STRING 'SQL='                                        36146700
361468                  PV-SQL-RETURN-CD                                36146800
361469                  DELIMITED BY SIZE                               36146900
361470                                      INTO WS001-CRA-RET-MSG      36147000
361472             MOVE SQLCA                 TO WS001-SQLCA            36147200
361478             PERFORM 9999-ABEND                                   36147800
361479     END-EVALUATE.                                                36147900
361480                                                                  36148000
361481/                                                                 36148100
361482 8030-CLOSE-DUMMY-CSR.                                            36148200
361483                                                                  36148300
361484     MOVE '8030-CLOSE-DUMMY-CSR'                                  36148400
361485                                 TO WS001-PARAGRAPH-NAME.         36148500
361486                                                                  36148600
361487     EXEC SQL                                                     36148700
361488          CLOSE DUMMY-CSR                                         36148800
361489     END-EXEC.                                                    36148900
361490                                                                  36149000
361491     EVALUATE TRUE                                                36149100
361492         WHEN SQLCODE = ZERO                                      36149200
361493             IF PS-LOG-SWITCH-YES                                 36149301
361494                 INITIALIZE PV-MSG-AREA                           36149401
361495                 STRING   ' ' WS001-SRC-TASK-NUMBER               36149500
361496                          ' WSKUP305-8030:'                       36149600
361497                          ' CLOSED DUMMY-CSR'                     36149700
361498                          DELIMITED BY SIZE                       36149800
361499                          INTO PV-MSG-AREA                        36149901
361500                 PERFORM 7000-WRITE-TO-LOG                        36150001
361501             END-IF                                               36150100
361502         WHEN SQLCODE = -904                                      36150200
361503         WHEN SQLCODE = -913                                      36150300
361504         WHEN SQLCODE = -911                                      36150400
361505              CONTINUE                                            36150500
361506         WHEN SQLWARN0 NOT = SPACES                               36150600
361507         WHEN SQLCODE NOT = ZERO                                  36150700
361508             INITIALIZE PV-MSG-AREA                               36150801
361509             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36150900
361510             STRING   ' ' WS001-SRC-TASK-NUMBER                   36151000
361511                      ' WSKUP305-8030-ERROR:'                     36151100
361512                      ' SQL='                                     36151200
361513                      PV-SQL-RETURN-CD                            36151300
361514                      DELIMITED BY SIZE                           36151400
361515                      INTO PV-MSG-AREA                            36151501
361516             PERFORM 7000-WRITE-TO-LOG                            36151601
361517                                                                  36151700
361518             SET WS001-INVALID-SQL      TO TRUE                   36151800
361519             STRING 'SQL='                                        36151900
361520                  PV-SQL-RETURN-CD                                36152000
361521                  DELIMITED BY SIZE                               36152100
361522                                      INTO WS001-CRA-RET-MSG      36152200
361524             MOVE SQLCA                 TO WS001-SQLCA            36152400
361528             PERFORM 9999-ABEND                                   36152800
361529     END-EVALUATE.                                                36152900
361530                                                                  36153000
361531/                                                                 36153100
361532 8040-GET-HDR-INFO.                                               36153200
361533                                                                  36153300
361534     MOVE '8040-GET-HDR-INFO'    TO WS001-PARAGRAPH-NAME.         36153410
361535                                                                  36153500
361536     EXEC SQL                                                     36153600
361537         SELECT  DISTINCT                                         36153700
361538                 INTR_TRIP_ID                                     36153800
361539               , DEST_LOC_NBR                                     36153900
361540         INTO                                                     36154000
361541                :WST00001-INTR-TRIP-ID                            36154100
361542              , :WST00001-DEST-LOC-NBR                            36154200
361543         FROM    WST_SHPMT_XREF_HDR                               36154300
361544         WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                  36154400
361545     END-EXEC.                                                    36154500
361546                                                                  36154600
361547     EVALUATE TRUE                                                36154700
361548         WHEN SQLCODE = ZERO                                      36154800
361549             MOVE WST00001-INTR-TRIP-ID    TO DK-TRIP-ID          36154900
361550                                              WS-TRIP-ID          36155000
361551             MOVE WST00001-DEST-LOC-NBR    TO WS001-OPER-UNT-ID   36155100
361552             IF PS-LOG-SWITCH-YES                                 36155201
361553                 MOVE DK-TRIP-ID           TO WS-DISPLAY-1        36155300
361554                 INITIALIZE PV-MSG-AREA                           36155401
361555                 STRING   ' ' WS001-SRC-TASK-NUMBER               36155500
361556                          ' WSKUP305-8040:'                       36155600
361557                          ' TRIP='                                36155700
361558                          WS-DISPLAY-1                            36155800
361559                          DELIMITED BY SIZE                       36155900
361560                          INTO PV-MSG-AREA                        36156001
361561                 PERFORM 7000-WRITE-TO-LOG                        36156101
361562             END-IF                                               36156200
361563         WHEN SQLCODE = -811                                      36156300
361564         WHEN SQLCODE = -904                                      36156400
361565         WHEN SQLCODE = -913                                      36156500
361566         WHEN SQLCODE = -911                                      36156600
361567             CONTINUE                                             36156700
361568         WHEN SQLWARN0 NOT = SPACES                               36156800
361569         WHEN SQLCODE NOT = ZERO                                  36156900
361570             SET WS001-INVALID-SQL      TO TRUE                   36157000
361571             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36157100
361572             STRING 'SQL='                                        36157200
361573                  PV-SQL-RETURN-CD                                36157300
361574                  DELIMITED BY SIZE                               36157400
361575                                      INTO WS001-CRA-RET-MSG      36157500
361576             MOVE SQLCA                 TO WS001-SQLCA            36157600
361577             INITIALIZE PV-MSG-AREA                               36157701
361578             STRING   ' ' WS001-SRC-TASK-NUMBER                   36157800
361579                      ' WSKUP305-8040 ERROR:'                     36157900
361580                      ' SQL='                                     36158000
361581                      PV-SQL-RETURN-CD                            36158100
361582                      DELIMITED BY SIZE                           36158200
361583                      INTO PV-MSG-AREA                            36158301
361584             PERFORM 7000-WRITE-TO-LOG                            36158401
361585     END-EVALUATE.                                                36158500
361586*                                                                 36158600
361587/                                                                 36158700
361588 8050-UPDATE-DTL-REC.                                             36158800
361589                                                                  36158900
361590     MOVE '8050-UPDATE-DTL-REC'  TO WS001-PARAGRAPH-NAME.         36159000
361591                                                                  36159100
361592     EXEC SQL                                                     36159200
361593          UPDATE WST_SHPMT_XREF_DTL                               36159300
361594             SET ACTV_CDE         = 'I'                           36159400
361595             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                36159500
361596             AND   PO_NBR         = :DK-PO-NBR                    36159600
361597             AND   PO_LNE_NBR     = :DK-PO-LNE-NBR                36159700
361598             AND   RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              36159800
361599     END-EXEC.                                                    36159900
361600                                                                  36160000
361601     EVALUATE TRUE                                                36160100
361602         WHEN SQLCODE = ZERO                                      36160200
361603             IF PS-LOG-SWITCH-YES                                 36160301
361604                 MOVE DK-PO-NBR       TO WS-DISPLAY-1             36160400
361605                 MOVE DK-PO-LNE-NBR   TO WS-DISPLAY-2             36160500
361606                 MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-3             36160600
361607                 INITIALIZE PV-MSG-AREA                           36160701
361608                 STRING   ' ' WS001-SRC-TASK-NUMBER               36160800
361609                          ' WSKUP305-8050:'                       36160900
361610                          ' UPDATE WST_SHPMT_XREF_DTL'            36161000
361611                          ' FOR SHPMT=' DK-EXT-SHP-ID             36161100
361613                          ' PO NBR=' WS-DISPLAY-1                 36161200
361614                          ' PO LNE=' WS-DISPLAY-2                 36161300
361615                          ' RCVR SEQ=' WS-DISPLAY-3               36161400
361617                          DELIMITED BY SIZE                       36161500
361618                          INTO PV-MSG-AREA                        36161601
361619                 PERFORM 7000-WRITE-TO-LOG                        36161701
361620             END-IF                                               36161800
361621         WHEN SQLCODE = -904                                      36161900
361622         WHEN SQLCODE = -913                                      36162000
361623         WHEN SQLCODE = -911                                      36162100
361624              CONTINUE                                            36162200
361625         WHEN SQLCODE = 100                                       36162300
361626         WHEN SQLWARN0 NOT = SPACES                               36162400
361627         WHEN SQLCODE NOT = ZERO                                  36162500
361628             INITIALIZE PV-MSG-AREA                               36162601
361629             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36162700
361630             STRING   ' ' WS001-SRC-TASK-NUMBER                   36162800
361631                      ' WSKUP305-8050 ERROR:'                     36162900
361632                      ' SQL='                                     36163000
361633                      PV-SQL-RETURN-CD                            36163100
361634                      DELIMITED BY SIZE                           36163200
361635                      INTO PV-MSG-AREA                            36163301
361636             PERFORM 7000-WRITE-TO-LOG                            36163401
361637                                                                  36163500
361638             SET WS001-INVALID-SQL      TO TRUE                   36163600
361639             STRING 'SQL='                                        36163700
361640                  PV-SQL-RETURN-CD                                36163800
361641                  DELIMITED BY SIZE                               36163900
361642                                      INTO WS001-CRA-RET-MSG      36164000
361644             MOVE SQLCA                 TO WS001-SQLCA            36164200
361650             PERFORM 9999-ABEND                                   36164800
361651     END-EVALUATE.                                                36164900
361652                                                                  36165000
361653/                                                                 36165100
361654 8060-UPDATE-HDR-REC.                                             36165200
361655                                                                  36165300
361656     MOVE '8060-UPDATE-HDR-REC'  TO WS001-PARAGRAPH-NAME.         36165400
361657                                                                  36165500
361658     EXEC SQL                                                     36165600
361659          UPDATE WST_SHPMT_XREF_HDR                               36165700
361661             SET DWNLD_CDE        = 'C'                           36165800
361662             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                36165900
361663     END-EXEC.                                                    36166000
361664                                                                  36166100
361665     EVALUATE TRUE                                                36166200
361666         WHEN SQLCODE = ZERO                                      36166300
361667             IF PS-LOG-SWITCH-YES                                 36166401
361668                 INITIALIZE PV-MSG-AREA                           36166501
361669                 STRING   ' ' WS001-SRC-TASK-NUMBER               36166600
361670                          ' WSKUP305-8060:'                       36166700
361671                          ' UPDATE WST_SHPMT_XREF_HDR'            36166800
361672                          ' FOR SHPMT='                           36166900
361673                          DK-EXT-SHP-ID                           36167000
361674                          DELIMITED BY SIZE                       36167100
361675                          INTO PV-MSG-AREA                        36167201
361676                 PERFORM 7000-WRITE-TO-LOG                        36167301
361677             END-IF                                               36167400
361678         WHEN SQLCODE = -904                                      36167500
361679         WHEN SQLCODE = -913                                      36167600
361680         WHEN SQLCODE = -911                                      36167700
361681              CONTINUE                                            36167800
361682         WHEN SQLWARN0 NOT = SPACES                               36167900
361683         WHEN SQLCODE NOT = ZERO                                  36168000
361684             INITIALIZE PV-MSG-AREA                               36168101
361685             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36168200
361686             STRING   ' ' WS001-SRC-TASK-NUMBER                   36168300
361687                      ' WSKUP305-8060 ERROR:'                     36168400
361688                      ' SQL='                                     36168500
361689                      PV-SQL-RETURN-CD                            36168600
361690                      DELIMITED BY SIZE                           36168700
361691                      INTO PV-MSG-AREA                            36168801
361692             PERFORM 7000-WRITE-TO-LOG                            36168901
361693                                                                  36169000
361694             SET WS001-INVALID-SQL      TO TRUE                   36169100
361695             STRING 'SQL='                                        36169200
361696                  PV-SQL-RETURN-CD                                36169300
361697                  DELIMITED BY SIZE                               36169400
361698                                      INTO WS001-CRA-RET-MSG      36169500
361700             MOVE SQLCA                 TO WS001-SQLCA            36169700
361706             PERFORM 9999-ABEND                                   36170300
361707     END-EVALUATE.                                                36170400
361708                                                                  36170500
361709/                                                                 36170600
361710***************************************************************   36170710
361711*   STANDARD RETURN ROUTINE                                       36170810
361720***************************************************************   36170910
361800 9990-RETURN.                                                     36171010
363200                                                                  36171110
044635     INITIALIZE PV-MSG-AREA.                                      36171210
044636     STRING   ' ' WS001-SRC-TASK-NUMBER                           36171310
044637              ' EXITING WSKUP305'                                 36171410
044638              DELIMITED BY SIZE                                   36171510
044639                                 INTO PV-MSG-AREA.                36171610
044640     PERFORM 7000-WRITE-TO-LOG.                                   36171711
044641                                                                  36171810
363400     GOBACK.                                                      36171910
363300                                                                  36172210
363300                                                                  36172310
361710***************************************************************   36172400
361711*   STANDARD ABEND ROUTINE                                        36172500
361712* ==> PROCESSES:                                                  36172600
361713*   - ISSUES THE ABEND.                                           36172700
361720***************************************************************   36172800
361800 9999-ABEND.                                                      36173000
363300                                                                  36173108
361910     DISPLAY 'ERROR IN WSKUP305 - ROLLING BACK'.                  36173208
363300                                                                  36173308
550000     EXEC SQL                                                     36173408
550100         ROLLBACK                                                 36173508
550500     END-EXEC.                                                    36173608
363300                                                                  36173708
363400     PERFORM 9990-RETURN.                                         36280010
