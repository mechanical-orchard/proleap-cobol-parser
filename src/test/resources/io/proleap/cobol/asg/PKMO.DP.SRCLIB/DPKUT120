000100******************************************************************00010000
000200 IDENTIFICATION     DIVISION.                                     00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             DPKUT120.                                00050000
000600 AUTHOR.                 JOY WEISHAN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           10-01-96.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*     DPKUT120 WILL INTERROGATE THE LIKAGE SECTION PASSED TO IT   00120000
001300*     FROM ANY CALLED PROGRAM.  THE LINKAGE SHOULD BE IN THE      00130000
001400*     FORMAT OF DPWS120.                                          00140000
001500*     PROVIDE STORE NUMBER AND COMP DATE AND OPEN DATE WILL       00150000
001600*     RETURN.                                                     00160000
002000******************************************************************00200000
002100                                                                  00210000
002200******************************************************************00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400******************************************************************00240000
002500                                                                  00250000
002600 CONFIGURATION SECTION.                                           00260000
002700                                                                  00270000
002800 SOURCE-COMPUTER.        IBM-4381.                                00280000
002900 OBJECT-COMPUTER.        IBM-4381.                                00290000
003000                                                                  00300000
003100 INPUT-OUTPUT SECTION.                                            00310000
003200                                                                  00320000
003300 FILE-CONTROL.                                                    00330000
003400                                                                  00340000
003500******************************************************************00350000
003600 DATA DIVISION.                                                   00360000
003700******************************************************************00370000
003800                                                                  00380000
003900 WORKING-STORAGE SECTION.                                         00390000
004000                                                                  00400000
004100 01  WS-PROGRAM-SWITCHES.                                         00410000
004200     05 WS-COMP-CALC.                                             00420000
004300        10 WS-COMP-CALC-FULL.                                     00430000
004400           15 WS-COMP-CALC-CC            PIC 9(02)   VALUE ZEROES.00440000
004500           15 WS-COMP-CALC-YY            PIC 9(02)   VALUE ZEROES.00450000
004600        10 WS-COMP-CALC-YEAR REDEFINES                            00460000
004700              WS-COMP-CALC-FULL          PIC 9(04).               00470000
004710        10 FILLER                        PIC X(01)   VALUE '-'.   00471000
004800        10 WS-COMP-CALC-MM               PIC 9(02)   VALUE ZEROES.00480000
004810        10 FILLER                        PIC X(01)   VALUE '-'.   00481000
004900        10 WS-COMP-CALC-DD               PIC 9(02)   VALUE ZEROES.00490000
004910     05 WS-COMP-QUARTER.                                          00491000
004950        10 WS-COMP-QUARTER-YEAR          PIC 9(04)   VALUE ZEROES.00495000
004960        10 FILLER                        PIC X(01)   VALUE '-'.   00496000
004970        10 WS-COMP-QUARTER-MM            PIC 9(02)   VALUE ZEROES.00497000
004971        10 FILLER                        PIC X(01)   VALUE '-'.   00497100
004980        10 WS-COMP-QUARTER-DD            PIC 9(02)   VALUE ZEROES.00498000
004990     05 WS-COMP-SEASON.                                           00499000
004991        10 WS-COMP-SEASON-YEAR           PIC 9(04)   VALUE ZEROES.00499100
004992        10 FILLER                        PIC X(01)   VALUE '-'.   00499200
004993        10 WS-COMP-SEASON-MM             PIC 9(02)   VALUE ZEROES.00499300
004994        10 FILLER                        PIC X(01)   VALUE '-'.   00499400
004995        10 WS-COMP-SEASON-DD             PIC 9(02)   VALUE ZEROES.00499500
004996     05 WS-COMP-YEAR.                                             00499600
004997        10 WS-COMP-YEAR-YEAR             PIC 9(04)   VALUE ZEROES.00499700
004998        10 FILLER                        PIC X(01)   VALUE '-'.   00499800
004999        10 WS-COMP-YEAR-MM               PIC 9(02)   VALUE ZEROES.00499900
005000        10 FILLER                        PIC X(01)   VALUE '-'.   00500000
005001        10 WS-COMP-YEAR-DD               PIC 9(02)   VALUE ZEROES.00500100
005010     05 WS-FISCAL-YEAR.                                           00501000
005100        10 WS-FISCAL-YEAR-CC             PIC 9(02)   VALUE ZEROES.00510000
005200        10 WS-FISCAL-YEAR-YY             PIC 9(02)   VALUE ZEROES.00520000
005210     05  WS-COMP-FISCAL-PERIOD-NBR       PIC 9(02)   VALUE ZEROES.00521001
005300                                                                  00530000
005400 01  PV-PROGRAM-VARIABLES.                                        00540000
005500     05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE. 00550000
006400     05  PV-CLOSED-DATE.                                          00640000
006500         10 PV-CLOSED-DATE-CC            PIC 9(02)   VALUE ZEROES.00650000
006600         10 PV-CLOSED-DATE-YY            PIC 9(02)   VALUE ZEROES.00660000
006700         10 PV-CLOSED-DATE-MM            PIC 9(02)   VALUE ZEROES.00670000
006800         10 PV-CLOSED-DATE-DD            PIC 9(02)   VALUE ZEROES.00680000
006900******************************************************************00690000
007000*    CALENDAR ROTUINE                                             00700000
007100******************************************************************00710000
007200                                                                  00720000
007300     COPY DPWS500.                                                00730000
007400                                                                  00740000
007500 01  CC-CONTROL-CARD.                                             00750000
007600     05  CC-CALENDAR-TYPE                PIC X(02)   VALUE 'F2'.  00760000
007700     05  FILLER                          PIC X(01)   VALUE SPACES.00770000
007800     05  CC-DATE.                                                 00780000
007900         10 CC-CENTURY                   PIC 9(02)   VALUE ZEROES.00790000
008000         10 CC-YEAR                      PIC 9(02)   VALUE ZEROES.00800000
008010         10 FILLER                       PIC X(01)   VALUE '-'.   00801000
008100         10 CC-MONTH                     PIC 9(02)   VALUE ZEROES.00810000
008110         10 FILLER                       PIC X(01)   VALUE '-'.   00811000
008200         10 CC-DAY                       PIC 9(02)   VALUE ZEROES.00820000
008300     05  FILLER                          PIC X(69)   VALUE SPACES.00830000
008400                                                                  00840000
008500 01  PC-PGM-DPKUT500          PIC X(08)   VALUE 'DPKUT500'.       00850000
008600                                                                  00860000
010900 LINKAGE SECTION.                                                 01090000
011000     COPY DPWS120.                                                01100000
011100                                                                  01110000
011200******************************************************************01120000
011300 PROCEDURE DIVISION USING        DP120.                           01130000
011400******************************************************************01140000
011500 0000-MAINLINE.                                                   01150000
011600*                                                                 01160000
012300     PERFORM B100-INITIALIZE-LINKAGE.                             01230000
012301                                                                  01230100
012310     PERFORM B200-GET-DATES.                                      01231000
012400*                                                                 01240000
012700     GOBACK.                                                      01270000
012800     EJECT                                                        01280000
012900*                                                                 01290000
015000****************************************************************  01500000
015100* INITIALIZE THE LINKAGE SECTION                                  01510000
015200****************************************************************  01520000
015300 B100-INITIALIZE-LINKAGE.                                         01530000
015400****************************************************************  01540000
015500* MOVE OPEN DATE AND CALC COMPARABLE STORE DATE                   01550000
015600****************************************************************  01560000
015610     INITIALIZE DP120-COMP-DATE                                   01561000
015611                DP120-YEAR-COMP-DATE                              01561100
015612                DP120-SEASON-COMP-DATE                            01561200
015613                DP120-QUARTER-COMP-DATE                           01561300
015614                DP120-RETURN-CODE.                                01561400
015620                                                                  01562000
015700 B200-GET-DATES.                                                  01570000
016300* CALCULATE COMPARABLE STORE DATE                                 01630000
016400*                                                                 01640000
016500* FIND WHAT FISCAL WEEK OF THE MONTH THE STORE OPENED             01650000
016600*                                                                 01660000
016700     MOVE DP120-OPEN-DATE TO WS-COMP-CALC                         01670000
016800                             CC-DATE.                             01680000
016900     PERFORM C100-CALENDAR-ROUTINE.                               01690000
017000*                                                                 01700000
017100* IF STORE OPENED IN LAST 2 WEEKS, ADD 14 MONTHS, ELSE ADD 12     01710000
017200*                                                                 01720000
017300     IF (DPG56-FISCAL-PERIOD-WEEK >= 3 AND                        01730000
017400         DPG56-NBR-FISCAL-PERIOD-WEEKS = 4) OR                    01740000
017500        (DPG56-FISCAL-PERIOD-WEEK >= 4 AND                        01750000
017600         DPG56-NBR-FISCAL-PERIOD-WEEKS = 5)                       01760000
017700                                                                  01770000
017800* IN LAST 2 WEEKS, NOW PUT IN COMPARABLE YEAR (BECAUSE OF 4-5-4)  01780000
017900* MIGHT INCLUDE DATES IN A FISCAL MONTH FROM A DIFFERENT          01790000
018000* CALENDAR MONTH AND YEAR                                         01800000
018100                                                                  01810000
018200        MOVE DPG56-FISCAL-YEAR-NBR TO WS-FISCAL-YEAR-YY           01820000
018300        IF WS-FISCAL-YEAR-YY < 60                                 01830000
018400           MOVE '20' TO WS-FISCAL-YEAR-CC                         01840000
018500        ELSE                                                      01850000
018600           MOVE '19' TO WS-FISCAL-YEAR-CC                         01860000
018700        END-IF                                                    01870000
018800        IF WS-COMP-CALC-YEAR > WS-FISCAL-YEAR                     01880000
018900           ADD +12 TO WS-COMP-CALC-MM                             01890000
019000           IF WS-COMP-CALC-YY = 0                                 01900000
019100              MOVE +99 TO WS-COMP-CALC-YY                         01910000
019200              SUBTRACT +1 FROM WS-COMP-CALC-CC                    01920000
019300           ELSE                                                   01930000
019400              SUBTRACT +1 FROM WS-COMP-CALC-YY                    01940000
019500           END-IF                                                 01950000
019600        END-IF                                                    01960000
019700                                                                  01970000
019800* IF FISCAL MONTH > 1 MONTH, THERE IS A SCENARIO WHERE THE FIRST  01980000
019900* COUPLE DAYS OF A CAL MONTH ARE IN A DIFFERENT FISCAL MONTH THAN 01990000
020000* YOU WOULD EXPECT                                                02000000
020100        IF (WS-COMP-CALC-MM - DPG56-FISCAL-PERIOD-NBR) > 1        02010000
020200           ADD +13 TO WS-COMP-CALC-MM                             02020000
020300        ELSE                                                      02030000
020400           ADD +14 TO WS-COMP-CALC-MM                             02040000
020500        END-IF                                                    02050000
020600* ELSE IN FIRST 2/3 WEEKS OF MONTH (DEPENDING ON 4-5-4)           02060000
020700     ELSE                                                         02070000
020710        IF ((WS-COMP-CALC-MM > DPG56-FISCAL-PERIOD-NBR) OR        02071003
020720           (DPG56-FISCAL-PERIOD-NBR = '12' AND                    02072008
020730            WS-COMP-CALC-MM = '01'))                              02073008
020800            ADD +13 TO WS-COMP-CALC-MM                            02080000
020810        ELSE                                                      02081000
020820            ADD +14 TO WS-COMP-CALC-MM                            02082000
020830        END-IF                                                    02083000
020900     END-IF.                                                      02090000
021000*                                                                 02100000
021100*  ADJUST YEAR IF NEEDED, AND MOVE 15 TO DAY                      02110000
021200*  (IT MAY OCCUR THAT IF NEEDS TO BE DONE TWICE FOR LATER MONTHS  02120000
021300*   IN THE YEAR).                                                 02130000
021400*                                                                 02140000
021500     IF WS-COMP-CALC-MM > 12                                      02150000
021600        SUBTRACT +12 FROM WS-COMP-CALC-MM                         02160000
021700        ADD +1  TO WS-COMP-CALC-YEAR                              02170000
021800        IF WS-COMP-CALC-MM > 12                                   02180000
021900           SUBTRACT +12 FROM WS-COMP-CALC-MM                      02190000
022000           ADD +1  TO WS-COMP-CALC-YEAR                           02200000
022100        END-IF                                                    02210000
022200     END-IF.                                                      02220000
022300     MOVE +15 TO WS-COMP-CALC-DD.                                 02230000
022400*                                                                 02240000
022500*  MOVE THE COMP CALC DATE TO THE YEAR, SEASON AND QUARTER COMP DA02250000
022600*  DATES                                                          02260000
022700*                                                                 02270000
022701     MOVE WS-COMP-CALC TO WS-COMP-YEAR                            02270100
022702                          WS-COMP-SEASON                          02270200
022703                          WS-COMP-QUARTER.                        02270300
022710*                                                                 02271000
022720*  NOW THAT YEAR AND DATE ARE ADJUSTED, CALCULATE FIRST FICSAL DAY02272000
022730*  OF THAT MONTH FOR THE TRUE COMP DATE.                          02273000
022740*                                                                 02274000
022800     MOVE WS-COMP-CALC TO CC-DATE.                                02280000
022900     PERFORM C100-CALENDAR-ROUTINE.                               02290000
023000     MOVE DPG56-FIRST-FP-DB2-ISO-FMT-YR TO DP120-COMP-DATE-CCYY.  02300000
023100     MOVE DPG56-FIRST-FP-DB2-ISO-FMT-MO TO DP120-COMP-DATE-MM.    02310000
023200     MOVE DPG56-FIRST-FP-DB2-ISO-FMT-DY TO DP120-COMP-DATE-DD.    02320000
023201     MOVE DPG56-FISCAL-PERIOD-NBR  TO WS-COMP-FISCAL-PERIOD-NBR.  02320100
023202*                                                                 02320200
023203*  ADD 6 MONTHS TO THE COMP DATE TO GET THE DATE THE STORE IS COMP02320300
023204*  FOR THE ENTIRE SEASON.                                         02320400
023205*                                                                 02320500
023214     IF WS-COMP-FISCAL-PERIOD-NBR = '01' OR                       02321411
023215        WS-COMP-FISCAL-PERIOD-NBR = '07'                          02321511
023216         MOVE DP120-COMP-DATE TO DP120-SEASON-COMP-DATE           02321611
023217     ELSE                                                         02321711
023218        IF DPG56-SPRING-SEASON                                    02321811
023219            MOVE +8 TO WS-COMP-SEASON-MM                          02321911
023220            MOVE WS-COMP-SEASON TO CC-DATE                        02322011
023221            PERFORM C100-CALENDAR-ROUTINE                         02322111
023222            MOVE DPG56-FIRST-FP-DB2-ISO-FMT-YR TO                 02322211
023223                 DP120-SEASON-COMP-DATE-CCYY                      02322311
023224            MOVE DPG56-FIRST-FP-DB2-ISO-FMT-MO TO                 02322411
023225                 DP120-SEASON-COMP-DATE-MM                        02322511
023226            MOVE DPG56-FIRST-FP-DB2-ISO-FMT-DY TO                 02322611
023227                 DP120-SEASON-COMP-DATE-DD                        02322711
023229        ELSE                                                      02322911
023236            IF (DPG56-FISCAL-PERIOD-NBR = '12' AND                02323609
023237                WS-COMP-SEASON-MM = '01')                         02323709
023239                CONTINUE                                          02323909
023240            ELSE                                                  02324009
023241                ADD  +1 TO WS-COMP-SEASON-YEAR                    02324109
023242            END-IF                                                02324209
023243            MOVE +2 TO WS-COMP-SEASON-MM                          02324300
023245            MOVE WS-COMP-SEASON TO CC-DATE                        02324500
023246            PERFORM C100-CALENDAR-ROUTINE                         02324600
023247            MOVE DPG56-FIRST-FP-DB2-ISO-FMT-YR TO                 02324700
023248                 DP120-SEASON-COMP-DATE-CCYY                      02324800
023249            MOVE DPG56-FIRST-FP-DB2-ISO-FMT-MO TO                 02324900
023250                 DP120-SEASON-COMP-DATE-MM                        02325000
023251            MOVE DPG56-FIRST-FP-DB2-ISO-FMT-DY TO                 02325100
023252                 DP120-SEASON-COMP-DATE-DD                        02325200
023253        END-IF                                                    02325300
023254     END-IF.                                                      02325400
023255*                                                                 02325500
023256*  ADD 1 YEAR TO THE COMP DATE TO GET THE DATE THE STORE IS COMP  02325600
023257*  FOR THE ENTIRE YEAR.                                           02325700
023258*                                                                 02325800
023259     IF WS-COMP-FISCAL-PERIOD-NBR = '01'                          02325912
023260         MOVE DP120-COMP-DATE TO DP120-YEAR-COMP-DATE             02326011
023261     ELSE                                                         02326111
023262         ADD +1 TO WS-COMP-YEAR-YEAR                              02326211
023263         MOVE WS-COMP-YEAR TO CC-DATE                             02326311
023264         PERFORM C100-CALENDAR-ROUTINE                            02326411
023265         MOVE DPG56-FIRST-FD-DB2-ISO-FMT-YR TO                    02326511
023266              DP120-YEAR-COMP-DATE-CCYY                           02326611
023267         MOVE DPG56-FIRST-FD-DB2-ISO-FMT-MO TO                    02326711
023268              DP120-YEAR-COMP-DATE-MM                             02326811
023269         MOVE DPG56-FIRST-FD-DB2-ISO-FMT-DY TO                    02326911
023270              DP120-YEAR-COMP-DATE-DD                             02327011
023280     END-IF.                                                      02328011
023290*                                                                 02329000
023291*  ADD 3 MONTHS TO THE COMP DATE TO GET THE DATE THE STORE IS COMP02329100
023292*  FOR THE ENTIRE QUARTER.                                        02329200
023293*                                                                 02329300
023294     IF WS-COMP-FISCAL-PERIOD-NBR = '01' OR                       02329400
023295        WS-COMP-FISCAL-PERIOD-NBR = '04' OR                       02329500
023296        WS-COMP-FISCAL-PERIOD-NBR = '07' OR                       02329600
023297        WS-COMP-FISCAL-PERIOD-NBR = '10'                          02329700
023298         MOVE DP120-COMP-DATE TO DP120-QUARTER-COMP-DATE          02329800
023299     ELSE                                                         02329900
023300         ADD +3 TO WS-COMP-QUARTER-MM                             02330000
023301         IF WS-COMP-QUARTER-MM > 12                               02330100
023302            SUBTRACT +12 FROM WS-COMP-QUARTER-MM                  02330200
023303            ADD +1  TO WS-COMP-QUARTER-YEAR                       02330300
023304         END-IF                                                   02330402
023305         MOVE WS-COMP-QUARTER TO CC-DATE                          02330502
023306         PERFORM C100-CALENDAR-ROUTINE                            02330602
023307         MOVE DPG56-FIRST-FQ-DB2-ISO-FMT-YR TO                    02330700
023308              DP120-QUARTER-COMP-DATE-CCYY                        02330802
023309         MOVE DPG56-FIRST-FQ-DB2-ISO-FMT-MO TO                    02330900
023310              DP120-QUARTER-COMP-DATE-MM                          02331002
023311         MOVE DPG56-FIRST-FQ-DB2-ISO-FMT-DY TO                    02331100
023312              DP120-QUARTER-COMP-DATE-DD                          02331200
023313     END-IF.                                                      02331300
023320*                                                                 02332000
026000 C100-CALENDAR-ROUTINE.                                           02600000
026100******************************************************************02610000
026200*    CALL THE CALENDAR ROUTINE TO VALIDATE/MANIPULATE DATES       02620000
026300******************************************************************02630000
026400                                                                  02640000
026500     MOVE CC-DATE TO DPG52-LK-DATE-INPUT.                         02650000
026600     MOVE CC-CALENDAR-TYPE TO DPG51-CALENDAR-TYPE.                02660000
026700     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            02670000
026800                                                                  02680000
026900     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       02690000
027000                                DPG53 DPG54                       02700000
027100                                DPG55 DPG56.                      02710000
027200                                                                  02720000
027300     IF DPG54-NO-ERROR OR                                         02730000
027400        DPG54-WARNING-ERROR                                       02740000
027500         CONTINUE                                                 02750000
027600     ELSE                                                         02760000
027610         MOVE DPG54-ERROR-IND TO DP120-RETURN-CODE                02761000
028200     END-IF.                                                      02820000
028300*                                                                 02830000
