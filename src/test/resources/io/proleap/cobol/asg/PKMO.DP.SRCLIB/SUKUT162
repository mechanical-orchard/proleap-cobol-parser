000100******************************************************************00010024
000200 IDENTIFICATION DIVISION.                                         00020025
000300******************************************************************00030025
000400 PROGRAM-ID.    SUKUT162.                                         00040025
000500 AUTHOR.        JIM HUNTER                                        00050025
000600 INSTALLATION.  KOHLS.                                            00060025
000700 DATE-WRITTEN   MARCH, 2017.                                      00070025
000800 DATE-COMPILED.                                                   00080025
000900******************************************************************00090025
001000*  THIS PROGRAM WILL READ THE INPUT FILE CREATED BY SUKUT161      00100025
001100*  AFTER IT HAS BEEN SORTED IN TRIP ID SEQUENCE AND THE DUPLICATES00110025
001200*  HAVE BEEN REMOVED.                                             00120025
001300*  IT WILL RETRIEVE CARTON DATA WHICH WILL BE USED TO UPDATE      00130025
001400*  THE IN-TRANSIT TABLES.                                         00140025
001500*  IT WILL ALSO CREATE A DETAILED CARTON OUTPUT FILE AND AN       00150025
001600*  EMPTY CARTON OUTPUT FILE.                                      00160025
001700*  PO-RCVR CURSOR AND LOGIC COPIED FROM SUKUT013.                 00170025
001800******************************************************************00180025
001900******************************************************************00190025
002000*  CHANGE LOG                                                     00200025
002100*  DATE       CHANGED BY    DESC                                  00210025
002200*  ---------- ------------- --------------------------------------00220025
002300*  01-06-2017 JIM HUNTER    INITIAL PROGRAM FOR STORE RECEIVING   00230025
002400*                           PROJECT.                              00240025
002500*  06-21-2017 JIM HUNTER    ADD LOGIC TO DROP SSTM CARTONS WHICH  00250025
002600*                           HAD ORIG MISLOAD SHIPMENTS BEFORE     00260025
002700*                           THE STORE STARTED SCANNING AND NOW    00270025
002800*                           IS SCANNING THE MISLOAD CARTON(S).    00280025
002900*                           THIS WILL AVOID MULTIPLE STORE        00290025
003000*                           EXPECTED ADJUSTMENTS.                 00300025
003100******************************************************************00310025
003200 ENVIRONMENT DIVISION.                                            00320025
003300 CONFIGURATION SECTION.                                           00330025
003400                                                                  00340025
003500 SOURCE-COMPUTER.        IBM-3090.                                00350025
003600 OBJECT-COMPUTER.        IBM-3090.                                00360025
003700                                                                  00370025
003800 INPUT-OUTPUT SECTION.                                            00380025
003900 FILE-CONTROL.                                                    00390025
004000                                                                  00400025
004100     SELECT TRIP-ID-FILE                                          00410025
004200         ASSIGN TO IN01.                                          00420025
004300                                                                  00430025
004400     SELECT CARTON-DETAIL-FILE                                    00440025
004500         ASSIGN TO OUT01.                                         00450025
004600                                                                  00460025
004700     SELECT EMPTY-CARTON-FILE                                     00470025
004800         ASSIGN TO OUT02.                                         00480025
004900                                                                  00490025
005000******************************************************************00500025
005100 DATA DIVISION.                                                   00510025
005200 FILE SECTION.                                                    00520025
005300                                                                  00530025
005400 FD  TRIP-ID-FILE                                                 00540025
005500     RECORDING MODE IS F                                          00550025
005600     LABEL RECORDS ARE STANDARD                                   00560025
005700     BLOCK CONTAINS 0 RECORDS.                                    00570025
005800                                                                  00580025
005900 01  TRIP-ID-RECORD          PIC  X(100).                         00590025
006000*                                                                 00600025
006100 FD  CARTON-DETAIL-FILE                                           00610025
006200     RECORDING MODE IS F                                          00620025
006300     LABEL RECORDS ARE STANDARD                                   00630025
006400     BLOCK CONTAINS 0 RECORDS.                                    00640025
006500                                                                  00650025
006600 01  CARTON-DETAIL-RECORD    PIC  X(100).                         00660025
006700*                                                                 00670025
006800 FD  EMPTY-CARTON-FILE                                            00680025
006900     RECORDING MODE IS F                                          00690025
007000     LABEL RECORDS ARE STANDARD                                   00700025
007100     BLOCK CONTAINS 0 RECORDS.                                    00710025
007200                                                                  00720025
007300 01  EMPTY-CARTON-RECORD     PIC  X(125).                         00730025
007400*                                                                 00740025
007500******************************************************************00750025
007600 WORKING-STORAGE SECTION.                                         00760025
007700******************************************************************00770025
007800******************************************************************00780025
007900*  TRIP ID INPUT FILE LAYOUT                                      00790025
008000******************************************************************00800025
008100     COPY SURD150.                                                00810025
008200                                                                  00820025
008300*                                                                 00830025
008400******************************************************************00840025
008500*  CARTON OUTPUT FILE LAYOUT                                      00850025
008600******************************************************************00860025
008700     COPY PCRD010.                                                00870025
008800                                                                  00880025
008900***********************************************************       00890025
009000*  RECORD LAYOUT FOR THE EMPTY CARTON FILE                        00900025
009100***********************************************************       00910025
009200 01  PV-EMPTY-CARTON-REC.                                         00920025
009300     COPY SURD056.                                                00930025
009400                                                                  00940025
009500******************************************************************00950025
009600*  DB2 FORMATTED MESSAGE AREA                                     00960025
009700******************************************************************00970025
009800     COPY DPWS004.                                                00980025
009900*                                                                 00990025
010000******************************************************************01000025
010100*  COMMUNICATIONS AREA FOR DB2                                    01010025
010200******************************************************************01020025
010300     EXEC SQL                                                     01030025
010400          INCLUDE SQLCA                                           01040025
010500     END-EXEC.                                                    01050025
010600*                                                                 01060025
010700******************************************************************01070025
010800*    SUT_OTBND_STR_SCN TABLE                                      01080025
010900******************************************************************01090025
011000     EXEC SQL                                                     01100025
011100          INCLUDE SUT00121                                        01110025
011200     END-EXEC.                                                    01120025
011300                                                                  01130025
011400******************************************************************01140025
011500*    SUT_OTBND_UPC UPC TABLE                                      01150025
011600******************************************************************01160025
011700     EXEC SQL                                                     01170025
011800          INCLUDE SUT00028                                        01180025
011900     END-EXEC.                                                    01190025
012000                                                                  01200025
012100******************************************************************01210025
012200*    XLT_UPC  TABLE                                               01220025
012300******************************************************************01230025
012400     EXEC SQL                                                     01240025
012500          INCLUDE XLT00006                                        01250025
012600     END-EXEC.                                                    01260025
012700                                                                  01270025
012800******************************************************************01280025
012900*    XLT_SKU  TABLE                                               01290025
013000******************************************************************01300025
013100     EXEC SQL                                                     01310025
013200          INCLUDE XLT00003                                        01320025
013300     END-EXEC.                                                    01330025
013400                                                                  01340025
013500******************************************************************01350025
013600*     SUT_OTBND_VND  TABLE                                        01360025
013700******************************************************************01370025
013800     EXEC SQL                                                     01380025
013900          INCLUDE SUT00026                                        01390025
014000     END-EXEC.                                                    01400025
014100                                                                  01410025
014200******************************************************************01420025
014300*     TPKSLIP  TABLE                                              01430025
014400******************************************************************01440025
014500     EXEC SQL                                                     01450025
014600          INCLUDE TPKSLIP                                         01460025
014700     END-EXEC.                                                    01470025
014800                                                                  01480025
014900******************************************************************01490025
015000*    OUTBOUND TRAILER TRIP STATUS TABLE                           01500025
015100******************************************************************01510025
015200     EXEC SQL                                                     01520025
015300          INCLUDE TSUOBTS                                         01530025
015400     END-EXEC.                                                    01540025
015500                                                                  01550025
015600******************************************************************01560025
015700*  PARAMATER TABLE                                                01570025
015800******************************************************************01580025
015900     EXEC SQL                                                     01590025
016000          INCLUDE TKRPRPM                                         01600025
016100     END-EXEC.                                                    01610025
016200                                                                  01620025
016300***************************************************************** 01630025
016400*    WST_INTGRTN_TYP TABLE                                        01640025
016500***************************************************************** 01650025
016600     EXEC SQL                                                     01660025
016700          INCLUDE WST00008                                        01670025
016800     END-EXEC.                                                    01680025
016900                                                                  01690025
017000***************************************************************** 01700025
017100*    WST_ATTR_ELEM TABLE                                          01710025
017200***************************************************************** 01720025
017300     EXEC SQL                                                     01730025
017400          INCLUDE WST00009                                        01740025
017500     END-EXEC.                                                    01750025
017600                                                                  01760025
017700***************************************************************** 01770025
017800*    WST_ATTR_DEFN TABLE                                          01780025
017900***************************************************************** 01790025
018000     EXEC SQL                                                     01800025
018100          INCLUDE WST00010                                        01810025
018200     END-EXEC.                                                    01820025
018300                                                                  01830025
018400                                                                  01840025
018500******************************************************************01850025
018600 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01860025
018700                                                   COMP SYNC.     01870025
018800                                                                  01880025
018900 01  PS-PROGRAM-SWITCHES.                                         01890025
019000     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     01900025
019100         88  PS-END-OF-FILE                        VALUE 'Y'.     01910025
019200         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     01920025
019300     05  PS-END-OF-SCAN-CTN-CSR-SW   PIC  X(01)    VALUE 'N'.     01930025
019400         88  PS-END-OF-SCAN-CTN-CSR                VALUE 'Y'.     01940025
019500         88  PS-NOT-END-OF-SCAN-CTN-CSR            VALUE 'N'.     01950025
019600     05  PS-END-OF-PO-RCVR-CSR-SW    PIC  X(01)    VALUE 'N'.     01960025
019700         88  PS-END-OF-PO-RCVR-CSR                 VALUE 'Y'.     01970025
019800         88  PS-NOT-END-OF-PO-RCVR-CSR             VALUE 'N'.     01980025
019900     05  PS-TRIP-PROCESS-B4-SCAN-ON-IND   PIC X    VALUE 'N'.     01990025
020000         88  PS-TRIP-PROCESS-B4-SCAN-ON            VALUE 'Y'.     02000025
020100         88  PS-TRIP-NOT-PROCESS-B4-SCAN-ON        VALUE 'N'.     02010025
020200     05  PS-TSUOBTS-TMST-FOUND-IND        PIC X    VALUE 'N'.     02020025
020300         88  PS-TSUOBTS-TMST-FOUND                 VALUE 'Y'.     02030025
020400         88  PS-TSUOBTS-TMST-NOT-FOUND             VALUE 'N'.     02040025
020500                                                                  02050025
020600 01  PC-PROGRAM-CONSTANTS.                                        02060025
020700     05  PC-A                        PIC  X(01)    VALUE 'A'.     02070025
020800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT162'. 02080025
020900     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  02090025
021000                                                                  02100025
021100 01  PV-PROGRAM-VARIABLES.                                        02110025
021200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  02120025
021300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  02130025
021400     05  PV-PO-NBR                   PIC S9(9) COMP VALUE ZEROES. 02140025
021500     05  PV-RCVR-SEQ-NBR             PIC S9(9) COMP VALUE ZEROES. 02150025
021600     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             02160025
021700     05  PV-SHIPPED-TMST             PIC  X(26) VALUE SPACE.      02170025
021800     05  PV-STORE-SCAN-ON-TMST       PIC  X(26) VALUE SPACE.      02180025
021900     05  PV-ORIG-TRIP-ID-NULL-IND      PIC S9(4)  COMP VALUE +0.  02190025
022000         88 PV-ORIG-TRIP-ID-IS-NULL    VALUE -1.                  02200025
022100         88 PV-ORIG-TRIP-ID-NOT-FOUND  VALUE -1.                  02210025
022200                                                                  02220025
022300 01  COUNTERS.                                                    02230025
022400     05  PV-READ-COUNTER             PIC  S9(9) COMP-3.           02240025
022500     05  PV-UPC-COUNT                PIC  S9(9) COMP-3.           02250025
022600     05  PV-CARTON-COUNT             PIC  S9(9) COMP-3.           02260025
022700     05  PV-EMPTY-CARTON-COUNT       PIC  S9(9) COMP-3.           02270025
022800                                                                  02280025
022900*---------------------------------------------------------------* 02290025
023000*    SCAN-CTN CURSOR                                              02300025
023100*---------------------------------------------------------------* 02310025
023200     EXEC SQL                                                     02320025
023300         DECLARE SCAN-CTN-CSR CURSOR FOR                          02330025
023410         SELECT  DISTINCT A.SHIPT_UNT_ID                          02341025
023500              ,  A.SCN_LOC_NBR                                    02350025
023600              ,  A.SCN_TYP_CDE                                    02360025
023700              ,  A.ORIG_OTBND_TRIP_ID                             02370025
023800           FROM  SUT_OTBND_STR_SCN  A                             02380025
023810              ,  TSUOBTS B                                        02381025
023820          WHERE  A.SCN_OTBND_TRIP_ID                              02382025
023830                                  = :SUT00121-SCN-OTBND-TRIP-ID   02383025
023840            AND  A.SCN_TYP_CDE   IN ('SSEC','SSTM','SSNM')        02384025
023850            AND  A.ACTV_IND       = 'Y'                           02385025
023860            AND  A.SCN_OTBND_TRIP_ID = B.OTBND_TRIP_ID            02386025
023870            AND  B.TRIP_STAT_CDE     = 'SU'                       02387025
023880            AND  B.FINCL_POST_TMST                                02388027
023890                               = '9999-09-09-09.09.09.999999'     02389027
023900       ORDER BY  A.SHIPT_UNT_ID                                   02390025
024000        WITH UR                                                   02400025
024100     END-EXEC.                                                    02410025
024200                                                                  02420025
024300*---------------------------------------------------------------* 02430025
024400*    PO-RCVR CURSOR                                               02440025
024500*---------------------------------------------------------------* 02450025
024600     EXEC SQL                                                     02460025
024700         DECLARE PO-RCVR-CSR CURSOR FOR                           02470025
024800         SELECT  SUM(A.SHPD_UNT_QTY)                              02480025
024900                ,A.UPC_NBR                                        02490025
025000                ,A.TRN_LNE_NBR                                    02500025
025100                ,A.TRN_NBR                                        02510025
025200                ,A.RCVR_SEQ_NBR                                   02520025
025300                ,A.TRN_TYP_CDE                                    02530025
025400                ,C.SKU_NBR                                        02540025
025500                ,C.INTR_UPC_ID                                    02550025
025600          FROM  SUT_OTBND_UPC A                                   02560025
025700               ,XLT_UPC B                                         02570025
025800               ,XLT_SKU C                                         02580025
025900         WHERE  A.SHIPT_UNT_ID  =  :SUT00121-SHIPT-UNT-ID         02590025
026000           AND  A.UPC_NBR       =  B.UPC_NBR                      02600025
026100           AND  B.INTR_UPC_ID   =  C.INTR_UPC_ID                  02610025
026200          GROUP BY A.UPC_NBR, A.TRN_LNE_NBR, A.TRN_NBR,           02620025
026300                   A.RCVR_SEQ_NBR, A.TRN_TYP_CDE,                 02630025
026400                   C.SKU_NBR, C.INTR_UPC_ID                       02640025
026500          ORDER BY A.TRN_NBR, A.RCVR_SEQ_NBR                      02650025
026600          WITH UR                                                 02660025
026700     END-EXEC.                                                    02670025
026800                                                                  02680025
026900******************************************************************02690025
027000 PROCEDURE DIVISION.                                              02700025
027100******************************************************************02710025
027200******************************************************************02720025
027300* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02730025
027400*      PROGRAM.                                                   02740025
027500******************************************************************02750025
027600 0000-PROGRAM-MAINLINE.                                           02760025
027700                                                                  02770025
027800     DISPLAY '***** SUKUT162 STARTED *****'.                      02780025
027900                                                                  02790025
028000     PERFORM 1000-INITIALIZE.                                     02800025
028100     IF PS-NOT-END-OF-FILE                                        02810025
028200         PERFORM 2000-PROCESS-TRIP-ID-FILE                        02820025
028300            UNTIL PS-END-OF-FILE                                  02830025
028400     END-IF.                                                      02840025
028500     PERFORM 9000-EOJ-ROUTINE.                                    02850025
028600                                                                  02860025
028700     STOP RUN.                                                    02870025
028800                                                                  02880025
028900******************************************************************02890025
029000*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02900025
029100*    -- OPEN INPUT FILE                                           02910025
029200*    -- OPEN OUTPUT FILE                                          02920025
029300*    -- READ INPUT FILE                                           02930025
029400******************************************************************02940025
029500 1000-INITIALIZE.                                                 02950025
029600                                                                  02960025
029700     INITIALIZE COUNTERS.                                         02970025
029800     OPEN INPUT  TRIP-ID-FILE.                                    02980025
029900     OPEN OUTPUT CARTON-DETAIL-FILE                               02990025
030000                 EMPTY-CARTON-FILE.                               03000025
030100                                                                  03010025
030200     PERFORM 7000-READ-TRIP-ID-FILE.                              03020025
030300                                                                  03030025
030400******************************************************************03040025
030500*  BEGIN RETRIEVING THE NECESSARY DATA                            03050025
030600******************************************************************03060025
030700 2000-PROCESS-TRIP-ID-FILE.                                       03070025
030800                                                                  03080025
030900     INITIALIZE PC010-PCT-INTRANSIT-REC.                          03090025
031000                                                                  03100025
031100     DISPLAY 'TRIP ID BEING PROCESSED IS ' SU150-TRIP-ID.         03110025
031200                                                                  03120025
031300     SET PS-NOT-END-OF-SCAN-CTN-CSR TO TRUE.                      03130025
031400     PERFORM 2100-OPEN-SCAN-CTN-CSR.                              03140025
031500     PERFORM 2200-FETCH-SCAN-CTN-CSR.                             03150025
031600     PERFORM 2300-PROCESS-SCAN-CTN-CSR UNTIL                      03160025
031700             PS-END-OF-SCAN-CTN-CSR.                              03170025
031800     PERFORM 2400-CLOSE-SCAN-CTN-CSR.                             03180025
031900                                                                  03190025
032000     PERFORM 7000-READ-TRIP-ID-FILE.                              03200025
032100                                                                  03210025
032200                                                                  03220025
032300******************************************************************03230025
032400*  OPEN SCANNED CARTON CURSOR.                                    03240025
032500******************************************************************03250025
032600 2100-OPEN-SCAN-CTN-CSR.                                          03260025
032700                                                                  03270025
032800     MOVE SU150-TRIP-ID    TO SUT00121-SCN-OTBND-TRIP-ID.         03280025
032900                                                                  03290025
033000     EXEC SQL                                                     03300025
033100         OPEN SCAN-CTN-CSR                                        03310025
033200     END-EXEC.                                                    03320025
033300                                                                  03330025
033400     EVALUATE TRUE                                                03340025
033500         WHEN SQLCODE = ZERO                                      03350025
033600             CONTINUE                                             03360025
033700         WHEN SQLWARN0 NOT = SPACES                               03370025
033800         WHEN SQLCODE < ZERO                                      03380025
033900         WHEN SQLCODE > ZERO                                      03390025
034000             MOVE '2100-OPEN-SCAN-CTN-CSRCSR' TO PV-PARAGRAPH-NAME03400025
034100             MOVE 'SELECT SUT_OTBND_STR_SCN '                     03410025
034200                                    TO PV-DB2-OPERATION-ATTEMPTED 03420025
034300             PERFORM 9100-SQL-ABEND                               03430025
034400     END-EVALUATE.                                                03440025
034500                                                                  03450025
034600                                                                  03460025
034700******************************************************************03470025
034800*  FETCH SCANNED CARTON CURSOR ROW.                               03480025
034900******************************************************************03490025
035000 2200-FETCH-SCAN-CTN-CSR.                                         03500025
035100     EXEC SQL                                                     03510025
035200        FETCH SCAN-CTN-CSR                                        03520025
035300         INTO  :SUT00121-SHIPT-UNT-ID                             03530025
035400             , :SUT00121-SCN-LOC-NBR                              03540025
035500             , :SUT00121-SCN-TYP-CDE                              03550025
035600             , :SUT00121-ORIG-OTBND-TRIP-ID                       03560025
035700               :PV-ORIG-TRIP-ID-NULL-IND                          03570025
035800     END-EXEC.                                                    03580025
035900                                                                  03590025
036000     EVALUATE TRUE                                                03600025
036100         WHEN SQLCODE = ZERO                                      03610025
036200             MOVE SUT00121-SCN-LOC-NBR  TO  PC010-STR-NBR         03620025
036300             IF PV-ORIG-TRIP-ID-IS-NULL                           03630025
036400                 MOVE ZEROES  TO  SUT00121-ORIG-OTBND-TRIP-ID     03640025
036500             END-IF                                               03650025
036600         WHEN SQLCODE = +100                                      03660025
036700             SET PS-END-OF-SCAN-CTN-CSR    TO  TRUE               03670025
036800         WHEN SQLWARN0 NOT = SPACES                               03680025
036900         WHEN SQLCODE < ZERO                                      03690025
037000         WHEN SQLCODE > ZERO                                      03700025
037100             MOVE '2200-FETCH-SCAN-CTN-CSR' TO PV-PARAGRAPH-NAME  03710025
037200             MOVE 'SELECT SUT_OTBND_STR_SCN '                     03720025
037300                                   TO PV-DB2-OPERATION-ATTEMPTED  03730025
037400             PERFORM 9100-SQL-ABEND                               03740025
037500     END-EVALUATE.                                                03750025
037600                                                                  03760025
037700******************************************************************03770025
037800*  PROCESS SCANNED CARTON CURSOR ROW.                             03780025
037900*  DO NOT PROCESS TRAILER MISLOAD CARTONS (SSTM) PROCESSED BEFORE 03790025
038000*  STORE SCANNING WAS TURNED ON OR STORE EXPECTED WILL BE         03800025
038100*  ADJUSTED TWICE.                                                03810025
038200******************************************************************03820025
038300 2300-PROCESS-SCAN-CTN-CSR.                                       03830025
038400                                                                  03840025
038500     SET PS-TRIP-NOT-PROCESS-B4-SCAN-ON  TO TRUE.                 03850025
038600     IF SUT00121-SCN-TYP-CDE  = 'SSTM'                            03860025
038700         PERFORM 2350-TRIP-PROCESS-B4-SCAN-ON                     03870025
038800     END-IF.                                                      03880025
038900                                                                  03890025
039000     IF PS-TRIP-PROCESS-B4-SCAN-ON                                03900025
039100         DISPLAY 'CARTON    = ' SUT00121-SHIPT-UNT-ID             03910025
039200         DISPLAY 'STORE     = ' SUT00121-SCN-LOC-NBR              03920025
039300         DISPLAY 'SCN TYP   = ' SUT00121-SCN-TYP-CDE              03930025
039400         DISPLAY 'ORIG TRIP = ' SUT00121-ORIG-OTBND-TRIP-ID       03940025
039500     ELSE                                                         03950025
039600         SET PS-NOT-END-OF-PO-RCVR-CSR TO TRUE                    03960025
039700         PERFORM 5100-OPEN-PO-RCVR-CSR                            03970025
039800         PERFORM 5250-FETCH-PO-RCVR-CSR                           03980025
039900         IF PS-END-OF-PO-RCVR-CSR                                 03990025
040000             IF SUT00121-SCN-TYP-CDE  = 'SSNM'                    04000025
040100                 PERFORM 5500-EMPTY-CARTON                        04010025
040200             END-IF                                               04020025
040300         ELSE                                                     04030025
040400             PERFORM 5200-PROCESS-PO-RCVR-CSR UNTIL               04040025
040500                     PS-END-OF-PO-RCVR-CSR                        04050025
040600         END-IF                                                   04060025
040700         PERFORM 5300-CLOSE-PO-RCVR-CSR                           04070025
040800     END-IF.                                                      04080025
040900                                                                  04090025
041000     PERFORM 2200-FETCH-SCAN-CTN-CSR.                             04100025
041100                                                                  04110025
041200                                                                  04120025
041300******************************************************************04130025
041400*  CHECK IF TRAILER MISLOAD CARTONS (SSTM) WERE PROCESSED BEFORE  04140025
041500*  STORE SCANNING WAS TURNED ON, MEANING THAT STORE EXPECTED      04150025
041600*  WAS ALREADY ADJUSTED.                                          04160025
041700*  IF THEY WERE, THEN CARTON SCANNING SHOULD NOT RESULT IN        04170025
041800*  ADJUSTING STORE EXPECTED AGAIN.                                04180025
041900******************************************************************04190025
042000 2350-TRIP-PROCESS-B4-SCAN-ON.                                    04200025
042100                                                                  04210025
042200     PERFORM 2360-CALL-TSUOBTS-TMST.                              04220025
042300     IF PS-TSUOBTS-TMST-FOUND                                     04230025
042400         PERFORM 2370-CHECK-STORE-SCAN-TMST                       04240025
042500     ELSE                                                         04250025
042600         SET PS-TRIP-NOT-PROCESS-B4-SCAN-ON TO TRUE               04260025
042700     END-IF.                                                      04270025
042800                                                                  04280025
042900                                                                  04290025
043000******************************************************************04300025
043100*  CALL TSUOBTS TO GET TIMESTAMP OF ORIGINAL TRIP ID.             04310025
043200******************************************************************04320025
043300 2360-CALL-TSUOBTS-TMST.                                          04330025
043400                                                                  04340025
043500     EXEC SQL                                                     04350025
043600         SELECT OTBND_STAT_TMST                                   04360025
043700          INTO  :PV-SHIPPED-TMST                                  04370025
043800          FROM  TSUOBTS                                           04380025
043900         WHERE  OTBND_TRIP_ID   = :SUT00121-ORIG-OTBND-TRIP-ID    04390025
044000           AND  TRIP_STAT_CDE   = 'DS'                            04400025
044100         WITH UR                                                  04410025
044200     END-EXEC.                                                    04420025
044300                                                                  04430025
044400     EVALUATE TRUE                                                04440025
044500         WHEN SQLCODE = ZERO                                      04450025
044600             SET PS-TSUOBTS-TMST-FOUND      TO TRUE               04460025
044700         WHEN SQLCODE = +100                                      04470025
044800             SET PS-TSUOBTS-TMST-NOT-FOUND  TO TRUE               04480025
044900         WHEN SQLWARN0 NOT = SPACES                               04490025
045000         WHEN SQLCODE < ZERO                                      04500025
045100         WHEN SQLCODE > ZERO                                      04510025
045200             MOVE '2360-CALL-TSUOBTS-TMST' TO PV-PARAGRAPH-NAME   04520025
045300             MOVE 'SELECT TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 04530025
045400             PERFORM 9100-SQL-ABEND                               04540025
045500     END-EVALUATE.                                                04550025
045600                                                                  04560025
045700                                                                  04570025
045800******************************************************************04580025
045900*  CHECK IF TRIP PROCESSED BEFORE STORE SCANNING TURNED ON        04590025
046000******************************************************************04600025
046100 2370-CHECK-STORE-SCAN-TMST.                                      04610025
046200                                                                  04620025
046300     EXEC SQL                                                     04630025
046400        SELECT  D.ATTR_ELEM_TMST                                  04640025
046500          INTO :PV-STORE-SCAN-ON-TMST                             04650025
046600          FROM  WST_INTGRTN_TYP   A                               04660025
046700             ,  WST_ATTR_DEFN     B                               04670025
046800             ,  WST_ATTR_ELEM     C                               04680025
046900             ,  WST_ATTR_ELEM     D                               04690025
047000         WHERE  C.ATTR_ELEM_NBR      = :SUT00121-SCN-LOC-NBR      04700025
047100           AND  A.INTGRTN_TYP_CDE    = 'STOTBNDUPD'               04710025
047200           AND  A.INTGRTN_TYP_CDE    = B.INTGRTN_TYP_CDE          04720025
047300           AND  B.ATTR_DEFN_SEQ_NBR  = 1                          04730025
047400           AND  B.INTGRTN_TYP_CDE    = C.INTGRTN_TYP_CDE          04740025
047500           AND  C.ATTR_DEFN_SEQ_NBR  = 1                          04750025
047600           AND  B.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          04760025
047700           AND  D.ATTR_DEFN_SEQ_NBR  = 2                          04770025
047800           AND  C.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          04780025
047900           AND  C.ATTR_ELEM_SEQ_NBR  = D.ATTR_ELEM_SEQ_NBR        04790025
048000         WITH UR                                                  04800025
048100       END-EXEC.                                                  04810025
048200                                                                  04820025
048300     EVALUATE TRUE                                                04830025
048400         WHEN SQLCODE = ZERO                                      04840025
048500             IF PV-SHIPPED-TMST < PV-STORE-SCAN-ON-TMST           04850025
048600*                TRIP PROCESSED BEFORE STORE SCANNING TURNED ON   04860025
048700                 SET PS-TRIP-PROCESS-B4-SCAN-ON     TO TRUE       04870025
048800                 DISPLAY 'DROP SE RECORD IN PARA 2370-'           04880025
048900             ELSE                                                 04890025
049000*                TRIP PROCESSED AFTER STORE SCANNING TURNED ON    04900025
049100                 SET PS-TRIP-NOT-PROCESS-B4-SCAN-ON TO TRUE       04910025
049200             END-IF                                               04920025
049300         WHEN SQLCODE = +100                                      04930025
049400             PERFORM 2380-READ-TKRPRPM                            04940025
049500         WHEN SQLWARN0 NOT = SPACES                               04950025
049600         WHEN SQLCODE < ZERO                                      04960025
049700         WHEN SQLCODE > ZERO                                      04970025
049800             MOVE '2370-CHECK-STORE-SCAN-TMST'                    04980025
049900                                           TO PV-PARAGRAPH-NAME   04990025
050000             MOVE 'SELECT WST TBLS' TO PV-DB2-OPERATION-ATTEMPTED 05000025
050100             PERFORM 9100-SQL-ABEND                               05010025
050200     END-EVALUATE.                                                05020025
050300                                                                  05030025
050400                                                                  05040025
050500******************************************************************05050025
050600*  READ TKRPRPM TO DETERMINE IF ALL STORES, NO STORES OR SOME     05060025
050700*  STORES ARE TURNED ON FOR STORE SCANNING IF STORE BEING         05070025
050800*  PROCESSED WASN'T FOUND IN WST TABLES.                          05080025
050900******************************************************************05090025
051000 2380-READ-TKRPRPM.                                               05100025
051100                                                                  05110025
051200     EXEC SQL                                                     05120025
051300         SELECT  FUNC_TXT                                         05130025
051400                ,FUNC_BEG_TMST                                    05140025
051500           INTO  :KRPRPM-FUNC-TXT                                 05150025
051600                ,:KRPRPM-FUNC-BEG-TMST                            05160025
051700           FROM  TKRPRPM                                          05170025
051800          WHERE  LOC_ID            = 90                           05180025
051900            AND  INTFC_SYS_CDE     = 'KHL'                        05190025
052000            AND  SYS_PRC_FUNC_CDE  = 'STRSCN'                     05200025
052100            AND  FUNC_PRC_STAT_CDE = 'AC'                         05210025
052200          WITH UR                                                 05220025
052300     END-EXEC.                                                    05230025
052400                                                                  05240025
052500     EVALUATE TRUE                                                05250025
052600         WHEN SQLCODE = ZERO                                      05260025
052700             IF KRPRPM-FUNC-TXT = 'A'                             05270025
052800                 IF PV-SHIPPED-TMST < KRPRPM-FUNC-BEG-TMST        05280025
052900*                  TRIP PROCESSED BEFORE STORE SCANNING TURNED ON 05290025
053000                     SET PS-TRIP-PROCESS-B4-SCAN-ON     TO TRUE   05300025
053100                     DISPLAY 'DROP SE RECORD IN PARA 2380- (A)'   05310025
053200                 ELSE                                             05320025
053300*                  TRIP PROCESSED AFTER STORE SCANNING TURNED ON  05330025
053400                     SET PS-TRIP-NOT-PROCESS-B4-SCAN-ON TO TRUE   05340025
053500                 END-IF                                           05350025
053600             ELSE                                                 05360025
053700*                'E' OR 'N' - DO NOT PROCESS                      05370025
053800                 SET PS-TRIP-PROCESS-B4-SCAN-ON TO TRUE           05380025
053900                 DISPLAY 'DROP SE RECORD IN PARA 2380- (E/N)'     05390025
054000             END-IF                                               05400025
054100         WHEN SQLCODE = +100                                      05410025
054200             SET PS-TRIP-NOT-PROCESS-B4-SCAN-ON TO TRUE           05420025
054300         WHEN SQLWARN0 NOT = SPACES                               05430025
054400         WHEN SQLCODE < ZERO                                      05440025
054500         WHEN SQLCODE > ZERO                                      05450025
054600             MOVE '2380-READ-TKRPRPM'      TO PV-PARAGRAPH-NAME   05460025
054700             MOVE 'SELECT TKRPRPM ' TO PV-DB2-OPERATION-ATTEMPTED 05470025
054800             PERFORM 9100-SQL-ABEND                               05480025
054900     END-EVALUATE.                                                05490025
055000                                                                  05500025
055100                                                                  05510025
055200******************************************************************05520025
055300*  CLOSE SCANNED CARTON CURSOR.                                   05530025
055400******************************************************************05540025
055500 2400-CLOSE-SCAN-CTN-CSR.                                         05550025
055600     EXEC SQL                                                     05560025
055700        CLOSE SCAN-CTN-CSR                                        05570025
055800     END-EXEC.                                                    05580025
055900                                                                  05590025
056000     EVALUATE TRUE                                                05600025
056100         WHEN SQLCODE = ZERO                                      05610025
056200             CONTINUE                                             05620025
056300         WHEN SQLWARN0 NOT = SPACES                               05630025
056400         WHEN SQLCODE < ZERO                                      05640025
056500         WHEN SQLCODE > ZERO                                      05650025
056600             MOVE '2400-CLOSE-SCAN-CTN-CSR' TO PV-PARAGRAPH-NAME  05660025
056700             MOVE 'SELECT SUT_OTBND_STR_SCN'                      05670025
056800                                   TO PV-DB2-OPERATION-ATTEMPTED  05680025
056900             PERFORM 9100-SQL-ABEND                               05690025
057000     END-EVALUATE.                                                05700025
057100                                                                  05710025
057200                                                                  05720025
057300*----------------------------------------------------------------*05730025
057400* OPEN CURSOR                                                     05740025
057500*----------------------------------------------------------------*05750025
057600 5100-OPEN-PO-RCVR-CSR.                                           05760025
057700     INITIALIZE DCLSUT00028.                                      05770025
057800     EXEC SQL                                                     05780025
057900         OPEN PO-RCVR-CSR                                         05790025
058000     END-EXEC.                                                    05800025
058100                                                                  05810025
058200     EVALUATE TRUE                                                05820025
058300         WHEN SQLCODE = ZERO                                      05830025
058400             CONTINUE                                             05840025
058500         WHEN SQLWARN0 NOT = SPACES                               05850025
058600         WHEN SQLCODE < ZERO                                      05860025
058700         WHEN SQLCODE > ZERO                                      05870025
058800             MOVE '5100-OPEN-PO-RCVR-CSR' TO PV-PARAGRAPH-NAME    05880025
058900             MOVE 'SELECT SUT_OTBND_UPC '                         05890025
059000                                    TO PV-DB2-OPERATION-ATTEMPTED 05900025
059100             PERFORM 9100-SQL-ABEND                               05910025
059200     END-EVALUATE.                                                05920025
059300                                                                  05930025
059400*----------------------------------------------------------------*05940025
059500* PROCESS PO-RCVR CURSOR                                          05950025
059600*----------------------------------------------------------------*05960025
059700 5200-PROCESS-PO-RCVR-CSR.                                        05970025
059800     IF SUT00028-TRN-TYP-CDE = 'CS'                               05980025
059900         CONTINUE                                                 05990025
060000     ELSE                                                         06000025
060100         IF SUT00028-TRN-TYP-CDE = 'FX'                           06010025
060200*            SET PS-END-OF-PO-RCVR-CSR TO TRUE                    06020025
060300             CONTINUE                                             06030025
060400         ELSE                                                     06040025
060500             IF SUT00028-TRN-NBR    = PV-PO-NBR AND               06050025
060600                 SUT00028-RCVR-SEQ-NBR = PV-RCVR-SEQ-NBR          06060025
060700                 MOVE SUT00028-RCVR-SEQ-NBR TO PC010-RCVR-SEQ-NBR 06070025
060800             ELSE                                                 06080025
060900                 IF SUT00028-TRN-NBR = ZERO                       06090025
061000                   MOVE SUT00028-RCVR-SEQ-NBR                     06100025
061100                                            TO PC010-RCVR-SEQ-NBR 06110025
061200                 ELSE                                             06120025
061300                     IF SUT00028-RCVR-SEQ-NBR = ZERO              06130025
061400                         PERFORM 5400-GET-REC-SEQ-NBR             06140025
061500                     ELSE                                         06150025
061600                         MOVE SUT00028-RCVR-SEQ-NBR TO            06160025
061700                                           PC010-RCVR-SEQ-NBR     06170025
061800                     END-IF                                       06180025
061900                 END-IF                                           06190025
062000             END-IF                                               06200025
062100         END-IF                                                   06210025
062200     END-IF.                                                      06220025
062300                                                                  06230025
062400     IF SUT00028-TRN-TYP-CDE = 'FX'                               06240025
062500         CONTINUE                                                 06250025
062600     ELSE                                                         06260025
062700         PERFORM 8000-WRITE-OUTPUT                                06270025
062800         MOVE SUT00028-TRN-NBR      TO PV-PO-NBR                  06280025
062900         MOVE SUT00028-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR            06290025
063000*        PERFORM 5250-FETCH-PO-RCVR-CSR                           06300025
063100     END-IF.                                                      06310025
063200     PERFORM 5250-FETCH-PO-RCVR-CSR.                              06320025
063300                                                                  06330025
063400*----------------------------------------------------------------*06340025
063500* FETCH PO-RCVR CURSOR                                            06350025
063600*----------------------------------------------------------------*06360025
063700 5250-FETCH-PO-RCVR-CSR.                                          06370025
063800     EXEC SQL                                                     06380025
063900        FETCH PO-RCVR-CSR                                         06390025
064000         INTO   :SUT00028-SHPD-UNT-QTY                            06400025
064100               ,:SUT00028-UPC-NBR                                 06410025
064200               ,:SUT00028-TRN-LNE-NBR                             06420025
064300               ,:SUT00028-TRN-NBR                                 06430025
064400               ,:SUT00028-RCVR-SEQ-NBR                            06440025
064500               ,:SUT00028-TRN-TYP-CDE                             06450025
064600               ,:XLT00003-SKU-NBR                                 06460025
064700               ,:XLT00003-INTR-UPC-ID                             06470025
064800     END-EXEC.                                                    06480025
064900                                                                  06490025
065000     EVALUATE TRUE                                                06500025
065100         WHEN SQLCODE = ZERO                                      06510025
065200             COMPUTE PC010-IN-TRNST-QTY =                         06520025
065300                     SUT00028-SHPD-UNT-QTY * -1                   06530025
065400             END-COMPUTE                                          06540025
065500             MOVE SUT00028-UPC-NBR      TO PC010-UPC-NBR          06550025
065600             MOVE SUT00028-TRN-NBR      TO PC010-PO-NBR           06560025
065700             MOVE SUT00028-TRN-LNE-NBR  TO PC010-TRN-LNE-NBR      06570025
065800             MOVE SUT00028-TRN-TYP-CDE  TO PC010-OTB-TYP-CDE      06580025
065900             MOVE XLT00003-INTR-UPC-ID  TO PC010-INTR-UPC-ID      06590025
066000             ADD  +1                    TO PV-CARTON-COUNT        06600025
066100                                                                  06610025
066200         WHEN SQLCODE = +100                                      06620025
066300             MOVE ZEROES                TO PC010-IN-TRNST-QTY     06630025
066400                                           PC010-UPC-NBR          06640025
066500                                           PC010-PO-NBR           06650025
066600                                           PC010-RCVR-SEQ-NBR     06660025
066700                                           PC010-TRN-LNE-NBR      06670025
066800             SET PS-END-OF-PO-RCVR-CSR     TO  TRUE               06680025
066900         WHEN SQLWARN0 NOT = SPACES                               06690025
067000         WHEN SQLCODE < ZERO                                      06700025
067100         WHEN SQLCODE > ZERO                                      06710025
067200             MOVE '5200-FETCH-PO-RCVR-CSR' TO PV-PARAGRAPH-NAME   06720025
067300             MOVE 'SELECT SUT_OTBND_UPC'                          06730025
067400                                   TO PV-DB2-OPERATION-ATTEMPTED  06740025
067500             PERFORM 9100-SQL-ABEND                               06750025
067600     END-EVALUATE.                                                06760025
067700                                                                  06770025
067800*----------------------------------------------------------------*06780025
067900* CLOSE PO-RCVR CURSOR                                            06790025
068000*----------------------------------------------------------------*06800025
068100 5300-CLOSE-PO-RCVR-CSR.                                          06810025
068200     EXEC SQL                                                     06820025
068300        CLOSE PO-RCVR-CSR                                         06830025
068400     END-EXEC.                                                    06840025
068500                                                                  06850025
068600     EVALUATE TRUE                                                06860025
068700         WHEN SQLCODE = ZERO                                      06870025
068800             CONTINUE                                             06880025
068900         WHEN SQLWARN0 NOT = SPACES                               06890025
069000         WHEN SQLCODE < ZERO                                      06900025
069100         WHEN SQLCODE > ZERO                                      06910025
069200             MOVE '5300-CLOSE-PO-RCVR-CSR' TO PV-PARAGRAPH-NAME   06920025
069300             MOVE 'SELECT SUT_OTBND_UPC'                          06930025
069400                                   TO PV-DB2-OPERATION-ATTEMPTED  06940025
069500             PERFORM 9100-SQL-ABEND                               06950025
069600     END-EVALUATE.                                                06960025
069700                                                                  06970025
069800*----------------------------------------------------------------*06980025
069900* GET REC SEQ NBR                                                 06990025
070000*----------------------------------------------------------------*07000025
070100 5400-GET-REC-SEQ-NBR.                                            07010025
070200     EXEC SQL                                                     07020025
070300         SELECT  B.REC_SEQ_NBR                                    07030025
070400          INTO   :PKSLIP-REC-SEQ-NBR                              07040025
070500          FROM  SUT_OTBND_VND A                                   07050025
070600               ,TPKSLIP B                                         07060025
070700         WHERE  A.SHIPT_UNT_ID  =  :SUT00121-SHIPT-UNT-ID         07070025
070800           AND  A.PO_NBR        =  B.PO_NBR                       07080025
070900           AND  A.PKSL_SEQ_NBR  =  B.SEQ_NBR                      07090025
071000           AND  B.VER_STAT_CDE  =  :PC-A                          07100025
071100           WITH UR                                                07110025
071200     END-EXEC.                                                    07120025
071300                                                                  07130025
071400     EVALUATE TRUE                                                07140025
071500         WHEN SQLCODE = ZERO                                      07150025
071600             MOVE PKSLIP-REC-SEQ-NBR  TO  PC010-RCVR-SEQ-NBR      07160025
071700                                          SUT00028-RCVR-SEQ-NBR   07170025
071800         WHEN SQLCODE = +100                                      07180025
071900             MOVE ZERO                TO  PC010-RCVR-SEQ-NBR      07190025
072000                                          SUT00028-RCVR-SEQ-NBR   07200025
072100         WHEN SQLWARN0 NOT = SPACES                               07210025
072200         WHEN SQLCODE < ZERO                                      07220025
072300         WHEN SQLCODE > ZERO                                      07230025
072400             MOVE '5400-GET-REC-SEQ-NBR ' TO PV-PARAGRAPH-NAME    07240025
072500             MOVE 'SELECT TPKSLIP ' TO PV-DB2-OPERATION-ATTEMPTED 07250025
072600             PERFORM 9100-SQL-ABEND                               07260025
072700     END-EVALUATE.                                                07270025
072800                                                                  07280025
072900*----------------------------------------------------------------*07290025
073000* WRITE EMPTY CARTON RECORD.                                      07300025
073100*----------------------------------------------------------------*07310025
073200 5500-EMPTY-CARTON.                                               07320025
073300                                                                  07330025
073400     INITIALIZE PV-EMPTY-CARTON-REC.                              07340025
073500                                                                  07350025
073600     MOVE SUT00121-SHIPT-UNT-ID       TO SU056-SHIPT-UNT-ID       07360025
073700     MOVE SU150-TRIP-ID               TO SU056-OTBND-TRIP-ID      07370025
073800     EXEC SQL                                                     07380025
073900         SET :SU056-PROCESS-TIMESTAMP = CURRENT TIMESTAMP         07390025
074000     END-EXEC.                                                    07400025
074100                                                                  07410025
074200     MOVE SU150-EVENT-TMST            TO SU056-EVENT-TMST-SU.     07420025
074300                                                                  07430025
074400     MOVE SUT00121-SCN-LOC-NBR        TO SU056-STR-NBR.           07440025
074500     MOVE 'UN'                        TO SU056-TRN-TYP-CDE        07450025
074600     SET  SU056-NOT-SHIPPED-FROM-DC   TO TRUE.                    07460025
074700     SET  SU056-UNLOADED-AT-STORE     TO TRUE.                    07470025
074800     MOVE 'SE'                        TO SU056-TRN-CLSN-CDE       07480025
074900                                                                  07490025
075000     PERFORM 8100-WRITE-EMPTY-CARTON-REC.                         07500025
075100                                                                  07510025
075200                                                                  07520025
075300******************************************************************07530025
075400*  READ INPUT FILE.                                               07540025
075500******************************************************************07550025
075600 7000-READ-TRIP-ID-FILE.                                          07560025
075700                                                                  07570025
075800      INITIALIZE SU150-SCANNED-TRIP-ID-REC.                       07580025
075900                                                                  07590025
076000      READ TRIP-ID-FILE INTO                                      07600025
076100          SU150-SCANNED-TRIP-ID-REC                               07610025
076200            AT END SET PS-END-OF-FILE TO TRUE.                    07620025
076300                                                                  07630025
076400      IF PS-END-OF-FILE                                           07640025
076500         CONTINUE                                                 07650025
076600      ELSE                                                        07660025
076700         ADD +1 TO PV-READ-COUNTER                                07670025
076800      END-IF.                                                     07680025
076900                                                                  07690025
077000******************************************************************07700025
077100*  WRITE OUTPUT FILE.                                             07710025
077200******************************************************************07720025
077300 8000-WRITE-OUTPUT.                                               07730025
077400                                                                  07740025
077500     MOVE SU150-TRIP-ID               TO PC010-TRIP-ID.           07750025
077600     MOVE PC-CURRENT-PROGRAM-NAME     TO PC010-UPD-USR-ID.        07760025
077700     MOVE SU150-EVENT-TMST            TO PC010-EVENT-TMST.        07770025
077800     SET PC010-UNLOAD-ST              TO TRUE.                    07780025
077900     SET PC010-TRN-STR-EXPECTED       TO TRUE.                    07790025
078000     SET PC010-NOT-SHIPPED-FROM-DC    TO TRUE.                    07800025
078100     SET PC010-UNLOADED-AT-STORE      TO TRUE.                    07810025
078200                                                                  07820025
078300     WRITE  CARTON-DETAIL-RECORD                                  07830025
078400      FROM  PC010-PCT-INTRANSIT-REC.                              07840025
078500     ADD    +1   TO PV-UPC-COUNT.                                 07850025
078600                                                                  07860025
078700                                                                  07870025
078800******************************************************************07880025
078900*  WRITE EMPTY CARTON RECORD AND INCREMENT RECORD COUNTER.        07890025
079000******************************************************************07900025
079100 8100-WRITE-EMPTY-CARTON-REC.                                     07910025
079200                                                                  07920025
079300     WRITE EMPTY-CARTON-RECORD FROM PV-EMPTY-CARTON-REC           07930025
079400     ADD 1                            TO PV-EMPTY-CARTON-COUNT.   07940025
079500                                                                  07950025
079600******************************************************************07960025
079700*  CLOSE INPUT FILE.  DISPLAY COUNTERS.                           07970025
079800******************************************************************07980025
079900 9000-EOJ-ROUTINE.                                                07990025
080000     CLOSE TRIP-ID-FILE                                           08000025
080100           CARTON-DETAIL-FILE                                     08010025
080200           EMPTY-CARTON-FILE.                                     08020025
080300                                                                  08030025
080400     MOVE PV-READ-COUNTER TO PV-DISPLAY-COUNT.                    08040025
080500     DISPLAY 'TOTAL RECORDS READ.: '  PV-DISPLAY-COUNT.           08050025
080600     MOVE PV-UPC-COUNT    TO PV-DISPLAY-COUNT.                    08060025
080700     DISPLAY 'TOTAL RECORDS OUT..: '  PV-DISPLAY-COUNT.           08070025
080800     MOVE PV-CARTON-COUNT TO PV-DISPLAY-COUNT.                    08080025
080900     DISPLAY 'TOTAL TRIP CARTONS.: '  PV-DISPLAY-COUNT.           08090025
081000                                                                  08100025
081100     MOVE PV-EMPTY-CARTON-COUNT TO PV-DISPLAY-COUNT.              08110025
081200     DISPLAY 'TOTAL EMPTY CARTONS.: '  PV-DISPLAY-COUNT.          08120025
081300                                                                  08130025
081400     DISPLAY '*****  SUKUT162 ENDED  *****'.                      08140025
081500                                                                  08150025
081600******************************************************************08160025
081700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    08170025
081800*  ERROR OR WARNING CODE OCCURS.                                  08180025
081900******************************************************************08190025
082000 9100-SQL-ABEND.                                                  08200025
082100     DISPLAY '9100-SQL-ABEND'.                                    08210025
082200     DISPLAY '** ABEND     **'.                                   08220025
082300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08230025
082400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08240025
082500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     08250025
082600     DISPLAY '** TRIP ID   ** = ' SU150-TRIP-ID.                  08260025
082700                                                                  08270025
082800******************************************************************08280025
082900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    08290025
083000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         08300025
083100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08310025
083200* FORMAT.                                                         08320025
083300******************************************************************08330025
083400     COPY DPPD004.                                                08340025
083500                                                                  08350025
083600     MOVE +4013                  TO ABEND-CODE.                   08360025
083700     CALL 'ILBOABN0' USING ABEND-CODE.                            08370025
083800                                                                  08380025
