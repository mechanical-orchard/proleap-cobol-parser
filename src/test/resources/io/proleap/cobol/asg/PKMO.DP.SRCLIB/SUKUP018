000200***************************************************************** 00020001
000300 IDENTIFICATION DIVISION.                                         00030001
000400***************************************************************** 00040001
000500*                                                                 00050001
000600 PROGRAM-ID.             SUKUP018.                                00060001
000700 AUTHOR.                 PATRICK BURKE.                           00070001
000800 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00080001
000900 DATE-WRITTEN.           JANUARY 2005.                            00090001
001000 DATE-COMPILED.                                                   00100001
001100*                                                                 00110001
001200***************************************************************** 00120001
001300* THIS PROGRAM WILL BE USED TO PURGE CARTON PROCESSED TABLE       00130001
001400*  (SUT_LBL_REQ_MSG) OF OLD DATA DETERMINED BY PARM VALUE.        00140003
001500***************************************************************** 00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700***************************************************************** 00170001
001800 CONFIGURATION SECTION.                                           00180001
001900 SOURCE-COMPUTER.                        IBM-3090.                00190001
002000 OBJECT-COMPUTER.                        IBM-3090.                00200001
002100 INPUT-OUTPUT SECTION.                                            00210001
002200 FILE-CONTROL.                                                    00220001
002300                                                                  00230001
002400     SELECT EXTRACT-FILE                                          00240001
002500         ASSIGN TO INP01.                                         00250001
002600/                                                                 00260001
002700***************************************************************** 00270001
002800 DATA DIVISION.                                                   00280001
002900***************************************************************** 00290001
003000 FILE SECTION.                                                    00300001
003100                                                                  00310001
003200 FD  EXTRACT-FILE                                                 00320001
003300     RECORDING MODE IS F                                          00330001
003400     LABEL RECORDS ARE STANDARD                                   00340001
003500     BLOCK CONTAINS 0 RECORDS.                                    00350001
003600 01  EXTRACT-RECORD                   PIC X(50).                  00360004
003700/                                                                 00370001
003800***************************************************************** 00380001
003900 WORKING-STORAGE SECTION.                                         00390001
004000***************************************************************** 00400001
004100                                                                  00410001
004200 01  PS-SWITCHES.                                                 00420001
004300     05  PS-END-OF-INPUT-FILE-SW      PIC X(01) VALUE 'N'.        00430001
004400         88  PS-END-OF-INPUT                    VALUE 'Y'.        00440001
004500         88  PS-NOT-END-OF-INPUT                VALUE 'N'.        00450001
004600                                                                  00460001
004700 01  PV-VARIABLES.                                                00470001
004800     05  PV-COUNT                     PIC  9(09) VALUE ZERO.      00480001
004900     05  PV-READ-COUNT                PIC  9(09) VALUE ZERO.      00490001
005000     05  PV-DELETE-COUNT              PIC  9(09) VALUE ZERO.      00500001
005100     05  PV-DUPLICATE-CNT             PIC  9(09) VALUE ZERO.      00510001
005200     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00520001
005300     05  PV-NOT-FOUND-COUNT           PIC  9(09) VALUE ZERO.      00530001
005400     05  PV-COMMIT-COUNT              PIC  9(09) VALUE ZERO.      00540001
005500     05  PV-SKIP-CNT                  PIC  9(09) VALUE ZERO.      00550001
005600     05  PV-PREVIOUS-SML              PIC  9(18) VALUE ZERO.      00560001
005700                                                                  00570001
005800******************************************************************00580001
005900 01  PV-ABEND-FIELDS.                                             00590001
006000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00600001
006100                                                 COMP SYNC.       00610001
006200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUP018'.00620002
006300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00630001
006400     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    00640001
006500     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    00650001
006600     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    00660001
006700     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    00670001
006800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00680001
006900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00690001
007000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00700001
007100     05  PV-DB2-FUNCTION              PIC  X(50) VALUE SPACES.    00710001
007200/                                                                 00720001
007300 01  PC-CONSTANTS.                                                00730001
007400     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'SUKUP018'. 00740002
007500     05  PC-ROW-NOT-FOUND             PIC S9(04)    VALUE +100    00750001
007600                                                   COMP SYNC.     00760001
007700     05  PC-COMMIT-HOLD               PIC 9(3)  VALUE 100.        00770001
007800     05  PC-COUNT-HOLD                PIC 9(9)  VALUE 100000.     00780001
007900/                                                                 00790001
008000******************************************************************00800001
008100*  EXTRACT LAYOUT FOR THE LABEL REQUEST PURGE.                    00810002
008200******************************************************************00820001
008300     COPY SURD052.                                                00830002
008400*                                                                 00840001
008600******************************************************************00860001
008700*   DB2 SQL COMMUNICATION AREA                                    00870001
008800******************************************************************00880001
008900     EXEC SQL                                                     00890001
009000         INCLUDE SQLCA                                            00900001
009100     END-EXEC.                                                    00910001
009200*                                                                 00920001
009300     COPY SQLCA2.                                                 00930001
009400*                                                                 00940001
009410******************************************************************00941002
009420*   LABEL REQUEST TABLE                                           00942002
009430******************************************************************00943002
009440     EXEC SQL                                                     00944002
009450          INCLUDE SUT00043                                        00945002
009460     END-EXEC.                                                    00946002
009470                                                                  00947002
010300******************************************************************01030001
010400 PROCEDURE DIVISION.                                              01040001
010500******************************************************************01050001
010600 0000-MAINLINE.                                                   01060001
010700                                                                  01070001
010800     PERFORM 1000-INITIALIZE.                                     01080001
010900                                                                  01090001
011000     PERFORM 2000-PROCESS-EXTRACT                                 01100001
011100         UNTIL PS-END-OF-INPUT.                                   01110001
011200                                                                  01120001
011300     PERFORM 9000-EOJ.                                            01130001
011400                                                                  01140001
011500      GOBACK.                                                     01150001
011600                                                                  01160001
011700******************************************************************01170001
011800*  INITIALIZATION TASKS.                                          01180001
011900*    -- OPEN INPUT FILE                                           01190001
012000*    -- READ FILE                                                 01200001
012100******************************************************************01210001
012200 1000-INITIALIZE.                                                 01220001
012300                                                                  01230001
012400     OPEN INPUT  EXTRACT-FILE.                                    01240001
012500                                                                  01250001
012600     PERFORM 2100-READ-EXTRACT.                                   01260001
012700/                                                                 01270001
012800******************************************************************01280001
012900 2000-PROCESS-EXTRACT.                                            01290001
013000******************************************************************01300001
013100*                                                                 01310001
013200     IF  PV-COUNT  <  PC-COUNT-HOLD                               01320001
013300         CONTINUE                                                 01330001
013400     ELSE                                                         01340001
013500         MOVE PV-READ-COUNT  TO  PV-DISPLAY-COUNT                 01350001
013600         DISPLAY 'READ:  '       PV-DISPLAY-COUNT                 01360001
013700         MOVE  ZEROES  TO        PV-COUNT                         01370001
013800     END-IF.                                                      01380001
013900                                                                  01390001
014600     PERFORM 8000-DELETE-LABEL-RECS.                              01460002
014700     ADD +1 TO PV-COMMIT-COUNT.                                   01470002
015000                                                                  01500001
015300     IF PV-COMMIT-COUNT > PC-COMMIT-HOLD                          01530001
015400         PERFORM 2200-COMMIT-DELETE                               01540001
015500     END-IF.                                                      01550001
015600                                                                  01560001
015700     PERFORM 2100-READ-EXTRACT.                                   01570001
015800*                                                                 01580001
015900******************************************************************01590001
016000*  READ NEXT INPUT FILE RECORD.                                   01600001
016100******************************************************************01610001
016200 2100-READ-EXTRACT.                                               01620001
016300                                                                  01630001
016400     READ EXTRACT-FILE INTO SU052-EXTRACT-RECORD                  01640002
016500        AT END                                                    01650001
016600           SET PS-END-OF-INPUT TO TRUE                            01660001
016700        NOT AT END                                                01670001
016800           ADD +1                   TO PV-READ-COUNT              01680001
016900                                       PV-COUNT                   01690001
017000     END-READ.                                                    01700001
017100*                                                                 01710001
017200******************************************************************01720001
017300* COMMIT THE DELETE FROM ERROR TABLE                              01730001
017400******************************************************************01740001
017500 2200-COMMIT-DELETE.                                              01750001
017600                                                                  01760001
017700      EXEC SQL                                                    01770001
017800          COMMIT                                                  01780001
017900      END-EXEC.                                                   01790001
018000                                                                  01800001
018100      MOVE +0 TO PV-COMMIT-COUNT.                                 01810001
018200                                                                  01820001
018300*                                                                 01830001
018400******************************************************************01840001
018500* DELETE THE ROW FROM THE LABEL REQUEST TABLE (SUT00043).         01850002
018600******************************************************************01860001
018700 8000-DELETE-LABEL-RECS.                                          01870002
018800                                                                  01880001
018900     EXEC SQL                                                     01890001
019000          DELETE                                                  01900001
019100            FROM  SUT_LBL_REQ_MSG                                 01910002
019200           WHERE  DC_NBR           = :SU052-DC-NBR                01920002
019210            AND   ACM_LBL_STA_NBR  = :SU052-ACM-LBL-STA-NBR       01921003
019220            AND   ACM_MSG_RCV_TMST = :SU052-ACM-MSG-RCV-TMST      01922003
019300     END-EXEC.                                                    01930001
019400                                                                  01940001
019500     EVALUATE TRUE                                                01950001
019600         WHEN SQLCODE = 0                                         01960001
019700             ADD +1           TO PV-DELETE-COUNT                  01970001
019800         WHEN SQLCODE = +100                                      01980001
019900             ADD +1           TO PV-NOT-FOUND-COUNT               01990001
020000         WHEN SQLCODE < 0                                         02000001
020100         WHEN SQLCODE > 0                                         02010001
020200         WHEN SQLWARN0 = 'W'                                      02020001
020300             MOVE '8000-DELETE-LABEL-RECS'                        02030002
020400                         TO PV-ABEND-PARAGRAPH                    02040001
020500             MOVE 'DELETE OF SUT_LBL_REQ_MSG'                     02050002
020600                         TO PV-DB2-FUNCTION                       02060001
020700             PERFORM 9200-SQL-ABEND                               02070001
020800     END-EVALUATE.                                                02080001
020900/                                                                 02090001
021000******************************************************************02100001
021100*CLOSE INPUT FILE.                                                02110001
021200******************************************************************02120001
021300 9000-EOJ.                                                        02130001
021400*                                                                 02140001
021500     CLOSE EXTRACT-FILE.                                          02150001
021600                                                                  02160001
021700     MOVE PV-READ-COUNT      TO PV-DISPLAY-COUNT.                 02170001
021800     DISPLAY 'READ:         '   PV-DISPLAY-COUNT.                 02180001
021900     MOVE PV-DELETE-COUNT    TO PV-DISPLAY-COUNT.                 02190001
022000     DISPLAY 'DELETE:       '   PV-DISPLAY-COUNT.                 02200001
022100     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 02210001
022200     DISPLAY 'NOT FOUND     '   PV-DISPLAY-COUNT.                 02220001
022700                                                                  02270001
022800/                                                                 02280001
022900******************************************************************02290001
023000 9200-SQL-ABEND.                                                  02300001
023100******************************************************************02310001
023200                                                                  02320001
023300     MOVE SQLCODE                     TO SQLCODE2.                02330001
023400     MOVE SQLERRD(3)                  TO SQLERRD3.                02340001
023500                                                                  02350001
023600     DISPLAY '** ABEND **         ** = SQLERROR'.                 02360001
023700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02370001
023800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             02380001
023900     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                02390001
024000     DISPLAY '*** MESSAGE     = ' PV-DB2-OPERATION-MESSAGE-1.     02400001
024100     DISPLAY '***             = ' PV-DB2-OPERATION-MESSAGE-2.     02410001
024200     DISPLAY '***             = ' PV-DB2-OPERATION-MESSAGE-3.     02420001
024300                                                                  02430001
024400     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                02440001
024500     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                02450001
024600     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 02460001
024700     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                02470001
024800                                                                  02480001
024900                                                                  02490001
025000     MOVE +4013                       TO PV-ABEND-CODE.           02500001
025100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02510001
025200                                                                  02520001
