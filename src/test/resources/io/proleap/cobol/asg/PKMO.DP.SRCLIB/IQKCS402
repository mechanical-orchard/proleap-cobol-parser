000100*-----------------------*                                         00010086
000200 IDENTIFICATION DIVISION.                                         00020086
000300*-----------------------*                                         00030086
000400 PROGRAM-ID.    IQKCS402.                                         00040086
000500 AUTHOR.        GREG SHEFF.                                       00050086
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060086
000700 DATE-WRITTEN.  02-19-03.                                         00070086
000800 DATE-COMPILED.                                                   00080086
000900                                                                  00090086
001000*---------------------------------------------------------------* 00100086
001100*    I402 - VENDOR LABEL/NAME LIST                              * 00110086
001200*                                                               * 00120086
001300*    THIS IS THE SECOND PROGRAM IN THE DRILL DOWN SKU           * 00130086
001400*    IDENTIFICATION PROCESS.                                    * 00140086
001500*                                                               * 00150086
001600*    DISPLAYS A LIST OF VENDOR LABELS/VENDOR NAMES BASED ON TWO * 00160086
001700*    TO FIVE CHARACTERS ENTERED ON THE CRITERIA SPEC SCREEN.    * 00170086
001800*                                                               * 00180086
001900*    ALLOWS THE USER TO SELECT ONE LABEL OR VENDOR NAME AND     * 00190086
002000*    PASS IT TO THE NEXT PROGRAM.                               * 00200086
002100*                                                               * 00210086
002200*    ONLY ACTIVE VENDORS ARE DISPLAYED.                         * 00220086
002300*                                                               * 00230086
002400*---------------------------------------------------------------* 00240086
002420* DATE:        09/14/2021                                         00242087
002430* WR/IR#:      CHG0261678                                         00243088
002440* PROGRAMMER:  GERMAN BANDA                                       00244087
002450* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00245087
002460*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00246087
002470*              MAKING THE CALL DYNAMIC VS STATIC                  00247087
002471*---------------------------------------------------------------* 00247187
CICS  * CHANGED 10/31/2022    BY JIM HUNTER      WR: CHG0277565         00247289
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00247389
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00247489
CICS  ******************************************************************00247589
002500 EJECT                                                            00250086
002600 ENVIRONMENT DIVISION.                                            00260086
002700                                                                  00270086
002800 DATA DIVISION.                                                   00280086
002900                                                                  00290086
003000 WORKING-STORAGE SECTION.                                         00300086
003100                                                                  00310086
003200 01  DK-DB2-KEYS.                                                 00320086
003300     15  DK-VENDOR-ABBREV               PIC  X(06)  VALUE SPACE.  00330086
003400                                                                  00340086
003500 01  PC-PROGRAM-CONSTANTS.                                        00350086
003600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00360086
003700                                                    'IQ402A  '.   00370086
003800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00380086
003900                                                    'IQKM402 '.   00390086
004000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00400086
004100                                                    'IQKCS402'.   00410086
004200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00420086
004300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00430086
004400     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE ' '.    00440086
004500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00450086
004600                                                    COMP SYNC.    00460086
004700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00470086
004800                                                    COMP SYNC.    00480086
004900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00490086
005000                                                    +1000000      00500086
005100                                                    COMP-3.       00510086
005200     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00520086
005300                                                    COMP SYNC.    00530086
005400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00540086
005500                                                    COMP-3.       00550086
005600*                                                                 00560086
005700     05  PC-TSYMSG-NUMBERS.                                       00570086
005800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00580086
005900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00590086
006000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00600086
006100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00610086
006200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00620086
006300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00630086
006400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00640086
006500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00650086
006600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00660086
006700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00670086
006800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00680086
006900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00690086
007000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00700086
007100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00710086
007200*                                                                 00720086
007300 01  PS-PROGRAM-SWITCHES.                                         00730086
007400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00740086
007500         88  PS-NO-ERROR                            VALUE 'Y'.    00750086
007600         88  PS-ERROR                               VALUE 'N'.    00760086
007700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00770086
007800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00780086
007900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00790086
008000*                                                                 00800086
008100 01  PV-PROGRAM-VARIABLES.                                        00810086
008200     05  PV-VENDOR-ABBREV               PIC  X(06)  VALUE SPACE.  00820086
008300     05  PV-SUB                         PIC S9(04)  VALUE +0      00830086
008400                                                    COMP SYNC.    00840086
008500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00850086
008600                                                    COMP SYNC.    00860086
008700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00870086
008800                                                    COMP-3.       00880086
008900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00890086
009000                                                    COMP-3.       00900086
009100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00910086
009200                                                    COMP-3.       00920086
009300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00930086
009400                                                    COMP-3.       00940086
009500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00950086
009600                                                    COMP-3.       00960086
009700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00970086
009800                                                    COMP-3.       00980086
009900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00990086
010000                                                    COMP SYNC.    01000086
010100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01010086
010200                                                    COMP SYNC.    01020086
010300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01030086
010400                                                    COMP SYNC.    01040086
010500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01050086
010600                                                    COMP SYNC.    01060086
010700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01070086
010800                                                    COMP SYNC.    01080086
010900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01090086
011000                                                    COMP SYNC.    01100086
011100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01110086
011200                                                    COMP SYNC.    01120086
011300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01130086
011400                                                    COMP SYNC.    01140086
011500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01150086
011600                                                    COMP SYNC.    01160086
011700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01170086
011800                                                    COMP SYNC.    01180086
011900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01190086
012000                                                    COMP SYNC.    01200086
012100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01210086
012200                                                    COMP SYNC.    01220086
012300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01230086
012400                                                    COMP SYNC.    01240086
012500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01250086
012600                                                    COMP SYNC.    01260086
012700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01270086
012800                                                    COMP SYNC.    01280086
012900******************************************************************01290086
013000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01300086
013100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01310086
013200**  APPLICATION-SPECIFIC COMMAREA.                              **01320086
013300******************************************************************01330086
013400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01340086
013500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01350086
013600     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01360086
013700                                        INDEXED BY LQW-IDX.       01370086
013800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01380086
013900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01390086
014000         10  LQW-SELECTED-SW            PIC  X(01).               01400086
014100             88  LQW-SELECT                         VALUE 'S'.    01410086
014200             88  LQW-DESELECT                       VALUE ' '.    01420086
014300         10  LQW-LBL-NM                 PIC  X(30).               01430086
014400                                                                  01440086
014500     EJECT                                                        01450086
014600*---------------------------------------------------------------* 01460086
014700*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 01470086
014800*---------------------------------------------------------------* 01480086
014900     COPY IQWS014.                                                01490086
015000                                                                  01500086
015100     EJECT                                                        01510086
015200*---------------------------------------------------------------* 01520086
015300*    MAP LAYOUT                                                 * 01530086
015400*---------------------------------------------------------------* 01540086
015500                                                                  01550086
015600     COPY IQKM402.                                                01560086
015700*                                                                 01570086
015800 01  MR-OCCURS-LAYOUT                   REDEFINES  IQ402AO.       01580086
015900     05  FILLER                         PIC X(52).                01590086
016000     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01600086
016100         10  MR-SELECTL                 PIC S9(04) COMP.          01610086
016200         10  MR-SELECTA                 PIC  X(01).               01620086
016300         10  MR-SELECTC                 PIC  X(01).               01630086
016400         10  MR-SELECTH                 PIC  X(01).               01640086
016500         10  MR-SELECTI                 PIC  X(01).               01650086
016600                                                                  01660086
016700         10  MR-LBL-NML                 PIC S9(04) COMP.          01670086
016800         10  MR-LBL-NMA                 PIC  X(01).               01680086
016900         10  MR-LBL-NMC                 PIC  X(01).               01690086
017000         10  MR-LBL-NMH                 PIC  X(01).               01700086
017100         10  MR-LBL-NM                  PIC  X(30).               01710086
017200     EJECT                                                        01720086
017300*---------------------------------------------------------------* 01730086
017400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01740086
017500*---------------------------------------------------------------* 01750086
017600                                                                  01760086
017700     COPY DPWS015.                                                01770086
017800                                                                  01780086
017900*---------------------------------------------------------------* 01790086
018000*    FUNCTION KEYS COPYBOOK.                                    * 01800086
018100*---------------------------------------------------------------* 01810086
018200                                                                  01820086
018300     COPY DPWS016.                                                01830086
018400                                                                  01840086
018500*---------------------------------------------------------------* 01850086
018600*    NUMERIC EDIT LAYOUT.                                       * 01860086
018700*---------------------------------------------------------------* 01870086
018800                                                                  01880086
018900     COPY DPWS010I.                                               01890086
019000 EJECT                                                            01900086
019100*---------------------------------------------------------------* 01910086
019200*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01920089
019300*---------------------------------------------------------------* 01930086
019400                                                                  01940086
019500     COPY DPWS030.                                                01950086
CICS       COPY DPWS930.                                                01951089
019600 EJECT                                                            01960086
019700*---------------------------------------------------------------* 01970086
019800*    STANDARD COMMAREA.                                         * 01980086
019900*---------------------------------------------------------------* 01990086
020000                                                                  02000086
020100     COPY DPWS020.                                                02010086
020200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02020086
020300*---------------------------------------------------------------* 02030086
020400* INTER-APPLICATION COMMAREA.                                   * 02040086
020500*   IQWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02050086
020600*             SPEC SCREEN.                                      * 02060086
020700*   IQWS016 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02070086
020800*             THIS LIST PROGRAM.                                * 02080086
020900*---------------------------------------------------------------* 02090086
021000                                                                  02100086
021100         10  INTER-APPL-COMM-AREA       PIC X(200).               02110086
021200     COPY IQWS001.                                                02120086
021300     COPY IQWS016.                                                02130086
021400*---------------------------------------------------------------* 02140086
021500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02150086
021600*---------------------------------------------------------------* 02160086
021700         10  ASC-SPECIFIC-COMMAREA.                               02170086
021800             15  ASC-LIST-KEYS.                                   02180086
021900                 20  ASC-VENDOR-ABBREV               PIC  X(06).  02190086
022000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02200086
022100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02210086
022200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02220086
022300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02230086
022400                                                                  02240086
022500                 20  ASC-ITEM-ARRAY.                              02250086
022600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02260086
022700                         30  ASC-LIST-ITEM-NUMBER                 02270086
022800                                                     PIC S9(09)   02280086
022900                                                     COMP-3.      02290086
023000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02300086
023100                             88  ASC-VALID-SELECT    VALUE ' '    02310086
023200                                                           'S'    02320086
023300                                                           'B'    02330086
023400                                                           'E'.   02340086
023500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02350086
023600                             88  ASC-TEMP-SELECT     VALUE 'S'.   02360086
023700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02370086
023800                             88  ASC-TEMP-END        VALUE 'E'.   02380086
023900                         30  ASC-SELECTED-SW         PIC  X(01).  02390086
024000                             88  ASC-NO-SELECT       VALUE ' '.   02400086
024100                             88  ASC-SELECT          VALUE 'S'.   02410086
024200                             88  ASC-BEGIN           VALUE 'B'.   02420086
024300                             88  ASC-END             VALUE 'E'.   02430086
024400                         30  ASC-LBL-NM              PIC  X(30).  02440086
024500                                                                  02450086
024600             15  ASC-BLK-SUB                         PIC S9(04)   02460086
024700                                                          COMP    02470086
024800                                                          SYNC.   02480086
024900             15  ASC-ITEM-SUB                        PIC S9(04)   02490086
025000                                                          COMP    02500086
025100                                                          SYNC.   02510086
025200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02520086
025300                                                          COMP-3. 02530086
025400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02540086
025500                                                          COMP-3. 02550086
025600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02560086
025700                                                          COMP-3. 02570086
025800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02580086
025900                                                          COMP-3. 02590086
026000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02600086
026100                                                          COMP-3. 02610086
026200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02620086
026300                                                          COMP    02630086
026400                                                          SYNC.   02640086
026500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02650086
026600                                                          COMP-3. 02660086
026700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02670086
026800                                                          COMP-3. 02680086
026900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02690086
027000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02700086
027100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02710086
027200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  02720086
027300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   02730086
027400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   02740086
027500             15  ASC-LIST-QUEUE-NAME.                             02750086
027600                 20  ASC-LIST-TERM-ID                PIC  X(04).  02760086
027700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02770086
027800                                                          COMP-3. 02780086
027900                 20  ASC-LIST-SEQ                    PIC  9(01).  02790086
028000             15  ASC-SEL-QUEUE-NAME.                              02800086
028100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  02810086
028200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   02820086
028300                                                          COMP-3. 02830086
028400                 20  ASC-SEL-SEQ                     PIC  9(01).  02840086
028500             15  ASC-START-ITEM-REQUEST.                          02850086
028600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  02860086
028700         10  FILLER                                  PIC  X(1759).02870086
028800     EJECT                                                        02880086
028900*---------------------------------------------------------------* 02890086
029000*    ABEND PROCESSING COPYBOOK.                                 * 02900086
029100*---------------------------------------------------------------* 02910086
029200                                                                  02920086
029300     COPY DPWS013.                                                02930086
029400                                                                  02940086
029500 EJECT                                                            02950086
029600*---------------------------------------------------------------* 02960086
029700*    DB2 AREA FOR XST_VND_STYL                                  * 02970086
029800*---------------------------------------------------------------* 02980086
029900     EXEC SQL                                                     02990086
030000          INCLUDE XST00013                                        03000086
030100     END-EXEC.                                                    03010086
030200*---------------------------------------------------------------* 03020086
030300*    DB2 AREA FOR XST_VND                                       * 03030086
030400*---------------------------------------------------------------* 03040086
030500     EXEC SQL                                                     03050086
030600          INCLUDE XST00018                                        03060086
030700     END-EXEC.                                                    03070086
030800*---------------------------------------------------------------* 03080086
030900*    DB2 AREA FOR COMMUNICATIONS                                * 03090086
031000*---------------------------------------------------------------* 03100086
031100     EXEC SQL                                                     03110086
031200          INCLUDE SQLCA                                           03120086
031300     END-EXEC.                                                    03130086
031400*---------------------------------------------------------------* 03140086
031500*    RETURNS ALL OF THE ACTIVE VENDORS AND VENDOR NAMES THAT    * 03150086
031600*    BEGIN WITH THE FIRST 2 TO 5 CHARACTERS THAT WERE PASSED    * 03160086
031700*    BY THE CRITERIA SPEC (PREVIOUS) PROGRAM.                   * 03170086
031800*---------------------------------------------------------------* 03180086
031900*                                                               * 03190086
032000     EXEC SQL                                                     03200086
032100        DECLARE VENDOR-CSR CURSOR FOR                             03210086
032200        SELECT D.LBL_NM AS NAME                                   03220086
032300            FROM   XST_VND_STYL  D                                03230086
032400               WHERE  D.LBL_NM      LIKE :DK-VENDOR-ABBREV        03240086
032500          UNION                                                   03250086
032600        SELECT E.ENT_NM_DESC AS NAME                              03260086
032700            FROM   XST_VND       E,                               03270086
032800                   XST_VND_STYL  D                                03280086
032900               WHERE  E.ENT_NM_DESC LIKE :DK-VENDOR-ABBREV        03290086
033000                 AND  D.ENT_ID = E.ENT_ID                         03300086
033100           ORDER BY 1                                             03310086
033200     END-EXEC.                                                    03320086
033300 EJECT                                                            03330086
033400 LINKAGE SECTION.                                                 03340086
033500                                                                  03350086
033600 01  DFHCOMMAREA.                                                 03360086
033700     05  FILLER                         OCCURS  1 TO 4072 TIMES   03370086
033800                                        DEPENDING ON EIBCALEN.    03380086
033900         10  FILLER                     PIC X.                    03390086
034000                                                                  03400086
034100 EJECT                                                            03410086
034200 PROCEDURE DIVISION.                                              03420086
034300******************************************************************03430086
034400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **03440086
034500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **03450086
034600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **03460086
034700******************************************************************03470086
034800 0000-MAIN-MODULE.                                                03480086
034900     INITIALIZE DP030-CICS-API-FIELDS.                            03490086
035000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03500086
035100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03510086
035200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03520086
035300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03530086
035400     MOVE LENGTH OF IQ402AI        TO DP030-MAP-LENGTH (1).       03540086
035500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03550086
035600     PERFORM 0001-CALL-CICS-ARCH-API.                             03560086
035700*                                                                 03570086
035800     PERFORM 1000-CONTROL-PROCESSING                              03580086
035900*                                                                 03590086
036000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03600086
036100     PERFORM 0001-CALL-CICS-ARCH-API.                             03610086
036200                                                                  03620086
036300******************************************************************03630086
036400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03640086
036500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03650086
036600******************************************************************03660086
036700 0001-CALL-CICS-ARCH-API.                                         03670086
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03680089
036900                                    DFHCOMMAREA                   03690089
037000                                    DP030-CICS-API-FIELDS         03700089
037100                                    DP020-STANDARD-COMMAREA       03710089
037200                                    IQ402AI.                      03720089
037300*                                                                 03730086
037400     IF  DP030-RC-CALL-SUCCESSFUL                                 03740086
037500         CONTINUE                                                 03750086
037600     ELSE                                                         03760086
037700         SET DP013-NO-ROLLBACK                                    03770086
037800             DP013-XCTL-DISPLAY-RESTART                           03780086
037900             DP013-CICS-ABEND      TO TRUE                        03790086
038000         MOVE '0001-CALL-CICS-ARCH-API'                           03800086
038100                                   TO DP013-PARAGRAPH             03810086
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03811089
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03812089
038400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03840086
038500         PERFORM DP013-0000-PROCESS-ABEND                         03850086
038600     END-IF.                                                      03860086
038700*----------------------------------------------------------------*03870086
038800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03880086
038900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03890086
039000*                                                                *03900086
039100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03910086
039200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03920086
039300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03930086
039400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03940086
039500*----------------------------------------------------------------*03950086
039600                                                                  03960086
039700 1000-CONTROL-PROCESSING.                                         03970086
039800                                                                  03980086
039900     EVALUATE TRUE                                                03990086
040000         WHEN DP020-NEXT-ACT-INITIAL                              04000086
040100             INITIALIZE ASC-SPECIFIC-COMMAREA                     04010086
040200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04020086
040300                                      ASC-SEL-TERM-ID             04030086
040400             MOVE DP020-SRC-TASK-NUMBER                           04040086
040500                                   TO ASC-LIST-TASK-NUMBER        04050086
040600                                      ASC-SEL-TASK-NUMBER         04060086
040700             MOVE PC-LIST-QUEUE-SEQ                               04070086
040800                                   TO ASC-LIST-SEQ                04080086
040900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04090086
041000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04100086
041100***-----$TEMPLATE NOTE$-------------------------------------------04110086
041200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04120086
041300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04130086
041400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04140086
041500***---------------------------------------------------------------04150086
041600             IF  PS-COMMAREA-NOT-VALID                            04160086
041700                 SET DP020-NEXT-ACT-APPL-ERROR                    04170086
041800                                   TO TRUE                        04180086
041900             ELSE                                                 04190086
042000                 PERFORM 4000-BUILD-INITIAL-PANEL                 04200086
042100             END-IF                                               04210086
042200                                                                  04220086
042300         WHEN DP020-NEXT-ACT-READ-MAP                             04230086
042400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04240086
042500                                   TO PV-TOP-ITEM                 04250086
042600             PERFORM 2000-PROCESS-PANEL                           04260086
042700                                                                  04270086
042800         WHEN DP020-NEXT-ACT-RETURN                               04280086
042900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04290086
043000                                   TO PV-TOP-ITEM                 04300086
043100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04310086
043200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04320086
043300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04330086
043400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04340086
043500                                                                  04350086
043600         WHEN OTHER                                               04360086
043700             SET DP013-LOGIC-ABEND TO TRUE                        04370086
043800             SET DP013-NO-ROLLBACK TO TRUE                        04380086
043900             MOVE '1000-CONTROL-PROCESSING'                       04390086
044000                                   TO DP013-PARAGRAPH             04400086
044100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04410086
044200                                   TO DP013-MESSAGE-TEXT(1)       04420086
044300             PERFORM DP013-0000-PROCESS-ABEND                     04430086
044400     END-EVALUATE.                                                04440086
044500                                                                  04450086
044600 EJECT                                                            04460086
044700*----------------------------------------------------------------*04470086
044800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04480086
044900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04490086
045000*----------------------------------------------------------------*04500086
045100                                                                  04510086
045200 1100-PROCESS-INTER-APPL-COMM.                                    04520086
045300     SET PS-COMMAREA-VALID         TO TRUE.                       04530086
045400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04540086
045500     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          04550086
045600         MOVE IQ001-VENDOR-ABBREV                                 04560086
045700                                  TO ASC-VENDOR-ABBREV            04570086
045800                                      DK-VENDOR-ABBREV            04580086
045900     ELSE                                                         04590086
046000*----------------------------------------------------------------*04600086
046100* EXECUTE THIS CODE WHEN JUMP TO THIS PROGRAM FROM THE COMMAND   *04610086
046200* LINE (NOTE: MUST ENTER ALL PARAMTERS, NOT JUST MNEMONIC)       *04620086
046300*----------------------------------------------------------------*04630086
046400         IF  DP020-NAV-KEY-DATA > SPACE                           04640086
046500             MOVE DP020-NAV-KEY-DATA                              04650086
046600                                   TO DK-VENDOR-ABBREV            04660086
046700                                      ASC-VENDOR-ABBREV           04670086
046800         END-IF                                                   04680086
046900     END-IF.                                                      04690086
047000                                                                  04700086
047100 EJECT                                                            04710086
047200*----------------------------------------------------------------*04720086
047300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04730086
047400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04740086
047500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04750086
047600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04760086
047700* FUNCTION KEYS CAN GET THIS FAR.                                *04770086
047800*----------------------------------------------------------------*04780086
047900                                                                  04790086
048000 2000-PROCESS-PANEL.                                              04800086
048100     EVALUATE TRUE                                                04810086
048200         WHEN DP020-SRC-AID = DP016-CLEAR                         04820086
048300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04830086
048400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04840086
048500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04850086
048600                                                                  04860086
048700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04870086
048800             MOVE ASC-VENDOR-ABBREV                               04880086
048900                                   TO DK-VENDOR-ABBREV            04890086
049000             PERFORM 2050-DELETE-LIST-QUEUE                       04900086
049100             PERFORM 4000-BUILD-INITIAL-PANEL                     04910086
049200                                                                  04920086
049300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    04930086
049400             PERFORM 2140-DESELECT-ALL-ITEMS                      04940086
049500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04950086
049600                                                                  04960086
049700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  04970086
049800             PERFORM 2150-SELECT-ALL-ITEMS                        04980086
049900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04990086
050000                                                                  05000086
050100         WHEN OTHER                                               05010086
050200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05020086
050300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05030086
050400             IF  PS-NO-ERROR                                      05040086
050500                 SET DP030-CONTINUE-GO                            05050086
050600                                 TO TRUE                          05060086
050700                 PERFORM 2100-CHECK-FUNCTION-KEY                  05070086
050800             ELSE                                                 05080086
050900                 SET DP030-OVERRIDE-GO                            05090086
051000                                 TO TRUE                          05100086
051100             END-IF                                               05110086
051200     END-EVALUATE.                                                05120086
051300 EJECT                                                            05130086
051400*----------------------------------------------------------------*05140086
051500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05150086
051600*----------------------------------------------------------------*05160086
051700 2050-DELETE-LIST-QUEUE.                                          05170086
051800                                                                  05180086
051900     EXEC CICS                                                    05190086
052000         DELETEQ TS                                               05200086
052100             QUEUE (ASC-LIST-QUEUE-NAME)                          05210086
052200             RESP  (PV-CICS-RESP)                                 05220086
052300     END-EXEC.                                                    05230086
052400                                                                  05240086
052500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05250086
052600        (PV-CICS-RESP = DFHRESP(QIDERR))                          05260086
052700         CONTINUE                                                 05270086
052800     ELSE                                                         05280086
052900         SET DP013-CICS-ABEND      TO TRUE                        05290086
053000         SET DP013-NO-ROLLBACK     TO TRUE                        05300086
053100                                                                  05310086
053200         MOVE '2050-DELETE-LIST-QUEUE'                            05320086
053300                                   TO DP013-PARAGRAPH             05330086
053400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05340086
053500                                   TO DP013-MESSAGE-TEXT (1)      05350086
053600         PERFORM DP013-0000-PROCESS-ABEND                         05360086
053700     END-IF.                                                      05370086
053800                                                                  05380086
053900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05390086
054000 EJECT                                                            05400086
054100*----------------------------------------------------------------*05410086
054200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05420086
054300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05430086
054400* CICS ARCHITECTURE API.                                         *05440086
054500*----------------------------------------------------------------*05450086
054600 2100-CHECK-FUNCTION-KEY.                                         05460086
054700     EVALUATE TRUE                                                05470086
054800         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               05480086
054900             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              05490086
055000                 SET DP030-OVERRIDE-GO                            05500086
055100                                   TO TRUE                        05510086
055200*                --  A LIST ITEM MUST BE SELECTED --              05520086
055300                 MOVE PC-TSYMSG-00057                             05530086
055400                                   TO DP020-MSG-NUMBER            05540086
055500                 SET DP020-MSG-FATAL                              05550086
055600                                   TO TRUE                        05560086
055700             ELSE                                                 05570086
055800               IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1               05580086
055900                   SET DP030-OVERRIDE-GO                          05590086
056000                                   TO TRUE                        05600086
056100*                --  ONLY ONE LIST ITEM MAY BE SELECTED --        05610086
056200                   MOVE PC-TSYMSG-00047                           05620086
056300                                   TO DP020-MSG-NUMBER            05630086
056400                   SET DP020-MSG-FATAL                            05640086
056500                                   TO TRUE                        05650086
056600               ELSE                                               05660086
056700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05670086
056800                                TO IQ016-NUMBER-OF-SELECTED-ITEMS 05680086
056900                 PERFORM 5000-PREPARE-SEL-QUEUE                   05690086
057000               END-IF                                             05700086
057100             END-IF                                               05710086
057200                                                                  05720086
057300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05730086
057400             MOVE +1               TO PV-TOP-ITEM                 05740086
057500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05750086
057600                                                                  05760086
057700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05770086
057800             PERFORM 2110-BROWSE-BACKWARD                         05780086
057900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05790086
058000                                                                  05800086
058100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05810086
058200             PERFORM 2120-BROWSE-FORWARD                          05820086
058300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05830086
058400                                                                  05840086
058500         WHEN DP020-SRC-AID = DP016-ENTER                         05850086
058600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05860086
058700             IF  PS-ERROR                                         05870086
058800                 CONTINUE                                         05880086
058900             ELSE                                                 05890086
059000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05900086
059100             END-IF                                               05910086
059200                                                                  05920086
059300         WHEN OTHER                                               05930086
059400             SET DP013-NO-ROLLBACK                                05940086
059500                 DP013-XCTL-DISPLAY-RESTART                       05950086
059600                 DP013-CICS-ABEND  TO TRUE                        05960086
059700             MOVE '2100-CHECK-FUNCTION-KEY'                       05970086
059800                                   TO DP013-PARAGRAPH             05980086
059900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05990086
060000                                   TO DP013-MESSAGE-TEXT (1)      06000086
060100             PERFORM DP013-0000-PROCESS-ABEND                     06010086
060200     END-EVALUATE.                                                06020086
060300*                                                                 06030086
060400*----------------------------------------------------------------*06040086
060500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06050086
060600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06060086
060700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06070086
060800*----------------------------------------------------------------*06080086
060900                                                                  06090086
061000 2110-BROWSE-BACKWARD.                                            06100086
061100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06110086
061200         GIVING PV-TOP-ITEM.                                      06120086
061300*                                                                 06130086
061400     IF  ((PV-TOP-ITEM < +1)                                      06140086
061500       OR (PV-TOP-ITEM = +1))                                     06150086
061600         MOVE +1                   TO PV-TOP-ITEM                 06160086
061700*        -- TOP OF LIST --                                        06170086
061800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06180086
061900         SET DP020-MSG-INFORMATIONAL TO TRUE                      06190086
062000     END-IF.                                                      06200086
062100                                                                  06210086
062200 EJECT                                                            06220086
062300*----------------------------------------------------------------*06230086
062400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06240086
062500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06250086
062600*    PAST THE END, ISSUE THE BOTTOM OF LIST.                     *06260086
062700*----------------------------------------------------------------*06270086
062800                                                                  06280086
062900 2120-BROWSE-FORWARD.                                             06290086
063000                                                                  06300086
063100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06310086
063200         GIVING PV-TOP-ITEM.                                      06320086
063300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06330086
063400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06340086
063500                                   TO PV-TOP-ITEM                 06350086
063600*        -- BOTTOM OF LIST --                                     06360086
063700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06370086
063800         SET DP020-MSG-INFORMATIONAL                              06380086
063900                                   TO TRUE                        06390086
064000     ELSE                                                         06400086
064100         COMPUTE PV-BOTTOM-ITEM =                                 06410086
064200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06420086
064300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06430086
064400*            -- BOTTOM OF LIST --                                 06440086
064500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06450086
064600             SET DP020-MSG-INFORMATIONAL                          06460086
064700                                   TO TRUE                        06470086
064800         END-IF                                                   06480086
064900     END-IF.                                                      06490086
065000 EJECT                                                            06500086
065100*----------------------------------------------------------------*06510086
065200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06520086
065300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06530086
065400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06540086
065500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06550086
065600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06560086
065700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06570086
065800*----------------------------------------------------------------*06580086
065900                                                                  06590086
066000 2130-CHECK-FOR-JUMP-BROWSE.                                      06600086
066100     SET PS-NO-ERROR               TO TRUE.                       06610086
066200     IF (ASC-START-ITEM-REQUEST = SPACE)                          06620086
066300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06630086
066400                                   TO PV-TOP-ITEM                 06640086
066500     ELSE                                                         06650086
066600         MOVE ASC-START-ITEM-REQUEST                              06660086
066700                                   TO DP010I-UNEDITED-FIELD       06670086
066800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06680086
066900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06690086
067000         SET DP010I-NEGATIVE-NOT-ALLOWED                          06700086
067100                                   TO TRUE                        06710086
067210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06721087
067220                         USING DP010I-NUMERIC-EDIT-AREA           06722087
067300                                                                  06730086
067400         IF  NOT DP010I-ERROR-DETECTED                            06740086
067500             MOVE DP010I-NUMERIC-FIELD                            06750086
067600                                   TO  ASC-START-ITEM-REQUEST-N   06760086
067700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06770086
067800                 IF  ASC-START-ITEM-REQUEST-N >                   06780086
067900                                          ASC-NUMBER-OF-ITEMS-READ06790086
068000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06800086
068100                     COMPUTE PV-TOP-ITEM =                        06810086
068200                             ASC-NUMBER-OF-ITEMS-READ             06820086
068300                             - PC-ITEMS-PER-PANEL + 1             06830086
068400                     IF  PV-TOP-ITEM < +1                         06840086
068500                         MOVE +1   TO PV-TOP-ITEM                 06850086
068600                         MOVE PC-TSYMSG-00070                     06860086
068700                                   TO DP020-MSG-NUMBER            06870086
068800                         SET DP020-MSG-INFORMATIONAL              06880086
068900                                   TO TRUE                        06890086
069000                     END-IF                                       06900086
069100                 ELSE                                             06910086
069200                     MOVE ASC-START-ITEM-REQUEST-N                06920086
069300                                   TO PV-TOP-ITEM                 06930086
069400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06940086
069500                     COMPUTE PV-BOTTOM-ITEM =                     06950086
069600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06960086
069700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06970086
069800*                        -- BOTTOM OF LIST --                     06980086
069900                         MOVE PC-TSYMSG-00070                     06990086
070000                                   TO DP020-MSG-NUMBER            07000086
070100                         SET DP020-MSG-INFORMATIONAL              07010086
070200                                   TO TRUE                        07020086
070300                     END-IF                                       07030086
070400                 END-IF                                           07040086
070500             ELSE                                                 07050086
070600*                --- VALUE OUT OF RANGE ----                      07060086
070700                 MOVE PC-TSYMSG-00101                             07070086
070800                                   TO DP020-MSG-NUMBER            07080086
070900                 MOVE -1           TO ASTRTITL                    07090086
071000                 SET DP030-SET-CURSOR-APPL-1                      07100086
071100                                   TO TRUE                        07110086
071200                 MOVE DP015-REVERSE                               07120086
071300                                   TO ASTRTITH                    07130086
071400                 MOVE DP015-RED    TO ASTRTITC                    07140086
071500                 MOVE DP015-UNP-NUM-BRT-MDT                       07150086
071600                                   TO ASTRTITA                    07160086
071700                 SET DP020-MSG-FATAL                              07170086
071800                                   TO TRUE                        07180086
071900                 SET PS-ERROR      TO TRUE                        07190086
072000             END-IF                                               07200086
072100                                                                  07210086
072200         ELSE                                                     07220086
072300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07230086
072400             MOVE -1               TO ASTRTITL                    07240086
072500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07250086
072600             MOVE DP015-REVERSE    TO ASTRTITH                    07260086
072700             MOVE DP015-RED        TO ASTRTITC                    07270086
072800             MOVE DP015-UNP-NUM-BRT-MDT                           07280086
072900                                   TO ASTRTITA                    07290086
073000             SET DP020-MSG-FATAL   TO TRUE                        07300086
073100             SET PS-ERROR          TO TRUE                        07310086
073200         END-IF                                                   07320086
073300     END-IF.                                                      07330086
073400 EJECT                                                            07340086
073500*----------------------------------------------------------------*07350086
073600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07360086
073700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07370086
073800*----------------------------------------------------------------*07380086
073900 2140-DESELECT-ALL-ITEMS.                                         07390086
074000     MOVE +1                       TO ASC-BLK-SUB.                07400086
074100                                                                  07410086
074200     PERFORM 2141-CLEAR-SELECTED-INDS                             07420086
074300         VARYING ASC-ITEM-SUB                                     07430086
074400         FROM 1 BY 1                                              07440086
074500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07450086
074600                                                                  07460086
074700     ADD +1                        TO ASC-BLK-SUB.                07470086
074800                                                                  07480086
074900     PERFORM 2141-CLEAR-SELECTED-INDS                             07490086
075000         VARYING ASC-ITEM-SUB                                     07500086
075100         FROM 1 BY 1                                              07510086
075200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07520086
075300                                                                  07530086
075400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07540086
075500                                   TO PV-LIST-ITEM-NUMBER.        07550086
075600                                                                  07560086
075700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07570086
075800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07580086
075900                                                                  07590086
076000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07600086
076100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07610086
076200         MOVE +1                   TO ASC-BLK-SUB                 07620086
076300                                                                  07630086
076400         PERFORM 5100-WRITE-TEMP-STORAGE                          07640086
076500                                                                  07650086
076600         MOVE +1                   TO PV-BLOCK-NUMBER             07660086
076700                                                                  07670086
076800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07680086
076900             PV-FIRST-BLOCK-IN-ARRAY - 1                          07690086
077000                                                                  07700086
077100         PERFORM                                                  07710086
077200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07720086
077300                                                                  07730086
077400             PERFORM 4410-READ-TEMP-STORAGE                       07740086
077500                                                                  07750086
077600             PERFORM 2141-CLEAR-SELECTED-INDS                     07760086
077700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07770086
077800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07780086
077900                                                                  07790086
078000             PERFORM 5100-WRITE-TEMP-STORAGE                      07800086
078100                                                                  07810086
078200             ADD +1                TO PV-BLOCK-NUMBER             07820086
078300                                                                  07830086
078400         END-PERFORM                                              07840086
078500                                                                  07850086
078600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07860086
078700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07870086
078800                                                                  07880086
078900         PERFORM                                                  07890086
079000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07900086
079100                   ASC-HIGHEST-BLOCK-WRITTEN                      07910086
079200                                                                  07920086
079300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          07930086
079400                                   TO PV-BLOCK-NUMBER             07940086
079500                                                                  07950086
079600             PERFORM 4410-READ-TEMP-STORAGE                       07960086
079700                                                                  07970086
079800             PERFORM 2141-CLEAR-SELECTED-INDS                     07980086
079900                 VARYING ASC-ITEM-SUB                             07990086
080000                 FROM 1 BY 1                                      08000086
080100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08010086
080200                                                                  08020086
080300             PERFORM 5100-WRITE-TEMP-STORAGE                      08030086
080400                                                                  08040086
080500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08050086
080600                                                                  08060086
080700         END-PERFORM                                              08070086
080800                                                                  08080086
080900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08090086
081000                                   TO PV-BLOCK-NUMBER             08100086
081100                                                                  08110086
081200         PERFORM 4410-READ-TEMP-STORAGE                           08120086
081300     END-IF.                                                      08130086
081400                                                                  08140086
081500                                                                  08150086
081600     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08160086
081700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08170086
081800     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08180086
081900                                                                  08190086
082000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08200086
082100                                                                  08210086
082200 EJECT                                                            08220086
082300*----------------------------------------------------------------*08230086
082400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08240086
082500*----------------------------------------------------------------*08250086
082600                                                                  08260086
082700 2141-CLEAR-SELECTED-INDS.                                        08270086
082800                                                                  08280086
082900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08290086
083000             NOT EQUAL ZERO                                       08300086
083100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08310086
083200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08320086
083300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08330086
083400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08340086
083500                                   TO TRUE                        08350086
083600         END-IF                                                   08360086
083700     END-IF.                                                      08370086
083800                                                                  08380086
083900 EJECT                                                            08390086
084000*----------------------------------------------------------------*08400086
084100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08410086
084200*  FOR ALL ITEMS.                                                *08420086
084300*----------------------------------------------------------------*08430086
084400                                                                  08440086
084500 2150-SELECT-ALL-ITEMS.                                           08450086
084600                                                                  08460086
084700     MOVE +1                       TO ASC-BLK-SUB.                08470086
084800                                                                  08480086
084900     PERFORM 2151-SET-SELECTED-INDS                               08490086
085000         VARYING ASC-ITEM-SUB                                     08500086
085100         FROM 1 BY 1                                              08510086
085200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08520086
085300                                                                  08530086
085400     ADD +1                        TO ASC-BLK-SUB.                08540086
085500                                                                  08550086
085600     PERFORM 2151-SET-SELECTED-INDS                               08560086
085700         VARYING ASC-ITEM-SUB                                     08570086
085800         FROM 1 BY 1                                              08580086
085900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08590086
086000                                                                  08600086
086100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08610086
086200                                   TO PV-LIST-ITEM-NUMBER.        08620086
086300                                                                  08630086
086400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08640086
086500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08650086
086600                                                                  08660086
086700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08670086
086800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08680086
086900         MOVE +1                   TO ASC-BLK-SUB                 08690086
087000                                                                  08700086
087100         PERFORM 5100-WRITE-TEMP-STORAGE                          08710086
087200                                                                  08720086
087300         MOVE +1                   TO PV-BLOCK-NUMBER             08730086
087400                                                                  08740086
087500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08750086
087600             PV-FIRST-BLOCK-IN-ARRAY - 1                          08760086
087700                                                                  08770086
087800         PERFORM                                                  08780086
087900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08790086
088000                                                                  08800086
088100             PERFORM 4410-READ-TEMP-STORAGE                       08810086
088200                                                                  08820086
088300             PERFORM 2151-SET-SELECTED-INDS                       08830086
088400                 VARYING ASC-ITEM-SUB                             08840086
088500                 FROM 1 BY 1                                      08850086
088600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08860086
088700                                                                  08870086
088800             PERFORM 5100-WRITE-TEMP-STORAGE                      08880086
088900                                                                  08890086
089000             ADD +1                TO PV-BLOCK-NUMBER             08900086
089100                                                                  08910086
089200         END-PERFORM                                              08920086
089300                                                                  08930086
089400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08940086
089500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08950086
089600                                                                  08960086
089700         PERFORM                                                  08970086
089800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08980086
089900                   ASC-HIGHEST-BLOCK-WRITTEN                      08990086
090000                                                                  09000086
090100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09010086
090200                                   TO PV-BLOCK-NUMBER             09020086
090300                                                                  09030086
090400             PERFORM 4410-READ-TEMP-STORAGE                       09040086
090500                                                                  09050086
090600             PERFORM 2151-SET-SELECTED-INDS                       09060086
090700                 VARYING ASC-ITEM-SUB                             09070086
090800                 FROM 1 BY 1                                      09080086
090900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09090086
091000                                                                  09100086
091100             PERFORM 5100-WRITE-TEMP-STORAGE                      09110086
091200                                                                  09120086
091300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09130086
091400                                                                  09140086
091500         END-PERFORM                                              09150086
091600                                                                  09160086
091700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09170086
091800                                   TO PV-BLOCK-NUMBER             09180086
091900                                                                  09190086
092000         PERFORM 4410-READ-TEMP-STORAGE                           09200086
092100     END-IF.                                                      09210086
092200                                                                  09220086
092300                                                                  09230086
092400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09240086
092500                       ASC-NUMBER-OF-SELECTED-ITEMS.              09250086
092600                                                                  09260086
092700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09270086
092800                                                                  09280086
092900 EJECT                                                            09290086
093000*----------------------------------------------------------------*09300086
093100*    MARK EACH ITEM AS BEING SELECTED.                           *09310086
093200*----------------------------------------------------------------*09320086
093300                                                                  09330086
093400 2151-SET-SELECTED-INDS.                                          09340086
093500                                                                  09350086
093600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09360086
093700             NOT EQUAL ZERO                                       09370086
093800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09380086
093900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09390086
094000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09400086
094100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09410086
094200                               TO  TRUE                           09420086
094300         END-IF                                                   09430086
094400     END-IF.                                                      09440086
094500******************************************************************09450086
094600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09460086
094700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09470086
094800******************************************************************09480086
094900 2200-MOVE-SCREEN-TO-COMMAREA.                                    09490086
095000                                                                  09500086
095100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09510086
095200     MOVE +1                       TO PV-SUB.                     09520086
095300*                                                                 09530086
095400     PERFORM 3100-SET-SUBSCRIPTS.                                 09540086
095500     IF  ASTRTITL > ZERO                                          09550086
095600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09560086
095700     ELSE                                                         09570086
095800         IF  ASTRTITF = DP015-ERASE-EOF                           09580086
095900             INITIALIZE ASC-START-ITEM-REQUEST                    09590086
096000         END-IF                                                   09600086
096100     END-IF.                                                      09610086
096200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09620086
096300         VARYING PV-SUB                                           09630086
096400         FROM 1 BY 1                                              09640086
096500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09650086
096600******************************************************************09660086
096700** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09670086
096800******************************************************************09680086
096900 2210-MOVE-LINES-TO-COMMAREA.                                     09690086
097000     IF  MR-SELECTL (PV-SUB) > ZERO                               09700086
097100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09710086
097200         MOVE MR-SELECTI (PV-SUB)                                 09720086
097300                                   TO ASC-TEMP-SELECTED-SW        09730086
097400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09740086
097500     ELSE                                                         09750086
097600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09760086
097700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09770086
097800                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09780086
097900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09790086
098000         END-IF                                                   09800086
098100     END-IF.                                                      09810086
098200     ADD +1                        TO ASC-ITEM-SUB.               09820086
098300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09830086
098400         ADD +1                    TO ASC-BLK-SUB                 09840086
098500         MOVE +1                   TO ASC-ITEM-SUB                09850086
098600     END-IF.                                                      09860086
098700******************************************************************09870086
098800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09880086
098900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09890086
099000******************************************************************09900086
099100 3000-EDIT-DATA-IN-COMMAREA.                                      09910086
099200     SET PS-NO-ERROR               TO TRUE.                       09920086
099300     PERFORM 3200-RESET-ATTRIBUTES.                               09930086
099400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09940086
099500**                                                                09950086
099600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              09960086
099700* EDITTING IS DONE FROM THE BOTTOM UP.                            09970086
099800**                                                                09980086
099900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09990086
100000         ASC-ITEMS-DISPLAYED - 1.                                 10000086
100100     PERFORM 3100-SET-SUBSCRIPTS.                                 10010086
100200     PERFORM 3300-EDIT-SELECTIONS                                 10020086
100300         VARYING PV-SUB                                           10030086
100400         FROM PV-SUB BY -1                                        10040086
100500         UNTIL PV-SUB < +1                                        10050086
100600*                                                                 10060086
100700     IF  PS-NO-ERROR                                              10070086
100800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10080086
100900     END-IF.                                                      10090086
101000*                                                                 10100086
101100     IF  ((PS-NO-ERROR)                                           10110086
101200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10120086
101300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10130086
101400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10140086
101500     END-IF.                                                      10150086
101600 EJECT                                                            10160086
101700*----------------------------------------------------------------*10170086
101800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10180086
101900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10190086
102000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10200086
102100*                                                                *10210086
102200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10220086
102300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10230086
102400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10240086
102500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10250086
102600*----------------------------------------------------------------*10260086
102700                                                                  10270086
102800 3100-SET-SUBSCRIPTS.                                             10280086
102900                                                                  10290086
103000     COMPUTE ASC-ITEM-SUB =                                       10300086
103100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10310086
103200                                                                  10320086
103300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10330086
103400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10340086
103500                                                                  10350086
103600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10360086
103700     ELSE                                                         10370086
103800         MOVE +1                     TO ASC-BLK-SUB               10380086
103900     END-IF.                                                      10390086
104000******************************************************************10400086
104100** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **10410086
104200******************************************************************10420086
104300                                                                  10430086
104400 3200-RESET-ATTRIBUTES.                                           10440086
104500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10450086
104600     MOVE DP015-GREEN              TO ASTRTITC.                   10460086
104700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10470086
104800*                                                                 10480086
104900     PERFORM                                                      10490086
105000         VARYING PV-SUB                                           10500086
105100         FROM 1 BY 1                                              10510086
105200         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        10520086
105300         MOVE DP015-UNP-ALP-NOR-OFF                               10530086
105400                                   TO MR-SELECTA (PV-SUB)         10540086
105500         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         10550086
105600         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         10560086
105700     END-PERFORM.                                                 10570086
105800******************************************************************10580086
105900** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **10590086
106000** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **10600086
106100** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **10610086
106200** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **10620086
106300******************************************************************10630086
106400 3300-EDIT-SELECTIONS.                                            10640086
106500     EVALUATE TRUE                                                10650086
106600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10660086
106700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         10670086
106800                 CONTINUE                                         10680086
106900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         10690086
107000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10700086
107100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   10710086
107200                 MOVE ASC-TEMP-SELECTED-SW                        10720086
107300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10730086
107400                                TO ASC-SELECTED-SW                10740086
107500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10750086
107600             END-IF                                               10760086
107700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10770086
107800                 = SPACE                                          10780086
107900             EVALUATE TRUE                                        10790086
108000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       10800086
108100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS10810086
108200                     MOVE SPACE TO ASC-SELECTED-SW                10820086
108300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10830086
108400                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        10840086
108500                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    10850086
108600                     MOVE SPACE TO ASC-SELECTED-SW                10860086
108700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10870086
108800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          10880086
108900                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      10890086
109000                     MOVE SPACE TO ASC-SELECTED-SW                10900086
109100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10910086
109200             END-EVALUATE                                         10920086
109300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           10930086
109400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10940086
109500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10950086
109600             END-IF                                               10960086
109700             PERFORM 3310-EDIT-RANGE                              10970086
109800         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             10980086
109900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10990086
110000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11000086
110100             END-IF                                               11010086
110200             PERFORM 3310-EDIT-RANGE                              11020086
110300         WHEN OTHER                                               11030086
110400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           11040086
110500             SET DP020-MSG-FATAL    TO TRUE                       11050086
110600             MOVE -1                TO MR-SELECTL (PV-SUB)        11060086
110700             SET DP030-SET-CURSOR-APPL-1                          11070086
110800                                    TO TRUE                       11080086
110900             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        11090086
111000             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        11100086
111100             SET PS-ERROR TO TRUE                                 11110086
111200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11120086
111300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     11130086
111400                 MOVE SPACE         TO ASC-SELECTED-SW            11140086
111500                                        (ASC-BLK-SUB ASC-ITEM-SUB)11150086
111600             END-IF                                               11160086
111700     END-EVALUATE.                                                11170086
111800                                                                  11180086
111900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11190086
112000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11200086
112100     IF  ASC-ITEM-SUB < 1                                         11210086
112200         SUBTRACT +1 FROM ASC-BLK-SUB                             11220086
112300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11230086
112400     END-IF.                                                      11240086
112500******************************************************************11250086
112600** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **11260086
112700** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **11270086
112800** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**11280086
112900** THE ENDING.                                                  **11290086
113000******************************************************************11300086
113100 3310-EDIT-RANGE.                                                 11310086
113200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11320086
113300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11330086
113400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11340086
113500                                   TO ASC-SELECTED-SW             11350086
113600                                        (ASC-BLK-SUB ASC-ITEM-SUB)11360086
113700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11370086
113800         ELSE                                                     11380086
113900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11390086
114000                 CONTINUE                                         11400086
114100             ELSE                                                 11410086
114200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11420086
114300                 MOVE PC-TSYMSG-00054                             11430086
114400                                   TO DP020-MSG-NUMBER            11440086
114500                 SET DP020-MSG-FATAL                              11450086
114600                                   TO TRUE                        11460086
114700                 MOVE -1           TO MR-SELECTL (PV-SUB)         11470086
114800                 SET DP030-SET-CURSOR-APPL-1                      11480086
114900                                   TO TRUE                        11490086
115000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         11500086
115100                 MOVE DP015-UNDERLINE                             11510086
115200                                   TO MR-SELECTH (PV-SUB)         11520086
115300                 SET PS-ERROR      TO TRUE                        11530086
115400             END-IF                                               11540086
115500         END-IF                                                   11550086
115600     ELSE                                                         11560086
115700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     11570086
115800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 11580086
115900                                   TO ASC-SELECTED-SW             11590086
116000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11600086
116100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11610086
116200         ELSE                                                     11620086
116300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11630086
116400                 CONTINUE                                         11640086
116500             ELSE                                                 11650086
116600*                -- ONLY ONE END-OF-RANGE ALLOWED --              11660086
116700                 MOVE PC-TSYMSG-00055                             11670086
116800                                   TO DP020-MSG-NUMBER            11680086
116900                 SET DP020-MSG-FATAL                              11690086
117000                                   TO TRUE                        11700086
117100                 MOVE -1           TO MR-SELECTL (PV-SUB)         11710086
117200                 SET DP030-SET-CURSOR-APPL-1                      11720086
117300                                   TO TRUE                        11730086
117400                 SET PS-ERROR      TO TRUE                        11740086
117500             END-IF                                               11750086
117600         END-IF                                                   11760086
117700     END-IF.                                                      11770086
117800*                                                                 11780086
117900******************************************************************11790086
118000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **11800086
118100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **11810086
118200******************************************************************11820086
118300 3400-CHECK-RANGE-SEQUENCE.                                       11830086
118400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       11840086
118500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      11850086
118600       AND  ASC-START-OF-SELECTED-RANGE >                         11860086
118700                                         ASC-END-OF-SELECTED-RANGE11870086
118800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                11880086
118900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 11890086
119000         SET DP020-MSG-FATAL TO TRUE                              11900086
119100         SET PS-ERROR TO TRUE                                     11910086
119200         PERFORM 3410-POSITION-AT-ERROR                           11920086
119300     END-IF.                                                      11930086
119400******************************************************************11940086
119500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **11950086
119600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **11960086
119700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **11970086
119800******************************************************************11980086
119900 3410-POSITION-AT-ERROR.                                          11990086
120000     SET DP030-SET-CURSOR-APPL-1                                  12000086
120100                                   TO TRUE.                       12010086
120200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 12020086
120300                    - PV-TOP-ITEM + 1.                            12030086
120400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12040086
120500         CONTINUE                                                 12050086
120600     ELSE                                                         12060086
120700         MOVE -1                   TO MR-SELECTL (PV-SUB)         12070086
120800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12080086
120900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12090086
121000     END-IF.                                                      12100086
121100*                                                                 12110086
121200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   12120086
121300                    - PV-TOP-ITEM + 1.                            12130086
121400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12140086
121500         CONTINUE                                                 12150086
121600     ELSE                                                         12160086
121700         MOVE -1                   TO MR-SELECTL (PV-SUB)         12170086
121800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12180086
121900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12190086
122000     END-IF.                                                      12200086
122100 EJECT                                                            12210086
122200*----------------------------------------------------------------*12220086
122300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12230086
122400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12240086
122500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *12250086
122600*----------------------------------------------------------------*12260086
122700                                                                  12270086
122800 3500-MARK-RANGE-AS-SELECTED.                                     12280086
122900     MOVE +1                       TO  ASC-BLK-SUB.               12290086
123000     PERFORM 3510-MARK-SELECTED-INDS                              12300086
123100         VARYING ASC-ITEM-SUB                                     12310086
123200         FROM 1 BY 1                                              12320086
123300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12330086
123400                                                                  12340086
123500     ADD +1                        TO ASC-BLK-SUB.                12350086
123600     PERFORM 3510-MARK-SELECTED-INDS                              12360086
123700         VARYING ASC-ITEM-SUB                                     12370086
123800         FROM 1 BY 1                                              12380086
123900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12390086
124000                                                                  12400086
124100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12410086
124200                                   TO  PV-LIST-ITEM-NUMBER.       12420086
124300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12430086
124400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         12440086
124500               PC-ITEMS-PER-PANEL).                               12450086
124600                                                                  12460086
124700     MOVE ASC-START-OF-SELECTED-RANGE                             12470086
124800                                   TO PV-START-OF-SELECTED-RANGE. 12480086
124900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            12490086
125000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  12500086
125100               PC-ITEMS-PER-PANEL).                               12510086
125200                                                                  12520086
125300     MOVE ASC-END-OF-SELECTED-RANGE                               12530086
125400                                   TO  PV-END-OF-SELECTED-RANGE.  12540086
125500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             12550086
125600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    12560086
125700               PC-ITEMS-PER-PANEL).                               12570086
125800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12580086
125900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12590086
126000                                                                  12600086
126100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    12610086
126200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        12620086
126300         MOVE +1                   TO ASC-BLK-SUB                 12630086
126400         PERFORM 5100-WRITE-TEMP-STORAGE                          12640086
126500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12650086
126600             PV-FIRST-BLOCK-IN-ARRAY - 1                          12660086
126700                                                                  12670086
126800         PERFORM                                                  12680086
126900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      12690086
127000                   PV-PREV-BLOCK-IN-ARRAY                         12700086
127100             MOVE PV-FIRST-BLOCK-IN-RANGE                         12710086
127200                                   TO PV-BLOCK-NUMBER             12720086
127300             PERFORM 4410-READ-TEMP-STORAGE                       12730086
127400             PERFORM 3510-MARK-SELECTED-INDS                      12740086
127500                 VARYING ASC-ITEM-SUB                             12750086
127600                 FROM 1 BY 1                                      12760086
127700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12770086
127800             PERFORM 5100-WRITE-TEMP-STORAGE                      12780086
127900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     12790086
128000         END-PERFORM                                              12800086
128100                                                                  12810086
128200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12820086
128300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12830086
128400         PERFORM                                                  12840086
128500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12850086
128600                   PV-LAST-BLOCK-IN-RANGE                         12860086
128700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12870086
128800                                   TO PV-BLOCK-NUMBER             12880086
128900             PERFORM 4410-READ-TEMP-STORAGE                       12890086
129000             PERFORM 3510-MARK-SELECTED-INDS                      12900086
129100                 VARYING ASC-ITEM-SUB                             12910086
129200                 FROM 1 BY 1                                      12920086
129300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12930086
129400             PERFORM 5100-WRITE-TEMP-STORAGE                      12940086
129500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12950086
129600         END-PERFORM                                              12960086
129700                                                                  12970086
129800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12980086
129900                                   TO PV-BLOCK-NUMBER             12990086
130000         PERFORM 4410-READ-TEMP-STORAGE                           13000086
130100     END-IF.                                                      13010086
130200                                                                  13020086
130300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13030086
130400                                      ASC-END-OF-SELECTED-RANGE.  13040086
130500                                                                  13050086
130600 EJECT                                                            13060086
130700*----------------------------------------------------------------*13070086
130800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *13080086
130900*----------------------------------------------------------------*13090086
131000                                                                  13100086
131100 3510-MARK-SELECTED-INDS.                                         13110086
131200                                                                  13120086
131300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13130086
131400                                ASC-ITEM-SUB) >                   13140086
131500         ASC-START-OF-SELECTED-RANGE)                             13150086
131600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13160086
131700                                ASC-ITEM-SUB) =                   13170086
131800         ASC-START-OF-SELECTED-RANGE)                             13180086
131900                                                                  13190086
132000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13200086
132100                                    ASC-ITEM-SUB) <               13210086
132200             ASC-END-OF-SELECTED-RANGE)                           13220086
132300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13230086
132400                                    ASC-ITEM-SUB) =               13240086
132500             ASC-END-OF-SELECTED-RANGE)                           13250086
132600                                                                  13260086
132700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13270086
132800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   13280086
132900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   13290086
133000                               TO TRUE                            13300086
133100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              13310086
133200                               TO TRUE                            13320086
133300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13330086
133400             END-IF                                               13340086
133500         END-IF                                                   13350086
133600     END-IF.                                                      13360086
133700                                                                  13370086
133800 EJECT                                                            13380086
133900*----------------------------------------------------------------*13390086
134000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13400086
134100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13410086
134200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13420086
134300*    DISPLAY THE PANEL TO USER.                                  *13430086
134400*----------------------------------------------------------------*13440086
134500                                                                  13450086
134600 4000-BUILD-INITIAL-PANEL.                                        13460086
134700                                                                  13470086
134800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13480086
134900                                 ASC-BLOCK-ENTRIES (2).           13490086
135000     MOVE +1                 TO ASC-BLK-SUB.                      13500086
135100     SET ASC-ITEMS-LEFT-ON-DB                                     13510086
135200                             TO TRUE.                             13520086
135300                                                                  13530086
135400     MOVE +0                 TO ASC-ITEM-SUB                      13540086
135500                                ASC-NUMBER-OF-ITEMS-READ          13550086
135600                                ASC-NUMBER-OF-SELECTED-ITEMS      13560086
135700                                ASC-HIGHEST-BLOCK-WRITTEN         13570086
135800                                ASC-START-OF-SELECTED-RANGE       13580086
135900                                ASC-END-OF-SELECTED-RANGE         13590086
136000                                ASC-ITEM-AT-TOP-OF-PANEL.         13600086
136100     PERFORM 4100-PREPARE-CURSOR                                  13610086
136200                                                                  13620086
136300     PERFORM 4010-OPEN-CURSOR.                                    13630086
136400                                                                  13640086
136500     PERFORM 4300-READ-ITEMS-FROM-DB.                             13650086
136600                                                                  13660086
136700     PERFORM 4020-CLOSE-CURSOR.                                   13670086
136800                                                                  13680086
136900     MOVE +1                   TO  PV-TOP-ITEM.                   13690086
137000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          13700086
137100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    13710086
137200         SET DP020-MSG-FATAL   TO  TRUE                           13720086
137300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               13730086
137400     ELSE                                                         13740086
137500         MOVE -1               TO MR-SELECTL (1)                  13750086
137600         SET DP030-SET-CURSOR-APPL-1                              13760086
137700                               TO TRUE                            13770086
137800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     13780086
137900     END-IF.                                                      13790086
138000 EJECT                                                            13800086
138100*----------------------------------------------------------------*13810086
138200* OPEN THE VENDOR   CURSOR.                                      *13820086
138300*----------------------------------------------------------------*13830086
138400                                                                  13840086
138500 4010-OPEN-CURSOR.                                                13850086
138600     PERFORM                                                      13860086
138700         WITH TEST AFTER                                          13870086
138800         VARYING PV-RETRY-COUNTER                                 13880086
138900         FROM 1 BY 1                                              13890086
139000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13900086
139100                   OR (SQLCODE = ZERO))                           13910086
139200                                                                  13920086
139300         EXEC SQL                                                 13930086
139400              OPEN VENDOR-CSR                                     13940086
139500         END-EXEC                                                 13950086
139600                                                                  13960086
139700         EVALUATE TRUE                                            13970086
139800             WHEN SQLCODE = ZERO                                  13980086
139900             WHEN SQLCODE = -904                                  13990086
140000             WHEN SQLCODE = -913                                  14000086
140100                 CONTINUE                                         14010086
140200             WHEN SQLWARN0 NOT = SPACES                           14020086
140300             WHEN SQLCODE < ZERO                                  14030086
140400             WHEN SQLCODE > ZERO                                  14040086
140500                 MOVE '4010-OPEN-CURSOR'                          14050086
140600                                   TO DP013-PARAGRAPH             14060086
140700                 MOVE 'OPEN VENDOR CURSOR - '                     14070086
140800                                   TO DP013-MESSAGE-TEXT (1)      14080086
140900                 MOVE SQLCA        TO DP013-SQLCA                 14090086
141000                 MOVE 'VND STYL     ' TO DP013-DB2-TABLE-NAME (1) 14100086
141100                 MOVE 'VND          ' TO DP013-DB2-TABLE-NAME (2) 14110086
141200                 SET DP013-DB2-ABEND                              14120086
141300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14130086
141400                 PERFORM DP013-0000-PROCESS-ABEND                 14140086
141500         END-EVALUATE                                             14150086
141600     END-PERFORM.                                                 14160086
141700*                                                                 14170086
141800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14180086
141900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             14190086
142000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   14200086
142100                                   TO DP013-MESSAGE-TEXT (1)      14210086
142200         MOVE SQLCA                TO DP013-SQLCA                 14220086
142300         MOVE 'VND STYL     '      TO DP013-DB2-TABLE-NAME (1)    14230086
142400         MOVE 'VND          '      TO DP013-DB2-TABLE-NAME (2)    14240086
142500         SET DP013-DB2-ABEND                                      14250086
142600             DP013-XCTL-DISPLAY-RESTART                           14260086
142700                                   TO TRUE                        14270086
142800         PERFORM DP013-0000-PROCESS-ABEND                         14280086
142900     END-IF.                                                      14290086
143000                                                                  14300086
143100 EJECT                                                            14310086
143200*----------------------------------------------------------------*14320086
143300* CLOSE THE VENDOR   CURSOR.                                     *14330086
143400*----------------------------------------------------------------*14340086
143500                                                                  14350086
143600 4020-CLOSE-CURSOR.                                               14360086
143700                                                                  14370086
143800     EXEC SQL                                                     14380086
143900          CLOSE VENDOR-CSR                                        14390086
144000     END-EXEC.                                                    14400086
144100                                                                  14410086
144200     EVALUATE TRUE                                                14420086
144300         WHEN SQLCODE = ZERO                                      14430086
144400             CONTINUE                                             14440086
144500         WHEN SQLWARN0 NOT = SPACES                               14450086
144600         WHEN SQLCODE < ZERO                                      14460086
144700         WHEN SQLCODE > ZERO                                      14470086
144800             MOVE '4020-CLOSE-CURSOR'                             14480086
144900                               TO DP013-PARAGRAPH                 14490086
145000             MOVE 'CLOSE VENDOR CURSOR '                          14500086
145100                               TO DP013-MESSAGE-TEXT (1)          14510086
145200             MOVE SQLCA        TO DP013-SQLCA                     14520086
145300             MOVE 'VND STYL     '                                 14530086
145400                               TO DP013-DB2-TABLE-NAME (1)        14540086
145500             MOVE 'VND          '                                 14550086
145600                               TO DP013-DB2-TABLE-NAME (2)        14560086
145700             SET DP013-DB2-ABEND                                  14570086
145800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14580086
145900             PERFORM DP013-0000-PROCESS-ABEND                     14590086
146000     END-EVALUATE.                                                14600086
146100                                                                  14610086
146200*----------------------------------------------------------------*14620086
146300*    SET UP THE HOST VARIABLES.                                  *14630086
146400*----------------------------------------------------------------*14640086
146500                                                                  14650086
146600 4100-PREPARE-CURSOR.                                             14660086
146700     INSPECT DK-VENDOR-ABBREV REPLACING ALL ' ' BY '%'.           14670086
146800                                                                  14680086
146900*----------------------------------------------------------------*14690086
147000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *14700086
147100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *14710086
147200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *14720086
147300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *14730086
147400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *14740086
147500*                                                                *14750086
147600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *14760086
147700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *14770086
147800*    UPON INITIALIZATION.                                        *14780086
147900*----------------------------------------------------------------*14790086
148000                                                                  14800086
148100 4300-READ-ITEMS-FROM-DB.                                         14810086
148200                                                                  14820086
148300     PERFORM                                                      14830086
148400         VARYING PV-READ-COUNT                                    14840086
148500         FROM 1 BY 1                                              14850086
148600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    14860086
148700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         14870086
148800                                                                  14880086
148900         PERFORM 4310-FETCH                                       14890086
149000                                                                  14900086
149100         IF  ASC-ITEMS-LEFT-ON-DB                                 14910086
149200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                14920086
149300                 ADD +1            TO ASC-ITEM-SUB                14930086
149400             ELSE                                                 14940086
149500                 ADD +1            TO ASC-BLK-SUB                 14950086
149600                 MOVE +1           TO ASC-ITEM-SUB                14960086
149700                                                                  14970086
149800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         14980086
149900                     MOVE +1       TO ASC-BLK-SUB                 14990086
150000                     SET ASC-BLOCK-MODIFIED (1)                   15000086
150100                                   TO TRUE                        15010086
150200                     PERFORM 5100-WRITE-TEMP-STORAGE              15020086
150300                     MOVE ASC-BLOCK-ENTRIES                       15030086
150400                               (PC-MAX-BLOCKS-IN-ARRAY)           15040086
150500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 15050086
150600                     ADD +1        TO ASC-BLK-SUB                 15060086
150700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15070086
150800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      15080086
150900                                   TO TRUE                        15090086
151000                 END-IF                                           15100086
151100             END-IF                                               15110086
151200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    15120086
151300             MOVE ASC-NUMBER-OF-ITEMS-READ                        15130086
151400                                   TO ASC-LIST-ITEM-NUMBER        15140086
151500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15150086
151600             MOVE XST00018-ENT-NM-DESC TO ASC-LBL-NM              15160086
151700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15170086
151800         END-IF                                                   15180086
151900     END-PERFORM.                                                 15190086
152000                                                                  15200086
152100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          15210086
152200         MOVE +1               TO ASC-BLK-SUB                     15220086
152300         PERFORM 5100-WRITE-TEMP-STORAGE                          15230086
152400         ADD +1                TO ASC-BLK-SUB                     15240086
152500         PERFORM 5100-WRITE-TEMP-STORAGE                          15250086
152600                                                                  15260086
152700         MOVE 1                TO ASC-BLK-SUB                     15270086
152800                                  PV-BLOCK-NUMBER                 15280086
152900         PERFORM 4410-READ-TEMP-STORAGE                           15290086
153000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             15300086
153100             MOVE 2            TO ASC-BLK-SUB                     15310086
153200                                  PV-BLOCK-NUMBER                 15320086
153300             PERFORM 4410-READ-TEMP-STORAGE                       15330086
153400         END-IF                                                   15340086
153500     END-IF.                                                      15350086
153600 EJECT                                                            15360086
153700*----------------------------------------------------------------*15370086
153800*    FETCH THE VENDOR  CURSOR.                                   *15380086
153900*----------------------------------------------------------------*15390086
154000                                                                  15400086
154100 4310-FETCH.                                                      15410086
154200                                                                  15420086
154300*---------------------------------------------------------------* 15430086
154400*    RETURNS ALL OF THE ACTIVE VENDORS AND VENDOR NAMES THAT    * 15440086
154500*    BEGIN WITH THE FIRST 2 TO 5 CHARACTERS THAT WERE PASSED    * 15450086
154600*    BY THE CRITERIA SPEC (PREVIOUS) PROGRAM.                   * 15460086
154700*    ORDERED BY VENDOR NAME/VENDOR LABEL.                       * 15470086
154800*---------------------------------------------------------------* 15480086
154900                                                                  15490086
155000     EXEC SQL                                                     15500086
155100          FETCH VENDOR-CSR                                        15510086
155200                INTO :XST00018-ENT-NM-DESC                        15520086
155300     END-EXEC.                                                    15530086
155400                                                                  15540086
155500     EVALUATE TRUE                                                15550086
155600         WHEN SQLCODE = ZERO                                      15560086
155700         WHEN SQLCODE = +100                                      15570086
155800              CONTINUE                                            15580086
155900         WHEN SQLWARN0 NOT = SPACE                                15590086
156000         WHEN SQLCODE NOT = ZERO                                  15600086
156100              MOVE '4310-FETCH'                                   15610086
156200                               TO DP013-PARAGRAPH                 15620086
156300              MOVE 'FETCH VENDOR CURSOR'                          15630086
156400                               TO DP013-MESSAGE-TEXT (1)          15640086
156500              MOVE SQLCA       TO DP013-SQLCA                     15650086
156600              SET DP013-DB2-ABEND                                 15660086
156700                               TO TRUE                            15670086
156800              PERFORM DP013-0000-PROCESS-ABEND                    15680086
156900     END-EVALUATE.                                                15690086
157000                                                                  15700086
157100     IF  SQLCODE EQUAL +100                                       15710086
157200         SET ASC-NO-ITEMS-LEFT-ON-DB                              15720086
157300                                   TO TRUE                        15730086
157400     END-IF.                                                      15740086
157500                                                                  15750086
157600 EJECT                                                            15760086
157700*----------------------------------------------------------------*15770086
157800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15780086
157900*----------------------------------------------------------------*15790086
158000                                                                  15800086
158100 4400-MOVE-COMMAREA-TO-SCREEN.                                    15810086
158200     MOVE ASC-VENDOR-ABBREV   TO AVENDABO.                        15820086
158300     INSPECT AVENDABO REPLACING ALL '%' BY ' '                    15830086
158400                                                                  15840086
158500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15850086
158600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15860086
158700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15870086
158800             MOVE +1    TO ASC-BLK-SUB                            15880086
158900             PERFORM 5100-WRITE-TEMP-STORAGE                      15890086
159000             ADD +1     TO ASC-BLK-SUB                            15900086
159100             PERFORM 5100-WRITE-TEMP-STORAGE                      15910086
159200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15920086
159300                 GIVING PV-BLOCK-NUMBER                           15930086
159400                 REMAINDER PV-REMAINDER                           15940086
159500             IF  PV-REMAINDER > ZERO                              15950086
159600                 ADD +1 TO PV-BLOCK-NUMBER                        15960086
159700             END-IF                                               15970086
159800             MOVE +1    TO ASC-BLK-SUB                            15980086
159900             PERFORM 4410-READ-TEMP-STORAGE                       15990086
160000             ADD +1     TO ASC-BLK-SUB                            16000086
160100                           PV-BLOCK-NUMBER                        16010086
160200             PERFORM 4410-READ-TEMP-STORAGE                       16020086
160300     END-IF.                                                      16030086
160400     MOVE +1            TO ASC-BLK-SUB.                           16040086
160500     COMPUTE ASC-ITEM-SUB =                                       16050086
160600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              16060086
160700         + PC-ITEMS-PER-PANEL).                                   16070086
160800*                                                                 16080086
160900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16090086
161000         ADD +1         TO ASC-BLK-SUB                            16100086
161100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16110086
161200     END-IF.                                                      16120086
161300*                                                                 16130086
161400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           16140086
161500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                16150086
161600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        16160086
161700     PERFORM 4420-FORMAT-LIST-LINES                               16170086
161800         VARYING PV-SUB                                           16180086
161900         FROM PC-ITEMS-PER-PANEL BY -1                            16190086
162000         UNTIL PV-SUB < +1.                                       16200086
162100*                                                                 16210086
162200     COMPUTE ASC-ITEMS-DISPLAYED =                                16220086
162300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          16230086
162400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    16240086
162500                                      ASTRTITO.                   16250086
162600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    16260086
162700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    16270086
162800*                                                                 16280086
162900     IF  DP020-MSG-NUMBER-X = SPACE                               16290086
163000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  16300086
163100*            --- MORE ITEMS TO DISPLAY ----                       16310086
163200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            16320086
163300             SET DP020-MSG-INFORMATIONAL TO TRUE                  16330086
163400         END-IF                                                   16340086
163500     END-IF.                                                      16350086
163600*----------------------------------------------------------------*16360086
163700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *16370086
163800*----------------------------------------------------------------*16380086
163900                                                                  16390086
164000 4410-READ-TEMP-STORAGE.                                          16400086
164100                                                                  16410086
164200     EXEC CICS                                                    16420086
164300         READQ TS                                                 16430086
164400             QUEUE (ASC-LIST-QUEUE-NAME)                          16440086
164500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16450086
164600             ITEM  (PV-BLOCK-NUMBER)                              16460086
164700             RESP  (PV-CICS-RESP)                                 16470086
164800     END-EXEC.                                                    16480086
164900                                                                  16490086
165000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16500086
165100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16510086
165200         CONTINUE                                                 16520086
165300     ELSE                                                         16530086
165400         SET DP013-CICS-ABEND     TO TRUE                         16540086
165500         SET DP013-NO-ROLLBACK    TO TRUE                         16550086
165600         MOVE '4410-READ-TEMP-STORAGE'                            16560086
165700                                  TO DP013-PARAGRAPH              16570086
165800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16580086
165900                                  TO DP013-MESSAGE-TEXT(1)        16590086
166000         PERFORM DP013-0000-PROCESS-ABEND                         16600086
166100     END-IF.                                                      16610086
166200                                                                  16620086
166300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16630086
166400*                                                                 16640086
166500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16650086
166600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16660086
166700     END-IF.                                                      16670086
166800 EJECT                                                            16680086
166900*----------------------------------------------------------------*16690086
167000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *16700086
167100*----------------------------------------------------------------*16710086
167200                                                                  16720086
167300 4420-FORMAT-LIST-LINES.                                          16730086
167400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16740086
167500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16750086
167600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           16760086
167700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           16770086
167800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           16780086
167900                                    MR-LBL-NM (PV-SUB)            16790086
168000     ELSE                                                         16800086
168100         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16810086
168200                                                   > SPACE        16820086
168300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16830086
168400                                 TO MR-SELECTI (PV-SUB)           16840086
168500         ELSE                                                     16850086
168600             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16860086
168700                                 TO MR-SELECTI (PV-SUB)           16870086
168800         END-IF                                                   16880086
168900*                                                                 16890086
169000         IF  DP030-SET-CURSOR-TRAILER                             16900086
169100             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)16910086
169200                 > SPACE)                                         16920086
169300               OR (PV-SUB = 1))                                   16930086
169400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               16940086
169500                MOVE -1          TO MR-SELECTL (PV-SUB)           16950086
169600             END-IF                                               16960086
169700         END-IF                                                   16970086
169800*                                                                 16980086
169900         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16990086
170000             MOVE ASC-LBL-NM (ASC-BLK-SUB ASC-ITEM-SUB)           17000086
170100                                 TO MR-LBL-NM (PV-SUB)            17010086
170200         END-IF                                                   17020086
170300     END-IF.                                                      17030086
170400     SUBTRACT +1 FROM ASC-ITEM-SUB                                17040086
170500     IF  ASC-ITEM-SUB < + 1                                       17050086
170600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17060086
170700         MOVE +1                 TO ASC-BLK-SUB                   17070086
170800     END-IF.                                                      17080086
170900******************************************************************17090086
171000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **17100086
171100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **17110086
171200** ISSUE A WARNING.                                             **17120086
171300******************************************************************17130086
171400 4430-CHECK-FOR-BEGIN-AND-END.                                    17140086
171500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17150086
171600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17160086
171700*            -- NO END-OF-RANGE SPECFIED ---                      17170086
171800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            17180086
171900             SET DP020-MSG-WARNING TO TRUE                        17190086
172000             PERFORM 4431-POSITION-AT-WARNING                     17200086
172100         END-IF                                                   17210086
172200     ELSE                                                         17220086
172300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     17230086
172400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                17240086
172500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            17250086
172600             SET DP020-MSG-WARNING TO TRUE                        17260086
172700             PERFORM 4431-POSITION-AT-WARNING                     17270086
172800         END-IF                                                   17280086
172900     END-IF.                                                      17290086
173000******************************************************************17300086
173100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **17310086
173200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **17320086
173300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **17330086
173400** POSITION THE CURSOR THERE.                                   **17340086
173500******************************************************************17350086
173600 4431-POSITION-AT-WARNING.                                        17360086
173700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17370086
173800                    - PV-TOP-ITEM + 1.                            17380086
173900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17390086
174000         CONTINUE                                                 17400086
174100     ELSE                                                         17410086
174200         SET DP030-SET-CURSOR-APPL-1                              17420086
174300                                   TO TRUE                        17430086
174400         MOVE -1                   TO MR-SELECTL (PV-SUB)         17440086
174500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17450086
174600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         17460086
174700     END-IF.                                                      17470086
174800*                                                                 17480086
174900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17490086
175000                    - PV-TOP-ITEM + 1.                            17500086
175100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17510086
175200         CONTINUE                                                 17520086
175300     ELSE                                                         17530086
175400         SET DP030-SET-CURSOR-APPL-1                              17540086
175500                                   TO TRUE                        17550086
175600         MOVE -1                   TO MR-SELECTL (PV-SUB)         17560086
175700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17570086
175800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         17580086
175900     END-IF.                                                      17590086
176000 EJECT                                                            17600086
176100*----------------------------------------------------------------*17610086
176200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *17620086
176300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *17630086
176400* FOR THE SELECTED ITEMS QUEUE.                                  *17640086
176500*                                                                *17650086
176600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *17660086
176700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *17670086
176800* THE ARRAY IS FULL.                                             *17680086
176900*----------------------------------------------------------------*17690086
177000                                                                  17700086
177100 5000-PREPARE-SEL-QUEUE.                                          17710086
177200                                                                  17720086
177300     MOVE +1                   TO  ASC-BLK-SUB.                   17730086
177400     PERFORM 5100-WRITE-TEMP-STORAGE.                             17740086
177500     ADD +1                    TO  ASC-BLK-SUB.                   17750086
177600     PERFORM 5100-WRITE-TEMP-STORAGE.                             17760086
177700                                                                  17770086
177800     MOVE ASC-SEL-QUEUE-NAME   TO  IQ016-SEL-QUEUE-NAME.          17780086
177900     PERFORM 6010-DELETE-SEL-QUEUE.                               17790086
178000                                                                  17800086
178100     SET ASC-UPDATE-TSQ        TO  TRUE.                          17810086
178200                                                                  17820086
178300     SET IQ014-IDX             TO  1.                             17830086
178400     MOVE ZERO                 TO IQ016-NUMBER-OF-TS-ITEMS.       17840086
178500     INITIALIZE IQ014-SELECTED-ITEM-ARRAY.                        17850086
178600                                                                  17860086
178700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           17870086
178800             VARYING PV-ITEM                                      17880086
178900             FROM 1 BY 1                                          17890086
179000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     17900086
179100                                                                  17910086
179200     IF  IQ014-IDX > 1                                            17920086
179300         PERFORM 5205-WRITE-SEL-QUEUE                             17930086
179400         ADD +1                TO IQ016-NUMBER-OF-TS-ITEMS        17940086
179500     END-IF.                                                      17950086
179600 EJECT                                                            17960086
179700*----------------------------------------------------------------*17970086
179800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *17980086
179900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *17990086
180000*----------------------------------------------------------------*18000086
180100                                                                  18010086
180200 5100-WRITE-TEMP-STORAGE.                                         18020086
180300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18030086
180400                                   TO PV-LIST-ITEM-NUMBER.        18040086
180500     COMPUTE PV-BLOCK-NUMBER =                                    18050086
180600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18060086
180700                                                                  18070086
180800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18080086
180900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18090086
181000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18100086
181100             PERFORM 5105-REWRITE-ASC-LISTQ                       18110086
181200         END-IF                                                   18120086
181300     ELSE                                                         18130086
181400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       18140086
181500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            18150086
181600         PERFORM 5110-WRITE-ASC-LISTQ                             18160086
181700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   18170086
181800     END-IF.                                                      18180086
181900                                                                  18190086
182000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18200086
182100******************************************************************18210086
182200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **18220086
182300** SPECIFIC COMMAREA.                                           **18230086
182400******************************************************************18240086
182500 5105-REWRITE-ASC-LISTQ.                                          18250086
182600     EXEC CICS                                                    18260086
182700         WRITEQ TS                                                18270086
182800             QUEUE (ASC-LIST-QUEUE-NAME)                          18280086
182900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18290086
183000             ITEM  (PV-BLOCK-NUMBER)                              18300086
183100             REWRITE                                              18310086
183200             RESP  (PV-CICS-RESP)                                 18320086
183300     END-EXEC.                                                    18330086
183400                                                                  18340086
183500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18350086
183600         CONTINUE                                                 18360086
183700     ELSE                                                         18370086
183800         SET DP013-CICS-ABEND            TO TRUE                  18380086
183900         SET DP013-NO-ROLLBACK           TO TRUE                  18390086
184000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18400086
184100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18410086
184200                                         TO DP013-MESSAGE-TEXT(1) 18420086
184300         PERFORM DP013-0000-PROCESS-ABEND                         18430086
184400     END-IF.                                                      18440086
184500                                                                  18450086
184600******************************************************************18460086
184700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **18470086
184800** SPECIFIC COMMAREA.                                           **18480086
184900******************************************************************18490086
185000 5110-WRITE-ASC-LISTQ.                                            18500086
185100     EXEC CICS                                                    18510086
185200         WRITEQ TS                                                18520086
185300             QUEUE (ASC-LIST-QUEUE-NAME)                          18530086
185400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18540086
185500             ITEM  (PV-BLOCK-NUMBER)                              18550086
185600             RESP  (PV-CICS-RESP)                                 18560086
185700     END-EXEC.                                                    18570086
185800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18580086
185900         SET DP013-CICS-ABEND      TO TRUE                        18590086
186000         SET DP013-NO-ROLLBACK     TO TRUE                        18600086
186100         MOVE '5110-WRITE-ASC-LISTQ'                              18610086
186200                                   TO DP013-PARAGRAPH             18620086
186300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           18630086
186400                                   TO DP013-MESSAGE-TEXT(1)       18640086
186500         PERFORM DP013-0000-PROCESS-ABEND                         18650086
186600     END-IF.                                                      18660086
186700 EJECT                                                            18670086
186800*----------------------------------------------------------------*18680086
186900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *18690086
187000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *18700086
187100*----------------------------------------------------------------*18710086
187200                                                                  18720086
187300 5200-FILL-SEL-QUEUE-RECORD.                                      18730086
187400                                                                  18740086
187500     PERFORM 6112-READ-LIST-QUEUE.                                18750086
187600                                                                  18760086
187700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       18770086
187800         PERFORM                                                  18780086
187900         VARYING LQW-IDX                                          18790086
188000         FROM 1 BY 1                                              18800086
188100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            18810086
188200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          18820086
188300                                                                  18830086
188400             IF  LQW-SELECT (LQW-IDX)                             18840086
188500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              18850086
188600                                   TO IQ014-ITEM (IQ014-IDX)      18860086
188700                 MOVE LQW-LBL-NM (LQW-IDX)                        18870086
188800                                   TO IQ014-LBL-NM                18880086
188900                                        (IQ014-IDX)               18890086
189000                                      IQ016-LBL-NM                18900086
189100                 SET IQ014-IDX UP BY 1                            18910086
189200                 IF  IQ014-IDX > IQ014-MAX-ITEMS                  18920086
189300                     PERFORM 5205-WRITE-SEL-QUEUE                 18930086
189400                     ADD +1        TO IQ016-NUMBER-OF-TS-ITEMS    18940086
189500                     INITIALIZE IQ014-SELECTED-ITEM-ARRAY         18950086
189600                     SET IQ014-IDX TO  1                          18960086
189700                 END-IF                                           18970086
189800             END-IF                                               18980086
189900         END-PERFORM                                              18990086
190000     END-IF.                                                      19000086
190100                                                                  19010086
190200*----------------------------------------------------------------*19020086
190300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *19030086
190400*----------------------------------------------------------------*19040086
190500                                                                  19050086
190600 5205-WRITE-SEL-QUEUE.                                            19060086
190700                                                                  19070086
190800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19080086
190900                                   TO IQ014-SELECTED-ITEMS.       19090086
191000                                                                  19100086
191100     EXEC CICS                                                    19110086
191200          WRITEQ TS                                               19120086
191300              QUEUE (ASC-SEL-QUEUE-NAME)                          19130086
191400              FROM  (IQ014-MESSAGE-SEL-REC)                       19140086
191500              ITEM  (PV-SEL-QUEUE-ITEM)                           19150086
191600              RESP  (PV-CICS-RESP)                                19160086
191700     END-EXEC.                                                    19170086
191800                                                                  19180086
191900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          19190086
192000         CONTINUE                                                 19200086
192100     ELSE                                                         19210086
192200         SET DP013-CICS-ABEND      TO TRUE                        19220086
192300         SET DP013-NO-ROLLBACK     TO TRUE                        19230086
192400         MOVE '5205-WRITE-SEL-QUEUE'                              19240086
192500                                   TO DP013-PARAGRAPH             19250086
192600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          19260086
192700                                   TO DP013-MESSAGE-TEXT(1)       19270086
192800         PERFORM DP013-0000-PROCESS-ABEND                         19280086
192900     END-IF.                                                      19290086
193000 EJECT                                                            19300086
193100******************************************************************19310086
193200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **19320086
193300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **19330086
193400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **19340086
193500** THE USER.                                                    **19350086
193600******************************************************************19360086
193700 6000-REFRESH-PANEL-FROM-TEMP.                                    19370086
193800     IF  ASC-UPDATE-TSQ                                           19380086
193900         SET ASC-NO-TSQ-UPDATE TO TRUE                            19390086
194000         MOVE ZERO                 TO PV-SAVE-ITEM                19400086
194100                                      PV-SEL-QUEUE-ITEM           19410086
194200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        19420086
194300                                   TO PV-HOLD-SELECTED-ITEMS      19430086
194400         MOVE +1                   TO PV-ITEMS-PROCESSED          19440086
194500         PERFORM 6100-UPDATE-TSQ                                  19450086
194600             UNTIL PV-ITEMS-PROCESSED >                           19460086
194700                                     PV-HOLD-SELECTED-ITEMS       19470086
194800         PERFORM 6010-DELETE-SEL-QUEUE                            19480086
194900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         19490086
195000                    ASC-BLOCK-ENTRIES (2)                         19500086
195100     END-IF.                                                      19510086
195200                                                                  19520086
195300*----------------------------------------------------------------*19530086
195400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *19540086
195500*----------------------------------------------------------------*19550086
195600 6010-DELETE-SEL-QUEUE.                                           19560086
195700                                                                  19570086
195800     EXEC CICS                                                    19580086
195900         DELETEQ TS                                               19590086
196000             QUEUE (ASC-SEL-QUEUE-NAME)                           19600086
196100             RESP  (PV-CICS-RESP)                                 19610086
196200     END-EXEC.                                                    19620086
196300*                                                                 19630086
196400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      19640086
196500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         19650086
196600         CONTINUE                                                 19660086
196700     ELSE                                                         19670086
196800         SET DP013-CICS-ABEND TO TRUE                             19680086
196900         SET DP013-NO-ROLLBACK TO TRUE                            19690086
197000         MOVE '6010-DELETE-SEL-QUEUE'                             19700086
197100                        TO DP013-PARAGRAPH                        19710086
197200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         19720086
197300                        TO DP013-MESSAGE-TEXT (1)                 19730086
197400         PERFORM DP013-0000-PROCESS-ABEND                         19740086
197500     END-IF.                                                      19750086
197600                                                                  19760086
197700*----------------------------------------------------------------*19770086
197800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *19780086
197900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *19790086
198000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *19800086
198100*    THE TEMP QUEUE.                                             *19810086
198200*----------------------------------------------------------------*19820086
198300                                                                  19830086
198400 6100-UPDATE-TSQ.                                                 19840086
198500                                                                  19850086
198600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             19860086
198700     PERFORM 6105-READ-SEL-QUEUE.                                 19870086
198800     PERFORM                                                      19880086
198900         VARYING IQ014-IDX                                        19890086
199000         FROM 1 BY 1                                              19900086
199100         UNTIL ((PV-ITEMS-PROCESSED >                             19910086
199200                              PV-HOLD-SELECTED-ITEMS)             19920086
199300         OR (IQ014-IDX GREATER THAN IQ014-MAX-ITEMS))             19930086
199400         PERFORM 6110-PROCESS-ITEMS                               19940086
199500         ADD +1                     TO PV-ITEMS-PROCESSED         19950086
199600     END-PERFORM.                                                 19960086
199700     PERFORM 6111-WRITE-LIST-QUEUE.                               19970086
199800*----------------------------------------------------------------*19980086
199900*    READ THE LIST QUEUE RECORD.                                 *19990086
200000*----------------------------------------------------------------*20000086
200100                                                                  20010086
200200 6105-READ-SEL-QUEUE.                                             20020086
200300                                                                  20030086
200400     EXEC CICS                                                    20040086
200500          READQ TS                                                20050086
200600              QUEUE (ASC-SEL-QUEUE-NAME)                          20060086
200700              INTO  (IQ014-MESSAGE-SEL-REC)                       20070086
200800              ITEM  (PV-SEL-QUEUE-ITEM)                           20080086
200900              RESP  (PV-CICS-RESP)                                20090086
201000     END-EXEC.                                                    20100086
201100*                                                                 20110086
201200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20120086
201300         CONTINUE                                                 20130086
201400     ELSE                                                         20140086
201500         SET DP013-CICS-ABEND      TO  TRUE                       20150086
201600         SET DP013-NO-ROLLBACK     TO  TRUE                       20160086
201700         MOVE '6105-READ-SEL-QUEUE'                               20170086
201800                                   TO  DP013-PARAGRAPH            20180086
201900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           20190086
202000                                   TO  DP013-MESSAGE-TEXT(1)      20200086
202100         PERFORM DP013-0000-PROCESS-ABEND                         20210086
202200     END-IF.                                                      20220086
202300 EJECT                                                            20230086
202400*----------------------------------------------------------------*20240086
202500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*20250086
202600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*20260086
202700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *20270086
202800*----------------------------------------------------------------*20280086
202900                                                                  20290086
203000 6110-PROCESS-ITEMS.                                              20300086
203100                                                                  20310086
203200     COMPUTE PV-ITEM = 1 + ((IQ014-ITEM (IQ014-IDX) - 1)          20320086
203300                     / PC-ITEMS-PER-PANEL).                       20330086
203400                                                                  20340086
203500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           20350086
203600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          20360086
203700             PERFORM 6111-WRITE-LIST-QUEUE                        20370086
203800         END-IF                                                   20380086
203900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    20390086
204000                                                                  20400086
204100         PERFORM 6112-READ-LIST-QUEUE                             20410086
204200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               20420086
204300             CONTINUE                                             20430086
204400         END-IF                                                   20440086
204500     END-IF.                                                      20450086
204600                                                                  20460086
204700     COMPUTE PV-SUB = (IQ014-ITEM (IQ014-IDX)                     20470086
204800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              20480086
204900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         20490086
205000     MOVE LQW-SELECTED-SW (PV-SUB)                                20500086
205100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  20510086
205200                                                                  20520086
205300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                20530086
205400                                                                  20540086
205500*----------------------------------------------------------------*20550086
205600*    WRITE THE TS QUEUE RECORD JUST UPDATED                      *20560086
205700*----------------------------------------------------------------*20570086
205800                                                                  20580086
205900 6111-WRITE-LIST-QUEUE.                                           20590086
206000                                                                  20600086
206100     EXEC CICS                                                    20610086
206200         WRITEQ TS                                                20620086
206300             QUEUE (ASC-LIST-QUEUE-NAME)                          20630086
206400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     20640086
206500             ITEM  (PV-SAVE-ITEM)                                 20650086
206600             REWRITE                                              20660086
206700             RESP  (PV-CICS-RESP)                                 20670086
206800     END-EXEC.                                                    20680086
206900*                                                                 20690086
207000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20700086
207100         CONTINUE                                                 20710086
207200     ELSE                                                         20720086
207300         SET DP013-CICS-ABEND  TO  TRUE                           20730086
207400         SET DP013-NO-ROLLBACK TO  TRUE                           20740086
207500         MOVE '6111-WRITE-LIST-QUEUE'                             20750086
207600                               TO  DP013-PARAGRAPH                20760086
207700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  20770086
207800                               TO  DP013-MESSAGE-TEXT(1)          20780086
207900         PERFORM DP013-0000-PROCESS-ABEND                         20790086
208000     END-IF.                                                      20800086
208100                                                                  20810086
208200 EJECT                                                            20820086
208300*----------------------------------------------------------------*20830086
208400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*20840086
208500*----------------------------------------------------------------*20850086
208600                                                                  20860086
208700 6112-READ-LIST-QUEUE.                                            20870086
208800                                                                  20880086
208900     EXEC CICS                                                    20890086
209000         READQ TS                                                 20900086
209100             QUEUE (ASC-LIST-QUEUE-NAME)                          20910086
209200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     20920086
209300             ITEM  (PV-ITEM)                                      20930086
209400             RESP  (PV-CICS-RESP)                                 20940086
209500     END-EXEC.                                                    20950086
209600*                                                                 20960086
209700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20970086
209800         CONTINUE                                                 20980086
209900     ELSE                                                         20990086
210000         SET DP013-CICS-ABEND        TO TRUE                      21000086
210100         SET DP013-NO-ROLLBACK       TO TRUE                      21010086
210200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           21020086
210300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    21030086
210400                                     TO DP013-MESSAGE-TEXT(1)     21040086
210500         PERFORM DP013-0000-PROCESS-ABEND                         21050086
210600     END-IF.                                                      21060086
210700                                                                  21070086
210800 EJECT                                                            21080086
210900*----------------------------------------------------------------*21090086
211000*    ABEND PROCESSOR MODULE                                      *21100086
211100*----------------------------------------------------------------*21110086
211200                                                                  21120086
211300     COPY DPPD013.                                                21130086
