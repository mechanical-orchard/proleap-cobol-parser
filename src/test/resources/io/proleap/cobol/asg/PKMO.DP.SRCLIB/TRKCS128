000100*-----------------------*                                         00010006
000200 IDENTIFICATION DIVISION.                                         00020006
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    TRKCS128.                                         00040006
000500 AUTHOR.        LARRY SCHLEICHER - STRATAGEM.                     00050006
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060006
000700 DATE-WRITTEN.  04-24-95.                                         00070006
000800 DATE-COMPILED.                                                   00080006
000900*----------------------------------------------------------------*00090006
001000*    Y128 - FORECAST PO ADD                                      *00100006
001100*                                                                *00110006
001200*    THIS PROGRAM ALLOWS THE USER TO ADD A NEW FORECAST PO.      *00120006
001300*----------------------------------------------------------------*00130006
001400* CHANGED 10-30-2014 CHERI PARMLEY           CHG0094517           00131013
001500*         EXPANDED PO# FROM 7 TO 8 DIGITS                         00132013
001600*---------------------------------------------------------------* 00133013
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00135014
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00136014
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00137014
263697*---------------------------------------------------------------* 00138014
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00139015
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00139115
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00139215
CICS  *-----------------------------------------------------------------00139315
001400                                                                  00140006
001500 ENVIRONMENT DIVISION.                                            00150006
001600                                                                  00160006
001700 DATA DIVISION.                                                   00170006
001800                                                                  00180006
001900                                                                  00190006
002000 WORKING-STORAGE SECTION.                                         00200006
002100                                                                  00210006
002200 01  DN-NULL-INDICATORS.                                          00220006
002300     05  DN-TRIP-ID                   PIC S9(4) COMP VALUE +0.    00230006
002400     05  DN-SHIP-EST-AR-TMST          PIC S9(4) COMP VALUE +0.    00240006
002500                                                                  00250006
002600 01  DK-DB2-KEYS.                                                 00260006
002700     05  DK-SHIPT-ID                    PIC S9(09)  VALUE +0      00270006
002800                                                    COMP.         00280006
002900     05  DK-PO-NBR                      PIC S9(09)  VALUE +0      00290006
003000                                                    COMP.         00300006
003100*                                                                 00310006
003200 01  PC-PROGRAM-CONSTANTS.                                        00320006
003300     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR128A  '.  00330006
003400     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM128 '.  00340006
003500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS128'.  00350006
003600     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00360006
003700                                              COMP.               00370006
003800     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3           00380006
003900                                              COMP.               00390006
004000     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1            00400006
004100                                              COMP.               00410006
004200     05  PC-ZERO                  PIC S9(04)  VALUE +0            00420006
004300                                              COMP.               00430006
004400     05  PC-OPER-UNT-ID           PIC S9(4)   VALUE +0            00440006
004500                                              COMP.               00450006
004600     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00460006
004700     05  PC-LIST-FORMAT           PIC  X(01)  VALUE '1'.          00470006
004800     05  PC-ACTIVE                PIC  X(01)  VALUE 'A'.          00480006
004810     05  PC-A                     PIC  X(01)  VALUE 'A'.          00490006
004900     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          00500006
005000     05  PC-PO-ACTIVE             PIC  X(02)  VALUE 'AC'.         00510006
005100     05  PC-APPROVED              PIC X(02)   VALUE 'AP'.         00520006
005200     05  PC-CANCELLED             PIC X(02)   VALUE 'CA'.         00530006
005300     05  PC-CANBALENCE            PIC X(02)   VALUE 'CB'.         00540006
005400     05  PC-COMPLETE              PIC X(02)   VALUE 'CM'.         00550006
005500     05  PC-DEFAULT-DATE          PIC X(10)   VALUE               00560006
005600                                  '0001-01-01'.                   00570006
005700     05  PC-DEFAULT-TIME          PIC X(08)   VALUE               00580006
005800                                  '00.00.00'.                     00590006
005900     05  PC-TSYMSG-NUMBERS.                                       00600006
006000         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00610006
006100         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00620006
006200         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00630006
006300         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00640006
006400         10  PC-TSYMSG-00068      PIC  9(05)  VALUE  00068.       00650006
006500         10  PC-TSYMSG-00083      PIC  9(05)  VALUE  00083.       00660006
006600         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00670006
006700         10  PC-TSYMSG-00112      PIC  9(05)  VALUE  00112.       00680006
006800         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       00690006
006900         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00700006
007000         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.       00710006
007100         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00720006
007200*                                                                 00730006
007300 01  PS-PROGRAM-SWITCHES.                                         00740006
007400     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00750006
007500         88  PS-ERROR                         VALUE  'Y'.         00760006
007600         88  PS-NO-ERROR                      VALUE  'N'.         00770006
007700     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         00780006
007800         88  PS-COMMAREA-VALID                VALUE  'Y'.         00790006
007900         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         00800006
008000     05  PS-FOUND-SW              PIC  X(01)  VALUE ' '.          00810006
008100         88  PS-FOUND                         VALUE 'Y'.          00820006
008200         88  PS-NOT-FOUND                     VALUE 'N'.          00830006
008300     05  PS-DPT-NOT-FOUND-SW      PIC  X(01)  VALUE 'N'.          00840006
008400         88  PS-DPT-NOT-FOUND                 VALUE 'Y'.          00850006
008500         88  PS-DPT-FOUND                     VALUE 'N'.          00860006
008600     05  PS-NO-DISTRO-SW          PIC  X(01)  VALUE 'N'.          00870006
008700         88  PS-DISTRO                        VALUE 'Y'.          00880006
008800         88  PS-NO-DISTRO                     VALUE 'N'.          00890006
008900     05  PS-DISPLAY-DISTRO-SW     PIC  X(01)  VALUE 'N'.          00900006
009000         88  PS-DISPLAY-DISTRO-MSG            VALUE 'Y'.          00910006
009100         88  PS-DONT-DISPLAY-DISTRO-MSG       VALUE 'N'.          00920006
009200     05  PS-DONE-SW               PIC  X(01)  VALUE 'N'.          00930006
009300         88  PS-DONE                          VALUE 'Y'.          00940006
009400         88  PS-NOT-DONE                      VALUE 'N'.          00950006
009500     05  PS-SHIPMENT-EXIST-SW     PIC  X(01)  VALUE 'N'.          00960006
009600         88  PS-SHIPMENT-EXIST                VALUE 'Y'.          00970006
009700         88  PS-SHIPMENT-DOESNT-EXIST         VALUE 'N'.          00980006
009800*                                                                 00990006
009900 01  PV-PROGRAM-VARIABLES.                                        01000006
010000     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01010006
010100                                              COMP SYNC.          01020006
010200     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01030006
010300                                              COMP SYNC.          01040006
010400     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0            01050006
010500                                              COMP SYNC.          01060006
010600     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01070006
010700                                              COMP SYNC.          01080006
010800     05  PV-DB2-COUNT             PIC S9(09)  VALUE +0            01090006
010900                                              COMP-3.             01100006
011000     05  PV-W-FIRST-NAME.                                         01110006
011100         10  PV-WORKER-FIR-NAME   PIC X(10).                      01120006
011200         10  FILLER               PIC X(02).                      01130006
011300     05  PV-W-LAST-NAME.                                          01140006
011400         10  PV-WORKER-LAST-NAME  PIC X(10).                      01150006
011500         10  FILLER               PIC X(08).                      01160006
011600     05  PV-WORKER-NAME.                                          01170006
011700         10  PV-WORKER-FIRST      PIC X(10).                      01180006
011800         10  PV-WORKER-LAST       PIC X(10).                      01190006
011900     05  PV-DATE                  PIC X(10).                      01200006
012000     05  PV-TEMP-DATE.                                            01210006
012100         10  PV-DATE-CCYY         PIC X(04).                      01220006
012200         10  FILLER               PIC X(01).                      01230006
012300         10  PV-DATE-MM           PIC X(02).                      01240006
012400         10  FILLER               PIC X(01).                      01250006
012500         10  PV-DATE-DD           PIC X(02).                      01260006
012600     05  PV-WORK-DATE.                                            01270006
012700         10  PV-WK-DTE-MM         PIC X(02).                      01280006
012800         10  FILLER               PIC X(01) VALUE '/'.            01290006
012900         10  PV-WK-DTE-DD         PIC X(02).                      01300006
013000         10  FILLER               PIC X(01) VALUE '/'.            01310006
013100         10  PV-WK-DTE-YY         PIC X(04).                      01320006
013200     05  PV-WORK-DATE2.                                           01330006
013300         10  PV-WK2-DTE-MM        PIC X(02).                      01340006
013400         10  PV-WK2-DTE-DD        PIC X(02).                      01350006
013500         10  PV-WK2-DTE-YY        PIC X(04).                      01360006
013600     05  PV-TEMP-YYMM.                                            01370006
013700         10  PV-TEMP-YY           PIC X(02).                      01380006
013800         10  PV-TEMP-MM           PIC X(02).                      01390006
013900                                                                  01400006
014000 EJECT                                                            01410006
014100*----------------------------------------------------------------*01420006
014200*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *01430006
014300*----------------------------------------------------------------*01440006
014400                                                                  01450006
014500     COPY DPWS044.                                                01460006
014600 EJECT                                                            01470006
014700*----------------------------------------------------------------*01480006
014800*    MAP LAYOUT                                                  *01490006
014900*----------------------------------------------------------------*01500006
015000                                                                  01510006
015100     COPY TRKM128.                                                01520006
015200                                                                  01530006
015300                                                                  01540006
015400     EJECT                                                        01550006
015500*----------------------------------------------------------------*01560006
015600*    ATTRIBUTE SETTINGS COPYBOOK.                                *01570006
015700*----------------------------------------------------------------*01580006
015800                                                                  01590006
015900     COPY DPWS015.                                                01600006
016000                                                                  01610006
016100*----------------------------------------------------------------*01620006
016200*    FUNCTION KEYS COPYBOOK                                      *01630006
016300*----------------------------------------------------------------*01640006
016400                                                                  01650006
016500     COPY DPWS016.                                                01660006
016600******************************************************************01670006
016700** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01680006
016800** SUB-ROUTINE (DPKUT100).                                      **01690006
016900******************************************************************01700006
017000     COPY DPWS010I.                                               01710006
017100 EJECT                                                            01720006
017200***************************************************************** 01730006
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            01740015
017400***************************************************************** 01750006
017500     COPY DPWS030.                                                01760006
CICS       COPY DPWS930.                                                01761015
017600 EJECT                                                            01770006
017700***************************************************************** 01780006
017800*    STANDARD COMMAREA.                                           01790006
017900***************************************************************** 01800006
018000                                                                  01810006
018100     COPY DPWS020.                                                01820006
018200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01830006
018300                                                                  01840006
018400***************************************************************** 01850006
018500*    INTER-APPLICATION COMMAREA.                                  01860006
018600***************************************************************** 01870006
018700                                                                  01880006
018800         10  INTER-APPL-COMM-AREA PIC X(200).                     01890006
018900*---------------------------------------------------------------* 01900006
019000*   TRWS017 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED TO THIS  * 01910006
019100*             PROGRAM FROM THE LIST PROGRAM.                    * 01920006
019200*---------------------------------------------------------------* 01930006
019300     COPY TRWS017.                                                01940006
019400***************************************************************** 01950006
019500*    SPECIFIC COMMMAREA FOR TRKCS128.                             01960006
019600***************************************************************** 01970006
019700         10  ASC-SPECIFIC-COMMAREA.                               01980006
019800             15  ASC-INVALID-PO-STATUS-SW    PIC  X(01).          01990006
019900                 88  ASC-INVALID-PO-STATUS              VALUE 'Y'.02000006
020000                 88  ASC-VALID-PO-STATUS                VALUE 'N'.02010006
020100             15  ASC-ADD-COMPLETE-SW         PIC  X(01).          02020006
020200                 88  ASC-ADD-COMPLETE                   VALUE 'Y'.02030006
020300                 88  ASC-ADD-PENDING                    VALUE 'N'.02040006
020400             15  ASC-ACTIVE-PO-SW            PIC X(01).           02050006
020500                 88  ASC-ACTIVE-PO           VALUE 'Y'.           02060006
020600             15  ASC-KEY-FIELDS.                                  02070006
020700                 20  ASC-KEY-OPER-UNT-ID     PIC X(04).           02080006
020800                 20  ASC-KEY-OPER-UNT-ID-N REDEFINES              02090006
020900                     ASC-KEY-OPER-UNT-ID     PIC 9(04).           02100006
021000                 20  ASC-KEY-FCLTY-ID        PIC X(04).           02110006
021100                 20  ASC-KEY-FCLTY-ID-N REDEFINES                 02120006
021200                     ASC-KEY-FCLTY-ID        PIC 9(04).           02130006
021300                 20  ASC-KEY-SHIPT-ID        PIC S9(09) COMP.     02140006
021400                 20  ASC-KEY-FB              PIC  X(22).          02150006
021500                 20  ASC-KEY-BOL             PIC  X(30).          02160006
021600                 20  ASC-KEY-FCLTY-NME       PIC  X(30).          02170006
021700             15  ASC-SCREEN-FIELDS.                               02180006
021800                 20  ASC-FCLTY-NME           PIC  X(25).          02190006
021900                 20  ASC-PO-NUMBER.                               02200006
      *CLP 10/30/14                                                     02201012
022000                     25  ASC-PO-NUMBER-N     PIC  9(08).          02210012
022100                 20  ASC-VENDOR-NAME         PIC  X(30).          02220006
022200                 20  ASC-PACKSLIP-IND        PIC  X(01).          02230006
022300                 20  ASC-EXP-CARTON-COUNT.                        02240006
022400                     25  ASC-EXP-CARTON-COUNT-N                   02250006
022500                                             PIC  9(05).          02260006
022600                 20  ASC-DEPT-NBR            PIC  X(04).          02270008
022601                 20  ASC-DEPT-NBR-N REDEFINES                     02271008
022602                     ASC-DEPT-NBR            PIC  9(04).          02272008
022700                 20  ASC-PO-STATUS           PIC X(02).           02280006
022800                 20  ASC-PO-STATUS-DESC      PIC X(20).           02290006
022900                 20  ASC-NO-DISTRO-MSG       PIC X(09).           02300006
023000                 20  ASC-DONT-SHIP-BEF-DTE   PIC X(10).           02310006
023100                 20  ASC-CANCEL-DTE          PIC X(10).           02320006
023200                 20  ASC-EXT-CAN-DTE         PIC X(10).           02330006
023300                 20  ASC-DEPT-DESC           PIC X(25).           02340006
023400                 20  ASC-BUYER-NME           PIC X(25).           02350006
023500             15  ASC-ENT-ID                  PIC S9(9) COMP.      02360006
023600             15  ASC-USE-SELECTION-QUEUE-IND                      02370006
023700                                             PIC  X(01).          02380006
023800                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    02390006
023900             15  ASC-SEL-QUEUE-NAME          PIC  X(08).          02400006
024000             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05)  COMP-3.  02410006
024100             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02420006
024200                                             PIC S9(09)  COMP-3.  02430006
024300             15  ASC-SEL-SUB                 PIC S9(04)  COMP.    02440006
024400             15  ASC-SEL-ITEM                PIC S9(04)  COMP.    02450006
024500     EJECT                                                        02460006
024600/                                                                 02470006
024700*---------------------------------------------------------------* 02480006
024800*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02490006
024900*---------------------------------------------------------------* 02500006
025000     COPY TRWS004.                                                02510006
025100*----------------------------------------------------------------*02520006
025200*    ABEND PROCESSING COPYBOOK.                                  *02530006
025300*----------------------------------------------------------------*02540006
025400                                                                  02550006
025500     COPY DPWS013.                                                02560006
025600                                                                  02570006
025700*    DB2 AREA FOR TSYMSG  (SYSTEM MESSAGE - SHORT MESSAGE)        02580006
025800                                                                  02590006
025900                                                                  02600006
026000*    DB2 AREA FOR PLAN SHIPMENT TABLE                             02610006
026100                                                                  02620006
026200     EXEC SQL                                                     02630006
026300          INCLUDE TPLNSHP                                         02640006
026400     END-EXEC.                                                    02650006
026500                                                                  02660006
026600*    DB2 AREA FOR PURCHASE HEADER TABLE                           02670006
026700                                                                  02680006
026800     EXEC SQL                                                     02690006
026900          INCLUDE TPURCHS                                         02700006
027000     END-EXEC.                                                    02710006
027100                                                                  02720006
027200*    DB2 AREA FOR PURCHASE ITEM TABLE                             02730006
027300                                                                  02740006
027400     EXEC SQL                                                     02750006
027500          INCLUDE TPURITM                                         02760006
027600     END-EXEC.                                                    02770006
027700                                                                  02780006
027800*    DB2 AREA FOR PO ASSOCIATION TABLE                            02790006
027900                                                                  02800006
028000     EXEC SQL                                                     02810006
028100          INCLUDE TSHPTPO                                         02820006
028200     END-EXEC.                                                    02830006
028300                                                                  02840006
028400*    DB2 AREA FOR PO ASSOCIATION AUDIT TRAIL                      02850006
028500                                                                  02860006
028600     EXEC SQL                                                     02870006
028700          INCLUDE TAUSHPO                                         02880006
028800     END-EXEC.                                                    02890006
028900                                                                  02900006
029000*    DB2 AREA FOR SHIPMENT TABLE                                  02910006
029100                                                                  02920006
029200     EXEC SQL                                                     02930006
029300          INCLUDE TSHIPMT                                         02940006
029400     END-EXEC.                                                    02950006
029500                                                                  02960006
029600*    DB2 AREA FOR AUDIT SHIPMENT TABLE                            02970006
029700                                                                  02980006
029800     EXEC SQL                                                     02990006
029900          INCLUDE TAUSHIP                                         03000006
030000     END-EXEC.                                                    03010006
030100                                                                  03020006
030200*    DB2 AREA FOR SHIPMENT STATUS TABLE                           03030006
030300                                                                  03040006
030400     EXEC SQL                                                     03050006
030500          INCLUDE TSHIPST                                         03060006
030600     END-EXEC.                                                    03070006
030700                                                                  03080006
030800*    DB2 AREA FOR SHIPMENT STATUS TYPE TABLE                      03090006
030900                                                                  03100006
031000     EXEC SQL                                                     03110006
031100          INCLUDE TSHSTYP                                         03120006
031200     END-EXEC.                                                    03130006
031300                                                                  03140006
031400*    DB2 AREA FOR VENDOR NAME                                     03150006
031500                                                                  03160006
031600     EXEC SQL                                                     03170006
031700          INCLUDE TENTNME                                         03180006
031800     END-EXEC.                                                    03190006
031900                                                                  03200006
032000*    DB2 AREA FOR DC ALLOC SPLIT TABLE                            03210006
032100                                                                  03220006
032200     EXEC SQL                                                     03230006
032300          INCLUDE TALLPLN                                         03240006
032400     END-EXEC.                                                    03250006
032500                                                                  03260006
032600*    DB2 AREA FOR STORE ALLOCATION PLAN TABLE                     03270006
032700                                                                  03280006
032800     EXEC SQL                                                     03290006
032900          INCLUDE TMESTDS                                         03300006
033000     END-EXEC.                                                    03310006
033100                                                                  03320006
033200*    DB2 AREA FOR MERCHANDISE AREA                                03330006
033300                                                                  03340006
033400     EXEC SQL                                                     03350006
033500          INCLUDE TMDSEAR                                         03360006
033600     END-EXEC.                                                    03370006
033700                                                                  03380006
033800*    DB2 AREA FOR RESPONSIBILITY AREA                             03390006
033900                                                                  03400006
034000     EXEC SQL                                                     03410006
034100          INCLUDE TRSPBAR                                         03420006
034200     END-EXEC.                                                    03430006
034300                                                                  03440006
034400*    DB2 AREA FOR THE STATUS CODE DESCRIPTIONS                    03450006
034500                                                                  03460006
034600     EXEC SQL                                                     03470006
034700          INCLUDE TSTATCD                                         03480006
034800     END-EXEC.                                                    03490006
034900                                                                  03500006
035000*    DB2 AREA FOR COMMUNICATIONS                                  03510006
035100                                                                  03520006
035200     EXEC SQL                                                     03530006
035300          INCLUDE SQLCA                                           03540006
035400     END-EXEC.                                                    03550006
035500                                                                  03560006
035600*    CURSOR USED TO DETERMINE IF THE 'NO DISTRO' MESSAGE SHOULD BE03570006
035700*    DISPLAYED.                                                   03580006
035800                                                                  03590006
035900     EXEC SQL                                                     03600006
036000          DECLARE PO_CSR CURSOR FOR                               03610006
036100            SELECT DISTINCT(B.PO_LNE_NBR)                         03620006
036200            FROM   TPURCHS A                                      03630006
036300                  ,TPURITM B                                      03640006
036400            WHERE  A.PO_NBR = B.PO_NBR                            03650006
036500            AND    A.PO_NBR = :DK-PO-NBR                          03660006
036600            AND    A.VER_STATUS_CDE = B.VER_STATUS_CDE            03670006
036700            AND    A.VER_STATUS_CDE = :PC-ACTIVE                  03680006
036800     END-EXEC.                                                    03690006
036900 EJECT                                                            03700006
037000 LINKAGE SECTION.                                                 03710006
037100                                                                  03720006
037200 01  DFHCOMMAREA.                                                 03730006
037300     05  FILLER                         OCCURS  1 TO 4072 TIMES   03740006
037400                                        DEPENDING ON EIBCALEN.    03750006
037500         10  FILLER                     PIC  X(01).               03760006
037600                                                                  03770006
037700                                                                  03780006
037800 PROCEDURE DIVISION.                                              03790006
037900***************************************************************** 03800006
038000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03810006
038100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03820006
038200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03830006
038300**                                                             ** 03840006
038400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03850006
038500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03860006
038600***************************************************************** 03870006
038700 0000-MAIN-MODULE.                                                03880006
038800     INITIALIZE DP030-CICS-API-FIELDS.                            03890006
038900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03900006
039000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03910006
039100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03920006
039200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03930006
039300     MOVE LENGTH OF TR128AI        TO DP030-MAP-LENGTH (1).       03940006
039400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03950006
039500     PERFORM 0001-CALL-CICS-ARCH-API.                             03960006
039600*                                                                 03970006
039700     PERFORM 1000-CONTROL-PROCESSING                              03980006
039800*                                                                 03990006
039900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04000006
040000     PERFORM 0001-CALL-CICS-ARCH-API.                             04010006
040100                                                                  04020006
040200 0001-CALL-CICS-ARCH-API.                                         04030006
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04040015
040400                                    DFHCOMMAREA                   04050015
040500                                    DP030-CICS-API-FIELDS         04060015
040600                                    DP020-STANDARD-COMMAREA       04070015
040700                                    TR128AI.                      04080015
040800*                                                                 04090006
040900     IF  DP030-RC-CALL-SUCCESSFUL                                 04100006
041000         CONTINUE                                                 04110006
041100     ELSE                                                         04120006
041200         SET DP013-NO-ROLLBACK                                    04130006
041300             DP013-XCTL-DISPLAY-RESTART                           04140006
041400             DP013-CICS-ABEND      TO TRUE                        04150006
041500         MOVE 'BEFORE 0000-MAIN-MODULE'                           04160006
041600                                   TO DP013-PARAGRAPH             04170006
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04180015
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04190015
041900         MOVE DP030-RETURN-CODE                                   04200006
042000                                   TO DP013-MESSAGE-TEXT (3)      04210006
042100         PERFORM DP013-0000-PROCESS-ABEND                         04220006
042200     END-IF.                                                      04230006
042300 EJECT                                                            04240006
042400*----------------------------------------------------------------*04250006
042500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04260006
042600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04270006
042700*----------------------------------------------------------------*04280006
042800                                                                  04290006
042900 1000-CONTROL-PROCESSING.                                         04300006
043000                                                                  04310006
043100     EVALUATE TRUE                                                04320006
043200         WHEN DP020-NEXT-ACT-INITIAL                              04330006
043300             SET ASC-ADD-PENDING   TO TRUE                        04340006
043400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04350006
043500                                                                  04360006
043600***-----$TEMPLATE NOTE$-------------------------------------------04370006
043700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04380006
043800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04390006
043900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04400006
044000***---------------------------------------------------------------04410006
044100             IF  PS-COMMAREA-NOT-VALID                            04420006
044200                 SET DP020-NEXT-ACT-APPL-ERROR                    04430006
044300                                   TO TRUE                        04440006
044400             ELSE                                                 04450006
044500*                PERFORM 2050-DELETE-DETAIL-QUEUE                 04460006
044600                 PERFORM 4000-BUILD-INITIAL-PANEL                 04470006
044700                 PERFORM 3200-RESET-ATTRIBUTES                    04480006
044800             END-IF                                               04490006
044900                                                                  04500006
045000                                                                  04510006
045100         WHEN ASC-ADD-COMPLETE                                    04520006
045200             INITIALIZE ASC-SCREEN-FIELDS                         04530006
045300             SET ASC-ADD-PENDING   TO TRUE                        04540006
045400             PERFORM 4000-BUILD-INITIAL-PANEL                     04550006
045500                                                                  04560006
045600         WHEN DP020-NEXT-ACT-READ-MAP                             04570006
045700              MOVE ASC-KEY-OPER-UNT-ID                            04580006
045800                                   TO AOPERIDO                    04590006
045900              MOVE ASC-KEY-FCLTY-ID                               04600006
046000                                   TO AFCLTYO                     04610006
046100             PERFORM 2000-PROCESS-PANEL                           04620006
046200                                                                  04630006
046300         WHEN DP020-NEXT-ACT-RETURN                               04640006
046400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04650006
046500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04660006
046600                                                                  04670006
046700         WHEN OTHER                                               04680006
046800             SET DP013-LOGIC-ABEND                                04690006
046900                 DP013-NO-ROLLBACK TO TRUE                        04700006
047000             MOVE '1000-CONTROL-PROCESSING'                       04710006
047100                                   TO DP013-PARAGRAPH             04720006
047200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04730006
047300                                   TO DP013-MESSAGE-TEXT(1)       04740006
047400             MOVE DP020-NEXT-APPL-ACTIVITY                        04750006
047500                                   TO DP013-MESSAGE-TEXT(2)       04760006
047600             PERFORM DP013-0000-PROCESS-ABEND                     04770006
047700     END-EVALUATE.                                                04780006
047800/                                                                 04790006
047900*----------------------------------------------------------------*04800006
048000* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *04810006
048100*----------------------------------------------------------------*04820006
048200                                                                  04830006
048300 1100-PROCESS-INTER-APPL-COMM.                                    04840006
048400                                                                  04850006
048500     INITIALIZE ASC-SPECIFIC-COMMAREA                             04860006
048600                                                                  04870006
048700     SET PS-COMMAREA-VALID         TO TRUE.                       04880006
048800                                                                  04890006
048900     MOVE TR017-OPER-UNIT        TO ASC-KEY-OPER-UNT-ID-N         04900006
049000                                    AOPERIDO.                     04910006
049100     MOVE TR017-FCLTY-ID         TO ASC-KEY-FCLTY-ID-N            04920006
049200                                    AFCLTYO.                      04930006
049300     MOVE TR017-SHIPT-ID         TO ASC-KEY-SHIPT-ID              04940006
049400                                    DK-SHIPT-ID.                  04950006
049500     MOVE TR017-FCLTY-NME        TO ASC-KEY-FCLTY-NME.            04960006
049600     MOVE TR017-PRO-NBR          TO ASC-KEY-FB                    04970006
049700                                    AFBILLO.                      04980006
049800     MOVE TR017-BOL-NBR          TO ASC-KEY-BOL                   04990006
049900                                    ABOLO.                        05000006
050000                                                                  05010006
050100     EVALUATE DP020-INT-APPL-FORMAT-IND                           05020006
050200         WHEN PC-LIST-FORMAT                                      05030006
050300              IF TR017-NUMBER-OF-SELECTED-ITEMS = 0               05040006
050400                  SET ASC-USE-SELECTION-QUEUE TO TRUE             05050006
050500                  MOVE TR017-NUMBER-OF-TS-ITEMS                   05060006
050600                                   TO ASC-NUMBER-OF-TS-ITEMS      05070006
050700                  MOVE TR017-SEL-QUEUE-NAME                       05080006
050800                                   TO ASC-SEL-QUEUE-NAME          05090006
050900              ELSE                                                05100006
051000                  MOVE PC-TSYMSG-00112 TO DP020-MSG-NUMBER        05110006
051100                  SET DP020-MSG-FATAL                             05120006
051200                      DP020-NEXT-ACT-APPL-ERROR                   05130006
051300                      PS-COMMAREA-NOT-VALID                       05140006
051400                                       TO TRUE                    05150006
051500              END-IF                                              05160006
051600                                                                  05170006
051700                                                                  05180006
051800         WHEN OTHER                                               05190006
051900              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            05200006
052000              SET DP020-MSG-FATAL                                 05210006
052100                  DP020-NEXT-ACT-APPL-ERROR                       05220006
052200                  PS-COMMAREA-NOT-VALID                           05230006
052300                                   TO TRUE                        05240006
052400     END-EVALUATE.                                                05250006
052500                                                                  05260006
052600                                                                  05270006
052700*----------------------------------------------------------------*05280006
052800* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*05290006
052900* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*05300006
053000* EDITS.                                                         *05310006
053100*----------------------------------------------------------------*05320006
053200 2000-PROCESS-PANEL.                                              05330006
053300                                                                  05340006
053400     EVALUATE TRUE                                                05350006
053500                                                                  05360006
053600         WHEN DP020-SRC-AID = DP016-CLEAR                         05370006
053700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05380006
053800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05390006
053900                                                                  05400006
054000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05410006
054100             INITIALIZE ASC-SCREEN-FIELDS                         05420006
054200             PERFORM 4000-BUILD-INITIAL-PANEL                     05430006
054300             PERFORM 3200-RESET-ATTRIBUTES                        05440006
054400                                                                  05450006
054500         WHEN OTHER                                               05460006
054600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05470006
054700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05480006
054800             IF  PS-NO-ERROR                                      05490006
054900                 PERFORM 2100-CHECK-FUNCTION-KEY                  05500006
055000                 SET DP030-CONTINUE-GO TO TRUE                    05510006
055100             ELSE                                                 05520006
055200                 SET DP030-OVERRIDE-GO TO TRUE                    05530006
055300             END-IF                                               05540006
055400     END-EVALUATE.                                                05550006
055500                                                                  05560006
055600 EJECT                                                            05570006
055700******************************************************************05580006
055800** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **05590006
055900** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **05600006
056000** FROM THE CICS ARCHITECTURE API.                              **05610006
056100******************************************************************05620006
056200 2100-CHECK-FUNCTION-KEY.                                         05630006
056300     EVALUATE TRUE                                                05640006
056400                                                                  05650006
056500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05660006
056600             PERFORM 5000-ADD-SHPTPO                              05670006
056700             SET ASC-ADD-COMPLETE  TO TRUE                        05680006
056800*            -- OBJECT WAS ADDED --                               05690006
056900             MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER            05700006
057000             SET DP020-MSG-INFORMATIONAL TO TRUE                  05710006
057100             PERFORM 2110-PREPARE-INTER-APPL-COMM                 05720006
057200             SET DP030-ERASE-UNPROT TO TRUE                       05730006
057300                                                                  05740006
057400         WHEN DP020-SRC-AID = DP016-ENTER                         05750006
057500             CONTINUE                                             05760006
057600                                                                  05770006
057700         WHEN OTHER                                               05780006
057800             SET DP013-NO-ROLLBACK                                05790006
057900                 DP013-XCTL-DISPLAY-RESTART                       05800006
058000                 DP013-CICS-ABEND  TO TRUE                        05810006
058100             MOVE '2100-CHECK-FUNCTION-KEY'                       05820006
058200                                   TO DP013-PARAGRAPH             05830006
058300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05840006
058400                                   TO DP013-MESSAGE-TEXT (1)      05850006
058500             PERFORM DP013-0000-PROCESS-ABEND                     05860006
058600     END-EVALUATE.                                                05870006
058700 EJECT                                                            05880006
058800******************************************************************05890006
058900** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **05900006
059000** INTER-APPLICATION COMMAREA.                                  **05910006
059100******************************************************************05920006
059200 2110-PREPARE-INTER-APPL-COMM.                                    05930006
059300*    MOVE ASC-MSG-NUMBER-N         TO DP058-MESSAGE-NUMBER.       05940006
059400/                                                                 05950006
059500*----------------------------------------------------------------*05960006
059600*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*05970006
059700*----------------------------------------------------------------*05980006
059800*----------------------------------------------------------------*05990006
059900* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06000006
060000* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06010006
060100* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *06020006
060200*----------------------------------------------------------------*06030006
060300                                                                  06040006
060400 2200-MOVE-SCREEN-TO-COMMAREA.                                    06050006
060500     IF  APONBRL > ZERO                                           06060006
060600         MOVE APONBRI              TO ASC-PO-NUMBER               06070006
060700     ELSE                                                         06080006
060800         IF  APONBRF = DP015-ERASE-EOF                            06090006
060900             MOVE SPACE            TO ASC-PO-NUMBER               06100006
061000         END-IF                                                   06110006
061100     END-IF.                                                      06120006
061200                                                                  06130006
061300     IF  APCKSLPL > ZERO                                          06140006
061400         MOVE APCKSLPI             TO ASC-PACKSLIP-IND            06150006
061500     ELSE                                                         06160006
061600         IF  APCKSLPF = DP015-ERASE-EOF                           06170006
061700             MOVE SPACE            TO ASC-PACKSLIP-IND            06180006
061800         END-IF                                                   06190006
061900     END-IF.                                                      06200006
062000                                                                  06210006
062100     IF  AEXPCNTL > ZERO                                          06220006
062200         MOVE AEXPCNTI             TO ASC-EXP-CARTON-COUNT        06230006
062300     ELSE                                                         06240006
062400         IF  AEXPCNTF = DP015-ERASE-EOF                           06250006
062500             MOVE SPACE            TO ASC-EXP-CARTON-COUNT        06260006
062600         END-IF                                                   06270006
062700     END-IF.                                                      06280006
062800                                                                  06290006
062900                                                                  06300006
063000*----------------------------------------------------------------*06310006
063100* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06320006
063200* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *06330006
063300* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06340006
063400*----------------------------------------------------------------*06350006
063500                                                                  06360006
063600 3000-EDIT-DATA-IN-COMMAREA.                                      06370006
063700     PERFORM 3200-RESET-ATTRIBUTES.                               06380006
063800                                                                  06390006
063900     IF  ASC-EXP-CARTON-COUNT > SPACES                            06400006
064000         MOVE ASC-EXP-CARTON-COUNT  TO DP010I-UNEDITED-FIELD      06410006
064100         MOVE LENGTH OF ASC-EXP-CARTON-COUNT                      06420006
064200                                    TO DP010I-MAXIMUM-DIGITS      06430006
064300         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    06440006
064400         SET  DP010I-NEGATIVE-NOT-ALLOWED                         06450006
064500                                    TO TRUE                       06460006
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06471014
263697              USING DP010I-NUMERIC-EDIT-AREA                      06472014
064700         IF  DP010I-ERROR-DETECTED                                06480006
064800             SET PS-ERROR                                         06490006
064900                 DP020-MSG-FATAL    TO TRUE                       06500006
065000             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           06510006
065100             MOVE DP015-UNP-ALP-BRT-OFF                           06520006
065200                                    TO AEXPCNTA                   06530006
065300             MOVE DP015-RED         TO AEXPCNTC                   06540006
065400             MOVE DP015-REVERSE     TO AEXPCNTH                   06550006
065500             MOVE -1                TO AEXPCNTL                   06560006
065600             SET DP030-SET-CURSOR-APPL-1                          06570006
065700                                    TO TRUE                       06580006
065800         ELSE                                                     06590006
065900             MOVE DP010I-NUMERIC-FIELD                            06600006
066000                                    TO ASC-EXP-CARTON-COUNT-N     06610006
066100             MOVE ASC-EXP-CARTON-COUNT-N                          06620006
066200                                    TO AEXPCNTO                   06630006
066300         END-IF                                                   06640006
066400     END-IF.                                                      06650006
066500                                                                  06660006
066600     IF  ASC-PACKSLIP-IND = (' ' OR 'Y' OR 'N')                   06670006
066700         CONTINUE                                                 06680006
066800     ELSE                                                         06690006
066900         SET PS-ERROR                                             06700006
067000             DP020-MSG-FATAL        TO TRUE                       06710006
067100         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           06720006
067200         MOVE DP015-UNP-ALP-BRT-OFF TO APCKSLPA                   06730006
067300         MOVE DP015-RED             TO APCKSLPC                   06740006
067400         MOVE DP015-REVERSE         TO APCKSLPH                   06750006
067500         MOVE -1                    TO APCKSLPL                   06760006
067600         SET DP030-SET-CURSOR-APPL-1                              06770006
067700                                    TO TRUE                       06780006
067800     END-IF.                                                      06790006
067900                                                                  06800006
068000     IF  ASC-PO-NUMBER = (SPACES OR ZEROES)                       06810006
068100         SET PS-ERROR                                             06820006
068200             DP020-MSG-FATAL        TO TRUE                       06830006
068300         MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER           06840006
068400         MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                    06850006
068500         MOVE DP015-RED             TO APONBRC                    06860006
068600         MOVE DP015-REVERSE         TO APONBRH                    06870006
068700         MOVE -1                    TO APONBRL                    06880006
068800         SET DP030-SET-CURSOR-APPL-1                              06890006
068900                                    TO TRUE                       06900006
069000     ELSE                                                         06910006
069100         MOVE ASC-PO-NUMBER         TO DP010I-UNEDITED-FIELD      06920006
069200         MOVE LENGTH OF ASC-PO-NUMBER TO DP010I-MAXIMUM-DIGITS    06930006
069300         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    06940006
069400         SET  DP010I-NEGATIVE-NOT-ALLOWED                         06950006
069500                                    TO TRUE                       06960006
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06971014
263697              USING DP010I-NUMERIC-EDIT-AREA                      06972014
069700         IF  DP010I-ERROR-DETECTED                                06980006
069800             SET PS-ERROR                                         06990006
069900                 DP020-MSG-FATAL    TO TRUE                       07000006
070000             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           07010006
070100             MOVE DP015-UNP-ALP-BRT-OFF                           07020006
070200                                    TO APONBRA                    07030006
070300             MOVE DP015-RED         TO APONBRC                    07040006
070400             MOVE DP015-REVERSE     TO APONBRH                    07050006
070500             MOVE -1                TO APONBRL                    07060006
070600             SET DP030-SET-CURSOR-APPL-1                          07070006
070700                                    TO TRUE                       07080006
070800         ELSE                                                     07090006
070900             MOVE DP010I-NUMERIC-FIELD                            07100006
071000                                    TO ASC-PO-NUMBER-N            07110006
071100                                       DK-PO-NBR                  07120006
071200             MOVE ASC-PO-NUMBER-N   TO APONBRO                    07130006
071300             MOVE ASC-KEY-SHIPT-ID  TO DK-SHIPT-ID                07140006
071400             INITIALIZE PV-DB2-COUNT                              07150006
071500             PERFORM 3030-CHECK-DUPL-SHPPO                        07160006
071600             IF  PV-DB2-COUNT > +0                                07170006
071700                 SET PS-ERROR                                     07180006
071800                     DP020-MSG-FATAL    TO TRUE                   07190006
071900                 MOVE PC-TSYMSG-00117   TO DP020-MSG-NUMBER       07200006
072000                 MOVE DP015-UNP-ALP-BRT-OFF                       07210006
072100                                        TO APONBRA                07220006
072200                 MOVE DP015-RED         TO APONBRC                07230006
072300                 MOVE DP015-REVERSE     TO APONBRH                07240006
072400                 MOVE -1                TO APONBRL                07250006
072500                 SET DP030-SET-CURSOR-APPL-1                      07260006
072600                                        TO TRUE                   07270006
072700             ELSE                                                 07280006
072800                 PERFORM 3010-GET-DEPT-NBR                        07290006
072900                 IF  SQLCODE = +100                               07300006
073000                     SET  DP020-MSG-WARNING                       07310006
073100                                          TO TRUE                 07320006
073200                     MOVE PC-TSYMSG-00083 TO DP020-MSG-NUMBER     07330006
073300                 END-IF                                           07340006
073400             END-IF                                               07350006
073500         END-IF                                                   07360006
073600     END-IF.                                                      07370006
073700                                                                  07380006
073800     IF  PS-NO-ERROR                                              07390006
073900         MOVE 'N'                       TO ASC-ACTIVE-PO-SW       07400006
074000         PERFORM 3020-CHECK-ACTIVE-PO                             07410006
074100         IF  SQLCODE = +100                                       07420006
074200             SET PS-ERROR                                         07430006
074300                 DP020-MSG-FATAL        TO TRUE                   07440006
074400             MOVE PC-TSYMSG-00083       TO DP020-MSG-NUMBER       07450006
074500             MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                07460006
074600             MOVE DP015-RED             TO APONBRC                07470006
074700             MOVE DP015-REVERSE         TO APONBRH                07480006
074800             MOVE -1                    TO APONBRL                07490006
074900             SET DP030-SET-CURSOR-APPL-1                          07500006
075000                                        TO TRUE                   07510006
075100         ELSE                                                     07520006
075200             MOVE ENTNME-ENT-NAME-DESC  TO ASC-VENDOR-NAME        07530006
075300                                           AVNDNMEO               07540006
075400             SET ASC-ACTIVE-PO          TO TRUE                   07550006
075500         END-IF                                                   07560006
075600     END-IF.                                                      07570006
075700                                                                  07580006
075800     IF  PS-NO-ERROR                                              07590006
075900        IF ASC-PO-NUMBER > SPACES                                 07600006
076000           MOVE ASC-PO-NUMBER-N TO DK-PO-NBR                      07610006
076100           PERFORM 3040-GET-PO-INFO                               07620006
076200        ELSE                                                      07630006
076300           MOVE SPACES  TO ANODISTO                               07640006
076400                           APOSTATO                               07650006
076500                           ADNSDTEO                               07660006
076600                           ACANDTEO                               07670006
076700                           ACANDTEO                               07680006
076800                           AEXCDTEO                               07690006
077000*                          ADPTDSCO                               07710006
077100                           ABYRNMEO                               07720006
077110           MOVE ZEROES  TO ADPTNBRO                               07721010
077200        END-IF                                                    07730006
077300     ELSE                                                         07740006
077400        IF ASC-PO-STATUS > SPACES AND                             07750006
077500          (ASC-PO-STATUS NOT EQUAL PC-PO-ACTIVE AND               07760006
077600           ASC-PO-STATUS NOT EQUAL PC-APPROVED)                   07770006
077700           MOVE DP015-YELLOW TO APOSTATC                          07780006
077800        END-IF                                                    07790006
077900     END-IF.                                                      07800006
078000                                                                  07810006
078100     IF  PS-NO-ERROR                                              07820006
078200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     07830006
078300         MOVE -1           TO APONBRL                             07840006
078400         SET DP030-SET-CURSOR-APPL-1                              07850006
078500                                   TO TRUE                        07860006
078600     END-IF.                                                      07870006
078700                                                                  07880006
078800/                                                                 07890006
078900*----------------------------------------------------------------*07900006
079000*  RETRIEVE THE DEPARTMENT NUMBER                                 07910006
079100*----------------------------------------------------------------*07920006
079200                                                                  07930006
079300 3010-GET-DEPT-NBR.                                               07940006
079400                                                                  07950006
079500     PERFORM                                                      07960006
079600         WITH TEST AFTER                                          07970006
079700         VARYING PV-RETRY-COUNTER                                 07980006
079800         FROM 1 BY 1                                              07990006
079900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08000006
080000             OR (SQLCODE = +0)                                    08010006
080100             OR (SQLCODE = +100))                                 08020006
080200                                                                  08030006
080300         EXEC SQL                                                 08040006
080400              SELECT DEPT_NBR                                     08050006
080500                INTO :PURCHS-DEPT-NBR                             08060006
080600                FROM TPURCHS                                      08070006
080700               WHERE PO_NBR         = :DK-PO-NBR                  08080006
080800                 AND VER_STATUS_CDE = 'A'                         08090006
080900         END-EXEC                                                 08100006
081000                                                                  08110006
081100         EVALUATE TRUE                                            08120006
081200             WHEN SQLCODE = +0                                    08130006
081300                  MOVE PURCHS-DEPT-NBR                            08140006
081400                                  TO ASC-DEPT-NBR-N               08150008
081500                                                                  08160006
081600             WHEN SQLCODE = +100                                  08170006
081700             WHEN SQLCODE = -904                                  08180006
081800             WHEN SQLCODE = -913                                  08190006
081900                  CONTINUE                                        08200006
082000                                                                  08210006
082100             WHEN SQLWARN0 NOT = SPACES                           08220006
082200             WHEN SQLCODE < +0                                    08230006
082300             WHEN SQLCODE > +0                                    08240006
082400                  MOVE '3010-GET-DEPT-NBR'                        08250006
082500                                  TO DP013-PARAGRAPH              08260006
082600                  MOVE 'UNSUCCESSFUL SELECT FOR DEPT NBR   '      08270006
082700                                  TO DP013-MESSAGE-TEXT (1)       08280006
082800                  MOVE SQLCA      TO DP013-SQLCA                  08290006
082900                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     08300006
083000                  SET DP013-DB2-ABEND                             08310006
083100                      DP013-XCTL-DISPLAY-RESTART                  08320006
083200                                  TO TRUE                         08330006
083300                  PERFORM DP013-0000-PROCESS-ABEND                08340006
083400         END-EVALUATE                                             08350006
083500     END-PERFORM.                                                 08360006
083600                                                                  08370006
083700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08380006
083800         SQLCODE NOT = +0                                         08390006
083900         MOVE '3010-GET-DEPT-NBR '                                08400006
084000                                  TO DP013-PARAGRAPH              08410006
084100         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR DEPT NBR'       08420006
084200                                  TO DP013-MESSAGE-TEXT (1)       08430006
084300         MOVE SQLCA               TO DP013-SQLCA                  08440006
084400         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     08450006
084500         SET DP013-DB2-ABEND                                      08460006
084600             DP013-XCTL-DISPLAY-RESTART                           08470006
084700                                  TO TRUE                         08480006
084800         PERFORM DP013-0000-PROCESS-ABEND                         08490006
084900     END-IF.                                                      08500006
085000                                                                  08510006
085100/                                                                 08520006
085200/                                                                 08530006
085300*----------------------------------------------------------------*08540006
085400* CHECK TO SEE IF PO NUMBER IS ACTIVE                            *08550006
085500*----------------------------------------------------------------*08560006
085600 3020-CHECK-ACTIVE-PO.                                            08570006
085700                                                                  08580006
085800     PERFORM                                                      08590006
085900         WITH TEST AFTER                                          08600006
086000         VARYING PV-RETRY-COUNTER                                 08610006
086100         FROM 1 BY 1                                              08620006
086200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08630006
086300             OR (SQLCODE = +0)                                    08640006
086400             OR (SQLCODE = +100))                                 08650006
086500                                                                  08660006
086600         EXEC SQL                                                 08670006
086700              SELECT B.ENT_NAME_DESC                              08680006
086800                INTO :ENTNME-ENT-NAME-DESC                        08690006
086900                FROM TPURCHS A                                    08700006
087000                    ,TENTNME B                                    08710006
087100               WHERE A.PO_NBR         = :DK-PO-NBR                08720006
087200                 AND A.VER_STATUS_CDE = 'A'                       08730006
087300                 AND B.TYPE_CDE       = '01'                      08740006
087400                 AND A.STATUS_CDE IN ('CA', 'CM', 'AP', 'AC')     08750006
087500                 AND A.ENT_ID     = B.ENT_ID                      08760006
087600         END-EXEC                                                 08770006
087700                                                                  08780006
087800         EVALUATE TRUE                                            08790006
087900             WHEN SQLCODE = +0                                    08800006
088000             WHEN SQLCODE = +100                                  08810006
088100             WHEN SQLCODE = -904                                  08820006
088200             WHEN SQLCODE = -913                                  08830006
088300                  CONTINUE                                        08840006
088400                                                                  08850006
088500             WHEN SQLWARN0 NOT = SPACES                           08860006
088600             WHEN SQLCODE < +0                                    08870006
088700             WHEN SQLCODE > +0                                    08880006
088800                  MOVE '3020-CHECK-ACTIVE-PO  '                   08890006
088900                                  TO DP013-PARAGRAPH              08900006
089000                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      08910006
089100                                  TO DP013-MESSAGE-TEXT (1)       08920006
089200                  MOVE SQLCA      TO DP013-SQLCA                  08930006
089300                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     08940006
089400                  SET DP013-DB2-ABEND                             08950006
089500                      DP013-XCTL-DISPLAY-RESTART                  08960006
089600                                  TO TRUE                         08970006
089700                  PERFORM DP013-0000-PROCESS-ABEND                08980006
089800         END-EVALUATE                                             08990006
089900     END-PERFORM.                                                 09000006
090000                                                                  09010006
090100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09020006
090200         SQLCODE NOT = +0                                         09030006
090300         MOVE '3020-CHECK-ACTIVE-PO  '                            09040006
090400                                  TO DP013-PARAGRAPH              09050006
090500         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    09060006
090600                                  TO DP013-MESSAGE-TEXT (1)       09070006
090700         MOVE SQLCA               TO DP013-SQLCA                  09080006
090800         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     09090006
090900         SET DP013-DB2-ABEND                                      09100006
091000             DP013-XCTL-DISPLAY-RESTART                           09110006
091100                                  TO TRUE                         09120006
091200         PERFORM DP013-0000-PROCESS-ABEND                         09130006
091300     END-IF.                                                      09140006
091400                                                                  09150006
091500/                                                                 09160006
091600 3030-CHECK-DUPL-SHPPO.                                           09170006
091700                                                                  09180006
091800     PERFORM                                                      09190006
091900         WITH TEST AFTER                                          09200006
092000         VARYING PV-RETRY-COUNTER                                 09210006
092100         FROM 1 BY 1                                              09220006
092200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09230006
092300             OR (SQLCODE = +0)                                    09240006
092400             OR (SQLCODE = +100))                                 09250006
092500                                                                  09260006
092600         EXEC SQL                                                 09270006
092700             SELECT COUNT(*)                                      09280006
092800              INTO  :PV-DB2-COUNT                                 09290006
092900           FROM   TSHPTPO                                         09300006
093000           WHERE  SHIPT_ID = :DK-SHIPT-ID                         09310006
093100             AND  PO_NBR   = :DK-PO-NBR                           09320006
093200         END-EXEC                                                 09330006
093300                                                                  09340006
093400         EVALUATE TRUE                                            09350006
093500             WHEN SQLCODE = +0                                    09360006
093600             WHEN SQLCODE = +100                                  09370006
093700             WHEN SQLCODE = -904                                  09380006
093800             WHEN SQLCODE = -913                                  09390006
093900                 CONTINUE                                         09400006
094000                                                                  09410006
094100             WHEN SQLWARN0 NOT = SPACES                           09420006
094200             WHEN SQLCODE < +0                                    09430006
094300             WHEN SQLCODE > +0                                    09440006
094400                 MOVE '3030-CHECK-DUPL-SHPPO   '                  09450006
094500                                   TO DP013-PARAGRAPH             09460006
094600                 MOVE 'SELECT A TSHPTPO ROW   '                   09470006
094700                                   TO DP013-MESSAGE-TEXT(1)       09480006
094800                 MOVE SQLCA        TO DP013-SQLCA                 09490006
094900                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    09500006
095000                 SET DP013-DB2-ABEND                              09510006
095100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09520006
095200                 PERFORM DP013-0000-PROCESS-ABEND                 09530006
095300         END-EVALUATE                                             09540006
095400     END-PERFORM.                                                 09550006
095500                                                                  09560006
095600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09570006
095700         SQLCODE NOT = +0                                         09580006
095800         MOVE '3030-CHECK-DUPL-SHPPO   '                          09590006
095900                                   TO DP013-PARAGRAPH             09600006
096000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09610006
096100                                   TO DP013-MESSAGE-TEXT (1)      09620006
096200         MOVE 'TO SELECT A TSHPTPO ROW'                           09630006
096300                                   TO DP013-MESSAGE-TEXT (2)      09640006
096400         MOVE SQLCA                TO DP013-SQLCA                 09650006
096500         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    09660006
096600         SET DP013-DB2-ABEND                                      09670006
096700             DP013-XCTL-DISPLAY-RESTART                           09680006
096800                                   TO TRUE                        09690006
096900         PERFORM DP013-0000-PROCESS-ABEND                         09700006
097000     END-IF.                                                      09710006
097100                                                                  09720006
097200*----------------------------------------------------------------*09730006
097300*    SELECT THE NEEDED INFORMATION FROM THE PURCHASE ORDER HEADER*09740006
097400*    TABLE.                                                      *09750006
097500*----------------------------------------------------------------*09760006
097600                                                                  09770006
097700 3040-GET-PO-INFO.                                                09780006
097800                                                                  09790006
097900     PERFORM 3050-SELECT-TPURCHS                                  09800006
098000                                                                  09810006
098100     IF PS-FOUND                                                  09820006
098200        PERFORM 3060-CHECK-STATUS                                 09830006
098300        PERFORM 3070-SELECT-TPLNSHP                               09840006
098400        PERFORM 3080-SELECT-DPT-BYR                               09850006
098500        PERFORM 3090-DETERMINE-NO-DISTRO                          09860006
098600        MOVE ASC-KEY-OPER-UNT-ID      TO AOPERIDO                 09870006
098700        MOVE ASC-KEY-FCLTY-ID         TO AFCLTYO                  09880006
098800        MOVE ASC-FCLTY-NME            TO AOPRDESO                 09890006
098900        MOVE ASC-NO-DISTRO-MSG        TO ANODISTO                 09900006
099000        MOVE ASC-PO-STATUS-DESC       TO APOSTATO                 09910006
099100        MOVE ASC-DONT-SHIP-BEF-DTE    TO ADNSDTEO                 09920006
099200        MOVE ASC-CANCEL-DTE           TO ACANDTEO                 09930006
099300        MOVE ASC-EXT-CAN-DTE          TO AEXCDTEO                 09940006
099400        MOVE ASC-DEPT-NBR-N           TO ADPTNBRO                 09950008
099500*       MOVE ASC-DEPT-DESC            TO ADPTDSCO                 09960006
099600        MOVE ASC-BUYER-NME            TO ABYRNMEO                 09970006
099700     ELSE                                                         09980006
099800        SET PS-ERROR              TO TRUE                         09990006
099900        SET DP020-MSG-FATAL       TO TRUE                         10000006
100000        MOVE -1                   TO APONBRL                      10010006
100100        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       10020006
100200        MOVE PC-TSYMSG-00083      TO DP020-MSG-NUMBER             10030006
100300        MOVE SPACES               TO ANODISTO                     10040006
100400                                     ADNSDTEO                     10050006
100500                                     ACANDTEO                     10060006
100600                                     AEXCDTEO                     10070006
100800*                                    ADPTDSCO                     10090006
100900                                     ABYRNMEO                     10100006
100910        MOVE ZEROES               TO ADPTNBRO                     10101010
101000     END-IF.                                                      10110006
101100                                                                  10120006
101200                                                                  10130006
101300 3050-SELECT-TPURCHS.                                             10140006
101400*----------------------------------------------------------------*10150006
101500****   SELECT THE TPURCHS INFORMATION   *****                     10160006
101600*----------------------------------------------------------------*10170006
101700     PERFORM WITH TEST AFTER                                      10180006
101800         VARYING PV-RETRY-COUNTER                                 10190006
101900         FROM 1 BY 1                                              10200006
102000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 10210006
102100                 OR SQLCODE = 0                                   10220006
102200                 OR SQLCODE = +100)                               10230006
102300                                                                  10240006
102400         EXEC SQL                                                 10250006
102500             SELECT STATUS_CDE                                    10260006
102600                   ,DEPT_NBR                                      10270006
102700                   ,ENT_ID                                        10280006
102800             INTO   :PURCHS-STATUS-CDE                            10290006
102900                   ,:PURCHS-DEPT-NBR                              10300006
103000                   ,:PURCHS-ENT-ID                                10310006
103100             FROM   TPURCHS                                       10320006
103200             WHERE  PO_NBR         = :DK-PO-NBR                   10330006
103300             AND    VER_STATUS_CDE = :PC-ACTIVE                   10340006
103400         END-EXEC                                                 10350006
103500                                                                  10360006
103600         EVALUATE TRUE                                            10370006
103700             WHEN SQLCODE = +0                                    10380006
103800                  SET PS-FOUND TO TRUE                            10390006
103900                  MOVE PURCHS-DEPT-NBR TO ASC-DEPT-NBR-N          10400008
104000                  MOVE PURCHS-ENT-ID   TO ASC-ENT-ID              10410006
104100                                                                  10420006
104200             WHEN SQLCODE = +100                                  10430006
104300                  SET PS-NOT-FOUND TO TRUE                        10440006
104400                  MOVE SPACES  TO ASC-NO-DISTRO-MSG               10450006
104500                                  ASC-PO-STATUS-DESC              10460006
104600                                  ASC-DONT-SHIP-BEF-DTE           10470006
104700                                  ASC-CANCEL-DTE                  10480006
104800                                  ASC-EXT-CAN-DTE                 10490006
104900                                  ASC-DEPT-NBR                    10500006
105000                                  ASC-DEPT-DESC                   10510006
105100                                  ASC-BUYER-NME                   10520006
105200             WHEN SQLCODE = -904                                  10530006
105300             WHEN SQLCODE = -911                                  10540006
105400             WHEN SQLCODE = -913                                  10550006
105500                  CONTINUE                                        10560006
105600                                                                  10570006
105700             WHEN OTHER                                           10580006
105800                  SET  PS-DONE TO TRUE                            10590006
105900                  MOVE '3050-SELECT-PURCHS'                       10600006
106000                                  TO DP013-PARAGRAPH              10610006
106100                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS  '         10620006
106200                                  TO DP013-MESSAGE-TEXT (1)       10630006
106300                  MOVE SQLCA      TO DP013-SQLCA                  10640006
106400                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     10650006
106500                  SET DP013-DB2-ABEND                             10660006
106600                      DP013-XCTL-DISPLAY-RESTART                  10670006
106700                                  TO TRUE                         10680006
106800                  PERFORM DP013-0000-PROCESS-ABEND                10690006
106900         END-EVALUATE                                             10700006
107000     END-PERFORM.                                                 10710006
107100                                                                  10720006
107200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     10730006
107300         SQLCODE NOT = +0                                         10740006
107400         SET  PS-DONE TO TRUE                                     10750006
107500         MOVE '3050-SELECT-TPURCHS '                              10760006
107600                         TO DP013-PARAGRAPH                       10770006
107700         MOVE 'UNSUCCESSFUL SELECT ON TPURCHS  '                  10780006
107800                         TO DP013-MESSAGE-TEXT (1)                10790006
107900         MOVE SQLCA      TO DP013-SQLCA                           10800006
108000         MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)              10810006
108100         SET DP013-DB2-ABEND                                      10820006
108200             DP013-XCTL-DISPLAY-RESTART                           10830006
108300                         TO TRUE                                  10840006
108400         PERFORM DP013-0000-PROCESS-ABEND                         10850006
108500     END-IF.                                                      10860006
108600                                                                  10870006
108700*                                                                 10880006
108800****   GET THE STATUS DESCRIPTION       *****                     10890006
108900*                                                                 10900006
109000     IF PS-FOUND                                                  10910006
109100        PERFORM WITH TEST AFTER                                   10920006
109200            VARYING PV-RETRY-COUNTER                              10930006
109300            FROM 1 BY 1                                           10940006
109400            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              10950006
109500                    OR SQLCODE = 0                                10960006
109600                    OR SQLCODE = +100)                            10970006
109700                                                                  10980006
109800            EXEC SQL                                              10990006
109900                SELECT STATUS_DESC                                11000006
110000                INTO   :STATCD-STATUS-DESC                        11010006
110100                FROM   TSTATCD                                    11020006
110200                WHERE  STATUS_CDE     = :PURCHS-STATUS-CDE        11030006
110300                AND    STATUS_TYP_CDE = 'P'                       11040006
110400            END-EXEC                                              11050006
110500                                                                  11060006
110600            EVALUATE TRUE                                         11070006
110700                WHEN SQLCODE = +0                                 11080006
110800                     MOVE PURCHS-STATUS-CDE  TO ASC-PO-STATUS     11090006
110900                     MOVE STATCD-STATUS-DESC TO ASC-PO-STATUS-DESC11100006
111000                                                                  11110006
111100                WHEN SQLCODE = +100                               11120006
111200                     SET PS-NOT-FOUND TO TRUE                     11130006
111300                WHEN SQLCODE = -904                               11140006
111400                WHEN SQLCODE = -911                               11150006
111500                WHEN SQLCODE = -913                               11160006
111600                     CONTINUE                                     11170006
111700                                                                  11180006
111800                WHEN OTHER                                        11190006
111900                     SET  PS-DONE TO TRUE                         11200006
112000                     MOVE '3050-SELECT-TSTATCD'                   11210006
112100                                     TO DP013-PARAGRAPH           11220006
112200                     MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '      11230006
112300                                     TO DP013-MESSAGE-TEXT (1)    11240006
112400                     MOVE SQLCA      TO DP013-SQLCA               11250006
112500                     MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)  11260006
112600                     SET DP013-DB2-ABEND                          11270006
112700                         DP013-XCTL-DISPLAY-RESTART               11280006
112800                                     TO TRUE                      11290006
112900                     PERFORM DP013-0000-PROCESS-ABEND             11300006
113000            END-EVALUATE                                          11310006
113100        END-PERFORM                                               11320006
113200     END-IF.                                                      11330006
113300                                                                  11340006
113400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     11350006
113500         SQLCODE NOT = +0                                         11360006
113600         SET  PS-DONE TO TRUE                                     11370006
113700         MOVE '3050-SELECT-TSTATCD '                              11380006
113800                         TO DP013-PARAGRAPH                       11390006
113900         MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '                  11400006
114000                         TO DP013-MESSAGE-TEXT (1)                11410006
114100         MOVE SQLCA      TO DP013-SQLCA                           11420006
114200         MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)              11430006
114300         SET DP013-DB2-ABEND                                      11440006
114400             DP013-XCTL-DISPLAY-RESTART                           11450006
114500                         TO TRUE                                  11460006
114600         PERFORM DP013-0000-PROCESS-ABEND                         11470006
114700     END-IF.                                                      11480006
114800                                                                  11490006
114900 3060-CHECK-STATUS.                                               11500006
115000*----------------------------------------------------------------*11510006
115100*  A PO MAY NOT BE ADDED TO THE FORECAST SYSTEM IF THE PO STATUS  11520006
115200*  IS NOT ONE OF THE FOLLOWING STATUS - ACTIVE, APPROVED, COMPLETE11530006
115300*  , CANCELLED, OR CANCEL BALANCE.  THE STATUS WILL BE HIGHLIGHTED11540006
115400*  IF NOT 'ACTIVE' OR 'APPROVED'.                                 11550006
115500*----------------------------------------------------------------*11560006
115600                                                                  11570006
115700      SET ASC-VALID-PO-STATUS TO TRUE.                            11580006
115800                                                                  11590006
115900      EVALUATE PURCHS-STATUS-CDE                                  11600006
116000         WHEN PC-PO-ACTIVE                                        11610006
116100         WHEN PC-APPROVED                                         11620006
116200              CONTINUE                                            11630006
116300         WHEN PC-CANCELLED                                        11640006
116400         WHEN PC-COMPLETE                                         11650006
116500         WHEN PC-CANBALENCE                                       11660006
116600              MOVE DP015-YELLOW       TO APOSTATC                 11670006
116700         WHEN OTHER                                               11680006
116800              SET ASC-INVALID-PO-STATUS TO TRUE                   11690006
116900              MOVE DP015-YELLOW       TO APOSTATC                 11700006
117000      END-EVALUATE.                                               11710006
117100                                                                  11720006
117200 3070-SELECT-TPLNSHP.                                             11730006
117300*----------------------------------------------------------------*11740006
117400*  SELECT THE NEEDED INFORMATION FROM THE TPLNSHP TABLE           11750006
117500*----------------------------------------------------------------*11760006
117600                                                                  11770006
117700     PERFORM WITH TEST AFTER                                      11780006
117800         VARYING PV-RETRY-COUNTER                                 11790006
117900         FROM 1 BY 1                                              11800006
118000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 11810006
118100                 OR SQLCODE = 0                                   11820006
118200                 OR SQLCODE = +100)                               11830006
118300                                                                  11840006
118400         EXEC SQL                                                 11850006
118500             SELECT DONT_SHIP_BEF_DTE                             11860006
118600                   ,CAN_IFNOT_SHIP_DTE                            11870006
118700                   ,EXT_CAN_DTE                                   11880006
118800             INTO   :PLNSHP-DONT-SHIP-BEF-DTE                     11890006
118900                   ,:PLNSHP-CAN-IFNOT-SHIP-DTE                    11900006
119000                   ,:PLNSHP-EXT-CAN-DTE                           11910006
119100             FROM   TPLNSHP                                       11920006
119200             WHERE  PO_NBR         = :DK-PO-NBR                   11930006
119300             AND    VER_STATUS_CDE = :PC-ACTIVE                   11940006
119400         END-EXEC                                                 11950006
119500                                                                  11960006
119600         EVALUATE TRUE                                            11970006
119700             WHEN SQLCODE = +0                                    11980006
119800                MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-TEMP-DATE     11990006
119900                MOVE PV-DATE-CCYY  TO PV-WK-DTE-YY                12000006
120000                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                12010006
120100                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                12020006
120200                MOVE PV-WORK-DATE  TO ASC-DONT-SHIP-BEF-DTE       12030006
120300                                                                  12040006
120400                MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-TEMP-DATE    12050006
120500                MOVE PV-DATE-CCYY  TO PV-WK-DTE-YY                12060006
120600                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                12070006
120700                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                12080006
120800                MOVE PV-WORK-DATE  TO ASC-CANCEL-DTE              12090006
120900                                                                  12100006
121000                MOVE PLNSHP-EXT-CAN-DTE TO PV-TEMP-DATE           12110006
121100                MOVE PV-DATE-CCYY  TO PV-WK-DTE-YY                12120006
121200                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                12130006
121300                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                12140006
121400                MOVE PV-WORK-DATE  TO ASC-EXT-CAN-DTE             12150006
121500                                                                  12160006
121600             WHEN SQLCODE = +100                                  12170006
121700                  SET PS-DONE  TO TRUE                            12180006
121800             WHEN SQLCODE = -904                                  12190006
121900             WHEN SQLCODE = -911                                  12200006
122000             WHEN SQLCODE = -913                                  12210006
122100                  CONTINUE                                        12220006
122200                                                                  12230006
122300             WHEN OTHER                                           12240006
122400                  SET  PS-DONE TO TRUE                            12250006
122500                  MOVE '3070-SELECT-TPLNSHP'                      12260006
122600                                  TO DP013-PARAGRAPH              12270006
122700                  MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '         12280006
122800                                  TO DP013-MESSAGE-TEXT (1)       12290006
122900                  MOVE SQLCA      TO DP013-SQLCA                  12300006
123000                  MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)     12310006
123100                  SET DP013-DB2-ABEND                             12320006
123200                      DP013-XCTL-DISPLAY-RESTART                  12330006
123300                                  TO TRUE                         12340006
123400                  PERFORM DP013-0000-PROCESS-ABEND                12350006
123500         END-EVALUATE                                             12360006
123600     END-PERFORM.                                                 12370006
123700                                                                  12380006
123800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     12390006
123900         SQLCODE NOT = +0                                         12400006
124000         SET  PS-DONE TO TRUE                                     12410006
124100         MOVE '3070-SELECT-TPLNSHP'                               12420006
124200                         TO DP013-PARAGRAPH                       12430006
124300         MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '                  12440006
124400                         TO DP013-MESSAGE-TEXT (1)                12450006
124500         MOVE SQLCA      TO DP013-SQLCA                           12460006
124600         MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)              12470006
124700         SET DP013-DB2-ABEND                                      12480006
124800             DP013-XCTL-DISPLAY-RESTART                           12490006
124900                         TO TRUE                                  12500006
125000         PERFORM DP013-0000-PROCESS-ABEND                         12510006
125100     END-IF.                                                      12520006
125200                                                                  12530006
125300                                                                  12540006
125400 3080-SELECT-DPT-BYR.                                             12550006
125500*----------------------------------------------------------------*12560006
125600*  SELECT THE NEEDED INFORMATION FROM THE TMDSEAR AND TRSPBAR     12570006
125700*  TABLES                                                         12580006
125800*----------------------------------------------------------------*12590006
125900                                                                  12600006
126000     PERFORM WITH TEST AFTER                                      12610006
126100         VARYING PV-RETRY-COUNTER                                 12620006
126200         FROM 1 BY 1                                              12630006
126300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 12640006
126400                 OR SQLCODE = 0                                   12650006
126500                 OR SQLCODE = +100)                               12660006
126600                                                                  12670006
126700         EXEC SQL                                                 12680006
126800             SELECT MDSEAR_DKEY                                   12690006
126900                   ,BYR_NBR                                       12700006
127000                   ,MDSEAR_DESC                                   12710006
127100             INTO   :MDSEAR-DKEY                                  12720006
127200                   ,:MDSEAR-BYR-NBR                               12730006
127300                   ,:MDSEAR-DESC                                  12740006
127400             FROM   TMDSEAR                                       12750006
127500             WHERE  DEPT_NBR       = :PURCHS-DEPT-NBR             12760006
127600             AND    MDSELV_CDE     = 'DPT'                        12770006
127700             AND    CURRENT DATE BETWEEN STRT_DTE AND END_DTE     12780006
127800         END-EXEC                                                 12790006
127900                                                                  12800006
128000         EVALUATE TRUE                                            12810006
128100             WHEN SQLCODE = +0                                    12820006
128200                  MOVE MDSEAR-DESC TO ASC-DEPT-DESC               12830006
128300                                                                  12840006
128400             WHEN SQLCODE = +100                                  12850006
128500                  SET PS-DONE PS-DPT-NOT-FOUND TO TRUE            12860006
128600                  MOVE SPACES TO ASC-DEPT-DESC                    12870006
128700             WHEN SQLCODE = -904                                  12880006
128800             WHEN SQLCODE = -911                                  12890006
128900             WHEN SQLCODE = -913                                  12900006
129000                  CONTINUE                                        12910006
129100                                                                  12920006
129200             WHEN OTHER                                           12930006
129300                  SET  PS-DONE TO TRUE                            12940006
129400                  MOVE '3080-SELECT-DPT-BYR'                      12950006
129500                                  TO DP013-PARAGRAPH              12960006
129600                  MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR  '         12970006
129700                                  TO DP013-MESSAGE-TEXT (1)       12980006
129800                  MOVE SQLCA      TO DP013-SQLCA                  12990006
129900                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     13000006
130000                  SET DP013-DB2-ABEND                             13010006
130100                      DP013-XCTL-DISPLAY-RESTART                  13020006
130200                                  TO TRUE                         13030006
130300                  PERFORM DP013-0000-PROCESS-ABEND                13040006
130400         END-EVALUATE                                             13050006
130500     END-PERFORM.                                                 13060006
130600                                                                  13070006
130700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     13080006
130800         SQLCODE NOT = +0                                         13090006
130900         SET  PS-DONE TO TRUE                                     13100006
131000         MOVE '3080-SELECT-DPT-BYR'                               13110006
131100                         TO DP013-PARAGRAPH                       13120006
131200         MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR  '                  13130006
131300                         TO DP013-MESSAGE-TEXT (1)                13140006
131400         MOVE SQLCA      TO DP013-SQLCA                           13150006
131500         MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)              13160006
131600         SET DP013-DB2-ABEND                                      13170006
131700             DP013-XCTL-DISPLAY-RESTART                           13180006
131800                         TO TRUE                                  13190006
131900         PERFORM DP013-0000-PROCESS-ABEND                         13200006
132000     END-IF.                                                      13210006
132100                                                                  13220006
132200*                                                                 13230006
132300****   SELECT THE TRSPBAR INFORMATION   *****                     13240006
132400*                                                                 13250006
132500     IF PS-DPT-NOT-FOUND                                          13260006
132600        CONTINUE                                                  13270006
132700     ELSE                                                         13280006
132800        PERFORM WITH TEST AFTER                                   13290006
132900            VARYING PV-RETRY-COUNTER                              13300006
133000            FROM 1 BY 1                                           13310006
133100            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              13320006
133200                    OR SQLCODE = 0                                13330006
133300                    OR SQLCODE = +100)                            13340006
133400                                                                  13350006
133500            EXEC SQL                                              13360006
133600                SELECT WORKER_NBR                                 13370006
133700                      ,WORKER_FIR_NAME                            13380006
133800                      ,WORKER_LAST_NAME                           13390006
133900                INTO   :RSPBAR-WORKER-NBR                         13400006
134000                      ,:RSPBAR-WORKER-FIR-NAME                    13410006
134100                      ,:RSPBAR-WORKER-LAST-NAME                   13420006
134200                FROM   TRSPBAR                                    13430006
134300                WHERE  MDSEAR_DKEY    = :MDSEAR-DKEY              13440006
134400                AND    RSPLVL_CDE    = 'BYR'                      13450006
134500                AND    CURRENT DATE BETWEEN WORKER_STRT_DTE AND   13460006
134600                                            WORKER_END_DTE        13470006
134700            END-EXEC                                              13480006
134800                                                                  13490006
134900            EVALUATE TRUE                                         13500006
135000                WHEN SQLCODE = +0                                 13510006
135100                  MOVE RSPBAR-WORKER-FIR-NAME TO PV-W-FIRST-NAME  13520006
135200                  MOVE RSPBAR-WORKER-LAST-NAME TO PV-W-LAST-NAME  13530006
135300                  MOVE PV-W-FIRST-NAME TO PV-WORKER-FIRST         13540006
135400                  MOVE PV-W-LAST-NAME  TO PV-WORKER-LAST          13550006
135500                  MOVE PV-WORKER-NAME  TO ASC-BUYER-NME           13560006
135600                                                                  13570006
135700                WHEN SQLCODE = +100                               13580006
135800                     SET PS-DONE  TO TRUE                         13590006
135900                WHEN SQLCODE = -904                               13600006
136000                WHEN SQLCODE = -911                               13610006
136100                WHEN SQLCODE = -913                               13620006
136200                     CONTINUE                                     13630006
136300                                                                  13640006
136400                WHEN OTHER                                        13650006
136500                     SET  PS-DONE TO TRUE                         13660006
136600                     MOVE '3080-SELECT-DPT-BYR'                   13670006
136700                                     TO DP013-PARAGRAPH           13680006
136800                     MOVE 'UNSUCCESSFUL SELECT ON TRSPBAR  '      13690006
136900                                     TO DP013-MESSAGE-TEXT (1)    13700006
137000                     MOVE SQLCA      TO DP013-SQLCA               13710006
137100                     MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)  13720006
137200                     SET DP013-DB2-ABEND                          13730006
137300                         DP013-XCTL-DISPLAY-RESTART               13740006
137400                                     TO TRUE                      13750006
137500                     PERFORM DP013-0000-PROCESS-ABEND             13760006
137600            END-EVALUATE                                          13770006
137700        END-PERFORM                                               13780006
137800     END-IF.                                                      13790006
137900                                                                  13800006
138000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     13810006
138100         SQLCODE NOT = +0                                         13820006
138200         SET  PS-DONE TO TRUE                                     13830006
138300         MOVE '3080-SELECT-DPT-BYR'                               13840006
138400                         TO DP013-PARAGRAPH                       13850006
138500         MOVE 'UNSUCCESSFUL SELECT ON TRSPBAR  '                  13860006
138600                         TO DP013-MESSAGE-TEXT (1)                13870006
138700         MOVE SQLCA      TO DP013-SQLCA                           13880006
138800         MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)              13890006
138900         SET DP013-DB2-ABEND                                      13900006
139000             DP013-XCTL-DISPLAY-RESTART                           13910006
139100                         TO TRUE                                  13920006
139200         PERFORM DP013-0000-PROCESS-ABEND                         13930006
139300     END-IF.                                                      13940006
139400                                                                  13950006
139500                                                                  13960006
139600 3090-DETERMINE-NO-DISTRO.                                        13970006
139700******************************************************************13980006
139800*    THIS PARAGRAPH DETERMINES IF THE 'NO DISTRO' SHOULD BE       13990006
139900*    DISPLAYED FOR THE PO.                                        14000006
140000******************************************************************14010006
140100                                                                  14020006
140200                                                                  14030006
140300     PERFORM 3100-OPEN-PO-CSR.                                    14040006
140400     PERFORM 3110-FETCH-PO-CSR.                                   14050006
140500     SET PS-NOT-DONE TO TRUE.                                     14060006
140600     MOVE ASC-KEY-OPER-UNT-ID TO PC-OPER-UNT-ID.                  14070006
140700     PERFORM 3120-PROCESS-PO-CSR UNTIL PS-DONE.                   14080006
140800                                                                  14090006
140900     IF PS-DISPLAY-DISTRO-MSG                                     14100006
141000        MOVE 'NO DISTRO'      TO ASC-NO-DISTRO-MSG                14110006
141100     ELSE                                                         14120006
141200        MOVE SPACES           TO ASC-NO-DISTRO-MSG                14130006
141300     END-IF.                                                      14140006
141400                                                                  14150006
141500 3100-OPEN-PO-CSR.                                                14160006
141600                                                                  14170006
141700     PERFORM                                                      14180006
141800         WITH TEST AFTER                                          14190006
141900         VARYING PV-RETRY-COUNTER                                 14200006
142000         FROM 1 BY 1                                              14210006
142100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14220006
142200            OR (SQLCODE = +0))                                    14230006
142300                                                                  14240006
142400         EXEC SQL                                                 14250006
142500              OPEN PO_CSR                                         14260006
142600         END-EXEC                                                 14270006
142700                                                                  14280006
142800         EVALUATE TRUE                                            14290006
142900             WHEN SQLCODE = +0                                    14300006
143000                  CONTINUE                                        14310006
143100             WHEN SQLCODE = -904                                  14320006
143200             WHEN SQLCODE = -913                                  14330006
143300                  CONTINUE                                        14340006
143400             WHEN SQLWARN0 NOT = SPACE                            14350006
143500             WHEN SQLCODE  NOT = +0                               14360006
143600                  MOVE '3100-OPEN-PO-CSR'                         14370006
143700                                   TO DP013-PARAGRAPH             14380006
143800                  MOVE 'OPEN PO CURSOR'                           14390006
143900                                   TO DP013-MESSAGE-TEXT (1)      14400006
144000                  MOVE SQLCA       TO DP013-SQLCA                 14410006
144100                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    14420006
144200                  SET DP013-DB2-ABEND                             14430006
144300                                   TO TRUE                        14440006
144400                  PERFORM DP013-0000-PROCESS-ABEND                14450006
144500         END-EVALUATE                                             14460006
144600     END-PERFORM.                                                 14470006
144700                                                                  14480006
144800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    14490006
144900         SQLCODE NOT = +0                                         14500006
145000         MOVE '3100-OPEN-PO-CSR' TO DP013-PARAGRAPH               14510006
145100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN PO CURSOR'           14520006
145200                                   TO DP013-MESSAGE-TEXT (1)      14530006
145300         MOVE SQLCA                TO DP013-SQLCA                 14540006
145400         SET DP013-DB2-ABEND       TO TRUE                        14550006
145500         PERFORM DP013-0000-PROCESS-ABEND                         14560006
145600     END-IF.                                                      14570006
145700                                                                  14580006
145800 3110-FETCH-PO-CSR.                                               14590006
145900                                                                  14600006
146000     EXEC SQL                                                     14610006
146100          FETCH PO_CSR                                            14620006
146200          INTO :PURITM-PO-LNE-NBR                                 14630006
146300     END-EXEC                                                     14640006
146400                                                                  14650006
146500     EVALUATE TRUE                                                14660006
146600         WHEN SQLCODE = +0                                        14670006
146700              CONTINUE                                            14680006
146800                                                                  14690006
146900         WHEN SQLCODE = +100                                      14700006
147000              SET PS-DONE TO TRUE                                 14710006
147100                                                                  14720006
147200         WHEN SQLWARN0 NOT = SPACE                                14730006
147300         WHEN SQLCODE < +0                                        14740006
147400         WHEN SQLCODE > +0                                        14750006
147500              MOVE '3110-FETCH-PO-CSR'                            14760006
147600                                   TO DP013-PARAGRAPH             14770006
147700              MOVE 'FETCH PO CURSOR'                              14780006
147800                                   TO DP013-MESSAGE-TEXT (1)      14790006
147900              MOVE SQLCA           TO DP013-SQLCA                 14800006
148000              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    14810006
148100              SET DP013-DB2-ABEND  TO TRUE                        14820006
148200              PERFORM DP013-0000-PROCESS-ABEND                    14830006
148300     END-EVALUATE.                                                14840006
148400                                                                  14850006
148500                                                                  14860006
148600 3120-PROCESS-PO-CSR.                                             14870006
148700                                                                  14880006
148800     PERFORM                                                      14890006
148900         WITH TEST AFTER                                          14900006
149000         VARYING PV-RETRY-COUNTER                                 14910006
149100         FROM 1 BY 1                                              14920006
149200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14930006
149300            OR  (SQLCODE = +100)                                  14940006
149400            OR  (SQLCODE = +0))                                   14950006
149500                                                                  14960006
149600         EXEC SQL                                                 14970006
149700            SELECT  PLAN_NBR                                      14980006
149800            INTO   :ALLPLN-PLAN-NBR                               14990006
149900            FROM    TALLPLN                                       15000006
150000            WHERE   PO_NBR     = :DK-PO-NBR                       15010006
150100            AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR               15020006
150200            AND     DEST_NBR   = :PC-OPER-UNT-ID                  15030006
150300            AND     STATUS_CDE = :PC-PO-ACTIVE                    15040006
150400         END-EXEC                                                 15050006
150500                                                                  15060006
150600         EVALUATE TRUE                                            15070006
150700             WHEN SQLCODE = -904                                  15080006
150800             WHEN SQLCODE = -913                                  15090006
150900                  CONTINUE                                        15100006
151000                                                                  15110006
151100             WHEN SQLCODE = +0                                    15120006
151200                  SET PS-DISTRO         TO TRUE                   15130006
151300                                                                  15140006
151400             WHEN SQLCODE = +100                                  15150006
151500                  SET PS-NO-DISTRO      TO TRUE                   15160006
151600                                                                  15170006
151700             WHEN SQLWARN0 NOT = SPACE                            15180006
151800             WHEN SQLCODE < +0                                    15190006
151900             WHEN SQLCODE > +0                                    15200006
152000                  MOVE '3120-PROCESS-PO-CSR '                     15210006
152100                                   TO DP013-PARAGRAPH             15220006
152200                  MOVE 'SELECT ON TALLPLN'                        15230006
152300                                   TO DP013-MESSAGE-TEXT (1)      15240006
152400                  MOVE SQLCA       TO DP013-SQLCA                 15250006
152500                  MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)    15260006
152600                  SET DP013-DB2-ABEND                             15270006
152700                      DP013-XCTL-DISPLAY-RESTART                  15280006
152800                                   TO TRUE                        15290006
152900                  PERFORM DP013-0000-PROCESS-ABEND                15300006
153000         END-EVALUATE                                             15310006
153100     END-PERFORM.                                                 15320006
153200                                                                  15330006
153300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15340006
153400         SQLCODE NOT = +0                                         15350006
153500         MOVE '3120-PROCESS-PO-CSR '                              15360006
153600                                   TO DP013-PARAGRAPH             15370006
153700         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   15380006
153800                                   TO DP013-MESSAGE-TEXT (1)      15390006
153900         MOVE 'ON TABLE TALLPLN '  TO DP013-MESSAGE-TEXT (2)      15400006
154000         MOVE SQLCA                TO DP013-SQLCA                 15410006
154100         SET DP013-DB2-ABEND                                      15420006
154200             DP013-XCTL-DISPLAY-RESTART                           15430006
154300                                   TO TRUE                        15440006
154400         PERFORM DP013-0000-PROCESS-ABEND                         15450006
154500     END-IF.                                                      15460006
154600                                                                  15470006
154700                                                                  15480006
154800     IF PS-DISTRO                                                 15490006
154900        PERFORM                                                   15500006
155000            WITH TEST AFTER                                       15510006
155100            VARYING PV-RETRY-COUNTER                              15520006
155200            FROM 1 BY 1                                           15530006
155300            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            15540006
155400               OR  (SQLCODE = +100)                               15550006
155500               OR  (SQLCODE = -811)                               15560006
155600               OR  (SQLCODE = +0))                                15570006
155700                                                                  15580006
155800            EXEC SQL                                              15590006
155900               SELECT  PO_NBR                                     15600006
156000               INTO   :MESTDS-PO-NBR                              15610006
156100               FROM    TMESTDS                                    15620006
156200               WHERE   PO_NBR     = :DK-PO-NBR                    15630006
156300               AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR            15640006
156400               AND     PLAN_NBR   = :ALLPLN-PLAN-NBR              15650006
156500            END-EXEC                                              15660006
156600                                                                  15670006
156700            EVALUATE TRUE                                         15680006
156800                WHEN SQLCODE = -904                               15690006
156900                WHEN SQLCODE = -913                               15700006
157000                     CONTINUE                                     15710006
157100                                                                  15720006
157200                WHEN SQLCODE = +0                                 15730006
157300                WHEN SQLCODE = -811                               15740006
157400                     SET PS-DISTRO         TO TRUE                15750006
157500                                                                  15760006
157600                WHEN SQLCODE = +100                               15770006
157700                     SET PS-NO-DISTRO      TO TRUE                15780006
157800                                                                  15790006
157900                WHEN SQLWARN0 NOT = SPACE                         15800006
158000                WHEN SQLCODE < +0                                 15810006
158100                WHEN SQLCODE > +0                                 15820006
158200                     MOVE '3120-PROCESS-PO-CSR '                  15830006
158300                                      TO DP013-PARAGRAPH          15840006
158400                     MOVE 'SELECT ON TMESTDS'                     15850006
158500                                      TO DP013-MESSAGE-TEXT (1)   15860006
158600                     MOVE SQLCA       TO DP013-SQLCA              15870006
158700                     MOVE 'TMESTDS'   TO DP013-DB2-TABLE-NAME (1) 15880006
158800                     SET DP013-DB2-ABEND                          15890006
158900                         DP013-XCTL-DISPLAY-RESTART               15900006
159000                                      TO TRUE                     15910006
159100                     PERFORM DP013-0000-PROCESS-ABEND             15920006
159200            END-EVALUATE                                          15930006
159300        END-PERFORM                                               15940006
159400                                                                  15950006
159500        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                 15960006
159600            SQLCODE NOT = +0                                      15970006
159700            MOVE '3120-PROCESS-PO-CSR '                           15980006
159800                                      TO DP013-PARAGRAPH          15990006
159900            MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                16000006
160000                                      TO DP013-MESSAGE-TEXT (1)   16010006
160100            MOVE 'ON TABLE TMESTDS '  TO DP013-MESSAGE-TEXT (2)   16020006
160200            MOVE SQLCA                TO DP013-SQLCA              16030006
160300            SET DP013-DB2-ABEND                                   16040006
160400                DP013-XCTL-DISPLAY-RESTART                        16050006
160500                                      TO TRUE                     16060006
160600            PERFORM DP013-0000-PROCESS-ABEND                      16070006
160700        END-IF                                                    16080006
160800     END-IF.                                                      16090006
160900                                                                  16100006
161000     IF PS-NO-DISTRO                                              16110006
161100        SET PS-DISPLAY-DISTRO-MSG TO TRUE                         16120006
161200        SET PS-DONE TO TRUE                                       16130006
161300     ELSE                                                         16140006
161400        PERFORM 3110-FETCH-PO-CSR                                 16150006
161500     END-IF.                                                      16160006
161600                                                                  16170006
161700                                                                  16180006
161800 3200-RESET-ATTRIBUTES.                                           16190006
161900     MOVE DP015-UNP-ALP-NOR-OFF    TO APONBRA                     16200006
162000                                      APCKSLPA                    16210006
162100                                      AEXPCNTA.                   16220006
162200     MOVE DP015-GREEN              TO APONBRC                     16230006
162300                                      APCKSLPC                    16240006
162400                                      AEXPCNTC.                   16250006
162500     MOVE DP015-UNDERLINE          TO APONBRH                     16260006
162600                                      APCKSLPH                    16270006
162700                                      AEXPCNTH.                   16280006
162800*                                                                 16290006
162900*                                                                 16300006
163000*----------------------------------------------------------------*16310006
163100* GET THE NEXT AVAILABLE MESSAGE NUMBER, MOVE IT TO THE SCREEN   *16320006
163200* AND POSITION THE CURSOR FOR THE INITIAL PANEL.                 *16330006
163300*----------------------------------------------------------------*16340006
163400                                                                  16350006
163500 4000-BUILD-INITIAL-PANEL.                                        16360006
163600                                                                  16370006
163700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16380006
163800     MOVE -1                       TO APONBRL.                    16390006
163900                                                                  16400006
164000                                                                  16410006
164100 EJECT                                                            16420006
164200*----------------------------------------------------------------*16430006
164300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *16440006
164400*----------------------------------------------------------------*16450006
164500                                                                  16460006
164600 4400-MOVE-COMMAREA-TO-SCREEN.                                    16470006
164700     MOVE ASC-KEY-OPER-UNT-ID      TO AOPERIDO.                   16480006
164800     MOVE ASC-KEY-FCLTY-ID         TO AFCLTYO.                    16490006
164900     MOVE ASC-KEY-FB               TO AFBILLO.                    16500006
165000     MOVE ASC-KEY-BOL              TO ABOLO.                      16510006
165100                                                                  16520006
165200 EJECT                                                            16530006
165300*----------------------------------------------------------------*16540006
165400* CREATE THE SHORT MESSAGE OBJECT ON THE TSYMSG TABLE.           *16550006
165500*----------------------------------------------------------------*16560006
165600 5000-ADD-SHPTPO.                                                 16570006
165700     INITIALIZE DCLTSHPTPO.                                       16580006
165800                                                                  16590006
165900     MOVE ASC-KEY-SHIPT-ID         TO SHPTPO-SHIPT-ID             16600006
166000                                      DK-SHIPT-ID.                16610006
166100     MOVE ASC-PO-NUMBER-N          TO SHPTPO-PO-NBR               16620006
166200                                      DK-PO-NBR.                  16630006
166400     MOVE ZERO                     TO SHPTPO-REC-SEQ-NBR.         16650006
166500     MOVE ASC-EXP-CARTON-COUNT-N   TO SHPTPO-EXPTED-CART-CNT.     16660006
166600     MOVE ASC-PACKSLIP-IND         TO SHPTPO-PKSL-IND.            16670006
166700     MOVE ASC-VENDOR-NAME          TO SHPTPO-VEND-NAME.           16680006
166800     MOVE SPACES                   TO SHPTPO-SPLT-XMIT-IND        16690006
166900     PERFORM 5100-INSERT-SHPTPO.                                  16700006
167000     PERFORM 8000-AUDIT-TSHPTPO.                                  16710006
167100*----------------------------------------------------------------*16720006
167200* INSERT A ROW INTO THE TSYMSG TABLE.                            *16730006
167300*----------------------------------------------------------------*16740006
167400 5100-INSERT-SHPTPO.                                              16750006
167500     PERFORM                                                      16760006
167600         WITH TEST AFTER                                          16770006
167700         VARYING PV-RETRY-COUNTER                                 16780006
167800         FROM 1 BY 1                                              16790006
167900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16800006
168000                   OR (SQLCODE = ZERO))                           16810006
168100         EXEC SQL                                                 16820006
168200             INSERT INTO TSHPTPO                                  16830006
168300                (SHIPT_ID                                         16840006
168400                ,PO_NBR                                           16850006
168600                ,REC_SEQ_NBR                                      16870006
168700                ,EXPTED_CART_CNT                                  16880006
168800                ,ACTL_CART_CNT                                    16890006
168900                ,DMG_CART_CNT                                     16900006
169000                ,PKSL_IND                                         16910006
169100                ,VEND_NAME                                        16920006
169200                ,LAST_UPD_PGM_ID                                  16930006
169300                ,CRE_USER_ID                                      16940006
169400                ,CARR_LAST_UPD_DTE                                16950006
169500                ,CARR_LAST_UPD_TIME                               16960006
169600                ,VEND_LAST_UPD_DTE                                16970006
169700                ,VEND_LAST_UPD_TIME                               16980006
169800                ,LAST_UPD_DTE                                     16990006
169900                ,LAST_UPD_TIME                                    17000006
170000                ,LAST_UPD_USER_ID                                 17010006
170100                ,PRIM_SHIPT_IND                                   17020006
170200                ,SPLT_XMIT_IND                                    17030006
170300                ,SPLT_XMIT_DTE                                    17040006
170400                ,SPLT_XMIT_TM )                                   17050006
170500             VALUES                                               17060006
170600                (:SHPTPO-SHIPT-ID                                 17070006
170700                ,:SHPTPO-PO-NBR                                   17080006
170900                ,:SHPTPO-REC-SEQ-NBR                              17100006
171000                ,:SHPTPO-EXPTED-CART-CNT                          17110006
171100                ,:PC-ZERO                                         17120006
171200                ,:PC-ZERO                                         17130006
171300                ,:SHPTPO-PKSL-IND                                 17140006
171400                ,:SHPTPO-VEND-NAME                                17150006
171500                ,:PC-CURRENT-PROGRAM-NAME                         17160006
171600                ,:DP020-USERID                                    17170006
171700                ,:PC-DEFAULT-DATE                                 17180006
171800                ,:PC-DEFAULT-TIME                                 17190006
171900                ,:PC-DEFAULT-DATE                                 17200006
172000                ,:PC-DEFAULT-TIME                                 17210006
172100                ,CURRENT DATE                                     17220006
172200                ,CURRENT TIME                                     17230006
172300                ,:DP020-USERID                                    17240006
172400                ,:PC-Y                                            17250006
172500                ,:SHPTPO-SPLT-XMIT-IND                            17260009
172710                ,:PC-DEFAULT-DATE                                 17270006
172720                ,:PC-DEFAULT-TIME )                               17280006
172800         END-EXEC                                                 17290006
172900                                                                  17300006
173000         EVALUATE TRUE                                            17310006
173100             WHEN SQLCODE = ZERO                                  17320006
173200             WHEN SQLCODE = -904                                  17330006
173300             WHEN SQLCODE = -913                                  17340006
173400                 CONTINUE                                         17350006
173500             WHEN SQLWARN0 NOT = SPACES                           17360006
173600             WHEN SQLCODE < ZERO                                  17370006
173700             WHEN SQLCODE > ZERO                                  17380006
173800                 MOVE '5100-INSERT-SHPTPO'                        17390006
173900                                   TO DP013-PARAGRAPH             17400006
174000                 MOVE 'INSERT A ROW INTO THE SHIPMENT PO TABLE'   17410006
174100                                   TO DP013-MESSAGE-TEXT(1)       17420006
174200                 MOVE SQLCA        TO DP013-SQLCA                 17430006
174300                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    17440006
174400                 SET DP013-DB2-ABEND                              17450006
174500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17460006
174600                 PERFORM DP013-0000-PROCESS-ABEND                 17470006
174700         END-EVALUATE                                             17480006
174800     END-PERFORM.                                                 17490006
174900*                                                                 17500006
175000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    17510006
175100         SQLCODE NOT = +0                                         17520006
175200         MOVE '5100-INSERT-SHPTPO'                                17530006
175300                                   TO DP013-PARAGRAPH             17540006
175400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A NEW17550006
175500-             ' SHPTPO RECORD'     TO DP013-MESSAGE-TEXT (1)      17560006
175600         MOVE SQLCA                TO DP013-SQLCA                 17570006
175700         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    17580006
175800         SET DP013-DB2-ABEND                                      17590006
175900             DP013-XCTL-DISPLAY-RESTART                           17600006
176000                                   TO TRUE                        17610006
176100         PERFORM DP013-0000-PROCESS-ABEND                         17620006
176200     END-IF.                                                      17630006
176300 EJECT                                                            17640006
176400                                                                  17650006
176500/                                                                 17660006
176600***************************************************************** 17670006
176700*     INSERT A COPY OF THE SHPTPO ROW TO THE AUDIT TRAIL TABLE  * 17680006
176800*     AFTER INSERTING OR UPDATING TO THE SHPTPO TABLE.          * 17690006
176900***************************************************************** 17700006
177000                                                                  17710006
177100 8000-AUDIT-TSHPTPO.                                              17720006
177200                                                                  17730006
177300     PERFORM                                                      17740006
177400         WITH TEST AFTER                                          17750006
177500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     17760006
177600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            17770006
177700                (SQLCODE = ZERO)   OR                             17780006
177800                (SQLCODE = +100)                                  17790006
177900                                                                  17800006
178000         EXEC SQL                                                 17810006
178100             SELECT SHIPT_ID,                                     17820006
178200                    PO_NBR,                                       17830006
178400                    REC_SEQ_NBR,                                  17850006
178500                    EXPTED_CART_CNT,                              17860006
178600                    ACTL_CART_CNT,                                17870006
178700                    DMG_CART_CNT,                                 17880006
178800                    PKSL_IND,                                     17890006
178900                    VEND_NAME,                                    17900006
179000                    FRGT_CHG_AMT,                                 17910006
179100                    LAST_UPD_PGM_ID,                              17920006
179200                    CRE_USER_ID,                                  17930006
179300                    CARR_CART_CT,                                 17940006
179400                    CARR_LAST_UPD_DTE,                            17950006
179500                    CARR_LAST_UPD_TIME,                           17960006
179600                    VEND_CART_CT,                                 17970006
179700                    VEND_LAST_UPD_DTE,                            17980006
179800                    VEND_LAST_UPD_TIME,                           17990006
179900                    CRE_TMST,                                     18000006
180000                    LAST_UPD_DTE,                                 18010006
180100                    LAST_UPD_TIME,                                18020006
180200                    LAST_UPD_USER_ID,                             18030006
180300                    PRIM_SHIPT_IND                                18040006
180400                   ,SPLT_XMIT_IND                                 18050006
180500                   ,SPLT_XMIT_DTE                                 18060006
180600                   ,SPLT_XMIT_TM                                  18070006
180700               INTO :SHPTPO-SHIPT-ID,                             18080006
180800                    :SHPTPO-PO-NBR,                               18090006
181000                    :SHPTPO-REC-SEQ-NBR,                          18110006
181100                    :SHPTPO-EXPTED-CART-CNT,                      18120006
181200                    :SHPTPO-ACTL-CART-CNT,                        18130006
181300                    :SHPTPO-DMG-CART-CNT,                         18140006
181400                    :SHPTPO-PKSL-IND,                             18150006
181500                    :SHPTPO-VEND-NAME,                            18160006
181600                    :SHPTPO-FRGT-CHG-AMT,                         18170006
181700                    :SHPTPO-LAST-UPD-PGM-ID,                      18180006
181800                    :SHPTPO-CRE-USER-ID,                          18190006
181900                    :SHPTPO-CARR-CART-CT,                         18200006
182000                    :SHPTPO-CARR-LAST-UPD-DTE,                    18210006
182100                    :SHPTPO-CARR-LAST-UPD-TIME,                   18220006
182200                    :SHPTPO-VEND-CART-CT,                         18230006
182300                    :SHPTPO-VEND-LAST-UPD-DTE,                    18240006
182400                    :SHPTPO-VEND-LAST-UPD-TIME,                   18250006
182500                    :SHPTPO-CRE-TMST,                             18260006
182600                    :SHPTPO-LAST-UPD-DTE,                         18270006
182700                    :SHPTPO-LAST-UPD-TIME,                        18280006
182800                    :SHPTPO-LAST-UPD-USER-ID,                     18290006
182900                    :SHPTPO-PRIM-SHIPT-IND                        18300006
183000                   ,:SHPTPO-SPLT-XMIT-IND                         18310006
183100                   ,:SHPTPO-SPLT-XMIT-DTE                         18320006
183200                   ,:SHPTPO-SPLT-XMIT-TM                          18330006
183300               FROM TSHPTPO                                       18340006
183400              WHERE SHIPT_ID        = :DK-SHIPT-ID                18350006
183500                AND PO_NBR          = :DK-PO-NBR                  18360006
183600         END-EXEC                                                 18370006
183700                                                                  18380006
183800         EVALUATE TRUE                                            18390006
183900             WHEN SQLCODE = ZERO                                  18400006
184000             WHEN SQLCODE = +100                                  18410006
184100             WHEN SQLCODE = -904                                  18420006
184200             WHEN SQLCODE = -913                                  18430006
184300                 CONTINUE                                         18440006
184400                                                                  18450006
184500             WHEN SQLWARN0 NOT = SPACE                            18460006
184600             WHEN SQLCODE  NOT = +0                               18470006
184700                  MOVE '8000-AUDIT-SHPTPO'                        18480006
184800                                   TO DP013-PARAGRAPH             18490006
184900                  MOVE 'SELECT SHPPTPO DATA'                      18500006
185000                                   TO DP013-MESSAGE-TEXT (1)      18510006
185100                  MOVE SQLCA       TO DP013-SQLCA                 18520006
185200                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    18530006
185300                  SET DP013-DB2-ABEND                             18540006
185400                                   TO TRUE                        18550006
185500                  PERFORM DP013-0000-PROCESS-ABEND                18560006
185600         END-EVALUATE                                             18570006
185700                                                                  18580006
185800     END-PERFORM.                                                 18590006
185900                                                                  18600006
186000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    18610006
186100         SQLCODE NOT = +0                                         18620006
186200         MOVE '8000-AUDIT-SHPTPO'  TO DP013-PARAGRAPH             18630006
186300         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TSHPTPO'           18640006
186400                                   TO DP013-MESSAGE-TEXT (1)      18650006
186500         MOVE SQLCA                TO DP013-SQLCA                 18660006
186600         SET DP013-DB2-ABEND       TO TRUE                        18670006
186700         PERFORM DP013-0000-PROCESS-ABEND                         18680006
186800     END-IF.                                                      18690006
186900                                                                  18700006
187000     PERFORM                                                      18710007
187100         WITH TEST AFTER                                          18720006
187200         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     18730006
187300         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            18740006
187400                 SQLCODE = ZERO                                   18750006
187500                                                                  18760006
187600         EXEC SQL                                                 18770006
187700             INSERT INTO TAUSHPO                                  18780006
187800                   (SHIPT_ID,                                     18790006
187900                    PO_NBR,                                       18800006
188100                    REC_SEQ_NBR,                                  18820006
188200                    EXPTED_CART_CNT,                              18830006
188300                    ACTL_CART_CNT,                                18840006
188400                    DMG_CART_CNT,                                 18850006
188500                    PKSL_IND,                                     18860006
188600                    VEND_NAME,                                    18870006
188700                    FRGT_CHG_AMT,                                 18880006
188800                    LAST_UPD_PGM_ID,                              18890006
188900                    CRE_USER_ID,                                  18900006
189000                    CARR_CART_CT,                                 18910006
189100                    CARR_LAST_UPD_DTE,                            18920006
189200                    CARR_LAST_UPD_TIME,                           18930006
189300                    VEND_CART_CT,                                 18940006
189400                    VEND_LAST_UPD_DTE,                            18950006
189500                    VEND_LAST_UPD_TIME,                           18960006
189600                    CRE_TMST,                                     18970006
189700                    LAST_UPD_DTE,                                 18980006
189800                    LAST_UPD_TIME,                                18990006
189900                    LAST_UPD_USER_ID,                             19000006
190000                    PRIM_SHIPT_IND                                19010006
190100                   ,SPLT_XMIT_IND                                 19020006
190200                   ,SPLT_XMIT_DTE                                 19030006
190300                   ,SPLT_XMIT_TM                                  19040006
190310                   ,TRN_CDE )                                     19050007
190400             VALUES                                               19060006
190500                  (:SHPTPO-SHIPT-ID,                              19070006
190600                   :SHPTPO-PO-NBR,                                19080006
190800                   :SHPTPO-REC-SEQ-NBR,                           19100006
190900                   :SHPTPO-EXPTED-CART-CNT,                       19110006
191000                   :SHPTPO-ACTL-CART-CNT,                         19120006
191100                   :SHPTPO-DMG-CART-CNT,                          19130006
191200                   :SHPTPO-PKSL-IND,                              19140006
191300                   :SHPTPO-VEND-NAME,                             19150006
191400                   :SHPTPO-FRGT-CHG-AMT,                          19160006
191500                   :SHPTPO-LAST-UPD-PGM-ID,                       19170006
191600                   :SHPTPO-CRE-USER-ID,                           19180006
191700                   :SHPTPO-CARR-CART-CT,                          19190006
191800                   :SHPTPO-CARR-LAST-UPD-DTE,                     19200006
191900                   :SHPTPO-CARR-LAST-UPD-TIME,                    19210006
192000                   :SHPTPO-VEND-CART-CT,                          19220006
192100                   :SHPTPO-VEND-LAST-UPD-DTE,                     19230006
192200                   :SHPTPO-VEND-LAST-UPD-TIME,                    19240006
192300                   :SHPTPO-CRE-TMST,                              19250006
192400                   :SHPTPO-LAST-UPD-DTE,                          19260006
192500                   :SHPTPO-LAST-UPD-TIME,                         19270006
192600                   :SHPTPO-LAST-UPD-USER-ID,                      19280006
192700                   :SHPTPO-PRIM-SHIPT-IND                         19290009
192800                  ,:SHPTPO-SPLT-XMIT-IND                          19300006
192900                  ,:SHPTPO-SPLT-XMIT-DTE                          19310006
193000                  ,:SHPTPO-SPLT-XMIT-TM                           19320006
193010                  ,:PC-A )                                        19330006
193100         END-EXEC                                                 19340006
193200                                                                  19350006
193300         EVALUATE TRUE                                            19360006
193400             WHEN SQLCODE = ZERO                                  19370006
193500             WHEN SQLCODE = -904                                  19380006
193600             WHEN SQLCODE = -913                                  19390006
193700                 CONTINUE                                         19400006
193800                                                                  19410006
193900             WHEN SQLWARN0 NOT = SPACE                            19420006
194000             WHEN SQLCODE  NOT = +0                               19430006
194100                  MOVE '8000-AUDIT-SHPTPO'                        19440006
194200                                   TO DP013-PARAGRAPH             19450006
194300                  MOVE 'INSERT TAUSHPO DATA'                      19460006
194400                                   TO DP013-MESSAGE-TEXT (1)      19470006
194500                  MOVE SQLCA       TO DP013-SQLCA                 19480006
194600                  MOVE 'TAUSHPO'   TO DP013-DB2-TABLE-NAME (1)    19490006
194700                  SET DP013-DB2-ABEND                             19500006
194800                                   TO TRUE                        19510006
194900                  PERFORM DP013-0000-PROCESS-ABEND                19520006
195000         END-EVALUATE                                             19530006
195100     END-PERFORM.                                                 19540006
195200                                                                  19550006
195300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    19560006
195400         SQLCODE NOT = +0                                         19570006
195500         MOVE '8000-AUDIT-SHPTPO'  TO DP013-PARAGRAPH             19580006
195600         MOVE 'MAX RETRIES EXCEEDED FOR INSERT TAUSHPO'           19590006
195700                                   TO DP013-MESSAGE-TEXT (1)      19600006
195800         MOVE SQLCA                TO DP013-SQLCA                 19610006
195900         SET DP013-DB2-ABEND       TO TRUE                        19620006
196000         PERFORM DP013-0000-PROCESS-ABEND                         19630006
196100     END-IF.                                                      19640006
196200                                                                  19650006
196300/                                                                 19660006
196400*----------------------------------------------------------------*19670006
196500*    ABEND PROCESSOR MODULE                                      *19680006
196600*----------------------------------------------------------------*19690006
196700                                                                  19700006
196800     COPY DPPD013.                                                19710006
196900                                                                  19720006
197000*----------------------------------------------------------------*19730006
197100*    LINK TO CICS OBJECT LOCKING MODULE                          *19740006
197200*----------------------------------------------------------------*19750006
197300                                                                  19760006
197400     COPY DPPD044.                                                19770006
