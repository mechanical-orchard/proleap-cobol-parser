000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      SAKUP045.                                       00030000
000400 AUTHOR.          BARB SCHULTZ.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    02/21/14.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*  MODULE TYPE:   COBOL2 DB2 BATCH.                               00100000
001100*                                                                 00110000
001200*  DESCRIPTION: PROGRAM UPDATES THE TSASUM TABLE WITH THE DATA    00120000
001300*               PULLED IN PROGRAM SAKUT119                        00130000
001400*                                                                 00140000
001500*========================== CHANGE LOG ===========================00150000
001600*  AUTH        BY           DATE    DESCRIPTION                   00160004
001700*=================================================================00170000
001800* 8446E       TKMA555     02-21-14  CREATE PROGRAM                00180004
001900*                                                                 00190000
260107* CHG0260107  JIM HUNTER  08-19-21  ADD COPYBOOK DPWS991 TO MAKE  00191004
260107*                                   THE CALL TO DPKUT901 DYNAMIC. 00192004
002000******************************************************************00200000
002100                                                                  00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300 CONFIGURATION SECTION.                                           00230000
002400                                                                  00240000
002500 SOURCE-COMPUTER.    IBM-3090.                                    00250000
002600 OBJECT-COMPUTER.    IBM-3090.                                    00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100 DATA DIVISION.                                                   00310000
003200 FILE SECTION.                                                    00320000
003300                                                                  00330000
003400                                                                  00340000
003500***************************************************************** 00350000
003600*                       WORKING STORAGE                           00360000
003700***************************************************************** 00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900                                                                  00390000
004000 01  W-START                          PIC  X(40)                  00400000
004100     VALUE 'SAKUP045 - WORKING STORAGE BEGINS HERE'.              00410000
004200                                                                  00420000
004300                                                                  00430000
004400***************************************************************** 00440000
004500*                         SWITCHES                                00450000
004600***************************************************************** 00460000
004700 01  PROGRAM-SWITCHES.                                            00470000
004800     05  PS-RESTART-REQUIRED-SW       PIC  X(01) VALUE 'N'.       00480000
004900         88  PS-RESTART-REQUIRED                 VALUE 'Y'.       00490000
005000         88  PS-RESTART-NOT-REQUIRED             VALUE 'N'.       00500000
005100                                                                  00510000
005200******************************************************************00520000
005300*                       ACCUMULATORS                              00530000
005400******************************************************************00540000
005500 01  PROGRAM-ACCUM.                                               00550000
005600     05  PA-READ                      PIC  9(11) VALUE ZEROS.     00560000
005600     05  PA-CKPT                      PIC  9(11) VALUE ZEROS.     00570000
005700                                                                  00580000
005800******************************************************************00590000
005900*                           CONSTANTS                             00600000
006000******************************************************************00610000
006100 01  PROGRAM-CONSTANTS.                                           00620000
006200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00630000
006300                                                 COMP SYNC.       00640000
006400     05  PC-MAX-DEADLOCKS             PIC S9(04) VALUE +3         00650000
006500                                                 COMP SYNC.       00660000
006600                                                                  00670000
006700     05  PC-CKPT-JOB-NAME             PIC  X(08) VALUE 'SAK059  '.00680001
006800     05  PC-CKPT-PLAN-NAME            PIC  X(08) VALUE 'SAKUP045'.00690000
006900     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'SAKUP045'.00700000
007000                                                                  00710000
007100     05  PC-TRAN-PRES-FUNC-CODES.                                 00720000
007200         10  PC-TRAN-PRES-FUNC-OPEN   PIC  X(05) VALUE 'OPEN '.   00730000
007300         10  PC-TRAN-PRES-FUNC-TRANS  PIC  X(05) VALUE 'TRANS'.   00740000
007400         10  PC-TRAN-PRES-FUNC-RSTRT  PIC  X(05) VALUE 'RSTRT'.   00750000
007500         10  PC-TRAN-PRES-FUNC-CLOSE  PIC  X(05) VALUE 'CLOSE'.   00760000
007600                                                                  00770000
007700     05  PC-MINUS-ONE                 PIC S9(01) VALUE -1.        00780000
007800     05  PC-SYSTEM                    PIC  X(08) VALUE 'SYSTEM  '.00790000
007900                                                                  00800000
008000******************************************************************00810000
008100*                          VARIABLES                              00820000
008200******************************************************************00830000
008300 01  PROGRAM-VARIABLES.                                           00840000
008400     05  PV-SQL-SUB                   PIC  9(03) VALUE ZERO.      00850000
008500     05  PV-DEADLOCK-COUNTER          PIC  9(03) VALUE ZERO.      00860000
008600     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00870000
008700     05  PV-DB2-OPER-ATTEMPTED        PIC  X(30) VALUE SPACE.     00880000
008800     05  PV-OPERATION-MSG             PIC  X(35) VALUE SPACE.     00890000
008900     05  PV-RET-CODE                  PIC  9(04) VALUE ZEROS.     00900000
009000                                                                  00910000
009100******************************************************************00920000
009200*               SYSTEM TIME AND DATE VARIABLES                    00930000
009300******************************************************************00940000
009400 01  SYS-DATE-TIME.                                               00950000
009500     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    00960000
009600     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    00970000
009700                                                                  00980000
009800 01  ST-BEG-TIME.                                                 00990000
009900     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01000000
010000     05  FILLER                       PIC  X(01) VALUE ':'.       01010000
010100     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01020000
010200                                                                  01030000
010300 01  ST-END-TIME.                                                 01040000
010400     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01050000
010500     05  FILLER                       PIC  X(01) VALUE ':'.       01060000
010600     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01070000
010700                                                                  01080000
010800 01  SD-EDIT-DATE.                                                01090000
010900     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01100000
011000     05  FILLER                       PIC  X(01) VALUE '-'.       01110000
011100     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01120000
011200     05  FILLER                       PIC  X(01) VALUE '-'.       01130000
011300     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01140000
011400     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01150000
011500                                                                  01160000
011600******************************************************************01170000
011700*                        ERROR HANDLING                           01180000
011800******************************************************************01190000
011900 01  ABEND-CODE                       PIC S9(04) VALUE ZEROS      01200000
012000                                                 COMP SYNC.       01210000
012100     88  ABEND-4002-READ-ERROR                   VALUE +4002.     01220000
012200     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     01230000
012300     88  ABEND-4019-CAL-SUB-ERROR                VALUE +4019.     01240000
012400                                                                  01250000
012500                                                                  01260000
012600******************************************************************01270000
012700*  TSASUM - TOTALS BY STORE REGISTER                              01280000
012800******************************************************************01290000
012900     COPY SARD008.                                                01300000
013000                                                                  01310000
013100******************************************************************01320000
013200*  DB2 FORMATTED ERROR MESSAGE                                    01330000
013300******************************************************************01340000
013400     COPY DPWS004.                                                01350000
013500                                                                  01360000
013600******************************************************************01370000
013700*  SQL COMMUNICATIONS WORK AREA                                   01380000
013800******************************************************************01390000
013900     COPY SQLCA2.                                                 01400000
014000                                                                  01410000
014100******************************************************************01420000
014200*  COMMUNICATIONS AREA FOR DB2                                    01430000
014300******************************************************************01440000
014400     EXEC SQL                                                     01450000
014500         INCLUDE SQLCA                                            01460000
014600     END-EXEC.                                                    01470000
014700                                                                  01480000
014800******************************************************************01490000
014900*  DB2 TABLE TSASUM - STORE TOTALS TABLE                          01500000
015000******************************************************************01510000
015100     EXEC SQL                                                     01520000
015200          INCLUDE TSASUM                                          01530000
015300     END-EXEC.                                                    01540000
015400                                                                  01550006
015500******************************************************************01560000
015600*  TRANSACTION PREPARATION MODULE COMMUNICATIONS AREA             01570000
015700******************************************************************01580000
260107     COPY DPWS991.                                                01590004
015800                                                                  01591004
015800     COPY DPLS001.                                                01592004
015900     05  WORK-STORAGE-PASSED.                                     01600000
016000******************************************************************01610000
016100*PA - PROGRAM ACCUMULATORS                                        01620000
016200******************************************************************01630000
016300         10  PROGRAM-ACCUMULATORS.                                01640000
016400             15  PA-ROWS-INSERTED PIC S9(11)           VALUE ZERO 01650000
016500                                                       COMP-3.    01660000
016600             15  PA-DUPL-ROWS     PIC S9(11)           VALUE ZERO 01690000
016700                                                       COMP-3.    01700000
016800                                                                  01710000
016900 01  FILLER                          PIC X(4096)  VALUE SPACE.    01720000
017000                                                                  01730000
017100                                                                  01740000
017200                                                                  01750000
017300 PROCEDURE DIVISION.                                              01760000
017400******************************************************************01770000
017500* MAINLINE-PROCESSING                                             01780000
017600******************************************************************01790000
017700                                                                  01800000
017800     PERFORM A100-INITIALIZE.                                     01810000
017900                                                                  01820000
018000     PERFORM B100-PROCESS-UPDATE-RECORDS                          01830000
018100       UNTIL DP001-PREP-TRANS-EOF.                                01840000
018200                                                                  01850000
018300     PERFORM Z990-EOJ-ROUTINE.                                    01860000
018400                                                                  01870000
018500     GOBACK.                                                      01880000
018600                                                                  01890000
018700                                                                  01900000
018800******************************************************************01910000
018900* PREFORMS TASK INITIATION                                        01920000
019000******************************************************************01930000
019100 A100-INITIALIZE.                                                 01940000
019200                                                                  01950000
019300     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 01960000
019400                                                                  01970000
019500     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            01980000
019600     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            01990000
019700                                                                  02000000
019800     MOVE SYS-DATE (1:2) TO SD-CENT.                              02010000
019900     MOVE SYS-DATE (3:2) TO SD-YEAR.                              02020000
020000     MOVE SYS-DATE (5:2) TO SD-MONTH.                             02030000
020100     MOVE SYS-DATE (7:2) TO SD-DAY.                               02040000
020200                                                                  02050000
020300     MOVE PC-TRAN-PRES-FUNC-OPEN TO DP001-FUNC-CODE.              02060000
020400                                                                  02070000
020500     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      02080000
020600                                                                  02090000
020700                                                                  02100000
020800******************************************************************02110000
020900* PROCESS UPDATE RECORDS                                          02120000
021000******************************************************************02130000
021100 B100-PROCESS-UPDATE-RECORDS.                                     02140000
021200                                                                  02150000
021300     SET PS-RESTART-NOT-REQUIRED TO TRUE.                         02160000
021400                                                                  02170000
021500     PERFORM C100-MOVE-FIELDS.                                    02180003
021600                                                                  02190000
021700*----------------------------------------------------------------*02200000
021800*  IF A RESTART IS REQUIRED, ISSUE A RESTART CALL RATHER THAN A  *02210000
021900*  TRANS CALL.  THIS WILL ALLOW PROCESSING TO RESUME WITH THE    *02220000
022000*  FIRST TRANSACTION AFTER THE LAST COMMIT.                      *02230000
022100*----------------------------------------------------------------*02240000
022200     IF  PS-RESTART-REQUIRED                                      02250000
022300         MOVE PC-TRAN-PRES-FUNC-RSTRT TO DP001-FUNC-CODE          02260000
022400     ELSE                                                         02270000
022500         MOVE PC-TRAN-PRES-FUNC-TRANS TO DP001-FUNC-CODE          02280000
022600     END-IF.                                                      02290000
022700                                                                  02300000
022800     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      02310000
022900                                                                  02320000
023000     ADD 1 TO PA-READ.                                            02330000
023100                                                                  02340000
023100                                                                  02350000
023300******************************************************************02360000
023400* MOVES THE FIELDS FROM THE EXTRACT RECORD TO THE TSASUM DCLGEN   02370003
023500******************************************************************02380000
023600 C100-MOVE-FIELDS.                                                02390003
023700                                                                  02400000
023800     MOVE SA008-PARTN-NBR      TO SASUM-PARTN-NBR.                02410000
023900     MOVE SA008-STR-NBR        TO SASUM-STR-NBR.                  02420000
024000     MOVE SA008-RGST-ID        TO SASUM-RGST-ID.                  02430000
024100     MOVE SA008-SUM-TYP-CDE    TO SASUM-SUM-TYP-CDE.              02440000
024200     MOVE SA008-SUM-CTG-CDE    TO SASUM-SUM-CTG-CDE.              02450000
024300     MOVE SA008-CTG-AMT        TO SASUM-CTG-AMT.                  02460000
024400     MOVE SA008-CTG-NBR-OF-ITM TO SASUM-CTG-NBR-OF-ITM.           02470000
024500     MOVE SA008-CTG-SRC-CDE    TO SASUM-CTG-SRC-CDE.              02480000
024600                                                                  02490000
029300     EVALUATE TRUE                                                02491000
029400        WHEN SA008-TYPE = 'INSRT'                                 02492000
024800             PERFORM C200-TSASUM-INSERT                           02493000
025000                                                                  02494000
034000     END-EVALUATE.                                                02520000
025800                                                                  02530000
025900                                                                  02540000
026000******************************************************************02550000
026100* INSERT INTO THE TSASUM TABLE                                    02560000
026200******************************************************************02570000
026300 C200-TSASUM-INSERT.                                              02580000
026400                                                                  02590000
026500     PERFORM WITH TEST AFTER                                      02600000
026600         VARYING PV-SQL-SUB                                       02610000
026700         FROM 1 BY 1                                              02620000
026800         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       02630000
026900                OR SQLCODE = -911                                 02640000
026900                OR SQLCODE = -803                                 02650000
027000                OR SQLCODE = 0)                                   02660000
027100                                                                  02670000
027200         EXEC SQL                                                 02680000
027300             INSERT  INTO TSASUM                                  02690000
027400                  (  PARTN_NBR                                    02700000
027500                  ,  STR_NBR                                      02710000
027600                  ,  RGST_ID                                      02720000
027700                  ,  SUM_TYP_CDE                                  02730000
027800                  ,  SUM_CTG_CDE                                  02740000
027900                  ,  CTG_AMT                                      02750000
028000                  ,  CTG_NBR_OF_ITM                               02760000
028100                  ,  CTG_SRC_CDE)                                 02770000
028200              VALUES                                              02780000
028300                  (  :SASUM-PARTN-NBR                             02790000
028400                  ,  :SASUM-STR-NBR                               02800000
028500                  ,  :SASUM-RGST-ID                               02810000
028600                  ,  :SASUM-SUM-TYP-CDE                           02820000
028700                  ,  :SASUM-SUM-CTG-CDE                           02830000
028800                  ,  :SASUM-CTG-AMT                               02840000
028900                  ,  :SASUM-CTG-NBR-OF-ITM                        02850000
029000                  ,  :SASUM-CTG-SRC-CDE)                          02860000
029100         END-EXEC                                                 02870000
029200                                                                  02880000
029300         EVALUATE TRUE                                            02890000
029400             WHEN SQLCODE = 0                                     02900000
029500                 ADD +1 TO PA-ROWS-INSERTED                       02910000
029600                                                                  02920000
029700             WHEN SQLCODE = -803                                  02930000
029500                 ADD +1 TO PA-DUPL-ROWS                           02940000
029600                                                                  02950000
029700             WHEN SQLCODE = -911                                  02960000
029800                 ADD +1 TO PV-DEADLOCK-COUNTER                    02970000
029900                                                                  02980000
030000                 DISPLAY '                   '                    02990000
030100                 DISPLAY 'DEADLOCK INCOUNTERED -911'              03000000
030200                 DISPLAY 'DEADLOCK-COUNTER = ' PV-DEADLOCK-COUNTER03010000
030300                                                                  03020000
030400                 IF PV-DEADLOCK-COUNTER > PC-MAX-DEADLOCKS        03030000
030500                     MOVE 'C200-TSASUM-INSERT'                    03040000
030600                                      TO PV-PARAGRAPH-NAME        03050000
030700                     MOVE 'MAXIMUM DEADLOCKS EXCEEDED    '        03060000
030800                                      TO PV-DB2-OPER-ATTEMPTED    03070000
030900                     PERFORM Z200-SQL-ABEND                       03080000
031000                                                                  03090000
031100                 ELSE                                             03100000
031200                     SET PS-RESTART-REQUIRED TO TRUE              03110000
031300                 END-IF                                           03120000
031400                                                                  03130000
031500             WHEN OTHER                                           03140000
031600                 DISPLAY '                   '                    03150000
031700                 DISPLAY 'SQLCODE = ' SQLCODE                     03160000
031800                 DISPLAY 'DP001-FUNC-CODE = ' DP001-FUNC-CODE     03170000
031900                 DISPLAY 'DP001-RET-CODE  = ' DP001-RET-CODE      03180000
032000                 DISPLAY '                   '                    03190000
032100                 DISPLAY 'PA-ROWS-INSERTED= ' PA-ROWS-INSERTED    03200000
032300                 DISPLAY '                   '                    03220000
032400                 DISPLAY 'INSERT ABENDED ON: '                    03230000
032500                 DISPLAY 'PART-NBR = ' SASUM-PARTN-NBR            03240000
032600                 DISPLAY 'STR-NBR  = ' SASUM-STR-NBR              03250000
032700                 DISPLAY 'RGST-ID  = ' SASUM-RGST-ID              03260000
032800                 DISPLAY 'TYP-CDE  = ' SASUM-SUM-TYP-CDE          03270000
032900                 DISPLAY 'CTG-CDE  = ' SASUM-SUM-CTG-CDE          03280000
033000                 DISPLAY 'CTG-AMT  = ' SASUM-CTG-AMT              03290000
033100                 DISPLAY 'CTG-NBR  = ' SASUM-CTG-NBR-OF-ITM       03300000
033200                 DISPLAY 'CTG-SRC  = ' SASUM-CTG-SRC-CDE          03310000
033300                                                                  03320000
033400                 MOVE 'C200-TSASUM-INSERT'                        03330000
033500                                        TO PV-PARAGRAPH-NAME      03340000
033600                 MOVE 'TSASUM INSERT'                             03350000
033700                                        TO PV-DB2-OPER-ATTEMPTED  03360000
033800                                                                  03370000
033900                 PERFORM Z200-SQL-ABEND                           03380000
034000         END-EVALUATE                                             03390000
034100     END-PERFORM.                                                 03400000
034200                                                                  03410000
034300                                                                  03420000
034400     IF PV-SQL-SUB > PC-MAX-RETRIES                               03430000
034500         MOVE 'C200-TSASUM-INSERT'      TO PV-PARAGRAPH-NAME      03440000
034600         MOVE 'VERIFY RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED  03450000
034700         PERFORM Z200-SQL-ABEND                                   03460000
034800     END-IF.                                                      03470000
034900                                                                  03480000
034900                                                                  03490002
052100******************************************************************05200000
052200* BUILD THE COMMUNICATION AREA FOR A CALL TO THE TRANSACTION      05210000
052300* PRESENTATION MODULE                                             05220000
052400******************************************************************05230000
052500 X100-BUILD-COMM-AREA-TRAN-PRES.                                  05240000
052600                                                                  05250000
052700     MOVE LENGTH OF                                               05260000
052800          WORK-STORAGE-PASSED TO DP001-WORK-STRG-LENGTH.          05270000
052900     MOVE PC-CKPT-JOB-NAME    TO DP001-JOB-NAME.                  05280000
053000     MOVE PC-CKPT-PLAN-NAME   TO DP001-PLAN-NAME.                 05290000
053100                                                                  05300000
053200     PERFORM X200-CALL-TRANS-PRES-MODULE.                         05310000
053300                                                                  05320000
053400     MOVE DP001-TRANS-RECORD  TO SA008-TSASUM-REC.                05330000
053500                                                                  05340000
053600     IF  DP001-CKPT-TAKEN                                         05350000
053700         ADD 1 TO PA-CKPT                                         05360000
054200                                                                  05370000
054300         INITIALIZE PV-DEADLOCK-COUNTER                           05380000
054400     END-IF.                                                      05390000
054500                                                                  05400000
054600                                                                  05410000
054700******************************************************************05420000
054800* VERIFY THE RETURN CODE ON THE CALLED MODULE                     05430000
054900******************************************************************05440000
055000 X200-CALL-TRANS-PRES-MODULE.                                     05450000
055100                                                                  05460000
055200     PERFORM Z900-CALL-TRANS-PRES-MODULE.                         05470000
055300                                                                  05480000
055400     IF  DP001-GOOD-RET-CODE                                      05490000
055500     OR  DP001-CKPT-TAKEN                                         05500000
055600     OR  DP001-RESTART                                            05510000
055700         CONTINUE                                                 05520000
055800                                                                  05530000
055900     ELSE                                                         05540000
056000         MOVE 'X200-CALL-TRANS-PRES-MODULE' TO PV-PARAGRAPH-NAME  05550000
056100         MOVE '** BAD CALL TO TRANS PREP MODULE **'               05560000
056200                                            TO PV-OPERATION-MSG   05570000
056300         MOVE DP001-RET-CODE                TO PV-RET-CODE        05580000
056400                                                                  05590000
056500         SET ABEND-4019-CAL-SUB-ERROR TO TRUE                     05600000
056600                                                                  05610000
056700         PERFORM Z100-ABEND                                       05620000
056800     END-IF.                                                      05630000
056900                                                                  05640000
057000                                                                  05650000
057100******************************************************************05660000
057200* NON-DB2 ABEND                                                   05670000
057300******************************************************************05680000
057400 Z100-ABEND.                                                      05690000
057500                                                                  05700000
057600     PERFORM Z999-CONTROLS.                                       05710000
057700                                                                  05720000
057800     DISPLAY '                     '.                             05730000
057900     DISPLAY '** ABEND           **'.                             05740000
058000     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          05750000
058100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05760000
058200     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         05770000
058300     DISPLAY '** RETURN CODE     ** = ' PV-RET-CODE.              05780000
058400                                                                  05790000
058500     CALL 'ILBOABN0' USING ABEND-CODE.                            05800000
058600                                                                  05810000
058700                                                                  05820000
058800******************************************************************05830000
058900* ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING      05840000
059000* CODE OCCURS.                                                    05850000
059100******************************************************************05860000
059200 Z200-SQL-ABEND.                                                  05870000
059300                                                                  05880000
059400     PERFORM Z999-CONTROLS.                                       05890000
059500                                                                  05900000
059600     DISPLAY '** ABEND     **'.                                   05910000
059700     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                05920000
059800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05930000
059900     DISPLAY '** OPERATION ** = ' PV-DB2-OPER-ATTEMPTED.          05940000
060000                                                                  05950000
060100******************************************************************05960000
060200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05970000
060300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05980000
060400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05990000
060500* FORMAT.                                                         06000000
060600******************************************************************06010000
060700     COPY DPPD004.                                                06020000
060800                                                                  06030000
060900     SET ABEND-4013-DB2-ERROR TO TRUE.                            06040000
061000                                                                  06050000
061100     CALL 'ILBOABN0' USING ABEND-CODE.                            06060000
061200                                                                  06070000
061300                                                                  06080000
061400******************************************************************06090000
061500* PREFORMS TASK TERMINATION PROCESSING                            06100000
061600******************************************************************06110000
061700 Z990-EOJ-ROUTINE.                                                06120000
061800                                                                  06130000
061900     MOVE PC-TRAN-PRES-FUNC-CLOSE TO DP001-FUNC-CODE.             06140000
062000                                                                  06150000
062100     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      06160000
062200                                                                  06170000
062300     PERFORM Z999-CONTROLS.                                       06180000
062400                                                                  06190000
062500                                                                  06200000
062600******************************************************************06210000
062700* DISPLAY CONTROLS FROM THE PROGRAM                               06220000
062800******************************************************************06230000
062900 Z999-CONTROLS.                                                   06240000
063000                                                                  06250000
063100     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 06260000
063200                                                                  06270000
063300     MOVE SYS-TIME (1:2) TO ST-END-HR.                            06280000
063400     MOVE SYS-TIME (3:2) TO ST-END-MN.                            06290000
063500                                                                  06300000
063600     DISPLAY '                    '.                              06310000
063700     DISPLAY '**********************'.                            06320000
063800     DISPLAY '   SAKUP045 CONTROLS  '.                            06330000
063900     DISPLAY '**********************'.                            06340000
064000     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         06350000
064100     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          06360000
064200     DISPLAY 'END TIME  = ' ST-END-TIME.                          06370000
064300     DISPLAY '======================'.                            06380000
064400     DISPLAY 'RECORDS READ   = ' PA-READ.                         06390000
064400     DISPLAY 'CHECKPOINTS    = ' PA-CKPT.                         06400000
064500     DISPLAY '                '.                                  06410000
064600     DISPLAY 'ROWS INSERTED  = ' PA-ROWS-INSERTED.                06420000
064800     DISPLAY '                '.                                  06440000
064700     DISPLAY 'DUPLICATE ROWS = ' PA-DUPL-ROWS.                    06450000
064800     DISPLAY '                '.                                  06460000
064900                                                                  06470000
065000                                                                  06480000
065100******************************************************************06490000
065200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06500000
065300* MENTS THAT ARE REQUIRED TO INVOKE THE TRANSACTION PRESENTATION  06510000
065400* MODULE (DPKUT901) OF THE DB2 CHECKPOINT RESTART SYSTEM.         06520000
065500******************************************************************06530000
065600     COPY DPPD001.                                                06540000
065700                                                                  06550000
065800                                                                  06560000
