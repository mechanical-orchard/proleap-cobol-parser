000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.         WSKUP020.                                    00020099
000300 AUTHOR.             RICHARD WOJTCZAK.                            00030099
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040099
000500 DATE-WRITTEN.       MARCH 2007.                                  00050099
000600                                                                  00060099
000700****************************************************************  00070099
000800* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00080099
000900* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00090099
001000* THIS PROGRAM USES MQSERIES.                                     00100099
001100****************************************************************  00110099
001200*               XML DB2 PIX REPOSITORY LOAD                       00120099
001300*               ---------------------------                       00130099
001400*                                                                 00140099
001500* THIS PROGRAM WILL GET MESSAGES FROM THE PIX MQ MESSAGE QUEUE    00150099
001600* (WS.OUTBOUND.WMOS.PIX.TO.REPOSITORY.Q) AND FORMAT/LOAD          00160099
001700* THE INCOMING XML DATA TO THE DB2 TABLE WST_PIX_TRAN_HIST        00170099
001800*                                                                 00180099
001900****************************************************************  00190099
002000 ENVIRONMENT DIVISION.                                            00200099
002100****************************************************************  00210099
002200 CONFIGURATION SECTION.                                           00220099
002300 SOURCE-COMPUTER.        IBM-3090.                                00230099
002400 OBJECT-COMPUTER.        IBM-3090.                                00240099
002500 INPUT-OUTPUT SECTION.                                            00250099
002600                                                                  00260099
002700 FILE-CONTROL.                                                    00270099
002800****************************************************************  00280099
002900 DATA DIVISION.                                                   00290099
003000****************************************************************  00300099
003100 FILE SECTION.                                                    00310099
003200                                                                  00320099
003300 WORKING-STORAGE SECTION.                                         00330099
003400******************************************************************00340099
003500  01  PV-ABEND-CODE                  PIC S9(04) VALUE ZERO        00350099
003600                                                COMP SYNC.        00360099
003700******************************************************************00370099
003800*    PROGRAM CONSTANTS                                            00380099
003900******************************************************************00390099
004000 01  PC-PROGRAM-CONSTANTS.                                        00400099
004100     05  PC-PGM-NAME                 PIC X(08) VALUE 'WSKUP020'.  00410099
004200     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   00420099
004300                                                                  00440099
004400*mjmchg                                                           00450099
004500     05  PC-END-RUN-MSG              PIC  X(18) VALUE             00460099
004600                                    'END RUN OF PROGRAM'.         00470099
004700*mjmend                                                           00480099
004800******************************************************************00490099
004900*    PROGRAM VARIABLES                                            00500099
005000******************************************************************00510099
005100 01  PV-PROGRAM-VARIABLES.                                        00520099
005200     05  PV-CURRENT-TMST          PIC X(26)       VALUE SPACE.    00530099
005300     05  PV-CURRENT-DATE          PIC X(10)       VALUE SPACE.    00540099
005400     05  PV-CURRENT-ELEMENT       PIC X(30)       VALUE SPACES.   00550099
005500     05  PV-CURRENT-ATTRIBUTE     PIC X(30)       VALUE SPACES.   00560099
005600     05  PV-WMOS-DATE-CREATED     PIC X(19).                      00610099
005700     05  PV-RETRY-COUNTER         PIC S9(04) VALUE +0 COMP SYNC.  00620099
005800     05  PV-HOLD-COMPLETION-CODE  PIC S9(9) BINARY.               00630099
005900     05  PV-HOLD-REASON           PIC S9(9) BINARY.               00640099
006000     05  PV-PARAGRAPH             PIC X(30) VALUE SPACE.          00650099
006100     05  PV-TABLE-NAME            PIC X(30) VALUE SPACE.          00660099
006200     05  PV-SQLCODE               PIC -999.                       00670099
006300     05  PV-DISPLAY-NBR           PIC ZZZ,ZZZ,ZZ9.                00670099
006400                                                                  00680099
006500******************************************************************00690099
006600*    PROGRAM ACCUMULATORS                                         00700099
006700******************************************************************00710099
006800 01  PA-PROGRAM-ACCUMULATORS.                                     00720099
006900     05  PA-MQ-PIX-MSGS-READ       PIC  S9(09)  VALUE +0 COMP-3.  00730099
007000     05  PA-MQ-ERROR-MSGS-SENT     PIC  S9(09)  VALUE +0 COMP-3.  00740099
007100     05  PA-ERRORS-PROCESSED       PIC  S9(09)  VALUE +0 COMP-3.  00750099
007200     05  PA-PIX-INS                PIC  S9(09)  VALUE +0 COMP-3.  00760099
007300     05  PA-PIX-DUP                PIC  S9(09)  VALUE +0 COMP-3.  00770099
007400     05  PA-MQ-COMMITS             PIC  S9(09)  VALUE +0 COMP-3.  00780099
007500     05  PA-XML-PARSED             PIC  S9(09)  VALUE +0 COMP-3.  00790099
007600     05  PA-TOTAL-DB2-COMMITS      PIC  S9(09)  VALUE +0 COMP-3.  00790099
007700     05  PA-TOTAL-DB2-ROLLBACKS    PIC  S9(09)  VALUE +0 COMP-3.  00790099
007800******************************************************************00800099
007900*    PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         00810099
008000******************************************************************00820099
008100 01  PV-Q-MANAGER-VARIABLES.                                      00830099
008200     05  PV-QMGR-NAME-PIX             PIC X(48).                  00840099
008300     05  PV-QUE-NAME-PIX              PIC X(48).                  00850099
008400     05  PV-HANDLE-PIX           PIC S9(9) BINARY VALUE 0.        00860099
008500     05  PV-QMGR-NAME-ERROR           PIC X(48).                  00870099
008600     05  PV-QUE-NAME-ERROR            PIC X(48).                  00880099
008700     05  PV-HANDLE-ERROR         PIC S9(9) BINARY VALUE 0.        00890099
008800******************************************************************00900099
008900*    PROGRAM VARIABLES FOR MQ SERIES                              00910099
009000******************************************************************00920099
009100 01  PV-MQ-PROGRAM-VARIABLES.                                     00930099
009200     05  PV-QM-NAME              PIC X(48).                       00940099
009300     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        00950099
009400     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                00960099
009500*    05  PV-HANDLE               PIC S9(9) BINARY VALUE 0.        00970099
009600     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                00980099
009700     05  PV-REASON               PIC S9(9) BINARY.                00990099
009800     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          01000099
009900     05  PV-CON-REASON           PIC S9(9) BINARY.                01010099
010000     05  PV-MSGBUFFER            PIC X(32432) VALUE SPACES.       01020099
010100     05  PV-ERRMSGBUFFER         PIC X(630) VALUE SPACES.         01030099
010200     05  PV-MSG-LENGTH           PIC S9(9) BINARY VALUE 1000.     01040099
010300     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01050099
010400     05  PV-ACTION               PIC X(60) VALUE SPACES.          01060099
010500     05  PV-MQCHECK              PIC X(8)  VALUE 'MQR2C'.         01070099
010600     05  PV-MQ-REASON-TEXT       PIC X(30) VALUE SPACES.          01080099
010700                                                                  01090099
010800*PV-MSG IS THE INPUT MESSAGE                                      01100099
010900 01  PV-MSG                      PIC X(32432) VALUE SPACES.       01110099
011000 01  XML-LENGTH                  PIC 9(7)     VALUE ZEROS.        01120099
011100                                                                  01130099
011200 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQBCONN'.      01140099
011300 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQBOPEN'.      01150099
011400 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQBINQ'.       01160099
011500 01  PC-MQGET                    PIC X(8)  VALUE 'CSQBGET'.       01170099
011600 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQBPUT'.       01180099
011700 01  PC-MQCMIT                   PIC X(8)  VALUE 'CSQBCOMM'.      01190099
011800 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQBCLOS'.      01200099
011900 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQBDISC'.      01210099
012000 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQBBACK'.      01220099
012100                                                                  01230099
012200* API CONTROL BLOCKS                                              01240099
012300 01  MQM-OBJECT-DESCRIPTOR.                                       01250099
012400     COPY CMQODV.                                                 01260099
012500 01  MQM-MESSAGE-DESCRIPTOR.                                      01270099
012600     COPY CMQMDV.                                                 01280099
012700 01  MQM-PUT-MESSAGE-OPTIONS.                                     01290099
012800     COPY CMQPMOV.                                                01300099
012900 01  MQM-GET-MESSAGE-OPTIONS.                                     01310099
013000     COPY CMQGMOV.                                                01320099
013100                                                                  01330099
013200* MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)      01340099
013300* AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)             01350099
013400 01  MQM-CONSTANTS.                                               01360099
013500     COPY CMQV.                                                   01370099
013600                                                                  01380099
013700 01  PS-PROGRAM-SWITCHES.                                         01390099
013800*    05  PS-ERROR-REC-WRITTEN-SW        PIC X(01)  VALUE 'N'.     01400099
013900*        88  PS-ERROR-REC-WRITTEN-YES              VALUE 'Y'.     01410099
014000*        88  PS-ERROR-REC-WRITTEN-NO               VALUE 'N'.     01420099
014100     05  PS-TIME-TO-END-PROGRAM-SW      PIC X(01)  VALUE 'N'.     01430099
014200         88  PS-TIME-TO-END-PROGRAM-YES            VALUE 'Y'.     01440099
014300         88  PS-TIME-TO-END-PROGRAM-NO             VALUE 'N'.     01450099
014400     05  PS-ROLLBACK-DB2-SW             PIC X(01)  VALUE 'N'.             
014500         88  PS-ROLLBACK-DB2-YES                   VALUE 'Y'.             
014600         88  PS-ROLLBACK-DB2-NO                    VALUE 'N'.             
014700                                                                  01460099
014800***************************************************************** 01470099
014900* MQ SERIES COMPLETION CODES.                                     01480099
015000***************************************************************** 01490099
015100     COPY ISWS002.                                                01500099
015200                                                                  01510099
015300***************************************************************** 01520099
015400* XML CODE DESCRIPTIONS, AND DISPLAYING FORMATTED XML MESSAGES    01530099
015500***************************************************************** 01540099
015600     COPY ISWS007.                                                01550099
015700     COPY ISWS008.                                                01560099
015800     COPY ISWS009.                                                01570099
015900                                                                  01580099
016000***************************************************************** 01590099
016100* PIX RECORD LAYOUT                                               01600099
016200***************************************************************** 01610099
016300     COPY WSRD032.                                                01620099
016400                                                                  01630099
016500******************************************************************01631099
016600*  NUMERIC EDIT ROUTINE COMMAREA                                  01632099
016700******************************************************************01633099
016800     COPY DPWS010I.                                               01634099
016900*                                                                 01635099
017000***************************************************************** 01640099
017100* OUTPUT ERROR MESSAGE COPYBOOK - FOR ERROR QUEUE.                01650099
017200***************************************************************** 01660099
017300     COPY WSRD027.                                                01670099
017400                                                                  01680099
017500******************************************************************01690099
017600* COMMUNICATIONS AREA FOR DB2                                     01700099
017700******************************************************************01710099
017800     EXEC SQL                                                     01720099
017900          INCLUDE SQLCA                                           01730099
018000     END-EXEC.                                                    01740099
018100                                                                  01750099
018200******************************************************************01760099
018300*  DB2 TABLE DECLARATION - WST_PIX_TRAN_HIST                      01770099
018400******************************************************************01780099
018500     EXEC SQL                                                     01790099
018600          INCLUDE WST00000                                        01800099
018700     END-EXEC.                                                    01810099
018800                                                                  01820099
018900******************************************************************01830099
019000*  DB2 VIEW DECLARATION - PROVIDER QUEUE VIEW (PUT/WRITE)         01840099
019100*        (WSV_PRVDR_QUE) WSV00005                                 01850099
019200******************************************************************01860099
019300     EXEC SQL                                                     01870099
019400         INCLUDE WSV00005                                         01880099
019500     END-EXEC.                                                    01890099
019600                                                                  01900099
019700******************************************************************01910099
019800*  DB2 VIEW DECLARATION - CONSUMER QUEUE VIEW (GET/READ)          01920099
019900*        (WSV_CNSMR_QUE) WSV00006                                 01930099
020000******************************************************************01940099
020100     EXEC SQL                                                     01950099
020200         INCLUDE WSV00006                                         01960099
020300     END-EXEC.                                                    01970099
020400                                                                  01980099
020500 01  PT-SUBSCRIPTS.                                                       
020600     05  PT-SUB                       PIC S9(3) COMP-3.                   
020700     05  PT-POINT-SUB                 PIC S9(3) COMP-3.                   
020800 01  PT-EDIT-TABLE.                                               01980099
020900     05  PT-UNEDITED-FIELD OCCURS 21 TIMES.                       01980099
021000         10  PT-UNEDITED-BYTE         PIC X(01).                          
021100                                                                  01980099
021200                                                                  01980099
021300***************************************************************** 01990099
021400 PROCEDURE DIVISION.                                              02000099
021500***************************************************************** 02010099
021600*                                                                 02020099
021700******************************************************************02030099
021800*    MAIN PROCESSING.                                             02040099
021900******************************************************************02050099
022000 0000-MAIN-MODULE.                                                02060099
022100*    DISPLAY 'WSKUP020 - 0000-MAIN-MODULE.             '.         02070099
022200     DISPLAY '**********************************'.                02080099
022300     DISPLAY '* START OF WSKUP020               '.                02090099
022400     DISPLAY '**********************************'.                02100099
022500                                                                  02110099
022600     PERFORM 1000-INITIALIZATION.                                 02120099
022700     PERFORM 1200-MQSERIES-CONNECT.                               02130099
022800     PERFORM 1300-MQSERIES-OPEN-PIX.                              02140099
022900     PERFORM 1340-MQSERIES-OPEN-ERROR.                            02150099
023000     PERFORM 1400-GET-MQ-MESSAGE.                                 02160099
023100     PERFORM 2000-PROCESS-XML                                     02170099
023200             UNTIL PV-REASON = MQRC-NO-MSG-AVAILABLE              02180099
023300              OR PS-TIME-TO-END-PROGRAM-YES.                      02190099
023400     PERFORM 9300-EOJ.                                            02200099
023500     GOBACK.                                                      02210099
023600                                                                  02220099
023700***************************************************************** 02230099
023800* INITIALIZATION                                                  02240099
023900*     OPENS FILES                                                 02250099
024000*     INITIALIZES VARIABLES                                       02260099
024100*     GETS MQ QUEUE & QUEUE MANAGER INFORMATION                   02270099
024200***************************************************************** 02280099
024300 1000-INITIALIZATION.                                             02290099
024400*    DISPLAY 'WSKUP020 - 1000-INITIALIZATION.          '.         02300099
024500                                                                  02310099
024600     INITIALIZE   PIXBridge                                       02320099
024700                  DCLWST00000                                     02330099
024800                  WS027-RECEIPT-PIX-ERROR-REC.                    02340099
024900                                                                  02350099
025000     EXEC SQL                                                     02360099
025100         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 02370099
025200     END-EXEC                                                     02380099
025300                                                                  02390099
025400     EVALUATE TRUE                                                02400099
025500         WHEN SQLCODE = ZERO                                      02410099
025600              CONTINUE                                            02420099
025700         WHEN OTHER                                               02430099
025800              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              02440099
025900              MOVE 'C'                TO WS027-ERROR-TYPE-CDE     02450099
026000              MOVE 'WSRD032 '         TO WS027-ERROR-COPYBOOK     02460099
026100              MOVE PC-PGM-NAME        TO WS027-ERROR-PGM-NAME     02470099
026200              MOVE '1000-'            TO WS027-ERROR-PARA-NBR     02480099
026300              MOVE SQLCODE            TO WS027-SQLCODE            02490099
026400              MOVE 'SET CURR TIMESTEMP '                          02500099
026500                                      TO WS027-ERROR-DESC-TXT     02510099
026600              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                02520099
026700              MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH          02530099
026800              MOVE 'SET TIMESTAMP      ' TO PV-TABLE-NAME         02540099
026900              PERFORM 9500-ABEND                                  02550099
027000     END-EVALUATE.                                                02560099
027100                                                                  02570099
027200     MOVE PV-CURRENT-TMST       TO PV-CURRENT-DATE.               02580099
027300                                                                  02590099
027400     PERFORM 1100-GET-MQ-INFO-PIX.                                02600099
027500     PERFORM 1160-GET-MQ-INFO-ERROR.                              02610099
027600                                                                  02620099
027700******************************************************************02630099
027800* GETS MQ INFO FROM WSV_CNSMR_QUE (GET/READ) - PIX TRANSACTIONS.  02640099
027900******************************************************************02650099
028000 1100-GET-MQ-INFO-PIX.                                            02660099
028100*    DISPLAY 'WSKUP020 - 1100-GET-MQ-INFO-PIX.         '.         02670099
028200                                                                  02680099
028300     PERFORM WITH TEST AFTER                                      02690099
028400             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 02700099
028500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         02710099
028600                     SQLCODE = ZERO                               02720099
028700                                                                  02730099
028800       EXEC SQL                                                   02740099
028900        SELECT QUE_MGR,                                           02750099
029000               QUE_NM                                             02760099
029100         INTO :WSV00006-QUE-MGR                                   02770099
029200             ,:WSV00006-QUE-NM                                    02780099
029300         FROM WSV_CNSMR_QUE                                       02790099
029400        WHERE APPL_FUNC_DESC  = 'PIXALL'                          02800099
029500          AND INTGRTN_TYP_CDE = 'PIXREPSTRY'                      02810099
029600       END-EXEC                                                   02820099
029700                                                                  02830099
029800       DISPLAY 'WSV00006-QUE-MGR =' WSV00006-QUE-MGR-TEXT         02840099
029900       DISPLAY 'WSV00006-QUE-NM  =' WSV00006-QUE-NM-TEXT          02850099
030000                                                                  02860099
030100       EVALUATE TRUE                                              02870099
030200           WHEN SQLCODE = 0                                       02880099
030300             INITIALIZE PV-QMGR-NAME-PIX                          02890099
030400             MOVE WSV00006-QUE-MGR-TEXT TO                        02900099
030500                PV-QMGR-NAME-PIX                                  02910099
030600             INITIALIZE PV-QUE-NAME-PIX                           02920099
030700             MOVE WSV00006-QUE-NM-TEXT TO                         02930099
030800                PV-QUE-NAME-PIX                                   02940099
030900           WHEN OTHER                                             02950099
031000             DISPLAY PC-PGM-NAME                                  02960099
031100                ' - Q OR QMGR ERROR IN PIXQUEUE/PIXFASHION'       02970099
031200             MOVE 'Q OR QMGR ERROR IN PIXQUEUE/PIXFASHION' TO     02980099
031300                PV-ERROR-MESSAGE                                  02990099
031400             ADD +1 TO PA-ERRORS-PROCESSED                        03000099
031500             PERFORM 9001-MQSERIES-ERROR                          03010099
031600       END-EVALUATE                                               03020099
031700     END-PERFORM.                                                 03030099
031800                                                                  03040099
031900******************************************************************03050099
032000* GETS MQ INFO FROM WSV_PRVDR_QUE (PUT/WRITE) - ERROR QUEUE       03060099
032100******************************************************************03070099
032200 1160-GET-MQ-INFO-ERROR.                                          03080099
032300*    DISPLAY 'WSKUP020 - 1160-GET-MQ-INFO-ERROR.       '.         03090099
032400                                                                  03100099
032500     PERFORM WITH TEST AFTER                                      03110099
032600             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 03120099
032700             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         03130099
032800                     SQLCODE = ZERO                               03140099
032900                                                                  03150099
033000       EXEC SQL                                                   03160099
033100        SELECT LCL_QUE_MGR,                                       03170099
033200               QUE_NM                                             03180099
033300         INTO :WSV00005-LCL-QUE-MGR                               03190099
033400             ,:WSV00005-QUE-NM                                    03200099
033500         FROM WSV_PRVDR_QUE                                       03210099
033600        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      03220099
033700          AND INTGRTN_TYP_CDE = 'PIXFRWDERR'                      03230099
033800       END-EXEC                                                   03240099
033900                                                                  03250099
034000       DISPLAY 'WSV00005-QUE-MGR =' WSV00005-LCL-QUE-MGR-TEXT     03260099
034100       DISPLAY 'WSV00005-QUE-NM  =' WSV00005-QUE-NM-TEXT          03270099
034200                                                                  03280099
034300       EVALUATE TRUE                                              03290099
034400           WHEN SQLCODE = 0                                       03300099
034500              INITIALIZE PV-QMGR-NAME-ERROR                       03310099
034600              MOVE WSV00005-LCL-QUE-MGR-TEXT TO                   03320099
034700                 PV-QMGR-NAME-ERROR                               03330099
034800              INITIALIZE PV-QUE-NAME-ERROR                        03340099
034900              MOVE WSV00005-QUE-NM-TEXT TO                        03350099
035000                 PV-QUE-NAME-ERROR                                03360099
035100           WHEN OTHER                                             03370099
035200             DISPLAY PC-PGM-NAME                                  03380099
035300                ' - Q OR QMGR ERROR IN PIXLEGACYQ/PIXFRWDERR'     03390099
035400             MOVE 'Q OR QMGR ERROR IN PIXLEGACYQ/PIXFRWDERR' TO   03400099
035500                PV-ERROR-MESSAGE                                  03410099
035600             ADD +1 TO PA-ERRORS-PROCESSED                        03420099
035700             PERFORM 9001-MQSERIES-ERROR                          03430099
035800       END-EVALUATE                                               03440099
035900     END-PERFORM.                                                 03450099
036000                                                                  03460099
036100******************************************************************03470099
036200* CONNECT TO PIX QUEUE MANAGER.                                   03480099
036300******************************************************************03490099
036400 1200-MQSERIES-CONNECT.                                           03500099
036500*    DISPLAY 'WSKUP020 - 1200-MQSERIES-CONNECT.        '.         03510099
036600                                                                  03520099
036700     CALL PC-MQCONN USING PV-QMGR-NAME-PIX                        03530099
036800                          PV-HCONN                                03540099
036900                          PV-COMPLETION-CODE                      03550099
037000                          PV-REASON.                              03560099
037100                                                                  03570099
037200     MOVE PV-REASON TO PV-CON-REASON.                             03580099
037300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03590099
037400         CONTINUE                                                 03600099
037500     ELSE                                                         03610099
037600         STRING 'CONNECT - ' PV-QMGR-NAME-PIX                     03620099
037700           DELIMITED BY SIZE INTO PV-ACTION                       03630099
037800         ADD +1 TO PA-ERRORS-PROCESSED                            03640099
037900         PERFORM 9001-MQSERIES-ERROR.                             03650099
038000                                                                  03660099
038100***************************************************************** 03670099
038200*   OPEN THE ITEM QUEUE FOR GETS (PIX TRANSACTIONS).              03680099
038300***************************************************************** 03690099
038400 1300-MQSERIES-OPEN-PIX.                                          03700099
038500*    DISPLAY 'WSKUP020 - 1300-MQSERIES-OPEN-PIX.       '.         03710099
038600                                                                  03720099
038700     MOVE '1300-MQSERIES-OPEN-PIX'     TO PV-PARAGRAPH.           03730099
038800                                                                  03740099
038900*    NON-DESTRUCTIVE READ (FOR TESTING ONLY)                              
039000*    COMPUTE PV-OPEN-OPTIONS        = MQOO-BROWSE                         
039100*                                   + MQOO-FAIL-IF-QUIESCING.             
039200                                                                          
039300     COMPUTE PV-OPEN-OPTIONS        = MQOO-INPUT-SHARED           03750099
039400                                    + MQOO-OUTPUT                 03760099
039500                                    + MQOO-SET-IDENTITY-CONTEXT   03770099
039600                                    + MQOO-FAIL-IF-QUIESCING.     03780099
039700                                                                          
039800     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            03790099
039900     MOVE PV-QMGR-NAME-PIX         TO MQOD-OBJECTQMGRNAME.        03800099
040000     MOVE PV-QUE-NAME-PIX          TO MQOD-OBJECTNAME.            03810099
040100                                                                  03820099
040200     CALL PC-MQOPEN USING PV-HCONN                                03830099
040300                          MQM-OBJECT-DESCRIPTOR                   03840099
040400                          PV-OPEN-OPTIONS                         03850099
040500                          PV-HANDLE-PIX                           03860099
040600                          PV-COMPLETION-CODE                      03870099
040700                          PV-REASON.                              03880099
040800                                                                  03890099
040900     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03900099
041000         CONTINUE                                                 03910099
041100     ELSE                                                         03920099
041200         STRING 'OPEN - ' PV-QUE-NAME-PIX                         03930099
041300           DELIMITED BY SIZE INTO PV-ACTION                       03940099
041400         ADD +1 TO PA-ERRORS-PROCESSED                            03950099
041500         PERFORM 9001-MQSERIES-ERROR.                             03960099
041600                                                                  03970099
041700***************************************************************** 03980099
041800*   OPEN THE ITEM QUEUE FOR PUTS (ERROR TRANSACTIONS).            03990099
041900***************************************************************** 04000099
042000 1340-MQSERIES-OPEN-ERROR.                                        04010099
042100*    DISPLAY 'WSKUP020 - 1340-MQSERIES-OPEN-ERROR.     '.         04020099
042200                                                                  04030099
042300     MOVE PV-QMGR-NAME-ERROR       TO MQOD-OBJECTQMGRNAME.        04040099
042400     MOVE PV-QUE-NAME-ERROR        TO MQOD-OBJECTNAME.            04050099
042500                                                                  04060099
042600     COMPUTE PV-OPEN-OPTIONS       = MQOO-OUTPUT                  04070099
042700                                   + MQOO-SET-IDENTITY-CONTEXT    04080099
042800                                   + MQOO-FAIL-IF-QUIESCING.      04090099
042900                                                                  04100099
043000     CALL PC-MQOPEN USING PV-HCONN                                04110099
043100                          MQM-OBJECT-DESCRIPTOR                   04120099
043200                          PV-OPEN-OPTIONS                         04130099
043300                          PV-HANDLE-ERROR                         04140099
043400                          PV-COMPLETION-CODE                      04150099
043500                          PV-REASON.                              04160099
043600                                                                  04170099
043700     IF PV-COMPLETION-CODE = MQCC-OK THEN                         04180099
043800         CONTINUE                                                 04190099
043900     ELSE                                                         04200099
044000         STRING 'OPEN - ' PV-QUE-NAME-ERROR                       04210099
044100           DELIMITED BY SIZE INTO PV-ACTION                       04220099
044200         ADD +1 TO PA-ERRORS-PROCESSED                            04230099
044300         PERFORM 9001-MQSERIES-ERROR                              04240099
044400     END-IF.                                                      04250099
044500                                                                  04260099
044600****************************************************************  04270099
044700** GET THE MESSAGES (PIX TRANSACTION) FROM THE QUEUE.             04280099
044800****************************************************************  04290099
044900 1400-GET-MQ-MESSAGE.                                             04300099
045000*    DISPLAY 'WSKUP020 - 1400-GET-MQ-MESSAGE.          '.         04310099
045100                                                                  04320099
045200     INITIALIZE PV-MSGBUFFER                                      04330099
045300                PV-MSG.                                           04340099
045400                                                                  04350099
045500     MOVE MQMI-NONE         TO MQMD-MSGID.                        04360099
045600     MOVE MQCI-NONE         TO MQMD-CORRELID.                     04370099
045700                                                                  04380099
045800     MOVE MQFMT-STRING      TO MQMD-FORMAT.                       04390099
045900     MOVE +32432            TO PV-MSG-LENGTH.                     04400099
046000                                                                  04410099
046100*        QUEUE RECORDS ARE NOT DESTROYED (TEST ONLY)                      
046200*        COMPUTE MQGMO-OPTIONS  =   MQGMO-NO-SYNCPOINT                    
046300*                                 + MQGMO-CONVERT                         
046400*                                 + MQGMO-BROWSE-NEXT                     
046500*                                 + MQGMO-ACCEPT-TRUNCATED-MSG            
046600*                                 + MQGMO-FAIL-IF-QUIESCING               
046700*                                 + MQGMO-WAIT.                           
046800                                                                          
046900*** THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL                
047000*** CONTINUE UNTIL A END-OF-RUN MESSAGE APPEARS ON THE Q.                 
047100     MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.                     
047200                                                                          
047300     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  04420099
047400                               MQGMO-CONVERT   +                  04430099
047500                               MQGMO-ACCEPT-TRUNCATED-MSG +       04440099
047600                               MQGMO-WAIT.                        04450099
047700                                                                  04460099
047800     CALL PC-MQGET USING PV-HCONN                                 04470099
047900                         PV-HANDLE-PIX                            04480099
048000                         MQM-MESSAGE-DESCRIPTOR                   04490099
048100                         MQM-GET-MESSAGE-OPTIONS                  04500099
048200                         PV-MSG-LENGTH                            04510099
048300                         PV-MSGBUFFER(1:PV-MSG-LENGTH)            04520099
048400                         PV-DATA-LENGTH                           04530099
048500                         PV-COMPLETION-CODE                       04540099
048600                         PV-REASON.                               04550099
048700                                                                  04560099
048800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        04570099
048900         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              04580099
049000          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      04590099
049100            INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                04600099
049200            MOVE 'D'                TO WS027-ERROR-TYPE-CDE       04610099
049300            MOVE 'WSRD032 '         TO WS027-ERROR-COPYBOOK       04620099
049400            MOVE PC-PGM-NAME        TO WS027-ERROR-PGM-NAME       04630099
049500            MOVE '1400-'            TO WS027-ERROR-PARA-NBR       04640099
049600            MOVE SQLCODE            TO WS027-SQLCODE              04650099
049700            MOVE 'GET PIX MQ 1       '                            04660099
049800                                    TO WS027-ERROR-DESC-TXT       04670099
049900            PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                  04680099
050000            DISPLAY 'PV-MSGBUFF1:' PV-MSGBUFFER(1:PV-DATA-LENGTH) 04690099
050100            DISPLAY 'PV-MSGLNGT1:' PV-MSG-LENGTH                  04700099
050200            DISPLAY 'PV-DATLNGT1:' PV-DATA-LENGTH                 04710099
050300            DISPLAY 'PV-COMPLCD1:' PV-COMPLETION-CODE             04720099
050400            DISPLAY 'PV-REASON1 :' PV-REASON                      04730099
050500            MOVE 'MQGET ERROR'          TO PV-ERROR-MESSAGE       04740099
050600            MOVE '1400-GET-MQ-MSG'      TO PV-PARAGRAPH           04750099
050700            MOVE PV-COMPLETION-CODE     TO IS-COMPLETION          04760099
050800            MOVE PV-REASON              TO IS-REASON-TEXT         04770099
050900            STRING 'GET - ' PV-QMGR-NAME-PIX                      04780099
051000            DELIMITED BY SIZE INTO PV-ACTION                      04790099
051100            ADD +1 TO PA-ERRORS-PROCESSED                         04800099
051200            PERFORM 9001-MQSERIES-ERROR                           04810099
051300         ELSE                                                     04820099
051400*THIS MEANS A MSG WAS TRUNCATED                                   04830099
051500            IF PV-COMPLETION-CODE = +1                            04840099
051600             AND PV-REASON = +2079                                04850099
051700               INITIALIZE WS027-RECEIPT-PIX-ERROR-REC             04860099
051800               MOVE 'D'                TO WS027-ERROR-TYPE-CDE    04870099
051900               MOVE 'WSRD032 '         TO WS027-ERROR-COPYBOOK    04880099
052000               MOVE PC-PGM-NAME        TO WS027-ERROR-PGM-NAME    04890099
052100               MOVE '1400-'            TO WS027-ERROR-PARA-NBR    04900099
052200               MOVE SQLCODE            TO WS027-SQLCODE           04910099
052300               MOVE 'GET PIX MQ 2       '                         04920099
052400                                       TO WS027-ERROR-DESC-TXT    04930099
052500               PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT               04940099
052600               DISPLAY 'PV-MSGBUFF2:' PV-MSGBUFFER                04950099
052700                                      (1:PV-DATA-LENGTH)          04960099
052800               DISPLAY 'PV-MSGLNGT2:' PV-MSG-LENGTH               04970099
052900               DISPLAY 'PV-DATLNGT2:' PV-DATA-LENGTH              04980099
053000               DISPLAY 'PV-COMPLCD2:' PV-COMPLETION-CODE          04990099
053100               DISPLAY 'PV-REASON2 :' PV-REASON                   05000099
053200               MOVE PV-COMPLETION-CODE     TO IS-COMPLETION       05010099
053300               MOVE PV-REASON              TO IS-REASON-TEXT      05020099
053400               ADD +1          TO PA-MQ-PIX-MSGS-READ             05030099
053500               STRING 'GET - ' PV-QMGR-NAME-PIX 'MSG TRUNCATED'   05040099
053600               DELIMITED BY SIZE INTO PV-ACTION                   05050099
053700               ADD +1 TO PA-ERRORS-PROCESSED                      05060099
053800               PERFORM 9001-MQSERIES-ERROR                        05070099
053900            ELSE                                                  05080099
054000               IF (PV-REASON = MQRC-NO-MSG-AVAILABLE)             05090099
054100*                 PERFORM 8500-MQ-COMMIT                          11390099
054200                  CONTINUE                                        05100099
054300*                 DISPLAY 'PV-MSGBUFF4:' PV-MSGBUFFER             05110099
054400*                                        (1:PV-DATA-LENGTH)       05120099
054500*                 DISPLAY 'PV-MSGLNGT4:' PV-MSG-LENGTH            05130099
054600*                 DISPLAY 'PV-DATLNGT4:' PV-DATA-LENGTH           05140099
054700*                 DISPLAY 'PV-COMPLCD4:' PV-COMPLETION-CODE       05150099
054800*                 DISPLAY 'PV-REASON4 :' PV-REASON                05160099
054900*                 DISPLAY 'PIX REC:' PV-MSG(1:PV-DATA-LENGTH)     05170099
055000               END-IF                                             05180099
055100            END-IF                                                05190099
055200         END-IF                                                   05200099
055300     ELSE                                                         05210099
055400         MOVE PV-MSGBUFFER  TO PV-MSG                             05220099
055500         ADD +1             TO PA-MQ-PIX-MSGS-READ                05230099
055600*        DISPLAY 'PV-MSGBUFF3:' PV-MSGBUFFER(1:PV-DATA-LENGTH)    05240099
055700*        DISPLAY 'PV-MSGLNGT3:' PV-MSG-LENGTH                     05250099
055800*        DISPLAY 'PV-DATLNGT3:' PV-DATA-LENGTH                    05260099
055900*        DISPLAY 'PV-COMPLCD3:' PV-COMPLETION-CODE                05270099
056000*        DISPLAY 'PV-REASON3 :' PV-REASON                         05280099
056100*        DISPLAY 'PIX 300 REC:' PV-MSG(1:PV-DATA-LENGTH)          05290099
056200*        DISPLAY 'IN 1400-   :' PV-REASON                         05300099
056300     END-IF.                                                      05310099
056400                                                                  05320099
056500******************************************************************05330099
056600* PROCESS/PARSE THE XML DATA                                      05340099
056700******************************************************************05350099
056800 2000-PROCESS-XML.                                                05360099
056900*    DISPLAY 'WSKUP020 - 2000-PROCESS-XML.             '.         05370099
057000                                                                  05380099
057100*    DISPLAY " ".                                                 05390099
057200*    DISPLAY "PROCESSING XML...".                                 05400099
057300                                                                  05410099
057400     INITIALIZE DCLWST00000.                                      05420099
057500     MOVE PV-CURRENT-DATE      TO WST00000-DATE-PROC.             05430099
057600                                                                  05440099
057700*mjmchg                                                           05450099
057800*THE "END RUN OF PROGRAM" MSG WILL SHUT DOWN THIS STARTED TASK.   05460099
057900     IF PV-MSG (1:18) = PC-END-RUN-MSG                            05470099
058000        SET PS-TIME-TO-END-PROGRAM-YES TO TRUE                    05480099
058100     ELSE                                                         05490099
058200*mjmend                                                           05500099
058300                                                                  05510099
058400     SET PS-ROLLBACK-DB2-NO           TO TRUE                             
058500                                                                          
058600       XML PARSE PV-MSG                                           05520099
058700           PROCESSING PROCEDURE                                   05530099
058800               2100-HANDLE-XML                                    05540099
058900                   ON EXCEPTION                                   05550099
059000                        PERFORM 3000-XML-ERROR                    05560099
059100                   NOT ON EXCEPTION                               05570099
059200                        PERFORM 3100-XML-SUCCESS                  05580099
059300        END-XML                                                   05590099
059400                                                                  05600099
059500*       IF THIS INSERT FAILS:                                             
059600*       1 - AN ERROR MESSAGE IS WRITTEN                                   
059700*       2 - 9300-EOJ IS PERFORMED TO CLOSE THE QUEUES                     
059800*       3 - 6600-ROLLBACK-DB2 IS DONE                                     
059900*       4 - 9500-ABEND IS DONE (CROAK)                                    
060000*                                                                         
060100*      THEREFORE THE ROLLBACK SWITCH DOESN'T REALLY MEAN MUCH             
060200*      EXCEPT TO KEEP THE CODE SOMEWHAT STANDARD.                         
060300                                                                          
060400*      THE COMMIT WILL ALWAYS BE DONE UNLESS THE PROGRAM CROAKS           
060500*            (SEE ABOVE)                                                  
060600*                                                                         
060700        PERFORM 2500-INSERT-PIX-TBL                               05610099
060800                                                                          
060900        IF PS-ROLLBACK-DB2-YES                                            
061000            PERFORM 6600-ROLLBACK-DB2                                     
061100        ELSE                                                              
061200            PERFORM 6500-COMMIT                                           
061300        END-IF                                                            
061400                                                                          
061500        PERFORM 8500-MQ-COMMIT                                    11390099
061600        PERFORM 1400-GET-MQ-MESSAGE                               05620099
061700                                                                          
061800     END-IF.                                                      05630099
061900                                                                  05640099
062000******************************************************************05650099
062100* PREP THE DB2 FIELDS WITH THE XML DATA                           05660099
062200******************************************************************05670099
062300 2100-HANDLE-XML.                                                 05680099
062400*    DISPLAY 'WSKUP020 - 2100-HANDLE-XML.              '.         05690099
062500                                                                  05700099
062600     COMPUTE XML-LENGTH = FUNCTION LENGTH(XML-TEXT).              05710099
062700                                                                  05720099
062800     EVALUATE XML-EVENT                                           05730099
062900       WHEN 'START-OF-ELEMENT'                                    05740099
063000         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ELEMENT        05750099
063100                                                                  05760099
063200       WHEN 'END-OF-ELEMENT'                                      05770099
063300*        DISPLAY 'end-of-element: ' XML-TEXT(1:XML-LENGTH)        05780099
063400                                                                  05790099
063500         EVALUATE XML-TEXT(1:XML-LENGTH)                          05800099
063600           WHEN 'PIXBridge'                                       05810099
063600           WHEN 'PIXBRIDGE'                                       05810099
063700                 CONTINUE                                         05820099
063800           WHEN OTHER                                             05830099
063900                 CONTINUE                                         05840099
064000         END-EVALUATE                                             05850099
064100                                                                  05860099
064200       WHEN 'ATTRIBUTE-NAME'                                      05870099
064300         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ATTRIBUTE      05880099
064400                                                                  05890099
064500       WHEN 'ATTRIBUTE-CHARACTERS'                                05900099
064600       WHEN 'ATTRIBUTE-CHARACTER'                                 05910099
064700       WHEN 'CONTENT-CHARACTERS'                                  05920099
064800       WHEN 'CONTENT-CHARACTER'                                   05930099
064900        EVALUATE PV-CURRENT-ELEMENT                               05940099
065000         WHEN 'TransactionType'                                   05950099
065000         WHEN 'TRANSACTIONTYPE'                                   05950099
065100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-TRAN-TYPE      05960099
065200         WHEN 'TransactionCode'                                   05970099
065200         WHEN 'TRANSACTIONCODE'                                   05970099
065300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-TRAN-CODE      05980099
065400         WHEN 'TransactionNumber'                                 05990099
065400         WHEN 'TRANSACTIONNUMBER'                                 05990099
065500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-TRAN-NBR       06000099
065600         WHEN 'SequenceNumber'                                    06010099
065600         WHEN 'SEQUENCENUMBER'                                    06010099
065700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-PIX-SEQ-NBR    06020099
065800         WHEN 'DCNumber'                                          06030099
065800         WHEN 'DCNUMBER'                                          06030099
065900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-K-DC-NBR       06040099
066000         WHEN 'Warehouse'                                         06050099
066000         WHEN 'WAREHOUSE'                                         06050099
066100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-WHSE           06060099
066200         WHEN 'Company'                                           06070099
066200         WHEN 'COMPANY'                                           06070099
066300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-CO             06080099
066400         WHEN 'Division'                                          06090099
066400         WHEN 'DIVISION'                                          06090099
066500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-DIV            06100099
066600         WHEN 'CaseNumber'                                        06110099
066600         WHEN 'CASENUMBER'                                        06110099
066700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-CASE-NBR       06120099
066800         WHEN 'SkuID'                                             06130099
066800         WHEN 'SKUID'                                             06130099
066900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SKU-ID         06140099
067000         WHEN 'Style'                                             06150099
067000         WHEN 'STYLE'                                             06150099
067100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-STYLE          06160099
067200         WHEN 'StyleSuffix'                                       06170099
067200         WHEN 'STYLESUFFIX'                                       06170099
067300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-STYLE-SFX      06180099
067400         WHEN 'Season'                                            06190099
067400         WHEN 'SEASON'                                            06190099
067500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SEASON         06200099
067600         WHEN 'SeasonYear'                                        06210099
067600         WHEN 'SEASONYEAR'                                        06210099
067700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SEASON-YR      06220099
067800         WHEN 'Color'                                             06230099
067800         WHEN 'COLOR'                                             06230099
067900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-COLOR          06240099
068000         WHEN 'ColorSuffix'                                       06250099
068000         WHEN 'COLORSUFFIX'                                       06250099
068100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-COLOR-SFX      06260099
068200         WHEN 'SecDimension'                                      06270099
068200         WHEN 'SECDIMENSION'                                      06270099
068300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SEC-DIM        06280099
068400         WHEN 'Quality'                                           06290099
068400         WHEN 'QUALITY'                                           06290099
068500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-QUAL           06300099
068600         WHEN 'SizeDesc'                                          06310099
068600         WHEN 'SIZEDESC'                                          06310099
068700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SIZE-DESC      06320099
068800         WHEN 'SizeRangeCode'                                     06330099
068800         WHEN 'SIZERANGECODE'                                     06330099
068900           MOVE XML-TEXT(1:XML-LENGTH) TO                         06340099
069000                                       WST00000-SIZE-RANGE-CODE   06350099
069100*        WHEN 'SizeRelPosninTable'                                06360099
069200*          MOVE XML-TEXT(1:XML-LENGTH) TO                         06370099
069300*                                      WST00000-SIZE-POSN-IN-TBL  06380099
069400         WHEN 'InventoryType'                                     06390099
069400         WHEN 'INVENTORYTYPE'                                     06390099
069500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-INVN-TYPE      06400099
069600         WHEN 'ProductStatus'                                     06410099
069600         WHEN 'PRODUCTSTATUS'                                     06410099
069700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-PROD-STAT      06420099
069800         WHEN 'BatchNumber'                                       06430099
069800         WHEN 'BATCHNUMBER'                                       06430099
069900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-BATCH-NBR      06440099
070000         WHEN 'SKUAttribute1'                                     06450099
070000         WHEN 'SKUATTRIBUTE1'                                     06450099
070100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SKU-ATTR-1     06460099
070200         WHEN 'SKUAttribute2'                                     06470099
070200         WHEN 'SKUATTRIBUTE2'                                     06470099
070300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SKU-ATTR-2     06480099
070400         WHEN 'SKUAttribute3'                                     06490099
070400         WHEN 'SKUATTRIBUTE3'                                     06490099
070500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SKU-ATTR-3     06500099
070600         WHEN 'SKUAttribute4'                                     06510099
070600         WHEN 'SKUATTRIBUTE4'                                     06510099
070700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SKU-ATTR-4     06520099
070800         WHEN 'SKUAttribute5'                                     06530099
070800         WHEN 'SKUATTRIBUTE5'                                     06530099
070900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-SKU-ATTR-5     06540099
071000         WHEN 'CountryOfOrgin'                                    06550099
071000         WHEN 'COUNTRYOFORGIN'                                    06550099
071100           MOVE XML-TEXT(1:XML-LENGTH) TO                         06560099
071200                                       WST00000-CNTRY-OF-ORGN     06570099
071300         WHEN 'InvAdjustmentQty'                                  06580099
071300         WHEN 'INVADJUSTMENTQTY'                                  06580099
071400           MOVE XML-TEXT(1:XML-LENGTH) TO DP010I-UNEDITED-FIELD   06600099
071500           MOVE '2100-'                TO PV-PARAGRAPH            06601099
071600           PERFORM 8900-NUMERIC-EDIT                              06610099
071700           MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                     06620099
071800                                       TO WST00000-INVN-ADJMT-QTY         
071900                                                                  06630099
072000         WHEN 'InvAdjustmentType'                                 06640099
072000         WHEN 'INVADJUSTMENTTYPE'                                 06640099
072100           MOVE XML-TEXT(1:XML-LENGTH) TO                         06650099
072200                                       WST00000-INVN-ADJMT-TYPE   06660099
072300                                                                          
072400         WHEN 'WeightAdjustmentQuantity'                          06670099
072400         WHEN 'WEIGHTADJUSTMENTQUANTITY'                          06670099
072500                                                                  06720099
072600           MOVE XML-TEXT(1:XML-LENGTH) TO DP010I-UNEDITED-FIELD   06600099
072700           MOVE '2100-'                TO PV-PARAGRAPH            06601099
072800           PERFORM 8900-NUMERIC-EDIT                              06610099
072900           MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                     06620099
073000                                       TO WST00000-WT-ADJMT-QTY           
073100                                                                  06630099
073200         WHEN 'WeightAdjustmentType'                              06730099
073200         WHEN 'WEIGHTADJUSTMENTTYPE'                              06730099
073300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-WT-ADJMT-TYPE  06740099
073400         WHEN 'UnitOfMeasure'                                     06750099
073400         WHEN 'UNITOFMEASURE'                                     06750099
073500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-UOM            06760099
073600         WHEN 'ReferenceWhse'                                     06770099
073600         WHEN 'REFERENCEWHSE'                                     06770099
073700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-WHSE       06780099
073800         WHEN 'TransReasonCode'                                   06790099
073800         WHEN 'TRANSREASONCODE'                                   06790099
073900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-RSN-CODE       06800099
074000         WHEN 'ReceiptsVariance'                                  06810099
074000         WHEN 'RECEIPTSVARIANCE'                                  06810099
074100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-RCPT-VARI      06820099
074200         WHEN 'ReceiptsCompleted'                                 06830099
074200         WHEN 'RECEIPTSCOMPLETED'                                 06830099
074300           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-RCPT-CMPL      06840099
074400         WHEN 'CasesShipped'                                      06850099
074400         WHEN 'CASESSHIPPED'                                      06850099
074500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-CASES-SHPD     06860099
074600                                                                  06720099
074700         WHEN 'UnitsShipped'                                      06870099
074700         WHEN 'UNITSSHIPPED'                                      06870099
074800           MOVE XML-TEXT(1:XML-LENGTH) TO DP010I-UNEDITED-FIELD   06600099
074900           MOVE '2100-'                TO PV-PARAGRAPH            06601099
075000           PERFORM 8900-NUMERIC-EDIT                              06610099
075100           MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                     06620099
075200                                       TO WST00000-UNITS-SHPD             
075300                                                                  06630099
075400         WHEN 'CasesReceived'                                     06930099
075400         WHEN 'CASESRECEIVED'                                     06930099
075500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-CASES-RCVD     06940099
075600                                                                  06950099
075700         WHEN 'UnitsReceived'                                     06960099
075700         WHEN 'UNITSRECEIVED'                                     06960099
075800           MOVE XML-TEXT(1:XML-LENGTH) TO DP010I-UNEDITED-FIELD   06600099
075900           MOVE '2100-'                TO PV-PARAGRAPH            06601099
076000           PERFORM 8900-NUMERIC-EDIT                              06610099
076100           MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                     06620099
076200                                       TO WST00000-UNITS-RCVD             
076300                                                                  06630099
076400         WHEN 'ActionCode'                                        07020099
076400         WHEN 'ACTIONCODE'                                        07020099
076500           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-ACTN-CODE      07030099
076600         WHEN 'CustomReference'                                   07040099
076600         WHEN 'CUSTOMREFERENCE'                                   07040099
076700           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-CUSTOM-REF     07050099
076800                                                                  07060099
076900         WHEN 'ErrorComment'                                      07070099
076900         WHEN 'ERRORCOMMENT'                                      07070099
077000           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-ERROR-CMNT     07080099
077100                                                                  07090099
077200         WHEN 'ReferenceCode1'                                    07100099
077200         WHEN 'REFERENCECODE1'                                    07100099
077300           MOVE XML-TEXT(1:XML-LENGTH) TO                         07110099
077400                                       WST00000-REF-CODE-ID-1     07120099
077500         WHEN 'Reference1'                                        07130099
077500         WHEN 'REFERENCE1'                                        07130099
077600           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-1    07140099
077700         WHEN 'ReferenceCode2'                                    07150099
077700         WHEN 'REFERENCECODE2'                                    07150099
077800           MOVE XML-TEXT(1:XML-LENGTH) TO                         07160099
077900                                       WST00000-REF-CODE-ID-2     07170099
078000         WHEN 'Reference2'                                        07180099
078000         WHEN 'REFERENCE2'                                        07180099
078100           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-2    07190099
078200         WHEN 'ReferenceCode3'                                    07200099
078200         WHEN 'REFERENCECODE3'                                    07200099
078300           MOVE XML-TEXT(1:XML-LENGTH) TO                         07210099
078400                                       WST00000-REF-CODE-ID-3     07220099
078500         WHEN 'Reference3'                                        07230099
078500         WHEN 'REFERENCE3'                                        07230099
078600           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-3    07240099
078700                                                                  07250099
078800         WHEN 'ReferenceCode4'                                    07260099
078800         WHEN 'REFERENCECODE4'                                    07260099
078900           MOVE XML-TEXT(1:XML-LENGTH) TO                         07270099
079000                                       WST00000-REF-CODE-ID-4     07280099
079100         WHEN 'Reference4'                                        07290099
079100         WHEN 'REFERENCE4'                                        07290099
079200           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-4    07300099
079300                                                                  07310099
079400         WHEN 'ReferenceCode5'                                    07320099
079400         WHEN 'REFERENCECODE5'                                    07320099
079500           MOVE XML-TEXT(1:XML-LENGTH) TO                         07330099
079600                                       WST00000-REF-CODE-ID-5     07340099
079700         WHEN 'Reference5'                                        07350099
079700         WHEN 'REFERENCE5'                                        07350099
079800           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-5    07360099
079900                                                                  07370099
080000         WHEN 'ReferenceCode6'                                    07380099
080000         WHEN 'REFERENCECODE6'                                    07380099
080100           MOVE XML-TEXT(1:XML-LENGTH) TO                         07390099
080200                                       WST00000-REF-CODE-ID-6     07400099
080300         WHEN 'Reference6'                                        07410099
080300         WHEN 'REFERENCE6'                                        07410099
080400           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-6    07420099
080500                                                                  07430099
080600         WHEN 'ReferenceCode7'                                    07440099
080600         WHEN 'REFERENCECODE7'                                    07440099
080700           MOVE XML-TEXT(1:XML-LENGTH) TO                         07450099
080800                                       WST00000-REF-CODE-ID-7     07460099
080900         WHEN 'Reference7'                                        07470099
080900         WHEN 'REFERENCE7'                                        07470099
081000           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-7    07480099
081100                                                                  07490099
081200         WHEN 'ReferenceCode8'                                    07500099
081200         WHEN 'REFERENCECODE8'                                    07500099
081300           MOVE XML-TEXT(1:XML-LENGTH) TO                         07510099
081400                                       WST00000-REF-CODE-ID-8     07520099
081500         WHEN 'Reference8'                                        07530099
081500         WHEN 'REFERENCE8'                                        07530099
081600           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-8    07540099
081700                                                                  07550099
081800         WHEN 'ReferenceCode9'                                    07560099
081800         WHEN 'REFERENCECODE9'                                    07560099
081900           MOVE XML-TEXT(1:XML-LENGTH) TO                         07570099
082000                                       WST00000-REF-CODE-ID-9     07580099
082100         WHEN 'Reference9'                                        07590099
082100         WHEN 'REFERENCE9'                                        07590099
082200           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-9    07600099
082300                                                                  07610099
082400         WHEN 'ReferenceCode10'                                   07620099
082400         WHEN 'REFERENCECODE10'                                   07620099
082500           MOVE XML-TEXT(1:XML-LENGTH) TO                         07630099
082600                                       WST00000-REF-CODE-ID-10    07640099
082700         WHEN 'Reference10'                                       07650099
082700         WHEN 'REFERENCE10'                                       07650099
082800           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-REF-FIELD-10   07660099
082900                                                                  07670099
083000         WHEN 'DateCreated'                                       07680099
083000         WHEN 'DATECREATED'                                       07680099
083100           INITIALIZE PV-WMOS-DATE-CREATED                        07690099
083200           MOVE XML-TEXT(1:XML-LENGTH) TO PV-WMOS-DATE-CREATED    07700099
083300           STRING PV-WMOS-DATE-CREATED (1:10) '-'                 07710099
083400                  PV-WMOS-DATE-CREATED (12:2) '.'                 07720099
083500                  PV-WMOS-DATE-CREATED (15:2) '.'                 07730099
083600                  PV-WMOS-DATE-CREATED (18:2) '.' '000000'        07740099
083700           DELIMITED BY SIZE INTO WST00000-CREATE-DATE-TIME       07750099
083800                                                                  07760099
083900         WHEN 'ModifyDateTime'                                    07770099
083900         WHEN 'MODIFYDATETIME'                                    07770099
084000           INITIALIZE PV-WMOS-DATE-CREATED                        07780099
084100           MOVE XML-TEXT(1:XML-LENGTH) TO PV-WMOS-DATE-CREATED    07790099
084200           STRING PV-WMOS-DATE-CREATED (1:10) '-'                 07800099
084300                  PV-WMOS-DATE-CREATED (12:2) '.'                 07810099
084400                  PV-WMOS-DATE-CREATED (15:2) '.'                 07820099
084500                  PV-WMOS-DATE-CREATED (18:2) '.' '000000'        07830099
084600           DELIMITED BY SIZE INTO WST00000-MOD-DATE-TIME          07840099
084700                                                                  07850099
084800         WHEN 'As400UserID'                                       07860099
084800         WHEN 'AS400USERID'                                       07860099
084900           MOVE XML-TEXT(1:XML-LENGTH) TO WST00000-USER-ID        07870099
085000                                                                  07880099
085100           WHEN OTHER                                             07890099
085200             CONTINUE                                             07900099
085300         END-EVALUATE                                             07910099
085400                                                                  07920099
085500       WHEN 'EXCEPTION'                                           07930099
085600         DISPLAY 'Exception Caught at ' XML-TEXT(1:XML-LENGTH)    07940099
085700         INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                   07950099
085800         MOVE 'D'                TO WS027-ERROR-TYPE-CDE          07960099
085900         MOVE 'WSRD032 '         TO WS027-ERROR-COPYBOOK          07970099
086000         MOVE PC-PGM-NAME        TO WS027-ERROR-PGM-NAME          07980099
086100         MOVE '2100-'            TO WS027-ERROR-PARA-NBR          07990099
086200         MOVE SQLCODE            TO WS027-SQLCODE                 08000099
086300         MOVE 'HANDLE XML EXCEPTION  '                            08010099
086400                                 TO WS027-ERROR-DESC-TXT          08020099
086500         PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                     08030099
086600     END-EVALUATE.                                                08040099
086700                                                                  08050099
086800******************************************************************08060099
086900* INSERT TO WST_PIX_TRAN_HIST                                     08070099
087000******************************************************************08080099
087100 2500-INSERT-PIX-TBL.                                             08090099
087200*    DISPLAY '2500-INSERT-PIX-TBL.           '.                   08100099
087300                                                                  08110099
087400     EXEC SQL                                                     08120099
087500       INSERT INTO WST_PIX_TRAN_HIST                              08130099
087600             (TRAN_TYPE                                           08140099
087700             ,TRAN_CODE                                           08150099
087800             ,TRAN_NBR                                            08160099
087900             ,PIX_SEQ_NBR                                         08170099
088000             ,PROC_STAT_CODE                                      08180099
088100             ,WHSE                                                08190099
088200             ,CO                                                  08200099
088300             ,DIV                                                 08210099
088400             ,CASE_NBR                                            08220099
088500             ,SKU_ID                                              08230099
088600             ,SEASON                                              08240099
088700             ,SEASON_YR                                           08250099
088800             ,STYLE                                               08260099
088900             ,STYLE_SFX                                           08270099
089000             ,COLOR                                               08280099
089100             ,COLOR_SFX                                           08290099
089200             ,SEC_DIM                                             08300099
089300             ,QUAL                                                08310099
089400             ,SIZE_DESC                                           08320099
089500             ,SIZE_RANGE_CODE                                     08330099
089600             ,SIZE_POSN_IN_TBL                                    08340099
089700             ,INVN_TYPE                                           08350099
089800             ,PROD_STAT                                           08360099
089900             ,BATCH_NBR                                           08370099
090000             ,SKU_ATTR_1                                          08380099
090100             ,SKU_ATTR_2                                          08390099
090200             ,SKU_ATTR_3                                          08400099
090300             ,SKU_ATTR_4                                          08410099
090400             ,SKU_ATTR_5                                          08420099
090500             ,CNTRY_OF_ORGN                                       08430099
090600             ,INVN_ADJMT_QTY                                      08440099
090700             ,INVN_ADJMT_TYPE                                     08450099
090800             ,WT_ADJMT_QTY                                        08460099
090900             ,WT_ADJMT_TYPE                                       08470099
091000             ,UOM                                                 08480099
091100             ,REF_WHSE                                            08490099
091200             ,RSN_CODE                                            08500099
091300             ,RCPT_VARI                                           08510099
091400             ,RCPT_CMPL                                           08520099
091500             ,CASES_SHPD                                          08530099
091600             ,UNITS_SHPD                                          08540099
091700             ,CASES_RCVD                                          08550099
091800             ,UNITS_RCVD                                          08560099
091900             ,ACTN_CODE                                           08570099
092000             ,CUSTOM_REF                                          08580099
092100             ,DATE_PROC                                           08590099
092200             ,SYS_USER_ID                                         08600099
092300             ,ERROR_CMNT                                          08610099
092400             ,REF_CODE_ID_1                                       08620099
092500             ,REF_FIELD_1                                         08630099
092600             ,REF_CODE_ID_2                                       08640099
092700             ,REF_FIELD_2                                         08650099
092800             ,REF_CODE_ID_3                                       08660099
092900             ,REF_FIELD_3                                         08670099
093000             ,REF_CODE_ID_4                                       08680099
093100             ,REF_FIELD_4                                         08690099
093200             ,REF_CODE_ID_5                                       08700099
093300             ,REF_FIELD_5                                         08710099
093400             ,REF_CODE_ID_6                                       08720099
093500             ,REF_FIELD_6                                         08730099
093600             ,REF_CODE_ID_7                                       08740099
093700             ,REF_FIELD_7                                         08750099
093800             ,REF_CODE_ID_8                                       08760099
093900             ,REF_FIELD_8                                         08770099
094000             ,REF_CODE_ID_9                                       08780099
094100             ,REF_FIELD_9                                         08790099
094200             ,REF_CODE_ID_10                                      08800099
094300             ,REF_FIELD_10                                        08810099
094400             ,XML_GROUP_ID                                        08820099
094500             ,CREATE_DATE_TIME                                    08830099
094600             ,MOD_DATE_TIME                                       08840099
094700             ,USER_ID                                             08850099
094800             ,K_DC_NBR                                            08860099
094900             ,K_ISRT_TMST                                         08870099
095000             )                                                    08880099
095100       VALUES                                                     08890099
095200             (:WST00000-TRAN-TYPE                                 08900099
095300             ,:WST00000-TRAN-CODE                                 08910099
095400             ,:WST00000-TRAN-NBR                                  08920099
095500             ,:WST00000-PIX-SEQ-NBR                               08930099
095600             ,:WST00000-PROC-STAT-CODE                            08940099
095700             ,:WST00000-WHSE                                      08950099
095800             ,:WST00000-CO                                        08960099
095900             ,:WST00000-DIV                                       08970099
096000             ,:WST00000-CASE-NBR                                  08980099
096100             ,:WST00000-SKU-ID                                    08990099
096200             ,:WST00000-SEASON                                    09000099
096300             ,:WST00000-SEASON-YR                                 09010099
096400             ,:WST00000-STYLE                                     09020099
096500             ,:WST00000-STYLE-SFX                                 09030099
096600             ,:WST00000-COLOR                                     09040099
096700             ,:WST00000-COLOR-SFX                                 09050099
096800             ,:WST00000-SEC-DIM                                   09060099
096900             ,:WST00000-QUAL                                      09070099
097000             ,:WST00000-SIZE-DESC                                 09080099
097100             ,:WST00000-SIZE-RANGE-CODE                           09090099
097200             ,:WST00000-SIZE-POSN-IN-TBL                          09100099
097300             ,:WST00000-INVN-TYPE                                 09110099
097400             ,:WST00000-PROD-STAT                                 09120099
097500             ,:WST00000-BATCH-NBR                                 09130099
097600             ,:WST00000-SKU-ATTR-1                                09140099
097700             ,:WST00000-SKU-ATTR-2                                09150099
097800             ,:WST00000-SKU-ATTR-3                                09160099
097900             ,:WST00000-SKU-ATTR-4                                09170099
098000             ,:WST00000-SKU-ATTR-5                                09180099
098100             ,:WST00000-CNTRY-OF-ORGN                             09190099
098200             ,:WST00000-INVN-ADJMT-QTY                            09200099
098300             ,:WST00000-INVN-ADJMT-TYPE                           09210099
098400             ,:WST00000-WT-ADJMT-QTY                              09220099
098500             ,:WST00000-WT-ADJMT-TYPE                             09230099
098600             ,:WST00000-UOM                                       09240099
098700             ,:WST00000-REF-WHSE                                  09250099
098800             ,:WST00000-RSN-CODE                                  09260099
098900             ,:WST00000-RCPT-VARI                                 09270099
099000             ,:WST00000-RCPT-CMPL                                 09280099
099100             ,:WST00000-CASES-SHPD                                09290099
099200             ,:WST00000-UNITS-SHPD                                09300099
099300             ,:WST00000-CASES-RCVD                                09310099
099400             ,:WST00000-UNITS-RCVD                                09320099
099500             ,:WST00000-ACTN-CODE                                 09330099
099600             ,:WST00000-CUSTOM-REF                                09340099
099700             ,:WST00000-DATE-PROC                                 09350099
099800             ,:WST00000-SYS-USER-ID                               09360099
099900             ,:WST00000-ERROR-CMNT                                09370099
100000             ,:WST00000-REF-CODE-ID-1                             09380099
100100             ,:WST00000-REF-FIELD-1                               09390099
100200             ,:WST00000-REF-CODE-ID-2                             09400099
100300             ,:WST00000-REF-FIELD-2                               09410099
100400             ,:WST00000-REF-CODE-ID-3                             09420099
100500             ,:WST00000-REF-FIELD-3                               09430099
100600             ,:WST00000-REF-CODE-ID-4                             09440099
100700             ,:WST00000-REF-FIELD-4                               09450099
100800             ,:WST00000-REF-CODE-ID-5                             09460099
100900             ,:WST00000-REF-FIELD-5                               09470099
101000             ,:WST00000-REF-CODE-ID-6                             09480099
101100             ,:WST00000-REF-FIELD-6                               09490099
101200             ,:WST00000-REF-CODE-ID-7                             09500099
101300             ,:WST00000-REF-FIELD-7                               09510099
101400             ,:WST00000-REF-CODE-ID-8                             09520099
101500             ,:WST00000-REF-FIELD-8                               09530099
101600             ,:WST00000-REF-CODE-ID-9                             09540099
101700             ,:WST00000-REF-FIELD-9                               09550099
101800             ,:WST00000-REF-CODE-ID-10                            09560099
101900             ,:WST00000-REF-FIELD-10                              09570099
102000             ,:WST00000-XML-GROUP-ID                              09580099
102100             ,:WST00000-CREATE-DATE-TIME                          09590099
102200             ,:WST00000-MOD-DATE-TIME                             09600099
102300             ,:WST00000-USER-ID                                   09610099
102400             ,:WST00000-K-DC-NBR                                  09620099
102500             ,CURRENT TIMESTAMP                                   09630099
102600             )                                                    09640099
102700     END-EXEC                                                     09650099
102800                                                                  09660099
102900     EVALUATE TRUE                                                09670099
103000         WHEN SQLCODE = ZERO                                      09680099
103100              ADD +1                  TO PA-PIX-INS               09690099
103200*gb                                                               09700099
103300         WHEN SQLCODE = -803                                      09710099
103400              ADD +1                  TO PA-PIX-DUP               09720099
103500         WHEN OTHER                                               09730099
103600              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              09740099
103700              MOVE 'C'                TO WS027-ERROR-TYPE-CDE     09750099
103800              MOVE 'WSRD032 '         TO WS027-ERROR-COPYBOOK     09760099
103900              MOVE PC-PGM-NAME        TO WS027-ERROR-PGM-NAME     09770099
104000              MOVE '2500-'            TO WS027-ERROR-PARA-NBR     09780099
104100              MOVE SQLCODE            TO WS027-SQLCODE            09790099
104200              MOVE 'INSERT WST_PIX_TRAN_HIST '                    09800099
104300                                      TO WS027-ERROR-DESC-TXT     09810099
104400              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                09820099
104500              PERFORM 9300-EOJ                                    09830099
104600              MOVE '3000-INSERT-TABLE' TO PV-PARAGRAPH            09840099
104700              MOVE 'WST_PIX_TRAN_HIST' TO PV-TABLE-NAME           09850099
104800              PERFORM 6600-ROLLBACK-DB2                                   
104900              PERFORM 9500-ABEND                                  09860099
105000     END-EVALUATE.                                                09870099
105100                                                                  09880099
105200******************************************************************09890099
105300* XML ERROR                                                       09900099
105400******************************************************************09910099
105500 3000-XML-ERROR.                                                  09920099
105600*    DISPLAY 'WSKUP020 - 3000-XML-ERROR.               '.         09930099
105700                                                                  09940099
105800     PERFORM 9000-EXPLAIN-XML-RESPONSE                            09950099
105900     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    09960099
106000                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           09970099
106100         DISPLAY XML-MSG(XML-LINE-IDX)                            09980099
106200     END-PERFORM.                                                 09990099
106300     INITIALIZE WS027-RECEIPT-PIX-ERROR-REC.                      10000099
106400     MOVE 'D'                TO WS027-ERROR-TYPE-CDE.             10010099
106500     MOVE 'WSRD032 '         TO WS027-ERROR-COPYBOOK.             10020099
106600     MOVE PC-PGM-NAME        TO WS027-ERROR-PGM-NAME.             10030099
106700     MOVE '3000-'            TO WS027-ERROR-PARA-NBR.             10040099
106800     MOVE SQLCODE            TO WS027-SQLCODE.                    10050099
106900     MOVE 'XML ERROR             '                                10060099
107000                             TO WS027-ERROR-DESC-TXT.             10070099
107100     PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT.                        10080099
107200                                                                  10090099
107300     MOVE +4018              TO PV-ABEND-CODE.                    10100099
107400     MOVE '3000-XML-ERROR'   TO PV-PARAGRAPH.                     10110099
107500     PERFORM 9500-ABEND.                                          10120099
107600                                                                  10130099
107700******************************************************************10140099
107800* SUCCESSFUL XML PARSE                                            10150099
107900******************************************************************10160099
108000 3100-XML-SUCCESS.                                                10170099
108100*    DISPLAY 'WSKUP020 - 3100-XML-SUCCESS.             '.         10180099
108200                                                                  10190099
108300*    DISPLAY " ".                                                 10200099
108400*    DISPLAY "XML DOCUMENT SUCCESSFULLY PARSED".                  10210099
108500                                                                  10220099
108600     ADD +1 TO PA-XML-PARSED.                                     10230099
108700                                                                  10240099
108800***************************************************************** 10250099
108900* MQ SERIES CLOSE QUEUE FOR THE PIX TRANSACTIONS.                 10260099
109000***************************************************************** 10270099
109100 4100-MQ-CLOSE-PIX-QUEUE.                                         10280099
109200*    DISPLAY 'WSKUP020 - 4100-MQ-CLOSE-PIX-QUEUE.      '.         10290099
109300                                                                  10300099
109400     MOVE '4100-MQ-CLOSE-PIX-QUEUE' TO PV-PARAGRAPH.              10310099
109500                                                                  10320099
109600     MOVE PV-QUE-NAME-PIX           TO MQOD-OBJECTNAME.           10330099
109700     MOVE PV-QMGR-NAME-PIX          TO MQOD-OBJECTQMGRNAME.       10340099
109800                                                                  10350099
109900     CALL PC-MQCLOSE USING PV-HCONN                               10360099
110000                           PV-HANDLE-PIX                          10370099
110100                           MQCO-NONE                              10380099
110200                           PV-COMPLETION-CODE                     10390099
110300                           PV-REASON.                             10400099
110400                                                                  10410099
110500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10420099
110600         CONTINUE                                                 10430099
110700     ELSE                                                         10440099
110800         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      10450099
110900           DELIMITED BY SIZE INTO PV-ACTION                       10460099
111000         ADD +1 TO PA-ERRORS-PROCESSED                            10470099
111100         PERFORM 9001-MQSERIES-ERROR                              10480099
111200     END-IF.                                                      10490099
111300                                                                  10500099
111400***************************************************************** 10510099
111500* MQ SERIES CLOSE QUEUE FOR THE ERROR MESSAGE FILE.               10520099
111600***************************************************************** 10530099
111700 4300-MQ-CLOSE-ERROR-QUEUE.                                       10540099
111800*    DISPLAY 'WSKUP020 - 4300-MQ-CLOSE-ERROR-QUEUE.    '.         10550099
111900                                                                  10560099
112000     MOVE '4300-MQ-CLOSE-ERROR-QUEUE' TO PV-PARAGRAPH.            10570099
112100                                                                  10580099
112200     MOVE PV-QUE-NAME-ERROR         TO MQOD-OBJECTNAME.           10590099
112300     MOVE PV-QMGR-NAME-ERROR        TO MQOD-OBJECTQMGRNAME.       10600099
112400                                                                  10610099
112500     CALL PC-MQCLOSE USING PV-HCONN                               10620099
112600                           PV-HANDLE-ERROR                        10630099
112700                           MQCO-NONE                              10640099
112800                           PV-COMPLETION-CODE                     10650099
112900                           PV-REASON.                             10660099
113000                                                                  10670099
113100     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10680099
113200         CONTINUE                                                 10690099
113300     ELSE                                                         10700099
113400         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      10710099
113500           DELIMITED BY SIZE INTO PV-ACTION                       10720099
113600         ADD +1 TO PA-ERRORS-PROCESSED                            10730099
113700         PERFORM 9001-MQSERIES-ERROR                              10740099
113800     END-IF.                                                      10750099
113900                                                                  10760099
114000***************************************************************** 10770099
114100* DISCONNECT FROM QUEUE MANAGER.                                  10780099
114200***************************************************************** 10790099
114300 4500-MQ-DISCONNECT.                                              10800099
114400*    DISPLAY 'WSKUP020 - 4500-MQ-DISCONNECT.           '.         10810099
114500                                                                  10820099
114600     MOVE '4500-MQ-DISCONNECT'    TO PV-PARAGRAPH.                10830099
114700                                                                  10840099
114800     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                10850099
114900         CALL PC-MQDISC USING PV-HCONN                            10860099
115000                              PV-COMPLETION-CODE                  10870099
115100                              PV-REASON                           10880099
115200                                                                  10890099
115300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10900099
115400         CONTINUE                                                 10910099
115500     ELSE                                                         10920099
115600         STRING 'DISCONNECT - ' PV-QMGR-NAME-PIX                  10930099
115700           DELIMITED BY SIZE INTO PV-ACTION                       10940099
115800         ADD +1 TO PA-ERRORS-PROCESSED                            10950099
115900         PERFORM 9001-MQSERIES-ERROR                              10960099
116000     END-IF.                                                      10970099
116100                                                                  10980099
116200 6500-COMMIT.                                                             
116300                                                                          
116400     EXEC SQL                                                             
116500         COMMIT                                                           
116600     END-EXEC.                                                            
116700                                                                          
116800     EVALUATE TRUE                                                        
116900         WHEN SQLCODE EQUAL ZERO                                          
117000             ADD +1 TO PA-TOTAL-DB2-COMMITS                               
117100         WHEN SQLWARN0 NOT EQUAL SPACE                                    
117200         WHEN SQLCODE NOT EQUAL ZERO                                      
117300             INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                       
117400             MOVE 'C'             TO WS027-ERROR-TYPE-CDE                 
117500             MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME                     
117600             MOVE 'WSRD022' TO WS027-ERROR-COPYBOOK                       
117700             MOVE '6500-'         TO WS027-ERROR-PARA-NBR                 
117800             MOVE 'COMMIT CE-ADJ-WORK FAILED'                             
117900                                  TO WS027-ERROR-DESC-TXT                 
118000             MOVE SQLCODE         TO WS027-SQLCODE                        
118100             PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                         
118200     END-EVALUATE.                                                        
118300                                                                          
118400 6600-ROLLBACK-DB2.                                                       
118500                                                                          
118600     EXEC SQL                                                             
118700         ROLLBACK                                                         
118800     END-EXEC.                                                            
118900                                                                          
119000     EVALUATE TRUE                                                        
119100         WHEN SQLCODE EQUAL ZERO                                          
119200             ADD +1 TO PA-TOTAL-DB2-ROLLBACKS                             
119300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
119400         WHEN SQLCODE NOT EQUAL ZERO                                      
119500             INITIALIZE WS027-RECEIPT-PIX-ERROR-REC               11639599
119600             SET WS027-SQL-ERROR      TO TRUE                     11640099
119700             MOVE 'WSRD032 '          TO WS027-ERROR-COPYBOOK     11640199
119800             MOVE PC-PGM-NAME         TO WS027-ERROR-PGM-NAME     11640299
119900             MOVE '6600-ROLLBACK-DB2' TO WS027-ERROR-PARA-NBR     11640399
120000             MOVE SQLCODE             TO WS027-SQLCODE            11640499
120100             MOVE 'ROLLBACK FAILURE'  TO WS027-ERROR-DESC-TXT     11640899
120200             PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                 11020099
120300     END-EVALUATE.                                                        
120400                                                                          
120500***************************************************************** 10990099
120600* WRITE OUTGOING ERROR MQ MESSAGE.                                11000099
120700***************************************************************** 11010099
120800 8000-WRITE-MQ-ERROR-MESG-OUT.                                    11020099
120900*    DISPLAY 'WSKUP020 - 8000-WRITE-MQ-ERROR-MESG-OUT. '.         11030099
121000*    DISPLAY " ".                                                 11040099
121100*    DISPLAY "PROCESSING XML FOR ERROR...".                       11050099
121200                                                                  11060099
121300     INITIALIZE PV-ERRMSGBUFFER.                                  11070099
121400                                                                  11080099
121500     MOVE MQMI-NONE            TO MQMD-MSGID.                     11090099
121600     MOVE MQCI-NONE            TO MQMD-CORRELID.                  11100099
121700                                                                  11110099
121800     MOVE DCLWST00000                 TO WS027-FORMAT-RECORD.     11120099
121900     MOVE LENGTH OF WS027-RECEIPT-PIX-ERROR-REC                   11130099
122000                                      TO PV-MSG-LENGTH.           11140099
122100     MOVE WS027-RECEIPT-PIX-ERROR-REC TO PV-ERRMSGBUFFER.         11150099
122200                                                                  11160099
122300     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        11170099
122400     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   11180099
122500     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  11190099
122600                               MQPMO-SET-IDENTITY-CONTEXT.        11200099
122700                                                                  11210099
122800     CALL PC-MQPUT USING PV-HCONN                                 11220099
122900                         PV-HANDLE-ERROR                          11230099
123000                         MQM-MESSAGE-DESCRIPTOR                   11240099
123100                         MQM-PUT-MESSAGE-OPTIONS                  11250099
123200                         PV-MSG-LENGTH                            11260099
123300                         PV-ERRMSGBUFFER(1:PV-MSG-LENGTH)         11270099
123400                         PV-COMPLETION-CODE                       11280099
123500                         PV-REASON.                               11290099
123600                                                                  11300099
123700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        11310099
123800         DISPLAY 'MQ MESSAGE = ', PV-ERRMSGBUFFER                 11320099
123900         MOVE '8000-PUT-MQ-MESG-ON-QUEUE' TO PV-PARAGRAPH         11330099
124000         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         11340099
124100         ADD +1 TO PA-ERRORS-PROCESSED                            11350099
124200         PERFORM 9001-MQSERIES-ERROR                              11360099
124300     ELSE                                                         11370099
124400         ADD 1 TO PA-MQ-ERROR-MSGS-SENT                           11380099
124500         PERFORM 8500-MQ-COMMIT                                   11390099
124600     END-IF.                                                      11400099
124700                                                                  11410099
124800******************************************************************11420099
124900*  COMMIT MQ PROCESSING                                           11430099
125000******************************************************************11440099
125100 8500-MQ-COMMIT.                                                  11450099
125200*    DISPLAY '8500-MQ-COMMIT.   '                                 11460099
125300                                                                  11470099
125400     CALL PC-MQCMIT USING PV-HCONN                                11480099
125500                          PV-COMPLETION-CODE                      11490099
125600                          PV-REASON.                              11500099
125700                                                                  11510099
125800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        11520099
125900        MOVE '8500-COMMIT-MQ'   TO PV-PARAGRAPH                   11530099
126000        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               11540099
126100        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        11550099
126200        MOVE PV-REASON          TO PV-HOLD-REASON                 11560099
126300        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        11570099
126400        MOVE PV-HOLD-REASON     TO PV-REASON                      11580099
126500        PERFORM 9001-MQSERIES-ERROR                               11590099
126600     ELSE                                                         11600099
126700        ADD 1 TO PA-MQ-COMMITS                                    11610099
126800     END-IF.                                                      11620099
126900                                                                  11630099
127000 8900-NUMERIC-EDIT.                                               11631099
127100                                                                          
127200     PERFORM 8901-STRIP-AWAY-DECIMALS                                     
127300                                                                          
127400     MOVE +15                        TO DP010I-MAXIMUM-DIGITS.    11635099
127500     MOVE 2                          TO DP010I-MAXIMUM-DECIMALS.  11636099
127600*    SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     11637099
127700     CALL DP010I-NUMERIC-EDIT-ROUTINE                             11638099
127800         USING DP010I-NUMERIC-EDIT-AREA.                          11639099
127900                                                                  11639199
128000     IF DP010I-NO-ERROR-DETECTED                                  11639299
128100         CONTINUE                                                 11639399
128200     ELSE                                                         11639499
128300                                                                  08050099
128400         INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                   11639599
128500         SET WS027-INVALID-REC        TO TRUE                     11640099
128600         MOVE 'WSRD032 '              TO WS027-ERROR-COPYBOOK     11640199
128700         MOVE PC-PGM-NAME             TO WS027-ERROR-PGM-NAME     11640299
128800         MOVE PV-PARAGRAPH            TO WS027-ERROR-PARA-NBR     11640399
128900         MOVE SQLCODE                 TO WS027-SQLCODE            11640499
129000         MOVE 'INVALID NUMERIC QTY'   TO WS027-ERROR-DESC-TXT     11640899
129100         PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                     11020099
129200     END-IF.                                                      11641199
129300                                                                          
129400 8901-STRIP-AWAY-DECIMALS.                                                
129500     INITIALIZE PT-EDIT-TABLE                                             
129600                PT-POINT-SUB                                              
129700     MOVE DP010I-UNEDITED-FIELD       TO PT-EDIT-TABLE            06620099
129800     PERFORM VARYING PT-SUB FROM 1 BY 1 UNTIL PT-SUB > 21                 
129900         IF PT-UNEDITED-BYTE(PT-SUB) = '.'                                
130000             MOVE PT-SUB              TO PT-POINT-SUB                     
130100         END-IF                                                           
130200         IF PT-POINT-SUB > ZERO                                           
130300             IF PT-SUB > PT-POINT-SUB + 2                                 
130400                 MOVE SPACES          TO PT-UNEDITED-BYTE(PT-SUB)         
130500             END-IF                                                       
130600         END-IF                                                           
130700     END-PERFORM.                                                         
130800     MOVE PT-EDIT-TABLE               TO DP010I-UNEDITED-FIELD.           
130900*                                                                 11641299
131000***************************************************************** 11642099
131100* EOJ AND DISPLAY SUMMARY TOTALS.                                 11650099
131200***************************************************************** 11660099
131300 9300-EOJ.                                                        11670099
131400*    DISPLAY 'WSKUP020 - 9300-EOJ.                  '.            11680099
131500                                                                  11690099
131600     PERFORM 4100-MQ-CLOSE-PIX-QUEUE.                             11700099
131700     PERFORM 4300-MQ-CLOSE-ERROR-QUEUE.                           11710099
131800     PERFORM 4500-MQ-DISCONNECT.                                  11720099
131900                                                                  11730099
132000     DISPLAY SPACES.                                              11740099
132100     DISPLAY '        WSKUP020 SUMMARY STATISTICS             '   11750099
132200     DISPLAY '************************************************'.  11760099
132300     DISPLAY SPACES                                                       
132400     MOVE PA-MQ-PIX-MSGS-READ         TO PV-DISPLAY-NBR           00670099
132500     DISPLAY ' MQ PIX MESSAGES READ   = ' PV-DISPLAY-NBR          11770099
132600                                                                          
132700     MOVE PA-XML-PARSED               TO PV-DISPLAY-NBR           00670099
132800     DISPLAY ' MQ PIX MESSAGES PARSED = ' PV-DISPLAY-NBR          11780099
132900                                                                          
133000     MOVE PA-PIX-INS                  TO PV-DISPLAY-NBR           00670099
133100     DISPLAY ' PIX ROWS INSERTED      = ' PV-DISPLAY-NBR          11790099
133200*gb                                                               11800099
133300     MOVE PA-PIX-DUP                  TO PV-DISPLAY-NBR           00670099
133400     DISPLAY ' DUPLICATE PIX RECVD    = ' PV-DISPLAY-NBR          11810099
133500     DISPLAY SPACES                                               11820099
133600                                                                          
133700     MOVE PA-MQ-ERROR-MSGS-SENT       TO PV-DISPLAY-NBR           00670099
133800     DISPLAY ' MQ ERROR MESSAGES SENT = ' PV-DISPLAY-NBR          11830099
133900                                                                          
134000     MOVE PA-ERRORS-PROCESSED         TO PV-DISPLAY-NBR           00670099
134100     DISPLAY ' ERRORS PROCESSED       = ' PV-DISPLAY-NBR          11840099
134200                                                                          
134300     MOVE PA-MQ-COMMITS               TO PV-DISPLAY-NBR           00670099
134400     DISPLAY ' MQ COMMITS             = ' PV-DISPLAY-NBR          11850099
134500                                                                          
134600     DISPLAY SPACES.                                              11870099
134700     DISPLAY '************************************************'.  11860099
134800     DISPLAY SPACES.                                              11870099
134900                                                                  11880099
135000***************************************************************** 11890099
135100* ABEND PROGRAM - CALL ABEND MODULE                               11900099
135200***************************************************************** 11910099
135300 9500-ABEND.                                                      11920099
135400     DISPLAY 'WSKUP020 - 9500-ABEND.                   '.         11930099
135500                                                                  11940099
135600     MOVE SQLCODE               TO PV-SQLCODE.                    11950099
135700     DISPLAY ' '.                                                 11960099
135800     DISPLAY '** ABEND INFO  '.                                   11970099
135900     DISPLAY ' '.                                                 11980099
136000     DISPLAY '** PROGRAM       = ' PC-PGM-NAME.                   11990099
136100     DISPLAY '** PARAGRAPH     = ' PV-PARAGRAPH.                  12000099
136200     DISPLAY '** TABLE         = ' PV-TABLE-NAME.                 12010099
136300     DISPLAY ' '.                                                 12020099
136400     DISPLAY '** SQLCODE       = ' PV-SQLCODE.                    12030099
136500     DISPLAY '** SQLWARN       = ' SQLWARN                        12040099
136600     DISPLAY '** SQLEXT        = ' SQLEXT                         12050099
136700     DISPLAY ' '.                                                 12060099
136800                                                                  12070099
136900     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        12080099
137000                                                                  12090099
137100     COPY ISPD002.                                                12100099
137200     COPY ISPD007.                                                12110099
137300     COPY ISPD008.                                                12120099
137400     COPY ISPD009.                                                12130099
