000100 IDENTIFICATION DIVISION.                                         00010009
000200 PROGRAM-ID.    PCKCS159.                                         00020009
000300 AUTHOR.        DAN HINTZ.                                        00030009
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040009
000500 DATE-WRITTEN.  01-28-93.                                         00050009
000600 DATE-COMPILED.                                                   00060009
000700                                                                  00070009
000800*---------------------------------------------------------------* 00080009
000900*    E159 - WORK ORDER UPDATE.                                  * 00090009
001000*                                                               * 00100009
001100*    THIS PROGRAM WILL ALLOW THE UPDATE OF THE WORK ORDERS. IT  * 00110009
001200*    IS INVOKED FROM A LIST SCREEN WHERE THE WORK ORDERS TO BE  * 00120009
001300*    UPDATED ARE SELECTED.                                      * 00130009
001400*                                                               * 00140009
001500*---------------------------------------------------------------* 00150009
001510* DATE  11/04/2021                                                00151019
001520*            - CHANGE CALL OF 'DPKUT100' TO                     * 00152019
001530*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00153019
001540*              MAKING THE CALL DYNAMIC VS STATIC                * 00154019
001550*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00155020
1122RM*---------------------------------------------------------------- 00155121
1122RM* DATE  11/07/2022                                              * 00155221
1122RM*            - ADD COPYBOOK DPWS930                             * 00155321
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00155421
1122RM*              DYNAMIC.                                         * 00155521
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00155621
001560*-----------------------------------------------------------------00156019
001600/                                                                 00160009
001700 ENVIRONMENT DIVISION.                                            00170009
001800                                                                  00180009
001900 DATA DIVISION.                                                   00190009
002000                                                                  00200009
002100 WORKING-STORAGE SECTION.                                         00210009
002200                                                                  00220009
002300 01  DK-DB2-KEYS.                                                 00230009
002400*    REQUIRED FIELDS                                              00240009
002500     05  DK-OPERATING-UNIT-ID           PIC S9(04)  COMP.         00250009
002600     05  DK-FACILITY-ID                 PIC S9(04)  COMP.         00260009
002700     05  DK-ORD-NBR                     PIC S9(09)  COMP.         00270009
002800     05  DK-RCVR-SEQ-NBR                PIC S9(09)  COMP.         00280009
002900     05  DK-LINE-NBR                    PIC S9(04)  COMP.         00290009
003000*    OPTIONAL FIELDS                                              00300009
003100     05  DK-STAT-CDE-LOW                PIC  X(02).               00310009
003200     05  DK-STAT-CDE-HIGH               PIC  X(02).               00320009
003300     05  DK-STAT-CDE                    PIC  X(02).               00330009
003400     05  DK-WORK-ORD-SEQ-NBR-LOW        PIC S9(04)  COMP.         00340009
003500     05  DK-WORK-ORD-SEQ-NBR-HIGH       PIC S9(04)  COMP.         00350009
003600     05  DK-WORK-ORD-SEQ-NBR            PIC S9(04)  COMP.         00360009
003700                                                                  00370009
003800 01  PC-PROGRAM-CONSTANTS.                                        00380009
003900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00390009
004000                                                    'PC159A  '.   00400009
004100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00410009
004200                                                    'PCKM159 '.   00420009
004300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00430009
004400                                                    'PCKCS159'.   00440009
004500     05  PC-AUDIT-RTN                   PIC  X(08)  VALUE         00450009
004600                                                    'RCKCS290'.   00460009
004700     05  PC-AUDIT-RTN-LENGTH            PIC S9(04)  VALUE  +300   00470009
004800                                                    COMP SYNC.    00480009
004900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00490009
005000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00500009
005100     05  PC-INTER-APPL-CODES.                                     00510009
005200         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.    00520009
005300         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '5'.    00530009
005400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +8      00540009
005500                                                    COMP SYNC.    00550009
005600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00560009
005700                                                    COMP SYNC.    00570009
005800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00580009
005900                                                    +1000000      00590009
006000                                                    COMP-3.       00600009
006100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00610009
006200                                                    COMP SYNC.    00620009
006300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00630009
006400                                                    COMP-3.       00640009
006500     05  PC-5                           PIC  9(01)  VALUE 5.      00650009
006600     05  PC-A                           PIC  X(01)  VALUE 'A'.    00660009
006700     05  PC-DUMMY-TMST                  PIC  X(26)  VALUE         00670009
006800         '9998-09-09-09.09.09.999999'.                            00680009
006900                                                                  00690009
007000     05  PC-TSYMSG-NUMBERS.                                       00700009
007100         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00710009
007200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00720009
007300         10  PC-TSYMSG-00046            PIC  9(05)  VALUE 00046.  00730009
007400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00740009
007500         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00750009
007600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00760009
007700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00770009
007800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00780009
007900         10  PC-TSYMSG-00170            PIC  9(05)  VALUE 00170.  00790009
008000         10  PC-TSYMSG-00254            PIC  9(05)  VALUE 00254.  00800009
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00810009
008200                                                                  00820009
008300 01  PS-PROGRAM-SWITCHES.                                         00830009
008400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00840009
008500         88  PS-NO-ERROR                            VALUE 'Y'.    00850009
008600         88  PS-ERROR                               VALUE 'N'.    00860009
008700     05  PS-VALID-UPDATE-STAT-CDE-SW    PIC  X(01)  VALUE 'N'.    00870009
008800         88  PS-VALID-UPDATE-STAT-CDE               VALUE 'Y'.    00880009
008900         88  PS-NOT-VALID-UPDATE-STAT-CDE           VALUE 'N'.    00890009
009000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00900009
009100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00910009
009200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00920009
009300     05  PS-UPDATE-SW                   PIC  X(01)  VALUE 'N'.    00930009
009400         88  PS-UPDATED                             VALUE 'Y'.    00940009
009500         88  PS-NOT-UPDATED                         VALUE 'N'.    00950009
009600     05  PS-WRKORD-ROW-FOUND-SW         PIC  X(01)  VALUE 'N'.    00960009
009700         88  PS-WRKORD-ROW-FOUND                    VALUE 'Y'.    00970009
009800         88  PS-WRKORD-ROW-NOT-FOUND                VALUE 'N'.    00980009
009900     05  PS-WKORIN-SW                   PIC  X(01)  VALUE 'N'.    00990009
010000         88  PS-END-OF-TWKORIN                      VALUE 'Y'.    01000009
010100         88  PS-NOT-END-OF-TWKORIN                  VALUE 'N'.    01010009
010200     05  PS-END-OF-SEL-ITEMS-QUEUE-SW   PIC  X(01)  VALUE 'N'.    01020009
010300         88  PS-END-OF-SEL-ITEMS-QUEUE              VALUE 'Y'.    01030009
010400         88  PS-NOT-END-OF-SEL-ITEMS-QUEUE          VALUE 'N'.    01040009
010500                                                                  01050009
010600 01  PV-PROGRAM-VARIABLES.                                        01060009
010700     05  PV-SUB                         PIC S9(04)  VALUE +0      01070009
010800                                                    COMP SYNC.    01080009
010900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01090009
011000                                                    COMP SYNC.    01100009
011100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01110009
011200                                                    COMP-3.       01120009
011300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01130009
011400                                                    COMP-3.       01140009
011500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01150009
011600                                                    COMP-3.       01160009
011700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01170009
011800                                                    COMP-3.       01180009
011900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01190009
012000                                                    COMP SYNC.    01200009
012100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01210009
012200                                                    COMP SYNC.    01220009
012300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01230009
012400                                                    COMP SYNC.    01240009
012500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01250009
012600                                                    COMP SYNC.    01260009
012700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01270009
012800                                                    COMP SYNC.    01280009
012900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01290009
013000                                                    COMP SYNC.    01300009
013100     05  PV-TOT-ACTL-CART-CNT           PIC S9(07)  VALUE +0      01310009
013200                                                    COMP-3.       01320009
013300     05  PV-TOT-ACTL-ITM-CNT            PIC S9(07)  VALUE +0      01330009
013400                                                    COMP-3.       01340009
013500     05  PV-STAT-CDE                    PIC  X(02)  VALUE SPACES. 01350009
013600         88  PV-VALID-UPDATE-STAT-CDE               VALUE 'IP'.   01360009
013610     05  PV-DISPLAY-SKU-NBR             PIC  X(08).               01361014
013700                                                                  01370009
013800*---------------------------------------------------------------* 01380009
013900*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01390009
014000*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01400009
014100*   APPLICATION-SPECIFIC COMMAREA.                              * 01410009
014200*---------------------------------------------------------------* 01420009
014300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01430009
014400     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  01440009
014500     05  LQW-ITEM-ENTRIES               OCCURS 8 TIMES            01450009
014600                                        INDEXED BY LQW-IDX.       01460009
014700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01470009
014800         10  LQW-WORK-ORD-SEQ-NBR       PIC 9(3).                 01480009
014900         10  LQW-STAT-CDE               PIC X(2).                 01490009
015000         10  LQW-EXPTED-CART-CNT        PIC 9(5).                 01500009
015100         10  LQW-ACTL-CART-CNT-X.                                 01510009
015200             15  LQW-ACTL-CART-CNT      PIC 9(5).                 01520009
015300         10  LQW-EXPTED-ITM-CNT         PIC 9(5).                 01530009
015400         10  LQW-ACTL-ITM-CNT-X.                                  01540009
015500             15  LQW-ACTL-ITM-CNT       PIC 9(5).                 01550009
015600         10  LQW-ACTL-CART-CNT-SW       PIC X(01).                01560009
015700             88  LQW-ACTL-CART-CNT-CHGD      VALUE 'Y'.           01570009
015800             88  LQW-ACTL-CART-CNT-NOT-CHGD  VALUE 'N'.           01580009
015900         10  LQW-ACTL-ITM-CNT-SW        PIC X(01).                01590009
016000             88  LQW-ACTL-ITM-CNT-CHGD       VALUE 'Y'.           01600009
016100             88  LQW-ACTL-ITM-CNT-NOT-CHGD   VALUE 'N'.           01610009
016200         10  LQW-RECORD-UPDATED-SW      PIC X(01).                01620009
016300             88  LQW-UPDATED                 VALUE 'Y'.           01630009
016400             88  LQW-NOT-UPDATED             VALUE 'N'.           01640009
016500                                                                  01650009
016600/                                                                 01660009
016700*---------------------------------------------------------------* 01670009
016800*  RECORD LAYOUT 'INSERT AUDIT MODULE'  RCKCS290                * 01680009
016900*---------------------------------------------------------------* 01690009
017000                                                                  01700009
017100     COPY RCWS031.                                                01710009
017200                                                                  01720009
017300/                                                                 01730009
017400*---------------------------------------------------------------* 01740009
017500*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01750009
017600*---------------------------------------------------------------* 01760009
017700                                                                  01770009
017800     COPY PCWS016.                                                01780009
017900                                                                  01790009
018000/                                                                 01800009
018100*---------------------------------------------------------------* 01810009
018200*    MAP LAYOUT                                                 * 01820009
018300*---------------------------------------------------------------* 01830009
018400                                                                  01840009
018500     COPY PCKM159.                                                01850009
018600                                                                  01860009
018700 01  MR-OCCURS-LAYOUT                   REDEFINES  PC159AO.       01870009
018800     05  FILLER                         PIC X(213).               01880017
018900                                                                  01890009
019000     05  MR-SCROLL-AREA                 OCCURS 8 TIMES.           01900009
019100         10  FILLER                     PIC X(05).                01910009
019200         10  MR-WORK-ORD-SEQ-NBR-X.                               01920009
019300             15  MR-WORK-ORD-SEQ-NBR    PIC Z(3).                 01930009
019400                                                                  01940009
019500         10  FILLER                     PIC X(05).                01950009
019600         10  MR-WORK-ORD-STAT-CDE       PIC X(02).                01960009
019700                                                                  01970009
019800         10  FILLER                     PIC X(05).                01980009
019900         10  MR-EXPTED-CART-CNT-X.                                01990009
020000             15  MR-EXPTED-CART-CNT     PIC Z(5).                 02000009
020100                                                                  02010009
020200         10  MR-ACTL-CART-CNTL          PIC S9(04) COMP.          02020009
020300         10  MR-ACTL-CART-CNTA          PIC X(01).                02030009
020400         10  MR-ACTL-CART-CNTC          PIC X(01).                02040009
020500         10  MR-ACTL-CART-CNTH          PIC X(01).                02050009
020600         10  MR-ACTL-CART-CNT-X.                                  02060009
020700             15  MR-ACTL-CART-CNT       PIC Z(5).                 02070009
020800                                                                  02080009
020900                                                                  02090009
021000         10  FILLER                     PIC X(05).                02100009
021100         10  MR-EXPTED-ITM-CNT-X.                                 02110009
021200             15  MR-EXPTED-ITM-CNT      PIC Z(5).                 02120009
021300                                                                  02130009
021400         10  MR-ACTL-ITM-CNTL           PIC S9(04) COMP.          02140009
021500         10  MR-ACTL-ITM-CNTA           PIC X(01).                02150009
021600         10  MR-ACTL-ITM-CNTC           PIC X(01).                02160009
021700         10  MR-ACTL-ITM-CNTH           PIC X(01).                02170009
021800         10  MR-ACTL-ITM-CNT-X.                                   02180009
021900             15  MR-ACTL-ITM-CNT        PIC Z(5).                 02190009
022000                                                                  02200009
022100/                                                                 02210009
022200*---------------------------------------------------------------* 02220009
022300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02230009
022400*---------------------------------------------------------------* 02240009
022500                                                                  02250009
022600     COPY DPWS015.                                                02260009
022700                                                                  02270009
022800*---------------------------------------------------------------* 02280009
022900*    FUNCTION KEYS COPYBOOK.                                    * 02290009
023000*---------------------------------------------------------------* 02300009
023100                                                                  02310009
023200     COPY DPWS016.                                                02320009
023300                                                                  02330009
023400*---------------------------------------------------------------* 02340009
023500*    NUMERIC EDIT LAYOUT.                                       * 02350009
023600*---------------------------------------------------------------* 02360009
023700                                                                  02370009
023800     COPY DPWS010I.                                               02380009
023900                                                                  02390009
024000/                                                                 02400009
024100*---------------------------------------------------------------* 02410009
024200*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02420009
024300*---------------------------------------------------------------* 02430009
024400                                                                  02440009
024500     COPY DPWS030.                                                02450009
1122RM     COPY DPWS930.                                                02451021
024600                                                                  02460009
024700/                                                                 02470009
024710*---------------------------------------------------------------* 02471014
024720*    LOGISTICS DOMAIN ITEM ACCESS MODULE.                       * 02472014
024730*---------------------------------------------------------------* 02473014
024740                                                                  02474014
024750     COPY XLWS001.                                                02475014
024760                                                                  02476014
024770/                                                                 02477014
024800*---------------------------------------------------------------* 02480009
024900*    STANDARD COMMAREA.                                         * 02490009
025000*---------------------------------------------------------------* 02500009
025100                                                                  02510009
025200     COPY DPWS020.                                                02520009
025300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02530009
025400                                                                  02540009
025500*---------------------------------------------------------------* 02550009
025600* INTER-APPLICATION COMMAREA.                                   * 02560009
025700*---------------------------------------------------------------* 02570009
025800                                                                  02580009
025900         10  INTER-APPL-COMM-AREA       PIC X(200).               02590009
026000     COPY PCWS000.                                                02600009
026100*---------------------------------------------------------------* 02610009
026200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02620009
026300*---------------------------------------------------------------* 02630009
026400         10  ASC-SPECIFIC-COMMAREA.                               02640009
026500             15  ASC-OPERATING-UNIT-ID      PIC 9(04).            02650009
026600             15  ASC-FACILITY-ID            PIC 9(04).            02660009
026700             15  ASC-LIST-KEYS.                                   02670009
026800                 20  ASC-PO-NBR             PIC 9(08).            02680009
026900                 20  ASC-REC-SEQ-NBR        PIC 9(03).            02690009
027000                 20  ASC-LINE-NBR           PIC 9(04).            02700009
027100             15  ASC-OTHER-TOP-OF-SCREEN-DATA.                    02710009
027200                 20  ASC-TRECITM-DATA.                            02720009
027300                     25  ASC-TRECITM-PKSL-ITM-QTY     PIC 9(5).   02730009
027400                     25  ASC-TRECITM-DTL-CK-ITM-QTY   PIC 9(5).   02740009
027500                     25  ASC-TRECITM-EXPTED-CART-CNT  PIC 9(5).   02750009
027600                     25  ASC-TRECITM-ACTL-CART-CNT    PIC 9(5).   02760009
027700                 20  ASC-TPURITM-DATA.                            02770009
027800*                    25  ASC-TPURITM-SKU.                         02780013
027900                     25  ASC-TPURCHS-DEPT-NBR         PIC X(3).   02790013
028000                     25  ASC-TPURITM-CL-NBR           PIC X(2).   02800013
028010                     25  ASC-NIS-SKU-SEQ-NBR          PIC X(8).   02801013
028100*                    25  ASC-TPURITM-SKU-SEQ-NBR      PIC X(3).   02810013
028200                     25  ASC-TPURITM-SKU-DESC         PIC X(25).  02820009
028300                     25  ASC-TPURITM-VEND-STYL-NAME   PIC X(20).  02830009
028400             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           02840009
028500                 20  ASC-BLOCK-MODIFIED-SW                        02850009
028600                                        PIC X(01).                02860009
028700                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     02870009
028800                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     02880009
028900                                                                  02890009
029000                 20  ASC-ITEM-ARRAY.                              02900009
029100                     25  ASC-ITEM-ENTRIES OCCURS 8 TIMES.         02910009
029200                         30  ASC-LIST-ITEM-NUMBER                 02920009
029300                                        PIC S9(09) COMP-3.        02930009
029400                         30  ASC-WORK-ORD-SEQ-NBR  PIC 9(3).      02940009
029500                         30  ASC-STAT-CDE          PIC X(2).      02950009
029600                         30  ASC-EXPTED-CART-CNT   PIC 9(5).      02960009
029700                         30  ASC-ACTL-CART-CNT-X.                 02970009
029800                             35  ASC-ACTL-CART-CNT PIC 9(5).      02980009
029900                         30  ASC-EXPTED-ITM-CNT    PIC 9(5).      02990009
030000                         30  ASC-ACTL-ITM-CNT-X.                  03000009
030100                             35  ASC-ACTL-ITM-CNT  PIC 9(5).      03010009
030200                         30  ASC-ACTL-CART-CNT-SW  PIC X(01).     03020009
030300                             88  ASC-ACTL-CART-CNT-CHGD           03030009
030400                                                   VALUE 'Y'.     03040009
030500                             88  ASC-ACTL-CART-CNT-NOT-CHGD       03050009
030600                                                   VALUE 'N'.     03060009
030700                         30  ASC-ACTL-ITM-CNT-SW   PIC X(01).     03070009
030800                             88  ASC-ACTL-ITM-CNT-CHGD            03080009
030900                                                   VALUE 'Y'.     03090009
031000                             88  ASC-ACTL-ITM-CNT-NOT-CHGD        03100009
031100                                                   VALUE 'N'.     03110009
031200                         30  ASC-RECORD-UPDATED-SW PIC X(01).     03120009
031300                             88  ASC-UPDATED       VALUE 'Y'.     03130009
031400                             88  ASC-NOT-UPDATED   VALUE 'N'.     03140009
031500                                                                  03150009
031600             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03160009
031700             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03170009
031800             15  ASC-SEL-SUB            PIC S9(04) COMP.          03180009
031900             15  ASC-SEL-ITEM           PIC S9(04) COMP.          03190009
032000             15  ASC-NUMBER-OF-ITEMS-READ                         03200009
032100                                        PIC S9(09) COMP-3.        03210009
032200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03220009
032300                                        PIC S9(09) COMP-3.        03230009
032400             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        03240009
032500             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03250009
032600             15  ASC-ITEM-AT-TOP-OF-PANEL                         03260009
032700                                        PIC S9(09) COMP-3.        03270009
032800             15  ASC-ITEM-AT-BOT-OF-PANEL                         03280009
032900                                        PIC S9(09) COMP-3.        03290009
033000             15  ASC-HIGHEST-BLOCK-WRITTEN                        03300009
033100                                        PIC S9(04) COMP SYNC.     03310009
033200             15  ASC-START-OF-SELECTED-RANGE                      03320009
033300                                        PIC S9(09) COMP-3.        03330009
033400             15  ASC-END-OF-SELECTED-RANGE                        03340009
033500                                        PIC S9(09) COMP-3.        03350009
033600             15  ASC-ITEMS-LEFT-INDICATOR                         03360009
033700                                        PIC X(01).                03370009
033800                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03380009
033900                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03390009
034000             15  ASC-TEMP-QUEUE-UPDATE-SW                         03400009
034100                                        PIC X(01).                03410009
034200                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03420009
034300                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03430009
034400             15  ASC-LIST-QUEUE-NAME.                             03440009
034500                 20  ASC-LIST-TERM-ID   PIC X(04).                03450009
034600                 20  ASC-LIST-TASK-NUMBER                         03460009
034700                                        PIC S9(05) COMP-3.        03470009
034800                 20  ASC-LIST-SEQ       PIC 9(01).                03480009
034900             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               03490009
035000             15  ASC-SEL-QUEUE-NAME-OUT.                          03500009
035100                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               03510009
035200                 20  ASC-SEL-TASK-NUMBER-OUT                      03520009
035300                                         PIC S9(05) COMP-3.       03530009
035400                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               03540009
035500                                                                  03550009
035600             15  ASC-START-ITEM-REQUEST.                          03560009
035700                 20  ASC-START-ITEM-REQUEST-N  PIC 9(07).         03570009
035800             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         03580009
035900                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         03590009
036000/                                                                 03600009
036100*---------------------------------------------------------------* 03610009
036200*    ABEND PROCESSING COPYBOOK.                                 * 03620009
036300*---------------------------------------------------------------* 03630009
036400                                                                  03640009
036500     COPY DPWS013.                                                03650009
036600                                                                  03660009
036700/                                                                 03670009
036800*---------------------------------------------------------------* 03680009
036900*    DB2 AREA FOR THE WORK ORDER TABLE                          * 03690009
037000*---------------------------------------------------------------* 03700009
037100     EXEC SQL                                                     03710009
037200          INCLUDE TWRKORD                                         03720009
037300     END-EXEC.                                                    03730009
037400                                                                  03740009
037500/                                                                 03750009
037600*---------------------------------------------------------------* 03760009
037700*    DB2 AREA FOR THE WORK ORDER INSTRUCTIONS TABLE             * 03770009
037800*---------------------------------------------------------------* 03780009
037900     EXEC SQL                                                     03790009
038000          INCLUDE TWKORIN                                         03800009
038100     END-EXEC.                                                    03810009
038200                                                                  03820009
038300/                                                                 03830009
038400*---------------------------------------------------------------* 03840009
038500*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 03850009
038600*---------------------------------------------------------------* 03860009
038700     EXEC SQL                                                     03870009
038800          INCLUDE TPURCHS                                         03880009
038900     END-EXEC.                                                    03890009
039000                                                                  03900009
039100/                                                                 03910009
039200*---------------------------------------------------------------* 03920009
039300*    DB2 AREA FOR THE PURCHASE ORDER ITEM TABLE                 * 03930009
039400*---------------------------------------------------------------* 03940009
039500     EXEC SQL                                                     03950009
039600          INCLUDE TPURITM                                         03960009
039700     END-EXEC.                                                    03970009
039800                                                                  03980009
039900/                                                                 03990009
040000*---------------------------------------------------------------* 04000009
040100*    DB2 AREA FOR THE RECEIPT ITEM TABLE                        * 04010009
040200*---------------------------------------------------------------* 04020009
040300     EXEC SQL                                                     04030009
040400          INCLUDE TRECITM                                         04040009
040500     END-EXEC.                                                    04050009
040600                                                                  04060009
040700/                                                                 04070009
040800*---------------------------------------------------------------* 04080009
040900*    DB2 AREA FOR COMMUNICATIONS                                * 04090009
041000*---------------------------------------------------------------* 04100009
041100     EXEC SQL                                                     04110009
041200          INCLUDE SQLCA                                           04120009
041300     END-EXEC.                                                    04130009
041400                                                                  04140009
041500/                                                                 04150009
041600*---------------------------------------------------------------* 04160009
041700*  CURSOR TO LIST SHIPMENTS                                     * 04170009
041800*---------------------------------------------------------------* 04180009
041900                                                                  04190009
042000     EXEC SQL                                                     04200009
042100          DECLARE TWRKORD_CSR CURSOR FOR                          04210009
042200           SELECT WORK_ORD_SEQ_NBR                                04220009
042300                 ,STAT_CDE                                        04230009
042400                 ,EXPTED_CART_CNT                                 04240009
042500                 ,ACTL_CART_CNT                                   04250009
042600                 ,EXPTED_ITM_CNT                                  04260009
042700                 ,ACTL_ITM_CNT                                    04270009
042800           FROM   TWRKORD                                         04280009
042900           WHERE  ORD_NBR        = :DK-ORD-NBR                    04290009
043000             AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR               04300009
043100             AND  ORD_LNE_NBR    = :DK-LINE-NBR                   04310009
043200             AND  WORK_ORD_SEQ_NBR    BETWEEN                     04320009
043300                                   :DK-WORK-ORD-SEQ-NBR-LOW AND   04330009
043400                                   :DK-WORK-ORD-SEQ-NBR-HIGH      04340009
043500             AND  OPER_UNT_ID    = :DK-OPERATING-UNIT-ID          04350009
043600             AND  FCLTY_ID       = :DK-FACILITY-ID                04360009
043700             AND  VER_STATUS_CDE = 'A'                            04370009
043800             AND  STAT_CDE            BETWEEN                     04380009
043900                                   :DK-STAT-CDE-LOW       AND     04390009
044000                                   :DK-STAT-CDE-HIGH              04400009
044100         ORDER BY WORK_ORD_SEQ_NBR                                04410009
044200     END-EXEC.                                                    04420009
044300/                                                                 04430009
044400*---------------------------------------------------------------* 04440009
044500*    CURSOR FOR THE WORK ORDER INSTRUCTIONS                     * 04450009
044600*---------------------------------------------------------------* 04460009
044700                                                                  04470009
044800     EXEC SQL                                                     04480009
044900          DECLARE TWKORIN-CSR CURSOR                              04490009
045000          FOR SELECT                                              04500009
045100                STOP_TMST                                         04510009
045200              , SCREEN_SEQ_NBR                                    04520009
045300          FROM                                                    04530009
045400                TWKORIN                                           04540009
045500          WHERE                                                   04550009
045600                ORD_NBR            =  :DK-ORD-NBR                 04560009
045700            AND ORD_LNE_NBR        =  :DK-LINE-NBR                04570009
045800            AND RCVR_SEQ_NBR       =  :DK-RCVR-SEQ-NBR            04580009
045900            AND WORK_ORD_SEQ_NBR   =  :DK-WORK-ORD-SEQ-NBR        04590009
046000            AND OPER_UNT_ID        =  :DK-OPERATING-UNIT-ID       04600009
046100            AND FCLTY_ID           =  :DK-FACILITY-ID             04610009
046200            AND VER_STATUS_CDE     =  :PC-A                       04620009
046300          ORDER BY                                                04630009
046400                SCREEN_SEQ_NBR                                    04640009
046500     END-EXEC.                                                    04650009
046600/                                                                 04660009
046700 LINKAGE SECTION.                                                 04670009
046800                                                                  04680009
046900 01  DFHCOMMAREA.                                                 04690009
047000     05  FILLER                         OCCURS  1 TO 4072 TIMES   04700009
047100                                        DEPENDING ON EIBCALEN.    04710009
047200         10  FILLER                     PIC X.                    04720009
047300                                                                  04730009
047400/                                                                 04740009
047500 PROCEDURE DIVISION.                                              04750009
047600*---------------------------------------------------------------* 04760009
047700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04770009
047800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04780009
047900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04790009
048000*---------------------------------------------------------------* 04800009
048100 0000-MAIN-MODULE.                                                04810009
048200                                                                  04820009
048300     INITIALIZE DP030-CICS-API-FIELDS.                            04830009
048400                                                                  04840009
048500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04850009
048600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04860009
048700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04870009
048800                                                                  04880009
048900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04890009
049000                                                                  04900009
049100     MOVE LENGTH OF PC159AI        TO DP030-MAP-LENGTH (1).       04910009
049200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04920009
049300                                                                  04930009
049400     PERFORM 0001-CALL-CICS-ARCH-API.                             04940009
049500     PERFORM 1000-CONTROL-PROCESSING                              04950009
049600                                                                  04960009
049700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04970009
049800     PERFORM 0001-CALL-CICS-ARCH-API.                             04980009
049900                                                                  04990009
050000*---------------------------------------------------------------* 05000009
050100*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05010009
050200*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05020009
050300*---------------------------------------------------------------* 05030009
050400 0001-CALL-CICS-ARCH-API.                                         05040009
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               05050021
1122RM     CALL DP930-CICS-ARCH-API                                     05051021
1122RM                     USING DFHEIBLK                               05052021
050600                           DFHCOMMAREA                            05060009
050700                           DP030-CICS-API-FIELDS                  05070009
050800                           DP020-STANDARD-COMMAREA                05080009
050900                           PC159AI.                               05090009
051000                                                                  05100009
051100     IF  DP030-RC-CALL-SUCCESSFUL                                 05110009
051200         CONTINUE                                                 05120009
051300     ELSE                                                         05130009
051400         SET DP013-NO-ROLLBACK                                    05140009
051500             DP013-XCTL-DISPLAY-RESTART                           05150009
051600             DP013-CICS-ABEND      TO TRUE                        05160009
051700         MOVE '0001-CALL-CICS-ARCH-API'                           05170009
051800                                   TO DP013-PARAGRAPH             05180009
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05190021
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05200021
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05201021
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05202021
052100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05210009
052200         PERFORM DP013-0000-PROCESS-ABEND                         05220009
052300     END-IF.                                                      05230009
052400                                                                  05240009
052500*----------------------------------------------------------------*05250009
052600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05260009
052700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05270009
052800*                                                                *05280009
052900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05290009
053000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05300009
053100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05310009
053200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05320009
053300*----------------------------------------------------------------*05330009
053400                                                                  05340009
053500 1000-CONTROL-PROCESSING.                                         05350009
053600                                                                  05360009
053700     EVALUATE TRUE                                                05370009
053800         WHEN DP020-NEXT-ACT-INITIAL                              05380009
053900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05390009
054000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05400009
054100                                      ASC-SEL-TERM-ID-OUT         05410009
054200             MOVE DP020-SRC-TASK-NUMBER                           05420009
054300                                   TO ASC-LIST-TASK-NUMBER        05430009
054400                                      ASC-SEL-TASK-NUMBER-OUT     05440009
054500             MOVE PC-LIST-QUEUE-SEQ                               05450009
054600                                   TO ASC-LIST-SEQ                05460009
054700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             05470009
054800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05480009
054900             IF  PS-COMMAREA-NOT-VALID                            05490009
055000                 SET DP020-MSG-FATAL                              05500009
055100                     DP020-NEXT-ACT-APPL-ERROR                    05510009
055200                                   TO TRUE                        05520009
055300             ELSE                                                 05530009
055400                 PERFORM 4000-BUILD-INITIAL-PANEL                 05540009
055500             END-IF                                               05550009
055600                                                                  05560009
055700         WHEN DP020-NEXT-ACT-READ-MAP                             05570009
055800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05580009
055900                                   TO PV-TOP-ITEM                 05590009
056000             PERFORM 2000-PROCESS-PANEL                           05600009
056100                                                                  05610009
056200         WHEN DP020-NEXT-ACT-RETURN                               05620009
056300              PERFORM 2050-DELETE-LIST-QUEUE                      05630009
056400              PERFORM 4000-BUILD-INITIAL-PANEL                    05640009
056500                                                                  05650009
056600         WHEN OTHER                                               05660009
056700             SET DP013-LOGIC-ABEND TO TRUE                        05670009
056800             SET DP013-NO-ROLLBACK TO TRUE                        05680009
056900             MOVE '1000-CONTROL-PROCESSING'                       05690009
057000                                   TO DP013-PARAGRAPH             05700009
057100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05710009
057200                                   TO DP013-MESSAGE-TEXT(1)       05720009
057300             PERFORM DP013-0000-PROCESS-ABEND                     05730009
057400     END-EVALUATE.                                                05740009
057500                                                                  05750009
057600/                                                                 05760009
057700*----------------------------------------------------------------*05770009
057800* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05780009
057900*----------------------------------------------------------------*05790009
058000                                                                  05800009
058100 1100-PROCESS-INTER-APPL-COMM.                                    05810009
058200                                                                  05820009
058300*----------------------------------------------------------------*05830009
058400* NOTE - IT'S "PC" STANDARD TO DENOTE LIST-TO-LIST ENTRY BY A    *05840009
058500*        '5' IN DP020-INT-APPL-FORMAT-IND.                       *05850009
058600*----------------------------------------------------------------*05860009
058700     SET PS-COMMAREA-VALID         TO TRUE.                       05870009
058800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05880009
058900                                                                  05890009
059000     EVALUATE DP020-INT-APPL-FORMAT-IND                           05900009
059100                                                                  05910009
059200         WHEN PC-INTER-APPL-CRIT-SPEC                             05920009
059300                                                                  05930009
059400**           THIS PROGRAM ASSUMES THAT INTER-APPL FIELDS ARE      05940009
059500**           PROPERLY INITIALIZED...                              05950009
059600             IF  PC000-PO-NBR-N      = ZEROES                     05960009
059700                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        05970009
059800                 SET PS-ERROR                                     05980009
059900                     PS-COMMAREA-NOT-VALID                        05990009
060000                     DP020-MSG-FATAL   TO TRUE                    06000009
060100             END-IF                                               06010009
060200             IF  PC000-REC-SEQ-NBR-N = ZEROES                     06020009
060300                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        06030009
060400                 SET PS-ERROR                                     06040009
060500                     PS-COMMAREA-NOT-VALID                        06050009
060600                     DP020-MSG-FATAL   TO TRUE                    06060009
060700             END-IF                                               06070009
060800             IF  PC000-LINE-NBR-N    = ZEROES                     06080009
060900                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        06090009
061000                 SET PS-ERROR                                     06100009
061100                     PS-COMMAREA-NOT-VALID                        06110009
061200                     DP020-MSG-FATAL   TO TRUE                    06120009
061300             END-IF                                               06130009
061400             IF  PS-NO-ERROR                                      06140009
061500                 MOVE PC000-OPERATING-UNIT-ID TO                  06150009
061600                      ASC-OPERATING-UNIT-ID                       06160009
061700                 MOVE PC000-FACILITY-ID       TO                  06170009
061800                      ASC-FACILITY-ID                             06180009
061900                 MOVE PC000-PO-NBR-N          TO                  06190009
062000                      ASC-PO-NBR                                  06200009
062100                 MOVE PC000-REC-SEQ-NBR-N     TO                  06210009
062200                      ASC-REC-SEQ-NBR                             06220009
062300                 MOVE PC000-LINE-NBR-N        TO                  06230009
062400                      ASC-LINE-NBR                                06240009
062500             END-IF                                               06250009
062600                                                                  06260009
062700         WHEN PC-INTER-APPL-LIST                                  06270009
062800              SET ASC-USE-SELECTION-QUEUE                         06280009
062900                                   TO TRUE                        06290009
063000              MOVE PC000-OPERATING-UNIT-ID                        06300009
063100                                   TO ASC-OPERATING-UNIT-ID       06310009
063200              MOVE PC000-FACILITY-ID                              06320009
063300                                   TO ASC-FACILITY-ID             06330009
063400              MOVE PC000-NUMBER-OF-SELECTED-ITEMS                 06340009
063500                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06350009
063600              MOVE PC000-NUMBER-OF-TS-ITEMS                       06360009
063700                                   TO ASC-NUMBER-OF-TS-ITEMS      06370009
063800              MOVE PC000-SEL-QUEUE-NAME                           06380009
063900                                   TO ASC-SEL-QUEUE-NAME-IN       06390009
064000              PERFORM 1120-PREPARE-LIST-ENTRY                     06400009
064100                                                                  06410009
064200     END-EVALUATE.                                                06420009
064300                                                                  06430009
064400*----------------------------------------------------------------*06440009
064500*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *06450009
064600*  QUEUE PASSED FROM THE LIST.                                   *06460009
064700*----------------------------------------------------------------*06470009
064800                                                                  06480009
064900 1120-PREPARE-LIST-ENTRY.                                         06490009
065000      MOVE PC016-MAX-ITEMS         TO ASC-SEL-SUB.                06500009
065100      MOVE ZERO                    TO ASC-SEL-ITEM.               06510009
065200      PERFORM 2300-GET-NEXT-RECORD.                               06520009
065300                                                                  06530009
065400/                                                                 06540009
065500*----------------------------------------------------------------*06550009
065600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06560009
065700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06570009
065800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06580009
065900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06590009
066000* FUNCTION KEYS CAN GET THIS FAR.                                *06600009
066100*----------------------------------------------------------------*06610009
066200                                                                  06620009
066300 2000-PROCESS-PANEL.                                              06630009
066400     EVALUATE TRUE                                                06640009
066500         WHEN DP020-SRC-AID = DP016-CLEAR                         06650009
066600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06660009
066700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06670009
066800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06680009
066900                                                                  06690009
067000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06700009
067100             PERFORM 2050-DELETE-LIST-QUEUE                       06710009
067200             PERFORM 4000-BUILD-INITIAL-PANEL                     06720009
067300                                                                  06730009
067400         WHEN OTHER                                               06740009
067500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06750009
067600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06760009
067700             IF  PS-NO-ERROR                                      06770009
067800                 SET DP030-CONTINUE-GO TO TRUE                    06780009
067900                 PERFORM 2100-CHECK-FUNCTION-KEY                  06790009
068000             ELSE                                                 06800009
068100                 SET DP030-OVERRIDE-GO TO TRUE                    06810009
068200             END-IF                                               06820009
068300     END-EVALUATE.                                                06830009
068400                                                                  06840009
068500/                                                                 06850009
068600*----------------------------------------------------------------*06860009
068700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06870009
068800*----------------------------------------------------------------*06880009
068900 2050-DELETE-LIST-QUEUE.                                          06890009
069000                                                                  06900009
069100     EXEC CICS                                                    06910009
069200         DELETEQ TS                                               06920009
069300           QUEUE (ASC-LIST-QUEUE-NAME)                            06930009
069400            RESP (PV-CICS-RESP)                                   06940009
069500     END-EXEC.                                                    06950009
069600                                                                  06960009
069700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06970009
069800        (PV-CICS-RESP = DFHRESP(QIDERR))                          06980009
069900         CONTINUE                                                 06990009
070000     ELSE                                                         07000009
070100         SET DP013-CICS-ABEND      TO TRUE                        07010009
070200         SET DP013-NO-ROLLBACK     TO TRUE                        07020009
070300                                                                  07030009
070400         MOVE '2050-DELETE-LIST-QUEUE'                            07040009
070500                                   TO DP013-PARAGRAPH             07050009
070600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07060009
070700                                   TO DP013-MESSAGE-TEXT (1)      07070009
070800         PERFORM DP013-0000-PROCESS-ABEND                         07080009
070900     END-IF.                                                      07090009
071000                                                                  07100009
071100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07110009
071200                                                                  07120009
071300/                                                                 07130009
071400*----------------------------------------------------------------*07140009
071500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07150009
071600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07160009
071700* CICS ARCHITECTURE API.                                         *07170009
071800*----------------------------------------------------------------*07180009
071900 2100-CHECK-FUNCTION-KEY.                                         07190009
072000                                                                  07200009
072100     EVALUATE TRUE                                                07210009
072200          WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)             07220009
072300               IF  PS-NO-ERROR                                    07230009
072400                   SET DP030-CONTINUE-GO TO TRUE                  07240009
072500                   PERFORM 5000-UPDATE-PROCESS                    07250009
072600                   MOVE ZERO       TO ASC-ITEM-AT-TOP-OF-PANEL    07260009
072700*              --- UPDATES SUCCESSFUL ---                         07270009
072800                   IF  PS-UPDATED                                 07280009
072900                       MOVE PC-TSYMSG-00059                       07290009
073000                                         TO DP020-MSG-NUMBER      07300009
073100                   ELSE                                           07310009
073200                       MOVE PC-TSYMSG-00046                       07320009
073300                                         TO DP020-MSG-NUMBER      07330009
073400                   END-IF                                         07340009
073500                   SET DP020-MSG-INFORMATIONAL                    07350009
073600                                         TO TRUE                  07360009
073700               ELSE                                               07370009
073800                   MOVE PC-TSYMSG-00254                           07380009
073900                                   TO  DP020-MSG-NUMBER           07390009
074000                   SET DP020-MSG-FATAL   TO TRUE                  07400009
074100               END-IF                                             07410009
074200               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               07420009
074300                                                                  07430009
074400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07440009
074500             MOVE +1               TO PV-TOP-ITEM                 07450009
074600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07460009
074700             PERFORM 3200-RESET-ATTRIBUTES                        07470009
074800                                                                  07480009
074900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07490009
075000             PERFORM 2110-BROWSE-BACKWARD                         07500009
075100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07510009
075200             PERFORM 3200-RESET-ATTRIBUTES                        07520009
075300                                                                  07530009
075400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07540009
075500             PERFORM 2120-BROWSE-FORWARD                          07550009
075600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07560009
075700             PERFORM 3200-RESET-ATTRIBUTES                        07570009
075800                                                                  07580009
075900         WHEN DP020-SRC-AID = DP016-ENTER                         07590009
076000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07600009
076100             IF  PS-ERROR                                         07610009
076200                 CONTINUE                                         07620009
076300             ELSE                                                 07630009
076400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07640009
076500             END-IF                                               07650009
076600                                                                  07660009
076700         WHEN OTHER                                               07670009
076800             SET DP013-NO-ROLLBACK                                07680009
076900                 DP013-XCTL-DISPLAY-RESTART                       07690009
077000                 DP013-CICS-ABEND  TO TRUE                        07700009
077100             MOVE '2100-CHECK-FUNCTION-KEY'                       07710009
077200                                   TO DP013-PARAGRAPH             07720009
077300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07730009
077400                                   TO DP013-MESSAGE-TEXT (1)      07740009
077500             PERFORM DP013-0000-PROCESS-ABEND                     07750009
077600     END-EVALUATE.                                                07760009
077700                                                                  07770009
077800/                                                                 07780009
077900*----------------------------------------------------------------*07790009
078000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07800009
078100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07810009
078200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07820009
078300*    MESSAGE.                                                    *07830009
078400*----------------------------------------------------------------*07840009
078500                                                                  07850009
078600 2110-BROWSE-BACKWARD.                                            07860009
078700                                                                  07870009
078800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07880009
078900         GIVING PV-TOP-ITEM.                                      07890009
079000                                                                  07900009
079100     IF  ((PV-TOP-ITEM < +1)                                      07910009
079200       OR (PV-TOP-ITEM = +1))                                     07920009
079300         MOVE +1                   TO PV-TOP-ITEM                 07930009
079400*        -- TOP OF LIST --                                        07940009
079500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07950009
079600         SET DP020-MSG-INFORMATIONAL                              07960009
079700                                   TO TRUE                        07970009
079800     END-IF.                                                      07980009
079900                                                                  07990009
080000/                                                                 08000009
080100*----------------------------------------------------------------*08010009
080200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08020009
080300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08030009
080400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08040009
080500*----------------------------------------------------------------*08050009
080600                                                                  08060009
080700 2120-BROWSE-FORWARD.                                             08070009
080800                                                                  08080009
080900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08090009
081000         GIVING PV-TOP-ITEM.                                      08100009
081100                                                                  08110009
081200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08120009
081300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08130009
081400                                   TO PV-TOP-ITEM                 08140009
081500*        -- BOTTOM OF LIST --                                     08150009
081600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08160009
081700         SET DP020-MSG-INFORMATIONAL                              08170009
081800                                   TO TRUE                        08180009
081900     ELSE                                                         08190009
082000         COMPUTE PV-BOTTOM-ITEM =                                 08200009
082100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08210009
082200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08220009
082300*            -- BOTTOM OF LIST --                                 08230009
082400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08240009
082500             SET DP020-MSG-INFORMATIONAL                          08250009
082600                                   TO TRUE                        08260009
082700         END-IF                                                   08270009
082800     END-IF.                                                      08280009
082900                                                                  08290009
083000/                                                                 08300009
083100*----------------------------------------------------------------*08310009
083200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08320009
083300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08330009
083400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08340009
083500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08350009
083600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08360009
083700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08370009
083800*----------------------------------------------------------------*08380009
083900                                                                  08390009
084000 2130-CHECK-FOR-JUMP-BROWSE.                                      08400009
084100                                                                  08410009
084200     SET PS-NO-ERROR               TO TRUE.                       08420009
084300     IF (ASC-START-ITEM-REQUEST = SPACE)                          08430009
084400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08440009
084500                                   TO PV-TOP-ITEM                 08450009
084600     ELSE                                                         08460009
084700         MOVE ASC-START-ITEM-REQUEST                              08470009
084800                                   TO DP010I-UNEDITED-FIELD       08480009
084900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08490009
085000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08500009
085100         SET DP010I-NEGATIVE-NOT-ALLOWED                          08510009
085200                                   TO TRUE                        08520009
085310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08531018
085320                         USING DP010I-NUMERIC-EDIT-AREA           08532018
085400                                                                  08540009
085500         IF  NOT DP010I-ERROR-DETECTED                            08550009
085600             MOVE DP010I-NUMERIC-FIELD                            08560009
085700                                   TO ASC-START-ITEM-REQUEST-N    08570009
085800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08580009
085900                 IF  ASC-START-ITEM-REQUEST-N >                   08590009
086000                                          ASC-NUMBER-OF-ITEMS-READ08600009
086100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08610009
086200                     COMPUTE PV-TOP-ITEM =                        08620009
086300                             ASC-NUMBER-OF-ITEMS-READ             08630009
086400                             - PC-ITEMS-PER-PANEL + 1             08640009
086500                     IF  PV-TOP-ITEM < +1                         08650009
086600                         MOVE +1   TO PV-TOP-ITEM                 08660009
086700                         MOVE PC-TSYMSG-00070                     08670009
086800                                   TO DP020-MSG-NUMBER            08680009
086900                         SET DP020-MSG-INFORMATIONAL              08690009
087000                                   TO TRUE                        08700009
087100                     END-IF                                       08710009
087200                 ELSE                                             08720009
087300                     MOVE ASC-START-ITEM-REQUEST-N                08730009
087400                                   TO PV-TOP-ITEM                 08740009
087500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08750009
087600                     COMPUTE PV-BOTTOM-ITEM =                     08760009
087700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08770009
087800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08780009
087900*                        -- BOTTOM OF LIST --                     08790009
088000                         MOVE PC-TSYMSG-00070                     08800009
088100                                   TO DP020-MSG-NUMBER            08810009
088200                         SET DP020-MSG-INFORMATIONAL              08820009
088300                                   TO TRUE                        08830009
088400                     END-IF                                       08840009
088500                 END-IF                                           08850009
088600             ELSE                                                 08860009
088700*                --- VALUE OUT OF RANGE ----                      08870009
088800                 MOVE PC-TSYMSG-00101                             08880009
088900                                   TO DP020-MSG-NUMBER            08890009
089000                 MOVE -1           TO ASTRTITL                    08900009
089100                 SET DP030-SET-CURSOR-APPL-1                      08910009
089200                                   TO TRUE                        08920009
089300                 MOVE DP015-REVERSE                               08930009
089400                                   TO ASTRTITH                    08940009
089500                 MOVE DP015-RED    TO ASTRTITC                    08950009
089600                 MOVE DP015-UNP-NUM-BRT-MDT                       08960009
089700                                   TO ASTRTITA                    08970009
089800                 SET DP020-MSG-FATAL                              08980009
089900                                   TO TRUE                        08990009
090000                 SET PS-ERROR      TO TRUE                        09000009
090100             END-IF                                               09010009
090200                                                                  09020009
090300         ELSE                                                     09030009
090400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09040009
090500             MOVE -1               TO ASTRTITL                    09050009
090600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09060009
090700             MOVE DP015-REVERSE    TO ASTRTITH                    09070009
090800             MOVE DP015-RED        TO ASTRTITC                    09080009
090900             MOVE DP015-UNP-NUM-BRT-MDT                           09090009
091000                                   TO ASTRTITA                    09100009
091100             SET DP020-MSG-FATAL   TO TRUE                        09110009
091200             SET PS-ERROR          TO TRUE                        09120009
091300         END-IF                                                   09130009
091400     END-IF.                                                      09140009
091500                                                                  09150009
091600/                                                                 09160009
091700*----------------------------------------------------------------*09170009
091800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *09180009
091900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *09190009
092000*----------------------------------------------------------------*09200009
092100 2200-MOVE-SCREEN-TO-COMMAREA.                                    09210009
092200                                                                  09220009
092300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09230009
092400     MOVE +1                       TO PV-SUB.                     09240009
092500                                                                  09250009
092600     PERFORM 3100-SET-SUBSCRIPTS.                                 09260009
092700                                                                  09270009
092800     IF  ASTRTITL > ZERO                                          09280009
092900         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      09290009
093000     ELSE                                                         09300009
093100         IF  ASTRTITF = DP015-ERASE-EOF                           09310009
093200             INITIALIZE ASC-START-ITEM-REQUEST                    09320009
093300         END-IF                                                   09330009
093400     END-IF.                                                      09340009
093500                                                                  09350009
093600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09360009
093700         VARYING PV-SUB                                           09370009
093800         FROM 1 BY 1                                              09380009
093900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09390009
094000                                                                  09400009
094100/                                                                 09410009
094200*----------------------------------------------------------------*09420009
094300*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *09430009
094400*----------------------------------------------------------------*09440009
094500 2210-MOVE-LINES-TO-COMMAREA.                                     09450009
094600                                                                  09460009
094700     IF  MR-ACTL-CART-CNTL (PV-SUB) > ZERO                        09470009
094800         SET ASC-BLOCK-MODIFIED     (ASC-BLK-SUB)                 09480009
094900             ASC-ACTL-CART-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)   09490009
095000                                   TO TRUE                        09500009
095100         MOVE MR-ACTL-CART-CNT (PV-SUB) TO ASC-ACTL-CART-CNT-X    09510009
095200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09520009
095300     ELSE                                                         09530009
095400         IF  MR-ACTL-CART-CNTA (PV-SUB) = DP015-ERASE-EOF         09540009
095500             SET ASC-BLOCK-MODIFIED    (ASC-BLK-SUB)              09550009
095600                 ASC-ACTL-CART-CNT-CHGD                           09560009
095700                                       (ASC-BLK-SUB, ASC-ITEM-SUB)09570009
095800                                   TO TRUE                        09580009
095900             MOVE ZERO             TO ASC-ACTL-CART-CNT-X         09590009
096000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09600009
096100         END-IF                                                   09610009
096200     END-IF.                                                      09620009
096300                                                                  09630009
096400     IF  MR-ACTL-ITM-CNTL (PV-SUB) > ZERO                         09640009
096500         SET ASC-BLOCK-MODIFIED    (ASC-BLK-SUB)                  09650009
096600             ASC-ACTL-ITM-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)    09660009
096700                                   TO TRUE                        09670009
096800         MOVE MR-ACTL-ITM-CNT (PV-SUB) TO ASC-ACTL-ITM-CNT-X      09680009
096900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09690009
097000     ELSE                                                         09700009
097100         IF  MR-ACTL-ITM-CNTA (PV-SUB) = DP015-ERASE-EOF          09710009
097200             SET ASC-BLOCK-MODIFIED    (ASC-BLK-SUB)              09720009
097300                 ASC-ACTL-ITM-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)09730009
097400                                   TO TRUE                        09740009
097500             MOVE ZERO             TO ASC-ACTL-ITM-CNT-X          09750009
097600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09760009
097700         END-IF                                                   09770009
097800     END-IF.                                                      09780009
097900                                                                  09790009
098000     ADD +1                        TO ASC-ITEM-SUB.               09800009
098100                                                                  09810009
098200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09820009
098300         ADD +1                    TO ASC-BLK-SUB                 09830009
098400         MOVE +1                   TO ASC-ITEM-SUB                09840009
098500     END-IF.                                                      09850009
098600                                                                  09860009
098700/                                                                 09870009
098800******************************************************************09880009
098900* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *09890009
099000* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *09900009
099100******************************************************************09910009
099200 2300-GET-NEXT-RECORD.                                            09920009
099300                                                                  09930009
099400     ADD +1                        TO ASC-SEL-SUB.                09940009
099500     IF ASC-SEL-SUB > PC016-MAX-ITEMS                             09950009
099600         ADD +1                    TO ASC-SEL-ITEM                09960009
099700         MOVE +1                   TO ASC-SEL-SUB                 09970009
099800     END-IF.                                                      09980009
099900     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 09990009
100000         PERFORM 9100-READ-SEL-QUEUE                              10000009
100100         IF PC016-ITEM (ASC-SEL-SUB) > ZERO                       10010009
100200             INITIALIZE ASC-LIST-KEYS                             10020009
100300             MOVE PC016-PO-NBR-N(ASC-SEL-SUB)      TO ASC-PO-NBR  10030009
100400             MOVE PC016-REC-SEQ-NBR-N(ASC-SEL-SUB) TO             10040009
100500                  ASC-REC-SEQ-NBR                                 10050009
100600             MOVE PC016-LINE-NBR-N(ASC-SEL-SUB)    TO             10060009
100700                  ASC-LINE-NBR                                    10070009
100800             SET PC016-INQ (ASC-SEL-SUB)           TO TRUE        10080009
100900             PERFORM 9200-REWRITE-LIST-QUEUE                      10090009
101000         ELSE                                                     10100009
101100             SUBTRACT +1 FROM ASC-SEL-SUB                         10110009
101200*            --- BOTTOM OF LIST ---                               10120009
101300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10130009
101400             SET DP020-MSG-INFORMATIONAL                          10140009
101500                                   TO TRUE                        10150009
101600         END-IF                                                   10160009
101700     ELSE                                                         10170009
101800         SUBTRACT +1 FROM ASC-SEL-ITEM                            10180009
101900         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 10190009
102000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10200009
102100         SET DP020-MSG-INFORMATIONAL                              10210009
102200                                   TO TRUE                        10220009
102300     END-IF.                                                      10230009
102400                                                                  10240009
102500/                                                                 10250009
102600*----------------------------------------------------------------*10260009
102700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *10270009
102800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *10280009
102900*----------------------------------------------------------------*10290009
103000 3000-EDIT-DATA-IN-COMMAREA.                                      10300009
103100                                                                  10310009
103200     SET PS-NO-ERROR               TO TRUE.                       10320009
103300                                                                  10330009
103400     PERFORM 3200-RESET-ATTRIBUTES.                               10340009
103500                                                                  10350009
103600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10360009
103700**                                                                10370009
103800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10380009
103900* EDITTING IS DONE FROM THE BOTTOM UP.                            10390009
104000**                                                                10400009
104100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10410009
104200         ASC-ITEMS-DISPLAYED - 1.                                 10420009
104300                                                                  10430009
104400     PERFORM 3100-SET-SUBSCRIPTS.                                 10440009
104500     PERFORM 3300-EDIT-SELECTIONS                                 10450009
104600         VARYING PV-SUB                                           10460009
104700         FROM PV-SUB BY -1                                        10470009
104800         UNTIL PV-SUB < +1.                                       10480009
104900                                                                  10490009
105000                                                                  10500009
105100/                                                                 10510009
105200*----------------------------------------------------------------*10520009
105300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10530009
105400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10540009
105500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10550009
105600*                                                                *10560009
105700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10570009
105800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10580009
105900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10590009
106000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10600009
106100*----------------------------------------------------------------*10610009
106200                                                                  10620009
106300 3100-SET-SUBSCRIPTS.                                             10630009
106400                                                                  10640009
106500     COMPUTE ASC-ITEM-SUB =                                       10650009
106600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10660009
106700                                                                  10670009
106800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10680009
106900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10690009
107000                                                                  10700009
107100         MOVE PC-MAX-BLOCKS-IN-ARRAY                              10710009
107200                                   TO ASC-BLK-SUB                 10720009
107300     ELSE                                                         10730009
107400         MOVE +1                   TO ASC-BLK-SUB                 10740009
107500     END-IF.                                                      10750009
107600                                                                  10760009
107700*----------------------------------------------------------------*10770009
107800*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *10780009
107900*----------------------------------------------------------------*10790009
108000                                                                  10800009
108100 3200-RESET-ATTRIBUTES.                                           10810009
108200                                                                  10820009
108300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10830009
108400     MOVE DP015-GREEN              TO ASTRTITC.                   10840009
108500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10850009
108600                                                                  10860009
108700     IF DP020-NEXT-ACT-RETURN                                     10870009
108800     OR DP020-NEXT-ACT-READ-MAP                                   10880009
108900        PERFORM                                                   10890009
109000            VARYING PV-SUB                                        10900009
109100            FROM 1 BY 1                                           10910009
109200            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    10920009
109300            MOVE DP015-UNP-ALP-NOR-OFF                            10930009
109400                                     TO MR-ACTL-CART-CNTA (PV-SUB)10940009
109500                                        MR-ACTL-ITM-CNTA (PV-SUB) 10950009
109600            MOVE DP015-GREEN         TO MR-ACTL-CART-CNTC (PV-SUB)10960009
109700                                        MR-ACTL-ITM-CNTC (PV-SUB) 10970009
109800            MOVE DP015-UNDERLINE     TO MR-ACTL-CART-CNTH (PV-SUB)10980009
109900                                        MR-ACTL-ITM-CNTH (PV-SUB) 10990009
110000        END-PERFORM                                               11000009
110100     ELSE                                                         11010009
110200        PERFORM                                                   11020009
110300            VARYING PV-SUB                                        11030009
110400            FROM 1 BY 1                                           11040009
110500            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     11050009
110600            MOVE DP015-UNP-ALP-NOR-OFF                            11060009
110700                                     TO MR-ACTL-CART-CNTA (PV-SUB)11070009
110800                                        MR-ACTL-ITM-CNTA (PV-SUB) 11080009
110900            MOVE DP015-GREEN         TO MR-ACTL-CART-CNTC (PV-SUB)11090009
111000                                        MR-ACTL-ITM-CNTC (PV-SUB) 11100009
111100            MOVE DP015-UNDERLINE     TO MR-ACTL-CART-CNTH (PV-SUB)11110009
111200                                        MR-ACTL-ITM-CNTH (PV-SUB) 11120009
111300        END-PERFORM                                               11130009
111400     END-IF.                                                      11140009
111500/                                                                 11150009
111600*----------------------------------------------------------------*11160009
111700*  EDIT ANY CHANGES THAT WERE MADE TO FIELDS ON THE SCREEN.      *11170009
111800*----------------------------------------------------------------*11180009
111900 3300-EDIT-SELECTIONS.                                            11190009
112000                                                                  11200009
112100     IF (ASC-ACTL-CART-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)       11210009
112200     OR  ASC-ACTL-ITM-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB))       11220009
112300         MOVE ASC-STAT-CDE (ASC-BLK-SUB ASC-ITEM-SUB)             11230009
112400                                   TO  PV-STAT-CDE                11240009
112500         IF  PV-VALID-UPDATE-STAT-CDE                             11250009
112600             SET PS-VALID-UPDATE-STAT-CDE                         11260009
112700                                   TO  TRUE                       11270009
112800         ELSE                                                     11280009
112900             SET PS-ERROR                                         11290009
113000                 DP020-MSG-FATAL   TO TRUE                        11300009
113100             MOVE PC-TSYMSG-00170  TO DP020-MSG-NUMBER            11310009
113200             SET DP030-SET-CURSOR-APPL-1                          11320009
113300                                   TO TRUE                        11330009
113400             IF  ASC-ACTL-ITM-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)11340009
113500                 MOVE DP015-UNP-ALP-BRT-MDT                       11350009
113600                                   TO MR-ACTL-ITM-CNTA (PV-SUB)   11360009
113700                 MOVE DP015-RED    TO MR-ACTL-ITM-CNTC (PV-SUB)   11370009
113800                 MOVE DP015-REVERSE                               11380009
113900                                   TO MR-ACTL-ITM-CNTH (PV-SUB)   11390009
114000                 MOVE -1           TO MR-ACTL-ITM-CNTL (PV-SUB)   11400009
114100             ELSE                                                 11410009
114200                 MOVE DP015-UNP-ALP-BRT-MDT                       11420009
114300                                   TO MR-ACTL-CART-CNTA (PV-SUB)  11430009
114400                 MOVE DP015-RED    TO MR-ACTL-CART-CNTC (PV-SUB)  11440009
114500                 MOVE DP015-REVERSE                               11450009
114600                                   TO MR-ACTL-CART-CNTH (PV-SUB)  11460009
114700                 MOVE -1           TO MR-ACTL-CART-CNTL (PV-SUB)  11470009
114800             END-IF                                               11480009
114900         END-IF                                                   11490009
115000     END-IF.                                                      11500009
115100                                                                  11510009
115200     IF (ASC-ACTL-ITM-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)        11520009
115300     AND PS-VALID-UPDATE-STAT-CDE)                                11530009
115400*-->     ** ACTUAL ITEM COUNT NUMERIC EDIT CHECK                  11540009
115500         MOVE ASC-ACTL-ITM-CNT-X (ASC-BLK-SUB ASC-ITEM-SUB)       11550009
115600                                   TO  DP010I-UNEDITED-FIELD      11560009
115700         MOVE PC-5                 TO  DP010I-MAXIMUM-DIGITS      11570009
115800         MOVE ZERO                 TO  DP010I-MAXIMUM-DECIMALS    11580009
115900         SET DP010I-NEGATIVE-NOT-ALLOWED                          11590009
116000                                   TO  TRUE                       11600009
116110         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11611018
116120                         USING DP010I-NUMERIC-EDIT-AREA           11612018
116200                                                                  11620009
116300         IF  DP010I-ERROR-DETECTED                                11630009
116400             SET PS-ERROR                                         11640009
116500                 DP020-MSG-FATAL   TO TRUE                        11650009
116600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11660009
116700             MOVE DP015-UNP-ALP-BRT-MDT                           11670009
116800                                   TO MR-ACTL-ITM-CNTA (PV-SUB)   11680009
116900             MOVE DP015-RED        TO MR-ACTL-ITM-CNTC (PV-SUB)   11690009
117000             MOVE DP015-REVERSE    TO MR-ACTL-ITM-CNTH (PV-SUB)   11700009
117100             MOVE -1               TO MR-ACTL-ITM-CNTL (PV-SUB)   11710009
117200             SET DP030-SET-CURSOR-APPL-1                          11720009
117300                                   TO TRUE                        11730009
117400             SET  PS-ERROR         TO TRUE                        11740009
117500         ELSE                                                     11750009
117600             MOVE DP010I-NUMERIC-FIELD                            11760009
117700                                   TO ASC-ACTL-ITM-CNT            11770009
117800                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 11780009
117900             SET ASC-UPDATED (ASC-BLK-SUB, ASC-ITEM-SUB)          11790009
118000                                   TO TRUE                        11800009
118100         END-IF                                                   11810009
118200     END-IF.                                                      11820009
118300                                                                  11830009
118400     IF (ASC-ACTL-CART-CNT-CHGD (ASC-BLK-SUB, ASC-ITEM-SUB)       11840009
118500     AND PS-VALID-UPDATE-STAT-CDE)                                11850009
118600*-->     ** ACTUAL CARTON COUNT NUMERIC EDIT CHECK                11860009
118700         MOVE ASC-ACTL-CART-CNT-X (ASC-BLK-SUB ASC-ITEM-SUB)      11870009
118800                                   TO  DP010I-UNEDITED-FIELD      11880009
118900         MOVE PC-5                 TO  DP010I-MAXIMUM-DIGITS      11890009
119000         MOVE ZERO                 TO  DP010I-MAXIMUM-DECIMALS    11900009
119100         SET DP010I-NEGATIVE-NOT-ALLOWED                          11910009
119200                                   TO  TRUE                       11920009
119310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11931018
119320                         USING DP010I-NUMERIC-EDIT-AREA           11932018
119400                                                                  11940009
119500         IF  DP010I-ERROR-DETECTED                                11950009
119600             SET PS-ERROR                                         11960009
119700                 DP020-MSG-FATAL   TO TRUE                        11970009
119800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11980009
119900             MOVE DP015-UNP-ALP-BRT-MDT                           11990009
120000                                   TO MR-ACTL-CART-CNTA (PV-SUB)  12000009
120100             MOVE DP015-RED        TO MR-ACTL-CART-CNTC (PV-SUB)  12010009
120200             MOVE DP015-REVERSE    TO MR-ACTL-CART-CNTH (PV-SUB)  12020009
120300             MOVE -1               TO MR-ACTL-CART-CNTL (PV-SUB)  12030009
120400             SET DP030-SET-CURSOR-APPL-1                          12040009
120500                                   TO TRUE                        12050009
120600         ELSE                                                     12060009
120700             MOVE DP010I-NUMERIC-FIELD                            12070009
120800                                   TO ASC-ACTL-CART-CNT           12080009
120900                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 12090009
121000             SET ASC-UPDATED (ASC-BLK-SUB, ASC-ITEM-SUB)          12100009
121100                                   TO TRUE                        12110009
121200         END-IF                                                   12120009
121300     END-IF.                                                      12130009
121400                                                                  12140009
121500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12150009
121600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12160009
121700     IF  ASC-ITEM-SUB < 1                                         12170009
121800         SUBTRACT +1 FROM ASC-BLK-SUB                             12180009
121900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12190009
122000     END-IF.                                                      12200009
122100                                                                  12210009
122200/                                                                 12220009
122300*----------------------------------------------------------------*12230009
122400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *12240009
122500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *12250009
122600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *12260009
122700*    DISPLAY THE PANEL TO USER.                                  *12270009
122800*----------------------------------------------------------------*12280009
122900                                                                  12290009
123000 4000-BUILD-INITIAL-PANEL.                                        12300009
123100                                                                  12310009
123200     INITIALIZE ASC-BLOCK-ENTRIES (1)                             12320009
123300                ASC-BLOCK-ENTRIES (2).                            12330009
123400                                                                  12340009
123500     MOVE +1                       TO ASC-BLK-SUB.                12350009
123600                                                                  12360009
123700     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       12370009
123800                                                                  12380009
123900     MOVE +0                       TO ASC-ITEM-SUB                12390009
124000                                      ASC-NUMBER-OF-ITEMS-READ    12400009
124100                                      ASC-NUMBER-OF-SELECTED-ITEMS12410009
124200                                      ASC-HIGHEST-BLOCK-WRITTEN   12420009
124300                                      ASC-START-OF-SELECTED-RANGE 12430009
124400                                      ASC-END-OF-SELECTED-RANGE   12440009
124500                                      ASC-ITEM-AT-TOP-OF-PANEL.   12450009
124600                                                                  12460009
124700     PERFORM 4100-PREPARE-CURSOR.                                 12470009
124800                                                                  12480009
124900     PERFORM 4010-OPEN-CURSOR.                                    12490009
125000                                                                  12500009
125100     PERFORM 4300-READ-ITEMS-FROM-DB.                             12510009
125200                                                                  12520009
125300     PERFORM 4020-CLOSE-CURSOR.                                   12530009
125400                                                                  12540009
125500     MOVE +1                       TO PV-TOP-ITEM.                12550009
125600                                                                  12560009
125700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          12570009
125800         SET DP020-NEXT-ACT-APPL-ERROR                            12580009
125900                                   TO TRUE                        12590009
126000         SET DP020-MSG-FATAL       TO TRUE                        12600009
126100         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            12610009
126200     ELSE                                                         12620009
126300         MOVE -1                   TO MR-ACTL-CART-CNTL (1)       12630009
126400         SET DP030-SET-CURSOR-APPL-1                              12640009
126500                                   TO TRUE                        12650009
126600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     12660009
126700     END-IF.                                                      12670009
126800                                                                  12680009
126900/                                                                 12690009
127000*----------------------------------------------------------------*12700009
127100* OPEN THE SHIPMENT CURSOR                                       *12710009
127200*----------------------------------------------------------------*12720009
127300                                                                  12730009
127400 4010-OPEN-CURSOR.                                                12740009
127500                                                                  12750009
127600     PERFORM                                                      12760009
127700         WITH TEST AFTER                                          12770009
127800         VARYING PV-RETRY-COUNTER                                 12780009
127900         FROM 1 BY 1                                              12790009
128000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12800009
128100            OR (SQLCODE = +0))                                    12810009
128200                                                                  12820009
128300         EXEC SQL                                                 12830009
128400             OPEN TWRKORD_CSR                                     12840009
128500         END-EXEC                                                 12850009
128600                                                                  12860009
128700                                                                  12870009
128800         EVALUATE TRUE                                            12880009
128900             WHEN SQLCODE = +0                                    12890009
129000                  CONTINUE                                        12900009
129100             WHEN SQLCODE = -904                                  12910009
129200             WHEN SQLCODE = -913                                  12920009
129300                  CONTINUE                                        12930009
129400             WHEN SQLWARN0 NOT = SPACE                            12940009
129500             WHEN SQLCODE  NOT = +0                               12950009
129600                  MOVE '4010-OPEN-CURSOR'                         12960009
129700                                   TO DP013-PARAGRAPH             12970009
129800                  MOVE 'OPEN CURSOR'                              12980009
129900                                   TO DP013-MESSAGE-TEXT (1)      12990009
130000                  MOVE SQLCA       TO DP013-SQLCA                 13000009
130100                  MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)    13010009
130200                  SET DP013-DB2-ABEND                             13020009
130300                                   TO TRUE                        13030009
130400                  PERFORM DP013-0000-PROCESS-ABEND                13040009
130500         END-EVALUATE                                             13050009
130600     END-PERFORM.                                                 13060009
130700                                                                  13070009
130800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13080009
130900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             13090009
131000         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              13100009
131100                                   TO DP013-MESSAGE-TEXT (1)      13110009
131200         MOVE SQLCA                TO DP013-SQLCA                 13120009
131300         SET DP013-DB2-ABEND       TO TRUE                        13130009
131400         PERFORM DP013-0000-PROCESS-ABEND                         13140009
131500     END-IF.                                                      13150009
131600                                                                  13160009
131700/                                                                 13170009
131800*----------------------------------------------------------------*13180009
131900* CLOSE THE SHIPMENT CURSOR                                      *13190009
132000*----------------------------------------------------------------*13200009
132100                                                                  13210009
132200 4020-CLOSE-CURSOR.                                               13220009
132300                                                                  13230009
132400     EXEC SQL                                                     13240009
132500         CLOSE TWRKORD_CSR                                        13250009
132600     END-EXEC.                                                    13260009
132700                                                                  13270009
132800     EVALUATE TRUE                                                13280009
132900         WHEN SQLCODE = +0                                        13290009
133000              CONTINUE                                            13300009
133100         WHEN SQLWARN0 NOT = SPACE                                13310009
133200         WHEN SQLCODE  NOT = +0                                   13320009
133300              MOVE '4020-CLOSE-CURSOR'                            13330009
133400                                   TO DP013-PARAGRAPH             13340009
133500              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      13350009
133600              MOVE SQLCA           TO DP013-SQLCA                 13360009
133700              MOVE 'TWRKORD'       TO DP013-DB2-TABLE-NAME (1)    13370009
133800              SET DP013-DB2-ABEND  TO TRUE                        13380009
133900              PERFORM DP013-0000-PROCESS-ABEND                    13390009
134000     END-EVALUATE.                                                13400009
134100                                                                  13410009
134200/                                                                 13420009
134300*----------------------------------------------------------------*13430009
134400*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *13440009
134500*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *13450009
134600*----------------------------------------------------------------*13460009
134700                                                                  13470009
134800 4100-PREPARE-CURSOR.                                             13480009
134900                                                                  13490009
135000     MOVE ASC-OPERATING-UNIT-ID                                   13500009
135100                           TO DK-OPERATING-UNIT-ID                13510009
135200     MOVE ASC-FACILITY-ID  TO DK-FACILITY-ID                      13520009
135300     MOVE ASC-PO-NBR       TO DK-ORD-NBR                          13530009
135400     MOVE ASC-REC-SEQ-NBR  TO DK-RCVR-SEQ-NBR                     13540009
135500     MOVE ASC-LINE-NBR     TO DK-LINE-NBR.                        13550009
135600                                                                  13560009
135700     MOVE +0               TO DK-WORK-ORD-SEQ-NBR-LOW             13570009
135800     MOVE +9999            TO DK-WORK-ORD-SEQ-NBR-HIGH            13580009
135900     MOVE LOW-VALUES       TO DK-STAT-CDE-LOW                     13590009
136000     MOVE HIGH-VALUES      TO DK-STAT-CDE-HIGH.                   13600009
136100/                                                                 13610009
136200*----------------------------------------------------------------*13620009
136300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *13630009
136400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *13640009
136500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *13650009
136600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *13660009
136700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *13670009
136800*                                                                *13680009
136900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *13690009
137000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *13700009
137100*    UPON INITIALIZATION.                                        *13710009
137200*----------------------------------------------------------------*13720009
137300                                                                  13730009
137400 4300-READ-ITEMS-FROM-DB.                                         13740009
137500                                                                  13750009
137600     PERFORM                                                      13760009
137700         VARYING PV-READ-COUNT                                    13770009
137800         FROM 1 BY 1                                              13780009
137900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    13790009
138000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         13800009
138100                                                                  13810009
138200         PERFORM 4310-FETCH                                       13820009
138300                                                                  13830009
138400         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 13840009
138500         MOVE ZERO                 TO ASC-SEL-ITEM                13850009
138600         SET PS-WRKORD-ROW-NOT-FOUND                              13860009
138700                                   TO TRUE                        13870009
138800         SET PS-NOT-END-OF-SEL-ITEMS-QUEUE                        13880009
138900                                   TO TRUE                        13890009
139000                                                                  13900009
139100         PERFORM 4320-CHECK-SEL-ITEM-QUEUE                        13910009
139200             UNTIL ((PS-WRKORD-ROW-FOUND)                         13920009
139300                OR (PS-END-OF-SEL-ITEMS-QUEUE))                   13930009
139400                                                                  13940009
139500         IF  ((ASC-ITEMS-LEFT-ON-DB)                              13950009
139600         AND (PS-WRKORD-ROW-FOUND))                               13960009
139700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                13970009
139800                 ADD +1            TO ASC-ITEM-SUB                13980009
139900             ELSE                                                 13990009
140000                 ADD +1            TO ASC-BLK-SUB                 14000009
140100                 MOVE +1           TO ASC-ITEM-SUB                14010009
140200                                                                  14020009
140300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         14030009
140400                     MOVE +1       TO ASC-BLK-SUB                 14040009
140500                     SET ASC-BLOCK-MODIFIED (1)                   14050009
140600                                   TO TRUE                        14060009
140700                     PERFORM 5100-WRITE-TEMP-STORAGE              14070009
140800                     MOVE ASC-BLOCK-ENTRIES                       14080009
140900                               (PC-MAX-BLOCKS-IN-ARRAY)           14090009
141000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14100009
141100                     ADD +1        TO ASC-BLK-SUB                 14110009
141200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14120009
141300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14130009
141400                                   TO TRUE                        14140009
141500                 END-IF                                           14150009
141600             END-IF                                               14160009
141700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14170009
141800             MOVE ASC-NUMBER-OF-ITEMS-READ                        14180009
141900                                   TO ASC-LIST-ITEM-NUMBER        14190009
142000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14200009
142100             MOVE WRKORD-WORK-ORD-SEQ-NBR  TO                     14210009
142200                  ASC-WORK-ORD-SEQ-NBR(ASC-BLK-SUB ASC-ITEM-SUB)  14220009
142300             MOVE WRKORD-STAT-CDE          TO                     14230009
142400                  ASC-STAT-CDE        (ASC-BLK-SUB ASC-ITEM-SUB)  14240009
142500             MOVE WRKORD-EXPTED-CART-CNT   TO                     14250009
142600                  ASC-EXPTED-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)  14260009
142700             MOVE WRKORD-ACTL-CART-CNT     TO                     14270009
142800                  ASC-ACTL-CART-CNT   (ASC-BLK-SUB ASC-ITEM-SUB)  14280009
142900             MOVE WRKORD-EXPTED-ITM-CNT   TO                      14290009
143000                  ASC-EXPTED-ITM-CNT (ASC-BLK-SUB ASC-ITEM-SUB)   14300009
143100             MOVE WRKORD-ACTL-ITM-CNT      TO                     14310009
143200                  ASC-ACTL-ITM-CNT    (ASC-BLK-SUB ASC-ITEM-SUB)  14320009
143300         END-IF                                                   14330009
143400     END-PERFORM.                                                 14340009
143500                                                                  14350009
143600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14360009
143700*-->     ** NO LIST ITEMS TO DISPLAY                              14370009
143800         CONTINUE                                                 14380009
143900     ELSE                                                         14390009
144000         PERFORM 4330-GET-SKU-INFO                                14400009
144100         PERFORM 4331-CALL-CICS-API-ARCH                          14410013
144110                                                                  14411013
144200         MOVE PURCHS-DEPT-NBR       TO ASC-TPURCHS-DEPT-NBR       14420009
144300         MOVE PURITM-CL-NBR         TO ASC-TPURITM-CL-NBR         14430009
144400*        MOVE PURITM-SKU-SEQ-NBR    TO ASC-TPURITM-SKU-SEQ-NBR    14440013
144500         MOVE PURITM-SKU-DESC       TO ASC-TPURITM-SKU-DESC       14450009
144600         MOVE PURITM-VEND-STYL-NAME TO ASC-TPURITM-VEND-STYL-NAME 14460009
144700                                                                  14470009
144800         PERFORM 4340-GET-TRECITM-INFO                            14480009
144900                                                                  14490009
145000         MOVE RECITM-PKSL-ITM-QTY   TO ASC-TRECITM-PKSL-ITM-QTY   14500009
145100         MOVE RECITM-DTL-CK-ITM-QTY TO ASC-TRECITM-DTL-CK-ITM-QTY 14510009
145200         MOVE RECITM-EXPTED-CART-CNT                              14520009
145300                                    TO ASC-TRECITM-EXPTED-CART-CNT14530009
145400         MOVE RECITM-ACTL-CART-CNT  TO ASC-TRECITM-ACTL-CART-CNT  14540009
145500     END-IF                                                       14550009
145600                                                                  14560009
145700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14570009
145800         MOVE +1                   TO ASC-BLK-SUB                 14580009
145900         PERFORM 5100-WRITE-TEMP-STORAGE                          14590009
146000         ADD +1                    TO ASC-BLK-SUB                 14600009
146100         PERFORM 5100-WRITE-TEMP-STORAGE                          14610009
146200                                                                  14620009
146300         MOVE 1                    TO ASC-BLK-SUB                 14630009
146400                                      PV-BLOCK-NUMBER             14640009
146500         PERFORM 4410-READ-TEMP-STORAGE                           14650009
146600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             14660009
146700             MOVE 2                TO ASC-BLK-SUB                 14670009
146800                                      PV-BLOCK-NUMBER             14680009
146900             PERFORM 4410-READ-TEMP-STORAGE                       14690009
147000         END-IF                                                   14700009
147100     END-IF.                                                      14710009
147200                                                                  14720009
147300/                                                                 14730009
147400*----------------------------------------------------------------*14740009
147500*    FETCH A TWRKORD ROW                                         *14750009
147600*----------------------------------------------------------------*14760009
147700                                                                  14770009
147800 4310-FETCH.                                                      14780009
147900                                                                  14790009
148000     EXEC SQL                                                     14800009
148100         FETCH TWRKORD_CSR                                        14810009
148200            INTO :WRKORD-WORK-ORD-SEQ-NBR                         14820009
148300                ,:WRKORD-STAT-CDE                                 14830009
148400                ,:WRKORD-EXPTED-CART-CNT                          14840009
148500                ,:WRKORD-ACTL-CART-CNT                            14850009
148600                ,:WRKORD-EXPTED-ITM-CNT                           14860009
148700                ,:WRKORD-ACTL-ITM-CNT                             14870009
148800     END-EXEC.                                                    14880009
148900                                                                  14890009
149000     EVALUATE TRUE                                                14900009
149100         WHEN SQLCODE = +0                                        14910009
149200              CONTINUE                                            14920009
149300                                                                  14930009
149400         WHEN SQLCODE = +100                                      14940009
149500              SET ASC-NO-ITEMS-LEFT-ON-DB                         14950009
149600                                   TO TRUE                        14960009
149700                                                                  14970009
149800         WHEN SQLWARN0 NOT = SPACE                                14980009
149900         WHEN SQLCODE < +0                                        14990009
150000         WHEN SQLCODE > +0                                        15000009
150100              MOVE '4310-FETCH-CURSOR'                            15010009
150200                                   TO DP013-PARAGRAPH             15020009
150300              MOVE 'FETCH TWRKORD CURSOR'                         15030009
150400                                   TO DP013-MESSAGE-TEXT (1)      15040009
150500              MOVE SQLCA           TO DP013-SQLCA                 15050009
150600              MOVE 'TWRKORD'       TO DP013-DB2-TABLE-NAME (1)    15060009
150700              SET DP013-DB2-ABEND  TO TRUE                        15070009
150800              PERFORM DP013-0000-PROCESS-ABEND                    15080009
150900     END-EVALUATE.                                                15090009
151000                                                                  15100009
151100/                                                                 15110009
151200******************************************************************15120009
151300* READ THROUGH THE SELECTED-ITEMS TEMP STORAGE QUEUE TO FIND IF  *15130009
151400* THIS IS ONE OF THE ROWS THAT WAS SELECTED IN THE PREVIOUS      *15140009
151500* PROGRAM (PCKCS152).  THIS PARAGRAPH IS PROCESSED UNTIL EITHER  *15150009
151600* THE SELECTED ROW IS FOUND, OR THE END OF THE TEMP STORAGE QUEUE*15160009
151700* IS REACHED.                                                    *15170009
151800******************************************************************15180009
151900 4320-CHECK-SEL-ITEM-QUEUE.                                       15190009
152000                                                                  15200009
152100     ADD +1                                TO ASC-SEL-SUB.        15210009
152200                                                                  15220009
152300     IF ASC-SEL-SUB > PC016-MAX-ITEMS                             15230009
152400         ADD +1                            TO ASC-SEL-ITEM        15240009
152500         MOVE +1                           TO ASC-SEL-SUB         15250009
152600         IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS             15260009
152700             PERFORM 9100-READ-SEL-QUEUE                          15270009
152800         ELSE                                                     15280009
152900             SET PS-END-OF-SEL-ITEMS-QUEUE TO TRUE                15290009
153000         END-IF                                                   15300009
153100     END-IF.                                                      15310009
153200                                                                  15320009
153300     IF PC016-ITEM (ASC-SEL-SUB) > ZERO                           15330009
153400        IF  PC016-WO-NBR-N (ASC-SEL-SUB) = WRKORD-WORK-ORD-SEQ-NBR15340009
153500        AND PC016-RECVR-STATUS-CDE (ASC-SEL-SUB) = WRKORD-STAT-CDE15350009
153600             SET PS-WRKORD-ROW-FOUND               TO TRUE        15360009
153700        END-IF                                                    15370009
153800     ELSE                                                         15380009
153900        SET PS-END-OF-SEL-ITEMS-QUEUE              TO TRUE        15390009
154000     END-IF.                                                      15400009
154100                                                                  15410009
154200/                                                                 15420009
154300*----------------------------------------------------------------*15430009
154400*    GET SKU, SKU DESC, AND VENDOR STYLE FROM TPURCHS/TPURITM    *15440009
154500*----------------------------------------------------------------*15450009
154600 4330-GET-SKU-INFO.                                               15460009
154700                                                                  15470009
154800     INITIALIZE DCLTPURCHS                                        15480009
154900                DCLTPURITM.                                       15490009
155000                                                                  15500009
155100     PERFORM                                                      15510009
155200         WITH TEST AFTER                                          15520009
155300         VARYING PV-RETRY-COUNTER                                 15530009
155400         FROM 1 BY 1                                              15540009
155500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15550009
155600             OR (SQLCODE = +0)                                    15560009
155700             OR (SQLCODE = +100))                                 15570009
155800                                                                  15580009
155900         EXEC SQL                                                 15590009
156000              SELECT A.DEPT_NBR                                   15600009
156100                    ,B.CL_NBR                                     15610009
156200                    ,B.ITM_NBR                                    15620013
156300                    ,B.SKU_DESC                                   15630009
156400                    ,B.VEND_STYL_NAME                             15640009
156500                INTO :PURCHS-DEPT-NBR                             15650009
156600                    ,:PURITM-CL-NBR                               15660009
156700                    ,:PURITM-ITM-NBR                              15670013
156800                    ,:PURITM-SKU-DESC                             15680009
156900                    ,:PURITM-VEND-STYL-NAME                       15690009
157000                FROM TPURCHS A                                    15700009
157100                    ,TPURITM B                                    15710009
157200               WHERE A.PO_NBR          = :DK-ORD-NBR              15720009
157300                 AND A.VER_STATUS_CDE  = 'A'                      15730009
157400                 AND A.PO_NBR          =  B.PO_NBR                15740009
157500                 AND B.STATUS_CDE     IN ('AC', 'AP', 'RV')       15750009
157600                 AND B.VER_STATUS_CDE  = 'A'                      15760009
157700                 AND B.APP_PO_LNE_NBR  = :DK-LINE-NBR             15770009
157800         END-EXEC                                                 15780009
157900                                                                  15790009
158000         EVALUATE TRUE                                            15800009
158100             WHEN SQLCODE = +0                                    15810009
158200             WHEN SQLCODE = +100                                  15820009
158300             WHEN SQLCODE = -904                                  15830009
158400             WHEN SQLCODE = -913                                  15840009
158500                  CONTINUE                                        15850009
158600                                                                  15860009
158700             WHEN SQLWARN0 NOT = SPACES                           15870009
158800             WHEN SQLCODE < +0                                    15880009
158900             WHEN SQLCODE > +0                                    15890009
159000                  MOVE '4330-GET-SKU-INFO'                        15900009
159100                                  TO DP013-PARAGRAPH              15910009
159200                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS/TPURITM'   15920009
159300                                  TO DP013-MESSAGE-TEXT (1)       15930009
159400                  MOVE SQLCA      TO DP013-SQLCA                  15940009
159500                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     15950009
159600                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (2)     15960009
159700                  SET DP013-DB2-ABEND                             15970009
159800                      DP013-XCTL-DISPLAY-RESTART                  15980009
159900                                  TO TRUE                         15990009
160000                  PERFORM DP013-0000-PROCESS-ABEND                16000009
160100         END-EVALUATE                                             16010009
160200     END-PERFORM.                                                 16020009
160300                                                                  16030009
160400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16040009
160500         MOVE '4330-GET-SKU-INFO' TO DP013-PARAGRAPH              16050009
160600         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURCHS/TPURITM'    16060009
160700                                  TO DP013-MESSAGE-TEXT (1)       16070009
160800         MOVE SQLCA               TO DP013-SQLCA                  16080009
160900         MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     16090009
161000         MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (2)     16100009
161100         SET DP013-DB2-ABEND                                      16110009
161200             DP013-XCTL-DISPLAY-RESTART                           16120009
161300                                  TO TRUE                         16130009
161400         PERFORM DP013-0000-PROCESS-ABEND                         16140009
161500     END-IF.                                                      16150009
161600                                                                  16160009
161700/                                                                 16170009
161711*----------------------------------------------------------------*16171113
161712*    CALL LOGISTICS DOMAIN ITEM ACCESS MODULE                    *16171213
161713*----------------------------------------------------------------*16171313
161720 4331-CALL-CICS-API-ARCH.                                         16172013
161730                                                                  16173013
161731      INITIALIZE XL001-ITEM-COMMAREA                              16173113
161732                                                                  16173213
161733      MOVE PURITM-ITM-NBR   TO XL001-KEY-ITM-NBR.                 16173313
161734                                                                  16173413
161735      SET  XL001-BY-ITEM                                          16173513
161736           XL001-SELECT-SKU TO TRUE.                              16173613
161737                                                                  16173713
161738      CALL XL001-VSM-PGM USING  DFHEIBLK                          16173813
161739                                XL001-COMMAREA                    16173913
161740                                XL001-ITEM-COMMAREA.              16174013
161741                                                                  16174113
161742      EVALUATE TRUE                                               16174213
161743                                                                  16174313
161744          WHEN XL001-SUCCESSFUL                                   16174413
161745               MOVE XL001-SKU-NBR     TO ASC-NIS-SKU-SEQ-NBR      16174515
161746                                                                  16174613
161747          WHEN XL001-SQL-ERROR                                    16174713
161748               IF XL001-SKU-SQLCODE = +100                        16174813
161749                  MOVE '00000000'      TO ASC-NIS-SKU-SEQ-NBR     16174915
161751               ELSE                                               16175113
161752                  MOVE XL001-SKU-NBR   TO PV-DISPLAY-SKU-NBR      16175214
161753                  MOVE '4331-CALL-CICS-API-ARCH'                  16175314
161754                                       TO DP013-PARAGRAPH         16175414
161755                  MOVE 'UNSUCCESSFUL SELECT ON XLV SKU'           16175513
161756                                       TO DP013-MESSAGE-TEXT (1)  16175614
161757                  STRING 'XL VIEW ERROR PARA- '                   16175713
161758                                       DELIMITED BY SIZE          16175814
161759                  XL001-ERROR-PARAGRAPH-NBR DELIMITED BY SIZE     16175913
161760                                       INTO DP013-MESSAGE-TEXT (2)16176014
161761                  STRING 'SKU NUMBER : ' DELIMITED BY SIZE        16176113
161762                      PV-DISPLAY-SKU-NBR DELIMITED BY SIZE        16176213
161763                                  INTO DP013-MESSAGE-TEXT (3)     16176313
161764                  MOVE XL001-SKU-SQLCODE TO DP013-SQLCA           16176413
161765                  MOVE 'XLV_SKU'       TO DP013-DB2-TABLE-NAME (1)16176514
161766                  SET DP013-DB2-ABEND                             16176613
161767                      DP013-XCTL-DISPLAY-RESTART                  16176713
161768                                         TO TRUE                  16176814
161769                  PERFORM DP013-0000-PROCESS-ABEND                16176913
161770               END-IF                                             16177014
161771                                                                  16177113
161772               WHEN XL001-INVALID-ACCESS                          16177214
161773                  MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'       16177314
161774                                     TO DP013-PARAGRAPH           16177414
161775                  MOVE 'UNSUCCESSFUL SELECT ON XLV_SKU'           16177514
161776                                     TO DP013-MESSAGE-TEXT (1)    16177614
161777                  MOVE SQLCA         TO DP013-SQLCA               16177714
161778                  MOVE 'XLV_SKU'     TO DP013-DB2-TABLE-NAME (1)  16177814
161779                  SET DP013-DB2-ABEND                             16177914
161780                      DP013-XCTL-DISPLAY-RESTART                  16178014
161781                                     TO TRUE                      16178114
161782                                                                  16178213
161783                  PERFORM DP013-0000-PROCESS-ABEND                16178314
161784             WHEN OTHER                                           16178414
161785                  MOVE '4331-CALL-CICS-API-ARCH'                  16178514
161786                                     TO DP013-PARAGRAPH           16178614
161787                  MOVE 'UNSUCCESSFUL SELECT ON XLV_SKU'           16178714
161788                                     TO DP013-MESSAGE-TEXT (1)    16178814
161789                  MOVE SQLCA         TO DP013-SQLCA               16178914
161790                  MOVE 'XLV_SKU'     TO DP013-DB2-TABLE-NAME (1)  16179014
161791                  SET DP013-DB2-ABEND                             16179114
161792                      DP013-XCTL-DISPLAY-RESTART                  16179214
161793                                     TO TRUE                      16179314
161794                                                                  16179414
161795                  PERFORM DP013-0000-PROCESS-ABEND                16179514
161796             END-EVALUATE.                                        16179614
161802                                                                  16180213
161803/                                                                 16180313
161810*----------------------------------------------------------------*16181009
161900*    GET RECEIPT ITEM INFO FOR THE TOP OF THE SCREEN             *16190009
162000*----------------------------------------------------------------*16200009
162100 4340-GET-TRECITM-INFO.                                           16210009
162200                                                                  16220009
162300     INITIALIZE DCLTRECITM.                                       16230009
162400                                                                  16240009
162500     PERFORM                                                      16250009
162600         WITH TEST AFTER                                          16260009
162700         VARYING PV-RETRY-COUNTER                                 16270009
162800         FROM 1 BY 1                                              16280009
162900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16290009
163000             OR (SQLCODE = +0)                                    16300009
163100             OR (SQLCODE = +100))                                 16310009
163200                                                                  16320009
163300**                                                                16330009
163400         EXEC SQL                                                 16340009
163500              SELECT  PKSL_ITM_QTY                                16350009
163600                     ,DTL_CK_ITM_QTY                              16360009
163700                     ,EXPTED_CART_CNT                             16370009
163800                     ,ACTL_CART_CNT                               16380009
163900                INTO :RECITM-PKSL-ITM-QTY                         16390009
164000                    ,:RECITM-DTL-CK-ITM-QTY                       16400009
164100                    ,:RECITM-EXPTED-CART-CNT                      16410009
164200                    ,:RECITM-ACTL-CART-CNT                        16420009
164300                FROM TRECITM                                      16430009
164400               WHERE  ORD_NBR        = :DK-ORD-NBR                16440009
164500                 AND  ORD_LNE_NBR    = :DK-LINE-NBR               16450009
164600                 AND  REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR           16460009
164700                 AND  OPER_UNT_ID    = :DK-OPERATING-UNIT-ID      16470009
164800                 AND  FCLTY_ID       = :DK-FACILITY-ID            16480009
164900                 AND  VER_STATUS_CDE = 'A'                        16490009
165000         END-EXEC                                                 16500009
165100                                                                  16510009
165200         EVALUATE TRUE                                            16520009
165300             WHEN SQLCODE = +0                                    16530009
165400             WHEN SQLCODE = +100                                  16540009
165500             WHEN SQLCODE = -904                                  16550009
165600             WHEN SQLCODE = -913                                  16560009
165700                  CONTINUE                                        16570009
165800                                                                  16580009
165900             WHEN SQLWARN0 NOT = SPACES                           16590009
166000             WHEN SQLCODE < +0                                    16600009
166100             WHEN SQLCODE > +0                                    16610009
166200                  MOVE '4340-GET-TRECITM-INFO'                    16620009
166300                                  TO DP013-PARAGRAPH              16630009
166400                  MOVE 'UNSUCCESSFUL SELECT ON TRECITM'           16640009
166500                                  TO DP013-MESSAGE-TEXT (1)       16650009
166600                  MOVE SQLCA      TO DP013-SQLCA                  16660009
166700                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)     16670009
166800                  SET DP013-DB2-ABEND                             16680009
166900                      DP013-XCTL-DISPLAY-RESTART                  16690009
167000                                  TO TRUE                         16700009
167100                  PERFORM DP013-0000-PROCESS-ABEND                16710009
167200         END-EVALUATE                                             16720009
167300     END-PERFORM.                                                 16730009
167400                                                                  16740009
167500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16750009
167600         MOVE '4340-GET-TRECITM-INFO' TO DP013-PARAGRAPH          16760009
167700         MOVE 'MAX RETRIES EXCEEDED ON SELECT TRECITM'            16770009
167800                                  TO DP013-MESSAGE-TEXT (1)       16780009
167900         MOVE SQLCA               TO DP013-SQLCA                  16790009
168000         MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)     16800009
168100         SET DP013-DB2-ABEND                                      16810009
168200             DP013-XCTL-DISPLAY-RESTART                           16820009
168300                                  TO TRUE                         16830009
168400         PERFORM DP013-0000-PROCESS-ABEND                         16840009
168500     END-IF.                                                      16850009
168600                                                                  16860009
168700/                                                                 16870009
168800*----------------------------------------------------------------*16880009
168900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16890009
169000*----------------------------------------------------------------*16900009
169100                                                                  16910009
169200 4400-MOVE-COMMAREA-TO-SCREEN.                                    16920009
169300                                                                  16930009
169400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16940009
169500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16950009
169600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16960009
169700             MOVE +1               TO ASC-BLK-SUB                 16970009
169800             PERFORM 5100-WRITE-TEMP-STORAGE                      16980009
169900             ADD +1                TO ASC-BLK-SUB                 16990009
170000             PERFORM 5100-WRITE-TEMP-STORAGE                      17000009
170100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17010009
170200                 GIVING PV-BLOCK-NUMBER                           17020009
170300                 REMAINDER PV-REMAINDER                           17030009
170400             IF  PV-REMAINDER > ZERO                              17040009
170500                 ADD +1            TO PV-BLOCK-NUMBER             17050009
170600             END-IF                                               17060009
170700             MOVE +1               TO ASC-BLK-SUB                 17070009
170800             PERFORM 4410-READ-TEMP-STORAGE                       17080009
170900             ADD +1                TO ASC-BLK-SUB                 17090009
171000                                      PV-BLOCK-NUMBER             17100009
171100             PERFORM 4410-READ-TEMP-STORAGE                       17110009
171200     END-IF.                                                      17120009
171300                                                                  17130009
171400     MOVE +1                       TO ASC-BLK-SUB.                17140009
171500                                                                  17150009
171600     COMPUTE ASC-ITEM-SUB =                                       17160009
171700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17170009
171800         + PC-ITEMS-PER-PANEL).                                   17180009
171900                                                                  17190009
172000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17200009
172100         ADD +1                    TO ASC-BLK-SUB                 17210009
172200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17220009
172300     END-IF.                                                      17230009
172400                                                                  17240009
172500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17250009
172600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17260009
172700                                                                  17270009
172800     PERFORM 4420-FORMAT-LIST-LINES                               17280009
172900         VARYING PV-SUB                                           17290009
173000         FROM PC-ITEMS-PER-PANEL BY -1                            17300009
173100         UNTIL PV-SUB < +1.                                       17310009
173200                                                                  17320009
173300     COMPUTE ASC-ITEMS-DISPLAYED =                                17330009
173400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17340009
173500                                                                  17350009
173600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17360009
173700                                      ASTRTITO.                   17370009
173800                                                                  17380009
173900     MOVE ASC-OPERATING-UNIT-ID        TO AOPERIDO                17390009
174000     MOVE ASC-FACILITY-ID              TO AFACLIDO                17400009
174100     MOVE ASC-PO-NBR                   TO PONBRO                  17410009
174200     MOVE ASC-REC-SEQ-NBR              TO RCVRSEQO                17420009
174300     MOVE ASC-LINE-NBR                 TO LINENBRO                17430009
174400                                                                  17440009
174500     MOVE ASC-TRECITM-PKSL-ITM-QTY     TO PACKCNTO                17450009
174600     MOVE ASC-TRECITM-DTL-CK-ITM-QTY   TO DTCKQTYO                17460009
174700     MOVE ASC-TRECITM-EXPTED-CART-CNT  TO EXCRTCTO                17470009
174800     MOVE ASC-TRECITM-ACTL-CART-CNT    TO ACCRTCTO                17480009
174900                                                                  17490009
175000     MOVE SPACES                       TO SKUO                    17500009
175100                                                                  17510009
175200*    IF (ASC-TPURCHS-DEPT-NBR > SPACES) AND                       17520013
175300*       (ASC-TPURITM-CL-NBR > SPACES) AND                         17530013
175400*       (ASC-TPURITM-SKU-SEQ-NBR > SPACES)                        17540013
175500*        STRING ASC-TPURCHS-DEPT-NBR       DELIMITED BY SIZE      17550013
175600*               '-'                        DELIMITED BY SIZE      17560013
175700*               ASC-TPURITM-CL-NBR         DELIMITED BY SIZE      17570013
175800*               '-'                        DELIMITED BY SIZE      17580013
175900*               ASC-TPURITM-SKU-SEQ-NBR    DELIMITED BY SIZE      17590013
176000*                                    INTO SKUO                    17600013
176100*    END-IF.                                                      17610013
176200                                                                  17620009
176201     MOVE ASC-NIS-SKU-SEQ-NBR          TO SKUO                    17620115
176210     MOVE ASC-TPURITM-CL-NBR           TO CLASSO                  17621015
176220     MOVE ASC-TPURCHS-DEPT-NBR         TO DEPTO                   17622015
176230                                                                  17623013
176300     MOVE ASC-TPURITM-SKU-DESC         TO SKUDESCO                17630009
176400     MOVE ASC-TPURITM-VEND-STYL-NAME   TO VDRSTYLO                17640009
176500                                                                  17650009
176600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17660009
176700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17670009
176800                                                                  17680009
176900     IF  DP020-MSG-NUMBER-X = SPACE                               17690009
177000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17700009
177100*            --- MORE ITEMS TO DISPLAY ----                       17710009
177200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17720009
177300             SET DP020-MSG-INFORMATIONAL                          17730009
177400                                   TO TRUE                        17740009
177500         END-IF                                                   17750009
177600     END-IF.                                                      17760009
177700                                                                  17770009
177800*----------------------------------------------------------------*17780009
177900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17790009
178000*----------------------------------------------------------------*17800009
178100                                                                  17810009
178200 4410-READ-TEMP-STORAGE.                                          17820009
178300                                                                  17830009
178400     EXEC CICS                                                    17840009
178500         READQ TS                                                 17850009
178600             QUEUE (ASC-LIST-QUEUE-NAME)                          17860009
178700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17870009
178800             ITEM  (PV-BLOCK-NUMBER)                              17880009
178900             RESP  (PV-CICS-RESP)                                 17890009
179000     END-EXEC.                                                    17900009
179100                                                                  17910009
179200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17920009
179300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17930009
179400         CONTINUE                                                 17940009
179500     ELSE                                                         17950009
179600         SET DP013-CICS-ABEND      TO TRUE                        17960009
179700         SET DP013-NO-ROLLBACK     TO TRUE                        17970009
179800         MOVE '4410-READ-TEMP-STORAGE'                            17980009
179900                                   TO DP013-PARAGRAPH             17990009
180000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18000009
180100                                   TO DP013-MESSAGE-TEXT(1)       18010009
180200         PERFORM DP013-0000-PROCESS-ABEND                         18020009
180300     END-IF.                                                      18030009
180400                                                                  18040009
180500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      18050009
180600                                   TO TRUE.                       18060009
180700                                                                  18070009
180800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18080009
180900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18090009
181000     END-IF.                                                      18100009
181100                                                                  18110009
181200/                                                                 18120009
181300*----------------------------------------------------------------*18130009
181400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18140009
181500*----------------------------------------------------------------*18150009
181600                                                                  18160009
181700 4420-FORMAT-LIST-LINES.                                          18170009
181800**                                                                18180009
181900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18190009
182000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18200009
182100         MOVE DP015-ASK-DRK-OFF    TO MR-ACTL-CART-CNTA   (PV-SUB)18210009
182200                                      MR-ACTL-ITM-CNTA    (PV-SUB)18220009
182300         MOVE ZEROS                TO MR-WORK-ORD-SEQ-NBR (PV-SUB)18230009
182400                                      MR-EXPTED-CART-CNT  (PV-SUB)18240009
182500                                      MR-ACTL-CART-CNT    (PV-SUB)18250009
182600                                      MR-ACTL-ITM-CNT     (PV-SUB)18260009
182700                                      MR-EXPTED-ITM-CNT   (PV-SUB)18270009
182800         MOVE SPACES               TO MR-WORK-ORD-STAT-CDE(PV-SUB)18280009
182900     ELSE                                                         18290009
183000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18300009
183100             MOVE ASC-WORK-ORD-SEQ-NBR(ASC-BLK-SUB ASC-ITEM-SUB)  18310009
183200               TO                     MR-WORK-ORD-SEQ-NBR (PV-SUB)18320009
183300             MOVE ASC-STAT-CDE        (ASC-BLK-SUB ASC-ITEM-SUB)  18330009
183400               TO                     MR-WORK-ORD-STAT-CDE(PV-SUB)18340009
183500             MOVE ASC-EXPTED-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)  18350009
183600               TO                     MR-EXPTED-CART-CNT  (PV-SUB)18360009
183700             MOVE ASC-ACTL-CART-CNT   (ASC-BLK-SUB ASC-ITEM-SUB)  18370009
183800               TO                     MR-ACTL-CART-CNT    (PV-SUB)18380009
183900             MOVE ASC-EXPTED-ITM-CNT  (ASC-BLK-SUB ASC-ITEM-SUB)  18390009
184000               TO                     MR-EXPTED-ITM-CNT   (PV-SUB)18400009
184100             MOVE ASC-ACTL-ITM-CNT    (ASC-BLK-SUB ASC-ITEM-SUB)  18410009
184200               TO                     MR-ACTL-ITM-CNT     (PV-SUB)18420009
184300         END-IF                                                   18430009
184400     END-IF.                                                      18440009
184500                                                                  18450009
184600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18460009
184700                                                                  18470009
184800     IF  ASC-ITEM-SUB < + 1                                       18480009
184900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18490009
185000         MOVE +1                   TO ASC-BLK-SUB                 18500009
185100     END-IF.                                                      18510009
185200                                                                  18520009
185300/                                                                 18530009
185400*----------------------------------------------------------------*18540009
185500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18550009
185600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18560009
185700* FOR THE SELECTED ITEMS QUEUE.                                  *18570009
185800*                                                                *18580009
185900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18590009
186000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18600009
186100* THE ARRAY IS FULL.                                             *18610009
186200*----------------------------------------------------------------*18620009
186300                                                                  18630009
186400 5000-UPDATE-PROCESS.                                             18640009
186500                                                                  18650009
186600     MOVE +1                   TO  ASC-BLK-SUB.                   18660009
186700     PERFORM 5100-WRITE-TEMP-STORAGE.                             18670009
186800     ADD +1                    TO  ASC-BLK-SUB.                   18680009
186900     PERFORM 5100-WRITE-TEMP-STORAGE.                             18690009
187000                                                                  18700009
187100     PERFORM 5200-UPDATE-IN-TSQUEUE                               18710009
187200             VARYING PV-ITEM                                      18720009
187300             FROM 1 BY 1                                          18730009
187400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18740009
187500                                                                  18750009
187600*----------------------------------------------------------------*18760009
187700*    WE WILL ONLY UPDATE TRECITM INFO WITH THE TWRKORD CHANGES   *18770009
187800*    WHERE THE TRECITM LINE NUMBER IS GREATER THAN ZERO.         *18780009
187900*----------------------------------------------------------------*18790009
188000     IF (PS-UPDATED) AND                                          18800009
188100        (ASC-LINE-NBR > 0)                                        18810009
188200         PERFORM 5400-SUM-ACTL-CART-ITM-CNTS                      18820009
188300         PERFORM 5500-LINK-AUDIT-MODULE                           18830009
188400         PERFORM 5520-UPDATE-TRECITM                              18840009
188500     END-IF                                                       18850009
188600                                                                  18860009
188700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18870009
188800                                 ASC-BLOCK-ENTRIES (2).           18880009
188900                                                                  18890009
189000/                                                                 18900009
189100*----------------------------------------------------------------*18910009
189200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18920009
189300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18930009
189400*----------------------------------------------------------------*18940009
189500                                                                  18950009
189600 5100-WRITE-TEMP-STORAGE.                                         18960009
189700                                                                  18970009
189800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18980009
189900                                   TO PV-LIST-ITEM-NUMBER.        18990009
190000     COMPUTE PV-BLOCK-NUMBER =                                    19000009
190100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19010009
190200                                                                  19020009
190300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19030009
190400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19040009
190500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19050009
190600             PERFORM 5105-REWRITE-ASC-LISTQ                       19060009
190700         END-IF                                                   19070009
190800     ELSE                                                         19080009
190900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19090009
191000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19100009
191100         PERFORM 5110-WRITE-ASC-LISTQ                             19110009
191200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19120009
191300     END-IF.                                                      19130009
191400                                                                  19140009
191500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      19150009
191600                                   TO TRUE.                       19160009
191700                                                                  19170009
191800/                                                                 19180009
191900*----------------------------------------------------------------*19190009
192000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *19200009
192100*  SPECIFIC COMMAREA.                                            *19210009
192200*----------------------------------------------------------------*19220009
192300 5105-REWRITE-ASC-LISTQ.                                          19230009
192400                                                                  19240009
192500     EXEC CICS                                                    19250009
192600         WRITEQ TS                                                19260009
192700             QUEUE (ASC-LIST-QUEUE-NAME)                          19270009
192800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19280009
192900             ITEM  (PV-BLOCK-NUMBER)                              19290009
193000             REWRITE                                              19300009
193100             RESP  (PV-CICS-RESP)                                 19310009
193200     END-EXEC.                                                    19320009
193300                                                                  19330009
193400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19340009
193500         CONTINUE                                                 19350009
193600     ELSE                                                         19360009
193700         SET DP013-CICS-ABEND      TO TRUE                        19370009
193800         SET DP013-NO-ROLLBACK     TO TRUE                        19380009
193900         MOVE '5105-REWRITE-ASC-LISTQ'                            19390009
194000                                   TO DP013-PARAGRAPH             19400009
194100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19410009
194200                                   TO DP013-MESSAGE-TEXT(1)       19420009
194300         PERFORM DP013-0000-PROCESS-ABEND                         19430009
194400     END-IF.                                                      19440009
194500                                                                  19450009
194600/                                                                 19460009
194700*----------------------------------------------------------------*19470009
194800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *19480009
194900*  SPECIFIC COMMAREA.                                            *19490009
195000*----------------------------------------------------------------*19500009
195100 5110-WRITE-ASC-LISTQ.                                            19510009
195200                                                                  19520009
195300     EXEC CICS                                                    19530009
195400         WRITEQ TS                                                19540009
195500             QUEUE (ASC-LIST-QUEUE-NAME)                          19550009
195600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19560009
195700             ITEM  (PV-BLOCK-NUMBER)                              19570009
195800             RESP  (PV-CICS-RESP)                                 19580009
195900     END-EXEC.                                                    19590009
196000                                                                  19600009
196100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19610009
196200         SET DP013-CICS-ABEND      TO TRUE                        19620009
196300         SET DP013-NO-ROLLBACK     TO TRUE                        19630009
196400         MOVE '5110-WRITE-ASC-LISTQ'                              19640009
196500                                   TO DP013-PARAGRAPH             19650009
196600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19660009
196700                                   TO DP013-MESSAGE-TEXT(1)       19670009
196800         PERFORM DP013-0000-PROCESS-ABEND                         19680009
196900     END-IF.                                                      19690009
197000                                                                  19700009
197100/                                                                 19710009
197200*----------------------------------------------------------------*19720009
197300*    READ A LIST QUEUE RECORD AND UPDATE THE DB2 TABLES FOR EACH *19730009
197400*    ITEM THAT HAS CHANGED.                                      *19740009
197500*----------------------------------------------------------------*19750009
197600                                                                  19760009
197700 5200-UPDATE-IN-TSQUEUE.                                          19770009
197800                                                                  19780009
197900     PERFORM 6112-READ-LIST-QUEUE.                                19790009
198000                                                                  19800009
198100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19810009
198200         PERFORM                                                  19820009
198300         VARYING LQW-IDX                                          19830009
198400         FROM 1 BY 1                                              19840009
198500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19850009
198600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19860009
198700                                                                  19870009
198800             IF  LQW-UPDATED(LQW-IDX)                             19880009
198900                 MOVE ASC-OPERATING-UNIT-ID                       19890009
199000                                   TO  DK-OPERATING-UNIT-ID       19900009
199100                 MOVE ASC-FACILITY-ID                             19910009
199200                                   TO  DK-FACILITY-ID             19920009
199300                 MOVE ASC-PO-NBR   TO  DK-ORD-NBR                 19930009
199400                 MOVE ASC-REC-SEQ-NBR                             19940009
199500                                   TO  DK-RCVR-SEQ-NBR            19950009
199600                 MOVE ASC-LINE-NBR TO  DK-LINE-NBR                19960009
199700                 MOVE LQW-WORK-ORD-SEQ-NBR (LQW-IDX)              19970009
199800                                   TO  DK-WORK-ORD-SEQ-NBR        19980009
199900                 MOVE LQW-STAT-CDE         (LQW-IDX)              19990009
200000                                   TO  DK-STAT-CDE                20000009
200100                                                                  20010009
200200                 PERFORM 5300-READ-TWRKORD-FOR-UPDATE             20020009
200300                 PERFORM 5310-UPDATE-TWRKORD                      20030009
200400                                                                  20040009
200500                 MOVE LQW-ACTL-CART-CNT    (LQW-IDX)              20050009
200600                                   TO  WRKORD-ACTL-CART-CNT       20060009
200700                 MOVE LQW-ACTL-ITM-CNT     (LQW-IDX)              20070009
200800                                   TO  WRKORD-ACTL-ITM-CNT        20080009
200900                                                                  20090009
201000                 SET PS-UPDATED    TO  TRUE                       20100009
201100                 PERFORM 5320-INSERT-TWRKORD                      20110009
201200                 PERFORM 5330-UPDATE-TWKORIN                      20120009
201300             END-IF                                               20130009
201400                                                                  20140009
201500         END-PERFORM                                              20150009
201600     END-IF.                                                      20160009
201700                                                                  20170009
201800     PERFORM 6111-WRITE-LIST-QUEUE.                               20180009
201900/                                                                 20190009
202000******************************************************************20200009
202100** THIS PARAGRAPH WILL READ ALL COLUMNS IN THE WORK ORDER TABLE **20210009
202200** (TWRKORD) FOR A SPECIFIED ROW.  THESE VALUES WILL BE USED    **20220009
202300** WHEN DOING AN INSERT TO THE TABLE WITH THE UPDATED ACTUAL    **20230009
202400** CARTON COUNT AND ACTUAL ITEM COUNT INFORMATION.              **20240009
202500******************************************************************20250009
202600 5300-READ-TWRKORD-FOR-UPDATE.                                    20260009
202700                                                                  20270009
202800     PERFORM                                                      20280009
202900         WITH TEST AFTER                                          20290009
203000         VARYING PV-RETRY-COUNTER                                 20300009
203100         FROM 1 BY 1                                              20310009
203200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20320009
203300             OR (SQLCODE = +0))                                   20330009
203400                                                                  20340009
203500         EXEC SQL                                                 20350009
203600           SELECT ORD_NBR                                         20360009
203700                 ,RCVR_SEQ_NBR                                    20370009
203800                 ,ORD_LNE_NBR                                     20380009
203900                 ,WORK_ORD_SEQ_NBR                                20390009
204000                 ,OPER_UNT_ID                                     20400009
204100                 ,FCLTY_ID                                        20410009
204200                 ,CRE_TMST                                        20420009
204300                 ,VER_STATUS_CDE                                  20430009
204400                 ,CRE_UID_ID                                      20440009
204500                 ,EXPTED_CART_CNT                                 20450009
204600                 ,ACTL_CART_CNT                                   20460009
204700                 ,EXPTED_ITM_CNT                                  20470009
204800                 ,ACTL_ITM_CNT                                    20480009
204900                 ,STAT_CDE                                        20490009
205000                 ,WORK_ORD_DISTR_IND                              20500009
205100                 ,OPER_SET_ID                                     20510009
205200             INTO :WRKORD-ORD-NBR                                 20520009
205300                 ,:WRKORD-RCVR-SEQ-NBR                            20530009
205400                 ,:WRKORD-ORD-LNE-NBR                             20540009
205500                 ,:WRKORD-WORK-ORD-SEQ-NBR                        20550009
205600                 ,:WRKORD-OPER-UNT-ID                             20560009
205700                 ,:WRKORD-FCLTY-ID                                20570009
205800                 ,:WRKORD-CRE-TMST                                20580009
205900                 ,:WRKORD-VER-STATUS-CDE                          20590009
206000                 ,:WRKORD-CRE-UID-ID                              20600009
206100                 ,:WRKORD-EXPTED-CART-CNT                         20610009
206200                 ,:WRKORD-ACTL-CART-CNT                           20620009
206300                 ,:WRKORD-EXPTED-ITM-CNT                          20630009
206400                 ,:WRKORD-ACTL-ITM-CNT                            20640009
206500                 ,:WRKORD-STAT-CDE                                20650009
206600                 ,:WRKORD-WORK-ORD-DISTR-IND                      20660009
206700                 ,:WRKORD-OPER-SET-ID                             20670009
206800           FROM   TWRKORD                                         20680009
206900           WHERE  ORD_NBR          = :DK-ORD-NBR                  20690009
207000             AND  RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR             20700009
207100             AND  ORD_LNE_NBR      = :DK-LINE-NBR                 20710009
207200             AND  WORK_ORD_SEQ_NBR = :DK-WORK-ORD-SEQ-NBR         20720009
207300             AND  OPER_UNT_ID      = :DK-OPERATING-UNIT-ID        20730009
207400             AND  FCLTY_ID         = :DK-FACILITY-ID              20740009
207500             AND  VER_STATUS_CDE   = 'A'                          20750009
207600             AND  STAT_CDE         = :DK-STAT-CDE                 20760009
207700         END-EXEC                                                 20770009
207800                                                                  20780009
207900         EVALUATE TRUE                                            20790009
208000             WHEN SQLCODE = +0                                    20800009
208100             WHEN SQLCODE = -904                                  20810009
208200             WHEN SQLCODE = -913                                  20820009
208300                 CONTINUE                                         20830009
208400                                                                  20840009
208500             WHEN SQLWARN0 NOT = SPACES                           20850009
208600             WHEN SQLCODE < +0                                    20860009
208700             WHEN SQLCODE > +0                                    20870009
208800                 MOVE '5300-READ-TWRKORD-FOR-UPDATE'              20880009
208900                                   TO DP013-PARAGRAPH             20890009
209000                 MOVE 'ERROR READING TWRKORD FOR UPDATE '         20900009
209100                                   TO DP013-MESSAGE-TEXT(1)       20910009
209200                 MOVE SQLCA        TO DP013-SQLCA                 20920009
209300                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    20930009
209400                 SET DP013-DB2-ABEND                              20940009
209500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20950009
209600                 PERFORM DP013-0000-PROCESS-ABEND                 20960009
209700         END-EVALUATE                                             20970009
209800     END-PERFORM.                                                 20980009
209900                                                                  20990009
210000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21000009
210100         MOVE '5300-READ-TWRKORD-FOR-UPDATE'                      21010009
210200                                   TO DP013-PARAGRAPH             21020009
210300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              21030009
210400                                   TO DP013-MESSAGE-TEXT (1)      21040009
210500         MOVE 'TO READ A ROW FROM TWRKORD FOR UPDATE'             21050009
210600                                   TO DP013-MESSAGE-TEXT (2)      21060009
210700         MOVE SQLCA                TO DP013-SQLCA                 21070009
210800         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    21080009
210900         SET DP013-DB2-ABEND                                      21090009
211000             DP013-XCTL-DISPLAY-RESTART                           21100009
211100                                   TO TRUE                        21110009
211200         PERFORM DP013-0000-PROCESS-ABEND                         21120009
211300     END-IF.                                                      21130009
211400                                                                  21140009
211500/                                                                 21150009
211600******************************************************************21160009
211700** THIS PARAGRAPH WILL STATUS THE CURRENT ROW INACTIVE.  THIS   **21170009
211800** IS BEING DONE FOR AUDITING PURPOSES.                         **21180009
211900******************************************************************21190009
212000 5310-UPDATE-TWRKORD.                                             21200009
212100                                                                  21210009
212200     PERFORM                                                      21220009
212300         WITH TEST AFTER                                          21230009
212400         VARYING PV-RETRY-COUNTER                                 21240009
212500         FROM 1 BY 1                                              21250009
212600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21260009
212700             OR (SQLCODE = +0))                                   21270009
212800                                                                  21280009
212900         EXEC SQL                                                 21290009
213000           UPDATE TWRKORD                                         21300009
213100              SET VER_STATUS_CDE = 'I'                            21310009
213200           WHERE  ORD_NBR          = :DK-ORD-NBR                  21320009
213300             AND  RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR             21330009
213400             AND  ORD_LNE_NBR      = :DK-LINE-NBR                 21340009
213500             AND  WORK_ORD_SEQ_NBR = :DK-WORK-ORD-SEQ-NBR         21350009
213600             AND  OPER_UNT_ID      = :DK-OPERATING-UNIT-ID        21360009
213700             AND  FCLTY_ID         = :DK-FACILITY-ID              21370009
213800             AND  VER_STATUS_CDE   = 'A'                          21380009
213900             AND  STAT_CDE         = :DK-STAT-CDE                 21390009
214000         END-EXEC                                                 21400009
214100                                                                  21410009
214200         EVALUATE TRUE                                            21420009
214300             WHEN SQLCODE = +0                                    21430009
214400             WHEN SQLCODE = -904                                  21440009
214500             WHEN SQLCODE = -913                                  21450009
214600                 CONTINUE                                         21460009
214700                                                                  21470009
214800             WHEN SQLWARN0 NOT = SPACES                           21480009
214900             WHEN SQLCODE < +0                                    21490009
215000             WHEN SQLCODE > +0                                    21500009
215100                 MOVE '5310-UPDATE-TWRKORD'                       21510009
215200                                   TO DP013-PARAGRAPH             21520009
215300                 MOVE 'ERROR UPDATING TWRKORD '                   21530009
215400                                   TO DP013-MESSAGE-TEXT(1)       21540009
215500                 MOVE SQLCA        TO DP013-SQLCA                 21550009
215600                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    21560009
215700                 SET DP013-DB2-ABEND                              21570009
215800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21580009
215900                 PERFORM DP013-0000-PROCESS-ABEND                 21590009
216000         END-EVALUATE                                             21600009
216100     END-PERFORM.                                                 21610009
216200                                                                  21620009
216300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21630009
216400         MOVE '5310-UPDATE-TWRKORD'                               21640009
216500                                   TO DP013-PARAGRAPH             21650009
216600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              21660009
216700                                   TO DP013-MESSAGE-TEXT (1)      21670009
216800         MOVE 'TO UPDATE A ROW ON TWORKORD'                       21680009
216900                                   TO DP013-MESSAGE-TEXT (2)      21690009
217000         MOVE SQLCA                TO DP013-SQLCA                 21700009
217100         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    21710009
217200         SET DP013-DB2-ABEND                                      21720009
217300             DP013-XCTL-DISPLAY-RESTART                           21730009
217400                                   TO TRUE                        21740009
217500         PERFORM DP013-0000-PROCESS-ABEND                         21750009
217600     END-IF.                                                      21760009
217700                                                                  21770009
217800/                                                                 21780009
217900******************************************************************21790009
218000** THIS PARAGRAPH WILL INSERT A NEW ROW INTO THE WORK ORDER     **21800009
218100** TABLE (TWRKORD) THAT CONTAINS THE UPDATED ACTUAL CARTON      **21810009
218200** COUNT AND ACTUAL ITEM COUNT INFORMATION.                     **21820009
218300******************************************************************21830009
218400 5320-INSERT-TWRKORD.                                             21840009
218500                                                                  21850009
218600     PERFORM                                                      21860009
218700         WITH TEST AFTER                                          21870009
218800         VARYING PV-RETRY-COUNTER                                 21880009
218900         FROM 1 BY 1                                              21890009
219000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21900009
219100             OR (SQLCODE = +0))                                   21910009
219200                                                                  21920009
219300         EXEC SQL                                                 21930009
219400           INSERT  INTO TWRKORD                                   21940009
219500                  (ORD_NBR                                        21950009
219600                  ,RCVR_SEQ_NBR                                   21960009
219700                  ,ORD_LNE_NBR                                    21970009
219800                  ,WORK_ORD_SEQ_NBR                               21980009
219900                  ,OPER_UNT_ID                                    21990009
220000                  ,FCLTY_ID                                       22000009
220100                  ,CRE_TMST                                       22010009
220200                  ,VER_STATUS_CDE                                 22020009
220300                  ,CRE_UID_ID                                     22030009
220400                  ,EXPTED_CART_CNT                                22040009
220500                  ,ACTL_CART_CNT                                  22050009
220600                  ,EXPTED_ITM_CNT                                 22060009
220700                  ,ACTL_ITM_CNT                                   22070009
220800                  ,STAT_CDE                                       22080009
220900                  ,WORK_ORD_DISTR_IND                             22090009
221000                  ,OPER_SET_ID)                                   22100009
221100           VALUES (:WRKORD-ORD-NBR                                22110009
221200                  ,:WRKORD-RCVR-SEQ-NBR                           22120009
221300                  ,:WRKORD-ORD-LNE-NBR                            22130009
221400                  ,:WRKORD-WORK-ORD-SEQ-NBR                       22140009
221500                  ,:WRKORD-OPER-UNT-ID                            22150009
221600                  ,:WRKORD-FCLTY-ID                               22160009
221700                  , CURRENT TIMESTAMP                             22170009
221800                  ,:WRKORD-VER-STATUS-CDE                         22180009
221900                  ,:DP020-USERID                                  22190009
222000                  ,:WRKORD-EXPTED-CART-CNT                        22200009
222100                  ,:WRKORD-ACTL-CART-CNT                          22210009
222200                  ,:WRKORD-EXPTED-ITM-CNT                         22220009
222300                  ,:WRKORD-ACTL-ITM-CNT                           22230009
222400                  ,:WRKORD-STAT-CDE                               22240009
222500                  ,:WRKORD-WORK-ORD-DISTR-IND                     22250009
222600                  ,:WRKORD-OPER-SET-ID)                           22260009
222700         END-EXEC                                                 22270009
222800                                                                  22280009
222900         EVALUATE TRUE                                            22290009
223000             WHEN SQLCODE = +0                                    22300009
223100             WHEN SQLCODE = -904                                  22310009
223200             WHEN SQLCODE = -913                                  22320009
223300                 CONTINUE                                         22330009
223400                                                                  22340009
223500             WHEN SQLWARN0 NOT = SPACES                           22350009
223600             WHEN SQLCODE < +0                                    22360009
223700             WHEN SQLCODE > +0                                    22370009
223800                 MOVE '5320-INSERT-TWRKORD'                       22380009
223900                                   TO DP013-PARAGRAPH             22390009
224000                 MOVE 'ERROR INSERTING A ROW INTO TWRKORD '       22400009
224100                                   TO DP013-MESSAGE-TEXT(1)       22410009
224200                 MOVE SQLCA        TO DP013-SQLCA                 22420009
224300                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    22430009
224400                 SET DP013-DB2-ABEND                              22440009
224500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22450009
224600                 PERFORM DP013-0000-PROCESS-ABEND                 22460009
224700         END-EVALUATE                                             22470009
224800     END-PERFORM.                                                 22480009
224900                                                                  22490009
225000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22500009
225100         MOVE '5320-INSERT-TWRKORD'                               22510009
225200                                   TO DP013-PARAGRAPH             22520009
225300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              22530009
225400                                   TO DP013-MESSAGE-TEXT (1)      22540009
225500         MOVE 'TO INSERT A ROW INTO TWRKORD '                     22550009
225600                                   TO DP013-MESSAGE-TEXT (2)      22560009
225700         MOVE SQLCA                TO DP013-SQLCA                 22570009
225800         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    22580009
225900         SET DP013-DB2-ABEND                                      22590009
226000             DP013-XCTL-DISPLAY-RESTART                           22600009
226100                                   TO TRUE                        22610009
226200         PERFORM DP013-0000-PROCESS-ABEND                         22620009
226300     END-IF.                                                      22630009
226400/                                                                 22640009
226500*----------------------------------------------------------------*22650009
226600*                                                                *22660009
226700*    FIND THE FIRST WORK ORDER INSTRUCTION THAT HAS NOT BEEN     *22670009
226800*    STOPPED AND UPDATE THE ACTUAL CARTON COUNT.                 *22680009
226900*                                                                *22690009
227000*----------------------------------------------------------------*22700009
227100                                                                  22710009
227200 5330-UPDATE-TWKORIN.                                             22720009
227300                                                                  22730009
227400     SET PS-NOT-END-OF-TWKORIN     TO  TRUE.                      22740009
227500     PERFORM 5331-OPEN-TWKORIN-CURSOR.                            22750009
227600     IF  SQLCODE EQUAL ZERO                                       22760009
227700         PERFORM 5332-PROCESS-CURSOR                              22770009
227800             UNTIL PS-END-OF-TWKORIN                              22780009
227900         PERFORM 5335-CLOSE-TWKORIN-CURSOR                        22790009
228000     END-IF.                                                      22800009
228100                                                                  22810009
228200 5331-OPEN-TWKORIN-CURSOR.                                        22820009
228300                                                                  22830009
228400     EXEC SQL                                                     22840009
228500          OPEN TWKORIN-CSR                                        22850009
228600     END-EXEC.                                                    22860009
228700                                                                  22870009
228800     EVALUATE TRUE                                                22880009
228900         WHEN SQLCODE = +0                                        22890009
229000         WHEN SQLCODE = +100                                      22900009
229100              CONTINUE                                            22910009
229200         WHEN SQLCODE = -904                                      22920009
229300         WHEN SQLCODE = -913                                      22930009
229400         WHEN SQLWARN0 NOT = SPACE                                22940009
229500         WHEN SQLCODE  NOT = +0                                   22950009
229600              MOVE '5331-OPEN-TWKORIN-CURSOR'                     22960009
229700                                   TO DP013-PARAGRAPH             22970009
229800              MOVE 'OPEN TWKORIN CURSOR'                          22980009
229900                                   TO DP013-MESSAGE-TEXT (1)      22990009
230000              MOVE SQLCA           TO DP013-SQLCA                 23000009
230100              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    23010009
230200              SET DP013-DB2-ABEND                                 23020009
230300                                   TO TRUE                        23030009
230400              PERFORM DP013-0000-PROCESS-ABEND                    23040009
230500     END-EVALUATE.                                                23050009
230600/                                                                 23060009
230700*----------------------------------------------------------------*23070009
230800*                                                                *23080009
230900*    WE MUST USE A CURSOR TO FIND WHAT WE WANT.  AS SOON AS THE  *23090009
231000*    FIRST STOP TIMESTAMP IS FOUND THAT IS THE 9'S DATE, UPDATE  *23100009
231100*    THE TWKORIN ROW AND GET OUT OF THIS ROUTINE.                *23110009
231200*                                                                *23120009
231300*----------------------------------------------------------------*23130009
231400                                                                  23140009
231500 5332-PROCESS-CURSOR.                                             23150009
231600                                                                  23160009
231700     PERFORM 5334-FETCH-TWKORIN-CURSOR.                           23170009
231800     IF  SQLCODE EQUAL ZERO                                       23180009
231900         IF  WKORIN-STOP-TMST GREATER PC-DUMMY-TMST               23190009
232000             PERFORM 5333-UPDATE-TWKORIN                          23200009
232100             SET PS-END-OF-TWKORIN TO TRUE                        23210009
232200         END-IF                                                   23220009
232300     END-IF.                                                      23230009
232400                                                                  23240009
232500 5333-UPDATE-TWKORIN.                                             23250009
232600                                                                  23260009
232700     EXEC SQL                                                     23270009
232800          UPDATE TWKORIN                                          23280009
232900            SET  ACTL_CART_CNT     =  :WRKORD-ACTL-CART-CNT       23290009
233000          WHERE                                                   23300009
233100                ORD_NBR            =  :DK-ORD-NBR                 23310009
233200            AND ORD_LNE_NBR        =  :DK-LINE-NBR                23320009
233300            AND RCVR_SEQ_NBR       =  :DK-RCVR-SEQ-NBR            23330009
233400            AND WORK_ORD_SEQ_NBR   =  :DK-WORK-ORD-SEQ-NBR        23340009
233500            AND OPER_UNT_ID        =  :DK-OPERATING-UNIT-ID       23350009
233600            AND FCLTY_ID           =  :DK-FACILITY-ID             23360009
233700            AND VER_STATUS_CDE     =  :PC-A                       23370009
233800            AND SCREEN_SEQ_NBR     =  :WKORIN-SCREEN-SEQ-NBR      23380009
233900     END-EXEC.                                                    23390009
234000                                                                  23400009
234100     EVALUATE TRUE                                                23410009
234200         WHEN SQLCODE = +0                                        23420009
234300              CONTINUE                                            23430009
234400                                                                  23440009
234500         WHEN SQLWARN0 NOT = SPACES                               23450009
234600         WHEN SQLCODE < +0                                        23460009
234700         WHEN SQLCODE > +0                                        23470009
234800              MOVE '5334-UPDATE-TWKORIN'                          23480009
234900                                   TO DP013-PARAGRAPH             23490009
235000              MOVE 'ERROR UPDATING TWKORIN  '                     23500009
235100                                   TO DP013-MESSAGE-TEXT(1)       23510009
235200              MOVE SQLCA           TO DP013-SQLCA                 23520009
235300              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    23530009
235400              SET DP013-DB2-ABEND                                 23540009
235500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              23550009
235600              PERFORM DP013-0000-PROCESS-ABEND                    23560009
235700      END-EVALUATE.                                               23570009
235800                                                                  23580009
235900 5334-FETCH-TWKORIN-CURSOR.                                       23590009
236000                                                                  23600009
236100     EXEC SQL                                                     23610009
236200          FETCH TWKORIN-CSR                                       23620009
236300          INTO                                                    23630009
236400                :WKORIN-STOP-TMST                                 23640009
236500              , :WKORIN-SCREEN-SEQ-NBR                            23650009
236600     END-EXEC.                                                    23660009
236700                                                                  23670009
236800     EVALUATE TRUE                                                23680009
236900         WHEN SQLCODE = +0                                        23690009
237000              CONTINUE                                            23700009
237100         WHEN SQLCODE = +100                                      23710009
237200              SET PS-END-OF-TWKORIN TO TRUE                       23720009
237300         WHEN SQLWARN0 NOT = SPACE                                23730009
237400         WHEN SQLCODE  NOT = +0                                   23740009
237500              MOVE '5334-FETCH-TWKORIN-CURSOR'                    23750009
237600                                   TO DP013-PARAGRAPH             23760009
237700              MOVE 'FETCH TWKORIN CURSOR'                         23770009
237800                                   TO DP013-MESSAGE-TEXT (1)      23780009
237900              MOVE SQLCA           TO DP013-SQLCA                 23790009
238000              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    23800009
238100              SET DP013-DB2-ABEND                                 23810009
238200                                   TO TRUE                        23820009
238300              PERFORM DP013-0000-PROCESS-ABEND                    23830009
238400     END-EVALUATE.                                                23840009
238500/                                                                 23850009
238600 5335-CLOSE-TWKORIN-CURSOR.                                       23860009
238700                                                                  23870009
238800     EXEC SQL                                                     23880009
238900          CLOSE TWKORIN-CSR                                       23890009
239000     END-EXEC.                                                    23900009
239100                                                                  23910009
239200     EVALUATE TRUE                                                23920009
239300         WHEN SQLCODE = +0                                        23930009
239400         WHEN SQLCODE = +100                                      23940009
239500              CONTINUE                                            23950009
239600         WHEN SQLCODE = -904                                      23960009
239700         WHEN SQLCODE = -913                                      23970009
239800         WHEN SQLWARN0 NOT = SPACE                                23980009
239900         WHEN SQLCODE  NOT = +0                                   23990009
240000              MOVE '5335-CLOSE-TWKORIN-CURSOR'                    24000009
240100                                   TO DP013-PARAGRAPH             24010009
240200              MOVE 'CLOSE TWKORIN CURSOR'                         24020009
240300                                   TO DP013-MESSAGE-TEXT (1)      24030009
240400              MOVE SQLCA           TO DP013-SQLCA                 24040009
240500              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    24050009
240600              SET DP013-DB2-ABEND                                 24060009
240700                                   TO TRUE                        24070009
240800              PERFORM DP013-0000-PROCESS-ABEND                    24080009
240900     END-EVALUATE.                                                24090009
241000/                                                                 24100009
241100******************************************************************24110009
241200** THIS PARAGRAPH WILL SUM UP THE ACTUAL CARTON COUNTS AND      **24120009
241300** ACTUAL ITEM COUNTS ON ALL WORK ORDERS FOR A SPECIFIC ORDER   **24130009
241400** LINE NUMBER.  THIS INFORMATION WILL BE USED TO UPDATE THE    **24140009
241500** RECEIPT ITEM TABLE (TRECITM).                                **24150009
241600******************************************************************24160009
241700 5400-SUM-ACTL-CART-ITM-CNTS.                                     24170009
241800                                                                  24180009
241900     PERFORM                                                      24190009
242000         WITH TEST AFTER                                          24200009
242100         VARYING PV-RETRY-COUNTER                                 24210009
242200         FROM 1 BY 1                                              24220009
242300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24230009
242400             OR (SQLCODE = +0))                                   24240009
242500                                                                  24250009
242600         EXEC SQL                                                 24260009
242700           SELECT SUM(ACTL_CART_CNT)                              24270009
242800                 ,SUM(ACTL_ITM_CNT)                               24280009
242900             INTO :PV-TOT-ACTL-CART-CNT                           24290009
243000                 ,:PV-TOT-ACTL-ITM-CNT                            24300009
243100             FROM TWRKORD                                         24310009
243200           WHERE  ORD_NBR          = :DK-ORD-NBR                  24320009
243300             AND  RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR             24330009
243400             AND  ORD_LNE_NBR      = :DK-LINE-NBR                 24340009
243500             AND  OPER_UNT_ID      = :DK-OPERATING-UNIT-ID        24350009
243600             AND  FCLTY_ID         = :DK-FACILITY-ID              24360009
243700             AND  VER_STATUS_CDE   = 'A'                          24370009
243800         END-EXEC                                                 24380009
243900                                                                  24390009
244000         EVALUATE TRUE                                            24400009
244100             WHEN SQLCODE = +0                                    24410009
244200             WHEN SQLCODE = -904                                  24420009
244300             WHEN SQLCODE = -913                                  24430009
244400                 CONTINUE                                         24440009
244500                                                                  24450009
244600             WHEN SQLWARN0 NOT = SPACES                           24460009
244700             WHEN SQLCODE < +0                                    24470009
244800             WHEN SQLCODE > +0                                    24480009
244900                 MOVE '5400-SUM-ACTL-CART-ITM-CNTS'               24490009
245000                                   TO DP013-PARAGRAPH             24500009
245100                 MOVE 'ERROR COUNTING ITEMS AND CARTONS'          24510009
245200                                   TO DP013-MESSAGE-TEXT(1)       24520009
245300                 MOVE 'ON TWORKORD                     '          24530009
245400                                   TO DP013-MESSAGE-TEXT(2)       24540009
245500                 MOVE SQLCA        TO DP013-SQLCA                 24550009
245600                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    24560009
245700                 SET DP013-DB2-ABEND                              24570009
245800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           24580009
245900                 PERFORM DP013-0000-PROCESS-ABEND                 24590009
246000         END-EVALUATE                                             24600009
246100     END-PERFORM.                                                 24610009
246200                                                                  24620009
246300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24630009
246400         MOVE '5400-SUM-ACTL-CART-ITM-CNTS'                       24640009
246500                                   TO DP013-PARAGRAPH             24650009
246600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              24660009
246700                                   TO DP013-MESSAGE-TEXT (1)      24670009
246800         MOVE 'TO COUNT ITEMS AND CARTONS ON TWORKORD'            24680009
246900                                   TO DP013-MESSAGE-TEXT (2)      24690009
247000         MOVE SQLCA                TO DP013-SQLCA                 24700009
247100         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    24710009
247200         SET DP013-DB2-ABEND                                      24720009
247300             DP013-XCTL-DISPLAY-RESTART                           24730009
247400                                   TO TRUE                        24740009
247500         PERFORM DP013-0000-PROCESS-ABEND                         24750009
247600     END-IF.                                                      24760009
247700                                                                  24770009
247800/                                                                 24780009
247900*----------------------------------------------------------------*24790009
248000*    LINK TO AUDIT MODULE * RCKCS290                             *24800009
248100*----------------------------------------------------------------*24810009
248200                                                                  24820009
248300 5500-LINK-AUDIT-MODULE.                                          24830009
248400                                                                  24840009
248500     MOVE 'I'                   TO RC031-TABLE-TO-AUDIT.          24850009
248600     MOVE 'B'                   TO RC031-AUD-TYP-CDE.             24860009
248700     MOVE 'U'                   TO RC031-AUD-FUNC-CDE.            24870009
248800     MOVE DK-OPERATING-UNIT-ID  TO RC031-OPER-UNT-ID.             24880009
248900     MOVE DK-FACILITY-ID        TO RC031-FCLTY-ID.                24890009
249000     MOVE DK-ORD-NBR            TO RC031-PO-NBR.                  24900009
249100     MOVE DK-RCVR-SEQ-NBR       TO RC031-REC-SEQ-NBR.             24910009
249200     MOVE DK-LINE-NBR           TO RC031-PO-LNE-NBR.              24920009
249210     MOVE PC-CURRENT-PROGRAM-NAME TO RC031-UPD-PGM-ID.            24921012
249300                                                                  24930009
249400     EXEC CICS                                                    24940009
249500          LINK PROGRAM  (PC-AUDIT-RTN)                            24950009
249600          COMMAREA (RC031-FIELDS)                                 24960009
249700          LENGTH   (PC-AUDIT-RTN-LENGTH)                          24970009
249800     END-EXEC.                                                    24980009
249900                                                                  24990009
250000     EVALUATE TRUE                                                25000009
250100         WHEN RC031-CALL-SUCCESSFUL                               25010009
250200             CONTINUE                                             25020009
250300         WHEN OTHER                                               25030009
250400             MOVE '5500-LINK-AUDIT-MODULE'                        25040009
250500                                 TO DP013-PARAGRAPH               25050009
250600             MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'                25060009
250700                                 TO DP013-MESSAGE-TEXT (1)        25070009
250800             MOVE RC031-RETURN-DESC                               25080009
250900                                 TO DP013-MESSAGE-TEXT (2)        25090009
251000             MOVE RC031-SQLCA    TO DP013-SQLCA                   25100009
251100             SET DP013-DB2-ABEND                                  25110009
251200                 DP013-XCTL-DISPLAY-RESTART                       25120009
251300                                 TO TRUE                          25130009
251400             PERFORM DP013-0000-PROCESS-ABEND                     25140009
251500     END-EVALUATE.                                                25150009
251600/                                                                 25160009
251700******************************************************************25170009
251800** THIS PARAGRAPH WILL STATUS THE CURRENT ROW INACTIVE.  THIS   **25180009
251900** IS BEING DONE FOR AUDITING PURPOSES.                         **25190009
252000******************************************************************25200009
252100 5520-UPDATE-TRECITM.                                             25210009
252200                                                                  25220009
252300     PERFORM                                                      25230009
252400         WITH TEST AFTER                                          25240009
252500         VARYING PV-RETRY-COUNTER                                 25250009
252600         FROM 1 BY 1                                              25260009
252700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25270009
252800             OR (SQLCODE = +0))                                   25280009
252900                                                                  25290009
253000         EXEC SQL                                                 25300009
253100           UPDATE TRECITM                                         25310009
253200              SET DTL_CK_ITM_QTY = :PV-TOT-ACTL-ITM-CNT           25320009
253300                 ,ACTL_CART_CNT  = :PV-TOT-ACTL-CART-CNT          25330009
253400                 ,UPD_TMST       = CURRENT TIMESTAMP              25340009
253500                 ,UPD_UID        = :DP020-USERID                  25350009
253600                 ,UPD_PGM_ID     = :PC-CURRENT-PROGRAM-NAME       25360009
253700            WHERE ORD_NBR        = :DK-ORD-NBR                    25370009
253800            AND   ORD_LNE_NBR    = :DK-LINE-NBR                   25380009
253900            AND   REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR               25390009
254000            AND   OPER_UNT_ID    = :DK-OPERATING-UNIT-ID          25400009
254100            AND   FCLTY_ID       = :DK-FACILITY-ID                25410009
254200            AND   VER_STATUS_CDE = 'A'                            25420009
254300         END-EXEC                                                 25430009
254400                                                                  25440009
254500         EVALUATE TRUE                                            25450009
254600             WHEN SQLCODE = +0                                    25460009
254700             WHEN SQLCODE = -904                                  25470009
254800             WHEN SQLCODE = -913                                  25480009
254900                 CONTINUE                                         25490009
255000                                                                  25500009
255100             WHEN SQLWARN0 NOT = SPACES                           25510009
255200             WHEN SQLCODE < +0                                    25520009
255300             WHEN SQLCODE > +0                                    25530009
255400                 MOVE '5520-UPDATE-TRECITM'                       25540009
255500                                   TO DP013-PARAGRAPH             25550009
255600                 MOVE 'ERROR UPDATING TRECITM  '                  25560009
255700                                   TO DP013-MESSAGE-TEXT(1)       25570009
255800                 MOVE SQLCA        TO DP013-SQLCA                 25580009
255900                 MOVE 'TRECITM'    TO DP013-DB2-TABLE-NAME (1)    25590009
256000                 SET DP013-DB2-ABEND                              25600009
256100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25610009
256200                 PERFORM DP013-0000-PROCESS-ABEND                 25620009
256300         END-EVALUATE                                             25630009
256400     END-PERFORM.                                                 25640009
256500                                                                  25650009
256600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25660009
256700         MOVE '5520-UPDATE-TRECITM'                               25670009
256800                                   TO DP013-PARAGRAPH             25680009
256900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              25690009
257000                                   TO DP013-MESSAGE-TEXT (1)      25700009
257100         MOVE 'TO UPDATE A ROW ON TRECITM '                       25710009
257200                                   TO DP013-MESSAGE-TEXT (2)      25720009
257300         MOVE SQLCA                TO DP013-SQLCA                 25730009
257400         MOVE 'TRECITM'            TO DP013-DB2-TABLE-NAME (1)    25740009
257500         SET DP013-DB2-ABEND                                      25750009
257600             DP013-XCTL-DISPLAY-RESTART                           25760009
257700                                   TO TRUE                        25770009
257800         PERFORM DP013-0000-PROCESS-ABEND                         25780009
257900     END-IF.                                                      25790009
258000                                                                  25800009
258100/                                                                 25810009
258200*----------------------------------------------------------------*25820009
258300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25830009
258400*----------------------------------------------------------------*25840009
258500                                                                  25850009
258600 6111-WRITE-LIST-QUEUE.                                           25860009
258700                                                                  25870009
258800     EXEC CICS                                                    25880009
258900         WRITEQ TS                                                25890009
259000             QUEUE (ASC-LIST-QUEUE-NAME)                          25900009
259100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25910009
259200             ITEM  (PV-ITEM)                                      25920009
259300             REWRITE                                              25930009
259400             RESP  (PV-CICS-RESP)                                 25940009
259500     END-EXEC.                                                    25950009
259600                                                                  25960009
259700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25970009
259800         CONTINUE                                                 25980009
259900     ELSE                                                         25990009
260000         SET DP013-CICS-ABEND      TO TRUE                        26000009
260100         SET DP013-NO-ROLLBACK     TO TRUE                        26010009
260200         MOVE '6111-WRITE-LIST-QUEUE'                             26020009
260300                                   TO DP013-PARAGRAPH             26030009
260400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26040009
260500                                   TO DP013-MESSAGE-TEXT(1)       26050009
260600         PERFORM DP013-0000-PROCESS-ABEND                         26060009
260700     END-IF.                                                      26070009
260800                                                                  26080009
260900/                                                                 26090009
261000*----------------------------------------------------------------*26100009
261100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26110009
261200*----------------------------------------------------------------*26120009
261300                                                                  26130009
261400 6112-READ-LIST-QUEUE.                                            26140009
261500                                                                  26150009
261600     EXEC CICS                                                    26160009
261700         READQ TS                                                 26170009
261800             QUEUE (ASC-LIST-QUEUE-NAME)                          26180009
261900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26190009
262000             ITEM  (PV-ITEM)                                      26200009
262100             RESP  (PV-CICS-RESP)                                 26210009
262200     END-EXEC.                                                    26220009
262300                                                                  26230009
262400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26240009
262500         CONTINUE                                                 26250009
262600     ELSE                                                         26260009
262700         SET DP013-CICS-ABEND      TO TRUE                        26270009
262800         SET DP013-NO-ROLLBACK     TO TRUE                        26280009
262900         MOVE '6112-READ-LIST-QUEUE'                              26290009
263000                                   TO DP013-PARAGRAPH             26300009
263100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26310009
263200                                   TO DP013-MESSAGE-TEXT(1)       26320009
263300         PERFORM DP013-0000-PROCESS-ABEND                         26330009
263400     END-IF.                                                      26340009
263500                                                                  26350009
263600/                                                                 26360009
263700******************************************************************26370009
263800* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *26380009
263900******************************************************************26390009
264000 9100-READ-SEL-QUEUE.                                             26400009
264100     EXEC CICS                                                    26410009
264200         READQ TS                                                 26420009
264300             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        26430009
264400             INTO  (PC016-TS-SEL-REC)                             26440009
264500             ITEM  (ASC-SEL-ITEM)                                 26450009
264600             RESP  (PV-CICS-RESP)                                 26460009
264700     END-EXEC.                                                    26470009
264800                                                                  26480009
264900     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        26490009
265000         CONTINUE                                                 26500009
265100     ELSE                                                         26510009
265200         SET DP013-LOGIC-ABEND                                    26520009
265300             DP013-NO-ROLLBACK     TO TRUE                        26530009
265400         MOVE '9100-READ-SEL-QUEUE'                               26540009
265500                                   TO DP013-PARAGRAPH             26550009
265600         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    26560009
265700                                   TO DP013-MESSAGE-TEXT (1)      26570009
265800         PERFORM DP013-0000-PROCESS-ABEND                         26580009
265900     END-IF.                                                      26590009
266000                                                                  26600009
266100/                                                                 26610009
266200******************************************************************26620009
266300* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *26630009
266400******************************************************************26640009
266500 9200-REWRITE-LIST-QUEUE.                                         26650009
266600     EXEC CICS                                                    26660009
266700          WRITEQ TS                                               26670009
266800              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     26680009
266900              FROM    (PC016-TS-SEL-REC)                          26690009
267000              ITEM    (ASC-SEL-ITEM)                              26700009
267100              RESP    (PV-CICS-RESP)                              26710009
267200              REWRITE                                             26720009
267300     END-EXEC.                                                    26730009
267400                                                                  26740009
267500     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    26750009
267600         SET DP013-CICS-ABEND                                     26760009
267700             DP013-NO-ROLLBACK     TO TRUE                        26770009
267800         MOVE '9200-REWRITE-LIST-QUEUE'                           26780009
267900                                   TO DP013-PARAGRAPH             26790009
268000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   26800009
268100                                   TO DP013-MESSAGE-TEXT (1)      26810009
268200         PERFORM DP013-0000-PROCESS-ABEND                         26820009
268300     END-IF.                                                      26830009
268400                                                                  26840009
268500/                                                                 26850009
268600*----------------------------------------------------------------*26860009
268700*    ABEND PROCESSOR MODULE                                      *26870009
268800*----------------------------------------------------------------*26880009
268900                                                                  26890009
269000     COPY DPPD013.                                                26900009
