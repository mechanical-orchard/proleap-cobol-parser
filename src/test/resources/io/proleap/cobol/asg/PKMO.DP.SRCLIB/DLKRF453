000100 TITLE 'LABOR SYSTEM - SHARE MENU'.                               00010001
000200******************************************************************00020001
000300 IDENTIFICATION DIVISION.                                         00030001
000400******************************************************************00040001
000500                                                                  00050001
000600 PROGRAM-ID.             DLKRF453.                                00060001
000700 AUTHOR.                 BUDDY BARNES                             00070001
000800 INSTALLATION.           KOHLS.                                   00080001
000900 DATE-WRITTEN            DEC, 2003.                               00090001
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001200******************************************************************00120001
001300* THIS PROGRAM DISPLAYS THE SHARE (LABOR) RF MENU ON THE          00130001
001400* LRT (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM    00140001
001500* WHICH PROCESSES THE SELECTED FUNCTION.                          00150001
001600******************************************************************00160001
263627*----------------------------------------------------------------*00161007
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00162007
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00163007
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00164007
263627*----------------------------------------------------------------*00165007
001700                                                                  00170001
001800******************************************************************00180001
001900 ENVIRONMENT DIVISION.                                            00190001
002000******************************************************************00200001
002100                                                                  00210001
002200******************************************************************00220001
002300 DATA DIVISION.                                                   00230001
002400******************************************************************00240001
002500                                                                  00250001
002600******************************************************************00260001
002700 WORKING-STORAGE SECTION.                                         00270001
002800******************************************************************00280001
002900     COPY MPWS026.                                                00290001
003000     COPY DLWS010.                                                00300001
003100                                                                  00310001
003200 01  PC-PROGRAM-CONSTANTS.                                        00320001
003300     05  PV-TIMESTAMP                    PIC X(26).               00330001
003400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00340001
003500                                                     COMP SYNC.   00350001
003600     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00360001
003700         'DLKRF453'.                                              00370001
003800     05  PC-DC-RF-APPL-PGM               PIC  X(08)  VALUE        00380001
003900         'MPKCS027'.                                              00390001
004000     05  PC-CURR-TRANID                  PIC  X(04)  VALUE 'D453'.00400001
004100     05  PC-CHECK-AUTH-FOR-TRAN-D452     PIC  X(04)  VALUE 'D452'.00410001
004200     05  PC-CHECK-AUTH-FOR-TRAN-D454     PIC  X(04)  VALUE 'D454'.00420001
004210*** PRB0058387 START                                              00421002
004211     05  PC-CHECK-AUTH-FOR-TRAN-D457     PIC  X(08)  VALUE        00421102
004212                                                       'DLGISTOP'.00421202
004220*** PRB0058387 END                                                00422002
004300     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00430001
004400         'END OF SESSION     '.                                   00440001
004500     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00450001
004600         'INVALID SELECTION  '.                                   00460001
004700     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00470001
004800         'UNRECOGNIZED PF KEY'.                                   00480001
004900     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00490001
005000         'USER NOT AUTHORIZED'.                                   00500001
005100     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00510001
005200         'NUMERIC VALUE REQ. '.                                   00520001
005300     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00530001
005400         'F3 =END            '.                                   00540001
005500     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00550001
005600         'TRANS NOT AVAILABLE'.                                   00560001
005700     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00570001
005800         'CICS ABEND -CALL DP'.                                   00580001
005900     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00590001
006000         'CICSAUTH BAD RETURN'.                                   00600001
006100     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00610001
006200         'SELECTION NOT AVAIL'.                                   00620001
006300                                                                  00630001
006400 01  PN-PGM-NAME-DATA.                                            00640001
006500     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00650001
006600         'DLKRF454'.                                              00660001
006700     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00670001
006800         'DLKRF452'.                                              00680001
006900     05  PN-SELECTION-03-PROGRAM         PIC  X(08)  VALUE        00690001
007000         'DLKRF452'.                                              00700001
007010*** PRB0058387 START                                              00701002
007011     05  PN-SELECTION-04-PROGRAM         PIC  X(08)  VALUE        00701102
007012         'DLKRF457'.                                              00701202
007020*** PRB0058387 END                                                00702002
007100                                                                  00710001
007200 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00720001
007210*** PRB0058387 START                                              00721002
007300*    05  PN-PGM-NAME  OCCURS 3 TIMES                              00730002
007310     05  PN-PGM-NAME  OCCURS 4 TIMES                              00731002
007400                      INDEXED BY PN-INDX                          00740001
007500                                         PIC  X(08).              00750001
007510*** PRB0058387 END                                                00751002
007600                                                                  00760001
007700 01  PS-PROGRAM-SWITCHES.                                         00770001
007800     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00780001
007900         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00790001
008000         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00800001
008100                                                                  00810001
008200 01  PV-PROGRAM-VARIABLES.                                        00820001
008300     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00830001
008400     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00840001
008500                                                     COMP SYNC.   00850001
008600     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00860001
008700                                                                  00870001
008800******************************************************************00880001
008900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00890001
009000******************************************************************00900001
009100     COPY DPWS013.                                                00910001
009200                                                                  00920001
009300******************************************************************00930001
009400*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        00940001
009500******************************************************************00950001
009600     COPY DPWS008.                                                00960001
009700                                                                  00970001
009800******************************************************************00980001
009900*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00990001
010000******************************************************************01000001
010100     COPY DPWS010I.                                               01010001
010200                                                                  01020001
010300******************************************************************01030001
010400*  GENERATED DSECT FOR THE DLKM453 MAPSET                         01040001
010500******************************************************************01050001
010600     COPY DLKM453.                                                01060001
010700                                                                  01070001
010800******************************************************************01080001
010900* HELP SCREEN COMMAREA                                            01090001
011000******************************************************************01100001
011100     COPY PCWS192.                                                01110001
011200                                                                  01120001
011300******************************************************************01130001
011400* HELP SCREEN WORK AREA                                           01140001
011500******************************************************************01150001
011600     COPY PCWS188.                                                01160001
011700                                                                  01170001
011800******************************************************************01180001
011900*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01190001
012000******************************************************************01200001
012100     COPY DPWS015.                                                01210001
012200                                                                  01220001
012300******************************************************************01230001
012400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01240001
012500******************************************************************01250001
012600     COPY DFHAID.                                                 01260001
012700                                                                  01270001
012800     EXEC SQL                                                     01280001
012900         INCLUDE SQLCA                                            01290001
013000     END-EXEC.                                                    01300001
013100                                                                  01310001
013200******************************************************************01320001
013300 LINKAGE SECTION.                                                 01330001
013400******************************************************************01340001
013500 01  DFHCOMMAREA.                                                 01350001
013600     05  FILLER                       OCCURS 1 TO 4072 TIMES      01360001
013700                                      DEPENDING ON EIBCALEN.      01370001
013800         10  FILLER                   PIC X.                      01380001
013900                                                                  01390001
014000******************************************************************01400001
014100 PROCEDURE DIVISION.                                              01410001
014200******************************************************************01420001
014300 0000-PROGRAM-MAINLINE.                                           01430001
014400                                                                  01440001
014500     IF EIBTRNID = 'Z278'                                         01450001
014600         MOVE DFHCOMMAREA            TO PC192-COMMAREA            01460001
014700         MOVE PC192-HOST-SAVE-AREA   TO DL010-COMMAREA            01470001
014800     ELSE                                                         01480001
014900     IF EIBTRNID = 'M027'                                         01490001
015000         INITIALIZE DL010-COMMAREA                                01500001
015100         MOVE DFHCOMMAREA            TO MP026-COMMAREA            01510001
015200         SET DL010-INITIALIZE-SCREEN TO TRUE                      01520001
015300*        MOVE DFHCOMMAREA            TO DL010-COMMAREA            01530001
015400         MOVE MP026-LAST-PROGRAM     TO DL010-LAST-PROGRAM        01540001
015500         MOVE MP026-OPER-UNIT-ID     TO DL010-OPER-UNT-ID         01550001
015600         MOVE MP026-USERID           TO DL010-USERID              01560001
015700                                        DL010-KEYED-USERID        01570001
015800         MOVE MP026-COMMAREA         TO MP026-MP-SAVE-AREA        01580001
015900         MOVE 'DLKRF453'             TO DL010-MENU-PROGRAM        01590001
016000     ELSE                                                         01600001
016100         MOVE DFHCOMMAREA            TO DL010-COMMAREA            01610001
016200     END-IF.                                                      01620001
016300     MOVE LOW-VALUES                 TO DL453AI.                  01630001
016400                                                                  01640001
016500     EVALUATE TRUE                                                01650001
016600         WHEN EIBCALEN = ZERO                                     01660001
016700         WHEN EIBAID = DFHCLEAR                                   01670001
016800         WHEN DL010-INITIALIZE-SCREEN                             01680001
016900              MOVE DL010-USERID       TO DL010-KEYED-USERID       01690001
017000              SET DL010-PROCESS-SCREEN TO TRUE                    01700001
017100              PERFORM 8000-SEND-MAP                               01710001
017200              PERFORM 8200-RETURN-TRANID                          01720001
017300         WHEN EIBAID = DFHENTER                                   01730001
017400              PERFORM 1000-RECEIVE-MAP                            01740001
017500              PERFORM 1100-EDIT-SELECTION                         01750001
017600         WHEN EIBAID = DFHPF3                                     01760001
017700              MOVE PC-DC-RF-APPL-PGM TO PV-TRANSFER-PROGRAM       01770001
017800              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01780001
017900         WHEN EIBAID = DFHPF1                                     01790001
018000              PERFORM 1400-HELP-SCREEN                            01800001
018100         WHEN OTHER                                               01810001
018200              EXEC SQL                                            01820001
018300                 SET :PV-TIMESTAMP = CURRENT TIMESTAMP            01830001
018400              END-EXEC                                            01840001
018500              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     01850001
018600                                     TO AMSGLNO                   01860001
018700              PERFORM 8100-SEND-DATA-ONLY                         01870001
018800              PERFORM 8200-RETURN-TRANID                          01880001
018900     END-EVALUATE.                                                01890001
019000                                                                  01900001
019100     GOBACK.                                                      01910001
019200                                                                  01920001
019300 1000-RECEIVE-MAP.                                                01930001
019400     EXEC CICS                                                    01940001
019500         RECEIVE MAP    ('DL453A')                                01950001
019600                 MAPSET ('DLKM453')                               01960001
019700                 RESP   (PV-CICS-RESPONSE)                        01970001
019800     END-EXEC.                                                    01980001
019900                                                                  01990001
020000     EVALUATE TRUE                                                02000001
020100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02010001
020200              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  02020001
020300         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02030001
020400              CONTINUE                                            02040001
020500         WHEN OTHER                                               02050001
020600              MOVE '1000-RECEIVE-MAP'                             02060001
020700                                     TO DP013-PARAGRAPH           02070001
020800              MOVE 'UNABLE TO RECEIVE MAP'                        02080001
020900                                     TO DP013-MESSAGE-TEXT (1)    02090001
021000              SET DP013-LOGIC-ABEND  TO TRUE                      02100001
021100              SET DP013-NO-ROLLBACK  TO TRUE                      02110001
021200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02120001
021300     END-EVALUATE.                                                02130001
021400                                                                  02140001
021500 1010-RECEIVE-SCREEN-FIELDS.                                      02150001
021600     IF  ASELECTL > ZERO                                          02160001
021700         MOVE ASELECTI               TO DL010-SELECTION-X         02170001
021800     END-IF.                                                      02180001
021900                                                                  02190001
022000 1100-EDIT-SELECTION.                                             02200001
022100     MOVE DL010-SELECTION-X      TO DP010I-UNEDITED-FIELD.        02210001
022200     MOVE 1                      TO DP010I-MAXIMUM-DIGITS.        02220001
022300     MOVE 0                      TO DP010I-MAXIMUM-DECIMALS.      02230001
022400     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     02240001
022500                                                                  02250001
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02261007
263627          USING DP010I-NUMERIC-EDIT-AREA.                         02262007
022700                                                                  02270001
022800     IF  DP010I-ERROR-DETECTED                                    02280001
022900         MOVE PC-NON-NUMERIC-SELECTION-MSG TO AMSGLNO             02290001
023000         PERFORM 8100-SEND-DATA-ONLY                              02300001
023100         PERFORM 8200-RETURN-TRANID                               02310001
023200     ELSE                                                         02320001
023300         MOVE DP010I-NUMERIC-FIELD   TO DL010-SELECTION           02330001
023400     END-IF.                                                      02340001
023500                                                                  02350001
023600     EVALUATE TRUE                                                02360001
023700     WHEN DL010-VALID-SELECTION                                   02370001
023800         PERFORM 2000-PROCESS-SELECTION                           02380001
023900     WHEN OTHER                                                   02390001
024000         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02400001
024100         MOVE PC-INVALID-SELECTION-MSG                            02410001
024200                                     TO AMSGLNO                   02420001
024300         PERFORM 8100-SEND-DATA-ONLY                              02430001
024400         PERFORM 8200-RETURN-TRANID                               02440001
024500     END-EVALUATE.                                                02450001
024600                                                                  02460001
024700 1400-HELP-SCREEN.                                                02470001
024800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02480001
024900     MOVE 'DLKRF453'                  TO PC192-PROGRAM-NAME       02490001
025000     COPY PCPD188.                                                02500001
025100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02510001
025200     PERFORM 2200-XCTL-TO-HELP.                                   02520001
025300                                                                  02530001
025400 2000-PROCESS-SELECTION.                                          02540001
025500     SET PN-INDX                     TO DL010-SELECTION.          02550001
025510*** PRB0058387 START                                              02551003
025600*    IF DL010-SELECTION < 4                                       02560003
025610     IF DL010-SELECTION < 5                                       02561003
025620*** PRB0058387 SEND                                               02562003
025700         PERFORM 9000-CHECK-RACF                                  02570001
025800     ELSE                                                         02580001
025900         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02590001
026000         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02600001
026100     END-IF.                                                      02610001
026200                                                                  02620001
026300     IF  PS-ACCESS-ALLOWED                                        02630001
026400         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02640001
026500                                        DL010-NEXT-PROGRAM        02650001
026600         MOVE 'DLKRF453'             TO DL010-MENU-PROGRAM        02660001
026700         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02670001
026800     ELSE                                                         02680001
026900         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02690001
027000         PERFORM 8100-SEND-DATA-ONLY                              02700001
027100         PERFORM 8200-RETURN-TRANID                               02710001
027200     END-IF.                                                      02720001
027300                                                                  02730001
027400 2100-XCTL-TO-SELECTED-PROGRAM.                                   02740001
027500     SET DL010-INITIALIZE-SCREEN     TO TRUE.                     02750001
027600     MOVE PC-CURRENT-PROGRAM-NAME    TO DL010-LAST-PROGRAM.       02760001
027700                                                                  02770001
027800     MOVE LENGTH OF DL010-COMMAREA TO PV-COMMAREA-LENGTH.         02780001
027900     EXEC CICS                                                    02790001
028000         XCTL                                                     02800001
028100             PROGRAM   (PV-TRANSFER-PROGRAM)                      02810001
028200             COMMAREA  (DL010-COMMAREA)                           02820001
028300             LENGTH    (PV-COMMAREA-LENGTH)                       02830001
028400             RESP      (PV-CICS-RESPONSE)                         02840001
028500     END-EXEC.                                                    02850001
028600                                                                  02860001
028700     EVALUATE TRUE                                                02870001
028800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02880001
028900              CONTINUE                                            02890001
029000         WHEN OTHER                                               02900001
029100              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                02910001
029200                                     TO DP013-PARAGRAPH           02920001
029300              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       02930001
029400                                     TO DP013-MESSAGE-TEXT (1)    02940001
029500              MOVE PV-TRANSFER-PROGRAM                            02950001
029600                                     TO DP013-MESSAGE-TEXT (2)    02960001
029700              SET DP013-CICS-ABEND   TO TRUE                      02970001
029800              SET DP013-NO-ROLLBACK  TO TRUE                      02980001
029900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02990001
030000              MOVE PC-TRANS-UNAVAILABLE-MSG                       03000001
030100                                     TO AMSGLNO                   03010001
030200              SET DL010-PROCESS-SCREEN TO TRUE                    03020001
030300              PERFORM 8100-SEND-DATA-ONLY                         03030001
030400              PERFORM 8200-RETURN-TRANID                          03040001
030500     END-EVALUATE.                                                03050001
030600                                                                  03060001
030700 2200-XCTL-TO-HELP.                                               03070001
030800     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      03080001
030900     SET DL010-INITIALIZE-SCREEN      TO TRUE.                    03090001
031000     MOVE DL010-COMMAREA              TO PC192-HOST-SAVE-AREA.    03100001
031100                                                                  03110001
031200     EXEC CICS                                                    03120001
031300         XCTL                                                     03130001
031400             PROGRAM   (PV-TRANSFER-PROGRAM)                      03140001
031500             COMMAREA  (PC192-COMMAREA)                           03150001
031600             LENGTH    (PV-COMMAREA-LENGTH)                       03160001
031700             RESP      (PV-CICS-RESPONSE)                         03170001
031800     END-EXEC.                                                    03180001
031900                                                                  03190001
032000     EVALUATE TRUE                                                03200001
032100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03210001
032200              CONTINUE                                            03220001
032300         WHEN OTHER                                               03230001
032400              MOVE '2200-XCTL-TO-HELP'                            03240001
032500                                     TO DP013-PARAGRAPH           03250001
032600              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03260001
032700                                     TO DP013-MESSAGE-TEXT (1)    03270001
032800              MOVE PV-TRANSFER-PROGRAM                            03280001
032900                                     TO DP013-MESSAGE-TEXT (2)    03290001
033000              SET DP013-CICS-ABEND   TO TRUE                      03300001
033100              SET DP013-NO-ROLLBACK  TO TRUE                      03310001
033200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03320001
033300              MOVE PC-TRANS-UNAVAILABLE-MSG                       03330001
033400                                     TO AMSGLNO                   03340001
033500              SET DL010-PROCESS-SCREEN TO TRUE                    03350001
033600              PERFORM 8100-SEND-DATA-ONLY                         03360001
033700              PERFORM 8200-RETURN-TRANID                          03370001
033800     END-EVALUATE.                                                03380001
033900                                                                  03390001
034000 8000-SEND-MAP.                                                   03400001
034100     EXEC CICS                                                    03410001
034200         SEND MAP       ('DL453A')                                03420001
034300              MAPSET    ('DLKM453')                               03430001
034400              ERASE                                               03440001
034500              RESP      (PV-CICS-RESPONSE)                        03450001
034600     END-EXEC.                                                    03460001
034700                                                                  03470001
034800     EVALUATE TRUE                                                03480001
034900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03490001
035000              CONTINUE                                            03500001
035100         WHEN OTHER                                               03510001
035200              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           03520001
035300              MOVE 'UNABLE TO SEND MAP'                           03530001
035400                                     TO DP013-MESSAGE-TEXT (1)    03540001
035500              SET DP013-CICS-ABEND   TO TRUE                      03550001
035600              SET DP013-NO-ROLLBACK  TO TRUE                      03560001
035700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03570001
035800     END-EVALUATE.                                                03580001
035900                                                                  03590001
036000 8100-SEND-DATA-ONLY.                                             03600001
036100     MOVE -1 TO ASELECTL.                                         03610001
036200                                                                  03620001
036300     EXEC CICS                                                    03630001
036400         SEND MAP       ('DL453A')                                03640001
036500              MAPSET    ('DLKM453')                               03650001
036600              CURSOR                                              03660001
036700              DATAONLY                                            03670001
036800              RESP      (PV-CICS-RESPONSE)                        03680001
036900     END-EXEC.                                                    03690001
037000                                                                  03700001
037100     EVALUATE TRUE                                                03710001
037200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03720001
037300              CONTINUE                                            03730001
037400         WHEN OTHER                                               03740001
037500              MOVE '8100-SEND-DATA-ONLY'                          03750001
037600                                     TO DP013-PARAGRAPH           03760001
037700              MOVE 'UNABLE TO SEND DATA'                          03770001
037800                                     TO DP013-MESSAGE-TEXT (1)    03780001
037900              SET DP013-CICS-ABEND   TO TRUE                      03790001
038000              SET DP013-NO-ROLLBACK  TO TRUE                      03800001
038100              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03810001
038200     END-EVALUATE.                                                03820001
038300                                                                  03830001
038400 8200-RETURN-TRANID.                                              03840001
038500     MOVE LENGTH OF DL010-COMMAREA       TO PV-COMMAREA-LENGTH.   03850001
038600     EXEC CICS                                                    03860001
038700         RETURN TRANSID   (PC-CURR-TRANID)                        03870001
038800                COMMAREA  (DL010-COMMAREA)                        03880001
038900                LENGTH    (PV-COMMAREA-LENGTH)                    03890001
039000                RESP      (PV-CICS-RESPONSE)                      03900001
039100     END-EXEC.                                                    03910001
039200                                                                  03920001
039300     EVALUATE TRUE                                                03930001
039400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03940001
039500              CONTINUE                                            03950001
039600         WHEN OTHER                                               03960001
039700              MOVE '8200-RETURN-TRANID'                           03970001
039800                                     TO DP013-PARAGRAPH           03980001
039900              MOVE 'UNABLE TO RETURN TO TRANID'                   03990001
040000                                     TO DP013-MESSAGE-TEXT (1)    04000001
040100              SET DP013-CICS-ABEND   TO TRUE                      04010001
040200              SET DP013-NO-ROLLBACK  TO TRUE                      04020001
040300              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04030001
040400     END-EVALUATE.                                                04040001
040500                                                                  04050001
041300 9000-CHECK-RACF.                                                 04130001
041400******************************************************************04140001
041500*  CHECK ACCESSS AUTHORITY OF USER                                04150001
041600******************************************************************04160001
041700     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04170001
041800     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04180001
041900                                                                  04190001
042000     EVALUATE TRUE                                                04200001
042100         WHEN DL010-SELECTION-ONE                                 04210001
042200              MOVE PC-CHECK-AUTH-FOR-TRAN-D454                    04220001
042300                                     TO DP008-RESOURCE-NAME       04230001
042400         WHEN DL010-SELECTION-TWO                                 04240001
042500              MOVE PC-CHECK-AUTH-FOR-TRAN-D452                    04250001
042600                                     TO DP008-RESOURCE-NAME       04260001
042700         WHEN DL010-SELECTION-THREE                               04270001
042800              MOVE PC-CHECK-AUTH-FOR-TRAN-D452                    04280001
042900                                     TO DP008-RESOURCE-NAME       04290001
042901*** PRB0058387 START                                              04290103
042910         WHEN DL010-SELECTION-FOUR                                04291003
042911              SET DP008-RSRC-TYPE-FUNC                            04291104
042912                                     TO TRUE                      04291204
042931              MOVE PC-CHECK-AUTH-FOR-TRAN-D457                    04293105
042932                                     TO DP008-RESOURCE-NAME       04293205
042940*** PRB0058387 END                                                04294003
043000     END-EVALUATE.                                                04300001
043100                                                                  04310001
043200     EXEC CICS                                                    04320001
043300          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04330001
043400               COMMAREA (DP008-SECURITY-COMMAREA)                 04340001
043500               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04350001
043600               RESP     (PV-CICS-RESPONSE)                        04360001
043700     END-EXEC.                                                    04370001
043800                                                                  04380001
043900     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       04390001
044000         IF  DP008-CALL-SUCCESSFUL                                04400001
044100             IF  DP008-ACCESS-ALLOWED                             04410001
044200                 SET PS-ACCESS-ALLOWED                            04420001
044300                                     TO TRUE                      04430001
044400             ELSE                                                 04440001
044500                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   04450001
044600                                     TO AMSGLNO                   04460001
044700             END-IF                                               04470001
044800         ELSE                                                     04480001
044900             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   04490001
045000         END-IF                                                   04500001
045100     ELSE                                                         04510001
045200         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           04520001
045300         MOVE 'BAD LINK TO RACF PROGRAM'                          04530001
045400                                     TO DP013-MESSAGE-TEXT (1)    04540001
045500         SET DP013-CICS-ABEND        TO TRUE                      04550001
045600         SET DP013-NO-ROLLBACK       TO TRUE                      04560001
045700         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04570001
045800     END-IF.                                                      04580001
045900                                                                  04590001
046000 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  04600001
046100     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04610001
046200     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04620001
046300     INITIALIZE DP013-SRC-TASK-NUMBER                             04630001
046400                DP013-STACK.                                      04640001
046500     SET DP013-LINK-RETURN           TO TRUE.                     04650001
046600                                                                  04660001
046700     EXEC CICS                                                    04670001
046800         LINK                                                     04680001
046900             PROGRAM   (DP013-NAME)                               04690001
047000             COMMAREA  (DP013-PARAMETERS)                         04700001
047100             LENGTH    (DP013-LENGTH)                             04710001
047200     END-EXEC.                                                    04720001
