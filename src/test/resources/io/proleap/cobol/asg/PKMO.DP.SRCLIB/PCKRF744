000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - TRAILER INFO SUMMARY'.                      00020000
000210                                                                  00021000
000220 PROGRAM-ID.             PCKRF744.                                00022000
000230 AUTHOR.                 DENNIS STEFFEN.                          00023000
000240 INSTALLATION.           KOHLS.                                   00024000
000250 DATE-WRITTEN.           MAY, 2001.                               00025000
000260 DATE-COMPILED.                                                   00026000
000270 ENVIRONMENT DIVISION.                                            00027000
000280 DATA DIVISION.                                                   00028000
000290                                                                  00029000
000300 WORKING-STORAGE SECTION.                                         00030000
000400                                                                  00040000
000500 01  PC-PROGRAM-CONSTANTS.                                        00050000
000600     05  PC-TRANID                    PIC X(04) VALUE 'E744'.     00060000
000700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF744'. 00070000
000800     05  PC-TRAILER-PROGRAM           PIC X(08) VALUE 'PCKCS714'. 00080000
000900     05  PC-DUMMY-TIMESTAMP           PIC X(26) VALUE             00090000
001000            '9999-09-09-09.09.09.999999'.                         00100000
001100     05  PC-LOW-TIMESTAMP             PIC X(26) VALUE             00110000
001200            '0001-01-01-00.00.00.000000'.                         00120000
001300                                                                  00130000
001400                                                                  00140000
001500* ERROR MESSAGES                                                 *00150000
001600     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00160000
001700                                           'UNRECOGNIZED PF KEY'. 00170000
001800     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00180000
001900                                           'ENTER THROUGH MENU '. 00190000
002000     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00200000
002100                                           'TRANS NOT AVAILABLE'. 00210000
002200     05  PC-WRONG-FACILITY            PIC X(19) VALUE             00220000
002300                                           'WRG FCLTY - F2 CONF'. 00230000
002400                                                                  00240000
002500 01  PS-PROGRAM-SWITCHES.                                         00250000
002600     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00260000
002700         88  PS-ERRORS-YES                        VALUE 'Y'.      00270000
002800         88  PS-ERRORS-NO                         VALUE 'N'.      00280000
002900     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00290000
003000         88  PS-XCTL-E871                       VALUE 'E871'.     00300000
003100     05  PS-VALID-INPUT-SW            PIC X(01) VALUE 'N'.        00310000
003200         88  PS-VALID-INPUT                       VALUE 'Y'.      00320000
003300         88  PS-INVALID-INPUT                     VALUE 'N'.      00330000
003400     05  PS-TRLR-OPEN-SW              PIC X(04) VALUE SPACES.     00340000
003500         88  PS-TRLR-OPEN-THIS-DOOR             VALUE 'THIS'.     00350000
003600         88  PS-TRLR-OPEN-DIFF-DOOR             VALUE 'DIFF'.     00360000
003700     05  PC-STORE-DOOR-CSR-SW         PIC X(01) VALUE 'N'.        00370000
003800         88  PS-END-STORE-DOOR-CSR              VALUE 'Y'.        00380000
003900         88  PS-NOT-END-STORE-DOOR-CSR          VALUE 'N'.        00390000
004000     05  PS-DOOR-DEST-EDIT-SW         PIC X(01) VALUE 'Y'.        00400000
004100         88  PS-SKIP-DOOR-DEST-EDITS            VALUE 'N'.        00410000
004200         88  PS-DO-DOOR-DEST-EDITS              VALUE 'Y'.        00420000
004300     05  PS-DIVERT-DOOR-SW            PIC X(01) VALUE 'Y'.        00430000
004400         88  PS-DIVERT-DOOR-YES                 VALUE 'Y'.        00440000
004500         88  PS-DIVERT-DOOR-NO                  VALUE 'N'.        00450000
004600     05  PS-SERIAL-SW                 PIC X(01) VALUE 'N'.        00460000
004700         88  PS-SERIAL-NO                       VALUE 'N'.        00470000
004800         88  PS-SERIAL-YES                      VALUE 'Y'.        00480000
004900     05  PS-ACTIVE-TRIP-SW            PIC X(01) VALUE 'N'.        00490000
005000         88  PS-ACTIVE-TRIP-EXISTS              VALUE 'Y'.        00500000
005100         88  PS-NO-ACTIVE-TRIP-EXISTS           VALUE 'N'.        00510000
005200                                                                  00520000
005300 01  PV-PROGRAM-VARIABLES.                                        00530000
005400     05  PV-CURRENT-TRIP-ID           PIC S9(09) COMP.            00540000
005500     05  PV-STAT-DATE                 PIC X(10) VALUE SPACES.     00550000
005600     05  PV-DB2-COUNT                 PIC S9(03) COMP-3.          00560000
005700     05  PV-TRIP-STAT-DESC            PIC X(10)  VALUE SPACES.    00570000
005800     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00580000
005900                                                     COMP SYNC.   00590000
006000     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00600000
006100     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00610000
006200                                                     COMP SYNC.   00620000
006300     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00630000
006400                                                                  00640000
006500     05  PV-DISPLAY-MSG               PIC  X(80)  VALUE SPACE.    00650000
006600     05  PV-DISPLAY-DOOR-ID           PIC  X(04)  VALUE SPACE.    00660000
006700     05  PV-DISPLAY-OPER              PIC  9(04)  VALUE ZEROES.   00670000
006800     05  PV-DISPLAY-DEST              PIC  9(04)  VALUE ZEROES.   00680000
006900     05  PV-DISPLAY-SRL-NBR           PIC  9(09)  VALUE ZEROES.   00690000
007000     05  PV-DISPLAY-SCAC              PIC  X(04)  VALUE SPACES.   00700000
007100     05  PV-DISPLAY-TRLR-ID           PIC  X(12)  VALUE ZEROES.   00710000
007200     05  PV-DISPLAY-TRIP              PIC  9(09)  VALUE ZEROES.   00720000
007210     05  PV-AVG-CRTN-WEIGHT           PIC  S9(9)  VALUE ZEROES    00721002
007300                                                  COMP.           00730002
007400                                                                  00740000
007500 01  PV-LOG-MSG.                                                  00750000
007600     05  FILLER                       PIC X(12) VALUE             00760000
007700         ' E744 ERROR '.                                          00770000
007800     05  FILLER                       PIC X(06) VALUE             00780000
007900         'USER= '.                                                00790000
008000     05  PV-USER-ID                   PIC X(08) VALUE SPACES.     00800000
008100     05  FILLER                       PIC X(10) VALUE             00810000
008200         ' SQLCODE= '.                                            00820000
008300     05  PV-SQLCODE                   PIC -9(03).                 00830000
008400     05  FILLER                       PIC X(06) VALUE             00840000
008500         ' ERR= '.                                                00850000
008600     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       00860000
008700     05  FILLER                       PIC X(07) VALUE             00870000
008800         ' DOOR= '.                                               00880000
008900     05  PV-DISPLAY-DOOR              PIC X(04) VALUE ZEROES.     00890000
009000/                                                                 00900000
009100 01  PV-EDITING-FIELDS.                                           00910000
009200     05  PV-SCREEN-SERIAL-NBR         PIC X(09).                  00920000
009300                                                                  00930000
009400     COPY PCWS047.                                                00940000
009500/                                                                 00950000
009600 01  CA-COMMAREA.                                                 00960000
009700     COPY PCWS233.                                                00970000
009800     05  CA-PRIVATE-COMMAREA          PIC X(100).                 00980000
009900     05  CA-REDEFINED-COMMAREA REDEFINES CA-PRIVATE-COMMAREA.     00990000
010000         10  CA-CURR-DOOR             PIC X(04).                  01000000
010100         10  CA-CURR-SERIAL-NBR       PIC 9(09).                  01010000
010200/                                                                 01020000
010300*  MAP LAYOUT                                                     01030000
010400     COPY PCKM744.                                                01040000
010500                                                                  01050000
010600* HELP SCREEN COMMAREA                                            01060000
010700     COPY PCWS192.                                                01070000
010800* HELP SCREEN WORK AREA                                           01080000
010900     COPY PCWS188.                                                01090000
011000/                                                                 01100000
011100     COPY DPWS010I.                                               01110000
011200*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01120000
011300     COPY DPWS015.                                                01130000
011400                                                                  01140000
011500*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01150000
011600     COPY DFHAID.                                                 01160000
011700                                                                  01170000
011800*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01180000
011900     COPY DPWS013.                                                01190000
012000/                                                                 01200000
012100*    DC DOOR MASTER                                               01210000
012200                                                                  01220000
012300*    TRAILER ID MASTER                                            01230000
012400     EXEC SQL                                                     01240000
012500         INCLUDE TCNTRID                                          01250000
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
012800*    OUTBOUND TRAILER TRIP                                        01280000
012900     EXEC SQL                                                     01290000
013000         INCLUDE TSUOBTR                                          01300000
013100     END-EXEC.                                                    01310000
013200                                                                  01320000
013300*    OUTBOUND TRAILER TRIP STATUS                                 01330000
013400     EXEC SQL                                                     01340000
013500         INCLUDE TSUOBTS                                          01350000
013600     END-EXEC.                                                    01360000
013700                                                                  01370000
013710*    PARM TABLE                                                   01371003
013720     EXEC SQL                                                     01372003
013730         INCLUDE TKRPRPM                                          01373003
013740     END-EXEC.                                                    01374003
013750                                                                  01375003
013800     EXEC SQL                                                     01380000
013900         INCLUDE SQLCA                                            01390000
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200 LINKAGE SECTION.                                                 01420000
014300 01  DFHCOMMAREA.                                                 01430000
014400     05  FILLER                         OCCURS  1 TO 4072 TIMES   01440000
014500                                      DEPENDING ON EIBCALEN.      01450000
014600         10  FILLER                   PIC X.                      01460000
014700/                                                                 01470000
014800 PROCEDURE DIVISION.                                              01480000
014900 0000-PROGRAM-MAINLINE.                                           01490000
015000                                                                  01500000
015100     INITIALIZE CA-COMMAREA                                       01510000
015200     MOVE DFHCOMMAREA                 TO CA-COMMAREA              01520000
015300                                                                  01530000
015400     EVALUATE TRUE                                                01540000
015500         WHEN EIBCALEN = ZERO                                     01550000
015600             MOVE PC-ENTER-THROUGH-MENU-MSG                       01560000
015700                                      TO PV-MESSAGE-AREA          01570000
015800             PERFORM 8110-RETURN                                  01580000
015900                                                                  01590000
016000         WHEN EIBTRNID = 'Z278'                                   01600000
016100*            RETURNING FROM F1 HELP INFO SCREEN                   01610000
016200             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01620000
016300             MOVE PC192-HOST-SAVE-AREA                            01630000
016400                                      TO CA-COMMAREA              01640000
016500             SET PC233-PROCESS-SCREEN TO TRUE                     01650000
016600             MOVE PC192-HOST-SAVE-MAP TO PC744AO                  01660000
016700             PERFORM 8000-SEND-MAP                                01670000
016800             PERFORM 8100-RETURN-TRANID                           01680000
016900                                                                  01690000
017000         WHEN PC233-INITIALIZE-SCREEN                             01700000
017100         WHEN EIBAID = DFHCLEAR                                   01710000
017200             SET PC233-WAIT-FOR-CONFIRM                           01720000
017300                                      TO TRUE                     01730000
017400             PERFORM 1000-INITIALIZE                              01740000
017500             PERFORM 8000-SEND-MAP                                01750000
017600             PERFORM 8100-RETURN-TRANID                           01760000
017700                                                                  01770000
017800                                                                  01780000
017900         WHEN EIBAID = DFHENTER                                   01790000
018000         WHEN EIBAID = DFHPF3                                     01800000
018100             MOVE PC233-ROOT-PROGRAM  TO PV-TRANSFER-PROGRAM      01810000
018200             PERFORM 8200-XCTL                                    01820000
018300                                                                  01830000
018400         WHEN EIBAID = DFHPF1                                     01840000
018500             PERFORM 8020-RECEIVE-MAP                             01850000
018600             MOVE PC744AO             TO PC192-HOST-SAVE-MAP      01860000
018700             PERFORM 1200-HELP-SCREEN                             01870000
018800                                                                  01880000
018900         WHEN OTHER                                               01890000
019000             PERFORM 8020-RECEIVE-MAP                             01900000
019100             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      01910000
019200                                      TO AMSGLNO                  01920000
019300             PERFORM 8000-SEND-MAP                                01930000
019400             PERFORM 8100-RETURN-TRANID                           01940000
019500     END-EVALUATE.                                                01950000
019600                                                                  01960000
019700     GOBACK.                                                      01970000
019800                                                                  01980000
019900 1000-INITIALIZE.                                                 01990000
020000                                                                  02000000
020100     INITIALIZE CA-REDEFINED-COMMAREA                             02010000
020200                PC233-ERROR-FIELDS                                02020000
020300     MOVE PC233-MENU-PROGRAM          TO PV-TRANSFER-PROGRAM      02030000
020400                                                                  02040000
020500     MOVE PC-TRANID                   TO PC233-TRAN-ID            02050000
020600                                                                  02060000
020700     MOVE PC233-USER-ID               TO PV-USER-ID.              02070000
020800                                                                  02080000
020900                                                                  02090000
021000     PERFORM 1300-GET-TRAILER-INFO.                               02100000
021010     PERFORM 7010-GET-AVG-CRTN-WGT.                               02101002
021100                                                                  02110000
021200     INITIALIZE PC047-COMMAREA.                                   02120000
021300     SET PC047-BOTH-TOTAL             TO TRUE                     02130000
021400     MOVE PC233-TRIP-ID               TO PC047-OTBND-TRIP-ID.     02140000
021500     MOVE PC233-DOOR-TYPE-CDE         TO PC047-DOOR-TYPE-CDE.     02150000
021600     MOVE PC233-STR-NBR               TO PC047-DEST-OPER-UNT-ID.  02160000
021700     PERFORM 8050-LINK.                                           02170000
021701                                                                  02170101
021710* DMH - 05/05/03                                                  02171001
021720     IF  SUOBTS-TRIP-STAT-CDE  = 'SU'                             02172001
021730         MOVE  ZEROES  TO  PC047-TOTAL-CTN-COUNT                  02173001
021740     END-IF.                                                      02174001
021750* DMH - 05/05/03                                                  02175001
021760                                                                  02176001
021800     IF PC047-SUCCESSFUL                                          02180000
021900         MOVE PC047-TOTAL-CTN-COUNT   TO ACOUNTO                  02190000
022000         MULTIPLY PC047-TOTAL-CTN-COUNT BY PV-AVG-CRTN-WEIGHT     02200002
022100                                      GIVING AWGTO                02210000
022200     ELSE                                                         02220000
022300         MOVE 1                       TO PV-ERROR-NBR             02230000
022400                                         PC233-ERROR-NBR          02240000
022500         PERFORM 9903-WRITE-CICS-LOG                              02250000
022600         MOVE '1000-INITIALIZE'                                   02260000
022700                                      TO PC233-PARAGRAPH          02270000
022800         MOVE 'PCKRF744 - CALL TRAILER SUBPROGRAM'                02280000
022900                                      TO PC233-MESSAGE-TEXT(1)    02290000
023000         MOVE SQLCA                   TO PC233-SQLCA              02300000
023100         SET PC233-ABEND              TO TRUE                     02310000
023200         MOVE 99                      TO PC233-PGM-MSG-NBR        02320000
023300         PERFORM 8210-XCTL-ERROR-SCREEN                           02330000
023400     END-IF.                                                      02340000
023500                                                                  02350000
023600 1200-HELP-SCREEN.                                                02360000
023700     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02370000
023800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       02380000
023900     COPY PCPD188.                                                02390000
024000     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02400000
024100     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02410000
024200     PERFORM 8220-XCTL-TO-HELP.                                   02420000
024300                                                                  02430000
024400/                                                                 02440000
024500 1300-GET-TRAILER-INFO.                                           02450000
024600     MOVE PC233-SERIAL-NBR            TO ASERIALO.                02460000
024700     MOVE PC233-TRAILER-STATUS        TO ASTATUSO.                02470000
024800                                                                  02480000
025000                                                                  02500000
025100     PERFORM 7000-SELECT-TRAILER-INFO.                            02510000
025200                                                                  02520000
025300     EVALUATE TRUE                                                02530000
025400         WHEN SUOBTS-TRIP-STAT-CDE = 'DC' OR 'DS'                 02540000
025500             MOVE '  TRAILER DETAIL   '                           02550000
025600                                      TO ATITLEO                  02560000
025700         WHEN SUOBTS-TRIP-STAT-CDE = 'DO'                         02570000
025800             MOVE ' TRAILER ESTIMATES '                           02580000
025900                                      TO ATITLEO                  02590000
026000     END-EVALUATE.                                                02600000
026100                                                                  02610000
026200     MOVE PV-STAT-DATE                TO ASTDATEO                 02620000
026300     MOVE PC233-SERIAL-NBR            TO ASERIALO.                02630000
026400/                                                                 02640000
027332/                                                                 02733200
027333 7000-SELECT-TRAILER-INFO.                                        02733300
027334                                                                  02733400
027335     EXEC SQL                                                     02733500
027336       SELECT                                                     02733600
027337           OBTS.TRIP_STAT_CDE                                     02733700
027338       ,   CHAR(DATE(OBTS.OTBND_STAT_TMST),USA)                   02733800
027339       INTO                                                       02733900
027340           :SUOBTS-TRIP-STAT-CDE                                  02734000
027350       ,   :PV-STAT-DATE                                          02735000
027360       FROM TSUOBTS OBTS                                          02736000
027370       ,    TSUOBTR OBTR                                          02737000
027380       WHERE                                                      02738000
027390           OBTR.ORGN_OPER_UNT_ID    = :PC233-OPER-UNT-ID          02739000
027400       AND OBTR.TRLR_SRL_NBR        = :PC233-SERIAL-NBR           02740000
027500       AND OBTR.TRIP_ACTV_CDE       = 'A'                         02750000
027600       AND OBTS.OTBND_TRIP_ID       = :PC233-TRIP-ID              02760000
027610       AND OBTS.OTBND_TRIP_ID       = OBTR.OTBND_TRIP_ID          02761000
027700       AND OBTS.OTBND_STAT_TMST =                                 02770000
027800           (SELECT MAX(OBTS1.OTBND_STAT_TMST)                     02780000
027900               FROM TSUOBTS OBTS1                                 02790000
028000               WHERE                                              02800000
028100               OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)          02810000
028200                                                                  02820000
028300     END-EXEC.                                                    02830000
028400                                                                  02840000
028500     EVALUATE TRUE                                                02850000
028600         WHEN SQLCODE = ZERO                                      02860000
028700             SET PS-ACTIVE-TRIP-EXISTS                            02870000
028800                                      TO TRUE                     02880000
028900         WHEN SQLCODE = +100                                      02890000
029000             SET PS-ERRORS-YES                                    02900000
029100                 PS-NO-ACTIVE-TRIP-EXISTS                         02910000
029200                                      TO TRUE                     02920000
029300         WHEN SQLCODE = -904                                      02930000
029400         WHEN SQLCODE = -913                                      02940000
029500         WHEN SQLCODE = -911                                      02950000
029600             MOVE 2                   TO PV-ERROR-NBR             02960000
029700             PERFORM 9903-WRITE-CICS-LOG                          02970000
029800             PERFORM 9000-SOFT-ABORT                              02980000
029900         WHEN SQLWARN0 NOT = SPACES                               02990000
030000         WHEN SQLCODE NOT EQUAL ZERO                              03000000
030100              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      03010000
030200              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   03020000
030300              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      03030000
030400              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   03040000
030500              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      03050000
030600              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      03060000
030700              STRING  ' OPER-'               DELIMITED BY SIZE    03070000
030800                      PV-DISPLAY-OPER        DELIMITED BY SIZE    03080000
030900                      '  DOOR-'              DELIMITED BY SIZE    03090000
031000                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    03100000
031100                      '  DEST-'              DELIMITED BY SIZE    03110000
031200                      PV-DISPLAY-DEST        DELIMITED BY SIZE    03120000
031300                                        INTO                      03130000
031400                                        PC233-MESSAGE-TEXT(2)     03140000
031500             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    03150000
031600                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    03160000
031700                      '   SCAC-'             DELIMITED BY SIZE    03170000
031800                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    03180000
031900                      '   TRIP-'             DELIMITED BY SIZE    03190000
032000                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    03200000
032100                                        INTO                      03210000
032200                                        PC233-MESSAGE-TEXT(3)     03220000
032300             MOVE 3                   TO PV-ERROR-NBR             03230000
032400                                         PC233-ERROR-NBR          03240000
032500             PERFORM 9903-WRITE-CICS-LOG                          03250000
032600             MOVE '7000-SELECT-TRAILER-INFO'                      03260000
032700                                      TO PC233-PARAGRAPH          03270000
032800             MOVE 'PCKRF744 - CHECK TRLR AT ANOTHER DOOR'         03280000
032900                                      TO PC233-MESSAGE-TEXT(1)    03290000
033000             MOVE SQLCA               TO PC233-SQLCA              03300000
033100             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  03310000
033200             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  03320000
033300             SET PC233-ABEND          TO TRUE                     03330000
033400             MOVE 99                  TO PC233-PGM-MSG-NBR        03340000
033500             PERFORM 8210-XCTL-ERROR-SCREEN                       03350000
033600     END-EVALUATE.                                                03360000
033601                                                                  03360102
033602                                                                  03360202
033603*----------------------------------------------------------------*03360302
033604* SELECT PARM AVGWGT TO GET THE AVERAGE WEIGHT OF A CARTON TO BE *03360402
033605* USED TO DETERMINE ESTIMATED TRAILER WEIGHT.                    *03360502
033606*----------------------------------------------------------------*03360602
033610 7010-GET-AVG-CRTN-WGT.                                           03361002
033620                                                                  03362002
033630     EXEC SQL                                                     03363002
033640              SELECT  FUNC_QTY                                    03364002
033650                INTO  :PV-AVG-CRTN-WEIGHT                         03365002
033660                FROM  TKRPRPM                                     03366002
033670               WHERE  LOC_ID = 90                                 03367002
033680                 AND  INTFC_SYS_CDE = 'KHL'                       03368002
033690                 AND  SYS_PRC_FUNC_CDE = 'AVGWGT'                 03369002
033700                WITH UR                                           03370003
033705     END-EXEC.                                                    03370502
033706                                                                  03370602
033707     EVALUATE TRUE                                                03370702
033708         WHEN SQLCODE = ZERO                                      03370802
033709              CONTINUE                                            03370902
033710                                                                  03371004
033715         WHEN SQLCODE = -904                                      03371502
033716         WHEN SQLCODE = -913                                      03371602
033717         WHEN SQLCODE = -911                                      03371702
033718             MOVE 2                   TO PV-ERROR-NBR             03371802
033719             PERFORM 9903-WRITE-CICS-LOG                          03371902
033720             PERFORM 9000-SOFT-ABORT                              03372002
033721                                                                  03372102
033722         WHEN SQLWARN0 NOT = SPACES                               03372202
033723         WHEN SQLCODE NOT EQUAL ZERO                              03372302
033724              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      03372402
033725              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   03372502
033726              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      03372602
033727              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   03372702
033728              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      03372802
033729              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      03372902
033730              STRING  ' OPER-'               DELIMITED BY SIZE    03373002
033731                      PV-DISPLAY-OPER        DELIMITED BY SIZE    03373102
033732                      '  DOOR-'              DELIMITED BY SIZE    03373202
033733                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    03373302
033734                      '  DEST-'              DELIMITED BY SIZE    03373402
033735                      PV-DISPLAY-DEST        DELIMITED BY SIZE    03373502
033736                                        INTO                      03373602
033737                                        PC233-MESSAGE-TEXT(2)     03373702
033738             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    03373802
033739                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    03373902
033740                      '   SCAC-'             DELIMITED BY SIZE    03374002
033741                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    03374102
033742                      '   TRIP-'             DELIMITED BY SIZE    03374202
033743                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    03374302
033744                                        INTO                      03374402
033745                                        PC233-MESSAGE-TEXT(3)     03374502
033746             MOVE 3                   TO PV-ERROR-NBR             03374602
033747                                         PC233-ERROR-NBR          03374702
033748             PERFORM 9903-WRITE-CICS-LOG                          03374802
033749             MOVE '7010-GET-AVG-CRTN-WGT'                         03374902
033750                                      TO PC233-PARAGRAPH          03375002
033751             MOVE 'PCKRF744-SELECT TKRPRPM AVGWGT'                03375102
033752                                      TO PC233-MESSAGE-TEXT(1)    03375202
033753             MOVE SQLCA               TO PC233-SQLCA              03375302
033754             MOVE 'TKRPRPM'           TO PC233-DB2-TABLE-NAME(1)  03375402
033756             SET PC233-ABEND          TO TRUE                     03375602
033757             MOVE 99                  TO PC233-PGM-MSG-NBR        03375702
033758             PERFORM 8210-XCTL-ERROR-SCREEN                       03375802
033759     END-EVALUATE.                                                03375902
033760                                                                  03376002
033761                                                                  03376102
033764*----------------------------------------------------------------*03376402
033765*                                                                *03376502
033766*                                                                *03376602
033770*----------------------------------------------------------------*03377002
033800 8000-SEND-MAP.                                                   03380000
033900                                                                  03390000
034000     EXEC CICS                                                    03400000
034100         SEND MAP       ('PC744A')                                03410000
034200              MAPSET    ('PCKM744')                               03420000
034300              ERASE                                               03430000
034400              RESP      (PV-CICS-RESPONSE)                        03440000
034500     END-EXEC.                                                    03450000
034600                                                                  03460000
034700     EVALUATE TRUE                                                03470000
034800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03480000
034900             CONTINUE                                             03490000
035000         WHEN OTHER                                               03500000
035100             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          03510000
035200             MOVE 'PCKRF744 - UNABLE TO SEND MAP'                 03520000
035300                                      TO DP013-MESSAGE-TEXT (1)   03530000
035400             SET DP013-CICS-ABEND                                 03540000
035500                 DP013-ROLLBACK       TO TRUE                     03550000
035600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03560000
035700     END-EVALUATE.                                                03570000
035800                                                                  03580000
035900 8010-SEND-DATA-ONLY.                                             03590000
036000                                                                  03600000
036100     EXEC CICS                                                    03610000
036200         SEND MAP       ('PC744A')                                03620000
036300              MAPSET    ('PCKM744')                               03630000
036400              DATAONLY                                            03640000
036500              RESP      (PV-CICS-RESPONSE)                        03650000
036600     END-EXEC.                                                    03660000
036700                                                                  03670000
036800     EVALUATE TRUE                                                03680000
036900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03690000
037000             CONTINUE                                             03700000
037100         WHEN OTHER                                               03710000
037200             MOVE '8010-SEND-DATA-ONLY'                           03720000
037300                                      TO DP013-PARAGRAPH          03730000
037400             MOVE 'PCKRF744 - UNABLE TO SEND DATA'                03740000
037500                                      TO DP013-MESSAGE-TEXT (1)   03750000
037600             SET DP013-CICS-ABEND                                 03760000
037700                 DP013-ROLLBACK       TO TRUE                     03770000
037800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03780000
037900     END-EVALUATE.                                                03790000
038000                                                                  03800000
038100 8020-RECEIVE-MAP.                                                03810000
038200                                                                  03820000
038300     EXEC CICS                                                    03830000
038400         RECEIVE MAP    ('PC744A')                                03840000
038500                 MAPSET ('PCKM744')                               03850000
038600                 RESP   (PV-CICS-RESPONSE)                        03860000
038700     END-EXEC.                                                    03870000
038800                                                                  03880000
038900     EVALUATE TRUE                                                03890000
039000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03900000
039100             CONTINUE                                             03910000
039200         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                03920000
039300             CONTINUE                                             03930000
039400         WHEN OTHER                                               03940000
039500            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          03950000
039600            MOVE 'PCKRF744 - UNABLE TO RECEIVE MAP'               03960000
039700                                      TO DP013-MESSAGE-TEXT (1)   03970000
039800            SET DP013-LOGIC-ABEND     TO TRUE                     03980000
039900            SET DP013-ROLLBACK        TO TRUE                     03990000
040000            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                04000000
040100     END-EVALUATE.                                                04010000
040200                                                                  04020000
040300 8050-LINK.                                                       04030000
040400     MOVE 'PCKRF744'                  TO PC047-CALLING-PROGRAM    04040000
040500     MOVE LENGTH OF PC047-COMMAREA    TO PV-COMMAREA-LENGTH       04050000
040600     EXEC CICS                                                    04060000
040700         LINK                                                     04070000
040800             PROGRAM   (PC-TRAILER-PROGRAM)                       04080000
040900             COMMAREA  (PC047-COMMAREA)                           04090000
041000             LENGTH    (PV-COMMAREA-LENGTH)                       04100000
041100     END-EXEC.                                                    04110000
041200                                                                  04120000
041300 8100-RETURN-TRANID.                                              04130000
041400                                                                  04140000
041500     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       04150000
041600     EXEC CICS                                                    04160000
041700         RETURN TRANSID  (PC-TRANID)                              04170000
041800                COMMAREA (CA-COMMAREA)                            04180000
041900                LENGTH   (PV-COMMAREA-LENGTH)                     04190000
042000                RESP     (PV-CICS-RESPONSE)                       04200000
042100     END-EXEC.                                                    04210000
042200                                                                  04220000
042300     EVALUATE TRUE                                                04230000
042400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04240000
042500             CONTINUE                                             04250000
042600         WHEN OTHER                                               04260000
042700             MOVE '8100-RETURN-TRANIND'                           04270000
042800                                      TO DP013-PARAGRAPH          04280000
042900             MOVE 'PCKRF744 - UNABLE TO RETURN TO TRANID'         04290000
043000                 TO DP013-MESSAGE-TEXT (1)                        04300000
043100             SET DP013-CICS-ABEND     TO TRUE                     04310000
043200             SET DP013-ROLLBACK       TO TRUE                     04320000
043300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04330000
043400     END-EVALUATE.                                                04340000
043500                                                                  04350000
043600 8110-RETURN.                                                     04360000
043700                                                                  04370000
043800     EXEC CICS                                                    04380000
043900         SEND FROM (PV-MESSAGE-AREA)                              04390000
044000              LENGTH (19)                                         04400000
044100              ERASE                                               04410000
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400     EXEC CICS                                                    04440000
044500         RETURN                                                   04450000
044600     END-EXEC.                                                    04460000
044700                                                                  04470000
044800 8200-XCTL.                                                       04480000
044900     SET PC233-INITIALIZE-SCREEN      TO TRUE.                    04490000
045000     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      04500000
045100     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       04510000
045200                                                                  04520000
045300     EXEC CICS                                                    04530000
045400         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    04540000
045500               COMMAREA  (CA-COMMAREA)                            04550000
045600               LENGTH    (PV-COMMAREA-LENGTH)                     04560000
045700               RESP      (PV-CICS-RESPONSE)                       04570000
045800     END-EXEC.                                                    04580000
045900                                                                  04590000
046000     EVALUATE TRUE                                                04600000
046100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04610000
046200             CONTINUE                                             04620000
046300         WHEN OTHER                                               04630000
046400             MOVE '8200-XCTL'                                     04640000
046500                                      TO DP013-PARAGRAPH          04650000
046600             MOVE 'PCKRF744 - UNABLE TO XCTL TO PROGRAM: '        04660000
046700                                      TO DP013-MESSAGE-TEXT (1)   04670000
046800             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   04680000
046900             SET DP013-CICS-ABEND                                 04690000
047000                 DP013-ROLLBACK       TO TRUE                     04700000
047100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04710000
047200             MOVE PC-TRANS-UNAVAILABLE-MSG                        04720000
047300                                      TO AMSGLNO                  04730000
047400             SET PC233-PROCESS-SCREEN TO TRUE                     04740000
047500             PERFORM 8000-SEND-MAP                                04750000
047600             PERFORM 8100-RETURN-TRANID                           04760000
047700     END-EVALUATE.                                                04770000
047800                                                                  04780000
047900 8210-XCTL-ERROR-SCREEN.                                          04790000
048000     IF NOT PC233-ABEND                                           04800000
048100         SET PC233-INITIALIZE-SCREEN  TO TRUE                     04810000
048200     END-IF                                                       04820000
048300     IF PC233-PGM-MSG-NBR = ZERO                                  04830000
048400         MOVE 2                       TO PC233-PGM-MSG-NBR        04840000
048500     END-IF                                                       04850000
048600                                                                  04860000
048700     MOVE DFHEIBLK                    TO PC233-DFHEIBLK.          04870000
048800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      04880000
048900     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       04890000
049000     MOVE 'PCKRF871'                  TO PV-TRANSFER-PROGRAM      04900000
049100                                                                  04910000
049200     EXEC CICS                                                    04920000
049300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    04930000
049400               COMMAREA  (CA-COMMAREA)                            04940000
049500               LENGTH    (PV-COMMAREA-LENGTH)                     04950000
049600               RESP      (PV-CICS-RESPONSE)                       04960000
049700     END-EXEC.                                                    04970000
049800                                                                  04980000
049900     EVALUATE TRUE                                                04990000
050000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05000000
050100             CONTINUE                                             05010000
050200         WHEN OTHER                                               05020000
050300             MOVE '8200-XCTL'                                     05030000
050400                                      TO DP013-PARAGRAPH          05040000
050500             MOVE 'PCKRF744 - UNABLE TO XCTL TO PROGRAM: '        05050000
050600                                      TO DP013-MESSAGE-TEXT (1)   05060000
050700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   05070000
050800             SET DP013-CICS-ABEND                                 05080000
050900                 DP013-ROLLBACK       TO TRUE                     05090000
051000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05100000
051100             MOVE PC-TRANS-UNAVAILABLE-MSG                        05110000
051200                                      TO AMSGLNO                  05120000
051300             SET PC233-PROCESS-SCREEN TO TRUE                     05130000
051400             PERFORM 8000-SEND-MAP                                05140000
051500             PERFORM 8100-RETURN-TRANID                           05150000
051600     END-EVALUATE.                                                05160000
051700                                                                  05170000
051800*                                                                 05180000
051900 8220-XCTL-TO-HELP.                                               05190000
052000                                                                  05200000
052100     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       05210000
052200                                                                  05220000
052300     EXEC CICS                                                    05230000
052400         XCTL                                                     05240000
052500             PROGRAM   (PV-TRANSFER-PROGRAM)                      05250000
052600             COMMAREA  (PC192-COMMAREA)                           05260000
052700             LENGTH    (PV-COMMAREA-LENGTH)                       05270000
052800             RESP      (PV-CICS-RESPONSE)                         05280000
052900     END-EXEC.                                                    05290000
053000                                                                  05300000
053100     EVALUATE TRUE                                                05310000
053200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05320000
053300              CONTINUE                                            05330000
053400         WHEN OTHER                                               05340000
053500             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          05350000
053600             MOVE 'PCKRF744 - UNABLE TO XCTL TO PROGRAM: '        05360000
053700                                      TO DP013-MESSAGE-TEXT (1)   05370000
053800             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   05380000
053900             SET DP013-CICS-ABEND                                 05390000
054000                 DP013-ROLLBACK       TO TRUE                     05400000
054100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05410000
054200             MOVE PC-TRANS-UNAVAILABLE-MSG                        05420000
054300                                      TO AMSGLNO                  05430000
054400             SET PC233-PROCESS-SCREEN TO TRUE                     05440000
054500             PERFORM 8000-SEND-MAP                                05450000
054600             PERFORM 8100-RETURN-TRANID                           05460000
054700     END-EVALUATE.                                                05470000
054800/                                                                 05480000
054900 9000-SOFT-ABORT.                                                 05490000
055000                                                                  05500000
055100     EXEC CICS                                                    05510000
055200         SYNCPOINT ROLLBACK                                       05520000
055300     END-EXEC                                                     05530000
055400                                                                  05540000
055500     MOVE 1                           TO PC233-PGM-MSG-NBR        05550000
055600     MOVE SQLCODE                     TO PC233-SQLCODE            05560000
055700     PERFORM 8210-XCTL-ERROR-SCREEN.                              05570000
055800                                                                  05580000
055900                                                                  05590000
056000 9903-WRITE-CICS-LOG.                                             05600000
056100                                                                  05610000
056200     MOVE SQLCODE                     TO PV-SQLCODE               05620000
056300     MOVE PC233-USER-ID               TO PV-USER-ID               05630000
056400                                                                  05640000
056500     EXEC CICS                                                    05650000
056600         WRITEQ TD                                                05660000
056700             QUEUE  ('CSSL')                                      05670000
056800             FROM   (PV-LOG-MSG)                                  05680000
056900             RESP   (PV-CICS-RESPONSE)                            05690000
057000     END-EXEC.                                                    05700000
057100                                                                  05710000
057200     MOVE DP013-MESSAGE-TEXT (1)      TO PV-DISPLAY-MSG           05720000
057300                                                                  05730000
057400     EXEC CICS                                                    05740000
057500         WRITEQ TD                                                05750000
057600             QUEUE  ('CSSL')                                      05760000
057700             FROM   (PV-DISPLAY-MSG)                              05770000
057800             RESP   (PV-CICS-RESPONSE)                            05780000
057900     END-EXEC.                                                    05790000
058000                                                                  05800000
058100     MOVE DP013-MESSAGE-TEXT (2)      TO PV-DISPLAY-MSG           05810000
058200                                                                  05820000
058300     EXEC CICS                                                    05830000
058400         WRITEQ TD                                                05840000
058500             QUEUE  ('CSSL')                                      05850000
058600             FROM   (PV-DISPLAY-MSG)                              05860000
058700             RESP   (PV-CICS-RESPONSE)                            05870000
058800     END-EXEC.                                                    05880000
058900                                                                  05890000
059000     MOVE DP013-MESSAGE-TEXT (3)      TO PV-DISPLAY-MSG           05900000
059100                                                                  05910000
059200     EXEC CICS                                                    05920000
059300         WRITEQ TD                                                05930000
059400             QUEUE  ('CSSL')                                      05940000
059500             FROM   (PV-DISPLAY-MSG)                              05950000
059600             RESP   (PV-CICS-RESPONSE)                            05960000
059700     END-EXEC.                                                    05970000
059800                                                                  05980000
059900 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  05990000
060000                                                                  06000000
060100     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           06010000
060200     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          06020000
060300     INITIALIZE DP013-SRC-TASK-NUMBER                             06030000
060400                DP013-STACK.                                      06040000
060500     SET DP013-LINK-RETURN            TO TRUE.                    06050000
060600                                                                  06060000
060700     EXEC CICS                                                    06070000
060800         LINK                                                     06080000
060900             PROGRAM   (DP013-NAME)                               06090000
061000             COMMAREA  (DP013-PARAMETERS)                         06100000
061100             LENGTH    (DP013-LENGTH)                             06110000
061200     END-EXEC.                                                    06120000
