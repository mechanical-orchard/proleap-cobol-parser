000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    TRKUP092.                                         00050001
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   FEBRUARY 2021                                     00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM IS USED TO CLEAN UP OLD INBOUND TRIPS.            00120000
001300*  INPUT FILES CREATED BY TRKUT091 CONTAINING OLD TRIPS THAT NEED 00130000
001400*  TO BE CLEANED UP.  ALSO CREATED FILE OF ASSOCIATED SHIPMENTS   00140000
001410*  THAT ALSO NEED TO BE CLEANED UP.                               00141000
001420*                                                                 00142000
001421*  THIS PROGRAM WILL TAKE BOTH FILE (TRIP & SHIPMENT) AND CREATE  00142100
001422*  DE (DELETED) & ET (END TRIP) INSERT SQL STATEMENTS FOR         00142200
001423*  TTRIPST & TSHIPST TABLES.                                      00142300
001424*                                                                 00142400
001425******************************************************************00142500
001426******************************************************************00142600
001427 ENVIRONMENT DIVISION.                                            00142700
001428******************************************************************00142800
001429                                                                  00142900
001430 CONFIGURATION SECTION.                                           00143000
001440                                                                  00144000
001450 SOURCE-COMPUTER.        IBM-3090.                                00145000
001460 OBJECT-COMPUTER.        IBM-3090.                                00146000
001470                                                                  00147000
001480 INPUT-OUTPUT SECTION.                                            00148000
001490                                                                  00149000
001500 FILE-CONTROL.                                                    00150000
001600                                                                  00160000
001700     SELECT TRIP-FILE                                             00170000
001800         ASSIGN TO INP01.                                         00180000
001900                                                                  00190000
002000     SELECT SHIP-FILE                                             00200000
002100         ASSIGN TO INP02.                                         00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 FILE SECTION.                                                    00270000
002800                                                                  00280000
002900 FD  TRIP-FILE                                                    00290000
003000     RECORDING MODE IS F                                          00300000
003100     LABEL RECORDS ARE STANDARD                                   00310000
003200     BLOCK CONTAINS 0 RECORDS.                                    00320000
003300*                                                                 00330000
003400 01  TRIP-RECORD.                                                 00340000
003500     05  FILLER                  PIC X(125).                      00350000
003600                                                                  00360000
003700 FD  SHIP-FILE                                                    00370000
003800     RECORDING MODE IS F                                          00380000
003900     LABEL RECORDS ARE STANDARD                                   00390000
004000     BLOCK CONTAINS 0 RECORDS.                                    00400000
004100*                                                                 00410000
004200 01  SHIP-RECORD.                                                 00420000
004300     05  FILLER                  PIC X(100).                      00430000
004400                                                                  00440000
004500                                                                  00450000
004600*                                                                 00460000
004700******************************************************************00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900******************************************************************00490000
005000*                                                                 00500000
005100******************************************************************00510000
005200*  TRIP FILE                                                      00520000
005300******************************************************************00530000
005400     COPY TRRD074.                                                00540000
005500*                                                                 00550000
005600******************************************************************00560000
005700*  SHPMT FILE                                                     00570000
005800******************************************************************00580000
005900     COPY TRRD075.                                                00590000
006000*                                                                 00600000
006100*                                                                 00610000
006200 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00620000
006300                                                   COMP SYNC.     00630000
006400                                                                  00640000
006500 01  PC-PROGRAM-CONSTANTS.                                        00650000
006600     05  PC-TRKUP092                 PIC X(08) VALUE 'TRKUP092'.  00660001
006610                                                                  00661000
006620 01  PS-PROGRAM-SWITCHES.                                         00662000
006630     05  PS-EOF-TRIP-SW              PIC  X(01)    VALUE 'N'.     00663000
006640         88  PS-EOF-TRIP                           VALUE 'Y'.     00664000
006650         88  PS-MORE-TRIP                          VALUE 'N'.     00665000
006660     05  PS-EOF-SHIP-SW              PIC  X(01)    VALUE 'N'.     00666000
006670         88  PS-EOF-SHIP                           VALUE 'Y'.     00667000
006680         88  PS-MORE-SHIP                          VALUE 'N'.     00668000
006690                                                                  00669000
006700 01  DK-DB2-KEYS.                                                 00670000
006800     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00680000
006900                                                                  00690000
007000 01  PROGRAM-VARIABLES.                                           00700000
007100     05  PV-DISP-OPER-UNT            PIC  9(04).                  00710000
007110     05  PV-DISP-TRIP-ID             PIC  9(09).                  00711000
007120     05  PV-DISP-SHIPMT-ID           PIC  9(09).                  00712000
007130     05  PV-TRIP-COUNT               PIC  9(09).                  00713000
007140     05  PV-TTRIPST-CNT              PIC  9(09).                  00714000
007141     05  PV-TSHIPST-CNT              PIC  9(09).                  00714100
007142     05  PV-COMMIT-CNT               PIC  9(09).                  00714200
007143     05  PV-SHPMT-COUNT              PIC S9(09)  VALUE ZEROES     00714300
007144                                                 COMP.            00714400
007145     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00714500
007146                                                 COMP SYNC.       00714600
007147     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00714700
007148                                                 COMP SYNC.       00714800
007149     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00714900
007150     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00715000
007160                                                                  00716000
007170     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00717000
007190     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00719000
007200     05  PV-VEHICL-COUNT             PIC S9(09)    VALUE ZERO.    00720000
007201     05  PV-SHIP-COUNT               PIC S9(09)    VALUE ZERO.    00720100
007202     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO     00720200
007203                                                   COMP SYNC.     00720300
007204     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     00720400
007205                                                   COMP SYNC.     00720500
007206     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00720600
007207                                                                  00720700
007208     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00720800
007209                                                   COMP-3.        00720900
007210     05  PV-TMST-HOLD                PIC X(26).                   00721000
007211     05  PV-TMST-HOLD-R REDEFINES PV-TMST-HOLD.                   00721100
007212         10  PV-TMST-DATE            PIC X(10).                   00721200
007213         10  PV-TMST-TIME            PIC X(16).                   00721300
007214             88 PV-DP-TIME      VALUE '-00.01.00.000000'.         00721400
007215             88 PV-ET-TIME      VALUE '-00.02.00.000000'.         00721500
007216                                                                  00721600
007217 01  PV-ABEND-FIELDS.                                             00721700
007218     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUP092'.00721801
007219     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00721900
007220                                                 COMP SYNC.       00722000
007221     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00722100
007222     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00722200
007223     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00722300
007224     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00722400
007225     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00722500
007226     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00722600
007227     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00722700
007228     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00722800
007229     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00722900
007230     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00723000
007231     05  PV-NEW-STATUS-DTE           PIC  X(10)  VALUE SPACES.    00723100
007232                                                                  00723200
007233                                                                  00723300
007234***************************************************************** 00723400
007235*    SQL ABEND ROUTINE WORKING STORAGE                          * 00723500
007236***************************************************************** 00723600
007237     COPY DPWS004.                                                00723700
007238                                                                  00723800
007239     EXEC SQL                                                     00723900
007240        INCLUDE TTRIPST                                           00724000
007250     END-EXEC.                                                    00725000
007260                                                                  00726000
007270     EXEC SQL                                                     00727000
007280        INCLUDE TSHIPST                                           00728000
007290     END-EXEC.                                                    00729000
007300                                                                  00730000
007310     EXEC SQL                                                     00731002
007320        INCLUDE TVEHICL                                           00732003
007330     END-EXEC.                                                    00733002
007340                                                                  00734002
007400***************************************************************** 00740000
007500*   DB2 SQL COMMUNICATION AREA                                  * 00750000
007600***************************************************************** 00760000
007700     EXEC SQL                                                     00770000
007800          INCLUDE SQLCA                                           00780000
007900     END-EXEC.                                                    00790000
008000                                                                  00800000
008100                                                                  00810000
008200******************************************************************00820000
008300 PROCEDURE DIVISION.                                              00830000
008400******************************************************************00840000
008500                                                                  00850000
008600 0000-PROGRAM-MAINLINE.                                           00860000
008700******************************************************************00870000
008800* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00880000
008900*      PROGRAM.                                                   00890000
009000******************************************************************00900000
009100                                                                  00910000
009200     PERFORM 1000-INITIALIZE.                                     00920000
009300                                                                  00930000
009400     IF PS-MORE-TRIP                                              00940000
009500         PERFORM 2000-PROCESS-TRIP                                00950000
009600            UNTIL PS-EOF-TRIP                                     00960000
009700     END-IF.                                                      00970000
009800                                                                  00980000
009900     SET  PS-MORE-SHIP  TO  TRUE.                                 00990000
010000                                                                  01000000
010100     IF PS-MORE-SHIP                                              01010000
010200         PERFORM 2100-PROCESS-SHIP                                01020000
010300            UNTIL PS-EOF-SHIP                                     01030000
010400     END-IF.                                                      01040000
010500                                                                  01050000
010600     PERFORM 9000-EOJ-ROUTINE.                                    01060000
010700                                                                  01070000
010800     STOP RUN.                                                    01080000
010900                                                                  01090000
010910 1000-INITIALIZE.                                                 01091000
010920******************************************************************01092000
010930*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01093000
010940*    -- OPEN FILES                                                01094000
010950******************************************************************01095000
010951                                                                  01095107
010952     DISPLAY '************************************************'   01095207
010953     DISPLAY '** TRKUP092'                                        01095307
010954     DISPLAY '** '                                                01095407
010960                                                                  01096000
010970     OPEN INPUT TRIP-FILE                                         01097000
010980                SHIP-FILE.                                        01098000
010990                                                                  01099000
011000 2000-PROCESS-TRIP.                                               01100000
011100******************************************************************01110000
011200*  PROCESS THE TRIP FILE.                                         01120000
011300******************************************************************01130000
011400                                                                  01140000
011500     PERFORM 8000-READ-TRIP.                                      01150000
011600                                                                  01160000
011700     IF PS-EOF-TRIP                                               01170000
011800         CONTINUE                                                 01180000
011900     ELSE                                                         01190000
012600         MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID              01260002
012700         MOVE 'DE'                 TO TRIPST-TRIP-STATUS-CDE      01270002
012800         MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE           01280002
012900         MOVE '00:01:00'           TO TRIPST-STATUS-TME           01290002
013000         MOVE PC-TRKUP092          TO TRIPST-STATUS-UID           01300002
013100         MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID          01310002
013200         MOVE 1                    TO TRIPST-FCLTY-ID             01320002
013210         MOVE SPACES               TO TRIPST-FCLTY-AREA-ID        01321002
013220         MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE                01322002
013230         SET  PV-DP-TIME           TO TRUE                        01323002
013240         MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST             01324002
013241                                                                  01324100
013242         PERFORM 8200-INSERT-TTRIPST                              01324202
013243                                                                  01324300
013244         MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID              01324402
013245         MOVE 'ET'                 TO TRIPST-TRIP-STATUS-CDE      01324502
013246         MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE           01324602
013247         MOVE '00:02:00'           TO TRIPST-STATUS-TME           01324702
013248         MOVE PC-TRKUP092          TO TRIPST-STATUS-UID           01324802
013249         MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID          01324902
013250         MOVE 1                    TO TRIPST-FCLTY-ID             01325002
013260         MOVE SPACES               TO TRIPST-FCLTY-AREA-ID        01326002
013261         MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE                01326102
013262         SET  PV-ET-TIME           TO TRUE                        01326202
013263         MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST             01326302
013264                                                                  01326400
013265         PERFORM 8200-INSERT-TTRIPST                              01326507
013266                                                                  01326607
013267         PERFORM 8300-UPDATE-TVEHICL                              01326702
013268                                                                  01326800
013271     END-IF.                                                      01327102
013272                                                                  01327202
013280     IF  PV-COMMIT-CNT > 50                                       01328000
013290         PERFORM 8500-COMMIT                                      01329000
013300         MOVE ZEROES TO PV-COMMIT-CNT                             01330000
013310     END-IF.                                                      01331000
013320                                                                  01332000
013330                                                                  01333000
013340 2100-PROCESS-SHIP.                                               01334000
013350******************************************************************01335000
013360*  PROCESS THE SHIPMENT FILE.                                     01336000
013370******************************************************************01337000
013380                                                                  01338000
013390     PERFORM 8100-READ-SHIP.                                      01339000
013400                                                                  01340000
013500     IF PS-EOF-SHIP                                               01350000
013600         CONTINUE                                                 01360000
013610     ELSE                                                         01361000
013700         MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID            01370002
013701         MOVE 'DE'                  TO SHIPST-SHIPT-STATUS-CDE    01370102
013702         MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE          01370202
013703         MOVE '00:01:00'            TO SHIPST-STATUS-TME          01370302
013704         MOVE PC-TRKUP092           TO SHIPST-STATUS-UID          01370402
013705         MOVE SPACES                TO SHIPST-DELAY-RSN-CDE       01370502
013706         MOVE SPACES                TO SHIPST-CARR-STATUS-CDE     01370602
013707         MOVE SPACES                TO SHIPST-TIME-ZONE-CDE       01370702
013708         MOVE SPACES                TO SHIPST-CITY-NAME           01370802
013709         MOVE SPACES                TO SHIPST-STATE-CDE           01370902
013710         MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE               01371002
013711         SET  PV-DP-TIME            TO TRUE                       01371102
013712         MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST            01371202
013713                                                                  01371300
013714         PERFORM 8400-INSERT-TSHIPST                              01371402
013715                                                                  01371500
013716         MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID            01371602
013717         MOVE 'ET'                  TO SHIPST-SHIPT-STATUS-CDE    01371702
013718         MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE          01371802
013719         MOVE '00:02:00'            TO SHIPST-STATUS-TME          01371902
013720         MOVE PC-TRKUP092           TO SHIPST-STATUS-UID          01372002
013730         MOVE SPACES                TO SHIPST-DELAY-RSN-CDE       01373002
013740         MOVE SPACES                TO SHIPST-CARR-STATUS-CDE     01374002
013741         MOVE SPACES                TO SHIPST-TIME-ZONE-CDE       01374102
013742         MOVE SPACES                TO SHIPST-CITY-NAME           01374202
013743         MOVE SPACES                TO SHIPST-STATE-CDE           01374302
013744         MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE               01374402
013745         SET  PV-ET-TIME            TO TRUE                       01374502
013746         MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST            01374602
013747                                                                  01374700
013748         PERFORM 8400-INSERT-TSHIPST                              01374802
013750                                                                  01375000
013760     END-IF.                                                      01376000
013761                                                                  01376100
013762     IF  PV-COMMIT-CNT > 50                                       01376200
013763         PERFORM 8500-COMMIT                                      01376300
013764         MOVE ZEROES TO PV-COMMIT-CNT                             01376400
013765     END-IF.                                                      01376500
013766                                                                  01376600
013767                                                                  01376700
013768                                                                  01376800
013769 8000-READ-TRIP.                                                  01376900
013770******************************************************************01377000
013780*  READ THE TRIP DATA                                             01378000
013790******************************************************************01379000
013800     READ TRIP-FILE                                               01380000
013900          INTO  TR074-RECORD                                      01390000
014000          AT END                                                  01400000
014100             SET PS-EOF-TRIP TO TRUE.                             01410000
014200                                                                  01420000
014300     IF  PS-EOF-TRIP                                              01430000
014310         DISPLAY ' '                                              01431000
014320         CONTINUE                                                 01432000
014330     ELSE                                                         01433000
014340         ADD +1 TO PV-TRIP-COUNT                                  01434000
014350                                                                  01435000
014360         MOVE TR074-TRIP-ID     TO PV-DISP-TRIP-ID                01436000
014370         MOVE TR074-OPER-UNT-ID TO PV-DISP-OPER-UNT               01437000
014380         DISPLAY  'TTRIPST: '                                     01438000
014390                  TR074-OWNER-SCAC-ID   '/'                       01439000
014400                  TR074-VEH-NBR         ' '                       01440000
014500                  PV-DISP-TRIP-ID       ' '                       01450000
014600                  TR074-TRIP-STATUS-CDE ' '                       01460000
014610                  TR074-TRIP-STATUS-DTE ' '                       01461000
014620                  TR074-TRIP-STATUS-TME ' '                       01462000
014630                  TR074-TRIP-STATUS-UID ' '                       01463000
014640                  PV-DISP-OPER-UNT                                01464000
014650     END-IF.                                                      01465000
014660                                                                  01466000
014670                                                                  01467000
014680 8100-READ-SHIP.                                                  01468000
014690******************************************************************01469000
014700*  READ THE SHIP DATA                                             01470000
014800******************************************************************01480000
014900     READ SHIP-FILE                                               01490000
015000          INTO  TR075-RECORD                                      01500000
015010          AT END                                                  01501000
015020             SET PS-EOF-SHIP TO TRUE.                             01502000
015030                                                                  01503000
015040     IF  PS-EOF-SHIP                                              01504000
015050         DISPLAY ' '                                              01505000
015060         CONTINUE                                                 01506000
015070     ELSE                                                         01507000
015080         ADD +1 TO PV-SHIP-COUNT                                  01508000
015090                                                                  01509000
015091         MOVE TR075-TRIP-ID     TO PV-DISP-TRIP-ID                01509100
015092         MOVE TR075-SHIPT-ID    TO PV-DISP-SHIPMT-ID              01509200
015093         DISPLAY  'TSHIPST: '                                     01509300
015094                  PV-DISP-TRIP-ID        ' '                      01509400
015095                  PV-DISP-SHIPMT-ID      ' '                      01509500
015096                  TR075-SHIPT-STATUS-CDE ' '                      01509600
015097                  TR075-STATUS-DTE       ' '                      01509700
015098                  TR075-STATUS-TME       ' '                      01509800
015099     END-IF.                                                      01509900
015100                                                                  01510000
015101                                                                  01510100
015102******************************************************************01510200
015103* TTRIPST INSERTS                                                 01510300
015104******************************************************************01510400
015105 8200-INSERT-TTRIPST.                                             01510500
015106                                                                  01510600
015107     EXEC SQL                                                     01510700
015108          INSERT                                                  01510800
015109            INTO TTRIPST                                          01510908
015110                ( TRIP_ID                                         01511000
015120                , TRIP_STATUS_CDE                                 01512000
015130                , STATUS_DTE                                      01513000
015140                , STATUS_TME                                      01514000
015150                , STATUS_UID                                      01515000
015160                , OPER_UNT_ID                                     01516000
015170                , FCLTY_ID                                        01517000
015180                , FCLTY_AREA_ID                                   01518000
015190                , CRE_TMST)                                       01519000
015200          VALUES                                                  01520000
015300                (:TRIPST-TRIP-ID                                  01530000
015400                ,:TRIPST-TRIP-STATUS-CDE                          01540000
015500                ,:TRIPST-STATUS-DTE                               01550000
015600                ,:TRIPST-STATUS-TME                               01560000
015700                ,:TRIPST-STATUS-UID                               01570000
015800                ,:TRIPST-OPER-UNT-ID                              01580000
015900                ,:TRIPST-FCLTY-ID                                 01590000
016000                ,:TRIPST-FCLTY-AREA-ID                            01600000
016100                , CURRENT TIMESTAMP                               01610000
016200                )                                                 01620000
016300     END-EXEC.                                                    01630000
016400                                                                  01640000
016500     EVALUATE TRUE                                                01650000
016600         WHEN SQLCODE = ZERO                                      01660000
016700         WHEN SQLCODE = -803                                      01670000
016800              ADD +1 TO PV-TTRIPST-CNT                            01680000
016900                        PV-COMMIT-CNT                             01690000
017000                                                                  01700000
017100         WHEN OTHER                                               01710000
017200             MOVE '8200-WRITE-TTRIPST-SQL'                        01720000
017300                                       TO PV-ABEND-PARAGRAPH      01730000
017400             MOVE 'INSERT TTRIPST'     TO PV-ABEND-OPERATION      01740000
017500             PERFORM 9900-DB2-ABEND                               01750000
017600     END-EVALUATE.                                                01760000
017700                                                                  01770000
017800                                                                  01780000
017810******************************************************************01781002
017820*                                                                *01782002
017830******************************************************************01783002
017840 8300-UPDATE-TVEHICL.                                             01784002
017850                                                                  01785002
017860     MOVE TR074-OWNER-SCAC-ID TO VEHICL-OWNER-SCAC-ID             01786002
017870     MOVE TR074-VEH-NBR       TO VEHICL-VEH-NBR                   01787002
017880     MOVE 'TRKUP092'          TO VEHICL-LAST-UPD-UID              01788007
017890     MOVE 'ET'                TO VEHICL-CURR-STATUS-CDE           01789002
017891     MOVE SPACES              TO VEHICL-USAGE-CDE                 01789102
017892                                                                  01789202
017893     EXEC SQL                                                     01789302
017894         UPDATE TVEHICL                                           01789408
017895            SET LAST_UPD_DTE     =  CURRENT DATE                  01789502
017896               ,LAST_UPD_TME     =  CURRENT TIME                  01789602
017897               ,LAST_UPD_UID     = :VEHICL-LAST-UPD-UID           01789702
017898               ,CURR_STATUS_DTE  =  CURRENT DATE                  01789802
017899               ,CURR_STATUS_TME  =  CURRENT TIME                  01789902
017900               ,CURR_STATUS_CDE  = :VEHICL-CURR-STATUS-CDE        01790002
017901               ,USAGE_CDE        = :VEHICL-USAGE-CDE              01790102
017902               ,CURR_TRIP_ID     =  NULL                          01790202
017903         WHERE VEH_NBR           = :VEHICL-VEH-NBR                01790302
017904           AND OWNER_SCAC_ID     = :VEHICL-OWNER-SCAC-ID          01790402
017905     END-EXEC                                                     01790502
017906                                                                  01790602
017907     EVALUATE TRUE                                                01790702
017908         WHEN SQLCODE = +0                                        01790802
017909              ADD 1  TO  PV-COMMIT-CNT                            01790902
017910         WHEN OTHER                                               01791002
017911              DISPLAY 'VEHICLE NUMBER ' VEHICL-VEH-NBR            01791102
017912              DISPLAY 'SCAC ID ' VEHICL-OWNER-SCAC-ID             01791202
017913              STRING  VEHICL-OWNER-SCAC-ID '-'                    01791302
017914                      VEHICL-VEH-NBR        DELIMITED BY SIZE     01791402
017915                               INTO PV-DB2-OPERATION-MESSAGE-1    01791502
017916              MOVE '7000-UPDATE-TVEHICL  ' TO PV-PARAGRAPH-NAME   01791602
017917              MOVE 'UPDATE TVEHICL TABLE' TO PV-DB2-OPER-ATTEMPTED01791702
017918              PERFORM 9900-DB2-ABEND                              01791802
017919     END-EVALUATE.                                                01791902
017920                                                                  01792002
017921                                                                  01792102
017930                                                                  01793000
018000                                                                  01800000
018100******************************************************************01810000
018200* TSHIPST INSERTS                                                 01820000
018300******************************************************************01830000
018400 8400-INSERT-TSHIPST.                                             01840000
018500                                                                  01850000
018600     EXEC SQL                                                     01860000
018700          INSERT                                                  01870000
018800            INTO TSHIPST                                          01880008
018900                (SHIPT_ID                                         01890000
019000                ,SHIPT_STATUS_CDE                                 01900000
019100                ,STATUS_DTE                                       01910000
019200                ,STATUS_TME                                       01920000
019300                ,STATUS_UID                                       01930000
019400                ,DELAY_RSN_CDE                                    01940000
019500                ,CARR_STATUS_CDE                                  01950000
019600                ,TIME_ZONE_CDE                                    01960000
019700                ,CITY_NAME                                        01970000
019800                ,STATE_CDE                                        01980000
019900                ,CRE_TMST)                                        01990000
020000          VALUES                                                  02000000
020100                (:SHIPST-SHIPT-ID                                 02010000
020200                ,:SHIPST-SHIPT-STATUS-CDE                         02020000
020300                ,:SHIPST-STATUS-DTE                               02030000
020400                ,:SHIPST-STATUS-TME                               02040000
020410                ,:SHIPST-STATUS-UID                               02041000
020420                ,:SHIPST-DELAY-RSN-CDE                            02042000
020430                ,:SHIPST-CARR-STATUS-CDE                          02043000
020440                ,:SHIPST-TIME-ZONE-CDE                            02044000
020450                ,:SHIPST-CITY-NAME                                02045000
020460                ,:SHIPST-STATE-CDE                                02046000
020470                , CURRENT TIMESTAMP                               02047000
020480                )                                                 02048000
020490     END-EXEC.                                                    02049000
020500                                                                  02050000
020501     EVALUATE TRUE                                                02050100
020502         WHEN SQLCODE = ZERO                                      02050200
020503         WHEN SQLCODE = -803                                      02050300
020504              ADD +1 TO PV-TSHIPST-CNT                            02050400
020505                        PV-COMMIT-CNT                             02050500
020506                                                                  02050600
020507         WHEN OTHER                                               02050700
020508             MOVE '8400-INSERT-TSHIPST   '                        02050800
020509                                       TO PV-ABEND-PARAGRAPH      02050900
020510             MOVE 'INSERT TSHIPST'     TO PV-ABEND-OPERATION      02051000
020520             PERFORM 9900-DB2-ABEND                               02052000
020521     END-EVALUATE.                                                02052100
020522                                                                  02052200
020523                                                                  02052300
020524                                                                  02052400
020525******************************************************************02052500
020526*  COMMIT                                                         02052600
020527******************************************************************02052700
020528 8500-COMMIT.                                                     02052800
020529                                                                  02052900
020530     EXEC SQL                                                     02053000
020531         COMMIT                                                   02053100
020532     END-EXEC.                                                    02053200
020533                                                                  02053300
020534     DISPLAY ' '.                                                 02053400
020535     DISPLAY 'COMMIT'                                             02053500
020536     DISPLAY ' '.                                                 02053600
020537                                                                  02053700
020538                                                                  02053800
020539******************************************************************02053900
020540*  CLOSE OUTPUT FILE.                                             02054000
020541******************************************************************02054100
020542 9000-EOJ-ROUTINE.                                                02054200
020543     CLOSE TRIP-FILE                                              02054300
020544           SHIP-FILE.                                             02054400
020545                                                                  02054500
020546     DISPLAY 'TRKUP092 COUNTS'.                                   02054601
020547     DISPLAY ' '.                                                 02054700
020548     MOVE PV-TRIP-COUNT           TO PV-DISPLAY-COUNT             02054800
020549     DISPLAY 'TOTAL TRIP CNT:   '    PV-DISPLAY-COUNT.            02054900
020550     MOVE PV-TTRIPST-CNT          TO PV-DISPLAY-COUNT             02055000
020560     DISPLAY 'TTRIPST INSERTS:  '    PV-DISPLAY-COUNT.            02056000
020570     DISPLAY ' '.                                                 02057000
020580                                                                  02058000
020590     MOVE PV-SHIP-COUNT   TO PV-DISPLAY-COUNT                     02059000
020600     DISPLAY 'TOTAL SHIPMT CNT: '    PV-DISPLAY-COUNT.            02060000
020700     MOVE PV-TSHIPST-CNT          TO PV-DISPLAY-COUNT             02070000
020800     DISPLAY 'TSHIPST INSERTS:  '    PV-DISPLAY-COUNT.            02080000
020900     DISPLAY ' '.                                                 02090000
021000                                                                  02100000
021100***********************************************************       02110000
021200*                                                         *       02120000
021300***********************************************************       02130000
021400 9900-DB2-ABEND.                                                  02140000
021500                                                                  02150000
021600     MOVE SQLCODE TO PV-SQLCODE.                                  02160000
021700     DISPLAY '*** DB2 ERROR '.                                    02170000
021800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02180000
021900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02190000
022000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02200000
022100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02210000
022200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02220000
022300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02230000
022400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02240000
022500                                                                  02250000
022600     COPY DPPD004.                                                02260000
022700                                                                  02270000
022800     IF SQLCODE NOT = -911                                        02280000
022900         EXEC SQL                                                 02290000
023000              ROLLBACK                                            02300000
023100         END-EXEC                                                 02310000
023200     END-IF.                                                      02320000
023300                                                                  02330000
023400     MOVE +4013                  TO PV-ABEND-CODE.                02340000
023500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02350000
023600                                                                  02360000
