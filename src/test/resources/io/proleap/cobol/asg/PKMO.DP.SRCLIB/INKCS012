000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020092
000300*-----------------------*                                         00030092
000400 PROGRAM-ID.    INKCS012.                                         00040092
000500 AUTHOR.        M. FURLICK - STRATAGEM                            00050092
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060092
000700 DATE-WRITTEN.  09-29-93.                                         00070092
000800 DATE-COMPILED.                                                   00080092
000900                                                                  00090092
001000*----------------------------------------------------------------*00100092
001100*    I012 - PHYSICAL INVENTORY ADJUSTMENT ADD.                   *00110092
001200*                                                                *00120092
001300*    THIS PROGRAM IS INVOKED FROM INKCS010/011 OR 013. DISPLAY   *00130092
001400*    SUMMARY INVENTORY AND DETAIL ADJUSTMENT ROWS THAT EXIST     *00140092
001500*    FOR THE SELECTED STORE/AREA/SKU.  THE USER MAY ENTER AN     *00150092
001600*    ADJUSTMENT BY KEYING WHAT THE ACTUAL UNITS/PRICE SHOULD     *00160092
001700*    BE.  THIS PROGRAM CALCULATES THE DIFFERENCE BETWEEN WHAT    *00170092
001800*    IS ENTERED AND WHAT IS ON FILE TO CREATE AN ADJUSTMENT.     *00180092
001900*                                                                *00190092
002000*    SCOTT SWESSEL 09/10/98 - ADDED TYPE CODE 'SA'               *00200092
002100*----------------------------------------------------------------*00210092
002200*                                                                *00220092
002300*    JULIE SEIDLER 05/10/99 -                                    *00230092
002400*    AS PART OF AN ENHANCEMENT TO INCLUDE ONLINE PHYSICAL        *00240092
002500*    INVENTORY ADJUSTMENTS TO THE VARIANCE REPORT, A NEW         *00250092
002600*    INDICATOR WILL BE ADDED TO THE OUTPUT ADJUSTMENT VSAM FILE. *00260092
002700*    THIS INDICATOR WILL SHOW WHETHER OR NOT THE STORE HAS        00270092
002800*    COMPLETED UNIT BOOKING AT THE TIME OF THE ONLINE ADJUSTMENT. 00280092
002900*----------------------------------------------------------------*00290092
003000*    RONNA BUTZ 04/25/02                                          00300092
003100*    MASS DELETE PROJECT - ALLOW THE ADJUSTMENT BRING THE QUANTITY00310092
003200*    DOWN TO ZERO.  LOSS PREVENTION WANTS TO BE ABLE              00320092
003300*    TO TAKE AN ITEM DOWN TO ZERO IN AN EXISTING AREA             00330092
003400*    AS OPPOSED TO PUTTING AN ADJUSTMENT IN AREA 999999.          00340092
003500*----------------------------------------------------------------*00350092
003000*    CHANGED BY IGSI    10/24/02     WR# 21732                   *00360092
W21732*                                                                *00370092
W21732*    CHANGED THE PROGRAM TO USE NON-INTELLIGENT SKU INSTEAD OF   *00380092
W21732*    DEPT/CLASS/SEQ NUMBER. AND TO LOAD FASHION SALES VSAM FILE  *00390092
W21732*    WITH NON-INTELLIGENT SKU INSTEAD OF DEPT/CLASS/SEQ NUMBER.  *00400092
      *----------------------------------------------------------------*00410092
C21732*    CHANGE BY S JACKSON  3/17/03                                *00420092
C21732*    USE DPKUT041 - NEW SKU COMPLIANT UPC LOOKUP MODULE           00430092
W25248*----------------------------------------------------------------*00440092
W25248*    CHANGE BY S JACKSON  9/29/03     CHANGE ID : W25248         *00450092
W25248*    CHANGE MAP AND PROGRAM TO ALLOW FOR ENTRY OF UPC. ADDED     *00460092
W25248*    LOGIC TO HANDLE PARAMETERS PASSED IN FROM NEW UPC LIST      *00470092
W25248*    SCREEN. USERS WILL BE ABLE TO ADD/ADJUST ENTRIES BASED ON   *00480092
W25248*    EITHER SKU OR UPC.                                          *00490092
W25248*----------------------------------------------------------------*00500092
R25248*  12/04/03 - R.JANSSEN  -   WR#25248                           * 00510092
R25248*      ISSUE ON THE SUMMARY SCREEN WHERE THE LAST SKU NUMBER IS * 00520092
R25248*    NOT DISPLAYING ON THE SCREEN.                              * 00530092
W25248*---------------------------------------------------------------* 00540011
X25248*  12/04/03 - R.JANSSEN  -   WR#25248                           * 00550092
X25248*      SKU/UPC EXISTS EDITS WERE NOT FIRING WHEN A USER ENTERED * 00560092
X25248*    AN UPC. (PART OF THE UPC MOD)                              * 00570092
W25248*---------------------------------------------------------------* 00580011
      * 26600    04-20-2004  STORE NUMBER EXPANSION FOR INV. LEDGER   * 00590092
      *                      TEMPORARILY ADD LOC-NBR TO INSERT STMT   * 00600092
      *                      -V. LEE YANG                             * 00610092
      *---------------------------------------------------------------* 00620011
W26682*  06/23/04 - R.JANSSEN  -   WR#26682                           * 00630092
W26682*      SQL -811 OCCURING ON AN ADD ON THE MAIN ADJUSTMENT SCREEN* 00640092
      *---------------------------------------------------------------* 00650011
R26682*  06/25/04 - R.JANSSEN  -   WR#26682                             00660092
R26682*      ERROR PC-TSYMSG-00117 FOR 83010000 SKUS IN AREA 888888     00670092
R26682*    AND 999999. WHY?                                             00680092
W26600* W26600  06-29-2004 ROD JANSSEN INV STORE EXPANSION              00690092
R26600* R26600  06-29-2004 ROD JANSSEN ADJUSTMENTS ARE NOT SHOWING UP   00700092
R26600*                                ON THE ADJUSTMENT ADD SCREEN.    00710092
R26600*                                WHY?                             00720092
W27710* W27710  01-21-2005 DETAIL ADJUSTMENTS WERE BEING DISPLAYED ON   00730092
W27710*                    EVERY INSTANCE OF STORE/AREA/SKU. ADD DKEY   00740092
W27710*                    TO ADJ-CSR2 CURSOR  - SCOTT JACKSON          00750092
W27710* W28543  06-08-2005 CHECK PS-ERROR-SW STATUS BEFORE WRITING TO   00760092
W27710*                    VSAM FILE. VALUE SHOULD BE 'N'.              00770092
W27710*                                        - ERIN SEARL             00780092
W28545* W28545  04-18-2006 ADD COMON PRICING INWS400 AND INPD400 TO     00790092
W28545*                    REPLACE SKU AND UPD LOOK UPS.                00800092
W28545*                                        - B. GRAHAM              00810092
J28545* W28545  06-16-2006 TINVPAR/TINCNTL ARE USED TO GET              00811099
J28545*                    THE PROPER INV-ID AND STORE                  00812099
J28545*                    -JAN BLAZICH                                 00813099
W28545* F28545  09-12-2006 -B. GRAHAM - STRATAGEM                     * 00814099
W28545*      CHG PASS DATE FROM IN400-PV-EFF-BEG-DTE-IN TO            * 00815099
W28545*                         IN400-PV-EFF-DTE-IN                   * 00816099
W28582* W28582  07-31-2007 AFTER LOOKING UP RETAIL WITH UPC           * 00817099
W28582*                    CHECK FOR DUMMY.                           * 00818099
W28582*                    -J. SELWITSCHKA                            * 00819099
      * W33304  05-01-2008 JILL LIN  HOLDING INVENTORY LEDGER OPEN    * 00819199
      *                              ACROSS PERIODS INVENTORY SHORTAGE* 00819299
      *                              REPORTING                        * 00819399
SR3403* SR3403  05-01-2012 JALAJ KUMAR  EXPANSIONS FOR LARGE RETAIL   * 00821099
SR3403*                                 PROJECT                       * 00822099
      *---------------------------------------------------------------* 00824099
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126         00825099
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00826099
263126* MAKING THE CALL DYNAMIC VS STATIC.                              00827099
263126*----------------------------------------------------------------*00828099
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00829099
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00829199
1122RM* THE CICS ARCHITECTURE API.                                      00829299
1122RM*---------------------------------------------------------------* 00829399
      * CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369         00829499
      * REMOVED COPYBOOK FOR UPC CHECK DIGIT ROUTINE                    00829599
      *---------------------------------------------------------------* 00829799
003600                                                                  00830092
003800 ENVIRONMENT DIVISION.                                            00840092
004000 DATA DIVISION.                                                   00850092
                                                                        00860092
004300 WORKING-STORAGE SECTION.                                         00870092
W25248 01  PA-PROGRAM-ACCUMULATORS.                                     00880092
           05  PA-INV-QTY               PIC S9(05)  COMP.               00890092
           05  PA-EXTD-AMT              PIC S9(07)V99  COMP.            00900092
                                                                        00910092
004400 01  PC-PROGRAM-CONSTANTS.                                        00920092
004500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'INKCS012'.  00930092
004600     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'IN012A  '.  00940092
004700     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'INKM012 '.  00950092
004800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00960092
004900                                              COMP.               00970092
005000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00980092
005100                                              COMP.               00990092
005200     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           01000092
005300                                              COMP.               01010092
005400     05  PC-INTER-APPL-CODES.                                     01020092
W25248***          FROM CRIT SPEC SCREEN (I010)                         01030092
005500         10  PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.   01040092
W25248***          FROM SKU LIST SCREEN  (I011)                         01050092
005600         10  PC-INTER-APPL-LIST          PIC  X(01)  VALUE '2'.   01060092
W25248***          FROM UPC LIST SCREEN  (I013)                         01070092
W25248         10  PC-INTER-APPL-DETAIL        PIC  X(01)  VALUE '3'.   01080092
005700                                                                  01090092
005800     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       01100092
005900     05  PC-30                    PIC  9(03)  VALUE 30 COMP-3.    01110092
006000     05  PC-9000                  PIC  9(05)  VALUE 9000.         01120092
006100     05  PC-9999                  PIC  9(05)  VALUE 9999.         01130092
006200     05  PC-98                    PIC  9(02)  VALUE 98.           01140092
006300     05  PC-15                    PIC  9(02)  VALUE 15.           01150092
006400     05  PC-11                    PIC  9(02)  VALUE 11.           01160092
006500     05  PC-9                     PIC  9(01)  VALUE 9.            01170092
006600     05  PC-7                     PIC  9(01)  VALUE 7.            01180092
W21732     05  PC-8                     PIC  9(01)  VALUE 8.            01190092
006800     05  PC-2                     PIC  9(01)  VALUE 2.            01200092
006900     05  PC-CO                    PIC  X(02)  VALUE 'CO'.         01210092
007000     05  PC-CORRECTION            PIC  X(10)  VALUE 'CORRECTION'. 01220092
007100     05  PC-N                     PIC  X(01)  VALUE 'N'.          01230092
007200     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          01240092
007300     05  PC-SCL                   PIC  X(03)  VALUE 'SCL'.        01250092
W25248     05  PC-MAX-SKU               PIC S9(08)V VALUE +99999999     01260092
W25248                                              COMP-3.             01270092
007400     05  PC-MAX-PRICE             PIC S9(05)V99 VALUE +99999.99   01280092
007500                                              COMP-3.             01290092
007600     05  PC-MAX-EXTENDED-PRICE    PIC S9(09)V99                   01300092
007700                                              VALUE +999999999.99 01310092
007800                                              COMP-3.             01320092
007900     05  PC-MIN-EXTENDED-PRICE    PIC S9(09)V99                   01330092
008000                                              VALUE -999999999.99 01340092
008100                                              COMP-3.             01350092
008200     05  PC-MAX-QUANTITY          PIC S9(07)    VALUE +99999      01360092
008300                                              COMP-3.             01370092
008400     05  PC-MIN-QUANTITY          PIC S9(07)    VALUE -99999      01380092
008500                                              COMP-3.             01390092
008600     05  PC-20-CENTS              PIC S9(01)V99 VALUE .20         01400092
008700                                              COMP-3.             01410092
008800     05  PC-PRIME1                PIC S9(05)  COMP-3              01420092
008900                                              VALUE +38543.       01430092
009000     05  PC-NINES-DATE            PIC X(10)   VALUE '9999-09-09'. 01440092
009100     05  PC-PRIME2                PIC S9(05)  COMP-3              01450092
009200                                              VALUE +58889.       01460092
009300     05  PC-ONE-BILLION           PIC S9(11)  COMP-3              01470092
009400                                              VALUE +1000000000.  01480092
W33304     05  PC-STR-BKNG-IN-PROGRESS  PIC X(02)   VALUE 'IP'.         01490099
009600                                                                  01500092
009700     05  PC-TSYMSG-NUMBERS.                                       01510092
009800         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       01520092
009900         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       01530092
010000         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       01540092
010100         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       01550092
010200         10  PC-TSYMSG-00046      PIC  9(05)  VALUE  00046.       01560092
010300         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       01570092
010400         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       01580092
010500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       01590092
010600         10  PC-TSYMSG-00073      PIC  9(05)  VALUE  00073.       01600092
010700         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       01610092
010800         10  PC-TSYMSG-00100      PIC  9(05)  VALUE  00100.       01620092
010900         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       01630092
011000         10  PC-TSYMSG-00124      PIC  9(05)  VALUE  00124.       01640092
011100         10  PC-TSYMSG-00125      PIC  9(05)  VALUE  00125.       01650092
011200         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       01660092
011300         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       01670092
011400         10  PC-TSYMSG-00316      PIC  9(05)  VALUE  00316.       01680092
011500         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       01690092
011600         10  PC-TSYMSG-00410      PIC  9(05)  VALUE  00410.       01700092
011700         10  PC-TSYMSG-00453      PIC  9(05)  VALUE  00453.       01710092
011800         10  PC-TSYMSG-00474      PIC  9(05)  VALUE  00474.       01720092
011900         10  PC-TSYMSG-00547      PIC  9(05)  VALUE  00547.       01730092
012000         10  PC-TSYMSG-00548      PIC  9(05)  VALUE  00548.       01740092
012100         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       01750092
012200         10  PC-TSYMSG-00686      PIC  9(05)  VALUE  00686.       01760092
012300         10  PC-TSYMSG-00687      PIC  9(05)  VALUE  00687.       01770092
012400         10  PC-TSYMSG-00688      PIC  9(05)  VALUE  00688.       01780092
012500         10  PC-TSYMSG-00698      PIC  9(05)  VALUE  00698.       01790092
W25248         10  PC-TSYMSG-01657      PIC  9(05)  VALUE  01657.       01800092
012600         10  PC-TSYMSG-02150      PIC  9(05)  VALUE  02150.       01810092
012700         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01820092
012800*                                                                 01830092
012900 01  PS-PROGRAM-SWITCHES.                                         01840092
013000     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01850092
013100         88  PS-ERROR                         VALUE  'Y'.         01860092
013200         88  PS-WARNING                       VALUE  'W'.         01870092
013300         88  PS-NO-ERROR                      VALUE  'N'.         01880092
013400     05  PS-QTY-ENTERED-SW        PIC  X(01)  VALUE  'N'.         01890092
013500         88  PS-QTY-ENTERED                   VALUE  'Y'.         01900092
013600     05  PS-PRICE-ENTERED-SW      PIC  X(01)  VALUE  'N'.         01910092
013700         88  PS-PRICE-ENTERED                 VALUE  'Y'.         01920092
013800     05  PS-REASON-ENTERED-SW     PIC  X(01)  VALUE  'N'.         01930092
013900         88  PS-REASON-ENTERED                VALUE  'Y'.         01940092
014000     05  PS-GOOD-SKU-SW           PIC X(01)   VALUE  'N'.         01950092
014100         88  PS-GOOD-SKU                      VALUE  'Y'.         01960092
014200         88  PS-BAD-SKU                       VALUE  'N'.         01970092
014000     05  PS-GOOD-UPC-SW           PIC X(01)   VALUE  'N'.         01980092
014100         88  PS-GOOD-UPC                      VALUE  'Y'.         01990092
014200         88  PS-BAD-UPC                       VALUE  'N'.         02000092
014300     05  PS-INSERT-SW             PIC X(01)   VALUE  'N'.         02010092
014400         88  PS-INSERT-DONE                   VALUE  'Y'.         02020092
014500         88  PS-INSERT-NOT-DONE               VALUE  'N'.         02030092
014600     05  PS-ROW-EXISTS-SW         PIC X(01)   VALUE  'N'.         02040092
014700         88  PS-ROW-FOUND                     VALUE  'Y'.         02050092
014800         88  PS-ROW-NOT-FOUND                 VALUE  'N'.         02060092
014900     05  PS-QTY-PRICE-ERROR-SW    PIC X(01)   VALUE  'N'.         02070092
015000         88  PS-QTY-PRICE-ERROR               VALUE  'Y'.         02080092
015100     05  PS-SKU-ENTERED-SW        PIC  X(01).                     02090092
015200         88  PS-SKU-ENTERED                   VALUE  'Y'.         02100092
015300         88  PS-SKU-NOT-ENTERED               VALUE  'N'.         02110092
W25248     05  PS-UPC-ENTERED-SW        PIC  X(01).                     02120092
W25248         88  PS-UPC-ENTERED                   VALUE  'Y'.         02130092
W25248         88  PS-UPC-NOT-ENTERED               VALUE  'N'.         02140092
W25248     05  PS-SUMINV-CSR-SW         PIC  X(01)  VALUE  'N'.         02150092
W25248         88  PS-EOF-SUMINV-CSR                VALUE  'Y'.         02160092
W25248         88  PS-NOT-EOF-SUMINV                VALUE  'N'.         02170092
W25248     05  PS-ADJADD-CSR-SW         PIC  X(01)  VALUE  'N'.         02180092
W25248         88  PS-EOF-ADJADD-CSR                VALUE  'Y'.         02190092
W25248         88  PS-NOT-EOF-ADJADD                VALUE  'N'.         02200092
015400*                                                                 02210092
015500 01  PV-PROGRAM-VARIABLES.                                        02220092
015600     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            02230092
015700                                              COMP SYNC.          02240092
015800     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            02250092
015900                                              COMP SYNC.          02260092
016000     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            02270092
016100                                              COMP SYNC.          02280092
016200     05  PV-RBA                   PIC S9(09)  COMP VALUE ZERO.    02290092
016300     05  PV-DISPLAY-RESP          PIC  9(08)  VALUE ZERO.         02300092
016400     05  PV-WORK-PR-AMT-X.                                        02310092
016500         10  PV-WORK-PR-AMT       PIC S9(05)V99.                  02320092
016600     05  PV-TOT-EXT-PRICE         PIC S9(15)V99 COMP-3.           02330092
016700     05  PV-ADJ-EXT1              PIC S9(15)V99 COMP-3.           02340092
016800     05  PV-ADJ-EXT2              PIC S9(15)V99 COMP-3.           02350092
016900                                                                  02360092
017600     05  PV-WORK-UPC-X2.                                          02370092
W25248         10  FILLER               PIC X(2)    VALUE ZEROES.       02380092
017700         10  FILLER               PIC X(4)    VALUE '0400'.       02390092
W21732         10  PV-UPC-SKU2          PIC X(8).                       02400092
W25248*        10  PV-UPC-SKU2          PIC 9(15).                      02410092
018100         10  PV-UPC-CHK-DIG2      PIC 9       VALUE ZERO.         02420092
018200     05  PV-WORK-UPC2  REDEFINES  PV-WORK-UPC-X2                  02430092
W25248                                  PIC 9(15).                      02440092
W25248     05  PV-HOLD-INTR-UPC-ID      PIC  S9(9) COMP.                02450092
W25248                                                                  02460092
018500     05  PV-WORK-SKU.                                             02470092
W21732         10  PV-WORK-SKU-NBR      PIC X(8).                       02480092
W25248     05  PV-WORK-UPC.                                             02490092
W25248         10  PV-WORK-UPC-NBR      PIC X(15).                      02500092
W21732     05  PV-EIGHT                 PIC 9(08).                      02510092
W21732     05  FILLER  REDEFINES  PV-EIGHT.                             02520092
W21732         10  PV-EIGHT-X           PIC X(08).                      02530092
W25248     05  PV-FIFTEEN               PIC 9(15).                      02540092
W25248     05  FILLER  REDEFINES  PV-FIFTEEN.                           02550092
W25248         10  PV-FIFTEEN-X         PIC X(15).                      02560092
020200                                                                  02570092
020300     05  PV-WORK-TMST.                                            02580092
020400         10  PV-WT-CC             PIC X(02).                      02590092
020500         10  PV-WT-YY             PIC X(02).                      02600092
020600         10  FILLER               PIC X(01).                      02610092
020700         10  PV-WT-MM             PIC X(02).                      02620092
020800         10  FILLER               PIC X(01).                      02630092
020900         10  PV-WT-DD             PIC X(02).                      02640092
021000         10  FILLER               PIC X(16).                      02650092
021100     05  PV-DISPLAY-DATE.                                         02660092
021200         10  PV-DD-MM             PIC XX.                         02670092
021300         10  FILLER               PIC X(01)   VALUE '/'.          02680092
021400         10  PV-DD-DD             PIC XX.                         02690092
021500         10  FILLER               PIC X(01)   VALUE '/'.          02700092
021600         10  PV-DD-YY             PIC XX.                         02710092
021700                                                                  02720092
021800     05  PV-RANDOM-NUMBER                PIC S9(11)   COMP-3      02730092
021900                                                      VALUE +0.   02740092
022000     05  PV-SEED                         PIC S9(11)   COMP-3      02750092
022100                                                      VALUE +0.   02760092
022200     05  PV-WORK-FIELD                   PIC S9(17)   COMP-3      02770092
022300                                                      VALUE +0.   02780092
022400     05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3      02790092
022500                                                      VALUE +0.   02800092
022600     05  PV-TODAYS-TIME                  PIC 9(08)    VALUE ZERO. 02810092
022700     05  FILLER  REDEFINES  PV-TODAYS-TIME.                       02820092
022800         10  PV-HH                       PIC 9(02).               02830092
022900         10  PV-MIN                      PIC 9(02).               02840092
023000         10  PV-SEC                      PIC 9(02).               02850092
023100         10  PV-HUND-SEC                 PIC 9(02).               02860092
023200     05  PV-INITIAL-SEED                 PIC 9(08)    VALUE ZERO. 02870092
023300     05  FILLER REDEFINES PV-INITIAL-SEED.                        02880092
023400         10  PV-SEED-BYTE-1-2            PIC 9(02).               02890092
023500         10  PV-SEED-BYTE-3-4            PIC 9(02).               02900092
023600         10  PV-SEED-BYTE-5-6            PIC 9(02).               02910092
023700         10  PV-SEED-BYTE-7-8            PIC 9(02).               02920092
023800     05  PV-QTY-FORMAT                   PIC -----9.              02930092
W21732     05  PV-MAJ-CL-NBR.                                           02940092
W21732         10  PV-MAJ-CL-NBR1              PIC X.                   02950092
W21732         10  PV-MAJ-CL-NBR2              PIC X.                   02960092
W21732     05  PV-SUB-CL-NBR.                                           02970092
W21732         10  PV-SUB-CL-NBR1              PIC X      VALUE '0'.    02980092
W21732         10  PV-SUB-CL-NBR2-3            PIC  X(02).              02990092
W28545     05  PV-STAT-CDE                     PIC  9(02).              03000092
W21732     05  PV-SKU                          PIC  9(08).              03010092
W25248     05  PV-UPC                          PIC  9(15).              03020092
W25248     05  PV-HOLD-SKU                     PIC  S9(8)V COMP-3.      03030092
W25248     05  PV-HOLD-UPC                     PIC  S9(15)V COMP-3.     03040092
W25248     05  PV-UPC-NUMBER                   PIC  9(15).              03050092
W26600     05  PV-STORE-NBR-X                  PIC  X(04)  VALUE ZEROES.03060092
W26600     05  PV-STORE-NBR-9 REDEFINES PV-STORE-NBR-X                  03070092
W26600                                         PIC  9(04).              03080092
023900/                                                                 03090092
024000*----------------------------------------------------------------*03100092
024100*  THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING         *03110092
024200*  SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.          *03120092
024300*----------------------------------------------------------------*03130092
024400     COPY INWS012.                                                03140092
024500/                                                                 03150092
024600                                                                  03160092
024700*----------------------------------------------------------------*03170092
024800*    MAP LAYOUT                                                  *03180092
024900*----------------------------------------------------------------*03190092
025000                                                                  03200092
W26600     COPY INKM012.                                                03210092
025200                                                                  03220092
025300 01  MR-OCCURS-LAYOUT                   REDEFINES  IN012AO.       03230092
W26600     05  FILLER                         PIC X(142).               03240092
025500     05  MR-SCROLL-AREA                 OCCURS 6 TIMES.           03250092
025600         10  MR-USERIDL                 PIC S9(04) COMP.          03260092
025700         10  MR-USERIDA                 PIC  X(01).               03270092
025800         10  MR-USERIDC                 PIC  X(01).               03280092
025900         10  MR-USERIDH                 PIC  X(01).               03290092
026000         10  MR-USERIDO                 PIC  X(08).               03300092
026100                                                                  03310092
026200         10  MR-ADJ-DATEL               PIC S9(04) COMP.          03320092
026300         10  MR-ADJ-DATEA               PIC  X(01).               03330092
026400         10  MR-ADJ-DATEC               PIC  X(01).               03340092
026500         10  MR-ADJ-DATEH               PIC  X(01).               03350092
026600         10  MR-ADJ-DATEO               PIC  X(08).               03360092
026700                                                                  03370092
026800         10  MR-ADJ-QTYL                PIC S9(04) COMP.          03380092
026900         10  MR-ADJ-QTYA                PIC  X(01).               03390092
027000         10  MR-ADJ-QTYC                PIC  X(01).               03400092
027100         10  MR-ADJ-QTYH                PIC  X(01).               03410092
027200         10  MR-ADJ-QTYX.                                         03420092
027300             15  MR-ADJ-QTYO            PIC  -(06)9.              03430092
027400                                                                  03440092
027500         10  MR-ADJ-PRICEL              PIC S9(04) COMP.          03450092
027600         10  MR-ADJ-PRICEA              PIC  X(01).               03460092
027700         10  MR-ADJ-PRICEC              PIC  X(01).               03470092
027800         10  MR-ADJ-PRICEH              PIC  X(01).               03480092
027900         10  MR-ADJ-PRICEX.                                       03490092
SR3403             15  MR-ADJ-PRICEO          PIC  -(06).99.            03501099
028100                                                                  03510092
028200         10  MR-EXT-PRICEL              PIC S9(04) COMP.          03520092
028300         10  MR-EXT-PRICEA              PIC  X(01).               03530092
028400         10  MR-EXT-PRICEC              PIC  X(01).               03540092
028500         10  MR-EXT-PRICEH              PIC  X(01).               03550092
028600         10  MR-EXT-PRICEX.                                       03560092
028700             15  MR-EXT-PRICEO          PIC  -(10).99.            03570092
028800                                                                  03580092
028900         10  MR-ADJ-REASONL             PIC S9(04) COMP.          03590092
029000         10  MR-ADJ-REASONA             PIC  X(01).               03600092
029100         10  MR-ADJ-REASONC             PIC  X(01).               03610092
029200         10  MR-ADJ-REASONH             PIC  X(01).               03620092
SR3403         10  MR-ADJ-REASONO             PIC  X(19).               03631099
029400                                                                  03640092
029500/                                                                 03650092
029600*----------------------------------------------------------------*03660092
029700*    ATTRIBUTE SETTINGS COPYBOOK.                                *03670092
029800*----------------------------------------------------------------*03680092
029900                                                                  03690092
030000     COPY DPWS015.                                                03700092
030100                                                                  03710092
030200*----------------------------------------------------------------*03720092
030300*    FUNCTION KEYS COPYBOOK                                      *03730092
030400*----------------------------------------------------------------*03740092
030500                                                                  03750092
030600     COPY DPWS016.                                                03760092
030700                                                                  03770092
030800*----------------------------------------------------------------*03780092
030900*    VSAM ADJUSTMENT RECORD LAYOUT.                              *03790092
031000*----------------------------------------------------------------*03800092
031100                                                                  03810092
W26600     COPY INWS015.                                                03820092
031300/                                                                 03830092
031400**--------------------------------------------------------------**03840092
031500** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **03850092
031600** SUB-ROUTINE (DPKUT100).                                      **03860092
031700**--------------------------------------------------------------**03870092
031800     COPY DPWS010I.                                               03880092
031900/                                                                 03890092
032600**--------------------------------------------------------------**03960092
032700** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*03970092
032800** APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.        **03980092
032900**--------------------------------------------------------------**03990092
033000     COPY DPWS030.                                                04000092
1122RM     COPY DPWS930.                                                04001099
033100/                                                                 04010092
033200**--------------------------------------------------------------**04020092
033300*    STANDARD COMMAREA.                                           04030092
033400**--------------------------------------------------------------**04040092
033500                                                                  04050092
033600     COPY DPWS020.                                                04060092
033700     05  INKCS012-APPL REDEFINES DP020-VARIABLE-COMMAREA.         04070092
033800                                                                  04080092
033900***************************************************************** 04090092
034000*    INTER-APPLICATION COMMAREA.                                  04100092
034100***************************************************************** 04110092
034200                                                                  04120092
034300         10  INTER-APPL-COMM-AREA PIC X(200).                     04130092
W26600     COPY INWS001.                                                04140092
034500***************************************************************** 04150092
034600*    SPECIFIC COMMMAREA FOR DPKCS041.                             04160092
034700***************************************************************** 04170092
034800         10  ASC-SPECIFIC-COMMAREA.                               04180092
034900             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            04190092
W26600             15  ASC-STORE-NBR             PIC X(04).             04200092
035100             15  ASC-AREA-NBR              PIC S9(08)    COMP.    04210092
035200             15  ASC-ADJ-TYPE-CDE          PIC  X(02).            04220092
035300                 88  ASC-ADJ-TYPE-SI                  VALUE 'SI'. 04230092
035400                 88  ASC-ADJ-TYPE-AD                  VALUE 'AD'. 04240092
035500             15  ASC-ADJ-TYPE-CDE2         PIC  X(02).            04250092
035600                 88  ASC-ADJ-TYPE-MM                  VALUE 'MM'. 04260092
035700                 88  ASC-ADJ-TYPE-AD2                 VALUE 'AD'. 04270092
035800             15  ASC-ADJ-TYPE-CDE3         PIC  X(02).            04280092
035900                 88  ASC-ADJ-TYPE-SA                  VALUE 'SA'. 04290092
036000                 88  ASC-ADJ-TYPE-AD3                 VALUE 'AD'. 04300092
036100             15  ASC-ADD-NUM               PIC S9(04)    COMP.    04310092
036200                                                                  04320092
036300             15  ASC-KEY-DATA.                                    04330092
W25248                 20  ASC-SKU               PIC  X(08).            04340092
W25248                 20  ASC-SKU-NUM REDEFINES                        04350092
W25248                     ASC-SKU               PIC  Z(08).            04360092
W25248                 20  ASC-UPC               PIC  X(15).            04370092
W25248                 20  ASC-UPC-NUM REDEFINES                        04380092
W25248                     ASC-UPC               PIC  Z(15).            04390092
W25248                 20  ASC-QTY               PIC S9(06)    COMP-3.  04400092
036900                 20  ASC-PRICE             PIC S9(05)V99 COMP-3.  04410092
037000                 20  ASC-TABLE-FROM        PIC  X(01).            04420092
037100                     88  ASC-FROM-TSUMINV              VALUE 'S'. 04430092
037200                     88  ASC-FROM-TADJADD              VALUE 'A'. 04440092
W25248                     88  ASC-FROM-TADJDTL              VALUE 'D'. 04450092
037300             15  ASC-DKEY-NBR              PIC S9(08)    COMP.    04460092
037400                                                                  04470092
037500             15  ASC-USE-SELECTION-SW      PIC  X(01).            04480092
037600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'S'. 04490092
037700                 88  ASC-NO-SELECTION-QUEUE            VALUE 'N'. 04500092
037800             15  ASC-READ-TABLES-SW        PIC  X(01).            04510092
037900                 88  ASC-MUST-READ-TABLES              VALUE 'Y'. 04520092
038000                 88  ASC-DONT-READ-TABLES              VALUE 'N'. 04530092
038100             15  ASC-DATA-EXISTS-SW        PIC  X(01).            04540092
038200                 88  ASC-ADD-NEW                       VALUE 'N'. 04550092
038300                 88  ASC-ADD-EXIST                     VALUE 'E'. 04560092
038400             15  ASC-ALLOW-ADJUSTMENTS-SW  PIC  X(01).            04570092
038500                 88  ASC-ADJUSTMENTS-ALLOWED           VALUE 'Y'. 04580092
038600                 88  ASC-NO-ADJUSTMENTS-ALLOWED        VALUE 'N'. 04590092
038700                                                                  04600092
038800             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            04610092
038900             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    04620092
039000             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04630092
039100                                           PIC S9(09)  COMP-3.    04640092
039200             15  ASC-SEL-SUB               PIC S9(04)  COMP.      04650092
039300             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      04660092
039400                                                                  04670092
039500         12  ASC-INIT-ALL-ASC.                                    04680092
039600             15  ASC-INIT-AREA.                                   04690092
039700               17  ASC-MAP-TABLE OCCURS 6 TIMES.                  04700092
039800                 20  ASC-MAP-USERID        PIC  X(08).            04710092
039900                 20  ASC-MAP-ADJ-DATE      PIC  X(08).            04720092
040000                 20  ASC-MAP-ADJ-QTY       PIC S9(07)    COMP-3.  04730092
040100                 20  ASC-MAP-ADJ-PRICE     PIC S9(05)V99 COMP-3.  04740092
040200                 20  ASC-MAP-ADJ-EXT-PRICE PIC S9(11)V99 COMP-3.  04750092
SR3403                 20  ASC-MAP-REASON        PIC  X(19).            04761099
040400               17  ASC-MAP-SUB             PIC S9(04)    COMP.    04770092
040500                                                                  04780092
040600               17  ASC-ORIG-QTY            PIC S9(07)    COMP-3.  04790092
040700               17  ASC-ORIG-PRICE          PIC S9(05)V99 COMP-3.  04800092
040800               17  ASC-ORIG-EXT-PRICE      PIC S9(09)V99 COMP-3.  04810092
040900               17  ASC-ORIG-REASON         PIC  X(20).            04820092
041000               17  ASC-STATUS-CODE         PIC S9(03)    COMP-3.  04830092
041100                   88  ASC-CLEARANCE                   VALUE 30.  04840092
041200                                                                  04850092
041500               17  ASC-NEW-QTY-X           PIC X(6).              04860092
041600               17  ASC-NEW-QTY             PIC S9(06).            04870092
041700               17  ASC-NEW-PRICE-X.                               04880092
041800                 20  ASC-NEW-PRICE         PIC S9(06)V99.         04890092
041900               17  ASC-NEW-EXT-PRICE       PIC S9(11)V99 COMP-3.  04900092
042000               17  ASC-NEW-REASON          PIC  X(20).            04910092
042100                                                                  04920092
042200*******        17  ASC-ADJ-QTY             PIC S9(07)    COMP-3.  04930092
042200               17  ASC-ADJ-QTY             PIC S9(06)    COMP-3.  04940092
042300               17  ASC-ADJ-PRICE           PIC S9(05)V99 COMP-3.  04950092
042400               17  ASC-ACT-ADJ-QTY         PIC S9(07)    COMP-3.  04960092
042500               17  ASC-ACT-ADJ-PRICE       PIC S9(07)V99 COMP-3.  04970092
042600               17  ASC-TOT-QTY             PIC S9(7)     COMP-3.  04980092
042700               17  ASC-TOT-PRICE           PIC S9(5)V99  COMP-3.  04990092
042800               17  ASC-TOT-EXT-PRICE       PIC S9(11)V99  COMP-3. 05000092
042900               17  ASC-PRICE-ERROR-SW      PIC  X(1).             05010092
043000                   88  ASC-PRICE-ERROR                  VALUE 'E'.05020092
043100                   88  ASC-NO-PRICE-ERROR               VALUE 'N'.05030092
043200               17  ASC-QTY-ERROR-SW        PIC  X(1).             05040092
043300                   88  ASC-QTY-ERROR                    VALUE 'E'.05050092
043400                   88  ASC-NO-QTY-ERROR                 VALUE 'N'.05060092
043500             15  ASC-INIT-AREA-END         PIC  X(1).             05070092
043600           12    ASC-INIT-ALL-ASC-END.                            05080092
043700                                                                  05090092
043800             15  ASC-HOLD-INTER-APPL       PIC  X(200).           05100092
043900         10  FILLER                        PIC  X(2003).          05110092
 44000     EJECT                                                        05120092
044100*----------------------------------------------------------------*05130092
044200*    ABEND PROCESSING COPYBOOK.                                  *05140092
044300*----------------------------------------------------------------*05150092
044400                                                                  05160092
044500     COPY DPWS013.                                                05170092
044600                                                                  05180092
044700/                                                                 05190092
044800*    DB2 AREA FOR TINVPAR (PI INVENTORY PARM)                     05200092
044900                                                                  05210092
045000     EXEC SQL                                                     05220092
045100          INCLUDE TINVPAR                                         05230092
045200     END-EXEC.                                                    05240092
045300                                                                  05250092
JKB   *    DB2 AREA FOR TINCNTL (PI INVENTORY CONTROL)                  05251099
JKB                                                                     05252099
JKB        EXEC SQL                                                     05253099
JKB             INCLUDE TINCNTL                                         05254099
JKB        END-EXEC.                                                    05255099
JKB                                                                     05256099
045400*    DB2 AREA FOR TSUMINV (PI SUMMARY INVENTORY)                  05260092
045500                                                                  05270092
045600     EXEC SQL                                                     05280092
045700          INCLUDE TSUMINV                                         05290092
045800     END-EXEC.                                                    05300092
045900                                                                  05310092
046000*    DB2 AREA FOR TADJADD (PI ADJUSTMENT ADD)                     05320092
046100                                                                  05330092
046200     EXEC SQL                                                     05340092
W26600          INCLUDE TADJADD                                         05350092
046400     END-EXEC.                                                    05360092
046500                                                                  05370092
046600*    DB2 AREA FOR TADJADD (PI ADJUSTMENT DETAIL)                  05380092
046700                                                                  05390092
046800     EXEC SQL                                                     05400092
W26600          INCLUDE TADJDTL                                         05410092
047000     END-EXEC.                                                    05420092
047100                                                                  05430092
W28545*    DB2 AREA AND WS AREA FOR COMMON PRICING LOOKUP               05440092
W28545                                                                  05450092
W28545     COPY INWS400.                                                05460092
W28545                                                                  05470092
049000                                                                  05480092
049100*    DB2 AREA FOR COMMUNICATIONS                                  05490092
049200                                                                  05500092
049300     EXEC SQL                                                     05510092
049400          INCLUDE SQLCA                                           05520092
049500     END-EXEC.                                                    05530092
049600                                                                  05540092
R26600*    ADJUSTMENT DETAIL CURSOR (ADJDTL DETAIL CURSOR)              05550092
049800                                                                  05560092
049900     EXEC SQL DECLARE ADJ-CSR CURSOR FOR                          05570092
050000          SELECT                                                  05580092
050100                   ADJ_UNIT_PR_AMT                                05590092
050200               ,   ADJ_QTY                                        05600092
050300               ,   ADJ_EXTD_AMT                                   05610092
050400               ,   ADJ_RSN_TXT                                    05620092
050500               ,   CRE_TMST                                       05630092
050600               ,   CRE_ID_NBR                                     05640092
050700          FROM                                                    05650092
050800                 TADJDTL                                          05660092
050900          WHERE                                                   05670092
W26600                 LOC_NBR          =  :ADJDTL-LOC-NBR              05680092
051100            AND  AREA_NBR           =  :ASC-AREA-NBR              05690092
R26600            AND  SKU_NBR            =  :ADJDTL-SKU-NBR            05700092
R26600            AND  UPC_NBR            =  :ADJDTL-UPC-NBR            05710092
R26600            AND  DKEY_NBR           =  :ASC-DKEY-NBR              05720092
051300            AND (ADJ_TYPE_CDE       =  :ASC-ADJ-TYPE-CDE          05730092
051400             OR  ADJ_TYPE_CDE       =  :ASC-ADJ-TYPE-CDE2         05740092
051500             OR  ADJ_TYPE_CDE       =  :ASC-ADJ-TYPE-CDE3)        05750092
051600          ORDER BY                                                05760092
051700                 CRE_TMST                                         05770092
051800     END-EXEC.                                                    05780092
051900                                                                  05790092
R26600*    ADJUSTMENT DETAIL CURSOR (ADJDTL LIST CURSOR)                05800092
R26600                                                                  05810092
R26600     EXEC SQL DECLARE ADJ-CSR2 CURSOR FOR                         05820092
R26600          SELECT ADJ_UNIT_PR_AMT                                  05830092
R26600               , ADJ_QTY                                          05840092
R26600               , ADJ_EXTD_AMT                                     05850092
R26600               , ADJ_RSN_TXT                                      05860092
R26600               , CRE_TMST                                         05870092
R26600               , CRE_ID_NBR                                       05880092
R26600          FROM TADJDTL                                            05890092
R26600          WHERE LOC_NBR       = :ADJDTL-LOC-NBR                   05900092
R26600            AND AREA_NBR      = :ASC-AREA-NBR                     05910092
R26600            AND SKU_NBR       = :ADJDTL-SKU-NBR                   05920092
W27710            AND DKEY_NBR      = :ASC-DKEY-NBR                     05930092
R26600            AND (ADJ_TYPE_CDE = :ASC-ADJ-TYPE-CDE                 05940092
R26600             OR  ADJ_TYPE_CDE = :ASC-ADJ-TYPE-CDE2                05950092
R26600             OR  ADJ_TYPE_CDE = :ASC-ADJ-TYPE-CDE3)               05960092
R26600          ORDER BY CRE_TMST                                       05970092
R26600     END-EXEC.                                                    05980092
R26600                                                                  05990092
W25248* SUMINV-CSRENT DETAIL CURSOR                                     06000092
W25248                                                                  06010092
W25248     EXEC SQL DECLARE SUMINV-CSR  CURSOR FOR                      06020092
W25248          SELECT                                                  06030092
W25248                   UPC_NBR                                        06040092
W25248               ,   INV_UNIT_PR_AMT                                06050092
W25248               ,   INV_QTY                                        06060092
W25248               ,   EXTD_AMT                                       06070092
W25248               ,   DKEY_NBR                                       06080092
W25248          FROM                                                    06090092
W25248                 TSUMINV                                          06100092
W25248          WHERE                                                   06110092
W26600                 LOC_NBR          =  :SUMINV-LOC-NBR              06120092
W25248            AND  AREA_NBR           =  :ASC-AREA-NBR              06130092
W25248            AND  SKU_NBR            =  :PV-HOLD-SKU               06140092
W25248            AND  INV_UNIT_PR_AMT    =  :ASC-PRICE                 06150092
W25248          ORDER BY                                                06160092
W25248                 UPC_NBR DESC                                     06170092
W25248     END-EXEC.                                                    06180092
W25248                                                                  06190092
W25248     EXEC SQL DECLARE ADJADD-CSR  CURSOR FOR                      06200092
W25248          SELECT                                                  06210092
W25248                   UPC_NBR                                        06220092
W25248               ,   ADJ_UNIT_PR_AMT                                06230092
W25248               ,   ADJ_QTY                                        06240092
W25248               ,   ADJ_EXTD_AMT                                   06250092
W25248               ,   DKEY_NBR                                       06260092
W25248               ,   ADJ_RSN_TXT                                    06270092
W25248          FROM                                                    06280092
W25248                 TADJADD                                          06290092
W25248          WHERE                                                   06300092
W26600                 LOC_NBR          =  :ADJADD-LOC-NBR              06310092
W25248            AND  AREA_NBR           =  :ADJADD-AREA-NBR           06320092
W25248            AND  SKU_NBR            =  :PV-HOLD-SKU               06330092
W25248            AND  ADJ_UNIT_PR_AMT    =  :ADJADD-ADJ-UNIT-PR-AMT    06340092
W25248          ORDER BY                                                06350092
W25248                 UPC_NBR DESC                                     06360092
W25248     END-EXEC.                                                    06370092
051900                                                                  06380092
051900                                                                  06390092
052000 EJECT                                                            06400092
052100 LINKAGE SECTION.                                                 06410092
052200                                                                  06420092
052300 01  DFHCOMMAREA.                                                 06430092
052400     05  FILLER                         OCCURS  1 TO 4072 TIMES   06440092
052500                                        DEPENDING ON EIBCALEN.    06450092
052600         10  FILLER                     PIC X.                    06460092
052700                                                                  06470092
052800                                                                  06480092
052900 PROCEDURE DIVISION.                                              06490092
053000**-------------------------------------------------------------** 06500092
053100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 06510092
053200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 06520092
053300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 06530092
053400**                                                             ** 06540092
053500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 06550092
053600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 06560092
053700**-------------------------------------------------------------** 06570092
053800                                                                  06580092
053900 0000-MAIN-MODULE.                                                06590092
054000                                                                  06600092
054100     INITIALIZE DP030-CICS-API-FIELDS.                            06610092
054200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06620092
054300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06630092
054400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06640092
054500                                                                  06650092
054600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06660092
054700     MOVE LENGTH OF IN012AI        TO DP030-MAP-LENGTH (1).       06670092
054800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06680092
054900     PERFORM 0001-CALL-CICS-ARCH-API.                             06690092
055000                                                                  06700092
055100     PERFORM 1000-CONTROL-PROCESSING                              06710092
055200                                                                  06720092
055300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06730092
055400     PERFORM 0001-CALL-CICS-ARCH-API.                             06740092
055500                                                                  06750092
055600 0001-CALL-CICS-ARCH-API.                                         06760092
055700                                                                  06770092
055800*    CALL 'DPKCS030' USING DFHEIBLK                               06780099
1122RM     CALL DP930-CICS-ARCH-API                                     06781099
1122RM                     USING DFHEIBLK                               06782099
055900                           DFHCOMMAREA                            06790092
056000                           DP030-CICS-API-FIELDS                  06800092
056100                           DP020-STANDARD-COMMAREA                06810092
056200                           IN012AI.                               06820092
056300                                                                  06830092
056400     IF  DP030-RC-CALL-SUCCESSFUL                                 06840092
056500         CONTINUE                                                 06850092
056600     ELSE                                                         06860092
056700         SET DP013-NO-ROLLBACK                                    06870092
056800             DP013-XCTL-DISPLAY-RESTART                           06880092
056900             DP013-CICS-ABEND      TO TRUE                        06890092
057000         MOVE 'BEFORE 0000-MAIN-MODULE'                           06900092
057100                                   TO DP013-PARAGRAPH             06910092
057200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06920099
057300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06930099
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06931099
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06932099
057400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06940092
057500         PERFORM DP013-0000-PROCESS-ABEND                         06950092
057600     END-IF.                                                      06960092
057700/                                                                 06970092
057800*----------------------------------------------------------------*06980092
057900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *06990092
058000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *07000092
058100*----------------------------------------------------------------*07010092
058200                                                                  07020092
058300 1000-CONTROL-PROCESSING.                                         07030092
058400                                                                  07040092
058500                                                                  07050092
058600     EVALUATE TRUE                                                07060092
058700         WHEN DP020-NEXT-ACT-INITIAL                              07070092
058800              PERFORM 1100-FIND-OBJECT-KEYS                       07080092
058900              IF  PS-ERROR                                        07090092
059000                  CONTINUE                                        07100092
059100              ELSE                                                07110092
059200                  MOVE INTER-APPL-COMM-AREA                       07120092
059300                                   TO  ASC-HOLD-INTER-APPL        07130092
059400                  IF  ASC-USE-SELECTION-QUEUE                     07140092
059500                      SET ASC-DONT-READ-TABLES                    07150092
059600                                   TO  TRUE                       07160092
059700                      PERFORM 4000-BUILD-INITIAL-PANEL            07170092
059800                      IF  SQLCODE = +100                          07180092
059900                          MOVE PC-TSYMSG-00148                    07190092
060000                                   TO  DP020-MSG-NUMBER           07200092
060100                          SET DP020-MSG-INFORMATIONAL             07210092
060200                              DP020-NEXT-ACT-APPL-ERROR           07220092
060300                                   TO  TRUE                       07230092
060400                      END-IF                                      07240092
060500                  ELSE                                            07250092
W21732                      MOVE -1      TO ANSKUL                      07260092
060700                      SET ASC-MUST-READ-TABLES                    07270092
060800                          DP030-SET-CURSOR-APPL-1                 07280092
060900                                   TO  TRUE                       07290092
061000                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        07300092
061100                  END-IF                                          07310092
061200                                                                  07320092
061300                  PERFORM 3200-RESET-ATTRIBUTES                   07330092
061400              END-IF                                              07340092
061500                                                                  07350092
061600         WHEN DP020-NEXT-ACT-READ-MAP                             07360092
061700              PERFORM 2000-PROCESS-PANEL                          07370092
061800                                                                  07380092
061900         WHEN DP020-NEXT-ACT-RETURN                               07390092
062000              MOVE ASC-HOLD-INTER-APPL                            07400092
062100                                   TO  INTER-APPL-COMM-AREA       07410092
062200              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  07420092
062300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07430092
062400                                                                  07440092
062500         WHEN OTHER                                               07450092
062600              SET DP013-LOGIC-ABEND TO TRUE                       07460092
062700              SET DP013-NO-ROLLBACK TO TRUE                       07470092
062800              MOVE '1000-CONTROL-PROCESSING'                      07480092
062900                                   TO  DP013-PARAGRAPH            07490092
063000              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  07500092
063100                                   TO  DP013-MESSAGE-TEXT(1)      07510092
063200              MOVE DP020-NEXT-APPL-ACTIVITY                       07520092
063300                                   TO  DP013-MESSAGE-TEXT(2)      07530092
063400              PERFORM DP013-0000-PROCESS-ABEND                    07540092
063500     END-EVALUATE.                                                07550092
063600                                                                  07560092
063700*----------------------------------------------------------------*07570092
063800*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *07580092
063900*  INTER-APPLICATION FORMAT CODE.                                *07590092
064000*----------------------------------------------------------------*07600092
064100                                                                  07610092
064200 1100-FIND-OBJECT-KEYS.                                           07620092
064300                                                                  07630092
064400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            07640092
064500     MOVE DP020-INT-APPL-FORMAT-IND  TO  ASC-INT-APPL-FORMAT-IND  07650092
064700                                                                  07660092
064800     EVALUATE DP020-INT-APPL-FORMAT-IND                           07670092
064900         WHEN PC-INTER-APPL-CRIT-SPEC                             07680092
065000              IF (IN001-STORE-NBR NUMERIC                         07690092
065100              AND IN001-AREA-NBR NUMERIC)                         07700092
065200                  MOVE IN001-STORE-NBR                            07710092
065300                                   TO  ASC-STORE-NBR              07720092
065400                  MOVE IN001-AREA-NBR                             07730092
065500                                   TO  ASC-AREA-NBR               07740092
065600                  SET ASC-NO-SELECTION-QUEUE                      07750092
065700                      ASC-ADD-NEW                                 07760092
065800                                   TO  TRUE                       07770092
065900              ELSE                                                07780092
066000                  MOVE PC-TSYMSG-00148                            07790092
066100                                   TO  DP020-MSG-NUMBER           07800092
066200                  SET DP020-MSG-FATAL                             07810092
066300                      DP020-NEXT-ACT-APPL-ERROR                   07820092
066400                                   TO  TRUE                       07830092
066500              END-IF                                              07840092
066600                                                                  07850092
066700         WHEN PC-INTER-APPL-LIST                                  07860092
W25248         WHEN PC-INTER-APPL-DETAIL                                07870092
066800              SET ASC-USE-SELECTION-QUEUE                         07880092
066900                  ASC-ADD-EXIST    TO  TRUE                       07890092
067000              MOVE IN001-NUMBER-OF-SELECTED-ITEMS                 07900092
067100                                   TO ASC-NUMBER-OF-SELECTED-ITEMS07910092
067200              MOVE IN001-NUMBER-OF-TS-ITEMS                       07920092
067300                                   TO  ASC-NUMBER-OF-TS-ITEMS     07930092
067400              MOVE IN001-SEL-QUEUE-NAME                           07940092
067500                                   TO  ASC-SEL-QUEUE-NAME         07950092
067600              PERFORM 1120-PREPARE-LIST-ENTRY                     07960092
067700                                                                  07970092
067800         WHEN OTHER                                               07980092
067900              MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER           07990092
068000              SET DP020-MSG-FATAL                                 08000092
068100                  DP020-NEXT-ACT-APPL-ERROR                       08010092
068200                                   TO TRUE                        08020092
068300     END-EVALUATE.                                                08030092
068400                                                                  08040092
068500                                                                  08050092
068600*----------------------------------------------------------------*08060092
068700* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *08070092
068800* STORAGE QUEUE PASSED FROM THE LIST.                            *08080092
068900*----------------------------------------------------------------*08090092
069000                                                                  08100092
069100 1120-PREPARE-LIST-ENTRY.                                         08110092
069200                                                                  08120092
069300     MOVE IN012-MAX-ITEMS          TO ASC-SEL-SUB.                08130092
069400     MOVE ZERO                     TO ASC-SEL-ITEM.               08140092
069500     PERFORM 2110-GET-NEXT-LINE.                                  08150092
069600                                                                  08160092
069700*----------------------------------------------------------------*08170092
069800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08180092
069900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08190092
070000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08200092
070100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08210092
070200* FUNCTION KEYS CAN GET THIS FAR.                                *08220092
070300*----------------------------------------------------------------*08230092
070400                                                                  08240092
070500 2000-PROCESS-PANEL.                                              08250092
070600                                                                  08260092
070700     IF  IN001-STORE-NBR NOT NUMERIC                              08270092
070800         MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA         08280092
070900     END-IF.                                                      08290092
071000                                                                  08300092
071100     EVALUATE TRUE                                                08310092
071200                                                                  08320092
071300         WHEN DP020-SRC-AID = DP016-CLEAR                         08330092
071400              IF  ASC-MUST-READ-TABLES                            08340092
W21732                  MOVE -1          TO  ANSKUL                     08350092
071600                  SET DP030-SET-CURSOR-APPL-1                     08360092
071700                                   TO  TRUE                       08370092
071800              ELSE                                                08380092
071900                  PERFORM 3000-EDIT-DATA-IN-COMMAREA              08390092
070000              END-IF                                              08400092
072100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                08410092
072200                                                                  08420092
072300         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     08430092
072400              SET DP030-DONT-ERASE                                08440092
072500                  DP030-SEND-DATAONLY (PC-APPL-MAP)               08450092
072600                                   TO TRUE                        08460092
072700              MOVE ZERO            TO  ASC-NEW-QTY                08470092
072800                                       ASC-NEW-PRICE              08480092
072900                                       ADADJQTO                   08490092
073000                                       ADADJPRO                   08500092
073100                                       ADEXTPRO                   08510092
073200              MOVE SPACE           TO  ANREASNO                   08520092
073300                                       ASC-NEW-REASON             08530092
073400              IF  ASC-ADD-NEW                                     08540092
W21732                  MOVE -1          TO  ANSKUL                     08550092
073600                  SET DP030-SET-CURSOR-APPL-1                     08560092
073700                                   TO  TRUE                       08570092
W21732                  MOVE SPACES      TO  ANSKUO                     08580092
W25248                                       ASC-SKU                    08590092
W25248                  MOVE SPACES      TO  ANUPCO                     08600092
W25248                                       ASC-UPC                    08610092
074400                  INITIALIZE ASC-INIT-ALL-ASC                     08620092
074500                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            08630092
074600                  PERFORM 3200-RESET-ATTRIBUTES                   08640092
074700              ELSE                                                08650092
074800                  PERFORM 4000-BUILD-INITIAL-PANEL                08660092
074900                  PERFORM 3200-RESET-ATTRIBUTES                   08670092
075000              END-IF                                              08680092
075100                                                                  08690092
075200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08700092
075300              IF  ASC-USE-SELECTION-QUEUE                         08710092
075400                  PERFORM 2110-GET-NEXT-LINE                      08720092
075500                  PERFORM 4000-BUILD-INITIAL-PANEL                08730092
075600                  PERFORM 3200-RESET-ATTRIBUTES                   08740092
075700              ELSE                                                08750092
075800*                 --- BOTTOM OF LIST ---                          08760092
075900                  MOVE PC-TSYMSG-00070                            08770092
076000                                   TO DP020-MSG-NUMBER            08780092
076100                  SET DP020-MSG-INFORMATIONAL                     08790092
076200                                   TO TRUE                        08800092
076300              END-IF                                              08810092
076400                                                                  08820092
076500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08830092
076600              IF  ASC-USE-SELECTION-QUEUE                         08840092
076700                  PERFORM 2120-GET-PREV-LINE                      08850092
076800                  PERFORM 4000-BUILD-INITIAL-PANEL                08860092
076900                  PERFORM 3200-RESET-ATTRIBUTES                   08870092
077000              ELSE                                                08880092
077100*                 --- TOP OF LIST ---                             08890092
077200                  MOVE PC-TSYMSG-00069                            08900092
077300                                   TO DP020-MSG-NUMBER            08910092
077400                  SET DP020-MSG-INFORMATIONAL                     08920092
077500                                   TO TRUE                        08930092
077600              END-IF                                              08940092
077700                                                                  08950092
077800         WHEN OTHER                                               08960092
077900              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                08970092
078000              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  08980092
078100              IF  PS-NO-ERROR                                     08990092
078200                  SET DP030-CONTINUE-GO                           09000092
078300                                   TO TRUE                        09010092
078400                  PERFORM 2100-CHECK-FUNCTION-KEY                 09020092
078500              ELSE                                                09030092
078600                  SET DP030-OVERRIDE-GO                           09040092
078700                                   TO TRUE                        09050092
078800                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            09060092
078900              END-IF                                              09070092
079000     END-EVALUATE.                                                09080092
079100                                                                  09090092
079200*----------------------------------------------------------------*09100092
079300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *09110092
079400* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *09120092
079500* FROM THE CICS ARCHITECTURE API.                                *09130092
079600*----------------------------------------------------------------*09140092
079700                                                                  09150092
079800 2100-CHECK-FUNCTION-KEY.                                         09160092
079900                                                                  09170092
080000     EVALUATE TRUE                                                09180092
080100         WHEN DP020-SRC-AID = DP016-ENTER                         09190092
080200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09200092
080300                                                                  09210092
080400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09220092
080500*            --  UPDATES WILL NOT BE ALLOWED WHEN A STORE IS IN   09230092
080600*            --  THE UNIT BOOKING PROCESS                         09240092
080700             PERFORM 3099-CHECK-BOOKING-STATUS                    09250092
080800             IF PC-STR-BKNG-IN-PROGRESS = INVPAR-UNT-BKG-STAT-CDE 09260092
080900                 SET DP020-MSG-INFORMATIONAL                      09270092
081000                 DP020-NEXT-ACT-APPL-ERROR                        09280092
081100                                   TO  TRUE                       09290092
081200                 MOVE PC-TSYMSG-02150 TO  DP020-MSG-NUMBER        09300092
081300             ELSE                                                 09310092
081400                 IF  ASC-ADD-EXIST                                09320092
081500                    PERFORM 3015-PROCESS-SKU                      09330092
081600                 END-IF                                           09340092
081700                 PERFORM 5000-BEGIN-UPDATE-PROCESS                09350092
081800                 IF  PS-NO-ERROR                                  09360092
081900*                --- UPDATES SUCCESSFUL ---                       09370092
082000                     MOVE PC-TSYMSG-00059                         09380092
082100                                   TO DP020-MSG-NUMBER            09390092
082200                     SET DP020-MSG-INFORMATIONAL                  09400092
082300                                   TO TRUE                        09410092
082400                     INITIALIZE ASC-INIT-ALL-ASC                  09420092
W21732                     MOVE SPACE       TO  ANSKUO                  09430092
W25248                     MOVE SPACE       TO  ANUPCO                  09440092
082800                     IF  ASC-ADD-NEW                              09450092
W21732                         MOVE -1      TO  ANSKUL                  09460092
W21732                         MOVE SPACE   TO  ASC-SKU                 09470092
W25248                                          ASC-UPC                 09480092
083300                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     09490092
083400                     ELSE                                         09500092
083500                         PERFORM 4000-BUILD-INITIAL-PANEL         09510092
083600                         PERFORM 3200-RESET-ATTRIBUTES            09520092
083700                     END-IF                                       09530092
W25248                 ELSE                                             09540092
W25248                     SET PS-ERROR                                 09550092
W25248                         DP020-MSG-FATAL   TO  TRUE               09560092
W25248                     MOVE PC-TSYMSG-00117  TO  DP020-MSG-NUMBER   09570092
W25248                     MOVE DP015-UNP-ALP-BRT-OFF                   09580092
W25248                                           TO  ANSKUA             09590092
W25248                     MOVE DP015-RED        TO  ANSKUC             09600092
W25248                     MOVE DP015-REVERSE    TO  ANSKUH             09610092
W25248                     MOVE -1               TO  ANSKUL             09620092
W25248                 END-IF                                           09630092
083900             END-IF                                               09640092
084000                                                                  09650092
084100         WHEN OTHER                                               09660092
084200              SET DP013-NO-ROLLBACK                               09670092
084300                  DP013-XCTL-DISPLAY-RESTART                      09680092
084400                  DP013-CICS-ABEND  TO TRUE                       09690092
084500              MOVE '2100-CHECK-FUNCTION-KEY'                      09700092
084600                                   TO DP013-PARAGRAPH             09710092
084700              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     09720092
084800                                   TO DP013-MESSAGE-TEXT (1)      09730092
084900              PERFORM DP013-0000-PROCESS-ABEND                    09740092
085000     END-EVALUATE.                                                09750092
085100                                                                  09760092
085200*----------------------------------------------------------------*09770092
085300*    RETRIEVE THE NEXT KEY FOR PROCESSING.                       *09780092
085400*----------------------------------------------------------------*09790092
085500                                                                  09800092
085600 2110-GET-NEXT-LINE.                                              09810092
085700                                                                  09820092
085800     ADD +1                        TO  ASC-SEL-SUB.               09830092
085900     IF  ASC-SEL-SUB > IN012-MAX-ITEMS                            09840092
086000         ADD +1                    TO  ASC-SEL-ITEM               09850092
086100         MOVE +1                   TO  ASC-SEL-SUB                09860092
086200     END-IF.                                                      09870092
086300                                                                  09880092
086400     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                09890092
086500         PERFORM 9100-READ-SEL-QUEUE                              09900092
086600         IF  IN012-ITEM (ASC-SEL-SUB) > ZERO                      09910092
086700             INITIALIZE ASC-INIT-ALL-ASC                          09920092
086800             MOVE IN012-KEY-DATA (ASC-SEL-SUB)                    09930092
086900                                   TO  ASC-KEY-DATA               09940092
087000             SET IN012-INQ (ASC-SEL-SUB)                          09950092
087100                                   TO  TRUE                       09960092
087200             PERFORM 9200-REWRITE-SEL-QUEUE                       09970092
087300         ELSE                                                     09980092
087400             SUBTRACT +1 FROM ASC-SEL-SUB                         09990092
087500*            --- BOTTOM OF LIST ---                               10000092
087600             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           10010092
087700             SET DP020-MSG-INFORMATIONAL                          10020092
087800                                   TO  TRUE                       10030092
087900         END-IF                                                   10040092
088000     ELSE                                                         10050092
088100         SUBTRACT +1 FROM ASC-SEL-ITEM                            10060092
088200         MOVE IN012-MAX-ITEMS      TO  ASC-SEL-SUB                10070092
088300         MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER           10080092
088400         SET DP020-MSG-INFORMATIONAL                              10090092
088500                                   TO  TRUE                       10100092
088600     END-IF.                                                      10110092
088700                                                                  10120092
088800*----------------------------------------------------------------*10130092
088900*  GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED         *10140092
089000*  OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.           *10150092
089100*----------------------------------------------------------------*10160092
089200                                                                  10170092
089300 2120-GET-PREV-LINE.                                              10180092
089400                                                                  10190092
089500     SUBTRACT +1 FROM ASC-SEL-SUB.                                10200092
089600     IF  ASC-SEL-SUB < +1                                         10210092
089700         SUBTRACT +1 FROM ASC-SEL-ITEM                            10220092
089800         MOVE IN012-MAX-ITEMS      TO ASC-SEL-SUB                 10230092
089900     END-IF.                                                      10240092
090000                                                                  10250092
090100     IF  ASC-SEL-ITEM > ZERO                                      10260092
090200         INITIALIZE ASC-INIT-ALL-ASC                              10270092
090300         PERFORM 9100-READ-SEL-QUEUE                              10280092
090400         MOVE IN012-KEY-DATA (ASC-SEL-SUB)                        10290092
090500                                   TO ASC-KEY-DATA                10300092
090600     ELSE                                                         10310092
090700         MOVE +1                   TO ASC-SEL-ITEM                10320092
090800                                      ASC-SEL-SUB                 10330092
090900*        --- TOP OF LIST ---                                      10340092
091000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10350092
091100         SET DP020-MSG-INFORMATIONAL                              10360092
091200                                   TO TRUE                        10370092
091300     END-IF.                                                      10380092
091400/                                                                 10390092
091500*----------------------------------------------------------------*10400092
091600* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *10410092
091700* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *10420092
091800* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *10430092
091900*----------------------------------------------------------------*10440092
092000                                                                  10450092
092100 2200-MOVE-SCREEN-TO-COMMAREA.                                    10460092
092200                                                                  10470092
W21732     IF  ANSKUL > 0                                               10480092
W21732         SET PS-SKU-ENTERED        TO  TRUE                       10490092
W21732         MOVE ANSKUI               TO  ASC-SKU                    10500092
W25248         MOVE ASC-SKU              TO  PV-SKU                     10510092
095700     ELSE                                                         10520092
095800         IF  ANSKUF = DP015-ERASE-EOF                             10530092
095900             SET PS-SKU-ENTERED    TO  TRUE                       10540092
096000             MOVE SPACE            TO  ASC-SKU                    10550092
096100         END-IF                                                   10560092
096200     END-IF.                                                      10570092
W25248                                                                  10580092
W25248     IF  ANUPCL > 0                                               10590092
W25248         SET PS-UPC-ENTERED        TO  TRUE                       10600092
W25248         MOVE ANUPCI               TO  ASC-UPC                    10610092
W25248         MOVE ASC-UPC              TO  PV-UPC                     10620092
W25248     ELSE                                                         10630092
W25248         IF  ANUPCF = DP015-ERASE-EOF                             10640092
SCOTT***********   SET PS-UPC-ENTERED    TO  TRUE                       10650092
W25248             SET PS-UPC-NOT-ENTERED    TO  TRUE                   10660092
W25248             MOVE SPACE            TO  ASC-UPC                    10670092
W25248         END-IF                                                   10680092
W25248     END-IF.                                                      10690092
W25248                                                                  10700092
096400     IF (PS-SKU-ENTERED OR                                        10710092
W25248         PS-UPC-ENTERED)                                          10720092
096500         MOVE ZERO                 TO  ADADJQTO                   10730092
096600                                       ADADJPRO                   10740092
096700                                       ADEXTPRO                   10750092
096800     END-IF.                                                      10760092
096900                                                                  10770092
097000     IF  ANADJQTL > ZERO                                          10780092
097100         SET PS-QTY-ENTERED        TO  TRUE                       10790092
097200         MOVE ANADJQTI             TO  ASC-NEW-QTY-X              10800092
097300         IF  ASC-NEW-QTY-X EQUAL SPACES                           10810092
097400             MOVE ZERO             TO  ASC-NEW-QTY                10820092
097500         END-IF                                                   10830092
097600     ELSE                                                         10840092
097700         IF  ANADJQTF = DP015-ERASE-EOF                           10850092
097800*            MOVE ZERO             TO  ASC-NEW-QTY-X              10860092
097900             MOVE ZERO             TO  ASC-NEW-QTY                10870092
098000             MOVE SPACES           TO  ASC-NEW-QTY-X              10880092
098100         END-IF                                                   10890092
098200     END-IF.                                                      10900092
098300                                                                  10910092
098400     IF  ANADJPRL > ZERO                                          10920092
098500         MOVE ANADJPRI             TO  ASC-NEW-PRICE-X            10930092
098600         IF  ASC-NEW-PRICE-X NOT EQUAL SPACES                     10940092
098700             SET PS-PRICE-ENTERED  TO  TRUE                       10950092
098800         ELSE                                                     10960092
098900             MOVE ZERO             TO  ASC-NEW-PRICE              10970092
099000             SET ASC-NO-PRICE-ERROR TO TRUE                       10980092
099100         END-IF                                                   10990092
099200     ELSE                                                         11000092
099300         IF  ANADJPRF = DP015-ERASE-EOF                           11010092
099400             MOVE ZERO             TO  ASC-NEW-PRICE-X            11020092
099500             SET ASC-NO-PRICE-ERROR TO TRUE                       11030092
099600         END-IF                                                   11040092
099700     END-IF.                                                      11050092
099800                                                                  11060092
099900     IF  ANREASNL > ZERO                                          11070092
100000         SET PS-REASON-ENTERED     TO  TRUE                       11080092
100100         MOVE ANREASNI             TO  ASC-NEW-REASON             11090092
100200     ELSE                                                         11100092
100300         IF  ANREASNF = DP015-ERASE-EOF                           11110092
100400             MOVE SPACE            TO  ASC-NEW-REASON             11120092
100500         END-IF                                                   11130092
100600     END-IF.                                                      11140092
100700/                                                                 11150092
100800*----------------------------------------------------------------*11160092
100900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *11170092
101000* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *11180092
101100* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *11190092
101200*----------------------------------------------------------------*11200092
101300                                                                  11210092
101400 3000-EDIT-DATA-IN-COMMAREA.                                      11220092
101500                                                                  11230092
101600     PERFORM 3200-RESET-ATTRIBUTES.                               11240092
101700                                                                  11250092
101800     IF (PS-PRICE-ENTERED                                         11260092
101900     OR  ASC-PRICE-ERROR)                                         11270092
102000         PERFORM 3001-VALIDATE-PRICE                              11280092
102100     END-IF.                                                      11290092
102200                                                                  11300092
102300     IF (PS-QTY-ENTERED                                           11310092
102400     OR  ASC-QTY-ERROR)                                           11320092
102500         PERFORM 3002-VALIDATE-QTY                                11330092
102600     END-IF.                                                      11340092
102700     IF  NOT ASC-QTY-ERROR                                        11350092
102800         IF (ASC-NEW-QTY GREATER PC-MAX-QUANTITY                  11360092
102900         OR  ASC-NEW-QTY LESS    PC-MIN-QUANTITY)                 11370092
103000             SET PS-ERROR                                         11380092
103100                 DP020-MSG-FATAL   TO  TRUE                       11390092
103200             MOVE PC-TSYMSG-00687  TO  DP020-MSG-NUMBER           11400092
103300             MOVE DP015-UNP-ALP-BRT-OFF                           11410092
103400                                   TO  ANADJQTA                   11420092
103500             MOVE DP015-RED        TO  ANADJQTC                   11430092
103600             MOVE DP015-REVERSE    TO  ANADJQTH                   11440092
103700             MOVE -1               TO  ANADJQTL                   11450092
103800         END-IF                                                   11460092
103900     END-IF.                                                      11470092
104000                                                                  11480092
104100     IF  PS-NO-ERROR                                              11490092
104200         IF  ASC-ADD-EXIST                                        11500092
104300             PERFORM 3003-CALC-ACTUAL                             11510092
104400             PERFORM 3004-CHECK-EXTENDED-MAX                      11520092
104500         ELSE                                                     11530092
104600             COMPUTE PV-TOT-EXT-PRICE                             11540092
104700                                    =  ASC-NEW-PRICE              11550092
104800                                    *  ASC-NEW-QTY                11560092
104900         END-IF                                                   11570092
105000                                                                  11580092
105100         IF  ASC-ADD-NEW                                          11590092
105200             MOVE ASC-NEW-PRICE      TO  ASC-PRICE                11600092
105300             IF (ASC-PRICE EQUAL ZERO                             11610092
105400             OR  ASC-NEW-QTY EQUAL ZERO)                          11620092
105500                 PERFORM 3045-SET-QTY-PRICE-ERROR                 11630092
105600             ELSE                                                 11640092
105700                 PERFORM 3004-CHECK-EXTENDED-MAX                  11650092
105800             END-IF                                               11660092
105900                                                                  11670092
W25248             IF PS-UPC-ENTERED                                    11680092
W25248                 PERFORM 3070-VALIDATE-UPC                        11690092
W25248                 IF  PS-GOOD-UPC                                  11700092
W25248                     PERFORM 3075-PROCESS-UPC                     11710092
W28545                     IF  IN400-PV-NOT-FOUND                       11720092
W25248                         PERFORM 3090-SET-UPC-ERROR               11730092
W25248                     ELSE                                         11740092
W28545                         MOVE PV-SKU     TO ASC-SKU               11750092
W25248                         IF  NOT PS-QTY-PRICE-ERROR               11760092
X25248                             PERFORM 3085-FROM-WHERE              11770092
W25248                             SET PS-SKU-NOT-ENTERED  TO TRUE      11780092
W25248                         END-IF                                   11790092
W25248                     END-IF                                       11800092
W25248                 ELSE                                             11810092
W25248                     PERFORM 3090-SET-UPC-ERROR                   11820092
W25248                 END-IF                                           11830092
W25248             ELSE                                                 11840092
106000                 PERFORM 3010-VALIDATE-SKU                        11850092
106100                 IF  PS-GOOD-SKU                                  11860092
106200                     PERFORM 3015-PROCESS-SKU                     11870092
W28545                     IF IN400-PV-NOT-FOUND                        11880092
106500                         PERFORM 3040-SET-SKU-ERROR               11890092
106600                     ELSE                                         11900092
106700                         IF  NOT PS-QTY-PRICE-ERROR               11910092
106800                             PERFORM 3020-CONTINUE-SKU-CHECK      11920092
106900                         END-IF                                   11930092
107000                     END-IF                                       11940092
107100                 ELSE                                             11950092
107200                     PERFORM 3040-SET-SKU-ERROR                   11960092
107300                 END-IF                                           11970092
107300             END-IF                                               11980092
107500         END-IF                                                   11990092
107600     END-IF.                                                      12000092
107700                                                                  12010092
107800     IF (ASC-ADJUSTMENTS-ALLOWED                                  12020092
107900     OR  ASC-ADD-NEW)                                             12030092
108000     AND ASC-NEW-REASON NOT GREATER THAN SPACES                   12040092
108100         MOVE DP015-RED            TO  ANREASNC                   12050092
108200         MOVE DP015-REVERSE        TO  ANREASNH                   12060092
108300         IF  PS-NO-ERROR                                          12070092
108400             MOVE -1               TO  ANREASNL                   12080092
108500             MOVE PC-TSYMSG-00007  TO  DP020-MSG-NUMBER           12090092
108600             SET PS-ERROR                                         12100092
108700                 DP020-MSG-FATAL   TO  TRUE                       12110092
108800         END-IF                                                   12120092
108900     END-IF.                                                      12130092
109000                                                                  12140092
109100     IF  PS-NO-ERROR                                              12150092
109200         MOVE -1                   TO  ANADJQTL                   12160092
109300     END-IF.                                                      12170092
109400     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      12180092
109500/                                                                 12190092
109600*----------------------------------------------------------------*12200092
109700*    ENSURE THE PRICE IS VALID.                                  *12210092
109800*----------------------------------------------------------------*12220092
109900                                                                  12230092
110000 3001-VALIDATE-PRICE.                                             12240092
110100                                                                  12250092
110200     SET  ASC-NO-PRICE-ERROR       TO  TRUE.                      12260092
110300     MOVE ASC-NEW-PRICE-X          TO  DP010I-UNEDITED-FIELD.     12270092
110400     MOVE PC-9                     TO  DP010I-MAXIMUM-DIGITS.     12280092
110500     MOVE PC-2                     TO  DP010I-MAXIMUM-DECIMALS.   12290092
110600     SET DP010I-NEGATIVE-NOT-ALLOWED                              12300092
110700                                   TO  TRUE.                      12310092
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12321099
263126          USING DP010I-NUMERIC-EDIT-AREA.                         12322099
110900                                                                  12330092
111000     IF  DP010I-ERROR-DETECTED                                    12340092
111100         SET PS-ERROR                                             12350092
111200             ASC-PRICE-ERROR                                      12360092
111300             DP020-MSG-FATAL       TO  TRUE                       12370092
111400         MOVE PC-TSYMSG-00008      TO  DP020-MSG-NUMBER           12380092
111500         MOVE DP015-UNP-ALP-BRT-OFF                               12390092
111600                                   TO  ANADJPRA                   12400092
111700         MOVE DP015-RED            TO  ANADJPRC                   12410092
111800         MOVE DP015-REVERSE        TO  ANADJPRH                   12420092
111900         MOVE -1                   TO  ANADJPRL                   12430092
112000     ELSE                                                         12440092
112100                                                                  12450092
112200         IF  DP010I-NUMERIC-FIELD LESS THAN PC-20-CENTS           12460092
112300             SET PS-ERROR                                         12470092
112400                 ASC-PRICE-ERROR                                  12480092
112500                 DP020-MSG-FATAL   TO  TRUE                       12490092
112600             MOVE PC-TSYMSG-00688  TO  DP020-MSG-NUMBER           12500092
112700             MOVE DP015-UNP-ALP-BRT-OFF                           12510092
112800                                   TO  ANADJPRA                   12520092
112900             MOVE DP015-RED        TO  ANADJPRC                   12530092
113000             MOVE DP015-REVERSE    TO  ANADJPRH                   12540092
113100             MOVE -1               TO  ANADJPRL                   12550092
113200         ELSE                                                     12560092
113300             IF  DP010I-NUMERIC-FIELD > PC-MAX-PRICE              12570092
113400                 SET PS-ERROR                                     12580092
113500                     ASC-PRICE-ERROR                              12590092
113600                     DP020-MSG-FATAL TO TRUE                      12600092
113700                 MOVE PC-TSYMSG-00686                             12610092
113800                                   TO  DP020-MSG-NUMBER           12620092
113900                 MOVE DP015-UNP-ALP-BRT-OFF                       12630092
114000                                   TO  ANADJPRA                   12640092
114100                 MOVE DP015-RED    TO  ANADJPRC                   12650092
114200                 MOVE DP015-REVERSE TO ANADJPRH                   12660092
114300                 MOVE -1           TO  ANADJPRL                   12670092
114400             ELSE                                                 12680092
114500                 MOVE DP010I-NUMERIC-FIELD                        12690092
114600                                   TO  ASC-NEW-PRICE              12700092
114700             END-IF                                               12710092
114800         END-IF                                                   12720092
114900                                                                  12730092
115000     END-IF.                                                      12740092
115100/                                                                 12750092
115200*----------------------------------------------------------------*12760092
115300*    NOW, ENSURE THE QUANTITY IS NUMERIC.                        *12770092
115400*----------------------------------------------------------------*12780092
115500                                                                  12790092
115600 3002-VALIDATE-QTY.                                               12800092
115700                                                                  12810092
115800     SET  ASC-NO-QTY-ERROR         TO  TRUE.                      12820092
115900     MOVE ASC-NEW-QTY-X            TO  DP010I-UNEDITED-FIELD.     12830092
116000     MOVE PC-7                     TO  DP010I-MAXIMUM-DIGITS.     12840092
116100     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   12850092
116200     SET DP010I-NEGATIVE-ALLOWED   TO  TRUE.                      12860092
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12871099
263126          USING DP010I-NUMERIC-EDIT-AREA.                         12872099
116400                                                                  12880092
116500     IF  DP010I-ERROR-DETECTED                                    12890092
116600         SET PS-ERROR                                             12900092
116700             ASC-QTY-ERROR                                        12910092
116800             DP020-MSG-FATAL       TO  TRUE                       12920092
116900         MOVE PC-TSYMSG-00008      TO  DP020-MSG-NUMBER           12930092
117000         MOVE DP015-UNP-ALP-BRT-OFF                               12940092
117100                                   TO  ANADJQTA                   12950092
117200         MOVE DP015-RED            TO  ANADJQTC                   12960092
117300         MOVE DP015-REVERSE        TO  ANADJQTH                   12970092
117400         MOVE -1                   TO  ANADJQTL                   12980092
117500     ELSE                                                         12990092
117600         MOVE DP010I-NUMERIC-FIELD                                13000092
117700                                   TO  ASC-NEW-QTY                13010092
117800     END-IF.                                                      13020092
117900/                                                                 13030092
118000*----------------------------------------------------------------*13040092
118100*    COMPUTE THE ACTUAL ADJUSTMENT FIELDS.                       *13050092
118200*----------------------------------------------------------------*13060092
118300                                                                  13070092
118400 3003-CALC-ACTUAL.                                                13080092
118500                                                                  13090092
118600     IF  ASC-NEW-PRICE EQUAL ZERO                                 13100092
118700         MOVE ZERO                 TO  ASC-ACT-ADJ-PRICE          13110092
118800                                       PV-ADJ-EXT1                13120092
118900     ELSE                                                         13130092
119000         COMPUTE ASC-ACT-ADJ-PRICE  =  ASC-NEW-PRICE              13140092
119100                                    -  ASC-TOT-PRICE              13150092
119200         COMPUTE PV-ADJ-EXT1        =  ASC-ACT-ADJ-PRICE          13160092
119300                                    *  ASC-TOT-QTY                13170092
119400     END-IF.                                                      13180092
119500                                                                  13190092
119600     IF  ASC-NEW-QTY EQUAL ZERO AND                               13200092
119700         ASC-NEW-QTY-X = SPACES                                   13210092
119800         MOVE ZERO                 TO  ASC-ACT-ADJ-QTY            13220092
119900                                       PV-ADJ-EXT2                13230092
120000     ELSE                                                         13240092
120100         COMPUTE ASC-ACT-ADJ-QTY    =  ASC-NEW-QTY                13250092
120200                                    -  ASC-TOT-QTY                13260092
120300         IF  PV-ADJ-EXT1 EQUAL ZERO                               13270092
120400             COMPUTE PV-ADJ-EXT2    =  ASC-ACT-ADJ-QTY            13280092
120500                                    *  ASC-TOT-PRICE              13290092
120600         ELSE                                                     13300092
120700             COMPUTE PV-ADJ-EXT2    =  ASC-ACT-ADJ-QTY            13310092
120800                                    *  ASC-NEW-PRICE              13320092
120900         END-IF                                                   13330092
121000     END-IF.                                                      13340092
121100                                                                  13350092
121200     MOVE ASC-ACT-ADJ-QTY          TO  ADADJQTO.                  13360092
121300     MOVE ASC-ACT-ADJ-PRICE        TO  ADADJPRO.                  13370092
121400     COMPUTE PV-TOT-EXT-PRICE       =  PV-ADJ-EXT1                13380092
121500                                    +  PV-ADJ-EXT2.               13390092
121600/                                                                 13400092
121700*----------------------------------------------------------------*13410092
121800*    SEE IF WE EXCEEDED THE MAXIMUM ADJUSTMENT ALLOWED.          *13420092
121900*----------------------------------------------------------------*13430092
122000                                                                  13440092
122100 3004-CHECK-EXTENDED-MAX.                                         13450092
122200                                                                  13460092
122300     IF  ASC-NO-ADJUSTMENTS-ALLOWED                               13470092
122400         CONTINUE                                                 13480092
122500     ELSE                                                         13490092
122600         IF (PV-TOT-EXT-PRICE GREATER PC-MAX-EXTENDED-PRICE       13500092
122700         OR  PV-TOT-EXT-PRICE LESS    PC-MIN-EXTENDED-PRICE)      13510092
122800             MOVE PC-TSYMSG-00686  TO  DP020-MSG-NUMBER           13520092
122900             SET DP020-MSG-FATAL   TO  TRUE                       13530092
123000             SET PS-ERROR          TO  TRUE                       13540092
123100             IF (PS-QTY-ENTERED                                   13550092
123200             OR  ASC-NEW-QTY GREATER THAN ZERO)                   13560092
123300                 MOVE DP015-UNP-ALP-BRT-OFF                       13570092
123400                                   TO  ANADJQTA                   13580092
123500                 MOVE DP015-RED    TO  ANADJQTC                   13590092
123600                 MOVE DP015-REVERSE TO ANADJQTH                   13600092
123700                 MOVE -1           TO  ANADJQTL                   13610092
123800             ELSE                                                 13620092
123900                 MOVE DP015-UNP-ALP-BRT-OFF                       13630092
124000                                   TO  ANADJPRA                   13640092
124100                 MOVE DP015-RED    TO  ANADJPRC                   13650092
124200                 MOVE DP015-REVERSE TO ANADJPRH                   13660092
124300                 MOVE -1           TO  ANADJPRL                   13670092
124400             END-IF                                               13680092
124500         ELSE                                                     13690092
124600             IF  PV-TOT-EXT-PRICE EQUAL ZERO                      13700092
124700                 MOVE PC-TSYMSG-00010                             13710092
124800                                   TO  DP020-MSG-NUMBER           13720092
124900                 SET DP020-MSG-FATAL                              13730092
125000                     PS-ERROR      TO  TRUE                       13740092
125100                 IF (PS-QTY-ENTERED                               13750092
125200                 OR  ASC-NEW-QTY GREATER THAN ZERO)               13760092
125300                     MOVE DP015-UNP-ALP-BRT-OFF                   13770092
125400                                   TO  ANADJQTA                   13780092
125500                     MOVE DP015-RED TO ANADJQTC                   13790092
125600                     MOVE DP015-REVERSE TO ANADJQTH               13800092
125700                     MOVE -1       TO  ANADJQTL                   13810092
125800                 ELSE                                             13820092
125900                     MOVE DP015-UNP-ALP-BRT-OFF                   13830092
126000                                   TO  ANADJPRA                   13840092
126100                     MOVE DP015-RED TO ANADJPRC                   13850092
126200                     MOVE DP015-REVERSE TO ANADJPRH               13860092
126300                     MOVE -1       TO  ANADJPRL                   13870092
126400                 END-IF                                           13880092
126500             END-IF                                               13890092
126600         END-IF                                                   13900092
126700     END-IF.                                                      13910092
126800     MOVE PV-TOT-EXT-PRICE         TO  ADEXTPRO.                  13920092
126900/                                                                 13930092
127000*----------------------------------------------------------------*13940092
127100*    FIRST, SEE IF THE OPERATOR ENTERED A VALID SKU.             *13950092
127200*    IF VALID, CHECK FOR STATUS 98.                              *13960092
127300*    IF A ROW DOES NOT EXIST ON EITHER TSUMINV OR TADJADD,       *13970092
127400*    CHECK IF A ROW EXISTS FOR THE RENUMBERED SKU.               *13980092
127500*    IF NOT, USE THE RENUMBERED SKU FOR PROCESSING.              *13990092
127600*----------------------------------------------------------------*14000092
127700                                                                  14010092
127800 3010-VALIDATE-SKU.                                               14020092
127900                                                                  14030092
128000     SET PS-GOOD-SKU               TO  TRUE.                      14040092
128100                                                                  14050092
W25248     MOVE ASC-SKU                  TO  DP010I-UNEDITED-FIELD.     14060092
W21732     MOVE PC-8                     TO  DP010I-MAXIMUM-DIGITS.     14070092
131200     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   14080092
131300     SET DP010I-NEGATIVE-NOT-ALLOWED                              14090092
131400                                   TO  TRUE.                      14100092
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             14111099
263126          USING DP010I-NUMERIC-EDIT-AREA.                         14112099
131600                                                                  14120092
131700     IF  DP010I-ERROR-DETECTED                                    14130092
131800         PERFORM 3040-SET-SKU-ERROR                               14140092
131900     ELSE                                                         14150092
W21732         MOVE DP010I-NUMERIC-FIELD TO  PV-EIGHT                   14160092
W25248         MOVE PV-EIGHT-X           TO  ASC-SKU                    14170092
132200     END-IF.                                                      14180092
132300                                                                  14190092
132400*----------------------------------------------------------------*14200092
132500*    NOW CHECK IF THE SKU EXISTS.                                *14210092
W25248*    CHECK IF THE ENTRY WAS SKU NUMBER IS 99999999 (PC-MAX-SKU)  *14220092
132600*----------------------------------------------------------------*14230092
132700                                                                  14240092
132800 3015-PROCESS-SKU.                                                14250092
W28545                                                                  14260092
W28545     INITIALIZE IN400-PV-INPUT-AREA.                              14270092
W28545                                                                  14320092
F28545     MOVE IN001-DB2-ACTL-INV-DTE  TO IN400-PV-EFF-DTE-IN.         14330099
W28545     MOVE 'SKU'                   TO IN400-PV-LOOKUP-TYPE-IN.     14340092
W28545     MOVE ASC-SKU                 TO PV-SKU.                      14350092
W28545     MOVE PV-SKU                  TO IN400-PV-SKU-IN-NUM.         14360092
W26600     MOVE ASC-STORE-NBR           TO PV-STORE-NBR-X.              14370092
W28545     MOVE PV-STORE-NBR-9          TO IN400-PV-LOC-IN-NUM.         14380092
W28545                                                                  14390092
W28545     PERFORM IN400-LOOKUP-RETAIL.                                 14450092
W28545                                                                  14460092
W28545     IF IN400-PV-FOUND                                            14470092
W28545         MOVE IN400-PRC-STATUS-OUT TO PV-STAT-CDE                 14480092
W28545         MOVE IN400-PRC-SKU-OUT    TO PV-HOLD-SKU                 14481095
W28545     ELSE                                                         14540092
W28545         IF IN400-PV-NOT-FOUND                                    14550092
W28545             MOVE ZEROS           TO PV-STAT-CDE                  14560092
W28545     ELSE                                                         14570092
W28545             MOVE '3015-PROCESS-SKU'                              14580092
W28545                                   TO DP013-PARAGRAPH             14590092
W28545             MOVE 'CALL INPD400 '                                 14600092
W28545                                   TO DP013-MESSAGE-TEXT (1)      14610092
W28545             MOVE IN400-PV-RETURN-RSN                             14620092
W28545                                   TO DP013-MESSAGE-TEXT (2)      14630092
W28545             MOVE IN400-PV-PARAGRAPH                              14640092
W28545                                   TO DP013-MESSAGE-TEXT (3)      14650092
W28545             MOVE IN400-PV-PRC-SQLCDE                             14660092
W28545                                   TO DP013-SQLCA                 14670092
W28545             MOVE '???????'        TO DP013-DB2-TABLE-NAME (1)    14680092
W28545             SET DP013-DB2-ABEND                                  14690092
W28545                     DP013-XCTL-DISPLAY-RESTART                   14700092
W28545                                   TO TRUE                        14710092
W28545             PERFORM DP013-0000-PROCESS-ABEND                     14720092
W28545                                                                  14730092
W28545     END-IF.                                                      14740092
132900                                                                  14750092
W28545     MOVE PV-STAT-CDE              TO  ASC-STATUS-CODE.           14760092
133700                                                                  14770092
      *----------------------------------------------------------------*14780092
W28545*    SEE IF THE SKU IS RENUMBERED. PUT OUT INFO MESSAGE          *14790092
134000*----------------------------------------------------------------*14800092
134100                                                                  14810092
134200 3020-CONTINUE-SKU-CHECK.                                         14820092
134300                                                                  14830092
W28545     IF  IN400-PV-FOUND  AND                                      14840092
W28545         IN400-PS-RENUMBER-SKU AND                                14850096
W28545         IN400-PRC-SKU-OUT NOT = ZEROS                            14860092
134800             SET DP020-MSG-INFORMATIONAL                          14870092
134900                                    TO  TRUE                      14880092
W28545             MOVE PC-TSYMSG-00453   TO  DP020-MSG-NUMBER          14890092
W28545             MOVE IN400-PRC-SKU-OUT TO  PV-SKU                    14900092
W28545             MOVE PV-SKU            TO  ASC-SKU                   14910092
W28545             MOVE IN400-PRC-SKU-OUT TO  DP020-MSG-TEXT            14920092
136500     END-IF.                                                      14930092
136600                                                                  14940092
136700     IF  PS-ERROR                                                 14950092
136800         CONTINUE                                                 14960092
136900     ELSE                                                         14970092
137000         PERFORM 3025-FROM-WHERE                                  14980092
137100     END-IF.                                                      14990092
137200                                                                  15000092
137300*----------------------------------------------------------------*15010092
137400*    SEE IF A ROW EXISTS ON EITHER TSUMINV OR TADJADD.           *15020092
137500*----------------------------------------------------------------*15030092
137600                                                                  15040092
137700 3025-FROM-WHERE.                                                 15050092
137800                                                                  15060092
137900*    MOVE ASC-NEW-PRICE            TO  ASC-PRICE.                 15070092
138000*    MOVE ZERO                     TO  ASC-NEW-PRICE.             15080092
138100     PERFORM 4100-GET-FROM-TSUMINV.                               15090092
138200                                                                  15100092
138300     IF  SQLCODE EQUAL +100                                       15110092
138400         PERFORM 4200-GET-FROM-TADJADD                            15120092
138500         IF  SQLCODE EQUAL ZERO                                   15130092
138600             SET PS-ERROR                                         15140092
138700                 PS-ROW-FOUND      TO  TRUE                       15150092
138800         END-IF                                                   15160092
138900     ELSE                                                         15170092
139000         SET PS-ERROR                                             15180092
139100             PS-ROW-FOUND          TO  TRUE                       15190092
139200     END-IF.                                                      15200092
139300                                                                  15210092
139400     IF  PS-ROW-FOUND                                             15220092
139500         PERFORM 3040-SET-SKU-ERROR                               15230092
139600         MOVE PC-TSYMSG-00117      TO  DP020-MSG-NUMBER           15240092
139700     END-IF.                                                      15250092
139800                                                                  15260092
155100/                                                                 15290092
155200*----------------------------------------------------------------*15300092
155300*    COMMON ROUTINE TO SET SKU ERROR FLAGS.                      *15310092
155400*----------------------------------------------------------------*15320092
155500/                                                                 15330092
155600 3040-SET-SKU-ERROR.                                              15340092
155700                                                                  15350092
155800     SET PS-ERROR                                                 15360092
155900         PS-BAD-SKU                                               15370092
156000         DP020-MSG-FATAL           TO  TRUE.                      15380092
156100     MOVE PC-TSYMSG-00073          TO  DP020-MSG-NUMBER.          15390092
W21732     MOVE DP015-UNP-ALP-BRT-OFF    TO  ANSKUA.                    15400092
W21732     MOVE DP015-RED                TO  ANSKUC.                    15410092
W21732     MOVE DP015-REVERSE            TO  ANSKUH.                    15420092
W21732     MOVE -1                       TO  ANSKUL.                    15430092
157200                                                                  15440092
157300*----------------------------------------------------------------*15450092
157400*    SET THE FIELDS IN ERROR.                                    *15460092
157500*----------------------------------------------------------------*15470092
157600                                                                  15480092
157700 3045-SET-QTY-PRICE-ERROR.                                        15490092
157800                                                                  15500092
W28545     IF  PV-SKU GREATER THAN ZEROS                                15510092
158000         CONTINUE                                                 15520092
158100     ELSE                                                         15530092
158200         MOVE PC-TSYMSG-00007      TO  DP020-MSG-NUMBER           15540092
158300     END-IF.                                                      15550092
158400                                                                  15560092
158500     SET PS-ERROR                                                 15570092
158600         PS-QTY-PRICE-ERROR                                       15580092
158700         DP020-MSG-FATAL           TO  TRUE.                      15590092
158800                                                                  15600092
158900     IF  ASC-NEW-PRICE EQUAL ZERO                                 15610092
159000         MOVE DP015-UNP-ALP-BRT-OFF                               15620092
159100                                   TO  ANADJPRA                   15630092
159200         MOVE DP015-RED            TO  ANADJPRC                   15640092
159300         MOVE DP015-REVERSE        TO  ANADJPRH                   15650092
159400         MOVE -1                   TO  ANADJPRL                   15660092
159500     END-IF.                                                      15670092
159600                                                                  15680092
159700     IF  ASC-NEW-QTY EQUAL ZERO                                   15690092
159800         MOVE DP015-UNP-ALP-BRT-OFF                               15700092
159900                                   TO  ANADJQTA                   15710092
160000         MOVE DP015-RED            TO  ANADJQTC                   15720092
160100         MOVE DP015-REVERSE        TO  ANADJQTH                   15730092
160200         MOVE -1                   TO  ANADJQTL                   15740092
160300     END-IF.                                                      15750092
160400/                                                                 15760092
165800                                                                  15770092
W25248*----------------------------------------------------------------*15780092
W25248*                                                                 15790092
W25248*                        UPC LOGIC                                15800092
W25248*                                                                 15810092
W25248*----------------------------------------------------------------*15820092
W25248*    FIRST, SEE IF THE OPERATOR ENTERED A VALID UPC.             *15830092
W25248*    IF VALID, CHECK FOR STATUS 98.                              *15840092
W25248*    IF A ROW DOES NOT EXIST ON EITHER TSUMINV OR TADJADD,       *15850092
W25248*    CHECK IF A ROW EXISTS FOR THE RENUMBERED SKU.               *15860092
W25248*    IF NOT, USE THE RENUMBERED SKU FOR PROCESSING.              *15870092
W25248*----------------------------------------------------------------*15880092
W25248                                                                  15890092
W25248 3070-VALIDATE-UPC.                                               15900092
W25248                                                                  15910092
W25248     SET PS-GOOD-UPC               TO  TRUE.                      15920092
W25248                                                                  15930092
W25248     MOVE ASC-UPC                  TO  DP010I-UNEDITED-FIELD.     15940092
W25248     MOVE PC-15                    TO  DP010I-MAXIMUM-DIGITS.     15950092
W25248     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   15960092
W25248     SET DP010I-NEGATIVE-NOT-ALLOWED                              15970092
W25248                                   TO  TRUE.                      15980092
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             15991099
263126          USING DP010I-NUMERIC-EDIT-AREA.                         15992099
W25248                                                                  16000092
W25248     IF  DP010I-ERROR-DETECTED                                    16010092
W25248         PERFORM 3090-SET-UPC-ERROR                               16020092
W25248     ELSE                                                         16030092
W25248         MOVE DP010I-NUM-FIELD-15-DIG-2-DEC TO  PV-FIFTEEN        16040092
W25248         MOVE PV-FIFTEEN-X         TO  ASC-UPC                    16050092
W25248     END-IF.                                                      16060092
W25248                                                                  16070092
W25248*----------------------------------------------------------------*16080092
W25248*    PROCESS THE UPC. CHECK IF THE UPC IS VALID.                 *16090092
W25248*    IF VALID - DETERMINE IF RENUMBERED AND PROCEED ACCORDINGLY  *16100092
W25248*----------------------------------------------------------------*16110092
W25248                                                                  16120092
W25248 3075-PROCESS-UPC.                                                16130092
W25248                                                                  16140092
W28545     INITIALIZE IN400-PV-INPUT-AREA.                              16150092
W28545                                                                  16200092
F28545     MOVE IN001-DB2-ACTL-INV-DTE  TO IN400-PV-EFF-DTE-IN.         16210099
W28545     MOVE 'UPC'                   TO IN400-PV-LOOKUP-TYPE-IN.     16220092
W28545     MOVE ZEROS                   TO PV-SKU.                      16230092
W28545     MOVE ASC-UPC                 TO PV-UPC-NUMBER.               16240092
W28545     MOVE PV-UPC-NUMBER           TO IN400-PV-UPC-NBR-IN.         16250092
W26600     MOVE ASC-STORE-NBR           TO PV-STORE-NBR-X.              16260092
W28545     MOVE PV-STORE-NBR-9          TO IN400-PV-LOC-IN-NUM.         16270092
W28545                                                                  16280092
W28545     PERFORM IN400-LOOKUP-RETAIL.                                 16340092
W28545                                                                  16350092
W28545     IF IN400-PV-FOUND                                            16360092
W28545         MOVE IN400-PRC-STATUS-OUT TO PV-STAT-CDE                 16370092
W28545         MOVE IN400-PRC-SKU-OUT    TO PV-SKU                      16371094
W28545         MOVE IN400-PRC-SKU-OUT    TO PV-HOLD-SKU                 16372095
W28545         MOVE IN400-PRC-UPC-OUT    TO PV-HOLD-UPC                 16373095
W28545         MOVE IN400-PRC-UPC-OUT    TO PV-UPC                      16374095
W28582         IF IN400-PV-DUMMY-UPC                                    16375099
W28582             MOVE IN400-ATT-SKU-OUT TO PV-SKU                     16376099
W28582                                       PV-HOLD-SKU                16376199
W28582             MOVE IN400-ATT-UPC-OUT TO PV-UPC                     16376299
W28582                                       PV-HOLD-UPC                16376399
W28582         END-IF                                                   16378099
W28545                                                                  16401096
W28545         IF IN400-PS-RENUMBER-SKU AND                             16403096
W28545            IN400-PRC-SKU-OUT NOT = ZEROS                         16404096
134800               SET DP020-MSG-INFORMATIONAL                        16405096
134900                                      TO  TRUE                    16406096
W28545               MOVE PC-TSYMSG-00453   TO  DP020-MSG-NUMBER        16407096
W28545               MOVE IN400-PRC-SKU-OUT TO  PV-SKU                  16408096
W28545               MOVE PV-SKU            TO  ASC-SKU                 16409096
W28545               MOVE IN400-PRC-SKU-OUT TO  DP020-MSG-TEXT          16409196
W28545          END-IF                                                  16409696
W28545     ELSE                                                         16410092
W28545         IF IN400-PV-NOT-FOUND                                    16420092
W28545             MOVE ZEROS           TO PV-STAT-CDE                  16430092
W28545     ELSE                                                         16440092
W28545             MOVE '3075-PROCESS-UPC '                             16450092
W28545                                   TO DP013-PARAGRAPH             16460092
W28545             MOVE 'CALL INPD400 '                                 16470092
W28545                                   TO DP013-MESSAGE-TEXT (1)      16480092
W28545             MOVE IN400-PV-RETURN-RSN                             16490092
W28545                                   TO DP013-MESSAGE-TEXT (2)      16500092
W28545             MOVE IN400-PV-PARAGRAPH                              16510092
W28545                                   TO DP013-MESSAGE-TEXT (3)      16520092
W28545             MOVE IN400-PV-PRC-SQLCDE                             16530092
W28545                                   TO DP013-SQLCA                 16540092
W28545             MOVE '???????'        TO DP013-DB2-TABLE-NAME (1)    16550092
W28545             SET DP013-DB2-ABEND                                  16560092
W28545                     DP013-XCTL-DISPLAY-RESTART                   16570092
W28545                                   TO TRUE                        16580092
W28545             PERFORM DP013-0000-PROCESS-ABEND                     16590092
W28545                                                                  16600092
W28545     END-IF.                                                      16610092
W28545     MOVE PV-STAT-CDE              TO  ASC-STATUS-CODE.           16620092
W25248*----------------------------------------------------------------*16630092
W25248*    SEE IF A ROW EXISTS ON EITHER TSUMINV OR TADJADD.           *16640092
W25248*----------------------------------------------------------------*16650092
W25248 3085-FROM-WHERE.                                                 16660092
W25248                                                                  16670092
X25248     PERFORM 4102-GET-FROM-TSUMINV.                               16680092
W25248                                                                  16690092
W25248     IF  SQLCODE EQUAL +100                                       16700092
X25248         PERFORM 4202-GET-FROM-TADJADD                            16710092
W25248         IF  SQLCODE EQUAL ZERO                                   16720092
W25248             SET PS-ERROR                                         16730092
W25248                 PS-ROW-FOUND      TO  TRUE                       16740092
W25248         END-IF                                                   16750092
W25248     ELSE                                                         16760092
W25248         SET PS-ERROR                                             16770092
W25248             PS-ROW-FOUND          TO  TRUE                       16780092
W25248     END-IF.                                                      16790092
W25248                                                                  16800092
W25248     IF  PS-ROW-FOUND                                             16810092
W25248         PERFORM 3090-SET-UPC-ERROR                               16820092
W25248         MOVE PC-TSYMSG-00117      TO  DP020-MSG-NUMBER           16830092
W25248     END-IF.                                                      16840092
W25248/                                                                 16850092
W25248*----------------------------------------------------------------*16860092
W25248*    COMMON ROUTINE TO SET SKU ERROR FLAGS.                      *16870092
W25248*----------------------------------------------------------------*16880092
W25248/                                                                 16890092
W25248 3090-SET-UPC-ERROR.                                              16900092
W25248                                                                  16910092
W25248     SET PS-ERROR                                                 16920092
W25248         PS-BAD-UPC                                               16930092
W25248         DP020-MSG-FATAL           TO  TRUE.                      16940092
W25248     MOVE PC-TSYMSG-00100          TO  DP020-MSG-NUMBER.          16950092
W25248     MOVE DP015-UNP-ALP-BRT-OFF    TO  ANUPCA.                    16960092
W25248     MOVE DP015-RED                TO  ANUPCC.                    16970092
W25248     MOVE DP015-REVERSE            TO  ANUPCH.                    16980092
W21732     MOVE -1                       TO  ANUPCL.                    16990092
W25248/                                                                 17000092
166100*----------------------------------------------------------------*17010092
166200*    READ THE TINVPAR AND CHECK IF THE BOOKING PROCESS FOR THE   *17020092
166300*    STORE IS CURRENTLY TAKING PLACE                             *17030092
166400*----------------------------------------------------------------*17040092
166500                                                                  17050092
166600 3099-CHECK-BOOKING-STATUS.                                       17060092
166700                                                                  17070092
W26600     MOVE ASC-STORE-NBR            TO  PV-STORE-NBR-X.            17080092
W26600     MOVE PV-STORE-NBR-9           TO  INVPAR-LOC-NBR.            17090092
JKB        MOVE IN001-INV-ID             TO  INVPAR-INV-ID.             17091099
W26600                                                                  17100092
166800         EXEC SQL                                                 17110092
166900            SELECT  A.ACTL_UNIT_BK_DTE                            17120099
167000                   ,A.UNT_BKG_STAT_CDE                            17130099
167100            INTO   :INVPAR-ACTL-UNIT-BK-DTE                       17140092
167200                  ,:INVPAR-UNT-BKG-STAT-CDE                       17150092
167300              FROM   TINVPAR  A                                   17160099
JKB                       ,TINCNTL  B                                   17161099
W26600              WHERE  A.LOC_NBR = :INVPAR-LOC-NBR                  17170099
JKB                   AND  A.INV_ID  = :INVPAR-INV-ID                   17170199
167500                AND  A.ACTL_FIN_BK_DTE = :PC-NINES-DATE           17170299
W33304                AND  A.LOC_INV_STAT_CDE = 'IN'                    17170399
JKB                   AND  A.INV_ID  = B.INV_ID                         17171099
JKB                   AND  B.ACTV_IND = 'Y'                             17173099
167600         END-EXEC.                                                17190092
167700                                                                  17200092
167800         EVALUATE TRUE                                            17210092
167900             WHEN SQLCODE = ZERO                                  17220092
168000                  CONTINUE                                        17230092
168100             WHEN SQLCODE = +100                                  17240092
W33304                  MOVE 'IN' TO  INVPAR-UNT-BKG-STAT-CDE           17250099
168300                  MOVE PC-NINES-DATE TO INVPAR-ACTL-UNIT-BK-DTE   17260092
168400             WHEN SQLCODE = -904                                  17270092
168500             WHEN SQLCODE = -913                                  17280092
168600                  PERFORM 9900-SOFT-ABORT                         17290092
168700             WHEN SQLWARN0 NOT = SPACES                           17300092
168800             WHEN SQLCODE NOT EQUAL ZERO                          17310092
168900                 MOVE '3099-CHECK-BOOKING-STATUS'                 17320092
169000                                   TO DP013-PARAGRAPH             17330092
169100                 MOVE 'SELECT TINVPAR'                            17340092
169200                                   TO DP013-MESSAGE-TEXT (1)      17350092
169300                 MOVE SQLCA        TO DP013-SQLCA                 17360092
169400                 MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)    17370092
169500                 SET DP013-DB2-ABEND                              17380092
169600                     DP013-XCTL-DISPLAY-RESTART                   17390092
169700                                   TO TRUE                        17400092
169800                 PERFORM DP013-0000-PROCESS-ABEND                 17410092
169900         END-EVALUATE.                                            17420092
170000                                                                  17430092
170200*----------------------------------------------------------------*17440092
170300*    RESET THE DATA ENTERABLE FIELDS ATTRIBUTE, HIGHLIGHT, AND   *17450092
170400*    COLOR BYTES.                                                *17460092
170500*----------------------------------------------------------------*17470092
170600                                                                  17480092
170700 3200-RESET-ATTRIBUTES.                                           17490092
170800                                                                  17500092
170900     IF  ASC-NO-ADJUSTMENTS-ALLOWED                               17510092
171000         MOVE DP015-ASK-DRK-OFF    TO  ANADJQTA                   17520092
171100                                       ANADJPRA                   17530092
171200                                       ANREASNA                   17540092
171300         MOVE DP015-BLUE           TO  ANADJQTC                   17550092
171400                                       ANADJPRC                   17560092
171500                                       ANREASNC                   17570092
171600         MOVE DP015-HL-OFF         TO  ANADJQTH                   17580092
171700                                       ANADJPRH                   17590092
171800                                       ANREASNH                   17600092
171900     ELSE                                                         17610092
172000         MOVE DP015-UNP-ALP-BRT-OFF TO ANADJQTA                   17620092
172100                                       ANADJPRA                   17630092
172200                                       ANREASNA                   17640092
172300         MOVE DP015-GREEN          TO  ANADJQTC                   17650092
172400                                       ANADJPRC                   17660092
172500                                       ANREASNC                   17670092
172600         MOVE DP015-UNDERLINE      TO  ANADJQTH                   17680092
172700                                       ANADJPRH                   17690092
172800                                       ANREASNH                   17700092
172900     END-IF.                                                      17710092
173000                                                                  17720092
173100     IF  ASC-ADD-NEW                                              17730092
W21732         MOVE DP015-UNP-ALP-NOR-OFF TO ANSKUA                     17740092
W25248                                       ANUPCA                     17750092
W21732         MOVE DP015-GREEN           TO ANSKUC                     17760092
W25248                                       ANUPCC                     17770092
W21732         MOVE DP015-UNDERLINE       TO ANSKUH                     17780092
W25248                                       ANUPCH                     17790092
174200     ELSE                                                         17800092
W21732         MOVE DP015-ASK-DRK-OFF     TO ANSKUA                     17810092
W25248                                       ANUPCA                     17820092
W21732         MOVE DP015-BLUE            TO ANSKUC                     17830092
W25248                                       ANUPCC                     17840092
W21732         MOVE DP015-HL-OFF          TO ANSKUH                     17850092
W25248                                       ANUPCH                     17860092
175300     END-IF.                                                      17870092
175400                                                                  17880092
175500/                                                                 17890092
175600*----------------------------------------------------------------*17900092
175700*    THIS IS BUILT ONLY IF A SELECTION QUEUE WAS PASSED.         *17910092
175800*----------------------------------------------------------------*17920092
175900                                                                  17930092
176000 4000-BUILD-INITIAL-PANEL.                                        17940092
176100                                                                  17950092
176200     SET DP030-SET-CURSOR-APPL-1                                  17960092
176300         ASC-ADJUSTMENTS-ALLOWED   TO  TRUE.                      17970092
176400     MOVE IN001-STORE-NBR          TO  ASC-STORE-NBR.             17980092
176500     MOVE IN001-AREA-NBR           TO  ASC-AREA-NBR.              17990092
176600     MOVE ZERO                     TO  ASC-MAP-SUB.               18000092
176700                                                                  18010092
W25248     EVALUATE DP020-INT-APPL-FORMAT-IND                           18020092
W25248         WHEN PC-INTER-APPL-LIST                                  18030092
W25248             IF  ASC-FROM-TSUMINV                                 18040092
W25248                 PERFORM 4120-GET-FROM-TSUMINV                    18050092
W25248                 SET ASC-ADJ-TYPE-SI   TO  TRUE                   18060092
W25248                 SET ASC-ADJ-TYPE-MM   TO  TRUE                   18070092
W25248                 SET ASC-ADJ-TYPE-SA   TO  TRUE                   18080092
W25248             ELSE                                                 18090092
W25248                 PERFORM 4220-GET-FROM-TADJADD                    18100092
W25248                 SET ASC-ADJ-TYPE-AD   TO  TRUE                   18110092
W25248                 SET ASC-ADJ-TYPE-AD2  TO  TRUE                   18120092
W25248                 SET ASC-ADJ-TYPE-AD3  TO  TRUE                   18130092
W25248             END-IF                                               18140092
R26600             PERFORM 4700-GET-TADJDTL-LIST                        18150092
W25248         WHEN PC-INTER-APPL-DETAIL                                18160092
W25248             IF  ASC-FROM-TSUMINV                                 18170092
W25248                 PERFORM 4180-GET-FROM-TSUMINV                    18180092
W25248                 SET ASC-ADJ-TYPE-SI   TO  TRUE                   18190092
W25248                 SET ASC-ADJ-TYPE-MM   TO  TRUE                   18200092
W25248                 SET ASC-ADJ-TYPE-SA   TO  TRUE                   18210092
W25248             ELSE                                                 18220092
W25248                 PERFORM 4280-GET-FROM-TADJADD                    18230092
W25248                 SET ASC-ADJ-TYPE-AD   TO  TRUE                   18240092
W25248                 SET ASC-ADJ-TYPE-AD2  TO  TRUE                   18250092
W25248                 SET ASC-ADJ-TYPE-AD3  TO  TRUE                   18260092
W25248             END-IF                                               18270092
R26600             PERFORM 4300-GET-TADJDTL                             18280092
W25248         WHEN OTHER                                               18290092
W25248             CONTINUE                                             18300092
PREV  *        IF  ASC-FROM-TSUMINV                                     18310092
CODE  *            PERFORM 4100-GET-FROM-TSUMINV                        18320092
 |    *            SET ASC-ADJ-TYPE-SI       TO  TRUE                   18330092
 |    *            SET ASC-ADJ-TYPE-MM       TO  TRUE                   18340092
 |    *            SET ASC-ADJ-TYPE-SA       TO  TRUE                   18350092
 |    *        ELSE                                                     18360092
 |    *            PERFORM 4200-GET-FROM-TADJADD                        18370092
 |    *            SET ASC-ADJ-TYPE-AD       TO  TRUE                   18380092
 |    *            SET ASC-ADJ-TYPE-AD2      TO  TRUE                   18390092
 |    *            SET ASC-ADJ-TYPE-AD3      TO  TRUE                   18400092
EXIST *        END-IF                                                   18410092
           END-EVALUATE.                                                18420092
                                                                        18430092
R26600**** PERFORM 4300-GET-TADJDTL.                                    18440092
R26600****                                                              18450092
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18460092
178200/                                                                 18470092
178300*----------------------------------------------------------------*18480092
178400*    RETRIEVE THE ROWS FROM THE SUMMARY INVENTORY TABLE.         *18490092
178500*----------------------------------------------------------------*18500092
178600                                                                  18510092
178700 4100-GET-FROM-TSUMINV.                                           18520092
178800                                                                  18530092
W26600     MOVE ASC-STORE-NBR            TO  PV-STORE-NBR-X.            18540092
W26600     MOVE PV-STORE-NBR-9           TO  SUMINV-LOC-NBR.            18550092
W21732     MOVE ASC-AREA-NBR               TO SUMINV-AREA-NBR.          18560092
W21732*    MOVE ASC-SKU                    TO PV-SKU.                   18570092
W21732*    MOVE PV-SKU                     TO SUMINV-SKU-NBR.           18580092
W21732     MOVE ASC-PRICE                  TO SUMINV-INV-UNIT-PR-AMT.   18590092
W25248*                                                                 18600092
W25248     IF ASC-UPC-NUM > 0                                           18610092
W25248         SET PS-UPC-ENTERED          TO TRUE                      18620092
W25248         PERFORM 3075-PROCESS-UPC                                 18630092
W28545         MOVE PV-SKU      TO SUMINV-SKU-NBR                       18640092
W25248         MOVE UPC-UPC-NBR TO SUMINV-UPC-NBR                       18650092
W25248     ELSE                                                         18660092
W25248         SET PS-SKU-ENTERED          TO TRUE                      18670092
W25248         MOVE ASC-SKU                TO PV-SKU                    18680092
W25248         MOVE PV-SKU                 TO SUMINV-SKU-NBR            18690092
W25248         MOVE ZEROES                 TO SUMINV-UPC-NBR            18700092
W25248     END-IF.                                                      18710092
W25248*                                                                 18720092
W25248*                                                                 18730092
178900     EXEC SQL                                                     18740092
W25248          SELECT  SKU_NBR                                         18750092
W25248               ,  UPC_NBR                                         18760092
179100               ,  INV_UNIT_PR_AMT                                 18770092
179200               ,  INV_QTY                                         18780092
179300               ,  EXTD_AMT                                        18790092
179400               ,  DKEY_NBR                                        18800092
W25248          INTO   :SUMINV-SKU-NBR                                  18810092
W25248               , :SUMINV-UPC-NBR                                  18820092
179600               , :SUMINV-INV-UNIT-PR-AMT                          18830092
179700               , :SUMINV-INV-QTY                                  18840092
179800               , :SUMINV-EXTD-AMT                                 18850092
179900               , :SUMINV-DKEY-NBR                                 18860092
180100          FROM    TSUMINV                                         18870092
W26600          WHERE   LOC_NBR          =  :SUMINV-LOC-NBR             18880092
W21732            AND   AREA_NBR           =  :SUMINV-AREA-NBR          18890092
W21732            AND   SKU_NBR            =  :SUMINV-SKU-NBR           18900092
W26682            AND   UPC_NBR            =  :SUMINV-UPC-NBR           18910092
W21732            AND   INV_UNIT_PR_AMT    =  :SUMINV-INV-UNIT-PR-AMT   18920092
180900     END-EXEC.                                                    18930092
181000                                                                  18940092
181100     EVALUATE TRUE                                                18950092
181200         WHEN SQLCODE = ZERO                                      18960092
181300         WHEN SQLCODE = +100                                      18970092
181400              CONTINUE                                            18980092
181500         WHEN SQLCODE = -904                                      18990092
181600         WHEN SQLCODE = -913                                      19000092
181700              PERFORM 9900-SOFT-ABORT                             19010092
181800         WHEN SQLWARN0 NOT = SPACES                               19020092
181900         WHEN SQLCODE NOT EQUAL ZERO                              19030092
182000              MOVE '4100-GET-FROM-TSUMINV'                        19040092
182100                                   TO DP013-PARAGRAPH             19050092
182200              MOVE 'SELECT TSUMINV'                               19060092
182300                                   TO DP013-MESSAGE-TEXT (1)      19070092
182400              MOVE SQLCA           TO DP013-SQLCA                 19080092
182500              MOVE 'TSUMINV'       TO DP013-DB2-TABLE-NAME (1)    19090092
182600              SET DP013-DB2-ABEND                                 19100092
182700                  DP013-XCTL-DISPLAY-RESTART                      19110092
182800                                   TO TRUE                        19120092
182900              PERFORM DP013-0000-PROCESS-ABEND                    19130092
183000     END-EVALUATE.                                                19140092
183100                                                                  19150092
183200     IF  SQLCODE EQUAL ZERO                                       19160092
183300         MOVE SUMINV-INV-UNIT-PR-AMT TO  ASC-ORIG-PRICE           19170092
183400                                         ASC-TOT-PRICE            19180092
183500         MOVE SUMINV-INV-QTY         TO  ASC-ORIG-QTY             19190092
183600                                         ASC-TOT-QTY              19200092
183700         MOVE SUMINV-EXTD-AMT        TO  ASC-ORIG-EXT-PRICE       19210092
183800                                         ASC-TOT-EXT-PRICE        19220092
183900         MOVE SUMINV-DKEY-NBR        TO  ASC-DKEY-NBR             19230092
184000     END-IF.                                                      19240092
184100                                                                  19250092
X25248/----------------------------------------------------------------*19260092
 |    * 4102-GET-FROM-TSUMINV.                                          19270092
 |    *    RETRIEVE THE ROWS FROM THE SUMMARY INVENTORY TABLE.         *19280092
 |    *----------------------------------------------------------------*19290092
 |     4102-GET-FROM-TSUMINV.                                           19300092
X25248                                                                  19310092
W26600     MOVE ASC-STORE-NBR            TO  PV-STORE-NBR-X.            19320092
W26600     MOVE PV-STORE-NBR-9           TO  SUMINV-LOC-NBR.            19330092
X25248     MOVE ASC-AREA-NBR               TO SUMINV-AREA-NBR.          19340092
 |         MOVE ASC-SKU                    TO PV-SKU.                   19350092
X25248     MOVE PV-SKU                     TO SUMINV-SKU-NBR.           19360092
W26682     MOVE ASC-UPC                    TO PV-UPC.                   19370092
W26682     MOVE PV-UPC                     TO SUMINV-UPC-NBR.           19380092
X25248     MOVE ASC-PRICE                  TO SUMINV-INV-UNIT-PR-AMT.   19390092
 |    *                                                                 19400092
 |         EXEC SQL                                                     19410092
 |              SELECT  SKU_NBR                                         19420092
 |                   ,  UPC_NBR                                         19430092
 |                   ,  INV_UNIT_PR_AMT                                 19440092
 |                   ,  INV_QTY                                         19450092
 |                   ,  EXTD_AMT                                        19460092
 |                   ,  DKEY_NBR                                        19470092
 |              INTO   :SUMINV-SKU-NBR                                  19480092
 |                   , :SUMINV-UPC-NBR                                  19490092
 |                   , :SUMINV-INV-UNIT-PR-AMT                          19500092
 |                   , :SUMINV-INV-QTY                                  19510092
 |                   , :SUMINV-EXTD-AMT                                 19520092
 |                   , :SUMINV-DKEY-NBR                                 19530092
X25248          FROM    TSUMINV                                         19540092
W26600          WHERE   LOC_NBR          =  :SUMINV-LOC-NBR             19550092
X25248            AND   AREA_NBR           =  :SUMINV-AREA-NBR          19560092
X25248            AND   SKU_NBR            =  :SUMINV-SKU-NBR           19570092
W26682            AND   UPC_NBR            =  :SUMINV-UPC-NBR           19580092
X25248            AND   INV_UNIT_PR_AMT    =  :SUMINV-INV-UNIT-PR-AMT   19590092
 |         END-EXEC.                                                    19600092
 |                                                                      19610092
 |         EVALUATE TRUE                                                19620092
 |             WHEN SQLCODE = ZERO                                      19630092
 |             WHEN SQLCODE = +100                                      19640092
 |                  CONTINUE                                            19650092
 |             WHEN SQLCODE = -904                                      19660092
 |             WHEN SQLCODE = -913                                      19670092
 |                  PERFORM 9900-SOFT-ABORT                             19680092
 |             WHEN SQLWARN0 NOT = SPACES                               19690092
 |             WHEN SQLCODE NOT EQUAL ZERO                              19700092
 |                  MOVE '4102-GET-FROM-TSUMINV'                        19710092
 |                                       TO DP013-PARAGRAPH             19720092
 |                  MOVE 'SELECT TSUMINV'                               19730092
 |                                       TO DP013-MESSAGE-TEXT (1)      19740092
 |                  MOVE SQLCA           TO DP013-SQLCA                 19750092
 |                  MOVE 'TSUMINV'       TO DP013-DB2-TABLE-NAME (1)    19760092
 |                  SET DP013-DB2-ABEND                                 19770092
 |                      DP013-XCTL-DISPLAY-RESTART                      19780092
 |                                       TO TRUE                        19790092
 |                  PERFORM DP013-0000-PROCESS-ABEND                    19800092
 |         END-EVALUATE.                                                19810092
 |                                                                      19820092
 |         IF  SQLCODE EQUAL ZERO                                       19830092
 |             MOVE SUMINV-INV-UNIT-PR-AMT TO  ASC-ORIG-PRICE           19840092
 |                                             ASC-TOT-PRICE            19850092
 |             MOVE SUMINV-INV-QTY         TO  ASC-ORIG-QTY             19860092
 |                                             ASC-TOT-QTY              19870092
 |             MOVE SUMINV-EXTD-AMT        TO  ASC-ORIG-EXT-PRICE       19880092
 |                                             ASC-TOT-EXT-PRICE        19890092
 |             MOVE SUMINV-DKEY-NBR        TO  ASC-DKEY-NBR             19900092
X25248     END-IF.                                                      19910092
184100/                                                                 19920092
W25248*----------------------------------------------------------------*19930092
W25248*    RETRIEVE THE ROWS FROM THE SUMMARY INVENTORY TABLE.         *19940092
W25248*----------------------------------------------------------------*19950092
W25248                                                                  19960092
W25248 4120-GET-FROM-TSUMINV.                                           19970092
W25248                                                                  19980092
W26600     MOVE ASC-STORE-NBR              TO PV-STORE-NBR-X.           19990092
W26600     MOVE PV-STORE-NBR-9             TO SUMINV-LOC-NBR.           20000092
W25248     MOVE ASC-AREA-NBR               TO SUMINV-AREA-NBR.          20010092
W25248     MOVE ASC-PRICE                  TO SUMINV-INV-UNIT-PR-AMT.   20020092
W25248                                                                  20030092
W25248     MOVE ASC-SKU                    TO PV-HOLD-SKU.              20040092
W25248     MOVE PV-HOLD-SKU                TO SUMINV-SKU-NBR.           20050092
W25248                                                                  20060092
W25248     PERFORM 4130-OPEN-SUM-CSR.                                   20070092
W25248     PERFORM 4140-RETRIEVE-SUM-ROWS.                              20080092
W25248     PERFORM 4160-CLOSE-SUM-CSR.                                  20090092
W25248                                                                  20100092
W25248*----------------------------------------------------------------*20110092
W25248*    OPEN THE SUMINV CURSOR.                                     *20120092
W25248*----------------------------------------------------------------*20130092
192200                                                                  20140092
W25248 4130-OPEN-SUM-CSR.                                               20150092
W25248                                                                  20160092
W26600     MOVE ASC-STORE-NBR       TO PV-STORE-NBR-X.                  20170092
W26600     MOVE PV-STORE-NBR-9      TO SUMINV-LOC-NBR.                  20180092
W26600                                                                  20190092
W25248     EXEC SQL                                                     20200092
W25248          OPEN SUMINV-CSR                                         20210092
W25248     END-EXEC.                                                    20220092
W25248                                                                  20230092
W25248     EVALUATE TRUE                                                20240092
W25248         WHEN SQLCODE = ZERO                                      20250092
W25248         WHEN SQLCODE = +100                                      20260092
W25248              CONTINUE                                            20270092
W25248         WHEN SQLCODE = -904                                      20280092
W25248         WHEN SQLCODE = -913                                      20290092
W25248              PERFORM 9900-SOFT-ABORT                             20300092
W25248         WHEN SQLWARN0 NOT = SPACES                               20310092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              20320092
W25248              MOVE '4130-OPEN-SUM-CSR'                            20330092
W25248                                   TO DP013-PARAGRAPH             20340092
W25248              MOVE 'OPEN SUMINV CURSOR'                           20350092
W25248                                   TO DP013-MESSAGE-TEXT (1)      20360092
W25248              MOVE SQLCA           TO DP013-SQLCA                 20370092
W25248              MOVE 'TSUMINV'       TO DP013-DB2-TABLE-NAME (1)    20380092
W25248              SET DP013-DB2-ABEND                                 20390092
W25248                  DP013-XCTL-DISPLAY-RESTART                      20400092
W25248                                   TO TRUE                        20410092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    20420092
W25248     END-EVALUATE.                                                20430092
W25248                                                                  20440092
W25248*----------------------------------------------------------------*20450092
W25248*    NOW, FETCH THE ROWS AND LOAD THE ASC.                       *20460092
W25248*----------------------------------------------------------------*20470092
W25248                                                                  20480092
W25248 4140-RETRIEVE-SUM-ROWS.                                          20490092
W25248                                                                  20500092
W25248     MOVE ZEROES TO PA-INV-QTY                                    20510092
W25248                    PA-EXTD-AMT.                                  20520092
W25248                                                                  20530092
W25248     MOVE 'N' TO PS-SUMINV-CSR-SW.                                20540092
W25248                                                                  20550092
W25248     MOVE ASC-SKU-NUM TO PV-HOLD-SKU.                             20560092
W25248                                                                  20570092
W25248     PERFORM 4150-FETCH-SUM-CSR                                   20580092
W25248         UNTIL PS-EOF-SUMINV-CSR.                                 20590092
W25248                                                                  20600092
W25248     MOVE SUMINV-INV-UNIT-PR-AMT TO  ASC-ORIG-PRICE               20610092
W25248                                     ASC-TOT-PRICE.               20620092
W25248     MOVE PA-INV-QTY             TO  ASC-ORIG-QTY                 20630092
W25248                                     ASC-TOT-QTY.                 20640092
W25248     MOVE PA-EXTD-AMT            TO  ASC-ORIG-EXT-PRICE           20650092
W25248                                     ASC-TOT-EXT-PRICE.           20660092
W25248     MOVE SUMINV-DKEY-NBR        TO  ASC-DKEY-NBR.                20670092
W25248                                                                  20680092
W25248*----------------------------------------------------------------*20690092
W25248*    FETCH A ROW FROM THE SUMINV CURSOR.                         *20700092
W25248*----------------------------------------------------------------*20710092
W25248                                                                  20720092
W25248 4150-FETCH-SUM-CSR.                                              20730092
W25248                                                                  20740092
W25248     EXEC SQL                                                     20750092
W25248          FETCH                                                   20760092
W25248                  SUMINV-CSR                                      20770092
W25248          INTO                                                    20780092
W25248                 :SUMINV-UPC-NBR                                  20790092
W25248               , :SUMINV-INV-UNIT-PR-AMT                          20800092
W25248               , :SUMINV-INV-QTY                                  20810092
W25248               , :SUMINV-EXTD-AMT                                 20820092
W25248               , :SUMINV-DKEY-NBR                                 20830092
W25248     END-EXEC.                                                    20840092
W25248                                                                  20850092
W25248     EVALUATE TRUE                                                20860092
W25248         WHEN SQLCODE = ZERO                                      20870092
W25248             PERFORM 4170-PROCESS-SUM-ROWS                        20880092
W25248         WHEN SQLCODE = +100                                      20890092
W25248              SET PS-EOF-SUMINV-CSR TO TRUE                       20900092
W25248         WHEN SQLCODE = -904                                      20910092
W25248         WHEN SQLCODE = -913                                      20920092
W25248              PERFORM 9900-SOFT-ABORT                             20930092
W25248         WHEN SQLWARN0 NOT = SPACES                               20940092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              20950092
W25248              MOVE '4150-FETCH-SUM-CSR'                           20960092
W25248                                   TO DP013-PARAGRAPH             20970092
W25248              MOVE 'FETCH SUMINV CURSOR'                          20980092
W25248                                   TO DP013-MESSAGE-TEXT (1)      20990092
W25248              MOVE SQLCA           TO DP013-SQLCA                 21000092
W25248              MOVE 'TSUMINV'       TO DP013-DB2-TABLE-NAME (1)    21010092
W25248              SET DP013-DB2-ABEND                                 21020092
W25248                  DP013-XCTL-DISPLAY-RESTART                      21030092
W25248                                   TO TRUE                        21040092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    21050092
W25248     END-EVALUATE.                                                21060092
W25248                                                                  21070092
W25248*----------------------------------------------------------------*21080092
W25248*    CLOSE THE SUMINV CURSOR.                                    *21090092
W25248*----------------------------------------------------------------*21100092
W25248                                                                  21110092
W25248 4160-CLOSE-SUM-CSR.                                              21120092
W25248                                                                  21130092
W25248     EXEC SQL                                                     21140092
W25248          CLOSE SUMINV-CSR                                        21150092
W25248     END-EXEC.                                                    21160092
W25248                                                                  21170092
W25248     EVALUATE TRUE                                                21180092
W25248         WHEN SQLCODE = ZERO                                      21190092
W25248              CONTINUE                                            21200092
W25248         WHEN SQLCODE = -904                                      21210092
W25248         WHEN SQLCODE = -913                                      21220092
W25248              PERFORM 9900-SOFT-ABORT                             21230092
W25248         WHEN SQLWARN0 NOT = SPACES                               21240092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              21250092
W25248              MOVE '4160-CLOSE-SUM-CSR'                           21260092
W25248                                   TO DP013-PARAGRAPH             21270092
W25248              MOVE 'CLOSE SUMINV CURSOR'                          21280092
W25248                                   TO DP013-MESSAGE-TEXT (1)      21290092
W25248              MOVE SQLCA           TO DP013-SQLCA                 21300092
W25248              MOVE 'TSUMINV'       TO DP013-DB2-TABLE-NAME (1)    21310092
W25248              SET DP013-DB2-ABEND                                 21320092
W25248                  DP013-XCTL-DISPLAY-RESTART                      21330092
W25248                                   TO TRUE                        21340092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    21350092
W25248     END-EVALUATE.                                                21360092
W25248                                                                  21370092
W25248*----------------------------------------------------------------*21380092
W25248*    NOW, ACCUMULATE THE SKU ROWS (INCLUDING ALL UPCS)           *21390092
W25248*----------------------------------------------------------------*21400092
W25248                                                                  21410092
W25248 4170-PROCESS-SUM-ROWS.                                           21420092
W25248     MOVE SUMINV-UPC-NBR  TO ASC-UPC.                             21430092
W25248     MOVE SUMINV-DKEY-NBR TO ASC-DKEY-NBR.                        21440092
W25248                                                                  21450092
W25248     COMPUTE PA-INV-QTY  = PA-INV-QTY  + SUMINV-INV-QTY.          21460092
W25248     COMPUTE PA-EXTD-AMT = PA-EXTD-AMT + SUMINV-EXTD-AMT.         21470092
W25248/                                                                 21480092
W25248*----------------------------------------------------------------*21490092
W25248*    NOW, GET THE ROW FROM TSUMINV                               *21500092
W25248*----------------------------------------------------------------*21510092
W25248                                                                  21520092
W25248 4180-GET-FROM-TSUMINV.                                           21530092
W25248                                                                  21540092
W26600     MOVE ASC-STORE-NBR            TO  PV-STORE-NBR-X.            21550092
W26600     MOVE PV-STORE-NBR-9           TO  ADJDTL-LOC-NBR.            21560092
W26600                                                                  21570092
W25248     MOVE ASC-UPC-NUM TO PV-HOLD-UPC.                             21580092
W25248     MOVE ASC-SKU-NUM TO PV-HOLD-SKU.                             21590092
W25248                                                                  21600092
W25248     EXEC SQL                                                     21610092
W25248          SELECT  INV_QTY                                         21620092
W25248               ,  DKEY_NBR                                        21630092
W25248               ,  EXTD_AMT                                        21640092
W25248            INTO  :SUMINV-INV-QTY                                 21650092
W25248               ,  :SUMINV-DKEY-NBR                                21660092
W25248               ,  :SUMINV-EXTD-AMT                                21670092
W25248            FROM  TSUMINV                                         21680092
W26600           WHERE  LOC_NBR       =  :ADJDTL-LOC-NBR                21690092
W25248             AND  AREA_NBR        =  :ASC-AREA-NBR                21700092
W25248             AND  SKU_NBR         =  :PV-HOLD-SKU                 21710092
W25248             AND  UPC_NBR         =  :PV-HOLD-UPC                 21720092
W25248             AND  INV_UNIT_PR_AMT =  :ASC-PRICE                   21730092
W25248     END-EXEC.                                                    21740092
W25248                                                                  21750092
W25248     EVALUATE TRUE                                                21760092
W25248         WHEN SQLCODE = ZERO                                      21770092
W25248         WHEN SQLCODE = +100                                      21780092
W25248              CONTINUE                                            21790092
W25248         WHEN SQLCODE = -904                                      21800092
W25248         WHEN SQLCODE = -913                                      21810092
W25248              PERFORM 9900-SOFT-ABORT                             21820092
W25248         WHEN SQLWARN0 NOT = SPACES                               21830092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              21840092
W25248              MOVE '4180-GET-FROM-TSUMINV'                        21850092
W25248                                   TO DP013-PARAGRAPH             21860092
W25248              MOVE 'SELECT TSUMINV'                               21870092
W25248                                   TO DP013-MESSAGE-TEXT (1)      21880092
W25248              MOVE SQLCA           TO DP013-SQLCA                 21890092
W25248              MOVE 'TSUMINV'       TO DP013-DB2-TABLE-NAME (1)    21900092
W25248              SET DP013-DB2-ABEND                                 21910092
W25248                  DP013-XCTL-DISPLAY-RESTART                      21920092
W25248                                   TO TRUE                        21930092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    21940092
W25248     END-EVALUATE.                                                21950092
W25248                                                                  21960092
W25248     MOVE ASC-PRICE              TO  ASC-ORIG-PRICE               21970092
W25248                                     ASC-TOT-PRICE.               21980092
W25248     MOVE SUMINV-INV-QTY         TO  ASC-ORIG-QTY                 21990092
W25248                                     ASC-TOT-QTY.                 22000092
W25248     MOVE SUMINV-EXTD-AMT        TO  ASC-ORIG-EXT-PRICE           22010092
W25248                                     ASC-TOT-EXT-PRICE.           22020092
W25248     MOVE SUMINV-DKEY-NBR        TO  ASC-DKEY-NBR.                22030092
W25248                                                                  22040092
184200*----------------------------------------------------------------*22050092
184300*    RETRIEVE THE ROWS FROM THE ADJUSTMENT ADD TABLE.            *22060092
184400*----------------------------------------------------------------*22070092
184500                                                                  22080092
184600 4200-GET-FROM-TADJADD.                                           22090092
W25248*                                                                 22100092
W26600     MOVE ASC-STORE-NBR              TO PV-STORE-NBR-X.           22110092
W26600     MOVE PV-STORE-NBR-9             TO ADJADD-LOC-NBR.           22120092
W21732     MOVE ASC-AREA-NBR               TO ADJADD-AREA-NBR.          22130092
W21732*    MOVE ASC-SKU-NBR                TO PV-SKU.                   22140092
W21732*    MOVE PV-SKU                     TO ADJADD-SKU-NBR.           22150092
W21732     MOVE ASC-PRICE                  TO ADJADD-ADJ-UNIT-PR-AMT.   22160092
W25248*                                                                 22170092
W25248     IF ASC-UPC > 0                                               22180092
W25248         SET PS-UPC-ENTERED          TO TRUE                      22190092
W25248         PERFORM 3075-PROCESS-UPC                                 22200092
W25248         MOVE UPC-UPC-NBR            TO ADJADD-UPC-NBR            22210092
W25248         MOVE PV-HOLD-SKU            TO ADJADD-SKU-NBR            22220092
W25248     ELSE                                                         22230092
W25248         SET PS-SKU-ENTERED          TO TRUE                      22240092
W25248         MOVE ASC-SKU                TO PV-SKU                    22250092
W25248         MOVE PV-SKU                 TO ADJADD-SKU-NBR            22260092
W25248         MOVE ZEROES                 TO ADJADD-UPC-NBR            22270092
W25248     END-IF.                                                      22280092
W25248                                                                  22290092
184800     EXEC SQL                                                     22300092
184900          SELECT                                                  22310092
185000                  ADJ_UNIT_PR_AMT                                 22320092
185100               ,  ADJ_QTY                                         22330092
185200               ,  ADJ_EXTD_AMT                                    22340092
185300               ,  DKEY_NBR                                        22350092
185400               ,  ADJ_RSN_TXT                                     22360092
185500          INTO                                                    22370092
185600                 :ADJADD-ADJ-UNIT-PR-AMT                          22380092
185700               , :ADJADD-ADJ-QTY                                  22390092
185800               , :ADJADD-ADJ-EXTD-AMT                             22400092
185900               , :ADJADD-DKEY-NBR                                 22410092
186000               , :ADJADD-ADJ-RSN-TXT                              22420092
186100          FROM                                                    22430092
186200                  TADJADD                                         22440092
186300          WHERE                                                   22450092
W26600                  LOC_NBR          =  :ADJADD-LOC-NBR             22460092
W21732            AND   AREA_NBR           =  :ADJADD-AREA-NBR          22470092
W21732            AND   SKU_NBR            =  :ADJADD-SKU-NBR           22480092
R26682            AND   UPC_NBR            =  :ADJADD-UPC-NBR           22490092
W21732            AND   ADJ_UNIT_PR_AMT    =  :ADJADD-ADJ-UNIT-PR-AMT   22500092
187000     END-EXEC.                                                    22510092
187100                                                                  22520092
187200     EVALUATE TRUE                                                22530092
187300         WHEN SQLCODE = ZERO                                      22540092
187400         WHEN SQLCODE = +100                                      22550092
187500              CONTINUE                                            22560092
187600         WHEN SQLCODE = -904                                      22570092
187700         WHEN SQLCODE = -913                                      22580092
187800              PERFORM 9900-SOFT-ABORT                             22590092
187900         WHEN SQLWARN0 NOT = SPACES                               22600092
188000         WHEN SQLCODE NOT EQUAL ZERO                              22610092
188100              MOVE '4200-GET-FROM-TADJADD'                        22620092
188200                                   TO DP013-PARAGRAPH             22630092
188300              MOVE 'SELECT TADJADD'                               22640092
188400                                   TO DP013-MESSAGE-TEXT (1)      22650092
188500              MOVE SQLCA           TO DP013-SQLCA                 22660092
188600              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    22670092
188700              SET DP013-DB2-ABEND                                 22680092
188800                  DP013-XCTL-DISPLAY-RESTART                      22690092
188900                                   TO TRUE                        22700092
189000              PERFORM DP013-0000-PROCESS-ABEND                    22710092
189100     END-EVALUATE.                                                22720092
189200                                                                  22730092
189300     IF  SQLCODE EQUAL ZERO                                       22740092
189400         MOVE ADJADD-ADJ-UNIT-PR-AMT TO  ASC-ORIG-PRICE           22750092
189500                                         ASC-TOT-PRICE            22760092
189600         MOVE ADJADD-ADJ-QTY         TO  ASC-ORIG-QTY             22770092
189700                                         ASC-TOT-QTY              22780092
189800         MOVE ADJADD-ADJ-EXTD-AMT    TO  ASC-ORIG-EXT-PRICE       22790092
189900                                         ASC-TOT-EXT-PRICE        22800092
190000         MOVE ADJADD-DKEY-NBR        TO  ASC-DKEY-NBR             22810092
190100         MOVE ADJADD-ADJ-RSN-TXT     TO  ASC-ORIG-REASON          22820092
190200     END-IF.                                                      22830092
190300                                                                  22840092
X25248/----------------------------------------------------------------*22850092
 |    * 4202-GET-FROM-TADJADD.                                          22860092
 |    *    RETRIEVE THE ROWS FROM THE ADJUSTMENT ADD TABLE.            *22870092
 |    *----------------------------------------------------------------*22880092
 |     4202-GET-FROM-TADJADD.                                           22890092
X25248                                                                  22900092
W26600     MOVE ASC-STORE-NBR              TO PV-STORE-NBR-X.           22910092
W26600     MOVE PV-STORE-NBR-9             TO ADJADD-LOC-NBR.           22920092
X25248     MOVE ASC-AREA-NBR               TO ADJADD-AREA-NBR.          22930092
X25248     MOVE ASC-SKU                    TO PV-SKU.                   22940092
X25248     MOVE PV-SKU                     TO ADJADD-SKU-NBR.           22950092
R26682     MOVE ASC-UPC                    TO PV-UPC.                   22960092
R26682     MOVE PV-UPC                     TO ADJADD-UPC-NBR.           22970092
X25248     MOVE ASC-PRICE                  TO ADJADD-ADJ-UNIT-PR-AMT.   22980092
 |    *                                                                 22990092
 |         EXEC SQL                                                     23000092
 |              SELECT                                                  23010092
 |                      ADJ_UNIT_PR_AMT                                 23020092
 |                   ,  ADJ_QTY                                         23030092
 |                   ,  ADJ_EXTD_AMT                                    23040092
 |                   ,  DKEY_NBR                                        23050092
 |                   ,  ADJ_RSN_TXT                                     23060092
 |              INTO                                                    23070092
 |                     :ADJADD-ADJ-UNIT-PR-AMT                          23080092
 |                   , :ADJADD-ADJ-QTY                                  23090092
 |                   , :ADJADD-ADJ-EXTD-AMT                             23100092
 |                   , :ADJADD-DKEY-NBR                                 23110092
 |                   , :ADJADD-ADJ-RSN-TXT                              23120092
 |              FROM                                                    23130092
 |                      TADJADD                                         23140092
X25248          WHERE                                                   23150092
W26600                  LOC_NBR          =  :ADJADD-LOC-NBR             23160092
X25248            AND   AREA_NBR           =  :ADJADD-AREA-NBR          23170092
X25248            AND   SKU_NBR            =  :ADJADD-SKU-NBR           23180092
R26682            AND   UPC_NBR            =  :ADJADD-UPC-NBR           23190092
X25248            AND   ADJ_UNIT_PR_AMT    =  :ADJADD-ADJ-UNIT-PR-AMT   23200092
 |         END-EXEC.                                                    23210092
 |                                                                      23220092
 |         EVALUATE TRUE                                                23230092
 |             WHEN SQLCODE = ZERO                                      23240092
 |             WHEN SQLCODE = +100                                      23250092
 |                  CONTINUE                                            23260092
 |             WHEN SQLCODE = -904                                      23270092
 |             WHEN SQLCODE = -913                                      23280092
 |                  PERFORM 9900-SOFT-ABORT                             23290092
 |             WHEN SQLWARN0 NOT = SPACES                               23300092
 |             WHEN SQLCODE NOT EQUAL ZERO                              23310092
 |                  MOVE '4202-GET-FROM-TADJADD'                        23320092
 |                                       TO DP013-PARAGRAPH             23330092
 |                  MOVE 'SELECT TADJADD'                               23340092
 |                                       TO DP013-MESSAGE-TEXT (1)      23350092
 |                  MOVE SQLCA           TO DP013-SQLCA                 23360092
 |                  MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    23370092
 |                  SET DP013-DB2-ABEND                                 23380092
 |                      DP013-XCTL-DISPLAY-RESTART                      23390092
 |                                       TO TRUE                        23400092
 |                  PERFORM DP013-0000-PROCESS-ABEND                    23410092
 |         END-EVALUATE.                                                23420092
 |                                                                      23430092
 |         IF  SQLCODE EQUAL ZERO                                       23440092
 |             MOVE ADJADD-ADJ-UNIT-PR-AMT TO  ASC-ORIG-PRICE           23450092
 |                                             ASC-TOT-PRICE            23460092
 |             MOVE ADJADD-ADJ-QTY         TO  ASC-ORIG-QTY             23470092
 |                                             ASC-TOT-QTY              23480092
 |             MOVE ADJADD-ADJ-EXTD-AMT    TO  ASC-ORIG-EXT-PRICE       23490092
 |                                             ASC-TOT-EXT-PRICE        23500092
 |             MOVE ADJADD-DKEY-NBR        TO  ASC-DKEY-NBR             23510092
 |             MOVE ADJADD-ADJ-RSN-TXT     TO  ASC-ORIG-REASON          23520092
 |         END-IF.                                                      23530092
X25248                                                                  23540092
W25248/----------------------------------------------------------------*23550092
W25248*    RETRIEVE THE ROWS FROM THE ADJUSTMENT ADD TABLE.            *23560092
W25248*----------------------------------------------------------------*23570092
W25248                                                                  23580092
W25248 4220-GET-FROM-TADJADD.                                           23590092
W25248                                                                  23600092
W26600     MOVE ASC-STORE-NBR              TO PV-STORE-NBR-X.           23610092
W26600     MOVE PV-STORE-NBR-9             TO ADJADD-LOC-NBR.           23620092
W25248     MOVE ASC-AREA-NBR               TO ADJADD-AREA-NBR.          23630092
W25248     MOVE ASC-PRICE                  TO ADJADD-ADJ-UNIT-PR-AMT.   23640092
W25248                                                                  23650092
W25248     MOVE ASC-SKU                    TO PV-HOLD-SKU.              23660092
W25248     MOVE PV-HOLD-SKU                TO ADJADD-SKU-NBR.           23670092
W25248                                                                  23680092
W25248     PERFORM 4230-OPEN-ADD-CSR.                                   23690092
W25248     PERFORM 4240-RETRIEVE-ADD-ROWS.                              23700092
W25248     PERFORM 4260-CLOSE-ADD-CSR.                                  23710092
W25248                                                                  23720092
W25248*----------------------------------------------------------------*23730092
W25248*    OPEN THE ADJADD CURSOR.                                     *23740092
W25248*----------------------------------------------------------------*23750092
192200                                                                  23760092
W25248 4230-OPEN-ADD-CSR.                                               23770092
W25248                                                                  23780092
W26600     MOVE ASC-STORE-NBR       TO PV-STORE-NBR-X.                  23790092
W26600     MOVE PV-STORE-NBR-9      TO ADJADD-LOC-NBR.                  23800092
W26600                                                                  23810092
W25248     EXEC SQL                                                     23820092
W25248          OPEN ADJADD-CSR                                         23830092
W25248     END-EXEC.                                                    23840092
W25248                                                                  23850092
W25248     EVALUATE TRUE                                                23860092
W25248         WHEN SQLCODE = ZERO                                      23870092
W25248         WHEN SQLCODE = +100                                      23880092
W25248              CONTINUE                                            23890092
W25248         WHEN SQLCODE = -904                                      23900092
W25248         WHEN SQLCODE = -913                                      23910092
W25248              PERFORM 9900-SOFT-ABORT                             23920092
W25248         WHEN SQLWARN0 NOT = SPACES                               23930092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              23940092
W25248              MOVE '4230-OPEN-ADD-CSR'                            23950092
W25248                                   TO DP013-PARAGRAPH             23960092
W25248              MOVE 'OPEN ADJADD CURSOR'                           23970092
W25248                                   TO DP013-MESSAGE-TEXT (1)      23980092
W25248              MOVE SQLCA           TO DP013-SQLCA                 23990092
W25248              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    24000092
W25248              SET DP013-DB2-ABEND                                 24010092
W25248                  DP013-XCTL-DISPLAY-RESTART                      24020092
W25248                                   TO TRUE                        24030092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    24040092
W25248     END-EVALUATE.                                                24050092
W25248                                                                  24060092
W25248*----------------------------------------------------------------*24070092
W25248*    NOW, FETCH THE ROWS AND LOAD THE ASC.                       *24080092
W25248*----------------------------------------------------------------*24090092
W25248                                                                  24100092
W25248 4240-RETRIEVE-ADD-ROWS.                                          24110092
W25248                                                                  24120092
W25248     MOVE ZEROES TO PA-INV-QTY                                    24130092
W25248                    PA-EXTD-AMT.                                  24140092
W25248                                                                  24150092
W25248     MOVE 'N' TO PS-ADJADD-CSR-SW.                                24160092
W25248                                                                  24170092
W25248     MOVE ASC-SKU-NUM TO PV-HOLD-SKU.                             24180092
W25248                                                                  24190092
W25248     PERFORM 4250-FETCH-ADD-CSR                                   24200092
W25248         UNTIL PS-EOF-ADJADD-CSR.                                 24210092
W25248                                                                  24220092
W25248     MOVE ADJADD-ADJ-UNIT-PR-AMT TO  ASC-ORIG-PRICE               24230092
W25248                                     ASC-TOT-PRICE.               24240092
W25248     MOVE PA-INV-QTY             TO  ASC-ORIG-QTY                 24250092
W25248                                     ASC-TOT-QTY.                 24260092
W25248     MOVE PA-EXTD-AMT            TO  ASC-ORIG-EXT-PRICE           24270092
W25248                                     ASC-TOT-EXT-PRICE.           24280092
W25248     MOVE ADJADD-DKEY-NBR        TO  ASC-DKEY-NBR.                24290092
R25248     MOVE ADJADD-ADJ-RSN-TXT     TO  ASC-ORIG-REASON.             24300092
W25248                                                                  24310092
W25248*----------------------------------------------------------------*24320092
W25248*    FETCH A ROW FROM THE ADJADD CURSOR.                         *24330092
W25248*----------------------------------------------------------------*24340092
W25248                                                                  24350092
W25248 4250-FETCH-ADD-CSR.                                              24360092
W25248                                                                  24370092
W25248     EXEC SQL                                                     24380092
W25248          FETCH                                                   24390092
W25248                  ADJADD-CSR                                      24400092
W25248          INTO                                                    24410092
W25248                 :ADJADD-UPC-NBR                                  24420092
W25248               , :ADJADD-ADJ-UNIT-PR-AMT                          24430092
W25248               , :ADJADD-ADJ-QTY                                  24440092
W25248               , :ADJADD-ADJ-EXTD-AMT                             24450092
W25248               , :ADJADD-DKEY-NBR                                 24460092
W25248               , :ADJADD-ADJ-RSN-TXT                              24470092
W25248     END-EXEC.                                                    24480092
W25248                                                                  24490092
W25248     EVALUATE TRUE                                                24500092
W25248         WHEN SQLCODE = ZERO                                      24510092
W25248             PERFORM 4270-PROCESS-ADD-ROWS                        24520092
W25248         WHEN SQLCODE = +100                                      24530092
W25248              SET PS-EOF-ADJADD-CSR TO TRUE                       24540092
W25248         WHEN SQLCODE = -904                                      24550092
W25248         WHEN SQLCODE = -913                                      24560092
W25248              PERFORM 9900-SOFT-ABORT                             24570092
W25248         WHEN SQLWARN0 NOT = SPACES                               24580092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              24590092
W25248              MOVE '4250-FETCH-ADD-CSR'                           24600092
W25248                                   TO DP013-PARAGRAPH             24610092
W25248              MOVE 'FETCH ADJADD CURSOR'                          24620092
W25248                                   TO DP013-MESSAGE-TEXT (1)      24630092
W25248              MOVE SQLCA           TO DP013-SQLCA                 24640092
W25248              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    24650092
W25248              SET DP013-DB2-ABEND                                 24660092
W25248                  DP013-XCTL-DISPLAY-RESTART                      24670092
W25248                                   TO TRUE                        24680092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    24690092
W25248     END-EVALUATE.                                                24700092
W25248                                                                  24710092
W25248*----------------------------------------------------------------*24720092
W25248*    CLOSE THE ADJADD CURSOR.                                    *24730092
W25248*----------------------------------------------------------------*24740092
W25248                                                                  24750092
W25248 4260-CLOSE-ADD-CSR.                                              24760092
W25248                                                                  24770092
W25248     EXEC SQL                                                     24780092
W25248          CLOSE ADJADD-CSR                                        24790092
W25248     END-EXEC.                                                    24800092
W25248                                                                  24810092
W25248     EVALUATE TRUE                                                24820092
W25248         WHEN SQLCODE = ZERO                                      24830092
W25248              CONTINUE                                            24840092
W25248         WHEN SQLCODE = -904                                      24850092
W25248         WHEN SQLCODE = -913                                      24860092
W25248              PERFORM 9900-SOFT-ABORT                             24870092
W25248         WHEN SQLWARN0 NOT = SPACES                               24880092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              24890092
W25248              MOVE '4260-CLOSE-ADD-CSR'                           24900092
W25248                                   TO DP013-PARAGRAPH             24910092
W25248              MOVE 'CLOSE ADJADD CURSOR'                          24920092
W25248                                   TO DP013-MESSAGE-TEXT (1)      24930092
W25248              MOVE SQLCA           TO DP013-SQLCA                 24940092
W25248              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    24950092
W25248              SET DP013-DB2-ABEND                                 24960092
W25248                  DP013-XCTL-DISPLAY-RESTART                      24970092
W25248                                   TO TRUE                        24980092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    24990092
W25248     END-EVALUATE.                                                25000092
W25248                                                                  25010092
W25248                                                                  25020092
190400*----------------------------------------------------------------*25030092
190500*    RETRIEVE THE ADJUSTMENT DETAIL ROWS.                        *25040092
190600*----------------------------------------------------------------*25050092
W25248 4270-PROCESS-ADD-ROWS.                                           25060092
W25248     MOVE ADJADD-UPC-NBR  TO ASC-UPC.                             25070092
W25248     MOVE ADJADD-DKEY-NBR TO ASC-DKEY-NBR.                        25080092
W25248                                                                  25090092
W25248     COMPUTE PA-INV-QTY  = PA-INV-QTY  + ADJADD-ADJ-QTY.          25100092
W25248     COMPUTE PA-EXTD-AMT = PA-EXTD-AMT + ADJADD-ADJ-EXTD-AMT.     25110092
W25248                                                                  25120092
W25248*----------------------------------------------------------------*25130092
W25248*    NOW, GET THE ROW FROM TADJADD                               *25140092
W25248*----------------------------------------------------------------*25150092
W25248                                                                  25160092
W25248 4280-GET-FROM-TADJADD.                                           25170092
W25248                                                                  25180092
W26600     MOVE ASC-STORE-NBR TO PV-STORE-NBR-X.                        25190092
W26600     MOVE PV-STORE-NBR-9 TO ADJADD-LOC-NBR.                       25200092
W26600     MOVE ASC-AREA-NBR  TO ADJADD-AREA-NBR.                       25210092
W25248     MOVE ASC-UPC-NUM TO PV-HOLD-UPC.                             25220092
W25248     MOVE ASC-SKU-NUM TO PV-HOLD-SKU.                             25230092
W25248                                                                  25240092
W25248     EXEC SQL                                                     25250092
W25248          SELECT  ADJ_QTY                                         25260092
W25248               ,  DKEY_NBR                                        25270092
W25248               ,  ADJ_EXTD_AMT                                    25280092
R25248               ,  ADJ_RSN_TXT                                     25290092
W25248            INTO  :ADJADD-ADJ-QTY                                 25300092
W25248               ,  :ADJADD-DKEY-NBR                                25310092
W25248               ,  :ADJADD-ADJ-EXTD-AMT                            25320092
R25248               ,  :ADJADD-ADJ-RSN-TXT                             25330092
W25248            FROM  TADJADD                                         25340092
W26600           WHERE  LOC_NBR         =  :ADJADD-LOC-NBR              25350092
W26600             AND  AREA_NBR        =  :ADJADD-AREA-NBR             25360092
W25248             AND  SKU_NBR         =  :PV-HOLD-SKU                 25370092
W25248             AND  UPC_NBR         =  :PV-HOLD-UPC                 25380092
W25248             AND  ADJ_UNIT_PR_AMT =  :ASC-PRICE                   25390092
W25248     END-EXEC.                                                    25400092
W25248                                                                  25410092
W25248     EVALUATE TRUE                                                25420092
W25248         WHEN SQLCODE = ZERO                                      25430092
W25248         WHEN SQLCODE = +100                                      25440092
W25248              CONTINUE                                            25450092
W25248         WHEN SQLCODE = -904                                      25460092
W25248         WHEN SQLCODE = -913                                      25470092
W25248              PERFORM 9900-SOFT-ABORT                             25480092
W25248         WHEN SQLWARN0 NOT = SPACES                               25490092
W25248         WHEN SQLCODE NOT EQUAL ZERO                              25500092
W25248              MOVE '4280-GET-FROM-TADJADD'                        25510092
W25248                                   TO DP013-PARAGRAPH             25520092
W25248              MOVE 'SELECT TADJADD'                               25530092
W25248                                   TO DP013-MESSAGE-TEXT (1)      25540092
W25248              MOVE SQLCA           TO DP013-SQLCA                 25550092
W25248              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    25560092
W25248              SET DP013-DB2-ABEND                                 25570092
W25248                  DP013-XCTL-DISPLAY-RESTART                      25580092
W25248                                   TO TRUE                        25590092
W25248              PERFORM DP013-0000-PROCESS-ABEND                    25600092
W25248     END-EVALUATE.                                                25610092
W25248                                                                  25620092
W25248     MOVE ASC-PRICE              TO  ASC-ORIG-PRICE               25630092
W25248                                     ASC-TOT-PRICE.               25640092
W25248     MOVE ADJADD-ADJ-QTY         TO  ASC-ORIG-QTY                 25650092
W25248                                     ASC-TOT-QTY.                 25660092
W25248     MOVE ADJADD-ADJ-EXTD-AMT    TO  ASC-ORIG-EXT-PRICE           25670092
W25248                                     ASC-TOT-EXT-PRICE.           25680092
W25248     MOVE ADJADD-DKEY-NBR        TO  ASC-DKEY-NBR.                25690092
R25248     MOVE ADJADD-ADJ-RSN-TXT     TO  ASC-ORIG-REASON.             25700092
W25248                                                                  25710092
190400/----------------------------------------------------------------*25720092
190500*    RETRIEVE THE ADJUSTMENT DETAIL ROWS.                        *25730092
190600*----------------------------------------------------------------*25740092
190700                                                                  25750092
190800 4300-GET-TADJDTL.                                                25760092
190900                                                                  25770092
W26600     MOVE ASC-STORE-NBR       TO  PV-STORE-NBR-X.                 25780092
W26600     MOVE PV-STORE-NBR-9      TO  ADJDTL-LOC-NBR.                 25790092
W26600                                                                  25800092
R26600     MOVE ASC-SKU-NUM         TO PV-HOLD-SKU.                     25810092
R26600     MOVE PV-HOLD-SKU         TO ADJDTL-SKU-NBR.                  25820092
R26600                                                                  25830092
R26600     MOVE ASC-UPC-NUM         TO PV-HOLD-UPC.                     25840092
R26600     MOVE PV-HOLD-UPC         TO ADJDTL-UPC-NBR.                  25850092
R26600                                                                  25860092
191000     PERFORM 4310-OPEN-ADJ-CSR.                                   25870092
191100     IF  SQLCODE EQUAL ZERO                                       25880092
191200         PERFORM 4320-RETRIEVE-ADJ-ROWS                           25890092
191300                 UNTIL SQLCODE NOT EQUAL ZERO                     25900092
191400         IF  SQLCODE EQUAL ZERO OR +100                           25910092
191500             PERFORM 4340-CLOSE-ADJ-CSR                           25920092
191600         END-IF                                                   25930092
191700     END-IF.                                                      25940092
191800                                                                  25950092
191900*----------------------------------------------------------------*25960092
192000*    OPEN THE ADJDTL CURSOR.                                     *25970092
192100*----------------------------------------------------------------*25980092
192200                                                                  25990092
192300 4310-OPEN-ADJ-CSR.                                               26000092
192400                                                                  26010092
192500     EXEC SQL                                                     26020092
192600          OPEN ADJ-CSR                                            26030092
192700     END-EXEC.                                                    26040092
192800                                                                  26050092
192900     EVALUATE TRUE                                                26060092
193000         WHEN SQLCODE = ZERO                                      26070092
193100         WHEN SQLCODE = +100                                      26080092
193200              CONTINUE                                            26090092
193300         WHEN SQLCODE = -904                                      26100092
193400         WHEN SQLCODE = -913                                      26110092
193500              PERFORM 9900-SOFT-ABORT                             26120092
193600         WHEN SQLWARN0 NOT = SPACES                               26130092
193700         WHEN SQLCODE NOT EQUAL ZERO                              26140092
193800              MOVE '4310-OPEN-ADJ-CSR'                            26150092
193900                                   TO DP013-PARAGRAPH             26160092
194000              MOVE 'OPEN ADJADD CURSOR'                           26170092
194100                                   TO DP013-MESSAGE-TEXT (1)      26180092
194200              MOVE SQLCA           TO DP013-SQLCA                 26190092
194300              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    26200092
194400              SET DP013-DB2-ABEND                                 26210092
194500                  DP013-XCTL-DISPLAY-RESTART                      26220092
194600                                   TO TRUE                        26230092
194700              PERFORM DP013-0000-PROCESS-ABEND                    26240092
194800     END-EVALUATE.                                                26250092
194900                                                                  26260092
195000*----------------------------------------------------------------*26270092
195100*    NOW, FETCH THE ROWS AND LOAD THE ASC.                       *26280092
195200*----------------------------------------------------------------*26290092
195300                                                                  26300092
195400 4320-RETRIEVE-ADJ-ROWS.                                          26310092
195500                                                                  26320092
195600     PERFORM 4330-FETCH-ADJ-CSR.                                  26330092
195700     IF  SQLCODE EQUAL ZERO                                       26340092
195800         PERFORM 4350-LOAD-ASC                                    26350092
195900     END-IF.                                                      26360092
196000                                                                  26370092
196100*----------------------------------------------------------------*26380092
196200*    FETCH A ROW FROM THE ADJADD CURSOR.                         *26390092
196300*----------------------------------------------------------------*26400092
196400                                                                  26410092
196500 4330-FETCH-ADJ-CSR.                                              26420092
196600                                                                  26430092
196700     EXEC SQL                                                     26440092
196800          FETCH                                                   26450092
196900                  ADJ-CSR                                         26460092
197000          INTO                                                    26470092
197100                 :ADJDTL-ADJ-UNIT-PR-AMT                          26480092
197200               , :ADJDTL-ADJ-QTY                                  26490092
197300               , :ADJDTL-ADJ-EXTD-AMT                             26500092
197400               , :ADJDTL-ADJ-RSN-TXT                              26510092
197500               , :ADJDTL-CRE-TMST                                 26520092
197600               , :ADJDTL-CRE-ID-NBR                               26530092
197700     END-EXEC.                                                    26540092
197800                                                                  26550092
197900     EVALUATE TRUE                                                26560092
198000         WHEN SQLCODE = ZERO                                      26570092
198100         WHEN SQLCODE = +100                                      26580092
198200              CONTINUE                                            26590092
198300         WHEN SQLCODE = -904                                      26600092
198400         WHEN SQLCODE = -913                                      26610092
198500              PERFORM 9900-SOFT-ABORT                             26620092
198600         WHEN SQLWARN0 NOT = SPACES                               26630092
198700         WHEN SQLCODE NOT EQUAL ZERO                              26640092
198800              MOVE '4330-FETCH-ADJ-CSR'                           26650092
198900                                   TO DP013-PARAGRAPH             26660092
199000              MOVE 'FETCH ADJADD CURSOR'                          26670092
199100                                   TO DP013-MESSAGE-TEXT (1)      26680092
199200              MOVE SQLCA           TO DP013-SQLCA                 26690092
199300              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    26700092
199400              SET DP013-DB2-ABEND                                 26710092
199500                  DP013-XCTL-DISPLAY-RESTART                      26720092
199600                                   TO TRUE                        26730092
199700              PERFORM DP013-0000-PROCESS-ABEND                    26740092
199800     END-EVALUATE.                                                26750092
199900                                                                  26760092
200000*----------------------------------------------------------------*26770092
200100*    CLOSE THE ADJADD CURSOR.                                    *26780092
200200*----------------------------------------------------------------*26790092
200300                                                                  26800092
200400 4340-CLOSE-ADJ-CSR.                                              26810092
200500                                                                  26820092
200600     EXEC SQL                                                     26830092
200700          CLOSE ADJ-CSR                                           26840092
200800     END-EXEC.                                                    26850092
200900                                                                  26860092
201000     EVALUATE TRUE                                                26870092
201100         WHEN SQLCODE = ZERO                                      26880092
201200              CONTINUE                                            26890092
201300         WHEN SQLCODE = -904                                      26900092
201400         WHEN SQLCODE = -913                                      26910092
201500              PERFORM 9900-SOFT-ABORT                             26920092
201600         WHEN SQLWARN0 NOT = SPACES                               26930092
201700         WHEN SQLCODE NOT EQUAL ZERO                              26940092
201800              MOVE '4340-CLOSE-ADJ-CSR'                           26950092
201900                                   TO DP013-PARAGRAPH             26960092
202000              MOVE 'CLOSE ADJADD CURSOR'                          26970092
202100                                   TO DP013-MESSAGE-TEXT (1)      26980092
202200              MOVE SQLCA           TO DP013-SQLCA                 26990092
202300              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    27000092
202400              SET DP013-DB2-ABEND                                 27010092
202500                  DP013-XCTL-DISPLAY-RESTART                      27020092
202600                                   TO TRUE                        27030092
202700              PERFORM DP013-0000-PROCESS-ABEND                    27040092
202800     END-EVALUATE.                                                27050092
202900                                                                  27060092
203000/                                                                 27070092
203100*----------------------------------------------------------------*27080092
203200*    MOVE THE DATA FROM THE HOST VARIALBES TO THE ASC.           *27090092
203300*----------------------------------------------------------------*27100092
203400                                                                  27110092
203500 4350-LOAD-ASC.                                                   27120092
203600                                                                  27130092
203700     ADD 1                       TO  ASC-MAP-SUB.                 27140092
203800     IF  ASC-MAP-SUB GREATER THAN 5                               27150092
203900         MOVE PC-TSYMSG-00698    TO  DP020-MSG-NUMBER             27160092
204000         SET ASC-NO-ADJUSTMENTS-ALLOWED                           27170092
204100             DP030-SET-CURSOR-TRAILER                             27180092
204200             DP020-MSG-FATAL                                      27190092
204300             PS-ERROR            TO  TRUE                         27200092
204400         MOVE 6                  TO  ASC-MAP-SUB                  27210092
204500     END-IF.                                                      27220092
204600                                                                  27230092
204700     MOVE ADJDTL-CRE-TMST       TO  PV-WORK-TMST.                 27240092
204800     MOVE PV-WT-YY              TO  PV-DD-YY.                     27250092
204900     MOVE PV-WT-MM              TO  PV-DD-MM.                     27260092
205000     MOVE PV-WT-DD              TO  PV-DD-DD.                     27270092
205100     MOVE PV-DISPLAY-DATE       TO  ASC-MAP-ADJ-DATE (ASC-MAP-SUB)27280092
205200                                                                  27290092
205300     MOVE ADJDTL-ADJ-UNIT-PR-AMT                                  27300092
205400                                TO  ASC-MAP-ADJ-PRICE(ASC-MAP-SUB)27310092
205500     MOVE ADJDTL-ADJ-QTY        TO  ASC-MAP-ADJ-QTY  (ASC-MAP-SUB)27320092
205600     MOVE ADJDTL-CRE-ID-NBR     TO  ASC-MAP-USERID   (ASC-MAP-SUB)27330092
205700     MOVE ADJDTL-ADJ-EXTD-AMT                                     27340092
205800                                TO  ASC-MAP-ADJ-EXT-PRICE         27350092
205900                                                     (ASC-MAP-SUB)27360092
206000     MOVE ADJDTL-ADJ-RSN-TXT    TO  ASC-MAP-REASON   (ASC-MAP-SUB)27370092
206100                                                                  27380092
206200     ADD ADJDTL-ADJ-QTY         TO  ASC-TOT-QTY.                  27390092
206300     ADD ADJDTL-ADJ-UNIT-PR-AMT                                   27400092
206400                                TO  ASC-TOT-PRICE.                27410092
206500     ADD ADJDTL-ADJ-EXTD-AMT    TO  ASC-TOT-EXT-PRICE.            27420092
206600/                                                                 27430092
206700*----------------------------------------------------------------*27440092
206800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *27450092
206900*----------------------------------------------------------------*27460092
207000                                                                  27470092
207100 4400-MOVE-COMMAREA-TO-SCREEN.                                    27480092
207200                                                                  27490092
W26600     MOVE IN001-STORE-NBR          TO  ASTRNBRO.                  27500092
207300     MOVE IN001-STORE-NAME         TO  ASTRNAMO.                  27510092
207400     MOVE ASC-AREA-NBR             TO  AAREAO.                    27520092
207500     MOVE ASC-NEW-REASON           TO  ANREASNO.                  27530092
207600                                                                  27540092
207700     IF  ASC-NEW-PRICE NUMERIC                                    27550092
207800         MOVE ASC-NEW-PRICE        TO  ANADJPRO                   27560092
207900     ELSE                                                         27570092
208000         MOVE ASC-NEW-PRICE-X      TO  ANADJPRO                   27580092
208100     END-IF.                                                      27590092
208200     IF ASC-NEW-QTY NUMERIC                                       27600092
208300         IF ASC-NEW-QTY NOT = ZERO                                27610092
208500             MOVE ASC-NEW-QTY          TO  PV-QTY-FORMAT          27620092
208600             MOVE PV-QTY-FORMAT        TO  ANADJQTO               27630092
208700         ELSE                                                     27640092
208800             IF ASC-NEW-QTY-X = SPACES                            27650092
208900                 MOVE ASC-NEW-QTY-X    TO  ANADJQTO               27660092
209000             ELSE                                                 27670092
209100                 MOVE ASC-NEW-QTY-X    TO  PV-QTY-FORMAT          27680092
209200                 MOVE PV-QTY-FORMAT    TO  ANADJQTO               27690092
209300             END-IF                                               27700092
209400         END-IF                                                   27710092
209500     ELSE                                                         27720092
209600         MOVE ASC-NEW-QTY-X        TO  ANADJQTO                   27730092
209700     END-IF.                                                      27740092
209800                                                                  27750092
209900     IF  ASC-ADD-NEW                                              27760092
W25248         MOVE ASC-SKU-NUM          TO  ANSKUO                     27770092
W21732         IF  ANSKUC  NOT EQUAL DP015-RED                          27780092
W21732             MOVE DP015-GREEN      TO  ANSKUC                     27790092
W21732             MOVE DP015-UNDERLINE  TO  ANSKUH                     27800092
W21732             MOVE DP015-UNP-ALP-NOR-OFF                           27810092
W21732                                   TO  ANSKUA                     27820092
211400             IF  PS-NO-ERROR                                      27830092
211500                 MOVE -1           TO  ANADJQTL                   27840092
211600             END-IF                                               27850092
211700         END-IF                                                   27860092
W25248                                                                  27870092
W25248         MOVE ASC-UPC-NUM          TO  ANUPCO                     27880092
W25248         IF  ANUPCC  NOT EQUAL DP015-RED                          27890092
W25248             MOVE DP015-GREEN      TO  ANUPCC                     27900092
W25248             MOVE DP015-UNDERLINE  TO  ANUPCH                     27910092
W25248             MOVE DP015-UNP-ALP-NOR-OFF                           27920092
W25248                                   TO  ANUPCA                     27930092
W25248             IF  PS-NO-ERROR                                      27940092
W25248                 MOVE -1           TO  ANADJQTL                   27950092
W25248             END-IF                                               27960092
W25248         END-IF                                                   27970092
211800     ELSE                                                         27980092
211900         PERFORM 4410-MOVE-REST                                   27990092
212000     END-IF.                                                      28000092
212100                                                                  28010092
212200*----------------------------------------------------------------*28020092
212300*    THERE IS DATA TO BE MOVED, SO MOVE IT.                      *28030092
212400*----------------------------------------------------------------*28040092
212500                                                                  28050092
212600 4410-MOVE-REST.                                                  28060092
212700                                                                  28070092
W21732*    MOVE ASC-SKU-NBR              TO  ASKUO.                     28080092
W25248     EVALUATE DP020-INT-APPL-FORMAT-IND                           28090092
W25248         WHEN PC-INTER-APPL-LIST                                  28100092
W25248              MOVE ASC-SKU         TO  ASKUO                      28110092
W25248         WHEN PC-INTER-APPL-DETAIL                                28120092
W25248              MOVE ASC-UPC-NUM     TO  ASKUO                      28130092
W25248     END-EVALUATE.                                                28140092
213100                                                                  28150092
213200     MOVE ASC-ORIG-QTY             TO  AQTYO.                     28160092
213300     MOVE ASC-ORIG-PRICE           TO  APRICEO.                   28170092
213400     MOVE ASC-ORIG-EXT-PRICE       TO  AEXTPRIO.                  28180092
213500     MOVE ASC-ORIG-REASON          TO  AREASONO.                  28190092
213600                                                                  28200092
213700     MOVE ASC-TOT-QTY              TO  ATOTQTYO.                  28210092
213800     MOVE ASC-TOT-PRICE            TO  ATOTPRIO.                  28220092
213900     MOVE ASC-TOT-EXT-PRICE        TO  ATOTEXTO.                  28230092
214000                                                                  28240092
214100     IF  PS-NO-ERROR                                              28250092
214200         IF  ASC-ADJUSTMENTS-ALLOWED                              28260092
214300             MOVE -1               TO  ANADJQTL                   28270092
214400         ELSE                                                     28280092
214500             SET DP030-SET-CURSOR-TRAILER                         28290092
214600                                   TO  TRUE                       28300092
214700         END-IF                                                   28310092
214800     END-IF.                                                      28320092
214900                                                                  28330092
215000     PERFORM VARYING ASC-MAP-SUB                                  28340092
215100         FROM 1 BY 1                                              28350092
215200         UNTIL ASC-MAP-SUB GREATER THAN 6                         28360092
215300                                                                  28370092
215400         IF  ASC-MAP-USERID(ASC-MAP-SUB) > SPACES                 28380092
215500             MOVE ASC-MAP-USERID       (ASC-MAP-SUB)              28390092
215600                                   TO  MR-USERIDO  (ASC-MAP-SUB)  28400092
215700             MOVE ASC-MAP-ADJ-DATE     (ASC-MAP-SUB)              28410092
215800                                   TO  MR-ADJ-DATEO (ASC-MAP-SUB) 28420092
215900             MOVE ASC-MAP-ADJ-QTY      (ASC-MAP-SUB)              28430092
216000                                   TO  MR-ADJ-QTYO  (ASC-MAP-SUB) 28440092
216100             MOVE ASC-MAP-ADJ-PRICE    (ASC-MAP-SUB)              28450092
216200                                   TO  MR-ADJ-PRICEO(ASC-MAP-SUB) 28460092
216300             MOVE ASC-MAP-ADJ-EXT-PRICE(ASC-MAP-SUB)              28470092
216400                                   TO  MR-EXT-PRICEO(ASC-MAP-SUB) 28480092
216500             MOVE ASC-MAP-REASON       (ASC-MAP-SUB)              28490092
216600                                   TO MR-ADJ-REASONO(ASC-MAP-SUB) 28500092
216700         ELSE                                                     28510092
216800             MOVE SPACES           TO  MR-USERIDO  (ASC-MAP-SUB)  28520092
216900                                       MR-ADJ-DATEO (ASC-MAP-SUB) 28530092
217000                                       MR-ADJ-QTYX  (ASC-MAP-SUB) 28540092
217100                                       MR-ADJ-PRICEX(ASC-MAP-SUB) 28550092
217200                                       MR-EXT-PRICEX(ASC-MAP-SUB) 28560092
217300                                      MR-ADJ-REASONO(ASC-MAP-SUB) 28570092
217400         END-IF                                                   28580092
217500     END-PERFORM.                                                 28590092
217600                                                                  28601099
R26600/*****************************************************************28610092
R26600* 4700-GET-TADJDTL-LIST.                                          28620092
R26600******************************************************************28630092
R26600 4700-GET-TADJDTL-LIST.                                           28640092
R26600                                                                  28650092
R26600     MOVE ASC-STORE-NBR       TO PV-STORE-NBR-X.                  28660092
R26600     MOVE PV-STORE-NBR-9      TO ADJDTL-LOC-NBR.                  28670092
R26600                                                                  28680092
R26600     MOVE ASC-SKU-NUM         TO PV-HOLD-SKU.                     28690092
R26600     MOVE PV-HOLD-SKU         TO ADJDTL-SKU-NBR.                  28700092
R26600                                                                  28710092
R26600     PERFORM 4710-OPEN-ADJ-CSR.                                   28720092
R26600                                                                  28730092
R26600     PERFORM 4720-RETRIEVE-ADJ-ROWS                               28740092
R26600        UNTIL SQLCODE NOT EQUAL ZERO.                             28750092
R26600                                                                  28760092
R26600     IF SQLCODE EQUAL ZERO OR +100                                28770092
R26600         PERFORM 4740-CLOSE-ADJ-CSR                               28780092
R26600     END-IF.                                                      28790092
R26600                                                                  28800092
R26600*----------------------------------------------------------------*28810092
R26600*    OPEN THE ADJDTL CURSOR.                                     *28820092
R26600*----------------------------------------------------------------*28830092
R26600                                                                  28840092
R26600 4710-OPEN-ADJ-CSR.                                               28850092
R26600                                                                  28860092
R26600     EXEC SQL                                                     28870092
R26600          OPEN ADJ-CSR2                                           28880092
R26600     END-EXEC.                                                    28890092
R26600                                                                  28900092
R26600     EVALUATE TRUE                                                28910092
R26600         WHEN SQLCODE = ZERO                                      28920092
R26600         WHEN SQLCODE = +100                                      28930092
R26600              CONTINUE                                            28940092
R26600         WHEN SQLCODE = -904                                      28950092
R26600         WHEN SQLCODE = -913                                      28960092
R26600              PERFORM 9900-SOFT-ABORT                             28970092
R26600         WHEN SQLWARN0 NOT = SPACES                               28980092
R26600         WHEN SQLCODE NOT EQUAL ZERO                              28990092
R26600              MOVE '4710-OPEN-ADJ-CSR'                            29000092
R26600                                   TO DP013-PARAGRAPH             29010092
R26600              MOVE 'OPEN ADJADD CURSOR2'                          29020092
R26600                                   TO DP013-MESSAGE-TEXT (1)      29030092
R26600              MOVE SQLCA           TO DP013-SQLCA                 29040092
R26600              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    29050092
R26600              SET DP013-DB2-ABEND                                 29060092
R26600                  DP013-XCTL-DISPLAY-RESTART                      29070092
R26600                                   TO TRUE                        29080092
R26600              PERFORM DP013-0000-PROCESS-ABEND                    29090092
R26600     END-EVALUATE.                                                29100092
R26600                                                                  29110092
R26600*----------------------------------------------------------------*29120092
R26600*    NOW, FETCH THE ROWS AND LOAD THE ASC.                       *29130092
R26600*----------------------------------------------------------------*29140092
R26600                                                                  29150092
R26600 4720-RETRIEVE-ADJ-ROWS.                                          29160092
R26600                                                                  29170092
R26600     PERFORM 4730-FETCH-ADJ-CSR.                                  29180092
R26600     IF  SQLCODE EQUAL ZERO                                       29190092
R26600         PERFORM 4750-LOAD-ASC                                    29200092
R26600     END-IF.                                                      29210092
R26600                                                                  29220092
R26600*----------------------------------------------------------------*29230092
R26600*    FETCH A ROW FROM THE ADJADD CURSOR.                         *29240092
R26600*----------------------------------------------------------------*29250092
R26600                                                                  29260092
R26600 4730-FETCH-ADJ-CSR.                                              29270092
R26600                                                                  29280092
R26600     EXEC SQL                                                     29290092
R26600          FETCH ADJ-CSR2                                          29300092
R26600          INTO   :ADJDTL-ADJ-UNIT-PR-AMT                          29310092
R26600               , :ADJDTL-ADJ-QTY                                  29320092
R26600               , :ADJDTL-ADJ-EXTD-AMT                             29330092
R26600               , :ADJDTL-ADJ-RSN-TXT                              29340092
R26600               , :ADJDTL-CRE-TMST                                 29350092
R26600               , :ADJDTL-CRE-ID-NBR                               29360092
R26600     END-EXEC.                                                    29370092
R26600                                                                  29380092
R26600     EVALUATE TRUE                                                29390092
R26600         WHEN SQLCODE = ZERO                                      29400092
R26600         WHEN SQLCODE = +100                                      29410092
R26600              CONTINUE                                            29420092
R26600         WHEN SQLCODE = -904                                      29430092
R26600         WHEN SQLCODE = -913                                      29440092
R26600              PERFORM 9900-SOFT-ABORT                             29450092
R26600         WHEN SQLWARN0 NOT = SPACES                               29460092
R26600         WHEN SQLCODE NOT EQUAL ZERO                              29470092
R26600              MOVE '4730-FETCH-ADJ-CSR'                           29480092
R26600                                   TO DP013-PARAGRAPH             29490092
R26600              MOVE 'FETCH ADJADD CURSOR2'                         29500092
R26600                                   TO DP013-MESSAGE-TEXT (1)      29510092
R26600              MOVE SQLCA           TO DP013-SQLCA                 29520092
R26600              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    29530092
R26600              SET DP013-DB2-ABEND                                 29540092
R26600                  DP013-XCTL-DISPLAY-RESTART                      29550092
R26600                                   TO TRUE                        29560092
R26600              PERFORM DP013-0000-PROCESS-ABEND                    29570092
R26600     END-EVALUATE.                                                29580092
R26600                                                                  29590092
R26600*----------------------------------------------------------------*29600092
R26600*    CLOSE THE ADJADD CURSOR.                                    *29610092
R26600*----------------------------------------------------------------*29620092
R26600                                                                  29630092
R26600 4740-CLOSE-ADJ-CSR.                                              29640092
R26600                                                                  29650092
R26600     EXEC SQL                                                     29660092
R26600          CLOSE ADJ-CSR2                                          29670092
R26600     END-EXEC.                                                    29680092
R26600                                                                  29690092
R26600     EVALUATE TRUE                                                29700092
R26600         WHEN SQLCODE = ZERO                                      29710092
R26600              CONTINUE                                            29720092
R26600         WHEN SQLCODE = -904                                      29730092
R26600         WHEN SQLCODE = -913                                      29740092
R26600              PERFORM 9900-SOFT-ABORT                             29750092
R26600         WHEN SQLWARN0 NOT = SPACES                               29760092
R26600         WHEN SQLCODE NOT EQUAL ZERO                              29770092
R26600              MOVE '4740-CLOSE-ADJ-CSR2'                          29780092
R26600                                   TO DP013-PARAGRAPH             29790092
R26600              MOVE 'CLOSE ADJADD CURSOR'                          29800092
R26600                                   TO DP013-MESSAGE-TEXT (1)      29810092
R26600              MOVE SQLCA           TO DP013-SQLCA                 29820092
R26600              MOVE 'TADJADD'       TO DP013-DB2-TABLE-NAME (1)    29830092
R26600              SET DP013-DB2-ABEND                                 29840092
R26600                  DP013-XCTL-DISPLAY-RESTART                      29850092
R26600                                   TO TRUE                        29860092
R26600              PERFORM DP013-0000-PROCESS-ABEND                    29870092
R26600     END-EVALUATE.                                                29880092
R26600                                                                  29890092
R26600*----------------------------------------------------------------*29900092
R26600*    MOVE THE DATA FROM THE HOST VARIALBES TO THE ASC.           *29910092
R26600*----------------------------------------------------------------*29920092
R26600                                                                  29930092
R26600 4750-LOAD-ASC.                                                   29940092
R26600                                                                  29950092
R26600     ADD 1                       TO  ASC-MAP-SUB.                 29960092
R26600     IF  ASC-MAP-SUB GREATER THAN 5                               29970092
R26600         MOVE PC-TSYMSG-00698    TO  DP020-MSG-NUMBER             29980092
R26600         SET ASC-NO-ADJUSTMENTS-ALLOWED                           29990092
R26600             DP030-SET-CURSOR-TRAILER                             30000092
R26600             DP020-MSG-FATAL                                      30010092
R26600             PS-ERROR            TO  TRUE                         30020092
R26600         MOVE 6                  TO  ASC-MAP-SUB                  30030092
R26600     END-IF.                                                      30040092
R26600                                                                  30050092
R26600     MOVE ADJDTL-CRE-TMST       TO  PV-WORK-TMST.                 30060092
R26600     MOVE PV-WT-YY              TO  PV-DD-YY.                     30070092
R26600     MOVE PV-WT-MM              TO  PV-DD-MM.                     30080092
R26600     MOVE PV-WT-DD              TO  PV-DD-DD.                     30090092
R26600     MOVE PV-DISPLAY-DATE       TO  ASC-MAP-ADJ-DATE (ASC-MAP-SUB)30100092
R26600                                                                  30110092
R26600     MOVE ADJDTL-ADJ-UNIT-PR-AMT                                  30120092
R26600                                TO  ASC-MAP-ADJ-PRICE(ASC-MAP-SUB)30130092
R26600     MOVE ADJDTL-ADJ-QTY        TO  ASC-MAP-ADJ-QTY  (ASC-MAP-SUB)30140092
R26600     MOVE ADJDTL-CRE-ID-NBR     TO  ASC-MAP-USERID   (ASC-MAP-SUB)30150092
R26600     MOVE ADJDTL-ADJ-EXTD-AMT                                     30160092
R26600                                TO  ASC-MAP-ADJ-EXT-PRICE         30170092
R26600                                                     (ASC-MAP-SUB)30180092
R26600     MOVE ADJDTL-ADJ-RSN-TXT    TO  ASC-MAP-REASON   (ASC-MAP-SUB)30190092
R26600                                                                  30200092
R26600     ADD ADJDTL-ADJ-QTY         TO  ASC-TOT-QTY.                  30210092
R26600     ADD ADJDTL-ADJ-UNIT-PR-AMT                                   30220092
R26600                                TO  ASC-TOT-PRICE.                30230092
R26600     ADD ADJDTL-ADJ-EXTD-AMT    TO  ASC-TOT-EXT-PRICE.            30240092
R26600                                                                  30250092
      /----------------------------------------------------------------*30260092
217800*    ENSURE DATA WAS ENTERED BEFORE UPDATING.                    *30270092
217900*----------------------------------------------------------------*30280092
218000                                                                  30290092
218100 5000-BEGIN-UPDATE-PROCESS.                                       30300092
218200                                                                  30310092
218300     IF  ASC-ADD-NEW                                              30320092
218400         PERFORM 5001-CONTINUE-UPDATE                             30330092
218500     ELSE                                                         30340092
218600         IF  ASC-NEW-PRICE GREATER THAN ZERO                      30350092
218700         OR  ASC-NEW-QTY   NOT EQUAL ZERO                         30360092
218800         OR (ASC-NEW-QTY       EQUAL ZERO AND                     30370092
218900             ASC-NEW-QTY-X NOT = SPACE)                           30380092
219000             PERFORM 5001-CONTINUE-UPDATE                         30390092
219100         ELSE                                                     30400092
219200             SET PS-ERROR            TO  TRUE                     30410092
219300             SET DP020-MSG-FATAL     TO  TRUE                     30420092
219400             IF  ASC-NO-ADJUSTMENTS-ALLOWED                       30430092
219500                 SET DP030-SET-CURSOR-TRAILER                     30440092
219600                                     TO  TRUE                     30450092
219700                 MOVE PC-TSYMSG-00698                             30460092
219800                                 TO  DP020-MSG-NUMBER             30470092
219900             ELSE                                                 30480092
220000                 MOVE -1             TO  ANADJQTL                 30490092
220100                 MOVE PC-TSYMSG-00046 TO DP020-MSG-NUMBER         30500092
220200             END-IF                                               30510092
220300         END-IF                                                   30520092
220400     END-IF.                                                      30530092
220500                                                                  30540092
220600/                                                                 30550092
220700*----------------------------------------------------------------*30560092
220800*    DETERMINE WHETHER THIS IS THE FIRST ADJUSTMENT FOR THIS     *30570092
220900*    SKU.  IF SO, ADD TO ADJADD, ELSE, ADD TO ADJDTL.            *30580092
221000*----------------------------------------------------------------*30590092
221100                                                                  30600092
221200 5001-CONTINUE-UPDATE.                                            30610092
221300                                                                  30620092
221400     IF  ASC-ADD-NEW                                              30630092
221500         PERFORM 5100-PREPARE-TADJADD-ROW                         30640092
221600         PERFORM 5110-INSERT-TADJADD-ROW                          30650092
221700     ELSE                                                         30660092
221800         PERFORM 5200-PREPARE-TADJDTL-ROW                         30670092
221900         PERFORM 5210-INSERT-TADJDTL-ROW                          30680092
222000     END-IF.                                                      30690092
222100                                                                  30700092
W21732*    IF (ASC-SKU-NBR (6:3) = '000' OR '999'                       30710092
W25248     IF (PV-SKU (6:3)      = '000' OR '999'                       30720092
222400     OR  IN015-ADJUSTMENT-QTY EQUAL ZERO)                         30730092
222500         CONTINUE                                                 30740092
222600     ELSE                                                         30750092
W28543         IF NOT PS-ERROR                                          30760092
W28543             PERFORM 5300-WRITE-VSAM-ADJUST-REC                   30770092
W28543         END-IF                                                   30780092
222800     END-IF.                                                      30790092
222900                                                                  30800092
223000     IF  ASC-USE-SELECTION-QUEUE                                  30810092
223100         PERFORM 9000-UPDATE-SELECTION-QUEUE                      30820092
223200     END-IF.                                                      30830092
223300                                                                  30840092
223400     MOVE ZERO                     TO  ADADJQTO                   30850092
223500                                       ADADJPRO                   30860092
223600                                       ADEXTPRO.                  30870092
223700                                                                  30880092
223800*----------------------------------------------------------------*30890092
223900*    FIRST, GENERATE THE DATALESS KEY.  NEXT, PREPARE THE        *30900092
224000*    REST OF THE HOST VARIABLES FOR TADJADD.                     *30910092
224100*----------------------------------------------------------------*30920092
224200                                                                  30930092
224300 5100-PREPARE-TADJADD-ROW.                                        30940092
224400                                                                  30950092
224500     ADD PC-11                     TO  ASC-ADD-NUM.               30960092
224600     COMPUTE PV-TODAYS-TIME        =  (DP020-SRC-TASK-NUMBER      30970092
224700                                   +   ASC-ADD-NUM)               30980092
224800                                   *   PC-11.                     30990092
224900     MOVE PV-HUND-SEC              TO  PV-SEED-BYTE-1-2.          31000092
225000     MOVE PV-SEC                   TO  PV-SEED-BYTE-3-4.          31010092
225100     MOVE PV-MIN                   TO  PV-SEED-BYTE-5-6.          31020092
225200     MOVE PV-HH                    TO  PV-SEED-BYTE-7-8.          31030092
225300     MOVE PV-INITIAL-SEED          TO  PV-SEED.                   31040092
225400                                                                  31050092
225500     COMPUTE PV-WORK-FIELD    =                                   31060092
225600            ((PV-SEED + PC-PRIME1) * PC-PRIME2).                  31070092
225700                                                                  31080092
225800     DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                      31090092
225900            GIVING PV-WORK-FIELD2                                 31100092
226000            REMAINDER PV-RANDOM-NUMBER.                           31110092
226100                                                                  31120092
226200     MOVE PV-RANDOM-NUMBER         TO  ASC-DKEY-NBR               31130092
226300                                       ADJADD-DKEY-NBR.           31140092
226400                                                                  31150092
W26600     MOVE ASC-STORE-NBR            TO  PV-STORE-NBR-X.            31160092
W26600     MOVE PV-STORE-NBR-9           TO  ADJADD-LOC-NBR.            31170092
                                                                        31180092
226600     MOVE ASC-AREA-NBR             TO  ADJADD-AREA-NBR.           31190092
W21732*    MOVE ASC-SKU-NBR              TO  PV-SKU.                    31200092
W25248     MOVE ASC-SKU                  TO  PV-SKU.                    31210092
W28582*    MOVE PV-SKU                   TO  ADJADD-SKU-NBR             31220099
W28582     IF NOT IN400-PV-DUMMY-UPC                                    31221099
W28582         MOVE PV-SKU               TO  ADJADD-SKU-NBR             31222099
W28582     ELSE                                                         31223099
W28582         MOVE IN400-ATT-SKU-OUT    TO  ADJADD-SKU-NBR             31224099
W28582     END-IF.                                                      31225099
W25248     MOVE ASC-UPC                  TO  PV-UPC.                    31230092
W25248     MOVE PV-UPC                   TO  ADJADD-UPC-NBR             31240092
W25248                                                                  31250092
227100     MOVE SPACE                    TO  ADJADD-MISSED-MD-IND.      31260092
227200     MOVE DP020-USERID             TO  ADJADD-CHG-ID-NBR.         31270092
227300                                                                  31280092
227400     MOVE ASC-NEW-REASON           TO  ADJADD-ADJ-RSN-TXT.        31290092
227500     MOVE ASC-NEW-PRICE            TO  ADJADD-ADJ-UNIT-PR-AMT.    31300092
227600     MOVE ASC-NEW-QTY              TO  ADJADD-ADJ-QTY             31310092
227700                                       IN015-ADJUSTMENT-QTY.      31320092
227800                                                                  31330092
227900     EVALUATE TRUE                                                31340092
228000       WHEN ASC-NEW-PRICE EQUAL ZERO                              31350092
228100          COMPUTE ADJADD-ADJ-EXTD-AMT = ADJADD-ADJ-QTY            31360092
228200                                      * ASC-TOT-PRICE             31370092
228300       WHEN ASC-NEW-QTY EQUAL ZERO                                31380092
228400          COMPUTE ADJADD-ADJ-EXTD-AMT = ASC-TOT-QTY               31390092
228500                                      * ADJADD-ADJ-UNIT-PR-AMT    31400092
228600       WHEN OTHER                                                 31410092
228700          COMPUTE ADJADD-ADJ-EXTD-AMT = ADJADD-ADJ-QTY            31420092
228800                                      * ADJADD-ADJ-UNIT-PR-AMT    31430092
228900     END-EVALUATE.                                                31440092
229000                                                                  31450092
229100*----------------------------------------------------------------*31460092
229200*     INSERT THE TADJADD TABLE.                                  *31470092
229300*----------------------------------------------------------------*31480092
229400                                                                  31490092
229500 5110-INSERT-TADJADD-ROW.                                         31500092
229600                                                                  31510092
229700     SET PS-INSERT-NOT-DONE        TO TRUE.                       31520092
229800     PERFORM UNTIL PS-INSERT-DONE                                 31530092
229800                OR SQLCODE = -803                                 31540092
229900         EXEC SQL                                                 31550092
230000              INSERT                                              31560092
230100              INTO  TADJADD                                       31570092
W26600                   (LOC_NBR                                       31580092
230300                  , AREA_NBR                                      31590092
W21732                  , SKU_NBR                                       31600092
W25248                  , UPC_NBR                                       31610092
230700                  , ADJ_UNIT_PR_AMT                               31620092
230800                  , ADJ_QTY                                       31630092
230900                  , MISSED_MD_IND                                 31640092
231000                  , DKEY_NBR                                      31650092
231100                  , CHG_TMST                                      31660092
231200                  , CHG_ID_NBR                                    31670092
231300                  , ADJ_RSN_TXT                                   31680092
231400                  , ADJ_EXTD_AMT)                                 31690092
231500             VALUES                                               31700092
W26600                   (:ADJADD-LOC-NBR                               31710092
231700                  , :ADJADD-AREA-NBR                              31720092
W21732                  , :ADJADD-SKU-NBR                               31730092
W25248                  , :ADJADD-UPC-NBR                               31740092
232100                  , :ADJADD-ADJ-UNIT-PR-AMT                       31750092
232200                  , :ADJADD-ADJ-QTY                               31760092
232300                  , :ADJADD-MISSED-MD-IND                         31770092
232400                  , :ADJADD-DKEY-NBR                              31780092
232500                  ,  CURRENT TIMESTAMP                            31790092
232600                  , :ADJADD-CHG-ID-NBR                            31800092
232700                  , :ADJADD-ADJ-RSN-TXT                           31810092
232800                  , :ADJADD-ADJ-EXTD-AMT)                         31820092
232900         END-EXEC                                                 31830092
233000                                                                  31840092
233100         EVALUATE TRUE                                            31850092
233200             WHEN SQLCODE = ZERO                                  31860092
233300                  SET PS-INSERT-DONE TO TRUE                      31870092
233400             WHEN SQLCODE = -803                                  31880092
W25248                  SET PS-ERROR   TO TRUE                          31890092
233500*                 COMPUTE PV-RANDOM-NUMBER =                      31900092
233600*                         PV-RANDOM-NUMBER *                      31910092
233700*                        (PC-11 * ASC-ADD-NUM)                    31920092
233800*                 ADD PC-11        TO  ASC-ADD-NUM                31930092
233900*                 MOVE PV-RANDOM-NUMBER                           31940092
234000*                                  TO  ASC-DKEY-NBR               31950092
234100*                                      ADJADD-DKEY-NBR            31960092
234200             WHEN SQLCODE = -904                                  31970092
234300             WHEN SQLCODE = -913                                  31980092
234400                  PERFORM 9900-SOFT-ABORT                         31990092
234500                  SET PS-INSERT-DONE TO TRUE                      32000092
234600             WHEN SQLWARN0 NOT = SPACES                           32010092
234700             WHEN SQLCODE < ZERO                                  32020092
234800             WHEN SQLCODE > ZERO                                  32030092
234900                 MOVE '5110-INSERT-TADJADD-ROW'                   32040092
235000                                   TO DP013-PARAGRAPH             32050092
235100                 MOVE 'INSERT A ROW ON THE TADJADD TABLE'         32060092
235200                                   TO DP013-MESSAGE-TEXT(1)       32070092
235300                 MOVE SQLCA        TO DP013-SQLCA                 32080092
235400                 MOVE 'TADJADD'    TO DP013-DB2-TABLE-NAME (1)    32090092
235500                 SET DP013-DB2-ABEND                              32100092
235600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           32110092
235700                 PERFORM DP013-0000-PROCESS-ABEND                 32120092
235800         END-EVALUATE                                             32130092
235900     END-PERFORM.                                                 32140092
236000/                                                                 32150092
236100*----------------------------------------------------------------*32160092
236200*    PREPARE THE ADJUSTMENT DETAIL HOST VARIABLES.               *32170092
236300*----------------------------------------------------------------*32180092
236400                                                                  32190092
236500 5200-PREPARE-TADJDTL-ROW.                                        32200092
236600                                                                  32210092
236700     IF  ASC-NEW-PRICE EQUAL ZERO                                 32220092
236800         MOVE ZERO                 TO  ASC-ACT-ADJ-PRICE          32230092
236900                                       PV-ADJ-EXT1                32240092
237000     ELSE                                                         32250092
237100         COMPUTE ASC-ACT-ADJ-PRICE  =  ASC-NEW-PRICE              32260092
237200                                    -  ASC-TOT-PRICE              32270092
237300         COMPUTE PV-ADJ-EXT1        =  ASC-ACT-ADJ-PRICE          32280092
237400                                    *  ASC-TOT-QTY                32290092
237500     END-IF.                                                      32300092
237600                                                                  32310092
237700*    IF  ASC-NEW-QTY EQUAL ZERO                                   32320092
237800     IF  ASC-NEW-QTY EQUAL ZERO AND                               32330092
237900         ASC-NEW-QTY-X = SPACES                                   32340092
238000         MOVE ZERO                 TO  ASC-ACT-ADJ-QTY            32350092
238100                                       PV-ADJ-EXT2                32360092
238200     ELSE                                                         32370092
238300         COMPUTE ASC-ACT-ADJ-QTY    =  ASC-NEW-QTY                32380092
238400                                    -  ASC-TOT-QTY                32390092
238500         IF  PV-ADJ-EXT1 EQUAL ZERO                               32400092
238600             COMPUTE PV-ADJ-EXT2    =  ASC-ACT-ADJ-QTY            32410092
238700                                    *  ASC-TOT-PRICE              32420092
238800         ELSE                                                     32430092
238900             COMPUTE PV-ADJ-EXT2    =  ASC-ACT-ADJ-QTY            32440092
239000                                    *  ASC-NEW-PRICE              32450092
239100         END-IF                                                   32460092
239200     END-IF.                                                      32470092
239300                                                                  32480092
239400     COMPUTE ADJDTL-ADJ-EXTD-AMT    =  PV-ADJ-EXT1                32490092
239500                                    +  PV-ADJ-EXT2.               32500092
239600                                                                  32510092
W26600     MOVE ASC-STORE-NBR            TO  PV-STORE-NBR-X.            32520092
W26600     MOVE PV-STORE-NBR-9           TO  ADJDTL-LOC-NBR.            32530092
                                                                        32540092
239800     MOVE ASC-AREA-NBR             TO  ADJDTL-AREA-NBR.           32550092
239900     MOVE ASC-ADJ-TYPE-CDE         TO  ADJDTL-ADJ-TYPE-CDE.       32560092
240000     MOVE ASC-NEW-REASON           TO  ADJDTL-ADJ-RSN-TXT.        32570092
240100                                                                  32580092
W25248     MOVE ASC-SKU                  TO  ADJDTL-SKU-NBR.            32590092
W25248     MOVE ASC-UPC                  TO  ADJDTL-UPC-NBR.            32600092
W25248                                                                  32610092
240500     MOVE ASC-ACT-ADJ-PRICE        TO  ADJDTL-ADJ-UNIT-PR-AMT.    32620092
240600     MOVE ASC-ACT-ADJ-QTY          TO  ADJDTL-ADJ-QTY             32630092
240700                                       IN015-ADJUSTMENT-QTY.      32640092
240800                                                                  32650092
240900     MOVE ASC-DKEY-NBR             TO  ADJDTL-DKEY-NBR.           32660092
241000     MOVE DP020-USERID             TO  ADJDTL-CRE-ID-NBR.         32670092
241100                                                                  32680092
241200*----------------------------------------------------------------*32690092
241300*    INSERT THE ADJUSTMENT DETAIL ROW.                           *32700092
241400*----------------------------------------------------------------*32710092
241500                                                                  32720092
241600 5210-INSERT-TADJDTL-ROW.                                         32730092
241700                                                                  32740092
241800         EXEC SQL                                                 32750092
241900              INSERT                                              32760092
242000              INTO  TADJDTL                                       32770092
W26600                   (LOC_NBR                                       32780092
242200                  , AREA_NBR                                      32790092
W21732                  , SKU_NBR                                       32800092
W25248                  , UPC_NBR                                       32810092
242600                  , CRE_TMST                                      32820092
242700                  , ADJ_RSN_TXT                                   32830092
242800                  , ADJ_TYPE_CDE                                  32840092
242900                  , ADJ_UNIT_PR_AMT                               32850092
243000                  , ADJ_QTY                                       32860092
243100                  , ADJ_EXTD_AMT                                  32870092
243200                  , DKEY_NBR                                      32880092
243300                  , CRE_ID_NBR)                                   32890092
243400             VALUES                                               32900092
W26600                   (:ADJDTL-LOC-NBR                               32910092
243600                  , :ADJDTL-AREA-NBR                              32920092
W21732                  , :ADJDTL-SKU-NBR                               32930092
W25248                  , :ADJDTL-UPC-NBR                               32940092
244000                  ,  CURRENT TIMESTAMP                            32950092
244100                  , :ADJDTL-ADJ-RSN-TXT                           32960092
244200                  , :ADJDTL-ADJ-TYPE-CDE                          32970092
244300                  , :ADJDTL-ADJ-UNIT-PR-AMT                       32980092
244400                  , :ADJDTL-ADJ-QTY                               32990092
244500                  , :ADJDTL-ADJ-EXTD-AMT                          33000092
244600                  , :ADJDTL-DKEY-NBR                              33010092
244700                  , :ADJDTL-CRE-ID-NBR)                           33020092
244800         END-EXEC.                                                33030092
244900                                                                  33040092
245000         EVALUATE TRUE                                            33050092
245100             WHEN SQLCODE = ZERO                                  33060092
245200                  EXEC SQL                                        33070092
245300                       COMMIT                                     33080092
245400                  END-EXEC                                        33090092
245500             WHEN SQLCODE = -904                                  33100092
245600             WHEN SQLCODE = -913                                  33110092
245700                  PERFORM 9900-SOFT-ABORT                         33120092
245800             WHEN SQLWARN0 NOT = SPACES                           33130092
245900             WHEN SQLCODE < ZERO                                  33140092
246000             WHEN SQLCODE > ZERO                                  33150092
246100                 MOVE '5210-INSERT-TADJDTL-ROW'                   33160092
246200                                   TO DP013-PARAGRAPH             33170092
246300                 MOVE 'INSERT A ROW ON THE TADJDTL TABLE'         33180092
246400                                   TO DP013-MESSAGE-TEXT(1)       33190092
246500                 MOVE SQLCA        TO DP013-SQLCA                 33200092
246600                 MOVE 'TADJDTL'    TO DP013-DB2-TABLE-NAME (1)    33210092
246700                 SET DP013-DB2-ABEND                              33220092
246800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           33230092
246900                 PERFORM DP013-0000-PROCESS-ABEND                 33240092
247000         END-EVALUATE.                                            33250092
247100/                                                                 33260092
247200*----------------------------------------------------------------*33270092
247300*    GET STORE UNIT BOOK DATE.                                   *33280092
247400*----------------------------------------------------------------*33290092
247500                                                                  33300092
247600*----------------------------------------------------------------*33310092
247700*    WRITE THE ADJUSTMENT VSAM RECORD.                           *33320092
247800*----------------------------------------------------------------*33330092
247900                                                                  33340092
248000 5300-WRITE-VSAM-ADJUST-REC.                                      33350092
248100                                                                  33360092
248200     MOVE IN001-STORE-NBR          TO  IN015-STORE-NBR.           33370092
W21732*    MOVE ASC-SKU-NBR              TO  IN015-SKU-NBR.             33380092
W21732     MOVE PV-SKU                   TO  IN015-SKU-NBR.             33390092
248600     IF  IN015-ADJUSTMENT-QTY POSITIVE                            33400092
248700         SET IN015-POSITIVE-ADJUSTMENT                            33410092
248800                                   TO  TRUE                       33420092
248900     ELSE                                                         33430092
249000         SET IN015-NEGATIVE-ADJUSTMENT                            33440092
249100                                   TO  TRUE                       33450092
249200     END-IF.                                                      33460092
249300                                                                  33470092
249400     IF INVPAR-ACTL-UNIT-BK-DTE = PC-NINES-DATE                   33480092
249500         MOVE 'N' TO IN015-UNIT-BOOK-IND                          33490092
249600     ELSE                                                         33500092
249700         MOVE 'Y' TO IN015-UNIT-BOOK-IND                          33510092
249800     END-IF.                                                      33520092
249900                                                                  33530092
250000     EXEC CICS WRITE                                              33540092
250100          FROM  (IN015-ADJUSTMENT-RECORD)                         33550092
250200          RIDFLD(PV-RBA)                                          33560092
250300          RBA                                                     33570092
250400          FILE  ('INADJUST')                                      33580092
250500          RESP  (PV-CICS-RESPONSE)                                33590092
250600     END-EXEC.                                                    33600092
250700                                                                  33610092
250800     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               33620092
250900         SET DP013-LOGIC-ABEND                                    33630092
251000             DP013-NO-ROLLBACK     TO TRUE                        33640092
251100         MOVE '5300-WRITE-VSAM-ADJUST-REC'                        33650092
251200                                   TO DP013-PARAGRAPH             33660092
251300         MOVE 'INVALID RESPONSE FROM WRITE COMMAND:'              33670092
251400                                   TO DP013-MESSAGE-TEXT (1)      33680092
251500         MOVE PV-CICS-RESPONSE     TO PV-DISPLAY-RESP             33690092
251600         MOVE PV-DISPLAY-RESP      TO DP013-MESSAGE-TEXT (2)      33700092
251700         PERFORM DP013-0000-PROCESS-ABEND                         33710092
251800     END-IF.                                                      33720092
251900/                                                                 33730092
252000*----------------------------------------------------------------*33740092
252100* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *33750092
252200* OBJECT WAS UPDATED.                                            *33760092
252300*----------------------------------------------------------------*33770092
252400                                                                  33780092
252500 9000-UPDATE-SELECTION-QUEUE.                                     33790092
252600                                                                  33800092
252700     PERFORM 9100-READ-SEL-QUEUE.                                 33810092
252800     SET IN012-UPD (ASC-SEL-SUB) TO TRUE.                         33820092
252900     PERFORM 9200-REWRITE-SEL-QUEUE.                              33830092
253000/                                                                 33840092
253100*----------------------------------------------------------------*33850092
253200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *33860092
253300*----------------------------------------------------------------*33870092
253400                                                                  33880092
253500 9100-READ-SEL-QUEUE.                                             33890092
253600                                                                  33900092
253700     EXEC CICS                                                    33910092
253800         READQ TS                                                 33920092
253900             QUEUE (ASC-SEL-QUEUE-NAME)                           33930092
254000             INTO  (IN012-SELECTED-SKUS)                          33940092
254100             ITEM  (ASC-SEL-ITEM)                                 33950092
254200             RESP  (PV-CICS-RESPONSE)                             33960092
254300     END-EXEC.                                                    33970092
254400                                                                  33980092
254500     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   33990092
254600         CONTINUE                                                 34000092
254700     ELSE                                                         34010092
254800         SET DP013-LOGIC-ABEND                                    34020092
254900             DP013-NO-ROLLBACK     TO TRUE                        34030092
255000         MOVE '9100-READ-SEL-QUEUE'                               34040092
255100                                   TO DP013-PARAGRAPH             34050092
255200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   34060092
255300                                   TO DP013-MESSAGE-TEXT (1)      34070092
255400         PERFORM DP013-0000-PROCESS-ABEND                         34080092
255500     END-IF.                                                      34090092
255600                                                                  34100092
255700*----------------------------------------------------------------*34110092
255800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *34120092
255900*----------------------------------------------------------------*34130092
256000                                                                  34140092
256100 9200-REWRITE-SEL-QUEUE.                                          34150092
256200                                                                  34160092
256300     EXEC CICS                                                    34170092
256400          WRITEQ TS                                               34180092
256500              QUEUE  (ASC-SEL-QUEUE-NAME)                         34190092
256600              FROM   (IN012-SELECTED-SKUS)                        34200092
256700              ITEM   (ASC-SEL-ITEM)                               34210092
256800              RESP   (PV-CICS-RESPONSE)                           34220092
256900              REWRITE                                             34230092
257000     END-EXEC.                                                    34240092
257100                                                                  34250092
257200     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               34260092
257300         SET DP013-CICS-ABEND                                     34270092
257400             DP013-NO-ROLLBACK     TO TRUE                        34280092
257500         MOVE '9200-REWRITE-SEL-QUEUE'                            34290092
257600                                   TO DP013-PARAGRAPH             34300092
257700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   34310092
257800                                   TO DP013-MESSAGE-TEXT (1)      34320092
257900         PERFORM DP013-0000-PROCESS-ABEND                         34330092
258000     END-IF.                                                      34340092
W28545/                                                                 34350092
W28545*----------------------------------------------------------------*34360092
W28545*    PRICE LOOK-UP PROCEDURE DIVISION COPYBOOK                    34370092
W28545*----------------------------------------------------------------*34380092
W28545                                                                  34390092
W28545     COPY INPD400.                                                34400092
258100/                                                                 34410092
258200*----------------------------------------------------------------*34420092
258300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *34430092
258400*    AND THE ERROR SWITCHES.                                     *34440092
258500*----------------------------------------------------------------*34450092
258600                                                                  34460092
258700 9900-SOFT-ABORT.                                                 34470092
258800                                                                  34480092
258900     SET PS-ERROR                TO  TRUE.                        34490092
259000     SET DP020-MSG-FATAL         TO  TRUE.                        34500092
259100     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            34510092
259200/                                                                 34520092
259300*----------------------------------------------------------------*34530092
259400*    ABEND PROCESSOR MODULE                                      *34540092
259500*----------------------------------------------------------------*34550092
259600                                                                  34560092
259700     COPY DPPD013.                                                34570092
