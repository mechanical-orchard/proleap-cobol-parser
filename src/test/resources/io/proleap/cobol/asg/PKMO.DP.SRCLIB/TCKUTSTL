000100 IDENTIFICATION DIVISION.                                         00010025
000200 PROGRAM-ID.               TCKUTBRD.                              00020025
000300 AUTHOR.                   JIM ULICKEY                            00030025
000400 INSTALLATION.             KOHLS DEPARTMENT STORES.               00040025
000500 DATE-WRITTEN.             APRIL 30, 2013.                        00050025
000600 DATE-COMPILED.                                                   00060025
000700*----------------------------------------------------------------*00070025
000800*  CREATION OF MERCHANT.TBL AND STORE.TBL ENTRIES FOR STORES     *00080025
000900*----------------------------------------------------------------*00090025
001000*  PROGRAM NARRATIVE:                                            *00100025
001100*                                                                *00110025
001200*   PROGRAM PRODUCES 2 FILES TO BE LOADED TO THE PC.             *00120025
001300*   ONE FOR THE MERCHANT.TBL AND ONE FOR THE STORE.TBL.          *00130025
001310*   BOTH FILES ARE FOR AJB.                                      *00140025
001400*   THIS PROGRAM READS THE XST_LOC TABLE AND RETRIEVES STORE     *00150025
001500*   INFORMATION, ALSO READS XST_LOC_ATTR FOR MERCHANT NUMBERS.   *00160025
001600*----------------------------------------------------------------*00170025
001602*   - MAY 2013 - JHU.                                            *00180025
001603* UPDATES TO ADD DISCOVER AND AMEX LINES TO THE MPSCRD LINE.     *00190025
001604*   - JUN 2013 - JHU.                                            *00200025
001605* UPDATES TO REMOVE DISCOVER AND AMEX LINES.                     *00210025
001606*   - OCT 2013 - SAK                                             *00220025
001607* UPDATES TO ADD POC PAYMENT GATEWAY USING FEPTCP                *00230025
001606*   - FEB 2014 - SJK                                             *00240025
001607* UPDATES FOR AJB V4 CHANGES.                                    *00250025
001607*   - CHANGE 9FEPTCP TO 9TCPCOM FOR ALL LINES IN STORE TABLE     *00260025
      *   - CHANGE FDRRTL TO FDRCRD FOR MERCHANT TABLE                  00270025
      *   - CHANGE STORE 873 LINE TO NOT INCLUDE *SEC_*SSL              00280025
      *   - ADDED SPECIAL CHARACTER REMOVAL                             00290032
      * UPDATES FOR SETTLEMENT.                                         00291044
      *   - ADDED FIELDS 6 AND 17 TO MPSCRD                             00292044
      *   - ADDED FIELDS 15 TO FDRCRD AND FDRRMO                        00293044
      *   - ADDED TWO DEFAULT RECORD DFDRCRD AND DFDRRMO                00294044
      * UPDATES FOR AJB SETTLEMENT.                                     00295082
      *   - MODIFIED MPSCRD, FDRCRD AND FDRRMO RECORD LAYOUT TO ALIGN   00296082
      *     WITH AJB MERCHANT FILE                                      00296182
      *   - MODIFIED TCBRADS2 AND TCBRADS5 FOR AJB MERCHANT FILE LAYOUT 00297082
      *   - UNCOMMENTED DFDRCRD AND DFDRRMO RECORD CREATION LINES       00298082
      * UPDATES FOR AJB SETTLEMENT.                                     00298186
      *   - REMOVE FIELD 18 FROM DFDRCRD RECORD                         00298286
      *   NOTE:                                                         00299084
      *   -----                                                         00299184
      *   THIS PROGRAM IS ONLY FOR SETTLEMENT AND NOT FOR               00299284
      *   AUTHORIZATION. THERE IS A SEPARATE PROGRAM FOR AUTHORIZATION. 00299384
001608*----------------------------------------------------------------*00300025
001609 ENVIRONMENT DIVISION.                                            00310025
001610                                                                  00320025
001620                                                                  00330025
001630 CONFIGURATION SECTION.                                           00340025
001640                                                                  00350025
001650 SOURCE-COMPUTER.    IBM-3090.                                    00360025
001660 OBJECT-COMPUTER.    IBM-3090.                                    00370025
001670                                                                  00380025
001680                                                                  00390025
001690 INPUT-OUTPUT SECTION.                                            00400025
001700                                                                  00410025
001800 FILE-CONTROL.                                                    00420025
001900                                                                  00430025
002000     SELECT MERCHANT-TABLE-FILE        ASSIGN TO OUT01.           00440025
002100     SELECT STORE-TABLE-FILE           ASSIGN TO OUT02.           00450025
002200     EJECT                                                        00460025
002300                                                                  00470025
002400 DATA DIVISION.                                                   00480025
002500                                                                  00490025
002600 FILE SECTION.                                                    00500025
002700                                                                  00510025
002800 FD  MERCHANT-TABLE-FILE                                          00520025
002900     RECORDING MODE IS F                                          00530025
003000     BLOCK CONTAINS 0                                             00540025
003100     LABEL RECORDS ARE STANDARD.                                  00550025
003200 01  MERCHANT-TABLE-RECORD            PIC X(300).                 00560057
003300                                                                  00570025
003400 FD  STORE-TABLE-FILE                                             00580025
003500     RECORDING MODE IS F                                          00590025
003600     BLOCK CONTAINS 0                                             00600025
003700     LABEL RECORDS ARE STANDARD.                                  00610025
003800 01  STORE-TABLE-RECORD               PIC X(129).                 00620027
003900                                                                  00630025
004000                                                                  00640025
004100 WORKING-STORAGE SECTION.                                         00650025
004200                                                                  00660025
004300 01  FILLER                           PIC X(32)  VALUE            00670025
004400     'TCKUTBRD WORKING STORAGE BEGINS:'.                          00680025
004500                                                                  00690025
004600 01  PC-PROGRAM-CONSTANTS.                                        00700025
004700                                                                  00710025
004800*        -- MISCELLANEOUS CONSTANTS/LITERALS --                   00720025
004900                                                                  00730025
005000     05  PC-PROGRAM-NUMBER            PIC X(08)      VALUE        00740025
005100         'TCKUTBRD'.                                              00750025
005200     05  PC-UNDER-SCORE               PIC X(23)      VALUE        00760025
005300         '_______________________'.                               00770025
005400                                                                  00780025
005500     05  PC-ST-HARDCODE-1             PIC  X(30)  VALUE           00790025
005600         ' 9TCPCOM 0 _ _ 0 _ _ _ _ Y FIP'.                        00800029
005700     05  PC-ST-HARDCODE-2             PIC  X(43)  VALUE           00810030
005800         'CRED N FIPCRED 0 N 0 1 _ 1 _STORE_ _ _ _ _ '.           00820030
005900     05  PC-ST-HARDCODE-3             PIC  X(45)  VALUE           00830030
006000         ' _ _ *SSL _ 0 0 0 0 0 0 _ _ _ _ N E _ _ '.              00840030
005900* ADDED VERIATION WITHOUT THE *SEC_*SSL                           00850025
005900     05  PC-ST-HARDCODE-3-ECOM        PIC  X(36)  VALUE           00860030
006000         ' _ _ _ _ 0 0 0 0 0 0 _ _ _ _ N E _ _'.                  00870030
006100*    05  PC-ST-HC-LAST                PIC  X(16)  VALUE           00880026
006200*        '0 _ _ _ _ N E _ '.                                      00890026
006300**** STORE.TBL POC PAYMENT GATEWAY CONSTANTS                      00900025
006400*    05  PC-ST-PG-HARDCODE-1          PIC  X(30)  VALUE           00910025
006500*        ' 9FEPTCP 0 _ _ 0 _ _ _ _ Y FIP'.                        00920025
006400     05  PC-ST-PG-HARDCODE-1          PIC  X(30)  VALUE           00930025
006500         ' 9TCPCOM 0 _ _ 0 _ _ _ _ Y FIP'.                        00940025
007200**** MPS MERCHANT TABLE CONSTANTS                                 00950025
007300     05  PC-MT-FIRST-FIELD            PIC  X(08)  VALUE           00960025
SJK1 0         'MPSCRD!F'.                                              00970032
007300     05  PC-PG-MT-FIRST-FIELD         PIC  X(08)  VALUE           00980061
SJK1 0         'MPSCRD!F'.                                              00990061
007500     05  PC-MT-HARDCODE-ONE           PIC  X(35)  VALUE           01000025
007600         ' |1 042000314 |2 000148 |3 5311 |4 '.                   01010025
007500     05  PC-MT-HARDCODE-ONE-A         PIC  X(06)  VALUE           01011039
007600         'US |6 '.                                                01012039
007700     05  PC-MT-HARDCODE-TWO           PIC  X(20)  VALUE           01020039
007800         " |8 840 |15 KOHL'S_#".                                  01030039
007700     05  PC-MT-HARDCODE-TWO-A         PIC  X(05)  VALUE           01031037
007800         " |17 ".                                                 01032037
007900     05  PC-MT-HARDCODE-THREE         PIC  X(06)  VALUE           01040025
008000         " |100 ".                                                01050025
008100     05  PC-MT-HARDCODE-FOUR          PIC  X(06)  VALUE           01060025
008200         " |101 ".                                                01070025
008300     05  PC-MT-HARDCODE-FIVE          PIC  X(06)  VALUE           01080025
008400         " |102 ".                                                01090025
008500     05  PC-MT-HARDCODE-SIX           PIC  X(06)  VALUE           01100025
008600         " |104 ".                                                01110062
008700**** MPS MERCHANT TABLE DISCOVER AND AMEX ADDITIONS JIM           01120025
008800     05  PC-MT-HARDCODE-SEVEN         PIC  X(06)  VALUE           01130025
008900         " |105 ".                                                01140062
009000     05  PC-MT-HARDCODE-EIGHT         PIC  X(06)  VALUE           01150025
009100         " |106 ".                                                01160025
009200**** DISCOVER MERCHANT TABLE CONSTANTS                            01170025
009300     05  PC-DT-FIRST-FIELD            PIC  X(08)  VALUE           01180025
009400         'DCV3RN!F'.                                              01190025
009500     05  PC-DT-HARDCODE-ONE           PIC  X(11)  VALUE           01200025
009600         ' |1 KOHLS_#'.                                           01210025
009700     05  PC-DT-HARDCODE-TWO           PIC  X(12)  VALUE           01220025
009800         '____________'.                                          01230025
009900     05  PC-DT-HARDCODE-THREE         PIC  X(01)  VALUE           01240025
010000         '_'.                                                     01250025
010100     05  PC-DT-HARDCODE-FOUR          PIC  X(01)  VALUE           01260025
010200         '_'.                                                     01270025
010300     05  PC-DT-HARDCODE-FIVE          PIC  X(12)  VALUE           01280025
010400         ' |3 5311 |4 '.                                          01290025
010500     05  PC-DT-HARDCODE-51            PIC  X(12)  VALUE           01300025
010600         ' |6 '.                                                  01310025
010700     05  PC-DT-HARDCODE-SIX           PIC  X(04)  VALUE           01320025
010800         ' |7 '.                                                  01330025
010900     05  PC-DT-HARDCODE-SEVEN         PIC  X(12)  VALUE           01340025
011000         ' |8 840 |17 '.                                          01350025
011100     05  PC-DT-HARDCODE-EIGHT         PIC  X(05)  VALUE           01360025
011200         ' |18 '.                                                 01370025
011300     05  PC-DT-HARDCODE-NINE          PIC  X(04)  VALUE           01380025
011400         '0000'.                                                  01390025
011500     05  PC-DT-HARDCODE-TEN           PIC  X(06)  VALUE           01400025
011600         ' |106 '.                                                01410025
011700**** AMERICAN EXPRESS MERCHANT TABLE CONSTANTS                    01420025
011800     05  PC-AT-FIRST-FIELD            PIC  X(08)  VALUE           01430025
011900         'AMX3RD!F'.                                              01440025
012000     05  PC-AT-HARDCODE-ONE           PIC  X(21)  VALUE           01450025
012100         ' |8 840 |3 5311 |104 '.                                 01460025
012200**** FIRST DATA MERCHANT TABLE CONSTANTS                          01470025
012300     05  PC-FD-RETURNS-FIRST-FIELD    PIC  X(08)  VALUE           01480025
SJK1 0         'FDRRMO!F'.                                              01490032
012300     05  PC-PG-FD-RETURNS-FIRST-FIELD PIC  X(07)  VALUE           01500033
SJK1 0         'FDRRMO!'.                                               01510033
012500     05  PC-FD-RETURNS-HARDCODE-ONE   PIC  X(05)  VALUE           01530140
012600         ' |15 '.                                                 01530240
012500     05  PC-FD-RETURNS-HARDCODE-TWO   PIC  X(06)  VALUE           01531036
012600         ' |103 '.                                                01532036
012700*    05  PC-FD-SALES-FIRST-FIELD      PIC  X(08)  VALUE           01540025
012800*        'FDRRTL!F'.                                              01550025
012700     05  PC-FD-SALES-FIRST-FIELD      PIC  X(08)  VALUE           01560025
SJK1 0         'FDRCRD!F'.                                              01570032
012700     05  PC-PG-FD-SALES-FIRST-FIELD   PIC  X(07)  VALUE           01580033
SJK1 0         'FDRCRD!'.                                               01590033
012900     05  PC-FD-SALES-HARDCODE-ONE     PIC  X(20)  VALUE           01610140
013000         ' |3 5311 |8 840 |15 '.                                  01610240
012900     05  PC-FD-SALES-HARDCODE-TWO     PIC  X(06)  VALUE           01611036
013000         ' |103 '.                                                01612036
012900     05  PC-FD-SALES-DFDRRMO          PIC  X(31)  VALUE           01613042
013000         'DFDRRMO |2 93680000 |18 639305'.                        01614044
012900     05  PC-FD-SALES-DFDRCRD          PIC  X(34)  VALUE           01615087
013000         'DFDRCRD |2 93680000 |3 5311 |8 840'.                    01616085
013100                                                                  01620025
013200     05  PC-ABEND-MSSG                PIC X(12)      VALUE        01630025
013300         '** ABEND ** '.                                          01640025
013400     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        01650025
013500         'DB2 ERROR'.                                             01660025
013600     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)      VALUE        01670025
013700         'ATTEMPTING TO '.                                        01680025
013800                                                                  01690025
013900 01  PS-PROCESS-SWITCHES.                                         01700025
014000     05  PS-TRANSACTION-DETAIL-SW     PIC X(01)      VALUE 'N'.   01710025
014100         88  PS-NOT-END-OF-TRANS-DETAIL              VALUE 'N'.   01720025
014200         88  PS-END-OF-TRANSACTION-DETAIL            VALUE 'Y'.   01730025
014300                                                                  01740025
014400     EJECT                                                        01750025
014500 01  PROGRAM-TABLES.                                              01760025
014600     05  PT-ADDRESS-FIELD             PIC X(23).                  01770025
014700     05  PT-ADDRESS-TABLE REDEFINES PT-ADDRESS-FIELD.             01780025
014800         10  PT-ADDR-TABLE OCCURS 23 TIMES                        01790025
014900                                      PIC X(01).                  01800025
015000                                                                  01810025
015100     05  PT-ADDRESS-FIELD-OUT         PIC X(23).                  01820025
015200     05  PT-ADDRESS-TABLE-OUT REDEFINES PT-ADDRESS-FIELD-OUT.     01830025
015300         10  PT-ADDR-TABLE-OUT OCCURS 23 TIMES                    01840025
015400                                      PIC X(01).                  01850025
015500     05  PT-CITY-FIELD                PIC X(13).                  01860025
015600     05  PT-CITY-TABLE    REDEFINES PT-CITY-FIELD.                01870025
015700         10  PT-CITY-TBL   OCCURS 13 TIMES                        01880025
015800                                      PIC X(01).                  01890025
015900                                                                  01900025
016000     05  PT-CITY-FIELD-OUT            PIC X(13).                  01910025
016100     05  PT-CITY-TABLE-OUT    REDEFINES PT-CITY-FIELD-OUT.        01920025
016200         10  PT-CITY-TBL-OUT   OCCURS 13 TIMES                    01930025
016300                                      PIC X(01).                  01940025
016400                                                                  01950025
016500 01  PV-PROGRAM-VARIABLES.                                        01960025
016600     05  PV-SUB                       PIC S9(04)     COMP.        01970025
016700     05  PV-SUB-DEST                  PIC S9(04)     COMP.        01980025
016800     05  PV-PARAGRAPH-NAME            PIC X(50)      VALUE SPACES.01990025
016900     05  PV-DB2-ERROR-MSSG            PIC X(50)      VALUE SPACES.02000025
017000     05  PV-VERIFY-ADDR2              PIC X(2)       VALUE SPACES.02010025
017100     05  PV-FD-MERCHANT-ID.                                       02020025
017200         10  PV-FD-MERCHANT-ID-BIN    PIC 9(06)      VALUE 639305.02030025
017300         10  PV-FD-MERCHANT-ID-ZEROS  PIC 9(05)      VALUE 0.     02040025
017400         10  PV-FD-MERCHANT-ID-STORE  PIC 9(04)      VALUE 0.     02050025
017500                                                                  02060025
017600 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 02070025
017700     88  ABEND-4003-INVALID-CC-DATE                  VALUE +4003. 02080025
017800     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 02090025
017900     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 02100025
018000     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 02110025
                                                                        02111047
       01  WS-MPS-TABLE                     PIC X(251).                 02112050
       01  WS-PG-MPS-TABLE                  PIC X(251).                 02113076
       01  WS-FDRCRD-TABLE                  PIC X(200).                 02114081
       01  WS-FDRRMO-TABLE                  PIC X(200).                 02115081
018100*----------------------------------------------------------------*02120025
018200*    STANDARD FILE LAYOUT FOR THE STORE TABLE FILE               *02130025
018300*----------------------------------------------------------------*02140025
018400     COPY TCBRDS1.                                                02150088
018500*----------------------------------------------------------------*02160025
018600*    STANDARD FILE LAYOUT FOR THE MPS MERCHANT TABLE ENTRIES     *02170025
018700*----------------------------------------------------------------*02180025
018800     COPY TCBRDS2.                                                02190088
018900*----------------------------------------------------------------*02200025
019000*    STANDARD FILE LAYOUT FOR THE DISCOVER MERCHANT TABLE ENTRIES*02210025
019100*----------------------------------------------------------------*02220025
019200*    COPY TCBRDS3.                                                02230088
019300*----------------------------------------------------------------*02240025
019400*    STANDARD FILE LAYOUT FOR THE AMEX MERCHANT TABLE ENTRIES    *02250025
019500*----------------------------------------------------------------*02260025
019600*    COPY TCBRDS4.                                                02270088
019700*----------------------------------------------------------------*02280025
019800*    STANDARD FILE LAYOUT FOR THE FIRST DATA MERCHANT TBL ENTRIES*02290025
019900*----------------------------------------------------------------*02300025
020000     COPY TCBRDS5.                                                02310088
020100*----------------------------------------------------------------*02320025
020200*    STANDARD DB2 ERROR HANDLING AREA                            *02330025
020300*----------------------------------------------------------------*02340025
020400     COPY DPWS004.                                                02350025
020500*----------------------------------------------------------------*02360025
020600*   LOCATION DOMAIN TABLE                                       * 02370025
020700*----------------------------------------------------------------*02380025
020800     EXEC SQL                                                     02390025
020900         INCLUDE XST00001                                         02400025
021000     END-EXEC.                                                    02410025
021100*----------------------------------------------------------------*02420025
021200*   LOCATION ATTRIBUTE TABLE                                    * 02430025
021300*----------------------------------------------------------------*02440025
021400     EXEC SQL                                                     02450025
021500         INCLUDE XST00025                                         02460025
021600     END-EXEC.                                                    02470025
021700*----------------------------------------------------------------*02480025
021800*    STANDARD DB2 DCLGEN FOR THE STATE TABLE (TSTATE)            *02490025
021900*----------------------------------------------------------------*02500025
022000     EXEC SQL                                                     02510025
022100         INCLUDE TSTATE                                           02520025
022200     END-EXEC.                                                    02530025
022300*----------------------------------------------------------------*02540025
022400*    STANDARD DB2 COMMUNICATIONS AREA                            *02550025
022500*----------------------------------------------------------------*02560025
022600     EXEC SQL                                                     02570025
022700         INCLUDE SQLCA                                            02580025
022800     END-EXEC.                                                    02590025
022900*----------------------------------------------------------------*02600025
023000*    CURSOR DECLARE - STORE EXTRACT CSR                          *02610025
023100*----------------------------------------------------------------*02620025
023200     EXEC SQL                                                     02630025
023300         DECLARE STORE-EXTR-CSR CURSOR WITH HOLD FOR              02640025
023400                                                                  02650025
023500         SELECT  A.LOC_NBR                                        02660025
023600              ,  A.LOC_NM                                         02670036
023600              ,  A.LNE_1_ADDR                                     02671036
023700              ,  A.LNE_2_ADDR                                     02680025
023800              ,  A.CTY_NM                                         02690025
023900              ,  A.ST_CDE                                         02700025
024000              ,  A.ZIP_10_CDE                                     02710025
024100              ,  COALESCE(B.BNKCRD_MERCH_NBR, 0)                  02720025
024200              ,  COALESCE(B.DSCVR_MERCH_NBR, 0)                   02730025
024300              ,  COALESCE(B.AMEX_MERCH_NBR, 0)                    02740025
024400              ,  C.ANSI_US_ST_CDE                                 02750025
024500         FROM XST_LOC A                                           02760025
024600             ,XST_LOC_ATTR B                                      02770025
024700             ,TSTATE  C                                           02780025
024800         WHERE A.LOC_NBR = B.LOC_NBR                              02790025
024900           AND A.ST_CDE = C.STATE_CODE                            02800025
025000           AND LOC_TYP_CDE = 'DS'                                 02810025
025100           AND CLO_DTE  > '2009-07-29'                            02820025
025200         ORDER BY A.LOC_NBR                                       02830025
025300         WITH UR                                                  02840025
025400     END-EXEC.                                                    02850025
025500*----------------------------------------------------------------*02860025
025600 PROCEDURE DIVISION.                                              02870025
025700*----------------------------------------------------------------*02880025
025800                                                                  02890025
025900     OPEN OUTPUT MERCHANT-TABLE-FILE                              02900025
026000                 STORE-TABLE-FILE.                                02910025
026100                                                                  02920025
026200     PERFORM 1000-OPEN-STORE-EXTR-CSR.                            02930025
026300                                                                  02940025
026400     PERFORM 1050-FETCH-STORE-EXTR-CSR.                           02950025
026500                                                                  02960025
      *    WRITE TWO DEFAULT RECORDS                                    02960183
           IF NOT PS-END-OF-TRANSACTION-DETAIL                          02960282
              WRITE MERCHANT-TABLE-RECORD FROM PC-FD-SALES-DFDRRMO      02961082
              WRITE MERCHANT-TABLE-RECORD FROM PC-FD-SALES-DFDRCRD      02962082
           END-IF.                                                      02962182
                                                                        02963046
026600     PERFORM 2000-PROCESS                                         02970025
026700         UNTIL PS-END-OF-TRANSACTION-DETAIL.                      02980025
026800                                                                  02990025
026900     PERFORM 1070-CLOSE-STORE-EXTR-CSR.                           03000025
027000                                                                  03010025
027100     CLOSE MERCHANT-TABLE-FILE                                    03020025
027200           STORE-TABLE-FILE.                                      03030025
027300                                                                  03040025
027400     GOBACK.                                                      03050025
027500*----------------------------------------------------------------*03060025
027600*   OPEN THE STORE EXTRACT CURSOR                                *03070025
027700*----------------------------------------------------------------*03080025
027800 1000-OPEN-STORE-EXTR-CSR.                                        03090025
027900                                                                  03100025
028000     EXEC SQL                                                     03110025
028100         OPEN STORE-EXTR-CSR                                      03120025
028200     END-EXEC.                                                    03130025
028300                                                                  03140025
028400     EVALUATE TRUE                                                03150025
028500       WHEN SQLCODE NOT = 0                                       03160025
028600       WHEN SQLWARN0    = 'W'                                     03170025
028700         MOVE '1000-OPEN-STORE-EXTR-CSR '                         03180025
028800                           TO PV-PARAGRAPH-NAME                   03190025
028900         MOVE 'OPEN STORE EXTRACT CURSOR ERROR.'                  03200025
029000                           TO PV-DB2-ERROR-MSSG                   03210025
029100         PERFORM 9400-DB2-ERROR                                   03220025
029200     END-EVALUATE.                                                03230025
029300                                                                  03240025
029400*----------------------------------------------------------------*03250025
029500*   FETCH DATA FROM THE STORE EXTRACT CSR                        *03260025
029600*----------------------------------------------------------------*03270025
029700 1050-FETCH-STORE-EXTR-CSR.                                       03280025
029800                                                                  03290025
029900     EXEC SQL                                                     03300025
030000         FETCH STORE-EXTR-CSR                                     03310025
030100           INTO :XST00001-LOC-NBR                                 03320025
030200              , :XST00001-LOC-NM                                  03330036
030200              , :XST00001-LNE-1-ADDR                              03331036
030300              , :XST00001-LNE-2-ADDR                              03340025
030400              , :XST00001-CTY-NM                                  03350025
030500              , :XST00001-ST-CDE                                  03360025
030600              , :XST00001-ZIP-10-CDE                              03370025
030700              , :XST00025-BNKCRD-MERCH-NBR                        03380025
030800              , :XST00025-DSCVR-MERCH-NBR                         03390025
030900              , :XST00025-AMEX-MERCH-NBR                          03400025
031000              , :TSTATE-ANSI-US-ST-CDE                            03410025
031100     END-EXEC.                                                    03420025
031200                                                                  03430025
031300     EVALUATE TRUE                                                03440025
031400         WHEN SQLCODE = +0                                        03450025
031500           CONTINUE                                               03460031
031600         WHEN SQLCODE = +100                                      03470025
031700           SET PS-END-OF-TRANSACTION-DETAIL TO TRUE               03480025
031800         WHEN OTHER                                               03490025
031900             MOVE '1050-FETCH-STORE-EXTR-CURSOR'                  03500025
032000                               TO PV-PARAGRAPH-NAME               03510025
032100             MOVE 'FETCH FROM STORE EXTRACT CURSOR ERROR.'        03520025
032200                               TO PV-DB2-ERROR-MSSG               03530025
032300             PERFORM 9400-DB2-ERROR                               03540025
032400     END-EVALUATE.                                                03550025
032500                                                                  03560025
032600*----------------------------------------------------------------*03570025
032700*   CLOSE THE STORE EXTRACT CSR                                  *03580025
032800*----------------------------------------------------------------*03590025
032900 1070-CLOSE-STORE-EXTR-CSR.                                       03600025
033000     EXEC SQL                                                     03610025
033100       CLOSE STORE-EXTR-CSR                                       03620025
033200     END-EXEC.                                                    03630025
033300                                                                  03640025
033400     EVALUATE TRUE                                                03650025
033500       WHEN SQLCODE NOT = 0                                       03660025
033600       WHEN SQLWARN0    = 'W'                                     03670025
033700           MOVE '1070-CLOSE-STORE-EXTR-CSR'                       03680025
033800                             TO PV-PARAGRAPH-NAME                 03690025
033900           MOVE 'CLOSE FAILED FOR STORE EXTRACT CURSOR'           03700025
034000                             TO PV-DB2-ERROR-MSSG                 03710025
034100           PERFORM 9400-DB2-ERROR                                 03720025
034200     END-EVALUATE.                                                03730025
034300                                                                  03740025
034400*----------------------------------------------------------------*03750025
034500* PROCESS  :  BUILD THE TWO EXTRACT RECORDS WITH STORE EXTRACT   *03760025
034600*             INFORMATION.  SPECIAL CREATION OF ADDRESS AND CITY *03770025
034700*             USE ADDRESS LINE TWO IF INFORMATION IN THAT FIELD  *03780025
034800*             BUILD THE ADDRESS AND CITY OUTPUT WITH ALL UNDER   *03790025
034900*             SCORES WHERE SPACES WOULD BE. UNDERSCORE TO THE    *03800025
035000*             END OF BOTH FIELDS WHEN NOT FILLED COMPLETE        *03810025
035100*             ALOT OF THE FIELDS ARE HARD CODED AND ARE IN THE   *03820025
035200*             PC-CONSTANT FIELDS WITH SAME NAME.                 *03830025
035300*----------------------------------------------------------------*03840025
035400 2000-PROCESS.                                                    03850025
035500                                                                  03860025
035600     INITIALIZE ABCDE-MPS-MER-TABLE                               03870025
035700*               ABCDE-AMEX-MER-TABLE                              03880025
035800*               ABCDE-DISC-MER-TABLE                              03890025
035900                ABCDE-FD-RETURNS-MER-TABLE                        03900025
036000                ABCDE-FD-SALES-MER-TABLE                          03910025
036100                ABCDE-STORE-TABLE.                                03920025
036200                                                                  03930031
036200     PERFORM 2100-REMOVE-SPECIAL-CHARACTERS.                      03940032
036200                                                                  03950031
036300     MOVE 'F'                   TO  ABCDE-ST-1ST-FIELD.           03960025
036400     MOVE  XST00001-LOC-NBR      TO  ABCDE-ST-STORE-NBR.          03970025
036500     MOVE  'A'                   TO  ABCDE-ST-RECORD-TYPE.        03980025
036600     MOVE  PC-ST-HARDCODE-1      TO  ABCDE-ST-HARDCODE-1.         03990025
036700     MOVE  PC-ST-HARDCODE-2      TO  ABCDE-ST-HARDCODE-2.         04000025
      * AJB V4 - NEED SPECIAL LINE FOR ECOM STORES                      04010025
           IF XST00001-LOC-NBR = 0873                                   04020025
036800        MOVE  PC-ST-HARDCODE-3-ECOM TO  ABCDE-ST-HARDCODE-3       04030025
           ELSE                                                         04040025
036800        MOVE  PC-ST-HARDCODE-3   TO  ABCDE-ST-HARDCODE-3          04050025
036800     END-IF.                                                      04060025
036900*    MOVE  PC-ST-HC-LAST         TO  ABCDE-ST-HC-LAST.            04070026
SJK2 0     MOVE  PC-MT-FIRST-FIELD     TO  ABCDE-MT-FIRST-FIELD.        04080032
SJK2 0     MOVE  PC-PG-MT-FIRST-FIELD  TO  ABCDE-PG-MT-FIRST-FIELD.     04090056
037100*    MOVE  PC-DT-FIRST-FIELD     TO  ABCDE-DT-FIRST-FIELD.        04100025
037200*    MOVE  PC-AT-FIRST-FIELD     TO  ABCDE-AT-FIRST-FIELD.        04110025
SJK2 0     MOVE  PC-FD-RETURNS-FIRST-FIELD                              04120032
037400                                 TO  ABCDE-FD-RETURNS-FIRST-FIELD.04130025
SJK2 0     MOVE  PC-PG-FD-RETURNS-FIRST-FIELD                           04140034
037400                                 TO ABCDE-PG-FD-RTRNS-FIRST-FIELD.04150034
SJK2 0     MOVE  PC-FD-SALES-FIRST-FIELD                                04160032
037600                                 TO  ABCDE-FD-SALES-FIRST-FIELD.  04170025
SJK2 0     MOVE  PC-PG-FD-SALES-FIRST-FIELD                             04180034
037600                                 TO ABCDE-PG-FD-SLS-FIRST-FIELD.  04190034
037700     MOVE  XST00001-LOC-NBR      TO  ABCDE-MT-STORE-NBR           04200025
037800*                                    ABCDE-DT-STORE-NBR           04210025
037900*                                    ABCDE-DT-STORE-NBR2          04220025
038000*                                    ABCDE-DT-STORE-NBR3          04230025
038100*                                    ABCDE-AT-STORE-NBR           04240025
038200                                     ABCDE-FD-RETURNS-STORE-NBR   04250025
038300                                     ABCDE-FD-SALES-STORE-NBR     04260025
038400                                     PV-FD-MERCHANT-ID-STORE.     04270032
           MOVE XST00001-LOC-NM        TO  ABCDE-FD-RETURNS-LOCATION-NM 04271036
                                           ABCDE-FD-SALES-LOCATION-NM.  04272036
038500     MOVE  'A'                   TO  ABCDE-MT-RECORD-TYPE.        04280025
038600*                                    ABCDE-DT-RECORD-TYPE         04290025
038700*    MOVE  'A'                   TO  ABCDE-AT-RECORD-TYPE         04300025
038800     MOVE  'A'                   TO  ABCDE-FD-RETURNS-RECORD-TYPE 04310025
038900                                     ABCDE-FD-SALES-RECORD-TYPE.  04320025
039000     MOVE  PC-MT-HARDCODE-ONE    TO  ABCDE-MT-HARDCODE-ONE.       04330025
039000     MOVE  PC-MT-HARDCODE-ONE-A  TO  ABCDE-MT-HARDCODE-ONE-A.     04331038
039100*    MOVE  PC-DT-HARDCODE-ONE    TO  ABCDE-DT-HARDCODE-ONE.       04340025
039200*    MOVE  PC-AT-HARDCODE-ONE    TO  ABCDE-AT-HARDCODE-ONE.       04350025
039300     MOVE  PC-FD-RETURNS-HARDCODE-ONE                             04360025
039400                                 TO ABCDE-FD-RETURNS-HARDCODE-ONE.04370025
039300     MOVE  PC-FD-RETURNS-HARDCODE-TWO                             04371036
039400                                 TO ABCDE-FD-RETURNS-HARDCODE-TWO.04372036
039500     MOVE  PC-FD-SALES-HARDCODE-ONE                               04380025
039600                                 TO  ABCDE-FD-SALES-HARDCODE-ONE. 04390025
039500     MOVE  PC-FD-SALES-HARDCODE-TWO                               04391036
039600                                 TO  ABCDE-FD-SALES-HARDCODE-TWO. 04392036
039700     MOVE  XST00001-ST-CDE       TO  ABCDE-MT-STATE.              04400025
039800*                                    ABCDE-DT-STATE               04410025
039900*                                    ABCDE-DT-STATE2.             04420025
040000     MOVE  PC-MT-HARDCODE-TWO    TO  ABCDE-MT-HARDCODE-TWO.       04430025
040000     MOVE  PC-MT-HARDCODE-TWO-A  TO  ABCDE-MT-HARDCODE-TWO-A.     04431038
040100*    MOVE  PC-DT-HARDCODE-TWO    TO  ABCDE-DT-HARDCODE-TWO.       04440025
040200     MOVE  XST00001-LOC-NBR      TO  ABCDE-MT-STORE-NBR2.         04450025
040300     MOVE  PC-MT-HARDCODE-THREE  TO  ABCDE-MT-HARDCODE-THREE.     04460025
040400*    MOVE  PC-DT-HARDCODE-THREE  TO  ABCDE-DT-HARDCODE-THREE.     04470025
040500*    MOVE  PC-DT-HARDCODE-FOUR   TO  ABCDE-DT-HARDCODE-FOUR.      04480025
040600     MOVE  PC-MT-HARDCODE-FOUR   TO  ABCDE-MT-HARDCODE-FOUR.      04490025
040700*    MOVE  PC-DT-HARDCODE-FIVE   TO  ABCDE-DT-HARDCODE-FIVE.      04500025
040800     MOVE  PC-MT-HARDCODE-FIVE   TO  ABCDE-MT-HARDCODE-FIVE.      04510025
040900*    MOVE  PC-DT-HARDCODE-51     TO  ABCDE-DT-HARDCODE-51.        04520025
041000*    MOVE  PC-DT-HARDCODE-SIX    TO  ABCDE-DT-HARDCODE-SIX.       04530025
041100     MOVE  PC-MT-HARDCODE-SIX    TO  ABCDE-MT-HARDCODE-SIX.       04540025
041200     MOVE  PC-MT-HARDCODE-SEVEN  TO  ABCDE-MT-HARDCODE-SEVEN.     04550025
041300*    MOVE  PC-DT-HARDCODE-SEVEN  TO  ABCDE-DT-HARDCODE-SEVEN.     04560025
041400     MOVE  PC-MT-HARDCODE-EIGHT  TO  ABCDE-MT-HARDCODE-EIGHT.     04570025
041500*    MOVE  PC-DT-HARDCODE-EIGHT  TO  ABCDE-DT-HARDCODE-EIGHT.     04580025
041600*    MOVE  PC-DT-HARDCODE-NINE   TO  ABCDE-DT-HARDCODE-NINE.      04590025
041700*    MOVE  PC-DT-HARDCODE-TEN    TO  ABCDE-DT-HARDCODE-TEN.       04600025
041800     MOVE  SPACES                TO  ABCDE-MT-FILLER.             04610025
041900*    MOVE  SPACES                TO  ABCDE-AT-FILLER.             04620025
042000     MOVE  SPACES                TO  ABCDE-FD-RETURNS-FILLER      04630025
042100                                     ABCDE-FD-SALES-FILLER.       04640025
042200     MOVE  XST00025-BNKCRD-MERCH-NBR                              04650077
042300                                 TO  ABCDE-MT-MERCHANT-100        04660025
042400                                     ABCDE-MT-MERCHANT-101        04670025
042500                                     ABCDE-MT-MERCHANT-102        04680025
042600                                     ABCDE-MT-MERCHANT-105        04690025
042700                                     ABCDE-MT-MERCHANT-104        04700025
042800                                     ABCDE-MT-MERCHANT-106.       04710075
042900*    MOVE  XST00025-DSCVR-MERCH-NBR                               04720025
043000*                                TO  ABCDE-DT-MERCHANT-NBR.       04730025
043100*    MOVE  XST00025-AMEX-MERCH-NBR                                04740025
043200*                                TO  ABCDE-AT-MERCHANT-NBR.       04750025
043300     MOVE  PV-FD-MERCHANT-ID     TO  ABCDE-FD-RETURNS-MERCHANT-NBR04760025
043400                                     ABCDE-FD-SALES-MERCHANT-NBR. 04770025
043500                                                                  04780025
043600****************************************************              04790025
043700*    FORMAT ZIP CODE FOR DISCOVER MERCHANT RECORD                 04800025
043800* IN XST_LOC, THE ZIP CODE CAN BE IN ONE OF THE FOLLOWING         04810025
043900* FORMATS:                                                        04820025
044000*  1. 53227-1234                                                  04830025
044100*  2. 53227_____                                                  04840025
044200*  3. 532270000_                                                  04850025
044300*  4. 532271234_                                                  04860025
044400* THE DISCOVER RECORD NEEDS IT IN 532271234 PIC X(9)              04870025
044500* FORMAT.                                                         04880025
044600****************************************************              04890025
044700     MOVE 1 TO PV-SUB.                                            04900025
044800     MOVE 1 TO PV-SUB-DEST.                                       04910025
044900     MOVE XST00001-ZIP-10-CDE TO PT-ADDRESS-FIELD.                04920025
045000     PERFORM UNTIL PV-SUB-DEST = 10                               04930025
045100         IF (PT-ADDR-TABLE (PV-SUB) = '-')                        04940025
045200            ADD +1 TO PV-SUB                                      04950025
045300         END-IF                                                   04960025
045400         IF (PT-ADDR-TABLE (PV-SUB) = ' ')                        04970025
045500            MOVE '0' TO PT-ADDR-TABLE (PV-SUB)                    04980025
045600         END-IF                                                   04990025
045700         MOVE PT-ADDR-TABLE (PV-SUB) TO                           05000025
045800                PT-ADDR-TABLE-OUT (PV-SUB-DEST)                   05010025
045900         ADD +1 TO PV-SUB                                         05020025
046000         ADD +1 TO PV-SUB-DEST                                    05030025
046100     END-PERFORM.                                                 05040025
046200                                                                  05050025
046300*    MOVE PT-ADDRESS-FIELD-OUT TO ABCDE-DT-ZIPPLUS4               05060025
046400*                             ABCDE-DT-ZIPPLUS4A.                 05070025
046500* ALSO MOVE ZIP TO 5 DIGIT ZIP FOR STORE TABLE *                  05080025
046600     MOVE PT-ADDRESS-FIELD-OUT TO ABCDE-ST-ZIPCODE.               05090025
046600     MOVE PT-ADDRESS-FIELD-OUT TO ABCDE-MT-ZIPCODE.               05091038
046700                                                                  05100025
046800****************************************************              05110025
046900*    FILL DISCOVER MALL NAME                                      05120025
047000* PACK WITH UNDERSCORES                                           05130025
047100****************************************************              05140025
047200     MOVE XST00001-LNE-1-ADDR                                     05150025
047300                                 TO PT-ADDRESS-FIELD.             05160025
047400     MOVE PC-UNDER-SCORE         TO  PT-ADDRESS-FIELD-OUT.        05170025
047500     MOVE 1                      TO  PV-SUB                       05180025
047600                                                                  05190025
047700     PERFORM UNTIL PV-SUB >  23                                   05200025
047800         IF PT-ADDR-TABLE (PV-SUB) > SPACES                       05210025
047900             MOVE PT-ADDR-TABLE (PV-SUB)                          05220025
048000                                 TO  PT-ADDR-TABLE-OUT (PV-SUB)   05230025
048100         END-IF                                                   05240025
048200         ADD +1                  TO PV-SUB                        05250025
048300     END-PERFORM.                                                 05260025
048400                                                                  05270025
048500*    MOVE  PT-ADDRESS-FIELD-OUT  TO  ABCDE-DT-MALLNAME.           05280025
048600                                                                  05290025
048700****************************************************              05300025
048800*    FILL MPS ADDRESS INFO                                        05310025
048900* SINCE SHOPPING MALL NAME CAN BE IN ADDRESS LINE 1,              05320025
049000* WE WANT TO USE ADDRESS LINE 2 IF IT HAS THE USEFUL              05330025
049100* ADDRESS INFO IN IT, OTHERWISE USE ADDRESS LINE ONE.             05340025
049200* WE ARE CHECKING POSITIONS 9 AND 10 FOR SPACES, BECAUSE          05350025
049300* SOMETIMES LINE 2 ONLY HAS THE LEFTOVER WORD 'ROAD' ETC          05360025
049400* WHEREAS USEFUL ADDRESSES CONTINUE INTO POS 9 AND 10.            05370025
049500* ALSO CHECK FIRST 2 LETTERS OF ADDR LINE 2.                      05380025
049600* IF ADDR LINE 2 IS ANY OF THE FOLLOWING, THEN USE                05390025
049700* ADDR LINE1.                                                     05400025
049800* & , SUITE, STE, LOT, SPACE, TPKE, SILVER SPRING                 05410025
049900****************************************************              05420025
050000     MOVE XST00001-LNE-2-ADDR                                     05430025
050100                                 TO PT-ADDRESS-FIELD.             05440025
050200     MOVE XST00001-LNE-2-ADDR                                     05450025
050300                                 TO PV-VERIFY-ADDR2.              05460025
050400     IF (PT-ADDR-TABLE (9) <= SPACES AND                          05470025
050500        PT-ADDR-TABLE (10) <= SPACES)                             05480025
050600        OR PV-VERIFY-ADDR2 = '& '                                 05490025
050700        OR PV-VERIFY-ADDR2 = 'ST'                                 05500025
050800        OR PV-VERIFY-ADDR2 = 'SU'                                 05510025
050900        OR PV-VERIFY-ADDR2 = 'LO'                                 05520025
051000        OR PV-VERIFY-ADDR2 = 'SP'                                 05530025
051100        OR PV-VERIFY-ADDR2 = 'TP'                                 05540025
051200        OR PV-VERIFY-ADDR2 = 'SI'                                 05550025
051300         MOVE XST00001-LNE-1-ADDR                                 05560025
051400                                 TO PT-ADDRESS-FIELD              05570025
051500     END-IF.                                                      05580025
051600                                                                  05590025
051700                                                                  05600025
051800     MOVE PC-UNDER-SCORE         TO  PT-ADDRESS-FIELD-OUT.        05610025
051900                                                                  05620025
052000     MOVE 1                      TO  PV-SUB                       05630025
052100                                                                  05640025
052200     PERFORM UNTIL PV-SUB >  23                                   05650025
052300         IF PT-ADDR-TABLE (PV-SUB) > SPACES                       05660025
052400             MOVE PT-ADDR-TABLE (PV-SUB)                          05670025
052500                                 TO  PT-ADDR-TABLE-OUT (PV-SUB)   05680025
052600         END-IF                                                   05690025
052700         ADD +1                  TO PV-SUB                        05700025
052800     END-PERFORM.                                                 05710025
052900                                                                  05720025
053000     MOVE  PT-ADDRESS-FIELD-OUT  TO  ABCDE-MT-ADDRESS.            05730025
053100*    MOVE  PT-ADDRESS-FIELD-OUT  TO  ABCDE-DT-ADDRESS.            05740025
053200                                                                  05750025
053300*    **** FILL CITY NAME WITH UNDERSCORES ***                     05760025
053400                                                                  05770025
053500     MOVE  XST00001-CTY-NM       TO  PT-CITY-FIELD.               05780025
053500     MOVE  XST00001-CTY-NM       TO  ABCDE-MT-CITY2.              05781063
053600     MOVE PC-UNDER-SCORE         TO  PT-CITY-FIELD-OUT.           05790025
053700     MOVE 1                      TO  PV-SUB                       05800025
053800     PERFORM UNTIL PV-SUB >  13                                   05810025
053900         IF PT-CITY-TBL   (PV-SUB) > SPACES                       05820025
054000             MOVE PT-CITY-TBL   (PV-SUB)                          05830025
054100                                 TO  PT-CITY-TBL-OUT (PV-SUB)     05840025
054200         END-IF                                                   05850025
054300         ADD +1                  TO PV-SUB                        05860025
054400     END-PERFORM.                                                 05870025
054500                                                                  05880025
054600     MOVE  PT-CITY-FIELD-OUT     TO  ABCDE-MT-CITY.               05890025
054700*                                    ABCDE-DT-CITY                05900025
054800*                                    ABCDE-DT-CITY2.              05910025
054900     PERFORM 3000-WRITE-MERCHANT-FILE.                            05920025
055000                                                                  05930025
055100     PERFORM 4000-WRITE-STORE-FILE.                               05940025
055200                                                                  05950025
055300     PERFORM 1050-FETCH-STORE-EXTR-CSR.                           05960025
055400                                                                  05970031
055500*----------------------------------------------------------------*05980031
055600* FIX-SPECIAL-CHARACTERS                                          05990031
055700*    REMOVE PERIODS AND COMMAS FROM XST_LOC FIELDS                06000031
056000*----------------------------------------------------------------*06010031
056100 2100-REMOVE-SPECIAL-CHARACTERS.                                  06020032
056200                                                                  06030031
056200*  REMOVE PERIODS AND COMMAS FROM ADDERS AND CITY                 06040031
030200     INSPECT XST00001-LNE-1-ADDR REPLACING ALL "." BY " ".        06050031
030200     INSPECT XST00001-LNE-1-ADDR REPLACING ALL "," BY " ".        06060031
030300     INSPECT XST00001-LNE-2-ADDR REPLACING ALL "." BY " ".        06070031
030300     INSPECT XST00001-LNE-2-ADDR REPLACING ALL "," BY " ".        06080031
030400     INSPECT XST00001-CTY-NM     REPLACING ALL "." BY " ".        06090031
030400     INSPECT XST00001-CTY-NM     REPLACING ALL "," BY " ".        06100031
030400     INSPECT XST00001-LOC-NM     REPLACING ALL "." BY " ".        06101038
030400     INSPECT XST00001-LOC-NM     REPLACING ALL "," BY " ".        06102038
055400                                                                  06110031
056200*  REMOVE INITIAL SPACE FROM ADDERS                               06120031
055400     IF XST00001-LNE-1-ADDR(1:1) = " "                            06130031
052700        MOVE +1                   TO PV-SUB                       06140031
052200        PERFORM UNTIL PV-SUB >  22                                06150031
055400           MOVE XST00001-LNE-1-ADDR(PV-SUB + 1:1) TO              06160031
055400                              XST00001-LNE-1-ADDR(PV-SUB:1)       06170031
052700           ADD +1                  TO PV-SUB                      06180031
052800        END-PERFORM                                               06190031
           END-IF.                                                      06200031
055400                                                                  06210031
055400     IF XST00001-LNE-2-ADDR(1:1) = " "                            06220031
052700        MOVE +1                   TO PV-SUB                       06230031
052200        PERFORM UNTIL PV-SUB >  22                                06240031
055400           MOVE XST00001-LNE-2-ADDR(PV-SUB + 1:1) TO              06250031
055400                              XST00001-LNE-2-ADDR(PV-SUB:1)       06260031
052700           ADD +1                  TO PV-SUB                      06270031
052800        END-PERFORM                                               06280031
           END-IF.                                                      06290031
055500*----------------------------------------------------------------*06300025
055600* WRITE-MERCHANT-FILE                                            *06310025
055700*             WRITE THE MERCHANT FILE WITH AN 'A' IN RECORD TYPE *06320025
055800*             THEN MOVE A 'B' INTO RECORD TYPE AND WRITE         *06330025
055900*             ANOTHER RECORD.                                    *06340025
056000*----------------------------------------------------------------*06350025
056100 3000-WRITE-MERCHANT-FILE.                                        06360025
056200                                                                  06370025
056300* WRITE OUT THE A NODE RECORDS                                    06380025
056400                                                                  06390025
      * GET RID OF SPACES IN CITY NAME FOR MPSCRD AJB RECORD LAYOUT     06390182
           MOVE FUNCTION REVERSE(ABCDE-MT-CITY-R1) TO ABCDE-MT-CITY-R1. 06390382
           INSPECT ABCDE-MT-CITY-R1 REPLACING LEADING SPACE BY "*".     06390482
           MOVE FUNCTION REVERSE(ABCDE-MT-CITY-R1) TO ABCDE-MT-CITY-R1. 06390582
           INSPECT ABCDE-MT-CITY-R1 REPLACING ALL SPACE BY "_".         06390682
                                                                        06390773
      * GET RID OF SPACES IN LOCATION NAME FOR FDRCRD ADN FDRRMO AJB    06390882
      * RECORD LAYOUT                                                   06390982
           MOVE FUNCTION REVERSE(ABCDE-FD-RETURNS-LOC-NM-R2)            06391082
                                         TO ABCDE-FD-RETURNS-LOC-NM-R2. 06391182
           INSPECT ABCDE-FD-RETURNS-LOC-NM-R2                           06391282
                                    REPLACING LEADING SPACE BY "*".     06391382
           MOVE FUNCTION REVERSE(ABCDE-FD-RETURNS-LOC-NM-R2)            06391482
                                         TO ABCDE-FD-RETURNS-LOC-NM-R2. 06391582
           INSPECT ABCDE-FD-RETURNS-LOC-NM-R2                           06391682
                                    REPLACING ALL SPACE BY "_".         06391782
           MOVE ABCDE-FD-RETURNS-LOC-NM-R2 TO ABCDE-FD-SALES-LOC-NM-R2. 06391882
                                                                        06391982
           INITIALIZE WS-MPS-TABLE                                      06392082
                      WS-FDRCRD-TABLE                                   06392182
                      WS-FDRRMO-TABLE.                                  06392282
           STRING                                                       06392382
                 ABCDE-MT-FIELD-SET1    DELIMITED BY SIZE               06392482
                 ABCDE-MT-CITY-R1       DELIMITED BY "*"                06393073
                 ABCDE-MT-FIELD-SET2    DELIMITED BY SIZE               06394053
           INTO  WS-MPS-TABLE.                                          06395073
                                                                        06395179
           STRING                                                       06395279
                 ABCDE-FD-RETURNS-SET1          DELIMITED BY SIZE       06395379
                 ABCDE-FD-RETURNS-REC-TYP-R2    DELIMITED BY SIZE       06395479
                 ABCDE-FD-RETURNS-HRDCDE-ONE-R2 DELIMITED BY SIZE       06395579
                 ABCDE-FD-RETURNS-LOC-NM-R2     DELIMITED BY "*"        06395679
                 ABCDE-FD-RETURNS-SET2          DELIMITED BY SIZE       06395779
           INTO  WS-FDRRMO-TABLE.                                       06395879
                                                                        06395979
           STRING                                                       06396079
                 ABCDE-FD-SALES-SET1            DELIMITED BY SIZE       06396179
                 ABCDE-FD-SALES-REC-TYP-R2      DELIMITED BY SIZE       06396279
                 ABCDE-FD-SALES-HRDCDE-ONE-R2   DELIMITED BY SIZE       06396379
                 ABCDE-FD-SALES-LOC-NM-R2       DELIMITED BY "*"        06396479
                 ABCDE-FD-SALES-SET2            DELIMITED BY SIZE       06396579
           INTO  WS-FDRCRD-TABLE.                                       06396679
                                                                        06396779
           WRITE MERCHANT-TABLE-RECORD FROM WS-MPS-TABLE.               06396879
           WRITE MERCHANT-TABLE-RECORD FROM WS-FDRRMO-TABLE.            06396979
           WRITE MERCHANT-TABLE-RECORD FROM WS-FDRCRD-TABLE.            06397079
                                                                        06398079
056500*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-MPS-MER-TABLE.        06400047
056600*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-DISC-MER-TABLE.       06410025
056700*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-AMEX-MER-TABLE.       06420025
056800*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-FD-RETURNS-MER-TABLE. 06430079
056900*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-FD-SALES-MER-TABLE.   06440079
057000                                                                  06450025
057100* WRITE OUT THE B NODE RECORDS                                    06460025
057200                                                                  06470025
057300     MOVE  'B'                   TO  ABCDE-MT-RECORD-TYPE.        06480025
057400*    MOVE  'B'                   TO  ABCDE-AT-RECORD-TYPE.        06490025
057500*    MOVE  'B'                   TO  ABCDE-DT-RECORD-TYPE.        06500025
057600     MOVE  'B'                   TO  ABCDE-FD-RETURNS-RECORD-TYPE 06510025
057700                                     ABCDE-FD-SALES-RECORD-TYPE   06520079
                                           WS-FDRRMO-TABLE(14:1)        06521079
                                           WS-FDRCRD-TABLE(14:1).       06522079
057800                                                                  06530025
           INITIALIZE WS-MPS-TABLE.                                     06531050
           STRING                                                       06536151
                 ABCDE-MT-FIELD-SET1    DELIMITED BY SIZE               06536251
                 ABCDE-MT-CITY-R1       DELIMITED BY "*"                06536573
                 ABCDE-MT-FIELD-SET2    DELIMITED BY SIZE               06536653
           INTO  WS-MPS-TABLE.                                          06536951
           WRITE MERCHANT-TABLE-RECORD FROM WS-MPS-TABLE.               06537047
           WRITE MERCHANT-TABLE-RECORD FROM WS-FDRRMO-TABLE.            06537180
           WRITE MERCHANT-TABLE-RECORD FROM WS-FDRCRD-TABLE.            06537280
                                                                        06538047
057900*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-MPS-MER-TABLE.        06540047
058000*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-DISC-MER-TABLE.       06550025
058100*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-AMEX-MER-TABLE.       06560025
058200*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-FD-RETURNS-MER-TABLE. 06570080
058300*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-FD-SALES-MER-TABLE.   06580080
058400                                                                  06590025
058410* WRITE OUT THE PAYMENT GATEWAY NODE RECORDS                      06600025
058500                                                                  06610025
SJK510     MOVE XST00001-LOC-NBR       TO  ABCDE-PG-MT-STORE-NBR.       06620060
058520*                                    ABCDE-PG-FD-RTRNS-STORE-NBR  06630045
058530*                                    ABCDE-PG-FD-SLS-STORE-NBR.   06640045
058540*                                                                 06650045
058540     MOVE ABCDE-MT-DETAIL         TO  ABCDE-PG-MT-DETAIL.         06660060
058540*    MOVE ABCDE-FD-RETURNS-DETAIL TO  ABCDE-PG-FD-RTRNS-DETAIL.   06670045
058540*    MOVE ABCDE-FD-SALES-DETAIL   TO  ABCDE-PG-FD-SLS-DETAIL.     06680045
058540*                                                                 06690045
058550*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-PG-MPS-MER-TABLE.     06700045
058560*    WRITE MERCHANT-TABLE-RECORD                                  06710045
      *                                FROM ABCDE-PG-FD-RTRNS-MER-TABLE.06720045
058570*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-PG-FD-SLS-MER-TABLE.  06730045
058580*                                                                 06740045
058540*                                                                 06740146
058540* USE REDIFINITION SO THE STORE NUMBER APPREARS WITH 'F'          06740246
058540*                                                                 06740346
057300     MOVE  ' '                   TO  ABCDE-MT-RECORD-TYPE.        06740446
057400*    MOVE  ' '                   TO  ABCDE-AT-RECORD-TYPE.        06740546
057500*    MOVE  ' '                   TO  ABCDE-DT-RECORD-TYPE.        06740646
057600     MOVE  ' '                   TO  ABCDE-FD-RETURNS-RECORD-TYPE 06740746
057700                                     ABCDE-FD-SALES-RECORD-TYPE.  06740846
057800                                                                  06740946
SJK510     MOVE XST00001-LOC-NBR       TO   ABCDE-MT-STORE-NBR          06741046
058520                                      ABCDE-FD-RETURNS-STORE-NBR  06742046
058530                                      ABCDE-FD-SALES-STORE-NBR.   06743046
058540     MOVE ABCDE-MT-DETAIL         TO  ABCDE-MT-DETAIL.            06745045
058540     MOVE ABCDE-FD-RETURNS-DETAIL TO  ABCDE-FD-RETURNS-DETAIL.    06746045
058540     MOVE ABCDE-FD-SALES-DETAIL   TO  ABCDE-FD-SALES-DETAIL.      06747045
058540                                                                  06748045
                                                                        06748568
           INITIALIZE WS-PG-MPS-TABLE                                   06749080
                      WS-FDRCRD-TABLE                                   06749180
                      WS-FDRRMO-TABLE.                                  06749280
           STRING                                                       06749363
                 ABCDE-PG-MT-FIRST-FIELD DELIMITED BY SIZE              06749463
                 ABCDE-PG-MT-STORE-NBR   DELIMITED BY SIZE              06749563
                 ABCDE-MT-FIELD-R2-SET2  DELIMITED BY SIZE              06749663
                 ABCDE-MT-CITY-R2        DELIMITED BY "*"               06749773
                 ABCDE-MT-FIELD-R2-SET3 DELIMITED BY SIZE               06749870
           INTO  WS-PG-MPS-TABLE.                                       06749976
                                                                        06750170
           STRING                                                       06750280
                 ABCDE-FD-RETURNS-SET1          DELIMITED BY SIZE       06750380
                 ABCDE-FD-RETURNS-HRDCDE-ONE-R2 DELIMITED BY SIZE       06750580
                 ABCDE-FD-RETURNS-LOC-NM-R2     DELIMITED BY "*"        06750680
                 ABCDE-FD-RETURNS-SET2          DELIMITED BY SIZE       06750780
           INTO  WS-FDRRMO-TABLE.                                       06750880
                                                                        06750980
           STRING                                                       06751080
                 ABCDE-FD-SALES-SET1            DELIMITED BY SIZE       06751180
                 ABCDE-FD-SALES-HRDCDE-ONE-R2   DELIMITED BY SIZE       06751380
                 ABCDE-FD-SALES-LOC-NM-R2       DELIMITED BY "*"        06751480
                 ABCDE-FD-SALES-SET2            DELIMITED BY SIZE       06751580
           INTO  WS-FDRCRD-TABLE.                                       06751680
                                                                        06751780
           WRITE MERCHANT-TABLE-RECORD FROM WS-PG-MPS-TABLE.            06751880
           WRITE MERCHANT-TABLE-RECORD FROM WS-FDRRMO-TABLE.            06751980
           WRITE MERCHANT-TABLE-RECORD FROM WS-FDRCRD-TABLE.            06752080
                                                                        06752180
058550*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-PG-MPS-MER-TABLE.     06752270
058560*    WRITE MERCHANT-TABLE-RECORD                                  06752380
      *                                FROM ABCDE-FD-RETURNS-MER-TABLE. 06752480
058570*    WRITE MERCHANT-TABLE-RECORD FROM ABCDE-FD-SALES-MER-TABLE.   06752580
058580                                                                  06752670
058600*----------------------------------------------------------------*06753025
058700* WRITE-STORE-FILE                                               *06760025
058800*             WRITE THE STORE    FILE WITH AN 'A' IN RECORD TYPE *06770025
058900*             THEN MOVE A 'B' INTO RECORD TYPE AND WRITE         *06780025
059000*             ANOTHER RECORD.                                    *06790025
059100*----------------------------------------------------------------*06800025
059200 4000-WRITE-STORE-FILE.                                           06810025
059300                                                                  06820025
059400* WRITE OUT THE A NODE RECORDS                                    06830025
059500                                                                  06840025
059600     WRITE STORE-TABLE-RECORD    FROM ABCDE-STORE-TABLE.          06850025
059700                                                                  06860025
059800* WRITE OUT THE B NODE RECORDS                                    06870025
059900                                                                  06880025
060000     MOVE  'B'                   TO  ABCDE-ST-RECORD-TYPE.        06890025
060200     WRITE STORE-TABLE-RECORD    FROM ABCDE-STORE-TABLE.          06900025
060300                                                                  06910025
060310* WRITE OUT THE PAYMENT GATEWAY NODE RECORDS                      06920025
060320                                                                  06930025
060330     MOVE XST00001-LOC-NBR       TO ABCDE-ST-PG-STORE-NBR.        06940025
060331     MOVE PC-ST-PG-HARDCODE-1    TO  ABCDE-ST-HARDCODE-1.         06950025
060340     WRITE STORE-TABLE-RECORD    FROM ABCDE-STORE-TABLE.          06960025
060350                                                                  06970025
060400*----------------------------------------------------------------*06980025
060500*    DB2 ERROR                                                   *06990025
060600*      PERFORMED ONLY VIA (1000-OPEN-STORE-EXTR-CSR )            *07000025
060700*                     VIA (1050-FETCH-STORE-EXTR-CSR)            *07010025
060800*                     VIA (1070-CLOSE-STORE-EXTR-CSR)            *07020025
060900*    FUNCTION: HANDLE DB2 ERRORS                                 *07030025
061000*----------------------------------------------------------------*07040025
061100 9400-DB2-ERROR.                                                  07050025
061200                                                                  07060025
061300     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER.                    07070025
061400     DISPLAY PC-DB-ERROR-PREFIX                                   07080025
061500     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             07090025
061600     COPY DPPD004.                                                07100025
061700     SET ABEND-4013-DB2-ERROR TO TRUE.                            07110025
061800     CALL 'ILBOABN0' USING ABEND-CODE.                            07120025
061900     EJECT                                                        07130025
