000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TXKUT052.                                         00020000
000300 AUTHOR.        DANIEL OKYERE.                                    00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10/2007.                                          00050000
000600 DATE-COMPILED. 10/2007.                                          00060000
000700******************************************************************00070000
000800*                                                                *00080000
000900*  THIS PROGRAM READS E-COMMERCE NEW YORK TRANSACTIONS           *00090000
001000*  ASSIGNS CITY AND COUNTY BASED ZIPGEO FILE FROM TAXWARE        *00100000
001100*  AND SPLITS TRANSACTIONS INTO DETAIL TRANSACTIONS FOR SCHEDULES*00110000
001200*                                                                *00120000
001300******************************************************************00130000
SEPHOR* CHANGE LOG:                                                    *00140006
SEPHOR*  04/28/2022                                                    *00140106
SEPHOR*     CHANGE MADE: ADDED SEPHORA DEPT 712 TO NOT BE WRITTEN OUT  *00140206
SEPHOR*     TO THE OUTPUT FILE.                                        *00140306
SEPHOR*  MADE BY: BARB SCHULTZ               WR/IR#: CHG0269533        *00140411
SEPHOR******************************************************************00140506
001400 ENVIRONMENT DIVISION.                                            00141006
001500*                                                                 00150000
001600 CONFIGURATION SECTION.                                           00160000
001700 SOURCE-COMPUTER. IBM-3090.                                       00170000
001800 OBJECT-COMPUTER. IBM-3090.                                       00180000
001900*                                                                 00190000
002000 INPUT-OUTPUT SECTION.                                            00200000
002100 FILE-CONTROL.                                                    00210000
002200                                                                  00220000
002300     SELECT TAX-IN-FILE                                           00230000
002400         ASSIGN                       TO INP01.                   00240000
002500* output files                                                    00250000
002600     SELECT TAX-SCHA-FILE                                         00260000
002700         ASSIGN                       TO SCHA.                    00270000
002800                                                                  00280000
002900     SELECT TAX-SCHB-FILE                                         00290000
003000         ASSIGN                       TO SCHB.                    00300000
003100                                                                  00310000
003200     SELECT TAX-SCHB1-FILE                                        00320000
003300         ASSIGN                       TO SCHB1.                   00330000
003400                                                                  00340000
003500     SELECT TAX-SCH810-FILE                                       00350000
003600         ASSIGN                       TO SCH810.                  00360000
003700* data to load in working-storage lookup tables                   00370000
003800     SELECT COUNTY-FILE                                           00380000
003900         ASSIGN                       TO COUNTY.                  00390000
004000                                                                  00400000
004100     SELECT ZIPGEO-FILE                                           00410000
004200         ASSIGN                       TO ZIPGEO.                  00420000
004300                                                                  00430000
004400     SELECT POS-DATE-CARD-FILE                                    00440000
004500         ASSIGN TO INP02.                                         00450000
004600*---------------------------------------------------------------* 00460000
004700 DATA DIVISION.                                                   00470000
004800*---------------------------------------------------------------* 00480000
004900*                                                                 00490000
005000 FILE SECTION.                                                    00500000
005100*                                                                 00510000
005200 FD  TAX-IN-FILE                                                  00520000
005300     RECORDING MODE IS F                                          00530000
005400     LABEL RECORDS ARE STANDARD                                   00540000
005500     BLOCK CONTAINS 0 RECORDS                                     00550000
005600     RECORD CONTAINS 200 CHARACTERS                               00560000
005700     DATA RECORD IS TX-TAX-IN-FILE.                               00570000
005800                                                                  00580000
005900 01  TX-TAX-IN-FILE              PIC X(200).                      00590000
006000*                                                                 00600000
006100 FD  POS-DATE-CARD-FILE                                           00610000
006200     RECORDING MODE IS F                                          00620000
006300     BLOCK CONTAINS 0 RECORDS                                     00630000
006400     LABEL RECORDS ARE STANDARD.                                  00640000
006500                                                                  00650000
006600 01  POS-DATE-CARD-RECORD            PIC X(80).                   00660000
006700                                                                  00670000
006800*                                                                 00680000
006900 FD  TAX-SCHA-FILE                                                00690000
007000     RECORDING MODE IS F                                          00700000
007100     LABEL RECORDS ARE STANDARD                                   00710000
007200     BLOCK CONTAINS 0 RECORDS                                     00720000
007300     RECORD CONTAINS 220 CHARACTERS                               00730000
007400     DATA RECORD IS TAX-SCHA-REC.                                 00740000
007500                                                                  00750000
007600* record comma delimited                                          00760000
007700 01  TAX-SCHA-REC                PIC X(220).                      00770000
007800                                                                  00780000
007900* less $55                                                        00790000
008000 FD  TAX-SCHB-FILE                                                00800000
008100     RECORDING MODE IS F                                          00810000
008200     LABEL RECORDS ARE STANDARD                                   00820000
008300     BLOCK CONTAINS 0 RECORDS                                     00830000
008400     RECORD CONTAINS 220 CHARACTERS                               00840000
008500     DATA RECORD IS TAX-SCHB-REC.                                 00850000
008600 01  TAX-SCHB-REC                PIC X(220).                      00860000
008700                                                                  00870000
008800* between $55 and $110                                            00880000
008900 FD  TAX-SCHB1-FILE                                               00890000
009000     RECORDING MODE IS F                                          00900000
009100     LABEL RECORDS ARE STANDARD                                   00910000
009200     BLOCK CONTAINS 0 RECORDS                                     00920000
009300     RECORD CONTAINS 220 CHARACTERS                               00930000
009400     DATA RECORD IS TAX-SCHB1-REC.                                00940000
009500 01  TAX-SCHB1-REC               PIC X(220).                      00950000
009600*                                                                 00960000
009700 FD  TAX-SCH810-FILE                                              00970000
009800     RECORDING MODE IS F                                          00980000
009900     LABEL RECORDS ARE STANDARD                                   00990000
010000     BLOCK CONTAINS 0 RECORDS                                     01000000
010100     RECORD CONTAINS 220 CHARACTERS                               01010000
010200     DATA RECORD IS TAX-SCH810-REC.                               01020000
010300                                                                  01030000
010400 01  TAX-SCH810-REC              PIC X(220).                      01040000
010500*                                                                 01050000
010600 FD  COUNTY-FILE                                                  01060000
010700     RECORDING MODE IS F                                          01070000
010800     LABEL RECORDS ARE STANDARD                                   01080000
010900     BLOCK CONTAINS 0 RECORDS                                     01090000
011000     RECORD CONTAINS 132 CHARACTERS                               01100000
011100     DATA RECORD IS COUNTY-REC.                                   01110000
011200 01  COUNTY-REC                  PIC X(132).                      01120000
011300*                                                                 01130000
011400 FD  ZIPGEO-FILE                                                  01140000
011500     RECORDING MODE IS F                                          01150000
011600     LABEL RECORDS ARE STANDARD                                   01160000
011700     BLOCK CONTAINS 0 RECORDS                                     01170000
011800     RECORD CONTAINS 80 CHARACTERS                                01180000
011900     DATA RECORD IS ZIPGEO-REC.                                   01190000
011910 01  ZIPGEO-REC.                                                  01191000
011920     05  ZIPGEO-ZIP-GEO.                                          01192000
012100        07  ZIPGEO-ZIP-CDE          PIC X(5).                     01210000
012200        07  ZIPGEO-GEO-CDE          PIC X(2).                     01220000
012300     05  ZIPGEO-COUNTY-CDE          PIC X(3).                     01230000
012400     05  ZIPGEO-COUNTY-NAME         PIC X(26).                    01240000
012500     05  ZIPGEO-CITY-NAME           PIC X(26).                    01250000
012600     05  FILLER                     PIC X(18).                    01260000
012700                                                                  01270000
012800*---------------------------------------------------------------* 01280000
012900 WORKING-STORAGE SECTION.                                         01290000
013000*---------------------------------------------------------------* 01300000
013100                                                                  01310000
013200******************************************************************01320000
013300* RECORD LAYOUT FOR INPUT DATE CARD                               01330000
013400* LISTS THE FIRST AND LAST DAYS OF THE FISCAL PERIOD.             01340000
013500* LAYOUT:   CCYYMMDD CCYYMMDD                                     01350000
013600******************************************************************01360000
013700 01  CC-DATE-CARD.                                                01370000
013800     05  CC-RPT-TYPE                    PIC X(01).                01380000
013900         88 CC-RPT-810                            VALUE 'T'.      01390000
014000         88 CC-RPT-SCHA                           VALUE 'A'.      01400000
014100         88 CC-RPT-SCHB                           VALUE 'B'.      01410000
014200     05  CC-TO-DATE                     PIC X(08) VALUE SPACES.   01420000
014300     05  FILLER                         PIC X(71) VALUE SPACES.   01430000
014400****************************************************************  01440000
014500* RECORD LAYOUT FOR INPUT TAX FILE                                01450000
014600****************************************************************  01460000
014700     COPY TXRD006.                                                01470000
014800*                                                                 01480000
014900****************************************************************  01490000
015000* RECORD LAYOUT FOR OUTPUT TAX FILE                               01500000
015100****************************************************************  01510000
015200     COPY TXRD052.                                                01520000
015300*                                                                 01530000
015400 01  WS-ERROR-FIELDS.                                             01540000
015500     05 WS-MSG-TEXT                  PIC X(512).                  01550000
015600     05 WS-MAX-SIZE                  PIC S9(09) COMP              01560000
015700                                                 VALUE +512.      01570000
015800     05 WS-MSG-LENGTH                PIC S9(09) COMP.             01580000
015900     05 WS-ABEND-CODE                PIC S9(04) COMP SYNC         01590000
016000                                                VALUE ZEROS.      01600000
016100******************************************************************01610000
016200*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01620000
016300******************************************************************01630000
016400     COPY DPWS500.                                                01640000
016500                                                                  01650000
016600                                                                  01660000
016700 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01670000
016800                                                  COMP SYNC.      01680000
016900     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01690000
017000     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01700000
017100                                                                  01710000
017200 01 PV-PROGRAM-VARIABLES.                                         01720000
017300    05  PV-ABEND-PARAGRAPH     PIC X(40)  VALUE SPACES.           01730000
017400    05  PV-OPERATION-MSG-1     PIC  X(40)    VALUE SPACE.         01740000
017500    05  PV-READ-CNT            PIC 9(07)  COMP-3 VALUE ZEROES.    01750000
017600    05  PV-SKIP-CNT            PIC 9(07)  COMP-3 VALUE ZEROES.    01760000
017700    05  PV-OUT-CNT-SCHA        PIC 9(07)  COMP-3 VALUE ZEROES.    01770000
017800    05  PV-OUT-CNT-SCHB        PIC 9(07)  COMP-3 VALUE ZEROES.    01780000
017900    05  PV-OUT-CNT-SCHB1       PIC 9(07)  COMP-3 VALUE ZEROES.    01790000
018000    05  PV-OUT-CNT-SCH810      PIC 9(07)  COMP-3 VALUE ZEROES.    01800000
018100    05  PV-OUT-TAX-SCHA        PIC S9(8)V99 COMP-3 VALUE ZEROES.  01810000
018200    05  PV-OUT-TAX-SCHB        PIC S9(8)V99 COMP-3 VALUE ZEROES.  01820000
018300    05  PV-OUT-TAX-SCHB1       PIC S9(8)V99 COMP-3 VALUE ZEROES.  01830000
018400    05  PV-OUT-TAX-SCH810      PIC S9(8)V99 COMP-3 VALUE ZEROES.  01840000
018500    05  PV-OUT-SLS-SCHA        PIC S9(8)V99 COMP-3 VALUE ZEROES.  01850000
018600    05  PV-OUT-SLS-SCHB        PIC S9(8)V99 COMP-3 VALUE ZEROES.  01860000
018700    05  PV-OUT-SLS-SCHB1       PIC S9(8)V99 COMP-3 VALUE ZEROES.  01870000
018800    05  PV-OUT-SLS-SCH810      PIC S9(8)V99 COMP-3 VALUE ZEROES.  01880000
018900    05  PV-DISPLAY-CNT         PIC ZZZ,ZZZ,ZZ9.                   01890000
019000    05  PV-DISPLAY-AMT         PIC Z,ZZZ,ZZ9.99.                  01900000
019100    05  PV-DISPLAY-AMT2        PIC Z,ZZZ,ZZ9.99.                  01910000
019200    05  PV-SAVE-ZIP-CDE        PIC X(05)  VALUE SPACES.           01920000
019300    05  PV-SAVE-GEO-CDE        PIC X(02)  VALUE SPACES.           01930000
019400    05  PV-CURR-DATE-CCYYMMDD.                                    01940000
019500        10  PV-CURR-DATE-CCYY       PIC  9(04).                   01950000
019600        10  PV-CURR-DATE-MM         PIC  9(02).                   01960000
019700        10  PV-CURR-DATE-DD         PIC  9(02).                   01970000
019800    05  PV-CURR-TIME.                                             01980000
019900        10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.     01990000
020000        10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.     02000000
020100        10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.     02010000
020200    05  PV-RPT-ASX.                                               02020000
020300        10 PV-RPT-AS                PIC 9(3).                     02030000
020400    05  PV-SCH1A-ENACTED            PIC X.                        02040000
020500    05  PV-SCH1B-ENACTED            PIC X.                        02050000
020600    05  PV-LOCAL-RATEX.                                           02060000
020700        10 PV-LOCAL-RATE            PIC V9(5).                    02070000
020800    05  PV-MCTD-RATEX.                                            02080000
020900        10 PV-MCTD-RATE             PIC V9(5).                    02090000
021000    05  PV-TOTAL-RATE               PIC V9(5).                    02100000
021100    05  PV-TOTAL-MCTD-RATE          PIC V9(5).                    02110000
021200    05  PV-NY-MCTD-RATE             PIC V9(5).                    02120000
021300    05  PV-FIELD-FROM               PIC X(5).                     02130000
021400    05  PV-FIELD-TO                 PIC X(5).                     02140000
021500    05  PV-SUB-FROM                 PIC 9.                        02150000
021600    05  PV-SUB-TO                   PIC 9.                        02160000
021700    05  WS-CITY-NAME                PIC   X(26).                  02170000
021800    05  WS-COUNTY-NAME              PIC   X(26).                  02180000
021900    05  WS-COUNTY-CDE.                                            02190000
022000        07  WS-COUNTY-CDE9          PIC   9(4).                   02200000
022100    05  WS-ZIP-GEO.                                               02210000
022200        07  WS-ZIP-CODE             PIC   X(05).                  02220000
022300        07  WS-GEO-CODE             PIC   X(02).                  02230000
022400    05 W9-POS                       PIC S9(2).                    02240000
022500    05 PARAM-NAME                   PIC X(30).                    02250000
022600    05 PARAM-VALUE                  PIC X(60).                    02260000
022700    05 PARAM-VALUE2                 PIC X(60).                    02270000
022800    05 PV-COMP-START-DTE.                                         02280000
022900       10 PV-COMP-START-CCYY        PIC X(04).                    02290000
023000       10 PV-COMP-START-MM          PIC X(02).                    02300000
023100       10 PV-COMP-START-DD          PIC X(02).                    02310000
023200    05 PV-COMP-END-DTE.                                           02320000
023300       10 PV-COMP-END-CCYY          PIC X(04).                    02330000
023400       10 PV-COMP-END-MM            PIC X(02).                    02340000
023500       10 PV-COMP-END-DD            PIC X(02).                    02350000
023600                                                                  02360000
023700                                                                  02370000
023800 01 PV-SCH-VARIABLE.                                              02380000
023900     05 PV-EFF-SUB                  PIC 9.                        02390000
024000     05 PV-EFF-DATA OCCURS 2 TIMES.                               02400000
024100        10 PV-EFF-DATE              PIC X(8).                     02410000
024200        10 PV-STATE-RATEX.                                        02420000
024300            15 PV-STATE-RATE        PIC V9(5).                    02430000
024400        10 PV-SCHA-AMTX.                                          02440000
024500            15 PV-SCHA-AMT          PIC 9(3).                     02450000
024600        10 PV-SCHB1-AMTX.                                         02460000
024700            15 PV-SCHB1-AMT         PIC 9(3).                     02470000
024800                                                                  02480000
024900                                                                  02490000
025000                                                                  02500000
025100 01 PS-PROGRAM-SWITCHES.                                          02510000
025200     05  PS-END-OF-TAX-FILE-SW    PIC X(1)     VALUE 'N'.         02520000
025300         88  PS-END-OF-TAX-FILE                VALUE 'Y'.         02530000
025400         88  PS-NOT-END-OF-TAX-FILE            VALUE 'N'.         02540000
025500     05 PS-END-OF-DATE-FILE-SW    PIC X(01) VALUE 'N'.            02550000
025600         88  PS-END-OF-DATE-FILE               VALUE 'Y'.         02560000
025700     05  PS-END-OF-ZIPGEO-SW      PIC X(1)     VALUE 'N'.         02570000
025800         88  PS-END-OF-ZIPGEO                  VALUE 'Y'.         02580000
025900         88  PS-NOT-END-OF-ZIPGEO              VALUE 'N'.         02590000
026000     05  PS-END-OF-COUNTY-SW      PIC X(1)     VALUE 'N'.         02600000
026100         88  PS-END-OF-COUNTY                  VALUE 'Y'.         02610000
026200         88  PS-NOT-END-OF-COUNTY              VALUE 'N'.         02620000
026300     05  PS-WRITE-SCH-SW          PIC X(1)     VALUE '8'.         02630000
026400         88  PS-WRITE-SCH           VALUES 'A', 'B', '8'.         02640000
026500         88  PS-WRITE-SCHA                     VALUE 'A'.         02650000
026600         88  PS-WRITE-SCHB                     VALUE 'B'.         02660000
026700         88  PS-WRITE-SCHB1                    VALUE '1'.         02670000
026800         88  PS-WRITE-SCH810                   VALUE '8'.         02680000
026900         88  PS-NOT-WRITE-SCH                  VALUE 'N'.         02690000
027000     05  PS-CLOTHING-FOOTWEAR-SW  PIC X(5)     VALUE SPACES.      02700000
027100         88  PS-CLOTHING-FOOTWEAR                                 02710000
027200       VALUES '61000', '61025', '61050', '61075', '61350',        02720000
027300              '61375', '61500', '61550', '61600', '61605',        02730000
027400              '61610', '61625', '61635', '61637', '61640',        02740000
027500              '61645', '61715', '61725', '61730', '61735',        02750000
027600              '61740'.                                            02760000
027700                                                                  02770000
027800 01  PC-PROGRAM-CONSTANTS.                                        02780000
027900     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)     VALUE         02790000
028000                                                   'TXKUT052'.    02800000
028100 01 CSV-HEADER.                                                   02810000
028200    03 FILLER                     PIC X(62) VALUE                 02820000
028300      'Str#,St, County                   ,City'.                  02830000
028400*note position 9 must be a space so file will sort header         02840000
028500*     as first record after county name sort                      02850000
028600    03 FILLER                     PIC X(52) VALUE                 02860000
028700      ',Zip  ,Go,OrderDte,ProsDate,Prdcd,E,C,GrossAmount'.        02870000
028800    03 FILLER                     PIC X(65) VALUE                 02880000
028900      ',TaxAmount     ,NumberOfItems ,I,Rate ,TaxExmptId'.        02890000
029000    03 FILLER                     PIC X(42) VALUE                 02900000
029100      ',Dep,UnitAmount    ,W,OrderNbr  ,SKU-Nbr ,'.               02910000
029200                                                                  02920000
029300 01 WC-ZIPGEO-MAX                 PIC S9(04)  COMP VALUE 9000.    02930000
029400 01 WC-ZIPGEO-CNT                 PIC S9(04)  COMP VALUE ZERO.    02940000
029500 01 WG-ZIPGEO-TABLE.                                              02950000
029600    03 WT-ZIPGEO-TABLE OCCURS 0 TO 9000 TIMES                     02960000
029700                       DEPENDING ON  WC-ZIPGEO-CNT                02970000
029800                       ASCENDING KEY WT-ZIP-GEO                   02980000
029900                       INDEXED BY EI-ZIPGEO.                      02990000
030000       05 WT-ZIP-GEO.                                             03000000
030100          07 WT-ZIP-CODE          PIC X(5).                       03010000
030200          07 WT-GEO-CODE          PIC X(2).                       03020000
030300       05 WT-CITY-NAME            PIC X(26).                      03030000
030400       05 WT-COUNTY-CDE.                                          03040000
030500          07 WT-COUNTY-CDE9       PIC 9(3).                       03050000
030600                                                                  03060000
030700 01 WG-COUNTY-TABLE.                                              03070000
030800    03 WT-COUNTY-TABLE OCCURS 1030 TIMES.                         03080000
030900* 1001-1030 used form city-county subtots                         03090000
031000       05 WT-COUNTY-NAME          PIC X(26).                      03100000
031100       05 WT-RPT-ASX.                                             03110000
031200           10 WT-RPT-AS           PIC 9(3).                       03120000
031300       05 WT-SCH1A-ENACTED        PIC X.                          03130000
031400       05 WT-SCH1B-ENACTED        PIC X.                          03140000
031500       05 WT-LOCAL-RATEX.                                         03150000
031600           10 WT-LOCAL-RATE       PIC V9(5).                      03160000
031700       05 WT-MCTD-RATEX.                                          03170000
031800           10 WT-MCTD-RATE        PIC V9(5).                      03180000
031900                                                                  03190000
032000 01 WC-DO-CITY-MAX                PIC S9(04)  COMP VALUE 30.      03200000
032100 01 WC-DO-CITY-CNT                PIC S9(04)  COMP VALUE ZERO.    03210000
032200 01 WG-DO-CITY-TABLE.                                             03220000
032300    03 WT-DO-CITY-TABLE OCCURS 0 TO 30 TIMES                      03230000
032400                              DEPENDING ON WC-DO-CITY-CNT         03240000
032500                              INDEXED BY EI-DO-CITY.              03250000
032600       05 WT-DO-CITY-NAME         PIC X(26).                      03260000
032700       05 WT-DO-COUNTY-NAME       PIC X(26).                      03270000
032800       05 WT-DO-COUNTY-CDE9       PIC 9(4).                       03280000
032900                                                                  03290000
033000****************************************************************  03300000
033100 PROCEDURE DIVISION.                                              03310000
033200****************************************************************  03320000
033300                                                                  03330000
033400****************************************************************  03340000
033500* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  03350000
033600* PROGRAM.                                                     *  03360000
033700****************************************************************  03370000
033800                                                                  03380000
033900 0000-PROGRAM-MAINLINE.                                           03390000
034000                                                                  03400000
034100     PERFORM 9000-INITIALIZATION.                                 03410000
034200                                                                  03420000
034300     PERFORM 2000-PROCESS-TAX-FILE                                03430000
034400        UNTIL PS-END-OF-TAX-FILE.                                 03440000
034500                                                                  03450000
034600     PERFORM 9990-END-ROUTINE.                                    03460000
034700                                                                  03470000
034800     GOBACK.                                                      03480000
034900                                                                  03490000
035000****************************************************************  03500000
035100* 2000-PROCESS-TAX-FILE                                        *  03510000
035200****************************************************************  03520000
035300 2000-PROCESS-TAX-FILE.                                           03530000
035400                                                                  03540000
035500         IF NOT (TX006-ZIP-CDE = PV-SAVE-ZIP-CDE AND              03550000
035600                 TX006-GEO-CDE = PV-SAVE-GEO-CDE)                 03560000
035700         PERFORM 2100-SEARCH-ZIPGEO                               03570000
035800         MOVE TX006-ZIP-CDE TO PV-SAVE-ZIP-CDE                    03580000
035900         MOVE TX006-GEO-CDE TO PV-SAVE-GEO-CDE                    03590000
036000     END-IF.                                                      03600000
036100                                                                  03610000
036200     PERFORM 4000-MOVE-OUTPUT-DATA.                               03620000
036300     PERFORM 5000-WRITE-RECORD                                    03630000
036400                                                                  03640000
036500     PERFORM 2200-READ-TAX-FILE.                                  03650000
036600                                                                  03660000
036700******************************************************************03670000
036800* 2100-SEARCH THE ZIPGEO ARRAY                                    03680000
036900******************************************************************03690000
037000 2100-SEARCH-ZIPGEO.                                              03700000
037100                                                                  03710000
037200     MOVE TX006-ZIP-CDE TO WS-ZIP-CODE                            03720000
037300     MOVE TX006-GEO-CDE TO WS-GEO-CODE                            03730000
037400* find city name and county code for zipgeo                       03740000
037500     SET EI-ZIPGEO                     TO 1                       03750000
037600     SEARCH ALL WT-ZIPGEO-TABLE                                   03760000
037700        AT END                                                    03770000
037800        MOVE 'ERR'  TO WS-CITY-NAME WS-COUNTY-NAME                03780000
037900        DISPLAY 'ZIP/GEO NOT FOUND ' WS-ZIP-GEO                   03790000
038000      WHEN WT-ZIP-GEO(EI-ZIPGEO) = WS-ZIP-GEO                     03800000
038100        MOVE WT-COUNTY-CDE9(EI-ZIPGEO)      TO WS-COUNTY-CDE9     03810000
038200        IF WT-RPT-ASX(WS-COUNTY-CDE9) NOT = ZERO                  03820000
038300            MOVE WT-RPT-AS(WS-COUNTY-CDE9) TO WS-COUNTY-CDE9      03830000
038400        END-IF                                                    03840000
038500        IF WS-COUNTY-CDE9 = ZERO                                  03850000
038600           MOVE 999           TO WS-COUNTY-CDE9                   03860000
038700        END-IF                                                    03870000
038800        MOVE WT-COUNTY-NAME(WS-COUNTY-CDE9) TO WS-COUNTY-NAME     03880000
038900        MOVE WT-CITY-NAME(EI-ZIPGEO)        TO WS-CITY-NAME       03890000
039000     END-SEARCH.                                                  03900000
039100                                                                  03910000
039200* check to see if city is a subtotal for county                   03920000
039300     SET EI-DO-CITY                    TO 1                       03930000
039400     SEARCH WT-DO-CITY-TABLE                                      03940000
039500         AT END CONTINUE                                          03950000
039600       WHEN WS-CITY-NAME   = WT-DO-CITY-NAME(EI-DO-CITY)          03960000
039700        AND WS-COUNTY-NAME = WT-DO-COUNTY-NAME(EI-DO-CITY)        03970000
039800          MOVE WT-DO-COUNTY-CDE9(EI-DO-CITY) TO WS-COUNTY-CDE9    03980000
039810          MOVE WT-COUNTY-NAME(WS-COUNTY-CDE9) TO WS-COUNTY-NAME   03981000
039900     END-SEARCH.                                                  03990000
040000                                                                  04000000
040100******************************************************************04010000
040200* 2200-READ-TAX-FILE                                              04020000
040300******************************************************************04030000
040400 2200-READ-TAX-FILE.                                              04040000
040500                                                                  04050000
040600     MOVE SPACES TO TX006-TAX-AUDIT-RECORD                        04060000
040700                                                                  04070000
040800     READ TAX-IN-FILE                                             04080000
040900         INTO TX006-TAX-AUDIT-RECORD                              04090000
041000         AT END                                                   04100000
041100             SET PS-END-OF-TAX-FILE TO TRUE                       04110000
041200     END-READ.                                                    04120000
041300                                                                  04130000
041400     IF NOT PS-END-OF-TAX-FILE                                    04140000
041500         ADD  1    TO  PV-READ-CNT                                04150000
041600     END-IF.                                                      04160000
041700                                                                  04170000
041800*--------------------------------------------------------------*  04180000
041900* 4000-MOVE-OUTPUT-DATA                                        *  04190000
042000*--------------------------------------------------------------*  04200000
042100 4000-MOVE-OUTPUT-DATA.                                           04210000
042200                                                                  04220000
042300     MOVE WS-CITY-NAME           TO TX052-CITY-NAME.              04230000
042400     MOVE WS-COUNTY-NAME         TO TX052-COUNTY-NAME.            04240000
042500     MOVE TX006-STR-NBR          TO TX052-STR-NBR.                04250000
042600     MOVE TX006-ST-CDE           TO TX052-ST-CDE.                 04260000
042700     MOVE TX006-ZIP-CDE          TO TX052-ZIP-CDE.                04270000
042800     MOVE TX006-GEO-CDE          TO TX052-GEO-CDE.                04280000
042900     MOVE TX006-ORDER-DTE (1:4)  TO TX052-ORDER-DTE (1:4).        04290000
043000     MOVE TX006-ORDER-DTE (6:2)  TO TX052-ORDER-DTE (5:2).        04300000
043100     MOVE TX006-ORDER-DTE (9:2)  TO TX052-ORDER-DTE (7:2).        04310000
043200     MOVE TX006-PROCESS-DTE(1:4) TO TX052-PROCESS-DTE (1:4).      04320000
043300     MOVE TX006-PROCESS-DTE(6:2) TO TX052-PROCESS-DTE (5:2).      04330000
043400     MOVE TX006-PROCESS-DTE(9:2) TO TX052-PROCESS-DTE (7:2).      04340000
043500     MOVE TX006-TAXWARE-PROD-CDE TO TX052-TAXWARE-PROD-CDE.       04350000
043600     MOVE TX006-EXEMPT-IND       TO TX052-EXEMPT-IND.             04360000
043700     MOVE TX006-CREDIT-IND       TO TX052-CREDIT-IND.             04370000
043800     MOVE TX006-TAXABLE-AMT      TO TX052-GROSS-AMT.              04380000
043900     MOVE TX006-TX-AMT           TO TX052-TAX-AMT.                04390000
044000     MOVE TX006-SLD-QTY          TO TX052-NO-OF-ITEMS.            04400000
044100     MOVE TX006-PROCESS-TYPE     TO TX052-CALC-TYP-IND.           04410000
044200     MOVE TX006-TAX-RT-PCT       TO TX052-TAX-RATE.               04420000
044300     MOVE TX006-TAX-EXMPT-ID     TO TX052-TX-EXMPT-ID.            04430000
044400     MOVE TX006-DEPT-NBR         TO TX052-DEPT-NBR.               04440000
044500     MOVE TX006-ECOMMERCE-ORDER-NUMBER                            04450000
044600                                 TO TX052-ORDER-NBR.              04460000
044700     MOVE TX006-SKU-NBR          TO TX052-SKU-NBR.                04470000
044800     MOVE TX006-TAXWARE-PROD-CDE TO PS-CLOTHING-FOOTWEAR-SW       04480000
044900                                                                  04490000
INC023     IF TX052-NO-OF-ITEMS NOT EQUAL ZERO                          04491003
INC023        COMPUTE TX052-UNIT-AMT =                                  04500002
INC023                TX052-GROSS-AMT / TX052-NO-OF-ITEMS               04500104
INC023     ELSE                                                         04500202
INC023        MOVE ZERO TO  TX052-UNIT-AMT                              04500302
INC023     END-IF.                                                      04501002
045100     MOVE SPACES                 TO TX052-WARNING.                04510000
045200                                                                  04520000
045300     SET PS-WRITE-SCH810         TO TRUE                          04530000
SEPHOR     IF TX006-DEPT-NBR = '981' OR '983' OR '712'                  04540005
045500         SET PS-NOT-WRITE-SCH    TO TRUE                          04550000
045600     END-IF                                                       04560000
045700     IF TX052-PROCESS-DTE < PV-COMP-START-DTE                     04570000
045800     OR TX052-PROCESS-DTE > PV-COMP-END-DTE                       04580000
045900         SET PS-NOT-WRITE-SCH    TO TRUE                          04590000
046000     END-IF                                                       04600000
046100                                                                  04610000
046200     IF PS-WRITE-SCH810                                           04620000
046300         PERFORM 4100-RATES                                       04630000
046400     END-IF.                                                      04640000
046500                                                                  04650000
046600 4100-RATES.                                                      04660000
046700                                                                  04670000
046800     IF TX052-ORDER-DTE > PV-EFF-DATE(2)                          04680000
046900         MOVE 2                  TO PV-EFF-SUB                    04690000
047000     ELSE                                                         04700000
047100         MOVE 1                  TO PV-EFF-SUB                    04710000
047200     END-IF                                                       04720000
047300                                                                  04730000
047400     IF WT-LOCAL-RATEX(WS-COUNTY-CDE9) = '    '                   04740000
047500         MOVE ZEROES             TO PV-LOCAL-RATE                 04750000
047600     ELSE                                                         04760000
047700         MOVE WT-LOCAL-RATEX(WS-COUNTY-CDE9) TO PV-LOCAL-RATEX    04770000
047800     END-IF.                                                      04780000
047900     IF WT-MCTD-RATEX(WS-COUNTY-CDE9) = '    '                    04790000
048000         MOVE ZEROES             TO PV-MCTD-RATE                  04800000
048100     ELSE                                                         04810000
048200         MOVE WT-MCTD-RATEX(WS-COUNTY-CDE9) TO PV-MCTD-RATEX      04820000
048300     END-IF.                                                      04830000
048400                                                                  04840000
048500     COMPUTE PV-TOTAL-RATE = PV-STATE-RATE(PV-EFF-SUB)            04850000
048600                           + PV-LOCAL-RATE                        04860000
048700     COMPUTE PV-NY-MCTD-RATE = PV-STATE-RATE(PV-EFF-SUB)          04870000
048800                             + PV-MCTD-RATE                       04880000
048900     COMPUTE PV-TOTAL-MCTD-RATE = PV-STATE-RATE(PV-EFF-SUB)       04890000
049000                           + PV-LOCAL-RATE + PV-MCTD-RATE         04900000
049100                                                                  04910000
049200     IF PS-CLOTHING-FOOTWEAR                                      04920000
049300* scha                                                            04930000
049400         IF TX052-UNIT-AMT < PV-SCHA-AMT(PV-EFF-SUB)              04940000
049500             IF  TX052-TAX-AMT = ZERO AND                         04950000
049600                 TX052-TAX-RATE = ZERO                            04960000
049700               SET PS-WRITE-SCHA     TO TRUE                      04970000
049800               IF WT-SCH1A-ENACTED(WS-COUNTY-CDE9) NOT = 'Y'      04980000
049900                 MOVE '?'            TO TX052-WARNING             04990000
050000               END-IF                                             05000000
050100             END-IF                                               05010000
050200         END-IF                                                   05020000
050300* schb                                                            05030000
050400         IF TX052-UNIT-AMT < PV-SCHA-AMT(PV-EFF-SUB)              05040000
050500             IF  TX052-TAX-AMT > ZERO                             05050000
050600               SET PS-WRITE-SCHA     TO TRUE                      05060000
050700               SET PS-WRITE-SCHB     TO TRUE                      05070000
050800               IF TX052-TAX-RATE NOT = PV-LOCAL-RATE              05080000
050900                 MOVE '%'            TO TX052-WARNING             05090000
051000               END-IF                                             05100000
051100             END-IF                                               05110000
051200         END-IF                                                   05120000
051300* schb1                                                           05130000
051400         IF  TX052-UNIT-AMT > PV-SCHA-AMT(PV-EFF-SUB)             05140000
051500         AND TX052-UNIT-AMT < PV-SCHB1-AMT(PV-EFF-SUB)            05150000
051600           IF TX052-TAX-RATE < PV-TOTAL-RATE OR                   05160000
051700              WT-SCH1B-ENACTED(WS-COUNTY-CDE9) = 'Y'              05170000
051800             SET PS-WRITE-SCHB1      TO TRUE                      05180000
051900             IF TX052-TAX-RATE NOT = PV-NY-MCTD-RATE              05190000
052000               MOVE '%'            TO TX052-WARNING               05200000
052100             END-IF                                               05210000
052200             IF WT-SCH1B-ENACTED(WS-COUNTY-CDE9) NOT = 'Y'        05220000
052300                 MOVE '?'           TO TX052-WARNING              05230000
052400             END-IF                                               05240000
052500           END-IF                                                 05250000
052600         END-IF                                                   05260000
052700     END-IF.                                                      05270000
052800* sch810 if not other sch                                         05280000
052900     IF PS-WRITE-SCH810 AND PS-CLOTHING-FOOTWEAR                  05290000
053000        IF TX052-TAX-RATE < PV-TOTAL-MCTD-RATE                    05300000
053100            MOVE '%'                      TO TX052-WARNING        05310000
053200        END-IF                                                    05320000
053300        IF TX052-TAX-RATE = ZERO                                  05330000
053400                MOVE '?'                  TO TX052-WARNING        05340000
053500        END-IF                                                    05350000
053600     END-IF.                                                      05360000
053700                                                                  05370000
053800                                                                  05380000
053900****************************************************************  05390000
054000* 5000-WRITE-RECORD                                               05400000
054100****************************************************************  05410000
054200 5000-WRITE-RECORD.                                               05420000
054300                                                                  05430000
054400                                                                  05440000
054500                                                                  05450000
054600     EVALUATE TRUE                                                05460000
054700        WHEN PS-WRITE-SCHA                                        05470000
054800              ADD  1            TO  PV-OUT-CNT-SCHA               05480000
054900              IF TX006-CREDIT-YES                                 05490000
055000                  SUBTRACT TX052-TAX-AMT FROM PV-OUT-TAX-SCHA     05500000
055100                  SUBTRACT TX052-GROSS-AMT FROM PV-OUT-SLS-SCHA   05510000
055200              ELSE                                                05520000
055300                  ADD TX052-TAX-AMT TO PV-OUT-TAX-SCHA            05530000
055400                  ADD TX052-GROSS-AMT TO PV-OUT-SLS-SCHA          05540000
055500              END-IF                                              05550000
055600              WRITE TAX-SCHA-REC  FROM TX052-TAX-SUMMARY-RECORD   05560000
055700        WHEN PS-WRITE-SCHB                                        05570000
055800              ADD  1            TO  PV-OUT-CNT-SCHB               05580000
055900              IF TX006-CREDIT-YES                                 05590000
056000                  SUBTRACT TX052-TAX-AMT FROM PV-OUT-TAX-SCHB     05600000
056100                  SUBTRACT TX052-GROSS-AMT FROM PV-OUT-SLS-SCHB   05610000
056200              ELSE                                                05620000
056300                  ADD TX052-TAX-AMT TO PV-OUT-TAX-SCHB            05630000
056400                  ADD TX052-GROSS-AMT TO PV-OUT-SLS-SCHB          05640000
056500              END-IF                                              05650000
056600              WRITE TAX-SCHB-REC  FROM TX052-TAX-SUMMARY-RECORD   05660000
056700        WHEN PS-WRITE-SCHB1                                       05670000
056800              ADD  1            TO  PV-OUT-CNT-SCHB1              05680000
056900              IF TX006-CREDIT-YES                                 05690000
057000                  SUBTRACT TX052-TAX-AMT FROM PV-OUT-TAX-SCHB1    05700000
057100                  SUBTRACT TX052-GROSS-AMT FROM PV-OUT-SLS-SCHB1  05710000
057200              ELSE                                                05720000
057300                  ADD TX052-TAX-AMT TO PV-OUT-TAX-SCHB1           05730000
057400                  ADD TX052-GROSS-AMT TO PV-OUT-SLS-SCHB1         05740000
057500              END-IF                                              05750000
057600              WRITE TAX-SCHB1-REC  FROM TX052-TAX-SUMMARY-RECORD  05760000
057700        WHEN PS-WRITE-SCH810                                      05770000
057800              ADD  1            TO  PV-OUT-CNT-SCH810             05780000
057900              IF TX006-CREDIT-YES                                 05790000
058000                  SUBTRACT TX052-TAX-AMT FROM PV-OUT-TAX-SCH810   05800000
058100                  SUBTRACT TX052-GROSS-AMT FROM PV-OUT-SLS-SCH810 05810000
058200              ELSE                                                05820000
058300                  ADD TX052-TAX-AMT TO PV-OUT-TAX-SCH810          05830000
058400                  ADD TX052-GROSS-AMT TO PV-OUT-SLS-SCH810        05840000
058500              END-IF                                              05850000
058600              WRITE TAX-SCH810-REC  FROM TX052-TAX-SUMMARY-RECORD 05860000
058700        WHEN OTHER                                                05870000
058800              ADD 1                 TO PV-SKIP-CNT                05880000
058900     END-EVALUATE.                                                05890000
059000                                                                  05900000
059100*                                                                 05910000
059200****************************************************************  05920000
059300* 9000-INITIALIZATION OPENS ALL FILES, CONNECTS TO ORACLE      *  05930000
059400*      OPENS THE FILES AND PERFORM THE FIRST READ.             *  05940000
059500****************************************************************  05950000
059600 9000-INITIALIZATION.                                             05960000
059700                                                                  05970000
059800     OPEN INPUT  POS-DATE-CARD-FILE.                              05980000
059900     PERFORM 9100-PROCESS-DATE-CARD.                              05990000
060000     CLOSE POS-DATE-CARD-FILE.                                    06000000
060100                                                                  06010000
060200     OPEN   INPUT  COUNTY-FILE                                    06020000
060300     INITIALIZE PV-SCH-VARIABLE.                                  06030000
060400     PERFORM 9200-LOAD-COUNTY UNTIL PS-END-OF-COUNTY              06040000
060500       display 'effective data:' PV-EFF-DATA(1)                   06050000
060600       display 'effective data:' PV-EFF-DATA(2)                   06060000
060700     CLOSE COUNTY-FILE.                                           06070000
060800     DISPLAY PV-READ-CNT ' Counties'                              06080000
060900     OPEN INPUT ZIPGEO-FILE                                       06090000
060910     MOVE SPACES TO WS-ZIP-GEO                                    06091000
061000     PERFORM 9300-LOAD-ZIPGEO UNTIL PS-END-OF-ZIPGEO              06100000
061100     DISPLAY 'ZIP/GEO LOADED: ' WC-ZIPGEO-CNT                     06110000
061200             ' max available '  WC-ZIPGEO-MAX                     06120000
061300     CLOSE ZIPGEO-FILE.                                           06130000
061400     MOVE ZERO            TO PV-READ-CNT                          06140000
061500                                                                  06150000
061600     OPEN   INPUT  TAX-IN-FILE.                                   06160000
061700     OPEN   OUTPUT TAX-SCHA-FILE.                                 06170000
061800     WRITE TAX-SCHA-REC FROM CSV-HEADER.                          06180000
061900     OPEN   OUTPUT TAX-SCHB-FILE.                                 06190000
062000     WRITE TAX-SCHB-REC FROM CSV-HEADER.                          06200000
062100     OPEN   OUTPUT TAX-SCHB1-FILE.                                06210000
062200     WRITE TAX-SCHB1-REC FROM CSV-HEADER.                         06220000
062300     OPEN   OUTPUT TAX-SCH810-FILE.                               06230000
062400     WRITE TAX-SCH810-REC FROM CSV-HEADER.                        06240000
062500                                                                  06250000
062600     PERFORM 2200-READ-TAX-FILE.                                  06260000
062700                                                                  06270000
062800******************************************************************06280000
062900* 9100-PROCESS-DATE-CARD                                          06290000
063000******************************************************************06300000
063100 9100-PROCESS-DATE-CARD.                                          06310000
063200                                                                  06320000
063300     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         06330000
063400                                                                  06340000
063500     READ POS-DATE-CARD-FILE INTO CC-DATE-CARD                    06350000
063600         AT END                                                   06360000
063700             SET PS-END-OF-DATE-FILE TO TRUE                      06370000
063800     END-READ.                                                    06380000
063900                                                                  06390000
064000     IF PS-END-OF-DATE-FILE                                       06400000
064100         MOVE '9100-PROCESS-DATE-CARD'  TO PV-ABEND-PARAGRAPH     06410000
064200         MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     06420000
064300         SET AC-CONTROL-CARD-ERROR TO TRUE                        06430000
064400         PERFORM 9999-ABEND                                       06440000
064500     END-IF.                                                      06450000
064600                                                                  06460000
064700     SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     06470000
064800     SET DPG52-LK-DTE-ISO            TO TRUE.                     06480000
064900                                                                  06490000
065000     MOVE CC-TO-DATE                 TO DPG52-DB2-ISO-DATE.       06500000
065100                                                                  06510000
065200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06520000
065300                                             DPG54 DPG55 DPG56.   06530000
065400     IF  DPG54-SEVERE-ERROR                                       06540000
065500         DISPLAY '*********************************'              06550000
065600         DISPLAY '** ABEND FROM CALL SUB         **'              06560000
065700         DISPLAY '** PROGRAM = TXKUT052          **'              06570000
065800         DISPLAY '** DATE = ' CC-TO-DATE '       **'              06580000
065900         DISPLAY '*********************************'              06590000
066000         DISPLAY DPG54-ERROR-MESSAGE                              06600000
066100         SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                    06610000
066200         PERFORM 9999-ABEND                                       06620000
066300     ELSE                                                         06630000
066400         IF  DPG54-DATE-INVALID                                   06640000
066500              DISPLAY '****************************'              06650000
066600              DISPLAY '** ABEND INVALID END DATE **'              06660000
066700              DISPLAY '** PROGRAM = TXKUT052     **'              06670000
066800              DISPLAY '** DATE = ' CC-TO-DATE '  **'              06680000
066900              DISPLAY '****************************'              06690000
067000              DISPLAY DPG54-ERROR-MESSAGE                         06700000
067100              SET AC-CONTROL-CARD-ERROR TO TRUE                   06710000
067200              PERFORM 9999-ABEND                                  06720000
067300         END-IF                                                   06730000
067400     END-IF.                                                      06740000
067500                                                                  06750000
067600     MOVE DPG56-FIRST-FP-GREG-CC-YR TO PV-COMP-START-CCYY.        06760000
067700     MOVE DPG56-FIRST-FP-GREG-CC-MO TO PV-COMP-START-MM.          06770000
067800     MOVE DPG56-FIRST-FP-GREG-CC-DY TO PV-COMP-START-DD.          06780000
067900     MOVE DPG56-LAST-FP-GREG-CC-YR  TO PV-COMP-END-CCYY.          06790000
068000     MOVE DPG56-LAST-FP-GREG-CC-MO  TO PV-COMP-END-MM.            06800000
068100     MOVE DPG56-LAST-FP-GREG-CC-DY  TO PV-COMP-END-DD.            06810000
068200     DISPLAY 'PROCESSING FISCAL DATES '                           06820000
068300              PV-COMP-START-DTE ' - ' PV-COMP-END-DTE.            06830000
068400                                                                  06840000
068500****************************************************************  06850000
068600* LOAD  COUNTY TO WORKING-STORAGE TABLE                           06860000
068700****************************************************************  06870000
068800 9200-LOAD-COUNTY.                                                06880000
068900                                                                  06890000
069000     READ COUNTY-FILE                                             06900000
069100         AT END                                                   06910000
069200             SET PS-END-OF-COUNTY TO TRUE                         06920000
069300     END-READ.                                                    06930000
069400                                                                  06940000
069500     MOVE SPACES TO WS-COUNTY-NAME PV-RPT-ASX PV-SCH1A-ENACTED    06950000
069501                    PV-SCH1B-ENACTED PV-LOCAL-RATEX PV-MCTD-RATEX.06950100
069502                                                                  06950201
069503     INSPECT COUNTY-REC REPLACING ALL X'0D' BY X'6B'.             06950301
069504                                                                  06950401
069505     UNSTRING COUNTY-REC DELIMITED BY ','                         06950500
069600         INTO WS-COUNTY-CDE, WS-COUNTY-NAME, PV-RPT-ASX,          06960000
069700              PV-SCH1A-ENACTED, PV-SCH1B-ENACTED,                 06970000
069800              PV-LOCAL-RATEX, PV-MCTD-RATEX                       06980000
069900     END-UNSTRING.                                                06990000
070000                                                                  07000000
070100     MOVE WS-COUNTY-CDE      TO PV-FIELD-FROM                     07010000
070200     MOVE 4                  TO PV-SUB-TO                         07020000
070300     PERFORM 9210-FORMAT-NUMERIC                                  07030000
070400     MOVE PV-FIELD-TO        TO WS-COUNTY-CDE                     07040000
070500                                                                  07050000
070600     IF WS-COUNTY-CDE IS NUMERIC                                  07060000
070700       ADD 1                 TO PV-READ-CNT                       07070000
070800       IF WS-COUNTY-CDE9 = ZERO                                   07080000
070900          MOVE 999           TO WS-COUNTY-CDE9                    07090000
071000       END-IF                                                     07100000
071100       MOVE WS-COUNTY-NAME   TO WT-COUNTY-NAME(WS-COUNTY-CDE9)    07110000
071200       MOVE PV-RPT-ASX       TO PV-FIELD-FROM                     07120000
071300       MOVE 3                TO PV-SUB-TO                         07130000
071400       PERFORM 9210-FORMAT-NUMERIC                                07140000
071500       MOVE PV-FIELD-TO      TO WT-RPT-ASX(WS-COUNTY-CDE9)        07150000
071600       MOVE PV-SCH1A-ENACTED TO WT-SCH1A-ENACTED(WS-COUNTY-CDE9)  07160000
071700       MOVE PV-SCH1B-ENACTED TO WT-SCH1B-ENACTED(WS-COUNTY-CDE9)  07170000
071800       MOVE PV-LOCAL-RATEX   TO PV-FIELD-FROM                     07180000
071900       MOVE 5                TO PV-SUB-TO                         07190000
072000       PERFORM 9210-FORMAT-NUMERIC                                07200000
072100       MOVE PV-FIELD-TO      TO WT-LOCAL-RATEX(WS-COUNTY-CDE9)    07210000
072200       MOVE PV-MCTD-RATEX    TO PV-FIELD-FROM                     07220000
072300       MOVE 5                TO PV-SUB-TO                         07230000
072400       PERFORM 9210-FORMAT-NUMERIC                                07240000
072500       MOVE PV-FIELD-TO      TO WT-MCTD-RATEX(WS-COUNTY-CDE9)     07250000
072600       IF WS-COUNTY-CDE9 > 1000                                   07260000
072700         ADD 1                     TO WC-DO-CITY-CNT              07270000
072800         MOVE SPACES TO WS-CITY-NAME WS-COUNTY-NAME               07280000
072900         UNSTRING WT-COUNTY-NAME(WS-COUNTY-CDE9) DELIMITED BY '/' 07290000
073000             INTO WS-CITY-NAME, WS-COUNTY-NAME                    07300000
073100         END-UNSTRING                                             07310000
073200         MOVE WS-CITY-NAME                                        07320000
073300           TO WT-DO-CITY-NAME(WC-DO-CITY-CNT)                     07330000
073400         MOVE WS-COUNTY-NAME                                      07340000
073500           TO WT-DO-COUNTY-NAME(WC-DO-CITY-CNT)                   07350000
073600         MOVE WS-COUNTY-CDE9  TO WT-DO-COUNTY-CDE9(WC-DO-CITY-CNT)07360000
073700       END-IF                                                     07370000
073800     ELSE                                                         07380000
073900       UNSTRING COUNTY-REC DELIMITED BY ','                       07390000
074000        INTO PARAM-NAME, PARAM-VALUE, PARAM-VALUE2                07400000
074100       END-UNSTRING                                               07410000
074200       EVALUATE PARAM-NAME                                        07420000
074300         WHEN 'STATE-RATE'                                        07430000
074400             IF PV-EFF-DATE(1) = SPACES OR                        07440000
074500                PV-EFF-DATE(1) = PARAM-VALUE2                     07450000
074600               MOVE PARAM-VALUE      TO PV-FIELD-FROM             07460000
074700               MOVE 5                TO PV-SUB-TO                 07470000
074800               PERFORM 9210-FORMAT-NUMERIC                        07480000
074900               MOVE PV-FIELD-TO      TO PV-STATE-RATEX(1)         07490000
075000               MOVE PARAM-VALUE2     TO PV-EFF-DATE(1)            07500000
075100             ELSE                                                 07510000
075200                 IF PV-EFF-DATE(2) = SPACES OR                    07520000
075300                    PV-EFF-DATE(2) = PARAM-VALUE2                 07530000
075400                   MOVE PARAM-VALUE  TO PV-FIELD-FROM             07540000
075500                   MOVE 5            TO PV-SUB-TO                 07550000
075600                   PERFORM 9210-FORMAT-NUMERIC                    07560000
075700                   MOVE PV-FIELD-TO  TO PV-STATE-RATEX(2)         07570000
075800                   MOVE PARAM-VALUE2       TO PV-EFF-DATE(2)      07580000
075900                 ELSE                                             07590000
076000                     DISPLAY 'ONLY 2 EFFECTIVE DATES VALID'       07600000
076100                 END-IF                                           07610000
076200             END-IF                                               07620000
076300         WHEN 'SCHA-AMT'                                          07630000
076400             IF PV-EFF-DATE(1) = SPACES OR                        07640000
076500                PV-EFF-DATE(1) = PARAM-VALUE2                     07650000
076600               MOVE PARAM-VALUE  TO PV-FIELD-FROM                 07660000
076700               MOVE 3            TO PV-SUB-TO                     07670000
076800               PERFORM 9210-FORMAT-NUMERIC                        07680000
076900               MOVE PV-FIELD-TO  TO PV-SCHA-AMTX(1)               07690000
077000               MOVE PARAM-VALUE2       TO PV-EFF-DATE(1)          07700000
077100             ELSE                                                 07710000
077200                 IF PV-EFF-DATE(2) = SPACES OR                    07720000
077300                    PV-EFF-DATE(2) = PARAM-VALUE2                 07730000
077400                   MOVE PARAM-VALUE  TO PV-FIELD-FROM             07740000
077500                   MOVE 3            TO PV-SUB-TO                 07750000
077600                   PERFORM 9210-FORMAT-NUMERIC                    07760000
077700                   MOVE PV-FIELD-TO  TO PV-SCHA-AMTX(2)           07770000
077800                   MOVE PARAM-VALUE2       TO PV-EFF-DATE(2)      07780000
077900                 ELSE                                             07790000
078000                     DISPLAY 'ONLY 2 EFFECTIVE DATES VALID'       07800000
078100                 END-IF                                           07810000
078200             END-IF                                               07820000
078300         WHEN 'SCHB1-AMT'                                         07830000
078400             IF PV-EFF-DATE(1) = SPACES OR                        07840000
078500                PV-EFF-DATE(1) = PARAM-VALUE2                     07850000
078600                   MOVE PARAM-VALUE  TO PV-FIELD-FROM             07860000
078700                   MOVE 3            TO PV-SUB-TO                 07870000
078800                   PERFORM 9210-FORMAT-NUMERIC                    07880000
078900                   MOVE PV-FIELD-TO  TO PV-SCHB1-AMTX(1)          07890000
079000               MOVE PARAM-VALUE2       TO PV-EFF-DATE(1)          07900000
079100             ELSE                                                 07910000
079200                 IF PV-EFF-DATE(2) = SPACES OR                    07920000
079300                    PV-EFF-DATE(2) = PARAM-VALUE2                 07930000
079400                   MOVE PARAM-VALUE  TO PV-FIELD-FROM             07940000
079500                   MOVE 3            TO PV-SUB-TO                 07950000
079600                   PERFORM 9210-FORMAT-NUMERIC                    07960000
079700                   MOVE PV-FIELD-TO  TO PV-SCHB1-AMTX(2)          07970000
079800                   MOVE PARAM-VALUE2       TO PV-EFF-DATE(2)      07980000
079900                 ELSE                                             07990000
080000                     DISPLAY 'ONLY 2 EFFECTIVE DATES VALID'       08000000
080100                 END-IF                                           08010000
080200             END-IF                                               08020000
080300       END-EVALUATE                                               08030000
080400     END-IF.                                                      08040000
080500                                                                  08050000
080600****************************************************************  08060000
080700* FORMAT NUMERIC                                                  08070000
080800****************************************************************  08080000
080900 9210-FORMAT-NUMERIC.                                             08090000
081000     MOVE '00000' TO PV-FIELD-TO                                  08100000
081100     PERFORM VARYING PV-SUB-FROM FROM PV-SUB-TO BY -1             08110000
081200                UNTIL PV-SUB-FROM = 0                             08120000
081300        IF PV-FIELD-FROM(PV-SUB-FROM:1) NOT = SPACES              08130000
081400           MOVE PV-FIELD-FROM(PV-SUB-FROM:1)                      08140000
081500                             TO PV-FIELD-TO(PV-SUB-TO:1)          08150000
081600           SUBTRACT 1 FROM PV-SUB-TO                              08160000
081700        END-IF                                                    08170000
081800     END-PERFORM.                                                 08180000
081900                                                                  08190000
082000****************************************************************  08200000
082100* LOAD ZIPGEO TO WORKING-STORAGE TABLE                            08210000
082200****************************************************************  08220000
082300 9300-LOAD-ZIPGEO.                                                08230000
082400                                                                  08240000
082500     READ ZIPGEO-FILE                                             08250000
082600         AT END                                                   08260000
082700             SET PS-END-OF-ZIPGEO TO TRUE                         08270000
082800     END-READ.                                                    08280000
082900     ADD 1                        TO PV-READ-CNT.                 08290000
083000                                                                  08300000
083100     IF NOT PS-END-OF-ZIPGEO                                      08310000
083200      IF ZIPGEO-COUNTY-CDE IS NUMERIC                             08320000
083300       ADD 1                      TO WC-ZIPGEO-CNT                08330000
083400       IF WC-ZIPGEO-CNT > WC-ZIPGEO-MAX                           08340000
083500         MOVE '9300-LOAD-ZIPGEO'        TO PV-ABEND-PARAGRAPH     08350000
083600         MOVE 'ZIPGEO TABLE FULL      ' TO PV-OPERATION-MSG-1     08360000
083700         PERFORM 9999-ABEND                                       08370000
083800       END-IF                                                     08380000
083900       IF ZIPGEO-ZIP-GEO > WS-ZIP-GEO                             08390000
084000         MOVE ZIPGEO-ZIP-GEO TO WS-ZIP-GEO                        08400000
084100       ELSE                                                       08410000
084200         DISPLAY 'Record: ' WC-ZIPGEO-CNT                         08420000
084201                  ' ZIP/GEO: ' ZIPGEO-ZIP-GEO                     08420100
084202         MOVE '9300-LOAD-ZIPGEO'        TO PV-ABEND-PARAGRAPH     08420200
084203         MOVE 'ZIPGEO FILE NOT SEQ ZIP/GEO' TO PV-OPERATION-MSG-1 08420300
084204         PERFORM 9999-ABEND                                       08420400
084205       END-IF                                                     08420500
084206       MOVE ZIPGEO-ZIP-CDE        TO WT-ZIP-CODE(WC-ZIPGEO-CNT)   08420600
084207       MOVE ZIPGEO-GEO-CDE        TO WT-GEO-CODE(WC-ZIPGEO-CNT)   08420700
084208       MOVE "0000"                TO WS-COUNTY-CDE                08420800
084209       MOVE ZIPGEO-COUNTY-CDE     TO WT-COUNTY-CDE(WC-ZIPGEO-CNT) 08420900
084210                                     WS-COUNTY-CDE(2:3)           08421000
084300       MOVE ZIPGEO-CITY-NAME      TO WT-CITY-NAME(WC-ZIPGEO-CNT)  08430000
084400       IF ZIPGEO-COUNTY-NAME NOT = WT-COUNTY-NAME(WS-COUNTY-CDE9) 08440000
084500          DISPLAY 'ZIP/GEO COUNTY ' ZIPGEO-COUNTY-NAME            08450000
084600                  ' not equal ' WT-COUNTY-NAME(WS-COUNTY-CDE9)    08460000
084700                  ' for county cde ' WS-COUNTY-CDE                08470000
084710                  ' ' ZIPGEO-ZIP-GEO                              08471000
084800       END-IF                                                     08480000
084900      ELSE                                                        08490000
085000       DISPLAY 'ZIPGEO has invalid county cde ' ZIPGEO-COUNTY-CDE 08500000
085100     END-IF.                                                      08510000
085200                                                                  08520000
085300***************************************************************** 08530000
085400* 9990-END-ROUTINE                                              * 08540000
085500* CLOSE FILES                                                   * 08550000
085600***************************************************************** 08560000
085700                                                                  08570000
085800 9990-END-ROUTINE.                                                08580000
085900                                                                  08590000
086000     CLOSE TAX-IN-FILE.                                           08600000
086100     CLOSE TAX-SCHA-FILE.                                         08610000
086200     CLOSE TAX-SCHB-FILE.                                         08620000
086300     CLOSE TAX-SCHB1-FILE.                                        08630000
086400     CLOSE TAX-SCH810-FILE.                                       08640000
086500                                                                  08650000
086600     MOVE PV-READ-CNT      TO PV-DISPLAY-CNT.                     08660000
086700     DISPLAY 'RECORDS READ:          ' PV-DISPLAY-CNT.            08670000
086800     MOVE PV-OUT-CNT-SCHA  TO PV-DISPLAY-CNT.                     08680000
086900     MOVE PV-OUT-SLS-SCHA  TO PV-DISPLAY-AMT.                     08690000
087000     MOVE PV-OUT-TAX-SCHA  TO PV-DISPLAY-AMT2.                    08700000
087100     DISPLAY 'RECORDS WRITTEN SCHA  :' PV-DISPLAY-CNT             08710000
087200             ' Sales ' PV-DISPLAY-AMT                             08720000
087300             ' Tax '   PV-DISPLAY-AMT2.                           08730000
087400     MOVE PV-OUT-CNT-SCHB  TO PV-DISPLAY-CNT.                     08740000
087500     MOVE PV-OUT-SLS-SCHB  TO PV-DISPLAY-AMT.                     08750000
087600     MOVE PV-OUT-TAX-SCHB  TO PV-DISPLAY-AMT2.                    08760000
087700     DISPLAY 'RECORDS WRITTEN SCHB  :' PV-DISPLAY-CNT             08770000
087800             ' Sales ' PV-DISPLAY-AMT                             08780000
087900             ' Tax '   PV-DISPLAY-AMT2.                           08790000
088000     MOVE PV-OUT-CNT-SCHB1 TO PV-DISPLAY-CNT.                     08800000
088100     MOVE PV-OUT-SLS-SCHB1 TO PV-DISPLAY-AMT.                     08810000
088200     MOVE PV-OUT-TAX-SCHB1 TO PV-DISPLAY-AMT2.                    08820000
088300     DISPLAY 'RECORDS WRITTEN SCHB1 :' PV-DISPLAY-CNT             08830000
088400             ' Sales ' PV-DISPLAY-AMT                             08840000
088500             ' Tax '   PV-DISPLAY-AMT2.                           08850000
088600     MOVE PV-OUT-CNT-SCH810 TO PV-DISPLAY-CNT.                    08860000
088700     MOVE PV-OUT-SLS-SCH810 TO PV-DISPLAY-AMT.                    08870000
088800     MOVE PV-OUT-TAX-SCH810 TO PV-DISPLAY-AMT2.                   08880000
088900     DISPLAY 'RECORDS WRITTEN SCH810:' PV-DISPLAY-CNT             08890000
089000             ' Sales ' PV-DISPLAY-AMT                             08900000
089100             ' Tax '   PV-DISPLAY-AMT2.                           08910000
089200     MOVE PV-SKIP-CNT       TO PV-DISPLAY-CNT.                    08920000
089300     DISPLAY 'RECORDS SKIPPED       :' PV-DISPLAY-CNT.            08930000
089400                                                                  08940000
089500******************************************************************08950000
089600 9999-ABEND.                                                      08960000
089700*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  08970000
089800******************************************************************08980000
089900                                                                  08990000
090000     DISPLAY '** ABEND           **'.                             09000000
090100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  09010000
090200     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       09020000
090300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       09030000
090400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         09040000
090500                                                                  09050000
090600******************************************************************09060000
090700***                    END  OF  PROGRAM                        ***09070000
090800******************************************************************09080000
