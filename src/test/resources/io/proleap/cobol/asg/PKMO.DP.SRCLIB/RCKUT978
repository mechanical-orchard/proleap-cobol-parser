000100***************************************************************** 00010013
000200 IDENTIFICATION DIVISION.                                         00020013
000300 PROGRAM-ID.             RCKUT978.                                00030013
000400 AUTHOR.                 RON KRIER.                               00040013
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050013
000600 DATE-WRITTEN.           JANUARY, 2015.                           00060013
000700 DATE-COMPILED.                                                   00070013
000800***************************************************************** 00080013
000900*  THIS IS A SPECIAL PROGRAM TO ASSIST IN THE PROCESSING OF     * 00090013
001000*  RECEIPTS THAT WERE PART OF THE EXPEDITED FREIGHT PROGRAM     * 00100013
001100*  TO GET MERCHANDISE TO THE STORES IN A SHORT PERIOD OF TIME   * 00110013
001200*  (FREIGHT THAT NEEDED TO BE SENT TO THE STORES VIA UPS        * 00120013
001300*  BECAUSE THE MERCHANDISE NEEDED TO GET TO THE STORES          * 00130013
001400*  QUICKLY FOR ADS).                                            * 00140013
001500*  THIS PROGRAM WAS COPIED FROM RCKUT975 AND THEN CHANGED.      * 00150013
001600***************************************************************** 00160013
001700*  THIS PROGRAM WILL TAKE IN A FILE THAT WILL CONTAIN ONE TO    * 00170013
001800*  MANY RECORDS WHICH WILL CONTAIN A PO NUMBER AND DC NUMBER    * 00180013
001900*  TO BE PROCESSED.  THE PO AND DC NUMBER WILL THEN BE USED TO  * 00190013
002000*  DRIVE A CURSOR WHICH WILL GO OUT AND FIND ALL OF THE         * 00200013
002100*  OUTBOUND CARTONS (CARTONS NOT FROM: PACK-TO-LIGHT, AN EFC,   * 00210013
002200*  IMPORT REPLEN, MASTER, FAST TRANSFER) CREATED BY THE PO/DC   * 00220013
002300*  THAT DO NOT HAVE A CARTON DIVERT OR ACTIVE SCAN ON ENTRY     * 00230013
002400*  (ASSUMPTION IS THAT THE CARTON DID NOT DIVERT OR GET         * 00240013
002500*  MANUALLY SCANNED ON A TRAILER, IT THEN WAS SENT VIA UPS      * 00250013
002600*  TO THE STORE) AND THAT INFORMATION WILL BE SUMMARIZED BY     * 00260013
002700*  THE CURSOR AND USED TO BUILD DATA THAT WILL RELIEVE STORE    * 00270013
002800*  EXPECTED AND THEN ALSO PUT THE DATA INTO AND TAKE OUT OF     * 00280013
002900*  STORE IN-TRANSIT.  THIS IS DONE SO THAT THE INVENTORY WILL   * 00290013
003000*  LOOK RIGHT AND THE GOODS CAN BE USED TO FULFILL FROM THE     * 00300013
003100*  STORE.                                                       * 00310013
003200*  THE INPUT FILE WILL ALSO HAVE 2 SETS OF DATE/TIME.  THE      * 00320013
003300*  FIRST SET BEING USED TO DEFINE THE DATE AND TIME FROM WHICH  * 00330013
003400*  THE CARTONS WERE CREATED TO BE EXTRACTED ANE THE SECOND SET  * 00340013
003500*  BEING THE END DATE AND TIME (BASICALLY BOOK END DATE/TIME TO * 00350013
003600*  PULL CARTONS CREATED FROM THRU THE TO DATE/TIME.             * 00360013
003700*  ONE OUTPUT FILE WILL THEN BE FED THRU JOB RCK050 TO PROCESS  * 00370013
003800*  THE STORE EXPECTED DATA.  THIS FILE WILL BE USING THE        * 00380013
003900*  STOREEXT COPYBOOK AND WILL LAND UP FEEDING A SPECIAL RUN OF  * 00390013
004000*  JOB RCK050.                                                  * 00400013
004100*  THE OTHER OUTPUT FILE WILL THEN BE PASSED ALONG TO A GVK JOB * 00410013
004200*  TO UPDATE IN-TRANSIT DATA WITHIN THE GIV SYSTEM.  THIS FILE  * 00420013
004300*  TO FEED GIV WILL HAVE 2 RECORDS PER PO/RECEIVER/LINE/STORE   * 00430013
004400*  IN THE PCRD010 FORMAT WHICH WILL BE USED TO INCREASE         * 00440013
004500*  PCRD010 FORMAT TO A SECOND OUTPUT FILE WHICH WILL BE USED    * 00450013
004600*  IN-TRANSIT IN GIV AND THEN THE SECOND RECORD WOULD BE USED   * 00460013
004700*  TO DECREASE IN-TRANSIT IN GIV.                               * 00470013
004800*  THIS SECOND FILE WOULD GET FED INTO JOB GVK300 TO GET TO GIV * 00480013
004900*  AND UPDATE IN-TRANSIT DATA IN THAT APPLICATION.              * 00490013
005000*  A THIRD OUTPUT FILE IS CREATED WHICH WILL BE A COMMA         * 00500013
005100*  DELIMITED FILE WHICH WILL CONTAIN A RECORD FOR EACH          * 00510013
005200*  PO/RECEIVER/LINE/STORE COMBINATION AND WILL CONTAIN THE      * 00520013
005300*  QUANITY USED TO GENERATE THE DATA FOR THE OTHER TWO FILES.   * 00530013
005400*  THIS FILE WILL BE SENT TO INVENTORY CONTROL FOR THEIR OWN    * 00540013
005500*  USE IF NEEDED.                                               * 00550013
005600*                                                               * 00560013
005700*  03/06/2015 - ADDING THE DEPARTMENT NUMBER, DEPARTMENT        * 00570013
005800*               DESCRIPTION AND SKU DESCRIPTION TO THE THIRD    * 00580013
005900*               OUTPUT FILE (COMMA DELIMITED FILE) ALONG WITH   * 00590013
006000*               A HEADING LINE(S).                              * 00600013
006100*                                                               * 00610013
006200*  03/19/2015 - ADDING LOGIC TO CHECK THE PCT_TRN_CLSN_DTL      * 00620013
006300*               TABLE FOR CLEAN ENTRIES FOR THE SKU/STORE/PO/   * 00630013
006400*               RECEIVER AND IF THERE IS AN ENTRY, THEN DON'T   * 00640013
006500*               CREATE THE RECORD TO THE STOREEXT OUTPUT FILE   * 00650013
006600*               SINCE THE CORRESPONDING SE ENTRY FOR THE        * 00660013
006700*               VERIFIED RECEIPT HAS ALREADY BEEN OFFSET BY     * 00670013
006800*               THE CLEAN ENTRY.                                * 00680013
006810*                                                               * 00681017
006820*  12/18/2018 - ADDED LOGIC TO THE MAIN CURSOR TO CHECK THE     * 00682017
006830*               STORE SCAN DATABASE - IF CARTON HAS BEEN        * 00683017
006840*               SCANNED AT THE STORE, DO NOT INCLUDE IN THIS    * 00684017
006850*               PROCESS.                                        * 00685017
006900*                                                               * 00690013
007000***************************************************************** 00700013
007100 ENVIRONMENT DIVISION.                                            00710013
007200 CONFIGURATION SECTION.                                           00720013
007300                                                                  00730013
007400 SOURCE-COMPUTER.        IBM-3090.                                00740013
007500 OBJECT-COMPUTER.        IBM-3090.                                00750013
007600                                                                  00760013
007700***************************************************************** 00770013
007800 INPUT-OUTPUT SECTION.                                            00780013
007900                                                                  00790013
008000 FILE-CONTROL.                                                    00800013
008100                                                                  00810013
008200     SELECT INPUT-FILE                                            00820013
008300         ASSIGN TO INP01.                                         00830013
008400                                                                  00840013
008500     SELECT RECEIPT-OUTPUT-FILE                                   00850013
008600         ASSIGN TO OUT01.                                         00860013
008700                                                                  00870013
008800     SELECT INTRANSIT-OUTPUT-FILE                                 00880013
008900         ASSIGN TO OUT02.                                         00890013
009000                                                                  00900013
009100     SELECT ADJUST-OUTPUT-FILE                                    00910013
009200         ASSIGN TO OUT03.                                         00920013
009300                                                                  00930013
009400***************************************************************** 00940013
009500 DATA DIVISION.                                                   00950013
009600***************************************************************** 00960013
009700 FILE SECTION.                                                    00970013
009800                                                                  00980013
009900 FD  INPUT-FILE                                                   00990013
010000     RECORDING MODE IS F                                          01000013
010100     BLOCK CONTAINS 0  RECORDS.                                   01010013
010200 01  INPUT-RECORD                    PIC X(70).                   01020013
010300                                                                  01030013
010400 FD  RECEIPT-OUTPUT-FILE                                          01040013
010500     RECORDING MODE IS F                                          01050013
010600     BLOCK CONTAINS 0  RECORDS.                                   01060013
010700 01  RECEIPT-OUTPUT-RECORD           PIC X(300).                  01070013
010800                                                                  01080013
010900 FD  INTRANSIT-OUTPUT-FILE                                        01090013
011000     RECORDING MODE IS F                                          01100013
011100     BLOCK CONTAINS 0  RECORDS.                                   01110013
011200 01  INTRANSIT-OUTPUT-RECORD         PIC X(100).                  01120013
011300                                                                  01130013
011400 FD  ADJUST-OUTPUT-FILE                                           01140013
011500     RECORDING MODE IS F                                          01150013
011600     BLOCK CONTAINS 0  RECORDS.                                   01160013
011700 01  ADJUST-OUTPUT-RECORD            PIC X(110).                  01170013
011800                                                                  01180013
011900***************************************************************** 01190013
012000 WORKING-STORAGE SECTION.                                         01200013
012100                                                                  01210013
012200 01  PROGRAM-SWITCHES.                                            01220013
012300     05  PS-EOF-INPUT-SW              PIC X(01) VALUE 'N'.        01230013
012400         88  PS-EOF-INPUT                       VALUE 'Y'.        01240013
012500         88  PS-NOT-EOF-INPUT                   VALUE 'N'.        01250013
012600     05  PS-VALID-STORE-SW            PIC X(01) VALUE 'N'.        01260013
012700         88  PS-VALID-STORE                     VALUE 'Y'.        01270013
012800         88  PS-NOT-VALID-STORE                 VALUE 'N'.        01280013
012900     05  PS-VALID-SKU-SW              PIC X(01) VALUE 'N'.        01290013
013000         88  PS-VALID-SKU                       VALUE 'Y'.        01300013
013100         88  PS-NOT-VALID-SKU                   VALUE 'N'.        01310013
013200     05  PS-LOCATION-DS-SW            PIC X(01) VALUE 'N'.        01320013
013300         88  PS-LOCATION-DS                     VALUE 'Y'.        01330013
013400         88  PS-LOCATION-DS-NO                  VALUE 'N'.        01340013
013500     05  PS-IT-EXISTS-SW              PIC X(01) VALUE 'N'.        01350013
013600         88  PS-IT-EXISTS                       VALUE 'Y'.        01360013
013700         88  PS-IT-EXISTS-NO                    VALUE 'N'.        01370013
013800     05  PS-CLEAN-EXISTS-SW           PIC X(01) VALUE 'N'.        01380013
013900         88  PS-CLEAN-EXISTS                    VALUE 'Y'.        01390013
014000         88  PS-CLEAN-EXISTS-NO                 VALUE 'N'.        01400013
014100     05  PS-END-OF-PO-CSR-SW          PIC X(01) VALUE 'N'.        01410013
014200         88  PS-END-OF-PO-CSR                   VALUE 'Y'.        01420013
014210     05  PS-CSR-FIRST-FETCH-SW        PIC X(01) VALUE 'N'.        01421020
014220         88  PS-CSR-FIRST-FETCH                 VALUE 'Y'.        01422020
014230         88  PS-CSR-NOT-FIRST-FETCH             VALUE 'N'.        01423020
014240     05  PS-EMPTY-CURSOR-SW           PIC X(01) VALUE 'N'.        01424025
014250         88  PS-EMPTY-CURSOR                    VALUE 'Y'.        01425025
014300                                                                  01430013
014400 01  PC-PROGRAM-CONSTANTS.                                        01440013
014500     05  PC-RCKUT978                 PIC X(08) VALUE              01450013
014600                                               'RCKUT978'.        01460013
014700     05  PC-DEFAULT-TMST             PIC X(26)  VALUE             01470013
014800                                    '9999-09-09-09.09.09.999999'. 01480013
014900     05  PC-SLASH                    PIC X(01) VALUE '/'.         01490013
015000     05  PC-DASH                     PIC X(01) VALUE '-'.         01500013
015100                                                                  01510013
015200                                                                  01520013
015300 01  PV-PROGRAM-VARIABLES.                                        01530013
015400                                                                  01540013
015500     05  PV-INBD-CART-CNT             PIC S9(09) COMP VALUE ZERO. 01550013
015600     05  PV-OTBD-CART-CNT             PIC S9(09) COMP VALUE ZERO. 01560013
015700     05  PV-INBD-SHPD-QTY             PIC S9(09) COMP VALUE ZERO. 01570013
015800     05  PV-OTBD-SHPD-QTY             PIC S9(09) COMP VALUE ZERO. 01580013
015900     05  PV-NO-CHECKIN-CNT            PIC S9(09) COMP VALUE ZERO. 01590013
016000     05  PV-NO-CHECKIN-QTY            PIC S9(09) COMP VALUE ZERO. 01600013
016100                                                                  01610013
016200     05  PV-CLEAN-COUNT               PIC 9(09)  VALUE ZERO.      01620013
016201     05  PV-FETCH-COUNT               PIC 9(09)  VALUE ZERO.      01620113
016202     05  PV-FETCH-COUNT2              PIC 9(09)  VALUE ZERO.      01620213
016203     05  PV-READ-COUNT                PIC 9(09)  VALUE ZERO.      01620313
016204     05  PV-READ-COUNT-2              PIC 9(09)  VALUE ZERO.      01620413
016205     05  PV-WRITE-COUNT-RECEIPT       PIC 9(09)  VALUE ZERO.      01620513
016206     05  PV-WRITE-COUNT-INTRANSIT     PIC 9(09)  VALUE ZERO.      01620613
016207     05  PV-WRITE-COUNT-ADJUST        PIC 9(09)  VALUE ZERO.      01620713
016208     05  PV-NOT-DS-LOCATION-CNT       PIC 9(09)  VALUE ZERO.      01620813
016209     05  PV-INTRANSIT-EXISTS-CNT      PIC 9(09)  VALUE ZERO.      01620913
016210                                                                  01621013
016220     05  PV-SQLCODE                  PIC 9(09) VALUE ZERO.        01622013
016230     05  PV-DISP-SQLCODE             PIC -999.                    01623013
016240     05  PV-NULL-IND                    PIC S9(04)  VALUE ZEROS   01624013
016250                                                    COMP SYNC.    01625013
016260     05  PV-NULL-IND-1                  PIC S9(04)  VALUE ZEROS   01626013
016270                                                    COMP SYNC.    01627013
016280                                                                  01628013
016290 01  PV-ABEND-FIELDS.                                             01629013
016300     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           01630013
016400                                               COMP SYNC.         01640013
016500     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'RCKUT978'.  01650013
016600     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01660013
016700     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01670013
016800     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01680013
016900     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01690013
017000     05  PV-DB2-OPERATION-MESSAGE-2  PIC X(79) VALUE SPACES.      01700013
017100     05  PV-DB2-OPERATION-MESSAGE-3  PIC X(79) VALUE SPACES.      01710013
017200     05  PV-DB2-OPERATION-MESSAGE-4  PIC X(79) VALUE SPACES.      01720013
017300     05  PV-DB2-TABLE-NAME-1         PIC X(08) VALUE SPACES.      01730013
017400     05  PV-DB2-TABLE-NAME-2         PIC X(08) VALUE SPACES.      01740013
017500                                                                  01750013
017600     05  PV-DISPLAY-OPER             PIC  9(04) VALUE ZEROES.     01760013
017700     05  PV-DISPLAY-SQLCODE          PIC  9(03)- VALUE ZEROES.    01770013
017800     05  PV-DB2-TABLE-NAME1          PIC  X(15) VALUE SPACES.     01780013
017900                                                                  01790013
018000     05  PV-DISPLAY-FETCH-COUNT1     PIC ZZZ,ZZZ,ZZ9.             01800013
018100     05  PV-DISPLAY-FETCH-COUNT2     PIC ZZZ,ZZZ,ZZ9.             01810013
018200     05  PV-DISPLAY-READ-COUNT1      PIC ZZZ,ZZZ,ZZ9.             01820013
018300     05  PV-DISPLAY-READ-COUNT2      PIC ZZZ,ZZZ,ZZ9.             01830013
018400     05  PV-DISPLAY-WRITE-COUNT      PIC ZZZ,ZZZ,ZZ9.             01840013
018500     05  PV-DISPLAY-PERCENT1         PIC ZZZ.99.                  01850013
018600     05  PV-DISPLAY-PERCENT2         PIC ZZZ.                     01860013
018700     05  PV-DISP-PO                  PIC Z(09).                   01870013
018800     05  PV-DISP-RCVR                PIC 9999.                    01880013
018900     05  PV-DISP-LOC-NBR             PIC 9999.                    01890013
019000     05  PV-DISP-LINE                PIC 9999.                    01900013
019100     05  PV-DISP-SKU                 PIC 9(08).                   01910013
019200     05  PV-DISP-INTR-UPC            PIC Z(15).                   01920013
019300                                                                  01930013
019400     05  PV-DEPT-NBR                 PIC X(04).                   01940013
019500     05  PV-DEPT-NM                  PIC X(20).                   01950013
019600     05  PV-SKU-DESC                 PIC X(30).                   01960013
019700                                                                  01970013
019800     05  PV-PREV-LOC-NBR             PIC S9(4) COMP VALUE ZEROES. 01980013
019900     05  PV-SHIPPED-TMST             PIC X(26).                   01990013
020000     05  PV-UNLOADED-TMST            PIC X(26).                   02000013
020100     05  PV-FROM-TMST.                                            02010013
020200         10  PV-FROM-TMST-DATE       PIC X(10).                   02020013
020300         10  PV-FROM-FILLER1         PIC X(01)   VALUE '-'.       02030013
020400         10  PV-FROM-TMST-TIME       PIC X(08).                   02040013
020500         10  PV-FROM-FILLER2         PIC X(07)   VALUE '.000000'. 02050013
020600     05  PV-TO-TMST.                                              02060013
020700         10  PV-TO-TMST-DATE         PIC X(10).                   02070013
020800         10  PV-TO-FILLER1           PIC X(01)   VALUE '-'.       02080013
020900         10  PV-TO-TMST-TIME         PIC X(08).                   02090013
021000         10  PV-TO-FILLER2           PIC X(07)   VALUE '.000000'. 02100013
021100                                                                  02110013
021200                                                                  02120013
021300 01  IR-INPUT-RECORD.                                             02130013
021400     05  IR-PO-NBR                   PIC  9(8)      VALUE ZEROES. 02140013
021500     05  FILLER                      PIC  X(1)      VALUE SPACES. 02150013
021600     05  IR-DC-NBR                   PIC  9(4)      VALUE ZEROES. 02160013
021700     05  FILLER                      PIC  X(01)     VALUE SPACES. 02170013
021800     05  IR-FROM-DATE                PIC  X(10).                  02180013
021900     05  FILLER                      PIC  X(01)     VALUE SPACES. 02190013
022000     05  IR-FROM-TIME                PIC  X(08).                  02200013
022100     05  FILLER                      PIC  X(01)     VALUE SPACES. 02210013
022200     05  IR-TO-DATE                  PIC  X(10).                  02220013
022300     05  FILLER                      PIC  X(01)     VALUE SPACES. 02230013
022400     05  IR-TO-TIME                  PIC  X(08).                  02240013
022410     05  FILLER                      PIC  X(01)     VALUE SPACES. 02241020
022420     05  IR-REC-SEQ-NBR              PIC  9(4)      VALUE ZEROES. 02242020
022500     05  FILLER                      PIC  X(12)     VALUE SPACES. 02250020
022600                                                                  02260013
022700 01  OHR-OUTPUT-HEADER-RECORD.                                    02270013
022800     05  OHR-DEPT-NBR        PIC  X(04)     VALUE 'DEPT'.         02280013
022900     05  FILLER              PIC  X(01)     VALUE ','.            02290013
023000     05  OHR-DEPT-DESC       PIC  X(20)     VALUE 'DEPT NAME'.    02300013
023100     05  FILLER              PIC  X(01)     VALUE ','.            02310013
023200     05  OHR-PO-NBR          PIC  X(08)     VALUE 'PO NBR  '.     02320013
023300     05  FILLER              PIC  X(01)     VALUE ','.            02330013
023400     05  OHR-REC-SEQ-NBR     PIC  X(04)     VALUE 'RECV'.         02340013
023500     05  FILLER              PIC  X(01)     VALUE ','.            02350013
023600     05  OHR-PO-LNE-NBR      PIC  X(04)     VALUE 'LINE'.         02360013
023700     05  FILLER              PIC  X(01)     VALUE ','.            02370013
023800     05  OHR-STORE-NBR       PIC  X(04)     VALUE 'STOR'.         02380013
023900     05  FILLER              PIC  X(01)     VALUE ','.            02390013
024000     05  OHR-SKU-NBR         PIC  X(08)     VALUE 'SKU     '.     02400013
024100     05  FILLER              PIC  X(01)     VALUE ','.            02410013
024200     05  OHR-SKU-DESC        PIC  X(30)     VALUE 'SKU DESC'.     02420013
024300     05  FILLER              PIC  X(01)     VALUE ','.            02430013
024400     05  OHR-QTY             PIC  X(08)     VALUE 'UNITS   '.     02440013
024500     05  FILLER              PIC  X(01)     VALUE ','.            02450013
024600     05  CL-IND              PIC  X(02)     VALUE 'CL'.           02460013
024700     05  FILLER              PIC  X(01)     VALUE ','.            02470013
024800     05  FILLER              PIC  X(08)     VALUE SPACES.         02480013
024900                                                                  02490013
025000 01  OR-OUTPUT-RECORD.                                            02500013
025100     05  OR-DEPT-NBR                 PIC  X(04)     VALUE SPACES. 02510013
025200     05  FILLER                      PIC  X(01)     VALUE ','.    02520013
025300     05  OR-DEPT-NM                  PIC  X(20)     VALUE SPACES. 02530013
025400     05  FILLER                      PIC  X(01)     VALUE ','.    02540013
025500     05  OR-PO-NBR                   PIC  9(08)     VALUE ZEROES. 02550013
025600     05  FILLER                      PIC  X(01)     VALUE ','.    02560013
025700     05  OR-REC-SEQ-NBR              PIC  9(04)     VALUE ZEROES. 02570013
025800     05  FILLER                      PIC  X(01)     VALUE ','.    02580013
025900     05  OR-PO-LNE-NBR               PIC  9(04)     VALUE ZEROES. 02590013
026000     05  FILLER                      PIC  X(01)     VALUE ','.    02600013
026100     05  OR-STORE-NBR                PIC  9(04)     VALUE ZEROES. 02610013
026200     05  FILLER                      PIC  X(01)     VALUE ','.    02620013
026300     05  OR-SKU-NBR                  PIC  9(08).                  02630013
026400     05  FILLER                      PIC  X(01)     VALUE ','.    02640013
026500     05  OR-SKU-DESC                 PIC  X(30).                  02650013
026600     05  FILLER                      PIC  X(01)     VALUE ','.    02660013
026700     05  OR-QTY                      PIC  9(08).                  02670013
026800     05  FILLER                      PIC  X(01)     VALUE ','.    02680013
026900     05  OR-CLEAN-SW                 PIC  X(02).                  02690013
027000         88  OR-CLEAN-EXISTS                        VALUE 'CL'.   02700013
027100         88  OR-CLEAN-EXISTS-NO                     VALUE '  '.   02710013
027200     05  FILLER                      PIC  X(01)     VALUE ','.    02720013
027300     05  FILLER                      PIC  X(08)     VALUE SPACES. 02730013
027400                                                                  02740013
027500 01  DK-DB-KEYS.                                                  02750013
027600     05  DK-DC-NBR                   PIC S9(4) COMP VALUE ZEROES. 02760013
027700     05  DK-PO-NBR                   PIC S9(9) COMP VALUE ZEROES. 02770013
027710     05  DK-REC-SEQ-NBR-LOW          PIC S9(9) COMP VALUE ZEROES. 02771020
027720     05  DK-REC-SEQ-NBR-HIGH         PIC S9(9) COMP VALUE ZEROES. 02772020
027800     05  DK-FROM-TMST                PIC  X(26)     VALUE SPACES. 02780013
027900     05  DK-TO-TMST                  PIC  X(26)     VALUE SPACES. 02790013
028000     05  DK-SE-INTR_UPC_ID           PIC S9(9) COMP VALUE ZEROS.  02800013
028100     05  DK-SE-LOC-NBR               PIC S9(4) COMP VALUE ZEROS.  02810013
028200     05  DK-SE-PO-NBR                PIC S9(9) COMP VALUE ZEROES. 02820013
028300     05  DK-SE-RCVR-SEQ-NBR          PIC S9(9) COMP VALUE ZEROS.  02830013
028400                                                                  02840013
028500******************************************************************02850013
028600* OUTPUT RECEIPT RECORD LAYOUT                                    02860013
028700******************************************************************02870013
028800     COPY STOREEXT.                                               02880013
028900                                                                  02890013
029000******************************************************************02900013
029100* OUTPUT INTRANSIT RECORD LAYOUT                                  02910013
029200******************************************************************02920013
029300     COPY PCRD010.                                                02930013
029400                                                                  02940013
029500******************************************************************02950013
029600*  USED FOR DB2 ERROR MESSAGE BUILDING                            02960013
029700******************************************************************02970013
029800     COPY DPWS004.                                                02980013
029900                                                                  02990013
030000******************************************************************03000013
030100*   DB2 SQL COMMUNICATION AREA                                    03010013
030200******************************************************************03020013
030300     EXEC SQL                                                     03030013
030400          INCLUDE SQLCA                                           03040013
030500     END-EXEC.                                                    03050013
030600                                                                  03060013
030700*---------------------------------------------------------------* 03070013
030800*  PCT_TRN_CLSN_DTL                                               03080013
030900*---------------------------------------------------------------* 03090013
031000     EXEC SQL                                                     03100013
031100         INCLUDE PCT00015                                         03110013
031200     END-EXEC.                                                    03120013
031300                                                                  03130013
031400*---------------------------------------------------------------* 03140013
031500*  XLT_LOC                                                        03150013
031600*---------------------------------------------------------------* 03160013
031700     EXEC SQL                                                     03170013
031800         INCLUDE XLT00010                                         03180013
031900     END-EXEC.                                                    03190013
032000                                                                  03200013
032100*---------------------------------------------------------------* 03210013
032200*  XLT_UPC                                                        03220013
032300*---------------------------------------------------------------* 03230013
032400     EXEC SQL                                                     03240013
032500         INCLUDE XLT00006                                         03250013
032600     END-EXEC.                                                    03260013
032700                                                                  03270013
032800*---------------------------------------------------------------* 03280013
032900*  XLT_SKU                                                        03290013
033000*---------------------------------------------------------------* 03300013
033100     EXEC SQL                                                     03310013
033200         INCLUDE XLT00003                                         03320013
033300     END-EXEC.                                                    03330013
033400                                                                  03340013
033500*---------------------------------------------------------------* 03350013
033600*  XLT_VND_STYL                                                   03360013
033700*---------------------------------------------------------------* 03370013
033800     EXEC SQL                                                     03380013
033900         INCLUDE XLT00004                                         03390013
034000     END-EXEC.                                                    03400013
034100                                                                  03410013
034200*---------------------------------------------------------------* 03420013
034300*  XLT_DEPT                                                       03430013
034400*---------------------------------------------------------------* 03440013
034500     EXEC SQL                                                     03450013
034600         INCLUDE XLT00002                                         03460013
034700     END-EXEC.                                                    03470013
034800                                                                  03480013
034900*---------------------------------------------------------------* 03490013
035000*  SUT_OTBND_UPC                                                  03500013
035100*---------------------------------------------------------------* 03510013
035200     EXEC SQL                                                     03520013
035300         INCLUDE SUT00028                                         03530013
035400     END-EXEC.                                                    03540013
035500                                                                  03550013
035600*---------------------------------------------------------------* 03560013
035700*  SUT_OTBND_CART                                                 03570013
035800*---------------------------------------------------------------* 03580013
035900     EXEC SQL                                                     03590013
036000         INCLUDE SUT00024                                         03600013
036100     END-EXEC.                                                    03610013
036200                                                                  03620013
036300*---------------------------------------------------------------* 03630013
036400*  SUT_OTBND_LOC                                                  03640013
036500*---------------------------------------------------------------* 03650013
036600     EXEC SQL                                                     03660013
036700         INCLUDE SUT00027                                         03670013
036800     END-EXEC.                                                    03680013
036900                                                                  03690013
036910*---------------------------------------------------------------* 03691016
036920*  SUT_OTBND_STR_SCN                                              03692016
036930*---------------------------------------------------------------* 03693016
036940     EXEC SQL                                                     03694016
036950         INCLUDE SUT00121                                         03695016
036960     END-EXEC.                                                    03696016
036970                                                                  03697016
037000*---------------------------------------------------------------* 03700013
037100*  TSUCRDV                                                        03710013
037200*---------------------------------------------------------------* 03720013
037300     EXEC SQL                                                     03730013
037400         INCLUDE TSUCRDV                                          03740013
037500     END-EXEC.                                                    03750013
037600                                                                  03760013
037700*---------------------------------------------------------------* 03770013
037800*  TCNDCDR                                                        03780013
037900*---------------------------------------------------------------* 03790013
038000     EXEC SQL                                                     03800013
038100         INCLUDE TCNDCDR                                          03810013
038200     END-EXEC.                                                    03820013
038300                                                                  03830013
038310*---------------------------------------------------------------* 03831018
038320*  TCNDRST                                                        03832018
038330*---------------------------------------------------------------* 03833018
038340     EXEC SQL                                                     03834018
038350         INCLUDE TCNDRST                                          03835018
038360     END-EXEC.                                                    03836018
038361                                                                  03836118
038362*---------------------------------------------------------------* 03836218
038363*  TSUOBTR                                                        03836318
038364*---------------------------------------------------------------* 03836418
038365     EXEC SQL                                                     03836518
038366         INCLUDE TSUOBTR                                          03836618
038367     END-EXEC.                                                    03836718
038370                                                                  03837018
038400*---------------------------------------------------------------* 03840013
038500*  DRIVING CURSOR                                                 03850020
038600*---------------------------------------------------------------* 03860013
038700     EXEC SQL                                                     03870013
038800          DECLARE PO-CSR CURSOR FOR                               03880013
038900          SELECT A.TRN_NBR , A.RCVR_SEQ_NBR , A.TRN_LNE_NBR       03890013
039000               , B.DEST_LOC_NBR , C.INTR_UPC_ID , D.SKU_NBR       03900013
039100               , C.UPC_NBR, SUM(A.SHPD_UNT_QTY)                   03910013
039200               , F.DEPT_NBR, G.DEPT_NM, D.SKU_DESC                03920013
039300            FROM SUT_OTBND_UPC A                                  03930013
039400               , SUT_OTBND_CART B                                 03940013
039500               , XLT_UPC C                                        03950013
039600               , XLT_SKU D                                        03960013
039700               , XLT_LOC E                                        03970013
039800               , XLT_VND_STYL F                                   03980013
039900               , XLT_DEPT G                                       03990013
040000           WHERE A.TRN_NBR = :DK-PO-NBR                           04000013
040010             AND A.RCVR_SEQ_NBR >= :DK-REC-SEQ-NBR-LOW            04001020
040020             AND A.RCVR_SEQ_NBR <= :DK-REC-SEQ-NBR-HIGH           04002020
040100             AND B.SHIPT_UNT_ID = A.SHIPT_UNT_ID                  04010013
040200             AND B.ACTV_IND = 'Y'                                 04020013
040300             AND B.ORGN_LOC_NBR = :DK-DC-NBR                      04030013
040400             AND B.OTBND_TRIP_ID IS NULL                          04040013
040500             AND TIMESTAMP(B.CRE_DTE,B.CRE_TM) >= :DK-FROM-TMST   04050013
040600             AND TIMESTAMP(B.CRE_DTE,B.CRE_TM) <= :DK-TO-TMST     04060013
040700             AND NOT B.CART_SRC_CDE IN                            04070013
040800                ('P2L','JWL','MST','FXR','WMU','WMC','RDM','3WD') 04080026
040900             AND C.UPC_NBR = A.UPC_NBR                            04090013
041000             AND D.INTR_UPC_ID = C.INTR_UPC_ID                    04100013
041100             AND NOT EXISTS                                       04110013
041200                 (SELECT *                                        04120013
041300                    FROM TSUCRDV X                                04130013
041400                       , TCNDCDR Z                                04140013
041500                       , TCNDRST W                                04150013
041600                   WHERE X.SHIPT_UNT_ID = A.SHIPT_UNT_ID          04160013
041700                     AND X.ACTV_CDE = 'A'                         04170013
041800                     AND Z.OPER_UNT_ID = X.OPER_UNT_ID            04180013
041900                     AND Z.DOOR_ID = X.DOOR_ID                    04190013
042000                     AND W.OPER_UNT_ID = Z.OPER_UNT_ID            04200013
042100                     AND W.DOOR_ID = Z.DOOR_ID                    04210013
042200                     AND X.DIVERT_TMST >= W.STRT_TMST             04220013
042300                     AND X.DIVERT_TMST <= W.END_TMST              04230013
042400                     AND W.STR_NBR = B.DEST_LOC_NBR               04240013
042500                     AND X.DIVERT_TMST =                          04250013
042600                     (SELECT MAX(XX.DIVERT_TMST)                  04260013
042700                        FROM TSUCRDV XX                           04270013
042800                       WHERE XX.SHIPT_UNT_ID = X.SHIPT_UNT_ID))   04280013
042900             AND NOT EXISTS                                       04290013
043000                 (SELECT *                                        04300013
043100                    FROM SUT_OTBND_LOC Y                          04310013
043200                       , TSUOBTR YY                               04320013
043300                   WHERE Y.SHIPT_UNT_ID = A.SHIPT_UNT_ID          04330013
043400                     AND Y.SCN_CDE = 'SHON'                       04340013
043500                     AND Y.ACTV_CDE = 'A'                         04350013
043600                     AND YY.OTBND_TRIP_ID = Y.OTBND_TRIP_ID       04360013
043700                     AND YY.DOOR_TYP_CDE = 'SH')                  04370013
043710             AND NOT EXISTS                                       04371016
043720                 (SELECT *                                        04372016
043730                    FROM SUT_OTBND_STR_SCN Z                      04373016
043750                   WHERE Z.SHIPT_UNT_ID = A.SHIPT_UNT_ID)         04375016
043800             AND E.LOC_NBR = B.DEST_LOC_NBR                       04380013
043900             AND E.LOC_TYP_CDE = 'DS'                             04390013
044000             AND F.STYL_ID = D.STYL_ID                            04400013
044100             AND G.DEPT_NBR = F.DEPT_NBR                          04410013
044200           GROUP BY A.TRN_NBR , A.RCVR_SEQ_NBR , A.TRN_LNE_NBR    04420013
044300                  , B.DEST_LOC_NBR , C.INTR_UPC_ID , D.SKU_NBR    04430013
044400                  , C.UPC_NBR                                     04440013
044500                  , F.DEPT_NBR, G.DEPT_NM, D.SKU_DESC             04450013
044600           ORDER BY A.TRN_NBR , A.RCVR_SEQ_NBR , A.TRN_LNE_NBR    04460013
044700                  , B.DEST_LOC_NBR                                04470013
044800     WITH UR                                                      04480013
044900     END-EXEC.                                                    04490013
045000                                                                  04500013
045160                                                                  04516020
045200******************************************************************04520013
045300 PROCEDURE DIVISION.                                              04530013
045301                                                                  04530122
045400     DISPLAY '**** START OF RCKUT978 ****'.                       04540013
045500                                                                  04550013
045600*OPEN FILES.                                                      04560013
045700     OPEN INPUT  INPUT-FILE.                                      04570013
045800     OPEN OUTPUT RECEIPT-OUTPUT-FILE.                             04580013
045900     OPEN OUTPUT INTRANSIT-OUTPUT-FILE.                           04590013
046000     OPEN OUTPUT ADJUST-OUTPUT-FILE.                              04600013
046100                                                                  04610013
046200     WRITE ADJUST-OUTPUT-RECORD                                   04620013
046300      FROM OHR-OUTPUT-HEADER-RECORD.                              04630013
046400     ADD +1 TO PV-WRITE-COUNT-ADJUST.                             04640013
046500                                                                  04650013
046600     SET   PS-NOT-EOF-INPUT       TO  TRUE.                       04660013
046700                                                                  04670013
046800     PERFORM 1000-INITIALIZATION.                                 04680013
046900                                                                  04690013
047000     PERFORM 2000-PROCESS-INPUT                                   04700013
047100       UNTIL PS-EOF-INPUT.                                        04710013
047200                                                                  04720013
047300                                                                  04730013
047400     DISPLAY '***'                                                04740013
047500     DISPLAY '*** INPUT COUNT           :  ' PV-READ-COUNT        04750013
047600     DISPLAY '*** '                                               04760013
047700     DISPLAY '*** OUTPUT RECEIPT COUNT  :  '                      04770013
047800             PV-WRITE-COUNT-RECEIPT                               04780013
047900     DISPLAY '*** '                                               04790013
048000     DISPLAY '*** OUTPUT INTRANSIT COUNT:  '                      04800013
048100             PV-WRITE-COUNT-INTRANSIT                             04810013
048200     DISPLAY '***'.                                               04820013
048300     DISPLAY '*** OUTPUT ADJUST COUNT   :  '                      04830013
048400             PV-WRITE-COUNT-ADJUST                                04840013
048500     DISPLAY '***'.                                               04850013
048600     DISPLAY '*** CURSOR FETCH COUNT    :  '                      04860013
048700             PV-FETCH-COUNT                                       04870013
048800     DISPLAY '***'.                                               04880013
048900     DISPLAY '*** CLEAN ENTRIES FOUND   :  '                      04890013
049000             PV-CLEAN-COUNT                                       04900013
049100     DISPLAY '***'.                                               04910013
049110                                                                  04911025
049300*CLOSE FILES.                                                     04930013
049400     CLOSE INPUT-FILE.                                            04940013
049500     CLOSE RECEIPT-OUTPUT-FILE.                                   04950013
049600     CLOSE INTRANSIT-OUTPUT-FILE.                                 04960013
049700     CLOSE ADJUST-OUTPUT-FILE.                                    04970013
049701                                                                  04970125
049710     IF  PS-EMPTY-CURSOR                                          04971025
049720         MOVE 4050 TO RETURN-CODE                                 04972025
049730     END-IF.                                                      04973025
049740                                                                  04974025
049750     DISPLAY 'RETURN CODE VALUE IS:  ' RETURN-CODE.               04975025
049800                                                                  04980013
049900     GOBACK.                                                      04990013
050000                                                                  05000013
050100******************************************************************05010013
050200*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *05020013
050300******************************************************************05030013
050400 1000-INITIALIZATION.                                             05040013
050500     DISPLAY '1000-INITIALIZE '.                                  05050013
050600                                                                  05060013
050700     EXEC SQL                                                     05070013
050800          SELECT                                                  05080013
050900                 CURRENT TIMESTAMP                                05090013
051000               , CURRENT TIMESTAMP + 1 MINUTE                     05100013
051100            INTO :PV-SHIPPED-TMST                                 05110013
051200               , :PV-UNLOADED-TMST                                05120013
051300            FROM SYSIBM.SYSDUMMY1                                 05130013
051400     END-EXEC.                                                    05140013
051500                                                                  05150013
051600     PERFORM 7000-READ-INPUT.                                     05160013
051700                                                                  05170013
051800                                                                  05180013
051900******************************************************************05190013
052000**  READ INPUT-FILE, VALIDATE IF DATA IS TO BE PROCESSED TO       05200013
052100**  OUPUT FILE AND IF SO, THEN PROCESS.  IF NOT, JUST READ        05210013
052200**  NEXT RECORD.                                                  05220013
052300******************************************************************05230013
052400 2000-PROCESS-INPUT.                                              05240013
052500                                                                  05250013
052600     DISPLAY 'INPUT RECORD BEING PROCESSED: '.                    05260013
052700     DISPLAY IR-INPUT-RECORD.                                     05270013
052800                                                                  05280013
052900     MOVE IR-PO-NBR               TO  DK-PO-NBR.                  05290013
053000     MOVE IR-DC-NBR               TO  DK-DC-NBR.                  05300013
053001                                                                  05300120
053002     IF  IR-REC-SEQ-NBR = SPACES                                  05300220
053010     OR  IR-REC-SEQ-NBR = 0000                                    05301020
053020         MOVE 0000                TO  DK-REC-SEQ-NBR-LOW          05302020
053030         MOVE 9999                TO  DK-REC-SEQ-NBR-HIGH         05303020
053040     ELSE                                                         05304020
053041         MOVE IR-REC-SEQ-NBR      TO  DK-REC-SEQ-NBR-LOW          05304120
053042                                      DK-REC-SEQ-NBR-HIGH         05304220
053043     END-IF.                                                      05304320
053050                                                                  05305020
053100     MOVE IR-FROM-DATE            TO  PV-FROM-TMST-DATE.          05310013
053200     MOVE IR-FROM-TIME            TO  PV-FROM-TMST-TIME.          05320013
053300     MOVE PV-FROM-TMST            TO  DK-FROM-TMST.               05330013
053400     MOVE IR-TO-DATE              TO  PV-TO-TMST-DATE.            05340013
053500     MOVE IR-TO-TIME              TO  PV-TO-TMST-TIME.            05350013
053600     MOVE PV-TO-TMST              TO  DK-TO-TMST.                 05360013
053700                                                                  05370013
053800     MOVE 'N' TO PS-END-OF-PO-CSR-SW.                             05380013
053900                                                                  05390013
054000     PERFORM 4000-OPEN-PO-CSR.                                    05400013
054100                                                                  05410013
054200     PERFORM 4200-PROCESS-CSR                                     05420013
054300       UNTIL  PS-END-OF-PO-CSR.                                   05430013
054400                                                                  05440013
054500     PERFORM 4500-CLOSE-PO-CSR.                                   05450013
054600                                                                  05460013
054700     PERFORM 7000-READ-INPUT.                                     05470013
054800*---------------------------------------------------------------- 05480013
054900*                                                                 05490013
055000*---------------------------------------------------------------- 05500013
055100 2020-POPULATE-PCRD010-SHIPPED.                                   05510013
055200                                                                  05520013
055300     INITIALIZE PC010-PCT-INTRANSIT-REC.                          05530013
055400     MOVE XLT00006-INTR-UPC-ID        TO  PC010-INTR-UPC-ID.      05540013
055500     MOVE SE-LOC-NBR                  TO  PC010-STR-NBR.          05550013
055600     SET  PC010-SHIPPD-DC             TO  TRUE.                   05560013
055700     MOVE SE-RETAIL-UNITS-MARK        TO  PC010-IN-TRNST-QTY.     05570013
055800     MULTIPLY  PC010-IN-TRNST-QTY                                 05580013
055900           BY  -1                                                 05590013
056000       GIVING  PC010-IN-TRNST-QTY.                                05600013
056100     MOVE 'RCKUT978'                  TO  PC010-UPD-USR-ID.       05610013
056200     MOVE SE-PO                       TO  PC010-PO-NBR.           05620013
056300     MOVE SE-REC-SEQ-NBR              TO  PC010-RCVR-SEQ-NBR.     05630013
056400     MOVE ZEROES                      TO  PC010-TRIP-ID.          05640013
056500     SET  PC010-SHIPPED-FROM-DC       TO  TRUE.                   05650013
056600     SET  PC010-NOT-UNLOADED-AT-STORE TO  TRUE.                   05660013
056700     SET  PC010-TRN-IN-TRANSIT        TO  TRUE.                   05670013
056800     MOVE XLT00006-UPC-NBR            TO  PC010-UPC-NBR.          05680013
056900     MOVE PV-SHIPPED-TMST             TO  PC010-EVENT-TMST.       05690013
057000     MOVE SE-POLINENO                 TO  PC010-TRN-LNE-NBR.      05700013
057100     MOVE ' '                         TO  PC010-OTB-TYP-CDE.      05710013
057200                                                                  05720013
057300*---------------------------------------------------------------- 05730013
057400*                                                                 05740013
057500*---------------------------------------------------------------- 05750013
057600 2030-POPULATE-PCRD010-UNLOADED.                                  05760013
057700                                                                  05770013
057800     SET  PC010-UNLOAD-ST             TO  TRUE.                   05780013
057900     SET  PC010-NOT-SHIPPED-FROM-DC   TO  TRUE.                   05790013
058000     SET  PC010-UNLOADED-AT-STORE     TO  TRUE.                   05800013
058100     MOVE PV-UNLOADED-TMST            TO  PC010-EVENT-TMST.       05810013
058200     MULTIPLY  PC010-IN-TRNST-QTY                                 05820013
058300           BY  -1                                                 05830013
058400       GIVING  PC010-IN-TRNST-QTY.                                05840013
058500                                                                  05850013
058600*---------------------------------------------------------------- 05860013
058700*                                                                 05870013
058800*---------------------------------------------------------------- 05880013
058900 2040-POPULATE-ADJUST-RECORD.                                     05890013
059000                                                                  05900013
059100     INITIALIZE OR-OUTPUT-RECORD.                                 05910013
059200     MOVE SE-PO                       TO  OR-PO-NBR.              05920013
059300     MOVE SE-REC-SEQ-NBR              TO  OR-REC-SEQ-NBR.         05930013
059400     MOVE SE-POLINENO                 TO  OR-PO-LNE-NBR.          05940013
059500     MOVE SE-LOC-NBR                  TO  OR-STORE-NBR.           05950013
059600     MOVE SE-SKU-NBR                  TO  OR-SKU-NBR.             05960013
059700     MOVE SE-RETAIL-UNITS-MARK        TO  OR-QTY.                 05970013
059800     MOVE PV-DEPT-NBR                 TO  OR-DEPT-NBR.            05980013
059900     INSPECT PV-DEPT-NM REPLACING ALL                             05990013
060000         ',' BY SPACES.                                           06000013
060100     MOVE PV-DEPT-NM                  TO  OR-DEPT-NM.             06010013
060200     INSPECT PV-SKU-DESC REPLACING ALL                            06020013
060300         ',' BY SPACES.                                           06030013
060400     MOVE PV-SKU-DESC                 TO  OR-SKU-DESC.            06040013
060500     IF  PS-CLEAN-EXISTS                                          06050013
060510         SET OR-CLEAN-EXISTS    TO TRUE                           06051013
060520     ELSE                                                         06052013
060530         SET OR-CLEAN-EXISTS-NO TO TRUE                           06053013
060540     END-IF.                                                      06054013
060550                                                                  06055013
060560 4000-OPEN-PO-CSR.                                                06056013
060570                                                                  06057013
060580     MOVE '4000-OPEN-PO-CSR'                                      06058013
060590         TO PV-ABEND-PARAGRAPH.                                   06059013
060600     MOVE 'OPEN PO CURSOR'                                        06060013
060700         TO PV-ABEND-OPERATION.                                   06070013
060800                                                                  06080013
060900     EXEC SQL                                                     06090013
061000         OPEN PO-CSR                                              06100013
061100     END-EXEC.                                                    06110013
061200                                                                  06120013
061300     EVALUATE TRUE                                                06130013
061400         WHEN SQLWARN0 NOT = SPACE                                06140013
061500         WHEN SQLCODE < ZERO                                      06150013
061600         WHEN SQLCODE > ZERO                                      06160013
061700             DISPLAY IR-INPUT-RECORD                              06170013
061800             MOVE  SQLCODE               TO PV-DISP-SQLCODE       06180013
061900             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              06190013
061901             MOVE DK-FROM-TMST  TO                                06190127
061910                                PV-DB2-OPERATION-MESSAGE-1        06191027
061911             MOVE DK-TO-TMST    TO                                06191127
061920                                PV-DB2-OPERATION-MESSAGE-2        06192027
062000             PERFORM 9900-DB2-ABEND                               06200013
062100         WHEN SQLCODE = ZERO                                      06210013
062200             SET PS-CSR-FIRST-FETCH TO TRUE                       06220021
062300     END-EVALUATE.                                                06230013
062400                                                                  06240013
062500 4200-PROCESS-CSR.                                                06250013
062600                                                                  06260013
062700     PERFORM 4300-FETCH-PO-CSR.                                   06270013
062800                                                                  06280013
062900     IF  PS-END-OF-PO-CSR                                         06290013
062910         IF  PS-CSR-FIRST-FETCH                                   06291020
062920             DISPLAY '## CURSOR BROUGHT BACK NO DATA ##'          06292020
062921             SET PS-EMPTY-CURSOR TO TRUE                          06292125
062930         ELSE                                                     06293020
063000             CONTINUE                                             06300020
063010         END-IF                                                   06301020
063100     ELSE                                                         06310013
063110         SET PS-CSR-NOT-FIRST-FETCH TO TRUE                       06311020
063200         PERFORM 4800-PROCESS-DATA                                06320013
063300     END-IF.                                                      06330013
063400                                                                  06340013
063500 4300-FETCH-PO-CSR.                                               06350013
063600                                                                  06360013
063700     MOVE '4300-FETCH-PO-CSR'                                     06370013
063800         TO PV-ABEND-PARAGRAPH.                                   06380013
063900     MOVE 'FETCH THE PO_CSR'                                      06390013
064000         TO PV-ABEND-OPERATION.                                   06400013
064100                                                                  06410013
064200     EXEC SQL                                                     06420013
064300         FETCH  PO-CSR                                            06430013
064400          INTO  :SUT00028-TRN-NBR                                 06440013
064500             ,  :SUT00028-RCVR-SEQ-NBR                            06450013
064600             ,  :SUT00028-TRN-LNE-NBR                             06460013
064700             ,  :SUT00024-DEST-LOC-NBR                            06470013
064800             ,  :XLT00006-INTR-UPC-ID                             06480013
064900             ,  :XLT00003-SKU-NBR                                 06490013
065000             ,  :XLT00006-UPC-NBR                                 06500013
065100             ,  :SUT00028-SHPD-UNT-QTY                            06510013
065200             ,  :XLT00004-DEPT-NBR                                06520013
065300             ,  :XLT00002-DEPT-NM                                 06530013
065400             ,  :XLT00003-SKU-DESC                                06540013
065500     END-EXEC.                                                    06550013
065600                                                                  06560013
065700     EVALUATE TRUE                                                06570013
065800         WHEN SQLCODE = +100                                      06580013
065900             SET PS-END-OF-PO-CSR    TO  TRUE                     06590013
066000         WHEN SQLWARN0 NOT = SPACE                                06600013
066100         WHEN SQLCODE < ZERO                                      06610013
066200         WHEN SQLCODE > ZERO                                      06620013
066300             DISPLAY IR-INPUT-RECORD                              06630013
066400             MOVE  SQLCODE               TO PV-DISP-SQLCODE       06640013
066500             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              06650013
066600             PERFORM 9900-DB2-ABEND                               06660013
066700         WHEN SQLCODE = ZERO                                      06670013
066800             ADD +1 TO PV-FETCH-COUNT                             06680013
066900                       PV-FETCH-COUNT2                            06690013
067000             IF  PV-FETCH-COUNT2 = 500                            06700013
067100                 MOVE PV-FETCH-COUNT TO                           06710013
067200                      PV-DISPLAY-FETCH-COUNT1                     06720013
067300                 DISPLAY 'PROGRAM PROGRESS FETCH: '               06730013
067310                         PV-DISPLAY-FETCH-COUNT1                  06731013
067320                 MOVE +0 TO PV-FETCH-COUNT2                       06732013
067330             END-IF                                               06733013
067340     END-EVALUATE.                                                06734013
067350                                                                  06735013
067360 4500-CLOSE-PO-CSR.                                               06736013
067370                                                                  06737013
067380     MOVE '4500-CLOSE-PO-CSR'                                     06738013
067390         TO PV-ABEND-PARAGRAPH.                                   06739013
067400     MOVE 'CLOSE PO CURSOR'                                       06740013
067500         TO PV-ABEND-OPERATION.                                   06750013
067600                                                                  06760013
067700     EXEC SQL                                                     06770013
067800         CLOSE PO-CSR                                             06780013
067900     END-EXEC.                                                    06790013
068000                                                                  06800013
068100     EVALUATE TRUE                                                06810013
068200         WHEN SQLWARN0 NOT = SPACE                                06820013
068300         WHEN SQLCODE < ZERO                                      06830013
068400         WHEN SQLCODE > ZERO                                      06840013
068500             DISPLAY IR-INPUT-RECORD                              06850013
068600             MOVE  SQLCODE               TO PV-DISP-SQLCODE       06860013
068700             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              06870013
068800             PERFORM 9900-DB2-ABEND                               06880013
068900         WHEN SQLCODE = ZERO                                      06890013
069000             CONTINUE                                             06900013
069100     END-EVALUATE.                                                06910013
069200                                                                  06920013
069300 4800-PROCESS-DATA.                                               06930013
069400                                                                  06940013
069500     INITIALIZE STORE-EXTRACT-LINE.                               06950013
069600     MOVE IR-PO-NBR TO SE-PO.                                     06960013
069700     MOVE SUT00028-RCVR-SEQ-NBR TO SE-REC-SEQ-NBR.                06970013
069800     MOVE SUT00024-DEST-LOC-NBR TO SE-LOC-NBR.                    06980013
069900     MOVE SUT00028-TRN-LNE-NBR TO SE-POLINENO.                    06990013
070000     MOVE XLT00003-SKU-NBR TO SE-SKU-NBR.                         07000013
070100     MOVE XLT00004-DEPT-NBR TO PV-DEPT-NBR.                       07010013
070200     MOVE XLT00002-DEPT-NM  TO PV-DEPT-NM.                        07020013
070300     MOVE XLT00003-SKU-DESC TO PV-SKU-DESC.                       07030013
070400     MOVE ZERO TO SE-NOTIF-NBR.                                   07040013
070500     MOVE ZERO TO SE-ADJ-CYC-NBR.                                 07050013
070600     MOVE IR-DC-NBR TO SE-OPER-UNT-ID.                            07060013
070700     MOVE IR-DC-NBR TO SE-CURR-OPER-UNT-ID.                       07070013
070800     MOVE 1 TO SE-FCLTY-ID.                                       07080013
070900     MOVE 1 TO SE-CURR-FCLTY-ID.                                  07090013
071000     SET SE-ADJUSTMENT TO TRUE.                                   07100013
071100     MOVE SUT00028-SHPD-UNT-QTY TO SE-RETAIL-UNITS-MARK.          07110013
071200     MULTIPLY SE-RETAIL-UNITS-MARK                                07120013
071300           BY -1                                                  07130013
071400       GIVING SE-RETAIL-UNITS-MARK.                               07140013
071500     MOVE 'N' TO SE-CS-CONVRSON-IND.                              07150013
071600                                                                  07160013
071700*    CHECK PCT_TRN_CLSN_DTL                                       07170013
071800     SET PS-CLEAN-EXISTS-NO TO TRUE.                              07180013
071900     MOVE XLT00006-INTR-UPC-ID  TO DK-SE-INTR_UPC_ID.             07190013
072000     MOVE SUT00024-DEST-LOC-NBR TO DK-SE-LOC-NBR.                 07200013
072100     MOVE SUT00028-TRN-NBR      TO DK-SE-PO-NBR.                  07210013
072200     MOVE SUT00028-RCVR-SEQ-NBR TO DK-SE-RCVR-SEQ-NBR.            07220013
072300     PERFORM 6000-CHECK-SE-CLEAN.                                 07230013
072400                                                                  07240013
072500     IF  PS-CLEAN-EXISTS                                          07250013
072600         NEXT SENTENCE                                            07260013
072700     ELSE                                                         07270013
072800         PERFORM 8000-WRITE-OUTPUT-RECEIPT                        07280013
072900         PERFORM 2020-POPULATE-PCRD010-SHIPPED                    07290013
073000         PERFORM 8010-WRITE-PCRD010                               07300013
073100         PERFORM 2030-POPULATE-PCRD010-UNLOADED                   07310013
073200         PERFORM 8010-WRITE-PCRD010                               07320013
073300     END-IF.                                                      07330013
073400                                                                  07340013
073500     PERFORM 2040-POPULATE-ADJUST-RECORD.                         07350013
073600     PERFORM 8020-WRITE-ADJUST.                                   07360013
073700                                                                  07370013
073800******************************************************************07380013
073900*                                                                *07390013
074000******************************************************************07400013
074100 6000-CHECK-SE-CLEAN.                                             07410013
074200                                                                  07420013
074300     MOVE '6000-CHECK-SE-CLEAN'                                   07430013
074400         TO PV-ABEND-PARAGRAPH.                                   07440013
074500     MOVE 'SELECT PCT_TRN_CLSN_DTL'                               07450013
074600         TO PV-ABEND-OPERATION.                                   07460013
074700                                                                  07470013
074800     EXEC SQL                                                     07480013
074900          SELECT TRN_CLSN_CDE                                     07490013
075000          INTO  :PCT00015-TRN-CLSN-CDE                            07500013
075100          FROM   PCT_TRN_CLSN_DTL                                 07510013
075200          WHERE  INTR_UPC_ID   = :DK-SE-INTR_UPC_ID               07520013
075300           AND   LOC_NBR       = :DK-SE-LOC-NBR                   07530013
075400           AND   TRN_CLSN_CDE  = 'SE'                             07540013
075500           AND   TRN_TYP_CDE   = 'CL'                             07550013
075600           AND   PO_NBR        = :DK-SE-PO-NBR                    07560013
075700           AND   RCVR_SEQ_NBR  = :DK-SE-RCVR-SEQ-NBR              07570013
075800          FETCH FIRST 1 ROW ONLY                                  07580013
075900          WITH UR                                                 07590013
076000     END-EXEC.                                                    07600013
076100                                                                  07610013
076200     EVALUATE TRUE                                                07620013
076300         WHEN SQLCODE = ZERO                                      07630013
076400         WHEN SQLCODE = -811                                      07640013
076500             SET PS-CLEAN-EXISTS     TO  TRUE                     07650013
076600             ADD 1 TO PV-CLEAN-COUNT                              07660013
076700             MOVE DK-SE-INTR_UPC_ID  TO PV-DISP-INTR-UPC          07670013
076800             MOVE DK-SE-LOC-NBR      TO PV-DISP-LOC-NBR           07680013
076900             MOVE DK-SE-PO-NBR       TO PV-DISP-PO                07690013
076910             MOVE DK-SE-RCVR-SEQ-NBR TO PV-DISP-RCVR              07691013
076920             DISPLAY 'CLEAN FOUND FOR:  '                         07692013
076930                     'SKU - ' XLT00003-SKU-NBR                    07693013
076940                     ' LOC - ' PV-DISP-LOC-NBR                    07694013
076950                     ' PO - ' PV-DISP-PO                          07695013
076960                     ' RCVR - ' PV-DISP-RCVR                      07696013
076970                     ' INTR UPC - ' PV-DISP-INTR-UPC              07697013
076980         WHEN SQLCODE = +100                                      07698013
076990             SET PS-CLEAN-EXISTS-NO  TO  TRUE                     07699013
077000         WHEN SQLWARN0 NOT = SPACE                                07700013
077100         WHEN SQLCODE < ZERO                                      07710013
077200         WHEN SQLCODE > ZERO                                      07720013
077210             DISPLAY 'ABEND INFO - KEY DATA'                      07721013
077220             DISPLAY 'SKU NUMBER IS: '  XLT00003-SKU-NBR          07722013
077230             MOVE SUT00024-DEST-LOC-NBR TO PV-DISP-LOC-NBR        07723013
077240             DISPLAY 'LOC NUMBER IS: '  PV-DISP-LOC-NBR           07724013
077250             MOVE SUT00028-TRN-NBR      TO PV-DISP-PO             07725013
077260             DISPLAY 'PO NUMBER IS : '  PV-DISP-PO                07726013
077270             MOVE SUT00028-RCVR-SEQ-NBR TO PV-DISP-RCVR           07727013
077280             DISPLAY 'REC NUMBER IS: '  PV-DISP-RCVR              07728013
077290             MOVE XLT00006-INTR-UPC-ID  TO PV-DISP-INTR-UPC       07729013
077300             DISPLAY 'INTR UPC IS  :  ' PV-DISP-INTR-UPC          07730013
077400             MOVE  SQLCODE               TO PV-DISP-SQLCODE       07740013
077500             DISPLAY 'SQL CODE IS: ' PV-DISP-SQLCODE              07750013
077600             PERFORM 9900-DB2-ABEND                               07760013
077700         WHEN SQLCODE = ZERO                                      07770013
077800             CONTINUE                                             07780013
077900     END-EVALUATE.                                                07790013
078000                                                                  07800013
078100******************************************************************07810013
078200*                                                                *07820013
078300******************************************************************07830013
078400 7000-READ-INPUT.                                                 07840013
078500                                                                  07850013
078600     READ INPUT-FILE                                              07860013
078700     INTO IR-INPUT-RECORD                                         07870013
078800        AT END                                                    07880013
078900           SET  PS-EOF-INPUT  TO TRUE.                            07890013
079000                                                                  07900013
079100     IF  PS-EOF-INPUT                                             07910013
079200         NEXT SENTENCE                                            07920013
079300     ELSE                                                         07930013
079400         ADD 1 TO  PV-READ-COUNT                                  07940013
079500         ADD 1 TO  PV-READ-COUNT-2                                07950013
079600         IF  PV-READ-COUNT-2 = 500                                07960013
079700             DISPLAY 'READ COUNT:'                                07970013
079800                     PV-READ-COUNT                                07980013
079900             MOVE ZEROES  TO PV-READ-COUNT-2                      07990013
080000         END-IF                                                   08000013
080100     END-IF.                                                      08010013
080200                                                                  08020013
080300                                                                  08030013
080400******************************************************************08040013
080500*                                                                *08050013
080600******************************************************************08060013
080700 8000-WRITE-OUTPUT-RECEIPT.                                       08070013
080800                                                                  08080013
080900     WRITE RECEIPT-OUTPUT-RECORD                                  08090013
081000      FROM STORE-EXTRACT-LINE.                                    08100013
081100     ADD +1 TO PV-WRITE-COUNT-RECEIPT.                            08110013
081200                                                                  08120013
081300                                                                  08130013
081400******************************************************************08140013
081500*                                                                *08150013
081600******************************************************************08160013
081700 8010-WRITE-PCRD010.                                              08170013
081800                                                                  08180013
081900     WRITE INTRANSIT-OUTPUT-RECORD                                08190013
082000      FROM PC010-PCT-INTRANSIT-REC.                               08200013
082100     ADD +1 TO PV-WRITE-COUNT-INTRANSIT.                          08210013
082200                                                                  08220013
082300******************************************************************08230013
082400*                                                                *08240013
082500******************************************************************08250013
082600 8020-WRITE-ADJUST.                                               08260013
082700                                                                  08270013
082800     WRITE ADJUST-OUTPUT-RECORD                                   08280013
082900      FROM OR-OUTPUT-RECORD.                                      08290013
083000     ADD +1 TO PV-WRITE-COUNT-ADJUST.                             08300013
083100                                                                  08310013
083200                                                                  08320013
083300******************************************************************08330013
083400*  ABEND ROUTINE                                                 *08340013
083500******************************************************************08350013
083600 9900-DB2-ABEND.                                                  08360013
083700                                                                  08370013
083800     MOVE SQLCODE TO PV-SQLCODE.                                  08380013
083900     DISPLAY '*** DB2 ERROR '.                                    08390013
084000     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08400013
084100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08410013
084200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08420013
084300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08430013
084400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08440013
084500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08450013
084600     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.              08460013
084700     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.              08470013
084800                                                                  08480013
084900     COPY DPPD004.                                                08490013
085000                                                                  08500013
085100     MOVE +4013 TO PV-ABEND-CODE.                                 08510013
085200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08520013
085300                                                                  08530013
086500******************************************************************08650013
086600*                 E N D   O F   P R O G R A M                    *08660013
086700******************************************************************08670013
