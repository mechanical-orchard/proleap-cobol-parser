000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.      PMKUT108.                                       00050000
000600 AUTHOR.          AMANDA NEWHART.                                 00060000
000700 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00070000
000800 DATE-WRITTEN.    SEPTEMBER 2003.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*     PMKUT108 -                                                 *00120000
001300*      THIS PROGRAM DETERMINES LPS EXCEPTIONS.  OPEN THE OUTPUT  *00130000
001400*      FILE AND CONTROL CARD.  THE CONTROL CARD CONTAINS THE ADV *00140000
001500*      IND WHICH IS USED IN THE PRICING SQL TO DETERMINE IF ALL  *00150000
001600*      OR JUST ADV SHOULD BE BROUGHT BACK FROM THE TABLE,        *00160000
001700*      XST_LPS_MIN_PRIC_W. FIND THE CURRENT DATE BY USING THE    *00170000
001800*      SYSDUMMY1 TABLE.  OPEN THE DPT-CSR AND THEN FOR EACH ROW  *00180000
001900*      FOUND OPEN THE PRICE-CSR USING THE DPT NBR FROM THE       *00190000
002000*      DPT-CSR.  WHEN A PRICING ROW IS FOUND CHECK THE PRICING   *00200000
002100*      AMOUNTS.  IF THE LPS HAS NO PRICE DO NOTHING AND FETCH    *00210000
002200*      THE NEXT ROW.  ALTHOUGH IF THE LPS PRICE DOES HAVE A      *00220000
002300*      PRICE THEN COMPARE THE FUTURE MAIN PRICE AND THE HISTORY  *00230000
002400*      MAIN PRICE.  IF THE HISTORY MAIN PRICE IS LESS THEN THE   *00240000
002500*      FUTURE MAIN PRICE THEN CHECK IF THE HISTORY MAIN PRICE    *00250000
002600*      IS LESS THEN OR EQUAL TO THE LPS PRICE.  IF SO THEN MOVE  *00260000
002700*      THE HISTORY AND LPS VARIABLES TO THE COPYBOOK AND WRITE   *00270000
002800*      THE COPYBOOK TO A FILE.  IF THE FUTURE MAIN PRICE IS LESS *00280000
002900*      THEN THE HISTORY MAIN PRICE THEN COMPARE THE FUTURE MAIN  *00290000
003000*      PRICE TO THE LPS PRICE.  IF THE FUTURE MAIN PRICE IS LESS *00300000
003100*      THEN THE LPS PRICE THEN MOVE THE FUTURE AND LPS VARIABLES *00310000
003200*      TO THE COPYBOOK AND WRITE THE COPYBOOK TO A FILE.  NEXT   *00320000
003300*      DO THE SAME CHECK WITH THE HISTORY NON-MAIN AND FUTURE    *00330000
003400*      NON-MAIN.  WHEN THIS ROW IS DONE BEING VERIFIED FETCH THE *00340000
003500*      NEXT ROW IN THE PRICE-CSR AND REPEAT UNTIL THE LAST ROW   *00350000
003600*      IS FOUND.  WHEN THE LAST ROW IS FOUND THEN FETCH THE NEXT *00360000
003700*      ROW IN THE DPT-CSR AND REPEAT THE PRICE-CSR PROCESS.  WHEN*00370000
003800*      ALL DONE CLOSE THE OUTPUT FILE AND DISPLAY THE TOTALS.    *00380000
003900*                                                                *00390000
004000******************************************************************00400000
004100**   CHANGE LOG:                                                 *00410000
004200******************************************************************00420000
004300*    09/25/2003 - AMANDA NEWHART - WR21770                       *00430000
004400*     - CHANGED THE UPC FROM COMP-3 TO COMP.                     *00440000
004500*                                                                *00450000
004600*    09/26/2003 - MARTIN BRADLEY - WR25600                       *00460000
004700*     - NOTE - WR25600 IS THE CORRECT WR AND SHOULD BE USED.     *00470000
004800*     - REMOVED THE CALL TO PMKUT110.  MADE THIS A SEPERATE STEP *00480000
004900*       IN THE PROC.                                             *00490000
005000*                                                                *00500000
005100*    09/29/2003 - MARTIN BRADLEY - WR25600                       *00510000
005200*     - REMOVED EXTRA CODE THAT WAS NOT NEEDED ANYMORE.          *00520000
005300*                                                                *00530000
005400*    09/29/2003 - AMANDA NEWHART - WR25600                       *00540000
005500*     - REMOVED A COMMENT.                                       *00550000
005300*                                                                *00560000
005400*    01/30/2005 - KELLY WIESNER - MOVED WITH WR28178             *00570000
005500*     - STORE NUMBER EXPANSION PROJECT.                          *00580000
005500*     - COMMIT LOGIC TO HELP RELEASE OF TSKST PER DBA'S.         *00590000
005300*                                                                *00600002
005400*    09/08/2005 - COLLEEN CUMMINGS - WR29445                     *00610003
005500*     - NON-MAIN PRICING MUST BE LOWER THAN LPS PRICING.         *00620002
005500*       (USED TO BE OK TO BE EQUAL TO - NOT ANYMORE)             *00630003
005500*       CHANES IN PARAGRAPH 'C410-PROCESS-PRICE-CSR'.            *00640002
005300*                                                                *00640104
005400*    01/24/2006 - ERIC ZUNKE - WR29979                           *00641004
005500*     - REMOVAL OF MAP PRICING CHECK, NO LONGER OKAY FOR MAP     *00642004
005500*       TO BE LOWER THAT LPS PRICE.                              *00643004
005300*                                                                *00645004
C77388*    09/11/2017 - COGNIZANT - CHG0177388                         *00646006
C77388*     - IF LPS PRICE IS ONLY LESS THAN ANY OF THE FUTURE OR HISTO*00647006
C77388*       -RY PROMOTIONS, ONLY THEN THE OUTPUT REPORT SHOULD BE    *00648007
C77388*       GENERATED. EARLIER IT WAS GENARATED EVEN IF THE LPS PRICE*00648106
C77388*       IS EQUAL TO ANYOTHER PROMOTIONS.                          00648206
C77388*       CHANGES CAN BE RECOGNIZED BY C77388                       00648306
005300*                                                                *00649006
005600******************************************************************00650000
005700 ENVIRONMENT DIVISION.                                            00660000
005800******************************************************************00670000
005900                                                                  00680000
006000 CONFIGURATION SECTION.                                           00690000
006100                                                                  00700000
006200 SOURCE-COMPUTER. IBM-3090.                                       00710000
006300 OBJECT-COMPUTER. IBM-3090.                                       00720000
006400                                                                  00730000
006500 INPUT-OUTPUT SECTION.                                            00740000
006600                                                                  00750000
006700 FILE-CONTROL.                                                    00760000
006800                                                                  00770000
006900     SELECT LPS-ADV-CDE-CONTROL-CARD                              00780000
007000         ASSIGN                       TO INP01.                   00790000
007100                                                                  00800000
007110     SELECT CC-RPT-IND-FILE                                       00810000
007120         ASSIGN                       TO INP02.                   00820000
007130                                                                  00830000
007200     SELECT LPS-PRE-EXCEP-FILE                                    00840000
007300         ASSIGN                       TO OUT01.                   00850000
007400                                                                  00860000
007500******************************************************************00870000
007600 DATA DIVISION.                                                   00880000
007700******************************************************************00890000
007800                                                                  00900000
007900 FILE SECTION.                                                    00910000
008000                                                                  00920000
008100 FD  LPS-ADV-CDE-CONTROL-CARD                                     00930000
008200     RECORDING MODE F                                             00940000
008300     BLOCK CONTAINS 0 RECORDS                                     00950000
008400     LABEL RECORDS ARE STANDARD.                                  00960000
008500                                                                  00970000
008600 01  LSP-ADV-CDE-CONTROL-CARD-REC  PIC X(80).                     00980000
008700                                                                  00990000
008710 FD  CC-RPT-IND-FILE                                              01000000
008720     RECORDING MODE F                                             01010000
008730     BLOCK CONTAINS 0 RECORDS                                     01020000
008740     LABEL RECORDS ARE STANDARD.                                  01030000
008750                                                                  01040000
008760 01  CC-RPT-IND-RECORD             PIC X(80).                     01050000
008770                                                                  01060000
008800 FD  LPS-PRE-EXCEP-FILE                                           01070000
008900     RECORDING MODE F                                             01080000
009000     BLOCK CONTAINS 0 RECORDS                                     01090000
009100     LABEL RECORDS ARE STANDARD.                                  01100000
009200 01  LPS-PRE-EXCEP-RECORD          PIC X(350).                    01110000
009300                                                                  01120000
009400 WORKING-STORAGE SECTION.                                         01130000
009500                                                                  01140000
009600******************************************************************01150000
009700* PC PROGRAM CONSTANTS                                            01160000
009800******************************************************************01170000
009900 01  PC-PROGRAM-CONSTANTS.                                        01180000
010000     05  PC-PROGRAM-NAME              PIC X(08)      VALUE        01190000
010100                                                     'PMKUT108'.  01200000
010200     05  PC-MAIN-PROMO                PIC X(14)      VALUE        01210000
010300                                                'MAIN PROMOTION'. 01220000
010400     05  PC-SPACE                     PIC X(01)      VALUE ' '.   01230000
010500     05  PC-HIGH-PRICE                PIC S9(07)V9(3) COMP-3      01240000
010600                                             VALUE 9999999.999.   01250000
010700                                                                  01260000
010800******************************************************************01270000
010900* PV PROGRAM VARIABLES                                            01280000
011000******************************************************************01290000
011100 01  PV-PROGRAM-VARIABLES.                                        01300000
011200     05  PV-PARAGRAPH-NAME            PIC  X(40)  VALUE SPACES.   01310000
011300     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.   01320000
011400     05  PV-DB2-TABLE-NAME-1          PIC  X(40)  VALUE SPACES.   01330000
011500     05  PV-DB2-TABLE-NAME-2          PIC  X(40)  VALUE SPACES.   01340000
011600     05  PV-DB2-TABLE-NAME-3          PIC  X(40)  VALUE SPACES.   01350000
011610     05  PV-LPS-PREV-RPTD-IND         PIC  X(01)  VALUE SPACES.   01360000
011700     05  PV-GMA-NBR                   PIC  X(02)  VALUE SPACES.   01370000
011800     05  PV-GMA-FIRST-NM              PIC  X(12)  VALUE SPACES.   01380000
011900     05  PV-GMA-LAST-NM               PIC  X(18)  VALUE SPACES.   01390000
012000     05  PV-DMA-NBR                   PIC  X(02)  VALUE SPACES.   01400000
012100     05  PV-DMA-FIRST-NM              PIC  X(12)  VALUE SPACES.   01410000
012200     05  PV-DMA-LAST-NM               PIC  X(18)  VALUE SPACES.   01420000
012300     05  PV-BYR-NBR                   PIC  X(03)  VALUE SPACES.   01430000
012400     05  PV-BYR-FIRST-NM              PIC  X(12)  VALUE SPACES.   01440000
012500     05  PV-BYR-LAST-NM               PIC  X(18)  VALUE SPACES.   01450000
012600     05  PV-DPT-NBR-CHAR              PIC  X(03)  VALUE SPACES.   01460000
012700     05  PV-DPT-DESC                  PIC  X(25)  VALUE SPACES.   01470000
012800     05  PV-LPS-PROMO-ITM-ID          PIC S9(10)V COMP-3          01480000
012900                                                  VALUE ZEROS.    01490000
013000     05  PV-LPS-PRICG-AMT             PIC S9(07)V9(3) COMP-3      01500000
013100                                                  VALUE ZEROS.    01510000
013200     05  PV-LPS-PROMO-NM              PIC  X(40)  VALUE SPACES.   01520000
013300     05  PV-HIST-MP-ITM-ID            PIC S9(10)V COMP-3          01530000
013400                                                  VALUE ZEROS.    01540000
013500     05  PV-HIST-MP-PROMO-ID          PIC S9(10)V COMP-3          01550000
013600                                                  VALUE ZEROS.    01560000
013700     05  PV-HIST-MP-LO-AMT            PIC S9(07)V9(3) COMP-3      01570000
013800                                                  VALUE ZEROS.    01580000
013900     05  PV-HIST-MP-PROMO-NM          PIC  X(40)  VALUE SPACES.   01590000
014000     05  PV-HIST-MP-ADEVNT-NBR        PIC  X(15)  VALUE SPACES.   01600000
014100     05  PV-HIST-MP-ADEVNT-NM         PIC  X(40)  VALUE SPACES.   01610000
014200     05  PV-FUT-MP-ITM-ID             PIC S9(10)V COMP-3          01620000
014300                                                  VALUE ZEROS.    01630000
014400     05  PV-FUT-MP-PROMO-ID           PIC S9(10)V COMP-3          01640000
014500                                                  VALUE ZEROS.    01650000
014600     05  PV-FUT-MP-LO-AMT             PIC S9(07)V9(3) COMP-3      01660000
014700                                                  VALUE ZEROS.    01670000
014800     05  PV-FUT-MP-PROMO-NM           PIC  X(40)  VALUE SPACES.   01680000
014900     05  PV-FUT-MP-ADEVNT-NBR         PIC  X(15)  VALUE SPACES.   01690000
015000     05  PV-FUT-MP-ADEVNT-NM          PIC  X(40)  VALUE SPACES.   01700000
015100     05  PV-HIST-NMP-ITM-ID           PIC S9(10)V COMP-3          01710000
015200                                                  VALUE ZEROS.    01720000
015300     05  PV-HIST-NMP-PROMO-ID         PIC S9(10)V COMP-3          01730000
015400                                                  VALUE ZEROS.    01740000
015500     05  PV-HIST-NMP-LO-AMT           PIC S9(07)V9(3) COMP-3      01750000
015600                                                  VALUE ZEROS.    01760000
015700     05  PV-HIST-NMP-PROMO-NM         PIC  X(40)  VALUE SPACES.   01770000
015800     05  PV-HIST-NMP-ADEVNT-NBR       PIC  X(15)  VALUE SPACES.   01780000
015900     05  PV-HIST-NMP-ADEVNT-NM        PIC  X(40)  VALUE SPACES.   01790000
016000     05  PV-FUT-NMP-ITM-ID            PIC S9(10)V COMP-3          01800000
016100                                                  VALUE ZEROS.    01810000
016200     05  PV-FUT-NMP-PROMO-ID          PIC S9(10)V COMP-3          01820000
016300                                                  VALUE ZEROS.    01830000
016400     05  PV-FUT-NMP-LO-AMT            PIC S9(07)V9(3) COMP-3      01840000
016500                                                  VALUE ZEROS.    01850000
016501     05  PV-LPS-STRT-DTE              PIC  X(26) VALUE SPACES.    01860000
016502     05  PV-HIST-MP-STRT-DTE          PIC  X(26) VALUE SPACES.    01870000
016503     05  PV-FUT-MP-STRT-DTE           PIC  X(26) VALUE SPACES.    01880000
016504     05  PV-HIST-NMP-STRT-DTE         PIC  X(26) VALUE SPACES.    01890000
016505     05  PV-FUT-NMP-STRT-DTE          PIC  X(26) VALUE SPACES.    01900000
016506     05  PV-LPS-TMST.                                             01910000
016507         10  PV-LPS-DTE               PIC  X(10) VALUE SPACES.    01920000
016508         10  FILLER                   PIC  X(16) VALUE SPACES.    01930000
016509     05  PV-HMP-TMST.                                             01940000
016510         10  PV-HMP-DTE               PIC  X(10) VALUE SPACES.    01950000
016511         10  FILLER                   PIC  X(16) VALUE SPACES.    01960000
016512     05  PV-FMP-TMST.                                             01970000
016513         10  PV-FMP-DTE               PIC  X(10) VALUE SPACES.    01980000
016514         10  FILLER                   PIC  X(16) VALUE SPACES.    01990000
016515     05  PV-HNMP-TMST.                                            02000000
016516         10  PV-HNMP-DTE              PIC  X(10) VALUE SPACES.    02010000
016517         10  FILLER                   PIC  X(16) VALUE SPACES.    02020000
016518     05  PV-FNMP-TMST.                                            02030000
016519         10  PV-FNMP-DTE              PIC  X(10) VALUE SPACES.    02040000
016520         10  FILLER                   PIC  X(16) VALUE SPACES.    02050000
016521     05  PV-FIRST-RCVD-DTE-NUM        PIC  9(06) VALUE 0.         02060000
016522     05  PV-FIRST-RCVD-RDF REDEFINES PV-FIRST-RCVD-DTE-NUM.       02070000
016530         10  PV-FIRST-RCVD-RDF-YY     PIC  9(02).                 02080000
016540         10  PV-FIRST-RCVD-RDF-MM     PIC  9(02).                 02090000
016550         10  PV-FIRST-RCVD-RDF-DD     PIC  9(02).                 02100000
016560     05  PV-FIRST-RCVD-DTE.                                       02110000
016570         10  PV-FIRST-RCVD-DTE-CC     PIC  X(02) VALUE SPACES.    02120000
016580         10  PV-FIRST-RCVD-DTE-YY     PIC  X(02) VALUE SPACES.    02130000
016590         10  PV-FIRST-RCVD-DTE-D1     PIC  X(01) VALUE '-'.       02140000
016591         10  PV-FIRST-RCVD-DTE-MM     PIC  X(02) VALUE SPACES.    02150000
016592         10  PV-FIRST-RCVD-DTE-D2     PIC  X(01) VALUE '-'.       02160000
016593         10  PV-FIRST-RCVD-DTE-DD     PIC  X(02) VALUE SPACES.    02170000
016594     05  PV-FIRST-RC-DTE              PIC  X(10) VALUE SPACES.    02180000
016600     05  PV-FUT-NMP-PROMO-NM          PIC  X(40)  VALUE SPACES.   02190000
016700     05  PV-FUT-NMP-ADEVNT-NBR        PIC  X(15)  VALUE SPACES.   02200000
016800     05  PV-FUT-NMP-ADEVNT-NM         PIC  X(40)  VALUE SPACES.   02210000
016900     05  PV-VS-NBR                    PIC  X(20)  VALUE SPACES.   02220000
017000     05  PV-SUB-CL-NBR                PIC S9(04)V COMP-3          02230000
017100                                                  VALUE ZEROS.    02240000
017200     05  PV-VS-DESC                   PIC  X(25)  VALUE SPACES.   02250000
017300     05  PV-INTR-UPC-ID               PIC  S9(9)  COMP            02260000
017400                                                  VALUE ZEROS.    02270000
017500     05  PV-LPS-ADV-CDE               PIC  X(01)  VALUE SPACES.   02280000
017600     05  PV-RUN-DATE                  PIC  X(10).                 02290000
017700     05  PV-RUN-DATE-RDF REDEFINES PV-RUN-DATE.                   02300000
017800         10  PV-RUN-DATE-CC           PIC  X(02).                 02310000
017900         10  PV-RUN-DATE-YY           PIC  X(02).                 02320000
018000         10  PV-RUN-DATE-D1           PIC  X(01).                 02330000
018100         10  PV-RUN-DATE-MM           PIC  X(02).                 02340000
018200         10  PV-RUN-DATE-D2           PIC  X(01).                 02350000
018300         10  PV-RUN-DATE-DD           PIC  X(02).                 02360000
018400     05  PV-LPS-PROMO-ITM-ID-NULL     PIC S9(04)  COMP            02370000
018500                                                  VALUE ZEROS.    02380000
018600     05  PV-LPS-PRICG-AMT-NULL        PIC S9(04)  COMP            02390000
018700                                                  VALUE ZEROS.    02400000
018800     05  PV-LPS-PROMO-NM-NULL         PIC S9(04)  COMP            02410000
018900                                                  VALUE ZEROS.    02420000
019000     05  PV-HIST-MP-ITM-ID-NULL       PIC S9(04)  COMP            02430000
019100                                                  VALUE ZEROS.    02440000
019200     05  PV-HIST-MP-PROMO-ID-NULL     PIC S9(04)  COMP            02450000
019300                                                  VALUE ZEROS.    02460000
019400     05  PV-HIST-MP-LO-AMT-NULL       PIC S9(04)  COMP            02470000
019500                                                  VALUE ZEROS.    02480000
019600     05  PV-HIST-MP-PROMO-NM-NULL     PIC S9(04)  COMP            02490000
019700                                                  VALUE ZEROS.    02500000
019800     05  PV-HIST-MP-ADEVNT-NBR-NULL   PIC S9(04)  COMP            02510000
019900                                                  VALUE ZEROS.    02520000
020000     05  PV-HIST-MP-ADEVNT-NM-NULL    PIC S9(04)  COMP            02530000
020100                                                  VALUE ZEROS.    02540000
020200     05  PV-FUT-MP-ITM-ID-NULL        PIC S9(04)  COMP            02550000
020300                                                  VALUE ZEROS.    02560000
020400     05  PV-FUT-MP-PROMO-ID-NULL      PIC S9(04)  COMP            02570000
020500                                                  VALUE ZEROS.    02580000
020600     05  PV-FUT-MP-LO-AMT-NULL        PIC S9(04)  COMP            02590000
020700                                                  VALUE ZEROS.    02600000
020800     05  PV-FUT-MP-PROMO-NM-NULL      PIC S9(04)  COMP            02610000
020900                                                  VALUE ZEROS.    02620000
021000     05  PV-FUT-MP-ADEVNT-NBR-NULL    PIC S9(04)  COMP            02630000
021100                                                  VALUE ZEROS.    02640000
021200     05  PV-FUT-MP-ADEVNT-NM-NULL     PIC S9(04)  COMP            02650000
021300                                                  VALUE ZEROS.    02660000
021400     05  PV-HIST-NMP-ITM-ID-NULL      PIC S9(04)  COMP            02670000
021500                                                  VALUE ZEROS.    02680000
021600     05  PV-HIST-NMP-PROMO-ID-NULL    PIC S9(04)  COMP            02690000
021700                                                  VALUE ZEROS.    02700000
021800     05  PV-HIST-NMP-LO-AMT-NULL      PIC S9(04)  COMP            02710000
021900                                                  VALUE ZEROS.    02720000
022000     05  PV-HIST-NMP-PROMO-NM-NULL    PIC S9(04)  COMP            02730000
022100                                                  VALUE ZEROS.    02740000
022200     05  PV-HIST-NMP-ADEVNT-NBR-NULL  PIC S9(04)  COMP            02750000
022300                                                  VALUE ZEROS.    02760000
022400     05  PV-HIST-NMP-ADEVNT-NM-NULL   PIC S9(04)  COMP            02770000
022500                                                  VALUE ZEROS.    02780000
022600     05  PV-FUT-NMP-ITM-ID-NULL       PIC S9(04)  COMP            02790000
022700                                                  VALUE ZEROS.    02800000
022800     05  PV-FUT-NMP-PROMO-ID-NULL     PIC S9(04)  COMP            02810000
022900                                                  VALUE ZEROS.    02820000
023000     05  PV-FUT-NMP-LO-AMT-NULL       PIC S9(04)  COMP            02830000
023100                                                  VALUE ZEROS.    02840000
023200     05  PV-FUT-NMP-PROMO-NM-NULL     PIC S9(04)  COMP            02850000
023300                                                  VALUE ZEROS.    02860000
023400     05  PV-FUT-NMP-ADEVNT-NBR-NULL   PIC S9(04)  COMP            02870000
023500                                                  VALUE ZEROS.    02880000
023600     05  PV-FUT-NMP-ADEVNT-NM-NULL    PIC S9(04)  COMP            02890000
023700                                                  VALUE ZEROS.    02900000
023710     05  PV-FUT-NMP-STRT-DTE-NULL     PIC S9(04)  COMP            02910000
023720                                                  VALUE ZEROS.    02920000
023730     05  PV-HIST-NMP-STRT-DTE-NULL    PIC S9(04)  COMP            02930000
023740                                                  VALUE ZEROS.    02940000
023750     05  PV-FUT-MP-STRT-DTE-NULL      PIC S9(04)  COMP            02950000
023760                                                  VALUE ZEROS.    02960000
023770     05  PV-HIST-MP-STRT-DTE-NULL     PIC S9(04)  COMP            02970000
023780                                                  VALUE ZEROS.    02980000
023790     05  PV-LPS-STRT-DTE-NULL         PIC S9(04)  COMP            02990000
023791                                                  VALUE ZEROS.    03000000
KBLFIX     05  PV-RUN-TIME                  PIC  X(26) VALUE SPACES.    03010000
KBLFIX     05  WS-TMST                      PIC  X(26) VALUE SPACES.    03020000
023800                                                                  03030000
023900******************************************************************03040000
024000* PS PROGRAM SWITCHES                                             03050000
024100******************************************************************03060000
024200 01  PS-PROGRAM-SWITCHES.                                         03070000
024300     05  PS-END-OF-CNTL-CARD-SW        PIC X(01)     VALUE 'N'.   03080000
024400         88  PS-END-OF-CNTL-CARD                     VALUE 'Y'.   03090000
024500         88  PS-NOT-END-OF-CNTL-CARD                 VALUE 'N'.   03100000
024510     05  PS-END-OF-CNTL-CARD-RPT-SW    PIC X(01)     VALUE 'N'.   03110000
024520         88  PS-END-OF-CNTL-CARD-RPT                 VALUE 'Y'.   03120000
024530         88  PS-NOT-END-OF-CNTL-CARD-RPT             VALUE 'N'.   03130000
024600     05  PS-END-OF-DEPT-CSR-SW         PIC  X(01)    VALUE 'N'.   03140000
024700         88  PS-END-OF-DEPT-CSR                      VALUE 'Y'.   03150000
024800         88  PS-NOT-END-OF-DEPT-CSR                  VALUE 'N'.   03160000
024900     05  PS-END-OF-PRICE-CSR-SW        PIC  X(01)    VALUE 'N'.   03170000
025000         88  PS-END-OF-PRICE-CSR                     VALUE 'Y'.   03180000
025100         88  PS-NOT-END-OF-PRICE-CSR                 VALUE 'N'.   03190000
025200                                                                  03200000
025300******************************************************************03210000
025400* PA PROGRAM ACCUMULATORS                                         03220000
025500******************************************************************03230000
025600 01  PA-PROGRAM-ACCUMULATORS.                                     03240000
025700     05  PA-RECS-WRITTEN                 PIC S9(11) COMP-3        03250000
025800                                                     VALUE ZEROES.03260000
025900     05  PA-DPT-CNT                      PIC S9(11) COMP-3        03270000
026000                                                     VALUE ZEROES.03280000
026100     05  PA-PRICE-CNT                    PIC S9(11) COMP-3        03290000
026200                                                     VALUE ZEROES.03300000
026300     05  PA-TOTAL-PRICE-CNT              PIC S9(11) COMP-3        03310000
026400                                                     VALUE ZEROES.03320000
026500     05  PA-CNT-DEPT                     PIC S9(11) COMP-3        03330000
026600                                                     VALUE ZEROES.03340000
026700                                                                  03350000
026800******************************************************************03360000
026900* CC CONTROL CARD RECORDS                                         03370000
027000******************************************************************03380000
027100 01  CC-LPS-ADV-CDE-RECORD.                                       03390000
027200     05  CC-LPS-ADV-CDE               PIC  X(01)     VALUE SPACES.03400000
027300     05  FILLER                       PIC  X(79)     VALUE SPACES.03410000
027400                                                                  03420000
027410 01  CC-CONTROL-CARD-REC.                                         03430000
027420     05  CC-RUN-DTE                   PIC X(08) VALUE SPACES.     03440000
027430     05  FILLER                       PIC X(01) VALUE SPACES.     03450000
027440     05  CC-RPT-IND                   PIC X(01) VALUE SPACES.     03460000
027450     05  FILLER                       PIC X(01) VALUE SPACES.     03470000
027460     05  CC-LPS-END-DTE               PIC X(08) VALUE SPACES.     03480000
027470     05  FILLER                       PIC X(61) VALUE SPACES.     03490000
027480                                                                  03500000
027500******************************************************************03510000
027600* ABEND CODES                                                     03520000
027700******************************************************************03530000
027800 01  ABEND-CODE                      PIC S9(04)  COMP VALUE +0.   03540000
027900     88  ABEND-4001-WRITE-ERROR                  VALUE +4001.     03550000
028000     88  ABEND-4002-READ-ERROR                   VALUE +4002.     03560000
028100     88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     03570000
028200     88  ABEND-4004-TABLE-ERROR                  VALUE +4004.     03580000
028300     88  ABEND-4005-OPEN-ERROR                   VALUE +4005.     03590000
028400     88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.     03600000
028500     88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.     03610000
028600     88  ABEND-4008-DATA-ERROR                   VALUE +4008.     03620000
028700     88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.     03630000
028800     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     03640000
028900     88  ABEND-4019-DATE-ROUTINE-ERROR           VALUE +4019.     03650000
029000     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     03660000
029100                                                                  03670000
029200******************************************************************03680000
029300*    LPS PRE EXCEPT OUTPUT RECORD                                 03690000
029400******************************************************************03700000
029500     COPY PMRD044.                                                03710000
029600                                                                  03720000
029700******************************************************************03730000
029800*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        03740000
029900******************************************************************03750000
030000     COPY DPWS004.                                                03760000
030100                                                                  03770000
030200***************************************************************** 03780000
030300*    TABLE INCLUDE AREAD.                                       * 03790000
030400***************************************************************** 03800000
030500     EXEC SQL INCLUDE XST00010 END-EXEC.                          03810000
030600     EXEC SQL INCLUDE XST00013 END-EXEC.                          03820000
030700     EXEC SQL INCLUDE XST00026 END-EXEC.                          03830000
030800     EXEC SQL INCLUDE XST00027 END-EXEC.                          03840000
030900     EXEC SQL INCLUDE XST00051 END-EXEC.                          03850000
031000     EXEC SQL INCLUDE TMDARVS END-EXEC.                           03860000
031100     EXEC SQL INCLUDE TRSPBAR END-EXEC.                           03870000
031200     EXEC SQL INCLUDE TMDSEAR END-EXEC.                           03880000
031210     EXEC SQL INCLUDE TSKXREF END-EXEC.                           03890000
031220     EXEC SQL INCLUDE TSKST END-EXEC.                             03900000
031300                                                                  03910000
031400******************************************************************03920000
031500*    SQL COMMUNICATIONS AREA DCLGEN                               03930000
031600******************************************************************03940000
031700     EXEC SQL                                                     03950000
031800         INCLUDE SQLCA                                            03960000
031900     END-EXEC.                                                    03970000
032000                                                                  03980000
032100******************************************************************03990000
032200*    EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING         04000000
032300*    SQL CODES FOR DISPLAY                                        04010000
032400******************************************************************04020000
032500     COPY SQLCA2.                                                 04030000
032600                                                                  04040000
032700***************************************************************** 04050000
032800*    ALL-DPT-CSR                                                  04060000
032900***************************************************************** 04070000
033000     EXEC SQL                                                     04080000
033100          DECLARE ALL-DPT-CSR CURSOR WITH HOLD                    04090000
033200          FOR SELECT G.GMA_NBR                                    04100000
033300                    ,GR.WORKER_FIR_NAME                           04110000
033400                    ,GR.WORKER_LAST_NAME                          04120000
033500                    ,D.DMA_NBR                                    04130000
033600                    ,DR.WORKER_FIR_NAME                           04140000
033700                    ,DR.WORKER_LAST_NAME                          04150000
033800                    ,B.BYR_NBR                                    04160000
033900                    ,BR.WORKER_FIR_NAME                           04170000
034000                    ,BR.WORKER_LAST_NAME                          04180000
034100                    ,B.DEPT_NBR                                   04190000
034200                    ,B.MDSEAR_DESC                                04200000
034300            FROM TMDSEAR    B                                     04210000
034400                ,TMDSEAR    D                                     04220000
034500                ,TMDSEAR    G                                     04230000
034600                ,TRSPBAR    BR                                    04240000
034700                ,TRSPBAR    DR                                    04250000
034800                ,TRSPBAR    GR                                    04260000
034900          WHERE B.OPERCO_NBR   = '03'                             04270000
035000            AND B.MDSEAR_DKEY  = BR.MDSEAR_DKEY                   04280000
035100            AND B.MDSELV_CDE   = 'DPT'                            04290000
035200            AND BR.RSPLVL_CDE  = 'BYR'                            04300000
035300            AND (DATE(:PV-RUN-DATE)                               04310000
035400                BETWEEN B.STRT_DTE                                04320000
035500                AND B.END_DTE)                                    04330000
035600            AND (DATE(:PV-RUN-DATE)                               04340000
035700                BETWEEN BR.WORKER_STRT_DTE                        04350000
035800                AND BR.WORKER_END_DTE)                            04360000
035900            AND D.OPERCO_NBR = '03'                               04370000
036000            AND D.MDSEAR_DKEY  = DR.MDSEAR_DKEY                   04380000
036100            AND D.DMA_NBR      = B.DMA_NBR                        04390000
036200            AND D.MDSELV_CDE   = 'DMA'                            04400000
036300            AND DR.RSPLVL_CDE  = 'DMM'                            04410000
036400            AND (DATE(:PV-RUN-DATE)                               04420000
036500                BETWEEN D.STRT_DTE                                04430000
036600                AND D.END_DTE)                                    04440000
036700            AND (DATE(:PV-RUN-DATE)                               04450000
036800                BETWEEN DR.WORKER_STRT_DTE                        04460000
036900                AND DR.WORKER_END_DTE)                            04470000
037000            AND G.OPERCO_NBR   = '03'                             04480000
037100            AND G.MDSEAR_DKEY  = GR.MDSEAR_DKEY                   04490000
037200            AND G.GMA_NBR      = B.GMA_NBR                        04500000
037300            AND G.MDSELV_CDE   = 'GMA'                            04510000
037400            AND GR.RSPLVL_CDE  = 'GMM'                            04520000
037500            AND (DATE(:PV-RUN-DATE)                               04530000
037600                BETWEEN G.STRT_DTE                                04540000
037700                AND G.END_DTE)                                    04550000
037800            AND (DATE(:PV-RUN-DATE)                               04560000
037900                BETWEEN GR.WORKER_STRT_DTE                        04570000
038000                AND GR.WORKER_END_DTE)                            04580000
038100          ORDER BY  G.GMA_NBR                                     04590000
038200                   ,D.DMA_NBR                                     04600000
038300                   ,B.BYR_NBR                                     04610000
038400                   ,B.DEPT_NBR                                    04620000
038500          WITH UR                                                 04630000
038600     END-EXEC.                                                    04640000
038700                                                                  04650000
038800***************************************************************** 04660000
038900*    PRICE-CSR                                                    04670000
039000***************************************************************** 04680000
039100     EXEC SQL                                                     04690000
039200          DECLARE PRICE-CSR CURSOR                                04700000
039300          WITH HOLD FOR                                           04710000
039400          SELECT A.INTR_UPC_ID                                    04720000
039410                ,A.LPS_PREV_RPTD_IND                              04730000
039500                ,A.LPS_PROMO_ITM_ID                               04740000
039600                ,A.LPS_PRICG_AMT                                  04750000
039700                ,M.PROMO_NM                                       04760000
039710                ,M.DFLT_STRT_TMST                                 04770000
039800                ,A.HIST_MP_ITM_ID                                 04780000
039900                ,A.HIST_MP_PROMO_ID                               04790000
040000                ,A.HIST_MP_LO_AMT                                 04800000
040100                ,D.PROMO_NM                                       04810000
040110                ,D.DFLT_STRT_TMST                                 04820000
040200                ,E.AD_EVNT_NBR_TXT                                04830000
040300                ,E.AD_EVNT_NM                                     04840000
040400                ,A.FUT_MP_ITM_ID                                  04850000
040500                ,A.FUT_MP_PROMO_ID                                04860000
040600                ,A.FUT_MP_LO_AMT                                  04870000
040700                ,H.PROMO_NM                                       04880000
040710                ,H.DFLT_STRT_TMST                                 04890000
040800                ,I.AD_EVNT_NBR_TXT                                04900000
040900                ,I.AD_EVNT_NM                                     04910000
041000                ,A.HIST_NMP_ITM_ID                                04920000
041100                ,A.HIST_NMP_PROMO_ID                              04930000
041200                ,A.HIST_NMP_LO_AMT                                04940000
041300                ,F.PROMO_NM                                       04950000
041310                ,F.DFLT_STRT_TMST                                 04960000
041400                ,G.AD_EVNT_NBR_TXT                                04970000
041500                ,G.AD_EVNT_NM                                     04980000
041600                ,A.FUT_NMP_ITM_ID                                 04990000
041700                ,A.FUT_NMP_PROMO_ID                               05000000
041800                ,A.FUT_NMP_LO_AMT                                 05010000
041900                ,J.PROMO_NM                                       05020000
041910                ,J.DFLT_STRT_TMST                                 05030000
042000                ,K.AD_EVNT_NBR_TXT                                05040000
042100                ,K.AD_EVNT_NM                                     05050000
042200                ,C.VS_NBR                                         05060000
042300                ,C.SUB_CL_NBR                                     05070000
042400                ,L.VS_DESC                                        05080000
042500          FROM   XST_LPS_MIN_PRIC_W A                             05090000
042600                 LEFT OUTER JOIN XST_PROMO D                      05100000
042700                     ON (A.HIST_MP_PROMO_ID = D.PROMO_ID          05110000
042800                     AND D.STAT_CDE = 'S')                        05120000
042900                 LEFT OUTER JOIN XST_AD_EVNT E                    05130000
043000                     ON (D.AD_EVNT_ID = E.AD_EVNT_ID              05140000
043100                     AND E.STAT_CDE = 'S')                        05150000
043200                 LEFT OUTER JOIN XST_PROMO F                      05160000
043300                     ON (A.HIST_NMP_PROMO_ID = F.PROMO_ID         05170000
043400                     AND F.STAT_CDE = 'S')                        05180000
043500                 LEFT OUTER JOIN XST_AD_EVNT G                    05190000
043600                     ON (F.AD_EVNT_ID = G.AD_EVNT_ID              05200000
043700                     AND G.STAT_CDE = 'S')                        05210000
043800                 LEFT OUTER JOIN XST_PROMO H                      05220000
043900                     ON (A.FUT_MP_PROMO_ID = H.PROMO_ID           05230000
044000                     AND H.STAT_CDE = 'S')                        05240000
044100                 LEFT OUTER JOIN XST_AD_EVNT I                    05250000
044200                     ON (H.AD_EVNT_ID = I.AD_EVNT_ID              05260000
044300                     AND I.STAT_CDE = 'S')                        05270000
044400                 LEFT OUTER JOIN XST_PROMO J                      05280000
044500                     ON (A.FUT_NMP_PROMO_ID = J.PROMO_ID          05290000
044600                     AND J.STAT_CDE = 'S')                        05300000
044700                 LEFT OUTER JOIN XST_AD_EVNT K                    05310000
044800                     ON (J.AD_EVNT_ID = K.AD_EVNT_ID              05320000
044900                     AND K.STAT_CDE = 'S')                        05330000
044910                 LEFT OUTER JOIN XST_PROMO M                      05340000
044920                     ON (A.LPS_PROMO_ID = M.PROMO_ID              05350000
044930                     AND M.STAT_CDE = 'S')                        05360000
045000                ,XST_SKU B                                        05370000
045100                ,XST_VND_STYL C                                   05380000
045200                ,TMDARVS L                                        05390000
045300          WHERE  A.INTR_UPC_ID = B.INTR_UPC_ID                    05400000
045400             AND B.STYL_ID = C.STYL_ID                            05410000
045500             AND C.STYL_ID = L.RMS_STYL_ID                        05420000
045600             AND C.VS_ID = L.VS_ID                                05430000
045700             AND L.SUB_CL_MDSEAR_ID > 0                           05440000
045800             AND L.ACTV_IND = 'Y'                                 05450000
045900             AND C.DEPT_NBR = INTEGER(:PV-DPT-NBR-CHAR)           05460000
046000             AND A.LPS_ADV_CDE IN ('Y', :PV-LPS-ADV-CDE)          05470000
046100          WITH UR                                                 05480000
046200     END-EXEC.                                                    05490000
046300                                                                  05500000
046400 PROCEDURE DIVISION.                                              05510000
046500                                                                  05520000
046600******************************************************************05530000
046700* MAIN PROCESSING                                                 05540000
046800******************************************************************05550000
046900 A100-PROGRAM-MAINLINE.                                           05560000
047000                                                                  05570000
047100     INITIALIZE PA-CNT-DEPT.                                      05580000
047200     PERFORM B100-OPEN-FILES.                                     05590000
047201     PERFORM B200-READ-RPT-IND-FILE.                              05600000
047210     IF CC-RPT-IND = 'Y'                                          05610000
047300        PERFORM B150-READ-ADV-CDE-CONTROL-CARD                    05620000
047400        PERFORM C100-FIND-DATE                                    05630000
KBLFIX        PERFORM C150-FIND-TIME                                    05640000
047500                                                                  05650000
047600        PERFORM C200-OPEN-ALL-DPT-CSR                             05660000
047700        PERFORM C300-FETCH-ALL-DPT-CSR                            05670000
047800        PERFORM C400-PROCESS-ALL-DPT-CSR                          05680000
047900            UNTIL PS-END-OF-DEPT-CSR                              05690000
048000        PERFORM C500-CLOSE-ALL-DPT-CSR                            05700000
048010     END-IF.                                                      05710000
048100                                                                  05720000
048200     PERFORM B900-CLOSE-FILES.                                    05730000
048300                                                                  05740000
048400     DISPLAY 'COUNT FROM DPT-CSR   = ' PA-DPT-CNT.                05750000
048500     DISPLAY 'COUNT FROM PRICE-CSR = ' PA-TOTAL-PRICE-CNT.        05760000
048600     DISPLAY 'RECORDS WRITTEN      = ' PA-RECS-WRITTEN.           05770000
048700                                                                  05780000
048800     STOP RUN.                                                    05790000
048900                                                                  05800000
049000***************************************************************** 05810000
049100* B100-OPEN-FILES.                                              * 05820000
049200* ==> PROCESSES:                                                * 05830000
049300*  - OPEN THE OUTPUT FILE                                       * 05840000
049400* ==> PERFORMED FROM: A100-MAINLINE                             * 05850000
049500***************************************************************** 05860000
049600 B100-OPEN-FILES.                                                 05870000
049700                                                                  05880000
049800     OPEN INPUT  LPS-ADV-CDE-CONTROL-CARD                         05890000
049810                 CC-RPT-IND-FILE                                  05900000
049900     OPEN OUTPUT LPS-PRE-EXCEP-FILE.                              05910000
050000                                                                  05920000
050100******************************************************************05930000
050200* B150-READ-ADV-CDE-CONTROL-CARD.                                *05940000
050300* ==> PROCESSES:                                                 *05950000
050400*  - READ IN THE LPS ADV CDE CONTROL CARD                        *05960000
050500* ==> PERFORMED FROM: A100-MAINLINE                              *05970000
050600******************************************************************05980000
050700 B150-READ-ADV-CDE-CONTROL-CARD.                                  05990000
050800                                                                  06000000
050900     READ LPS-ADV-CDE-CONTROL-CARD INTO CC-LPS-ADV-CDE-RECORD     06010000
051000         AT END                                                   06020000
051100             SET PS-END-OF-CNTL-CARD TO TRUE.                     06030000
051200                                                                  06040000
051300     IF PS-END-OF-CNTL-CARD                                       06050000
051400         DISPLAY ' '                                              06060000
051500         DISPLAY '** EMPTY CONTROL CARD. '                        06070000
051600         DISPLAY ' '                                              06080000
051700     ELSE                                                         06090000
051800         MOVE CC-LPS-ADV-CDE       TO PV-LPS-ADV-CDE              06100000
051900                                                                  06110000
052000         DISPLAY ' '                                              06120000
052200         DISPLAY '  LPS ADV CDE: ' CC-LPS-ADV-CDE                 06130000
052300         DISPLAY ' '                                              06140000
052400     END-IF.                                                      06150000
052500                                                                  06160000
052510******************************************************************06170000
052520* B200-READ-RPT-IND-FILE.                                        *06180000
052530* ==> PROCESSES:                                                 *06190000
052540*  - READ IN THE RPT INDICATOR CONTROL CARD.                     *06200000
052550* ==> PERFORMED FROM: A100-MAINLINE                              *06210000
052560******************************************************************06220000
052570 B200-READ-RPT-IND-FILE.                                          06230000
052580                                                                  06240000
052590     READ CC-RPT-IND-FILE INTO CC-CONTROL-CARD-REC                06250000
052591         AT END                                                   06260000
052592             SET PS-END-OF-CNTL-CARD TO TRUE.                     06270000
052593                                                                  06280000
052594     IF PS-END-OF-CNTL-CARD-RPT                                   06290000
052595         DISPLAY ' '                                              06300000
052596         DISPLAY '** EMPTY CONTROL CARD. '                        06310000
052597         DISPLAY ' '                                              06320000
052598     ELSE                                                         06330000
052601         DISPLAY ' '                                              06340000
052602         DISPLAY 'CONTROLS FOR PROGRAM ' PC-PROGRAM-NAME ': '     06350000
052603         DISPLAY '  RPT IND: ' CC-RPT-IND                         06360000
052604         DISPLAY ' '                                              06370000
052605     END-IF.                                                      06380000
052606                                                                  06390000
052610***************************************************************** 06400000
052700* B900-CLOSE-FILES                                              * 06410000
052800* ==> PROCESSES:                                                * 06420000
052900*  - CLOSE THE OUTPUT FILE                                      * 06430000
053000* ==> PERFORMED FROM: A100-MAINLINE                             * 06440000
053100***************************************************************** 06450000
053200 B900-CLOSE-FILES.                                                06460000
053300                                                                  06470000
053400     CLOSE  LPS-ADV-CDE-CONTROL-CARD                              06480000
053410            CC-RPT-IND-FILE                                       06490000
053500            LPS-PRE-EXCEP-FILE.                                   06500000
053600                                                                  06510000
053700***************************************************************** 06520000
053800* C100-FIND-DATES                                               * 06530000
053900* ==> PROCESSES:                                                * 06540000
054000*  - FIND THE CURRENT DATE                                      * 06550000
054100* ==> SQLCODE:                                                  * 06560000
054200*  - 0 = A ROW WAS FOUND.                                       * 06570000
054300* ==> PERFORMED FROM: A100-MAINLINE                             * 06580000
054400***************************************************************** 06590000
054500 C100-FIND-DATE.                                                  06600000
054600                                                                  06610000
054700     EXEC SQL                                                     06620000
054800         SELECT CURRENT DATE                                      06630000
054900         INTO   :PV-RUN-DATE                                      06640000
055000         FROM   SYSIBM.SYSDUMMY1                                  06650000
055100         WITH UR                                                  06660000
055200     END-EXEC.                                                    06670000
055300                                                                  06680000
055400     EVALUATE TRUE                                                06690000
055500         WHEN SQLCODE = ZERO                                      06700000
055600             DISPLAY 'PV-RUN-DATE = ' PV-RUN-DATE                 06710000
055700                                                                  06720000
055800          WHEN OTHER                                              06730000
055900             MOVE 'SYSIBM.SYSDUMMY1'    TO PV-DB2-TABLE-NAME-1    06740000
056000             MOVE 'C100-FIND-DATE '     TO PV-PARAGRAPH-NAME      06750000
056100             PERFORM Z100-SQL-ABEND                               06760000
056200     END-EVALUATE.                                                06770000
056300                                                                  06780000
KBLFIX C150-FIND-TIME.                                                  06790000
KBLFIX                                                                  06800000
KBLFIX     EXEC SQL                                                     06810000
KBLFIX         SELECT (CURRENT_TIMESTAMP + 30 SECONDS)                  06820000
KBLFIX         INTO   :PV-RUN-TIME                                      06830000
KBLFIX         FROM   SYSIBM.SYSDUMMY1                                  06840000
KBLFIX         WITH UR                                                  06850000
KBLFIX     END-EXEC.                                                    06860000
KBLFIX                                                                  06870000
KBLFIX     EVALUATE TRUE                                                06880000
KBLFIX         WHEN SQLCODE = ZERO                                      06890000
KBLFIX             CONTINUE                                             06900000
KBLFIX                                                                  06910000
KBLFIX          WHEN OTHER                                              06920000
KBLFIX             MOVE 'SYSIBM.SYSDUMMY1'    TO PV-DB2-TABLE-NAME-1    06930000
KBLFIX             MOVE 'C150-FIND-TIME '     TO PV-PARAGRAPH-NAME      06940000
KBLFIX             PERFORM Z100-SQL-ABEND                               06950000
KBLFIX     END-EVALUATE.                                                06960000
KBLFIX                                                                  06970000
KBLFIX C155-CHECK-TIME.                                                 06980000
KBLFIX                                                                  06990000
KBLFIX     EXEC SQL                                                     07000000
KBLFIX         SET :WS-TMST = CURRENT_TIMESTAMP                         07010000
KBLFIX     END-EXEC.                                                    07020000
KBLFIX                                                                  07030000
KBLFIX     EVALUATE TRUE                                                07040000
KBLFIX         WHEN SQLCODE = ZERO                                      07050000
KBLFIX             CONTINUE                                             07060000
KBLFIX                                                                  07070000
KBLFIX          WHEN OTHER                                              07080000
KBLFIX             MOVE 'SYSIBM.SYSDUMMY1'    TO PV-DB2-TABLE-NAME-1    07090000
KBLFIX             MOVE 'C155-CHECK-TIME '     TO PV-PARAGRAPH-NAME     07100000
KBLFIX             PERFORM Z100-SQL-ABEND                               07110000
KBLFIX     END-EVALUATE.                                                07120000
KBLFIX                                                                  07130000
KBLFIX C160-COMMIT.                                                     07140000
KBLFIX                                                                  07150000
KBLFIX     EXEC SQL                                                     07160000
KBLFIX         COMMIT                                                   07170000
KBLFIX     END-EXEC.                                                    07180000
KBLFIX                                                                  07190000
KBLFIX     EVALUATE TRUE                                                07200000
KBLFIX         WHEN SQLCODE = ZERO                                      07210000
KBLFIX             CONTINUE                                             07220000
KBLFIX                                                                  07230000
KBLFIX          WHEN OTHER                                              07240000
080500             MOVE 'C160-COMMIT' TO PV-PARAGRAPH-NAME              07250000
080800             PERFORM Z100-SQL-ABEND                               07260000
KBLFIX     END-EVALUATE.                                                07270000
056400***************************************************************** 07280000
056500* C200-OPEN-ALL-DPT-CSR                                         * 07290000
056600* ==> PROCESSES:                                                * 07300000
056700*  - OPEN ALL-DPT-CSR                                           * 07310000
056800* ==> SQLCODE:                                                  * 07320000
056900*  - 0 = SUCCESSFULL OPEN                                       * 07330000
057000* ==> PERFORMED FROM: A100-MAINLINE                             * 07340000
057100***************************************************************** 07350000
057200 C200-OPEN-ALL-DPT-CSR.                                           07360000
057300                                                                  07370000
057400     EXEC SQL                                                     07380000
057500           OPEN ALL-DPT-CSR                                       07390000
057600     END-EXEC.                                                    07400000
057700                                                                  07410000
057800     EVALUATE TRUE                                                07420000
057900         WHEN SQLCODE = ZERO                                      07430000
058000             CONTINUE                                             07440000
058100                                                                  07450000
058200         WHEN OTHER                                               07460000
058300             MOVE 'C200-OPEN-ALL-DPT-CSR '                        07470000
058400                                    TO PV-PARAGRAPH-NAME          07480000
058500             MOVE 'OPEN ERROR ON ALL-DPT-CSR'                     07490000
058600                                    TO PV-OPERATION-MSG-1         07500000
058700             MOVE 'TMDSEAR'         TO PV-DB2-TABLE-NAME-1        07510000
058800             MOVE 'TRSPBAR'         TO PV-DB2-TABLE-NAME-2        07520000
058900             PERFORM Z100-SQL-ABEND                               07530000
059000     END-EVALUATE.                                                07540000
059100                                                                  07550000
059200***************************************************************** 07560000
059300* C210-OPEN-PRICE-CSR                                           * 07570000
059400* ==> PROCESSES:                                                * 07580000
059500*  - OPEN PRICE-CSR                                             * 07590000
059600* ==> SQLCODE:                                                  * 07600000
059700*  - 0 = SUCCESSFULL OPEN                                       * 07610000
059800* ==> PERFORMED FROM: C400-PROCESS-ALL-DPT-CSR.                 * 07620000
059900***************************************************************** 07630000
060000 C210-OPEN-PRICE-CSR.                                             07640000
060100                                                                  07650000
060200     EXEC SQL                                                     07660000
060300           OPEN PRICE-CSR                                         07670000
060400     END-EXEC.                                                    07680000
060500                                                                  07690000
060600     EVALUATE TRUE                                                07700000
060700         WHEN SQLCODE = ZERO                                      07710000
060800             CONTINUE                                             07720000
060900                                                                  07730000
061000         WHEN OTHER                                               07740000
061100             MOVE 'C210-OPEN-PRICE-CSR '                          07750000
061200                                       TO PV-PARAGRAPH-NAME       07760000
061300             MOVE 'OPEN ERROR ON PRICE-CSR'                       07770000
061400                                       TO PV-OPERATION-MSG-1      07780000
061500             MOVE 'XST_LPS_MIN_PRIC_W' TO PV-DB2-TABLE-NAME-1     07790000
061600             MOVE 'XST_SKU'            TO PV-DB2-TABLE-NAME-2     07800000
061700             MOVE 'XST_VND_STYL'       TO PV-DB2-TABLE-NAME-3     07810000
061800             PERFORM Z100-SQL-ABEND                               07820000
061900     END-EVALUATE.                                                07830000
062000                                                                  07840000
062100***************************************************************** 07850000
062200* C300-FETCH-ALL-DPT-CSR.                                       * 07860000
062300* ==> PROCESSES:                                                * 07870000
062400*  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  * 07880000
062500*    VARIABLES LISTED.                                          * 07890000
062600* ==> SQLCODE:                                                  * 07900000
062700*  - 0    = A ROW WAS FOUND                                     * 07910000
062800*  - 100  = WHEN NO DATA WAS FOUND                              * 07920000
062900* ==> PERFORMED FROM: A100-MAINLINE, C400-PROCESS-ALL-DPTS-CSR  * 07930000
063000***************************************************************** 07940000
063100 C300-FETCH-ALL-DPT-CSR.                                          07950000
063200                                                                  07960000
063300     EXEC SQL                                                     07970000
063400         FETCH ALL-DPT-CSR                                        07980000
063500          INTO  :PV-GMA-NBR                                       07990000
063600               ,:PV-GMA-FIRST-NM                                  08000000
063700               ,:PV-GMA-LAST-NM                                   08010000
063800               ,:PV-DMA-NBR                                       08020000
063900               ,:PV-DMA-FIRST-NM                                  08030000
064000               ,:PV-DMA-LAST-NM                                   08040000
064100               ,:PV-BYR-NBR                                       08050000
064200               ,:PV-BYR-FIRST-NM                                  08060000
064300               ,:PV-BYR-LAST-NM                                   08070000
064400               ,:PV-DPT-NBR-CHAR                                  08080000
064500               ,:PV-DPT-DESC                                      08090000
064600     END-EXEC.                                                    08100000
064700                                                                  08110000
064800     EVALUATE TRUE                                                08120000
064900         WHEN SQLCODE = ZERO                                      08130000
065000             ADD 1 TO PA-DPT-CNT                                  08140000
065100                                                                  08150000
065200         WHEN SQLCODE = 100                                       08160000
065300             DISPLAY 'COUNT FROM C300-FETCH-ALL-DPT-CSR = '       08170000
065400                                              PA-DPT-CNT          08180000
065500             SET PS-END-OF-DEPT-CSR TO TRUE                       08190000
065600                                                                  08200000
065700         WHEN OTHER                                               08210000
065800             DISPLAY 'PV-GMA-NBR       = ' PV-GMA-NBR             08220000
065900             DISPLAY 'PV-GMA-FIRST-NM  = ' PV-GMA-FIRST-NM        08230000
066000             DISPLAY 'PV-GMA-LAST-NM   = ' PV-GMA-LAST-NM         08240000
066100             DISPLAY 'PV-DMA-NBR       = ' PV-DMA-NBR             08250000
066200             DISPLAY 'PV-DMA-FIRST-NM  = ' PV-DMA-FIRST-NM        08260000
066300             DISPLAY 'PV-DMA-LAST-NM   = ' PV-DMA-LAST-NM         08270000
066400             DISPLAY 'PV-BYR-NBR       = ' PV-BYR-NBR             08280000
066500             DISPLAY 'PV-BYR-FIRST-NM  = ' PV-BYR-FIRST-NM        08290000
066600             DISPLAY 'PV-BYR-LAST-NM   = ' PV-BYR-LAST-NM         08300000
066700             DISPLAY 'PV-DPT-NBR-CHAR  = ' PV-DPT-NBR-CHAR        08310000
066800             DISPLAY 'PV-DPT-DESC      = ' PV-DPT-DESC            08320000
066900             MOVE 'C300-FETCH-ALL-DPT-CSR   '                     08330000
067000                                      TO PV-PARAGRAPH-NAME        08340000
067100             MOVE 'FETCH ERROR ON ALL-DPT-CSR'                    08350000
067200                                      TO PV-OPERATION-MSG-1       08360000
067300             PERFORM Z100-SQL-ABEND                               08370000
067400     END-EVALUATE.                                                08380000
067500                                                                  08390000
067600***************************************************************** 08400000
067700* C310-FETCH-PRICE-CSR.                                         * 08410000
067800* ==> PROCESSES:                                                * 08420000
067900*  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  * 08430000
068000*    VARIABLES LISTED.                                          * 08440000
068100* ==> SQLCODE:                                                  * 08450000
068200*  - 0    = A ROW WAS FOUND                                     * 08460000
068300*  - 100  = WHEN NO DATA WAS FOUND                              * 08470000
068400* ==> PERFORMED FROM: C400-PROCESS-ALL-DPT-CSR                  * 08480000
068500*            C410-PROCESS-PRICE-CSR                             * 08490000
068600***************************************************************** 08500000
068700 C310-FETCH-PRICE-CSR.                                            08510000
068800                                                                  08520000
068900     EXEC SQL                                                     08530000
069000         FETCH PRICE-CSR                                          08540000
069100          INTO  :PV-INTR-UPC-ID                                   08550000
069110               ,:PV-LPS-PREV-RPTD-IND                             08560000
069200               ,:PV-LPS-PROMO-ITM-ID   :PV-LPS-PROMO-ITM-ID-NULL  08570000
069300               ,:PV-LPS-PRICG-AMT      :PV-LPS-PRICG-AMT-NULL     08580000
069400               ,:PV-LPS-PROMO-NM       :PV-LPS-PROMO-NM-NULL      08590000
069410               ,:PV-LPS-STRT-DTE       :PV-LPS-STRT-DTE-NULL      08600000
069500               ,:PV-HIST-MP-ITM-ID     :PV-HIST-MP-ITM-ID-NULL    08610000
069600               ,:PV-HIST-MP-PROMO-ID   :PV-HIST-MP-PROMO-ID-NULL  08620000
069700               ,:PV-HIST-MP-LO-AMT     :PV-HIST-MP-LO-AMT-NULL    08630000
069800               ,:PV-HIST-MP-PROMO-NM   :PV-HIST-MP-PROMO-NM-NULL  08640000
069810               ,:PV-HIST-MP-STRT-DTE   :PV-HIST-MP-STRT-DTE-NULL  08650000
069900               ,:PV-HIST-MP-ADEVNT-NBR :PV-HIST-MP-ADEVNT-NBR-NULL08660000
070000               ,:PV-HIST-MP-ADEVNT-NM  :PV-HIST-MP-ADEVNT-NM-NULL 08670000
070100               ,:PV-FUT-MP-ITM-ID      :PV-FUT-MP-ITM-ID-NULL     08680000
070200               ,:PV-FUT-MP-PROMO-ID    :PV-FUT-MP-PROMO-ID-NULL   08690000
070300               ,:PV-FUT-MP-LO-AMT      :PV-FUT-MP-LO-AMT-NULL     08700000
070400               ,:PV-FUT-MP-PROMO-NM    :PV-FUT-MP-PROMO-NM-NULL   08710000
070410               ,:PV-FUT-MP-STRT-DTE    :PV-FUT-MP-STRT-DTE-NULL   08720000
070500               ,:PV-FUT-MP-ADEVNT-NBR  :PV-FUT-MP-ADEVNT-NBR-NULL 08730000
070600               ,:PV-FUT-MP-ADEVNT-NM   :PV-FUT-MP-ADEVNT-NM-NULL  08740000
070700               ,:PV-HIST-NMP-ITM-ID    :PV-HIST-NMP-ITM-ID-NULL   08750000
070800               ,:PV-HIST-NMP-PROMO-ID  :PV-HIST-NMP-PROMO-ID-NULL 08760000
070900               ,:PV-HIST-NMP-LO-AMT    :PV-HIST-NMP-LO-AMT-NULL   08770000
071000               ,:PV-HIST-NMP-PROMO-NM  :PV-HIST-NMP-PROMO-NM-NULL 08780000
071010               ,:PV-HIST-NMP-STRT-DTE  :PV-HIST-NMP-STRT-DTE-NULL 08790000
071100               ,:PV-HIST-NMP-ADEVNT-NBR                           08800000
071200                                      :PV-HIST-NMP-ADEVNT-NBR-NULL08810000
071300               ,:PV-HIST-NMP-ADEVNT-NM :PV-HIST-NMP-ADEVNT-NM-NULL08820000
071400               ,:PV-FUT-NMP-ITM-ID     :PV-FUT-NMP-ITM-ID-NULL    08830000
071500               ,:PV-FUT-NMP-PROMO-ID   :PV-FUT-NMP-PROMO-ID-NULL  08840000
071600               ,:PV-FUT-NMP-LO-AMT     :PV-FUT-NMP-LO-AMT-NULL    08850000
071700               ,:PV-FUT-NMP-PROMO-NM   :PV-FUT-NMP-PROMO-NM-NULL  08860000
071710               ,:PV-FUT-NMP-STRT-DTE   :PV-FUT-NMP-STRT-DTE-NULL  08870000
071800               ,:PV-FUT-NMP-ADEVNT-NBR :PV-FUT-NMP-ADEVNT-NBR-NULL08880000
071900               ,:PV-FUT-NMP-ADEVNT-NM  :PV-FUT-NMP-ADEVNT-NM-NULL 08890000
072000               ,:PV-VS-NBR                                        08900000
072100               ,:PV-SUB-CL-NBR                                    08910000
072200               ,:PV-VS-DESC                                       08920000
072300     END-EXEC.                                                    08930000
072400                                                                  08940000
072500     EVALUATE TRUE                                                08950000
072600         WHEN SQLCODE = ZERO                                      08960000
072610              MOVE PV-LPS-STRT-DTE      TO PV-LPS-TMST            08970000
072620              MOVE PV-HIST-MP-STRT-DTE  TO PV-HMP-TMST            08980000
072630              MOVE PV-FUT-MP-STRT-DTE   TO PV-FMP-TMST            08990000
072640              MOVE PV-HIST-NMP-STRT-DTE TO PV-HNMP-TMST           09000000
072650              MOVE PV-FUT-NMP-STRT-DTE  TO PV-FNMP-TMST           09010000
072700             IF PV-LPS-PROMO-ITM-ID-NULL < 0                      09020000
072800                 MOVE ZEROS TO PV-LPS-PROMO-ITM-ID                09030000
072900             END-IF                                               09040000
073000             IF PV-LPS-PRICG-AMT-NULL < 0                         09050000
073100                 MOVE PC-HIGH-PRICE TO PV-LPS-PRICG-AMT           09060000
073200             END-IF                                               09070000
073300             IF PV-LPS-PRICG-AMT = 0                              09080000
073400                 MOVE PC-HIGH-PRICE TO PV-LPS-PRICG-AMT           09090000
073500             END-IF                                               09100000
073600             IF PV-LPS-PROMO-NM-NULL < 0                          09110000
073700                 MOVE SPACES TO PV-LPS-PROMO-NM                   09120000
073800             END-IF                                               09130000
073900             IF PV-HIST-MP-PROMO-ID-NULL < 0                      09140000
074000                 MOVE ZEROS TO PV-HIST-MP-PROMO-ID                09150000
074100             END-IF                                               09160000
074200             IF PV-HIST-MP-LO-AMT-NULL < 0                        09170000
074300                 MOVE PC-HIGH-PRICE TO PV-HIST-MP-LO-AMT          09180000
074400             END-IF                                               09190000
074500             IF PV-HIST-MP-PROMO-NM-NULL < 0                      09200000
074600                 MOVE SPACES TO PV-HIST-MP-PROMO-NM               09210000
074700             END-IF                                               09220000
074800             IF PV-HIST-MP-ADEVNT-NBR-NULL < 0                    09230000
074900                 MOVE SPACES TO PV-HIST-MP-ADEVNT-NBR             09240000
075000             END-IF                                               09250000
075100             IF PV-HIST-MP-ADEVNT-NM-NULL < 0                     09260000
075200                 MOVE SPACES TO PV-HIST-MP-ADEVNT-NM              09270000
075300             END-IF                                               09280000
075400             IF PV-FUT-MP-PROMO-ID-NULL < 0                       09290000
075500                 MOVE ZEROS TO PV-FUT-MP-PROMO-ID                 09300000
075600             END-IF                                               09310000
075700             IF PV-FUT-MP-LO-AMT-NULL < 0                         09320000
075800                 MOVE PC-HIGH-PRICE TO PV-FUT-MP-LO-AMT           09330000
075900             END-IF                                               09340000
076000             IF PV-FUT-MP-PROMO-NM-NULL < 0                       09350000
076100                 MOVE SPACES TO PV-FUT-MP-PROMO-NM                09360000
076200             END-IF                                               09370000
076300             IF PV-FUT-MP-ADEVNT-NBR-NULL < 0                     09380000
076400                 MOVE SPACES TO PV-FUT-MP-ADEVNT-NBR              09390000
076500             END-IF                                               09400000
076600             IF PV-FUT-MP-ADEVNT-NM-NULL < 0                      09410000
076700                 MOVE SPACES TO PV-FUT-MP-ADEVNT-NM               09420000
076800             END-IF                                               09430000
076900             IF PV-HIST-NMP-PROMO-ID-NULL < 0                     09440000
077000                 MOVE ZEROS TO PV-HIST-NMP-PROMO-ID               09450000
077100             END-IF                                               09460000
077200             IF PV-HIST-NMP-LO-AMT-NULL < 0                       09470000
077300                 MOVE PC-HIGH-PRICE TO PV-HIST-NMP-LO-AMT         09480000
077400             END-IF                                               09490000
077500             IF PV-HIST-NMP-PROMO-NM-NULL < 0                     09500000
077600                 MOVE SPACES TO PV-HIST-NMP-PROMO-NM              09510000
077700             END-IF                                               09520000
077800             IF PV-HIST-NMP-ADEVNT-NBR-NULL < 0                   09530000
077900                 MOVE SPACES TO PV-HIST-NMP-ADEVNT-NBR            09540000
078000             END-IF                                               09550000
078100             IF PV-HIST-NMP-ADEVNT-NM-NULL < 0                    09560000
078200                 MOVE SPACES TO PV-HIST-NMP-ADEVNT-NM             09570000
078300             END-IF                                               09580000
078400             IF PV-FUT-NMP-PROMO-ID-NULL < 0                      09590000
078500                 MOVE ZEROS TO PV-FUT-NMP-PROMO-ID                09600000
078600             END-IF                                               09610000
078700             IF PV-FUT-NMP-LO-AMT-NULL < 0                        09620000
078800                 MOVE PC-HIGH-PRICE TO PV-FUT-NMP-LO-AMT          09630000
078900             END-IF                                               09640000
079000             IF PV-FUT-NMP-PROMO-NM-NULL < 0                      09650000
079100                 MOVE SPACES TO PV-FUT-NMP-PROMO-NM               09660000
079200             END-IF                                               09670000
079300             IF PV-FUT-NMP-ADEVNT-NBR-NULL < 0                    09680000
079400                 MOVE SPACES TO PV-FUT-NMP-ADEVNT-NBR             09690000
079500             END-IF                                               09700000
079600             IF PV-FUT-NMP-ADEVNT-NM-NULL < 0                     09710000
079700                 MOVE SPACES TO PV-FUT-NMP-ADEVNT-NM              09720000
079800             END-IF                                               09730000
079900             ADD 1 TO PA-PRICE-CNT                                09740000
080000             ADD 1 TO PA-TOTAL-PRICE-CNT                          09750000
080100                                                                  09760000
080200         WHEN SQLCODE = 100                                       09770000
080300             DISPLAY 'CNT FROM PRICE-CSR ' PA-PRICE-CNT           09780000
080400             DISPLAY '  FOR DEPT ' PV-DPT-NBR-CHAR                09790000
080500             SET PS-END-OF-PRICE-CSR TO TRUE                      09800000
080600                                                                  09810000
080700         WHEN OTHER                                               09820000
080800             DISPLAY 'LPS PROMO ITM ID   = ' PV-LPS-PROMO-ITM-ID  09830000
080900             DISPLAY 'LPS PRICG AMT      = ' PV-LPS-PRICG-AMT     09840000
081000             DISPLAY 'LPS PROMO NM       = ' PV-LPS-PROMO-NM      09850000
081100             DISPLAY 'HIST MP PROMO ID   = ' PV-HIST-MP-PROMO-ID  09860000
081200             DISPLAY 'HIST MP LO AMT     = ' PV-HIST-MP-LO-AMT    09870000
081300             DISPLAY 'HIST MP PROMO NM   = ' PV-HIST-MP-PROMO-NM  09880000
081400             DISPLAY 'HIST MP ADEVNT NBR = ' PV-HIST-MP-ADEVNT-NBR09890000
081500             DISPLAY 'HIST MP ADEVNT NM  = ' PV-HIST-MP-ADEVNT-NM 09900000
081600             DISPLAY 'FUT MP PROMO ID    = ' PV-FUT-MP-PROMO-ID   09910000
081700             DISPLAY 'FUT MP LO AMT      = ' PV-FUT-MP-LO-AMT     09920000
081800             DISPLAY 'FUT MP PROMO NM    = ' PV-FUT-MP-PROMO-NM   09930000
081900             DISPLAY 'FUT MP ADEVNT NBR  = ' PV-FUT-MP-ADEVNT-NBR 09940000
082000             DISPLAY 'FUT MP ADEVNT NM   = ' PV-FUT-MP-ADEVNT-NM  09950000
082100             DISPLAY 'HIST NMP PROMO ID  = ' PV-HIST-NMP-PROMO-ID 09960000
082200             DISPLAY 'HIST NMP LO AMT    = ' PV-HIST-NMP-LO-AMT   09970000
082300             DISPLAY 'HIST NMP PROMO NM  = ' PV-HIST-NMP-PROMO-NM 09980000
082400             DISPLAY 'HIST NMP ADEVNT NBR = '                     09990000
082500                                           PV-HIST-NMP-ADEVNT-NBR 10000000
082600             DISPLAY 'HIST NMP ADEVNT NM = ' PV-HIST-NMP-ADEVNT-NM10010000
082700             DISPLAY 'FUT NMP PROMO ID   = ' PV-FUT-NMP-PROMO-ID  10020000
082800             DISPLAY 'FUT NMP LO AMT     = ' PV-FUT-NMP-LO-AMT    10030000
082900             DISPLAY 'FUT NMP PROMO NM   = ' PV-FUT-NMP-PROMO-NM  10040000
083000             DISPLAY 'FUT NMP ADEVNT NBR = ' PV-FUT-NMP-ADEVNT-NBR10050000
083100             DISPLAY 'FUT NMP ADEVNT NM  = ' PV-FUT-NMP-ADEVNT-NM 10060000
083200             DISPLAY 'PV-VS-NBR          =' PV-VS-NBR             10070000
083300             DISPLAY 'PV-SUB-CL-NBR      =' PV-SUB-CL-NBR         10080000
083400             DISPLAY 'PV-VS-DESC         =' PV-VS-DESC            10090000
083500             MOVE 'C310-FETCH-PRICE-CSR '                         10100000
083600                                         TO PV-PARAGRAPH-NAME     10110000
083700             MOVE 'FETCH ERROR ON PRICE-CSR'                      10120000
083800                                         TO PV-OPERATION-MSG-1    10130000
083900             PERFORM Z100-SQL-ABEND                               10140000
084000     END-EVALUATE.                                                10150000
084100                                                                  10160000
084200***************************************************************** 10170000
084300* C400-PROCESS-ALL-DPT-CSR.                                     * 10180000
084400* ==> PROCESSES:                                                * 10190000
084500*     - FOR EVERY ROW BROUGHT BACK RUN THE PRICE CURSOR FOR     * 10200000
084600*       THAT DEPARTMENT.  THE DEPARTMENT WILL BE ORIGINAL FOR   * 10210000
084700*       EACH ROW.                                               * 10220000
084800* ==> PERFORMED FROM: A100-MAINLINE                             * 10230000
084900***************************************************************** 10240000
085000 C400-PROCESS-ALL-DPT-CSR.                                        10250000
085100                                                                  10260000
085200     SET PS-NOT-END-OF-PRICE-CSR TO TRUE.                         10270000
085300     MOVE 0 TO PA-PRICE-CNT.                                      10280000
085400                                                                  10290000
085500     PERFORM C210-OPEN-PRICE-CSR.                                 10300000
085600     PERFORM C310-FETCH-PRICE-CSR.                                10310000
085700     PERFORM C410-PROCESS-PRICE-CSR                               10320000
085800        UNTIL PS-END-OF-PRICE-CSR.                                10330000
085900     PERFORM C510-CLOSE-PRICE-CSR.                                10340000
086000                                                                  10350000
086100     IF PA-CNT-DEPT = 0                                           10360000
086200        PERFORM D120-MOVE-NO-DEPT-TO-COPYBOOK                     10370000
086300     END-IF.                                                      10380000
086400                                                                  10390000
086500     INITIALIZE PA-CNT-DEPT.                                      10400000
086600     PERFORM C300-FETCH-ALL-DPT-CSR.                              10410000
086700                                                                  10420000
086800***************************************************************** 10430000
086900* C410-PROCESS-PRICE-CSR.                                       * 10440000
087000* ==> PROCESSES:                                                * 10450000
087100*     - CHECK TO SEE IF THE LPS PRICE AMOUNT IS ZERO.           * 10460000
087200*     - IF IT IS NOT ZERO THEN CHECK TO SEE IF THE PRE MAIN AMT * 10470000
087300*       IS LESS THEN THE LPS PRICE.  IF SO THEN MOVE DATA TO    * 10480000
087400*       COPYBOOK.  NEXT CHECK TO SEE IF THE PRE NMAIN AMT IS    * 10490000
087500*       LESS THEN THE LPS PRICE.  IF SO THEN MOVE THAT DATA TO  * 10500000
087600*       THE COPYBOOK.                                           * 10510000
087700*     - WHEN ALL CHECKS ARE DONE FETCH NEXT ROW FROM PRICE-CSR. * 10520000
087800* ==> PERFORMED FROM: C400-PROCESS-ALL-DPT-CSR.                 * 10530000
087900***************************************************************** 10540000
088000 C410-PROCESS-PRICE-CSR.                                          10550000
088100                                                                  10560000
088200     MOVE SPACES TO PM044-PM-LPS-PRE-EXCEP.                       10570000
088300                                                                  10580000
088310     PERFORM S100-SELECT-ONHAND-QTY.                              10590000
088320                                                                  10600000
088330     IF TSKST-ONHAND-QTY > 10                                     10630000
088400        IF NOT(PV-LPS-PRICG-AMT = PC-HIGH-PRICE)                  10760004
088500           IF (PV-HIST-MP-LO-AMT < PV-FUT-MP-LO-AMT)              10770004
C77388              IF (PV-HIST-MP-LO-AMT < PV-LPS-PRICG-AMT)           10780006
088610                  IF PV-HMP-DTE >= PV-FIRST-RC-DTE                10790004
088620                     AND PV-FIRST-RC-DTE NOT = SPACES             10800004
088640                     IF PV-LPS-PREV-RPTD-IND = 'N'                10810004
088650                        PERFORM U100-UPDATE-RPT-IND               10820004
088660                     END-IF                                       10830004
088700                     PERFORM D100-MOVE-HIST-MP-COPYBOOK           10840004
088800                     ADD +1 TO PA-CNT-DEPT                        10850004
088810                  END-IF                                          10860004
088900              END-IF                                              10870004
089000           ELSE                                                   10880004
C77388              IF (PV-FUT-MP-LO-AMT < PV-LPS-PRICG-AMT)            10890006
089110                 IF PV-FMP-DTE >= PV-FIRST-RC-DTE                 10900004
089120                    AND PV-FIRST-RC-DTE NOT = SPACES              10910004
089121                    IF PV-LPS-PREV-RPTD-IND = 'N'                 10920004
089122                       PERFORM U100-UPDATE-RPT-IND                10930004
089123                    END-IF                                        10940004
089200                    PERFORM D105-MOVE-FUT-MP-COPYBOOK             10950004
089300                    ADD +1 TO PA-CNT-DEPT                         10960004
089310                 END-IF                                           10970004
089400              END-IF                                              10980004
089500           END-IF                                                 10990004
089600                                                                  11000000
089700           IF (PV-HIST-NMP-LO-AMT < PV-FUT-NMP-LO-AMT)            11010004
C77388              IF (PV-HIST-NMP-LO-AMT < PV-LPS-PRICG-AMT)          11020006
089810                  IF PV-HNMP-DTE >= PV-FIRST-RC-DTE               11030004
089820                     AND PV-FIRST-RC-DTE NOT = SPACES             11040004
089821                     IF PV-LPS-PREV-RPTD-IND = 'N'                11050004
089822                        PERFORM U100-UPDATE-RPT-IND               11060004
089823                     END-IF                                       11070004
089900                     PERFORM D110-MOVE-HIST-NMP-TO-COPYBOOK       11080004
090000                     ADD +1 TO PA-CNT-DEPT                        11090004
090010                  END-IF                                          11100004
090100              END-IF                                              11110004
090200           ELSE                                                   11120004
C77388              IF (PV-FUT-NMP-LO-AMT < PV-LPS-PRICG-AMT)           11130006
090310                  IF PV-FNMP-DTE >= PV-FIRST-RC-DTE               11140004
090320                     AND PV-FIRST-RC-DTE NOT = SPACES             11150004
090340                     IF PV-LPS-PREV-RPTD-IND = 'N'                11160004
090350                        PERFORM U100-UPDATE-RPT-IND               11170004
090360                     END-IF                                       11180004
090400                     PERFORM D115-MOVE-FUT-NMP-TO-COPYBOOK        11190004
090500                    ADD +1 TO PA-CNT-DEPT                         11200004
090510                  END-IF                                          11210004
090600              END-IF                                              11220004
090700           END-IF                                                 11230004
090800        END-IF                                                    11240004
090810     END-IF.                                                      11260000
090900                                                                  11270000
091000                                                                  11280000
091100     PERFORM C310-FETCH-PRICE-CSR.                                11290000
091200                                                                  11300000
091300****************************************************************  11310000
091400* C500-CLOSE-ALL-DPT-CSR                                       *  11320000
091500* ==> PROCESSES:                                                * 11330000
091600*  - CLOSE THE ALL-DPT-CSR                                      * 11340000
091700* ==> SQLCODE:                                                  * 11350000
091800*  - 0    = CLOSE WAS SUCCESSFULL                               * 11360000
091900* ==> PERFORMED FROM: A100-MAINLINE                             * 11370000
092000****************************************************************  11380000
092100 C500-CLOSE-ALL-DPT-CSR.                                          11390000
092200                                                                  11400000
092300     EXEC SQL                                                     11410000
092400          CLOSE ALL-DPT-CSR                                       11420000
092500     END-EXEC.                                                    11430000
092600                                                                  11440000
092700     EVALUATE TRUE                                                11450000
092800         WHEN SQLCODE = ZERO                                      11460000
092900             CONTINUE                                             11470000
093000                                                                  11480000
093100         WHEN OTHER                                               11490000
093200             MOVE 'C500-CLOSE-ALL-DPT-CSR     '                   11500000
093300                                          TO PV-PARAGRAPH-NAME    11510000
093400             MOVE 'CLOSE ERROR ON ALL-DPT-CSR  '                  11520000
093500                                          TO PV-OPERATION-MSG-1   11530000
093600             PERFORM Z100-SQL-ABEND                               11540000
093700     END-EVALUATE.                                                11550000
093800                                                                  11560000
093900***************************************************************** 11570000
094000* C510-CLOSE-PRICE-CSR                                          * 11580000
094100* ==> PROCESSES:                                                * 11590000
094200*  - CLOSE THE PRICE-CSR                                        * 11600000
094300* ==> SQLCODE:                                                  * 11610000
094400*  - 0    = CLOSE WAS SUCCESSFULL                               * 11620000
094500* ==> PERFORMED FROM: C400-PROCESS-ALL-DPT-CSR                  * 11630000
094600***************************************************************** 11640000
094700 C510-CLOSE-PRICE-CSR.                                            11650000
094800                                                                  11660000
094900     EXEC SQL                                                     11670000
095000          CLOSE PRICE-CSR                                         11680000
095100     END-EXEC.                                                    11690000
095200                                                                  11700000
095300     EVALUATE TRUE                                                11710000
095400         WHEN SQLCODE = ZERO                                      11720000
095500             CONTINUE                                             11730000
095600                                                                  11740000
095700         WHEN OTHER                                               11750000
095800             MOVE 'C510-CLOSE-PRICE-CSR   '                       11760000
095900                                          TO PV-PARAGRAPH-NAME    11770000
096000             MOVE 'CLOSE ERROR ON PRICE-CSR  '                    11780000
096100                                          TO PV-OPERATION-MSG-1   11790000
096200             PERFORM Z100-SQL-ABEND                               11800000
096300     END-EVALUATE.                                                11810000
096400                                                                  11820000
096500***************************************************************** 11830000
096600* D100-MOVE-HIST-MP-COPYBOOK                                    * 11840000
096700* ==> PROCESSES:                                                * 11850000
096800*     - MOVE PRE MAIN INFO FOUND IN PRICE-CSR TO THE COPYBOOK.  * 11860000
096900*     - WRITE DATA FROM COPYBOOK TO FILE.                       * 11870000
097000* ==> PERFORMED FROM: C410-PROCESS-PRICE-CSR                    * 11880000
097100***************************************************************** 11890000
097200 D100-MOVE-HIST-MP-COPYBOOK.                                      11900000
097300                                                                  11910000
097400     MOVE PV-GMA-NBR         TO PM044-GMM-NBR.                    11920000
097500     STRING PV-GMA-FIRST-NM                                       11930000
097600             DELIMITED BY PC-SPACE                                11940000
097700         PC-SPACE                                                 11950000
097800             DELIMITED BY SIZE                                    11960000
097900         PV-GMA-LAST-NM                                           11970000
098000             DELIMITED BY SIZE                                    11980000
098100     INTO  PM044-GMM-NAME.                                        11990000
098200     MOVE PV-DMA-NBR         TO PM044-DMM-NBR.                    12000000
098300     STRING PV-DMA-FIRST-NM                                       12010000
098400             DELIMITED BY PC-SPACE                                12020000
098500         PC-SPACE                                                 12030000
098600             DELIMITED BY SIZE                                    12040000
098700         PV-DMA-LAST-NM                                           12050000
098800             DELIMITED BY SIZE                                    12060000
098900     INTO  PM044-DMM-NAME.                                        12070000
099000     MOVE PV-BYR-NBR         TO PM044-BUYER-NBR.                  12080000
099100     STRING PV-BYR-FIRST-NM                                       12090000
099200             DELIMITED BY PC-SPACE                                12100000
099300         PC-SPACE                                                 12110000
099400             DELIMITED BY SIZE                                    12120000
099500         PV-BYR-LAST-NM                                           12130000
099600             DELIMITED BY SIZE                                    12140000
099700     INTO  PM044-BUYER-NAME.                                      12150000
099800     MOVE PV-DPT-NBR-CHAR           TO PM044-DEPT-NBR.            12160000
099900     MOVE PV-DPT-DESC               TO PM044-DEPT-DESC.           12170000
100000     MOVE PV-SUB-CL-NBR             TO PM044-SUB-CL-NBR.          12180000
100100     MOVE PV-VS-NBR                 TO PM044-STYL-ID.             12190000
100200     MOVE PV-VS-DESC                TO PM044-VS-DESC.             12200000
100300     MOVE PV-HIST-MP-LO-AMT         TO PM044-PRE-LO-AMT.          12210000
100400     STRING PV-HIST-MP-ADEVNT-NBR                                 12220000
100500             DELIMITED BY PC-SPACE                                12230000
100600         PC-SPACE                                                 12240000
100700             DELIMITED BY SIZE                                    12250000
100800         PV-HIST-MP-ADEVNT-NM                                     12260000
100900             DELIMITED BY SIZE                                    12270000
101000     INTO  PM044-PRE-AD-EVNT.                                     12280000
101100     MOVE PV-HIST-MP-PROMO-NM       TO PM044-PRE-PROMO-NM.        12290000
101200     MOVE PV-HIST-MP-ITM-ID         TO PM044-PRE-AD-ITM-ID.       12300000
101300     MOVE SPACES                    TO PM044-PRE-AD-ITM.          12310000
101400     MOVE PV-LPS-PRICG-AMT          TO PM044-LPS-PRICG-AMT.       12320000
101500     MOVE PV-LPS-PROMO-NM           TO PM044-LPS-PROMO-NM.        12330000
101600     MOVE PV-LPS-PROMO-ITM-ID       TO PM044-LPS-AD-ITM-ID.       12340000
101610     MOVE PV-LPS-PREV-RPTD-IND      TO PM044-LPS-PREV-RPTD-IND.   12350000
101700     MOVE SPACES                    TO PM044-LPS-AD-ITM.          12360000
101800     PERFORM W100-WRITE-DETAIL.                                   12370000
101900                                                                  12380000
102000***************************************************************** 12390000
102100* D105-MOVE-FUT-MP-COPYBOOK                                     * 12400000
102200* ==> PROCESSES:                                                * 12410000
102300*     - MOVE PRE MAIN INFO FOUND IN PRICE-CSR TO THE COPYBOOK.  * 12420000
102400*     - WRITE DATA FROM COPYBOOK TO FILE.                       * 12430000
102500* ==> PERFORMED FROM: C410-PROCESS-PRICE-CSR                    * 12440000
102600***************************************************************** 12450000
102700 D105-MOVE-FUT-MP-COPYBOOK.                                       12460000
102800                                                                  12470000
102900     MOVE PV-GMA-NBR         TO PM044-GMM-NBR.                    12480000
103000     STRING PV-GMA-FIRST-NM                                       12490000
103100             DELIMITED BY PC-SPACE                                12500000
103200         PC-SPACE                                                 12510000
103300             DELIMITED BY SIZE                                    12520000
103400         PV-GMA-LAST-NM                                           12530000
103500             DELIMITED BY SIZE                                    12540000
103600     INTO  PM044-GMM-NAME.                                        12550000
103700     MOVE PV-DMA-NBR         TO PM044-DMM-NBR.                    12560000
103800     STRING PV-DMA-FIRST-NM                                       12570000
103900             DELIMITED BY PC-SPACE                                12580000
104000         PC-SPACE                                                 12590000
104100             DELIMITED BY SIZE                                    12600000
104200         PV-DMA-LAST-NM                                           12610000
104300             DELIMITED BY SIZE                                    12620000
104400     INTO  PM044-DMM-NAME.                                        12630000
104500     MOVE PV-BYR-NBR         TO PM044-BUYER-NBR.                  12640000
104600     STRING PV-BYR-FIRST-NM                                       12650000
104700             DELIMITED BY PC-SPACE                                12660000
104800         PC-SPACE                                                 12670000
104900             DELIMITED BY SIZE                                    12680000
105000         PV-BYR-LAST-NM                                           12690000
105100             DELIMITED BY SIZE                                    12700000
105200     INTO  PM044-BUYER-NAME.                                      12710000
105300     MOVE PV-DPT-NBR-CHAR           TO PM044-DEPT-NBR.            12720000
105400     MOVE PV-DPT-DESC               TO PM044-DEPT-DESC.           12730000
105500     MOVE PV-SUB-CL-NBR             TO PM044-SUB-CL-NBR.          12740000
105600     MOVE PV-VS-NBR                 TO PM044-STYL-ID.             12750000
105700     MOVE PV-VS-DESC                TO PM044-VS-DESC.             12760000
105800     MOVE PV-FUT-MP-LO-AMT          TO PM044-PRE-LO-AMT.          12770000
105900     STRING PV-FUT-MP-ADEVNT-NBR                                  12780000
106000             DELIMITED BY PC-SPACE                                12790000
106100         PC-SPACE                                                 12800000
106200             DELIMITED BY SIZE                                    12810000
106300         PV-FUT-MP-ADEVNT-NM                                      12820000
106400             DELIMITED BY SIZE                                    12830000
106500     INTO  PM044-PRE-AD-EVNT.                                     12840000
106600     MOVE PV-FUT-MP-PROMO-NM        TO PM044-PRE-PROMO-NM.        12850000
106700     MOVE PV-FUT-MP-ITM-ID          TO PM044-PRE-AD-ITM-ID.       12860000
106800     MOVE SPACES                    TO PM044-PRE-AD-ITM.          12870000
106900     MOVE PV-LPS-PRICG-AMT          TO PM044-LPS-PRICG-AMT.       12880000
107000     MOVE PV-LPS-PROMO-NM           TO PM044-LPS-PROMO-NM.        12890000
107100     MOVE PV-LPS-PROMO-ITM-ID       TO PM044-LPS-AD-ITM-ID.       12900000
107110     MOVE PV-LPS-PREV-RPTD-IND      TO PM044-LPS-PREV-RPTD-IND.   12910000
107200     MOVE SPACES                    TO PM044-LPS-AD-ITM.          12920000
107300     PERFORM W100-WRITE-DETAIL.                                   12930000
107400                                                                  12940000
107500***************************************************************** 12950000
107600* D110-MOVE-HIST-NMP-TO-COPYBOOK                                * 12960000
107700* ==> PROCESSES:                                                * 12970000
107800*     - MOVE PRE NMAIN INFO FOUND IN PRICE-CSR TO THE COPYBOOK. * 12980000
107900*     - WRITE DATA FROM COPYBOOK TO FILE.                       * 12990000
108000* ==> PERFORMED FROM: C410-PROCESS-PRICE-CSR                    * 13000000
108100***************************************************************** 13010000
108200 D110-MOVE-HIST-NMP-TO-COPYBOOK.                                  13020000
108300                                                                  13030000
108400     MOVE PV-GMA-NBR                 TO PM044-GMM-NBR.            13040000
108500     STRING PV-GMA-FIRST-NM                                       13050000
108600             DELIMITED BY PC-SPACE                                13060000
108700         PC-SPACE                                                 13070000
108800             DELIMITED BY SIZE                                    13080000
108900         PV-GMA-LAST-NM                                           13090000
109000             DELIMITED BY SIZE                                    13100000
109100     INTO  PM044-GMM-NAME.                                        13110000
109200     MOVE PV-DMA-NBR                 TO PM044-DMM-NBR.            13120000
109300     STRING PV-DMA-FIRST-NM                                       13130000
109400             DELIMITED BY PC-SPACE                                13140000
109500         PC-SPACE                                                 13150000
109600             DELIMITED BY SIZE                                    13160000
109700         PV-DMA-LAST-NM                                           13170000
109800             DELIMITED BY SIZE                                    13180000
109900     INTO  PM044-DMM-NAME.                                        13190000
110000     MOVE PV-BYR-NBR                 TO PM044-BUYER-NBR.          13200000
110100     STRING PV-BYR-FIRST-NM                                       13210000
110200             DELIMITED BY PC-SPACE                                13220000
110300         PC-SPACE                                                 13230000
110400             DELIMITED BY SIZE                                    13240000
110500         PV-BYR-LAST-NM                                           13250000
110600             DELIMITED BY SIZE                                    13260000
110700     INTO  PM044-BUYER-NAME.                                      13270000
110800     MOVE PV-DPT-NBR-CHAR            TO PM044-DEPT-NBR.           13280000
110900     MOVE PV-DPT-DESC                TO PM044-DEPT-DESC.          13290000
111000     MOVE PV-SUB-CL-NBR              TO PM044-SUB-CL-NBR.         13300000
111100     MOVE PV-VS-NBR                  TO PM044-STYL-ID.            13310000
111200     MOVE PV-VS-DESC                 TO PM044-VS-DESC.            13320000
111300     MOVE PV-HIST-NMP-LO-AMT         TO PM044-PRE-LO-AMT.         13330000
111400     STRING PV-HIST-NMP-ADEVNT-NBR                                13340000
111500             DELIMITED BY PC-SPACE                                13350000
111600         PC-SPACE                                                 13360000
111700             DELIMITED BY SIZE                                    13370000
111800         PV-HIST-NMP-ADEVNT-NM                                    13380000
111900             DELIMITED BY SIZE                                    13390000
112000     INTO  PM044-PRE-AD-EVNT.                                     13400000
112100     MOVE PV-HIST-NMP-PROMO-NM       TO PM044-PRE-PROMO-NM.       13410000
112200     MOVE PV-HIST-NMP-ITM-ID         TO PM044-PRE-AD-ITM-ID.      13420000
112300     MOVE SPACES                     TO PM044-PRE-AD-ITM.         13430000
112400     MOVE PV-LPS-PRICG-AMT           TO PM044-LPS-PRICG-AMT.      13440000
112500     MOVE PV-LPS-PROMO-NM            TO PM044-LPS-PROMO-NM.       13450000
112600     MOVE PV-LPS-PROMO-ITM-ID        TO PM044-LPS-AD-ITM-ID.      13460000
112610     MOVE PV-LPS-PREV-RPTD-IND       TO PM044-LPS-PREV-RPTD-IND.  13470000
112700     MOVE SPACES                     TO PM044-LPS-AD-ITM.         13480000
112800     PERFORM W100-WRITE-DETAIL.                                   13490000
112900                                                                  13500000
113000***************************************************************** 13510000
113100* D115-MOVE-FUT-NMP-TO-COPYBOOK                                 * 13520000
113200* ==> PROCESSES:                                                * 13530000
113300*     - MOVE PRE NMAIN INFO FOUND IN PRICE-CSR TO THE COPYBOOK. * 13540000
113400*     - WRITE DATA FROM COPYBOOK TO FILE.                       * 13550000
113500* ==> PERFORMED FROM: C410-PROCESS-PRICE-CSR                    * 13560000
113600***************************************************************** 13570000
113700 D115-MOVE-FUT-NMP-TO-COPYBOOK.                                   13580000
113800                                                                  13590000
113900     MOVE PV-GMA-NBR                 TO PM044-GMM-NBR.            13600000
114000     STRING PV-GMA-FIRST-NM                                       13610000
114100             DELIMITED BY PC-SPACE                                13620000
114200         PC-SPACE                                                 13630000
114300             DELIMITED BY SIZE                                    13640000
114400         PV-GMA-LAST-NM                                           13650000
114500             DELIMITED BY SIZE                                    13660000
114600     INTO  PM044-GMM-NAME.                                        13670000
114700     MOVE PV-DMA-NBR                 TO PM044-DMM-NBR.            13680000
114800     STRING PV-DMA-FIRST-NM                                       13690000
114900             DELIMITED BY PC-SPACE                                13700000
115000         PC-SPACE                                                 13710000
115100             DELIMITED BY SIZE                                    13720000
115200         PV-DMA-LAST-NM                                           13730000
115300             DELIMITED BY SIZE                                    13740000
115400     INTO  PM044-DMM-NAME.                                        13750000
115500     MOVE PV-BYR-NBR                 TO PM044-BUYER-NBR.          13760000
115600     STRING PV-BYR-FIRST-NM                                       13770000
115700             DELIMITED BY PC-SPACE                                13780000
115800         PC-SPACE                                                 13790000
115900             DELIMITED BY SIZE                                    13800000
116000         PV-BYR-LAST-NM                                           13810000
116100             DELIMITED BY SIZE                                    13820000
116200     INTO  PM044-BUYER-NAME.                                      13830000
116300     MOVE PV-DPT-NBR-CHAR            TO PM044-DEPT-NBR.           13840000
116400     MOVE PV-DPT-DESC                TO PM044-DEPT-DESC.          13850000
116500     MOVE PV-SUB-CL-NBR              TO PM044-SUB-CL-NBR.         13860000
116600     MOVE PV-VS-NBR                  TO PM044-STYL-ID.            13870000
116700     MOVE PV-VS-DESC                 TO PM044-VS-DESC.            13880000
116800     MOVE PV-FUT-NMP-LO-AMT          TO PM044-PRE-LO-AMT.         13890000
116900     STRING PV-FUT-NMP-ADEVNT-NBR                                 13900000
117000             DELIMITED BY PC-SPACE                                13910000
117100         PC-SPACE                                                 13920000
117200             DELIMITED BY SIZE                                    13930000
117300         PV-FUT-NMP-ADEVNT-NM                                     13940000
117400             DELIMITED BY SIZE                                    13950000
117500     INTO  PM044-PRE-AD-EVNT.                                     13960000
117600     MOVE PV-FUT-NMP-PROMO-NM        TO PM044-PRE-PROMO-NM.       13970000
117700     MOVE PV-FUT-NMP-ITM-ID          TO PM044-PRE-AD-ITM-ID.      13980000
117800     MOVE SPACES                     TO PM044-PRE-AD-ITM.         13990000
117900     MOVE PV-LPS-PRICG-AMT           TO PM044-LPS-PRICG-AMT.      14000000
118000     MOVE PV-LPS-PROMO-NM            TO PM044-LPS-PROMO-NM.       14010000
118100     MOVE PV-LPS-PROMO-ITM-ID        TO PM044-LPS-AD-ITM-ID.      14020000
118110     MOVE PV-LPS-PREV-RPTD-IND       TO PM044-LPS-PREV-RPTD-IND.  14030000
118200     MOVE SPACES                     TO PM044-LPS-AD-ITM.         14040000
118300     PERFORM W100-WRITE-DETAIL.                                   14050000
118400                                                                  14060000
118500***************************************************************** 14070000
118600* D120-MOVE-NO-DEPT-TO-COPYBOOK.                                * 14080000
118700* ==> PROCESSES:                                                * 14090000
118800*     - MOVE PRE NMAIN INFO FOUND IN PRICE-CSR TO THE COPYBOOK. * 14100000
118900*     - WRITE DATA FROM COPYBOOK TO FILE.                       * 14110000
119000* ==> PERFORMED FROM: C410-PROCESS-PRICE-CSR                    * 14120000
119100***************************************************************** 14130000
119200 D120-MOVE-NO-DEPT-TO-COPYBOOK.                                   14140000
119300                                                                  14150000
119400     MOVE PV-GMA-NBR                 TO PM044-GMM-NBR.            14160000
119500     STRING PV-GMA-FIRST-NM                                       14170000
119600             DELIMITED BY PC-SPACE                                14180000
119700         PC-SPACE                                                 14190000
119800             DELIMITED BY SIZE                                    14200000
119900         PV-GMA-LAST-NM                                           14210000
120000             DELIMITED BY SIZE                                    14220000
120100     INTO  PM044-GMM-NAME.                                        14230000
120200     MOVE PV-DMA-NBR                 TO PM044-DMM-NBR.            14240000
120300     STRING PV-DMA-FIRST-NM                                       14250000
120400             DELIMITED BY PC-SPACE                                14260000
120500         PC-SPACE                                                 14270000
120600             DELIMITED BY SIZE                                    14280000
120700         PV-DMA-LAST-NM                                           14290000
120800             DELIMITED BY SIZE                                    14300000
120900     INTO  PM044-DMM-NAME.                                        14310000
121000     MOVE PV-BYR-NBR                 TO PM044-BUYER-NBR.          14320000
121100     STRING PV-BYR-FIRST-NM                                       14330000
121200             DELIMITED BY PC-SPACE                                14340000
121300         PC-SPACE                                                 14350000
121400             DELIMITED BY SIZE                                    14360000
121500         PV-BYR-LAST-NM                                           14370000
121600             DELIMITED BY SIZE                                    14380000
121700     INTO  PM044-BUYER-NAME.                                      14390000
121800     MOVE PV-DPT-NBR-CHAR            TO PM044-DEPT-NBR.           14400000
121900     MOVE PV-DPT-DESC                TO PM044-DEPT-DESC.          14410000
122000     MOVE ZEROES                     TO PM044-SUB-CL-NBR.         14420000
122100     MOVE SPACES                     TO PM044-STYL-ID.            14430000
122200     MOVE SPACES                     TO PM044-VS-DESC.            14440000
122300     MOVE ZEROES                     TO PM044-PRE-LO-AMT.         14450000
122400     MOVE SPACES                     TO PM044-PRE-AD-EVNT.        14460000
122500     MOVE SPACES                     TO PM044-PRE-PROMO-NM.       14470000
122600     MOVE ZEROES                     TO PM044-PRE-AD-ITM-ID.      14480000
122700     MOVE SPACES                     TO PM044-PRE-AD-ITM.         14490000
122800     MOVE ZEROES                     TO PM044-LPS-PRICG-AMT.      14500000
122900     MOVE SPACES                     TO PM044-LPS-PROMO-NM.       14510000
123000     MOVE ZEROES                     TO PM044-LPS-AD-ITM-ID.      14520000
123100     MOVE SPACES                     TO PM044-LPS-AD-ITM.         14530000
123110     MOVE SPACES                     TO PM044-LPS-PREV-RPTD-IND.  14540000
123200     PERFORM W100-WRITE-DETAIL.                                   14550000
123300                                                                  14560000
123440******************************************************************15070000
123500* GET THE TSKST DATA AND MOVE IT OUT                              15080000
123600******************************************************************15090000
123700 S100-SELECT-ONHAND-QTY.                                          15100000
123800                                                                  15110000
123900     EXEC SQL                                                     15120000
124000         SELECT S.ONHAND_QTY                                      15130000
124010               ,S.FIRST_RCVD_DATE                                 15140000
124100           INTO :TSKST-ONHAND-QTY                                 15150000
124110               ,:TSKST-FIRST-RCVD-DATE                            15160000
124200           FROM TSKXREF X                                         15170000
124300               ,TSKST   S                                         15180000
124400          WHERE X.ITM_NBR = S.ITEM_NMBR                           15190000
124500            AND X.SKU_STAT_CDE NOT IN ('30','98')                 15200000
124600            AND X.INTR_UPC_ID = :PV-INTR-UPC-ID                   15210000
124610            AND S.LOC_NBR     = SMALLINT(0)                       15220000
124700          WITH UR                                                 15230000
124800     END-EXEC.                                                    15240000
124900                                                                  15250000
125000     EVALUATE TRUE                                                15260000
125100         WHEN SQLCODE = 0                                         15270000
125300             IF TSKST-FIRST-RCVD-DATE > 0                         15280000
125400*                CONVERT FIRST-RCVD-DATE TO A DATE FORMAT         15290000
125500                 MOVE TSKST-FIRST-RCVD-DATE TO                    15300000
125600                                            PV-FIRST-RCVD-DTE-NUM 15310000
125610                 IF PV-FIRST-RCVD-RDF-YY < 30                     15320000
125620                     MOVE '20' TO PV-FIRST-RCVD-DTE-CC            15330000
125630                 ELSE                                             15340000
125640                     MOVE '19' TO PV-FIRST-RCVD-DTE-CC            15350000
125650                 END-IF                                           15360000
125660                 MOVE PV-FIRST-RCVD-RDF-YY TO PV-FIRST-RCVD-DTE-YY15370000
125670                 MOVE PV-FIRST-RCVD-RDF-MM TO PV-FIRST-RCVD-DTE-MM15380000
125680                 MOVE PV-FIRST-RCVD-RDF-DD TO PV-FIRST-RCVD-DTE-DD15390000
125690                 MOVE PV-FIRST-RCVD-DTE    TO PV-FIRST-RC-DTE     15400000
125691             ELSE                                                 15410000
125692                 MOVE SPACES               TO PV-FIRST-RC-DTE     15420000
125693             END-IF                                               15430000
125700         WHEN SQLCODE = +100                                      15440000
125800              MOVE ZEROES TO TSKST-ONHAND-QTY                     15450000
125900              MOVE SPACES TO PV-FIRST-RC-DTE                      15460000
126000         WHEN OTHER                                               15470000
126100              MOVE 'H200-RETRIEVE-TSKST-FIELDS' TO                15480000
126200                    PV-PARAGRAPH-NAME                             15490000
126300              MOVE 'ERROR ON TSKST SELECT ' TO PV-OPERATION-MSG-1 15500000
126400              PERFORM Z100-SQL-ABEND                              15510000
126500     END-EVALUATE.                                                15520000
                                                                        15530000
KBLFIX     PERFORM C155-CHECK-TIME.                                     15540000
KBLFIX     IF WS-TMST > PV-RUN-TIME                                     15550000
KBLFIX        PERFORM C160-COMMIT                                       15560000
KBLFIX        PERFORM C150-FIND-TIME                                    15570000
KBLFIX     END-IF.                                                      15580000
126600                                                                  15590000
126729******************************************************************15920000
126730* U100-UPDATE-RPT-IND.                                            15930000
126731*  UPDATES THE REPORT INDICATOR ON THE TABLE.                     15940000
126734******************************************************************15950000
126735 U100-UPDATE-RPT-IND.                                             15960000
126736                                                                  15970000
126745     EXEC SQL                                                     15980000
126746         UPDATE XST_LPS_MIN_PRIC_W                                15990000
126747             SET LPS_PREV_RPTD_IND = 'Y'                          16000000
126754         WHERE INTR_UPC_ID = :PV-INTR-UPC-ID                      16010000
126757     END-EXEC.                                                    16020000
126758                                                                  16030000
126759     EVALUATE TRUE                                                16040000
126760         WHEN SQLCODE = 0                                         16050000
126761         WHEN SQLCODE = +100                                      16060000
126762             CONTINUE                                             16070000
126763         WHEN OTHER                                               16080000
126764             MOVE 'U100-UPDATE-RPT-IND'                           16090000
126765                               TO PV-PARAGRAPH-NAME               16100000
126766             MOVE 'UPDATE ERROR ON XST_LPS_MIN_PRIC_W'            16110000
126767                               TO PV-OPERATION-MSG-1              16120000
126768             PERFORM Z100-SQL-ABEND                               16130000
126769     END-EVALUATE.                                                16140000
126770                                                                  16150000
126780***************************************************************** 16160000
126800* W100-WRITE-DETAIL.                                            * 16170000
126900* ==> PROCESSES:                                                * 16180000
127000*  - WRITE THE DETAIL LINE TO THE OUTPUT FILE                   * 16190000
127100* ==> PERFORMED FROM: D100-MOVE-HIST-MP-COPYBOOK,               * 16200000
127200*        D105-MOVE-FUT-MP-COPYBOOK,D110-MOVE-HIST-NMP-COPYBOOK  * 16210000
127300*        D115-MOVE-FUT-NMP-COPYBOOK                             * 16220000
127400***************************************************************** 16230000
127500 W100-WRITE-DETAIL.                                               16240000
127600                                                                  16250000
127700     WRITE LPS-PRE-EXCEP-RECORD FROM PM044-PM-LPS-PRE-EXCEP.      16260000
127800                                                                  16270000
127900     ADD +1                    TO PA-RECS-WRITTEN.                16280000
128000                                                                  16290000
128100******************************************************************16300000
128200* Z100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE     *16310000
128300* EVENT THAT AN SQL ERROR CODE OCCURS.                           *16320000
128400******************************************************************16330000
128500 Z100-SQL-ABEND.                                                  16340000
128600                                                                  16350000
128700     MOVE SQLCODE TO SQLCODE2.                                    16360000
128800     MOVE SQLERRD(3) TO SQLERRD3.                                 16370000
128900     DISPLAY '** ABEND           ** = SQLABEND'.                  16380000
129000     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          16390000
129100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        16400000
129200     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.      16410000
129300     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-2.      16420000
129400     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-3.      16430000
129500     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       16440000
129600     DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 16450000
129700     DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 16460000
129800     DISPLAY '** SQLERRM         ** = ' SQLERRM.                  16470000
129900     DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 16480000
130000                                                                  16490000
130100******************************************************************16500000
130200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *16510000
130300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *16520000
130400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *16530000
130500* FORMAT.                                                        *16540000
130600******************************************************************16550000
130700     COPY DPPD004.                                                16560000
130800                                                                  16570000
130900     SET ABEND-4013-DB2-ERROR  TO TRUE.                           16580000
131000     CALL 'ILBOABN0' USING ABEND-CODE.                            16590000
