000100 TITLE 'REFORMAT AUDIT EXTRACT FOR VIOLATION REPORTS'.            00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    SUKUT067.                                         00030000
000400 AUTHOR.        DENNIS STEFFEN.                                   00040000
000500 DATE-WRITTEN.  WINTER 2002.                                      00050000
000600 ENVIRONMENT DIVISION.                                            00060000
000700 INPUT-OUTPUT SECTION.                                            00070000
000800                                                                  00080000
001600******************************************************************00081000
000800                                                                  00082000
000900* THIS PROGRAM REFORMAT AUDIT EXTRACT FOR VIOLATION REPORTS.      00083000
      * /*VSH - CN FILE LAYOUT CHANGES                                  00084000
001000* THE PROGRAM WAS MODIFIED TO COMPARE THE CORRECT QTY AGAINST     00085000
      * RFID TAGGED QTY WHICH GETS MODFIED FOR DIFFERENT SCENARIOS      00086000
      * SUCH RFID ONLY, COMBO AUDIT AND RFID AUDIT.                     00087000
001100* */VSH - CN FILE LAYOUT CHANGES                                  00088000
001600******************************************************************00089000
000900 FILE-CONTROL.                                                    00090000
001000     SELECT OLD-AUDIT-EXTRACT-FILE      ASSIGN TO INP01.          00100000
001100     SELECT VIOLATION-EXTRACT-FILE      ASSIGN TO OUT01.          00110000
001200                                                                  00120000
001300 DATA DIVISION.                                                   00130000
001400 FILE SECTION.                                                    00140000
001500                                                                  00150000
001600                                                                  00160000
001700 FD  OLD-AUDIT-EXTRACT-FILE                                       00170000
001800     RECORDING MODE IS F                                          00180000
001900     LABEL RECORDS ARE STANDARD                                   00190000
002000     RECORD CONTAINS 150                                          00200000
002100     BLOCK CONTAINS 0 RECORDS                                     00210000
002200     DATA RECORD IS OLD-AUDIT-EXTRACT-RECORD.                     00220000
002300 01  OLD-AUDIT-EXTRACT-RECORD         PIC X(150).                 00230000
002400                                                                  00240000
002500 FD  VIOLATION-EXTRACT-FILE                                       00250000
002600     RECORDING MODE IS F                                          00260000
002700     LABEL RECORDS ARE STANDARD                                   00270000
002800     RECORD CONTAINS 150                                          00280000
002900     BLOCK CONTAINS 0 RECORDS                                     00290000
003000     DATA RECORD IS VIOLATION-EXTRACT-RECORD.                     00300000
003100 01  VIOLATION-EXTRACT-RECORD        PIC X(150).                  00310000
003200                                                                  00320000
003300 WORKING-STORAGE SECTION.                                         00330000
003400                                                                  00340000
003500 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     00350000
003600                                                   COMP SYNC.     00360000
003700                                                                  00370000
003800 01  PS-PROGRAM-SWITCHES.                                         00380000
003900     05  PS-END-EXTRACT-SW            PIC X(1)   VALUE 'N'.       00390000
004000         88  PS-END-EXTRACT                      VALUE 'Y'.       00400000
004100                                                                  00410000
004200 01  DK-KEYS.                                                     00420000
004300     05  DK-AUD-CNTL-NBR              PIC S9(09) COMP VALUE ZERO. 00430000
004400                                                                  00440000
004500 01  PV-PROGRAM-VARIABLES.                                        00450000
004600     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00460000
004700                                                  COMP SYNC.      00470000
004800     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00480000
004900     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00490000
005000     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00500000
005100     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00510000
005200     05  PV-DISP-NBR                  PIC Z(8)9.                  00520000
005200     05  PV-DISP-NBR-N                PIC 9(9)    VALUE ZERO.     00521000
005300     05  PV-AUDIT-DURATION            PIC S9(9) COMP-3 VALUE ZERO.00530000
005400     05  PV-PREPACK-COUNT             PIC S9(9) COMP-3 VALUE ZERO.00540000
005500     05  PV-TOTAL-PACK-ITEMS          PIC S9(9) COMP-3 VALUE ZERO.00550000
005600     05  PV-SCAN-PACK-ITEMS           PIC S9(9) COMP-3 VALUE ZERO.00560000
005700     05  PV-PREPACK-ERRORS            PIC S9(9) COMP-3 VALUE ZERO.00570000
005800     05  PV-FAILURE-COUNT             PIC S9(9) COMP-3 VALUE ZERO.00580000
      * /*VSH - CN FILE LAYOUT CHANGES                                  00580100
005800     05  PV-NBR-TICK-ERRS             PIC S9(9) COMP   VALUE ZERO.00581200
005800     05  PV-NBR-EPC-ERRS              PIC S9(9) COMP   VALUE ZERO.00581300
012000*VSH CN FILE LAYOUT CHANGES END                                   00581500
005900                                                                  00590000
006000 01  PV-COUNTERS COMP-3.                                          00600000
006100     05  PV-READ-COUNT                PIC S9(9)    VALUE ZERO.    00610000
006200     05  PV-WRITE-COUNT               PIC S9(9)    VALUE ZERO.    00620000
006300     05  PV-B-COUNT                   PIC S9(9)    VALUE ZERO.    00630000
006400     05  PV-C-COUNT                   PIC S9(9)    VALUE ZERO.    00640000
006500                                                                  00650000
006600 01  PC-PROGRAM-CONSTANTS.                                        00660000
006700     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT067'.00670000
006800     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00680000
006900                                                 COMP SYNC.       00690000
007000 01  PV-ABEND-FIELDS.                                             00700000
007100     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT067'.00710000
007200     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00720000
007300     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00730000
007400     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    00740000
007500     05  PV-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    00750000
007600     05  PV-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    00760000
007700     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    00770000
007800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00780000
007900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00790000
008000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00800000
008100     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00810000
008200                                                                  00820000
008300/                                                                 00830000
008400*    VIOLATION EXTRACT                                            00840000
008500     COPY SURD033.                                                00850000
008600                                                                  00860000
008700*    AUDIT-EXTRACT RECORD                                         00870000
008800     COPY SURD031.                                                00880000
008900                                                                  00890000
009000*    DATE CONTROL CARD                                            00900000
009100     COPY SURD032.                                                00910000
009200                                                                  00920000
009300/                                                                 00930000
009400*    VENDOR NAMES                                                 00940000
009500     EXEC SQL                                                     00950000
009600         INCLUDE TENTNME                                          00960000
009700     END-EXEC                                                     00970000
009800                                                                  00980000
      * /*VSH - CN FILE LAYOUT CHANGES                                  00980100
009400*    SUT_PO_AUD_REQ                                               00981000
009500     EXEC SQL                                                     00982000
009600         INCLUDE SUT00015                                         00983000
009700     END-EXEC                                                     00984000
001100* */VSH - CN FILE LAYOUT CHANGES                                  00984100
009800                                                                  00985000
009900*    VENDOR MASTER                                                00990000
010000     EXEC SQL                                                     01000000
010100         INCLUDE TEXTENT                                          01010000
010200     END-EXEC                                                     01020000
010300                                                                  01030000
010400*    AUDIT TRANSACTIONS                                           01040000
010500     EXEC SQL                                                     01050000
010600         INCLUDE TSUATRN                                          01060000
010700     END-EXEC                                                     01070000
010800                                                                  01080000
010900*    AUDIT UNITS                                                  01090000
011000     EXEC SQL                                                     01100000
011100         INCLUDE TSUAUPC                                          01110000
011200     END-EXEC                                                     01120000
011300                                                                  01130000
011400*    AUDIT EXCEPTIONS                                             01140000
011500     EXEC SQL                                                     01150000
011600         INCLUDE TSUEXCP                                          01160000
011700     END-EXEC                                                     01170000
011800                                                                  01180000
011900*    VIOLATION CODES                                              01190000
012000     EXEC SQL                                                     01200000
012100         INCLUDE TVILNCD                                          01210000
012200     END-EXEC                                                     01220000
012300                                                                  01230000
012400*                                                                 01240000
012500     EXEC SQL                                                     01250000
012600         INCLUDE TCTEXCP                                          01260000
012700     END-EXEC                                                     01270000
012800                                                                  01280000
012900/                                                                 01290000
013000*  USED FOR DB2 ERROR MESSAGE BUILDING                            01300000
013100     COPY DPWS004.                                                01310000
013200                                                                  01320000
013300*   DB2 SQL COMMUNICATION AREA                                    01330000
013400     EXEC SQL                                                     01340000
013500          INCLUDE SQLCA                                           01350000
013600     END-EXEC.                                                    01360000
013700/                                                                 01370000
013800 PROCEDURE DIVISION.                                              01380000
013900                                                                  01390000
014000     PERFORM 1000-INIT.                                           01400000
014100                                                                  01410000
014200     PERFORM 2000-PROCESS UNTIL PS-END-EXTRACT.                   01420000
014300                                                                  01430000
014400     PERFORM 9000-TERMINATE.                                      01440000
014500                                                                  01450000
014600     GOBACK.                                                      01460000
014700                                                                  01470000
014800 1000-INIT.                                                       01480000
014900                                                                  01490000
015000     OPEN INPUT  OLD-AUDIT-EXTRACT-FILE                           01500000
015100          OUTPUT VIOLATION-EXTRACT-FILE                           01510000
015200                                                                  01520000
015300     ACCEPT SU032-DATE-CONTROL-REC FROM SYSIN                     01530000
015400                                                                  01540000
015500     PERFORM 8000-READ-OLD-AUDIT-REC.                             01550000
015600                                                                  01560000
015700 2000-PROCESS.                                                    01570000
015800                                                                  01580000
015900     PERFORM 3000-BUILD-EXTRACT.                                  01590000
016000                                                                  01600000
016100     PERFORM 8100-WRITE-EXTRACT-REC.                              01610000
016200                                                                  01620000
016300     PERFORM 8000-READ-OLD-AUDIT-REC.                             01630000
016400/                                                                 01640000
016500 3000-BUILD-EXTRACT.                                              01650000
016600                                                                  01660000
016700     INITIALIZE SU033-RECORD                                      01670000
016800                                                                  01680000
016900     MOVE SU032-TO-DATE               TO SU033-WEEK-END-DATE      01690000
017000     MOVE SU031-FISCAL-YEAR           TO SU033-FISCAL-YEAR        01700000
017100     MOVE SU031-FISCAL-WEEK           TO SU033-FISCAL-WEEK        01710000
017200     MOVE SU031-FISCAL-SEASON         TO SU033-FISCAL-SEASON      01720000
017300     MOVE SU031-FISCAL-MONTH          TO SU033-FISCAL-MONTH       01730000
017400     MOVE SU031-OPER-UNT-ID           TO SU033-OPER-UNT-ID        01740000
017500     MOVE SU031-PKGNG-TYPE            TO SU033-PKGNG-TYPE         01750000
017600     MOVE SU031-VENDOR-RANK           TO SU033-VENDOR-AUDIT-RANK  01760000
017700     MOVE SU031-AUD-CNTL-NBR          TO SU033-AUD-CNTL-NBR       01770000
017800     MOVE SU031-PO-NBR                TO SU033-PO-NBR             01780000
017900     MOVE SU031-RCVR-SEQ-NBR          TO SU033-RCVR-SEQ-NBR       01790000
018000     MOVE SU031-PO-LNE-NBR            TO SU033-PO-LNE-NBR         01800000
018100     MOVE SU031-PO-PREPK-ID           TO SU033-PO-PREPK-ID        01810000
018200     MOVE SU031-AUD-CART-QTY          TO SU033-CRTNS-AUDITED      01820000
018300     MOVE SU031-AUD-UNT-QTY           TO SU033-UNITS-AUDITED      01830000
018400     MOVE SU031-AUD-STAT-CDE          TO SU033-AUD-STAT-CDE.      01840000
018500                                                                  01850000
018600     PERFORM 7000-VENDOR-INFO                                     01860000
018700     MOVE ENTNME-ENT-NAME-DESC        TO SU033-VENDOR-NAME        01870000
018800     MOVE EXTENT-CFY-SLSRNK-NBR       TO SU033-VENDOR-SALES-RANK. 01880000
018900                                                                  01890000
      * /*VSH - CN FILE LAYOUT CHANGES                                  01890100
           IF SU033-RFID                                                01891000
              MOVE SU031-AUD-CNTL-NBR TO SUT00015-RWRK-AUD-CNTL-NBR     01894000
              PERFORM 7093-TICKET-ERROR                                 01894100
           ELSE                                                         01896000
019000        PERFORM 7010-CRTNS-W-PICK-ERR                             01900000
019200        PERFORM 7020-UNITS-PICK-ERR                               01920000
019400        PERFORM 7080-UNITS-TICK-ERR                               01940000
019600        PERFORM 7030-UNITS-PACK-ERR                               01960000
           END-IF                                                       01961000
001100* */VSH - CN FILE LAYOUT CHANGES                                  01962000
019700                                                                  01970000
019800     IF SU031-PREPACK                                             01980000
019900         INITIALIZE  PV-TOTAL-PACK-ITEMS                          01990000
020000                     PV-SCAN-PACK-ITEMS                           02000000
020100                     PV-PREPACK-COUNT                             02010000
020200                     PV-PREPACK-ERRORS                            02020000
020300                                                                  02030000
020400         PERFORM 7040-PREPACK-PACKS-AUDITED                       02040000
020500         IF PV-SCAN-PACK-ITEMS   > 0  AND                         02050000
020600            PV-TOTAL-PACK-ITEMS  > 0                              02060000
020700             DIVIDE PV-TOTAL-PACK-ITEMS                           02070000
020800                 BY PV-SCAN-PACK-ITEMS                            02080000
020900             GIVING PV-PREPACK-COUNT                              02090000
021000         END-IF                                                   02100000
021100         MOVE  PV-PREPACK-COUNT  TO  SU033-PACKS-AUDITED          02110000
021200                                                                  02120000
021300         PERFORM 7050-PREPACK-PACKS-ERR                           02130000
021400         MOVE  PV-PREPACK-ERRORS  TO  SU033-PACKS-W-PACK-ERR      02140000
021500     END-IF                                                       02150000
021600                                                                  02160000
021700     PERFORM 7060-FAILURE-ERR.                                    02170000
021800     IF PV-FAILURE-COUNT > ZERO                                   02180000
021900         SET SU033-FAILURE-ERROR-YES  TO TRUE                     02190000
022000     ELSE                                                         02200000
022100         PERFORM 7070-COUNT-ITEM-FAILURES                         02210000
022200     END-IF                                                       02220000
022300                                                                  02230000
022400     IF PV-FAILURE-COUNT > ZERO                                   02240000
022500         SET SU033-FAILURE-ERROR-YES  TO TRUE                     02250000
022600     ELSE                                                         02260000
022700         SET SU033-FAILURE-ERROR-NO   TO TRUE                     02270000
022800     END-IF.                                                      02280000
022900/                                                                 02290000
023000 7000-VENDOR-INFO.                                                02300000
023100                                                                  02310000
023200     MOVE SU031-ENT-ID                TO EXTENT-ENT-ID            02320000
023300                                         SU033-VENDOR-ID          02330000
023400     INITIALIZE ENTNME-ENT-NAME-DESC                              02340000
023500                EXTENT-CFY-SLSRNK-NBR                             02350000
023600                                                                  02360000
023700     EXEC SQL                                                     02370000
023800         SELECT                                                   02380000
023900             NME.ENT_NAME_DESC                                    02390000
024000         ,   ENT.CFY_SLSRNK_NBR                                   02400000
024100         INTO                                                     02410000
024200             :ENTNME-ENT-NAME-DESC                                02420000
024300         ,   :EXTENT-CFY-SLSRNK-NBR                               02430000
024400         FROM                                                     02440000
024500             TENTNME NME                                          02450000
024600         ,   TEXTENT ENT                                          02460000
024700         WHERE                                                    02470000
024800             NME.ENT_ID        = ENT.ENT_ID                       02480000
024900         AND ENT.ENT_ID        = :EXTENT-ENT-ID                   02490000
025000         AND ENT.MDSE_VENDOR_IND  = 'Y'                           02500000
025100         AND ENT.STATUS_CDE       = 'A'                           02510000
025200         AND NME.TYPE_CDE         = '01'                          02520000
025300         WITH UR                                                  02530000
025400     END-EXEC.                                                    02540000
025500                                                                  02550000
025600     EVALUATE TRUE                                                02560000
025700         WHEN SQLCODE = ZERO                                      02570000
025800         WHEN SQLCODE = +100                                      02580000
025900             CONTINUE                                             02590000
026000         WHEN SQLWARN0 NOT = SPACE                                02600000
026100         WHEN SQLCODE  NOT = ZERO                                 02610000
026200             MOVE EXTENT-ENT-ID       TO PV-DISP-NBR              02620000
026300             DISPLAY 'EXTENT-ENT-ID= ' PV-DISP-NBR                02630000
026400             MOVE '7000-VENDOR-INFO'   TO PV-ABEND-PARAGRAPH      02640000
026500             MOVE 'SELECT'             TO PV-ABEND-OPERATION      02650000
026600             MOVE 'TENTNME' TO PV-ABEND-STRUCTURE-1               02660000
026700             MOVE 'TEXTENT' TO PV-ABEND-STRUCTURE-2               02670000
026800             PERFORM 9900-DB2-ABEND                               02680000
026900     END-EVALUATE.                                                02690000
027000/                                                                 02700000
027100 7010-CRTNS-W-PICK-ERR.                                           02710000
027200     MOVE SU033-AUD-CNTL-NBR          TO DK-AUD-CNTL-NBR          02720000
027300                                                                  02730000
027400     EXEC SQL                                                     02740000
027500         SELECT COUNT                                             02750000
027600             (DISTINCT T1.SHIPT_UNT_ID) AS CTN_PICK_ERRORS        02760000
027700                                                                  02770000
027800     INTO                                                         02780000
027900         :SU033-CRTNS-W-PICK-ERR                                  02790000
028000                                                                  02800000
028100     FROM                                                         02810000
028200                                                                  02820000
028300     ( SELECT DISTINCT                                            02830000
028400         UPC.AUD_CNTL_NBR                                         02840000
028500     ,   UPC.SHIPT_UNT_ID                                         02850000
028600     ,   UPC.UPC_NBR                                              02860000
028700    FROM                                                          02870000
028800        TSUAUPC UPC                                               02880000
028900        WHERE UPC.SCN_TYP_CDE  IN ('S','E','O')                   02890000
029000        AND   UPC.AUD_CNTL_NBR =  :DK-AUD-CNTL-NBR                02900000
029100        )  AS T1                                                  02910000
029200                                                                  02920000
029300                                                                  02930000
029400    INNER JOIN                                                    02940000
029500                                                                  02950000
029600    ( SELECT DISTINCT                                             02960000
029700          XCP.AUD_CNTL_NBR                                        02970000
029800       ,  XCP.SHIPT_UNT_ID                                        02980000
029900       ,  XCP.UPC_NBR                                             02990000
030000       ,  XCP.VILN_GP_CDE                                         03000000
030100       ,  XCP.VILN_GP_SEQ_NBR                                     03010000
030200       FROM                                                       03020000
030300        TSUEXCP XCP                                               03030000
030400        WHERE XCP.AUD_CNTL_NBR = :DK-AUD-CNTL-NBR ) AS T2         03040000
030500                                                                  03050000
030600       ON                                                         03060000
030700                                                                  03070000
030800          T1.AUD_CNTL_NBR = T2.AUD_CNTL_NBR                       03080000
030900      AND T1.SHIPT_UNT_ID = T2.SHIPT_UNT_ID                       03090000
031000      AND T1.UPC_NBR      = T2.UPC_NBR                            03100000
031100                                                                  03110000
031200      INNER JOIN                                                  03120000
031300                                                                  03130000
031400      (  SELECT                                                   03140000
031500          VILN.VILN_GP_CDE                                        03150000
031600       ,  VILN.VILN_GP_SEQ_NBR                                    03160000
031700                                                                  03170000
031800        FROM TVILNCD VILN                                         03180000
031900                                                                  03190000
032000        WHERE                                                     03200000
032100            VILN.VILN_GP_CDE  = 'VA'                              03210000
032200        AND VILN.VILN_CTG_CDE = 'P' ) AS T3                       03220000
032300                                                                  03230000
032400        ON                                                        03240000
032500          T3.VILN_GP_CDE        =  T2.VILN_GP_CDE                 03250000
032600     AND  T3.VILN_GP_SEQ_NBR    =  T2.VILN_GP_SEQ_NBR             03260000
032700     WITH UR                                                      03270000
032800                                                                  03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100     EVALUATE TRUE                                                03310000
033200         WHEN SQLCODE = ZERO                                      03320000
033300         WHEN SQLCODE = +100                                      03330000
033400             CONTINUE                                             03340000
033500         WHEN SQLWARN0 NOT = SPACE                                03350000
033600         WHEN SQLCODE  NOT = ZERO                                 03360000
033700             MOVE DK-AUD-CNTL-NBR     TO PV-DISP-NBR              03370000
033800             DISPLAY 'DK-AUD-CNTL-NBR= ' PV-DISP-NBR              03380000
033900             MOVE '7010-CRTNS-W-PICK-ERR'                         03390000
034000                                       TO PV-ABEND-PARAGRAPH      03400000
034100             MOVE 'SELECT'             TO PV-ABEND-OPERATION      03410000
034200             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               03420000
034300             MOVE 'TSUEXCP' TO PV-ABEND-STRUCTURE-2               03430000
034400             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-3               03440000
034500             PERFORM 9900-DB2-ABEND                               03450000
034600     END-EVALUATE.                                                03460000
034700                                                                  03470000
034800                                                                  03480000
034900 7020-UNITS-PICK-ERR.                                             03490000
035000                                                                  03500000
035100     MOVE SU033-AUD-CNTL-NBR          TO DK-AUD-CNTL-NBR          03510000
035200                                                                  03520000
035300     EXEC SQL                                                     03530000
035400           SELECT                                                 03540000
035500                  SUM(A.SCND_UNT_QTY)                             03550000
035600           INTO                                                   03560000
035700                 :SU033-UNITS-PICK-ERR                            03570000
035800           FROM                                                   03580000
035900                  TSUAUPC A                                       03590000
036000                , TSUEXCP B                                       03600000
036100                , TVILNCD C                                       03610000
036200           WHERE                                                  03620000
036300                  A.AUD_CNTL_NBR    =  :DK-AUD-CNTL-NBR           03630000
036400             AND  A.SCN_TYP_CDE    IN  ('S','E','O')              03640000
036500             AND  A.AUD_CNTL_NBR    =  B.AUD_CNTL_NBR             03650000
036510             AND  A.SCN_TMST        =  B.SCN_TMST                 03651000
036600             AND  A.UPC_NBR         =  B.UPC_NBR                  03660000
036700             AND  A.SHIPT_UNT_ID    =  B.SHIPT_UNT_ID             03670000
036800             AND  B.VILN_GP_CDE     =  C.VILN_GP_CDE              03680000
036900             AND  B.VILN_GP_SEQ_NBR =  C.VILN_GP_SEQ_NBR          03690000
037000             AND  C.VILN_GP_CDE     = 'VA'                        03700000
037100             AND  C.VILN_CTG_CDE    = 'P'                         03710000
037200                                                                  03720000
037300     END-EXEC.                                                    03730000
037400                                                                  03740000
037500     EVALUATE TRUE                                                03750000
037600         WHEN SQLCODE = ZERO                                      03760000
037700         WHEN SQLCODE = +100                                      03770000
037800             CONTINUE                                             03780000
037900         WHEN SQLCODE = -305                                      03790000
038000             MOVE ZEROES  TO  SU033-UNITS-PICK-ERR                03800000
038100         WHEN SQLWARN0 NOT = SPACE                                03810000
038200         WHEN SQLCODE  NOT = ZERO                                 03820000
038300             MOVE '7020-UNITS-PICK-ERR'                           03830000
038400                                       TO PV-ABEND-PARAGRAPH      03840000
038500             MOVE DK-AUD-CNTL-NBR      TO PV-DISP-NBR             03850000
038600             DISPLAY 'DK-AUD-CNTL-NBR= ' PV-DISP-NBR              03860000
038700             MOVE 'SELECT'             TO PV-ABEND-OPERATION      03870000
038800             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               03880000
038900             MOVE 'TSUEXCP' TO PV-ABEND-STRUCTURE-2               03890000
039000             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-3               03900000
039100             PERFORM 9900-DB2-ABEND                               03910000
039200     END-EVALUATE.                                                03920000
039300                                                                  03930000
039400                                                                  03940000
039500 7030-UNITS-PACK-ERR.                                             03950000
039600                                                                  03960000
039700     MOVE SU033-AUD-CNTL-NBR          TO DK-AUD-CNTL-NBR          03970000
039800     EXEC SQL                                                     03980000
039900           SELECT                                                 03990000
040000                  SUM(A.SCND_UNT_QTY)                             04000000
040100           INTO                                                   04010000
040200                 :SU033-UNITS-PACK-ERR                            04020000
040300           FROM                                                   04030000
040400                  TSUAUPC A                                       04040000
040500                , TSUEXCP B                                       04050000
040600                , TVILNCD C                                       04060000
040700           WHERE                                                  04070000
040800                  A.AUD_CNTL_NBR    =  :DK-AUD-CNTL-NBR           04080000
040900             AND  A.SCN_TYP_CDE    IN  ('S','E','O')              04090000
041000             AND  A.AUD_CNTL_NBR    =  B.AUD_CNTL_NBR             04100000
041100             AND  A.UPC_NBR         =  B.UPC_NBR                  04110000
041110             AND  A.SCN_TMST        =  B.SCN_TMST                 04111000
041200             AND  A.SHIPT_UNT_ID    =  B.SHIPT_UNT_ID             04120000
041300             AND  B.VILN_GP_CDE     =  C.VILN_GP_CDE              04130000
041400             AND  B.VILN_GP_SEQ_NBR =  C.VILN_GP_SEQ_NBR          04140000
041500             AND  C.VILN_GP_CDE     = 'VA'                        04150000
041600             AND  C.VILN_CTG_CDE    = 'A'                         04160000
041700                                                                  04170000
041800     END-EXEC.                                                    04180000
041900                                                                  04190000
042000     EVALUATE TRUE                                                04200000
042100         WHEN SQLCODE = ZERO                                      04210000
042200         WHEN SQLCODE = +100                                      04220000
042300             CONTINUE                                             04230000
042400         WHEN SQLCODE = -305                                      04240000
042500             MOVE ZEROES  TO  SU033-UNITS-PACK-ERR                04250000
042600         WHEN SQLWARN0 NOT = SPACE                                04260000
042700         WHEN SQLCODE  NOT = ZERO                                 04270000
042800             MOVE '7030-UNITS-PACK-ERR'                           04280000
042900                                       TO PV-ABEND-PARAGRAPH      04290000
043000             MOVE DK-AUD-CNTL-NBR   TO PV-DISP-NBR                04300000
043100             DISPLAY 'DK-AUD-CNTL-NBR= ' PV-DISP-NBR              04310000
043200             MOVE 'SELECT'             TO PV-ABEND-OPERATION      04320000
043300             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               04330000
043400             MOVE 'TSUEXCP' TO PV-ABEND-STRUCTURE-2               04340000
043500             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-3               04350000
043600             PERFORM 9900-DB2-ABEND                               04360000
043700     END-EVALUATE.                                                04370000
043800                                                                  04380000
043900*-----------------------------------------------------------------04390000
044000*  COUNT THE TOTAL NUMBER OF PACK ITEMS   -   'P'                 04400000
044100*-----------------------------------------------------------------04410000
044200 7040-PREPACK-PACKS-AUDITED.                                      04420000
044300                                                                  04430000
044400     MOVE SU033-AUD-CNTL-NBR          TO SUAUPC-AUD-CNTL-NBR      04440000
044500     EXEC SQL                                                     04450000
044600        SELECT COUNT (*) AS X                                     04460000
044700        INTO                                                      04470000
044800             :PV-TOTAL-PACK-ITEMS                                 04480000
044900        FROM                                                      04490000
045000          TSUAUPC        UPC                                      04500000
045100          WHERE                                                   04510000
045200                UPC.AUD_CNTL_NBR = :SUAUPC-AUD-CNTL-NBR           04520000
045300           AND  UPC.SCN_TYP_CDE IN ('P')                          04530000
045400     END-EXEC.                                                    04540000
045500                                                                  04550000
045600     EVALUATE TRUE                                                04560000
045700         WHEN SQLCODE = ZERO                                      04570000
045800             IF PV-TOTAL-PACK-ITEMS > ZERO                        04580000
045900                 PERFORM 7041-COUNT-PREPACKS                      04590000
046000             END-IF                                               04600000
046100         WHEN SQLCODE = +100                                      04610000
046200             CONTINUE                                             04620000
046300         WHEN SQLWARN0 NOT = SPACE                                04630000
046400         WHEN SQLCODE  NOT = ZERO                                 04640000
046500             MOVE '7040-PREPACK-PACKS-AUDITED'                    04650000
046600                                       TO PV-ABEND-PARAGRAPH      04660000
046700             MOVE SUAUPC-AUD-CNTL-NBR   TO PV-DISP-NBR            04670000
046800             DISPLAY 'DK-AUD-CNTL-NBR= ' PV-DISP-NBR              04680000
046900             MOVE 'SELECT'                                        04690000
047000                                       TO PV-ABEND-OPERATION      04700000
047100             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               04710000
047200             PERFORM 9900-DB2-ABEND                               04720000
047300     END-EVALUATE.                                                04730000
047400                                                                  04740000
047500 7041-COUNT-PREPACKS.                                             04750000
047600                                                                  04760000
047700     MOVE SU033-AUD-CNTL-NBR          TO SUAUPC-AUD-CNTL-NBR      04770000
047800     EXEC SQL                                                     04780000
047900        SELECT COUNT (*) AS X                                     04790000
048000        INTO                                                      04800000
048100             :PV-SCAN-PACK-ITEMS                                  04810000
048200        FROM                                                      04820000
048300          TSUAUPC        UPC                                      04830000
048400          WHERE                                                   04840000
048500                UPC.AUD_CNTL_NBR = :SUAUPC-AUD-CNTL-NBR           04850000
048600           AND  UPC.SCN_TYP_CDE  = 'P'                            04860000
048700     END-EXEC.                                                    04870000
048800                                                                  04880000
048900     EVALUATE TRUE                                                04890000
049000         WHEN SQLCODE = ZERO                                      04900000
049100             CONTINUE                                             04910000
049200         WHEN SQLCODE = +100                                      04920000
049300             CONTINUE                                             04930000
049400         WHEN SQLWARN0 NOT = SPACE                                04940000
049500         WHEN SQLCODE  NOT = ZERO                                 04950000
049600             MOVE '7041-COUNT-PREPACKS'                           04960000
049700                                       TO PV-ABEND-PARAGRAPH      04970000
049800             MOVE SUAUPC-AUD-CNTL-NBR   TO PV-DISP-NBR            04980000
049900             DISPLAY 'SUAUPC-AUD-CNTL-NBR= ' PV-DISP-NBR          04990000
050000             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05000000
050100             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               05010000
050200             PERFORM 9900-DB2-ABEND                               05020000
050300     END-EVALUATE.                                                05030000
050400                                                                  05040000
050500 7050-PREPACK-PACKS-ERR.                                          05050000
050600                                                                  05060000
050700     MOVE SU033-AUD-CNTL-NBR          TO CTEXCP-AUD-CNTL-NBR      05070000
050800     EXEC SQL                                                     05080000
050900      SELECT COUNT                                                05090000
051000          (DISTINCT XCP.SHIPT_UNT_ID) AS UNIT_PACK_ERRORS         05100000
051100     INTO                                                         05110000
051200         :PV-PREPACK-ERRORS                                       05120000
051300      FROM                                                        05130000
051400         TCTEXCP XCP                                              05140000
051500      ,  TVILNCD VILN                                             05150000
051600                                                                  05160000
051700          WHERE                                                   05170000
051800                VILN.VILN_GP_CDE      = XCP.VILN_GP_CDE           05180000
051900          AND   VILN.VILN_GP_SEQ_NBR  = XCP.VILN_GP_SEQ_NBR       05190000
052000                                                                  05200000
052100          AND   XCP.AUD_CNTL_NBR      = :CTEXCP-AUD-CNTL-NBR      05210000
052200                                                                  05220000
052300          AND   VILN.VILN_GP_CDE      = 'VA'                      05230000
052400          AND   VILN.VILN_CTG_CDE     = 'A'                       05240000
052500     END-EXEC.                                                    05250000
052600                                                                  05260000
052700     EVALUATE TRUE                                                05270000
052800         WHEN SQLCODE = ZERO                                      05280000
052900              CONTINUE                                            05290000
053000         WHEN SQLCODE = +100                                      05300000
053100             CONTINUE                                             05310000
053200         WHEN SQLWARN0 NOT = SPACE                                05320000
053300         WHEN SQLCODE  NOT = ZERO                                 05330000
053400             MOVE '7050-PREPACK-PACKS-ERR'                        05340000
053500                                       TO PV-ABEND-PARAGRAPH      05350000
053600             MOVE CTEXCP-AUD-CNTL-NBR   TO PV-DISP-NBR            05360000
053700             DISPLAY 'CTEXCP-AUD-CNTL-NBR= ' PV-DISP-NBR          05370000
053800             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05380000
053900             MOVE 'TCTEXCP' TO PV-ABEND-STRUCTURE-1               05390000
054000             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-2               05400000
054100             PERFORM 9900-DB2-ABEND                               05410000
054200     END-EVALUATE.                                                05420000
054300                                                                  05430000
054400 7060-FAILURE-ERR.                                                05440000
054500                                                                  05450000
054600     MOVE ZERO                        TO PV-FAILURE-COUNT         05460000
054700     MOVE SU033-AUD-CNTL-NBR          TO CTEXCP-AUD-CNTL-NBR      05470000
054800                                                                  05480000
054900     EXEC SQL                                                     05490000
055000         SELECT COUNT                                             05500000
055100              (DISTINCT XCP.SHIPT_UNT_ID) AS PACK_FAIL_ERRORS     05510000
055200         INTO                                                     05520000
055300             :PV-FAILURE-COUNT                                    05530000
055400         FROM                                                     05540000
055500             TCTEXCP XCP                                          05550000
055600         ,   TVILNCD VILN                                         05560000
055700                                                                  05570000
055800         WHERE                                                    05580000
055900             VILN.VILN_GP_CDE      = XCP.VILN_GP_CDE              05590000
056000         AND VILN.VILN_GP_SEQ_NBR  = XCP.VILN_GP_SEQ_NBR          05600000
056100                                                                  05610000
056200         AND XCP.AUD_CNTL_NBR      = :CTEXCP-AUD-CNTL-NBR         05620000
056300                                                                  05630000
056400         AND VILN.VILN_GP_CDE      = 'VA'                         05640000
056500         AND VILN.FALR_IND         = 'Y'                          05650000
056600     END-EXEC.                                                    05660000
056700                                                                  05670000
056800     EVALUATE TRUE                                                05680000
056900         WHEN SQLCODE = ZERO                                      05690000
057000         WHEN SQLCODE = +100                                      05700000
057100             CONTINUE                                             05710000
057200         WHEN SQLWARN0 NOT = SPACE                                05720000
057300         WHEN SQLCODE  NOT = ZERO                                 05730000
057400             MOVE '7060-FAILURE-ERR'   TO PV-ABEND-PARAGRAPH      05740000
057500             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05750000
057600             MOVE CTEXCP-AUD-CNTL-NBR   TO PV-DISP-NBR            05760000
057700             DISPLAY 'CTEXCP-AUDIT-CNTL-NBR= ' PV-DISP-NBR        05770000
057800             MOVE 'TCTEXCP' TO PV-ABEND-STRUCTURE-1               05780000
057900             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-2               05790000
058000             PERFORM 9900-DB2-ABEND                               05800000
058100     END-EVALUATE.                                                05810000
058200                                                                  05820000
058300 7070-COUNT-ITEM-FAILURES.                                        05830000
058400                                                                  05840000
058500     MOVE SU033-AUD-CNTL-NBR          TO DK-AUD-CNTL-NBR          05850000
058600                                                                  05860000
058700     EXEC SQL                                                     05870000
058800         SELECT COUNT                                             05880000
058900             (DISTINCT T1.UPC_NBR) AS UNIT_FAIL_ERRORS            05890000
059000                                                                  05900000
059100     INTO                                                         05910000
059200         :PV-FAILURE-COUNT                                        05920000
059300                                                                  05930000
059400     FROM                                                         05940000
059500                                                                  05950000
059600     ( SELECT DISTINCT                                            05960000
059700         UPC.AUD_CNTL_NBR                                         05970000
059800     ,   UPC.UPC_NBR                                              05980000
059900    FROM                                                          05990000
060000        TSUAUPC UPC                                               06000000
060100        WHERE UPC.SCN_TYP_CDE  IN ('S','E','O')                   06010000
060200        AND   UPC.AUD_CNTL_NBR =  :DK-AUD-CNTL-NBR                06020000
060300        )  AS T1                                                  06030000
060400                                                                  06040000
060500                                                                  06050000
060600    INNER JOIN                                                    06060000
060700                                                                  06070000
060800    ( SELECT DISTINCT                                             06080000
060900          XCP.AUD_CNTL_NBR                                        06090000
061000       ,  XCP.UPC_NBR                                             06100000
061100       ,  XCP.VILN_GP_CDE                                         06110000
061200       ,  XCP.VILN_GP_SEQ_NBR                                     06120000
061300       FROM                                                       06130000
061400        TSUEXCP XCP                                               06140000
061500        WHERE XCP.AUD_CNTL_NBR = :DK-AUD-CNTL-NBR ) AS T2         06150000
061600                                                                  06160000
061700       ON                                                         06170000
061800                                                                  06180000
061900          T1.AUD_CNTL_NBR = T2.AUD_CNTL_NBR                       06190000
062000      AND T1.UPC_NBR      = T2.UPC_NBR                            06200000
062100                                                                  06210000
062200      INNER JOIN                                                  06220000
062300                                                                  06230000
062400      (  SELECT                                                   06240000
062500          VILN.VILN_GP_CDE                                        06250000
062600       ,  VILN.VILN_GP_SEQ_NBR                                    06260000
062700                                                                  06270000
062800        FROM TVILNCD VILN                                         06280000
062900                                                                  06290000
063000        WHERE                                                     06300000
063100              VILN.VILN_GP_CDE = 'VA'                             06310000
063200          AND VILN.FALR_IND    = 'Y' ) AS T3                      06320000
063300                                                                  06330000
063400        ON                                                        06340000
063500          T3.VILN_GP_CDE        =  T2.VILN_GP_CDE                 06350000
063600     AND  T3.VILN_GP_SEQ_NBR    =  T2.VILN_GP_SEQ_NBR             06360000
063700     WITH UR                                                      06370000
063800     END-EXEC.                                                    06380000
063900                                                                  06390000
064000     EVALUATE TRUE                                                06400000
064100         WHEN SQLCODE = ZERO                                      06410000
064200         WHEN SQLCODE = +100                                      06420000
064300             CONTINUE                                             06430000
064400         WHEN SQLWARN0 NOT = SPACE                                06440000
064500         WHEN SQLCODE  NOT = ZERO                                 06450000
064600             MOVE '7070-COUNT-ITEM-FAILURES'                      06460000
064700                                       TO PV-ABEND-PARAGRAPH      06470000
064800             MOVE DK-AUD-CNTL-NBR      TO PV-DISP-NBR             06480000
064900             DISPLAY 'DK-AUD-CNTL-NBR= ' PV-DISP-NBR              06490000
065000             MOVE 'SELECT'                                        06500000
065100                                       TO PV-ABEND-OPERATION      06510000
065200             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               06520000
065300             MOVE 'TSUEXCP' TO PV-ABEND-STRUCTURE-2               06530000
065400             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-3               06540000
065500             PERFORM 9900-DB2-ABEND                               06550000
065600     END-EVALUATE.                                                06560000
065700                                                                  06570000
065800 7080-UNITS-TICK-ERR.                                             06580000
065900                                                                  06590000
066000     MOVE SU033-AUD-CNTL-NBR          TO DK-AUD-CNTL-NBR          06600000
                                               PV-DISP-NBR              06601000
           DISPLAY 'THE AUD NBR IS' PV-DISP-NBR                         06602000
066100                                                                  06610000
066200     EXEC SQL                                                     06620000
066300           SELECT                                                 06630000
066400                  SUM(A.SCND_UNT_QTY)                             06640000
066500           INTO                                                   06650000
066600                 :SU033-UNITS-TICK-ERR                            06660000
066700           FROM                                                   06670000
066800                  TSUAUPC A                                       06680000
066900                , TSUEXCP B                                       06690000
067000                , TVILNCD C                                       06700000
067100           WHERE                                                  06710000
067200                  A.AUD_CNTL_NBR    =  :DK-AUD-CNTL-NBR           06720000
067300             AND  A.SCN_TYP_CDE    IN  ('S','E','O')              06730000
067400             AND  A.AUD_CNTL_NBR    =  B.AUD_CNTL_NBR             06740000
067410             AND  A.SCN_TMST        =  B.SCN_TMST                 06741000
067500             AND  A.UPC_NBR         =  B.UPC_NBR                  06750000
067600             AND  A.SHIPT_UNT_ID    =  B.SHIPT_UNT_ID             06760000
067700             AND  B.VILN_GP_CDE     =  C.VILN_GP_CDE              06770000
067800             AND  B.VILN_GP_SEQ_NBR =  C.VILN_GP_SEQ_NBR          06780000
067900             AND  C.VILN_GP_CDE     = 'VA'                        06790000
068000             AND  C.VILN_CTG_CDE    = 'T'                         06800000
068100                                                                  06810000
068200     END-EXEC.                                                    06820000
068300                                                                  06830000
068400     EVALUATE TRUE                                                06840000
068500         WHEN SQLCODE = ZERO                                      06850000
068600         WHEN SQLCODE = +100                                      06860000
068700             CONTINUE                                             06870000
068800         WHEN SQLCODE = -305                                      06880000
068900             MOVE ZEROES  TO  SU033-UNITS-TICK-ERR                06890000
069000         WHEN SQLWARN0 NOT = SPACE                                06900000
069100         WHEN SQLCODE  NOT = ZERO                                 06910000
069200             MOVE '7080-UNITS-TICK-ERR'                           06920000
069300                                       TO PV-ABEND-PARAGRAPH      06930000
069400             MOVE DK-AUD-CNTL-NBR      TO PV-DISP-NBR             06940000
069500             DISPLAY 'DK-AUD-CNTL-NBR= ' PV-DISP-NBR              06950000
069600             MOVE 'SELECT'             TO PV-ABEND-OPERATION      06960000
069700             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               06970000
069800             MOVE 'TSUEXCP' TO PV-ABEND-STRUCTURE-2               06980000
069900             MOVE 'TVILNCD' TO PV-ABEND-STRUCTURE-3               06990000
070000             PERFORM 9900-DB2-ABEND                               07000000
070100     END-EVALUATE.                                                07010000
                                                                        07011000
070200      MOVE SU033-UNITS-TICK-ERR TO PV-DISP-NBR                    07020046
            DISPLAY 'THE TICK ERR' PV-DISP-NBR.                         07020146
                                                                        07020200
      * /*VSH - CN FILE LAYOUT CHANGES                                  07020300
       7093-TICKET-ERROR.                                               07048800
                                                                        07048900
           EXEC SQL                                                     07049000
              SELECT VALUE(COUNT(DISTINCT(A.SCN_TMST)),0)               07049100
                INTO :PV-NBR-TICK-ERRS                                  07049200
                FROM TSUAUPC A                                          07049300
                   , TSUEXCP B                                          07049400
                   , TVILNCD C                                          07049547
               WHERE A.AUD_CNTL_NBR = :SUT00015-RWRK-AUD-CNTL-NBR       07049600
                 AND A.AUD_CNTL_NBR = B.AUD_CNTL_NBR                    07049700
                 AND A.SCN_TMST = B.SCN_TMST                            07049800
                 AND B.VILN_GP_SEQ_NBR = C.VILN_GP_SEQ_NBR              07049947
                 AND  B.VILN_GP_CDE    = C.VILN_GP_CDE                  07050047
                 AND  C.VILN_GP_CDE    = 'VA'                           07050147
                 AND  C.VILN_CTG_CDE   = 'R'                            07050247
           END-EXEC                                                     07050400
070300                                                                  07050500
068400     EVALUATE TRUE                                                07050600
068500         WHEN SQLCODE = ZERO                                      07050700
                    MOVE PV-NBR-TICK-ERRS TO SU033-UNITS-TICK-ERR       07050800
                    MOVE SU033-UNITS-TICK-ERR TO PV-DISP-NBR            07050900
                    DISPLAY 'THE 40, 41' PV-DISP-NBR                    07051000
068600         WHEN SQLCODE = +100                                      07051100
                    MOVE ZERO             TO SU033-UNITS-TICK-ERR       07051200
069000         WHEN SQLWARN0 NOT = SPACE                                07051300
069100         WHEN SQLCODE  NOT = ZERO                                 07051400
069200             MOVE '7093-TICKET-ERROR'                             07051500
069300                                       TO PV-ABEND-PARAGRAPH      07051600
069600             MOVE 'SELECT'             TO PV-ABEND-OPERATION      07051700
069700             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               07051800
070000             PERFORM 9900-DB2-ABEND                               07051900
070100     END-EVALUATE.                                                07052000
                                                                        07052100
           EXEC SQL                                                     07052200
              SELECT VALUE((SUM(SCND_UNT_QTY) - SUM(RFID_TGD_QTY)),0)   07052300
                INTO :PV-NBR-EPC-ERRS                                   07052400
                FROM TSUAUPC A                                          07052500
                   , TSUEXCP B                                          07052600
               WHERE A.AUD_CNTL_NBR = :SUT00015-RWRK-AUD-CNTL-NBR       07052700
                 AND A.AUD_CNTL_NBR = B.AUD_CNTL_NBR                    07052800
                 AND A.SCN_TMST = B.SCN_TMST                            07052900
                 AND B.VILN_GP_SEQ_NBR = 42                             07053000
                 AND SCN_TYP_CDE = 'E'                                  07053100
           END-EXEC                                                     07053200
070300                                                                  07053300
068400     EVALUATE TRUE                                                07053400
068500         WHEN SQLCODE = ZERO                                      07053500
                    COMPUTE SU033-UNITS-TICK-ERR = SU033-UNITS-TICK-ERR 07053600
                        + PV-NBR-EPC-ERRS                               07053700
                    MOVE SU033-UNITS-TICK-ERR TO PV-DISP-NBR            07053800
                    DISPLAY 'THE 40, 41' PV-DISP-NBR                    07053900
               WHEN SQLCODE = 100                                       07054000
                    MOVE ZERO             TO SU033-UNITS-PICK-ERR       07054100
069000         WHEN SQLWARN0 NOT = SPACE                                07054200
069100         WHEN SQLCODE  NOT = ZERO                                 07054300
069200             MOVE '7093-TICKET-ERROR'                             07054400
069300                                       TO PV-ABEND-PARAGRAPH      07054500
069600             MOVE 'SELECT'             TO PV-ABEND-OPERATION      07054600
069700             MOVE 'TSUAUPC' TO PV-ABEND-STRUCTURE-1               07054700
070000             PERFORM 9900-DB2-ABEND                               07054800
070100     END-EVALUATE.                                                07054900
                                                                        07055000
001100* */VSH - CN FILE LAYOUT CHANGES                                  07055100
070200                                                                  07055200
070400 8000-READ-OLD-AUDIT-REC.                                         07055300
070500                                                                  07056000
070600     READ OLD-AUDIT-EXTRACT-FILE INTO                             07060000
070700           SU031-RECORD                                           07070000
070800     AT END                                                       07080000
070900         SET PS-END-EXTRACT           TO TRUE                     07090000
071000     NOT AT END                                                   07100000
071100         ADD 1                        TO PV-READ-COUNT            07110000
071200     END-READ.                                                    07120000
071300                                                                  07130000
071400 8100-WRITE-EXTRACT-REC.                                          07140000
071500                                                                  07150000
071600     ADD 1                         TO PV-WRITE-COUNT              07160000
071700                                                                  07170000
071800     WRITE VIOLATION-EXTRACT-RECORD FROM SU033-RECORD.            07180000
071900/                                                                 07190000
072000 9000-TERMINATE.                                                  07200000
072100                                                                  07210000
072200     CLOSE OLD-AUDIT-EXTRACT-FILE                                 07220000
072300           VIOLATION-EXTRACT-FILE                                 07230000
072400                                                                  07240000
072500     DISPLAY '************************'.                          07250000
072600     DISPLAY '******* SUKUT067 *******'.                          07260000
072700     DISPLAY '************************'.                          07270000
072800     DISPLAY SPACES                                               07280000
072900                                                                  07290000
073000     MOVE PV-READ-COUNT               TO PV-DISP-NBR              07300000
073100     DISPLAY 'OLD AUDIT EXTRACTS READ      = ' PV-DISP-NBR        07310000
073200                                                                  07320000
073300     DISPLAY SPACES                                               07330000
073400     DISPLAY '                                _________'          07340000
073500                                                                  07350000
073600                                                                  07360000
073700     MOVE PV-WRITE-COUNT              TO PV-DISP-NBR              07370000
073800     DISPLAY 'REFORMATTED EXTRACTS WRITTEN = ' PV-DISP-NBR        07380000
073900                                                                  07390000
074000     DISPLAY SPACES                                               07400000
074100     DISPLAY '************************'.                          07410000
074200                                                                  07420000
074300 9900-DB2-ABEND.                                                  07430000
074400                                                                  07440000
074500     MOVE SQLCODE TO PV-SQLCODE.                                  07450000
074600     DISPLAY '*** DB2 ERROR '.                                    07460000
074700     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       07470000
074800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 07480000
074900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               07490000
075000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               07500000
075100     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       07510000
075200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       07520000
075300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       07530000
075400     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             07540000
075500     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2              07550000
075600                                                                  07560000
075700                                                                  07570000
075800     COPY DPPD004.                                                07580000
075900                                                                  07590000
076000     MOVE +4013                  TO PV-ABEND-CODE.                07600000
076100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07610000
076200                                                                  07620000
076300*9200-ABEND.                                                      07630000
076400******************************************************************07640000
076500*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       07650000
076600******************************************************************07660000
076700*    DISPLAY '***************************'.                       07670000
076800*    DISPLAY '**       ABEND           **'.                       07680000
076900*    DISPLAY '**  IN PROGRAM SUKUT067  **'.                       07690000
077000*    DISPLAY '***************************'.                       07700000
077100*    DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07710000
077200*    DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       07720000
077300*    DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       07730000
077400*                                                                 07740000
077500*    MOVE +4014                  TO PV-ABEND-CODE.                07750000
077600*    CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07760000
077700                                                                  07770000
