000100*----------------------------------------------------------------*00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*----------------------------------------------------------------*00030001
000400                                                                  00040001
000500 PROGRAM-ID.    VLKUT065.                                         00050001
000600 AUTHOR.        DENISE HAHN.                                      00060001
000700 INSTALLATION.  KOHLS.                                            00070001
000800 DATE-WRITTEN   MARCH 2021.                                       00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*----------------------------------------------------------------*00110001
001200*  EXTRACT ASN HEADER RECORDS FROM TASNHDR AND TASNORD.          *00120001
001310*  ***  UNAMATCHED PO'S ***                                      *00131001
001320*  EMAIL WILL BE SENT TO EDIMIO TEAM AND LOGISTICSSUPPORT TEAM   *00132001
001400*----------------------------------------------------------------*00140001
001500                                                                  00150001
001600*----------------------------------------------------------------*00160001
001700 ENVIRONMENT DIVISION.                                            00170001
001800*----------------------------------------------------------------*00180001
001900                                                                  00190001
002000 CONFIGURATION SECTION.                                           00200001
002100                                                                  00210001
002200 SOURCE-COMPUTER.        IBM-3090.                                00220001
002300 OBJECT-COMPUTER.        IBM-3090.                                00230001
002400                                                                  00240001
002500 INPUT-OUTPUT SECTION.                                            00250001
002600                                                                  00260001
002700 FILE-CONTROL.                                                    00270001
002800                                                                  00280001
002900     SELECT VL-CNTL-FILE                                          00290001
003000         ASSIGN TO INP01.                                         00300001
003100                                                                  00310001
003200     SELECT EXTRACT-OUT-FILE                                      00320001
003300         ASSIGN TO OUT01.                                         00330001
003400                                                                  00340001
003500*----------------------------------------------------------------*00350001
003600 DATA DIVISION.                                                   00360001
003700*----------------------------------------------------------------*00370001
003800                                                                  00380001
003900 FILE SECTION.                                                    00390001
004000*                                                                 00400001
004100 FD  VL-CNTL-FILE                                                 00410001
004200     RECORDING MODE IS F                                          00420001
004300     LABEL RECORDS ARE STANDARD                                   00430001
004400     BLOCK CONTAINS 0 RECORDS.                                    00440001
004500 01  VL-CNTL-FILE-RECORD            PIC  X(80).                   00450001
004600*                                                                 00460001
004700*                                                                 00470001
004800 FD  EXTRACT-OUT-FILE                                             00480001
004900     RECORDING MODE IS F                                          00490001
005000     BLOCK CONTAINS 0 RECORDS                                     00500001
005100     LABEL RECORDS ARE STANDARD.                                  00510001
005200                                                                  00520001
005300 01  EXTRACT-OUT-RECORD             PIC X(90).                    00530001
005400                                                                  00540001
005500                                                                  00550001
005600*---------------------------------------------------------------* 00560001
005700 WORKING-STORAGE SECTION.                                         00570001
005800*---------------------------------------------------------------* 00580001
005900*                                                                 00590001
006000 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00600001
006100                                                   COMP SYNC.     00610001
006200                                                                  00620001
006300*---------------------------------------------------------------* 00630001
006400*    INPUT CONTROL CARD                                           00640001
006500*---------------------------------------------------------------* 00650001
006600 01  CC-CONTROL-CARD.                                             00660001
006700     05  CC-FROM-TIMESTAMP           PIC X(26)     VALUE SPACES.  00670001
006800     05  FILLER                      PIC X(01)     VALUE SPACES.  00680001
006900     05  CC-TO-TIMESTAMP             PIC X(26)     VALUE SPACES.  00690001
007000     05  FILLER                      PIC X(27)     VALUE SPACES.  00700001
007100                                                                  00710001
007200 01  PC-PROGRAM-CONSTANTS.                                        00720001
007300     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00730001
007400                                                   COMP SYNC.     00740001
007500 01  PS-PROGRAM-SWITCHES.                                         00750001
007600     05  PS-EOF-CNTL-FILE-SW         PIC  X(01)    VALUE 'N'.     00760001
007700         88  PS-EOF-CNTL-FILE                      VALUE 'Y'.     00770001
007800         88  PS-NOT-EOF-CNTL-FILE                  VALUE 'N'.     00780001
007900     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00790001
008000         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00800001
008100         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     00810001
008200                                                                  00820001
008300 01  PV-OUTPUT-HDR-REC.                                           00830001
008400     05  PV-HDR-1                    PIC  X(30)                   00840001
008410         VALUE 'ASNHDR NUMBER                '.                   00841001
008500     05  FILLER                      PIC  X(05)    VALUE SPACE.   00850009
008600     05  PV-HDR-2                    PIC  X(17)                   00860007
008601         VALUE 'PO NUMBER        '.                               00860107
008610     05  FILLER                      PIC  X(01)    VALUE SPACE.   00861001
008620     05  PV-HDR-3                    PIC  X(36)                   00862003
008630         VALUE 'VENDOR NAME                         '.            00863001
008701                                                                  00870101
008702 01  PV-OUTPUT-DTL-REC.                                           00870201
008703     05  PV-DTL-ASNHDR-NBR           PIC  X(30)    VALUE SPACES.  00870301
008704     05  FILLER                      PIC  X(01)    VALUE SPACE.   00870401
008705     05  PV-DTL-PO-NBR               PIC  X(22)    VALUE SPACES.  00870501
008706     05  FILLER                      PIC  X(01)    VALUE SPACE.   00870601
008707     05  PV-DTL-ENT-NAME             PIC  X(36)    VALUE SPACES.  00870701
008708                                                                  00870801
008710 01  PV-PROGRAM-VARIABLES.                                        00871001
008720     05  PV-COUNTER                  PIC S9(09)    VALUE ZERO     00872001
008730                                                   COMP SYNC.     00873001
008740     05  PV-COUNT                    PIC S9(09)    VALUE ZERO.    00874001
008750     05  PV-NULL-IND-1               PIC S9(04)    VALUE ZEROS    00875001
008800                                                    COMP SYNC.    00880001
008900     05  PV-NULL-IND-2               PIC S9(04)    VALUE ZEROS    00890001
009000                                                    COMP SYNC.    00900001
009100     05  PV-NULL-IND-3               PIC S9(04)    VALUE ZEROS    00910001
009200                                                    COMP SYNC.    00920001
009300     05  PV-FROM-TIMESTAMP           PIC X(26)     VALUE SPACES.  00930001
009400     05  PV-TO-TIMESTAMP             PIC X(26)     VALUE SPACES.  00940001
009500     05  PV-DISP-COUNT               PIC ZZZ,ZZZ,ZZ9.             00950001
009600                                                                  00960001
009700                                                                  00970001
009800 01  PV-ABEND-VARIABLES.                                          00980001
009900     05  PV-SQLCODE                  PIC S9(9).                   00990001
010000     05  PV-DISPLAY-SQLCODE          PIC -999.                    01000001
010100     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'VLKUT065'.  01010001
010200     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      01020001
010300     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      01030001
010400     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      01040001
010500     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      01050001
010600     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      01060001
010700     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      01070001
010800     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      01080001
010900     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      01090001
011000     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      01100001
011100                                                                  01110001
011700*---------------------------------------------------------------* 01170001
011800** ASN HEADER                                                   **01180001
011900*---------------------------------------------------------------* 01190001
012000     EXEC SQL                                                     01200001
012100          INCLUDE TASNHDR                                         01210001
012200     END-EXEC.                                                    01220001
012300                                                                  01230001
012400*---------------------------------------------------------------* 01240001
012500*  ASN DETAIL                                                     01250001
012600*---------------------------------------------------------------* 01260001
012700     EXEC SQL                                                     01270001
012800         INCLUDE TASNORD                                          01280001
012900     END-EXEC.                                                    01290001
013000                                                                  01300001
013010*---------------------------------------------------------------* 01301001
013020*  EXTERNAL ENTITY NAME                                           01302001
013030*---------------------------------------------------------------* 01303001
013040     EXEC SQL                                                     01304001
013050         INCLUDE TENTNME                                          01305001
013060     END-EXEC.                                                    01306001
013070                                                                  01307001
013080*---------------------------------------------------------------* 01308001
013090*  EXTERNAL ENTITY                                                01309001
013091*---------------------------------------------------------------* 01309101
013092     EXEC SQL                                                     01309201
013093         INCLUDE TEXTENT                                          01309301
013094     END-EXEC.                                                    01309401
013095                                                                  01309501
013100*---------------------------------------------------------------* 01310001
013200** DB2 FORMATTED MESSAGE AREA                                   **01320001
013300*---------------------------------------------------------------* 01330001
013400     COPY DPWS004.                                                01340001
013500                                                                  01350001
013600*---------------------------------------------------------------* 01360001
013700** COMMUNICATIONS AREA FOR DB2                                  **01370001
013800*---------------------------------------------------------------* 01380001
013900     EXEC SQL                                                     01390001
014000          INCLUDE SQLCA                                           01400001
014100     END-EXEC.                                                    01410001
014200                                                                  01420001
014300*---------------------------------------------------------------* 01430001
014400* ASN CURSOR                                                      01440001
014500*---------------------------------------------------------------* 01450001
014600     EXEC SQL                                                     01460001
014700          DECLARE UNMATCHED-PO-ASN-CSR  CURSOR FOR                01470001
014710            SELECT T1.ASNHDR_NBR                                  01471001
014720                 , T1.PO_NBR                                      01472001
014730                 , T2.ENT_NAME_DESC                               01473001
014740              FROM                                                01474001
014750            (                                                     01475001
014800             SELECT A.ASNHDR_NBR                                  01480001
015200                  , B.PO_NBR                                      01520001
015800               FROM TASNHDR A                                     01580001
015900                  , TASNORD B                                     01590001
016000              WHERE A.ASNHDR_TMST  >=  :PV-FROM-TIMESTAMP         01600001
016100                AND A.ASNHDR_TMST  <=  :PV-TO-TIMESTAMP           01610001
016200                AND A.ASNHDR_ID     =  B.ASNHDR_ID                01620001
016300                AND B.MTCH_PO_CDE   =  'U'                        01630001
016400              ORDER BY A.ASNHDR_NBR                               01640001
016500                     , B.PO_NBR                                   01650001
016600                     , B.LOC_NBR                                  01660001
016601            ) AS T1                                               01660101
016602              LEFT OUTER JOIN                                     01660201
016603            (                                                     01660301
016610             SELECT C.ENT_NAME_DESC                               01661001
016620                  , F.ASNHDR_NBR                                  01662001
016692               FROM TASNHDR F                                     01669201
016694                  , TENTNME C                                     01669401
016695                  , TEXTENT D                                     01669501
016696              WHERE F.ASNHDR_TMST  >=  :PV-FROM-TIMESTAMP         01669604
016697                AND F.ASNHDR_TMST  <=  :PV-TO-TIMESTAMP           01669701
016698                AND C.ENT_ID        = D.ENT_ID                    01669801
016699                AND F.EDI_VEND_ID   = D.DUN_NBR                   01669901
016700                AND C.SEQ_NBR       =                             01670001
016701                        (SELECT MIN(E.SEQ_NBR)                    01670101
016702                           FROM TENTNME E                         01670201
016703                          WHERE C.ENT_ID = E.ENT_ID)              01670301
016707            ) AS T2                                               01670701
016708              ON T1.ASNHDR_NBR = T2.ASNHDR_NBR                    01670801
016720              WITH UR                                             01672001
016800     END-EXEC.                                                    01680001
016900                                                                  01690001
017000                                                                  01700001
017100*---------------------------------------------------------------* 01710001
017200 PROCEDURE DIVISION.                                              01720001
017300*---------------------------------------------------------------* 01730001
017400                                                                  01740001
017500*---------------------------------------------------------------* 01750001
017600* 0000-PROGRAM-MAINLINE                                           01760001
017700*---------------------------------------------------------------* 01770001
017800 0000-PROGRAM-MAINLINE.                                           01780001
017900                                                                  01790001
018000     DISPLAY '* START - VLKUT065'.                                01800001
018100     DISPLAY '*'.                                                 01810001
018200                                                                  01820001
018300     PERFORM 1000-INITIALIZE.                                     01830001
018400                                                                  01840001
018410     IF  PS-NOT-END-OF-CURSOR                                     01841001
018420         PERFORM 8100-WRITE-HEADER.                               01842001
018421                                                                  01842107
018500     PERFORM 2000-PROCESS-ASN-CSR                                 01850001
018600       UNTIL PS-END-OF-CURSOR.                                    01860001
018700                                                                  01870001
018800     DISPLAY  '*'.                                                01880001
018900     MOVE  PV-COUNT   TO  PV-DISP-COUNT.                          01890001
019000     DISPLAY  '* OUTPUT COUNT:'  PV-DISP-COUNT.                   01900001
019100     DISPLAY  ' '.                                                01910001
019200                                                                  01920001
019300     CLOSE VL-CNTL-FILE                                           01930001
019400           EXTRACT-OUT-FILE.                                      01940001
019500                                                                  01950001
019501*    SET RETURN CODE IF E-MAIL SWITCH IS TRUE.                    01950110
019510     IF  PV-COUNT  > 0                                            01951010
019540         MOVE 4050 TO RETURN-CODE                                 01954010
019550     END-IF.                                                      01955010
019560                                                                  01956010
019600     STOP RUN.                                                    01960001
019700                                                                  01970001
019800                                                                  01980001
019900*---------------------------------------------------------------* 01990001
020000*  INITIALIZATION PARAGRAPH                                       02000001
020100*---------------------------------------------------------------* 02010001
020200 1000-INITIALIZE.                                                 02020001
020300                                                                  02030001
020400     OPEN INPUT VL-CNTL-FILE                                      02040001
020500         OUTPUT EXTRACT-OUT-FILE.                                 02050001
020600                                                                  02060001
020700     PERFORM 7000-READ-CNVYR-CNTL-REC.                            02070001
020800                                                                  02080001
020900     MOVE   CC-FROM-TIMESTAMP    TO  PV-FROM-TIMESTAMP.           02090001
021000     MOVE   CC-TO-TIMESTAMP      TO  PV-TO-TIMESTAMP.             02100001
021100                                                                  02110001
021200     SET  PS-NOT-END-OF-CURSOR   TO  TRUE.                        02120001
021300     PERFORM 2050-OPEN-ASN-CSR.                                   02130001
021400     PERFORM 2060-FETCH-ASN-CSR.                                  02140001
021500                                                                  02150001
021600                                                                  02160001
021700*---------------------------------------------------------------* 02170001
021800*  PROCESS CURSOR UNTIL THEN OF FILE                              02180001
021900*---------------------------------------------------------------* 02190001
022000 2000-PROCESS-ASN-CSR.                                            02200001
022100                                                                  02210001
022200     MOVE SPACES                   TO  PV-OUTPUT-DTL-REC.         02220002
022300                                                                  02230001
022310     MOVE ASNHDR-ASNHDR-NBR        TO  PV-DTL-ASNHDR-NBR.         02231001
022330     MOVE ASNORD-PO-NBR            TO  PV-DTL-PO-NBR.             02233001
022350     MOVE ENTNME-ENT-NAME-DESC     TO  PV-DTL-ENT-NAME.           02235001
022360                                                                  02236001
023500     PERFORM 8000-WRITE-OUTPUT-REC.                               02350001
023600                                                                  02360001
023700     PERFORM 2060-FETCH-ASN-CSR.                                  02370001
023800                                                                  02380001
023900                                                                  02390001
024000*---------------------------------------------------------------* 02400001
024100* OPEN ASN CURSOR                                                 02410001
024200*---------------------------------------------------------------* 02420001
024300 2050-OPEN-ASN-CSR.                                               02430001
024400                                                                  02440001
024500     PERFORM WITH TEST AFTER                                      02450001
024600       VARYING PV-COUNTER FROM 1 BY 1                             02460001
024700         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       02470001
024800                OR                                                02480001
024900                SQLCODE = ZERO)                                   02490001
025000                                                                  02500001
025100         EXEC SQL                                                 02510001
025200              OPEN UNMATCHED-PO-ASN-CSR                           02520001
025300         END-EXEC                                                 02530001
025400                                                                  02540001
025500         EVALUATE TRUE                                            02550001
025600             WHEN SQLCODE = +0                                    02560001
025700             WHEN SQLCODE = -904                                  02570001
025800             WHEN SQLCODE = -911                                  02580001
025900             WHEN SQLCODE = -913                                  02590001
026000                 CONTINUE                                         02600001
026100             WHEN SQLWARN0 NOT EQUAL SPACE                        02610001
026200             WHEN SQLCODE NOT EQUAL ZERO                          02620001
026300                 MOVE '2050-OPEN-ASN-CSR'                         02630001
026400                                      TO PV-ABEND-PARAGRAPH       02640001
026500                 MOVE 'ERROR OPENING ASN CURSOR'                  02650001
026600                                      TO PV-ABEND-OPER-MESSAGE-1  02660001
026610                 STRING PV-FROM-TIMESTAMP  '-'                    02661005
026611                        PV-TO-TIMESTAMP  DELIMITED BY SIZE        02661105
026620                                    INTO PV-ABEND-OPER-MESSAGE-2  02662005
026700                 MOVE 'TASNHDR'       TO PV-ABEND-TABLE-1         02670001
026800                 MOVE 'TASNORD'       TO PV-ABEND-TABLE-2         02680001
026900                 PERFORM 9100-SQL-ABEND                           02690001
027000         END-EVALUATE                                             02700001
027100     END-PERFORM.                                                 02710001
027200                                                                  02720001
027300     IF  PV-COUNTER > PC-MAX-RETRIES                              02730001
027400         MOVE '2050-OPEN-ASN-CSR'                                 02740001
027500                                      TO PV-ABEND-PARAGRAPH       02750001
027600         MOVE 'MAX RETRIES ERROR OPENING ASN CURSOR'              02760001
027700                                      TO PV-ABEND-OPER-MESSAGE-1  02770001
027710         STRING PV-FROM-TIMESTAMP  '-'                            02771005
027720                PV-TO-TIMESTAMP          DELIMITED BY SIZE        02772005
027730                                    INTO PV-ABEND-OPER-MESSAGE-2  02773005
027800         MOVE 'TASNHDR'               TO PV-ABEND-TABLE-1         02780001
027900         MOVE 'TASNORD'               TO PV-ABEND-TABLE-2         02790001
028000         PERFORM 9100-SQL-ABEND                                   02800001
028100     END-IF.                                                      02810001
028200                                                                  02820001
028300                                                                  02830001
028400*---------------------------------------------------------------* 02840001
028500* FETCH A ROW FROM THE AUDIT CONTROL GROUP CURSOR.               *02850001
028600*---------------------------------------------------------------* 02860001
028700 2060-FETCH-ASN-CSR.                                              02870001
028800                                                                  02880001
028900     EXEC SQL                                                     02890001
029000          FETCH UNMATCHED-PO-ASN-CSR                              02900001
029100           INTO :ASNHDR-ASNHDR-NBR                                02910001
029110               ,:ASNORD-PO-NBR                                    02911001
029200               ,:ENTNME-ENT-NAME-DESC :PV-NULL-IND-1              02920001
030100     END-EXEC.                                                    03010001
030200                                                                  03020001
030300     EVALUATE TRUE                                                03030001
030400       WHEN SQLCODE = ZERO                                        03040001
030500             IF  PV-NULL-IND-1  =  -1                             03050001
030600                 MOVE SPACES  TO  ENTNME-ENT-NAME-DESC            03060001
030700             END-IF                                               03070001
031400                                                                  03140001
031500       WHEN SQLCODE = +100                                        03150001
031600           SET PS-END-OF-CURSOR      TO TRUE                      03160001
031700                                                                  03170001
031800       WHEN SQLWARN0 NOT EQUAL SPACE                              03180001
031900       WHEN SQLCODE NOT EQUAL ZERO                                03190001
032000           MOVE '2060-FETCH-ASN-CSR'                              03200001
032100                                     TO PV-ABEND-PARAGRAPH        03210001
032200           MOVE 'FETCH ASN CURSOR ROW'                            03220001
032300                                     TO PV-ABEND-OPER-MESSAGE-1   03230001
032310           STRING PV-FROM-TIMESTAMP  '-'                          03231005
032320                  PV-TO-TIMESTAMP        DELIMITED BY SIZE        03232005
032330                                    INTO PV-ABEND-OPER-MESSAGE-2  03233005
032400           MOVE 'TASNHDR'            TO PV-ABEND-TABLE-1          03240001
032500           MOVE 'TASNORD'            TO PV-ABEND-TABLE-2          03250001
032600           PERFORM 9100-SQL-ABEND                                 03260001
032700     END-EVALUATE.                                                03270001
032800                                                                  03280001
032900                                                                  03290001
033000*---------------------------------------------------------------* 03300001
033100* CLOSE THE CONVEYOR VENDOR CURSOR                                03310001
033200*---------------------------------------------------------------* 03320001
033300 2070-CLOSE-ASN-CSR.                                              03330001
033400                                                                  03340001
033500     PERFORM                                                      03350001
033600         WITH TEST AFTER                                          03360001
033700         VARYING PV-COUNTER                                       03370001
033800         FROM 1 BY 1                                              03380001
033900         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     03390001
034000                   OR (SQLCODE = ZERO))                           03400001
034100         EXEC SQL                                                 03410001
034200             CLOSE UNMATCHED-PO-ASN-CSR                           03420001
034300         END-EXEC                                                 03430001
034400                                                                  03440001
034500         EVALUATE TRUE                                            03450001
034600             WHEN SQLCODE = +0                                    03460001
034700             WHEN SQLCODE = -904                                  03470001
034800             WHEN SQLCODE = -911                                  03480001
034900             WHEN SQLCODE = -913                                  03490001
035000                 CONTINUE                                         03500001
035100             WHEN SQLWARN0 NOT EQUAL SPACE                        03510001
035200             WHEN SQLCODE NOT EQUAL ZERO                          03520001
035300                 MOVE '2070-CLOSE-ASN-CSR'                        03530001
035400                                      TO PV-ABEND-PARAGRAPH       03540001
035500                 MOVE 'ERROR CLOSING ASN CURSOR'                  03550001
035600                                      TO PV-ABEND-OPER-MESSAGE-1  03560001
035610                 STRING PV-FROM-TIMESTAMP  '-'                    03561005
035620                        PV-TO-TIMESTAMP  DELIMITED BY SIZE        03562005
035630                                    INTO PV-ABEND-OPER-MESSAGE-2  03563005
035700                 MOVE 'TASNHDR'       TO PV-ABEND-TABLE-1         03570001
035800                 MOVE 'TASNORD'       TO PV-ABEND-TABLE-2         03580001
035900                 PERFORM 9100-SQL-ABEND                           03590001
036000         END-EVALUATE                                             03600001
036100     END-PERFORM.                                                 03610001
036200                                                                  03620001
036300     IF  PV-COUNTER > PC-MAX-RETRIES                              03630001
036400         MOVE '2070-CLOSE-ASN-CSR'                                03640001
036500                                      TO PV-ABEND-PARAGRAPH       03650001
036600         MOVE 'MAX RETRIES ERROR CLOSING ASN CURSOR'              03660001
036700                                      TO PV-ABEND-OPER-MESSAGE-1  03670001
036710         STRING PV-FROM-TIMESTAMP  '-'                            03671005
036720                PV-TO-TIMESTAMP          DELIMITED BY SIZE        03672005
036730                                    INTO PV-ABEND-OPER-MESSAGE-2  03673005
036800         MOVE 'TASNHDR'               TO PV-ABEND-TABLE-1         03680001
036900         MOVE 'TASNORD'               TO PV-ABEND-TABLE-2         03690001
037000         PERFORM 9100-SQL-ABEND                                   03700001
037100     END-IF.                                                      03710001
037200                                                                  03720001
037300                                                                  03730001
037400*----------------------------------------------------------------*03740001
037500*  READ CONTROL RECORD                                            03750001
037600*----------------------------------------------------------------*03760001
037700 7000-READ-CNVYR-CNTL-REC.                                        03770001
037800                                                                  03780001
037900     READ VL-CNTL-FILE                                            03790001
038000         INTO CC-CONTROL-CARD                                     03800001
038100             AT END                                               03810001
038200                 SET PS-EOF-CNTL-FILE TO TRUE.                    03820001
038300                                                                  03830001
038400         DISPLAY '*'.                                             03840001
038500         DISPLAY '* FROM:' CC-FROM-TIMESTAMP.                     03850001
038600         DISPLAY '* TO:  ' CC-TO-TIMESTAMP.                       03860001
038700         DISPLAY '*'.                                             03870001
038800                                                                  03880001
038900                                                                  03890001
039000*----------------------------------------------------------------*03900001
039100*  WRITE OUTPUT RECORD                                            03910001
039200*----------------------------------------------------------------*03920001
039300 8000-WRITE-OUTPUT-REC.                                           03930001
039400                                                                  03940001
039500     WRITE EXTRACT-OUT-RECORD                                     03950001
039600      FROM PV-OUTPUT-DTL-REC.                                     03960006
039700                                                                  03970001
039800     ADD  1  TO  PV-COUNT.                                        03980001
039900                                                                  03990001
039901                                                                  03990101
039902*----------------------------------------------------------------*03990201
039903*  WRITE HEADER RECORD                                            03990301
039904*----------------------------------------------------------------*03990401
039910 8100-WRITE-HEADER.                                               03991001
039911                                                                  03991101
039920     WRITE EXTRACT-OUT-RECORD                                     03992001
039930      FROM PV-OUTPUT-HDR-REC.                                     03993001
039940                                                                  03994001
040000                                                                  04000001
040010                                                                  04001001
040100*----------------------------------------------------------------*04010001
040200*                                                                 04020001
040300*----------------------------------------------------------------*04030001
040400 9100-SQL-ABEND.                                                  04040001
040500     MOVE SQLCODE    TO PV-SQLCODE.                               04050001
040600     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       04060001
040700                                                                  04070001
040800     DISPLAY '9100-SQL-ABEND'.                                    04080001
040900     DISPLAY '** ABEND              **'.                          04090001
041000     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    04100001
041100     DISPLAY '** PROGRAM            ** = ' PV-ABEND-PROGRAM.      04110001
041200     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    04120001
041300     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      04130001
041400     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      04140001
041500     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      04150001
041600     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      04160001
041700     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-104170001
041800     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-204180001
041900     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-304190001
042000     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-404200001
042100     DISPLAY '**                    ** = '                        04210001
042200                                                                  04220001
042300*---------------------------------------------------------------* 04230001
042400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04240001
042500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04250001
042600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04260001
042700* FORMAT.                                                         04270001
042800*---------------------------------------------------------------* 04280001
042900     COPY DPPD004.                                                04290001
043000                                                                  04300001
043100     MOVE +4013                  TO ABEND-CODE.                   04310001
043200     CALL 'ILBOABN0' USING ABEND-CODE.                            04320001
