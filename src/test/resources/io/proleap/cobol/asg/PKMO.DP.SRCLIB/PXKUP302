       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.           PXKUP302.                                  00020000
       AUTHOR.               R. KELLEN                                  00030000
       INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040000
       DATE-WRITTEN          07/13/2009.                                00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      *   PXKUP302 - POPULATE PRICE CHANGE SETUP TABLES FOR USE BY THE  00090000
      *              'HOURLY' PROCESS TO TRACK EACH STORES' COMPLIANCE  00100000
      *              DURING A PRICE CHANGE EVENT.THE TABLES TO BE       00110000
      *              LOADED ARE PXT_EVNT_CMPLIN_WND AND                 00120000
      *              PXT_EVNT_RFRSH_PRC.                                00130000
      *                                                                 00140000
      *              THE PXT_EVNT_CMPLIN_WND TABLE CONTAINS ACTIVE      00150000
      *              EVENTS AND THERE EFFECTIVE WINDOW (EFF BEG AND     00160000
      *              EFF END DATES).                                    00170000
      *                                                                 00180000
      *              THE PXT_EVNT_RFRSH_PRC TABLE CONTAINS THE STATUS   00190000
      *              OF EACH 'HOURLY' EVENT EXTRACT. THIS TABLE IS      00200000
      *              LOADED WITH 5 TIME DEFINED ROWS EACH DAY FOR EACH  00210000
      *              ACTIVE EVENT AND AS EACH OF THE 5 EXTRACTS ARE     00220000
      *              PERFORMED DURING THE DAY A NEW ROW IS INSERTED     00230000
      *              INTO THIS TABLE WITH A 'PRC' STATUS SO THE         00240000
      *              WEB APP KNOWS TO USE THE MOST CURRENT SET OF DATA. 00250000
      *              THE ROWS INSERTED BY THIS PGM ARE INSERTED WITH AN 00260000
      *              'UNP' STATUS.                                      00270000
      *                                                                 00280000
      ******************** HISTORY OF CHANGES **************************00290000
      * CHG ID/                                                        *00300000
      * WR/PROJ          DATE        DESCRIPTION OF CHANGES            *00310000
      * ---------------  ----------  --------------------------------  *00320000
      *  WR33500         07/13/2009  NEW PROGRAM                       *00330000
      *                                                                *00340000
      *  WR33394         06/16/2010  CHANGE TO ALLOW WHITE TICKET      *00350000
      *                              EVENTS TO BE PROCESSED IN         *00360000
      *                              COMPLIANCE SYSTEM.                *00370000
      *  CHG0215757      01/21/2018  MODIFIED THE PROGRAM TO           *00380001
      *                              EXTERNALIZE ORACLE LOGON          *00381001
      *                              CHANGES TAGGED TO CHG757          *00382001
      ******************************************************************00390000
                                                                        00400000
       ENVIRONMENT DIVISION.                                            00410000
                                                                        00420000
       CONFIGURATION SECTION.                                           00430000
                                                                        00440000
       SOURCE-COMPUTER. IBM-3090.                                       00450000
       OBJECT-COMPUTER. IBM-3090.                                       00460000
                                                                        00470000
       INPUT-OUTPUT SECTION.                                            00480000
       FILE-CONTROL.                                                    00490000
CHG757     SELECT ORACLE-LOGON-FILE                                     00500001
CHG757         ASSIGN TO ORALOGON.                                      00510001
                                                                        00520000
                                                                        00530000
       DATA DIVISION.                                                   00540000
                                                                        00550000
       FILE SECTION.                                                    00560000
CHG757 FD  ORACLE-LOGON-FILE                                            00570001
CHG757     RECORDING MODE IS F                                          00580001
CHG757     LABEL RECORDS ARE STANDARD                                   00590001
CHG757     BLOCK CONTAINS 0 RECORDS                                     00600001
CHG757     RECORD CONTAINS 80 CHARACTERS                                00610001
CHG757     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00620001
CHG757 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   00630001
                                                                        00640000
       WORKING-STORAGE SECTION.                                         00650000
                                                                        00660000
      *----------------------------------------------------------       00670000
      *                      DATA BASE DECLARATIONS                     00680000
      *==========================================================       00690000
      *----------------------------------------------------------       00700000
      * COBOL DECLARATION FOR TABLE K_PX01.PXT_EVNT_CMPLIN_WND          00710000
      *==========================================================       00720000
       01  PXT00017.                                                    00730000
           10  PXT00017-EVNT-CDE                       PIC X(3).        00740000
           10  PXT00017-EVNT-DTE                       PIC X(19).       00750000
           10  PXT00017-EVNT-WND-STRT-DTE              PIC X(19).       00760000
           10  PXT00017-EVNT-WND-END-DTE               PIC X(19).       00770000
      *----------------------------------------------------------       00780000
      * COBOL DECLARATION FOR TABLE K_PX01.PXT_EVNT_RFRSH_PRC           00790000
      *==========================================================       00800000
       01  PXT00018.                                                    00810000
           10  PXT00018-EVNT-CDE                       PIC X(3).        00820000
           10  PXT00018-EVNT-DTE                       PIC X(19).       00830000
           10  PXT00018-EVNT-CMPLIN-EFF-DTE            PIC X(19).       00840000
           10  PXT00018-CMPLIN-DISP-TM                 PIC X(19).       00850000
           10  PXT00018-CRE-TMST                       PIC X(19).       00860000
           10  PXT00018-RFRSH-PRC-STAT-CDE             PIC X(3).        00870000
      *----------------------------------------------------------       00880000
      * COBOL DECLARATION FOR TABLE K_PX01.PXT_CMPLIN_TM_CNTL           00890000
      *==========================================================       00900000
       01  PXT00020.                                                    00910000
           10  PXT00020-CMPLIN-DISP-TM                 PIC X(19).       00920000
           10  PXT00020-EFF-BEG-DTE                    PIC X(19).       00930000
           10  PXT00020-LAST-UPD-TMST                  PIC X(19).       00940000
           10  PXT00020-RFRSH-PRC-STRT-TM              PIC X(19).       00950000
           10  PXT00020-EFF-END-DTE                    PIC X(19).       00960000
      *----------------------------------------------------------       00970000
      * COBOL DECLARATION FOR TABLE K_PX01.PXT_EVNT                     00980000
      *==========================================================       00990000
       01  PXT00006.                                                    01000000
           10  PXT00006-EVNT-CDE                       PIC X(3).        01010000
           10  PXT00006-EVNT-DTE                       PIC X(19).       01020000
           10  PXT00006-LAST-SNPSHT-TMST               PIC X(19).       01030000
           10  PXT00006-EVNT-STAT-CDE                  PIC X(1).        01040000
           10  PXT00006-LAST-UPD-TMST                  PIC X(19).       01050000
           10  PXT00006-LAST-UPD-ASSOC-LID             PIC X(11).       01060000
           10  PXT00006-DAYS-FR-EVNT-NBR               PIC S9(2) COMP-3.01070000
      ***************************************************************** 01080000
      *  PROGRAM'S CONSTANTS                                          * 01090000
      ***************************************************************** 01100000
       01  PC-PROGRAM-CONSTANTS.                                        01110000
           05  PC-MAX-DEADLOCKS            PIC S9(04)      VALUE +3.    01120000
           05  PC-PROGRAM-NAME             PIC X(08)       VALUE        01130000
               'PXKUP302'.                                              01140000
           05  PC-ORACLE-PROD-ID           PIC X(1)        VALUE '/'.   01150000
           05  PC-ORACLE-PROD-ID-LGTH      PIC 9(02)       VALUE 1.     01160000
                                                                        01170000
CHG757     05  PC-AUTO-LOGON                PIC X(1)       VALUE '/'.   01180001
                                                                        01190000
CHG757 01  CC-ORACLE-CONNECTION.                                        01200001
CHG757     05  CC-ORACLE-USERID             PIC X(40).                  01210001
CHG757         88 CC-AUTO-LOGON                            VALUE '/'.   01220001
CHG757     05  CC-ORACLE-PASSWORD           PIC X(40).                  01230001
      ***************************************************************** 01240000
      *  PROGRAM'S SWITCHES                                           * 01250000
      ***************************************************************** 01260000
       01  PS-PROGRAM-SWITCHES.                                         01270000
           05  PS-ROW-FOUND-SW             PIC X(01)       VALUE 'N'.   01280000
               88  PS-ROW-FOUND                            VALUE 'Y'.   01290000
               88  PS-ROW-NOT-FOUND                        VALUE 'N'.   01300000
           05  PS-OPERATION-ATTEMPTED      PIC X(40)       VALUE SPACES.01310000
               88  PS-COMMIT-MSG                           VALUE        01320000
                   'COMMIT FAILED                           '.          01330000
               88  PS-ORA-LOGIN-MSG                        VALUE        01340000
                   'ORACLE LOGIN FAILED                     '.          01350000
           05  PS-END-OF-LOGON-FILE-SW     PIC  X(01)      VALUE 'N'.   01360000
               88 PS-END-OF-LOGON-FILE                     VALUE 'Y'.   01370000
           05  PS-ORA-SRC-CTL-DONE-SW      PIC  X(01)      VALUE 'N'.   01380000
               88  PS-ORA-SRC-EMPTY                        VALUE 'Y'.   01390000
                                                                        01400000
      ***************************************************************** 01410000
      *  PROGRAM'S VARIABLES                                          * 01420000
      ***************************************************************** 01430000
       01  PV-PROGRAM-VARIABLES.                                        01440000
           05  PV-PARAGRAPH-NAME           PIC X(40)   VALUE SPACES.    01450000
           05  PV-EVENT-WND-BEG-DTE        PIC X(19)   VALUE SPACES.    01460000
           05  PV-EVENT-WND-END-DTE        PIC X(19)   VALUE SPACES.    01470000
           05  PV-DISP-TM-MAX-ENTRIES      PIC 9(03)   VALUE ZEROES.    01480000
           05  PV-DISP-TM-SUB              PIC 9(03)   VALUE ZEROES.    01490000
CHG757     05  PV-ORACLE-USERID-LEN        PIC S9(4)   VALUE ZEROS      01500001
CHG757                                                 COMP SYNC.       01510001
CHG757     05  PV-ORACLE-PASSWORD-LEN      PIC S9(4)   VALUE ZEROS      01520001
CHG757                                                 COMP SYNC.       01530001
                                                                        01540000
       01  PV-DISP-TM-TAB.                                              01550000
           05  PV-DISP-TM                  PIC X(26) OCCURS 10 TIMES.   01560000
      ***************************************************************** 01570000
      *  ABEND CODE AREA                                              * 01580000
      ***************************************************************** 01590000
       01  ABEND-CODE                      PIC S9(04)  VALUE +0  COMP.  01600000
           88  ABEND-4013-DB-ERROR                     VALUE +4013.     01610000
           88  ABEND-4014-ORACLE-LOGON-ERROR           VALUE +4014.     01620000
           88  AC-NO-CONTROL-CARD                      VALUE +4002.     01630000
           88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     01640000
           88  AC-ORACLE-BAD-LOGON-4004                VALUE +4004.     01650000
                                                                        01660000
       01  WS-MSG-TEXT                     PIC X(512)      VALUE SPACES.01670000
       01  WS-MAX-SIZE                     PIC S9(09)      VALUE +512   01680000
                               COMP.                                    01690000
       01  WS-MSG-LENGTH                   PIC S9(09)      VALUE ZEROES 01700000
                               COMP.                                    01710000
                                                                        01720000
      ******************************************************************01730000
      *    ORACLE DECLARE SECTION                                       01740000
      ******************************************************************01750000
      *    EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01760000
                                                                        01770000
       01  PV-ORACLE-ID                    PIC  X(01)  VALUE '/'.       01780000
       01  USERNAME                        PIC X(10)      VARYING.      01790000
       01  PASSWD                          PIC X(10)      VARYING.      01800000
                                                                        01810000
                                                                        01820000
      * ORA COMMUNICATION AREA                                          01830000
      *                                                                 01840000
        01       SQLCA.                                                 01850000
                 05  SQLCAID               PIC X(8).                    01860000
                 05  SQLCABC               PIC S9(9) COMPUTATIONAL.     01870000
                 05  SQLCODE               PIC S9(9) COMPUTATIONAL.     01880000
                 05  SQLERRM.                                           01890000
                     49 SQLERRML           PIC S9(4) COMPUTATIONAL.     01900000
                     49 SQLERRMC           PIC X(70).                   01910000
                 05  SQLERRP               PIC X(8).                    01920000
                 05  SQLERRD OCCURS 6 TIMES                             01930000
                                           PIC S9(9) COMPUTATIONAL.     01940000
                 05  SQLWARN.                                           01950000
                     10 SQLWARN0           PIC X(1).                    01960000
                     10 SQLWARN1           PIC X(1).                    01970000
                     10 SQLWARN2           PIC X(1).                    01980000
                     10 SQLWARN3           PIC X(1).                    01990000
                     10 SQLWARN4           PIC X(1).                    02000000
                     10 SQLWARN5           PIC X(1).                    02010000
                     10 SQLWARN6           PIC X(1).                    02020000
                     10 SQLWARN7           PIC X(1).                    02030000
                 05  SQLEXT                PIC X(8).                    02040000
      ******************************************************************02050000
      * ORA COMMUNICATION AREA2                                         02060000
           COPY SQLCA2.                                                 02070000
                                                                        02080000
      *    EXEC SQL END DECLARE SECTION END-EXEC.                       02090000
       PROCEDURE DIVISION.                                              02100000
                                                                        02110000
      ******************************************************************02120000
      *    MAINLINE LOGIC                                              *02130000
      ******************************************************************02140000
                                                                        02150000
       0000-MAINLINE.                                                   02160000
                                                                        02170000
           PERFORM 1000-INITIALIZATION.                                 02180000
                                                                        02190000
      * PROCESS TO LOAD THE PXT_EVNT_CMPLIN_WND TABLE                   02200000
           PERFORM 7000-DCL-EVENT-CUR.                                  02210000
           PERFORM 7100-OPN-EVENT-CUR.                                  02220000
           SET PS-ROW-NOT-FOUND TO TRUE.                                02230000
           PERFORM 7200-FET-EVENT-CUR.                                  02240000
                                                                        02250000
           PERFORM 2000-PROCESS-CMPLIN-WND                              02260000
               UNTIL PS-ROW-NOT-FOUND.                                  02270000
           PERFORM 7300-CLS-EVENT-CUR.                                  02280000
                                                                        02290000
           PERFORM 9000-COMMIT-CHANGES.                                 02300000
                                                                        02310000
      * PROCESS TO LOAD THE PXT_EVNT_RFRSH_PRC  TABLE                   02320000
           PERFORM 7400-DCL-CMPLIN-WND-CUR                              02330000
           PERFORM 7500-OPN-CMPLIN-WND-CUR                              02340000
           SET PS-ROW-NOT-FOUND TO TRUE.                                02350000
           PERFORM 7600-FET-CMPLIN-WND-CUR                              02360000
                                                                        02370000
           PERFORM 2100-PROCESS-RFRSH-PRC                               02380000
               UNTIL PS-ROW-NOT-FOUND.                                  02390000
           PERFORM 7700-CLS-CMPLIN-WND-CUR                              02400000
                                                                        02410000
           PERFORM 9000-COMMIT-CHANGES.                                 02420000
                                                                        02430000
           GOBACK.                                                      02440000
                                                                        02450000
                                                                        02460000
      ******************************************************************02470000
      *    LOGON TO ORACLE, AND DECLARE THE ORACLE CURSORS.            *02480000
      ******************************************************************02490000
       1000-INITIALIZATION.                                             02500000
                                                                        02510000
CHG757     OPEN INPUT  ORACLE-LOGON-FILE.                               02520001
CHG757     DISPLAY 'ORACLE FILE READ'.                                  02530001
CHG757     PERFORM 8500-READ-ORACLE-LOGON.                              02540001
CHG757     DISPLAY 'ORACLE FILE CLOSE'.                                 02550001
CHG757     CLOSE ORACLE-LOGON-FILE.                                     02560001
CHG757     IF ((PS-END-OF-LOGON-FILE)                                   02570001
CHG757              OR (CC-ORACLE-CONNECTION = SPACES))                 02580001
CHG757           DISPLAY '** ABEND **'                                  02590001
CHG757           DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '02600001
CHG757               'NOT PROVIDED'                                     02610001
CHG757           SET PS-ORA-SRC-EMPTY TO TRUE                           02620001
CHG757           CALL 'ILBOABN0' USING ABEND-CODE                       02630001
CHG757     END-IF.                                                      02640001
CHG757                                                                  02650001
CHG757         IF CC-AUTO-LOGON                                         02660001
CHG757             DISPLAY PC-PROGRAM-NAME  ' - AUTO LOGON TO ORACLE'   02670001
CHG757             EXEC SQL                                             02680001
CHG757               CONNECT  :PC-AUTO-LOGON                            02690001
CHG757             END-EXEC                                             02700001
CHG757     ELSE                                                         02710001
CHG757         INITIALIZE PV-ORACLE-USERID-LEN                          02720001
CHG757                    PV-ORACLE-PASSWORD-LEN                        02730001
CHG757           INSPECT    CC-ORACLE-USERID                            02740001
CHG757             TALLYING   PV-ORACLE-USERID-LEN                      02750001
CHG757             FOR CHARACTERS BEFORE INITIAL SPACE                  02760001
CHG757           INSPECT    CC-ORACLE-PASSWORD                          02770001
CHG757             TALLYING   PV-ORACLE-PASSWORD-LEN                    02780001
CHG757             FOR CHARACTERS BEFORE INITIAL SPACE                  02790001
CHG757         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO        02800001
CHG757                    USERNAME-ARR                                  02810001
CHG757         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                02820001
CHG757         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    02830001
CHG757                      PASSWD-ARR                                  02840001
CHG757         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                02850001
CHG757           DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER ' 02860001
CHG757                      USERNAME-ARR                                02870001
CHG757            EXEC SQL                                              02880001
CHG757                 CONNECT :USERNAME IDENTIFIED BY :PASSWD          02890001
CHG757            END-EXEC                                              02900001
CHG757         INITIALIZE CC-ORACLE-PASSWORD                            02910001
CHG757                    PASSWD                                        02920001
CHG757     END-IF.                                                      02930001
CHG757                                                                  02940001
CHG757         IF SQLCODE NOT = 0                                       02950001
CHG757            DISPLAY '** CONNECTING TO ORACLE BY USERID **'        02960001
CHG757            DISPLAY 'TRIED TO CONNECT TO ORACLE UNDER: '          02970001
CHG757                                  PASSWD                          02980001
CHG757            SET AC-ORACLE-BAD-LOGON-4004 TO TRUE                  02990001
CHG757               PERFORM Z100-ABEND                                 03000001
CHG757         END-IF.                                                  03010001
CHG757                                                                  03020001
           EXEC SQL                                                     03030000
               SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DDHH24:MI:SS')          03040000
               INTO :PV-EVENT-WND-BEG-DTE                               03050000
               FROM DUAL                                                03060000
           END-EXEC.                                                    03070000
                                                                        03080000
           EXEC SQL                                                     03090000
               SELECT TO_CHAR(SYSDATE + 12, 'YYYY-MM-DDHH24:MI:SS')     03100000
               INTO :PV-EVENT-WND-END-DTE                               03110000
               FROM DUAL                                                03120000
           END-EXEC.                                                    03130000
                                                                        03140000
           MOVE SPACE TO PV-DISP-TM(1)                                  03150000
                         PV-DISP-TM(2)                                  03160000
                         PV-DISP-TM(3)                                  03170000
                         PV-DISP-TM(4)                                  03180000
                         PV-DISP-TM(5)                                  03190000
                         PV-DISP-TM(6)                                  03200000
                         PV-DISP-TM(7)                                  03210000
                         PV-DISP-TM(8)                                  03220000
                         PV-DISP-TM(9)                                  03230000
                         PV-DISP-TM(10).                                03240000
           PERFORM 7800-DCL-CMPLIN-TM-WND.                              03250000
           PERFORM 7900-OPN-CMPLIN-TM-WND.                              03260000
           PERFORM 8000-FET-CMPLIN-WND-CUR.                             03270000
           SET PS-ROW-FOUND TO TRUE.                                    03280000
           PERFORM UNTIL PS-ROW-NOT-FOUND                               03290000
             ADD 1 TO PV-DISP-TM-SUB                                    03300000
             MOVE PV-EVENT-WND-BEG-DTE(1:10)                            03310000
                  TO PV-DISP-TM (PV-DISP-TM-SUB)(1:10)                  03320000
             MOVE PXT00020-CMPLIN-DISP-TM (11:9)                        03330000
                  TO PV-DISP-TM(PV-DISP-TM-SUB)(11:9)                   03340000
             PERFORM 8000-FET-CMPLIN-WND-CUR                            03350000
           END-PERFORM                                                  03360000
           PERFORM 8100-CLS-CMPLIN-TM-CSR.                              03370000
           MOVE PV-DISP-TM-SUB TO PV-DISP-TM-MAX-ENTRIES.               03380000
                                                                        03390000
      ******************************************************************03400000
      *    2000-PROCESS-CMPLIN-WND.                                    *03410000
      ******************************************************************03420000
       2000-PROCESS-CMPLIN-WND.                                         03430000
                                                                        03440000
           MOVE PXT00006-EVNT-CDE TO           PXT00017-EVNT-CDE.       03450000
           MOVE PXT00006-EVNT-DTE TO           PXT00017-EVNT-DTE.       03460000
      *  COLS PXT00017-EVNT-WND-STRT-DTE AND PXT00017-EVNT-WND-END-DTE  03470000
      *  ARE SELECTED IN THE FETCH DONE IN 7200-FET-EVENT-CUR.          03480000
           PERFORM 8150-INS-EVNT-CMPLIN-WND.                            03490000
           PERFORM 7200-FET-EVENT-CUR.                                  03500000
                                                                        03510000
      ******************************************************************03520000
      *    2100-PROCESS-RFRSH-PRC.                                     *03530000
      ******************************************************************03540000
       2100-PROCESS-RFRSH-PRC.                                          03550000
           MOVE 1 TO PV-DISP-TM-SUB.                                    03560000
           PERFORM UNTIL                                                03570000
             PV-DISP-TM-SUB > PV-DISP-TM-MAX-ENTRIES                    03580000
             MOVE PV-DISP-TM (PV-DISP-TM-SUB) TO                        03590000
                 PXT00018-CMPLIN-DISP-TM                                03600000
                 PXT00018-EVNT-CMPLIN-EFF-DTE                           03610000
             MOVE '00.00.00' TO PXT00018-EVNT-CMPLIN-EFF-DTE (12:8)     03620000
             MOVE PXT00017-EVNT-CDE TO  PXT00018-EVNT-CDE               03630000
             MOVE PXT00017-EVNT-DTE TO  PXT00018-EVNT-DTE               03640000
             PERFORM 8200-INS-EVNT-RFRSH-PRC                            03650000
             ADD 1 TO PV-DISP-TM-SUB                                    03660000
           END-PERFORM.                                                 03670000
           PERFORM 7600-FET-CMPLIN-WND-CUR.                             03680000
                                                                        03690000
      ******************************************************************03700000
      *  DECLARE EVENT CURSOR                                           03710000
      *  THIS CURSOR SELECTS ONLY NEW EVENT ROWS TO BE ADDED TO THE     03720000
      *  PXT_EVNT_CMPLIN_WND TABLE. IT IS POSSIBLE THAT NO ROWS ARE     03730000
      *  SELECTED, WHICH MEANS ALL CURRENT EVENTS HAVE ALREADY BEEN     03740000
      *  INSERTED.                                                      03750000
      ******************************************************************03760000
       7000-DCL-EVENT-CUR.                                              03770000
                                                                        03780000
           MOVE '7000-DCL-EVENT-CUR.' TO PV-PARAGRAPH-NAME.             03790000
                                                                        03800000
           EXEC SQL                                                     03810000
            DECLARE EVENT_CUR CURSOR FOR                                03820000
            SELECT  EVNT_CDE                                            03830000
                   ,EVNT_DTE                                            03840000
                   ,EVNT_DTE                                            03850000
                   ,EVNT_DTE + (DAYS_FR_EVNT_NBR - 1)                   03860000
            FROM PXT_EVNT  A                                            03870000
            WHERE EVNT_DTE BETWEEN (SYSDATE - DAYS_FR_EVNT_NBR)         03880000
                  AND SYSDATE + 1                                       03890000
              AND EVNT_STAT_CDE = 'A'                                   03900000
              AND EVNT_CDE IN                                           03910000
                ('001','002','003','004','005','006','007','008','009') 03920000
              AND NOT EXISTS                                            03930000
             (SELECT 'Y'                                                03940000
              FROM PXT_EVNT_CMPLIN_WND B                                03950000
              WHERE B.EVNT_CDE = A.EVNT_CDE                             03960000
                AND TO_CHAR(B.EVNT_DTE,'YYYY.MM.DD')                    03970000
                      = TO_CHAR(A.EVNT_DTE,'YYYY.MM.DD'))               03980000
           END-EXEC.                                                    03990000
                                                                        04000000
           EVALUATE TRUE                                                04010000
               WHEN SQLCODE = 0                                         04020000
                   CONTINUE                                             04030000
               WHEN OTHER                                               04040000
                   DISPLAY 'BAD DECLARE CALL PARA 7000-' SQLCODE        04050000
                   PERFORM 9990-SQL-ERROR                               04060000
           END-EVALUATE.                                                04070000
                                                                        04080000
      ******************************************************************04090000
      *  OPEN EVENT CURSOR                                              04100000
      ******************************************************************04110000
       7100-OPN-EVENT-CUR.                                              04120000
                                                                        04130000
           MOVE '7100-OPN-EVENT-CUR'          TO PV-PARAGRAPH-NAME.     04140000
                                                                        04150000
           EXEC SQL                                                     04160000
              OPEN EVENT_CUR                                            04170000
           END-EXEC.                                                    04180000
                                                                        04190000
           EVALUATE TRUE                                                04200000
               WHEN SQLCODE = 0                                         04210000
                   CONTINUE                                             04220000
               WHEN OTHER                                               04230000
                   DISPLAY 'BAD OPEN CALL PARA 7100-' SQLCODE           04240000
                   PERFORM 9990-SQL-ERROR                               04250000
           END-EVALUATE.                                                04260000
                                                                        04270000
      ******************************************************************04280000
      *  FETCH EVENT CURSOR                                             04290000
      ******************************************************************04300000
       7200-FET-EVENT-CUR.                                              04310000
                                                                        04320000
           MOVE '7200-FET-EVENT-CUR'          TO PV-PARAGRAPH-NAME.     04330000
                                                                        04340000
           EXEC SQL                                                     04350000
             FETCH EVENT_CUR                                            04360000
              INTO :PXT00006-EVNT-CDE                                   04370000
                  ,:PXT00006-EVNT-DTE                                   04380000
                  ,:PXT00017-EVNT-WND-STRT-DTE                          04390000
                  ,:PXT00017-EVNT-WND-END-DTE                           04400000
           END-EXEC.                                                    04410000
                                                                        04420000
           EVALUATE TRUE                                                04430000
               WHEN SQLCODE = 0                                         04440000
                   SET PS-ROW-FOUND       TO TRUE                       04450000
               WHEN SQLCODE = 1403                                      04460000
                   SET PS-ROW-NOT-FOUND       TO TRUE                   04470000
               WHEN OTHER                                               04480000
                   DISPLAY 'BAD FETCH CALL PARA 7200-' SQLCODE          04490000
                   PERFORM 9990-SQL-ERROR                               04500000
           END-EVALUATE.                                                04510000
                                                                        04520000
      ******************************************************************04530000
      *  CLOSE EVENT CURSOR                                             04540000
      ******************************************************************04550000
       7300-CLS-EVENT-CUR.                                              04560000
                                                                        04570000
           MOVE '7300-CLS-EVENT-CUR'          TO PV-PARAGRAPH-NAME.     04580000
                                                                        04590000
           EXEC SQL                                                     04600000
             CLOSE EVENT_CUR                                            04610000
           END-EXEC.                                                    04620000
                                                                        04630000
           EVALUATE TRUE                                                04640000
               WHEN SQLCODE = 0                                         04650000
                   CONTINUE                                             04660000
               WHEN OTHER                                               04670000
                   DISPLAY 'BAD CLOSE CALL PARA 7300-' SQLCODE          04680000
                   PERFORM 9990-SQL-ERROR                               04690000
           END-EVALUATE.                                                04700000
                                                                        04710000
      ******************************************************************04720000
      *  DECLARE EVNT_CMPLIN_WND CURSOR                                 04730000
      ******************************************************************04740000
       7400-DCL-CMPLIN-WND-CUR.                                         04750000
                                                                        04760000
           MOVE '7400-DCL-CMPLIN-WND-CUR' TO PV-PARAGRAPH-NAME.         04770000
                                                                        04780000
           EXEC SQL                                                     04790000
              DECLARE EVNT_CMPLIN_WND CURSOR FOR                        04800000
              SELECT EVNT_CDE                                           04810000
                    ,EVNT_DTE                                           04820000
                    ,EVNT_CMPLIN_WND_STRT_DTE                           04830000
                    ,EVNT_CMPLIN_WND_END_DTE                            04840000
              FROM PXT_EVNT_CMPLIN_WND                                  04850000
              WHERE TO_CHAR(SYSDATE,'YYYY.MM.DD') BETWEEN               04860000
                    TO_CHAR(EVNT_CMPLIN_WND_STRT_DTE - 1,'YYYY.MM.DD')  04870000
                AND TO_CHAR(EVNT_CMPLIN_WND_END_DTE,'YYYY.MM.DD')       04880000
           END-EXEC.                                                    04890000
           EVALUATE TRUE                                                04900000
               WHEN SQLCODE = 0                                         04910000
                   CONTINUE                                             04920000
               WHEN OTHER                                               04930000
                   DISPLAY 'BAD DECLARE CALL PARA 7400-' SQLCODE        04940000
                   PERFORM 9990-SQL-ERROR                               04950000
           END-EVALUATE.                                                04960000
                                                                        04970000
      ******************************************************************04980000
      *  OPEN EVNT_CMPLIN_WND CURSOR                                    04990000
      ******************************************************************05000000
       7500-OPN-CMPLIN-WND-CUR.                                         05010000
                                                                        05020000
           MOVE '7500-OPN-CMPLIN-WND-CUR'     TO PV-PARAGRAPH-NAME.     05030000
                                                                        05040000
           EXEC SQL                                                     05050000
              OPEN EVNT_CMPLIN_WND                                      05060000
           END-EXEC.                                                    05070000
                                                                        05080000
           EVALUATE TRUE                                                05090000
               WHEN SQLCODE = 0                                         05100000
                   CONTINUE                                             05110000
               WHEN OTHER                                               05120000
                   DISPLAY 'BAD OPEN CALL PARA 7500-' SQLCODE           05130000
                   PERFORM 9990-SQL-ERROR                               05140000
           END-EVALUATE.                                                05150000
                                                                        05160000
      ******************************************************************05170000
      *  FETCH EVNT_CMPLIN_WND CURSOR                                   05180000
      ******************************************************************05190000
       7600-FET-CMPLIN-WND-CUR.                                         05200000
                                                                        05210000
           MOVE '7600-FET-CMPLIN-WND-CUR' TO PV-PARAGRAPH-NAME.         05220000
                                                                        05230000
           EXEC SQL                                                     05240000
             FETCH EVNT_CMPLIN_WND                                      05250000
              INTO :PXT00017-EVNT-CDE                                   05260000
                  ,:PXT00017-EVNT-DTE                                   05270000
                  ,:PXT00017-EVNT-WND-STRT-DTE                          05280000
                  ,:PXT00017-EVNT-WND-END-DTE                           05290000
           END-EXEC.                                                    05300000
                                                                        05310000
           EVALUATE TRUE                                                05320000
               WHEN SQLCODE = 0                                         05330000
                   SET PS-ROW-FOUND       TO TRUE                       05340000
               WHEN SQLCODE = 1403                                      05350000
                   SET PS-ROW-NOT-FOUND       TO TRUE                   05360000
               WHEN OTHER                                               05370000
                   DISPLAY 'BAD FETCH CALL PARA 7600-' SQLCODE          05380000
                   PERFORM 9990-SQL-ERROR                               05390000
           END-EVALUATE.                                                05400000
                                                                        05410000
      ******************************************************************05420000
      *  CLOSE EVNT_CMPLIN_WND CURSOR                                   05430000
      ******************************************************************05440000
       7700-CLS-CMPLIN-WND-CUR.                                         05450000
                                                                        05460000
           MOVE '7700-CLS-CMPLIN-WND-CUR'     TO PV-PARAGRAPH-NAME.     05470000
                                                                        05480000
           EXEC SQL                                                     05490000
             CLOSE EVNT_CMPLIN_WND                                      05500000
           END-EXEC.                                                    05510000
                                                                        05520000
           EVALUATE TRUE                                                05530000
               WHEN SQLCODE = 0                                         05540000
                   CONTINUE                                             05550000
               WHEN OTHER                                               05560000
                   DISPLAY 'BAD CLOSE CALL PARA 7700- ' SQLCODE         05570000
                   PERFORM 9990-SQL-ERROR                               05580000
           END-EVALUATE.                                                05590000
                                                                        05600000
      ******************************************************************05610000
      *  DECLARE CMPLIN_TM_WND CURSOR                                   05620000
      ******************************************************************05630000
       7800-DCL-CMPLIN-TM-WND.                                          05640000
                                                                        05650000
           MOVE '7800-DCL-CMPLIN-TM-WND' TO PV-PARAGRAPH-NAME.          05660000
                                                                        05670000
           EXEC SQL                                                     05680000
             DECLARE CMPLIN_TM_WND CURSOR FOR                           05690000
             SELECT CMPLIN_DISP_TM                                      05700000
             FROM PXT_CMPLIN_TM_CNTL                                    05710000
             WHERE EFF_BEG_DTE <= SYSDATE                               05720000
               AND (EFF_END_DTE >= SYSDATE                              05730000
                OR  EFF_END_DTE IS NULL)                                05740000
           END-EXEC.                                                    05750000
                                                                        05760000
           EVALUATE TRUE                                                05770000
               WHEN SQLCODE = 0                                         05780000
                   CONTINUE                                             05790000
               WHEN OTHER                                               05800000
                   DISPLAY 'BAD DECLARE CALL PARA 7800-' SQLCODE        05810000
                   PERFORM 9990-SQL-ERROR                               05820000
           END-EVALUATE.                                                05830000
                                                                        05840000
      ******************************************************************05850000
      *  OPEN CMPLIN-TM-WND CURSOR                                      05860000
      ******************************************************************05870000
       7900-OPN-CMPLIN-TM-WND.                                          05880000
                                                                        05890000
           MOVE '7900-OPN-CMPLIN-TM-WND'     TO PV-PARAGRAPH-NAME.      05900000
                                                                        05910000
           EXEC SQL                                                     05920000
              OPEN CMPLIN_TM_WND                                        05930000
           END-EXEC.                                                    05940000
                                                                        05950000
           EVALUATE TRUE                                                05960000
               WHEN SQLCODE = 0                                         05970000
                   CONTINUE                                             05980000
               WHEN OTHER                                               05990000
                   DISPLAY 'BAD OPEN CALL PARA 7900-' SQLCODE           06000000
                   PERFORM 9990-SQL-ERROR                               06010000
           END-EVALUATE.                                                06020000
                                                                        06030000
      ******************************************************************06040000
      *  FETCH CMPLIN-TM-WND CURSOR                                     06050000
      ******************************************************************06060000
       8000-FET-CMPLIN-WND-CUR.                                         06070000
                                                                        06080000
           MOVE '8000-FET-CMPLIN-TM-WND' TO PV-PARAGRAPH-NAME.          06090000
                                                                        06100000
           EXEC SQL                                                     06110000
               FETCH CMPLIN_TM_WND                                      06120000
                INTO :PXT00020-CMPLIN-DISP-TM                           06130000
           END-EXEC.                                                    06140000
                                                                        06150000
           EVALUATE TRUE                                                06160000
               WHEN SQLCODE = 0                                         06170000
                 CONTINUE                                               06180000
               WHEN SQLCODE = 1403                                      06190000
                   SET PS-ROW-NOT-FOUND       TO TRUE                   06200000
               WHEN OTHER                                               06210000
                   DISPLAY 'BAD FETCH CALL PARA 8000-' SQLCODE          06220000
                   PERFORM 9990-SQL-ERROR                               06230000
           END-EVALUATE.                                                06240000
                                                                        06250000
      ******************************************************************06260000
      *  CLOSE CMPLIN-TM-WND CURSOR                                     06270000
      ******************************************************************06280000
       8100-CLS-CMPLIN-TM-CSR.                                          06290000
                                                                        06300000
           MOVE '8100-CLS-CMPLIN-TM-CSR'     TO PV-PARAGRAPH-NAME.      06310000
                                                                        06320000
           EXEC SQL                                                     06330000
             CLOSE CMPLIN_TM_WND                                        06340000
           END-EXEC.                                                    06350000
                                                                        06360000
           EVALUATE TRUE                                                06370000
               WHEN SQLCODE = 0                                         06380000
                   CONTINUE                                             06390000
               WHEN OTHER                                               06400000
                   DISPLAY 'BAD CLOSE CALL PARA 8000-' SQLCODE          06410000
                   PERFORM 9990-SQL-ERROR                               06420000
           END-EVALUATE.                                                06430000
                                                                        06440000
      ******************************************************************06450000
      *  INSERT PXT_EVNT_CMPLIN_WND                                     06460000
      ******************************************************************06470000
       8150-INS-EVNT-CMPLIN-WND.                                        06480000
                                                                        06490000
           MOVE '8150-INS-EVNT-CMPLIN-WND' TO  PV-PARAGRAPH-NAME.       06500000
           EXEC SQL                                                     06510000
               INSERT INTO PXT_EVNT_CMPLIN_WND                          06520000
               (EVNT_CDE                                                06530000
               ,EVNT_DTE                                                06540000
               ,EVNT_CMPLIN_WND_STRT_DTE                                06550000
               ,EVNT_CMPLIN_WND_END_DTE)                                06560000
               VALUES                                                   06570000
               (:PXT00017-EVNT-CDE                                      06580000
               ,:PXT00017-EVNT-DTE                                      06590000
               ,:PXT00017-EVNT-WND-STRT-DTE                             06600000
               ,:PXT00017-EVNT-WND-END-DTE)                             06610000
                                                                        06620000
           END-EXEC.                                                    06630000
                                                                        06640000
           EVALUATE TRUE                                                06650000
               WHEN SQLCODE = 0                                         06660000
                 CONTINUE                                               06670000
               WHEN SQLCODE = 00001                                     06680000
                 DISPLAY 'EVENT EXISTS ON PXT_EVNT_CMPLIN_WND TABLE - ' 06690000
                 PXT00017-EVNT-CDE ' - ' PXT00017-EVNT-DTE              06700000
               WHEN OTHER                                               06710000
                   DISPLAY 'BAD INSERT CALL PARA 8100-' SQLCODE         06720000
                   DISPLAY 'INS KEY - ' PXT00017-EVNT-CDE               06730000
                                        PXT00017-EVNT-DTE               06740000
                   PERFORM 9990-SQL-ERROR                               06750000
           END-EVALUATE.                                                06760000
                                                                        06770000
      ******************************************************************06780000
      *  INSERT PXT_EVNT_RFRSH_PRC                                      06790000
      ******************************************************************06800000
       8200-INS-EVNT-RFRSH-PRC.                                         06810000
                                                                        06820000
           MOVE '8200-INS-EVNT-RFRSH-PRC' TO  PV-PARAGRAPH-NAME.        06830000
           EXEC SQL                                                     06840000
             INSERT INTO PXT_EVNT_RFRSH_PRC                             06850000
               (EVNT_CDE                                                06860000
               ,EVNT_DTE                                                06870000
               ,EVNT_CMPLIN_EFF_DTE                                     06880000
               ,CMPLIN_DISP_TM                                          06890000
               ,CRE_TMST                                                06900000
               ,RFRSH_PRC_STAT_CDE)                                     06910000
             VALUES                                                     06920000
               (:PXT00018-EVNT-CDE                                      06930000
               ,:PXT00018-EVNT-DTE                                      06940000
               ,:PXT00018-EVNT-CMPLIN-EFF-DTE                           06950000
               ,:PXT00018-CMPLIN-DISP-TM                                06960000
               ,SYSDATE                                                 06970000
               ,'UNP')                                                  06980000
           END-EXEC.                                                    06990000
                                                                        07000000
           EVALUATE TRUE                                                07010000
               WHEN SQLCODE = 0                                         07020000
                 CONTINUE                                               07030000
               WHEN OTHER                                               07040000
                   DISPLAY 'BAD INSERT CALL PARA 8200-' SQLCODE         07050000
                   PERFORM 9990-SQL-ERROR                               07060000
           END-EVALUATE.                                                07070000
                                                                        07080000
CHG757****************************************************************  07090001
CHG757* LOGON TO ORACLE                                                 07100001
CHG757****************************************************************  07110001
CHG757 8500-READ-ORACLE-LOGON.                                          07120001
CHG757                                                                  07130001
CHG757     READ ORACLE-LOGON-FILE                                       07140001
CHG757         INTO CC-ORACLE-CONNECTION                                07150001
CHG757         AT END                                                   07160001
CHG757             SET PS-END-OF-LOGON-FILE TO TRUE                     07170001
CHG757     END-READ.                                                    07180001
CHG757                                                                  07190001
      ******************************************************************07200000
      * COMMIT CHANGES.                                                 07210000
      ******************************************************************07220000
       9000-COMMIT-CHANGES.                                             07230000
                                                                        07240000
           EXEC SQL                                                     07250000
               COMMIT                                                   07260000
           END-EXEC.                                                    07270000
                                                                        07280000
           IF SQLCODE = 0                                               07290000
               DISPLAY 'COMMIT COMPLETED'                               07300000
           ELSE                                                         07310000
               MOVE  '9000-COMMIT-CHANGES    ' TO PV-PARAGRAPH-NAME     07320000
               SET PS-COMMIT-MSG               TO TRUE                  07330000
               PERFORM 9990-SQL-ERROR                                   07340000
           END-IF.                                                      07350000
                                                                        07360000
      ******************************************************************07370000
      * DISPLAYS ERRORS ENCOUNTERED ON SQL REQUEST                      07380000
      ******************************************************************07390000
       9990-SQL-ERROR.                                                  07400000
                                                                        07410000
           MOVE SQLCODE    TO SQLCODE2.                                 07420000
           MOVE SQLERRD(3) TO SQLERRD3.                                 07430000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   07440000
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           07450000
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         07460000
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07470000
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07480000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   07490000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  07500000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                07510000
           DISPLAY '** OPERATION      ** = ' PS-OPERATION-ATTEMPTED.    07520000
                                                                        07530000
           MOVE SPACES TO WS-MSG-TEXT.                                  07540000
      *    GET FULL TEXT OF ERROR MESSAGE                               07550000
                                                                        07560000
           CALL 'SQLGLM' USING WS-MSG-TEXT,                             07570000
                               WS-MAX-SIZE,                             07580000
                               WS-MSG-LENGTH.                           07590000
           DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               07600000
                                                                        07610000
           EXEC SQL                                                     07620000
               ROLLBACK WORK RELEASE                                    07630000
           END-EXEC.                                                    07640000
                                                                        07650000
           SET ABEND-4013-DB-ERROR  TO TRUE.                            07660000
                                                                        07670000
           PERFORM Z100-ABEND.                                          07680000
                                                                        07690000
      *-----------------------------------------------------------      07700000
      * Z100-ABEND                                                      07710000
      *  - PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE              07720000
      *-----------------------------------------------------------      07730000
       Z100-ABEND.                                                      07740000
                                                                        07750000
           DISPLAY '                       '.                           07760000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   07770000
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           07780000
           DISPLAY '** SQLCODE        ** = ' SQLCODE.                   07790000
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                07800000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   07810000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  07820000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                07830000
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         07840000
           DISPLAY '                       '.                           07850000
                                                                        07860000
           CALL 'ILBOABN0' USING ABEND-CODE.                            07870000
                                                                        07880000
      ******************************************************************07890000
      *    END OF SOURCE CODE FOR PXKUP302                             *07900000
      ******************************************************************07910000
