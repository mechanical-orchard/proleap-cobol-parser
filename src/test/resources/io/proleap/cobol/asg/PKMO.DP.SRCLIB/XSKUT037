000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030000
000400 PROGRAM-ID.    XSKUT037.                                         00040006
000500 AUTHOR.        ALEXIS KEIKER.                                    00050000
000600 DATE-WRITTEN.  JANUARY 27, 2002.                                 00060000
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900*            PRICE DETERMINATION CALLED MODULE                    00090000
001000*----------------------------------------------------------       00100000
001100* THIS PROGRAM WILL BE CALLED BY XSKUT035 AND ACCEPT IN           00110000
001110* A LINKAGE SECTION.  THIS LINKAGE SECTION WILL HAVE              00120000
001120* A CERTAIN ITEM THAT NEEDS THE PRICE DETERMINED PRICE.           00130000
001130* THIS PROGRAM WILL FOLLOW THE PRICE DETERMINATION RULES          00140000
001131* TO PICK THE CORRECT SIMPLE NON-GROUP PROMOTION, THE             00150000
001132* GROUP PROMOTION, AND THE TIERED PROMOTION.  ONCE THE            00160000
001133* PROGRAM HAS FOUND THIS INFORMATION IT WILL EXIT AND             00170000
001134* RETURN THE INFORMATION BACK TO XSKUT035.                        00180000
001135*----------------------------------------------------------       00190000
001136* HISTORY LOG:                                                    00200000
001137*                                                                 00210000
001138*----------------------------------------------------------       00220000
      * DATE:         10/07/2003                                        00230001
      * WR/IR#:       WR21428                                           00240000
      * PROGRAMMER:   JODY TAINTER                                      00250001
      * DESCRIPTION:  COPIED XSKUT036 TO CREATE THIS VERSION.  THIS     00260001
      * WILL BE THE NON-CICS REAL TIME PDE.                             00270001
      *                                                                 00280000
      *----------------------------------------------------------       00290000
      * DATE:         10/29/2003                                        00300002
      * WR/IR#:       P000603068                                        00310002
      * PROGRAMMER:   JODY TAINTER                                      00320002
      * DESCRIPTION:  FIX TO XSPD001 GROUP PRICING.                     00330002
      *                                                                 00340002
      *----------------------------------------------------------       00350003
      * DATE:         12/29/2003                                        00360003
      * WR/IR#:       P000619089                                        00370003
      * PROGRAMMER:   JODY TAINTER                                      00380003
      * DESCRIPTION:  FIX TO ROUNDING ERROR IN FIELD PV-PERCENT-VAL     00390003
      *               FIELD NEEDS TO BE S9(7)V9(5) LENGTH INORDER       00400003
      *               TO CALCULATE GOLDSTAR CORRECTLY.                  00410003
      *                                                                 00420003
W26114*----------------------------------------------------------       00430004
W26114* DATE:         01/16/2004                                        00440004
W26114* WR/IR#:       WR26114                                           00450004
W26114* PROGRAMMER:   NANCY MARTIN                                      00460004
W26114* DESCRIPTION:  MODIFIED PROGRAM TO ACCOMODATE NEW BOGO CODES     00470004
W26114*               OF GBP & GBD.                                     00480004
W26114*                                                                 00490004
      *----------------------------------------------------------       00500003
001139* DATE:                                                           00510000
001140* WR/IR#:                                                         00520000
001141* PROGRAMMER:                                                     00530000
001142* DESCRIPTION:                                                    00540000
001143*                                                                 00550000
001150*----------------------------------------------------------       00560000
001160 ENVIRONMENT DIVISION.                                            00570000
001170*----------------------------------------------------------       00580000
001180 CONFIGURATION SECTION.                                           00590000
001190 SOURCE-COMPUTER. IBM-3090.                                       00600000
001200 OBJECT-COMPUTER. IBM-3090.                                       00610000
001300                                                                  00620000
001500                                                                  00630000
001700                                                                  00640000
001800*----------------------------------------------------------       00650000
001900 DATA DIVISION.                                                   00660000
002000*----------------------------------------------------------       00670000
002200                                                                  00680000
002300                                                                  00690000
002400*---------------------------------------------------------        00700000
002500                                                                  00710000
002600 WORKING-STORAGE SECTION.                                         00720000
002700*---------------------------------------------------------        00730000
002800* PC- PROGRAM CONSTANTS                                           00740000
002900*----------------------------------------------------------       00750000
003000 01  PC-PROGRAM-CONSTANTS.                                        00760000
003100     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT037'. 00770006
003200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00780000
003210     05  PC-SUB-ONE                   PIC S9(02) VALUE +01.       00790000
003300                                                                  00800000
003400*----------------------------------------------------------       00810000
003500* PS- PROGRAM SWITCHES                                            00820000
003600*----------------------------------------------------------       00830000
003700 01  PS-PROGRAM-SWITCHES.                                         00840000
003800     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       00850000
003900         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       00860000
004000         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       00870000
004010     05  PS-PROMO-ID-FOUND-SW         PIC X(01)  VALUE 'Y'.       00880000
004020         88  PS-PROMO-ID-FOUND                   VALUE 'N'.       00890000
004030         88  PS-PROMO-ID-NOT-FOUND               VALUE 'Y'.       00900000
004040     05  PS-GP-PRC-CHECK-SW           PIC X(01)  VALUE 'Y'.       00910000
004050         88  PS-GP-PRC-WINS                      VALUE 'N'.       00920000
004060         88  PS-SMPL-PRC-WINS                    VALUE 'Y'.       00930000
004100                                                                  00940000
004200*----------------------------------------------------------       00950000
004300* PV- PROGRAM VARIABLES                                           00960000
004400*----------------------------------------------------------       00970000
004500 01 PV-PROGRAM-VARIABLES.                                         00980000
004600    05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.    00990000
004610    05  PV-TABLE-SIZE                PIC 9(05) VALUE 0.           01000000
004611    05  PV-PROMO-ID                  PIC S9(10)V VALUE +0 COMP-3. 01010000
004611    05  PV-PROMO-INTFC-ID            PIC S9(10)V VALUE +0 COMP-3. 01020000
004611    05  PV-PROMO-MDSE-LNE-ID         PIC S9(10)V VALUE +0 COMP-3. 01030000
004612    05  PV-AD-VERSION                PIC S9(4) VALUE +0 COMP.     01040000
004613    05  PV-PERCENT-VAL               PIC S9(07)V9(05)             01050003
004614                                               VALUE +0 COMP-3.   01060000
004617    05  PV-PRICE-DET-PRC             PIC S9(07)V9(02)             01070000
004618                                                 VALUE +0 COMP-3. 01080000
004619    05  PV-GP-INDV-GP-PRC            PIC S9(07)V9(02)             01090000
004620                                                 VALUE +0 COMP-3. 01100000
004619    05  PV-BOGO-INDV-PRC             PIC S9(07)V9(02)             01110000
004620                                                 VALUE +0 COMP-3. 01120000
004621    05  PV-RGLR-PRICE                PIC S9(07)V9(02)             01130000
004622                                                 VALUE +0 COMP-3. 01140000
004623    05  PV-PRICG-TYP-CDE             PIC X(03) VALUE SPACES.      01150000
004630        88  PV-TIERED                          VALUES 'TAP',      01160000
004640                                                      'TQP'.      01170000
004650        88  PV-SIMPLE                          VALUES 'SPO',      01180000
004660                          'SRP', 'SPP', 'CPO', 'CPP', 'MPP'.      01190000
004670        88  PV-GROUP-PRICG                     VALUES 'GAO'.      01200000
004670        88  PV-BOGO                            VALUES 'GBL',      01210004
W26114                                               'GBD', 'GBP'.      01220004
004700    05  PV-TIERED-DATA.                                           01230000
004800        10 PV-TIERED-PROMO-ID        PIC S9(10)V VALUE +0 COMP-3. 01240000
004900        10 PV-TIERED-PROMO-INTFC-ID  PIC S9(10)V VALUE +0 COMP-3. 01250000
004900        10 PV-TIERED-MDSE-LNE-ID     PIC S9(10)V VALUE +0 COMP-3. 01260000
005000        10 PV-TIERED-STRT-DTE        PIC X(26) VALUE SPACES.      01270000
005100        10 PV-TIERED-END-DTE         PIC X(26) VALUE SPACES.      01280000
005200        10 PV-TIERED-PRICG-TYP-CDE   PIC X(03) VALUE SPACES.      01290000
005300        10 PV-TIERED-MRCH-HEIR-CDE   PIC X(03) VALUE SPACES.      01300000
005310                                                                  01310000
005400    05  PV-FINAL-SMPL-PRICG.                                      01320000
005401        10  PV-SMPL-PRC-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 01330000
005402        10  PV-SMPL-INTFC-ID         PIC S9(10)V VALUE +0 COMP-3. 01340000
005402        10  PV-SMPL-MDSE-LNE-ID      PIC S9(10)V VALUE +0 COMP-3. 01350000
005403        10  PV-SMPL-STRT-DTE         PIC X(26) VALUE SPACES.      01360000
005404        10  PV-SMPL-END-DTE          PIC X(26) VALUE SPACES.      01370000
005410        10  PV-SMPL-PRC-TYP-CDE      PIC X(03) VALUE SPACES.      01380000
005420        10  PV-SMPL-HEIR-CDE         PIC X(03) VALUE SPACES.      01390000
005500        10  PV-SMPL-PRC-DET-PRICE    PIC S9(07)V9(02)             01400000
005600                                               VALUE +0 COMP-3.   01410000
008200                                                                  01420000
005400    05  PV-FINAL-BOGO-PRICG.                                      01430000
005401        10  PV-BOGO-PRC-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 01440000
005402        10  PV-BOGO-PRC-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 01450000
005402        10  PV-BOGO-PRC-MDSE-LNE-ID  PIC S9(10)V VALUE +0 COMP-3. 01460000
005403        10  PV-BOGO-PRC-STRT-DTE     PIC X(26) VALUE SPACES.      01470000
005404        10  PV-BOGO-PRC-END-DTE      PIC X(26) VALUE SPACES.      01480000
005410        10  PV-BOGO-PRC-TYP-CDE      PIC X(03) VALUE SPACES.      01490000
W26114        10  PV-BOGO-DISC-QTY         PIC S9(04)  COMP VALUE +0.   01500005
W26114        10  PV-BOGO-DISC-AMT         PIC S9(07)V9(03)             01510005
W26114                                           VALUE +0 COMP-3.       01520005
008200                                                                  01530000
008201    05  PV-FINAL-GP-PRICG.                                        01540000
008202        10  PV-GP-PRC-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3. 01550000
008203        10  PV-GP-PRC-INTFC-ID       PIC S9(10)V VALUE +0 COMP-3. 01560000
008203        10  PV-GP-PRC-MDSE-LNE-ID    PIC S9(10)V VALUE +0 COMP-3. 01570000
008204        10  PV-GP-PRC-STRT-DTE       PIC X(26) VALUE SPACES.      01580000
008205        10  PV-GP-PRC-END-DTE        PIC X(26) VALUE SPACES.      01590000
008206        10  PV-GP-PRC-TYP-CDE        PIC X(03) VALUE SPACES.      01600000
008207        10  PV-GP-PRC-HEIR-CDE       PIC X(03) VALUE SPACES.      01610000
008208        10  PV-GP-PRC-QTY            PIC S9(04) VALUE +0 COMP.    01620000
008209        10  PV-GP-PRC-DLR            PIC S9(07)V9(02)             01630000
008210                                               VALUE +0 COMP-3.   01640000
008211        10  PV-GP-PRC-IDV-PRICE      PIC S9(07)V9(02)             01650000
008212                                               VALUE +0 COMP-3.   01660000
008213                                                                  01670000
008214    05  PV-FINAL-PRICING.                                         01680000
008215        10  PV-FINAL-PRC-DET-PRC     PIC S9(07)V9(02)             01690000
008216                                               VALUE +0 COMP-3.   01700000
008217        10  PV-FINAL-PRC-TYP-CDE     PIC X(03) VALUE SPACES.      01710000
008218        10  PV-FINAL-DET-PROMO-ID    PIC S9(10)V VALUE +0 COMP-3. 01720000
008218        10  PV-FINAL-DET-INTFC-ID    PIC S9(10)V VALUE +0 COMP-3. 01730000
008218        10  PV-FINAL-DET-MDSE-LNE-ID PIC S9(10)V VALUE +0 COMP-3. 01740000
008204        10  PV-FINAL-PD-STRT-DTE     PIC X(26) VALUE SPACES.      01750000
008205        10  PV-FINAL-PD-END-DTE      PIC X(26) VALUE SPACES.      01760000
008219        10  PV-FINAL-GP-QTY          PIC S9(04) VALUE +0 COMP.    01770000
008220        10  PV-FINAL-GP-DLR          PIC S9(07)V9(02)             01780000
008221                                               VALUE +0 COMP-3.   01790000
008222        10  PV-FINAL-GP-IDV-PRC      PIC S9(07)V9(02)             01800000
008223                                               VALUE +0 COMP-3.   01810000
008224        10  PV-FINAL-GP-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 01820000
008224        10  PV-FINAL-GP-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 01830000
008224        10  PV-FINAL-GP-MDSE-LNE-ID  PIC S9(10)V VALUE +0 COMP-3. 01840000
008204        10  PV-FINAL-GP-STRT-DTE     PIC X(26) VALUE SPACES.      01850000
008205        10  PV-FINAL-GP-END-DTE      PIC X(26) VALUE SPACES.      01860000
008225        10  PV-FINAL-GP-TYP-CDE      PIC X(03) VALUE SPACES.      01870000
008226        10  PV-FINAL-LWST-SIX-PRC    PIC S9(07)V9(02)             01880000
008227                                               VALUE +0 COMP-3.   01890000
008232                                                                  01900000
008233*----------------------------------------------------------       01910000
008234* TBL- TABLE VARIABLES                                            01920000
008235*----------------------------------------------------------       01930000
008236 01 TBL-TIERED-TABLES.                                            01940000
008237    05  TBL-TIERED-TABLE.                                         01950000
008238        10 FILLER                     OCCURS 10 TIMES             01960000
008239                                      INDEXED BY TBL-TIER-INDEX.  01970000
008240           15 TBL-BUY-QTY            PIC S9(04) VALUE +0 COMP.    01980000
008241           15 TBL-BUY-DLR            PIC S9(07)V9(02)             01990000
008242                                                VALUE +0 COMP-3.  02000000
008243           15 TBL-GET-PCT            PIC S9(03)V9(03)             02010000
008244                                                VALUE +0 COMP-3.  02020000
008245           15 TBL-GET-DLR            PIC S9(07)V9(02)             02030000
008246                                                VALUE +0 COMP-3.  02040000
008247           15 TBL-INTFC-SUB-ID       PIC S9(10)V VALUE +0 COMP-3. 02050000
008248                                                                  02060000
008249 01 TBL-SMPL-TABLES.                                              02070000
008250    05  TBL-SMPL-PRICG-TABLE.                                     02080000
008251        10 FILLER                     OCCURS 1 TO 2000 TIMES      02090000
008252                                      DEPENDING ON PC-CNT-SMPL    02100000
008253                                      INDEXED BY TBL-SMPL-INDEX.  02110000
008254           15 TBL-PROMO-ID           PIC S9(10)V VALUE +0 COMP-3. 02120000
008255           15 TBL-PROMO-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 02130000
008255           15 TBL-MDSE-LNE-ID        PIC S9(10)V VALUE +0 COMP-3. 02140000
008256           15 TBL-PROMO-STRT-DTE     PIC X(26) VALUE SPACES.      02150000
008257           15 TBL-PROMO-END-DTE      PIC X(26) VALUE SPACES.      02160000
008258           15 TBL-PRICG-TYP-CDE      PIC X(03) VALUE SPACES.      02170000
008259           15 TBL-MERCH-HEIR-CDE     PIC X(03) VALUE SPACES.      02180000
008260           15 TBL-PRICE-DET-PRC      PIC S9(07)V9(02)             02190000
008261                                                VALUE +0 COMP-3.  02200000
008262                                                                  02210000
008263 01 TBL-GP-TABLES.                                                02220000
008264    05  TBL-GP-PRICG-TABLE.                                       02230000
008265        10 FILLER                     OCCURS 1 TO 2000 TIMES      02240000
008266                                      DEPENDING ON PC-CNT-GP      02250000
008267                                      INDEXED BY TBL-GP-INDEX.    02260000
008268           15 TBL-GP-PROMO-ID        PIC S9(10)V VALUE +0 COMP-3. 02270000
008269           15 TBL-GP-PROMO-INTFC-ID  PIC S9(10)V VALUE +0 COMP-3. 02280000
008269           15 TBL-GP-MDSE-LNE-ID     PIC S9(10)V VALUE +0 COMP-3. 02290000
008270           15 TBL-GP-PROMO-STRT-DTE  PIC X(26) VALUE SPACES.      02300000
008271           15 TBL-GP-PROMO-END-DTE   PIC X(26) VALUE SPACES.      02310000
008272           15 TBL-GP-PRICG-TYP-CDE   PIC X(03) VALUE SPACES.      02320000
008273           15 TBL-GP-MERCH-HEIR-CDE  PIC X(03) VALUE SPACES.      02330000
008274           15 TBL-GP-GROUP-QTY       PIC S9(04) VALUE +0 COMP.    02340000
008275           15 TBL-GP-GROUP-PRC       PIC S9(07)V9(03) VALUE +0    02350000
008276                                                COMP-3.           02360000
008277           15 TBL-GP-INDV-GP-PRC     PIC S9(07)V9(02) VALUE +0    02370000
008278                                                COMP-3.           02380000
       01 TBL-BOGO-TABLES.                                              02390000
          05  TBL-BOGO-PRICG-TABLE.                                     02400000
              10 FILLER                     OCCURS 1 TO 200  TIMES      02410005
W26114                                      DEPENDING ON PC-CNT-BOGO    02420005
                                            INDEXED BY TBL-BOGO-INDEX.  02430000
                 15 TBL-BOGO-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3.02440000
                 15 TBL-BOGO-PROMO-INTFC-ID PIC S9(10)V VALUE +0 COMP-3.02450000
                 15 TBL-BOGO-MDSE-LNE-ID    PIC S9(10)V VALUE +0 COMP-3.02460000
                 15 TBL-BOGO-PROMO-STRT-DTE PIC X(26) VALUE SPACES.     02470000
                 15 TBL-BOGO-PROMO-END-DTE  PIC X(26) VALUE SPACES.     02480000
                 15 TBL-BOGO-PRICG-TYP-CDE  PIC X(03) VALUE SPACES.     02490000
W26114           15 TBL-BOGO-DISC-QTY       PIC S9(04) COMP VALUE +0.   02500005
W26114           15 TBL-BOGO-DISC-AMT       PIC S9(07)V9(03)            02510005
W26114                                            VALUE +0 COMP-3.      02520005
                                                                        02530000
008279                                                                  02540000
008280*-----------------------------------------------------------      02550000
008281* PC- PROGRAM COUNTERS                                            02560000
008282*-----------------------------------------------------------      02570000
008283 01  PC-PROGRAM-COUNTERS.                                         02580000
008284     05  PC-CNT-GP                   PIC S9(04) VALUE +0.         02590000
008284     05  PC-CNT-BOGO                 PIC S9(04) VALUE +0.         02600000
008285     05  PC-CNT-SMPL                 PIC S9(04) VALUE +0.         02610000
008286     05  PC-HOLD-INDEX               PIC S9(04) VALUE +0.         02620000
008287     05  PC-TBL-SUB                  PIC S9(04) VALUE +0.         02630000
008288     05  PC-CNT-INDX                 PIC S9(04) VALUE +0.         02640000
008289     05  PC-CNT-NEW-INDX             PIC S9(04) VALUE +0.         02650000
008290                                                                  02660000
008820*----------------------------------------------------------       02670000
008821* COPYBOOK USED FOR INPUT.                                        02680000
008822*----------------------------------------------------------       02690000
008823     COPY XSRD042.                                                02700000
008824                                                                  02710000
008830*----------------------------------------------------------       02720000
008900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02730000
009000*----------------------------------------------------------       02740000
009100     COPY DPWS004.                                                02750000
009200                                                                  02760000
009300*---------------------------------------------                    02770000
009400*  DB2 COMMUNICATION AREA.                                        02780000
009500*---------------------------------------------                    02790000
009600     EXEC SQL                                                     02800000
009700          INCLUDE SQLCA                                           02810000
009800     END-EXEC.                                                    02820000
009900                                                                  02830000
009910*---------------------------------------------                    02840000
009920*  DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP MEMBERSHIP  02850000
009921*                                                TABLE            02860000
009930*---------------------------------------------                    02870000
009940     EXEC SQL                                                     02880000
009950          INCLUDE XST00023                                        02890000
009960     END-EXEC.                                                    02900000
009970                                                                  02910000
010000*---------------------------------------------                    02920000
010100*  DB2 TABLE EPT00011(EPT_LO_RTL) - LOWEST SIX WEEK PRICE TABLE   02930000
010200*---------------------------------------------                    02940000
010300     EXEC SQL                                                     02950000
010400          INCLUDE EPT00011                                        02960000
010500     END-EXEC.                                                    02970000
010600                                                                  02980000
010700 LINKAGE SECTION.                                                 02990000
010900*----------------------------------------------------------       03000000
011000* FILE INFORMATION BEING PASSED TO AND FROM THIS MODULE.          03010000
011100*----------------------------------------------------------       03020000
011910     COPY XSRD045.                                                03030000
011920                                                                  03040000
012000*----------------------------------------------------------       03050000
012100 PROCEDURE DIVISION USING XS045-BUS-RULE-LINKAGE.                 03060000
012200*----------------------------------------------------------       03070000
012300 0000-MAINLINE.                                                   03080000
012400                                                                  03090000
012500     PERFORM 1000-INITIALIZATION.                                 03100000
012600                                                                  03110000
012700     PERFORM 2000-PROCESS-PRICING                                 03120000
012800             UNTIL PS-PROCESS-COMPLETE.                           03130000
012900                                                                  03140000
013000     PERFORM 9999-WRAPUP.                                         03150000
013100                                                                  03160000
013200     EXIT PROGRAM.                                                03170000
013300                                                                  03180000
013400*0000-EXIT.                                                       03190000
013500 EJECT.                                                           03200000
013600                                                                  03210000
013700*----------------------------------------------------------       03220000
013800* 1000-INITIALIZATION.                                            03230000
013900*     INTIALIZES OR MOVES ANY VARIABLES.  CHECKS THE TABLE        03240000
014000*     IN THE LINKAGE SECTION TO SEE IF IT IS LEGIT.               03250000
014100*----------------------------------------------------------       03260000
014200 1000-INITIALIZATION.                                             03270000
014300                                                                  03280000
014310     INITIALIZE PC-PROGRAM-COUNTERS                               03290000
014311                PV-TIERED-DATA                                    03300000
014312                PV-FINAL-SMPL-PRICG                               03310000
014313                PV-FINAL-GP-PRICG                                 03320000
014313                PV-FINAL-BOGO-PRICG                               03330000
014314                PV-FINAL-PRICING                                  03340000
014315                XS045-VARIABLES-SENT-BACK.                        03350000
014320                                                                  03360000
014400     INITIALIZE TBL-TIERED-TABLE                                  03370000
014410         REPLACING ALPHANUMERIC DATA BY ZEROES                    03380000
014420                   NUMERIC DATA BY ZEROS.                         03390000
014421                                                                  03400000
014422     SET PS-SMPL-PRC-WINS TO TRUE.                                03410000
014423                                                                  03420000
014426     IF XS045-ELIG-PROMO-TBL-SZ = 0                               03430000
014427        MOVE XS045-RGLR-PRICE TO PV-FINAL-PRC-DET-PRC             03440000
              PERFORM 4000-CHECK-LWST-SIX-WK-PRC                        03450000
014428        SET PS-PROCESS-COMPLETE TO TRUE                           03460000
014429     ELSE                                                         03470000
014460        SET PS-PROCESS-CONTINUE TO TRUE                           03480000
016100     END-IF.                                                      03490000
016110                                                                  03500000
016200*1000-EXIT.                                                       03510000
016300 EJECT.                                                           03520000
016400                                                                  03530000
016500*----------------------------------------------------------       03540000
020220* 2000-PROCESS-PRICING.                                           03550000
020230*     THIS PROCESS ALL THE RECORDS THAT WERE SENT THROUGH         03560000
020240*     THE LINKAGE SECTION.  IT WILL SIFT THROUGH EACH RECORD      03570000
020250*     TO FIND OUT THE PRICE DETERMINED PRICE.                     03580000
020270*----------------------------------------------------------       03590000
020280 2000-PROCESS-PRICING.                                            03600000
020290                                                                  03610000
020292     PERFORM VARYING PC-TBL-SUB FROM 1 BY 1                       03620000
020293        UNTIL PC-TBL-SUB > XS045-ELIG-PROMO-TBL-SZ                03630000
020294            MOVE XS045-ELIG-PROMO-ID (PC-TBL-SUB) TO              03640000
020295                                     PV-PROMO-ID                  03650000
020296            MOVE XS045-PRICG-TYP-CDE (PC-TBL-SUB) TO              03660000
020297                                     PV-PRICG-TYP-CDE             03670000
020298            INITIALIZE XS042-PD-DETAIL-RECORD                     03680000
020299            PERFORM 2010-POPULATE-COPYBOOK                        03690000
020300            EVALUATE TRUE                                         03700000
020301                WHEN PV-TIERED                                    03710000
020302                     PERFORM 2100-CHECK-TIERED                    03720000
020303                WHEN PV-SIMPLE                                    03730000
020306                     PERFORM 2200-CHECK-SMPL-PRICG                03740000
020307                WHEN PV-GROUP-PRICG                               03750000
020310                     PERFORM 2300-CHECK-GP-PRICG                  03760000
020307                WHEN PV-BOGO                                      03770000
020310                     PERFORM 2400-CHECK-BOGO                      03780000
020311                WHEN OTHER                                        03790000
020312                     CONTINUE                                     03800000
020318            END-EVALUATE                                          03810000
020319     END-PERFORM.                                                 03820000
020320                                                                  03830000
020321     PERFORM 3000-PROCESS-PRC-DET.                                03840000
020322                                                                  03850000
020323     PERFORM 4000-CHECK-LWST-SIX-WK-PRC.                          03860000
020324                                                                  03870000
020325     SET PS-PROCESS-COMPLETE TO TRUE.                             03880000
020326                                                                  03890000
020327*2000-EXIT.                                                       03900000
020328 EJECT.                                                           03910000
020329                                                                  03920000
020330*----------------------------------------------------------       03930000
020331* 2010-POPULATE-COPYBOOK.                                         03940000
020332*     THIS POPULATES THE INPUT COPYBOOK WITH THE DATA             03950000
020333*     FROM THE LINKAGE SECTION.                                   03960000
020334*----------------------------------------------------------       03970000
020335 2010-POPULATE-COPYBOOK.                                          03980000
020336                                                                  03990000
020337     MOVE XS045-RGLR-PRICE             TO PV-RGLR-PRICE.          04000000
020338     MOVE XS045-INTR-UPC-ID            TO XS042-INTR-UPC-ID.      04010000
020339     MOVE XS045-ELIG-PROMO-ID(PC-TBL-SUB) TO XS042-ELIG-PROMO-ID. 04020000
020340     MOVE XS045-ELIG-PROMO-INTFC-ID(PC-TBL-SUB)                   04030000
020341                                    TO XS042-ELIG-PROMO-INTFC-ID. 04040000
020342     MOVE XS045-PROMO-STRT-DTE(PC-TBL-SUB)                        04050000
020343                                        TO XS042-PROMO-STRT-DTE.  04060000
020344     MOVE XS045-PROMO-END-DTE(PC-TBL-SUB)                         04070000
020345                                        TO XS042-PROMO-END-DTE.   04080000
020346     MOVE XS045-PRICG-TYP-CDE(PC-TBL-SUB)                         04090000
020347                                        TO XS042-PRICG-TYP-CDE.   04100000
020348     MOVE XS045-MRCH-HIER-CDE(PC-TBL-SUB)                         04110000
020349                                        TO XS042-MRCH-HEIR-CDE.   04120000
020350     MOVE XS045-DISC-GP-QTY(PC-TBL-SUB) TO XS042-DISC-GP-QTY.     04130000
020351     MOVE XS045-DISC-GP-AMT(PC-TBL-SUB) TO XS042-DISC-GP-AMT.     04140000
020352                                                                  04150000
020353     IF PV-TIERED                                                 04160000
020355        PERFORM VARYING XS045-ELIG-TIER-INDEX FROM 1 BY 1         04170000
020357           UNTIL XS045-ELIG-TIER-INDEX > 10                       04180000
020358              OR XS045-PROMO-INTFC-SUB-ID                         04190000
020359                 (PC-TBL-SUB XS045-ELIG-TIER-INDEX) = 0           04200000
020360                 SET XS042-TIER-INDEX TO XS045-ELIG-TIER-INDEX    04210000
020361                 MOVE XS045-BUY-QTY                               04220000
020362                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04230000
020363                       TO XS042-BUY-QTY(XS042-TIER-INDEX)         04240000
020364                 MOVE XS045-BUY-DLR                               04250000
020365                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04260000
020366                       TO XS042-BUY-DLR(XS042-TIER-INDEX)         04270000
020367                 MOVE XS045-GET-PCT                               04280000
020368                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04290000
020369                       TO XS042-GET-PCT(XS042-TIER-INDEX)         04300000
020370                 MOVE XS045-GET-DLR                               04310000
020371                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04320000
020372                       TO XS042-GET-DLR(XS042-TIER-INDEX)         04330000
020373                 MOVE XS045-PROMO-INTFC-SUB-ID                    04340000
020374                             (PC-TBL-SUB, XS045-ELIG-TIER-INDEX)  04350000
020375                       TO XS042-INTFC-SUB-ID(XS042-TIER-INDEX)    04360000
020376        END-PERFORM                                               04370000
020377     END-IF.                                                      04380000
020378                                                                  04390000
020379*2010-EXIT.                                                       04400000
020380 EJECT.                                                           04410000
020381                                                                  04420000
020382*** THIS MEMBER HOLDS THE REST OF THE CODE FOR THIS PROGRAM       04430000
020383     COPY XSPD001.                                                04440000
020384                                                                  04450000
020390*----------------------------------------------------------       04460000
020400* 4000-CHECK-LWST-SIX-WK-PRC.                                     04470000
020500*     CHECKS TO SEE IF THE LOWEST SIX WEEK PRICE IS NEEDED.       04480000
020600*     IF IT IS NEEDED IT WILL SELECT IT FROM THE LOWEST           04490000
020700*     RETAIL AMOUNT TABLE.                                        04500000
020800*----------------------------------------------------------       04510000
020900 4000-CHECK-LWST-SIX-WK-PRC.                                      04520000
021000                                                                  04530000
021100     IF XS045-LWST-SIX-WK-NEEDED-IND = 'Y'                        04540000
021200        PERFORM 4100-SELECT-AD-VERSION                            04550000
021210        IF PV-AD-VERSION NOT = 0                                  04560000
021300           PERFORM 4200-SELECT-LWST-6-WK-PRC                      04570000
021310        END-IF                                                    04580000
021400     END-IF.                                                      04590000
021410                                                                  04600000
021500*4000-EXIT.                                                       04610000
021600 EJECT.                                                           04620000
021700                                                                  04630000
021800*----------------------------------------------------------       04640000
021900* 4100-SELECT-AD-VERSION.                                         04650000
022000*     SELECTS WHAT AD VERSION BELONGS TO A SPECIFIC STORE.        04660000
022100*----------------------------------------------------------       04670000
022200 4100-SELECT-AD-VERSION.                                          04680000
022300                                                                  04690000
022400     PERFORM                                                      04700000
022500         WITH TEST AFTER                                          04710000
022600         VARYING PV-SQL-SUB                                       04720000
022700         FROM 1 BY 1                                              04730000
022800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04740000
022900                   OR  SQLCODE NOT = -904 AND -911 AND -913)      04750000
023000                                                                  04760000
023100          EXEC SQL                                                04770000
023200               SELECT  STR_GP_ID                                  04780000
023300                 INTO :PV-AD-VERSION                              04790000
023400                 FROM XST_STR_GP_MBSHP                            04800000
023500                WHERE STR_NBR        = :XS045-STORE               04810000
023600                  AND STR_GP_TYP_CDE = 4000                       04820000
023700                  AND EFF_BEG_DTE   <= :XS045-DATE                04830000
023800                  AND (EFF_END_DTE   > :XS045-DATE                04840000
023900                   OR  EFF_END_DTE  IS NULL)                      04850000
024000                WITH UR                                           04860000
024100          END-EXEC                                                04870000
024200                                                                  04880000
024300          EVALUATE TRUE                                           04890000
024400              WHEN SQLCODE = -904                                 04900000
024500              WHEN SQLCODE = -911                                 04910000
024600              WHEN SQLCODE = -913                                 04920000
024700                   CONTINUE                                       04930000
024800              WHEN SQLCODE = ZERO                                 04940000
024900                   CONTINUE                                       04950000
025000              WHEN SQLCODE NOT EQUAL ZERO                         04960000
025100                   MOVE '4100-SELECT-AD-VERSION' TO               04970000
025101                                           XS045-ERROR-SECT-NAME  04980000
025110                   MOVE SQLCODE TO XS045-SQL-CODE                 04990000
025120                   MOVE ZEROES TO PV-AD-VERSION                   05000000
025200          END-EVALUATE                                            05010000
025300     END-PERFORM.                                                 05020000
025400                                                                  05030000
025500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05040000
025600        MOVE '4100-SELECT-AD-VERSION' TO XS045-ERROR-SECT-NAME    05050000
025700        MOVE SQLCODE TO XS045-SQL-CODE                            05060000
025800        MOVE ZEROES TO PV-AD-VERSION                              05070000
026100     END-IF.                                                      05080000
026200                                                                  05090000
026300*3500-EXIT.                                                       05100000
026400 EJECT.                                                           05110000
026500                                                                  05120000
026600*----------------------------------------------------------       05130000
026700* 4200-SELECT-LWST-6-WK-PRC.                                      05140000
026800*     SELECTS THE LOWEST 6-WEEK PRICE DETERMINED FOR THE          05150000
026900*     SKU/AD VERSION LEVEL.                                       05160000
027000*----------------------------------------------------------       05170000
027100 4200-SELECT-LWST-6-WK-PRC.                                       05180000
027200                                                                  05190000
027300     PERFORM                                                      05200000
027400         WITH TEST AFTER                                          05210000
027500         VARYING PV-SQL-SUB                                       05220000
027600         FROM 1 BY 1                                              05230000
027700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05240000
027800                   OR  SQLCODE NOT = -904 AND -911 AND -913)      05250000
027900                                                                  05260000
028000          EXEC SQL                                                05270000
028100               SELECT  MIN(UNT_RTL_AMT)                           05280000
028200                 INTO :PV-FINAL-LWST-SIX-PRC                      05290000
028300                 FROM EPT_LO_RTL                                  05300000
028400                WHERE INTR_UPC_ID    = :XS045-INTR-UPC-ID         05310000
028500                  AND STR_GP_TYP_CDE = 4000                       05320000
028600                  AND STR_GP_ID      = :PV-AD-VERSION             05330000
028700                WITH UR                                           05340000
028800          END-EXEC                                                05350000
028900                                                                  05360000
029000          EVALUATE TRUE                                           05370000
029100              WHEN SQLCODE = -904                                 05380000
029200              WHEN SQLCODE = -911                                 05390000
029300              WHEN SQLCODE = -913                                 05400000
029400                  CONTINUE                                        05410000
029500              WHEN SQLCODE = ZERO                                 05420000
029600                   CONTINUE                                       05430000
029700              WHEN SQLCODE = +100 OR -305                         05440000
029800                   MOVE 0 TO PV-FINAL-LWST-SIX-PRC                05450000
029900              WHEN SQLCODE NOT EQUAL ZERO                         05460000
030000                   MOVE '4200-SELECT-LWST-6-WK-PRC' TO            05470000
030100                                        XS045-ERROR-SECT-NAME     05480000
030200                   MOVE SQLCODE TO XS045-SQL-CODE                 05490000
030500          END-EVALUATE                                            05500000
030600     END-PERFORM.                                                 05510000
030700                                                                  05520000
030800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05530000
030900        MOVE '4200-SELECT-LWST-6-WK-PRC' TO                       05540000
031000                                 XS045-ERROR-SECT-NAME            05550000
031100        MOVE SQLCODE TO XS045-SQL-CODE                            05560000
031400     END-IF.                                                      05570000
031500                                                                  05580000
031600*4200-EXIT.                                                       05590000
031700 EJECT.                                                           05600000
031800                                                                  05610000
042800*----------------------------------------------------------       05620000
042900* 9999-WRAPUP.                                                    05630000
043000*     MOVES ALL VARIABLES TO THE LINKAGE SECTION SO THEY          05640000
043100*     CAN BE PASSED BACK TO THE CALLING PROGRAM.                  05650000
043300*----------------------------------------------------------       05660000
043400 9999-WRAPUP.                                                     05670000
043500                                                                  05680000
043600     MOVE PV-FINAL-PRC-DET-PRC    TO XS045-PD-PRICE.              05690000
043700     MOVE PV-FINAL-PRC-TYP-CDE    TO XS045-PD-PRC-PRC-TYP-CDE.    05700000
043800     MOVE PV-FINAL-DET-PROMO-ID   TO XS045-PD-PROMO-ID.           05710000
008204     MOVE PV-FINAL-PD-STRT-DTE    TO XS045-PD-STRT-TMST.          05720000
008205     MOVE PV-FINAL-PD-END-DTE     TO XS045-PD-END-TMST.           05730000
043810     MOVE PV-FINAL-GP-QTY         TO XS045-PROMO-GP-PRICG-QTY.    05740000
043820     MOVE PV-FINAL-GP-DLR         TO XS045-PROMO-GP-PRICG-DLR.    05750000
043821     MOVE PV-FINAL-GP-PROMO-ID    TO XS045-PROMO-GP-PROMO-ID.     05760000
043822     MOVE PV-FINAL-GP-TYP-CDE     TO XS045-PROMO-GP-PRICG-TYP-CDE.05770000
043830     MOVE PV-FINAL-LWST-SIX-PRC   TO XS045-LWST-SIX-WEEK-PRICE.   05780000
008204     MOVE PV-FINAL-GP-STRT-DTE    TO XS045-PROMO-GP-STRT-TMST.    05790000
008205     MOVE PV-FINAL-GP-END-DTE     TO XS045-PROMO-GP-END-TMST.     05800000
043900                                                                  05810000
      *                                                                 05820000
      * EBOGO                                                           05830000
      *                                                                 05840000
040400     MOVE PV-BOGO-PRC-PROMO-ID    TO XS045-EBOGO-PROMO-ID.        05850000
040600     MOVE PV-BOGO-PRC-INTFC-ID    TO XS045-EBOGO-INTFC-ID.        05860000
040600     MOVE PV-BOGO-PRC-MDSE-LNE-ID TO XS045-EBOGO-MDSE-LNE-ID.     05870000
040800     MOVE PV-BOGO-PRC-STRT-DTE    TO XS045-EBOGO-STRT-TMST.       05880000
041000     MOVE PV-BOGO-PRC-END-DTE     TO XS045-EBOGO-END-TMST.        05890000
041200     MOVE PV-BOGO-PRC-TYP-CDE     TO XS045-EBOGO-PRICG-TYP-CDE.   05900000
W26114     MOVE PV-BOGO-DISC-QTY        TO XS045-EBOGO-DISC-QTY.        05910005
W26114     MOVE PV-BOGO-DISC-AMT        TO XS045-EBOGO-DISC-AMT.        05920005
041700                                                                  05930000
043910     IF PV-FINAL-PRC-TYP-CDE NOT = 'SRP'                          05940000
043911        MOVE PV-TIERED-PROMO-ID TO XS045-TIERED-PROMO-ID          05950000
043912        MOVE PV-TIERED-PRICG-TYP-CDE                              05960000
043913                                TO XS045-TIERED-PRICG-TYP-CDE     05970000
006300        MOVE PV-TIERED-STRT-DTE TO XS045-TIERED-STRT-TMST         05980000
006400        MOVE PV-TIERED-END-DTE  TO XS045-TIERED-END-TMST          05990000
043915        PERFORM VARYING TBL-TIER-INDEX FROM 1 BY 1                06000000
043916           UNTIL TBL-TIER-INDEX > 10                              06010000
043917              OR TBL-INTFC-SUB-ID(TBL-TIER-INDEX) = 0             06020000
043918                 SET TIER-INDEX TO TBL-TIER-INDEX                 06030000
043919                 MOVE TBL-BUY-QTY(TBL-TIER-INDEX) TO              06040000
043920                             XS045-TIER-BUY-QTY(TIER-INDEX)       06050000
043921                 MOVE TBL-BUY-DLR(TBL-TIER-INDEX) TO              06060000
043922                             XS045-TIER-BUY-DLR(TIER-INDEX)       06070000
043923                 MOVE TBL-GET-PCT(TBL-TIER-INDEX) TO              06080000
043924                             XS045-TIER-GET-PCT(TIER-INDEX)       06090000
043925                 MOVE TBL-GET-DLR(TBL-TIER-INDEX) TO              06100000
043926                             XS045-TIER-GET-DLR(TIER-INDEX)       06110000
043927        END-PERFORM                                               06120000
043935     END-IF.                                                      06130000
043940                                                                  06140000
044000*9999-EXIT.                                                       06150000
044100 EJECT.                                                           06160000
044200                                                                  06170000
