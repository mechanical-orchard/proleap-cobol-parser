000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS002.                                         00040000
000500 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  06/93.                                            00070000
000800*---------------------------------------------------------------* 00080000
000900*    V002 - VENDOR/DEPARTMENT LIST PROGRAM                      * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF VENDORS FOR THE SPECIFIC  * 00110000
001200*    DEPARTMENT ENTERED.                                        * 00120000
001210*---------------------------------------------------------------* 00121028
001300* CHANGE LOG:                                                   * 00130028
001310* 09/07/2021 GERMAN BANDA                    WR/IR #: CHG0261091  00131030
001320*            - CHANGE CALL OF DPKUT100 TO                       * 00132028
001330*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00133028
001340*              MAKING THE CALL DYNAMIC VS STATIC                * 00134028
001350*                                                               * 00135028
001310* 01/05/2023 JEAN KURK                       WR/IR #: CHG0277999  00136031
001320*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00137031
001400*---------------------------------------------------------------* 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600 DATA DIVISION.                                                   00160000
001700                                                                  00170000
001800 WORKING-STORAGE SECTION.                                         00180000
001900                                                                  00190000
002000 01  PC-PROGRAM-CONSTANTS.                                        00200000
002100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00210000
002200                                                    'VN002A  '.   00220000
002300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00230000
002400                                                    'VNKM002 '.   00240000
002500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00250000
002600                                                    'VNKCS002'.   00260000
002700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00270000
002800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00280000
002900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00290000
003000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00300000
003100                                                    COMP SYNC.    00310000
003200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00320000
003300                                                    COMP SYNC.    00330000
003400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00340000
003500                                                    +1000000      00350000
003600                                                    COMP-3.       00360000
003700     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00370000
003800                                                    COMP SYNC.    00380000
003900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00390000
004000                                                    COMP-3.       00400000
004100     05  PC-ACTIVE                      PIC  X(01)  VALUE 'A'.    00410000
004200     05  PC-INACTIVE                    PIC  X(01)  VALUE 'I'.    00420000
004300                                                                  00430000
004400     05  PC-UPC-CATALOG-NAMES.                                    00440008
004500         10  PC-SEARS                   PIC  X(05)  VALUE 'SEARS'.00450008
004600         10  PC-QRS                     PIC  X(03)  VALUE 'QRS'.  00460008
004700                                                                  00470008
004800     05  PC-TSYMSG-NUMBERS.                                       00480000
004900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00490000
005000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00500000
005100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00510000
005200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00520000
005300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00530000
005400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00540000
005500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00550000
005600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00560000
005700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00570000
005800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00580000
005900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00590000
006000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00600000
006100         10  PC-TSYMSG-00155            PIC  9(05)  VALUE 00155.  00610000
006200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00620000
006300         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  00630000
006400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00640000
006500                                                                  00650000
006600 01  PS-PROGRAM-SWITCHES.                                         00660000
006700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00670000
006800         88  PS-NO-ERROR                            VALUE 'Y'.    00680000
006900         88  PS-ERROR                               VALUE 'N'.    00690000
007000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00700000
007100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00710000
007200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00720000
007300                                                                  00730000
007400 01  PV-PROGRAM-VARIABLES.                                        00740000
007500     05  PV-SUB                         PIC S9(04)  VALUE +0      00750000
007600                                                    COMP SYNC.    00760000
007700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00770000
007800                                                    COMP SYNC.    00780000
007900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00790000
008000                                                    COMP-3.       00800000
008100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00810000
008200                                                    COMP-3.       00820000
008300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00830000
008400                                                    COMP-3.       00840000
008500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00850000
008600                                                    COMP-3.       00860000
008700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00870000
008800                                                    COMP-3.       00880000
008900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00890000
009000                                                    COMP-3.       00900000
009100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00910000
009200                                                    COMP-3.       00920000
009300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00930000
009400                                                    COMP SYNC.    00940000
009500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00950000
009600                                                    COMP SYNC.    00960000
009700     05  PV-ITEM                        PIC S9(04)  VALUE +0      00970000
009800                                                    COMP SYNC.    00980000
009900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00990000
010000                                                    COMP SYNC.    01000000
010100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01010000
010200                                                    COMP SYNC.    01020000
010300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01030000
010400                                                    COMP SYNC.    01040000
010500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01050000
010600                                                    COMP SYNC.    01060000
010700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01070000
010800                                                    COMP SYNC.    01080000
010900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01090000
011000                                                    COMP SYNC.    01100000
011100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01130000
011400                                                    COMP SYNC.    01140000
011500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01170000
011800                                                    COMP SYNC.    01180000
011900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01190000
012000                                                    COMP SYNC.    01200000
012100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01210000
012200                                                    COMP SYNC.    01220000
012300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01230000
012400                                                    COMP SYNC.    01240000
012500     05  PV-EDIT-PAYT-TERM-ID           PIC ZZ9.                  01250000
012600                                                                  01260000
012700     05  PV-STAT1                       PIC X(01)   VALUE 'A'.    01270000
012800     05  PV-STAT2                       PIC X(01)   VALUE 'I'.    01280000
012900******************************************************************01290000
013000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01300000
013100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01310000
013200**  APPLICATION-SPECIFIC COMMAREA.                              **01320000
013300******************************************************************01330000
013400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01340000
013500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01350000
013600     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01360000
013700                                        INDEXED BY LQW-IDX.       01370000
013800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01380000
013900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01390000
014000         10  LQW-SELECTED-SW            PIC  X(01).               01400000
014100             88  LQW-SELECT                         VALUE 'S'.    01410000
014200             88  LQW-DESELECT                       VALUE ' '.    01420000
014300         10  LQW-VEND-TYPE              PIC  X(01).               01430000
014400         10  LQW-VEND-NAME              PIC  X(24).               01440011
014500         10  LQW-DUN-NBR                PIC  X(09).               01450000
014600         10  LQW-INHOUSE-NBR            PIC S9(04)  COMP.         01460000
014700         10  LQW-ENT-ID                 PIC S9(09)  COMP.         01470000
014800         10  LQW-PAYMENT-TERMS          PIC  X(23).               01480000
014900         10  LQW-UPC-CATALOG-NM         PIC  X(03).               01490006
015000         10  LQW-EDI-IND                PIC  X(01).               01500000
015100         10  LQW-PRETKT-IND             PIC  X(01).               01510000
015200         10  LQW-STATUS-IND             PIC  X(01).               01520000
015300                                                                  01530000
015400*---------------------------------------------------------------* 01540000
015500*  RECORD LAYOUT FOR THE VENDOR  SELECTION TEMP STORAGE QUEUE.  * 01550000
015600*---------------------------------------------------------------* 01560000
015700     COPY VNWS003.                                                01570000
015800                                                                  01580000
015900*---------------------------------------------------------------* 01590000
016000*    MAP LAYOUT                                                 * 01600000
016100*---------------------------------------------------------------* 01610000
016200     COPY VNKM002.                                                01620000
016300                                                                  01630000
016400 01  MR-OCCURS-LAYOUT                   REDEFINES  VN002AO.       01640000
016500     05  FILLER                         PIC X(86).                01650000
016600     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01660000
016700         10  MR-SELECTL                 PIC S9(04) COMP.          01670000
016800         10  MR-SELECTA                 PIC  X(01).               01680000
016900         10  MR-SELECTC                 PIC  X(01).               01690000
017000         10  MR-SELECTH                 PIC  X(01).               01700000
017100         10  MR-SELECTI                 PIC  X(01).               01710000
017200                                                                  01720000
017300                                                                  01730000
017400         10  MR-VEND-TYPEL              PIC S9(04) COMP.          01740000
017500         10  MR-VEND-TYPEA              PIC  X(01).               01750000
017600         10  MR-VEND-TYPEC              PIC  X(01).               01760000
017700         10  MR-VEND-TYPEH              PIC  X(01).               01770000
017800         10  MR-VEND-TYPE               PIC  X(01).               01780000
017900                                                                  01790000
018000         10  MR-VEND-NAMEL              PIC S9(04) COMP.          01800000
018100         10  MR-VEND-NAMEA              PIC  X(01).               01810000
018200         10  MR-VEND-NAMEC              PIC  X(01).               01820000
018300         10  MR-VEND-NAMEH              PIC  X(01).               01830000
018400         10  MR-VEND-NAME               PIC  X(24).               01840011
018500                                                                  01850000
018600         10  MR-DUN-NBRL                PIC S9(04) COMP.          01860000
018700         10  MR-DUN-NBRA                PIC  X(01).               01870000
018800         10  MR-DUN-NBRC                PIC  X(01).               01880000
018900         10  MR-DUN-NBRH                PIC  X(01).               01890000
019000         10  MR-DUN-NBR                 PIC  X(09).               01900000
019100                                                                  01910000
019200         10  MR-INHOUSE-NBRL            PIC S9(04) COMP.          01920000
019300         10  MR-INHOUSE-NBRA            PIC  X(01).               01930000
019400         10  MR-INHOUSE-NBRC            PIC  X(01).               01940000
019500         10  MR-INHOUSE-NBRH            PIC  X(01).               01950000
019600         10  MR-INHOUSE-NBR             PIC  9(03).               01960000
019700         10  MR-INHOUSE-NBR-X REDEFINES MR-INHOUSE-NBR            01970000
019800                                        PIC  X(03).               01980000
019900                                                                  01990000
020000         10  MR-PAYMENT-TERMSL          PIC S9(04) COMP.          02000000
020100         10  MR-PAYMENT-TERMSA          PIC  X(01).               02010000
020200         10  MR-PAYMENT-TERMSC          PIC  X(01).               02020000
020300         10  MR-PAYMENT-TERMSH          PIC  X(01).               02030000
020400         10  MR-PAYMENT-TERMS           PIC  X(23).               02040000
020500                                                                  02050000
020600         10  MR-UPC-CATALOG-NML         PIC S9(04) COMP.          02060007
020700         10  MR-UPC-CATALOG-NMA         PIC  X(01).               02070007
020800         10  MR-UPC-CATALOG-NMC         PIC  X(01).               02080007
020900         10  MR-UPC-CATALOG-NMH         PIC  X(01).               02090007
021000         10  MR-UPC-CATALOG-NM          PIC  X(03).               02100007
021100                                                                  02110007
021200         10  MR-EDI-INDL                PIC S9(04) COMP.          02120000
021300         10  MR-EDI-INDA                PIC  X(01).               02130000
021400         10  MR-EDI-INDC                PIC  X(01).               02140000
021500         10  MR-EDI-INDH                PIC  X(01).               02150000
021600         10  MR-EDI-IND                 PIC  X(01).               02160000
021700                                                                  02170000
021800         10  MR-PRETKT-INDL             PIC S9(04) COMP.          02180000
021900         10  MR-PRETKT-INDA             PIC  X(01).               02190000
022000         10  MR-PRETKT-INDC             PIC  X(01).               02200000
022100         10  MR-PRETKT-INDH             PIC  X(01).               02210000
022200         10  MR-PRETKT-IND              PIC  X(01).               02220000
022300                                                                  02230000
022400         10  MR-STATUS-INDL             PIC S9(04) COMP.          02240000
022500         10  MR-STATUS-INDA             PIC  X(01).               02250000
022600         10  MR-STATUS-INDC             PIC  X(01).               02260000
022700         10  MR-STATUS-INDH             PIC  X(01).               02270000
022800         10  MR-STATUS-IND              PIC  X(01).               02280000
022900*---------------------------------------------------------------* 02290000
023000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02300000
023100*---------------------------------------------------------------* 02310000
023200     COPY DPWS015.                                                02320000
023300                                                                  02330000
023400*---------------------------------------------------------------* 02340000
023500*    FUNCTION KEYS COPYBOOK.                                    * 02350000
023600*---------------------------------------------------------------* 02360000
023700     COPY DPWS016.                                                02370000
023800                                                                  02380000
023900*---------------------------------------------------------------* 02390000
024000*    NUMERIC EDIT LAYOUT.                                       * 02400000
024100*---------------------------------------------------------------* 02410000
024200     COPY DPWS010I.                                               02420000
024300                                                                  02430000
024400*---------------------------------------------------------------* 02440000
024500*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02450031
024600*---------------------------------------------------------------* 02460000
024700     COPY DPWS030.                                                02470000
024700     COPY DPWS930.                                                02471031
024800                                                                  02480000
024900*---------------------------------------------------------------* 02490000
025000*    STANDARD COMMAREA.                                         * 02500000
025100*---------------------------------------------------------------* 02510000
025200     COPY DPWS020.                                                02520000
025300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02530000
025400                                                                  02540000
025500*---------------------------------------------------------------* 02550000
025600* INTER-APPLICATION COMMAREA.                                   * 02560000
025700*   VNWS001 - INPUT FROM CRITERIA SPECIFICATION PROGRAM         * 02570000
025800*   VNWS002 - OUTPUT TO LOCAL-GO FUNCTION                       * 02580000
025900*---------------------------------------------------------------* 02590000
026000         10  INTER-APPL-COMM-AREA       PIC X(200).               02600000
026100     COPY VNWS001.                                                02610000
026200     COPY VNWS002.                                                02620000
026300         10  ASC-SPECIFIC-COMMAREA.                               02630000
026400             15  ASC-LIST-KEYS.                                   02640000
026500                 20  ASC-KEY-DEPT-NBR                PIC  X(03).  02650000
026600                 20  ASC-KEY-VENDOR-TYPE             PIC  X(01).  02660000
026700                 20  ASC-KEY-STATUS-CODE             PIC  X(01).  02670000
026800                 20  ASC-DEPT-DESC                   PIC  X(30).  02680000
026900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02690000
027000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02700000
027100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02710000
027200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02720000
027300                                                                  02730000
027400                 20  ASC-ITEM-ARRAY.                              02740000
027500                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02750000
027600                         30  ASC-LIST-ITEM-NUMBER                 02760000
027700                                                     PIC S9(09)   02770000
027800                                                     COMP-3.      02780000
027900                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02790000
028000                             88  ASC-VALID-SELECT    VALUE ' '    02800000
028100                                                           'S'    02810000
028200                                                           'B'    02820000
028300                                                           'E'.   02830000
028400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02840000
028500                             88  ASC-TEMP-SELECT     VALUE 'S'.   02850000
028600                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02860000
028700                             88  ASC-TEMP-END        VALUE 'E'.   02870000
028800                         30  ASC-SELECTED-SW         PIC  X(01).  02880000
028900                             88  ASC-NO-SELECT       VALUE ' '.   02890000
029000                             88  ASC-SELECT          VALUE 'S'.   02900000
029100                             88  ASC-BEGIN           VALUE 'B'.   02910000
029200                             88  ASC-END             VALUE 'E'.   02920000
029300                         30  ASC-VEND-TYPE           PIC  X(01).  02930000
029400                         30  ASC-VEND-NAME           PIC  X(24).  02940011
029500                         30  ASC-DUN-NBR             PIC  X(09).  02950000
029600                         30  ASC-INHOUSE-NBR         PIC S9(04)   02960000
029700                                                     COMP.        02970000
029800                         30  ASC-ENT-ID              PIC S9(09)   02980000
029900                                                     COMP.        02990000
030000                         30  ASC-PAYMENT-TERMS       PIC  X(23).  03000000
030100                         30  ASC-UPC-CATALOG-NM      PIC  X(03).  03010007
030200                         30  ASC-EDI-IND             PIC  X(01).  03020000
030300                         30  ASC-PRETKT-IND          PIC  X(01).  03030000
030400                         30  ASC-STATUS-IND          PIC  X(01).  03040000
030500                                                                  03050000
030600             15  ASC-BLK-SUB                         PIC S9(04)   03060000
030700                                                          COMP    03070000
030800                                                          SYNC.   03080000
030900             15  ASC-ITEM-SUB                        PIC S9(04)   03090000
031000                                                          COMP    03100000
031100                                                          SYNC.   03110000
031200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03120000
031300                                                          COMP-3. 03130000
031400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03140000
031500                                                          COMP-3. 03150000
031600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03160000
031700                                                          COMP-3. 03170000
031800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03180000
031900                                                          COMP-3. 03190000
032000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03200000
032100                                                          COMP-3. 03210000
032200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03220000
032300                                                          COMP    03230000
032400                                                          SYNC.   03240000
032500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03250000
032600                                                          COMP-3. 03260000
032700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03270000
032800                                                          COMP-3. 03280000
032900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03290000
033000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03300000
033100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03310000
033200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03320000
033300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03330000
033400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03340000
033500             15  ASC-LIST-QUEUE-NAME.                             03350000
033600                 20  ASC-LIST-TERM-ID                PIC  X(04).  03360000
033700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03370000
033800                                                          COMP-3. 03380000
033900                 20  ASC-LIST-SEQ                    PIC  9(01).  03390000
034000             15  ASC-SEL-QUEUE-NAME.                              03400000
034100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03410000
034200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03420000
034300                                                          COMP-3. 03430000
034400                 20  ASC-SEL-SEQ                     PIC  9(01).  03440000
034500                                                                  03450000
034600             15  ASC-START-ITEM-REQUEST.                          03460000
034700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03470000
034800             15  ASC-SAVE-INPUT                      PIC  X(200). 03480000
034900             15  ASC-PAYT-TERM-ID-DESC               PIC  X(28).  03490000
035000                                                                  03500000
035100*---------------------------------------------------------------* 03510000
035200*    ABEND PROCESSING COPYBOOK.                                 * 03520000
035300*---------------------------------------------------------------* 03530000
035400     COPY DPWS013.                                                03540000
035500                                                                  03550000
035600     COPY POWS020.                                                03560000
035700                                                                  03570000
035800*---------------------------------------------------------------* 03580000
035900*    DB2 AREA FOR TPAYTRM                                       * 03590000
036000*---------------------------------------------------------------* 03600000
036100     EXEC SQL                                                     03610000
036200          INCLUDE TPAYTRM                                         03620000
036300     END-EXEC.                                                    03630000
036400                                                                  03640000
036500*---------------------------------------------------------------* 03650004
036600*    DB2 AREA FOR TNETVND                                       * 03660004
036700*---------------------------------------------------------------* 03670004
036800     EXEC SQL                                                     03680004
036900          INCLUDE TNETVND                                         03690004
037000     END-EXEC.                                                    03700004
037100                                                                  03710004
037200*---------------------------------------------------------------* 03720004
037300*    DB2 AREA FOR TNETWRK                                       * 03730004
037400*---------------------------------------------------------------* 03740004
037500     EXEC SQL                                                     03750004
037600          INCLUDE TNETWRK                                         03760004
037700     END-EXEC.                                                    03770004
037800                                                                  03780004
037900*---------------------------------------------------------------* 03790000
038000*    DB2 AREA FOR TVNDAGR                                       * 03800000
038100*---------------------------------------------------------------* 03810000
038200     EXEC SQL                                                     03820000
038300          INCLUDE TVNDAGR                                         03830000
038400     END-EXEC.                                                    03840000
038500                                                                  03850000
038600*---------------------------------------------------------------* 03860000
038700*    DB2 AREA FOR VENDOR DEPARTMENT                             * 03870000
038800*---------------------------------------------------------------* 03880000
038900     EXEC SQL                                                     03890000
039000          INCLUDE TVNDDPT                                         03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300*---------------------------------------------------------------* 03930000
039400*    DB2 AREA FOR EXTERNAL ENTERPRISE                           * 03940000
039500*---------------------------------------------------------------* 03950000
039600     EXEC SQL                                                     03960000
039700          INCLUDE TEXTENT                                         03970000
039800     END-EXEC.                                                    03980000
039900                                                                  03990000
040000*---------------------------------------------------------------* 04000000
040100*    DB2 AREA FOR ENTERPRISE NAME                               * 04010000
040200*---------------------------------------------------------------* 04020000
040300     EXEC SQL                                                     04030000
040400          INCLUDE TENTNME                                         04040000
040500     END-EXEC.                                                    04050000
040600                                                                  04060000
040700*---------------------------------------------------------------* 04070000
040800*    DB2 AREA FOR MERCHANDISE AREA                              * 04080000
040900*---------------------------------------------------------------* 04090000
041000     EXEC SQL                                                     04100000
041100          INCLUDE TMDSEAR                                         04110000
041200     END-EXEC.                                                    04120000
041300                                                                  04130000
041400*---------------------------------------------------------------* 04140000
041500*    DB2 AREA FOR ORGANIZATION UNIT                             * 04150000
041600*---------------------------------------------------------------* 04160000
041700     EXEC SQL                                                     04170000
041800          INCLUDE TORGUNT                                         04180000
041900     END-EXEC.                                                    04190000
042000                                                                  04200000
042100*---------------------------------------------------------------* 04210000
042200*    DB2 AREA FOR COMMUNICATIONS                                * 04220000
042300*---------------------------------------------------------------* 04230000
042400     EXEC SQL                                                     04240000
042500          INCLUDE SQLCA                                           04250000
042600     END-EXEC.                                                    04260000
042700                                                                  04270000
042800*---------------------------------------------------------------* 04280000
042900*    VENDOR CURSOR WHEN DEPARTMENT NUMBER ENTERED               * 04290000
043000*    THIS CURSOR WILL ALSO BRING BACK THE UPC CATALOG NAME      * 04300026
043100*    WHEN THERE IS A UPC CATALOG ASSIGNED TO A VENDOR.          * 04310026
043200*---------------------------------------------------------------* 04320000
043300                                                                  04330000
043400     EXEC SQL                                                     04340022
043500          DECLARE VENDOR-CSR CURSOR FOR                           04350022
043600           SELECT A.ENT_ID                                        04360022
043700                 ,A.INHOUSE_NBR                                   04370022
043800                 ,A.VEND_TYP_IND                                  04380022
043900                 ,A.VND_DEPT_STAT_CD                              04390022
044000                 ,B.DUN_NBR                                       04400022
044100                 ,C.ENT_NAME_DESC                                 04410022
044200                 ,COALESCE(NETWK_NME1,'%')                        04420022
044300             FROM TVNDDPT A                                       04430022
044400                 ,TEXTENT B                                       04440022
044500                 ,(SELECT D1.ENT_ID AS ENT_ID1,                   04450022
044600                          E1.NETWK_NME AS NETWK_NME1              04460022
044700                   FROM   TNETVND D1,                             04470022
044800                          TNETWRK E1                              04480022
044900                   WHERE  D1.NETWK_ID = E1.NETWK_ID               04490025
045000                     AND  D1.PREF_NETWK_SW_IND = 'Y') AS NET      04500025
045100                   RIGHT OUTER JOIN TENTNME C                     04510022
045200                   ON ENT_ID1 = C.ENT_ID                          04520022
045300            WHERE A.DEPT_NBR        = :ASC-KEY-DEPT-NBR           04530022
045400              AND A.VEND_TYP_IND    = :ASC-KEY-VENDOR-TYPE        04540022
045500              AND A.VND_DEPT_STAT_CD IN (:PV-STAT1, :PV-STAT2)    04550022
045600              AND B.STATUS_CDE      = :ASC-KEY-STATUS-CODE        04560022
045700              AND B.ENT_ID          = A.ENT_ID                    04570022
045800              AND C.ENT_ID          = A.ENT_ID                    04580022
045900              AND C.TYPE_CDE        = '01'                        04590022
046000         ORDER BY ENT_NAME_DESC                                   04600022
046100     END-EXEC.                                                    04610022
046200                                                                  04620000
046300 LINKAGE SECTION.                                                 04630000
046400                                                                  04640000
046500 01  DFHCOMMAREA.                                                 04650000
046600     05  FILLER  OCCURS  1 TO 4072 TIMES                          04660000
046700                 DEPENDING ON EIBCALEN.                           04670000
046800         10  FILLER PIC X.                                        04680000
046900                                                                  04690000
047000                                                                  04700000
047100 PROCEDURE DIVISION.                                              04710000
047200 0000-MAIN-MODULE.                                                04720000
047300                                                                  04730000
047400     INITIALIZE DP030-CICS-API-FIELDS.                            04740000
047500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04750000
047600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04760000
047700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04770000
047800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04780000
047900     MOVE LENGTH OF VN002AI        TO DP030-MAP-LENGTH (1).       04790000
048000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04800000
048100     PERFORM 0001-CALL-CICS-ARCH-API.                             04810000
048200                                                                  04820000
048300     PERFORM 1000-CONTROL-PROCESSING.                             04830000
048400                                                                  04840000
048500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04850000
048600     PERFORM 0001-CALL-CICS-ARCH-API.                             04860000
048700                                                                  04870000
048800******************************************************************04880000
048900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04890000
049000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04900000
049100******************************************************************04910000
049200 0001-CALL-CICS-ARCH-API.                                         04920000
049300                                                                  04930000
049400*    CALL 'DPKCS030' USING DFHEIBLK                               04940031
049400     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04941031
049500                           DFHCOMMAREA                            04950000
049600                           DP030-CICS-API-FIELDS                  04960000
049700                           DP020-STANDARD-COMMAREA                04970000
049800                           VN002AI.                               04980000
049900                                                                  04990000
050000     IF  DP030-RC-CALL-SUCCESSFUL                                 05000000
050100         CONTINUE                                                 05010000
050200     ELSE                                                         05020000
050300         SET DP013-NO-ROLLBACK                                    05030000
050400             DP013-XCTL-DISPLAY-RESTART                           05040000
050500             DP013-CICS-ABEND      TO TRUE                        05050000
050600         MOVE '0001-CALL-CICS-ARCH-API'                           05060000
050700                                   TO DP013-PARAGRAPH             05070000
050800*        MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05080031
050900*             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05090031
050800         MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05091031
050900-             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05092031
051000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05100000
051100         PERFORM DP013-0000-PROCESS-ABEND.                        05110000
051200                                                                  05120000
051300*----------------------------------------------------------------*05130000
051400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05140000
051500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05150000
051600*----------------------------------------------------------------*05160000
051700 1000-CONTROL-PROCESSING.                                         05170000
051800                                                                  05180000
051900     EVALUATE TRUE                                                05190000
052000         WHEN DP020-NEXT-ACT-INITIAL                              05200000
052100             INITIALIZE ASC-SPECIFIC-COMMAREA                     05210000
052200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05220000
052300                                      ASC-SEL-TERM-ID             05230000
052400             MOVE DP020-SRC-TASK-NUMBER                           05240000
052500                                   TO ASC-LIST-TASK-NUMBER        05250000
052600                                      ASC-SEL-TASK-NUMBER         05260000
052700             MOVE PC-LIST-QUEUE-SEQ                               05270000
052800                                   TO ASC-LIST-SEQ                05280000
052900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05290000
053000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05300000
053100             IF PS-ERROR                                          05310000
053200                 CONTINUE                                         05320000
053300             ELSE                                                 05330000
053400                 PERFORM 4000-BUILD-INITIAL-PANEL                 05340000
053500             END-IF                                               05350000
053600                                                                  05360000
053700         WHEN DP020-NEXT-ACT-READ-MAP                             05370000
053800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05380000
053900                                   TO PV-TOP-ITEM                 05390000
054000             PERFORM 2000-PROCESS-PANEL                           05400000
054100                                                                  05410000
054200         WHEN DP020-NEXT-ACT-RETURN                               05420000
054300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05430000
054400                                   TO PV-TOP-ITEM                 05440000
054500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05450000
054600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05460000
054700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05470000
054800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05480000
054900                                                                  05490000
055000         WHEN OTHER                                               05500000
055100             SET DP013-LOGIC-ABEND TO TRUE                        05510000
055200             SET DP013-NO-ROLLBACK TO TRUE                        05520000
055300             MOVE '1000-CONTROL-PROCESSING'                       05530000
055400                                   TO DP013-PARAGRAPH             05540000
055500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05550000
055600                                   TO DP013-MESSAGE-TEXT(1)       05560000
055700             PERFORM DP013-0000-PROCESS-ABEND                     05570000
055800     END-EVALUATE.                                                05580000
055900                                                                  05590000
056000*----------------------------------------------------------------*05600000
056100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05610000
056200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05620000
056300*----------------------------------------------------------------*05630000
056400 1100-PROCESS-INTER-APPL-COMM.                                    05640000
056500                                                                  05650000
056600     SET  PS-COMMAREA-VALID TO TRUE.                              05660000
056700     MOVE SPACE             TO ASC-START-ITEM-REQUEST.            05670000
056800                                                                  05680000
056900     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05690000
057000         MOVE VN001-DEPARTMENT-NUMBER TO ASC-KEY-DEPT-NBR         05700000
057100         MOVE VN001-VENDOR-TYPE       TO ASC-KEY-VENDOR-TYPE      05710000
057200         MOVE VN001-STATUS-CODE       TO ASC-KEY-STATUS-CODE      05720000
057300         MOVE VN001-INTER-APPL-COMMAREA TO ASC-SAVE-INPUT         05730000
057400     ELSE                                                         05740000
057500         IF DP020-NAV-KEY-DATA > SPACE                            05750000
057600             MOVE DP020-NAV-KEY-DATA TO ASC-KEY-DEPT-NBR          05760000
057700         END-IF                                                   05770000
057800     END-IF.                                                      05780000
057900                                                                  05790000
058000     IF ASC-KEY-DEPT-NBR NOT > SPACES                             05800000
058100         MOVE PC-TSYMSG-00486 TO DP020-MSG-NUMBER                 05810000
058200         SET DP020-MSG-FATAL                                      05820000
058300             DP020-NEXT-ACT-APPL-ERROR                            05830000
058400             PS-ERROR                  TO TRUE                    05840000
058500     END-IF.                                                      05850000
058600                                                                  05860000
058700*----------------------------------------------------------------*05870000
058800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05880000
058900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05890000
059000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05900000
059100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05910000
059200* FUNCTION KEYS CAN GET THIS FAR.                                *05920000
059300*----------------------------------------------------------------*05930000
059400 2000-PROCESS-PANEL.                                              05940000
059500                                                                  05950000
059600     EVALUATE TRUE                                                05960000
059700         WHEN DP020-SRC-AID = DP016-CLEAR                         05970000
059800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05980000
059900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05990000
060000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06000000
060100                                                                  06010000
060200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06020000
060300             PERFORM 2050-DELETE-LIST-QUEUE                       06030000
060400             PERFORM 4000-BUILD-INITIAL-PANEL                     06040000
060500                                                                  06050000
060600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06060000
060700             PERFORM 2140-DESELECT-ALL-ITEMS                      06070000
060800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06080000
060900                                                                  06090000
061000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06100000
061100             PERFORM 2150-SELECT-ALL-ITEMS                        06110000
061200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06120000
061300                                                                  06130000
061400         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               06140000
061500             PERFORM 2050-DELETE-LIST-QUEUE                       06150000
061600             PERFORM 4000-BUILD-INITIAL-PANEL                     06160000
061700                                                                  06170000
061800         WHEN OTHER                                               06180000
061900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06190000
062000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06200000
062100             IF  PS-NO-ERROR                                      06210000
062200                 SET DP030-CONTINUE-GO TO TRUE                    06220000
062300                 PERFORM 2100-CHECK-FUNCTION-KEY                  06230000
062400             ELSE                                                 06240000
062500                 SET DP030-OVERRIDE-GO TO TRUE                    06250000
062600             END-IF                                               06260000
062700     END-EVALUATE.                                                06270000
062800                                                                  06280000
062900*----------------------------------------------------------------*06290000
063000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06300000
063100*----------------------------------------------------------------*06310000
063200 2050-DELETE-LIST-QUEUE.                                          06320000
063300                                                                  06330000
063400     EXEC CICS                                                    06340000
063500         DELETEQ TS                                               06350000
063600             QUEUE (ASC-LIST-QUEUE-NAME)                          06360000
063700             RESP  (PV-CICS-RESP)                                 06370000
063800     END-EXEC.                                                    06380000
063900                                                                  06390000
064000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06400000
064100        (PV-CICS-RESP = DFHRESP(QIDERR))                          06410000
064200         CONTINUE                                                 06420000
064300     ELSE                                                         06430000
064400         SET DP013-CICS-ABEND      TO TRUE                        06440000
064500         SET DP013-NO-ROLLBACK     TO TRUE                        06450000
064600                                                                  06460000
064700         MOVE '2050-DELETE-LIST-QUEUE'                            06470000
064800                                   TO DP013-PARAGRAPH             06480000
064900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06490000
065000                                   TO DP013-MESSAGE-TEXT (1)      06500000
065100         PERFORM DP013-0000-PROCESS-ABEND                         06510000
065200     END-IF.                                                      06520000
065300                                                                  06530000
065400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06540000
065500                                                                  06550000
065600*----------------------------------------------------------------*06560000
065700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06570000
065800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06580000
065900* CICS ARCHITECTURE API.                                         *06590000
066000*----------------------------------------------------------------*06600000
066100 2100-CHECK-FUNCTION-KEY.                                         06610000
066200                                                                  06620000
066300     EVALUATE TRUE                                                06630000
066400         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  06640000
066500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06650000
066600                 INITIALIZE VN002-INTER-APPL-COMMAREA             06660000
066700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06670000
066800                                TO VN002-NUMBER-OF-SELECTED-ITEMS 06680000
066900                 PERFORM 5000-PREPARE-SEL-QUEUE                   06690000
067000             ELSE                                                 06700000
067100                 SET DP030-OVERRIDE-GO                            06710000
067200                                   TO TRUE                        06720000
067300                 MOVE PC-TSYMSG-00057                             06730000
067400                                   TO DP020-MSG-NUMBER            06740000
067500                 SET DP020-MSG-WARNING                            06750000
067600                                   TO TRUE                        06760000
067700             END-IF                                               06770000
067800                                                                  06780000
067900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06790000
068000             MOVE +1               TO PV-TOP-ITEM                 06800000
068100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06810000
068200             PERFORM 3200-RESET-ATTRIBUTES                        06820000
068300                                                                  06830000
068400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06840000
068500             PERFORM 2110-BROWSE-BACKWARD                         06850000
068600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06860000
068700             PERFORM 3200-RESET-ATTRIBUTES                        06870000
068800                                                                  06880000
068900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06890000
069000             PERFORM 2120-BROWSE-FORWARD                          06900000
069100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06910000
069200             PERFORM 3200-RESET-ATTRIBUTES                        06920000
069300                                                                  06930000
069400         WHEN DP020-SRC-AID = DP016-ENTER                         06940000
069500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06950000
069600             IF  PS-ERROR                                         06960000
069700                 CONTINUE                                         06970000
069800             ELSE                                                 06980000
069900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06990000
070000             END-IF                                               07000000
070100                                                                  07010000
070200         WHEN OTHER                                               07020000
070300             SET DP013-NO-ROLLBACK                                07030000
070400                 DP013-XCTL-DISPLAY-RESTART                       07040000
070500                 DP013-CICS-ABEND  TO TRUE                        07050000
070600             MOVE '2100-CHECK-FUNCTION-KEY'                       07060000
070700                                   TO DP013-PARAGRAPH             07070000
070800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07080000
070900                                   TO DP013-MESSAGE-TEXT (1)      07090000
071000             PERFORM DP013-0000-PROCESS-ABEND                     07100000
071100     END-EVALUATE.                                                07110000
071200                                                                  07120000
071300*----------------------------------------------------------------*07130000
071400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07140000
071500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07150000
071600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07160000
071700*    MESSAGE.                                                    *07170000
071800*----------------------------------------------------------------*07180000
071900 2110-BROWSE-BACKWARD.                                            07190000
072000                                                                  07200000
072100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07210000
072200         GIVING PV-TOP-ITEM.                                      07220000
072300                                                                  07230000
072400     IF  ((PV-TOP-ITEM < +1)                                      07240000
072500       OR (PV-TOP-ITEM = +1))                                     07250000
072600         MOVE +1                   TO PV-TOP-ITEM                 07260000
072700*        -- TOP OF LIST --                                        07270000
072800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07280000
072900         SET DP020-MSG-INFORMATIONAL TO TRUE                      07290000
073000     END-IF.                                                      07300000
073100                                                                  07310000
073200*----------------------------------------------------------------*07320000
073300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07330000
073400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07340000
073500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07350000
073600*----------------------------------------------------------------*07360000
073700 2120-BROWSE-FORWARD.                                             07370000
073800                                                                  07380000
073900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07390000
074000         GIVING PV-TOP-ITEM.                                      07400000
074100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07410000
074200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07420000
074300                                   TO PV-TOP-ITEM                 07430000
074400*        -- BOTTOM OF LIST --                                     07440000
074500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07450000
074600         SET DP020-MSG-INFORMATIONAL                              07460000
074700                                   TO TRUE                        07470000
074800     ELSE                                                         07480000
074900         COMPUTE PV-BOTTOM-ITEM =                                 07490000
075000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07500000
075100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07510000
075200*            -- BOTTOM OF LIST --                                 07520000
075300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07530000
075400             SET DP020-MSG-INFORMATIONAL                          07540000
075500                                   TO TRUE                        07550000
075600         END-IF                                                   07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900*----------------------------------------------------------------*07590000
076000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07600000
076100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07610000
076200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07620000
076300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07630000
076400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07640000
076500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07650000
076600*----------------------------------------------------------------*07660000
076700 2130-CHECK-FOR-JUMP-BROWSE.                                      07670000
076800                                                                  07680000
076900     SET PS-NO-ERROR               TO TRUE.                       07690000
077000     IF (ASC-START-ITEM-REQUEST = SPACE)                          07700000
077100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07710000
077200                                   TO PV-TOP-ITEM                 07720000
077300     ELSE                                                         07730000
077400         MOVE ASC-START-ITEM-REQUEST                              07740000
077500                                   TO DP010I-UNEDITED-FIELD       07750000
077600         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07760000
077700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07770000
077800         SET DP010I-NEGATIVE-NOT-ALLOWED                          07780000
077900                                   TO TRUE                        07790000
078010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07801028
078020                         USING DP010I-NUMERIC-EDIT-AREA           07802028
078100                                                                  07810000
078200         IF  NOT DP010I-ERROR-DETECTED                            07820000
078300             MOVE DP010I-NUMERIC-FIELD                            07830000
078400                                   TO  ASC-START-ITEM-REQUEST-N   07840000
078500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07850000
078600                 IF  ASC-START-ITEM-REQUEST-N >                   07860000
078700                                          ASC-NUMBER-OF-ITEMS-READ07870000
078800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07880000
078900                     COMPUTE PV-TOP-ITEM =                        07890000
079000                             ASC-NUMBER-OF-ITEMS-READ             07900000
079100                             - PC-ITEMS-PER-PANEL + 1             07910000
079200                     IF  PV-TOP-ITEM < +1                         07920000
079300                         MOVE +1   TO PV-TOP-ITEM                 07930000
079400                         MOVE PC-TSYMSG-00070                     07940000
079500                                   TO DP020-MSG-NUMBER            07950000
079600                         SET DP020-MSG-INFORMATIONAL              07960000
079700                                   TO TRUE                        07970000
079800                     END-IF                                       07980000
079900                 ELSE                                             07990000
080000                     MOVE ASC-START-ITEM-REQUEST-N                08000000
080100                                   TO PV-TOP-ITEM                 08010000
080200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08020000
080300                     COMPUTE PV-BOTTOM-ITEM =                     08030000
080400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08040000
080500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08050000
080600*                        -- BOTTOM OF LIST --                     08060000
080700                         MOVE PC-TSYMSG-00070                     08070000
080800                                   TO DP020-MSG-NUMBER            08080000
080900                         SET DP020-MSG-INFORMATIONAL              08090000
081000                                   TO TRUE                        08100000
081100                     END-IF                                       08110000
081200                 END-IF                                           08120000
081300             ELSE                                                 08130000
081400*                --- VALUE OUT OF RANGE ----                      08140000
081500                 MOVE PC-TSYMSG-00101                             08150000
081600                                   TO DP020-MSG-NUMBER            08160000
081700                 MOVE -1           TO ASTRTITL                    08170000
081800                 SET DP030-SET-CURSOR-APPL-1                      08180000
081900                                   TO TRUE                        08190000
082000                 MOVE DP015-REVERSE                               08200000
082100                                   TO ASTRTITH                    08210000
082200                 MOVE DP015-RED    TO ASTRTITC                    08220000
082300                 MOVE DP015-UNP-NUM-BRT-MDT                       08230000
082400                                   TO ASTRTITA                    08240000
082500                 SET DP020-MSG-FATAL                              08250000
082600                                   TO TRUE                        08260000
082700                 SET PS-ERROR      TO TRUE                        08270000
082800             END-IF                                               08280000
082900                                                                  08290000
083000         ELSE                                                     08300000
083100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08310000
083200             MOVE -1               TO ASTRTITL                    08320000
083300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08330000
083400             MOVE DP015-REVERSE    TO ASTRTITH                    08340000
083500             MOVE DP015-RED        TO ASTRTITC                    08350000
083600             MOVE DP015-UNP-NUM-BRT-MDT                           08360000
083700                                   TO ASTRTITA                    08370000
083800             SET DP020-MSG-FATAL   TO TRUE                        08380000
083900             SET PS-ERROR          TO TRUE                        08390000
084000         END-IF                                                   08400000
084100     END-IF.                                                      08410000
084200                                                                  08420000
084300*----------------------------------------------------------------*08430000
084400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08440000
084500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08450000
084600*----------------------------------------------------------------*08460000
084700 2140-DESELECT-ALL-ITEMS.                                         08470000
084800                                                                  08480000
084900     MOVE +1                       TO ASC-BLK-SUB.                08490000
085000                                                                  08500000
085100     PERFORM 2141-CLEAR-SELECTED-INDS                             08510000
085200         VARYING ASC-ITEM-SUB                                     08520000
085300         FROM 1 BY 1                                              08530000
085400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08540000
085500                                                                  08550000
085600     ADD +1                        TO ASC-BLK-SUB.                08560000
085700                                                                  08570000
085800     PERFORM 2141-CLEAR-SELECTED-INDS                             08580000
085900         VARYING ASC-ITEM-SUB                                     08590000
086000         FROM 1 BY 1                                              08600000
086100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08610000
086200                                                                  08620000
086300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08630000
086400                                   TO PV-LIST-ITEM-NUMBER.        08640000
086500                                                                  08650000
086600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08660000
086700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08670000
086800                                                                  08680000
086900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08690000
087000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08700000
087100         MOVE +1                   TO ASC-BLK-SUB                 08710000
087200                                                                  08720000
087300         PERFORM 5100-WRITE-TEMP-STORAGE                          08730000
087400                                                                  08740000
087500         MOVE +1                   TO PV-BLOCK-NUMBER             08750000
087600                                                                  08760000
087700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08770000
087800             PV-FIRST-BLOCK-IN-ARRAY - 1                          08780000
087900                                                                  08790000
088000         PERFORM                                                  08800000
088100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08810000
088200                                                                  08820000
088300             PERFORM 4410-READ-TEMP-STORAGE                       08830000
088400                                                                  08840000
088500             PERFORM 2141-CLEAR-SELECTED-INDS                     08850000
088600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08860000
088700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08870000
088800                                                                  08880000
088900             PERFORM 5100-WRITE-TEMP-STORAGE                      08890000
089000                                                                  08900000
089100             ADD +1                TO PV-BLOCK-NUMBER             08910000
089200                                                                  08920000
089300         END-PERFORM                                              08930000
089400                                                                  08940000
089500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08950000
089600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08960000
089700                                                                  08970000
089800         PERFORM                                                  08980000
089900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08990000
090000                   ASC-HIGHEST-BLOCK-WRITTEN                      09000000
090100                                                                  09010000
090200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09020000
090300                                   TO PV-BLOCK-NUMBER             09030000
090400                                                                  09040000
090500             PERFORM 4410-READ-TEMP-STORAGE                       09050000
090600                                                                  09060000
090700             PERFORM 2141-CLEAR-SELECTED-INDS                     09070000
090800                 VARYING ASC-ITEM-SUB                             09080000
090900                 FROM 1 BY 1                                      09090000
091000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09100000
091100                                                                  09110000
091200             PERFORM 5100-WRITE-TEMP-STORAGE                      09120000
091300                                                                  09130000
091400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09140000
091500                                                                  09150000
091600         END-PERFORM                                              09160000
091700                                                                  09170000
091800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09180000
091900                                   TO PV-BLOCK-NUMBER             09190000
092000                                                                  09200000
092100         PERFORM 4410-READ-TEMP-STORAGE                           09210000
092200     END-IF.                                                      09220000
092300                                                                  09230000
092400                                                                  09240000
092500     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09250000
092600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09260000
092700     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09270000
092800                                                                  09280000
092900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09290000
093000                                                                  09300000
093100*----------------------------------------------------------------*09310000
093200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09320000
093300*----------------------------------------------------------------*09330000
093400 2141-CLEAR-SELECTED-INDS.                                        09340000
093500                                                                  09350000
093600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09360000
093700             NOT EQUAL ZERO                                       09370000
093800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09380000
093900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09390000
094000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09400000
094100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09410000
094200                                   TO TRUE                        09420000
094300         END-IF                                                   09430000
094400     END-IF.                                                      09440000
094500                                                                  09450000
094600*----------------------------------------------------------------*09460000
094700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09470000
094800*  FOR ALL ITEMS.                                                *09480000
094900*----------------------------------------------------------------*09490000
095000 2150-SELECT-ALL-ITEMS.                                           09500000
095100                                                                  09510000
095200     MOVE +1                       TO ASC-BLK-SUB.                09520000
095300                                                                  09530000
095400     PERFORM 2151-SET-SELECTED-INDS                               09540000
095500         VARYING ASC-ITEM-SUB                                     09550000
095600         FROM 1 BY 1                                              09560000
095700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09570000
095800                                                                  09580000
095900     ADD +1                        TO ASC-BLK-SUB.                09590000
096000                                                                  09600000
096100     PERFORM 2151-SET-SELECTED-INDS                               09610000
096200         VARYING ASC-ITEM-SUB                                     09620000
096300         FROM 1 BY 1                                              09630000
096400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09640000
096500                                                                  09650000
096600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09660000
096700                                   TO PV-LIST-ITEM-NUMBER.        09670000
096800                                                                  09680000
096900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09690000
097000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09700000
097100                                                                  09710000
097200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09720000
097300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09730000
097400         MOVE +1                   TO ASC-BLK-SUB                 09740000
097500                                                                  09750000
097600         PERFORM 5100-WRITE-TEMP-STORAGE                          09760000
097700                                                                  09770000
097800         MOVE +1                   TO PV-BLOCK-NUMBER             09780000
097900                                                                  09790000
098000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09800000
098100             PV-FIRST-BLOCK-IN-ARRAY - 1                          09810000
098200                                                                  09820000
098300         PERFORM                                                  09830000
098400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09840000
098500                                                                  09850000
098600             PERFORM 4410-READ-TEMP-STORAGE                       09860000
098700                                                                  09870000
098800             PERFORM 2151-SET-SELECTED-INDS                       09880000
098900                 VARYING ASC-ITEM-SUB                             09890000
099000                 FROM 1 BY 1                                      09900000
099100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09910000
099200                                                                  09920000
099300             PERFORM 5100-WRITE-TEMP-STORAGE                      09930000
099400                                                                  09940000
099500             ADD +1                TO PV-BLOCK-NUMBER             09950000
099600                                                                  09960000
099700         END-PERFORM                                              09970000
099800                                                                  09980000
099900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09990000
100000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10000000
100100                                                                  10010000
100200         PERFORM                                                  10020000
100300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10030000
100400                   ASC-HIGHEST-BLOCK-WRITTEN                      10040000
100500                                                                  10050000
100600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10060000
100700                                   TO PV-BLOCK-NUMBER             10070000
100800                                                                  10080000
100900             PERFORM 4410-READ-TEMP-STORAGE                       10090000
101000                                                                  10100000
101100             PERFORM 2151-SET-SELECTED-INDS                       10110000
101200                 VARYING ASC-ITEM-SUB                             10120000
101300                 FROM 1 BY 1                                      10130000
101400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10140000
101500                                                                  10150000
101600             PERFORM 5100-WRITE-TEMP-STORAGE                      10160000
101700                                                                  10170000
101800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10180000
101900                                                                  10190000
102000         END-PERFORM                                              10200000
102100                                                                  10210000
102200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10220000
102300                                   TO PV-BLOCK-NUMBER             10230000
102400                                                                  10240000
102500         PERFORM 4410-READ-TEMP-STORAGE                           10250000
102600     END-IF.                                                      10260000
102700                                                                  10270000
102800                                                                  10280000
102900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10290000
103000                       ASC-NUMBER-OF-SELECTED-ITEMS.              10300000
103100                                                                  10310000
103200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10320000
103300                                                                  10330000
103400*----------------------------------------------------------------*10340000
103500*    MARK EACH ITEM AS BEING SELECTED.                           *10350000
103600*----------------------------------------------------------------*10360000
103700 2151-SET-SELECTED-INDS.                                          10370000
103800                                                                  10380000
103900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10390000
104000             NOT EQUAL ZERO                                       10400000
104100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10410000
104200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10420000
104300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10430000
104400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10440000
104500                               TO  TRUE                           10450000
104600         END-IF                                                   10460000
104700     END-IF.                                                      10470000
104800                                                                  10480000
104900******************************************************************10490000
105000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10500000
105100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10510000
105200******************************************************************10520000
105300 2200-MOVE-SCREEN-TO-COMMAREA.                                    10530000
105400                                                                  10540000
105500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10550000
105600     MOVE +1                       TO PV-SUB.                     10560000
105700                                                                  10570000
105800     PERFORM 3100-SET-SUBSCRIPTS.                                 10580000
105900                                                                  10590000
106000     IF  ASTRTITL > ZERO                                          10600000
106100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10610000
106200     ELSE                                                         10620000
106300         IF  ASTRTITF = DP015-ERASE-EOF                           10630000
106400             INITIALIZE ASC-START-ITEM-REQUEST                    10640000
106500         END-IF                                                   10650000
106600     END-IF.                                                      10660000
106700                                                                  10670000
106800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10680000
106900         VARYING PV-SUB                                           10690000
107000         FROM 1 BY 1                                              10700000
107100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10710000
107200                                                                  10720000
107300******************************************************************10730000
107400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10740000
107500******************************************************************10750000
107600 2210-MOVE-LINES-TO-COMMAREA.                                     10760000
107700                                                                  10770000
107800     IF  MR-SELECTL (PV-SUB) > ZERO                               10780000
107900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10790000
108000         MOVE MR-SELECTI (PV-SUB)                                 10800000
108100                                   TO ASC-TEMP-SELECTED-SW        10810000
108200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10820000
108300     ELSE                                                         10830000
108400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10840000
108500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10850000
108600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10860000
108700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10870000
108800         END-IF                                                   10880000
108900     END-IF.                                                      10890000
109000                                                                  10900000
109100     ADD +1                        TO ASC-ITEM-SUB.               10910000
109200                                                                  10920000
109300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10930000
109400         ADD +1                    TO ASC-BLK-SUB                 10940000
109500         MOVE +1                   TO ASC-ITEM-SUB                10950000
109600     END-IF.                                                      10960000
109700                                                                  10970000
109800******************************************************************10980000
109900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10990000
110000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11000000
110100******************************************************************11010000
110200 3000-EDIT-DATA-IN-COMMAREA.                                      11020000
110300                                                                  11030000
110400     SET PS-NO-ERROR               TO TRUE.                       11040000
110500                                                                  11050000
110600     PERFORM 3200-RESET-ATTRIBUTES.                               11060000
110700                                                                  11070000
110800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11080000
110900**                                                                11090000
111000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11100000
111100* EDITTING IS DONE FROM THE BOTTOM UP.                            11110000
111200**                                                                11120000
111300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11130000
111400         ASC-ITEMS-DISPLAYED - 1.                                 11140000
111500                                                                  11150000
111600     PERFORM 3100-SET-SUBSCRIPTS.                                 11160000
111700                                                                  11170000
111800     PERFORM 3300-EDIT-SELECTIONS                                 11180000
111900         VARYING PV-SUB                                           11190000
112000         FROM PV-SUB BY -1                                        11200000
112100         UNTIL PV-SUB < +1                                        11210000
112200                                                                  11220000
112300     IF  PS-NO-ERROR                                              11230000
112400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11240000
112500     END-IF.                                                      11250000
112600                                                                  11260000
112700     IF  ((PS-NO-ERROR)                                           11270000
112800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11280000
112900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11290000
113000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11300000
113100     END-IF.                                                      11310000
113200                                                                  11320000
113300*----------------------------------------------------------------*11330000
113400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11340000
113500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11350000
113600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11360000
113700*                                                                *11370000
113800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11380000
113900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11390000
114000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11400000
114100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11410000
114200*----------------------------------------------------------------*11420000
114300 3100-SET-SUBSCRIPTS.                                             11430000
114400                                                                  11440000
114500     COMPUTE ASC-ITEM-SUB =                                       11450000
114600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11460000
114700                                                                  11470000
114800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11480000
114900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11490000
115000                                                                  11500000
115100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11510000
115200     ELSE                                                         11520000
115300         MOVE +1                     TO ASC-BLK-SUB               11530000
115400     END-IF.                                                      11540000
115500                                                                  11550000
115600******************************************************************11560000
115700** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11570000
115800******************************************************************11580000
115900 3200-RESET-ATTRIBUTES.                                           11590000
116000                                                                  11600000
116100     MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      11610000
116200     MOVE DP015-GREEN           TO ASTRTITC.                      11620000
116300     MOVE DP015-UNDERLINE       TO ASTRTITH.                      11630000
116400                                                                  11640000
116500     IF DP020-NEXT-ACT-RETURN OR                                  11650000
116600        DP020-NEXT-ACT-READ-MAP                                   11660000
116700         PERFORM VARYING PV-SUB  FROM 1 BY 1                      11670000
116800                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             11680000
116900                  MOVE DP015-UNP-ALP-NOR-OFF                      11690000
117000                                       TO MR-SELECTA (PV-SUB)     11700000
117100                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     11710000
117200                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     11720000
117300         END-PERFORM                                              11730000
117400     ELSE                                                         11740000
117500         PERFORM VARYING PV-SUB  FROM 1 BY 1                      11750000
117600                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              11760000
117700                  MOVE DP015-UNP-ALP-NOR-OFF                      11770000
117800                                       TO MR-SELECTA (PV-SUB)     11780000
117900                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     11790000
118000                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     11800000
118100         END-PERFORM.                                             11810000
118200                                                                  11820000
118300******************************************************************11830000
118400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11840000
118500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11850000
118600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11860000
118700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11870000
118800******************************************************************11880000
118900 3300-EDIT-SELECTIONS.                                            11890000
119000                                                                  11900000
119100     EVALUATE TRUE                                                11910000
119200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11920000
119300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11930000
119400                 CONTINUE                                         11940000
119500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11950000
119600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11960000
119700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11970000
119800                 MOVE ASC-TEMP-SELECTED-SW                        11980000
119900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11990000
120000                                TO ASC-SELECTED-SW                12000000
120100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12010000
120200             END-IF                                               12020000
120300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12030000
120400                 = SPACE                                          12040000
120500             EVALUATE TRUE                                        12050000
120600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12060000
120700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12070000
120800                     MOVE SPACE TO ASC-SELECTED-SW                12080000
120900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12090000
121000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12100000
121100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12110000
121200                     MOVE SPACE TO ASC-SELECTED-SW                12120000
121300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12130000
121400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12140000
121500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12150000
121600                     MOVE SPACE TO ASC-SELECTED-SW                12160000
121700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12170000
121800             END-EVALUATE                                         12180000
121900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12190000
122000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12200000
122100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12210000
122200             END-IF                                               12220000
122300             PERFORM 3310-EDIT-RANGE                              12230000
122400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12240000
122500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12250000
122600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12260000
122700             END-IF                                               12270000
122800             PERFORM 3310-EDIT-RANGE                              12280000
122900         WHEN OTHER                                               12290000
123000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12300000
123100             SET DP020-MSG-FATAL    TO TRUE                       12310000
123200             MOVE -1                TO MR-SELECTL (PV-SUB)        12320000
123300             SET DP030-SET-CURSOR-APPL-1                          12330000
123400                                    TO TRUE                       12340000
123500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12350000
123600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12360000
123700             SET PS-ERROR TO TRUE                                 12370000
123800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12380000
123900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12390000
124000                 MOVE SPACE         TO ASC-SELECTED-SW            12400000
124100                                        (ASC-BLK-SUB ASC-ITEM-SUB)12410000
124200             END-IF                                               12420000
124300     END-EVALUATE.                                                12430000
124400                                                                  12440000
124500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12450000
124600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12460000
124700     IF  ASC-ITEM-SUB < 1                                         12470000
124800         SUBTRACT +1 FROM ASC-BLK-SUB                             12480000
124900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12490000
125000     END-IF.                                                      12500000
125100                                                                  12510000
125200******************************************************************12520000
125300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12530000
125400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12540000
125500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12550000
125600** THE ENDING.                                                  **12560000
125700******************************************************************12570000
125800 3310-EDIT-RANGE.                                                 12580000
125900                                                                  12590000
126000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12600000
126100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12610000
126200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12620000
126300                                   TO ASC-SELECTED-SW             12630000
126400                                        (ASC-BLK-SUB ASC-ITEM-SUB)12640000
126500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12650000
126600         ELSE                                                     12660000
126700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12670000
126800                 CONTINUE                                         12680000
126900             ELSE                                                 12690000
127000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12700000
127100                 MOVE PC-TSYMSG-00054                             12710000
127200                                   TO DP020-MSG-NUMBER            12720000
127300                 SET DP020-MSG-FATAL                              12730000
127400                                   TO TRUE                        12740000
127500                 MOVE -1           TO MR-SELECTL (PV-SUB)         12750000
127600                 SET DP030-SET-CURSOR-APPL-1                      12760000
127700                                   TO TRUE                        12770000
127800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12780000
127900                 MOVE DP015-UNDERLINE                             12790000
128000                                   TO MR-SELECTH (PV-SUB)         12800000
128100                 SET PS-ERROR      TO TRUE                        12810000
128200             END-IF                                               12820000
128300         END-IF                                                   12830000
128400     ELSE                                                         12840000
128500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12850000
128600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12860000
128700                                   TO ASC-SELECTED-SW             12870000
128800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12880000
128900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12890000
129000         ELSE                                                     12900000
129100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12910000
129200                 CONTINUE                                         12920000
129300             ELSE                                                 12930000
129400*                -- ONLY ONE END-OF-RANGE ALLOWED --              12940000
129500                 MOVE PC-TSYMSG-00055                             12950000
129600                                   TO DP020-MSG-NUMBER            12960000
129700                 SET DP020-MSG-FATAL                              12970000
129800                                   TO TRUE                        12980000
129900                 MOVE -1           TO MR-SELECTL (PV-SUB)         12990000
130000                 SET DP030-SET-CURSOR-APPL-1                      13000000
130100                                   TO TRUE                        13010000
130200                 SET PS-ERROR      TO TRUE                        13020000
130300             END-IF                                               13030000
130400         END-IF                                                   13040000
130500     END-IF.                                                      13050000
130600                                                                  13060000
130700******************************************************************13070000
130800** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13080000
130900** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13090000
131000******************************************************************13100000
131100 3400-CHECK-RANGE-SEQUENCE.                                       13110000
131200                                                                  13120000
131300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13130000
131400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13140000
131500       AND  ASC-START-OF-SELECTED-RANGE >                         13150000
131600                                         ASC-END-OF-SELECTED-RANGE13160000
131700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13170000
131800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13180000
131900         SET DP020-MSG-FATAL TO TRUE                              13190000
132000         SET PS-ERROR TO TRUE                                     13200000
132100         PERFORM 3410-POSITION-AT-ERROR                           13210000
132200     END-IF.                                                      13220000
132300                                                                  13230000
132400******************************************************************13240000
132500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13250000
132600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13260000
132700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13270000
132800******************************************************************13280000
132900 3410-POSITION-AT-ERROR.                                          13290000
133000                                                                  13300000
133100     SET DP030-SET-CURSOR-APPL-1                                  13310000
133200                                   TO TRUE.                       13320000
133300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13330000
133400                    - PV-TOP-ITEM + 1.                            13340000
133500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13350000
133600         CONTINUE                                                 13360000
133700     ELSE                                                         13370000
133800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13380000
133900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13390000
134000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13400000
134100     END-IF.                                                      13410000
134200                                                                  13420000
134300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13430000
134400                    - PV-TOP-ITEM + 1.                            13440000
134500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13450000
134600         CONTINUE                                                 13460000
134700     ELSE                                                         13470000
134800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13480000
134900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13490000
135000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13500000
135100     END-IF.                                                      13510000
135200                                                                  13520000
135300*----------------------------------------------------------------*13530000
135400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13540000
135500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13550000
135600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13560000
135700*----------------------------------------------------------------*13570000
135800 3500-MARK-RANGE-AS-SELECTED.                                     13580000
135900                                                                  13590000
136000     MOVE +1                       TO  ASC-BLK-SUB.               13600000
136100                                                                  13610000
136200     PERFORM 3510-MARK-SELECTED-INDS                              13620000
136300         VARYING ASC-ITEM-SUB                                     13630000
136400         FROM 1 BY 1                                              13640000
136500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13650000
136600                                                                  13660000
136700     ADD +1                        TO ASC-BLK-SUB.                13670000
136800                                                                  13680000
136900     PERFORM 3510-MARK-SELECTED-INDS                              13690000
137000         VARYING ASC-ITEM-SUB                                     13700000
137100         FROM 1 BY 1                                              13710000
137200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13720000
137300                                                                  13730000
137400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13740000
137500                                   TO  PV-LIST-ITEM-NUMBER.       13750000
137600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13760000
137700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13770000
137800               PC-ITEMS-PER-PANEL).                               13780000
137900                                                                  13790000
138000     MOVE ASC-START-OF-SELECTED-RANGE                             13800000
138100                                   TO PV-START-OF-SELECTED-RANGE. 13810000
138200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13820000
138300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13830000
138400               PC-ITEMS-PER-PANEL).                               13840000
138500                                                                  13850000
138600     MOVE ASC-END-OF-SELECTED-RANGE                               13860000
138700                                   TO  PV-END-OF-SELECTED-RANGE.  13870000
138800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13880000
138900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13890000
139000               PC-ITEMS-PER-PANEL).                               13900000
139100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13910000
139200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13920000
139300                                                                  13930000
139400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13940000
139500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13950000
139600         MOVE +1                   TO ASC-BLK-SUB                 13960000
139700         PERFORM 5100-WRITE-TEMP-STORAGE                          13970000
139800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13980000
139900             PV-FIRST-BLOCK-IN-ARRAY - 1                          13990000
140000                                                                  14000000
140100         PERFORM                                                  14010000
140200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14020000
140300                   PV-PREV-BLOCK-IN-ARRAY                         14030000
140400             MOVE PV-FIRST-BLOCK-IN-RANGE                         14040000
140500                                   TO PV-BLOCK-NUMBER             14050000
140600             PERFORM 4410-READ-TEMP-STORAGE                       14060000
140700             PERFORM 3510-MARK-SELECTED-INDS                      14070000
140800                 VARYING ASC-ITEM-SUB                             14080000
140900                 FROM 1 BY 1                                      14090000
141000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14100000
141100             PERFORM 5100-WRITE-TEMP-STORAGE                      14110000
141200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14120000
141300         END-PERFORM                                              14130000
141400                                                                  14140000
141500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14150000
141600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14160000
141700         PERFORM                                                  14170000
141800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14180000
141900                   PV-LAST-BLOCK-IN-RANGE                         14190000
142000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14200000
142100                                   TO PV-BLOCK-NUMBER             14210000
142200             PERFORM 4410-READ-TEMP-STORAGE                       14220000
142300             PERFORM 3510-MARK-SELECTED-INDS                      14230000
142400                 VARYING ASC-ITEM-SUB                             14240000
142500                 FROM 1 BY 1                                      14250000
142600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14260000
142700             PERFORM 5100-WRITE-TEMP-STORAGE                      14270000
142800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14280000
142900         END-PERFORM                                              14290000
143000                                                                  14300000
143100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14310000
143200                                   TO PV-BLOCK-NUMBER             14320000
143300         PERFORM 4410-READ-TEMP-STORAGE                           14330000
143400     END-IF.                                                      14340000
143500                                                                  14350000
143600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14360000
143700                                      ASC-END-OF-SELECTED-RANGE.  14370000
143800                                                                  14380000
143900*----------------------------------------------------------------*14390000
144000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14400000
144100*----------------------------------------------------------------*14410000
144200 3510-MARK-SELECTED-INDS.                                         14420000
144300                                                                  14430000
144400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14440000
144500                                ASC-ITEM-SUB) >                   14450000
144600         ASC-START-OF-SELECTED-RANGE)                             14460000
144700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14470000
144800                                ASC-ITEM-SUB) =                   14480000
144900         ASC-START-OF-SELECTED-RANGE)                             14490000
145000                                                                  14500000
145100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14510000
145200                                    ASC-ITEM-SUB) <               14520000
145300             ASC-END-OF-SELECTED-RANGE)                           14530000
145400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14540000
145500                                    ASC-ITEM-SUB) =               14550000
145600             ASC-END-OF-SELECTED-RANGE)                           14560000
145700                                                                  14570000
145800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14580000
145900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14590000
146000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14600000
146100                               TO TRUE                            14610000
146200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14620000
146300                               TO TRUE                            14630000
146400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14640000
146500             END-IF                                               14650000
146600         END-IF                                                   14660000
146700     END-IF.                                                      14670000
146800                                                                  14680000
146900*----------------------------------------------------------------*14690000
147000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14700000
147100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14710000
147200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14720000
147300*    DISPLAY THE PANEL TO USER.                                  *14730000
147400*----------------------------------------------------------------*14740000
147500 4000-BUILD-INITIAL-PANEL.                                        14750000
147600                                                                  14760000
147700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             14770000
147800                ASC-BLOCK-ENTRIES (2).                            14780000
147900     MOVE +1 TO ASC-BLK-SUB.                                      14790000
148000     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            14800000
148100                                                                  14810000
148200     MOVE ZERO TO ASC-ITEM-SUB                                    14820000
148300                  ASC-NUMBER-OF-ITEMS-READ                        14830000
148400                  ASC-NUMBER-OF-SELECTED-ITEMS                    14840000
148500                  ASC-HIGHEST-BLOCK-WRITTEN                       14850000
148600                  ASC-START-OF-SELECTED-RANGE                     14860000
148700                  ASC-END-OF-SELECTED-RANGE                       14870000
148800                  ASC-ITEM-AT-TOP-OF-PANEL.                       14880000
148900                                                                  14890000
149000     EVALUATE TRUE                                                14900000
149100         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               14910000
149200              MOVE PC-ACTIVE   TO PV-STAT1                        14920000
149300              MOVE PC-ACTIVE   TO PV-STAT2                        14930000
149400         WHEN OTHER                                               14940000
149500              MOVE PC-ACTIVE   TO PV-STAT1                        14950000
149600              MOVE PC-INACTIVE TO PV-STAT2                        14960000
149700     END-EVALUATE.                                                14970000
149800                                                                  14980000
149900     PERFORM 4100-OPEN-CURSOR.                                    14990000
150000                                                                  15000000
150100     PERFORM 4200-READ-ITEMS-FROM-DB.                             15010000
150200                                                                  15020000
150300     PERFORM 4300-CLOSE-CURSOR.                                   15030000
150400                                                                  15040000
150500     PERFORM 4500-GET-OTHER-SCREEN-FIELDS.                        15050000
150600                                                                  15060000
150700     MOVE +1 TO PV-TOP-ITEM.                                      15070000
150800                                                                  15080000
150900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15090000
151000         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15100000
151100         SET DP020-MSG-FATAL   TO  TRUE                           15110000
151200         MOVE PC-TSYMSG-00155  TO  DP020-MSG-NUMBER               15120000
151300     ELSE                                                         15130000
151400         MOVE -1               TO MR-SELECTL (1)                  15140000
151500         SET DP030-SET-CURSOR-APPL-1                              15150000
151600                               TO TRUE                            15160000
151700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15170000
151800     END-IF.                                                      15180000
151900                                                                  15190000
152000*----------------------------------------------------------------*15200000
152100* OPEN  THE VENDOR   CURSOR.                                     *15210000
152200*----------------------------------------------------------------*15220000
152300 4100-OPEN-CURSOR.                                                15230000
152400                                                                  15240000
152500     PERFORM                                                      15250000
152600         WITH TEST AFTER                                          15260000
152700         VARYING PV-RETRY-COUNTER                                 15270000
152800         FROM 1 BY 1                                              15280000
152900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15290000
153000                   OR (SQLCODE = ZERO))                           15300000
153100             MOVE 'CURSOR:  VENDOR-CSR'                           15310000
153200                               TO DP013-MESSAGE-TEXT (2)          15320000
153300             EXEC SQL                                             15330000
153400                  OPEN VENDOR-CSR                                 15340000
153500             END-EXEC                                             15350000
153600                                                                  15360000
153700         EVALUATE TRUE                                            15370000
153800             WHEN SQLCODE = ZERO                                  15380000
153900             WHEN SQLCODE = -904                                  15390000
154000             WHEN SQLCODE = -913                                  15400000
154100                 CONTINUE                                         15410000
154200             WHEN SQLWARN0 NOT = SPACES                           15420000
154300             WHEN SQLCODE < ZERO                                  15430000
154400             WHEN SQLCODE > ZERO                                  15440000
154500                 MOVE '4100-OPEN-CURSOR'                          15450000
154600                                   TO DP013-PARAGRAPH             15460000
154700                 MOVE 'OPEN VENDOR CURSOR - '                     15470000
154800                                   TO DP013-MESSAGE-TEXT (1)      15480000
154900                 MOVE SQLCA        TO DP013-SQLCA                 15490000
155000                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    15500000
155100                 SET DP013-DB2-ABEND                              15510000
155200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15520000
155300                 PERFORM DP013-0000-PROCESS-ABEND                 15530000
155400         END-EVALUATE                                             15540000
155500     END-PERFORM.                                                 15550000
155600                                                                  15560000
155700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15570000
155800         MOVE '4100-OPEN-CURSOR'   TO DP013-PARAGRAPH             15580000
155900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15590000
156000                                   TO DP013-MESSAGE-TEXT (1)      15600000
156100         MOVE SQLCA                TO DP013-SQLCA                 15610000
156200         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    15620000
156300         SET DP013-DB2-ABEND                                      15630000
156400             DP013-XCTL-DISPLAY-RESTART                           15640000
156500                                   TO TRUE                        15650000
156600         PERFORM DP013-0000-PROCESS-ABEND                         15660000
156700     END-IF.                                                      15670000
156800                                                                  15680000
156900*----------------------------------------------------------------*15690000
157000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15700000
157100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15710000
157200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15720000
157300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15730000
157400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15740000
157500*                                                                *15750000
157600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15760000
157700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15770000
157800*    UPON INITIALIZATION.                                        *15780000
157900*----------------------------------------------------------------*15790000
158000 4200-READ-ITEMS-FROM-DB.                                         15800000
158100                                                                  15810000
158200     PERFORM                                                      15820000
158300         VARYING PV-READ-COUNT                                    15830000
158400         FROM 1 BY 1                                              15840000
158500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15850000
158600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15860000
158700                                                                  15870000
158800         PERFORM 4210-FETCH                                       15880000
158900                                                                  15890000
159000         IF  ASC-ITEMS-LEFT-ON-DB                                 15900000
159100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15910000
159200                 ADD +1            TO ASC-ITEM-SUB                15920000
159300             ELSE                                                 15930000
159400                 ADD +1            TO ASC-BLK-SUB                 15940000
159500                 MOVE +1           TO ASC-ITEM-SUB                15950000
159600                                                                  15960000
159700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         15970000
159800                     MOVE +1       TO ASC-BLK-SUB                 15980000
159900                     SET ASC-BLOCK-MODIFIED (1)                   15990000
160000                                   TO TRUE                        16000000
160100                     PERFORM 5100-WRITE-TEMP-STORAGE              16010000
160200                     MOVE ASC-BLOCK-ENTRIES                       16020000
160300                               (PC-MAX-BLOCKS-IN-ARRAY)           16030000
160400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16040000
160500                     ADD +1        TO ASC-BLK-SUB                 16050000
160600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16060000
160700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16070000
160800                                   TO TRUE                        16080000
160900                 END-IF                                           16090000
161000             END-IF                                               16100000
161100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16110000
161200             MOVE ASC-NUMBER-OF-ITEMS-READ                        16120000
161300                                   TO ASC-LIST-ITEM-NUMBER        16130000
161400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16140000
161500             IF VNDDPT-VEND-TYP-IND NOT = 'E'                     16150000
161600                 MOVE 'M' TO ASC-VEND-TYPE                        16160000
161700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16170000
161800             ELSE                                                 16180000
161900                 MOVE 'E' TO ASC-VEND-TYPE                        16190000
162000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16200000
162100             END-IF                                               16210000
162200             MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME           16220000
162300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16230000
162400             MOVE EXTENT-DUN-NBR     TO ASC-DUN-NBR               16240000
162500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16250000
162600             MOVE VNDDPT-INHOUSE-NBR TO ASC-INHOUSE-NBR           16260000
162700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16270000
162800             MOVE VNDDPT-ENT-ID      TO ASC-ENT-ID                16280000
162900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16290000
163000             MOVE VNDDPT-VND-DEPT-STAT-CD     TO ASC-STATUS-IND   16300000
163100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16310000
163200* UPC CATALOG / NETWORK NAME PROCESSING                           16320026
163300* '%' IS USED TO SUBSTITUTE FOR A NULL OR BLANK VALUE             16330026
163400             IF NETWRK-NETWK-NME = '%'                            16340009
163500                  MOVE SPACES TO ASC-UPC-CATALOG-NM               16350009
163600                                    (ASC-BLK-SUB ASC-ITEM-SUB)    16360009
163700             ELSE                                                 16370009
163800                 IF NETWRK-NETWK-NME =   PC-SEARS                 16380009
163900*                QRS IS SYNONYMOUS WITH THE SEARS/IBM RELATIONSHIP16390026
164000                    MOVE PC-QRS          TO PV-EDIT-PAYT-TERM-ID  16400009
164100                    MOVE PC-QRS          TO ASC-UPC-CATALOG-NM    16410009
164200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     16420009
164300                 ELSE                                             16430009
164400                   MOVE NETWRK-NETWK-NME   TO PV-EDIT-PAYT-TERM-ID16440009
164500                   MOVE NETWRK-NETWK-NME   TO ASC-UPC-CATALOG-NM  16450009
164600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16460009
164700                 END-IF                                           16470009
164800             END-IF                                               16480010
164900                                                                  16490026
165000             PERFORM 4220-GET-PAYMENT-TERMS                       16500022
165100                                                                  16510000
165200             PERFORM 4230-GET-EDI-INDICATOR                       16520000
165300                                                                  16530000
165400             PERFORM 4240-GET-PRETICKET-IND                       16540000
165500         END-IF                                                   16550000
165600     END-PERFORM.                                                 16560000
165700                                                                  16570000
165800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16580000
165900         MOVE +1               TO ASC-BLK-SUB                     16590000
166000         PERFORM 5100-WRITE-TEMP-STORAGE                          16600000
166100         ADD +1                TO ASC-BLK-SUB                     16610000
166200         PERFORM 5100-WRITE-TEMP-STORAGE                          16620000
166300                                                                  16630000
166400         MOVE 1                TO ASC-BLK-SUB                     16640000
166500                                  PV-BLOCK-NUMBER                 16650000
166600         PERFORM 4410-READ-TEMP-STORAGE                           16660000
166700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16670000
166800             MOVE 2            TO ASC-BLK-SUB                     16680000
166900                                  PV-BLOCK-NUMBER                 16690000
167000             PERFORM 4410-READ-TEMP-STORAGE                       16700000
167100         END-IF                                                   16710000
167200     END-IF.                                                      16720000
167300                                                                  16730000
167400*----------------------------------------------------------------*16740000
167500*    FETCH THE MESSAGE CURSOR.                                   *16750000
167600*----------------------------------------------------------------*16760000
167700 4210-FETCH.                                                      16770000
167800                                                                  16780000
167900     EXEC SQL                                                     16790000
168000          FETCH VENDOR-CSR                                        16800000
168100          INTO  :VNDDPT-ENT-ID                                    16810000
168200               ,:VNDDPT-INHOUSE-NBR                               16820000
168300               ,:VNDDPT-VEND-TYP-IND                              16830000
168400               ,:VNDDPT-VND-DEPT-STAT-CD                          16840000
168500               ,:EXTENT-DUN-NBR                                   16850000
168600               ,:ENTNME-ENT-NAME-DESC                             16860000
168700               ,:NETWRK-NETWK-NME                                 16870009
168800     END-EXEC                                                     16880000
168900                                                                  16890000
169000     EVALUATE TRUE                                                16900000
169100         WHEN SQLCODE = ZERO                                      16910000
169200         WHEN SQLCODE = +100                                      16920000
169300              CONTINUE                                            16930000
169400         WHEN SQLWARN0 NOT = SPACE                                16940000
169500         WHEN SQLCODE NOT = ZERO                                  16950000
169600              MOVE '4310-FETCH-CURSOR'                            16960000
169700                               TO DP013-PARAGRAPH                 16970000
169800              MOVE 'FETCH VENDOR CURSOR'                          16980000
169900                               TO DP013-MESSAGE-TEXT (1)          16990000
170000              MOVE SQLCA       TO DP013-SQLCA                     17000000
170100              SET DP013-DB2-ABEND                                 17010000
170200                               TO TRUE                            17020000
170300              PERFORM DP013-0000-PROCESS-ABEND                    17030000
170400     END-EVALUATE.                                                17040000
170500                                                                  17050000
170600     IF  SQLCODE EQUAL +100                                       17060000
170700         SET ASC-NO-ITEMS-LEFT-ON-DB                              17070000
170800                                   TO TRUE                        17080000
170900     END-IF.                                                      17090000
171000                                                                  17100000
171100*----------------------------------------------------------------*17110004
171200* OBTAIN THE PAYMENT TERMS FOR THE VENDOR                        *17120004
171300*----------------------------------------------------------------*17130004
171400 4220-GET-PAYMENT-TERMS.                                          17140000
171500                                                                  17150000
171600     PERFORM                                                      17160000
171700         WITH TEST AFTER                                          17170000
171800         VARYING PV-RETRY-COUNTER                                 17180000
171900         FROM 1 BY 1                                              17190000
172000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17200000
172100             OR (SQLCODE = +0)                                    17210000
172200             OR (SQLCODE = +100))                                 17220000
172300                                                                  17230000
172400         EXEC SQL                                                 17240000
172500               SELECT B.PAY_TERM_ID                               17250000
172600                     ,B.DISCOUNT_DAYS_QTY                         17260000
172700                     ,B.DISCOUNT_PCT                              17270000
172800                     ,B.DUE_DAY_QTY                               17280000
172900                     ,B.DUE_DAY_FR_DTE_TXT                        17290000
173000                     ,B.OTHER_TXT                                 17300000
173100                INTO :PAYTRM-PAY-TERM-ID                          17310000
173200                    ,:PAYTRM-DISCOUNT-DAYS-QTY                    17320000
173300                    ,:PAYTRM-DISCOUNT-PCT                         17330000
173400                    ,:PAYTRM-DUE-DAY-QTY                          17340000
173500                    ,:PAYTRM-DUE-DAY-FR-DTE-TXT                   17350000
173600                    ,:PAYTRM-OTHER-TXT                            17360000
173700                FROM TVNDAGR A                                    17370000
173800                    ,TPAYTRM B                                    17380000
173900               WHERE A.ENT_ID           = :VNDDPT-ENT-ID          17390000
174000                 AND A.DEPT_NBR         = :ASC-KEY-DEPT-NBR       17400000
174100                 AND A.AGRMT_TYP_ID     = '2'                     17410000
174200                 AND A.EFFECTIVE_DATE  <= CURRENT DATE            17420000
174300                 AND A.EXPIRATION_DATE >  CURRENT DATE            17430000
174400                 AND A.PAYT_TERM_ID     = B.PAY_TERM_ID           17440000
174500         END-EXEC                                                 17450000
174600                                                                  17460000
174700         EVALUATE TRUE                                            17470000
174800             WHEN SQLCODE = +0                                    17480000
174900                                                                  17490000
175000                  MOVE SPACES TO ASC-PAYT-TERM-ID-DESC            17500000
175100                                                                  17510000
175200                  MOVE PAYTRM-PAY-TERM-ID TO PV-EDIT-PAYT-TERM-ID 17520000
175300                                                                  17530000
175400                  PERFORM 4222-FORMAT-TERMS                       17540000
175500                                                                  17550000
175600                  MOVE ASC-PAYT-TERM-ID-DESC TO ASC-PAYMENT-TERMS 17560000
175700                                        (ASC-BLK-SUB ASC-ITEM-SUB)17570000
175800                                                                  17580000
175900             WHEN SQLCODE = +100                                  17590000
176000                  MOVE SPACES TO ASC-PAYMENT-TERMS                17600000
176100                                        (ASC-BLK-SUB ASC-ITEM-SUB)17610000
176200                                                                  17620000
176300             WHEN SQLCODE = -904                                  17630000
176400             WHEN SQLCODE = -913                                  17640000
176500                  CONTINUE                                        17650000
176600                                                                  17660000
176700             WHEN SQLWARN0 NOT = SPACES                           17670000
176800             WHEN SQLCODE < +0                                    17680000
176900             WHEN SQLCODE > +0                                    17690000
177000                  MOVE '4220-GET-PAYMENT-TERMS'                   17700000
177100                                  TO DP013-PARAGRAPH              17710000
177200                  MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS'        17720000
177300                                  TO DP013-MESSAGE-TEXT (1)       17730000
177400                  MOVE SQLCA      TO DP013-SQLCA                  17740000
177500                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     17750000
177600                  MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (2)     17760000
177700                  SET DP013-DB2-ABEND                             17770000
177800                      DP013-XCTL-DISPLAY-RESTART                  17780000
177900                                  TO TRUE                         17790000
178000                  PERFORM DP013-0000-PROCESS-ABEND                17800000
178100         END-EVALUATE                                             17810000
178200     END-PERFORM.                                                 17820000
178300                                                                  17830000
178400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17840000
178500         MOVE '4220-GET-PAYMENT-TERMS'                            17850000
178600                                  TO DP013-PARAGRAPH              17860000
178700         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS'      17870000
178800                                  TO DP013-MESSAGE-TEXT (1)       17880000
178900         MOVE SQLCA               TO DP013-SQLCA                  17890000
179000         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     17900000
179100         MOVE 'TPAYTRM '          TO DP013-DB2-TABLE-NAME (2)     17910000
179200         SET DP013-DB2-ABEND                                      17920000
179300             DP013-XCTL-DISPLAY-RESTART                           17930000
179400                                  TO TRUE                         17940000
179500         PERFORM DP013-0000-PROCESS-ABEND                         17950000
179600     END-IF.                                                      17960000
179700                                                                  17970000
179800*----------------------------------------------------------------*17980004
179900* FORMAT THE PAYMENT TERMS                                        17990004
180000*----------------------------------------------------------------*18000004
180100 4222-FORMAT-TERMS.                                               18010000
180200                                                                  18020000
180300     COPY POPD001.                                                18030000
180400                                                                  18040000
180500*----------------------------------------------------------------*18050004
180600* OBTAIN THE EDI INDICATOR                                       *18060004
180700*----------------------------------------------------------------*18070004
180800 4230-GET-EDI-INDICATOR.                                          18080000
180900                                                                  18090000
181000     MOVE VNDDPT-ENT-ID      TO VNDAGR-ENT-ID.                    18100000
181100     MOVE ASC-KEY-DEPT-NBR   TO VNDAGR-DEPT-NBR.                  18110000
181200     MOVE '4'                TO VNDAGR-AGRMT-TYP-ID.              18120000
181300     MOVE +5                 TO VNDAGR-TYP-CDE.                   18130000
181400                                                                  18140000
181500     PERFORM WITH TEST AFTER                                      18150000
181600             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 18160000
181700             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         18170000
181800                     SQLCODE = ZERO                               18180000
181900                                                                  18190000
182000             EXEC SQL                                             18200000
182100                  SELECT COUNT(*)                                 18210000
182200                    INTO :PV-READ-COUNT                           18220000
182300                    FROM TVNDAGR                                  18230000
182400                   WHERE ENT_ID          = :VNDAGR-ENT-ID         18240000
182500                     AND DEPT_NBR        = :VNDAGR-DEPT-NBR       18250000
182600                     AND AGRMT_TYP_ID    = :VNDAGR-AGRMT-TYP-ID   18260000
182700                     AND TYP_CDE         = :VNDAGR-TYP-CDE        18270000
182800                     AND EFFECTIVE_DATE  <= CURRENT DATE          18280000
182900                     AND EXPIRATION_DATE >  CURRENT DATE          18290000
183000                     AND SEQ_NBR         =                        18300000
183100                 (SELECT MAX(SEQ_NBR)                             18310000
183200                    FROM TVNDAGR                                  18320000
183300                   WHERE ENT_ID          = :VNDAGR-ENT-ID         18330000
183400                     AND DEPT_NBR        = :VNDAGR-DEPT-NBR       18340000
183500                     AND AGRMT_TYP_ID    = :VNDAGR-AGRMT-TYP-ID   18350000
183600                     AND TYP_CDE         = :VNDAGR-TYP-CDE)       18360000
183700             END-EXEC                                             18370000
183800                                                                  18380000
183900             EVALUATE TRUE                                        18390000
184000                 WHEN SQLCODE = ZERO                              18400000
184100                 WHEN SQLCODE = -904                              18410000
184200                 WHEN SQLCODE = -913                              18420000
184300                      CONTINUE                                    18430000
184400                                                                  18440000
184500                 WHEN OTHER                                       18450000
184600                      MOVE '4230-GET-EDI-INDICATOR'               18460000
184700                                      TO DP013-PARAGRAPH          18470000
184800                      MOVE 'UNSUCCESSFUL SELECT EDI INDICATOR'    18480000
184900                                      TO DP013-MESSAGE-TEXT (1)   18490000
185000                      MOVE SQLCA      TO DP013-SQLCA              18500000
185100                      MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1) 18510000
185200                      SET DP013-DB2-ABEND                         18520000
185300                          DP013-XCTL-DISPLAY-RESTART              18530000
185400                                      TO TRUE                     18540000
185500                      PERFORM DP013-0000-PROCESS-ABEND            18550000
185600             END-EVALUATE                                         18560000
185700         END-PERFORM.                                             18570000
185800                                                                  18580000
185900         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    18590000
186000             MOVE '4230-GET-EDI-INDICATOR'                        18600000
186100                                      TO DP013-PARAGRAPH          18610000
186200             MOVE 'MAX RETRIES EXCEEDED ON SELECT EDI INDICATOR'  18620000
186300                                      TO DP013-MESSAGE-TEXT (1)   18630000
186400             MOVE SQLCA               TO DP013-SQLCA              18640000
186500             MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1) 18650000
186600             SET DP013-DB2-ABEND                                  18660000
186700                 DP013-XCTL-DISPLAY-RESTART                       18670000
186800                                      TO TRUE                     18680000
186900             PERFORM DP013-0000-PROCESS-ABEND                     18690000
187000         END-IF.                                                  18700000
187100                                                                  18710000
187200     IF SQLCODE = ZERO                                            18720000
187300        IF PV-READ-COUNT > ZERO                                   18730000
187400            MOVE 'Y' TO ASC-EDI-IND (ASC-BLK-SUB ASC-ITEM-SUB)    18740000
187500        ELSE                                                      18750000
187600            MOVE 'N' TO ASC-EDI-IND (ASC-BLK-SUB ASC-ITEM-SUB)    18760000
187700        END-IF                                                    18770000
187800     ELSE                                                         18780000
187900         IF SQLCODE = -305                                        18790000
188000            MOVE 'N' TO ASC-EDI-IND (ASC-BLK-SUB ASC-ITEM-SUB)    18800000
188100         END-IF                                                   18810000
188200     END-IF.                                                      18820000
188300                                                                  18830000
188400*----------------------------------------------------------------*18840004
188500* OBTAIN THE PRETICKET INDICATOR VALUE                           *18850004
188600*----------------------------------------------------------------*18860004
188700 4240-GET-PRETICKET-IND.                                          18870000
188800                                                                  18880000
188900     MOVE VNDDPT-ENT-ID      TO VNDAGR-ENT-ID.                    18890000
189000     MOVE ASC-KEY-DEPT-NBR   TO VNDAGR-DEPT-NBR.                  18900000
189100     MOVE '4'                TO VNDAGR-AGRMT-TYP-ID.              18910000
189200     MOVE +1                 TO VNDAGR-TYP-CDE.                   18920000
189300                                                                  18930000
189400     PERFORM WITH TEST AFTER                                      18940000
189500             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 18950000
189600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         18960000
189700                     SQLCODE = ZERO                               18970000
189800                                                                  18980000
189900             EXEC SQL                                             18990000
190000                  SELECT COUNT(*)                                 19000000
190100                    INTO :PV-READ-COUNT                           19010000
190200                    FROM TVNDAGR                                  19020000
190300                   WHERE ENT_ID          = :VNDAGR-ENT-ID         19030000
190400                     AND DEPT_NBR        = :VNDAGR-DEPT-NBR       19040000
190500                     AND AGRMT_TYP_ID    = :VNDAGR-AGRMT-TYP-ID   19050000
190600                     AND TYP_CDE         = :VNDAGR-TYP-CDE        19060000
190700                     AND EFFECTIVE_DATE  <= CURRENT DATE          19070000
190800                     AND EXPIRATION_DATE >  CURRENT DATE          19080000
190900                     AND SEQ_NBR         =                        19090000
191000                 (SELECT MAX(SEQ_NBR)                             19100000
191100                    FROM TVNDAGR                                  19110000
191200                   WHERE ENT_ID          = :VNDAGR-ENT-ID         19120000
191300                     AND DEPT_NBR        = :VNDAGR-DEPT-NBR       19130000
191400                     AND AGRMT_TYP_ID    = :VNDAGR-AGRMT-TYP-ID   19140000
191500                     AND TYP_CDE         = :VNDAGR-TYP-CDE)       19150000
191600             END-EXEC                                             19160000
191700                                                                  19170000
191800             EVALUATE TRUE                                        19180000
191900                 WHEN SQLCODE = ZERO                              19190000
192000                 WHEN SQLCODE = -904                              19200000
192100                 WHEN SQLCODE = -913                              19210000
192200                      CONTINUE                                    19220000
192300                                                                  19230000
192400                 WHEN OTHER                                       19240000
192500                      MOVE '4240-GET-PRETICKET-IND'               19250000
192600                                      TO DP013-PARAGRAPH          19260000
192700                      MOVE 'UNSUCCESSFUL SELECT PRETKT INDICATOR' 19270000
192800                                      TO DP013-MESSAGE-TEXT (1)   19280000
192900                      MOVE SQLCA      TO DP013-SQLCA              19290000
193000                      MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1) 19300000
193100                      SET DP013-DB2-ABEND                         19310000
193200                          DP013-XCTL-DISPLAY-RESTART              19320000
193300                                      TO TRUE                     19330000
193400                      PERFORM DP013-0000-PROCESS-ABEND            19340000
193500             END-EVALUATE                                         19350000
193600         END-PERFORM.                                             19360000
193700                                                                  19370000
193800         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    19380000
193900             MOVE '4240-GET-PRETICKET-IND'                        19390000
194000                                      TO DP013-PARAGRAPH          19400000
194100             MOVE 'MAX RETRIES EXCEED ON SELECT PRETKT INDICATOR' 19410000
194200                                      TO DP013-MESSAGE-TEXT (1)   19420000
194300             MOVE SQLCA               TO DP013-SQLCA              19430000
194400             MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1) 19440000
194500             SET DP013-DB2-ABEND                                  19450000
194600                 DP013-XCTL-DISPLAY-RESTART                       19460000
194700                                      TO TRUE                     19470000
194800             PERFORM DP013-0000-PROCESS-ABEND                     19480000
194900         END-IF.                                                  19490000
195000                                                                  19500000
195100     IF SQLCODE = ZERO                                            19510000
195200        IF PV-READ-COUNT > ZERO                                   19520000
195300            MOVE 'Y' TO ASC-PRETKT-IND                            19530000
195400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19540000
195500        ELSE                                                      19550000
195600            MOVE 'N' TO ASC-PRETKT-IND                            19560000
195700                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19570000
195800        END-IF                                                    19580000
195900     ELSE                                                         19590000
196000         IF SQLCODE = -305                                        19600000
196100            MOVE 'N' TO ASC-PRETKT-IND                            19610000
196200                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19620000
196300         END-IF                                                   19630000
196400     END-IF.                                                      19640000
196500/                                                                 19650026
196600*----------------------------------------------------------------*19660000
196700* CLOSE THE VENDOR   CURSOR.                                     *19670000
196800*----------------------------------------------------------------*19680000
196900 4300-CLOSE-CURSOR.                                               19690000
197000                                                                  19700000
197100     EXEC SQL                                                     19710000
197200         CLOSE VENDOR-CSR                                         19720000
197300     END-EXEC                                                     19730000
197400                                                                  19740000
197500     EVALUATE TRUE                                                19750000
197600         WHEN SQLCODE = ZERO                                      19760000
197700             CONTINUE                                             19770000
197800         WHEN SQLWARN0 NOT = SPACES                               19780000
197900         WHEN SQLCODE < ZERO                                      19790000
198000         WHEN SQLCODE > ZERO                                      19800000
198100             MOVE '4300-CLOSE-CURSOR'                             19810000
198200                               TO DP013-PARAGRAPH                 19820000
198300             MOVE 'CLOSE VENDOR CURSOR '                          19830000
198400                               TO DP013-MESSAGE-TEXT (1)          19840000
198500             MOVE SQLCA        TO DP013-SQLCA                     19850000
198600             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        19860000
198700             SET DP013-DB2-ABEND                                  19870000
198800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19880000
198900             PERFORM DP013-0000-PROCESS-ABEND                     19890000
199000     END-EVALUATE.                                                19900000
199100                                                                  19910000
199200*----------------------------------------------------------------*19920000
199300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19930000
199400*----------------------------------------------------------------*19940000
199500 4400-MOVE-COMMAREA-TO-SCREEN.                                    19950000
199600                                                                  19960000
199700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19970000
199800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19980000
199900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19990000
200000             MOVE +1    TO ASC-BLK-SUB                            20000000
200100             PERFORM 5100-WRITE-TEMP-STORAGE                      20010000
200200             ADD +1     TO ASC-BLK-SUB                            20020000
200300             PERFORM 5100-WRITE-TEMP-STORAGE                      20030000
200400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20040000
200500                 GIVING PV-BLOCK-NUMBER                           20050000
200600                 REMAINDER PV-REMAINDER                           20060000
200700             IF  PV-REMAINDER > ZERO                              20070000
200800                 ADD +1 TO PV-BLOCK-NUMBER                        20080000
200900             END-IF                                               20090000
201000             MOVE +1    TO ASC-BLK-SUB                            20100000
201100             PERFORM 4410-READ-TEMP-STORAGE                       20110000
201200             ADD +1     TO ASC-BLK-SUB                            20120000
201300                           PV-BLOCK-NUMBER                        20130000
201400             PERFORM 4410-READ-TEMP-STORAGE                       20140000
201500     END-IF.                                                      20150000
201600     MOVE +1            TO ASC-BLK-SUB.                           20160000
201700     COMPUTE ASC-ITEM-SUB =                                       20170000
201800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20180000
201900         + PC-ITEMS-PER-PANEL).                                   20190000
202000                                                                  20200000
202100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20210000
202200         ADD +1         TO ASC-BLK-SUB                            20220000
202300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20230000
202400     END-IF.                                                      20240000
202500                                                                  20250000
202600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20260000
202700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20270000
202800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20280000
202900     PERFORM 4420-FORMAT-LIST-LINES                               20290000
203000         VARYING PV-SUB                                           20300000
203100         FROM PC-ITEMS-PER-PANEL BY -1                            20310000
203200         UNTIL PV-SUB < +1.                                       20320000
203300                                                                  20330000
203400     COMPUTE ASC-ITEMS-DISPLAYED =                                20340000
203500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20350000
203600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20360000
203700                                      ASTRTITO.                   20370000
203800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20380000
203900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20390000
204000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20400000
204100                                   TO ASELITO.                    20410000
204200     MOVE ASC-KEY-DEPT-NBR         TO ADPTNBRO.                   20420000
204300     MOVE ASC-DEPT-DESC            TO ADPTNAMO.                   20430000
204400                                                                  20440000
204500     IF  DP020-MSG-NUMBER-X = SPACE                               20450000
204600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20460000
204700*            --- MORE ITEMS TO DISPLAY ----                       20470000
204800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20480000
204900             SET DP020-MSG-INFORMATIONAL TO TRUE                  20490000
205000         END-IF                                                   20500000
205100     END-IF.                                                      20510000
205200                                                                  20520000
205300*----------------------------------------------------------------*20530000
205400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20540000
205500*----------------------------------------------------------------*20550000
205600 4410-READ-TEMP-STORAGE.                                          20560000
205700                                                                  20570000
205800     EXEC CICS                                                    20580000
205900         READQ TS                                                 20590000
206000             QUEUE (ASC-LIST-QUEUE-NAME)                          20600000
206100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20610000
206200             ITEM  (PV-BLOCK-NUMBER)                              20620000
206300             RESP  (PV-CICS-RESP)                                 20630000
206400     END-EXEC.                                                    20640000
206500                                                                  20650000
206600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20660000
206700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20670000
206800         CONTINUE                                                 20680000
206900     ELSE                                                         20690000
207000         SET DP013-CICS-ABEND     TO TRUE                         20700000
207100         SET DP013-NO-ROLLBACK    TO TRUE                         20710000
207200         MOVE '4410-READ-TEMP-STORAGE'                            20720000
207300                                  TO DP013-PARAGRAPH              20730000
207400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20740000
207500                                  TO DP013-MESSAGE-TEXT(1)        20750000
207600         PERFORM DP013-0000-PROCESS-ABEND                         20760000
207700     END-IF.                                                      20770000
207800                                                                  20780000
207900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20790000
208000                                                                  20800000
208100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20810000
208200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20820000
208300     END-IF.                                                      20830000
208400                                                                  20840000
208500*----------------------------------------------------------------*20850000
208600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20860000
208700*----------------------------------------------------------------*20870000
208800 4420-FORMAT-LIST-LINES.                                          20880000
208900                                                                  20890000
209000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20900000
209100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20910000
209200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA       (PV-SUB)     20920000
209300         MOVE SPACES             TO MR-SELECTI       (PV-SUB)     20930000
209400                                    MR-VEND-TYPE     (PV-SUB)     20940000
209500                                    MR-VEND-NAME     (PV-SUB)     20950000
209600                                    MR-DUN-NBR       (PV-SUB)     20960000
209700                                    MR-INHOUSE-NBR-X (PV-SUB)     20970000
209800                                    MR-PAYMENT-TERMS (PV-SUB)     20980000
209900                                    MR-UPC-CATALOG-NM (PV-SUB)    20990007
210000                                    MR-EDI-IND       (PV-SUB)     21000000
210100                                    MR-PRETKT-IND    (PV-SUB)     21010000
210200                                    MR-STATUS-IND    (PV-SUB)     21020000
210300     ELSE                                                         21030000
210400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21040000
210500                                                   > SPACE        21050000
210600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21060000
210700                                 TO MR-SELECTI (PV-SUB)           21070000
210800         ELSE                                                     21080000
210900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21090000
211000                                 TO MR-SELECTI (PV-SUB)           21100000
211100         END-IF                                                   21110000
211200                                                                  21120000
211300         IF  DP030-SET-CURSOR-TRAILER                             21130000
211400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21140000
211500                 > SPACE)                                         21150000
211600               OR (PV-SUB = 1))                                   21160000
211700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21170000
211800                MOVE -1          TO MR-SELECTL (PV-SUB)           21180000
211900             END-IF                                               21190000
212000         END-IF                                                   21200000
212100                                                                  21210000
212200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           21220000
212300             MOVE ASC-VEND-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)        21230000
212400                                 TO MR-VEND-TYPE (PV-SUB)         21240000
212500             MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        21250000
212600                                 TO MR-VEND-NAME (PV-SUB)         21260000
212700             MOVE ASC-DUN-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          21270000
212800                                 TO MR-DUN-NBR (PV-SUB)           21280000
212900             MOVE ASC-INHOUSE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      21290000
213000                                 TO MR-INHOUSE-NBR (PV-SUB)       21300000
213100             MOVE ASC-PAYMENT-TERMS (ASC-BLK-SUB ASC-ITEM-SUB)    21310000
213200                                 TO MR-PAYMENT-TERMS (PV-SUB)     21320000
213300             MOVE ASC-UPC-CATALOG-NM (ASC-BLK-SUB ASC-ITEM-SUB)   21330007
213400                                 TO MR-UPC-CATALOG-NM (PV-SUB)    21340007
213500             MOVE ASC-EDI-IND (ASC-BLK-SUB ASC-ITEM-SUB)          21350000
213600                                 TO MR-EDI-IND (PV-SUB)           21360000
213700             MOVE ASC-PRETKT-IND (ASC-BLK-SUB ASC-ITEM-SUB)       21370000
213800                                 TO MR-PRETKT-IND (PV-SUB)        21380000
213900             MOVE ASC-STATUS-IND (ASC-BLK-SUB ASC-ITEM-SUB)       21390000
214000                                 TO MR-STATUS-IND (PV-SUB)        21400000
214100         END-IF                                                   21410000
214200     END-IF.                                                      21420000
214300                                                                  21430000
214400     SUBTRACT +1 FROM ASC-ITEM-SUB                                21440000
214500                                                                  21450000
214600     IF  ASC-ITEM-SUB < + 1                                       21460000
214700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21470000
214800         MOVE +1                 TO ASC-BLK-SUB                   21480000
214900     END-IF.                                                      21490000
215000                                                                  21500000
215100******************************************************************21510000
215200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21520000
215300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21530000
215400** ISSUE A WARNING.                                             **21540000
215500******************************************************************21550000
215600 4430-CHECK-FOR-BEGIN-AND-END.                                    21560000
215700                                                                  21570000
215800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21580000
215900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21590000
216000*            -- NO END-OF-RANGE SPECFIED ---                      21600000
216100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21610000
216200             SET DP020-MSG-WARNING TO TRUE                        21620000
216300             PERFORM 4431-POSITION-AT-WARNING                     21630000
216400         END-IF                                                   21640000
216500     ELSE                                                         21650000
216600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21660000
216700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21670000
216800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21680000
216900             SET DP020-MSG-WARNING TO TRUE                        21690000
217000             PERFORM 4431-POSITION-AT-WARNING                     21700000
217100         END-IF                                                   21710000
217200     END-IF.                                                      21720000
217300                                                                  21730000
217400******************************************************************21740000
217500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21750000
217600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21760000
217700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21770000
217800** POSITION THE CURSOR THERE.                                   **21780000
217900******************************************************************21790000
218000 4431-POSITION-AT-WARNING.                                        21800000
218100                                                                  21810000
218200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21820000
218300                    - PV-TOP-ITEM + 1.                            21830000
218400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21840000
218500         CONTINUE                                                 21850000
218600     ELSE                                                         21860000
218700         SET DP030-SET-CURSOR-APPL-1                              21870000
218800                                   TO TRUE                        21880000
218900         MOVE -1                   TO MR-SELECTL (PV-SUB)         21890000
219000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21900000
219100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21910000
219200     END-IF.                                                      21920000
219300                                                                  21930000
219400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21940000
219500                    - PV-TOP-ITEM + 1.                            21950000
219600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21960000
219700         CONTINUE                                                 21970000
219800     ELSE                                                         21980000
219900         SET DP030-SET-CURSOR-APPL-1                              21990000
220000                                   TO TRUE                        22000000
220100         MOVE -1                   TO MR-SELECTL (PV-SUB)         22010000
220200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22020000
220300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22030000
220400     END-IF.                                                      22040000
220500                                                                  22050000
220600 4500-GET-OTHER-SCREEN-FIELDS.                                    22060000
220700                                                                  22070000
220800     PERFORM 4510-GET-MDSE-DEPT-NAME.                             22080000
220900                                                                  22090000
221000     IF SQLCODE = +100                                            22100000
221100         PERFORM 4520-GET-EXPENSE-DEPT-NAME                       22110000
221200     END-IF.                                                      22120000
221300                                                                  22130000
221400*----------------------------------------------------------------*22140000
221500*  GET DEPARTMENT NAME FROM TMDSEAR USING SUBROUTINE DPKUT038    *22150000
221600*----------------------------------------------------------------*22160000
221700 4510-GET-MDSE-DEPT-NAME.                                         22170000
221800                                                                  22180000
221900     PERFORM                                                      22190000
222000         WITH TEST AFTER                                          22200000
222100         VARYING PV-RETRY-COUNTER                                 22210000
222200         FROM 1 BY 1                                              22220000
222300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22230000
222400                   OR (SQLCODE = ZERO)                            22240000
222500                   OR (SQLCODE = +100))                           22250000
222600             EXEC SQL                                             22260000
222700                     SELECT MDSEAR_DESC                           22270000
222800                       INTO :ASC-DEPT-DESC                        22280000
222900                       FROM TMDSEAR                               22290000
223000                      WHERE DEPT_NBR   = :ASC-KEY-DEPT-NBR        22300000
223100                        AND OPERCO_NBR = :DP020-OPERATING-COMPANY 22310000
223200                        AND MDSELV_CDE = 'DPT'                    22320000
223300                        AND STRT_DTE  <= CURRENT DATE             22330000
223400                        AND END_DTE   >= CURRENT DATE             22340000
223500             END-EXEC                                             22350000
223600                                                                  22360000
223700         EVALUATE TRUE                                            22370000
223800             WHEN SQLCODE = ZERO                                  22380000
223900             WHEN SQLCODE = +100                                  22390000
224000             WHEN SQLCODE = -904                                  22400000
224100             WHEN SQLCODE = -913                                  22410000
224200                 CONTINUE                                         22420000
224300             WHEN SQLWARN0 NOT = SPACES                           22430000
224400             WHEN SQLCODE < ZERO                                  22440000
224500             WHEN SQLCODE > ZERO                                  22450000
224600                 MOVE '4510-GET-MDSE-DEPT-NAME'                   22460000
224700                                   TO DP013-PARAGRAPH             22470000
224800                 MOVE 'SELECT TMSDEAR'                            22480000
224900                                   TO DP013-MESSAGE-TEXT (1)      22490000
225000                 MOVE SQLCA        TO DP013-SQLCA                 22500000
225100                 MOVE 'TMSDEAR '   TO DP013-DB2-TABLE-NAME (1)    22510000
225200                 SET DP013-DB2-ABEND                              22520000
225300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22530000
225400                 PERFORM DP013-0000-PROCESS-ABEND                 22540000
225500         END-EVALUATE                                             22550000
225600     END-PERFORM.                                                 22560000
225700                                                                  22570000
225800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22580000
225900         MOVE '4510-GET-MDSE-DEPT-NAME'                           22590000
226000                                   TO DP013-PARAGRAPH             22600000
226100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22610000
226200                                   TO DP013-MESSAGE-TEXT (1)      22620000
226300         MOVE SQLCA                TO DP013-SQLCA                 22630000
226400         MOVE 'TMDSEAR '           TO DP013-DB2-TABLE-NAME (1)    22640000
226500         SET DP013-DB2-ABEND                                      22650000
226600             DP013-XCTL-DISPLAY-RESTART                           22660000
226700                                   TO TRUE                        22670000
226800         PERFORM DP013-0000-PROCESS-ABEND                         22680000
226900     END-IF.                                                      22690000
227000                                                                  22700000
227100*----------------------------------------------------------------*22710000
227200*  GET DEPARTMENT NAME FROM TORGUNT FOR EXPENSE VENDOR            22720000
227300*----------------------------------------------------------------*22730000
227400 4520-GET-EXPENSE-DEPT-NAME.                                      22740000
227500                                                                  22750000
227600     PERFORM                                                      22760000
227700         WITH TEST AFTER                                          22770000
227800         VARYING PV-RETRY-COUNTER                                 22780000
227900         FROM 1 BY 1                                              22790000
228000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22800000
228100                   OR (SQLCODE = ZERO)                            22810000
228200                   OR (SQLCODE = +100))                           22820000
228300             EXEC SQL                                             22830000
228400                     SELECT ORGUNT_NAME                           22840000
228500                       INTO :ASC-DEPT-DESC                        22850000
228600                       FROM TORGUNT                               22860000
228700                      WHERE ORGUNT_NICK_NAME = :ASC-KEY-DEPT-NBR  22870000
228800                        AND ORGUNT_TYP_CDE   = '01'               22880000
228900             END-EXEC                                             22890000
229000                                                                  22900000
229100         EVALUATE TRUE                                            22910000
229200             WHEN SQLCODE = ZERO                                  22920000
229300             WHEN SQLCODE = +100                                  22930000
229400             WHEN SQLCODE = -904                                  22940000
229500             WHEN SQLCODE = -913                                  22950000
229600                 CONTINUE                                         22960000
229700             WHEN SQLWARN0 NOT = SPACES                           22970000
229800             WHEN SQLCODE < ZERO                                  22980000
229900             WHEN SQLCODE > ZERO                                  22990000
230000                 MOVE '4520-GET-EXPENSE-DEPT-NAME'                23000000
230100                                   TO DP013-PARAGRAPH             23010000
230200                 MOVE 'SELECT TORGUNT'                            23020000
230300                                   TO DP013-MESSAGE-TEXT (1)      23030000
230400                 MOVE SQLCA        TO DP013-SQLCA                 23040000
230500                 MOVE 'TORGUNT '   TO DP013-DB2-TABLE-NAME (1)    23050000
230600                 SET DP013-DB2-ABEND                              23060000
230700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23070000
230800                 PERFORM DP013-0000-PROCESS-ABEND                 23080000
230900         END-EVALUATE                                             23090000
231000     END-PERFORM.                                                 23100000
231100                                                                  23110000
231200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23120000
231300         MOVE '4520-GET-EXPENSE-DEPT-NAME'                        23130000
231400                                   TO DP013-PARAGRAPH             23140000
231500         MOVE 'MAXIMUM RETRIES EXCEEDED ON SELECT TORGUNT'        23150000
231600                                   TO DP013-MESSAGE-TEXT (1)      23160000
231700         MOVE SQLCA                TO DP013-SQLCA                 23170000
231800         MOVE 'TORGUNT '           TO DP013-DB2-TABLE-NAME (1)    23180000
231900         SET DP013-DB2-ABEND                                      23190000
232000             DP013-XCTL-DISPLAY-RESTART                           23200000
232100                                   TO TRUE                        23210000
232200         PERFORM DP013-0000-PROCESS-ABEND                         23220000
232300     END-IF.                                                      23230000
232400                                                                  23240000
232500     IF SQLCODE = +100                                            23250000
232600         MOVE 'NAME NOT FOUND' TO ASC-DEPT-DESC.                  23260000
232700                                                                  23270000
232800*----------------------------------------------------------------*23280000
232900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23290000
233000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23300000
233100* FOR THE SELECTED ITEMS QUEUE.                                  *23310000
233200*                                                                *23320000
233300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23330000
233400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23340000
233500* THE ARRAY IS FULL.                                             *23350000
233600*----------------------------------------------------------------*23360000
233700 5000-PREPARE-SEL-QUEUE.                                          23370000
233800                                                                  23380000
233900     MOVE +1                   TO  ASC-BLK-SUB.                   23390000
234000     PERFORM 5100-WRITE-TEMP-STORAGE.                             23400000
234100     ADD +1                    TO  ASC-BLK-SUB.                   23410000
234200     PERFORM 5100-WRITE-TEMP-STORAGE.                             23420000
234300                                                                  23430000
234400     MOVE ASC-SEL-QUEUE-NAME   TO  VN002-SEL-QUEUE-NAME.          23440000
234500     PERFORM 6010-DELETE-SEL-QUEUE.                               23450000
234600                                                                  23460000
234700     SET ASC-UPDATE-TSQ        TO  TRUE.                          23470000
234800                                                                  23480000
234900     SET VN003-IDX             TO  1.                             23490000
235000     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       23500000
235100     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        23510000
235200                                                                  23520000
235300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23530000
235400             VARYING PV-ITEM                                      23540000
235500             FROM 1 BY 1                                          23550000
235600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23560000
235700                                                                  23570000
235800     IF  VN003-IDX > 1                                            23580000
235900         PERFORM 5205-WRITE-SEL-QUEUE                             23590000
236000         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        23600000
236100     END-IF.                                                      23610000
236200                                                                  23620000
236300*----------------------------------------------------------------*23630000
236400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23640000
236500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23650000
236600*----------------------------------------------------------------*23660000
236700 5100-WRITE-TEMP-STORAGE.                                         23670000
236800                                                                  23680000
236900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23690000
237000                                   TO PV-LIST-ITEM-NUMBER.        23700000
237100     COMPUTE PV-BLOCK-NUMBER =                                    23710000
237200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23720000
237300                                                                  23730000
237400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23740000
237500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23750000
237600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23760000
237700             PERFORM 5105-REWRITE-ASC-LISTQ                       23770000
237800         END-IF                                                   23780000
237900     ELSE                                                         23790000
238000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23800000
238100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23810000
238200         PERFORM 5110-WRITE-ASC-LISTQ                             23820000
238300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23830000
238400     END-IF.                                                      23840000
238500                                                                  23850000
238600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23860000
238700                                                                  23870000
238800******************************************************************23880000
238900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23890000
239000** SPECIFIC COMMAREA.                                           **23900000
239100******************************************************************23910000
239200 5105-REWRITE-ASC-LISTQ.                                          23920000
239300                                                                  23930000
239400     EXEC CICS                                                    23940000
239500         WRITEQ TS                                                23950000
239600             QUEUE (ASC-LIST-QUEUE-NAME)                          23960000
239700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23970000
239800             ITEM  (PV-BLOCK-NUMBER)                              23980000
239900             REWRITE                                              23990000
240000             RESP  (PV-CICS-RESP)                                 24000000
240100     END-EXEC.                                                    24010000
240200                                                                  24020000
240300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24030000
240400         CONTINUE                                                 24040000
240500     ELSE                                                         24050000
240600         SET DP013-CICS-ABEND            TO TRUE                  24060000
240700         SET DP013-NO-ROLLBACK           TO TRUE                  24070000
240800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24080000
240900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24090000
241000                                         TO DP013-MESSAGE-TEXT(1) 24100000
241100         PERFORM DP013-0000-PROCESS-ABEND                         24110000
241200     END-IF.                                                      24120000
241300                                                                  24130000
241400******************************************************************24140000
241500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24150000
241600** SPECIFIC COMMAREA.                                           **24160000
241700******************************************************************24170000
241800 5110-WRITE-ASC-LISTQ.                                            24180000
241900                                                                  24190000
242000     EXEC CICS                                                    24200000
242100         WRITEQ TS                                                24210000
242200             QUEUE (ASC-LIST-QUEUE-NAME)                          24220000
242300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24230000
242400             ITEM  (PV-BLOCK-NUMBER)                              24240000
242500             RESP  (PV-CICS-RESP)                                 24250000
242600     END-EXEC.                                                    24260000
242700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24270000
242800         SET DP013-CICS-ABEND      TO TRUE                        24280000
242900         SET DP013-NO-ROLLBACK     TO TRUE                        24290000
243000         MOVE '5110-WRITE-ASC-LISTQ'                              24300000
243100                                   TO DP013-PARAGRAPH             24310000
243200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24320000
243300                                   TO DP013-MESSAGE-TEXT(1)       24330000
243400         PERFORM DP013-0000-PROCESS-ABEND                         24340000
243500     END-IF.                                                      24350000
243600                                                                  24360000
243700*----------------------------------------------------------------*24370000
243800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24380000
243900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24390000
244000*----------------------------------------------------------------*24400000
244100 5200-FILL-SEL-QUEUE-RECORD.                                      24410000
244200                                                                  24420000
244300     PERFORM 6112-READ-LIST-QUEUE.                                24430000
244400                                                                  24440000
244500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24450000
244600         PERFORM                                                  24460000
244700         VARYING LQW-IDX                                          24470000
244800         FROM 1 BY 1                                              24480000
244900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24490000
245000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24500000
245100                                                                  24510000
245200             IF  LQW-SELECT (LQW-IDX)                             24520000
245300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24530000
245400                                   TO VN003-ITEM (VN003-IDX)      24540000
245500                 MOVE ASC-KEY-DEPT-NBR                            24550000
245600                                   TO VN003-DEPARTMENT (VN003-IDX)24560000
245700                 MOVE LQW-ENT-ID (LQW-IDX)                        24570000
245800                                   TO VN003-ENT-ID (VN003-IDX)    24580000
245900                 MOVE LQW-VEND-TYPE   (LQW-IDX)                   24590000
246000                                   TO VN003-VEND-TYPE             24600000
246100                                        (VN003-IDX)               24610000
246200                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) 24620000
246300                 SET VN003-IDX UP BY 1                            24630000
246400                 IF  VN003-IDX > VN003-MAX-ITEMS                  24640000
246500                     PERFORM 5205-WRITE-SEL-QUEUE                 24650000
246600                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    24660000
246700                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         24670000
246800                     SET VN003-IDX TO  1                          24680000
246900                 END-IF                                           24690000
247000             END-IF                                               24700000
247100         END-PERFORM                                              24710000
247200     END-IF.                                                      24720000
247300                                                                  24730000
247400*----------------------------------------------------------------*24740000
247500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24750000
247600*----------------------------------------------------------------*24760000
247700 5205-WRITE-SEL-QUEUE.                                            24770000
247800                                                                  24780000
247900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24790000
248000                                   TO VN003-SELECTED-ITEMS.       24800000
248100                                                                  24810000
248200     EXEC CICS                                                    24820000
248300          WRITEQ TS                                               24830000
248400              QUEUE (ASC-SEL-QUEUE-NAME)                          24840000
248500              FROM  (VN003-VENDOR-SEL-REC)                        24850000
248600              ITEM  (PV-SEL-QUEUE-ITEM)                           24860000
248700              RESP  (PV-CICS-RESP)                                24870000
248800     END-EXEC.                                                    24880000
248900                                                                  24890000
249000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24900000
249100         CONTINUE                                                 24910000
249200     ELSE                                                         24920000
249300         SET DP013-CICS-ABEND      TO TRUE                        24930000
249400         SET DP013-NO-ROLLBACK     TO TRUE                        24940000
249500         MOVE '5205-WRITE-SEL-QUEUE'                              24950000
249600                                   TO DP013-PARAGRAPH             24960000
249700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24970000
249800                                   TO DP013-MESSAGE-TEXT(1)       24980000
249900         PERFORM DP013-0000-PROCESS-ABEND                         24990000
250000     END-IF.                                                      25000000
250100                                                                  25010000
250200******************************************************************25020000
250300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **25030000
250400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **25040000
250500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **25050000
250600** THE USER.                                                    **25060000
250700******************************************************************25070000
250800 6000-REFRESH-PANEL-FROM-TEMP.                                    25080000
250900                                                                  25090000
251000     IF  ASC-UPDATE-TSQ                                           25100000
251100         SET ASC-NO-TSQ-UPDATE TO TRUE                            25110000
251200         MOVE ZERO                 TO PV-SAVE-ITEM                25120000
251300                                      PV-SEL-QUEUE-ITEM           25130000
251400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25140000
251500                                   TO PV-HOLD-SELECTED-ITEMS      25150000
251600         PERFORM 6100-UPDATE-TSQ                                  25160000
251700             UNTIL PV-ITEMS-PROCESSED >                           25170000
251800                                     ASC-NUMBER-OF-SELECTED-ITEMS 25180000
251900         PERFORM 6010-DELETE-SEL-QUEUE                            25190000
252000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25200000
252100                    ASC-BLOCK-ENTRIES (2)                         25210000
252200     END-IF.                                                      25220000
252300                                                                  25230000
252400*----------------------------------------------------------------*25240000
252500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25250000
252600*----------------------------------------------------------------*25260000
252700 6010-DELETE-SEL-QUEUE.                                           25270000
252800                                                                  25280000
252900     EXEC CICS                                                    25290000
253000         DELETEQ TS                                               25300000
253100             QUEUE (ASC-SEL-QUEUE-NAME)                           25310000
253200             RESP  (PV-CICS-RESP)                                 25320000
253300     END-EXEC.                                                    25330000
253400                                                                  25340000
253500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25350000
253600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25360000
253700         CONTINUE                                                 25370000
253800     ELSE                                                         25380000
253900         SET DP013-CICS-ABEND TO TRUE                             25390000
254000         SET DP013-NO-ROLLBACK TO TRUE                            25400000
254100         MOVE '6010-DELETE-SEL-QUEUE'                             25410000
254200                        TO DP013-PARAGRAPH                        25420000
254300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25430000
254400                        TO DP013-MESSAGE-TEXT (1)                 25440000
254500         PERFORM DP013-0000-PROCESS-ABEND                         25450000
254600     END-IF.                                                      25460000
254700                                                                  25470000
254800*----------------------------------------------------------------*25480000
254900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25490000
255000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25500000
255100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25510000
255200*    THE TEMP QUEUE.                                             *25520000
255300*----------------------------------------------------------------*25530000
255400 6100-UPDATE-TSQ.                                                 25540000
255500                                                                  25550000
255600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25560000
255700     PERFORM 6105-READ-SEL-QUEUE.                                 25570000
255800     PERFORM                                                      25580000
255900         VARYING VN003-IDX                                        25590000
256000         FROM 1 BY 1                                              25600000
256100         UNTIL ((PV-ITEMS-PROCESSED >                             25610000
256200                              PV-HOLD-SELECTED-ITEMS)             25620000
256300         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             25630000
256400         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  25640000
256500             PERFORM 6110-PROCESS-ITEMS                           25650000
256600         END-IF                                                   25660000
256700         ADD +1                TO PV-ITEMS-PROCESSED              25670000
256800     END-PERFORM.                                                 25680000
256900     PERFORM 6111-WRITE-LIST-QUEUE.                               25690000
257000                                                                  25700000
257100*----------------------------------------------------------------*25710000
257200*    READ THE LIST QUEUE RECORD.                                 *25720000
257300*----------------------------------------------------------------*25730000
257400 6105-READ-SEL-QUEUE.                                             25740000
257500                                                                  25750000
257600     EXEC CICS                                                    25760000
257700          READQ TS                                                25770000
257800              QUEUE (ASC-SEL-QUEUE-NAME)                          25780000
257900              INTO  (VN003-VENDOR-SEL-REC)                        25790000
258000              ITEM  (PV-SEL-QUEUE-ITEM)                           25800000
258100              RESP  (PV-CICS-RESP)                                25810000
258200     END-EXEC.                                                    25820000
258300                                                                  25830000
258400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25840000
258500         CONTINUE                                                 25850000
258600     ELSE                                                         25860000
258700         SET DP013-CICS-ABEND      TO  TRUE                       25870000
258800         SET DP013-NO-ROLLBACK     TO  TRUE                       25880000
258900         MOVE '6105-READ-SEL-QUEUE'                               25890000
259000                                   TO  DP013-PARAGRAPH            25900000
259100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25910000
259200                                   TO  DP013-MESSAGE-TEXT(1)      25920000
259300         PERFORM DP013-0000-PROCESS-ABEND                         25930000
259400     END-IF.                                                      25940000
259500                                                                  25950000
259600*----------------------------------------------------------------*25960000
259700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*25970000
259800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*25980000
259900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *25990000
260000*----------------------------------------------------------------*26000000
260100 6110-PROCESS-ITEMS.                                              26010000
260200                                                                  26020000
260300     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          26030000
260400                     / PC-ITEMS-PER-PANEL).                       26040000
260500                                                                  26050000
260600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26060000
260700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26070000
260800             PERFORM 6111-WRITE-LIST-QUEUE                        26080000
260900         END-IF                                                   26090000
261000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26100000
261100                                                                  26110000
261200         PERFORM 6112-READ-LIST-QUEUE                             26120000
261300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26130000
261400             CONTINUE                                             26140000
261500         END-IF                                                   26150000
261600     END-IF.                                                      26160000
261700                                                                  26170000
261800     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     26180000
261900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26190000
262000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26200000
262100     MOVE LQW-SELECTED-SW (PV-SUB)                                26210000
262200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26220000
262300                                                                  26230000
262400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26240000
262500                                                                  26250000
262600*----------------------------------------------------------------*26260000
262700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26270000
262800*----------------------------------------------------------------*26280000
262900 6111-WRITE-LIST-QUEUE.                                           26290000
263000                                                                  26300000
263100     EXEC CICS                                                    26310000
263200         WRITEQ TS                                                26320000
263300             QUEUE (ASC-LIST-QUEUE-NAME)                          26330000
263400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26340000
263500             ITEM  (PV-SAVE-ITEM)                                 26350000
263600             REWRITE                                              26360000
263700             RESP  (PV-CICS-RESP)                                 26370000
263800     END-EXEC.                                                    26380000
263900                                                                  26390000
264000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26400000
264100         CONTINUE                                                 26410000
264200     ELSE                                                         26420000
264300         SET DP013-CICS-ABEND  TO  TRUE                           26430000
264400         SET DP013-NO-ROLLBACK TO  TRUE                           26440000
264500         MOVE '6111-WRITE-LIST-QUEUE'                             26450000
264600                               TO  DP013-PARAGRAPH                26460000
264700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26470000
264800                               TO  DP013-MESSAGE-TEXT(1)          26480000
264900         PERFORM DP013-0000-PROCESS-ABEND                         26490000
265000     END-IF.                                                      26500000
265100                                                                  26510000
265200*----------------------------------------------------------------*26520000
265300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26530000
265400*----------------------------------------------------------------*26540000
265500 6112-READ-LIST-QUEUE.                                            26550000
265600                                                                  26560000
265700     EXEC CICS                                                    26570000
265800         READQ TS                                                 26580000
265900             QUEUE (ASC-LIST-QUEUE-NAME)                          26590000
266000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26600000
266100             ITEM  (PV-ITEM)                                      26610000
266200             RESP  (PV-CICS-RESP)                                 26620000
266300     END-EXEC.                                                    26630000
266400                                                                  26640000
266500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26650000
266600         CONTINUE                                                 26660000
266700     ELSE                                                         26670000
266800         SET DP013-CICS-ABEND        TO TRUE                      26680000
266900         SET DP013-NO-ROLLBACK       TO TRUE                      26690000
267000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26700000
267100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26710000
267200                                     TO DP013-MESSAGE-TEXT(1)     26720000
267300         PERFORM DP013-0000-PROCESS-ABEND                         26730000
267400     END-IF.                                                      26740000
267500                                                                  26750000
267600*----------------------------------------------------------------*26760000
267700*    ABEND PROCESSOR MODULE                                      *26770000
267800*----------------------------------------------------------------*26780000
267900     COPY DPPD013.                                                26790000
268000*----------------------------------------------------------------*26800000
