000100*--------------------------------------------------------------*  00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*--------------------------------------------------------------*  00030000
000400 PROGRAM-ID.    POKCS080.                                         00040000
000500 AUTHOR.        SCOTT VANG.                                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  05-01-96.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*--------------------------------------------------------------*  00090000
001000/                                                                 00100000
001100*---------------------------------------------------------------* 00110000
001110*                                                               * 00120000
001200*    W080 - PURCHASE ORDER SKU RECEIVED LIST.                   * 00130000
001300*                                                               * 00140000
001400*    THIS PROGRAM GENERATES A LIST OF ORDERS FOR A SKU.         * 00150000
001500*    EACH ITEM LISTS THE PO NUMBER, PO LINE, DEST LOCATION,     * 00160000
001600*    SHIP DATE, RECEIVED DATE, ORDER QTY, RECEIVED QTY,         * 00170000
001700*    AND THE PERCENT RECEIVED.                                  * 00180000
001710*                                                               * 00190000
001800*    THE USER SPECIFIES THE SKU AND THE OTB RANGE.  THESE ARE   * 00200000
001900*    THE ONLY REQUIRED FIELDS.  A PO MAY APPEAR ON THE SCREEN   * 00210000
002000*    SEVERAL TIMES IF THE SKU HAS SEVERAL RECEIVINGS FOR THAT   * 00220000
002100*    SKU OR LINE.                                               * 00230000
002101*                                                               * 00240000
002102*    TOTALS ARE GIVEN FOR ORDER QTY, RECEIVED QTY, AND          * 00250000
002200*    A TOTAL PERCENT RECEIVED IS CALCULATED.                    * 00260000
002201*                                                               * 00270000
002202*    THESE LIST ITEMS MAY BE SELECTED AND THE ALLOCATION        * 00280000
002203*    FOR THE LINE WILL BE SHOWN.                                * 00290000
002204*                                                               * 00300000
002300*    NOTE: ONLY THE LINES OF THE PO WITH THE ENTERED SKU        * 00310000
002400*          ARE LISTED.                                          * 00320000
002401*                                                               * 00330000
002402*---------------------------------------------------------------* 00340000
002400* DATE: 03/02/01 CHANGE MADE BY RYAN A. STAUFFACHER             * 00350000
002401* REMOVED REFERENCES TO ON-ORDER VSAM FILE AND INSTEAD CALL     * 00360000
002401* TSKSTOO TABLE TO DETERMINE ON ORDER QUANTITY                  * 00370000
      * WR: 21995                                                     * 00380000
002402*---------------------------------------------------------------* 00390000
W24803* 05/02/03 - S PRABHAKAR RAO, IGSI - WR NO. 24803               * 00400000
W24803*    - IN MAP POKM080 REPLACED DEPARTMENT, CLASS AND            * 00410000
W24803*      SEQUENCE NUMBER BY DEPARTMENT, MAJOR CLASS, SUB CLASS    * 00420000
W24803*      AND SKU NUMBER AND ADJUSTED THE POSITIONS OF OTHER FIELDS* 00430000
W24803*                                                               * 00440000
W24803*    - REPLACED ALL REFERENCES TO TSK, TRECEIV TABLE            * 00450000
W24803*      BY CALLING XLKUT001 DOMAIN PROGRAM.                      * 00460000
W24803*    - COPY BOOKS POWS070, POWS017 ARE CHANGED.                 * 00470000
W24803*    - REPLACED DEPARTMENT, CLASS AND 3 DIGIT SEQUENCE NUMBER   * 00480000
W24803*      WITH DEPARTMENT, SUB CLASS, MAJOR CLASS AND SKU NUMBER   * 00490000
W24803*      RESPECTIVELY FOR NI SKU CONVERSION.                      * 00500000
W24803*    - REMOVED COPYBOOK KDU1820.                                * 00510000
W24803*    - REMOVED PROGRAM VARIABLES PV-SKU-NUMBER, PC-DASH.        * 00520000
W24803*    - CHANGES ARE MADE IN 'MR-OCCURS-LAYOUT' ACCORDING TO THE  * 00530000
W24803*      MAP CHANGES.                                             * 00540000
W24803*    - REPLACED PARAGRAPH 4305-GET-SKU-INFO WITH PARA           * 00550000
W24803*      4305-CALL-XLKUT-DOMAIN-PGM TO CALL THE XLKUT001 DOMAIN   * 00560000
W24803*      PROGRAM.                                                 * 00570000
W24803*    - REPLACED DEPARTMENT, CLASS AND SEQUENCE NUMBER WITH      * 00580000
W24803*      ITEM NUMBER IN PO-INFO-CSR CURSOR WHERE CONDITION.       * 00590000
W24803*    - IN THE PARA 4309-GET-SKU-ON-ORDER, DEPARTMENT, CLASS AND * 00600000
W24803*      SEQUENCE NUMBER IN THE WHERE CLAUSE WERE REPLACED WITH   * 00610000
W24803*      ITEM NUMBER.                                             * 00620000
W24803*                                                               * 00630000
W24803*---------------------------------------------------------------* 00640000
C98147* 11/14/14 - LINDA FRIESS          - CHG0098147                   00650049
C98147*    - EXPANDED PO NUMBER TO 9 DIGITS IN MAP, COMMAREA,           00660050
C98147*      AND POWS070 COPYBOOK                                       00670050
C98147*---------------------------------------------------------------* 00680049
076319* DATE  10/27/2021                                                00681052
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00682052
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00683052
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00684052
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00685053
076312*                                                               * 00686052
076318*---------------------------------------------------------------* 00687052
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278585      * 00688055
CICS  *                                                               * 00689054
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00689154
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00689254
CICS  *---------------------------------------------------------------* 00689354
002500/                                                                 00690000
002600*--------------------------------------------------------------*  00700000
002700 ENVIRONMENT DIVISION.                                            00710000
002800*--------------------------------------------------------------*  00720000
002900                                                                  00730000
003000*--------------------------------------------------------------*  00740000
003100 DATA DIVISION.                                                   00750000
003200*--------------------------------------------------------------*  00760000
003300                                                                  00770000
003400 WORKING-STORAGE SECTION.                                         00780000
003500                                                                  00790000
003600 01  DK-DB2-KEYS.                                                 00800000
003700     05  DK-REC-SEQ-NBR                 PIC S9(09) COMP VALUE +0. 00810000
003800                                                                  00820000
003900 01  PC-PROGRAM-CONSTANTS.                                        00830000
004000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00840000
004100                                                    'PO080A  '.   00850000
004200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00860000
004300                                                    'POKM080 '.   00870000
004400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00880000
004500                                                    'POKCS080'.   00890000
004602     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00900000
004700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00910000
004800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00920000
004900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00930000
005000                                                    COMP SYNC.    00940000
005100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00950000
005200                                                    COMP SYNC.    00960000
005300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00970000
005400                                                    +1000000      00980000
005500                                                    COMP-3.       00990000
005600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      01000000
005700                                                    COMP SYNC.    01010000
005800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      01020000
005900                                                    COMP-3.       01030000
005901     05  PC-PERCENT-SIGN                PIC  X(01)  VALUE '%'.    01040000
006000     05  PC-TSYMSG-NUMBERS.                                       01050000
006100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01060000
006200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01070000
006300         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01080000
006400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01090000
006500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01100000
006600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01110000
006700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01120000
006800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01130000
006900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01140000
007000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01150000
007100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01160000
007200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01170000
007210         10  PC-TSYMSG-00073            PIC  9(05)  VALUE 00073.  01180000
007220         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01190000
007230         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01200000
007240         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01210000
007250         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01220000
007260         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01230000
007270         10  PC-TSYMSG-00620            PIC  9(05)  VALUE 00620.  01240000
007280         10  PC-TSYMSG-00694            PIC  9(05)  VALUE 00694.  01250000
007281         10  PC-TSYMSG-00699            PIC  9(05)  VALUE 00699.  01260000
007290         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01270000
007300         10  PC-TSYMSG-01198            PIC  9(05)  VALUE 01198.  01280000
W24803         10  PC-TSYMSG-02616            PIC  9(05)  VALUE 02616.  01290000
007400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01300000
007500                                                                  01310000
007600 01  PS-PROGRAM-SWITCHES.                                         01320000
007700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01330000
007800         88  PS-NO-ERROR                            VALUE 'Y'.    01340000
007900         88  PS-ERROR                               VALUE 'N'.    01350000
008000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01360000
008100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01370000
008200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01380000
008300                                                                  01390000
008400 01  PV-PROGRAM-VARIABLES.                                        01400000
008500     05  PV-SUB                         PIC S9(04)  VALUE +0      01410000
008600                                                    COMP SYNC.    01420000
008700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01430000
008800                                                    COMP SYNC.    01440000
008900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01450000
009000                                                    COMP-3.       01460000
009100     05  PV-READ-COUNT-2                PIC S9(09)  VALUE +0      01470000
009200                                                    COMP-3.       01480000
009300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01490000
009400                                                    COMP-3.       01500000
009500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01510000
009600                                                    COMP-3.       01520000
009700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01530000
009800                                                    COMP-3.       01540000
009900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01550000
010000                                                    COMP-3.       01560000
010100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01570000
010200                                                    COMP-3.       01580000
010300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01590000
010400                                                    COMP-3.       01600000
010500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01610000
010600                                                    COMP SYNC.    01620000
010700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01630000
010800                                                    COMP SYNC.    01640000
010900     05  PV-CICS-RESPONSE               PIC S9(09)  VALUE ZERO    01650000
010901                                                    COMP SYNC.    01660000
010902     05  PV-ITEM                        PIC S9(04)  VALUE +0      01670000
011000                                                    COMP SYNC.    01680000
011100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01690000
011200                                                    COMP SYNC.    01700000
011300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01710000
011400                                                    COMP SYNC.    01720000
011500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01730000
011600                                                    COMP SYNC.    01740000
011700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01750000
011800                                                    COMP SYNC.    01760000
011900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01770000
012000                                                    COMP SYNC.    01780000
012100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01790000
012200                                                    COMP SYNC.    01800000
012300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01810000
012400                                                    COMP SYNC.    01820000
012500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01830000
012600                                                    COMP SYNC.    01840000
012700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01850000
012800                                                    COMP SYNC.    01860000
012900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01870000
013000                                                    COMP SYNC.    01880000
013100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01890000
013200                                                    COMP SYNC.    01900000
013300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01910000
013400                                                    COMP SYNC.    01920000
013500     05  PV-TOT-REC-ORDER-QTY           PIC S9(09)  VALUE +0      01930000
013600                                                      COMP-3.     01940000
013700     05  PV-TOT-ORDER-QTY               PIC S9(09)  VALUE +0      01950000
013800                                                      COMP-3.     01960000
013900     05  PV-UNITS-VERIFIED              PIC S9(06)  VALUE +0      01970000
014000                                                      COMP-3.     01980000
014100     05  PV-REC-VERIFIED-NULL           PIC S9(04)  VALUE +0      01990000
014200                                                    COMP.         02000000
014300     05  PV-CALC-PCT                    PIC S999V9999             02010000
014400                                                  VALUE ZERO.     02020000
014401     05  PV-CALC-PCT-2                  PIC S9(03)V9              02030000
014402                                                  VALUE ZERO.     02040000
014500     05  PV-CRE-DTE                     PIC X(10) VALUE SPACES.   02050000
014600                                                                  02060000
014702     05  PV-PO-HOLD                     PIC S9(09) VALUE +0       02070000
014800                                                       COMP.      02080000
014801     05  PV-LINE-HOLD                   PIC S9(04) VALUE +0       02090000
014802                                                       COMP.      02100000
014803     05  PV-LOC-HOLD                    PIC S9(04) VALUE +0       02110000
014804                                                       COMP.      02120000
014900     05  PV-DB2-COUNT                   PIC S9(09) VALUE +0       02130000
015000                                                       COMP-3.    02140000
W24803     05  PV-DEPT-NBR                    PIC S9(03) VALUE +0.      02150000
015302*---------------------------------------------------------------* 02160000
015303*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02170000
015304*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02180000
015400*   APPLICATION-SPECIFIC COMMAREA.                              * 02190000
015500*---------------------------------------------------------------* 02200000
015600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02210000
015700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02220000
015800     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           02230000
015900                                        INDEXED BY LQW-IDX.       02240000
016000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02250000
016100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02260000
016200         10  LQW-SELECTED-SW            PIC  X(01).               02270000
016300             88  LQW-SELECT                         VALUE 'S'.    02280000
016400             88  LQW-DESELECT                       VALUE ' '.    02290000
C98147         10  LQW-PO-NUMBER              PIC S9(09)  COMP-3.       02300049
016600         10  LQW-PO-LINE                PIC S9(03)  COMP-3.       02310000
016700         10  LQW-LOCATION               PIC  X(05).               02320000
016710         10  LQW-SHIP-DTE               PIC  X(08).               02330000
016800         10  LQW-RECEIVED-DTE           PIC  X(08).               02340000
016900         10  LQW-ORDER-QTY              PIC S9(06)  COMP-3.       02350000
017000         10  LQW-RECEIVED-QTY           PIC S9(06)  COMP-3.       02360000
017001         10  LQW-PERCENT-REC            PIC S9(03)  COMP-3.       02370000
017002         10  LQW-PERCENT-SIGN           PIC  X(01).               02380000
017200/                                                                 02390000
017300*---------------------------------------------------------------* 02400000
017400*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02410000
017500*---------------------------------------------------------------* 02420000
017600     COPY POWS070.                                                02430000
017700/                                                                 02440000
017710 EJECT                                                            02450000
017720                                                                  02460000
017730*----------------------------------------------------------------*02470000
017740*    DPWS038 IS THE COPYBOOK WORKAREA FOR DPPD030.               *02480000
017750*----------------------------------------------------------------*02490000
017760*    COPY DPWS038.                                                02500000
017770*EJECT                                                            02510000
017780                                                                  02520000
017800*---------------------------------------------------------------* 02530000
017900*    MAP LAYOUT                                                 * 02540000
018000*---------------------------------------------------------------* 02550000
018100     COPY POKM080.                                                02560000
018200                                                                  02570000
018300 01  MR-OCCURS-LAYOUT                   REDEFINES  PO080AO.       02580000
018400     05  FILLER                         PIC X(12).                02590000
018500     05  FILLER.                                                  02600000
W24803         10  MR-DCL                     PIC S9(04) COMP.          02610000
W24803         10  MR-DCA                     PIC  X(01).               02620000
W24803         10  MR-DCC                     PIC  X(01).               02630000
W24803         10  MR-DCH                     PIC  X(01).               02640000
W24803         10  MR-DC-X.                                             02650000
019001            15  MR-DEPT                 PIC  X(03).               02660000
W24803            15  MR-SPACE-1              PIC  X(01).               02670000
W24803            15  MR-MAJ-CL               PIC  X(02).               02680000
W24803            15  MR-SPACE-2              PIC  X(01).               02690000
W24803            15  MR-SUB-CL               PIC  X(02).               02700000
020300                                                                  02710000
020400         10  MR-STYLEL                  PIC S9(04) COMP.          02720000
020500         10  MR-STYLEA                  PIC  X(01).               02730000
020600         10  MR-STYLEC                  PIC  X(01).               02740000
020700         10  MR-STYLEH                  PIC  X(01).               02750000
020800         10  MR-STYLE                   PIC  X(20).               02760000
020900                                                                  02770000
W24803         10  MR-SKUL                     PIC S9(04) COMP.         02780000
W24803         10  MR-SKUA                     PIC  X(01).              02790000
W24803         10  MR-SKUC                     PIC  X(01).              02800000
W24803         10  MR-SKUH                     PIC  X(01).              02810000
W24803         10  MR-SKU                      PIC  X(8).               02820000
021500                                                                  02830000
021600         10  MR-COLORL                  PIC S9(04) COMP.          02840000
021700         10  MR-COLORA                  PIC  X(01).               02850000
021800         10  MR-COLORC                  PIC  X(01).               02860000
021900         10  MR-COLORH                  PIC  X(01).               02870000
022000         10  MR-COLOR                   PIC  X(25).               02880000
022100                                                                  02890000
W24803         10  MR-DESCL                   PIC S9(04) COMP.          02900000
W24803         10  MR-DESCA                   PIC  X(01).               02910000
W24803         10  MR-DESCC                   PIC  X(01).               02920000
W24803         10  MR-DESCH                   PIC  X(01).               02930000
W24803         10  MR-DESC                    PIC  X(30).               02940000
022700                                                                  02950000
022800         10  MR-SIZEL                   PIC S9(04) COMP.          02960000
022900         10  MR-SIZEA                   PIC  X(01).               02970000
023000         10  MR-SIZEC                   PIC  X(01).               02980000
023100         10  MR-SIZEH                   PIC  X(01).               02990000
023200         10  MR-SIZE                    PIC  X(25).               03000000
023300                                                                  03010000
W24803         10  MR-ON-ORDERL               PIC S9(04) COMP.          03020000
W24803         10  MR-ON-ORDERA               PIC  X(01).               03030000
W24803         10  MR-ON-ORDERC               PIC  X(01).               03040000
W24803         10  MR-ON-ORDERH               PIC  X(01).               03050000
W24803         10  MR-ON-ORDER                PIC Z,ZZZ,ZZ9.            03060000
027901                                                                  03070000
W24803         10  MR-VEND-NAMEL              PIC S9(04) COMP.          03080000
W24803         10  MR-VEND-NAMEA              PIC  X(01).               03090000
W24803         10  MR-VEND-NAMEC              PIC  X(01).               03100000
W24803         10  MR-VEND-NAMEH              PIC  X(01).               03110000
W24803         10  MR-VEND-NAME               PIC  X(25).               03120000
W24803         10  FILLER                     PIC  X(36).               03130000
027903                                                                  03140000
W24803                                                                  03150000
W24803                                                                  03160000
027904     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          03170000
027905         10  MR-SELECTL                 PIC S9(04) COMP.          03180000
027906         10  MR-SELECTA                 PIC  X(01).               03190000
027907         10  MR-SELECTC                 PIC  X(01).               03200000
027908         10  MR-SELECTH                 PIC  X(01).               03210000
027909         10  MR-SELECT                  PIC  X(01).               03220000
027910                                                                  03230000
027911         10  MR-PO-NBRL                 PIC S9(04) COMP.          03240000
027912         10  MR-PO-NBRA                 PIC  X(01).               03250000
027913         10  MR-PO-NBRC                 PIC  X(01).               03260000
027914         10  MR-PO-NBRH                 PIC  X(01).               03270000
027915         10  MR-PO-NBR-X.                                         03280000
C98147             15  MR-PO-NBR              PIC  ZZZZZZZZZ.           03290049
027917                                                                  03300000
027918         10  MR-PO-LINE-NBRL            PIC S9(04) COMP.          03310000
027919         10  MR-PO-LINE-NBRA            PIC  X(01).               03320000
027920         10  MR-PO-LINE-NBRC            PIC  X(01).               03330000
027921         10  MR-PO-LINE-NBRH            PIC  X(01).               03340000
027922         10  MR-PO-LINE-NBR             PIC  ZZZ.                 03350000
027923                                                                  03360000
027924         10  MR-LOCATIONL               PIC S9(04) COMP.          03370000
027925         10  MR-LOCATIONA               PIC  X(01).               03380000
027926         10  MR-LOCATIONC               PIC  X(01).               03390000
027927         10  MR-LOCATIONH               PIC  X(01).               03400000
027928         10  MR-LOCATION                PIC  X(05).               03410000
027929                                                                  03420000
027930         10  MR-SHIP-DTEL               PIC S9(04) COMP.          03430000
027931         10  MR-SHIP-DTEA               PIC  X(01).               03440000
027932         10  MR-SHIP-DTEC               PIC  X(01).               03450000
027933         10  MR-SHIP-DTEH               PIC  X(01).               03460000
027934         10  MR-SHIP-DTE                PIC  X(08).               03470000
027935                                                                  03480000
027936         10  MR-REC-DTEL                PIC S9(04) COMP.          03490000
027937         10  MR-REC-DTEA                PIC  X(01).               03500000
027938         10  MR-REC-DTEC                PIC  X(01).               03510000
027939         10  MR-REC-DTEH                PIC  X(01).               03520000
027940         10  MR-REC-DTE                 PIC  X(08).               03530000
027941                                                                  03540000
027942         10  MR-ORD-QTYL                PIC S9(04) COMP.          03550000
027943         10  MR-ORD-QTYA                PIC  X(01).               03560000
027944         10  MR-ORD-QTYC                PIC  X(01).               03570000
027945         10  MR-ORD-QTYH                PIC  X(01).               03580000
027946         10  MR-ORD-QTY-X.                                        03590000
027947             15  MR-ORD-QTY             PIC  ZZZ,ZZZ.             03600000
027948                                                                  03610000
027949         10  MR-REC-QTYL                PIC S9(04) COMP.          03620000
027950         10  MR-REC-QTYA                PIC  X(01).               03630000
027951         10  MR-REC-QTYC                PIC  X(01).               03640000
027952         10  MR-REC-QTYH                PIC  X(01).               03650000
027953         10  MR-REC-QTY-X.                                        03660000
028000             15  MR-REC-QTY             PIC  ZZZ,ZZZ.             03670000
028100                                                                  03680000
028200         10  MR-PCT-RECL                PIC S9(04) COMP.          03690000
028300         10  MR-PCT-RECA                PIC  X(01).               03700000
028400         10  MR-PCT-RECC                PIC  X(01).               03710000
028500         10  MR-PCT-RECH                PIC  X(01).               03720000
028600         10  MR-PCT-REC-X.                                        03730000
028700             15  MR-PCT-REC             PIC    ZZZ.               03740000
028710             15  MR-PCT-SIGN            PIC  X(01).               03750000
028800                                                                  03760000
028900     05  FILLER.                                                  03770000
029000         10  MR-ORDERTOTL               PIC S9(04) COMP.          03780000
029100         10  MR-ORDERTOTA               PIC  X(01).               03790000
029200         10  MR-ORDERTOTC               PIC  X(01).               03800000
029300         10  MR-ORDERTOTH               PIC  X(01).               03810000
029400         10  MR-ORDERTOT-X.                                       03820000
029500             15  MR-ORDERTOT            PIC  ZZ,ZZZ,ZZ9.          03830000
029600                                                                  03840000
029700     05  FILLER.                                                  03850000
029800         10  MR-RECTOTL                 PIC S9(04) COMP.          03860000
029900         10  MR-RECTOTA                 PIC  X(01).               03870000
030000         10  MR-RECTOTC                 PIC  X(01).               03880000
030100         10  MR-RECTOTH                 PIC  X(01).               03890000
030200         10  MR-RECTOT-X.                                         03900000
030300             15  MR-RECTOT              PIC  ZZ,ZZZ,ZZ9.          03910000
030400                                                                  03920000
030500     05  FILLER.                                                  03930000
030600         10  MR-PCT-TOTL                PIC S9(04) COMP.          03940000
030700         10  MR-PCT-TOTA                PIC  X(01).               03950000
030800         10  MR-PCT-TOTC                PIC  X(01).               03960000
030900         10  MR-PCT-TOTH                PIC  X(01).               03970000
031000         10  MR-PCT-TOT-X.                                        03980000
031100             15  MR-PCTTOT             PIC     ZZZ.               03990000
031110             15  MR-PCT-SIGN-TOT       PIC   X(01).               04000000
031200/                                                                 04010000
031300*---------------------------------------------------------------* 04020000
031400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04030000
031500*---------------------------------------------------------------* 04040000
031600     COPY DPWS015.                                                04050000
031700/                                                                 04060000
031800*---------------------------------------------------------------* 04070000
031900*    FUNCTION KEYS COPYBOOK.                                    * 04080000
032000*---------------------------------------------------------------* 04090000
032100     COPY DPWS016.                                                04100000
032200/                                                                 04110000
032300*---------------------------------------------------------------* 04120000
032400*    NUMERIC EDIT LAYOUT.                                       * 04130000
032500*---------------------------------------------------------------* 04140000
032600     COPY DPWS010I.                                               04150000
032700/                                                                 04160000
032800*---------------------------------------------------------------* 04170000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04180054
033000*---------------------------------------------------------------* 04190000
033100     COPY DPWS030.                                                04200000
CICS       COPY DPWS930.                                                04201054
033200/                                                                 04210000
033306*---------------------------------------------------------------* 04220000
033400*    STANDARD COMMAREA.                                         * 04230000
033500*---------------------------------------------------------------* 04240000
033600     COPY DPWS020.                                                04250000
033700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04260000
033800/                                                                 04270000
033900*---------------------------------------------------------------* 04280000
034000* INTER-APPLICATION COMMAREA.                                   * 04290000
034100*---------------------------------------------------------------* 04300000
034200         10  INTER-APPL-COMM-AREA       PIC X(200).               04310000
034300     COPY POWS017.                                                04320000
034400     COPY POWS013.                                                04330000
034500     COPY POWS069.                                                04340000
034600/                                                                 04350000
034700*---------------------------------------------------------------* 04360000
034800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04370000
034900*---------------------------------------------------------------* 04380000
035000         10  ASC-SPECIFIC-COMMAREA.                               04390000
035100             15  ASC-LIST-KEYS.                                   04400000
035200                 20  ASC-DEPT-NBR        PIC X(03).               04410000
W24803                 20  ASC-MAJ-CL-NBR      PIC 9(02).               04420000
W24803                 20  ASC-SUB-CL-NBR      PIC 9(02).               04430000
W24803                 20  ASC-ITM-NBR         PIC S9(15) COMP-3.       04440000
035500                 20  ASC-STYLE           PIC X(20).               04450000
W24803                 20  ASC-SKU-NBR         PIC 9(08).               04460000
035600                 20  ASC-DESC            PIC X(30).               04470000
035700                 20  ASC-COLOR           PIC X(25).               04480000
035800                 20  ASC-VEND-NAME       PIC X(30).               04490000
035900                 20  ASC-SIZE            PIC X(25).               04500000
038800                 20  ASC-ON-ORDER        PIC S9(07) COMP-3.       04510000
038801                 20  ASC-OTB-BEG         PIC X(06).               04520000
038803                 20  ASC-OTB-END         PIC X(06).               04530000
038805             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04540000
038806                 20  ASC-BLOCK-MODIFIED-SW                        04550000
038807                                        PIC X(01).                04560000
038808                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    04570000
038809                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    04580000
038810                                                                  04590000
038811                 20  ASC-ITEM-ARRAY.                              04600000
038812                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        04610000
038813                         30  ASC-LIST-ITEM-NUMBER                 04620000
038814                                        PIC S9(09)  COMP-3.       04630000
038815                         30  ASC-TEMP-SELECTED-SW                 04640000
038816                                        PIC X(01).                04650000
038817                             88  ASC-VALID-SELECT   VALUE ' '     04660000
038818                                                          'S'     04670000
038819                                                          'B'     04680000
038820                                                          'E'.    04690000
038821                             88  ASC-TEMP-NO-SELECT VALUE ' '.    04700000
038822                             88  ASC-TEMP-SELECT    VALUE 'S'.    04710000
038823                             88  ASC-TEMP-BEGIN     VALUE 'B'.    04720000
038824                             88  ASC-TEMP-END       VALUE 'E'.    04730000
038825                         30  ASC-SELECTED-SW                      04740000
038826                                        PIC X(01).                04750000
038827                             88  ASC-NO-SELECT      VALUE ' '.    04760000
038828                             88  ASC-SELECT         VALUE 'S'.    04770000
038829                             88  ASC-BEGIN          VALUE 'B'.    04780000
038830                             88  ASC-END            VALUE 'E'.    04790000
038840                         30  ASC-PO-NBR                           04800000
C98147                                        PIC S9(09) COMP-3.        04810049
039000                         30  ASC-LINE                             04820000
039100                                        PIC S9(03) COMP-3.        04830000
039200                         30  ASC-LOCATION                         04840000
039300                                        PIC X(05).                04850000
039301                         30  ASC-SHIP-DTE                         04860000
039302                                        PIC X(08).                04870000
039400                         30  ASC-RECEIVED-DTE                     04880000
039500                                        PIC X(08).                04890000
039600                         30  ASC-ORDER-QTY                        04900000
039700                                        PIC S9(06) COMP-3.        04910000
039800                         30  ASC-RECEIVED-QTY                     04920000
039900                                        PIC S9(06) COMP-3.        04930000
040000                         30  ASC-PERCENT-REC                      04940000
040100                                        PIC S9(03) COMP-3.        04950000
040101                         30  ASC-PERCENT-SIGN                     04960000
040102                                        PIC X(01).                04970000
040103                                                                  04980000
040300             15  ASC-TOT-ORDER-QTY         PIC S9(09)             04990000
040400                                                 COMP-3.          05000000
040500             15  ASC-TOT-REC-ORDER-QTY     PIC S9(09)             05010000
040600                                                 COMP-3.          05020000
040700             15  ASC-TOT-PCT               PIC S9(03)             05030000
040800                                                 COMP-3.          05040000
040801             15  ASC-PERCENT-SIGN-TOT      PIC X(01).             05050000
040802                                                                  05060000
040900             15  ASC-ENT-ID             PIC S9(09) COMP.          05070000
041000             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     05080000
041100             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     05090000
041200             15  ASC-NUMBER-OF-ITEMS-READ                         05100000
041300                                        PIC S9(09) COMP-3.        05110000
041400             15  ASC-NUMBER-OF-SELECTED-ITEMS                     05120000
041500                                        PIC S9(09) COMP-3.        05130000
041600             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        05140000
041700             15  ASC-ITEM-AT-TOP-OF-PANEL                         05150000
041800                                        PIC S9(09) COMP-3.        05160000
041900             15  ASC-ITEM-AT-BOT-OF-PANEL                         05170000
042000                                        PIC S9(09) COMP-3.        05180000
042100             15  ASC-HIGHEST-BLOCK-WRITTEN                        05190000
042200                                        PIC S9(04) COMP SYNC.     05200000
042300             15  ASC-START-OF-SELECTED-RANGE                      05210000
042400                                        PIC S9(09) COMP-3.        05220000
042500             15  ASC-END-OF-SELECTED-RANGE                        05230000
042600                                        PIC S9(09) COMP-3.        05240000
042700             15  ASC-ITEMS-LEFT-INDICATOR                         05250000
042800                                        PIC X(01).                05260000
042900                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     05270000
043000                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     05280000
043100             15  ASC-ITEMS-LEFT-INDICATOR-2                       05290000
043200                                        PIC X(01).                05300000
043300                 88  ASC-ITEMS-LEFT-ON-DB-2        VALUE 'Y'.     05310000
043400                 88  ASC-NO-ITEMS-LEFT-ON-DB-2     VALUE 'N'.     05320000
043500             15  ASC-TEMP-QUEUE-UPDATE-SW                         05330000
043600                                        PIC X(01).                05340000
043700                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     05350000
043800                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     05360000
043900             15  ASC-LIST-QUEUE-NAME.                             05370000
044000                 20  ASC-LIST-TERM-ID   PIC X(04).                05380000
044100                 20  ASC-LIST-TASK-NUMBER                         05390000
044200                                        PIC S9(05) COMP-3.        05400000
044300                 20  ASC-LIST-SEQ       PIC 9(01).                05410000
044400             15  ASC-SEL-QUEUE-NAME.                              05420000
044500                 20  ASC-SEL-TERM-ID    PIC X(04).                05430000
044600                 20  ASC-SEL-TASK-NUMBER                          05440000
044700                                        PIC S9(05) COMP-3.        05450000
044800                 20  ASC-SEL-SEQ        PIC 9(01).                05460000
044900                                                                  05470000
045000             15  ASC-START-ITEM-REQUEST.                          05480000
045100                 20  ASC-START-ITEM-REQUEST-N                     05490000
045200                                        PIC 9(07).                05500000
W24803         10  FILLER                     PIC X(1712).              05510000
045300/                                                                 05520000
045400*---------------------------------------------------------------* 05530000
045500*    ABEND PROCESSING COPYBOOK.                                 * 05540000
045600*---------------------------------------------------------------* 05550000
045700     COPY DPWS013.                                                05560000
045800/                                                                 05570000
W24803*---------------------------------------------------------------* 05580000
W24803*    XLKUT001 DOMAIN PROGRAM COPYBOOK.                          * 05590000
W24803*---------------------------------------------------------------* 05600000
W24803                                                                  05610000
W24803     COPY XLWS001.                                                05620000
W24803/                                                                 05630000
045900*---------------------------------------------------------------* 05640000
046000*    DB2 AREA FOR RECEIVER DISTRIBUTION TABLE                   * 05650000
046100*---------------------------------------------------------------* 05660000
046200     EXEC SQL                                                     05670000
046300          INCLUDE TRECDIS                                         05680000
046400     END-EXEC.                                                    05690000
046500/                                                                 05700000
047300*---------------------------------------------------------------* 05710000
047400*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 05720000
047500*---------------------------------------------------------------* 05730000
047600     EXEC SQL                                                     05740000
047700          INCLUDE TRECITM                                         05750000
047800     END-EXEC.                                                    05760000
047900/                                                                 05770000
048000*---------------------------------------------------------------* 05780000
048100*    DB2 AREA FOR PURCHASE ITEM TABLE                           * 05790000
048200*---------------------------------------------------------------* 05800000
048300     EXEC SQL                                                     05810000
048400          INCLUDE TPURITM                                         05820000
048500     END-EXEC.                                                    05830000
048600/                                                                 05840000
048700*---------------------------------------------------------------* 05850000
048800*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 05860000
048900*---------------------------------------------------------------* 05870000
049000     EXEC SQL                                                     05880000
049100          INCLUDE TPURCHS                                         05890000
049200     END-EXEC.                                                    05900000
049300/                                                                 05910000
049400*---------------------------------------------------------------* 05920000
049500*    DB2 AREA FOR PURCHASE SKSTOO TABLE                         * 05930000
049600*---------------------------------------------------------------* 05940000
049700     EXEC SQL                                                     05950000
049800          INCLUDE TSKSTOO                                         05960000
049900     END-EXEC.                                                    05970000
049300/                                                                 05980000
049400*---------------------------------------------------------------* 05990000
049500*    DB2 AREA FOR PURCHASE SHIPMENT PLAN TABLE                  * 06000000
049600*---------------------------------------------------------------* 06010000
049700     EXEC SQL                                                     06020000
049800          INCLUDE TPLNSHP                                         06030000
049900     END-EXEC.                                                    06040000
049901/                                                                 06050000
049902*---------------------------------------------------------------* 06060000
049903*    DB2 AREA FOR PURCHASE ALLOCATION PLAN TABLE                * 06070000
049904*---------------------------------------------------------------* 06080000
049905     EXEC SQL                                                     06090000
049906          INCLUDE TALLPLN                                         06100000
049907     END-EXEC.                                                    06110000
050000/                                                                 06120000
050100*---------------------------------------------------------------* 06130000
050200*    DB2 AREA FOR MERCHANDISE AREA TABLE                        * 06140000
050300*---------------------------------------------------------------* 06150000
050400     EXEC SQL                                                     06160000
050500          INCLUDE TMDSEAR                                         06170000
050600     END-EXEC.                                                    06180000
050700/                                                                 06190000
051500*---------------------------------------------------------------* 06200000
051600*    DB2 AREA FOR ENTITY NAME TABLE                             * 06210000
051700*---------------------------------------------------------------* 06220000
051800     EXEC SQL                                                     06230000
051900          INCLUDE TENTNME                                         06240000
052000     END-EXEC.                                                    06250000
052001/                                                                 06260000
052002*---------------------------------------------------------------* 06270000
052003*    DB2 AREA FOR STORE TABLE                                   * 06280000
052004*---------------------------------------------------------------* 06290000
052005     EXEC SQL                                                     06300000
052006          INCLUDE XMT00001                                        06310044
052007     END-EXEC.                                                    06320000
052100/                                                                 06330000
052200*---------------------------------------------------------------* 06340000
052300*    DB2 AREA FOR COMMUNICATIONS                                * 06350000
052400*---------------------------------------------------------------* 06360000
052500     EXEC SQL                                                     06370000
052600          INCLUDE SQLCA                                           06380000
052700     END-EXEC.                                                    06390000
052800/                                                                 06400000
052900*---------------------------------------------------------------* 06410000
053000*  CURSOR TO SELECT PURCHASE ORDER INFORMATION                  * 06420000
053100*---------------------------------------------------------------* 06430000
053200     EXEC SQL                                                     06440000
053300          DECLARE PO-INFO-CSR CURSOR FOR                          06450000
053400          SELECT A.PO_NBR                                         06460000
053500                ,A.DIR_STR_IND                                    06470000
053600                ,B.APP_PO_LNE_NBR                                 06480000
053800                ,C.DONT_SHIP_BEF_DTE                              06490000
053801                ,D.DEST_NBR                                       06500000
053802                ,D.CURR_SPLIT_QTY                                 06510000
053900          FROM   TPURCHS A                                        06520000
054000                ,TPURITM B                                        06530000
054100                ,TPLNSHP C                                        06540000
054110                ,TALLPLN D                                        06550000
054320          WHERE A.OTB_PER_NBR BETWEEN :ASC-OTB-BEG                06560000
054400                                  AND :ASC-OTB-END                06570000
054600            AND A.VER_STATUS_CDE = 'A'                            06580000
054700            AND A.STATUS_CDE     IN ('AC','AP','CM','CA')         06590000
054800            AND A.PO_NBR         = B.PO_NBR                       06600000
W24803            AND B.ITM_NBR        = :PURITM-ITM-NBR                06610000
055100            AND B.VER_STATUS_CDE = 'A'                            06620000
055110            AND B.STATUS_CDE     NOT IN ('CA')                    06630000
055200            AND C.PO_NBR         = A.PO_NBR                       06640000
055300            AND C.VER_STATUS_CDE = 'A'                            06650000
055301            AND D.PO_NBR         = B.PO_NBR                       06660000
055302            AND D.PO_LNE_NBR     = B.PO_LNE_NBR                   06670000
055303                                                                  06680000
055320            ORDER BY C.DONT_SHIP_BEF_DTE                          06690000
055321                    ,A.PO_NBR                                     06700000
055322                    ,B.APP_PO_LNE_NBR                             06710000
055400     END-EXEC.                                                    06720000
055500/                                                                 06730000
055600*---------------------------------------------------------------* 06740000
055700*  CURSOR TO SELECT RECEIVER DATE AND QUANTITY                  * 06750000
055800*---------------------------------------------------------------* 06760000
055900     EXEC SQL                                                     06770000
056000          DECLARE RCVRQTY-CSR CURSOR FOR                          06780000
056100                  SELECT DATE(A.CRE_TMST),                        06790000
056200                        A.REC_SEQ_NBR,                            06800000
056300                        SUM(B.AP_VERIFY_ITM_QTY)                  06810000
056400                  FROM TRECITM A,                                 06820000
056500                       TRECDIS B                                  06830000
056600                                                                  06840000
056700                  WHERE A.ORD_NBR        = :PURCHS-PO-NBR         06850000
056720                    AND A.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR 06860000
056730                    AND A.VER_STATUS_CDE = 'A'                    06870000
056740                    AND A.STATUS_CDE     = 'VE'                   06880000
056750                    AND B.ORD_NBR        = A.ORD_NBR              06890000
056760                    AND B.ORD_LNE_NBR    = A.ORD_LNE_NBR          06900000
056770                    AND B.REC_SEQ_NBR    = A.REC_SEQ_NBR          06910000
056780                    AND B.VER_STATUS_CDE = 'A'                    06920000
056790                    AND B.OPER_UNT_ID    = A.OPER_UNT_ID          06930000
056800                    AND B.FCLTY_ID       = A.FCLTY_ID             06940000
056810                    AND B.OPER_UNT_ID    = :ALLPLN-DEST-NBR       06950000
056900                                                                  06960000
057000                    GROUP BY A.CRE_TMST, A.REC_SEQ_NBR            06970000
057020                    ORDER BY 1                                    06980000
057100     END-EXEC.                                                    06990000
057200/                                                                 07000000
057300*---------------------------------------------------------------* 07010000
057400 LINKAGE SECTION.                                                 07020000
057500*---------------------------------------------------------------* 07030000
057600 01  DFHCOMMAREA.                                                 07040000
057700     05  FILLER                         OCCURS  1 TO 4072 TIMES   07050000
057800                                        DEPENDING ON EIBCALEN.    07060000
057900         10  FILLER                     PIC X.                    07070000
058000/                                                                 07080000
058100*---------------------------------------------------------------* 07090000
058200 PROCEDURE DIVISION.                                              07100000
058300*---------------------------------------------------------------* 07110000
058400*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07120000
058500*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07130000
058600*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07140000
058700*---------------------------------------------------------------* 07150000
058800 0000-MAIN-MODULE.                                                07160000
058900     INITIALIZE DP030-CICS-API-FIELDS.                            07170000
059000                                                                  07180000
059100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07190000
059200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07200000
059300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07210000
059400                                                                  07220000
059500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07230000
059600                                                                  07240000
059700     MOVE LENGTH OF PO080AI        TO DP030-MAP-LENGTH (1).       07250000
059800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07260000
059900                                                                  07270000
060000     PERFORM 9000-CALL-CICS-ARCH-API.                             07280000
060010*                                                                 07290000
060020*    PERFORM DP038-0000-SET-DB2-PKG.                              07300000
060030*                                                                 07310000
060100     PERFORM 1000-CONTROL-PROCESSING                              07320000
060200                                                                  07330000
060300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07340000
060400     PERFORM 9000-CALL-CICS-ARCH-API.                             07350000
060500/                                                                 07360000
060600*----------------------------------------------------------------*07370000
060700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07380000
060800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07390000
060900*                                                                *07400000
061000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07410000
061100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07420000
061200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07430000
061300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07440000
061400*----------------------------------------------------------------*07450000
061500 1000-CONTROL-PROCESSING.                                         07460000
061600                                                                  07470000
061700     EVALUATE TRUE                                                07480000
061800                                                                  07490000
061900         WHEN DP020-NEXT-ACT-INITIAL                              07500000
062000             INITIALIZE ASC-SPECIFIC-COMMAREA                     07510000
062100                                                                  07520000
062200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07530000
062300                                      ASC-SEL-TERM-ID             07540000
062400             MOVE DP020-SRC-TASK-NUMBER                           07550000
062500                                   TO ASC-LIST-TASK-NUMBER        07560000
062600                                      ASC-SEL-TASK-NUMBER         07570000
062700             MOVE PC-LIST-QUEUE-SEQ                               07580000
062800                                   TO ASC-LIST-SEQ                07590000
062900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07600000
063000                                                                  07610000
063100             SET PS-COMMAREA-VALID    TO TRUE                     07620000
063200             MOVE SPACE               TO ASC-START-ITEM-REQUEST   07630000
063300                                                                  07640000
063400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07650000
063500             IF  PS-COMMAREA-NOT-VALID                            07660000
063600                 SET DP020-NEXT-ACT-APPL-ERROR                    07670000
063700                                   TO TRUE                        07680000
063800             ELSE                                                 07690000
063900                 PERFORM 4000-BUILD-INITIAL-PANEL                 07700000
064000             END-IF                                               07710000
064100                                                                  07720000
064200         WHEN DP020-NEXT-ACT-READ-MAP                             07730000
064300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07740000
064400                                   TO PV-TOP-ITEM                 07750000
064500             PERFORM 2000-PROCESS-PANEL                           07760000
064600                                                                  07770000
064700         WHEN DP020-NEXT-ACT-RETURN                               07780000
064800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07790000
064900                                   TO PV-TOP-ITEM                 07800000
065000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07810000
065100             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07820000
065200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07830000
065300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07840000
065400                                                                  07850000
065500         WHEN OTHER                                               07860000
065600             SET DP013-LOGIC-ABEND TO TRUE                        07870000
065700             SET DP013-NO-ROLLBACK TO TRUE                        07880000
065800             MOVE '1000-CONTROL-PROCESSING'                       07890000
065900                                   TO DP013-PARAGRAPH             07900000
066000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07910000
066100                                   TO DP013-MESSAGE-TEXT(1)       07920000
066200             PERFORM DP013-0000-PROCESS-ABEND                     07930000
066300     END-EVALUATE.                                                07940000
066400/                                                                 07950000
066500*----------------------------------------------------------------*07960000
066600* MOVE AND EDIT DATA PASSED THROUGH THE INTER-APPL COMMAREA       07970000
066700*----------------------------------------------------------------*07980000
066800                                                                  07990000
066900 1100-PROCESS-INTER-APPL-COMM.                                    08000000
067000                                                                  08010000
W24803         IF  PO017-SKU-NBR IS NUMERIC                             08020000
W24803         AND PO017-SKU-NBR NOT = 0                                08030000
W24803              MOVE PO017-SKU-NBR TO ASC-SKU-NBR                   08040000
W24803              INITIALIZE  XL001-COMMAREA                          08050000
W24803              INITIALIZE  XL001-ITEM-COMMAREA                     08060000
W24803              IF ASC-SKU-NBR (5:3) = '000' OR                     08070000
W24803                 ASC-SKU-NBR (5:3) = '999'                        08080000
W24803                 MOVE 0                    TO ASC-ON-ORDER        08090000
W24803              ELSE                                                08100000
W24803                 PERFORM 4305-CALL-XLKUT-DOMAIN-PGM               08110000
W24803                 MOVE XL001-DEPT-NBR       TO PV-DEPT-NBR         08120000
W24803                 MOVE PV-DEPT-NBR          TO ASC-DEPT-NBR        08130000
W24803                 MOVE XL001-MAJ-CL-NBR     TO ASC-MAJ-CL-NBR      08140000
W24803                 MOVE XL001-SUB-CL-NBR     TO ASC-SUB-CL-NBR      08150000
W24803                 MOVE XL001-VS-NBR         TO ASC-STYLE           08160000
W24803                 MOVE XL001-SKU-DESC       TO ASC-DESC            08170000
W24803                 MOVE XL001-SHRT-CLOR-DESC TO ASC-COLOR           08180000
W24803                 MOVE XL001-SIZE-DESC      TO ASC-SIZE            08190000
W24803                 MOVE XL001-ENT-ID         TO ASC-ENT-ID          08200000
W24803                 MOVE XL001-ITM-NBR        TO ASC-ITM-NBR         08210000
W24803                 IF PS-NO-ERROR                                   08220000
070691                   PERFORM 4309-GET-SKU-ON-ORDER                  08230000
W24803                 END-IF                                           08240000
W24803              END-IF                                              08250000
W24803         ELSE                                                     08260000
W24803            MOVE PC-TSYMSG-02616                                  08270000
W24803                              TO DP020-MSG-NUMBER                 08280000
W24803            SET PS-ERROR                                          08290000
W24803                PS-COMMAREA-NOT-VALID                             08300000
W24803                DP020-MSG-FATAL  TO TRUE                          08310000
070700         END-IF.                                                  08320000
070800                                                                  08330000
070900         IF PS-NO-ERROR                                           08340000
071000            IF PO017-OTB-PER-NBR-BEG  = SPACES                    08350000
071100            AND PO017-OTB-PER-NBR-END = SPACES                    08360000
071200               SET PS-ERROR                                       08370000
071300                   DP020-MSG-FATAL                                08380000
071400                   PS-COMMAREA-NOT-VALID                          08390000
071500                   DP030-SET-CURSOR-APPL-1 TO TRUE                08400000
071600               MOVE PC-TSYMSG-01198        TO DP020-MSG-NUMBER    08410000
071700         END-IF.                                                  08420000
071800                                                                  08430000
071900         IF PS-NO-ERROR                                           08440000
072000            IF PO017-OTB-PER-NBR-BEG > SPACES                     08450000
072010               IF PO017-OTB-PER-NBR-BEG(1:2) > 80                 08460000
072020                  MOVE '19' TO ASC-OTB-BEG(1:2)                   08470000
072030               ELSE                                               08480000
072040                  MOVE '20' TO ASC-OTB-BEG(1:2)                   08490000
072050               END-IF                                             08500000
072100               MOVE PO017-OTB-PER-NBR-BEG TO ASC-OTB-BEG(3:4)     08510000
072200            END-IF                                                08520000
072300                                                                  08530000
072400            IF PO017-OTB-PER-NBR-END > SPACES                     08540000
072510               IF PO017-OTB-PER-NBR-END(1:2) > 80                 08550000
072520                  MOVE '19' TO ASC-OTB-END(1:2)                   08560000
072530               ELSE                                               08570000
072540                  MOVE '20' TO ASC-OTB-END(1:2)                   08580000
072550               END-IF                                             08590000
072560               MOVE PO017-OTB-PER-NBR-END TO ASC-OTB-END(3:4)     08600000
072600            END-IF                                                08610000
072700                                                                  08620000
072800            IF (ASC-OTB-BEG > SPACES                              08630000
072900               AND ASC-OTB-END NOT > SPACES)                      08640000
073000                 MOVE ASC-OTB-BEG TO ASC-OTB-END                  08650000
073100            END-IF                                                08660000
073200            IF (ASC-OTB-END > SPACES                              08670000
073300               AND ASC-OTB-BEG NOT > SPACES)                      08680000
073400                 MOVE ASC-OTB-END TO ASC-OTB-BEG                  08690000
073500            END-IF                                                08700000
073600         END-IF.                                                  08710000
073700/                                                                 08720000
073800*----------------------------------------------------------------*08730000
073900* CHECK IF THE DEPT ENTERED BY THE USER IS A VALID ONE           *08740000
074000*----------------------------------------------------------------*08750000
074100 1110-VALIDATE-DEPT.                                              08760000
074200                                                                  08770000
074300     PERFORM                                                      08780000
074400         WITH TEST AFTER                                          08790000
074500         VARYING PV-RETRY-COUNTER                                 08800000
074600         FROM 1 BY 1                                              08810000
074700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08820000
074800             OR (SQLCODE = +0)                                    08830000
074900             OR (SQLCODE = +100))                                 08840000
075000                                                                  08850000
075100         EXEC SQL                                                 08860000
075200              SELECT COUNT(*)                                     08870000
075300                INTO :PV-DB2-COUNT                                08880000
075400                FROM TMDSEAR                                      08890000
075500               WHERE DEPT_NBR   = :ASC-DEPT-NBR                   08900000
075600                 AND OPERCO_NBR = '03'                            08910000
075700                 AND MDSELV_CDE = 'DPT'                           08920000
075800                 AND STRT_DTE  <= CURRENT DATE                    08930000
075900                 AND END_DTE   >= CURRENT DATE                    08940000
076000         END-EXEC                                                 08950000
076100                                                                  08960000
076200         EVALUATE TRUE                                            08970000
076300             WHEN SQLCODE = +0                                    08980000
076400             WHEN SQLCODE = +100                                  08990000
076500             WHEN SQLCODE = -904                                  09000000
076600             WHEN SQLCODE = -913                                  09010000
076700                  CONTINUE                                        09020000
076800                                                                  09030000
076900             WHEN SQLWARN0 NOT = SPACES                           09040000
077000             WHEN SQLCODE < +0                                    09050000
077100             WHEN SQLCODE > +0                                    09060000
077200                  MOVE '1110-VALIDATE-DEPT'                       09070000
077300                                  TO DP013-PARAGRAPH              09080000
077400                  MOVE 'UNSUCCESSFUL COUNT ON DEPARTMENT'         09090000
077500                                  TO DP013-MESSAGE-TEXT (1)       09100000
077600                  MOVE SQLCA      TO DP013-SQLCA                  09110000
077700                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     09120000
077800                  SET DP013-DB2-ABEND                             09130000
077900                      DP013-XCTL-DISPLAY-RESTART                  09140000
078000                                  TO TRUE                         09150000
078100                  PERFORM DP013-0000-PROCESS-ABEND                09160000
078200         END-EVALUATE                                             09170000
078300     END-PERFORM.                                                 09180000
078400                                                                  09190000
078500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09200000
078600         MOVE '1110-VALIDATE-DEPT'                                09210000
078700                                  TO DP013-PARAGRAPH              09220000
078800         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TMDSEAR'          09230000
078900                                  TO DP013-MESSAGE-TEXT (1)       09240000
079000         MOVE SQLCA               TO DP013-SQLCA                  09250000
079100         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     09260000
079200         SET DP013-DB2-ABEND                                      09270000
079300             DP013-XCTL-DISPLAY-RESTART                           09280000
079400                                  TO TRUE                         09290000
079500         PERFORM DP013-0000-PROCESS-ABEND                         09300000
079600     END-IF.                                                      09310000
079700/                                                                 09320000
079800*----------------------------------------------------------------*09330000
079900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *09340000
080000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *09350000
080100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *09360000
080200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *09370000
080300* FUNCTION KEYS CAN GET THIS FAR.                                *09380000
080400*----------------------------------------------------------------*09390000
080500 2000-PROCESS-PANEL.                                              09400000
080510                                                                  09410000
080600     EVALUATE TRUE                                                09420000
080700         WHEN DP020-SRC-AID = DP016-CLEAR                         09430000
080800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09440000
080900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09450000
081000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09460000
081100                                                                  09470000
081200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    09480000
081300             PERFORM 2050-DELETE-LIST-QUEUE                       09490000
081400             PERFORM 4000-BUILD-INITIAL-PANEL                     09500000
081500                                                                  09510000
081600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    09520000
081700             PERFORM 2140-DESELECT-ALL-ITEMS                      09530000
081800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09540000
081900                                                                  09550000
082000         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 09560000
082100              PERFORM 2150-SELECT-ALL-ITEMS                       09570000
082200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09580000
082300                                                                  09590000
082400         WHEN OTHER                                               09600000
082500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09610000
082600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09620000
082700             IF  PS-NO-ERROR                                      09630000
082800                 SET DP030-CONTINUE-GO TO TRUE                    09640000
082900                 PERFORM 2100-CHECK-FUNCTION-KEY                  09650000
083000             ELSE                                                 09660000
083100                 SET DP030-OVERRIDE-GO TO TRUE                    09670000
083200             END-IF                                               09680000
083300     END-EVALUATE.                                                09690000
083400/                                                                 09700000
083500*----------------------------------------------------------------*09710000
083600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09720000
083700*----------------------------------------------------------------*09730000
083800 2050-DELETE-LIST-QUEUE.                                          09740000
083900                                                                  09750000
084000     EXEC CICS                                                    09760000
084100         DELETEQ TS                                               09770000
084200           QUEUE (ASC-LIST-QUEUE-NAME)                            09780000
084300            RESP (PV-CICS-RESP)                                   09790000
084400     END-EXEC.                                                    09800000
084500                                                                  09810000
084600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09820000
084700        (PV-CICS-RESP = DFHRESP(QIDERR))                          09830000
084800         CONTINUE                                                 09840000
084900     ELSE                                                         09850000
085000         SET DP013-CICS-ABEND      TO TRUE                        09860000
085100         SET DP013-NO-ROLLBACK     TO TRUE                        09870000
085200                                                                  09880000
085300         MOVE '2050-DELETE-LIST-QUEUE'                            09890000
085400                                   TO DP013-PARAGRAPH             09900000
085500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09910000
085600                                   TO DP013-MESSAGE-TEXT (1)      09920000
085700         PERFORM DP013-0000-PROCESS-ABEND                         09930000
085800     END-IF.                                                      09940000
085900                                                                  09950000
086000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09960000
086100/                                                                 09970000
086200*----------------------------------------------------------------*09980000
086300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09990000
086400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10000000
086500* CICS ARCHITECTURE API.                                         *10010000
086600*----------------------------------------------------------------*10020000
086700 2100-CHECK-FUNCTION-KEY.                                         10030000
086800                                                                  10040000
086900     EVALUATE TRUE                                                10050000
087000         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  10060000
087100              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             10070000
087200                  INITIALIZE PO069-INTER-APPL-COMMAREA            10080000
087300                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               10090000
087400                                TO PO069-NUMBER-OF-SELECTED-ITEMS 10100000
088000                                                                  10110000
088100                  PERFORM 5000-PREPARE-SEL-QUEUE                  10120000
088500              ELSE                                                10130000
088600                  SET DP030-OVERRIDE-GO                           10140000
088700                      DP020-MSG-WARNING                           10150000
088800                                TO TRUE                           10160000
088900                  MOVE PC-TSYMSG-00057                            10170000
089000                                TO DP020-MSG-NUMBER               10180000
089100              END-IF                                              10190000
091100                                                                  10200000
091200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10210000
091300             MOVE +1               TO PV-TOP-ITEM                 10220000
091400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10230000
091500             PERFORM 3200-RESET-ATTRIBUTES                        10240000
091600                                                                  10250000
091700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10260000
091800             PERFORM 2110-BROWSE-BACKWARD                         10270000
091900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10280000
092000             PERFORM 3200-RESET-ATTRIBUTES                        10290000
092100                                                                  10300000
092200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10310000
092300             PERFORM 2120-BROWSE-FORWARD                          10320000
092400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10330000
092500             PERFORM 3200-RESET-ATTRIBUTES                        10340000
092600                                                                  10350000
092700         WHEN DP020-SRC-AID = DP016-ENTER                         10360000
092800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10370000
092900             IF  PS-ERROR                                         10380000
093000                 CONTINUE                                         10390000
093100             ELSE                                                 10400000
093200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10410000
093300             END-IF                                               10420000
093400                                                                  10430000
093500         WHEN OTHER                                               10440000
093600             SET DP013-NO-ROLLBACK                                10450000
093700                 DP013-XCTL-DISPLAY-RESTART                       10460000
093800                 DP013-CICS-ABEND  TO TRUE                        10470000
093900             MOVE '2100-CHECK-FUNCTION-KEY1'                      10480000
094000                                   TO DP013-PARAGRAPH             10490000
094100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10500000
094200                                   TO DP013-MESSAGE-TEXT (1)      10510000
094300             PERFORM DP013-0000-PROCESS-ABEND                     10520000
094400     END-EVALUATE.                                                10530000
094500/                                                                 10540000
094600*----------------------------------------------------------------*10550000
094700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10560000
094800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10570000
094900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10580000
095000*    MESSAGE.                                                    *10590000
095100*----------------------------------------------------------------*10600000
095200 2110-BROWSE-BACKWARD.                                            10610000
095300                                                                  10620000
095400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10630000
095500         GIVING PV-TOP-ITEM.                                      10640000
095600                                                                  10650000
095700     IF  ((PV-TOP-ITEM < +1)                                      10660000
095800       OR (PV-TOP-ITEM = +1))                                     10670000
095900         MOVE +1                   TO PV-TOP-ITEM                 10680000
096000*        -- TOP OF LIST --                                        10690000
096100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10700000
096200         SET DP020-MSG-INFORMATIONAL                              10710000
096300                                   TO TRUE                        10720000
096400     END-IF.                                                      10730000
096500/                                                                 10740000
096600*----------------------------------------------------------------*10750000
096700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10760000
096800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10770000
096900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10780000
097000*----------------------------------------------------------------*10790000
097100 2120-BROWSE-FORWARD.                                             10800000
097200                                                                  10810000
097300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10820000
097400         GIVING PV-TOP-ITEM.                                      10830000
097500                                                                  10840000
097600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10850000
097700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10860000
097800                                   TO PV-TOP-ITEM                 10870000
097900*        -- BOTTOM OF LIST --                                     10880000
098000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10890000
098100         SET DP020-MSG-INFORMATIONAL                              10900000
098200                                   TO TRUE                        10910000
098300     ELSE                                                         10920000
098400         COMPUTE PV-BOTTOM-ITEM =                                 10930000
098500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10940000
098600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10950000
098700*            -- BOTTOM OF LIST --                                 10960000
098800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10970000
098900             SET DP020-MSG-INFORMATIONAL                          10980000
099000                                   TO TRUE                        10990000
099100         END-IF                                                   11000000
099200     END-IF.                                                      11010000
099300/                                                                 11020000
099400*----------------------------------------------------------------*11030000
099500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11040000
099600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11050000
099700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11060000
099800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11070000
099900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11080000
100000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11090000
100100*----------------------------------------------------------------*11100000
100200 2130-CHECK-FOR-JUMP-BROWSE.                                      11110000
100300                                                                  11120000
100400     SET PS-NO-ERROR               TO TRUE.                       11130000
100500     IF (ASC-START-ITEM-REQUEST = SPACE)                          11140000
100600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11150000
100700                                   TO PV-TOP-ITEM                 11160000
100800     ELSE                                                         11170000
100900         MOVE ASC-START-ITEM-REQUEST                              11180000
101000                                   TO DP010I-UNEDITED-FIELD       11190000
101100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11200000
101200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11210000
101300         SET DP010I-NEGATIVE-NOT-ALLOWED                          11220000
101400                                   TO TRUE                        11230000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11241051
264230                         USING DP010I-NUMERIC-EDIT-AREA           11242051
101600                                                                  11250000
101700         IF  NOT DP010I-ERROR-DETECTED                            11260000
101800             MOVE DP010I-NUMERIC-FIELD                            11270000
101900                                   TO ASC-START-ITEM-REQUEST-N    11280000
102000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11290000
102100                 IF  ASC-START-ITEM-REQUEST-N >                   11300000
102200                                          ASC-NUMBER-OF-ITEMS-READ11310000
102300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11320000
102400                     COMPUTE PV-TOP-ITEM =                        11330000
102500                             ASC-NUMBER-OF-ITEMS-READ             11340000
102600                             - PC-ITEMS-PER-PANEL + 1             11350000
102700                     IF  PV-TOP-ITEM < +1                         11360000
102800                         MOVE +1   TO PV-TOP-ITEM                 11370000
102900                         MOVE PC-TSYMSG-00070                     11380000
103000                                   TO DP020-MSG-NUMBER            11390000
103100                         SET DP020-MSG-INFORMATIONAL              11400000
103200                                   TO TRUE                        11410000
103300                     END-IF                                       11420000
103400                 ELSE                                             11430000
103500                     MOVE ASC-START-ITEM-REQUEST-N                11440000
103600                                   TO PV-TOP-ITEM                 11450000
103700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11460000
103800                     COMPUTE PV-BOTTOM-ITEM =                     11470000
103900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11480000
104000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11490000
104100*                        -- BOTTOM OF LIST --                     11500000
104200                         MOVE PC-TSYMSG-00070                     11510000
104300                                   TO DP020-MSG-NUMBER            11520000
104400                         SET DP020-MSG-INFORMATIONAL              11530000
104500                                   TO TRUE                        11540000
104600                     END-IF                                       11550000
104700                 END-IF                                           11560000
104800             ELSE                                                 11570000
104900*                --- VALUE OUT OF RANGE ----                      11580000
105000                 MOVE PC-TSYMSG-00101                             11590000
105100                                   TO DP020-MSG-NUMBER            11600000
105200                 MOVE -1           TO ASTRTITL                    11610000
105300                 SET DP030-SET-CURSOR-APPL-1                      11620000
105400                                   TO TRUE                        11630000
105500                 MOVE DP015-REVERSE                               11640000
105600                                   TO ASTRTITH                    11650000
105700                 MOVE DP015-RED    TO ASTRTITC                    11660000
105800                 MOVE DP015-UNP-NUM-BRT-MDT                       11670000
105900                                   TO ASTRTITA                    11680000
106000                 SET DP020-MSG-FATAL                              11690000
106100                                   TO TRUE                        11700000
106200                 SET PS-ERROR      TO TRUE                        11710000
106300             END-IF                                               11720000
106400                                                                  11730000
106500         ELSE                                                     11740000
106600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11750000
106700             MOVE -1               TO ASTRTITL                    11760000
106800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11770000
106900             MOVE DP015-REVERSE    TO ASTRTITH                    11780000
107000             MOVE DP015-RED        TO ASTRTITC                    11790000
107100             MOVE DP015-UNP-NUM-BRT-MDT                           11800000
107200                                   TO ASTRTITA                    11810000
107300             SET DP020-MSG-FATAL   TO TRUE                        11820000
107400             SET PS-ERROR          TO TRUE                        11830000
107500         END-IF                                                   11840000
107600     END-IF.                                                      11850000
107700/                                                                 11860000
107800*----------------------------------------------------------------*11870000
107900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11880000
108000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11890000
108100*----------------------------------------------------------------*11900000
108200 2140-DESELECT-ALL-ITEMS.                                         11910000
108300                                                                  11920000
108400     MOVE +1                       TO ASC-BLK-SUB.                11930000
108500                                                                  11940000
108600     PERFORM 2141-CLEAR-SELECTED-INDS                             11950000
108700         VARYING ASC-ITEM-SUB                                     11960000
108800         FROM 1 BY 1                                              11970000
108900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11980000
109000                                                                  11990000
109100     ADD +1                        TO ASC-BLK-SUB.                12000000
109200                                                                  12010000
109300     PERFORM 2141-CLEAR-SELECTED-INDS                             12020000
109400         VARYING ASC-ITEM-SUB                                     12030000
109500         FROM 1 BY 1                                              12040000
109600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12050000
109700                                                                  12060000
109800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12070000
109900                                   TO PV-LIST-ITEM-NUMBER.        12080000
110000                                                                  12090000
110100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12100000
110200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12110000
110300                                                                  12120000
110400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12130000
110500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12140000
110600         MOVE +1                   TO ASC-BLK-SUB                 12150000
110700                                                                  12160000
110800         PERFORM 5100-WRITE-TEMP-STORAGE                          12170000
110900                                                                  12180000
111000         MOVE +1                   TO PV-BLOCK-NUMBER             12190000
111100                                                                  12200000
111200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12210000
111300             PV-FIRST-BLOCK-IN-ARRAY - 1                          12220000
111400                                                                  12230000
111500         PERFORM                                                  12240000
111600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12250000
111700                                                                  12260000
111800             PERFORM 4410-READ-TEMP-STORAGE                       12270000
111900                                                                  12280000
112000             PERFORM 2141-CLEAR-SELECTED-INDS                     12290000
112100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12300000
112200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12310000
112300                                                                  12320000
112400             PERFORM 5100-WRITE-TEMP-STORAGE                      12330000
112500                                                                  12340000
112600             ADD +1                TO PV-BLOCK-NUMBER             12350000
112700                                                                  12360000
112800         END-PERFORM                                              12370000
112900                                                                  12380000
113000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12390000
113100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12400000
113200                                                                  12410000
113300         PERFORM                                                  12420000
113400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12430000
113500                   ASC-HIGHEST-BLOCK-WRITTEN                      12440000
113600                                                                  12450000
113700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12460000
113800                                   TO PV-BLOCK-NUMBER             12470000
113900                                                                  12480000
114000             PERFORM 4410-READ-TEMP-STORAGE                       12490000
114100                                                                  12500000
114200             PERFORM 2141-CLEAR-SELECTED-INDS                     12510000
114300                 VARYING ASC-ITEM-SUB                             12520000
114400                 FROM 1 BY 1                                      12530000
114500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12540000
114600                                                                  12550000
114700             PERFORM 5100-WRITE-TEMP-STORAGE                      12560000
114800                                                                  12570000
114900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12580000
115000                                                                  12590000
115100         END-PERFORM                                              12600000
115200                                                                  12610000
115300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12620000
115400                                   TO PV-BLOCK-NUMBER             12630000
115500                                                                  12640000
115600         PERFORM 4410-READ-TEMP-STORAGE                           12650000
115700     END-IF.                                                      12660000
115800                                                                  12670000
115900     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.12680000
116000     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 12690000
116100     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   12700000
116200                                                                  12710000
116300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12720000
116400/                                                                 12730000
116500*----------------------------------------------------------------*12740000
116600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12750000
116700*----------------------------------------------------------------*12760000
116800 2141-CLEAR-SELECTED-INDS.                                        12770000
116900                                                                  12780000
117000     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          12790000
117100             NOT EQUAL ZERO                                       12800000
117200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12810000
117300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12820000
117400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12830000
117500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12840000
117600                                   TO TRUE                        12850000
117700         END-IF                                                   12860000
117800     END-IF.                                                      12870000
117900/                                                                 12880000
118000*----------------------------------------------------------------*12890000
118100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *12900000
118200*  FOR ALL ITEMS.                                                *12910000
118300*----------------------------------------------------------------*12920000
118400 2150-SELECT-ALL-ITEMS.                                           12930000
118500                                                                  12940000
118600     MOVE +1                       TO ASC-BLK-SUB.                12950000
118700                                                                  12960000
118800     PERFORM 2151-SET-SELECTED-INDS                               12970000
118900         VARYING ASC-ITEM-SUB                                     12980000
119000         FROM 1 BY 1                                              12990000
119100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13000000
119200                                                                  13010000
119300     ADD +1                        TO ASC-BLK-SUB.                13020000
119400                                                                  13030000
119500     PERFORM 2151-SET-SELECTED-INDS                               13040000
119600         VARYING ASC-ITEM-SUB                                     13050000
119700         FROM 1 BY 1                                              13060000
119800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13070000
119900                                                                  13080000
120000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13090000
120100                                   TO PV-LIST-ITEM-NUMBER.        13100000
120200                                                                  13110000
120300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13120000
120400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13130000
120500                                                                  13140000
120600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13150000
120700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13160000
120800         MOVE +1                   TO ASC-BLK-SUB                 13170000
120900                                                                  13180000
121000         PERFORM 5100-WRITE-TEMP-STORAGE                          13190000
121100                                                                  13200000
121200         MOVE +1                   TO PV-BLOCK-NUMBER             13210000
121300                                                                  13220000
121400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13230000
121500             PV-FIRST-BLOCK-IN-ARRAY - 1                          13240000
121600                                                                  13250000
121700         PERFORM                                                  13260000
121800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13270000
121900                                                                  13280000
122000             PERFORM 4410-READ-TEMP-STORAGE                       13290000
122100                                                                  13300000
122200             PERFORM 2151-SET-SELECTED-INDS                       13310000
122300                 VARYING ASC-ITEM-SUB                             13320000
122400                 FROM 1 BY 1                                      13330000
122500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13340000
122600                                                                  13350000
122700             PERFORM 5100-WRITE-TEMP-STORAGE                      13360000
122800                                                                  13370000
122900             ADD +1                TO PV-BLOCK-NUMBER             13380000
123000         END-PERFORM                                              13390000
123100                                                                  13400000
123200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13410000
123300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13420000
123400                                                                  13430000
123500         PERFORM                                                  13440000
123600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13450000
123700                   ASC-HIGHEST-BLOCK-WRITTEN                      13460000
123800                                                                  13470000
123900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13480000
124000                                   TO PV-BLOCK-NUMBER             13490000
124100                                                                  13500000
124200             PERFORM 4410-READ-TEMP-STORAGE                       13510000
124300                                                                  13520000
124400             PERFORM 2151-SET-SELECTED-INDS                       13530000
124500                 VARYING ASC-ITEM-SUB                             13540000
124600                 FROM 1 BY 1                                      13550000
124700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13560000
124800                                                                  13570000
124900             PERFORM 5100-WRITE-TEMP-STORAGE                      13580000
125000                                                                  13590000
125100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13600000
125200         END-PERFORM                                              13610000
125300                                                                  13620000
125400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13630000
125500                                   TO PV-BLOCK-NUMBER             13640000
125600                                                                  13650000
125700         PERFORM 4410-READ-TEMP-STORAGE                           13660000
125800     END-IF.                                                      13670000
125900                                                                  13680000
126000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13690000
126100          ASC-NUMBER-OF-SELECTED-ITEMS.                           13700000
126200                                                                  13710000
126300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13720000
126400/                                                                 13730000
126500*----------------------------------------------------------------*13740000
126600*    MARK EACH ITEM AS BEING SELECTED.                           *13750000
126700*----------------------------------------------------------------*13760000
126800 2151-SET-SELECTED-INDS.                                          13770000
126900                                                                  13780000
127000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13790000
127100             NOT EQUAL ZERO                                       13800000
127200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13810000
127300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13820000
127400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13830000
127500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13840000
127600                                   TO TRUE                        13850000
127700         END-IF                                                   13860000
127800     END-IF.                                                      13870000
127900/                                                                 13880000
128000*----------------------------------------------------------------*13890000
128100*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13900000
128200*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13910000
128300*----------------------------------------------------------------*13920000
128400 2200-MOVE-SCREEN-TO-COMMAREA.                                    13930000
128500                                                                  13940000
128600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13950000
128700     MOVE +1                       TO PV-SUB.                     13960000
128800                                                                  13970000
128900     PERFORM 3100-SET-SUBSCRIPTS.                                 13980000
129000                                                                  13990000
129100     IF  ASTRTITL > ZERO                                          14000000
129200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      14010000
129300     ELSE                                                         14020000
129400         IF  ASTRTITF = DP015-ERASE-EOF                           14030000
129500             INITIALIZE ASC-START-ITEM-REQUEST                    14040000
129600         END-IF                                                   14050000
129700     END-IF.                                                      14060000
129800                                                                  14070000
129900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14080000
130000         VARYING PV-SUB                                           14090000
130100         FROM 1 BY 1                                              14100000
130200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14110000
130300/                                                                 14120000
130400*----------------------------------------------------------------*14130000
130500*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *14140000
130600*----------------------------------------------------------------*14150000
130700 2210-MOVE-LINES-TO-COMMAREA.                                     14160000
130800                                                                  14170000
130900     IF  MR-SELECTL (PV-SUB) > ZERO                               14180000
131000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     14190000
131100                                   TO TRUE                        14200000
131200         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        14210000
131300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14220000
131400     ELSE                                                         14230000
131500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14240000
131600             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14250000
131700             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        14260000
131800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14270000
131900         END-IF                                                   14280000
132000     END-IF.                                                      14290000
132100                                                                  14300000
132200     ADD +1                        TO ASC-ITEM-SUB.               14310000
132300                                                                  14320000
132400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14330000
132500         ADD +1                    TO ASC-BLK-SUB                 14340000
132600         MOVE +1                   TO ASC-ITEM-SUB                14350000
132700     END-IF.                                                      14360000
132800/                                                                 14370000
132900*----------------------------------------------------------------*14380000
133000*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *14390000
133100*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *14400000
133200*----------------------------------------------------------------*14410000
133300 3000-EDIT-DATA-IN-COMMAREA.                                      14420000
133400                                                                  14430000
133500     SET PS-NO-ERROR               TO TRUE.                       14440000
133600                                                                  14450000
133700     PERFORM 3200-RESET-ATTRIBUTES.                               14460000
133800                                                                  14470000
133900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14480000
134000**                                                                14490000
134100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14500000
134200* EDITTING IS DONE FROM THE BOTTOM UP.                            14510000
134300**                                                                14520000
134400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14530000
134500         ASC-ITEMS-DISPLAYED - 1.                                 14540000
134600                                                                  14550000
134700     PERFORM 3100-SET-SUBSCRIPTS.                                 14560000
134800     PERFORM 3300-EDIT-SELECTIONS                                 14570000
134900         VARYING PV-SUB                                           14580000
135000         FROM PV-SUB BY -1                                        14590000
135100         UNTIL PV-SUB < +1                                        14600000
135200                                                                  14610000
135300     IF  PS-NO-ERROR                                              14620000
135400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14630000
135500     END-IF.                                                      14640000
135600                                                                  14650000
135700     IF  ((PS-NO-ERROR)                                           14660000
135800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14670000
135900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14680000
136000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14690000
136100     END-IF.                                                      14700000
136200/                                                                 14710000
136300*----------------------------------------------------------------*14720000
136400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14730000
136500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14740000
136600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14750000
136700*                                                                *14760000
136800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14770000
136900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14780000
137000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14790000
137100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14800000
137200*----------------------------------------------------------------*14810000
137300 3100-SET-SUBSCRIPTS.                                             14820000
137400                                                                  14830000
137500     COMPUTE ASC-ITEM-SUB =                                       14840000
137600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14850000
137700                                                                  14860000
137800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14870000
137900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14880000
138000                                                                  14890000
138100         MOVE PC-MAX-BLOCKS-IN-ARRAY                              14900000
138200                                   TO ASC-BLK-SUB                 14910000
138300     ELSE                                                         14920000
138400         MOVE +1                   TO ASC-BLK-SUB                 14930000
138500     END-IF.                                                      14940000
138600/                                                                 14950000
138700*----------------------------------------------------------------*14960000
138800*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *14970000
138900*----------------------------------------------------------------*14980000
139000 3200-RESET-ATTRIBUTES.                                           14990000
139100                                                                  15000000
139200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15010000
139300     MOVE DP015-GREEN              TO ASTRTITC.                   15020000
139400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15030000
139500                                                                  15040000
139600     IF DP020-NEXT-ACT-RETURN                                     15050000
139700     OR DP020-NEXT-ACT-READ-MAP                                   15060000
139800        PERFORM                                                   15070000
139900            VARYING PV-SUB                                        15080000
140000            FROM 1 BY 1                                           15090000
140100            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    15100000
140200            MOVE DP015-UNP-ALP-NOR-OFF                            15110000
140300                                      TO MR-SELECTA (PV-SUB)      15120000
140400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      15130000
140500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      15140000
140600        END-PERFORM                                               15150000
140700     ELSE                                                         15160000
140800        PERFORM                                                   15170000
140900            VARYING PV-SUB                                        15180000
141000            FROM 1 BY 1                                           15190000
141100            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     15200000
141200            MOVE DP015-UNP-ALP-NOR-OFF                            15210000
141300                                      TO MR-SELECTA (PV-SUB)      15220000
141400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      15230000
141500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      15240000
141600        END-PERFORM                                               15250000
141700     END-IF.                                                      15260000
141800/                                                                 15270000
141900*----------------------------------------------------------------*15280000
142000*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *15290000
142100*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *15300000
142200*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *15310000
142300*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *15320000
142400*----------------------------------------------------------------*15330000
142500 3300-EDIT-SELECTIONS.                                            15340000
142600                                                                  15350000
142700     EVALUATE TRUE                                                15360000
142800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15370000
142900             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15380000
143000                 CONTINUE                                         15390000
143100                                                                  15400000
143200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15410000
143300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15420000
143400                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15430000
143500                 MOVE ASC-TEMP-SELECTED-SW                        15440000
143600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15450000
143700                                   TO ASC-SELECTED-SW             15460000
143800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15470000
143900             END-IF                                               15480000
144000                                                                  15490000
144100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15500000
144200                 = SPACE                                          15510000
144300             EVALUATE TRUE                                        15520000
144400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15530000
144500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15540000
144600                     MOVE SPACE    TO ASC-SELECTED-SW             15550000
144700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15560000
144800                                                                  15570000
144900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15580000
145000                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 15590000
145100                     MOVE SPACE    TO ASC-SELECTED-SW             15600000
145200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15610000
145300                                                                  15620000
145400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15630000
145500                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   15640000
145600                     MOVE SPACE    TO ASC-SELECTED-SW             15650000
145700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15660000
145800             END-EVALUATE                                         15670000
145900                                                                  15680000
146000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15690000
146100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15700000
146200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15710000
146300             END-IF                                               15720000
146400             PERFORM 3310-EDIT-RANGE                              15730000
146500                                                                  15740000
146600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15750000
146700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15760000
146800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15770000
146900             END-IF                                               15780000
147000             PERFORM 3310-EDIT-RANGE                              15790000
147100                                                                  15800000
147200         WHEN OTHER                                               15810000
147300             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            15820000
147400             SET DP020-MSG-FATAL   TO TRUE                        15830000
147500             MOVE -1               TO MR-SELECTL (PV-SUB)         15840000
147600             SET DP030-SET-CURSOR-APPL-1                          15850000
147700                                   TO TRUE                        15860000
147800             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         15870000
147900             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         15880000
148000             SET PS-ERROR          TO TRUE                        15890000
148100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15900000
148200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15910000
148300                 MOVE SPACE        TO ASC-SELECTED-SW             15920000
148400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15930000
148500             END-IF                                               15940000
148600     END-EVALUATE.                                                15950000
148700                                                                  15960000
148800     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             15970000
148900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15980000
149000                                                                  15990000
149100     IF  ASC-ITEM-SUB < 1                                         16000000
149200         SUBTRACT +1 FROM ASC-BLK-SUB                             16010000
149300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16020000
149400     END-IF.                                                      16030000
149500/                                                                 16040000
149600*----------------------------------------------------------------*16050000
149700*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *16060000
149800*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *16070000
149900*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *16080000
150000*  THE ENDING.                                                   *16090000
150100*----------------------------------------------------------------*16100000
150200 3310-EDIT-RANGE.                                                 16110000
150300                                                                  16120000
150400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16130000
150500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16140000
150600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16150000
150700                                   TO ASC-SELECTED-SW             16160000
150800                                        (ASC-BLK-SUB ASC-ITEM-SUB)16170000
150900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16180000
151000         ELSE                                                     16190000
151100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16200000
151200                 CONTINUE                                         16210000
151300             ELSE                                                 16220000
151400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16230000
151500                 MOVE PC-TSYMSG-00054                             16240000
151600                                   TO DP020-MSG-NUMBER            16250000
151700                 SET DP020-MSG-FATAL                              16260000
151800                                   TO TRUE                        16270000
151900                 MOVE -1           TO MR-SELECTL (PV-SUB)         16280000
152000                 SET DP030-SET-CURSOR-APPL-1                      16290000
152100                                   TO TRUE                        16300000
152200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16310000
152300                 MOVE DP015-UNDERLINE                             16320000
152400                                   TO MR-SELECTH (PV-SUB)         16330000
152500                 SET PS-ERROR      TO TRUE                        16340000
152600             END-IF                                               16350000
152700         END-IF                                                   16360000
152800     ELSE                                                         16370000
152900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16380000
153000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16390000
153100                                   TO ASC-SELECTED-SW             16400000
153200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16410000
153300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16420000
153400         ELSE                                                     16430000
153500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16440000
153600                 CONTINUE                                         16450000
153700             ELSE                                                 16460000
153800*                -- ONLY ONE END-OF-RANGE ALLOWED --              16470000
153900                 MOVE PC-TSYMSG-00055                             16480000
154000                                   TO DP020-MSG-NUMBER            16490000
154100                 SET DP020-MSG-FATAL                              16500000
154200                                   TO TRUE                        16510000
154300                 MOVE -1           TO MR-SELECTL (PV-SUB)         16520000
154400                 SET DP030-SET-CURSOR-APPL-1                      16530000
154500                                   TO TRUE                        16540000
154600                 SET PS-ERROR      TO TRUE                        16550000
154700             END-IF                                               16560000
154800         END-IF                                                   16570000
154900     END-IF.                                                      16580000
155000/                                                                 16590000
155100*----------------------------------------------------------------*16600000
155200*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *16610000
155300*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *16620000
155400*----------------------------------------------------------------*16630000
155500 3400-CHECK-RANGE-SEQUENCE.                                       16640000
155600                                                                  16650000
155700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16660000
155800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16670000
155900       AND  ASC-START-OF-SELECTED-RANGE >                         16680000
156000                                         ASC-END-OF-SELECTED-RANGE16690000
156100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16700000
156200         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            16710000
156300         SET DP020-MSG-FATAL       TO TRUE                        16720000
156400         SET PS-ERROR              TO TRUE                        16730000
156500         PERFORM 3410-POSITION-AT-ERROR                           16740000
156600     END-IF.                                                      16750000
156700/                                                                 16760000
156800*----------------------------------------------------------------*16770000
156900*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *16780000
157000*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *16790000
157100*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16800000
157200*----------------------------------------------------------------*16810000
157300 3410-POSITION-AT-ERROR.                                          16820000
157400                                                                  16830000
157500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16840000
157600                                                                  16850000
157700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16860000
157800                    - PV-TOP-ITEM + 1.                            16870000
157900                                                                  16880000
158000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16890000
158100         CONTINUE                                                 16900000
158200     ELSE                                                         16910000
158300         MOVE -1                   TO MR-SELECTL (PV-SUB)         16920000
158400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16930000
158500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16940000
158600     END-IF.                                                      16950000
158700                                                                  16960000
158800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16970000
158900                    - PV-TOP-ITEM + 1.                            16980000
159000                                                                  16990000
159100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17000000
159200         CONTINUE                                                 17010000
159300     ELSE                                                         17020000
159400         MOVE -1                   TO MR-SELECTL (PV-SUB)         17030000
159500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17040000
159600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17050000
159700     END-IF.                                                      17060000
159800/                                                                 17070000
159900*----------------------------------------------------------------*17080000
160000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17090000
160100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17100000
160200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17110000
160300*----------------------------------------------------------------*17120000
160400 3500-MARK-RANGE-AS-SELECTED.                                     17130000
160500                                                                  17140000
160600     MOVE +1                       TO ASC-BLK-SUB.                17150000
160700                                                                  17160000
160800     PERFORM 3510-MARK-SELECTED-INDS                              17170000
160900         VARYING ASC-ITEM-SUB                                     17180000
161000         FROM 1 BY 1                                              17190000
161100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17200000
161200                                                                  17210000
161300     ADD +1                        TO ASC-BLK-SUB.                17220000
161400                                                                  17230000
161500     PERFORM 3510-MARK-SELECTED-INDS                              17240000
161600         VARYING ASC-ITEM-SUB                                     17250000
161700         FROM 1 BY 1                                              17260000
161800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17270000
161900                                                                  17280000
162000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17290000
162100                                   TO PV-LIST-ITEM-NUMBER.        17300000
162200                                                                  17310000
162300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17320000
162400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17330000
162500               PC-ITEMS-PER-PANEL).                               17340000
162600                                                                  17350000
162700     MOVE ASC-START-OF-SELECTED-RANGE                             17360000
162800                                   TO PV-START-OF-SELECTED-RANGE. 17370000
162900                                                                  17380000
163000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17390000
163100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17400000
163200               PC-ITEMS-PER-PANEL).                               17410000
163300                                                                  17420000
163400     MOVE ASC-END-OF-SELECTED-RANGE                               17430000
163500                                   TO PV-END-OF-SELECTED-RANGE.   17440000
163600                                                                  17450000
163700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17460000
163800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17470000
163900               PC-ITEMS-PER-PANEL).                               17480000
164000                                                                  17490000
164100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17500000
164200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17510000
164300                                                                  17520000
164400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17530000
164500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17540000
164600         MOVE +1                   TO ASC-BLK-SUB                 17550000
164700         PERFORM 5100-WRITE-TEMP-STORAGE                          17560000
164800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17570000
164900             PV-FIRST-BLOCK-IN-ARRAY - 1                          17580000
165000                                                                  17590000
165100         PERFORM                                                  17600000
165200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17610000
165300                   PV-PREV-BLOCK-IN-ARRAY                         17620000
165400             MOVE PV-FIRST-BLOCK-IN-RANGE                         17630000
165500                                   TO PV-BLOCK-NUMBER             17640000
165600             PERFORM 4410-READ-TEMP-STORAGE                       17650000
165700             PERFORM 3510-MARK-SELECTED-INDS                      17660000
165800                 VARYING ASC-ITEM-SUB                             17670000
165900                 FROM 1 BY 1                                      17680000
166000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17690000
166100             PERFORM 5100-WRITE-TEMP-STORAGE                      17700000
166200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17710000
166300         END-PERFORM                                              17720000
166400                                                                  17730000
166500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17740000
166600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17750000
166700         PERFORM                                                  17760000
166800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17770000
166900                   PV-LAST-BLOCK-IN-RANGE                         17780000
167000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17790000
167100                                   TO PV-BLOCK-NUMBER             17800000
167200             PERFORM 4410-READ-TEMP-STORAGE                       17810000
167300             PERFORM 3510-MARK-SELECTED-INDS                      17820000
167400                 VARYING ASC-ITEM-SUB                             17830000
167500                 FROM 1 BY 1                                      17840000
167600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17850000
167700             PERFORM 5100-WRITE-TEMP-STORAGE                      17860000
167800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17870000
167900         END-PERFORM                                              17880000
168000                                                                  17890000
168100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17900000
168200                                   TO PV-BLOCK-NUMBER             17910000
168300         PERFORM 4410-READ-TEMP-STORAGE                           17920000
168400     END-IF.                                                      17930000
168500                                                                  17940000
168600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17950000
168700                                      ASC-END-OF-SELECTED-RANGE.  17960000
168800/                                                                 17970000
168900*----------------------------------------------------------------*17980000
169000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17990000
169100*----------------------------------------------------------------*18000000
169200 3510-MARK-SELECTED-INDS.                                         18010000
169300                                                                  18020000
169400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         18030000
169500         ASC-START-OF-SELECTED-RANGE)                             18040000
169600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         18050000
169700         ASC-START-OF-SELECTED-RANGE)                             18060000
169800                                                                  18070000
169900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     18080000
170000             ASC-END-OF-SELECTED-RANGE)                           18090000
170100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     18100000
170200             ASC-END-OF-SELECTED-RANGE)                           18110000
170300                                                                  18120000
170400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18130000
170500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18140000
170600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18150000
170700                                   TO TRUE                        18160000
170800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18170000
170900                                   TO TRUE                        18180000
171000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS18190000
171100             END-IF                                               18200000
171200         END-IF                                                   18210000
171300     END-IF.                                                      18220000
171400/                                                                 18230000
171500*----------------------------------------------------------------*18240000
171600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18250000
171700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18260000
171800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18270000
171900*    DISPLAY THE PANEL TO USER.                                  *18280000
172000*----------------------------------------------------------------*18290000
172100 4000-BUILD-INITIAL-PANEL.                                        18300000
172200                                                                  18310000
172300     INITIALIZE ASC-BLOCK-ENTRIES (1)                             18320000
172400                ASC-BLOCK-ENTRIES (2).                            18330000
172500                                                                  18340000
172600     MOVE +1                       TO ASC-BLK-SUB.                18350000
172700                                                                  18360000
172800     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       18370000
172900     SET ASC-ITEMS-LEFT-ON-DB-2    TO TRUE.                       18380000
173000                                                                  18390000
173100     MOVE +0                       TO ASC-ITEM-SUB                18400000
173200                                      ASC-NUMBER-OF-ITEMS-READ    18410000
173300                                      ASC-NUMBER-OF-SELECTED-ITEMS18420000
173400                                      ASC-HIGHEST-BLOCK-WRITTEN   18430000
173500                                      ASC-START-OF-SELECTED-RANGE 18440000
173600                                      ASC-END-OF-SELECTED-RANGE   18450000
173700                                      ASC-ITEM-AT-TOP-OF-PANEL.   18460000
173800                                                                  18470000
173900     PERFORM 4010-OPEN-CURSOR.                                    18480000
174000                                                                  18490000
174100     PERFORM 4300-READ-ITEMS-FROM-DB.                             18500000
174200                                                                  18510000
174300     PERFORM 4020-CLOSE-CURSOR.                                   18520000
174400                                                                  18530000
174500     MOVE +1                       TO PV-TOP-ITEM.                18540000
174600                                                                  18550000
174700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18560000
174800         SET DP020-NEXT-ACT-APPL-ERROR                            18570000
174900                                   TO TRUE                        18580000
175000         SET DP020-MSG-FATAL       TO TRUE                        18590000
175100         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            18600000
175200     ELSE                                                         18610000
175300         MOVE -1                   TO MR-SELECTL (1)              18620000
175400         SET DP030-SET-CURSOR-APPL-1                              18630000
175500                                   TO TRUE                        18640000
175600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18650000
175700     END-IF.                                                      18660000
175800/                                                                 18670000
175900*----------------------------------------------------------------*18680000
176000* OPEN THE RCVR CURSOR.                                          *18690000
176100*----------------------------------------------------------------*18700000
176200 4010-OPEN-CURSOR.                                                18710000
176300                                                                  18720000
W24803     INITIALIZE DCLTPURCHS                                        18730000
W24803                DCLTPURITM                                        18740000
W24803                DCLTPLNSHP                                        18750000
W24803                DCLTALLPLN.                                       18760000
W24803     MOVE ASC-ITM-NBR    TO PURITM-ITM-NBR                        18770000
W24803                                                                  18780000
176400         EXEC SQL                                                 18790000
176500             OPEN PO-INFO-CSR                                     18800000
176600         END-EXEC                                                 18810000
176700                                                                  18820000
176800     EVALUATE TRUE                                                18830000
176900         WHEN SQLCODE = ZERO                                      18840000
177000                 CONTINUE                                         18850000
177100                                                                  18860000
177200         WHEN SQLCODE = -904                                      18870000
177300         WHEN SQLCODE = -911                                      18880000
177400         WHEN SQLCODE = -913                                      18890000
177500              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       18900000
177600              SET PS-ERROR                                        18910000
177700                  DP020-NEXT-ACT-APPL-ERROR                       18920000
177800                  DP020-MSG-FATAL                                 18930000
177900                      TO TRUE                                     18940000
178000              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 18950000
178100              PERFORM 9000-CALL-CICS-ARCH-API                     18960000
178200                                                                  18970000
178300         WHEN SQLWARN0 NOT = SPACES                               18980000
178400         WHEN SQLCODE < ZERO                                      18990000
178500         WHEN SQLCODE > ZERO                                      19000000
178600             MOVE '4010-OPEN-CURSOR'                              19010000
178700                               TO DP013-PARAGRAPH                 19020000
178800             MOVE 'OPEN PO-INFO-CSR CURSOR'                       19030000
178900                               TO DP013-MESSAGE-TEXT (1)          19040000
179000             MOVE SQLCA        TO DP013-SQLCA                     19050000
179100             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        19060000
179200             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        19070000
179300             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        19080000
179400             SET DP013-DB2-ABEND                                  19090000
179500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19100000
179600             PERFORM DP013-0000-PROCESS-ABEND                     19110000
179700     END-EVALUATE.                                                19120000
179800/                                                                 19130000
179900*----------------------------------------------------------------*19140000
180000* CLOSE THE RCVR CURSOR                                          *19150000
180100*----------------------------------------------------------------*19160000
180200 4020-CLOSE-CURSOR.                                               19170000
180300                                                                  19180000
180400     EXEC SQL                                                     19190000
180500         CLOSE PO-INFO-CSR                                        19200000
180600     END-EXEC.                                                    19210000
180700                                                                  19220000
180800     EVALUATE TRUE                                                19230000
180900         WHEN SQLCODE = ZERO                                      19240000
181000             CONTINUE                                             19250000
181100         WHEN SQLCODE = -904                                      19260000
181200         WHEN SQLCODE = -911                                      19270000
181300         WHEN SQLCODE = -913                                      19280000
181400              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       19290000
181500              SET PS-ERROR                                        19300000
181600                  DP020-NEXT-ACT-APPL-ERROR                       19310000
181700                  DP020-MSG-FATAL                                 19320000
181800                      TO TRUE                                     19330000
181900              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 19340000
182000              PERFORM 9000-CALL-CICS-ARCH-API                     19350000
182100                                                                  19360000
182200         WHEN SQLWARN0 NOT = SPACES                               19370000
182300         WHEN SQLCODE < ZERO                                      19380000
182400         WHEN SQLCODE > ZERO                                      19390000
182500             MOVE '4020-CLOSE-CURSOR'                             19400000
182600                                   TO DP013-PARAGRAPH             19410000
182700             MOVE 'CLOSE PO-INFO-CSR CURSOR'                      19420000
182800                                   TO DP013-MESSAGE-TEXT (1)      19430000
182900             MOVE SQLCA            TO DP013-SQLCA                 19440000
183000             MOVE 'TRECCEIV'   TO DP013-DB2-TABLE-NAME (1)        19450000
183100             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        19460000
183200             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        19470000
183300             SET DP013-DB2-ABEND                                  19480000
183400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19490000
183500             PERFORM DP013-0000-PROCESS-ABEND                     19500000
183600     END-EVALUATE.                                                19510000
183700/                                                                 19520000
183800*----------------------------------------------------------------*19530000
183900* OPEN THE RCVR TMST AND QTY CURSOR                              *19540000
184000*----------------------------------------------------------------*19550000
184100 4030-OPEN-CURSOR.                                                19560000
184200                                                                  19570000
184300         EXEC SQL                                                 19580000
184400             OPEN RCVRQTY-CSR                                     19590000
184500         END-EXEC                                                 19600000
184600                                                                  19610000
184700     EVALUATE TRUE                                                19620000
184800         WHEN SQLCODE = ZERO                                      19630000
184900                 CONTINUE                                         19640000
185000                                                                  19650000
185100         WHEN SQLCODE = -904                                      19660000
185200         WHEN SQLCODE = -911                                      19670000
185300         WHEN SQLCODE = -913                                      19680000
185400              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       19690000
185500              SET PS-ERROR                                        19700000
185600                  DP020-NEXT-ACT-APPL-ERROR                       19710000
185700                  DP020-MSG-FATAL                                 19720000
185800                      TO TRUE                                     19730000
185900              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 19740000
186000              PERFORM 9000-CALL-CICS-ARCH-API                     19750000
186100                                                                  19760000
186200         WHEN SQLWARN0 NOT = SPACES                               19770000
186300         WHEN SQLCODE < ZERO                                      19780000
186400         WHEN SQLCODE > ZERO                                      19790000
186500             MOVE '4030-OPEN-CURSOR'                              19800000
186600                               TO DP013-PARAGRAPH                 19810000
186700             MOVE 'OPEN RCVRQTY-CSR CURSOR'                       19820000
186800                               TO DP013-MESSAGE-TEXT (1)          19830000
186900             MOVE SQLCA        TO DP013-SQLCA                     19840000
187000             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        19850000
187100             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        19860000
187200             SET DP013-DB2-ABEND                                  19870000
187300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19880000
187400             PERFORM DP013-0000-PROCESS-ABEND                     19890000
187500     END-EVALUATE.                                                19900000
187600/                                                                 19910000
187700*----------------------------------------------------------------*19920000
187800* CLOSE THE RCVR TMST AND QTY CURSOR                             *19930000
187900*----------------------------------------------------------------*19940000
188000 4040-CLOSE-CURSOR.                                               19950000
188100                                                                  19960000
188200     EXEC SQL                                                     19970000
188300         CLOSE RCVRQTY-CSR                                        19980000
188400     END-EXEC.                                                    19990000
188500                                                                  20000000
188600     EVALUATE TRUE                                                20010000
188700         WHEN SQLCODE = ZERO                                      20020000
188800             CONTINUE                                             20030000
188900         WHEN SQLCODE = -904                                      20040000
189000         WHEN SQLCODE = -911                                      20050000
189100         WHEN SQLCODE = -913                                      20060000
189200              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       20070000
189300              SET PS-ERROR                                        20080000
189400                  DP020-NEXT-ACT-APPL-ERROR                       20090000
189500                  DP020-MSG-FATAL                                 20100000
189600                      TO TRUE                                     20110000
189700              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 20120000
189800              PERFORM 9000-CALL-CICS-ARCH-API                     20130000
189900                                                                  20140000
190000         WHEN SQLWARN0 NOT = SPACES                               20150000
190100         WHEN SQLCODE < ZERO                                      20160000
190200         WHEN SQLCODE > ZERO                                      20170000
190300             MOVE '4040-CLOSE-CURSOR'                             20180000
190400                                   TO DP013-PARAGRAPH             20190000
190500             MOVE 'CLOSE RCVRQTY-CSR CURSOR'                      20200000
190600                                   TO DP013-MESSAGE-TEXT (1)      20210000
190700             MOVE SQLCA            TO DP013-SQLCA                 20220000
190800             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        20230000
190900             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        20240000
191000             SET DP013-DB2-ABEND                                  20250000
191100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20260000
191200             PERFORM DP013-0000-PROCESS-ABEND                     20270000
191300     END-EVALUATE.                                                20280000
191400/                                                                 20290000
191500*----------------------------------------------------------------*20300000
191600*    GET THE SKU INFORMATION FOR THE SCREEN HEADER, THEN         *20310000
191700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20320000
191800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20330000
191900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20340000
192000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20350000
192100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20360000
192200*----------------------------------------------------------------*20370000
192300 4300-READ-ITEMS-FROM-DB.                                         20380000
192400                                                                  20390000
192500     PERFORM 4307-GET-VENDOR-NAME.                                20400000
192600                                                                  20410000
192700*-------*                                                *-------*20420000
192800*THIS OUTER PERFORM GETS THE PO LINE INFORMATION FOR EACH PO     *20430000
192900*WITH THE ENTERED SKU ON IT.                                     *20440000
193000*ALL PO LINES WITH THE SKU AND IN THE OTB RANGE ARE FETCHED.     *20450000
193100*-------*                                                *-------*20460000
193101                                                                  20470000
193102     PERFORM                                                      20480000
193103         VARYING PV-READ-COUNT                                    20490000
193104         FROM 1 BY 1                                              20500000
193105         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20510000
193106            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20520000
193200                                                                  20530000
193300         PERFORM 4310-FETCH-PO-LINE-INFO                          20540000
193400                                                                  20550000
193500         IF ASC-ITEMS-LEFT-ON-DB                                  20560000
193600            SET ASC-ITEMS-LEFT-ON-DB-2    TO TRUE                 20570000
193700            PERFORM 4030-OPEN-CURSOR                              20580000
193800         END-IF                                                   20590000
193900*-------*                                                *-------*20600000
194000*THIS INNER PERFORM GETS THE RECEIVERS FOR THE PO LINE AND       *20610000
194100*PUTS THE INFORMATION IN THE ASC TO BE MOVED TO THE SCREEN.      *20620000
194101*-------*                                                *-------*20630000
194102         PERFORM                                                  20640000
194103              VARYING PV-READ-COUNT-2                             20650000
194200              FROM 1 BY 1                                         20660000
194300              UNTIL ((PV-READ-COUNT-2 > PC-MAX-ITEMS)             20670000
194400                 OR (ASC-NO-ITEMS-LEFT-ON-DB)                     20680000
194500                 OR (ASC-NO-ITEMS-LEFT-ON-DB-2))                  20690000
194600                 PERFORM 4320-FETCH-VER-DATE-AND-QTY              20700000
194700                                                                  20710000
194800                 IF ASC-ITEMS-LEFT-ON-DB-2                        20720000
194900                     IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL         20730000
195000                                 ADD +1 TO ASC-ITEM-SUB           20740000
195100                     ELSE                                         20750000
195200                         ADD +1    TO ASC-BLK-SUB                 20760000
195300                         MOVE +1   TO ASC-ITEM-SUB                20770000
195400                                                                  20780000
195500                         IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY  20790000
195600                             MOVE +1 TO ASC-BLK-SUB               20800000
195700                             SET ASC-BLOCK-MODIFIED (1)           20810000
195800                                           TO TRUE                20820000
195900                             PERFORM 5100-WRITE-TEMP-STORAGE      20830000
196000                             MOVE ASC-BLOCK-ENTRIES               20840000
196100                                       (PC-MAX-BLOCKS-IN-ARRAY)   20850000
196200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20860000
196300                             ADD +1 TO ASC-BLK-SUB                20870000
196400                       INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB) 20880000
196500                          SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) 20890000
196600                                           TO TRUE                20900000
196700                         END-IF                                   20910000
196800                     END-IF                                       20920000
196900                     ADD +1        TO ASC-NUMBER-OF-ITEMS-READ    20930000
197000                                                                  20940000
197100                     MOVE ASC-NUMBER-OF-ITEMS-READ                20950000
197200                                          TO ASC-LIST-ITEM-NUMBER 20960000
197300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20970000
197400                                                                  20980000
197500                     MOVE PURCHS-PO-NBR                           20990000
197600                                           TO ASC-PO-NBR          21000000
197700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21010000
197800                     MOVE PURITM-APP-PO-LNE-NBR                   21020000
198000                                           TO ASC-LINE            21030000
198100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21040000
198200                                                                  21050000
198300                     PERFORM 4330-GET-LOC-NAME                    21060000
198400                     MOVE XMT00001-LOC-5-ABBR-NM                  21070044
198401                                     TO ASC-LOCATION              21080000
198402                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21090000
198403                                                                  21100000
198404                     MOVE ALLPLN-CURR-SPLIT-QTY                   21110000
198405                                           TO ASC-ORDER-QTY       21120000
198406                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21130000
198407                                                                  21140000
199600                     STRING PLNSHP-DONT-SHIP-BEF-DTE(6:2) '/'     21150000
199700                            PLNSHP-DONT-SHIP-BEF-DTE(9:2) '/'     21160000
199800                            PLNSHP-DONT-SHIP-BEF-DTE(3:2)         21170000
199900                            DELIMITED BY SIZE                     21180000
200000                                        INTO ASC-SHIP-DTE         21190000
200100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21200000
200200                                                                  21210000
200220                     IF RECDIS-AP-VERIFY-ITM-QTY < 1              21220000
200230                        MOVE ZEROES                               21230000
200240                        TO ASC-RECEIVED-QTY                       21240000
200250                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21250000
200260                     ELSE                                         21260000
200270                        MOVE RECDIS-AP-VERIFY-ITM-QTY             21270000
200280                        TO ASC-RECEIVED-QTY                       21280000
200290                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21290000
200291                     END-IF                                       21300000
200292                                                                  21310000
200293                     IF RECDIS-AP-VERIFY-ITM-QTY < 1              21320000
200294                        MOVE SPACES TO PV-CRE-DTE                 21330000
200295                                       ASC-RECEIVED-DTE           21340000
200296                                        (ASC-BLK-SUB ASC-ITEM-SUB)21350000
200297                     ELSE                                         21360000
200300                        STRING PV-CRE-DTE(6:2) '/'                21370000
200400                               PV-CRE-DTE(9:2) '/'                21380000
200410                               PV-CRE-DTE(3:2)                    21390000
200500                               DELIMITED BY SIZE                  21400000
200600                                     INTO ASC-RECEIVED-DTE        21410000
200700                                        (ASC-BLK-SUB ASC-ITEM-SUB)21420000
200710                     END-IF                                       21430000
200800                                                                  21440000
200900                     IF (ASC-RECEIVED-DTE                         21450000
201000                              (ASC-BLK-SUB ASC-ITEM-SUB)) =       21460000
201100                              '09/09/99'                          21470000
201200                        MOVE SPACES TO ASC-RECEIVED-DTE           21480000
201300                              (ASC-BLK-SUB ASC-ITEM-SUB)          21490000
201400                     END-IF                                       21500000
201500                                                                  21510000
201600                     IF (ALLPLN-CURR-SPLIT-QTY < 1 OR             21520000
201700                        RECDIS-AP-VERIFY-ITM-QTY < 1)             21530000
201800                        MOVE ZEROES TO ASC-PERCENT-REC            21540000
201900                              (ASC-BLK-SUB ASC-ITEM-SUB)          21550000
202000                        MOVE SPACE TO ASC-PERCENT-SIGN            21560000
202001                              (ASC-BLK-SUB ASC-ITEM-SUB)          21570000
202002                     ELSE                                         21580000
202100                        COMPUTE PV-CALC-PCT =                     21590000
202200                                (RECDIS-AP-VERIFY-ITM-QTY /       21600000
202300                                 ALLPLN-CURR-SPLIT-QTY)           21610000
202400                        COMPUTE PV-CALC-PCT-2 ROUNDED =           21620000
202500                                         PV-CALC-PCT * 100        21630000
202600                        IF (PV-CALC-PCT-2 < 100.0 AND             21640000
202700                            PV-CALC-PCT-2 > 99.4)                 21650000
202701                             MOVE ZEROES TO ASC-PERCENT-REC       21660000
202702                              (ASC-BLK-SUB ASC-ITEM-SUB)          21670000
202703                             MOVE 99     TO ASC-PERCENT-REC       21680000
202704                              (ASC-BLK-SUB ASC-ITEM-SUB)          21690000
202705                        ELSE                                      21700000
202706                             COMPUTE ASC-PERCENT-REC              21710000
202707                              (ASC-BLK-SUB ASC-ITEM-SUB)          21720000
202708                              ROUNDED = (PV-CALC-PCT * 100)       21730000
202709                        END-IF                                    21740000
202710                        MOVE PC-PERCENT-SIGN TO ASC-PERCENT-SIGN  21750000
202711                            (ASC-BLK-SUB ASC-ITEM-SUB)            21760000
202712                     END-IF                                       21770000
202800                                                                  21780000
202900***THESE ARE THE SCREEN TOTALS ACCUMULATIONS                      21790000
203000                     COMPUTE PV-TOT-REC-ORDER-QTY =               21800000
203100                             PV-TOT-REC-ORDER-QTY +               21810000
203200                      ASC-RECEIVED-QTY (ASC-BLK-SUB ASC-ITEM-SUB) 21820000
203300                                                                  21830000
203400                     IF (PURCHS-PO-NBR = PV-PO-HOLD               21840000
203500                       AND PURITM-APP-PO-LNE-NBR = PV-LINE-HOLD   21850000
203501                       AND ALLPLN-DEST-NBR       = PV-LOC-HOLD)   21860000
203502                        CONTINUE                                  21870000
203600                     ELSE                                         21880000
203700                       COMPUTE PV-TOT-ORDER-QTY =                 21890000
203800                               PV-TOT-ORDER-QTY +                 21900000
203900                        ASC-ORDER-QTY (ASC-BLK-SUB ASC-ITEM-SUB)  21910000
204000                       MOVE PURCHS-PO-NBR         TO PV-PO-HOLD   21920000
204100                       MOVE PURITM-APP-PO-LNE-NBR TO PV-LINE-HOLD 21930000
204101                       MOVE ALLPLN-DEST-NBR       TO PV-LOC-HOLD  21940000
204102                     END-IF                                       21950000
204110                     MOVE ZEROES TO RECDIS-AP-VERIFY-ITM-QTY      21960000
204200                 END-IF                                           21970000
204300         END-PERFORM                                              21980000
204400         IF ASC-ITEMS-LEFT-ON-DB                                  21990000
204500             PERFORM 4040-CLOSE-CURSOR                            22000000
204600         END-IF                                                   22010000
204700     END-PERFORM.                                                 22020000
204800                                                                  22030000
204900***THESE ARE THE NON-SCROLLABLE FIELDS ON THE SCREEN.             22040000
205400     MOVE ENTNME-ENT-NAME-DESC       TO ASC-VEND-NAME.            22050000
205500     MOVE PV-TOT-ORDER-QTY           TO ASC-TOT-ORDER-QTY.        22060000
205600     MOVE PV-TOT-REC-ORDER-QTY       TO ASC-TOT-REC-ORDER-QTY.    22070000
205700                                                                  22080000
205800     IF (PV-TOT-ORDER-QTY < 1 OR                                  22090000
205900        PV-TOT-REC-ORDER-QTY < 1)                                 22100000
206000        MOVE ZEROES TO ASC-TOT-PCT                                22110000
206010        MOVE SPACE TO ASC-PERCENT-SIGN-TOT                        22120000
206100     ELSE                                                         22130000
206200        COMPUTE PV-CALC-PCT =                                     22140000
206300                (PV-TOT-REC-ORDER-QTY /                           22150000
206400                PV-TOT-ORDER-QTY)                                 22160000
206500        COMPUTE PV-CALC-PCT-2 ROUNDED =                           22170000
206600                PV-CALC-PCT * 100                                 22180000
206700        IF (PV-CALC-PCT-2 < 100.0 AND                             22190000
206800            PV-CALC-PCT-2 > 99.4)                                 22200000
206900            MOVE ZEROES TO ASC-TOT-PCT                            22210000
207000            MOVE 99     TO ASC-TOT-PCT                            22220000
207100        ELSE                                                      22230000
207200            COMPUTE ASC-TOT-PCT ROUNDED =                         22240000
207201                    (PV-CALC-PCT * 100)                           22250000
207202        END-IF                                                    22260000
207203        MOVE PC-PERCENT-SIGN TO ASC-PERCENT-SIGN-TOT              22270000
207204     END-IF.                                                      22280000
207205                                                                  22290000
207206     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22300000
207207         MOVE +1                   TO ASC-BLK-SUB                 22310000
207208         PERFORM 5100-WRITE-TEMP-STORAGE                          22320000
207209         ADD +1                    TO ASC-BLK-SUB                 22330000
207210         PERFORM 5100-WRITE-TEMP-STORAGE                          22340000
207300                                                                  22350000
207400         MOVE 1                    TO ASC-BLK-SUB                 22360000
207500                                      PV-BLOCK-NUMBER             22370000
207600         PERFORM 4410-READ-TEMP-STORAGE                           22380000
207700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22390000
207800             MOVE 2                TO ASC-BLK-SUB                 22400000
207900                                      PV-BLOCK-NUMBER             22410000
208000             PERFORM 4410-READ-TEMP-STORAGE                       22420000
208100         END-IF                                                   22430000
208200     END-IF.                                                      22440000
208300/                                                                 22450000
W24803*----------------------------------------------------------------*22460000
W24803*  CALL TO XLKUT001 DOMAIN PROGRAM                               *22470000
W24803*----------------------------------------------------------------*22480000
W24803 4305-CALL-XLKUT-DOMAIN-PGM.                                      22490000
W24803     MOVE ASC-SKU-NBR         TO XL001-KEY-SKU.                   22500000
W24803     SET XL001-BY-NUMERIC-SKU                                     22510000
W24803         XL001-SELECT-SKU                                         22520000
W24803         XL001-SELECT-VND-STYL TO TRUE.                           22530000
W24803     CALL XL001-VSM-PGM USING DFHEIBLK                            22540000
W24803                              XL001-COMMAREA                      22550000
W24803                              XL001-ITEM-COMMAREA.                22560000
W24803                                                                  22570000
W24803     EVALUATE TRUE                                                22580000
W24803          WHEN XL001-SUCCESSFUL                                   22590000
W24803              SET PS-NO-ERROR   TO TRUE                           22600000
W24803          WHEN XL001-SKU-NOT-FOUND                                22610000
W24803          WHEN XL001-VND-STYL-NOT-FOUND                           22620000
W24803              MOVE PC-TSYMSG-00073                                22630000
W24803                              TO DP020-MSG-NUMBER                 22640000
W24803              SET PS-ERROR                                        22650000
W24803                  PS-COMMAREA-NOT-VALID                           22660000
W24803                  DP020-MSG-FATAL  TO TRUE                        22670000
W24803          WHEN XL001-SQL-ERROR                                    22680000
W24803              MOVE '4305-CALL-XLKUT-DOMAIN-PGM'                   22690000
W24803                                  TO DP013-PARAGRAPH              22700000
W24803              MOVE ' UNSUCCESSFUL SELECT XLT_SKU AND XLT_VND_STYL'22710000
W24803                                  TO DP013-MESSAGE-TEXT(1)        22720000
W24803              MOVE XL001-SQLCA    TO DP013-SQLCA                  22730000
W24803              MOVE 'XLT_SKU'      TO DP013-DB2-TABLE-NAME (1)     22740000
W24803              MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (2)     22750000
W24803              SET DP013-DB2-ABEND                                 22760000
W24803                    DP013-XCTL-DISPLAY-RESTART TO TRUE            22770000
W24803              PERFORM DP013-0000-PROCESS-ABEND                    22780000
W24803          WHEN XL001-INVALID-ACCESS                               22790000
W24803              MOVE '4305-CALL-XLKUT-DOMAIN-PGM'                   22800000
W24803                                  TO DP013-PARAGRAPH              22810000
W24803              MOVE 'UNSUCCESSFUL SELECT XLT_SKU AND XLT_VND_STYL' 22820000
W24803                                  TO DP013-MESSAGE-TEXT(1)        22830000
W24803              MOVE XL001-SQLCA    TO DP013-SQLCA                  22840000
W24803              MOVE 'XLT_SKU'      TO DP013-DB2-TABLE-NAME (1)     22850000
W24803              MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (2)     22860000
W24803              SET DP013-DB2-ABEND                                 22870000
W24803                      DP013-XCTL-DISPLAY-RESTART TO TRUE          22880000
W24803              PERFORM DP013-0000-PROCESS-ABEND                    22890000
W24803     END-EVALUATE.                                                22900000
W24803                                                                  22910000
214200*----------------------------------------------------------------*22920000
214300*    GET VENDOR NAME FOR SCREEN HEADER                           *22930000
214400*----------------------------------------------------------------*22940000
214500 4307-GET-VENDOR-NAME.                                            22950000
214600                                                                  22960000
214700         EXEC SQL                                                 22970000
214800            SELECT  ENT_NAME_DESC                                 22980000
214900                                                                  22990000
215000              INTO :ENTNME-ENT-NAME-DESC                          23000000
215100                                                                  23010000
215200              FROM  TENTNME                                       23020000
215300              WHERE ENT_ID          = :ASC-ENT-ID                 23030000
215400                AND TYPE_CDE        = '01'                        23040000
215500         END-EXEC.                                                23050000
215600                                                                  23060000
215700     EVALUATE TRUE                                                23070000
215800         WHEN SQLCODE = ZERO                                      23080048
                   CONTINUE                                             23090048
215800         WHEN SQLCODE = +100                                      23100048
215801              MOVE SPACES TO ENTNME-ENT-NAME-DESC                 23110000
215802         WHEN SQLCODE = -904                                      23120000
215900         WHEN SQLCODE = -911                                      23130000
216000         WHEN SQLCODE = -913                                      23140000
216100              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       23150000
216200              SET PS-ERROR                                        23160000
216300                  DP020-NEXT-ACT-APPL-ERROR                       23170000
216400                  DP020-MSG-FATAL                                 23180000
216500                      TO TRUE                                     23190000
216600              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 23200000
216700              PERFORM 9000-CALL-CICS-ARCH-API                     23210000
216800                                                                  23220000
216900         WHEN SQLWARN0 NOT = SPACES                               23230000
217000         WHEN SQLCODE < ZERO                                      23240000
217100         WHEN SQLCODE > ZERO                                      23250000
217200             MOVE '4307-GET-VENDOR-NAME'                          23260000
217300                               TO DP013-PARAGRAPH                 23270000
217400             MOVE 'GET-VENDOR NAME'                               23280000
217500                               TO DP013-MESSAGE-TEXT (1)          23290000
217600             MOVE SQLCA        TO DP013-SQLCA                     23300000
217700             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        23310000
217800             SET DP013-DB2-ABEND                                  23320000
217900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23330000
218000             PERFORM DP013-0000-PROCESS-ABEND                     23340000
218100     END-EVALUATE.                                                23350000
218101/                                                                 23360000
218102*----------------------------------------------------------------*23370000
218103*    GET THE SKU TOTAL ON ORDER FROM THE TSKSTOO TABLE           *23380000
218104*----------------------------------------------------------------*23390000
218105 4309-GET-SKU-ON-ORDER.                                           23400000
218106                                                                  23410000
W24803     INITIALIZE DCLTSKSTOO                                        23420000
W24803     MOVE ASC-ITM-NBR TO SKSTOO-ITM-NBR                           23430000
218110                                                                  23440000
               EXEC SQL                                                 23450000
                   SELECT SUM (ONORD_UNT_QTY)                           23460000
                     INTO  :SKSTOO-ONORD-UNT-QTY                        23470000
                     FROM  TSKSTOO                                      23480000
W24803              WHERE   ITM_NBR           =  :SKSTOO-ITM-NBR        23490000
               END-EXEC.                                                23500000
                                                                        23510000
               EVALUATE TRUE                                            23520000
                   WHEN SQLCODE = ZERO                                  23530000
                     MOVE SKSTOO-ONORD-UNT-QTY TO ASC-ON-ORDER          23540000
                   WHEN SQLCODE = +100                                  23550000
                   WHEN SQLCODE = -305                                  23560000
                     MOVE ZEROES TO ASC-ON-ORDER                        23570000
                   WHEN SQLCODE = -904                                  23580000
                   WHEN SQLCODE = -911                                  23590000
                   WHEN SQLCODE = -913                                  23600000
                     MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER      23610000
                     SET PS-ERROR                                       23620000
                        DP020-NEXT-ACT-APPL-ERROR                       23630000
                        DP020-MSG-FATAL                                 23640000
                            TO TRUE                                     23650000
                     MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1)23660000
                     PERFORM 9000-CALL-CICS-ARCH-API                    23670000
                   WHEN SQLWARN0 NOT = SPACES                           23680000
                   WHEN SQLCODE < ZERO                                  23690000
                   WHEN SQLCODE > ZERO                                  23700000
                       MOVE '4309-GET-SKU-ON-ORDER'                     23710000
                                         TO DP013-PARAGRAPH             23720000
                       MOVE 'GET SKU ON ORDER TOTAL'                    23730000
                                         TO DP013-MESSAGE-TEXT (1)      23740000
                       MOVE SQLCA        TO DP013-SQLCA                 23750000
                       MOVE 'TSKSTOO '   TO DP013-DB2-TABLE-NAME (1)    23760000
                       SET DP013-DB2-ABEND                              23770000
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           23780000
                       PERFORM DP013-0000-PROCESS-ABEND                 23790000
               END-EVALUATE.                                            23800000
218902/                                                                 23810000
218903*----------------------------------------------------------------*23820000
218904*    FETCH A SKU RECEIVER ROW                                    *23830000
218905*----------------------------------------------------------------*23840000
218906 4310-FETCH-PO-LINE-INFO.                                         23850000
218907                                                                  23860000
218908     EXEC SQL                                                     23870000
218909         FETCH PO-INFO-CSR                                        23880000
219000          INTO :PURCHS-PO-NBR                                     23890000
219100              ,:PURCHS-DIR-STR-IND                                23900000
219200              ,:PURITM-APP-PO-LNE-NBR                             23910000
219400              ,:PLNSHP-DONT-SHIP-BEF-DTE                          23920000
219401              ,:ALLPLN-DEST-NBR                                   23930000
219402              ,:ALLPLN-CURR-SPLIT-QTY                             23940000
219500     END-EXEC.                                                    23950000
219600                                                                  23960000
219700     EVALUATE TRUE                                                23970000
219800         WHEN SQLCODE = +0                                        23980000
219900              CONTINUE                                            23990000
220000         WHEN SQLCODE = +100                                      24000000
220100              SET ASC-NO-ITEMS-LEFT-ON-DB                         24010000
220200                                   TO TRUE                        24020000
220300         WHEN SQLWARN0 NOT = SPACE                                24030000
220400         WHEN SQLCODE < +0                                        24040000
220500         WHEN SQLCODE > +0                                        24050000
220600              MOVE '4310-FETCH-PO-LINE-INFO'                      24060000
220700                                   TO DP013-PARAGRAPH             24070000
220800              MOVE 'FETCH SKURCVR CURSOR'                         24080000
220900                                   TO DP013-MESSAGE-TEXT (1)      24090000
221000              MOVE SQLCA           TO DP013-SQLCA                 24100000
221100              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    24110000
221200              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    24120000
221300              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    24130000
221400              SET DP013-DB2-ABEND  TO TRUE                        24140000
221500              PERFORM DP013-0000-PROCESS-ABEND                    24150000
221600     END-EVALUATE.                                                24160000
221700                                                                  24170000
221800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24180000
221900         MOVE '4310-FETCH-PO-LINE-INFO'  TO DP013-PARAGRAPH       24190000
222000         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             24200000
222100                                   TO DP013-MESSAGE-TEXT (1)      24210000
222200         MOVE SQLCA                TO DP013-SQLCA                 24220000
222300         SET DP013-DB2-ABEND                                      24230000
222400             DP013-XCTL-DISPLAY-RESTART                           24240000
222500                                   TO TRUE                        24250000
222600         PERFORM DP013-0000-PROCESS-ABEND                         24260000
222700     END-IF.                                                      24270000
222800/                                                                 24280000
224603*----------------------------------------------------------------*24290000
224604*    FETCH CREATE DATE AND QUANTITIES FROM THE DB2 TABLES        *24300000
224605*----------------------------------------------------------------*24310000
224606 4320-FETCH-VER-DATE-AND-QTY.                                     24320000
224607                                                                  24330000
224608     EXEC SQL                                                     24340000
224609         FETCH RCVRQTY-CSR                                        24350000
224610                                                                  24360000
224611          INTO :PV-CRE-DTE                                        24370000
224612              ,:RECITM-REC-SEQ-NBR                                24380000
224613              ,:RECDIS-AP-VERIFY-ITM-QTY:PV-REC-VERIFIED-NULL     24390000
224614     END-EXEC.                                                    24400000
224615                                                                  24410000
224616     EVALUATE TRUE                                                24420000
224617         WHEN SQLCODE = +0                                        24430000
224618              IF PV-REC-VERIFIED-NULL < ZERO                      24440000
224619                 MOVE ZEROS TO RECDIS-AP-VERIFY-ITM-QTY           24450000
224620              END-IF                                              24460000
224800         WHEN SQLCODE = +100                                      24470000
224900              SET ASC-NO-ITEMS-LEFT-ON-DB-2                       24480000
225000                                   TO TRUE                        24490000
225100         WHEN SQLWARN0 NOT = SPACE                                24500000
225200         WHEN SQLCODE < +0                                        24510000
225300         WHEN SQLCODE > +0                                        24520000
225400              MOVE '4320-FETCH-VER-DATE-AND-QTY'                  24530000
225500                                   TO DP013-PARAGRAPH             24540000
225600              MOVE 'FETCH RCVRQTY CURSOR'                         24550000
225700                                   TO DP013-MESSAGE-TEXT (1)      24560000
225800              MOVE SQLCA           TO DP013-SQLCA                 24570000
225900              MOVE 'TRECDIS'       TO DP013-DB2-TABLE-NAME (1)    24580000
226000              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (2)    24590000
226100              SET DP013-DB2-ABEND  TO TRUE                        24600000
226200              PERFORM DP013-0000-PROCESS-ABEND                    24610000
226300     END-EVALUATE.                                                24620000
226400                                                                  24630000
226500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24640000
226600         MOVE '4320-FETCH-VER-DATE-AND-QTY' TO DP013-PARAGRAPH    24650000
226700         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             24660000
226800                                   TO DP013-MESSAGE-TEXT (1)      24670000
226900         MOVE SQLCA                TO DP013-SQLCA                 24680000
227000         SET DP013-DB2-ABEND                                      24690000
227100             DP013-XCTL-DISPLAY-RESTART                           24700000
227200                                   TO TRUE                        24710000
227300         PERFORM DP013-0000-PROCESS-ABEND                         24720000
227400     END-IF.                                                      24730000
227401                                                                  24740000
227402/                                                                 24750000
227403*----------------------------------------------------------------*24760000
227404*    GET 5 CHARACTER NAME FOR LOCATION DISPLAY                   *24770000
227405*----------------------------------------------------------------*24780000
227406 4330-GET-LOC-NAME.                                               24790000
227407                                                                  24800000
227408         EXEC SQL                                                 24810000
227409            SELECT  LOC_5_ABBR_NM                                 24820044
227410                                                                  24830000
227411              INTO :XMT00001-LOC-5-ABBR-NM                        24840044
227412                                                                  24850000
227413              FROM  XMT_LOC                                       24860044
227414              WHERE LOC_NBR = :ALLPLN-DEST-NBR                    24870044
227415                                                                  24880000
227416         END-EXEC.                                                24890000
227417                                                                  24900000
227418     EVALUATE TRUE                                                24910000
227419         WHEN SQLCODE = +100                                      24920000
227420              MOVE SPACES TO XMT00001-LOC-5-ABBR-NM               24930044
227421         WHEN SQLCODE = -904                                      24940000
227422         WHEN SQLCODE = -911                                      24950000
227423         WHEN SQLCODE = -913                                      24960000
227424              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       24970000
227425              SET PS-ERROR                                        24980000
227426                  DP020-NEXT-ACT-APPL-ERROR                       24990000
227427                  DP020-MSG-FATAL                                 25000000
227428                      TO TRUE                                     25010000
227429              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 25020000
227430              PERFORM 9000-CALL-CICS-ARCH-API                     25030000
227431                                                                  25040000
227432         WHEN SQLWARN0 NOT = SPACES                               25050000
227433         WHEN SQLCODE < ZERO                                      25060000
227434         WHEN SQLCODE > ZERO                                      25070000
227435             MOVE '4330-GET-LOC-NAME   '                          25080000
227436                               TO DP013-PARAGRAPH                 25090000
227437             MOVE 'GET-LOCATION NAME'                             25100000
227438                               TO DP013-MESSAGE-TEXT (1)          25110000
227439             MOVE SQLCA        TO DP013-SQLCA                     25120000
227440             MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)        25130044
227441             SET DP013-DB2-ABEND                                  25140000
227442                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25150000
227443             PERFORM DP013-0000-PROCESS-ABEND                     25160000
227444     END-EVALUATE.                                                25170000
227445                                                                  25180000
227500/                                                                 25190000
227600*----------------------------------------------------------------*25200000
227700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *25210000
227800*----------------------------------------------------------------*25220000
227900 4400-MOVE-COMMAREA-TO-SCREEN.                                    25230000
228000                                                                  25240000
228100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             25250000
228200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          25260000
228300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          25270000
228400             MOVE +1               TO ASC-BLK-SUB                 25280000
228500             PERFORM 5100-WRITE-TEMP-STORAGE                      25290000
228600             ADD +1                TO ASC-BLK-SUB                 25300000
228700             PERFORM 5100-WRITE-TEMP-STORAGE                      25310000
228800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             25320000
228900                 GIVING PV-BLOCK-NUMBER                           25330000
229000                 REMAINDER PV-REMAINDER                           25340000
229100             IF  PV-REMAINDER > ZERO                              25350000
229200                 ADD +1            TO PV-BLOCK-NUMBER             25360000
229300             END-IF                                               25370000
229400             MOVE +1               TO ASC-BLK-SUB                 25380000
229500             PERFORM 4410-READ-TEMP-STORAGE                       25390000
229600             ADD +1                TO ASC-BLK-SUB                 25400000
229700                                      PV-BLOCK-NUMBER             25410000
229800             PERFORM 4410-READ-TEMP-STORAGE                       25420000
229900     END-IF.                                                      25430000
230000                                                                  25440000
230100     MOVE +1                       TO ASC-BLK-SUB.                25450000
230200                                                                  25460000
230300     COMPUTE ASC-ITEM-SUB =                                       25470000
230400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              25480000
230500         + PC-ITEMS-PER-PANEL).                                   25490000
230600                                                                  25500000
230700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        25510000
230800         ADD +1                    TO ASC-BLK-SUB                 25520000
230900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25530000
231000     END-IF.                                                      25540000
231100                                                                  25550000
231200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           25560000
231300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                25570000
231400                                                                  25580000
231500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        25590000
231600     PERFORM 4420-FORMAT-LIST-LINES                               25600000
231700         VARYING PV-SUB                                           25610000
231800         FROM PC-ITEMS-PER-PANEL BY -1                            25620000
231900         UNTIL PV-SUB < +1.                                       25630000
232000                                                                  25640000
232100     COMPUTE ASC-ITEMS-DISPLAYED =                                25650000
232200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          25660000
232300                                                                  25670000
232400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    25680000
232500                                      ASTRTITO.                   25690000
232600                                                                  25700000
232700     MOVE ASC-DEPT-NBR             TO MR-DEPT.                    25710000
W24803     MOVE ASC-MAJ-CL-NBR           TO MR-MAJ-CL.                  25720000
W24803     MOVE ASC-SUB-CL-NBR           TO MR-SUB-CL.                  25730000
232900     MOVE ASC-SKU-NBR              TO MR-SKU.                     25740000
233000     MOVE ASC-STYLE                TO MR-STYLE.                   25750000
233100     MOVE ASC-DESC                 TO MR-DESC.                    25760000
233200     MOVE ASC-COLOR                TO MR-COLOR.                   25770000
233300     MOVE ASC-VEND-NAME            TO MR-VEND-NAME.               25780000
233400     MOVE ASC-SIZE                 TO MR-SIZE.                    25790000
233410     MOVE ASC-ON-ORDER             TO MR-ON-ORDER.                25800000
233500                                                                  25810000
233600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    25820000
233700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    25830000
233800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25840000
233900                                   TO ASELITO.                    25850000
234000                                                                  25860000
234100     IF  DP020-MSG-NUMBER-X = SPACE                               25870000
234200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  25880000
234300*            --- MORE ITEMS TO DISPLAY ----                       25890000
234400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            25900000
234500             SET DP020-MSG-INFORMATIONAL                          25910000
234600                                   TO TRUE                        25920000
234700         END-IF                                                   25930000
234800     END-IF.                                                      25940000
234900/                                                                 25950000
235000*----------------------------------------------------------------*25960000
235100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25970000
235200*----------------------------------------------------------------*25980000
235300 4410-READ-TEMP-STORAGE.                                          25990000
235400                                                                  26000000
235500     EXEC CICS                                                    26010000
235600         READQ TS                                                 26020000
235700             QUEUE (ASC-LIST-QUEUE-NAME)                          26030000
235800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26040000
235900             ITEM  (PV-BLOCK-NUMBER)                              26050000
236000             RESP  (PV-CICS-RESP)                                 26060000
236100     END-EXEC.                                                    26070000
236200                                                                  26080000
236300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       26090000
236400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     26100000
236500         CONTINUE                                                 26110000
236600     ELSE                                                         26120000
236700         SET DP013-CICS-ABEND      TO TRUE                        26130000
236800         SET DP013-NO-ROLLBACK     TO TRUE                        26140000
236900         MOVE '4410-READ-TEMP-STORAGE'                            26150000
237000                                   TO DP013-PARAGRAPH             26160000
237100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      26170000
237200                                   TO DP013-MESSAGE-TEXT(1)       26180000
237300         PERFORM DP013-0000-PROCESS-ABEND                         26190000
237400     END-IF.                                                      26200000
237500                                                                  26210000
237600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      26220000
237700                                   TO TRUE.                       26230000
237800                                                                  26240000
237900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         26250000
238000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               26260000
238100     END-IF.                                                      26270000
238200/                                                                 26280000
238300*----------------------------------------------------------------*26290000
238400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *26300000
238500*----------------------------------------------------------------*26310000
238600 4420-FORMAT-LIST-LINES.                                          26320000
238700                                                                  26330000
238800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      26340000
238900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                26350000
239000         MOVE DP015-HL-OFF         TO MR-SELECTH (PV-SUB)         26360000
239100         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         26370000
239200         MOVE SPACES             TO MR-DEPT                       26380000
W24803                                    MR-SPACE-1                    26390000
W24803                                    MR-MAJ-CL                     26400000
W24803                                    MR-SPACE-2                    26410000
W24803                                    MR-SUB-CL                     26420000
239400                                    MR-SKU                        26430000
239500                                    MR-STYLE                      26440000
239600                                    MR-DESC                       26450000
239700                                    MR-COLOR                      26460000
239800                                    MR-VEND-NAME                  26470000
239900                                    MR-SIZE                       26480000
240500         MOVE ZEROES             TO MR-ON-ORDER                   26490000
240501         MOVE SPACES             TO MR-SELECT (PV-SUB)            26500000
240502                                    MR-PO-NBR-X (PV-SUB)          26510000
240503                                    MR-LOCATION (PV-SUB)          26520000
240504                                    MR-SHIP-DTE (PV-SUB)          26530000
240505                                    MR-REC-DTE (PV-SUB)           26540000
240506                                                                  26550000
240507         MOVE ZEROES             TO MR-PO-LINE-NBR (PV-SUB)       26560000
240600                                    MR-ORD-QTY (PV-SUB)           26570000
240700                                    MR-REC-QTY (PV-SUB)           26580000
240800                                    MR-PCT-REC (PV-SUB)           26590000
240810         MOVE SPACES             TO MR-PCT-SIGN (PV-SUB)          26600000
240900     ELSE                                                         26610000
241000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26620000
241100                                                   > SPACE        26630000
241200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 26640000
241300                                   TO MR-SELECT (PV-SUB)          26650000
241400         ELSE                                                     26660000
241500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26670000
241600                                   TO MR-SELECT (PV-SUB)          26680000
241700         END-IF                                                   26690000
241800                                                                  26700000
241900         IF  DP030-SET-CURSOR-TRAILER                             26710000
242000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)26720000
242100                 > SPACE)                                         26730000
242200               OR (PV-SUB = 1))                                   26740000
242300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               26750000
242400                MOVE -1            TO MR-SELECTL (PV-SUB)         26760000
242500             END-IF                                               26770000
242600         END-IF                                                   26780000
242700                                                                  26790000
242800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           26800000
242900             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           26810000
243000                                   TO MR-PO-NBR (PV-SUB)          26820000
243100             MOVE ASC-LINE (ASC-BLK-SUB ASC-ITEM-SUB)             26830000
243200                                   TO MR-PO-LINE-NBR (PV-SUB)     26840000
243300             MOVE ASC-LOCATION (ASC-BLK-SUB ASC-ITEM-SUB)         26850000
243400                                   TO MR-LOCATION (PV-SUB)        26860000
243401             MOVE ASC-SHIP-DTE (ASC-BLK-SUB ASC-ITEM-SUB)         26870000
243402                                   TO MR-SHIP-DTE (PV-SUB)        26880000
243500             MOVE ASC-RECEIVED-DTE (ASC-BLK-SUB ASC-ITEM-SUB)     26890000
243600                                   TO MR-REC-DTE (PV-SUB)         26900000
243700             MOVE ASC-ORDER-QTY (ASC-BLK-SUB ASC-ITEM-SUB)        26910000
243800                                   TO MR-ORD-QTY (PV-SUB)         26920000
243900             MOVE ASC-RECEIVED-QTY (ASC-BLK-SUB ASC-ITEM-SUB)     26930000
244000                                   TO MR-REC-QTY (PV-SUB)         26940000
244100             MOVE ASC-PERCENT-REC (ASC-BLK-SUB ASC-ITEM-SUB)      26950000
244200                                   TO MR-PCT-REC (PV-SUB)         26960000
244201             MOVE ASC-PERCENT-SIGN (ASC-BLK-SUB ASC-ITEM-SUB)     26970000
244202                                   TO MR-PCT-SIGN (PV-SUB)        26980000
244300         END-IF                                                   26990000
244400     END-IF.                                                      27000000
244500                                                                  27010000
244600     MOVE ASC-TOT-ORDER-QTY     TO MR-ORDERTOT.                   27020000
244700     MOVE ASC-TOT-REC-ORDER-QTY TO MR-RECTOT.                     27030000
244800     MOVE ASC-TOT-PCT           TO MR-PCTTOT.                     27040000
244810     MOVE ASC-PERCENT-SIGN-TOT  TO MR-PCT-SIGN-TOT.               27050000
244900                                                                  27060000
245000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               27070000
245100                                                                  27080000
245200     IF  ASC-ITEM-SUB < + 1                                       27090000
245300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                27100000
245400         MOVE +1                   TO ASC-BLK-SUB                 27110000
245500     END-IF.                                                      27120000
245600/                                                                 27130000
245700*----------------------------------------------------------------*27140000
245800*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *27150000
245900*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *27160000
246000*  ISSUE A WARNING.                                              *27170000
246100*----------------------------------------------------------------*27180000
246200 4430-CHECK-FOR-BEGIN-AND-END.                                    27190000
246300                                                                  27200000
246400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       27210000
246500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     27220000
246600*            -- NO END-OF-RANGE SPECFIED ---                      27230000
246700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            27240000
246800             SET DP020-MSG-WARNING TO TRUE                        27250000
246900             PERFORM 4431-POSITION-AT-WARNING                     27260000
247000         END-IF                                                   27270000
247100     ELSE                                                         27280000
247200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     27290000
247300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                27300000
247400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            27310000
247500             SET DP020-MSG-WARNING TO TRUE                        27320000
247600             PERFORM 4431-POSITION-AT-WARNING                     27330000
247700         END-IF                                                   27340000
247800     END-IF.                                                      27350000
247900/                                                                 27360000
248000*----------------------------------------------------------------*27370000
248100*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *27380000
248200*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *27390000
248300*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *27400000
248400*  POSITION THE CURSOR THERE.                                    *27410000
248500*----------------------------------------------------------------*27420000
248600 4431-POSITION-AT-WARNING.                                        27430000
248700                                                                  27440000
248800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 27450000
248900                    - PV-TOP-ITEM + 1.                            27460000
249000                                                                  27470000
249100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27480000
249200         CONTINUE                                                 27490000
249300     ELSE                                                         27500000
249400         SET DP030-SET-CURSOR-APPL-1                              27510000
249500                                   TO TRUE                        27520000
249600         MOVE -1                   TO MR-SELECTL (PV-SUB)         27530000
249700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27540000
249800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27550000
249900     END-IF.                                                      27560000
250000                                                                  27570000
250100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   27580000
250200                    - PV-TOP-ITEM + 1.                            27590000
250300                                                                  27600000
250400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27610000
250500         CONTINUE                                                 27620000
250600     ELSE                                                         27630000
250700         SET DP030-SET-CURSOR-APPL-1                              27640000
250800                                   TO TRUE                        27650000
250900         MOVE -1                   TO MR-SELECTL (PV-SUB)         27660000
251000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27670000
251100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27680000
251200     END-IF.                                                      27690000
251300/                                                                 27700000
251400*----------------------------------------------------------------*27710000
251500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *27720000
251600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *27730000
251700* FOR THE SELECTED ITEMS QUEUE.                                  *27740000
251800*                                                                *27750000
251900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *27760000
252000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *27770000
252100* THE ARRAY IS FULL.                                             *27780000
252200*----------------------------------------------------------------*27790000
252300 5000-PREPARE-SEL-QUEUE.                                          27800000
252400                                                                  27810000
252500     MOVE +1                       TO ASC-BLK-SUB.                27820000
252600     PERFORM 5100-WRITE-TEMP-STORAGE.                             27830000
252700     ADD +1                        TO ASC-BLK-SUB.                27840000
252800     PERFORM 5100-WRITE-TEMP-STORAGE.                             27850000
252900                                                                  27860000
253000     MOVE ASC-SEL-QUEUE-NAME       TO PO069-SEL-QUEUE-NAME.       27870000
253100     PERFORM 6010-DELETE-SEL-QUEUE.                               27880000
253200                                                                  27890000
253300     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      27900000
253400         SET ASC-UPDATE-TSQ        TO TRUE                        27910000
253500     END-IF.                                                      27920000
253600                                                                  27930000
253700     SET PO070-IDX                 TO 1.                          27940000
253800     MOVE ZERO                     TO PO069-NUMBER-OF-TS-ITEMS.   27950000
253900     INITIALIZE PO070-SELECTED-ITEM-ARRAY.                        27960000
254000                                                                  27970000
254100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           27980000
254200             VARYING PV-ITEM                                      27990000
254300             FROM 1 BY 1                                          28000000
254400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     28010000
254500                                                                  28020000
254600     IF  PO070-IDX > 1                                            28030000
254700         PERFORM 5205-WRITE-SEL-QUEUE                             28040000
254800         ADD +1                    TO PO069-NUMBER-OF-TS-ITEMS    28050000
254900     END-IF.                                                      28060000
255000                                                                  28070000
255100/                                                                 28080000
255200*----------------------------------------------------------------*28090000
255300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *28100000
255400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *28110000
255500*----------------------------------------------------------------*28120000
255600 5100-WRITE-TEMP-STORAGE.                                         28130000
255700                                                                  28140000
255800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     28150000
255900                                   TO PV-LIST-ITEM-NUMBER.        28160000
256000     COMPUTE PV-BLOCK-NUMBER =                                    28170000
256100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    28180000
256200                                                                  28190000
256300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             28200000
256400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             28210000
256500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      28220000
256600             PERFORM 5105-REWRITE-ASC-LISTQ                       28230000
256700         END-IF                                                   28240000
256800     ELSE                                                         28250000
256900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       28260000
257000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            28270000
257100         PERFORM 5110-WRITE-ASC-LISTQ                             28280000
257200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   28290000
257300     END-IF.                                                      28300000
257400                                                                  28310000
257500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      28320000
257600                                   TO TRUE.                       28330000
257700/                                                                 28340000
257800*----------------------------------------------------------------*28350000
257900*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *28360000
258000*  SPECIFIC COMMAREA.                                            *28370000
258100*----------------------------------------------------------------*28380000
258200 5105-REWRITE-ASC-LISTQ.                                          28390000
258300                                                                  28400000
258400     EXEC CICS                                                    28410000
258500         WRITEQ TS                                                28420000
258600             QUEUE (ASC-LIST-QUEUE-NAME)                          28430000
258700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28440000
258800             ITEM  (PV-BLOCK-NUMBER)                              28450000
258900             REWRITE                                              28460000
259000             RESP  (PV-CICS-RESP)                                 28470000
259100     END-EXEC.                                                    28480000
259200                                                                  28490000
259300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           28500000
259400         CONTINUE                                                 28510000
259500     ELSE                                                         28520000
259600         SET DP013-CICS-ABEND      TO TRUE                        28530000
259700         SET DP013-NO-ROLLBACK     TO TRUE                        28540000
259800         MOVE '5105-REWRITE-ASC-LISTQ'                            28550000
259900                                   TO DP013-PARAGRAPH             28560000
260000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     28570000
260100                                   TO DP013-MESSAGE-TEXT(1)       28580000
260200         PERFORM DP013-0000-PROCESS-ABEND                         28590000
260300     END-IF.                                                      28600000
260400/                                                                 28610000
260500*----------------------------------------------------------------*28620000
260600*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *28630000
260700*  SPECIFIC COMMAREA.                                            *28640000
260800*----------------------------------------------------------------*28650000
260900 5110-WRITE-ASC-LISTQ.                                            28660000
261000                                                                  28670000
261100     EXEC CICS                                                    28680000
261200         WRITEQ TS                                                28690000
261300             QUEUE (ASC-LIST-QUEUE-NAME)                          28700000
261400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28710000
261500             ITEM  (PV-BLOCK-NUMBER)                              28720000
261600             RESP  (PV-CICS-RESP)                                 28730000
261700     END-EXEC.                                                    28740000
261800                                                                  28750000
261900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      28760000
262000         SET DP013-CICS-ABEND      TO TRUE                        28770000
262100         SET DP013-NO-ROLLBACK     TO TRUE                        28780000
262200         MOVE '5110-WRITE-ASC-LISTQ'                              28790000
262300                                   TO DP013-PARAGRAPH             28800000
262400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           28810000
262500                                   TO DP013-MESSAGE-TEXT(1)       28820000
262600         PERFORM DP013-0000-PROCESS-ABEND                         28830000
262700     END-IF.                                                      28840000
262800/                                                                 28850000
262900*----------------------------------------------------------------*28860000
263000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *28870000
263100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *28880000
263200*----------------------------------------------------------------*28890000
263300 5200-FILL-SEL-QUEUE-RECORD.                                      28900000
263400                                                                  28910000
263500     PERFORM 6112-READ-LIST-QUEUE.                                28920000
263600                                                                  28930000
263700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28940000
263800         PERFORM                                                  28950000
263900         VARYING LQW-IDX                                          28960000
264000         FROM 1 BY 1                                              28970000
264100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            28980000
264200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          28990000
264300             IF  LQW-SELECT (LQW-IDX)                             29000000
264400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              29010000
264500                                   TO PO070-ITEM (PO070-IDX)      29020000
264600                 MOVE LQW-PO-NUMBER (LQW-IDX)                     29030000
264700                                   TO PO070-PO-NBR (PO070-IDX)    29040000
264800                 MOVE LQW-PO-LINE (LQW-IDX)                       29050000
264900                                   TO PO070-LINE (PO070-IDX)      29060000
265000                 MOVE SPACE        TO PO070-ACTION-SW (PO070-IDX) 29070000
265100                 SET PO070-IDX UP BY 1                            29080000
265200                 IF  PO070-IDX > PO070-MAX-ITEMS                  29090000
265300                     PERFORM 5205-WRITE-SEL-QUEUE                 29100000
265400                     ADD +1        TO PO069-NUMBER-OF-TS-ITEMS    29110000
265500                     INITIALIZE PO070-SELECTED-ITEM-ARRAY         29120000
265600                     SET PO070-IDX TO 1                           29130000
265700                 END-IF                                           29140000
265800             END-IF                                               29150000
265900         END-PERFORM                                              29160000
266000     END-IF.                                                      29170000
266100/                                                                 29180000
266200*----------------------------------------------------------------*29190000
266300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *29200000
266400*----------------------------------------------------------------*29210000
266500 5205-WRITE-SEL-QUEUE.                                            29220000
266600                                                                  29230000
266700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29240000
266800                                   TO PO070-SELECTED-ITEMS.       29250000
266900                                                                  29260000
267000     EXEC CICS                                                    29270000
267100          WRITEQ TS                                               29280000
267200              QUEUE (ASC-SEL-QUEUE-NAME)                          29290000
267300              FROM  (PO070-SKU-RECEIVER-REC)                      29300000
267400              ITEM  (PV-SEL-QUEUE-ITEM)                           29310000
267500              RESP  (PV-CICS-RESP)                                29320000
267600     END-EXEC.                                                    29330000
267700                                                                  29340000
267800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29350000
267900         CONTINUE                                                 29360000
268000     ELSE                                                         29370000
268100         SET DP013-CICS-ABEND      TO TRUE                        29380000
268200         SET DP013-NO-ROLLBACK     TO TRUE                        29390000
268300         MOVE '5205-WRITE-SEL-QUEUE'                              29400000
268400                                   TO DP013-PARAGRAPH             29410000
268500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          29420000
268600                                   TO DP013-MESSAGE-TEXT(1)       29430000
268700         PERFORM DP013-0000-PROCESS-ABEND                         29440000
268800     END-IF.                                                      29450000
268900/                                                                 29460000
269000*----------------------------------------------------------------*29470000
269100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *29480000
269200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *29490000
269300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *29500000
269400*  THE USER.                                                     *29510000
269500*----------------------------------------------------------------*29520000
269600 6000-REFRESH-PANEL-FROM-TEMP.                                    29530000
269700                                                                  29540000
269800     IF  ASC-UPDATE-TSQ                                           29550000
269900         SET ASC-NO-TSQ-UPDATE     TO TRUE                        29560000
270000         MOVE ZERO                 TO PV-SAVE-ITEM                29570000
270100                                      PV-SEL-QUEUE-ITEM           29580000
270200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        29590000
270300                                   TO PV-HOLD-SELECTED-ITEMS      29600000
270400         PERFORM 6100-UPDATE-TSQ                                  29610000
270500             UNTIL PV-ITEMS-PROCESSED >                           29620000
270600                                     ASC-NUMBER-OF-SELECTED-ITEMS 29630000
270700         PERFORM 6010-DELETE-SEL-QUEUE                            29640000
270800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         29650000
270900                    ASC-BLOCK-ENTRIES (2)                         29660000
271000     END-IF.                                                      29670000
271100/                                                                 29680000
271200*----------------------------------------------------------------*29690000
271300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *29700000
271400*----------------------------------------------------------------*29710000
271500 6010-DELETE-SEL-QUEUE.                                           29720000
271600                                                                  29730000
271700     EXEC CICS                                                    29740000
271800         DELETEQ TS                                               29750000
271900             QUEUE (ASC-SEL-QUEUE-NAME)                           29760000
272000             RESP  (PV-CICS-RESP)                                 29770000
272100     END-EXEC.                                                    29780000
272200                                                                  29790000
272300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      29800000
272400         (PV-CICS-RESP = DFHRESP(QIDERR)))                        29810000
272500         CONTINUE                                                 29820000
272600     ELSE                                                         29830000
272700         SET DP013-CICS-ABEND      TO TRUE                        29840000
272800         SET DP013-NO-ROLLBACK     TO TRUE                        29850000
272900         MOVE '6010-DELETE-SEL-QUEUE'                             29860000
273000                                   TO DP013-PARAGRAPH             29870000
273100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         29880000
273200                                   TO DP013-MESSAGE-TEXT (1)      29890000
273300         PERFORM DP013-0000-PROCESS-ABEND                         29900000
273400     END-IF.                                                      29910000
273500/                                                                 29920000
273600*----------------------------------------------------------------*29930000
273700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *29940000
273800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *29950000
273900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *29960000
274000*    THE TEMP QUEUE.                                             *29970000
274100*----------------------------------------------------------------*29980000
274200 6100-UPDATE-TSQ.                                                 29990000
274300                                                                  30000000
274400     ADD 1                         TO PV-SEL-QUEUE-ITEM.          30010000
274500     PERFORM 6105-READ-SEL-QUEUE.                                 30020000
274600                                                                  30030000
274700     PERFORM                                                      30040000
274800         VARYING PO070-IDX                                        30050000
274900         FROM 1 BY 1                                              30060000
275000         UNTIL ((PV-ITEMS-PROCESSED >                             30070000
275100                              PV-HOLD-SELECTED-ITEMS)             30080000
275200         OR (PO070-IDX GREATER THAN PO070-MAX-ITEMS))             30090000
275300         IF  PO070-ACTION-SW (PO070-IDX) > SPACE                  30100000
275400             PERFORM 6110-PROCESS-ITEMS                           30110000
275500         END-IF                                                   30120000
275600         ADD +1                    TO PV-ITEMS-PROCESSED          30130000
275700     END-PERFORM.                                                 30140000
275800                                                                  30150000
275900     PERFORM 6111-WRITE-LIST-QUEUE.                               30160000
276000/                                                                 30170000
276100*----------------------------------------------------------------*30180000
276200*    READ THE LIST QUEUE RECORD.                                 *30190000
276300*----------------------------------------------------------------*30200000
276400 6105-READ-SEL-QUEUE.                                             30210000
276500                                                                  30220000
276600     EXEC CICS                                                    30230000
276700          READQ TS                                                30240000
276800              QUEUE (ASC-SEL-QUEUE-NAME)                          30250000
276900              INTO  (PO070-SKU-RECEIVER-REC)                      30260000
277000              ITEM  (PV-SEL-QUEUE-ITEM)                           30270000
277100              RESP  (PV-CICS-RESP)                                30280000
277200     END-EXEC.                                                    30290000
277300                                                                  30300000
277400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30310000
277500         CONTINUE                                                 30320000
277600     ELSE                                                         30330000
277700         SET DP013-CICS-ABEND      TO TRUE                        30340000
277800         SET DP013-NO-ROLLBACK     TO TRUE                        30350000
277900         MOVE '6105-READ-SEL-QUEUE'                               30360000
278000                                   TO DP013-PARAGRAPH             30370000
278100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           30380000
278200                                   TO DP013-MESSAGE-TEXT(1)       30390000
278300         PERFORM DP013-0000-PROCESS-ABEND                         30400000
278400     END-IF.                                                      30410000
278500/                                                                 30420000
278600*----------------------------------------------------------------*30430000
278700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*30440000
278800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*30450000
278900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *30460000
279000*----------------------------------------------------------------*30470000
279100 6110-PROCESS-ITEMS.                                              30480000
279200                                                                  30490000
279300     COMPUTE PV-ITEM = 1 + ((PO070-ITEM (PO070-IDX) - 1)          30500000
279400                     / PC-ITEMS-PER-PANEL).                       30510000
279500                                                                  30520000
279600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           30530000
279700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          30540000
279800             PERFORM 6111-WRITE-LIST-QUEUE                        30550000
279900         END-IF                                                   30560000
280000         MOVE PV-ITEM              TO PV-SAVE-ITEM                30570000
280100                                                                  30580000
280200         PERFORM 6112-READ-LIST-QUEUE                             30590000
280300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               30600000
280400             CONTINUE                                             30610000
280500         END-IF                                                   30620000
280600     END-IF.                                                      30630000
280700                                                                  30640000
280800     COMPUTE PV-SUB = (PO070-ITEM (PO070-IDX)                     30650000
280900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              30660000
281000                                                                  30670000
281100     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       30680000
281200     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        30690000
281300                                     (PV-SUB).                    30700000
281400                                                                  30710000
281500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                30720000
281600/                                                                 30730000
281700*----------------------------------------------------------------*30740000
281800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *30750000
281900*----------------------------------------------------------------*30760000
282000 6111-WRITE-LIST-QUEUE.                                           30770000
282100                                                                  30780000
282200     EXEC CICS                                                    30790000
282300         WRITEQ TS                                                30800000
282400             QUEUE (ASC-LIST-QUEUE-NAME)                          30810000
282500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     30820000
282600             ITEM  (PV-SAVE-ITEM)                                 30830000
282700             REWRITE                                              30840000
282800             RESP  (PV-CICS-RESP)                                 30850000
282900     END-EXEC.                                                    30860000
283000                                                                  30870000
283100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30880000
283200     OR  PV-CICS-RESP = DFHRESP (ITEMERR)                         30890000
283300         CONTINUE                                                 30900000
283400     ELSE                                                         30910000
283500         SET DP013-CICS-ABEND      TO TRUE                        30920000
283600         SET DP013-NO-ROLLBACK     TO TRUE                        30930000
283700         MOVE '6111-WRITE-LIST-QUEUE'                             30940000
283800                                   TO DP013-PARAGRAPH             30950000
283900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  30960000
284000                                   TO DP013-MESSAGE-TEXT(1)       30970000
284100         PERFORM DP013-0000-PROCESS-ABEND                         30980000
284200     END-IF.                                                      30990000
284300/                                                                 31000000
284400*----------------------------------------------------------------*31010000
284500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*31020000
284600*----------------------------------------------------------------*31030000
284700 6112-READ-LIST-QUEUE.                                            31040000
284800                                                                  31050000
284900     EXEC CICS                                                    31060000
285000         READQ TS                                                 31070000
285100             QUEUE (ASC-LIST-QUEUE-NAME)                          31080000
285200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     31090000
285300             ITEM  (PV-ITEM)                                      31100000
285400             RESP  (PV-CICS-RESP)                                 31110000
285500     END-EXEC.                                                    31120000
285600                                                                  31130000
285700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31140000
285800         CONTINUE                                                 31150000
285900     ELSE                                                         31160000
286000         SET DP013-CICS-ABEND      TO TRUE                        31170000
286100         SET DP013-NO-ROLLBACK     TO TRUE                        31180000
286200         MOVE '6112-READ-LIST-QUEUE'                              31190000
286300                                   TO DP013-PARAGRAPH             31200000
286400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    31210000
286500                                   TO DP013-MESSAGE-TEXT(1)       31220000
286600         PERFORM DP013-0000-PROCESS-ABEND                         31230000
286700     END-IF.                                                      31240000
286800                                                                  31250000
286820*----------------------------------------------------------------*31260000
286830*  FIRE UP THE CICS ARCHITECTURE                                 *31270000
286840*----------------------------------------------------------------*31280000
289900 9000-CALL-CICS-ARCH-API.                                         31290000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      31300054
290100                                    DFHCOMMAREA                   31310054
290200                                    DP030-CICS-API-FIELDS         31320054
290300                                    DP020-STANDARD-COMMAREA       31330054
290400                                    PO080AI.                      31340054
290500                                                                  31350000
290600     IF DP030-RC-CALL-SUCCESSFUL OR                               31360000
290700        DP030-RC-APPL-ERROR                                       31370000
290800         CONTINUE                                                 31380000
290900     ELSE                                                         31390000
291000         SET DP013-NO-ROLLBACK                                    31400000
291100             DP013-XCTL-DISPLAY-RESTART                           31410000
291200             DP013-CICS-ABEND      TO TRUE                        31420000
291300         MOVE '9000-CALL-CICS-ARCH-API'                           31430000
291400                                   TO DP013-PARAGRAPH             31440000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O31450054
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      31460054
291700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      31470000
291800         PERFORM DP013-0000-PROCESS-ABEND                         31480000
291900     END-IF.                                                      31490000
292000/                                                                 31500000
292010 EJECT                                                            31510000
292020                                                                  31520000
292030*----------------------------------------------------------------*31530000
292040*    DPPD038 IS THE COPYBOOK TO SELECTIVELY ACCESS               *31540000
292050*    ARCHIVE HISTORY DB2 TBLS -OR- REGULAR UPDATEABLE DB2 TBLS.  *31550000
292060*    PARA: DP038-0000-SET-DB2-PKG.                               *31560000
292070*----------------------------------------------------------------*31570000
292080*    COPY DPPD038.                                                31580000
292090*EJECT                                                            31590000
292091                                                                  31600000
292100*----------------------------------------------------------------*31610000
292200*    ABEND PROCESSOR MODULE                                      *31620000
292300*----------------------------------------------------------------*31630000
292400     COPY DPPD013.                                                31640000
292500*----------------------------------------------------------------*31650000
