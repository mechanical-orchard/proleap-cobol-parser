000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS171.                                         00040099
000500 AUTHOR.        MARGARET MORRISON.                                00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  12/98.                                            00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y171 - CUSTOMS ENTRY LIST BY PO                            * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE CUSTOMS ENTRIES   * 00130099
001400*    OF A REQUESTED PO.                                         * 00140099
001500*---------------------------------------------------------------* 00150099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00152099
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00153099
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00154099
263697*---------------------------------------------------------------* 00155099
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00156099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00157099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00158099
CICS  *-----------------------------------------------------------------00159099
001600                                                                  00160099
001700 ENVIRONMENT DIVISION.                                            00170099
001800                                                                  00180099
001900 DATA DIVISION.                                                   00190099
002000                                                                  00200099
002100 WORKING-STORAGE SECTION.                                         00210099
002200                                                                  00220099
002300 01  DK-DB2-KEYS.                                                 00230099
002400     15  DK-PO-NBR                      PIC S9(09)  COMP.         00240099
002500                                                                  00250099
002600 01  PC-PROGRAM-CONSTANTS.                                        00260099
002700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00270099
002800                                                    'TR171A  '.   00280099
002900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00290099
003000                                                    'TRKM171 '.   00300099
003100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00310099
003200                                                    'TRKCS171'.   00320099
003300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00330099
003400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00340099
003500     05  PC-N                           PIC  X(01)  VALUE 'N'.    00350099
003600     05  PC-D                           PIC  X(01)  VALUE 'D'.    00360099
003700     05  PC-U                           PIC  X(01)  VALUE 'U'.    00370099
003800     05  PC-0001                        PIC  X(04)  VALUE '0001'. 00380099
003900     05  PC-MULTI                       PIC  X(05)  VALUE 'MULTI'.00390099
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00400099
004100                                                    COMP SYNC.    00410099
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00420099
004300                                                    COMP SYNC.    00430099
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00440099
004500                                                    +1000000      00450099
004600                                                    COMP-3.       00460099
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00470099
004800                                                    COMP SYNC.    00480099
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00490099
005000                                                    COMP-3.       00500099
005100     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00510099
005200                                                    '0001-01-01'. 00520099
005300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00530099
005400                                                                  00540099
005500     05  PC-TSYMSG-NUMBERS.                                       00550099
005600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00560099
005700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00570099
005800         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00580099
005900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00590099
006000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00600099
006100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00610099
006200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00620099
006300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00630099
006400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00640099
006500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00650099
006600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00660099
006700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00670099
006800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00680099
006900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00690099
007000         10  PC-TSYMSG-00778            PIC  9(05)  VALUE 00778.  00700099
007100                                                                  00710099
007200     05  PC-HISTORY-MSG                 PIC  X(40)  VALUE         00720099
007300                     'DELETED ENTRIES EXIST -- ACCESS F23     '.  00730099
007400                                                                  00740099
007500 01  PS-PROGRAM-SWITCHES.                                         00750099
007600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00760099
007700         88  PS-NO-ERROR                            VALUE 'Y'.    00770099
007800         88  PS-ERROR                               VALUE 'N'.    00780099
007900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00790099
008000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00800099
008100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00810099
008200                                                                  00820099
008300 01  PV-PROGRAM-VARIABLES.                                        00830099
008400     05  PV-SUB                         PIC S9(04)  VALUE +0      00840099
008500                                                    COMP SYNC.    00850099
008600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00860099
008700                                                    COMP SYNC.    00870099
008800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00880099
008900                                                    COMP-3.       00890099
009000     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      00900099
009100                                                    COMP-3.       00910099
009200     05  PV-CONTNR-COUNT                PIC S9(09)  VALUE +0      00920099
009300                                                    COMP-3.       00930099
009400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00940099
009500                                                    COMP-3.       00950099
009600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00960099
009700                                                    COMP-3.       00970099
009800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00980099
009900                                                    COMP-3.       00990099
010000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01000099
010100                                                    COMP-3.       01010099
010200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01020099
010300                                                    COMP-3.       01030099
010400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01040099
010500                                                    COMP SYNC.    01050099
010600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01060099
010700                                                    COMP SYNC.    01070099
010800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01080099
010900                                                    COMP SYNC.    01090099
011000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01100099
011100                                                    COMP SYNC.    01110099
011200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01120099
011300                                                    COMP SYNC.    01130099
011400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01140099
011500                                                    COMP SYNC.    01150099
011600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01160099
011700                                                    COMP SYNC.    01170099
011800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01180099
011900                                                    COMP SYNC.    01190099
012000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01200099
012100                                                    COMP SYNC.    01210099
012200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01220099
012300                                                    COMP SYNC.    01230099
012400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01240099
012500                                                    COMP SYNC.    01250099
012600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01260099
012700                                                    COMP SYNC.    01270099
012800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01280099
012900                                                    COMP SYNC.    01290099
013000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01300099
013100                                                    COMP SYNC.    01310099
013200     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01320099
013300                                                    COMP SYNC.    01330099
013400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01340099
013500                                                    COMP SYNC.    01350099
013600     05  PV-FORMAT-DATE.                                          01360099
013700         10  PV-FORMAT-MONTH            PIC XX.                   01370099
013800         10  PV-FORMAT-SLASH            PIC X       VALUE '/'.    01380099
013900         10  PV-FORMAT-DAY              PIC XX.                   01390099
014000                                                                  01400099
014100*----------------------------------------------------------------*01410099
014200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01420099
014300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *01430099
014400*   APPLICATION-SPECIFIC COMMAREA.                               *01440099
014500*----------------------------------------------------------------*01450099
014600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01460099
014700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01470099
014800     05  LQW-ITEM-ENTRIES               OCCURS 11   TIMES         01480099
014900                                        INDEXED BY  LQW-IDX.      01490099
015000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01500099
015100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01510099
015200         10  LQW-SELECTED-SW            PIC  X(01).               01520099
015300             88  LQW-SELECT                         VALUE 'S'.    01530099
015400             88  LQW-DESELECT                       VALUE ' '.    01540099
015500         10  LQW-ACTION                 PIC  X(03).               01550099
015600         10  LQW-ENTRY-ID               PIC  X(12).               01560099
015700         10  LQW-FILED-DTE              PIC  X(05).               01570099
015800         10  LQW-EXAM-DECLARED-DTE      PIC  X(05).               01580099
015900         10  LQW-REJECTED-DTE           PIC  X(05).               01590099
016000         10  LQW-EST-CLRD-DTE           PIC  X(05).               01600099
016100         10  LQW-ACT-CLRD-DTE           PIC  X(05).               01610099
016200         10  LQW-LIQ-DTE                PIC  X(05).               01620099
016300         10  LQW-LIQ-SUSP-DTE           PIC  X(05).               01630099
016400         10  LQW-PO-CNT                 PIC  9(02).               01640099
016500         10  LQW-CONTNR-CNT             PIC  9(02).               01650099
016600         10  LQW-ENT-ID                 PIC  S9(09) COMP.         01660099
016700         10  LQW-POE-CDE                PIC  X(03).               01670099
016800         10  LQW-LAST-TRN               PIC  X(05).               01680099
016900         10  LQW-HISTORY-IND            PIC  X(01).               01690099
017000                                                                  01700099
017100 EJECT                                                            01710099
017200*---------------------------------------------------------------* 01720099
017300*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.            01730099
017400*---------------------------------------------------------------* 01740099
017500                                                                  01750099
017600     COPY TRWS112.                                                01760099
017700                                                                  01770099
017800 EJECT                                                            01780099
017900*---------------------------------------------------------------* 01790099
018000*    MAP LAYOUT                                                 * 01800099
018100*---------------------------------------------------------------* 01810099
018200                                                                  01820099
018300     COPY TRKM171.                                                01830099
018400                                                                  01840099
018500 01  MR-OCCURS-LAYOUT                   REDEFINES  TR171AO.       01850099
018600** CHG0094517  CHANGED FILLER LENGTH TO 135 FROM 134              01860099
018700     05  FILLER                         PIC X(135).               01870099
018800                                                                  01880099
018900     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          01890099
019000         10  MR-SELECTL                 PIC S9(04) COMP.          01900099
019100         10  MR-SELECTA                 PIC  X(01).               01910099
019200         10  MR-SELECTC                 PIC  X(01).               01920099
019300         10  MR-SELECTH                 PIC  X(01).               01930099
019400         10  MR-SELECTI                 PIC  X(01).               01940099
019500                                                                  01950099
019600         10  MR-ACTIONL                 PIC S9(04) COMP.          01960099
019700         10  MR-ACTIONA                 PIC  X(01).               01970099
019800         10  MR-ACTIONC                 PIC  X(01).               01980099
019900         10  MR-ACTIONH                 PIC  X(01).               01990099
020000         10  MR-ACTION                  PIC  X(03).               02000099
020100                                                                  02010099
020200         10  MR-ENTRY-NBRL              PIC S9(04) COMP.          02020099
020300         10  MR-ENTRY-NBRA              PIC  X(01).               02030099
020400         10  MR-ENTRY-NBRC              PIC  X(01).               02040099
020500         10  MR-ENTRY-NBRH              PIC  X(01).               02050099
020600         10  MR-ENTRY-NBR               PIC  X(12).               02060099
020700                                                                  02070099
020800         10  MR-POEL                    PIC S9(04) COMP.          02080099
020900         10  MR-POEA                    PIC  X(01).               02090099
021000         10  MR-POEC                    PIC  X(01).               02100099
021100         10  MR-POEH                    PIC  X(01).               02110099
021200         10  MR-POE                     PIC  X(03).               02120099
021300                                                                  02130099
021400         10  MR-FILEDL                  PIC S9(04) COMP.          02140099
021500         10  MR-FILEDA                  PIC  X(01).               02150099
021600         10  MR-FILEDC                  PIC  X(01).               02160099
021700         10  MR-FILEDH                  PIC  X(01).               02170099
021800         10  MR-FILED                   PIC  X(05).               02180099
021900                                                                  02190099
022000         10  MR-EXAML                   PIC S9(04) COMP.          02200099
022100         10  MR-EXAMA                   PIC  X(01).               02210099
022200         10  MR-EXAMC                   PIC  X(01).               02220099
022300         10  MR-EXAMH                   PIC  X(01).               02230099
022400         10  MR-EXAM                    PIC  X(05).               02240099
022500                                                                  02250099
022600         10  MR-REJL                    PIC S9(04) COMP.          02260099
022700         10  MR-REJA                    PIC  X(01).               02270099
022800         10  MR-REJC                    PIC  X(01).               02280099
022900         10  MR-REJH                    PIC  X(01).               02290099
023000         10  MR-REJ                     PIC  X(05).               02300099
023100                                                                  02310099
023200         10  MR-EST-CLRDL               PIC S9(04) COMP.          02320099
023300         10  MR-EST-CLRDA               PIC  X(01).               02330099
023400         10  MR-EST-CLRDC               PIC  X(01).               02340099
023500         10  MR-EST-CLRDH               PIC  X(01).               02350099
023600         10  MR-EST-CLRD                PIC  X(05).               02360099
023700                                                                  02370099
023800         10  MR-ACT-CLRDL               PIC S9(04) COMP.          02380099
023900         10  MR-ACT-CLRDA               PIC  X(01).               02390099
024000         10  MR-ACT-CLRDC               PIC  X(01).               02400099
024100         10  MR-ACT-CLRDH               PIC  X(01).               02410099
024200         10  MR-ACT-CLRD                PIC  X(05).               02420099
024300                                                                  02430099
024400         10  MR-LIQL                    PIC S9(04) COMP.          02440099
024500         10  MR-LIQA                    PIC  X(01).               02450099
024600         10  MR-LIQC                    PIC  X(01).               02460099
024700         10  MR-LIQH                    PIC  X(01).               02470099
024800         10  MR-LIQ                     PIC  X(05).               02480099
024900                                                                  02490099
025000         10  MR-SLIQL                   PIC S9(04) COMP.          02500099
025100         10  MR-SLIQA                   PIC  X(01).               02510099
025200         10  MR-SLIQC                   PIC  X(01).               02520099
025300         10  MR-SLIQH                   PIC  X(01).               02530099
025400         10  MR-SLIQ                    PIC  X(05).               02540099
025500                                                                  02550099
025600         10  MR-POL                     PIC S9(04) COMP.          02560099
025700         10  MR-POA                     PIC  X(01).               02570099
025800         10  MR-POC                     PIC  X(01).               02580099
025900         10  MR-POH                     PIC  X(01).               02590099
026000         10  MR-PO-CNT                  PIC  Z9.                  02600099
026100         10  MR-PO-CNT-X REDEFINES MR-PO-CNT  PIC X(02).          02610099
026200                                                                  02620099
026300         10  MR-CONTL                   PIC S9(04) COMP.          02630099
026400         10  MR-CONTA                   PIC  X(01).               02640099
026500         10  MR-CONTC                   PIC  X(01).               02650099
026600         10  MR-CONTH                   PIC  X(01).               02660099
026700         10  MR-CONTNR-CNT              PIC  Z9.                  02670099
026800         10  MR-CONTNR-CNT-X REDEFINES MR-CONTNR-CNT PIC X(02).   02680099
026900                                                                  02690099
027000         10  MR-LAST-TRNL               PIC S9(04) COMP.          02700099
027100         10  MR-LAST-TRNA               PIC  X(01).               02710099
027200         10  MR-LAST-TRNC               PIC  X(01).               02720099
027300         10  MR-LAST-TRNH               PIC  X(01).               02730099
027400         10  MR-LAST-TRN                PIC  X(05).               02740099
027500                                                                  02750099
027600         10  MR-HISTORYL                PIC S9(04) COMP.          02760099
027700         10  MR-HISTORYA                PIC  X(01).               02770099
027800         10  MR-HISTORYC                PIC  X(01).               02780099
027900         10  MR-HISTORYH                PIC  X(01).               02790099
028000         10  MR-HISTORY                 PIC  X(01).               02800099
028100                                                                  02810099
028200 EJECT                                                            02820099
028300*---------------------------------------------------------------* 02830099
028400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02840099
028500*---------------------------------------------------------------* 02850099
028600                                                                  02860099
028700     COPY DPWS015.                                                02870099
028800                                                                  02880099
028900 EJECT                                                            02890099
029000*---------------------------------------------------------------* 02900099
029100*    FUNCTION KEYS COPYBOOK.                                    * 02910099
029200*---------------------------------------------------------------* 02920099
029300                                                                  02930099
029400     COPY DPWS016.                                                02940099
029500                                                                  02950099
029600 EJECT                                                            02960099
029700*---------------------------------------------------------------* 02970099
029800*    NUMERIC EDIT LAYOUT.                                       * 02980099
029900*---------------------------------------------------------------* 02990099
030000                                                                  03000099
030100     COPY DPWS010I.                                               03010099
030200                                                                  03020099
030300 EJECT                                                            03030099
030400*---------------------------------------------------------------* 03040099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03050099
030600*---------------------------------------------------------------* 03060099
030700                                                                  03070099
030800     COPY DPWS030.                                                03080099
CICS       COPY DPWS930.                                                03090099
031000 EJECT                                                            03100099
031100*---------------------------------------------------------------* 03110099
031200*    STANDARD COMMAREA.                                         * 03120099
031300*---------------------------------------------------------------* 03130099
031400                                                                  03140099
031500     COPY DPWS020.                                                03150099
031600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03160099
031700                                                                  03170099
031800*---------------------------------------------------------------* 03180099
031900* INTER-APPLICATION COMMAREA.                                   * 03190099
032000*   TRWS105 - ARE THE INPUT LAYOUTS FOR THIS PROGRAM            * 03200099
032100*   TRWS114 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03210099
032200*             THIS PROGRAM TO CUSTOMS CONTAINER, BILL OF LADING,* 03220099
032300*             OR PURCHASE ORDER PROGRAMS.                       * 03230099
032400*---------------------------------------------------------------* 03240099
032500                                                                  03250099
032600         10  INTER-APPL-COMM-AREA       PIC X(200).               03260099
032700     COPY TRWS105.                                                03270099
032800     COPY TRWS114.                                                03280099
032900                                                                  03290099
033000*---------------------------------------------------------------* 03300099
033100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03310099
033200*---------------------------------------------------------------* 03320099
033300         10  ASC-SPECIFIC-COMMAREA.                               03330099
033400             15  ASC-LIST-KEYS.                                   03340099
033500                 20  ASC-KEY-PO-NBR                  PIC S9(09)   03350099
033600                                                          COMP.   03360099
033700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03370099
033800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03380099
033900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03390099
034000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03400099
034100                                                                  03410099
034200                 20  ASC-ITEM-ARRAY.                              03420099
034300                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03430099
034400                         30  ASC-LIST-ITEM-NUMBER                 03440099
034500                                                     PIC S9(09)   03450099
034600                                                     COMP-3.      03460099
034700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03470099
034800                             88  ASC-VALID-SELECT    VALUE ' '    03480099
034900                                                           'S'    03490099
035000                                                           'B'    03500099
035100                                                           'E'.   03510099
035200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03520099
035300                             88  ASC-TEMP-SELECT     VALUE 'S'.   03530099
035400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03540099
035500                             88  ASC-TEMP-END        VALUE 'E'.   03550099
035600                         30  ASC-SELECTED-SW         PIC  X(01).  03560099
035700                             88  ASC-NO-SELECT       VALUE ' '.   03570099
035800                             88  ASC-SELECT          VALUE 'S'.   03580099
035900                             88  ASC-BEGIN           VALUE 'B'.   03590099
036000                             88  ASC-END             VALUE 'E'.   03600099
036100                         30  ASC-ACTION              PIC  X(03).  03610099
036200                         30  ASC-CSTM-ENTR-ID        PIC  X(12).  03620099
036300                         30  ASC-FILD                PIC  X(05).  03630099
036400                         30  ASC-EXM                 PIC  X(05).  03640099
036500                         30  ASC-REJ                 PIC  X(05).  03650099
036600                         30  ASC-EST-CLRD            PIC  X(05).  03660099
036700                         30  ASC-ACT-CLRD            PIC  X(05).  03670099
036800                         30  ASC-LQDN                PIC  X(05).  03680099
036900                         30  ASC-LQDN-SSPNN          PIC  X(05).  03690099
037000                         30  ASC-PO-CNT              PIC  9(02).  03700099
037100                         30  ASC-CONT-CNT            PIC  9(02).  03710099
037200                         30  ASC-ENT-ID              PIC S9(09)   03720099
037300                                                           COMP.  03730099
037400                         30  ASC-POE                 PIC  X(03).  03740099
037500                         30  ASC-LAST-TRN            PIC  X(05).  03750099
037600                         30  ASC-HISTORY             PIC  X(01).  03760099
037700                                                                  03770099
037800             15  ASC-BLK-SUB                         PIC S9(04)   03780099
037900                                                          COMP    03790099
038000                                                          SYNC.   03800099
038100             15  ASC-ITEM-SUB                        PIC S9(04)   03810099
038200                                                          COMP    03820099
038300                                                          SYNC.   03830099
038400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03840099
038500                                                          COMP-3. 03850099
038600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03860099
038700                                                          COMP-3. 03870099
038800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03880099
038900                                                          COMP-3. 03890099
039000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03900099
039100                                                          COMP-3. 03910099
039200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03920099
039300                                                          COMP-3. 03930099
039400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03940099
039500                                                          COMP    03950099
039600                                                          SYNC.   03960099
039700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03970099
039800                                                          COMP-3. 03980099
039900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03990099
040000                                                          COMP-3. 04000099
040100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04010099
040200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04020099
040300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04030099
040400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04040099
040500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04050099
040600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04060099
040700             15  ASC-LIST-QUEUE-NAME.                             04070099
040800                 20  ASC-LIST-TERM-ID                PIC  X(04).  04080099
040900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04090099
041000                                                          COMP-3. 04100099
041100                 20  ASC-LIST-SEQ                    PIC  9(01).  04110099
041200             15  ASC-SEL-QUEUE-NAME.                              04120099
041300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04130099
041400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04140099
041500                                                          COMP-3. 04150099
041600                 20  ASC-SEL-SEQ                     PIC  9(01).  04160099
041700             15  ASC-CURSOR-SW                       PIC  X(01).  04170099
041800                 88  ASC-CONTNR-CURSOR               VALUE 'C'.   04180099
041900                 88  ASC-VSL-CONTNR-CURSOR           VALUE 'V'.   04190099
042000             15  ASC-START-ITEM-REQUEST.                          04200099
042100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04210099
042200                                                                  04220099
042300 EJECT                                                            04230099
042400*---------------------------------------------------------------* 04240099
042500*    ABEND PROCESSING COPYBOOK.                                 * 04250099
042600*---------------------------------------------------------------* 04260099
042700                                                                  04270099
042800     COPY DPWS013.                                                04280099
042900                                                                  04290099
043000 EJECT                                                            04300099
043100*---------------------------------------------------------------* 04310099
043200*    DB2 AREA FOR TIMCSEN                                       * 04320099
043300*---------------------------------------------------------------* 04330099
043400     EXEC SQL                                                     04340099
043500          INCLUDE TIMCSEN                                         04350099
043600     END-EXEC.                                                    04360099
043700*---------------------------------------------------------------* 04370099
043800*    DB2 AREA FOR TIMCSPO                                       * 04380099
043900*---------------------------------------------------------------* 04390099
044000     EXEC SQL                                                     04400099
044100          INCLUDE TIMCSPO                                         04410099
044200     END-EXEC.                                                    04420099
044300*---------------------------------------------------------------* 04430099
044400*    DB2 AREA FOR TAUCSEN                                       * 04440099
044500*---------------------------------------------------------------* 04450099
044600     EXEC SQL                                                     04460099
044700          INCLUDE TAUCSEN                                         04470099
044800     END-EXEC.                                                    04480099
044900*---------------------------------------------------------------* 04490099
045000*    DB2 AREA FOR TAUCSPO                                       * 04500099
045100*---------------------------------------------------------------* 04510099
045200     EXEC SQL                                                     04520099
045300          INCLUDE TAUCSPO                                         04530099
045400     END-EXEC.                                                    04540099
045500*---------------------------------------------------------------* 04550099
045600*    DB2 AREA FOR TIMCSCN                                       * 04560099
045700*---------------------------------------------------------------* 04570099
045800     EXEC SQL                                                     04580099
045900          INCLUDE TIMCSCN                                         04590099
046000     END-EXEC.                                                    04600099
046100*---------------------------------------------------------------* 04610099
046200*    DB2 AREA FOR TENTNME                                       * 04620099
046300*---------------------------------------------------------------* 04630099
046400     EXEC SQL                                                     04640099
046500          INCLUDE TENTNME                                         04650099
046600     END-EXEC.                                                    04660099
046700*---------------------------------------------------------------* 04670099
046800*    DB2 AREA FOR TEXTENT                                       * 04680099
046900*---------------------------------------------------------------* 04690099
047000     EXEC SQL                                                     04700099
047100          INCLUDE TEXTENT                                         04710099
047200     END-EXEC.                                                    04720099
047300*---------------------------------------------------------------* 04730099
047400*    DB2 AREA FOR TPURCHS                                       * 04740099
047500*---------------------------------------------------------------* 04750099
047600     EXEC SQL                                                     04760099
047700          INCLUDE TPURCHS                                         04770099
047800     END-EXEC.                                                    04780099
047900*---------------------------------------------------------------* 04790099
048000*    DB2 AREA FOR TIMPOE                                        * 04800099
048100*---------------------------------------------------------------* 04810099
048200     EXEC SQL                                                     04820099
048300          INCLUDE TIMPOE                                          04830099
048400     END-EXEC.                                                    04840099
048500*---------------------------------------------------------------* 04850099
048600*    DB2 AREA FOR COMMUNICATIONS                                * 04860099
048700*---------------------------------------------------------------* 04870099
048800     EXEC SQL                                                     04880099
048900          INCLUDE SQLCA                                           04890099
049000     END-EXEC.                                                    04900099
049100*---------------------------------------------------------------* 04910099
049200*    CURSOR FOR CUSTOMS ENTRY LIST BY PO FOR A REQUESTED PO.    * 04920099
049300*---------------------------------------------------------------* 04930099
049400                                                                  04940099
049500     EXEC SQL                                                     04950099
049600          DECLARE ENTRY-CSR CURSOR                                04960099
049700          FOR SELECT DISTINCT                                     04970099
049800                A.CSTM_ENTR_ID                                    04980099
049900              , A.FILD_TMST                                       04990099
050000              , A.EXM_TMST                                        05000099
050100              , A.REJ_TMST                                        05010099
050200              , A.EST_CLR_TMST                                    05020099
050300              , A.ACTL_CLR_TMST                                   05030099
050400              , A.LQDN_TMST                                       05040099
050500              , A.LQDN_SSPNN_TMST                                 05050099
050600              , A.ENT_ID                                          05060099
050700              , A.MOM_DEST_POE_CDE                                05070099
050800              , A.LAST_UPD_TMST                                   05080099
050900          FROM                                                    05090099
051000                TIMCSEN A                                         05100099
051100              , TIMCSPO B                                         05110099
051200          WHERE                                                   05120099
051300                B.PO_NBR         = :DK-PO-NBR                     05130099
051400          AND   B.CSTM_ENTR_ID   =  A.CSTM_ENTR_ID                05140099
051500          ORDER BY                                                05150099
051600                A.CSTM_ENTR_ID                                    05160099
051700     END-EXEC.                                                    05170099
051701                                                                  05170199
051702*---------------------------------------------------------------* 05170299
051703*    CURSOR DECLARATION FOR SELECTING POE CODE.                 * 05170399
051704*---------------------------------------------------------------* 05170499
051705                                                                  05170599
051706     EXEC SQL                                                     05170699
051707          DECLARE  POE-CSR CURSOR                                 05170799
051708              FOR  SELECT DISTINCT                                05170899
051709                   POE_CDE                                        05170999
051710             FROM  TIMPOE                                         05171099
051720            WHERE  POE_STD_EDI_CDE = :IMCSEN-MOM-DEST-POE-CDE     05172099
051730              AND  STAT_CDE        = 'A'                          05173099
051740         ORDER BY  POE_CDE                                        05174099
051750     END-EXEC.                                                    05175099
051751                                                                  05175199
051752 EJECT                                                            05175299
051753*----------------------------------------------------------------*05175399
051754 LINKAGE SECTION.                                                 05175499
051755                                                                  05175599
051756 01  DFHCOMMAREA.                                                 05175699
051757     05  FILLER                         OCCURS  1 TO 4072 TIMES   05175799
051758                                        DEPENDING ON EIBCALEN.    05175899
051759         10  FILLER                     PIC X.                    05175999
051760                                                                  05176099
051770 EJECT                                                            05177099
051780*----------------------------------------------------------------*05178099
051790 PROCEDURE DIVISION.                                              05179099
051800*----------------------------------------------------------------*05180099
051900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *05190099
052000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *05200099
052100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *05210099
052200*----------------------------------------------------------------*05220099
052300 0000-MAIN-MODULE.                                                05230099
052400                                                                  05240099
052500     INITIALIZE DP030-CICS-API-FIELDS.                            05250099
052600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05260099
052700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05270099
052800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05280099
052900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05290099
053000     MOVE LENGTH OF TR171AI        TO DP030-MAP-LENGTH (1).       05300099
053100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05310099
053200     PERFORM 0001-CALL-CICS-ARCH-API.                             05320099
053300*                                                                 05330099
053400     PERFORM 1000-CONTROL-PROCESSING.                             05340099
053500*                                                                 05350099
053600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05360099
053700     PERFORM 0001-CALL-CICS-ARCH-API.                             05370099
053800                                                                  05380099
053900*----------------------------------------------------------------*05390099
054000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *05400099
054100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *05410099
054200*----------------------------------------------------------------*05420099
054300 0001-CALL-CICS-ARCH-API.                                         05430099
054400                                                                  05440099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05450099
054600                                    DFHCOMMAREA                   05460099
054700                                    DP030-CICS-API-FIELDS         05470099
054800                                    DP020-STANDARD-COMMAREA       05480099
054900                                    TR171AI.                      05490099
055000*                                                                 05500099
055100     IF  DP030-RC-CALL-SUCCESSFUL                                 05510099
055200         CONTINUE                                                 05520099
055300     ELSE                                                         05530099
055400         SET DP013-NO-ROLLBACK                                    05540099
055500             DP013-XCTL-DISPLAY-RESTART                           05550099
055600             DP013-CICS-ABEND      TO TRUE                        05560099
055700         MOVE '0001-CALL-CICS-ARCH-API'                           05570099
055800                                   TO DP013-PARAGRAPH             05580099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05590099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05600099
056100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05610099
056200         PERFORM DP013-0000-PROCESS-ABEND                         05620099
056300     END-IF.                                                      05630099
056400                                                                  05640099
056500 EJECT                                                            05650099
056600*----------------------------------------------------------------*05660099
056700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05670099
056800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05680099
056900*                                                                *05690099
057000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05700099
057100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05710099
057200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05720099
057300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05730099
057400*----------------------------------------------------------------*05740099
057500 1000-CONTROL-PROCESSING.                                         05750099
057600                                                                  05760099
057700     EVALUATE TRUE                                                05770099
057800         WHEN DP020-NEXT-ACT-INITIAL                              05780099
057900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05790099
058000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05800099
058100                                      ASC-SEL-TERM-ID             05810099
058200             MOVE DP020-SRC-TASK-NUMBER                           05820099
058300                                   TO ASC-LIST-TASK-NUMBER        05830099
058400                                      ASC-SEL-TASK-NUMBER         05840099
058500             MOVE PC-LIST-QUEUE-SEQ                               05850099
058600                                   TO ASC-LIST-SEQ                05860099
058700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05870099
058800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05880099
058900*-------$TEMPLATE NOTE$------------------------------------------*05890099
059000* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *05900099
059100* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *05910099
059200* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *05920099
059300*----------------------------------------------------------------*05930099
059400             IF  PS-COMMAREA-NOT-VALID                            05940099
059500                 SET DP020-NEXT-ACT-APPL-ERROR                    05950099
059600                                   TO TRUE                        05960099
059700             ELSE                                                 05970099
059800                 PERFORM 4000-BUILD-INITIAL-PANEL                 05980099
059900             END-IF                                               05990099
060000                                                                  06000099
060100         WHEN DP020-NEXT-ACT-READ-MAP                             06010099
060200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06020099
060300                                   TO PV-TOP-ITEM                 06030099
060400             PERFORM 2000-PROCESS-PANEL                           06040099
060500                                                                  06050099
060600         WHEN DP020-NEXT-ACT-RETURN                               06060099
060700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06070099
060800                                   TO PV-TOP-ITEM                 06080099
060900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06090099
061000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06100099
061100             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06110099
061200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06120099
061300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06130099
061400                                                                  06140099
061500         WHEN OTHER                                               06150099
061600             SET DP013-LOGIC-ABEND TO TRUE                        06160099
061700             SET DP013-NO-ROLLBACK TO TRUE                        06170099
061800             MOVE '1000-CONTROL-PROCESSING'                       06180099
061900                                   TO DP013-PARAGRAPH             06190099
062000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06200099
062100                                   TO DP013-MESSAGE-TEXT(1)       06210099
062200             PERFORM DP013-0000-PROCESS-ABEND                     06220099
062300     END-EVALUATE.                                                06230099
062400                                                                  06240099
062500 EJECT                                                            06250099
062600*----------------------------------------------------------------*06260099
062700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06270099
062800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06280099
062900*----------------------------------------------------------------*06290099
063000 1100-PROCESS-INTER-APPL-COMM.                                    06300099
063100                                                                  06310099
063200     SET PS-COMMAREA-VALID         TO TRUE.                       06320099
063300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06330099
063400     IF  DP020-NAV-KEY-DATA > SPACE                               06340099
063500         MOVE DP020-NAV-KEY-DATA                                  06350099
063600                                TO ASC-KEY-PO-NBR                 06360099
063700                                   DK-PO-NBR                      06370099
063800     ELSE                                                         06380099
063900         MOVE TR105-PO-NBR     TO ASC-KEY-PO-NBR                  06390099
064000                                   DK-PO-NBR                      06400099
064100     END-IF.                                                      06410099
064200                                                                  06420099
064300 EJECT                                                            06430099
064400*----------------------------------------------------------------*06440099
064500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *06450099
064600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06460099
064700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06470099
064800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06480099
064900* FUNCTION KEYS CAN GET THIS FAR.                                *06490099
065000*----------------------------------------------------------------*06500099
065100 2000-PROCESS-PANEL.                                              06510099
065200                                                                  06520099
065300     EVALUATE TRUE                                                06530099
065400         WHEN DP020-SRC-AID = DP016-CLEAR                         06540099
065500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06550099
065600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06560099
065700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06570099
065800                                                                  06580099
065900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06590099
066000             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06600099
066100             PERFORM 2050-DELETE-LIST-QUEUE                       06610099
066200             PERFORM 4000-BUILD-INITIAL-PANEL                     06620099
066300                                                                  06630099
066400         WHEN OTHER                                               06640099
066500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06650099
066600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06660099
066700             IF  PS-NO-ERROR                                      06670099
066800                 SET DP030-CONTINUE-GO                            06680099
066900                                 TO TRUE                          06690099
067000                 PERFORM 2100-CHECK-FUNCTION-KEY                  06700099
067100             ELSE                                                 06710099
067200                 SET DP030-OVERRIDE-GO                            06720099
067300                                 TO TRUE                          06730099
067400             END-IF                                               06740099
067500     END-EVALUATE.                                                06750099
067600                                                                  06760099
067700 EJECT                                                            06770099
067800*----------------------------------------------------------------*06780099
067900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06790099
068000*----------------------------------------------------------------*06800099
068100 2050-DELETE-LIST-QUEUE.                                          06810099
068200                                                                  06820099
068300     EXEC CICS                                                    06830099
068400         DELETEQ TS                                               06840099
068500             QUEUE (ASC-LIST-QUEUE-NAME)                          06850099
068600             RESP  (PV-CICS-RESP)                                 06860099
068700     END-EXEC.                                                    06870099
068800                                                                  06880099
068900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06890099
069000        (PV-CICS-RESP = DFHRESP(QIDERR))                          06900099
069100         CONTINUE                                                 06910099
069200     ELSE                                                         06920099
069300         SET DP013-CICS-ABEND      TO TRUE                        06930099
069400         SET DP013-NO-ROLLBACK     TO TRUE                        06940099
069500                                                                  06950099
069600         MOVE '2050-DELETE-LIST-QUEUE'                            06960099
069700                                   TO DP013-PARAGRAPH             06970099
069800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06980099
069900                                   TO DP013-MESSAGE-TEXT (1)      06990099
070000         PERFORM DP013-0000-PROCESS-ABEND                         07000099
070100     END-IF.                                                      07010099
070200                                                                  07020099
070300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07030099
070400                                                                  07040099
070500 EJECT                                                            07050099
070600*----------------------------------------------------------------*07060099
070700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07070099
070800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07080099
070900* CICS ARCHITECTURE API.                                         *07090099
071000*----------------------------------------------------------------*07100099
071100 2100-CHECK-FUNCTION-KEY.                                         07110099
071200                                                                  07120099
071300     EVALUATE TRUE                                                07130099
071400                                                                  07140099
071500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07150099
071600            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                   07160099
071700              INITIALIZE         TR114-INTER-APPL-COMMAREA        07170099
071800              MOVE ASC-KEY-PO-NBR TO TR114-PO-NBR                 07180099
071900              PERFORM 5000-PREPARE-SEL-QUEUE                      07190099
072000            ELSE                                                  07200099
072100              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 07210099
072200                SET DP030-OVERRIDE-GO TO TRUE                     07220099
072300                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         07230099
072400                SET DP020-MSG-WARNING TO TRUE                     07240099
072500              ELSE                                                07250099
072600                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0               07260099
072700                  SET DP030-OVERRIDE-GO TO TRUE                   07270099
072800                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       07280099
072900                  SET DP020-MSG-WARNING TO TRUE                   07290099
073000                END-IF                                            07300099
073100              END-IF                                              07310099
073200            END-IF                                                07320099
073300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07330099
073400*  LIST CUSTOMS BILLS OF LADING                                   07340099
073500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07350099
073600*  LIST CUSTOMS ENTRY CONTAINERS                                  07360099
073700         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              07370099
073800*  LIST CUSTOMS PURCHASE ORDERS                                   07380099
073900         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              07390099
074000*  LIST CUSTOMS ENTRY CHANGE HISTORY                              07400099
074100             EVALUATE TRUE                                        07410099
074200             WHEN ASC-NUMBER-OF-SELECTED-ITEMS = 1                07420099
074300                 INITIALIZE TR114-INTER-APPL-COMMAREA             07430099
074400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07440099
074500                                       TO                         07450099
074600                            TR114-NUMBER-OF-SELECTED-ITEMS        07460099
074700                 MOVE ASC-KEY-PO-NBR   TO TR114-PO-NBR            07470099
074800                 PERFORM 5001-PREPARE-SEL-QUEUE                   07480099
074900             WHEN ASC-NUMBER-OF-SELECTED-ITEMS > 1                07490099
075000                SET DP030-OVERRIDE-GO TO TRUE                     07500099
075100                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         07510099
075200                SET DP020-MSG-WARNING TO TRUE                     07520099
075300             WHEN OTHER                                           07530099
075400                  SET DP030-OVERRIDE-GO TO TRUE                   07540099
075500                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       07550099
075600                  SET DP020-MSG-WARNING TO TRUE                   07560099
075700             END-EVALUATE                                         07570099
075800                                                                  07580099
075900         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              07590099
076000*  LIST CUSTOMS ENTRY DELETE HISTORY                              07600099
076100             EVALUATE TRUE                                        07610099
076200                                                                  07620099
076300             WHEN ASC-NUMBER-OF-SELECTED-ITEMS < 1                07630099
076400                 INITIALIZE TR114-INTER-APPL-COMMAREA             07640099
076500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07650099
076600                                       TO                         07660099
076700                            TR114-NUMBER-OF-SELECTED-ITEMS        07670099
076800                 MOVE ASC-KEY-PO-NBR   TO TR114-PO-NBR            07680099
076900                 PERFORM 5001-PREPARE-SEL-QUEUE                   07690099
077000             WHEN ASC-NUMBER-OF-SELECTED-ITEMS = 1                07700099
077100             WHEN ASC-NUMBER-OF-SELECTED-ITEMS > 1                07710099
077200                SET DP030-OVERRIDE-GO TO TRUE                     07720099
077300                MOVE PC-TSYMSG-00778  TO DP020-MSG-NUMBER         07730099
077400                SET DP020-MSG-WARNING TO TRUE                     07740099
077500             END-EVALUATE                                         07750099
077600                                                                  07760099
077700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07770099
077800             MOVE +1               TO PV-TOP-ITEM                 07780099
077900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   07790099
078000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07800099
078100             PERFORM 3200-RESET-ATTRIBUTES                        07810099
078200                                                                  07820099
078300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07830099
078400             PERFORM 2110-BROWSE-BACKWARD                         07840099
078500             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   07850099
078600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07860099
078700             PERFORM 3200-RESET-ATTRIBUTES                        07870099
078800                                                                  07880099
078900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07890099
079000             PERFORM 2120-BROWSE-FORWARD                          07900099
079100             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   07910099
079200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07920099
079300                                                                  07930099
079400         WHEN DP020-SRC-AID = DP016-ENTER                         07940099
079500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07950099
079600             IF  PS-ERROR                                         07960099
079700                 CONTINUE                                         07970099
079800             ELSE                                                 07980099
079900                 MOVE ASC-KEY-PO-NBR                              07990099
080000                                   TO DK-PO-NBR                   08000099
080100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08010099
080200                 PERFORM 3200-RESET-ATTRIBUTES                    08020099
080300             END-IF                                               08030099
080400                                                                  08040099
080500         WHEN OTHER                                               08050099
080600             SET DP013-NO-ROLLBACK                                08060099
080700                 DP013-XCTL-DISPLAY-RESTART                       08070099
080800                 DP013-CICS-ABEND  TO TRUE                        08080099
080900             MOVE '2100-CHECK-FUNCTION-KEY'                       08090099
081000                                   TO DP013-PARAGRAPH             08100099
081100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08110099
081200                                   TO DP013-MESSAGE-TEXT (1)      08120099
081300             PERFORM DP013-0000-PROCESS-ABEND                     08130099
081400     END-EVALUATE.                                                08140099
081500                                                                  08150099
081600 EJECT                                                            08160099
081700*----------------------------------------------------------------*08170099
081800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08180099
081900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08190099
082000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08200099
082100*    MESSAGE.                                                    *08210099
082200*----------------------------------------------------------------*08220099
082300 2110-BROWSE-BACKWARD.                                            08230099
082400                                                                  08240099
082500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08250099
082600         GIVING PV-TOP-ITEM.                                      08260099
082700*                                                                 08270099
082800     IF  ((PV-TOP-ITEM < +1)                                      08280099
082900       OR (PV-TOP-ITEM = +1))                                     08290099
083000         MOVE +1                   TO PV-TOP-ITEM                 08300099
083100*------- TOP OF LIST -----                                        08310099
083200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08320099
083300         SET DP020-MSG-INFORMATIONAL TO TRUE                      08330099
083400     END-IF.                                                      08340099
083500                                                                  08350099
083600 EJECT                                                            08360099
083700*----------------------------------------------------------------*08370099
083800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08380099
083900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08390099
084000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08400099
084100*----------------------------------------------------------------*08410099
084200 2120-BROWSE-FORWARD.                                             08420099
084300                                                                  08430099
084400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08440099
084500         GIVING PV-TOP-ITEM.                                      08450099
084600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08460099
084700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08470099
084800                                   TO PV-TOP-ITEM                 08480099
084900*------- BOTTOM OF LIST -----------                               08490099
085000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08500099
085100         SET DP020-MSG-INFORMATIONAL                              08510099
085200                                   TO TRUE                        08520099
085300     ELSE                                                         08530099
085400         COMPUTE PV-BOTTOM-ITEM =                                 08540099
085500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08550099
085600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08560099
085700*----------- BOTTOM OF LIST ---------                             08570099
085800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08580099
085900             SET DP020-MSG-INFORMATIONAL                          08590099
086000                                   TO TRUE                        08600099
086100         END-IF                                                   08610099
086200     END-IF.                                                      08620099
086300                                                                  08630099
086400 EJECT                                                            08640099
086500*----------------------------------------------------------------*08650099
086600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08660099
086700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08670099
086800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08680099
086900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08690099
087000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08700099
087100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08710099
087200*----------------------------------------------------------------*08720099
087300 2130-CHECK-FOR-JUMP-BROWSE.                                      08730099
087400                                                                  08740099
087500     SET PS-NO-ERROR               TO TRUE.                       08750099
087600     IF  (ASC-START-ITEM-REQUEST = SPACE)                         08760099
087700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08770099
087800                                   TO PV-TOP-ITEM                 08780099
087900     ELSE                                                         08790099
088000         MOVE ASC-START-ITEM-REQUEST                              08800099
088100                                   TO DP010I-UNEDITED-FIELD       08810099
088200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08820099
088300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08830099
088400         SET DP010I-NEGATIVE-NOT-ALLOWED                          08840099
088500                                   TO TRUE                        08850099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08861099
263697              USING DP010I-NUMERIC-EDIT-AREA                      08862099
088700                                                                  08870099
088800         IF  NOT DP010I-ERROR-DETECTED                            08880099
088900             MOVE DP010I-NUMERIC-FIELD                            08890099
089000                                   TO  ASC-START-ITEM-REQUEST-N   08900099
089100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08910099
089200                 IF  ASC-START-ITEM-REQUEST-N >                   08920099
089300                                          ASC-NUMBER-OF-ITEMS-READ08930099
089400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08940099
089500                     COMPUTE PV-TOP-ITEM =                        08950099
089600                             ASC-NUMBER-OF-ITEMS-READ             08960099
089700                             - PC-ITEMS-PER-PANEL + 1             08970099
089800                     IF  PV-TOP-ITEM < +1                         08980099
089900                         MOVE +1   TO PV-TOP-ITEM                 08990099
090000                         MOVE PC-TSYMSG-00070                     09000099
090100                                   TO DP020-MSG-NUMBER            09010099
090200                         SET DP020-MSG-INFORMATIONAL              09020099
090300                                   TO TRUE                        09030099
090400                     END-IF                                       09040099
090500                 ELSE                                             09050099
090600                     MOVE ASC-START-ITEM-REQUEST-N                09060099
090700                                   TO PV-TOP-ITEM                 09070099
090800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09080099
090900                     COMPUTE PV-BOTTOM-ITEM =                     09090099
091000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09100099
091100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09110099
091200*----------------------- BOTTOM OF LIST --------------            09120099
091300                         MOVE PC-TSYMSG-00070                     09130099
091400                                   TO DP020-MSG-NUMBER            09140099
091500                         SET DP020-MSG-INFORMATIONAL              09150099
091600                                   TO TRUE                        09160099
091700                     END-IF                                       09170099
091800                 END-IF                                           09180099
091900             ELSE                                                 09190099
092000*--------------- VALUE OUT OF RANGE ------------------            09200099
092100                 MOVE PC-TSYMSG-00101                             09210099
092200                                   TO DP020-MSG-NUMBER            09220099
092300                 MOVE -1           TO ASTRTITL                    09230099
092400                 SET DP030-SET-CURSOR-APPL-1                      09240099
092500                                   TO TRUE                        09250099
092600                 MOVE DP015-REVERSE                               09260099
092700                                   TO ASTRTITH                    09270099
092800                 MOVE DP015-RED    TO ASTRTITC                    09280099
092900                 MOVE DP015-UNP-NUM-BRT-MDT                       09290099
093000                                   TO ASTRTITA                    09300099
093100                 SET DP020-MSG-FATAL                              09310099
093200                                   TO TRUE                        09320099
093300                 SET PS-ERROR      TO TRUE                        09330099
093400             END-IF                                               09340099
093500                                                                  09350099
093600         ELSE                                                     09360099
093700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09370099
093800             MOVE -1               TO ASTRTITL                    09380099
093900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09390099
094000             MOVE DP015-REVERSE    TO ASTRTITH                    09400099
094100             MOVE DP015-RED        TO ASTRTITC                    09410099
094200             MOVE DP015-UNP-NUM-BRT-MDT                           09420099
094300                                   TO ASTRTITA                    09430099
094400             SET DP020-MSG-FATAL   TO TRUE                        09440099
094500             SET PS-ERROR          TO TRUE                        09450099
094600         END-IF                                                   09460099
094700     END-IF.                                                      09470099
094800                                                                  09480099
094900 EJECT                                                            09490099
095000*----------------------------------------------------------------*09500099
095100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09510099
095200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09520099
095300*----------------------------------------------------------------*09530099
095400 2140-DESELECT-ALL-ITEMS.                                         09540099
095500                                                                  09550099
095600     MOVE +1                       TO ASC-BLK-SUB.                09560099
095700                                                                  09570099
095800     PERFORM 2141-CLEAR-SELECTED-INDS                             09580099
095900         VARYING ASC-ITEM-SUB                                     09590099
096000         FROM 1 BY 1                                              09600099
096100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09610099
096200                                                                  09620099
096300     ADD +1                        TO ASC-BLK-SUB.                09630099
096400                                                                  09640099
096500     PERFORM 2141-CLEAR-SELECTED-INDS                             09650099
096600         VARYING ASC-ITEM-SUB                                     09660099
096700         FROM 1 BY 1                                              09670099
096800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09680099
096900                                                                  09690099
097000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09700099
097100                                   TO PV-LIST-ITEM-NUMBER.        09710099
097200                                                                  09720099
097300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09730099
097400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09740099
097500                                                                  09750099
097600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09760099
097700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09770099
097800         MOVE +1                   TO ASC-BLK-SUB                 09780099
097900                                                                  09790099
098000         PERFORM 5100-WRITE-TEMP-STORAGE                          09800099
098100                                                                  09810099
098200         MOVE +1                   TO PV-BLOCK-NUMBER             09820099
098300                                                                  09830099
098400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09840099
098500             PV-FIRST-BLOCK-IN-ARRAY - 1                          09850099
098600                                                                  09860099
098700         PERFORM                                                  09870099
098800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09880099
098900                                                                  09890099
099000             PERFORM 4410-READ-TEMP-STORAGE                       09900099
099100                                                                  09910099
099200             PERFORM 2141-CLEAR-SELECTED-INDS                     09920099
099300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09930099
099400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09940099
099500                                                                  09950099
099600             PERFORM 5100-WRITE-TEMP-STORAGE                      09960099
099700                                                                  09970099
099800             ADD +1                TO PV-BLOCK-NUMBER             09980099
099900                                                                  09990099
100000         END-PERFORM                                              10000099
100100                                                                  10010099
100200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10020099
100300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10030099
100400                                                                  10040099
100500         PERFORM                                                  10050099
100600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10060099
100700                   ASC-HIGHEST-BLOCK-WRITTEN                      10070099
100800                                                                  10080099
100900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10090099
101000                                   TO PV-BLOCK-NUMBER             10100099
101100                                                                  10110099
101200             PERFORM 4410-READ-TEMP-STORAGE                       10120099
101300                                                                  10130099
101400             PERFORM 2141-CLEAR-SELECTED-INDS                     10140099
101500                 VARYING ASC-ITEM-SUB                             10150099
101600                 FROM 1 BY 1                                      10160099
101700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10170099
101800                                                                  10180099
101900             PERFORM 5100-WRITE-TEMP-STORAGE                      10190099
102000                                                                  10200099
102100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10210099
102200                                                                  10220099
102300         END-PERFORM                                              10230099
102400                                                                  10240099
102500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10250099
102600                                   TO PV-BLOCK-NUMBER             10260099
102700                                                                  10270099
102800         PERFORM 4410-READ-TEMP-STORAGE                           10280099
102900     END-IF.                                                      10290099
103000                                                                  10300099
103100     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10310099
103200                                      ASC-START-OF-SELECTED-RANGE 10320099
103300                                      ASC-END-OF-SELECTED-RANGE.  10330099
103400                                                                  10340099
103500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10350099
103600                                                                  10360099
103700 EJECT                                                            10370099
103800*----------------------------------------------------------------*10380099
103900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10390099
104000*----------------------------------------------------------------*10400099
104100 2141-CLEAR-SELECTED-INDS.                                        10410099
104200                                                                  10420099
104300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10430099
104400             NOT EQUAL ZERO                                       10440099
104500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10450099
104600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10460099
104700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10470099
104800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10480099
104900                                   TO TRUE                        10490099
105000         END-IF                                                   10500099
105100     END-IF.                                                      10510099
105200                                                                  10520099
105300 EJECT                                                            10530099
105400*----------------------------------------------------------------*10540099
105500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10550099
105600*  FOR ALL ITEMS.                                                *10560099
105700*----------------------------------------------------------------*10570099
105800 2150-SELECT-ALL-ITEMS.                                           10580099
105900                                                                  10590099
106000     MOVE +1                       TO ASC-BLK-SUB.                10600099
106100                                                                  10610099
106200     PERFORM 2151-SET-SELECTED-INDS                               10620099
106300         VARYING ASC-ITEM-SUB                                     10630099
106400         FROM 1 BY 1                                              10640099
106500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10650099
106600                                                                  10660099
106700     ADD +1                        TO ASC-BLK-SUB.                10670099
106800                                                                  10680099
106900     PERFORM 2151-SET-SELECTED-INDS                               10690099
107000         VARYING ASC-ITEM-SUB                                     10700099
107100         FROM 1 BY 1                                              10710099
107200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10720099
107300                                                                  10730099
107400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10740099
107500                                   TO PV-LIST-ITEM-NUMBER.        10750099
107600                                                                  10760099
107700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10770099
107800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10780099
107900                                                                  10790099
108000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10800099
108100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10810099
108200         MOVE +1                   TO ASC-BLK-SUB                 10820099
108300                                                                  10830099
108400         PERFORM 5100-WRITE-TEMP-STORAGE                          10840099
108500                                                                  10850099
108600         MOVE +1                   TO PV-BLOCK-NUMBER             10860099
108700                                                                  10870099
108800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10880099
108900             PV-FIRST-BLOCK-IN-ARRAY - 1                          10890099
109000                                                                  10900099
109100         PERFORM                                                  10910099
109200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10920099
109300                                                                  10930099
109400             PERFORM 4410-READ-TEMP-STORAGE                       10940099
109500                                                                  10950099
109600             PERFORM 2151-SET-SELECTED-INDS                       10960099
109700                 VARYING ASC-ITEM-SUB                             10970099
109800                 FROM 1 BY 1                                      10980099
109900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10990099
110000                                                                  11000099
110100             PERFORM 5100-WRITE-TEMP-STORAGE                      11010099
110200                                                                  11020099
110300             ADD +1                TO PV-BLOCK-NUMBER             11030099
110400                                                                  11040099
110500         END-PERFORM                                              11050099
110600                                                                  11060099
110700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11070099
110800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11080099
110900                                                                  11090099
111000         PERFORM                                                  11100099
111100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11110099
111200                   ASC-HIGHEST-BLOCK-WRITTEN                      11120099
111300                                                                  11130099
111400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11140099
111500                                   TO PV-BLOCK-NUMBER             11150099
111600                                                                  11160099
111700             PERFORM 4410-READ-TEMP-STORAGE                       11170099
111800                                                                  11180099
111900             PERFORM 2151-SET-SELECTED-INDS                       11190099
112000                 VARYING ASC-ITEM-SUB                             11200099
112100                 FROM 1 BY 1                                      11210099
112200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11220099
112300                                                                  11230099
112400             PERFORM 5100-WRITE-TEMP-STORAGE                      11240099
112500                                                                  11250099
112600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11260099
112700                                                                  11270099
112800         END-PERFORM                                              11280099
112900                                                                  11290099
113000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11300099
113100                                   TO PV-BLOCK-NUMBER             11310099
113200                                                                  11320099
113300         PERFORM 4410-READ-TEMP-STORAGE                           11330099
113400     END-IF.                                                      11340099
113500                                                                  11350099
113600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11360099
113700                       ASC-NUMBER-OF-SELECTED-ITEMS.              11370099
113800                                                                  11380099
113900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11390099
114000                                                                  11400099
114100 EJECT                                                            11410099
114200*----------------------------------------------------------------*11420099
114300*    MARK EACH ITEM AS BEING SELECTED.                           *11430099
114400*----------------------------------------------------------------*11440099
114500 2151-SET-SELECTED-INDS.                                          11450099
114600                                                                  11460099
114700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11470099
114800             NOT EQUAL ZERO                                       11480099
114900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11490099
115000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11500099
115100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11510099
115200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11520099
115300                               TO  TRUE                           11530099
115400         END-IF                                                   11540099
115500     END-IF.                                                      11550099
115600                                                                  11560099
115700 EJECT                                                            11570099
115800*----------------------------------------------------------------*11580099
115900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *11590099
116000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *11600099
116100*----------------------------------------------------------------*11610099
116200 2200-MOVE-SCREEN-TO-COMMAREA.                                    11620099
116300                                                                  11630099
116400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11640099
116500     MOVE +1                       TO PV-SUB.                     11650099
116600*                                                                 11660099
116700     PERFORM 3100-SET-SUBSCRIPTS.                                 11670099
116800     IF  ASTRTITL > ZERO                                          11680099
116900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11690099
117000     ELSE                                                         11700099
117100         IF  ASTRTITF = DP015-ERASE-EOF                           11710099
117200             INITIALIZE ASC-START-ITEM-REQUEST                    11720099
117300         END-IF                                                   11730099
117400     END-IF.                                                      11740099
117500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11750099
117600         VARYING PV-SUB                                           11760099
117700         FROM 1 BY 1                                              11770099
117800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11780099
117900                                                                  11790099
118000 EJECT                                                            11800099
118100*----------------------------------------------------------------*11810099
118200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11820099
118300*----------------------------------------------------------------*11830099
118400 2210-MOVE-LINES-TO-COMMAREA.                                     11840099
118500                                                                  11850099
118600     IF  MR-SELECTL (PV-SUB) > ZERO                               11860099
118700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11870099
118800         MOVE MR-SELECTI (PV-SUB)                                 11880099
118900                                   TO ASC-TEMP-SELECTED-SW        11890099
119000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11900099
119100     ELSE                                                         11910099
119200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11920099
119300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11930099
119400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11940099
119500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11950099
119600         END-IF                                                   11960099
119700     END-IF.                                                      11970099
119800     ADD +1                        TO ASC-ITEM-SUB.               11980099
119900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11990099
120000         ADD  +1                   TO ASC-BLK-SUB                 12000099
120100         MOVE +1                   TO ASC-ITEM-SUB                12010099
120200     END-IF.                                                      12020099
120300                                                                  12030099
120400 EJECT                                                            12040099
120500*----------------------------------------------------------------*12050099
120600*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12060099
120700*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12070099
120800*----------------------------------------------------------------*12080099
120900 3000-EDIT-DATA-IN-COMMAREA.                                      12090099
121000                                                                  12100099
121100     SET PS-NO-ERROR               TO TRUE.                       12110099
121200     PERFORM 3200-RESET-ATTRIBUTES.                               12120099
121300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12130099
121400*----------------------------------------------------------------*12140099
121500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *12150099
121600* EDITTING IS DONE FROM THE BOTTOM UP.                           *12160099
121700*----------------------------------------------------------------*12170099
121800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12180099
121900         ASC-ITEMS-DISPLAYED - 1.                                 12190099
122000     PERFORM 3100-SET-SUBSCRIPTS.                                 12200099
122100     PERFORM 3300-EDIT-SELECTIONS                                 12210099
122200         VARYING PV-SUB                                           12220099
122300         FROM PV-SUB BY -1                                        12230099
122400         UNTIL PV-SUB < +1.                                       12240099
122500*                                                                 12250099
122600     IF  PS-NO-ERROR                                              12260099
122700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12270099
122800     END-IF.                                                      12280099
122900*                                                                 12290099
123000     IF  ((PS-NO-ERROR)                                           12300099
123100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12310099
123200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12320099
123300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12330099
123400     END-IF.                                                      12340099
123500                                                                  12350099
123600 EJECT                                                            12360099
123700*----------------------------------------------------------------*12370099
123800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12380099
123900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *12390099
124000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12400099
124100*                                                                *12410099
124200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12420099
124300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12430099
124400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12440099
124500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12450099
124600*----------------------------------------------------------------*12460099
124700 3100-SET-SUBSCRIPTS.                                             12470099
124800                                                                  12480099
124900     COMPUTE ASC-ITEM-SUB =                                       12490099
125000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12500099
125100                                                                  12510099
125200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12520099
125300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12530099
125400                                                                  12540099
125500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12550099
125600     ELSE                                                         12560099
125700         MOVE +1                     TO ASC-BLK-SUB               12570099
125800     END-IF.                                                      12580099
125900                                                                  12590099
126000 EJECT                                                            12600099
126100*----------------------------------------------------------------*12610099
126200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *12620099
126300*----------------------------------------------------------------*12630099
126400  3200-RESET-ATTRIBUTES.                                          12640099
126500                                                                  12650099
126600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12660099
126700     MOVE DP015-GREEN              TO ASTRTITC.                   12670099
126800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12680099
126900                                                                  12690099
127000     PERFORM                                                      12700099
127100         VARYING PV-SUB                                           12710099
127200         FROM 1 BY 1                                              12720099
127300         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   12730099
127400                         ASC-ITEMS-DISPLAYED)                     12740099
127500         MOVE DP015-UNP-ALP-NOR-OFF                               12750099
127600                                   TO MR-SELECTA (PV-SUB)         12760099
127700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12770099
127800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12780099
127900     END-PERFORM.                                                 12790099
128000                                                                  12800099
128100 EJECT                                                            12810099
128200*----------------------------------------------------------------*12820099
128300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *12830099
128400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *12840099
128500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *12850099
128600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *12860099
128700*----------------------------------------------------------------*12870099
128800 3300-EDIT-SELECTIONS.                                            12880099
128900                                                                  12890099
129000     EVALUATE TRUE                                                12900099
129100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12910099
129200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12920099
129300                 CONTINUE                                         12930099
129400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12940099
129500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12950099
129600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12960099
129700                 MOVE ASC-TEMP-SELECTED-SW                        12970099
129800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12980099
129900                                TO ASC-SELECTED-SW                12990099
130000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13000099
130100             END-IF                                               13010099
130200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13020099
130300                                = SPACE                           13030099
130400             EVALUATE TRUE                                        13040099
130500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13050099
130600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13060099
130700                     MOVE SPACE TO ASC-SELECTED-SW                13070099
130800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13080099
130900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13090099
131000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13100099
131100                     MOVE SPACE TO ASC-SELECTED-SW                13110099
131200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13120099
131300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13130099
131400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13140099
131500                     MOVE SPACE TO ASC-SELECTED-SW                13150099
131600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13160099
131700             END-EVALUATE                                         13170099
131800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13180099
131900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13190099
132000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13200099
132100             END-IF                                               13210099
132200             PERFORM 3310-EDIT-RANGE                              13220099
132300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13230099
132400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13240099
132500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13250099
132600             END-IF                                               13260099
132700             PERFORM 3310-EDIT-RANGE                              13270099
132800         WHEN OTHER                                               13280099
132900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13290099
133000             SET DP020-MSG-FATAL    TO TRUE                       13300099
133100             MOVE -1                TO MR-SELECTL (PV-SUB)        13310099
133200             SET DP030-SET-CURSOR-APPL-1                          13320099
133300                                    TO TRUE                       13330099
133400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13340099
133500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13350099
133600             SET PS-ERROR TO TRUE                                 13360099
133700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13370099
133800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13380099
133900                 MOVE SPACE         TO ASC-SELECTED-SW            13390099
134000                                        (ASC-BLK-SUB ASC-ITEM-SUB)13400099
134100             END-IF                                               13410099
134200     END-EVALUATE.                                                13420099
134300                                                                  13430099
134400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13440099
134500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13450099
134600     IF  ASC-ITEM-SUB < 1                                         13460099
134700         SUBTRACT +1 FROM ASC-BLK-SUB                             13470099
134800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13480099
134900     END-IF.                                                      13490099
135000                                                                  13500099
135100 EJECT                                                            13510099
135200*----------------------------------------------------------------*13520099
135300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *13530099
135400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *13540099
135500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *13550099
135600*  THE ENDING.                                                   *13560099
135700*----------------------------------------------------------------*13570099
135800 3310-EDIT-RANGE.                                                 13580099
135900                                                                  13590099
136000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13600099
136100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13610099
136200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13620099
136300                                   TO ASC-SELECTED-SW             13630099
136400                                        (ASC-BLK-SUB ASC-ITEM-SUB)13640099
136500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13650099
136600         ELSE                                                     13660099
136700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13670099
136800                 CONTINUE                                         13680099
136900             ELSE                                                 13690099
137000*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          13700099
137100                 MOVE PC-TSYMSG-00054                             13710099
137200                                   TO DP020-MSG-NUMBER            13720099
137300                 SET DP020-MSG-FATAL                              13730099
137400                                   TO TRUE                        13740099
137500                 MOVE -1           TO MR-SELECTL (PV-SUB)         13750099
137600                 SET DP030-SET-CURSOR-APPL-1                      13760099
137700                                   TO TRUE                        13770099
137800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13780099
137900                 MOVE DP015-UNDERLINE                             13790099
138000                                   TO MR-SELECTH (PV-SUB)         13800099
138100                 SET PS-ERROR      TO TRUE                        13810099
138200             END-IF                                               13820099
138300         END-IF                                                   13830099
138400     ELSE                                                         13840099
138500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13850099
138600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13860099
138700                                   TO ASC-SELECTED-SW             13870099
138800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13880099
138900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13890099
139000         ELSE                                                     13900099
139100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13910099
139200                 CONTINUE                                         13920099
139300             ELSE                                                 13930099
139400*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            13940099
139500                 MOVE PC-TSYMSG-00055                             13950099
139600                                   TO DP020-MSG-NUMBER            13960099
139700                 SET DP020-MSG-FATAL                              13970099
139800                                   TO TRUE                        13980099
139900                 MOVE -1           TO MR-SELECTL (PV-SUB)         13990099
140000                 SET DP030-SET-CURSOR-APPL-1                      14000099
140100                                   TO TRUE                        14010099
140200                 SET PS-ERROR      TO TRUE                        14020099
140300             END-IF                                               14030099
140400         END-IF                                                   14040099
140500     END-IF.                                                      14050099
140600                                                                  14060099
140700 EJECT                                                            14070099
140800*----------------------------------------------------------------*14080099
140900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14090099
141000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14100099
141100*----------------------------------------------------------------*14110099
141200 3400-CHECK-RANGE-SEQUENCE.                                       14120099
141300                                                                  14130099
141400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14140099
141500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14150099
141600       AND  ASC-START-OF-SELECTED-RANGE >                         14160099
141700                                         ASC-END-OF-SELECTED-RANGE14170099
141800*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                14180099
141900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14190099
142000         SET DP020-MSG-FATAL TO TRUE                              14200099
142100         SET PS-ERROR TO TRUE                                     14210099
142200         PERFORM 3410-POSITION-AT-ERROR                           14220099
142300     END-IF.                                                      14230099
142400                                                                  14240099
142500 EJECT                                                            14250099
142600*----------------------------------------------------------------*14260099
142700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *14270099
142800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *14280099
142900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *14290099
143000*----------------------------------------------------------------*14300099
143100 3410-POSITION-AT-ERROR.                                          14310099
143200                                                                  14320099
143300     SET DP030-SET-CURSOR-APPL-1                                  14330099
143400                                   TO TRUE.                       14340099
143500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14350099
143600                    - PV-TOP-ITEM + 1.                            14360099
143700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14370099
143800         CONTINUE                                                 14380099
143900     ELSE                                                         14390099
144000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14400099
144100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14410099
144200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14420099
144300     END-IF.                                                      14430099
144400*                                                                 14440099
144500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14450099
144600                    - PV-TOP-ITEM + 1.                            14460099
144700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14470099
144800         CONTINUE                                                 14480099
144900     ELSE                                                         14490099
145000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14500099
145100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14510099
145200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14520099
145300     END-IF.                                                      14530099
145400                                                                  14540099
145500 EJECT                                                            14550099
145600*----------------------------------------------------------------*14560099
145700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14570099
145800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14580099
145900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14590099
146000*----------------------------------------------------------------*14600099
146100 3500-MARK-RANGE-AS-SELECTED.                                     14610099
146200                                                                  14620099
146300     MOVE +1                       TO  ASC-BLK-SUB.               14630099
146400     PERFORM 3510-MARK-SELECTED-INDS                              14640099
146500         VARYING ASC-ITEM-SUB                                     14650099
146600         FROM 1 BY 1                                              14660099
146700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14670099
146800                                                                  14680099
146900     ADD +1                        TO ASC-BLK-SUB.                14690099
147000     PERFORM 3510-MARK-SELECTED-INDS                              14700099
147100         VARYING ASC-ITEM-SUB                                     14710099
147200         FROM 1 BY 1                                              14720099
147300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14730099
147400                                                                  14740099
147500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14750099
147600                                   TO  PV-LIST-ITEM-NUMBER.       14760099
147700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14770099
147800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14780099
147900               PC-ITEMS-PER-PANEL).                               14790099
148000                                                                  14800099
148100     MOVE ASC-START-OF-SELECTED-RANGE                             14810099
148200                                   TO PV-START-OF-SELECTED-RANGE. 14820099
148300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14830099
148400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14840099
148500               PC-ITEMS-PER-PANEL).                               14850099
148600                                                                  14860099
148700     MOVE ASC-END-OF-SELECTED-RANGE                               14870099
148800                                   TO  PV-END-OF-SELECTED-RANGE.  14880099
148900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14890099
149000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14900099
149100               PC-ITEMS-PER-PANEL).                               14910099
149200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14920099
149300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14930099
149400                                                                  14940099
149500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14950099
149600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14960099
149700         MOVE +1                   TO ASC-BLK-SUB                 14970099
149800         PERFORM 5100-WRITE-TEMP-STORAGE                          14980099
149900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14990099
150000             PV-FIRST-BLOCK-IN-ARRAY - 1                          15000099
150100                                                                  15010099
150200         PERFORM                                                  15020099
150300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15030099
150400                   PV-PREV-BLOCK-IN-ARRAY                         15040099
150500             MOVE PV-FIRST-BLOCK-IN-RANGE                         15050099
150600                                   TO PV-BLOCK-NUMBER             15060099
150700             PERFORM 4410-READ-TEMP-STORAGE                       15070099
150800             PERFORM 3510-MARK-SELECTED-INDS                      15080099
150900                 VARYING ASC-ITEM-SUB                             15090099
151000                 FROM 1 BY 1                                      15100099
151100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15110099
151200             PERFORM 5100-WRITE-TEMP-STORAGE                      15120099
151300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15130099
151400         END-PERFORM                                              15140099
151500                                                                  15150099
151600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15160099
151700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15170099
151800         PERFORM                                                  15180099
151900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15190099
152000                   PV-LAST-BLOCK-IN-RANGE                         15200099
152100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15210099
152200                                   TO PV-BLOCK-NUMBER             15220099
152300             PERFORM 4410-READ-TEMP-STORAGE                       15230099
152400             PERFORM 3510-MARK-SELECTED-INDS                      15240099
152500                 VARYING ASC-ITEM-SUB                             15250099
152600                 FROM 1 BY 1                                      15260099
152700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15270099
152800             PERFORM 5100-WRITE-TEMP-STORAGE                      15280099
152900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15290099
153000         END-PERFORM                                              15300099
153100                                                                  15310099
153200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15320099
153300                                   TO PV-BLOCK-NUMBER             15330099
153400         PERFORM 4410-READ-TEMP-STORAGE                           15340099
153500     END-IF.                                                      15350099
153600                                                                  15360099
153700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15370099
153800                                      ASC-END-OF-SELECTED-RANGE.  15380099
153900                                                                  15390099
154000 EJECT                                                            15400099
154100*----------------------------------------------------------------*15410099
154200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15420099
154300*----------------------------------------------------------------*15430099
154400 3510-MARK-SELECTED-INDS.                                         15440099
154500                                                                  15450099
154600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15460099
154700                                ASC-ITEM-SUB) >                   15470099
154800         ASC-START-OF-SELECTED-RANGE)                             15480099
154900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15490099
155000                                ASC-ITEM-SUB) =                   15500099
155100         ASC-START-OF-SELECTED-RANGE)                             15510099
155200                                                                  15520099
155300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15530099
155400                                    ASC-ITEM-SUB) <               15540099
155500             ASC-END-OF-SELECTED-RANGE)                           15550099
155600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15560099
155700                                    ASC-ITEM-SUB) =               15570099
155800             ASC-END-OF-SELECTED-RANGE)                           15580099
155900                                                                  15590099
156000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15600099
156100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15610099
156200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15620099
156300                               TO TRUE                            15630099
156400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15640099
156500                               TO TRUE                            15650099
156600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15660099
156700             END-IF                                               15670099
156800         END-IF                                                   15680099
156900     END-IF.                                                      15690099
157000                                                                  15700099
157100 EJECT                                                            15710099
157200*----------------------------------------------------------------*15720099
157300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15730099
157400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15740099
157500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15750099
157600*    DISPLAY THE PANEL TO USER.                                  *15760099
157700*----------------------------------------------------------------*15770099
157800 4000-BUILD-INITIAL-PANEL.                                        15780099
157900                                                                  15790099
158000     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             15800099
158100                                ASC-BLOCK-ENTRIES (2).            15810099
158200     MOVE +1                 TO ASC-BLK-SUB.                      15820099
158300     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        15830099
158400     SET ASC-ITEMS-LEFT-ON-DB                                     15840099
158500                             TO TRUE.                             15850099
158600                                                                  15860099
158700     MOVE +0                 TO ASC-ITEM-SUB                      15870099
158800                                ASC-NUMBER-OF-ITEMS-READ          15880099
158900                                ASC-NUMBER-OF-SELECTED-ITEMS      15890099
159000                                ASC-HIGHEST-BLOCK-WRITTEN         15900099
159100                                ASC-START-OF-SELECTED-RANGE       15910099
159200                                ASC-END-OF-SELECTED-RANGE         15920099
159300                                ASC-ITEM-AT-TOP-OF-PANEL.         15930099
159400     PERFORM 4010-OPEN-CURSOR.                                    15940099
159500                                                                  15950099
159600     PERFORM 4300-READ-ITEMS-FROM-DB.                             15960099
159700                                                                  15970099
159800     PERFORM 4020-CLOSE-CURSOR.                                   15980099
159900                                                                  15990099
159901* DMH - 2018-06-27 - BEGIN                                        15990199
159910     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15991099
159920         SET DP020-NEXT-ACT-APPL-ERROR                            15992099
159930                                   TO TRUE                        15993099
159940         SET DP020-MSG-FATAL       TO TRUE                        15994099
159950         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            15995099
159960     ELSE                                                         15996099
159970* DMH - 2018-06-27 - END                                          15997099
160000         MOVE +1                   TO PV-TOP-ITEM                 16000099
160100         MOVE -1                   TO MR-SELECTL (1)              16010099
160200         SET DP030-SET-CURSOR-APPL-1                              16020099
160300                                   TO TRUE                        16030099
160400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16040099
160410     END-IF.                                                      16041099
160500                                                                  16050099
160600 EJECT                                                            16060099
160700*----------------------------------------------------------------*16070099
160800*   OPEN THE ENTRY CURSOR                                        *16080099
160900*----------------------------------------------------------------*16090099
161000 4010-OPEN-CURSOR.                                                16100099
161100                                                                  16110099
161200     PERFORM                                                      16120099
161300         WITH TEST AFTER                                          16130099
161400         VARYING PV-RETRY-COUNTER                                 16140099
161500         FROM 1 BY 1                                              16150099
161600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16160099
161700             OR (SQLCODE = ZERO))                                 16170099
161800                                                                  16180099
161900         MOVE 'CURSOR:  ENTRY-CSR'                                16190099
162000                        TO DP013-MESSAGE-TEXT (2)                 16200099
162100         EXEC SQL                                                 16210099
162200                  OPEN ENTRY-CSR                                  16220099
162300         END-EXEC                                                 16230099
162400                                                                  16240099
162500*                                                                 16250099
162600         EVALUATE TRUE                                            16260099
162700             WHEN SQLCODE = ZERO                                  16270099
162800             WHEN SQLCODE = -904                                  16280099
162900             WHEN SQLCODE = -913                                  16290099
163000                 CONTINUE                                         16300099
163100             WHEN SQLWARN0 NOT = SPACES                           16310099
163200             WHEN SQLCODE < ZERO                                  16320099
163300             WHEN SQLCODE > ZERO                                  16330099
163400                 MOVE '4010-OPEN-CURSOR'                          16340099
163500                                   TO DP013-PARAGRAPH             16350099
163600                 MOVE 'OPEN ENTRY CURSOR - '                      16360099
163700                                   TO DP013-MESSAGE-TEXT (1)      16370099
163800                 MOVE SQLCA        TO DP013-SQLCA                 16380099
163900                 MOVE 'TIMCSPO '   TO DP013-DB2-TABLE-NAME (1)    16390099
164000                 SET DP013-DB2-ABEND                              16400099
164100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16410099
164200                 PERFORM DP013-0000-PROCESS-ABEND                 16420099
164300         END-EVALUATE                                             16430099
164400     END-PERFORM.                                                 16440099
164500*                                                                 16450099
164600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16460099
164700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16470099
164800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16480099
164900                                   TO DP013-MESSAGE-TEXT (1)      16490099
165000         MOVE SQLCA                TO DP013-SQLCA                 16500099
165100         MOVE 'TIMCSPO '           TO DP013-DB2-TABLE-NAME (1)    16510099
165200         SET DP013-DB2-ABEND                                      16520099
165300             DP013-XCTL-DISPLAY-RESTART                           16530099
165400                                   TO TRUE                        16540099
165500         PERFORM DP013-0000-PROCESS-ABEND                         16550099
165600     END-IF.                                                      16560099
165700                                                                  16570099
165800 EJECT                                                            16580099
165900*----------------------------------------------------------------*16590099
166000*   CLOSE THE ENTRY CURSOR                                       *16600099
166100*----------------------------------------------------------------*16610099
166200 4020-CLOSE-CURSOR.                                               16620099
166300                                                                  16630099
166400     EXEC SQL                                                     16640099
166500          CLOSE ENTRY-CSR                                         16650099
166600     END-EXEC                                                     16660099
166700                                                                  16670099
166800*                                                                 16680099
166900     EVALUATE TRUE                                                16690099
167000         WHEN SQLCODE = ZERO                                      16700099
167100             CONTINUE                                             16710099
167200         WHEN SQLWARN0 NOT = SPACES                               16720099
167300         WHEN SQLCODE < ZERO                                      16730099
167400         WHEN SQLCODE > ZERO                                      16740099
167500             MOVE '4020-CLOSE-CURSOR'                             16750099
167600                               TO DP013-PARAGRAPH                 16760099
167700             MOVE 'CLOSE ENTRY CURSOR '                           16770099
167800                               TO DP013-MESSAGE-TEXT (1)          16780099
167900             MOVE SQLCA        TO DP013-SQLCA                     16790099
168000             MOVE 'TIMCSPO '   TO DP013-DB2-TABLE-NAME (1)        16800099
168100             SET DP013-DB2-ABEND                                  16810099
168200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16820099
168300             PERFORM DP013-0000-PROCESS-ABEND                     16830099
168400     END-EVALUATE.                                                16840099
168500                                                                  16850099
168600 EJECT                                                            16860099
168700*----------------------------------------------------------------*16870099
168800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16880099
168900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16890099
169000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16900099
169100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16910099
169200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16920099
169300*                                                                *16930099
169400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16940099
169500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16950099
169600*    UPON INITIALIZATION.                                        *16960099
169700*----------------------------------------------------------------*16970099
169800 4300-READ-ITEMS-FROM-DB.                                         16980099
169900                                                                  16990099
170000     PERFORM                                                      17000099
170100         VARYING PV-READ-COUNT                                    17010099
170200         FROM 1 BY 1                                              17020099
170300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17030099
170400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17040099
170500                                                                  17050099
170600         PERFORM 4310-FETCH                                       17060099
170700                                                                  17070099
170800         IF  ASC-ITEMS-LEFT-ON-DB                                 17080099
170900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17090099
171000                 ADD +1            TO ASC-ITEM-SUB                17100099
171100             ELSE                                                 17110099
171200                 ADD +1            TO ASC-BLK-SUB                 17120099
171300                 MOVE +1           TO ASC-ITEM-SUB                17130099
171400                                                                  17140099
171500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17150099
171600                     MOVE +1       TO ASC-BLK-SUB                 17160099
171700                     SET ASC-BLOCK-MODIFIED (1)                   17170099
171800                                   TO TRUE                        17180099
171900                     PERFORM 5100-WRITE-TEMP-STORAGE              17190099
172000                     MOVE ASC-BLOCK-ENTRIES                       17200099
172100                               (PC-MAX-BLOCKS-IN-ARRAY)           17210099
172200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17220099
172300                     ADD +1        TO ASC-BLK-SUB                 17230099
172400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17240099
172500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17250099
172600                                   TO  TRUE                       17260099
172700                 END-IF                                           17270099
172800             END-IF                                               17280099
172900             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   17290099
173000             MOVE ASC-NUMBER-OF-ITEMS-READ                        17300099
173100                                   TO  ASC-LIST-ITEM-NUMBER       17310099
173200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17320099
173300             MOVE IMCSEN-CSTM-ENTR-ID TO  ASC-CSTM-ENTR-ID        17330099
173400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17340099
173500             MOVE IMCSEN-ENT-ID       TO  ASC-ENT-ID              17350099
173600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17360099
173700                                                                  17370099
173800             IF IMCSEN-MOM-DEST-POE-CDE EQUAL ZEROES OR SPACES    17380099
173900                 MOVE SPACES            TO ASC-POE                17390099
174000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17400099
174100             ELSE                                                 17410099
174200                 IF IMCSEN-MOM-DEST-POE-CDE NUMERIC               17420099
174300                     PERFORM 4315-OPEN-POE-CURSOR                 17430099
174400                     PERFORM 4325-FETCH-POE-CURSOR                17440099
174500                     PERFORM 4320-CLOSE-POE-CURSOR                17450099
174600                     MOVE IMPOE-POE-CDE       TO  ASC-POE         17460099
174700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17470099
174800                 ELSE                                             17480099
174900                     MOVE IMCSEN-MOM-DEST-POE-CDE TO ASC-POE      17490099
175000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17500099
175100                 END-IF                                           17510099
175200             END-IF                                               17520099
175300                                                                  17530099
175400             PERFORM 4330-FORMAT-FILD-DTE                         17540099
175500             PERFORM 4340-FORMAT-EXM-DTE                          17550099
175600             PERFORM 4350-FORMAT-REJ-DTE                          17560099
175700             PERFORM 4355-FORMAT-EST-CLR-DTE                      17570099
175800             PERFORM 4360-FORMAT-ACT-CLR-DTE                      17580099
175900             PERFORM 4370-FORMAT-LQDN-DTE                         17590099
176000             PERFORM 4380-FORMAT-LQDN-SSPNN-DTE                   17600099
176100             PERFORM 4390-SELECT-PO-COUNT                         17610099
176200             PERFORM 4395-SELECT-CONTNR-COUNT                     17620099
176300                                                                  17630099
176400             IF IMCSEN-LAST-UPD-TMST (1:10)                       17640099
176500                                        = SPACES OR PC-INIT-DATE  17650099
176600                 MOVE SPACES       TO ASC-LAST-TRN                17660099
176700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17670099
176800             ELSE                                                 17680099
176900                 STRING  IMCSEN-LAST-UPD-TMST(6:2) '/'            17690099
177000                         IMCSEN-LAST-UPD-TMST(9:2)                17700099
177100                         DELIMITED BY SIZE                        17710099
177200                                   INTO ASC-LAST-TRN              17720099
177300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17730099
177400             END-IF                                               17740099
177500                                                                  17750099
177600             PERFORM 4397-SELECT-ENTRY-HISTORY                    17760099
177700         END-IF                                                   17770099
177800     END-PERFORM.                                                 17780099
177900                                                                  17790099
178000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17800099
178100         MOVE +1               TO ASC-BLK-SUB                     17810099
178200         PERFORM 5100-WRITE-TEMP-STORAGE                          17820099
178300         ADD +1                TO ASC-BLK-SUB                     17830099
178400         PERFORM 5100-WRITE-TEMP-STORAGE                          17840099
178500                                                                  17850099
178600         MOVE 1                TO ASC-BLK-SUB                     17860099
178700                                  PV-BLOCK-NUMBER                 17870099
178800         PERFORM 4410-READ-TEMP-STORAGE                           17880099
178900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17890099
179000             MOVE 2            TO ASC-BLK-SUB                     17900099
179100                                  PV-BLOCK-NUMBER                 17910099
179200             PERFORM 4410-READ-TEMP-STORAGE                       17920099
179300         END-IF                                                   17930099
179400     ELSE                                                         17940099
179500         PERFORM 4398-SELECT-CUSTOMS-DEL-HSTRY                    17950099
179600     END-IF.                                                      17960099
179700                                                                  17970099
179800 EJECT                                                            17980099
179900*----------------------------------------------------------------*17990099
180000*    FETCH THE ENTRY CURSOR                                      *18000099
180100*----------------------------------------------------------------*18010099
180200 4310-FETCH.                                                      18020099
180300                                                                  18030099
180400        EXEC SQL                                                  18040099
180500        FETCH ENTRY-CSR                                           18050099
180600        INTO   :IMCSEN-CSTM-ENTR-ID                               18060099
180700             , :IMCSEN-FILD-TMST                                  18070099
180800             , :IMCSEN-EXM-TMST                                   18080099
180900             , :IMCSEN-REJ-TMST                                   18090099
181000             , :IMCSEN-EST-CLR-TMST                               18100099
181100             , :IMCSEN-ACTL-CLR-TMST                              18110099
181200             , :IMCSEN-LQDN-TMST                                  18120099
181300             , :IMCSEN-LQDN-SSPNN-TMST                            18130099
181400             , :IMCSEN-ENT-ID                                     18140099
181500             , :IMCSEN-MOM-DEST-POE-CDE                           18150099
181600             , :IMCSEN-LAST-UPD-TMST                              18160099
181700        END-EXEC                                                  18170099
181800                                                                  18180099
181900                                                                  18190099
182000     EVALUATE TRUE                                                18200099
182100         WHEN SQLCODE = ZERO                                      18210099
182200         WHEN SQLCODE = +100                                      18220099
182300         WHEN SQLCODE = -305                                      18230099
182400              CONTINUE                                            18240099
182500         WHEN SQLWARN0 NOT = SPACE                                18250099
182600         WHEN SQLCODE NOT = ZERO                                  18260099
182700              MOVE '4310-FETCH-CURSOR'                            18270099
182800                               TO DP013-PARAGRAPH                 18280099
182900              MOVE 'FETCH ENTRY CURSOR'                           18290099
183000                               TO DP013-MESSAGE-TEXT (1)          18300099
183100              MOVE SQLCA       TO DP013-SQLCA                     18310099
183200              SET DP013-DB2-ABEND                                 18320099
183300                               TO TRUE                            18330099
183400              PERFORM DP013-0000-PROCESS-ABEND                    18340099
183500             MOVE SQLCA        TO DP013-SQLCA                     18350099
183600             MOVE 'TIMCSPO '   TO DP013-DB2-TABLE-NAME (1)        18360099
183700             SET DP013-DB2-ABEND                                  18370099
183800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18380099
183900             PERFORM DP013-0000-PROCESS-ABEND                     18390099
184000     END-EVALUATE.                                                18400099
184100*                                                                 18410099
184200     IF  SQLCODE EQUAL +100                                       18420099
184300         SET ASC-NO-ITEMS-LEFT-ON-DB                              18430099
184400                                   TO TRUE                        18440099
184500     END-IF.                                                      18450099
184600                                                                  18460099
184700 EJECT                                                            18470099
184800*----------------------------------------------------------------*18480099
184900*   OPEN THE POE CODE CURSOR                                     *18490099
185000*----------------------------------------------------------------*18500099
185100 4315-OPEN-POE-CURSOR.                                            18510099
185200                                                                  18520099
185300     PERFORM                                                      18530099
185400         WITH TEST AFTER                                          18540099
185500         VARYING PV-RETRY-COUNTER                                 18550099
185600         FROM 1 BY 1                                              18560099
185700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18570099
185800                   OR (SQLCODE = ZERO))                           18580099
185900                                                                  18590099
186000         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)    18600099
186100                                                                  18610099
186200         EXEC SQL                                                 18620099
186300              OPEN POE-CSR                                        18630099
186400         END-EXEC                                                 18640099
186500                                                                  18650099
186600         EVALUATE TRUE                                            18660099
186700             WHEN SQLCODE = ZERO                                  18670099
186800             WHEN SQLCODE = -904                                  18680099
186900             WHEN SQLCODE = -913                                  18690099
187000                 CONTINUE                                         18700099
187100             WHEN SQLWARN0 NOT = SPACES                           18710099
187200             WHEN SQLCODE < ZERO                                  18720099
187300             WHEN SQLCODE > ZERO                                  18730099
187400                 MOVE '4315-OPEN-POE-CURSOR'                      18740099
187500                                   TO DP013-PARAGRAPH             18750099
187600                 MOVE 'OPEN POE CURSOR - '                        18760099
187700                                   TO DP013-MESSAGE-TEXT (1)      18770099
187800                 MOVE SQLCA        TO DP013-SQLCA                 18780099
187900                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)    18790099
188000                 SET DP013-DB2-ABEND                              18800099
188100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18810099
188200                 PERFORM DP013-0000-PROCESS-ABEND                 18820099
188300         END-EVALUATE                                             18830099
188400     END-PERFORM.                                                 18840099
188500*                                                                 18850099
188600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18860099
188700         MOVE '4315-OPEN-POE-CURSOR' TO DP013-PARAGRAPH           18870099
188800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18880099
188900                                   TO DP013-MESSAGE-TEXT (1)      18890099
189000         MOVE SQLCA                TO DP013-SQLCA                 18900099
189100         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)    18910099
189200         SET DP013-DB2-ABEND                                      18920099
189300             DP013-XCTL-DISPLAY-RESTART                           18930099
189400                                   TO TRUE                        18940099
189500         PERFORM DP013-0000-PROCESS-ABEND                         18950099
189600     END-IF.                                                      18960099
189700                                                                  18970099
189800 EJECT                                                            18980099
189900*----------------------------------------------------------------*18990099
190000*   CLOSE THE POE CODE CURSOR                                    *19000099
190100*----------------------------------------------------------------*19010099
190200 4320-CLOSE-POE-CURSOR.                                           19020099
190300                                                                  19030099
190400     EXEC SQL                                                     19040099
190500          CLOSE POE-CSR                                           19050099
190600     END-EXEC.                                                    19060099
190700                                                                  19070099
190800     EVALUATE TRUE                                                19080099
190900         WHEN SQLCODE = ZERO                                      19090099
191000             CONTINUE                                             19100099
191100         WHEN SQLWARN0 NOT = SPACES                               19110099
191200         WHEN SQLCODE < ZERO                                      19120099
191300         WHEN SQLCODE > ZERO                                      19130099
191400             MOVE '4320-CLOSE-POE-CURSOR'                         19140099
191500                               TO DP013-PARAGRAPH                 19150099
191600             MOVE 'CLOSE POE CURSOR '                             19160099
191700                               TO DP013-MESSAGE-TEXT (1)          19170099
191800             MOVE SQLCA        TO DP013-SQLCA                     19180099
191900             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)        19190099
192000             SET DP013-DB2-ABEND                                  19200099
192100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19210099
192200             PERFORM DP013-0000-PROCESS-ABEND                     19220099
192300     END-EVALUATE.                                                19230099
192400                                                                  19240099
192401 EJECT                                                            19240199
192402*----------------------------------------------------------------*19240299
192403*    FETCH THE POE CODE CURSOR                                   *19240399
192404*----------------------------------------------------------------*19240499
192405 4325-FETCH-POE-CURSOR.                                           19240599
192406                                                                  19240699
192407     EXEC SQL                                                     19240799
192408          FETCH POE-CSR                                           19240899
192409          INTO  :IMPOE-POE-CDE                                    19240999
192410     END-EXEC.                                                    19241099
192411                                                                  19241199
192412     EVALUATE TRUE                                                19241299
192413         WHEN SQLCODE = ZERO                                      19241399
192414         WHEN SQLCODE = -811                                      19241499
192415              CONTINUE                                            19241599
192416         WHEN SQLCODE = +100                                      19241699
192417              MOVE SPACES TO IMPOE-POE-CDE                        19241799
192418         WHEN SQLWARN0 NOT = SPACE                                19241899
192419         WHEN SQLCODE NOT = ZERO                                  19241999
192420              MOVE '4325-FETCH-POE-CURSOR'                        19242099
192421                               TO DP013-PARAGRAPH                 19242199
192422              MOVE 'FETCH POE CURSOR'                             19242299
192423                               TO DP013-MESSAGE-TEXT (1)          19242399
192424              MOVE SQLCA       TO DP013-SQLCA                     19242499
192425              SET DP013-DB2-ABEND                                 19242599
192426                               TO TRUE                            19242699
192427              PERFORM DP013-0000-PROCESS-ABEND                    19242799
192428     END-EVALUATE.                                                19242899
192429                                                                  19242999
192430 EJECT                                                            19243099
192440*----------------------------------------------------------------*19244099
192450*    FORMAT FILED DATE.                                          *19245099
192460*----------------------------------------------------------------*19246099
192470 4330-FORMAT-FILD-DTE.                                            19247099
192480                                                                  19248099
192490     IF IMCSEN-FILD-TMST(1:10) EQUAL PC-INIT-DATE                 19249099
192500         MOVE SPACES TO ASC-FILD                                  19250099
192600                        (ASC-BLK-SUB ASC-ITEM-SUB)                19260099
192700     ELSE                                                         19270099
192800         MOVE IMCSEN-FILD-TMST(9:2)  TO PV-FORMAT-DAY             19280099
192900         MOVE IMCSEN-FILD-TMST(6:2)  TO PV-FORMAT-MONTH           19290099
193000         MOVE PV-FORMAT-DATE         TO ASC-FILD                  19300099
193100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19310099
193200     END-IF.                                                      19320099
193300                                                                  19330099
193400*----------------------------------------------------------------*19340099
193500*    FORMAT EXAM DATE.                                           *19350099
193600*----------------------------------------------------------------*19360099
193700 4340-FORMAT-EXM-DTE.                                             19370099
193800                                                                  19380099
193900     IF IMCSEN-EXM-TMST(1:10) EQUAL PC-INIT-DATE                  19390099
194000         MOVE SPACES TO ASC-EXM                                   19400099
194100                        (ASC-BLK-SUB ASC-ITEM-SUB)                19410099
194200     ELSE                                                         19420099
194300         MOVE IMCSEN-EXM-TMST(9:2)  TO PV-FORMAT-DAY              19430099
194400         MOVE IMCSEN-EXM-TMST(6:2)  TO PV-FORMAT-MONTH            19440099
194500         MOVE PV-FORMAT-DATE        TO ASC-EXM                    19450099
194600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19460099
194700     END-IF.                                                      19470099
194800                                                                  19480099
194900*----------------------------------------------------------------*19490099
195000*    FORMAT REJECTED DATE.                                       *19500099
195100*----------------------------------------------------------------*19510099
195200 4350-FORMAT-REJ-DTE.                                             19520099
195300                                                                  19530099
195400     IF IMCSEN-REJ-TMST(1:10) EQUAL PC-INIT-DATE                  19540099
195500         MOVE SPACES TO ASC-REJ                                   19550099
195600                        (ASC-BLK-SUB ASC-ITEM-SUB)                19560099
195700     ELSE                                                         19570099
195800         MOVE IMCSEN-REJ-TMST(9:2)  TO PV-FORMAT-DAY              19580099
195900         MOVE IMCSEN-REJ-TMST(6:2)  TO PV-FORMAT-MONTH            19590099
196000         MOVE PV-FORMAT-DATE        TO ASC-REJ                    19600099
196100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19610099
196200     END-IF.                                                      19620099
196300                                                                  19630099
196400*----------------------------------------------------------------*19640099
196500*    FORMAT ESTIMATED CLEARANCE DATE.                            *19650099
196600*----------------------------------------------------------------*19660099
196700 4355-FORMAT-EST-CLR-DTE.                                         19670099
196800                                                                  19680099
196900     IF IMCSEN-EST-CLR-TMST(1:10) EQUAL PC-INIT-DATE              19690099
197000         MOVE SPACES TO ASC-EST-CLRD                              19700099
197100                        (ASC-BLK-SUB ASC-ITEM-SUB)                19710099
197200     ELSE                                                         19720099
197300         MOVE IMCSEN-EST-CLR-TMST(9:2)  TO PV-FORMAT-DAY          19730099
197400         MOVE IMCSEN-EST-CLR-TMST(6:2)  TO PV-FORMAT-MONTH        19740099
197500         MOVE PV-FORMAT-DATE             TO ASC-EST-CLRD          19750099
197600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19760099
197700     END-IF.                                                      19770099
197800                                                                  19780099
197900*----------------------------------------------------------------*19790099
198000*    FORMAT ACTUAL CLEARANCE DATE.                               *19800099
198100*----------------------------------------------------------------*19810099
198200 4360-FORMAT-ACT-CLR-DTE.                                         19820099
198300                                                                  19830099
198400     IF IMCSEN-ACTL-CLR-TMST(1:10) EQUAL PC-INIT-DATE             19840099
198500         MOVE SPACES TO ASC-ACT-CLRD                              19850099
198600                        (ASC-BLK-SUB ASC-ITEM-SUB)                19860099
198700     ELSE                                                         19870099
198800         MOVE IMCSEN-ACTL-CLR-TMST(9:2)  TO PV-FORMAT-DAY         19880099
198900         MOVE IMCSEN-ACTL-CLR-TMST(6:2)  TO PV-FORMAT-MONTH       19890099
199000         MOVE PV-FORMAT-DATE             TO ASC-ACT-CLRD          19900099
199100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19910099
199200     END-IF.                                                      19920099
199300                                                                  19930099
199400*----------------------------------------------------------------*19940099
199500*    FORMAT LIQUIDATION DATE.                                    *19950099
199600*----------------------------------------------------------------*19960099
199700 4370-FORMAT-LQDN-DTE.                                            19970099
199800                                                                  19980099
199900     IF IMCSEN-LQDN-TMST(1:10) EQUAL PC-INIT-DATE                 19990099
200000         MOVE SPACES TO ASC-LQDN                                  20000099
200100                        (ASC-BLK-SUB ASC-ITEM-SUB)                20010099
200200     ELSE                                                         20020099
200300         MOVE IMCSEN-LQDN-TMST(9:2)  TO PV-FORMAT-DAY             20030099
200400         MOVE IMCSEN-LQDN-TMST(6:2)  TO PV-FORMAT-MONTH           20040099
200500         MOVE PV-FORMAT-DATE         TO ASC-LQDN                  20050099
200600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   20060099
200700     END-IF.                                                      20070099
200800                                                                  20080099
200900*----------------------------------------------------------------*20090099
201000*    FORMAT LIQUIDATION SUSPENSION DATE.                         *20100099
201100*----------------------------------------------------------------*20110099
201200 4380-FORMAT-LQDN-SSPNN-DTE.                                      20120099
201300                                                                  20130099
201400     IF IMCSEN-LQDN-SSPNN-TMST(1:10) EQUAL PC-INIT-DATE           20140099
201500         MOVE SPACES TO ASC-LQDN-SSPNN                            20150099
201600                        (ASC-BLK-SUB ASC-ITEM-SUB)                20160099
201700     ELSE                                                         20170099
201800         MOVE IMCSEN-LQDN-SSPNN-TMST(9:2)  TO PV-FORMAT-DAY       20180099
201900         MOVE IMCSEN-LQDN-SSPNN-TMST(6:2)  TO PV-FORMAT-MONTH     20190099
202000         MOVE PV-FORMAT-DATE               TO ASC-LQDN-SSPNN      20200099
202100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   20210099
202200     END-IF.                                                      20220099
202300                                                                  20230099
202400*----------------------------------------------------------------*20240099
202500* SELECT THE PO COUNT FOR THE CUSTOMS ENTRY                      *20250099
202600*----------------------------------------------------------------*20260099
202700 4390-SELECT-PO-COUNT.                                            20270099
202800                                                                  20280099
202900     EXEC SQL                                                     20290099
203000         SELECT                                                   20300099
203100               COUNT(DISTINCT PO_NBR)                             20310099
203200         INTO   :PV-PO-COUNT                                      20320099
203300         FROM   TIMCSPO                                           20330099
203400         WHERE  CSTM_ENTR_ID   = :IMCSEN-CSTM-ENTR-ID             20340099
203500     END-EXEC.                                                    20350099
203600                                                                  20360099
203700     EVALUATE TRUE                                                20370099
203800         WHEN SQLCODE = ZERO                                      20380099
203900         WHEN SQLCODE = +100                                      20390099
204000              MOVE PV-PO-COUNT TO ASC-PO-CNT                      20400099
204100                                  (ASC-BLK-SUB ASC-ITEM-SUB)      20410099
204200         WHEN SQLWARN0 NOT = SPACE                                20420099
204300         WHEN SQLCODE NOT = ZERO                                  20430099
204400              MOVE '4390-SELECT-PO-COUNT'                         20440099
204500                               TO DP013-PARAGRAPH                 20450099
204600              MOVE 'SQL ERROR SELECTING PO COUNT'                 20460099
204700                               TO DP013-MESSAGE-TEXT (1)          20470099
204800              MOVE SQLCA       TO DP013-SQLCA                     20480099
204900              SET DP013-DB2-ABEND                                 20490099
205000                               TO TRUE                            20500099
205100              PERFORM DP013-0000-PROCESS-ABEND                    20510099
205200     END-EVALUATE.                                                20520099
205300                                                                  20530099
205400 EJECT                                                            20540099
205500*----------------------------------------------------------------*20550099
205600* SELECT THE CONTAINER COUNT FOR THE CUSTOMS ENTRY               *20560099
205700*----------------------------------------------------------------*20570099
205800 4395-SELECT-CONTNR-COUNT.                                        20580099
205900                                                                  20590099
206000     EXEC SQL                                                     20600099
206100         SELECT                                                   20610099
206200               COUNT(DISTINCT CONTNR_ID)                          20620099
206300         INTO   :PV-CONTNR-COUNT                                  20630099
206400         FROM   TIMCSCN                                           20640099
206500         WHERE  CSTM_ENTR_ID   = :IMCSEN-CSTM-ENTR-ID             20650099
206600     END-EXEC.                                                    20660099
206700                                                                  20670099
206800     EVALUATE TRUE                                                20680099
206900         WHEN SQLCODE = ZERO                                      20690099
207000         WHEN SQLCODE = +100                                      20700099
207100              MOVE PV-CONTNR-COUNT TO ASC-CONT-CNT                20710099
207200                                  (ASC-BLK-SUB ASC-ITEM-SUB)      20720099
207300         WHEN SQLWARN0 NOT = SPACE                                20730099
207400         WHEN SQLCODE NOT = ZERO                                  20740099
207500              MOVE '4395-SELECT-CONTNR-COUNT'                     20750099
207600                               TO DP013-PARAGRAPH                 20760099
207700              MOVE 'SQL ERROR SELECTING CONTNR COUNT'             20770099
207800                               TO DP013-MESSAGE-TEXT (1)          20780099
207900              MOVE SQLCA       TO DP013-SQLCA                     20790099
208000              SET DP013-DB2-ABEND                                 20800099
208100                               TO TRUE                            20810099
208200              PERFORM DP013-0000-PROCESS-ABEND                    20820099
208300     END-EVALUATE.                                                20830099
208400                                                                  20840099
208500 EJECT                                                            20850099
208600*----------------------------------------------------------------*20860099
208700* CHECK FOR CUSTOMS ENTRY HISTORY                                *20870099
208800*----------------------------------------------------------------*20880099
208900 4397-SELECT-ENTRY-HISTORY.                                       20890099
209000                                                                  20900099
209100     PERFORM                                                      20910099
209200         WITH TEST AFTER                                          20920099
209300         VARYING PV-RETRY-COUNTER                                 20930099
209400         FROM 1 BY 1                                              20940099
209500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20950099
209600            OR  (SQLCODE = ZERO)                                  20960099
209700            OR  (SQLCODE = -811)                                  20970099
209800            OR  (SQLCODE = +100))                                 20980099
209900                                                                  20990099
210000         EXEC SQL                                                 21000099
210100              SELECT DISTINCT                                     21010099
210200                     A.CSTM_ENTR_ID                               21020099
210300              INTO  :AUCSEN-CSTM-ENTR-ID                          21030099
210400              FROM   TAUCSEN A                                    21040099
210500              WHERE  A.CSTM_ENTR_ID = :IMCSEN-CSTM-ENTR-ID        21050099
210600                AND  A.AUD_FUNC_CDE = :PC-U                       21060099
210700         END-EXEC                                                 21070099
210800*                                                                 21080099
210900         EVALUATE TRUE                                            21090099
211000             WHEN SQLCODE = -904                                  21100099
211100             WHEN SQLCODE = -913                                  21110099
211200                 CONTINUE                                         21120099
211300             WHEN SQLCODE = ZERO                                  21130099
211400             WHEN SQLCODE = -811                                  21140099
211500                  MOVE 'Y'         TO ASC-HISTORY                 21150099
211600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   21160099
211700             WHEN SQLCODE = +100                                  21170099
211800                  MOVE 'N'         TO ASC-HISTORY                 21180099
211900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   21190099
212000             WHEN SQLWARN0 NOT = SPACES                           21200099
212100             WHEN SQLCODE < ZERO                                  21210099
212200             WHEN SQLCODE > ZERO                                  21220099
212300                 MOVE '4397-SELECT-ENTRY-HISTORY'                 21230099
212400                                   TO DP013-PARAGRAPH             21240099
212500                 MOVE 'SQL ERROR SELECTING ENTRY'                 21250099
212600                                   TO DP013-MESSAGE-TEXT (1)      21260099
212700                 MOVE SQLCA        TO DP013-SQLCA                 21270099
212800                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)    21280099
212900                 SET DP013-DB2-ABEND                              21290099
213000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21300099
213100                 PERFORM DP013-0000-PROCESS-ABEND                 21310099
213200         END-EVALUATE                                             21320099
213300     END-PERFORM.                                                 21330099
213400*                                                                 21340099
213500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21350099
213600        MOVE '4397-SELECT-ENTRY-HISTORY' TO DP013-PARAGRAPH       21360099
213700        MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'21370099
213800                                   TO DP013-MESSAGE-TEXT (1)      21380099
213900        MOVE SQLCA                TO DP013-SQLCA                  21390099
214000        MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)     21400099
214100        SET DP013-DB2-ABEND                                       21410099
214200            DP013-XCTL-DISPLAY-RESTART                            21420099
214300                                  TO TRUE                         21430099
214400        PERFORM DP013-0000-PROCESS-ABEND                          21440099
214500     END-IF.                                                      21450099
214600                                                                  21460099
214700 EJECT                                                            21470099
214800*----------------------------------------------------------------*21480099
214900* CHECK FOR DELETED CUSTOMS ENTRY HISTORY                        *21490099
215000*----------------------------------------------------------------*21500099
215100 4398-SELECT-CUSTOMS-DEL-HSTRY.                                   21510099
215200                                                                  21520099
215300     PERFORM                                                      21530099
215400         WITH TEST AFTER                                          21540099
215500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     21550099
215600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            21560099
215700                 SQLCODE = ZERO                     OR            21570099
215800                 SQLCODE = +100                     OR            21580099
215900                 SQLCODE = -811                                   21590099
216000                                                                  21600099
216100         EXEC SQL                                                 21610099
216200             SELECT B.CSTM_ENTR_ID                                21620099
216300               INTO :AUCSEN-CSTM-ENTR-ID                          21630099
216400               FROM                                               21640099
216500                    TAUCSPO  A                                    21650099
216600                   ,TAUCSEN  B                                    21660099
216700              WHERE                                               21670099
216800                    A.PO_NBR       = :DK-PO-NBR                   21680099
216900                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID               21690099
217000                AND B.AUD_FUNC_CDE = :PC-D                        21700099
217100         END-EXEC                                                 21710099
217200                                                                  21720099
217300         EVALUATE TRUE                                            21730099
217400             WHEN SQLCODE = -904                                  21740099
217500             WHEN SQLCODE = -913                                  21750099
217600                 CONTINUE                                         21760099
217700             WHEN SQLCODE = ZERO                                  21770099
217800             WHEN SQLCODE = -811                                  21780099
217900                 MOVE PC-HISTORY-MSG TO AMSGO                     21790099
218000             WHEN SQLCODE = +100                                  21800099
218100                 MOVE SPACES TO AMSGO                             21810099
218200             WHEN SQLWARN0 NOT = SPACES                           21820099
218300             WHEN SQLCODE < ZERO                                  21830099
218400             WHEN SQLCODE > ZERO                                  21840099
218500                 MOVE '4398-SELECT-CUSTOMS-DEL-HSTRY'             21850099
218600                                   TO DP013-PARAGRAPH             21860099
218700                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'          21870099
218800                                   TO DP013-MESSAGE-TEXT (1)      21880099
218900                 MOVE SQLCA        TO DP013-SQLCA                 21890099
219000                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)    21900099
219100                 SET DP013-DB2-ABEND                              21910099
219200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21920099
219300                 PERFORM DP013-0000-PROCESS-ABEND                 21930099
219400         END-EVALUATE                                             21940099
219500     END-PERFORM.                                                 21950099
219600*                                                                 21960099
219700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21970099
219800         MOVE '4398-SELECT-CUSTOMS-DEL-HSTRY'                     21980099
219900                                   TO DP013-PARAGRAPH             21990099
220000         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'   22000099
220100                                   TO DP013-MESSAGE-TEXT (1)      22010099
220200         MOVE SQLCA                TO DP013-SQLCA                 22020099
220300         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)    22030099
220400         SET DP013-DB2-ABEND                                      22040099
220500             DP013-XCTL-DISPLAY-RESTART                           22050099
220600                                   TO TRUE                        22060099
220700         PERFORM DP013-0000-PROCESS-ABEND                         22070099
220800     END-IF.                                                      22080099
220900                                                                  22090099
221000 EJECT                                                            22100099
221100*----------------------------------------------------------------*22110099
221200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22120099
221300*----------------------------------------------------------------*22130099
221400 4400-MOVE-COMMAREA-TO-SCREEN.                                    22140099
221500                                                                  22150099
221600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22160099
221700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22170099
221800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22180099
221900             MOVE +1    TO ASC-BLK-SUB                            22190099
222000             PERFORM 5100-WRITE-TEMP-STORAGE                      22200099
222100             ADD +1     TO ASC-BLK-SUB                            22210099
222200             PERFORM 5100-WRITE-TEMP-STORAGE                      22220099
222300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22230099
222400                 GIVING PV-BLOCK-NUMBER                           22240099
222500                 REMAINDER PV-REMAINDER                           22250099
222600             IF  PV-REMAINDER > ZERO                              22260099
222700                 ADD +1 TO PV-BLOCK-NUMBER                        22270099
222800             END-IF                                               22280099
222900             MOVE +1    TO ASC-BLK-SUB                            22290099
223000             PERFORM 4410-READ-TEMP-STORAGE                       22300099
223100             ADD +1     TO ASC-BLK-SUB                            22310099
223200                           PV-BLOCK-NUMBER                        22320099
223300             PERFORM 4410-READ-TEMP-STORAGE                       22330099
223400     END-IF.                                                      22340099
223500     MOVE +1            TO ASC-BLK-SUB.                           22350099
223600     COMPUTE ASC-ITEM-SUB =                                       22360099
223700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22370099
223800         + PC-ITEMS-PER-PANEL).                                   22380099
223900*                                                                 22390099
224000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22400099
224100         ADD +1         TO ASC-BLK-SUB                            22410099
224200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22420099
224300     END-IF.                                                      22430099
224400*                                                                 22440099
224500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22450099
224600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22460099
224700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22470099
224800     PERFORM 4420-FORMAT-LIST-LINES                               22480099
224900         VARYING PV-SUB                                           22490099
225000         FROM PC-ITEMS-PER-PANEL BY -1                            22500099
225100         UNTIL PV-SUB < +1.                                       22510099
225200*                                                                 22520099
225300     COMPUTE ASC-ITEMS-DISPLAYED =                                22530099
225400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22540099
225500     PERFORM 4401-SELECT-PO-DETAILS.                              22550099
225600     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            22560099
225700                                                                  22570099
225800     PERFORM 4398-SELECT-CUSTOMS-DEL-HSTRY                        22580099
225900*                                                                 22590099
226000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22600099
226100                                      ASTRTITO.                   22610099
226200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22620099
226300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22630099
226400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22640099
226500                                   TO ASELITO.                    22650099
226600                                                                  22660099
226700     IF  DP020-MSG-NUMBER-X = SPACE                               22670099
226800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22680099
226900*----------- MORE ITEMS TO DISPLAY --------                       22690099
227000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22700099
227100             SET DP020-MSG-INFORMATIONAL TO TRUE                  22710099
227200         END-IF                                                   22720099
227300     END-IF.                                                      22730099
227400                                                                  22740099
227500 EJECT                                                            22750099
227600*----------------------------------------------------------------*22760099
227700*    SELECT PO DETAILS.                                          *22770099
227800*----------------------------------------------------------------*22780099
227900 4401-SELECT-PO-DETAILS.                                          22790099
228000                                                                  22800099
228100     PERFORM                                                      22810099
228200         WITH TEST AFTER                                          22820099
228300         VARYING PV-RETRY-COUNTER                                 22830099
228400         FROM 1 BY 1                                              22840099
228500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22850099
228600            OR  (SQLCODE = ZERO)                                  22860099
228700            OR  (SQLCODE = +100))                                 22870099
228800                                                                  22880099
228900         EXEC SQL                                                 22890099
229000              SELECT B.ENT_NAME_DESC                              22900099
229100              INTO  :ENTNME-ENT-NAME-DESC                         22910099
229200              FROM   TPURCHS A,                                   22920099
229300                     TENTNME B                                    22930099
229400              WHERE  A.PO_NBR         = :DK-PO-NBR                22940099
229500                AND  A.VER_STATUS_CDE = 'A'                       22950099
229600                AND  B.ENT_ID         =  A.ENT_ID                 22960099
229700                AND  B.TYPE_CDE       = '01'                      22970099
229800         END-EXEC                                                 22980099
229900*                                                                 22990099
230000         EVALUATE TRUE                                            23000099
230100             WHEN SQLCODE = ZERO                                  23010099
230200             WHEN SQLCODE = +100                                  23020099
230300             WHEN SQLCODE = -904                                  23030099
230400             WHEN SQLCODE = -913                                  23040099
230500                 CONTINUE                                         23050099
230600             WHEN SQLWARN0 NOT = SPACES                           23060099
230700             WHEN SQLCODE < ZERO                                  23070099
230800             WHEN SQLCODE > ZERO                                  23080099
230900                 MOVE '4401-SELECT-PO-DETAILS'                    23090099
231000                                   TO DP013-PARAGRAPH             23100099
231100                 MOVE 'SQL ERROR SELECTING PO DETAILS'            23110099
231200                                   TO DP013-MESSAGE-TEXT (1)      23120099
231300                 MOVE SQLCA        TO DP013-SQLCA                 23130099
231400                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    23140099
231500                 SET DP013-DB2-ABEND                              23150099
231600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23160099
231700                 PERFORM DP013-0000-PROCESS-ABEND                 23170099
231800         END-EVALUATE                                             23180099
231900     END-PERFORM.                                                 23190099
232000*                                                                 23200099
232100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23210099
232200         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH      23220099
232300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  23230099
232400                                   TO DP013-MESSAGE-TEXT (1)      23240099
232500         MOVE SQLCA                TO DP013-SQLCA                 23250099
232600         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    23260099
232700         SET DP013-DB2-ABEND                                      23270099
232800             DP013-XCTL-DISPLAY-RESTART                           23280099
232900                                   TO TRUE                        23290099
233000         PERFORM DP013-0000-PROCESS-ABEND                         23300099
233100     END-IF.                                                      23310099
233200                                                                  23320099
233300 EJECT                                                            23330099
233400*----------------------------------------------------------------*23340099
233500*    MOVE PO DETAILS TO SCREEN.                                  *23350099
233600*----------------------------------------------------------------*23360099
233700 4407-MOVE-PO-DTLS-TO-SCR.                                        23370099
233800                                                                  23380099
233900     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   23390099
234000     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  23400099
234100                                                                  23410099
234200*----------------------------------------------------------------*23420099
234300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23430099
234400*----------------------------------------------------------------*23440099
234500 4410-READ-TEMP-STORAGE.                                          23450099
234600                                                                  23460099
234700     EXEC CICS                                                    23470099
234800         READQ TS                                                 23480099
234900             QUEUE (ASC-LIST-QUEUE-NAME)                          23490099
235000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23500099
235100             ITEM  (PV-BLOCK-NUMBER)                              23510099
235200             RESP  (PV-CICS-RESP)                                 23520099
235300     END-EXEC.                                                    23530099
235400*                                                                 23540099
235500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23550099
235600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23560099
235700         CONTINUE                                                 23570099
235800     ELSE                                                         23580099
235900         SET DP013-CICS-ABEND     TO TRUE                         23590099
236000         SET DP013-NO-ROLLBACK    TO TRUE                         23600099
236100         MOVE '4410-READ-TEMP-STORAGE'                            23610099
236200                                  TO DP013-PARAGRAPH              23620099
236300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23630099
236400                                  TO DP013-MESSAGE-TEXT(1)        23640099
236500         PERFORM DP013-0000-PROCESS-ABEND                         23650099
236600     END-IF.                                                      23660099
236700*                                                                 23670099
236800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23680099
236900*                                                                 23690099
237000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23700099
237100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23710099
237200     END-IF.                                                      23720099
237300                                                                  23730099
237400 EJECT                                                            23740099
237500*----------------------------------------------------------------*23750099
237600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23760099
237700*----------------------------------------------------------------*23770099
237800 4420-FORMAT-LIST-LINES.                                          23780099
237900                                                                  23790099
238000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23800099
238100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23810099
238200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      23820099
238300         MOVE DP015-HL-OFF       TO MR-SELECTH      (PV-SUB)      23830099
238400         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      23840099
238500                                    MR-ACTION       (PV-SUB)      23850099
238600                                    MR-ENTRY-NBR    (PV-SUB)      23860099
238700                                    MR-FILED        (PV-SUB)      23870099
238800                                    MR-EXAM         (PV-SUB)      23880099
238900                                    MR-REJ          (PV-SUB)      23890099
239000                                    MR-EST-CLRD     (PV-SUB)      23900099
239100                                    MR-ACT-CLRD     (PV-SUB)      23910099
239200                                    MR-LIQ          (PV-SUB)      23920099
239300                                    MR-SLIQ         (PV-SUB)      23930099
239400                                    MR-POE          (PV-SUB)      23940099
239500                                    MR-LAST-TRN     (PV-SUB)      23950099
239600                                    MR-CONTNR-CNT-X (PV-SUB)      23960099
239700                                    MR-PO-CNT-X     (PV-SUB)      23970099
239800                                    MR-HISTORY      (PV-SUB)      23980099
239900                                                                  23990099
240000     ELSE                                                         24000099
240100         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24010099
240200                                                   > SPACE        24020099
240300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24030099
240400                                 TO MR-SELECTI (PV-SUB)           24040099
240500         ELSE                                                     24050099
240600             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24060099
240700                                 TO MR-SELECTI (PV-SUB)           24070099
240800         END-IF                                                   24080099
240900                                                                  24090099
241000         IF  DP030-SET-CURSOR-TRAILER                             24100099
241100             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24110099
241200                 > SPACE)                                         24120099
241300               OR (PV-SUB = 1))                                   24130099
241400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24140099
241500                MOVE -1          TO MR-SELECTL (PV-SUB)           24150099
241600             END-IF                                               24160099
241700         END-IF                                                   24170099
241800                                                                  24180099
241900         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           24190099
242000             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         24200099
242100                               TO MR-ACTION (PV-SUB)              24210099
242200             MOVE ASC-CSTM-ENTR-ID (ASC-BLK-SUB ASC-ITEM-SUB)     24220099
242300                                 TO MR-ENTRY-NBR  (PV-SUB)        24230099
242400             MOVE ASC-POE          (ASC-BLK-SUB ASC-ITEM-SUB)     24240099
242500                                 TO MR-POE     (PV-SUB)           24250099
242600             MOVE ASC-FILD         (ASC-BLK-SUB ASC-ITEM-SUB)     24260099
242700                                 TO MR-FILED   (PV-SUB)           24270099
242800             MOVE ASC-EXM          (ASC-BLK-SUB ASC-ITEM-SUB)     24280099
242900                                 TO MR-EXAM    (PV-SUB)           24290099
243000             MOVE ASC-REJ          (ASC-BLK-SUB ASC-ITEM-SUB)     24300099
243100                                 TO MR-REJ     (PV-SUB)           24310099
243200             MOVE ASC-EST-CLRD     (ASC-BLK-SUB ASC-ITEM-SUB)     24320099
243300                                 TO MR-EST-CLRD (PV-SUB)          24330099
243400             MOVE ASC-ACT-CLRD     (ASC-BLK-SUB ASC-ITEM-SUB)     24340099
243500                                 TO MR-ACT-CLRD (PV-SUB)          24350099
243600             MOVE ASC-LQDN         (ASC-BLK-SUB ASC-ITEM-SUB)     24360099
243700                                 TO MR-LIQ     (PV-SUB)           24370099
243800             MOVE ASC-LQDN-SSPNN   (ASC-BLK-SUB ASC-ITEM-SUB)     24380099
243900                                 TO MR-SLIQ    (PV-SUB)           24390099
244000             MOVE ASC-PO-CNT       (ASC-BLK-SUB ASC-ITEM-SUB)     24400099
244100                                 TO MR-PO-CNT  (PV-SUB)           24410099
244200             MOVE ASC-CONT-CNT     (ASC-BLK-SUB ASC-ITEM-SUB)     24420099
244300                                 TO MR-CONTNR-CNT (PV-SUB)        24430099
244400             MOVE ASC-LAST-TRN     (ASC-BLK-SUB ASC-ITEM-SUB)     24440099
244500                                 TO MR-LAST-TRN (PV-SUB)          24450099
244600             MOVE ASC-HISTORY      (ASC-BLK-SUB ASC-ITEM-SUB)     24460099
244700                                 TO MR-HISTORY (PV-SUB)           24470099
244800         END-IF                                                   24480099
244900     END-IF.                                                      24490099
245000     SUBTRACT +1 FROM ASC-ITEM-SUB                                24500099
245100     IF  ASC-ITEM-SUB < + 1                                       24510099
245200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24520099
245300         MOVE +1                 TO ASC-BLK-SUB                   24530099
245400     END-IF.                                                      24540099
245500                                                                  24550099
245600 EJECT                                                            24560099
245700*----------------------------------------------------------------*24570099
245800*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *24580099
245900*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *24590099
246000*  ISSUE A WARNING.                                              *24600099
246100*----------------------------------------------------------------*24610099
246200 4430-CHECK-FOR-BEGIN-AND-END.                                    24620099
246300                                                                  24630099
246400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24640099
246500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24650099
246600*----------- NO END-OF-RANGE SPECFIED ---                         24660099
246700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24670099
246800             SET DP020-MSG-WARNING TO TRUE                        24680099
246900             PERFORM 4431-POSITION-AT-WARNING                     24690099
247000         END-IF                                                   24700099
247100     ELSE                                                         24710099
247200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24720099
247300*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   24730099
247400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24740099
247500             SET DP020-MSG-WARNING TO TRUE                        24750099
247600             PERFORM 4431-POSITION-AT-WARNING                     24760099
247700         END-IF                                                   24770099
247800     END-IF.                                                      24780099
247900                                                                  24790099
248000 EJECT                                                            24800099
248100*----------------------------------------------------------------*24810099
248200*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *24820099
248300*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *24830099
248400*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *24840099
248500*  POSITION THE CURSOR THERE.                                    *24850099
248600*----------------------------------------------------------------*24860099
248700 4431-POSITION-AT-WARNING.                                        24870099
248800                                                                  24880099
248900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24890099
249000                    - PV-TOP-ITEM + 1.                            24900099
249100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24910099
249200         CONTINUE                                                 24920099
249300     ELSE                                                         24930099
249400         SET DP030-SET-CURSOR-APPL-1                              24940099
249500                                   TO TRUE                        24950099
249600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24960099
249700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24970099
249800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24980099
249900     END-IF.                                                      24990099
250000*                                                                 25000099
250100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25010099
250200                    - PV-TOP-ITEM + 1.                            25020099
250300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25030099
250400         CONTINUE                                                 25040099
250500     ELSE                                                         25050099
250600         SET DP030-SET-CURSOR-APPL-1                              25060099
250700                                   TO TRUE                        25070099
250800         MOVE -1                   TO MR-SELECTL (PV-SUB)         25080099
250900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25090099
251000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25100099
251100     END-IF.                                                      25110099
251200                                                                  25120099
251300 EJECT                                                            25130099
251400*----------------------------------------------------------------*25140099
251500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25150099
251600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25160099
251700* FOR THE SELECTED ITEMS QUEUE.                                  *25170099
251800*                                                                *25180099
251900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25190099
252000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25200099
252100* THE ARRAY IS FULL.                                             *25210099
252200*----------------------------------------------------------------*25220099
252300 5000-PREPARE-SEL-QUEUE.                                          25230099
252400                                                                  25240099
252500     MOVE +1                   TO  ASC-BLK-SUB.                   25250099
252600     PERFORM 5100-WRITE-TEMP-STORAGE.                             25260099
252700     ADD +1                    TO  ASC-BLK-SUB.                   25270099
252800     PERFORM 5100-WRITE-TEMP-STORAGE.                             25280099
252900     MOVE ASC-SEL-QUEUE-NAME   TO  TR114-SEL-QUEUE-NAME.          25290099
253000     PERFORM 6010-DELETE-SEL-QUEUE.                               25300099
253100                                                                  25310099
253200     SET ASC-UPDATE-TSQ        TO  TRUE.                          25320099
253300                                                                  25330099
253400     SET TR112-IDX             TO  1.                             25340099
253500     MOVE ZERO                 TO TR114-NUMBER-OF-TS-ITEMS.       25350099
253600     INITIALIZE TR112-SELECTED-ITEM-ARRAY.                        25360099
253700                                                                  25370099
253800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25380099
253900             VARYING PV-ITEM                                      25390099
254000             FROM 1 BY 1                                          25400099
254100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25410099
254200                                                                  25420099
254300     IF  TR112-IDX > 1                                            25430099
254400         PERFORM 5205-WRITE-SEL-QUEUE                             25440099
254500         ADD +1                    TO TR114-NUMBER-OF-TS-ITEMS    25450099
254600     END-IF.                                                      25460099
254700                                                                  25470099
254800 5001-PREPARE-SEL-QUEUE.                                          25480099
254900                                                                  25490099
255000     MOVE +1                   TO  ASC-BLK-SUB.                   25500099
255100     PERFORM 5100-WRITE-TEMP-STORAGE.                             25510099
255200     ADD +1                    TO  ASC-BLK-SUB.                   25520099
255300     PERFORM 5100-WRITE-TEMP-STORAGE.                             25530099
255400     MOVE ASC-SEL-QUEUE-NAME   TO  TR114-SEL-QUEUE-NAME.          25540099
255500     PERFORM 6010-DELETE-SEL-QUEUE.                               25550099
255600                                                                  25560099
255700     SET ASC-UPDATE-TSQ        TO  TRUE.                          25570099
255800                                                                  25580099
255900     SET TR112-IDX             TO  1.                             25590099
256000     MOVE ZERO                 TO TR114-NUMBER-OF-TS-ITEMS.       25600099
256100     INITIALIZE TR112-SELECTED-ITEM-ARRAY.                        25610099
256200                                                                  25620099
256300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25630099
256400             VARYING PV-ITEM                                      25640099
256500             FROM 1 BY 1                                          25650099
256600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25660099
256700                                                                  25670099
256800     IF  TR112-IDX > 1                                            25680099
256900         PERFORM 5205-WRITE-SEL-QUEUE                             25690099
257000         ADD +1                    TO TR114-NUMBER-OF-TS-ITEMS    25700099
257100     END-IF.                                                      25710099
257200                                                                  25720099
257300 EJECT                                                            25730099
257400*----------------------------------------------------------------*25740099
257500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25750099
257600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25760099
257700*----------------------------------------------------------------*25770099
257800 5100-WRITE-TEMP-STORAGE.                                         25780099
257900                                                                  25790099
258000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25800099
258100                                   TO PV-LIST-ITEM-NUMBER.        25810099
258200     COMPUTE PV-BLOCK-NUMBER =                                    25820099
258300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25830099
258400                                                                  25840099
258500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25850099
258600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25860099
258700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25870099
258800             PERFORM 5105-REWRITE-ASC-LISTQ                       25880099
258900         END-IF                                                   25890099
259000     ELSE                                                         25900099
259100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25910099
259200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25920099
259300         PERFORM 5110-WRITE-ASC-LISTQ                             25930099
259400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25940099
259500     END-IF.                                                      25950099
259600                                                                  25960099
259700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25970099
259800                                                                  25980099
259900 EJECT                                                            25990099
260000*----------------------------------------------------------------*26000099
260100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *26010099
260200*  SPECIFIC COMMAREA.                                            *26020099
260300*----------------------------------------------------------------*26030099
260400 5105-REWRITE-ASC-LISTQ.                                          26040099
260500                                                                  26050099
260600     EXEC CICS                                                    26060099
260700         WRITEQ TS                                                26070099
260800             QUEUE (ASC-LIST-QUEUE-NAME)                          26080099
260900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26090099
261000             ITEM  (PV-BLOCK-NUMBER)                              26100099
261100             REWRITE                                              26110099
261200             RESP  (PV-CICS-RESP)                                 26120099
261300     END-EXEC.                                                    26130099
261400                                                                  26140099
261500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26150099
261600         CONTINUE                                                 26160099
261700     ELSE                                                         26170099
261800         SET DP013-CICS-ABEND            TO TRUE                  26180099
261900         SET DP013-NO-ROLLBACK           TO TRUE                  26190099
262000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26200099
262100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26210099
262200                                         TO DP013-MESSAGE-TEXT(1) 26220099
262300         PERFORM DP013-0000-PROCESS-ABEND                         26230099
262400     END-IF.                                                      26240099
262500                                                                  26250099
262600 EJECT                                                            26260099
262700*----------------------------------------------------------------*26270099
262800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *26280099
262900*  SPECIFIC COMMAREA.                                            *26290099
263000*----------------------------------------------------------------*26300099
263100 5110-WRITE-ASC-LISTQ.                                            26310099
263200                                                                  26320099
263300     EXEC CICS                                                    26330099
263400         WRITEQ TS                                                26340099
263500             QUEUE (ASC-LIST-QUEUE-NAME)                          26350099
263600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26360099
263700             ITEM  (PV-BLOCK-NUMBER)                              26370099
263800             RESP  (PV-CICS-RESP)                                 26380099
263900     END-EXEC.                                                    26390099
264000                                                                  26400099
264100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26410099
264200         SET DP013-CICS-ABEND      TO TRUE                        26420099
264300         SET DP013-NO-ROLLBACK     TO TRUE                        26430099
264400         MOVE '5110-WRITE-ASC-LISTQ'                              26440099
264500                                   TO DP013-PARAGRAPH             26450099
264600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26460099
264700                                   TO DP013-MESSAGE-TEXT(1)       26470099
264800         PERFORM DP013-0000-PROCESS-ABEND                         26480099
264900     END-IF.                                                      26490099
265000                                                                  26500099
265100 EJECT                                                            26510099
265200*----------------------------------------------------------------*26520099
265300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26530099
265400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26540099
265500*----------------------------------------------------------------*26550099
265600 5200-FILL-SEL-QUEUE-RECORD.                                      26560099
265700                                                                  26570099
265800     PERFORM 6112-READ-LIST-QUEUE.                                26580099
265900                                                                  26590099
266000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26600099
266100         PERFORM                                                  26610099
266200         VARYING LQW-IDX                                          26620099
266300         FROM 1 BY 1                                              26630099
266400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26640099
266500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26650099
266600                                                                  26660099
266700             IF  LQW-SELECT (LQW-IDX)                             26670099
266800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26680099
266900                                     TO TR112-ITEM (TR112-IDX)    26690099
267000                 MOVE LQW-ENTRY-ID (LQW-IDX)                      26700099
267100                                     TO TR112-CSTM-ENTRY-ID       26710099
267200                                        (TR112-IDX)               26720099
267300                                        TR114-CSTM-ENTRY-ID       26730099
267400                 MOVE LQW-ENT-ID   (LQW-IDX)                      26740099
267500                                     TO TR112-ENT-ID              26750099
267600                                        (TR112-IDX)               26760099
267700                                        TR114-ENT-ID              26770099
267800                 MOVE ASC-KEY-PO-NBR TO TR114-PO-NBR              26780099
267900                 MOVE 'I'           TO TR112-ACTION-SW (TR112-IDX)26790099
268000                 SET TR112-IDX UP BY 1                            26800099
268100                 IF  TR112-IDX > TR112-MAX-ITEMS                  26810099
268200                     PERFORM 5205-WRITE-SEL-QUEUE                 26820099
268300                     ADD +1        TO TR114-NUMBER-OF-TS-ITEMS    26830099
268400                     INITIALIZE TR112-SELECTED-ITEM-ARRAY         26840099
268500                     SET TR112-IDX TO  1                          26850099
268600                 END-IF                                           26860099
268700             END-IF                                               26870099
268800         END-PERFORM                                              26880099
268900     END-IF.                                                      26890099
269000                                                                  26900099
269100 EJECT                                                            26910099
269200*----------------------------------------------------------------*26920099
269300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26930099
269400*----------------------------------------------------------------*26940099
269500 5205-WRITE-SEL-QUEUE.                                            26950099
269600                                                                  26960099
269700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26970099
269800                                   TO TR112-SELECTED-ITEMS.       26980099
269900                                                                  26990099
270000     EXEC CICS                                                    27000099
270100          WRITEQ TS                                               27010099
270200             QUEUE (ASC-SEL-QUEUE-NAME)                           27020099
270300             FROM  (TR112-PO-SELECT-RECORD)                       27030099
270400             ITEM  (PV-SEL-QUEUE-ITEM)                            27040099
270500             RESP  (PV-CICS-RESP)                                 27050099
270600     END-EXEC.                                                    27060099
270700                                                                  27070099
270800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27080099
270900         CONTINUE                                                 27090099
271000     ELSE                                                         27100099
271100         SET DP013-CICS-ABEND      TO TRUE                        27110099
271200         SET DP013-NO-ROLLBACK     TO TRUE                        27120099
271300         MOVE '5205-WRITE-SEL-QUEUE'                              27130099
271400                                   TO DP013-PARAGRAPH             27140099
271500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27150099
271600                                   TO DP013-MESSAGE-TEXT(1)       27160099
271700         PERFORM DP013-0000-PROCESS-ABEND                         27170099
271800     END-IF.                                                      27180099
271900                                                                  27190099
272000 EJECT                                                            27200099
272100*----------------------------------------------------------------*27210099
272200*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *27220099
272300*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *27230099
272400*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *27240099
272500*  THE USER.                                                     *27250099
272600*----------------------------------------------------------------*27260099
272700 6000-REFRESH-PANEL-FROM-TEMP.                                    27270099
272800                                                                  27280099
272900     IF  ASC-UPDATE-TSQ                                           27290099
273000         SET ASC-NO-TSQ-UPDATE TO TRUE                            27300099
273100         MOVE ZERO                 TO PV-SAVE-ITEM                27310099
273200                                      PV-SEL-QUEUE-ITEM           27320099
273300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27330099
273400                                   TO PV-HOLD-SELECTED-ITEMS      27340099
273500         MOVE +1                   TO PV-ITEMS-PROCESSED          27350099
273600         PERFORM 6100-UPDATE-TSQ                                  27360099
273700             UNTIL PV-ITEMS-PROCESSED >                           27370099
273800                                     PV-HOLD-SELECTED-ITEMS       27380099
273900         PERFORM 6010-DELETE-SEL-QUEUE                            27390099
274000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27400099
274100                    ASC-BLOCK-ENTRIES (2)                         27410099
274200     END-IF.                                                      27420099
274300                                                                  27430099
274400 EJECT                                                            27440099
274500*----------------------------------------------------------------*27450099
274600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27460099
274700*----------------------------------------------------------------*27470099
274800 6010-DELETE-SEL-QUEUE.                                           27480099
274900                                                                  27490099
275000     EXEC CICS                                                    27500099
275100         DELETEQ TS                                               27510099
275200             QUEUE (ASC-SEL-QUEUE-NAME)                           27520099
275300             RESP  (PV-CICS-RESP)                                 27530099
275400     END-EXEC.                                                    27540099
275500*                                                                 27550099
275600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27560099
275700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27570099
275800         CONTINUE                                                 27580099
275900     ELSE                                                         27590099
276000         SET DP013-CICS-ABEND TO TRUE                             27600099
276100         SET DP013-NO-ROLLBACK TO TRUE                            27610099
276200         MOVE '6010-DELETE-SEL-QUEUE'                             27620099
276300                        TO DP013-PARAGRAPH                        27630099
276400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27640099
276500                        TO DP013-MESSAGE-TEXT (1)                 27650099
276600         PERFORM DP013-0000-PROCESS-ABEND                         27660099
276700     END-IF.                                                      27670099
276800                                                                  27680099
276900 EJECT                                                            27690099
277000*----------------------------------------------------------------*27700099
277100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27710099
277200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27720099
277300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27730099
277400*    THE TEMP QUEUE.                                             *27740099
277500*----------------------------------------------------------------*27750099
277600 6100-UPDATE-TSQ.                                                 27760099
277700                                                                  27770099
277800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27780099
277900     PERFORM 6105-READ-SEL-QUEUE.                                 27790099
278000     PERFORM                                                      27800099
278100         VARYING TR112-IDX                                        27810099
278200         FROM 1 BY 1                                              27820099
278300         UNTIL ((PV-ITEMS-PROCESSED >                             27830099
278400                              PV-HOLD-SELECTED-ITEMS)             27840099
278500         OR (TR112-IDX GREATER THAN TR112-MAX-ITEMS))             27850099
278600         IF  TR112-ACTION-SW (TR112-IDX) > SPACE                  27860099
278700             PERFORM 6110-PROCESS-ITEMS                           27870099
278800         END-IF                                                   27880099
278900         ADD +1                TO PV-ITEMS-PROCESSED              27890099
279000     END-PERFORM.                                                 27900099
279100     PERFORM 6111-WRITE-LIST-QUEUE.                               27910099
279200                                                                  27920099
279300 EJECT                                                            27930099
279400*----------------------------------------------------------------*27940099
279500*    READ THE LIST QUEUE RECORD.                                 *27950099
279600*----------------------------------------------------------------*27960099
279700 6105-READ-SEL-QUEUE.                                             27970099
279800                                                                  27980099
279900     EXEC CICS                                                    27990099
280000          READQ TS                                                28000099
280100             QUEUE (ASC-SEL-QUEUE-NAME)                           28010099
280200             INTO  (TR112-PO-SELECT-RECORD)                       28020099
280300             ITEM  (PV-SEL-QUEUE-ITEM)                            28030099
280400             RESP  (PV-CICS-RESP)                                 28040099
280500     END-EXEC.                                                    28050099
280600*                                                                 28060099
280700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28070099
280800         CONTINUE                                                 28080099
280900     ELSE                                                         28090099
281000         SET DP013-CICS-ABEND      TO  TRUE                       28100099
281100         SET DP013-NO-ROLLBACK     TO  TRUE                       28110099
281200         MOVE '6105-READ-SEL-QUEUE'                               28120099
281300                                   TO  DP013-PARAGRAPH            28130099
281400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           28140099
281500                                   TO  DP013-MESSAGE-TEXT(1)      28150099
281600         PERFORM DP013-0000-PROCESS-ABEND                         28160099
281700     END-IF.                                                      28170099
281800                                                                  28180099
281900 EJECT                                                            28190099
282000*----------------------------------------------------------------*28200099
282100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*28210099
282200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*28220099
282300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *28230099
282400*----------------------------------------------------------------*28240099
282500 6110-PROCESS-ITEMS.                                              28250099
282600                                                                  28260099
282700     COMPUTE PV-ITEM = 1 + ((TR112-ITEM (TR112-IDX) - 1)          28270099
282800                     / PC-ITEMS-PER-PANEL).                       28280099
282900                                                                  28290099
283000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28300099
283100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28310099
283200             PERFORM 6111-WRITE-LIST-QUEUE                        28320099
283300         END-IF                                                   28330099
283400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    28340099
283500                                                                  28350099
283600         PERFORM 6112-READ-LIST-QUEUE                             28360099
283700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28370099
283800             CONTINUE                                             28380099
283900         END-IF                                                   28390099
284000     END-IF.                                                      28400099
284100                                                                  28410099
284200     COMPUTE PV-SUB = (TR112-ITEM (TR112-IDX)                     28420099
284300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28430099
284400     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        28440099
284500     MOVE LQW-SELECTED-SW (PV-SUB)                                28450099
284600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28460099
284700                                                                  28470099
284800     IF TR112-INQ (TR112-IDX)                                     28480099
284900        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             28490099
285000     END-IF.                                                      28500099
285100                                                                  28510099
285200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28520099
285300                                                                  28530099
285400 EJECT                                                            28540099
285500*----------------------------------------------------------------*28550099
285600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28560099
285700*----------------------------------------------------------------*28570099
285800 6111-WRITE-LIST-QUEUE.                                           28580099
285900                                                                  28590099
286000     EXEC CICS                                                    28600099
286100         WRITEQ TS                                                28610099
286200             QUEUE (ASC-LIST-QUEUE-NAME)                          28620099
286300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28630099
286400             ITEM  (PV-SAVE-ITEM)                                 28640099
286500             REWRITE                                              28650099
286600             RESP  (PV-CICS-RESP)                                 28660099
286700     END-EXEC.                                                    28670099
286800*                                                                 28680099
286900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28690099
287000         CONTINUE                                                 28700099
287100     ELSE                                                         28710099
287200         SET DP013-CICS-ABEND  TO  TRUE                           28720099
287300         SET DP013-NO-ROLLBACK TO  TRUE                           28730099
287400         MOVE '6111-WRITE-LIST-QUEUE'                             28740099
287500                               TO  DP013-PARAGRAPH                28750099
287600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28760099
287700                               TO  DP013-MESSAGE-TEXT(1)          28770099
287800         PERFORM DP013-0000-PROCESS-ABEND                         28780099
287900     END-IF.                                                      28790099
288000                                                                  28800099
288100 EJECT                                                            28810099
288200*----------------------------------------------------------------*28820099
288300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28830099
288400*----------------------------------------------------------------*28840099
288500 6112-READ-LIST-QUEUE.                                            28850099
288600                                                                  28860099
288700     EXEC CICS                                                    28870099
288800         READQ TS                                                 28880099
288900             QUEUE (ASC-LIST-QUEUE-NAME)                          28890099
289000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28900099
289100             ITEM  (PV-ITEM)                                      28910099
289200             RESP  (PV-CICS-RESP)                                 28920099
289300     END-EXEC.                                                    28930099
289400*                                                                 28940099
289500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28950099
289600         CONTINUE                                                 28960099
289700     ELSE                                                         28970099
289800         SET DP013-CICS-ABEND        TO TRUE                      28980099
289900         SET DP013-NO-ROLLBACK       TO TRUE                      28990099
290000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           29000099
290100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    29010099
290200                                     TO DP013-MESSAGE-TEXT(1)     29020099
290300         PERFORM DP013-0000-PROCESS-ABEND                         29030099
290400     END-IF.                                                      29040099
290500                                                                  29050099
290600 EJECT                                                            29060099
290700*----------------------------------------------------------------*29070099
290800*    ABEND PROCESSOR MODULE                                      *29080099
290900*----------------------------------------------------------------*29090099
291000                                                                  29100099
291100     COPY DPPD013.                                                29110099
