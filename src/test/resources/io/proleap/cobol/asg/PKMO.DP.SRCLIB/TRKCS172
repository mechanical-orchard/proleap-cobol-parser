000100*-----------------------*                                                 
000200 IDENTIFICATION DIVISION.                                                 
000300*-----------------------*                                                 
000400 PROGRAM-ID.    TRKCS172.                                                 
000500 AUTHOR.        MARGARET MORRISON.                                        
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000700 DATE-WRITTEN.  01/99.                                                    
000800 DATE-COMPILED.                                                           
000900                                                                          
001000*---------------------------------------------------------------*         
001100*    Y172 - CUSTOMS ENTRY LIST                                  *         
001200*                                                               *         
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE CUSTOMS ENTRIES   *         
001400*    OF A REQUESTED PO, CONTAINER, ENTRY, HOUSE BOL AND/OR      *         
001410*    MASTER BOL DEPENDING ON WHAT VARIABLES ARE PASSED FROM THE *         
001420*    CRIT SPEC.                                                 *         
001500*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001600                                                                          
001700 ENVIRONMENT DIVISION.                                                    
001800                                                                          
001900 DATA DIVISION.                                                           
002000                                                                          
002100 WORKING-STORAGE SECTION.                                                 
002200                                                                          
002300 01  DK-DB2-KEYS.                                                         
002400     15  DK-PO-NBR                      PIC S9(09)  COMP.                 
002500     15  DK-ENTRY-ID                    PIC X(12)   VALUE SPACES.         
002600     15  DK-CONTNR-ID                   PIC X(12)   VALUE SPACES.         
002610     15  DK-HSE-BOL-NBR                 PIC X(30)   VALUE SPACES.         
002620     15  DK-MSTR-BOL-NBR                PIC X(30)   VALUE SPACES.         
002700                                                                          
002800 01  PC-PROGRAM-CONSTANTS.                                                
002900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
003000                                                    'TR172A  '.           
003100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
003200                                                    'TRKM172 '.           
003300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
003400                                                    'TRKCS172'.           
003500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
003600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
003700     05  PC-PO-CRIT-SUMM-FORMAT         PIC  X(01)  VALUE '2'.            
003900     05  PC-N                           PIC  X(01)  VALUE 'N'.            
003910     05  PC-D                           PIC  X(01)  VALUE 'D'.            
003920     05  PC-U                           PIC  X(01)  VALUE 'U'.            
004000     05  PC-0001                        PIC  X(04)  VALUE '0001'.         
004100     05  PC-MULTI                       PIC  X(05)  VALUE 'MULTI'.        
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11             
004300                                                    COMP SYNC.            
004400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
004500                                                    COMP SYNC.            
004600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
004700                                                    +1000000              
004800                                                    COMP-3.               
004900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
005000                                                    COMP SYNC.            
005100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3               
005200                                                    COMP-3.               
005300     05  PC-INIT-DATE                   PIC  X(10)  VALUE                 
005400                                                    '0001-01-01'.         
005500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
005600                                                                          
005700     05  PC-TSYMSG-NUMBERS.                                               
005800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
005900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
006000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.          
006100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
006200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
006300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
006400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
006500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
006600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
006700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
006800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
006900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
007000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
007100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
007101         10  PC-TSYMSG-00778            PIC  9(05)  VALUE 00778.          
007102                                                                          
007103     05  PC-HISTORY-MSG                 PIC  X(40)  VALUE                 
007104                     'DELETED ENTRIES EXIST -- ACCESS F23     '.          
007200                                                                          
007300 01  PS-PROGRAM-SWITCHES.                                                 
007400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
007500         88  PS-NO-ERROR                            VALUE 'Y'.            
007600         88  PS-ERROR                               VALUE 'N'.            
007700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.            
007800         88  PS-COMMAREA-VALID                      VALUE 'Y'.            
007900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.            
008000                                                                          
008100 01  PV-PROGRAM-VARIABLES.                                                
008200     05  PV-SUB                         PIC S9(04)  VALUE +0              
008300                                                    COMP SYNC.            
008400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
008500                                                    COMP SYNC.            
008600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0              
008700                                                    COMP-3.               
008800     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0              
008900                                                    COMP-3.               
009000     05  PV-CONTNR-COUNT                PIC S9(09)  VALUE +0              
009100                                                    COMP-3.               
009200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
009300                                                    COMP-3.               
009400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
009500                                                    COMP-3.               
009600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
009700                                                    COMP-3.               
009800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
009900                                                    COMP-3.               
010000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
010100                                                    COMP-3.               
010200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
010300                                                    COMP SYNC.            
010400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
010500                                                    COMP SYNC.            
010600     05  PV-ITEM                        PIC S9(04)  VALUE +0              
010700                                                    COMP SYNC.            
010800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0              
010900                                                    COMP SYNC.            
011000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
011100                                                    COMP SYNC.            
011200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
011300                                                    COMP SYNC.            
011400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
011500                                                    COMP SYNC.            
011600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
011700                                                    COMP SYNC.            
011800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
011900                                                    COMP SYNC.            
012000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012100                                                    COMP SYNC.            
012200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
012300                                                    COMP SYNC.            
012400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
012500                                                    COMP SYNC.            
012600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
012700                                                    COMP SYNC.            
012800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
012900                                                    COMP SYNC.            
013000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
013100                                                    COMP SYNC.            
013200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
013300                                                    COMP SYNC.            
013400     05  PV-FORMAT-DATE.                                                  
013500         10  PV-FORMAT-MONTH            PIC XX.                           
013600         10  PV-FORMAT-SLASH            PIC X       VALUE '/'.            
013700         10  PV-FORMAT-DAY              PIC XX.                           
013800                                                                          
013810     05  PV-ENTRY-HDR-LINE.                                               
013820         10  PV-ENTRY-HDR-ENTRY-LIT     PIC X(11)   VALUE                 
013821                                                    'ENTRY....: '.        
013822         10  PV-ENTRY-HDR-ENTRY         PIC X(12)   VALUE SPACES.         
013823         10  FILLER                     PIC X(57)   VALUE SPACES.         
013824                                                                          
013825     05  PV-PO-HDR-LINE.                                                  
013826         10  PV-PO-HDR-PO-LIT           PIC X(11)   VALUE                 
013827                                                    'PO NBR...: '.        
013828         10  PV-PO-HDR-PO               PIC ZZZZZZZZ9.                    
013829         10  FILLER                     PIC X(2)    VALUE SPACES.         
013830         10  PV-PO-HDR-ENT-NME-DESC     PIC X(30)   VALUE SPACES.         
013831         10  FILLER                     PIC X(28)   VALUE SPACES.         
013832                                                                          
013833     05  PV-CONTNR-HDR-LINE.                                              
013834         10  PV-CONTNR-HDR-CONTNR-LIT   PIC X(11)   VALUE                 
013835                                                    'CONTAINER: '.        
013836         10  PV-CONTNR-HDR-CONTNR       PIC X(12)   VALUE SPACES.         
013837         10  FILLER                     PIC X(57)   VALUE SPACES.         
013838                                                                          
013839     05  PV-HBOL-HDR-LINE.                                                
013840         10  PV-HBOL-HDR-HBOL-LIT       PIC X(11)   VALUE                 
013841                                                    'HBOL.....: '.        
013842         10  PV-HBOL-HDR-HBOL           PIC X(30)   VALUE SPACES.         
013843         10  FILLER                     PIC X(39)   VALUE SPACES.         
013844                                                                          
013845     05  PV-MBOL-HDR-LINE.                                                
013846         10  PV-MBOL-HDR-MBOL-LIT       PIC X(11)   VALUE                 
013847                                                    'MBOL.....: '.        
013848         10  PV-MBOL-HDR-MBOL           PIC X(30)   VALUE SPACES.         
013849         10  FILLER                     PIC X(39)   VALUE SPACES.         
013850                                                                          
013851     05  PV-HBOL-MBOL-HDR-LINE.                                           
013852         10  PV-HBOL-MBOL-HDR-MBOL-LIT  PIC X(11)   VALUE                 
013853                                                    'MBOL.....: '.        
013854         10  PV-HBOL-MBOL-HDR-MBOL      PIC X(25)   VALUE SPACES.         
013855         10  FILLER                     PIC X(05)   VALUE SPACES.         
013856         10  PV-HBOL-MBOL-HDR-HBOL-LIT  PIC X(11)   VALUE                 
013857                                                    'HBOL.....: '.        
013858         10  PV-HBOL-MBOL-HDR-HBOL      PIC X(25)   VALUE SPACES.         
013859         10  FILLER                     PIC X(03)   VALUE SPACES.         
013860                                                                          
013870                                                                          
013900*----------------------------------------------------------------*        
014000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *        
014100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *        
014200*   APPLICATION-SPECIFIC COMMAREA.                               *        
014300*----------------------------------------------------------------*        
014400 01  LQW-LIST-QUEUE-WORK-AREA.                                            
014500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.          
014600     05  LQW-ITEM-ENTRIES               OCCURS 11   TIMES                 
014700                                        INDEXED BY  LQW-IDX.              
014800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.               
014900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).                       
015000         10  LQW-SELECTED-SW            PIC  X(01).                       
015100             88  LQW-SELECT                         VALUE 'S'.            
015200             88  LQW-DESELECT                       VALUE ' '.            
015300         10  LQW-ACTION                 PIC  X(03).                       
015400         10  LQW-ENTRY-ID               PIC  X(12).                       
015500         10  LQW-FILED-DTE              PIC  X(05).                       
015600         10  LQW-EXAM-DECLARED-DTE      PIC  X(05).                       
015700         10  LQW-REJECTED-DTE           PIC  X(05).                       
015800         10  LQW-EST-CLRD-DTE           PIC  X(05).                       
015810         10  LQW-ACT-CLRD-DTE           PIC  X(05).                       
015900         10  LQW-LIQ-DTE                PIC  X(05).                       
016000         10  LQW-LIQ-SUSP-DTE           PIC  X(05).                       
016100         10  LQW-PO-CNT                 PIC  9(02).                       
016200         10  LQW-CONTNR-CNT             PIC  9(02).                       
016210         10  LQW-ENT-ID                 PIC  S9(09) COMP.                 
016230         10  LQW-POE-CDE                PIC  X(03).                       
016240         10  LQW-LAST-TRN               PIC  X(05).                       
016250         10  LQW-HISTORY-IND            PIC  X(01).                       
016300                                                                          
016400 EJECT                                                                    
016500*---------------------------------------------------------------*         
016600*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          *         
016700*---------------------------------------------------------------*         
016800                                                                          
016900     COPY TRWS112.                                                        
017000                                                                          
017100 EJECT                                                                    
017200*---------------------------------------------------------------*         
017300*    MAP LAYOUT                                                 *         
017400*---------------------------------------------------------------*         
017500                                                                          
017600     COPY TRKM172.                                                        
017700                                                                          
017800 01  MR-OCCURS-LAYOUT                   REDEFINES  TR172AO.               
017910     05  FILLER                         PIC X(172).                       
018000                                                                          
018100     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.                  
018200         10  MR-SELECTL                 PIC S9(04) COMP.                  
018300         10  MR-SELECTA                 PIC  X(01).                       
018400         10  MR-SELECTC                 PIC  X(01).                       
018500         10  MR-SELECTH                 PIC  X(01).                       
018600         10  MR-SELECTI                 PIC  X(01).                       
018700                                                                          
018800         10  MR-ACTIONL                 PIC S9(04) COMP.                  
018900         10  MR-ACTIONA                 PIC  X(01).                       
019000         10  MR-ACTIONC                 PIC  X(01).                       
019100         10  MR-ACTIONH                 PIC  X(01).                       
019200         10  MR-ACTION                  PIC  X(03).                       
019300                                                                          
019400         10  MR-ENTRY-NBRL              PIC S9(04) COMP.                  
019500         10  MR-ENTRY-NBRA              PIC  X(01).                       
019600         10  MR-ENTRY-NBRC              PIC  X(01).                       
019700         10  MR-ENTRY-NBRH              PIC  X(01).                       
019800         10  MR-ENTRY-NBR               PIC  X(12).                       
019900                                                                          
020511         10  MR-POEL                    PIC S9(04) COMP.                  
020512         10  MR-POEA                    PIC  X(01).                       
020513         10  MR-POEC                    PIC  X(01).                       
020514         10  MR-POEH                    PIC  X(01).                       
020515         10  MR-POE                     PIC  X(03).                       
020516                                                                          
020520         10  MR-FILEDL                  PIC S9(04) COMP.                  
020530         10  MR-FILEDA                  PIC  X(01).                       
020540         10  MR-FILEDC                  PIC  X(01).                       
020550         10  MR-FILEDH                  PIC  X(01).                       
020560         10  MR-FILED                   PIC  X(05).                       
020570                                                                          
020600         10  MR-EXAML                   PIC S9(04) COMP.                  
020700         10  MR-EXAMA                   PIC  X(01).                       
020800         10  MR-EXAMC                   PIC  X(01).                       
020900         10  MR-EXAMH                   PIC  X(01).                       
021000         10  MR-EXAM                    PIC  X(05).                       
021100                                                                          
021200         10  MR-REJL                    PIC S9(04) COMP.                  
021300         10  MR-REJA                    PIC  X(01).                       
021400         10  MR-REJC                    PIC  X(01).                       
021500         10  MR-REJH                    PIC  X(01).                       
021600         10  MR-REJ                     PIC  X(05).                       
021700                                                                          
021800         10  MR-EST-CLRDL               PIC S9(04) COMP.                  
021900         10  MR-EST-CLRDA               PIC  X(01).                       
022000         10  MR-EST-CLRDC               PIC  X(01).                       
022100         10  MR-EST-CLRDH               PIC  X(01).                       
022200         10  MR-EST-CLRD                PIC  X(05).                       
022300                                                                          
022310         10  MR-ACT-CLRDL               PIC S9(04) COMP.                  
022320         10  MR-ACT-CLRDA               PIC  X(01).                       
022330         10  MR-ACT-CLRDC               PIC  X(01).                       
022340         10  MR-ACT-CLRDH               PIC  X(01).                       
022350         10  MR-ACT-CLRD                PIC  X(05).                       
022360                                                                          
022400         10  MR-LIQL                    PIC S9(04) COMP.                  
022500         10  MR-LIQA                    PIC  X(01).                       
022600         10  MR-LIQC                    PIC  X(01).                       
022700         10  MR-LIQH                    PIC  X(01).                       
022800         10  MR-LIQ                     PIC  X(05).                       
022900                                                                          
023000         10  MR-SLIQL                   PIC S9(04) COMP.                  
023100         10  MR-SLIQA                   PIC  X(01).                       
023200         10  MR-SLIQC                   PIC  X(01).                       
023300         10  MR-SLIQH                   PIC  X(01).                       
023400         10  MR-SLIQ                    PIC  X(05).                       
023500                                                                          
023600         10  MR-POL                     PIC S9(04) COMP.                  
023700         10  MR-POA                     PIC  X(01).                       
023800         10  MR-POC                     PIC  X(01).                       
023900         10  MR-POH                     PIC  X(01).                       
024000         10  MR-PO-CNT                  PIC  Z9.                          
024010         10  MR-PO-CNT-X REDEFINES MR-PO-CNT  PIC X(02).                  
024100                                                                          
024200         10  MR-CONTL                   PIC S9(04) COMP.                  
024300         10  MR-CONTA                   PIC  X(01).                       
024400         10  MR-CONTC                   PIC  X(01).                       
024500         10  MR-CONTH                   PIC  X(01).                       
024600         10  MR-CONTNR-CNT              PIC  Z9.                          
024610         10  MR-CONTNR-CNT-X REDEFINES MR-CONTNR-CNT PIC X(02).           
024700                                                                          
024710         10  MR-LAST-TRNL               PIC S9(04) COMP.                  
024720         10  MR-LAST-TRNA               PIC  X(01).                       
024730         10  MR-LAST-TRNC               PIC  X(01).                       
024740         10  MR-LAST-TRNH               PIC  X(01).                       
024750         10  MR-LAST-TRN                PIC  X(05).                       
024760                                                                          
024770         10  MR-HISTORYL                PIC S9(04) COMP.                  
024780         10  MR-HISTORYA                PIC  X(01).                       
024790         10  MR-HISTORYC                PIC  X(01).                       
024800         10  MR-HISTORYH                PIC  X(01).                       
024900         10  MR-HISTORY                 PIC  X(01).                       
024910                                                                          
025000 EJECT                                                                    
025100*---------------------------------------------------------------*         
025200*    ATTRIBUTE SETTINGS COPYBOOK.                               *         
025300*---------------------------------------------------------------*         
025400                                                                          
025500     COPY DPWS015.                                                        
025600                                                                          
025700 EJECT                                                                    
025800*---------------------------------------------------------------*         
025900*    FUNCTION KEYS COPYBOOK.                                    *         
026000*---------------------------------------------------------------*         
026100                                                                          
026200     COPY DPWS016.                                                        
026300                                                                          
026400 EJECT                                                                    
026500*---------------------------------------------------------------*         
026600*    NUMERIC EDIT LAYOUT.                                       *         
026700*---------------------------------------------------------------*         
026800                                                                          
026900     COPY DPWS010I.                                                       
027000                                                                          
027100 EJECT                                                                    
027200*---------------------------------------------------------------*         
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
027400*---------------------------------------------------------------*         
027500                                                                          
027600     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
027800 EJECT                                                                    
027900*---------------------------------------------------------------*         
028000*    STANDARD COMMAREA.                                         *         
028100*---------------------------------------------------------------*         
028200                                                                          
028300     COPY DPWS020.                                                        
028400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
028500                                                                          
028600*---------------------------------------------------------------*         
028700* INTER-APPLICATION COMMAREA.                                   *         
028800*   TRWS114 - IS THE INPUT LAYOUT FOR THIS PROGRAM FROM THE     *         
028900*             CUSTOMS CRIT SPEC PROGRAM.                        *         
029000*   TRWS114 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     *         
029100*             THIS PROGRAM TO CUSTOMS BOL AND CUSTOMS CONTAINER *         
029200*             AND CUSTOMS PO PROGRAMS AND CUSTOMS HISTORY.      *         
029300*---------------------------------------------------------------*         
029400                                                                          
029500         10  INTER-APPL-COMM-AREA       PIC X(200).                       
029900     COPY TRWS114.                                                        
030000                                                                          
030100*---------------------------------------------------------------*         
030200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
030300*---------------------------------------------------------------*         
030400         10  ASC-SPECIFIC-COMMAREA.                                       
030500             15  ASC-LIST-KEYS.                                           
030701                 20  ASC-KEY-PO-NBR.                                      
030702                     25  ASC-KEY-PO-NBR-N            PIC 9(09).           
030710                 20  ASC-KEY-CSTM-ENTRY-ID           PIC X(12).           
030720                 20  ASC-KEY-CONTNR-ID               PIC X(12).           
030730                 20  ASC-KEY-HSE-BOL-NBR             PIC X(30).           
030740                 20  ASC-KEY-MSTR-BOL-NBR            PIC X(30).           
030750                                                                          
030800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
030900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
031000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
031100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
031200                                                                          
031300                 20  ASC-ITEM-ARRAY.                                      
031400                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.                
031500                         30  ASC-LIST-ITEM-NUMBER                         
031600                                                     PIC S9(09)           
031700                                                     COMP-3.              
031800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).          
031900                             88  ASC-VALID-SELECT    VALUE ' '            
032000                                                           'S'            
032100                                                           'B'            
032200                                                           'E'.           
032300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.           
032400                             88  ASC-TEMP-SELECT     VALUE 'S'.           
032500                             88  ASC-TEMP-BEGIN      VALUE 'B'.           
032600                             88  ASC-TEMP-END        VALUE 'E'.           
032700                         30  ASC-SELECTED-SW         PIC  X(01).          
032800                             88  ASC-NO-SELECT       VALUE ' '.           
032900                             88  ASC-SELECT          VALUE 'S'.           
033000                             88  ASC-BEGIN           VALUE 'B'.           
033100                             88  ASC-END             VALUE 'E'.           
033200                         30  ASC-ACTION              PIC  X(03).          
033300                         30  ASC-CSTM-ENTR-ID        PIC  X(12).          
033400                         30  ASC-FILD                PIC  X(05).          
033500                         30  ASC-EXM                 PIC  X(05).          
033600                         30  ASC-REJ                 PIC  X(05).          
033700                         30  ASC-EST-CLRD            PIC  X(05).          
033710                         30  ASC-ACT-CLRD            PIC  X(05).          
033800                         30  ASC-LQDN                PIC  X(05).          
033900                         30  ASC-LQDN-SSPNN          PIC  X(05).          
034000                         30  ASC-PO-CNT              PIC  9(02).          
034100                         30  ASC-CONT-CNT            PIC  9(02).          
034110                         30  ASC-ENT-ID              PIC S9(09)           
034120                                                           COMP.          
034140                         30  ASC-POE                 PIC  X(03).          
034150                         30  ASC-LAST-TRN            PIC  X(05).          
034160                         30  ASC-HISTORY             PIC  X(01).          
034200                                                                          
034300             15  ASC-BLK-SUB                         PIC S9(04)           
034400                                                          COMP            
034500                                                          SYNC.           
034600             15  ASC-ITEM-SUB                        PIC S9(04)           
034700                                                          COMP            
034800                                                          SYNC.           
034900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
035000                                                          COMP-3.         
035100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
035200                                                          COMP-3.         
035300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
035400                                                          COMP-3.         
035500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
035600                                                          COMP-3.         
035700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
035800                                                          COMP-3.         
035900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
036000                                                          COMP            
036100                                                          SYNC.           
036200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
036300                                                          COMP-3.         
036400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
036500                                                          COMP-3.         
036600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
036700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
036800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
036900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).          
037000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.           
037100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.           
037200             15  ASC-LIST-QUEUE-NAME.                                     
037300                 20  ASC-LIST-TERM-ID                PIC  X(04).          
037400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
037500                                                          COMP-3.         
037600                 20  ASC-LIST-SEQ                    PIC  9(01).          
037700             15  ASC-SEL-QUEUE-NAME.                                      
037800                 20  ASC-SEL-TERM-ID                 PIC  X(04).          
037900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)           
038000                                                          COMP-3.         
038100                 20  ASC-SEL-SEQ                     PIC  9(01).          
038200             15  ASC-CURSOR-SW                       PIC  X(01).          
038300                 88  ASC-CONTNR-CURSOR               VALUE 'C'.           
038400                 88  ASC-VSL-CONTNR-CURSOR           VALUE 'V'.           
038500             15  ASC-START-ITEM-REQUEST.                                  
038600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
038700                                                                          
038800 EJECT                                                                    
038900*---------------------------------------------------------------*         
039000*    ABEND PROCESSING COPYBOOK.                                 *         
039100*---------------------------------------------------------------*         
039200                                                                          
039300     COPY DPWS013.                                                        
039400                                                                          
039500 EJECT                                                                    
039600*---------------------------------------------------------------*         
039700*    DB2 AREA FOR TIMCSEN                                       *         
039800*---------------------------------------------------------------*         
039900     EXEC SQL                                                             
040000          INCLUDE TIMCSEN                                                 
040100     END-EXEC.                                                            
040110*---------------------------------------------------------------*         
040120*    DB2 AREA FOR TAUCSEN                                       *         
040130*---------------------------------------------------------------*         
040140     EXEC SQL                                                             
040150          INCLUDE TAUCSEN                                                 
040160     END-EXEC.                                                            
040200*---------------------------------------------------------------*         
040300*    DB2 AREA FOR TIMCSPO                                       *         
040400*---------------------------------------------------------------*         
040500     EXEC SQL                                                             
040600          INCLUDE TIMCSPO                                                 
040700     END-EXEC.                                                            
040710*---------------------------------------------------------------*         
040720*    DB2 AREA FOR TAUCSPO                                       *         
040730*---------------------------------------------------------------*         
040740     EXEC SQL                                                             
040750          INCLUDE TAUCSPO                                                 
040760     END-EXEC.                                                            
040800*---------------------------------------------------------------*         
040900*    DB2 AREA FOR TIMCSCN                                       *         
041000*---------------------------------------------------------------*         
041100     EXEC SQL                                                             
041200          INCLUDE TIMCSCN                                                 
041300     END-EXEC.                                                            
041301*---------------------------------------------------------------*         
041302*    DB2 AREA FOR TAUCSCN                                       *         
041303*---------------------------------------------------------------*         
041304     EXEC SQL                                                             
041305          INCLUDE TAUCSCN                                                 
041306     END-EXEC.                                                            
041310*---------------------------------------------------------------*         
041320*    DB2 AREA FOR TIMCSBL                                       *         
041330*---------------------------------------------------------------*         
041340     EXEC SQL                                                             
041350          INCLUDE TIMCSBL                                                 
041360     END-EXEC.                                                            
041370*---------------------------------------------------------------*         
041380*    DB2 AREA FOR TAUCSBL                                       *         
041390*---------------------------------------------------------------*         
041391     EXEC SQL                                                             
041392          INCLUDE TAUCSBL                                                 
041393     END-EXEC.                                                            
041400*---------------------------------------------------------------*         
041500*    DB2 AREA FOR TENTNME                                       *         
041600*---------------------------------------------------------------*         
041700     EXEC SQL                                                             
041800          INCLUDE TENTNME                                                 
041900     END-EXEC.                                                            
041910*---------------------------------------------------------------*         
041920*    DB2 AREA FOR TEXTENT                                       *         
041930*---------------------------------------------------------------*         
041940     EXEC SQL                                                             
041950          INCLUDE TEXTENT                                                 
041960     END-EXEC.                                                            
042000*---------------------------------------------------------------*         
042100*    DB2 AREA FOR TPURCHS                                       *         
042200*---------------------------------------------------------------*         
042300     EXEC SQL                                                             
042400          INCLUDE TPURCHS                                                 
042500     END-EXEC.                                                            
042510*---------------------------------------------------------------*         
042520*    DB2 AREA FOR TIMPOE                                        *         
042530*---------------------------------------------------------------*         
042540     EXEC SQL                                                             
042550          INCLUDE TIMPOE                                                  
042560     END-EXEC.                                                            
042600*---------------------------------------------------------------*         
042700*    DB2 AREA FOR COMMUNICATIONS                                *         
042800*---------------------------------------------------------------*         
042900     EXEC SQL                                                             
043000          INCLUDE SQLCA                                                   
043100     END-EXEC.                                                            
043200*---------------------------------------------------------------*         
043300*    CURSOR FOR CUSTOMS ENTRY LIST FOR A REQUESTED PO FROM THE  *         
043310*    CRIT SPEC.                                                 *         
043400*---------------------------------------------------------------*         
043500                                                                          
043600     EXEC SQL                                                             
043700          DECLARE PO-CSR CURSOR                                           
043800          FOR SELECT DISTINCT                                             
043900                A.CSTM_ENTR_ID                                            
044000              , A.FILD_TMST                                               
044100              , A.EXM_TMST                                                
044200              , A.REJ_TMST                                                
044300              , A.EST_CLR_TMST                                            
044310              , A.ACTL_CLR_TMST                                           
044400              , A.LQDN_TMST                                               
044500              , A.LQDN_SSPNN_TMST                                         
044510              , A.ENT_ID                                                  
044520              , A.MOM_DEST_POE_CDE                                        
044530              , A.LAST_UPD_TMST                                           
044600          FROM                                                            
044700                TIMCSEN A                                                 
044800              , TIMCSPO B                                                 
044900          WHERE                                                           
045000                B.PO_NBR         = :DK-PO-NBR                             
045100          AND   B.CSTM_ENTR_ID   =  A.CSTM_ENTR_ID                        
045300          ORDER BY                                                        
045400                A.CSTM_ENTR_ID                                            
045500     END-EXEC.                                                            
045510*---------------------------------------------------------------*         
045520*    CURSOR FOR CUSTOMS ENTRY LIST FOR A REQUESTED ENTRY FROM   *         
045521*    THE CRIT SPEC.                                             *         
045530*---------------------------------------------------------------*         
045540                                                                          
045550     EXEC SQL                                                             
045560          DECLARE ENTRY-CSR CURSOR                                        
045570          FOR SELECT DISTINCT                                             
045580                A.CSTM_ENTR_ID                                            
045590              , A.FILD_TMST                                               
045591              , A.EXM_TMST                                                
045592              , A.REJ_TMST                                                
045593              , A.EST_CLR_TMST                                            
045594              , A.ACTL_CLR_TMST                                           
045595              , A.LQDN_TMST                                               
045596              , A.LQDN_SSPNN_TMST                                         
045597              , A.ENT_ID                                                  
045598              , A.MOM_DEST_POE_CDE                                        
045599              , A.LAST_UPD_TMST                                           
045600          FROM                                                            
045601                TIMCSEN A                                                 
045602          WHERE                                                           
045603                A.CSTM_ENTR_ID   = :DK-ENTRY-ID                           
045604          ORDER BY                                                        
045605                A.CSTM_ENTR_ID                                            
045606     END-EXEC.                                                            
045607*---------------------------------------------------------------*         
045608*    CURSOR FOR CUSTOMS ENTRY LIST FOR A REQUESTED CONTAINER    *         
045609*    FROM THE CRIT SPEC.                                        *         
045610*---------------------------------------------------------------*         
045611                                                                          
045612     EXEC SQL                                                             
045613          DECLARE CONTNR-CSR CURSOR                                       
045614          FOR SELECT DISTINCT                                             
045615                A.CSTM_ENTR_ID                                            
045616              , A.FILD_TMST                                               
045617              , A.EXM_TMST                                                
045618              , A.REJ_TMST                                                
045619              , A.EST_CLR_TMST                                            
045620              , A.ACTL_CLR_TMST                                           
045621              , A.LQDN_TMST                                               
045622              , A.LQDN_SSPNN_TMST                                         
045623              , A.ENT_ID                                                  
045624              , A.MOM_DEST_POE_CDE                                        
045625              , A.LAST_UPD_TMST                                           
045626          FROM                                                            
045638                TIMCSEN A                                                 
045639              , TIMCSCN B                                                 
045640          WHERE                                                           
045641                B.CONTNR_ID      = :DK-CONTNR-ID                          
045642          AND   B.CSTM_ENTR_ID   =  A.CSTM_ENTR_ID                        
045643          ORDER BY                                                        
045644                A.CSTM_ENTR_ID                                            
045645     END-EXEC.                                                            
045646*---------------------------------------------------------------*         
045647*    CURSOR FOR CUSTOMS ENTRY LIST FOR A REQUESTED HOUSE BILL OF*         
045648*    LADING FROM THE CRIT SPEC.                                 *         
045649*---------------------------------------------------------------*         
045650                                                                          
045651     EXEC SQL                                                             
045652          DECLARE HBOL-CSR CURSOR                                         
045653          FOR SELECT DISTINCT                                             
045654                A.CSTM_ENTR_ID                                            
045655              , A.FILD_TMST                                               
045656              , A.EXM_TMST                                                
045657              , A.REJ_TMST                                                
045658              , A.EST_CLR_TMST                                            
045659              , A.ACTL_CLR_TMST                                           
045660              , A.LQDN_TMST                                               
045661              , A.LQDN_SSPNN_TMST                                         
045662              , A.ENT_ID                                                  
045663              , A.MOM_DEST_POE_CDE                                        
045664              , A.LAST_UPD_TMST                                           
045665          FROM                                                            
045666                TIMCSEN A                                                 
045667              , TIMCSBL B                                                 
045668          WHERE                                                           
045669                B.HSE_BOL_NBR    = :DK-HSE-BOL-NBR                        
045670          AND   B.CSTM_ENTR_ID   =  A.CSTM_ENTR_ID                        
045671          ORDER BY                                                        
045672                A.CSTM_ENTR_ID                                            
045673     END-EXEC.                                                            
045674*---------------------------------------------------------------*         
045675*    CURSOR FOR CUSTOMS ENTRY LIST FOR A REQUESTED MASTER BILL  *         
045676*    OF LADING FROM THE CRIT SPEC.                              *         
045677*---------------------------------------------------------------*         
045678                                                                          
045679     EXEC SQL                                                             
045680          DECLARE MBOL-CSR CURSOR                                         
045681          FOR SELECT DISTINCT                                             
045682                A.CSTM_ENTR_ID                                            
045683              , A.FILD_TMST                                               
045684              , A.EXM_TMST                                                
045685              , A.REJ_TMST                                                
045686              , A.EST_CLR_TMST                                            
045687              , A.ACTL_CLR_TMST                                           
045688              , A.LQDN_TMST                                               
045689              , A.LQDN_SSPNN_TMST                                         
045690              , A.ENT_ID                                                  
045691              , A.MOM_DEST_POE_CDE                                        
045692              , A.LAST_UPD_TMST                                           
045693          FROM                                                            
045694                TIMCSEN A                                                 
045695              , TIMCSBL B                                                 
045696          WHERE                                                           
045697                B.MSTR_BOL_NBR   = :DK-MSTR-BOL-NBR                       
045698          AND   B.CSTM_ENTR_ID   =  A.CSTM_ENTR_ID                        
045699          ORDER BY                                                        
045700                A.CSTM_ENTR_ID                                            
045701     END-EXEC.                                                            
045702*---------------------------------------------------------------*         
045703*    CURSOR FOR CUSTOMS ENTRY LIST FOR A REQUESTED MASTER BILL  *         
045704*    OF LADING AND HOUSE BILL OF LADING FROM THE CRIT SPEC.     *         
045705*---------------------------------------------------------------*         
045706                                                                          
045707     EXEC SQL                                                             
045708          DECLARE HBOL-MBOL-CSR CURSOR                                    
045709          FOR SELECT DISTINCT                                             
045710                A.CSTM_ENTR_ID                                            
045711              , A.FILD_TMST                                               
045712              , A.EXM_TMST                                                
045713              , A.REJ_TMST                                                
045714              , A.EST_CLR_TMST                                            
045715              , A.ACTL_CLR_TMST                                           
045716              , A.LQDN_TMST                                               
045717              , A.LQDN_SSPNN_TMST                                         
045718              , A.ENT_ID                                                  
045719              , A.MOM_DEST_POE_CDE                                        
045720              , A.LAST_UPD_TMST                                           
045721          FROM                                                            
045722                TIMCSEN A                                                 
045723              , TIMCSBL B                                                 
045724          WHERE                                                           
045725                B.MSTR_BOL_NBR   = :DK-MSTR-BOL-NBR                       
045726          AND   B.HSE_BOL_NBR    = :DK-HSE-BOL-NBR                        
045727          AND   B.CSTM_ENTR_ID   =  A.CSTM_ENTR_ID                        
045728          ORDER BY                                                        
045729                A.CSTM_ENTR_ID                                            
045730     END-EXEC.                                                            
045731                                                                          
045732*---------------------------------------------------------------* 03880099
045733*    CURSOR DECLARATION FOR SELECTING POE CODE.                 *         
045734*---------------------------------------------------------------* 03900099
045735                                                                  03910099
045736     EXEC SQL                                                     03920099
045737          DECLARE  POE-CSR CURSOR                                 03930099
045738              FOR  SELECT DISTINCT                                03940099
045739                   POE_CDE                                                
045740             FROM  TIMPOE                                                 
045741            WHERE  POE_STD_EDI_CDE = :IMCSEN-MOM-DEST-POE-CDE             
045742              AND  STAT_CDE        = 'A'                                  
045743         ORDER BY  POE_CDE                                                
045744     END-EXEC.                                                            
045745                                                                          
045746 EJECT                                                            04110099
045747*----------------------------------------------------------------*        
045750 LINKAGE SECTION.                                                         
045800                                                                          
045900 01  DFHCOMMAREA.                                                         
046000     05  FILLER                         OCCURS  1 TO 4072 TIMES           
046100                                        DEPENDING ON EIBCALEN.            
046200         10  FILLER                     PIC X.                            
046300                                                                          
046400 EJECT                                                                    
046510*----------------------------------------------------------------*        
046600 PROCEDURE DIVISION.                                                      
046700*----------------------------------------------------------------*        
046800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *        
046900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *        
047000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *        
047100*----------------------------------------------------------------*        
047200 0000-MAIN-MODULE.                                                        
047300                                                                          
047400     INITIALIZE DP030-CICS-API-FIELDS.                                    
047500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
047600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
047700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
047800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
047900     MOVE LENGTH OF TR172AI        TO DP030-MAP-LENGTH (1).               
048000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
048100     PERFORM 0001-CALL-CICS-ARCH-API.                                     
048200*                                                                         
048300     PERFORM 1000-CONTROL-PROCESSING.                                     
048400*                                                                         
048500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
048600     PERFORM 0001-CALL-CICS-ARCH-API.                                     
048700                                                                          
048800*----------------------------------------------------------------*        
048900*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *        
049000*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *        
049100*----------------------------------------------------------------*        
049200 0001-CALL-CICS-ARCH-API.                                                 
049300                                                                          
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
049500                                    DFHCOMMAREA                           
049600                                    DP030-CICS-API-FIELDS                 
049700                                    DP020-STANDARD-COMMAREA               
049800                                    TR172AI.                              
049900*                                                                         
050000     IF  DP030-RC-CALL-SUCCESSFUL                                         
050100         CONTINUE                                                         
050200     ELSE                                                                 
050300         SET DP013-NO-ROLLBACK                                            
050400             DP013-XCTL-DISPLAY-RESTART                                   
050500             DP013-CICS-ABEND      TO TRUE                                
050600         MOVE '0001-CALL-CICS-ARCH-API'                                   
050700                                   TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
051000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
051100         PERFORM DP013-0000-PROCESS-ABEND                                 
051200     END-IF.                                                              
051300                                                                          
051400 EJECT                                                                    
051500*----------------------------------------------------------------*        
051600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
051700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
051800*                                                                *        
051900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
052000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
052100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
052200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
052300*----------------------------------------------------------------*        
052400 1000-CONTROL-PROCESSING.                                                 
052500                                                                          
052600     EVALUATE TRUE                                                        
052700         WHEN DP020-NEXT-ACT-INITIAL                                      
052800             INITIALIZE ASC-SPECIFIC-COMMAREA                             
052900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
053000                                      ASC-SEL-TERM-ID                     
053100             MOVE DP020-SRC-TASK-NUMBER                                   
053200                                   TO ASC-LIST-TASK-NUMBER                
053300                                      ASC-SEL-TASK-NUMBER                 
053400             MOVE PC-LIST-QUEUE-SEQ                                       
053500                                   TO ASC-LIST-SEQ                        
053600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                         
053700             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
053800*-------$TEMPLATE NOTE$------------------------------------------*        
053900* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *        
054000* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *        
054100* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *        
054200*----------------------------------------------------------------*        
054300             IF  PS-COMMAREA-NOT-VALID                                    
054400                 SET DP020-NEXT-ACT-APPL-ERROR                            
054500                                   TO TRUE                                
054600             ELSE                                                         
054700                 PERFORM 4000-BUILD-INITIAL-PANEL                         
054800             END-IF                                                       
054900                                                                          
055000         WHEN DP020-NEXT-ACT-READ-MAP                                     
055100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
055200                                   TO PV-TOP-ITEM                         
055300             PERFORM 2000-PROCESS-PANEL                                   
055400                                                                          
055500         WHEN DP020-NEXT-ACT-RETURN                                       
055600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
055700                                   TO PV-TOP-ITEM                         
055800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
055900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                         
056000             MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR                     
056010             MOVE ASC-KEY-CSTM-ENTRY-ID  TO DK-ENTRY-ID                   
056020             MOVE ASC-KEY-CONTNR-ID      TO DK-CONTNR-ID                  
056030             MOVE ASC-KEY-HSE-BOL-NBR    TO DK-HSE-BOL-NBR                
056040             MOVE ASC-KEY-MSTR-BOL-NBR   TO DK-MSTR-BOL-NBR               
056100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
056200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
056300                                                                          
056400         WHEN OTHER                                                       
056500             SET DP013-LOGIC-ABEND TO TRUE                                
056600             SET DP013-NO-ROLLBACK TO TRUE                                
056700             MOVE '1000-CONTROL-PROCESSING'                               
056800                                   TO DP013-PARAGRAPH                     
056900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
057000                                   TO DP013-MESSAGE-TEXT(1)               
057100             PERFORM DP013-0000-PROCESS-ABEND                             
057200     END-EVALUATE.                                                        
057300                                                                          
057400 EJECT                                                                    
057500*----------------------------------------------------------------*        
057600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *        
057700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *        
057800*----------------------------------------------------------------*        
057900 1100-PROCESS-INTER-APPL-COMM.                                            
058000                                                                          
058100     SET PS-COMMAREA-VALID         TO TRUE.                               
058200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.             
058300     IF  DP020-NAV-KEY-DATA > SPACE                                       
058400         MOVE DP020-NAV-KEY-DATA                                          
058500                                TO ASC-KEY-PO-NBR-N                       
058600                                   DK-PO-NBR                              
058700     ELSE                                                                 
058800         MOVE TR114-PO-NBR        TO ASC-KEY-PO-NBR                       
058900                                     DK-PO-NBR                            
058910         MOVE TR114-CSTM-ENTRY-ID TO ASC-KEY-CSTM-ENTRY-ID                
058911                                     DK-ENTRY-ID                          
058920         MOVE TR114-CONTNR-ID     TO ASC-KEY-CONTNR-ID                    
058921                                     DK-CONTNR-ID                         
058930         MOVE TR114-HSE-BOL-NBR   TO ASC-KEY-HSE-BOL-NBR                  
058931                                     DK-HSE-BOL-NBR                       
058940         MOVE TR114-MSTR-BOL-NBR  TO ASC-KEY-MSTR-BOL-NBR                 
058950                                     DK-MSTR-BOL-NBR                      
059000     END-IF.                                                              
059100                                                                          
059200 EJECT                                                                    
059300*----------------------------------------------------------------*        
059400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *        
059500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
059600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
059700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
059800* FUNCTION KEYS CAN GET THIS FAR.                                *        
059900*----------------------------------------------------------------*        
060000 2000-PROCESS-PANEL.                                                      
060100                                                                          
060200     EVALUATE TRUE                                                        
060300         WHEN DP020-SRC-AID = DP016-CLEAR                                 
060400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
060500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
060600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
060700                                                                          
060800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
060900             MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR                     
060910             MOVE ASC-KEY-CSTM-ENTRY-ID  TO DK-ENTRY-ID                   
060920             MOVE ASC-KEY-CONTNR-ID      TO DK-CONTNR-ID                  
060930             MOVE ASC-KEY-HSE-BOL-NBR    TO DK-HSE-BOL-NBR                
060940             MOVE ASC-KEY-MSTR-BOL-NBR   TO DK-MSTR-BOL-NBR               
061000             PERFORM 2050-DELETE-LIST-QUEUE                               
061100             PERFORM 4000-BUILD-INITIAL-PANEL                             
061200                                                                          
061300         WHEN OTHER                                                       
061400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
061500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
061600             IF  PS-NO-ERROR                                              
061700                 SET DP030-CONTINUE-GO                                    
061800                                 TO TRUE                                  
061900                 PERFORM 2100-CHECK-FUNCTION-KEY                          
062000             ELSE                                                         
062100                 SET DP030-OVERRIDE-GO                                    
062200                                 TO TRUE                                  
062300             END-IF                                                       
062400     END-EVALUATE.                                                        
062500                                                                          
062600 EJECT                                                                    
062700*----------------------------------------------------------------*        
062800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
062900*----------------------------------------------------------------*        
063000 2050-DELETE-LIST-QUEUE.                                                  
063100                                                                          
063200     EXEC CICS                                                            
063300         DELETEQ TS                                                       
063400             QUEUE (ASC-LIST-QUEUE-NAME)                                  
063500             RESP  (PV-CICS-RESP)                                         
063600     END-EXEC.                                                            
063700                                                                          
063800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
063900        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
064000         CONTINUE                                                         
064100     ELSE                                                                 
064200         SET DP013-CICS-ABEND      TO TRUE                                
064300         SET DP013-NO-ROLLBACK     TO TRUE                                
064400                                                                          
064500         MOVE '2050-DELETE-LIST-QUEUE'                                    
064600                                   TO DP013-PARAGRAPH                     
064700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
064800                                   TO DP013-MESSAGE-TEXT (1)              
064900         PERFORM DP013-0000-PROCESS-ABEND                                 
065000     END-IF.                                                              
065100                                                                          
065200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
065300                                                                          
065400 EJECT                                                                    
065500*----------------------------------------------------------------*        
065600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
065700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
065800* CICS ARCHITECTURE API.                                         *        
065900*----------------------------------------------------------------*        
066000 2100-CHECK-FUNCTION-KEY.                                                 
066100                                                                          
066200     EVALUATE TRUE                                                        
066300                                                                          
066400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
066500            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                           
066600              INITIALIZE         TR114-INTER-APPL-COMMAREA                
066700              MOVE ASC-KEY-PO-NBR TO TR114-PO-NBR                         
066800              PERFORM 5000-PREPARE-SEL-QUEUE                              
066900            ELSE                                                          
067000              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                         
067100                SET DP030-OVERRIDE-GO TO TRUE                             
067200                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER                 
067300                SET DP020-MSG-WARNING TO TRUE                             
067400              ELSE                                                        
067500                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                       
067600                  SET DP030-OVERRIDE-GO TO TRUE                           
067700                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER               
067800                  SET DP020-MSG-WARNING TO TRUE                           
067900                END-IF                                                    
068000              END-IF                                                      
068100            END-IF                                                        
068200         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
068300*  LIST CUSTOMS BILLS OF LADING                                           
068310         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                      
068320*  LIST CUSTOMS ENTRY CONTAINERS                                          
068330         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)                      
068340*  LIST CUSTOMS PURCHASE ORDERS                                           
068341         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                      
068350*  LIST CUSTOMS ENTRY CHANGE HISTORY                                      
068400             EVALUATE TRUE                                                
068500             WHEN ASC-NUMBER-OF-SELECTED-ITEMS = 1                        
068600                 INITIALIZE TR114-INTER-APPL-COMMAREA                     
068700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        
068800                                       TO                                 
068900                            TR114-NUMBER-OF-SELECTED-ITEMS                
069000                 MOVE ASC-KEY-PO-NBR   TO TR114-PO-NBR                    
069100                 PERFORM 5001-PREPARE-SEL-QUEUE                           
069200             WHEN ASC-NUMBER-OF-SELECTED-ITEMS > 1                        
069300                SET DP030-OVERRIDE-GO TO TRUE                             
069400                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER                 
069500                SET DP020-MSG-WARNING TO TRUE                             
069600             WHEN OTHER                                                   
069700                  SET DP030-OVERRIDE-GO TO TRUE                           
069800                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER               
069900                  SET DP020-MSG-WARNING TO TRUE                           
070000             END-EVALUATE                                                 
070001                                                                          
070010         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                      
070020*  LIST CUSTOMS ENTRY DELETE HISTORY                                      
070030             EVALUATE TRUE                                                
070040             WHEN ASC-NUMBER-OF-SELECTED-ITEMS < 1                        
070050                 INITIALIZE TR114-INTER-APPL-COMMAREA                     
070060                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        
070070                                       TO                                 
070080                            TR114-NUMBER-OF-SELECTED-ITEMS                
070090                 MOVE ASC-KEY-PO-NBR        TO TR114-PO-NBR               
070091                 MOVE ASC-KEY-CSTM-ENTRY-ID TO TR114-CSTM-ENTRY-ID        
070092                 MOVE ASC-KEY-CONTNR-ID     TO TR114-CONTNR-ID            
070093                 MOVE ASC-KEY-HSE-BOL-NBR   TO TR114-HSE-BOL-NBR          
070094                 MOVE ASC-KEY-MSTR-BOL-NBR  TO TR114-MSTR-BOL-NBR         
070098                 PERFORM 5001-PREPARE-SEL-QUEUE                           
070099             WHEN ASC-NUMBER-OF-SELECTED-ITEMS = 1                        
070100             WHEN ASC-NUMBER-OF-SELECTED-ITEMS > 1                        
070101                SET DP030-OVERRIDE-GO TO TRUE                             
070103                MOVE PC-TSYMSG-00778  TO DP020-MSG-NUMBER                 
070104                SET DP020-MSG-WARNING TO TRUE                             
070109             END-EVALUATE                                                 
070110                                                                          
070200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
070300             MOVE +1               TO PV-TOP-ITEM                         
070400             MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR                     
070410             MOVE ASC-KEY-CSTM-ENTRY-ID  TO DK-ENTRY-ID                   
070420             MOVE ASC-KEY-CONTNR-ID      TO DK-CONTNR-ID                  
070430             MOVE ASC-KEY-HSE-BOL-NBR    TO DK-HSE-BOL-NBR                
070440             MOVE ASC-KEY-MSTR-BOL-NBR   TO DK-MSTR-BOL-NBR               
070500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
070600             PERFORM 3200-RESET-ATTRIBUTES                                
070700                                                                          
070800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
070900             PERFORM 2110-BROWSE-BACKWARD                                 
071000             MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR                     
071010             MOVE ASC-KEY-CSTM-ENTRY-ID  TO DK-ENTRY-ID                   
071020             MOVE ASC-KEY-CONTNR-ID      TO DK-CONTNR-ID                  
071030             MOVE ASC-KEY-HSE-BOL-NBR    TO DK-HSE-BOL-NBR                
071040             MOVE ASC-KEY-MSTR-BOL-NBR   TO DK-MSTR-BOL-NBR               
071100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
071200             PERFORM 3200-RESET-ATTRIBUTES                                
071300                                                                          
071400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
071500             PERFORM 2120-BROWSE-FORWARD                                  
071600             MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR                     
071610             MOVE ASC-KEY-CSTM-ENTRY-ID  TO DK-ENTRY-ID                   
071620             MOVE ASC-KEY-CONTNR-ID      TO DK-CONTNR-ID                  
071630             MOVE ASC-KEY-HSE-BOL-NBR    TO DK-HSE-BOL-NBR                
071640             MOVE ASC-KEY-MSTR-BOL-NBR   TO DK-MSTR-BOL-NBR               
071700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
071800                                                                          
071900         WHEN DP020-SRC-AID = DP016-ENTER                                 
072000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
072100             IF  PS-ERROR                                                 
072200                 CONTINUE                                                 
072300             ELSE                                                         
072500                 MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR                 
072510                 MOVE ASC-KEY-CSTM-ENTRY-ID  TO DK-ENTRY-ID               
072520                 MOVE ASC-KEY-CONTNR-ID      TO DK-CONTNR-ID              
072530                 MOVE ASC-KEY-HSE-BOL-NBR    TO DK-HSE-BOL-NBR            
072540                 MOVE ASC-KEY-MSTR-BOL-NBR   TO DK-MSTR-BOL-NBR           
072600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
072700                 PERFORM 3200-RESET-ATTRIBUTES                            
072800             END-IF                                                       
072900                                                                          
073000         WHEN OTHER                                                       
073100             SET DP013-NO-ROLLBACK                                        
073200                 DP013-XCTL-DISPLAY-RESTART                               
073300                 DP013-CICS-ABEND  TO TRUE                                
073400             MOVE '2100-CHECK-FUNCTION-KEY'                               
073500                                   TO DP013-PARAGRAPH                     
073600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
073700                                   TO DP013-MESSAGE-TEXT (1)              
073800             PERFORM DP013-0000-PROCESS-ABEND                             
073900     END-EVALUATE.                                                        
074000                                                                          
074100 EJECT                                                                    
074200*----------------------------------------------------------------*        
074300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
074400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
074500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
074600*    MESSAGE.                                                    *        
074700*----------------------------------------------------------------*        
074800 2110-BROWSE-BACKWARD.                                                    
074900                                                                          
075000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
075100         GIVING PV-TOP-ITEM.                                              
075200*                                                                         
075300     IF  ((PV-TOP-ITEM < +1)                                              
075400       OR (PV-TOP-ITEM = +1))                                             
075500         MOVE +1                   TO PV-TOP-ITEM                         
075600*------- TOP OF LIST -----                                                
075700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
075800         SET DP020-MSG-INFORMATIONAL TO TRUE                              
075900     END-IF.                                                              
076000                                                                          
076100 EJECT                                                                    
076200*----------------------------------------------------------------*        
076300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
076400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
076500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
076600*----------------------------------------------------------------*        
076700 2120-BROWSE-FORWARD.                                                     
076800                                                                          
076900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
077000         GIVING PV-TOP-ITEM.                                              
077100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
077200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
077300                                   TO PV-TOP-ITEM                         
077400*------- BOTTOM OF LIST -----------                                       
077500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
077600         SET DP020-MSG-INFORMATIONAL                                      
077700                                   TO TRUE                                
077800     ELSE                                                                 
077900         COMPUTE PV-BOTTOM-ITEM =                                         
078000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
078100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
078200*----------- BOTTOM OF LIST ---------                                     
078300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
078400             SET DP020-MSG-INFORMATIONAL                                  
078500                                   TO TRUE                                
078600         END-IF                                                           
078700     END-IF.                                                              
078800                                                                          
078900 EJECT                                                                    
079000*----------------------------------------------------------------*        
079100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
079200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
079300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
079400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *        
079500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
079600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
079700*----------------------------------------------------------------*        
079800 2130-CHECK-FOR-JUMP-BROWSE.                                              
079900                                                                          
080000     SET PS-NO-ERROR               TO TRUE.                               
080100     IF  (ASC-START-ITEM-REQUEST = SPACE)                                 
080200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
080300                                   TO PV-TOP-ITEM                         
080400     ELSE                                                                 
080500         MOVE ASC-START-ITEM-REQUEST                                      
080600                                   TO DP010I-UNEDITED-FIELD               
080700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
080800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
080900         SET DP010I-NEGATIVE-NOT-ALLOWED                                  
081000                                   TO TRUE                                
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
081200                                                                          
081300         IF  NOT DP010I-ERROR-DETECTED                                    
081400             MOVE DP010I-NUMERIC-FIELD                                    
081500                                   TO  ASC-START-ITEM-REQUEST-N           
081600             IF  ASC-START-ITEM-REQUEST-N > ZERO                          
081700                 IF  ASC-START-ITEM-REQUEST-N >                           
081800                                          ASC-NUMBER-OF-ITEMS-READ        
081900                     MOVE SPACE TO ASC-START-ITEM-REQUEST                 
082000                     COMPUTE PV-TOP-ITEM =                                
082100                             ASC-NUMBER-OF-ITEMS-READ                     
082200                             - PC-ITEMS-PER-PANEL + 1                     
082300                     IF  PV-TOP-ITEM < +1                                 
082400                         MOVE +1   TO PV-TOP-ITEM                         
082500                         MOVE PC-TSYMSG-00070                             
082600                                   TO DP020-MSG-NUMBER                    
082700                         SET DP020-MSG-INFORMATIONAL                      
082800                                   TO TRUE                                
082900                     END-IF                                               
083000                 ELSE                                                     
083100                     MOVE ASC-START-ITEM-REQUEST-N                        
083200                                   TO PV-TOP-ITEM                         
083300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST              
083400                     COMPUTE PV-BOTTOM-ITEM =                             
083500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
083600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
083700*----------------------- BOTTOM OF LIST --------------                    
083800                         MOVE PC-TSYMSG-00070                             
083900                                   TO DP020-MSG-NUMBER                    
084000                         SET DP020-MSG-INFORMATIONAL                      
084100                                   TO TRUE                                
084200                     END-IF                                               
084300                 END-IF                                                   
084400             ELSE                                                         
084500*--------------- VALUE OUT OF RANGE ------------------                    
084600                 MOVE PC-TSYMSG-00101                                     
084700                                   TO DP020-MSG-NUMBER                    
084800                 MOVE -1           TO ASTRTITL                            
084900                 SET DP030-SET-CURSOR-APPL-1                              
085000                                   TO TRUE                                
085100                 MOVE DP015-REVERSE                                       
085200                                   TO ASTRTITH                            
085300                 MOVE DP015-RED    TO ASTRTITC                            
085400                 MOVE DP015-UNP-NUM-BRT-MDT                               
085500                                   TO ASTRTITA                            
085600                 SET DP020-MSG-FATAL                                      
085700                                   TO TRUE                                
085800                 SET PS-ERROR      TO TRUE                                
085900             END-IF                                                       
086000                                                                          
086100         ELSE                                                             
086200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
086300             MOVE -1               TO ASTRTITL                            
086400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
086500             MOVE DP015-REVERSE    TO ASTRTITH                            
086600             MOVE DP015-RED        TO ASTRTITC                            
086700             MOVE DP015-UNP-NUM-BRT-MDT                                   
086800                                   TO ASTRTITA                            
086900             SET DP020-MSG-FATAL   TO TRUE                                
087000             SET PS-ERROR          TO TRUE                                
087100         END-IF                                                           
087200     END-IF.                                                              
087300                                                                          
087400 EJECT                                                                    
087500*----------------------------------------------------------------*        
087600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *        
087700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *        
087800*----------------------------------------------------------------*        
087900 2140-DESELECT-ALL-ITEMS.                                                 
088000                                                                          
088100     MOVE +1                       TO ASC-BLK-SUB.                        
088200                                                                          
088300     PERFORM 2141-CLEAR-SELECTED-INDS                                     
088400         VARYING ASC-ITEM-SUB                                             
088500         FROM 1 BY 1                                                      
088600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
088700                                                                          
088800     ADD +1                        TO ASC-BLK-SUB.                        
088900                                                                          
089000     PERFORM 2141-CLEAR-SELECTED-INDS                                     
089100         VARYING ASC-ITEM-SUB                                             
089200         FROM 1 BY 1                                                      
089300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
089400                                                                          
089500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
089600                                   TO PV-LIST-ITEM-NUMBER.                
089700                                                                          
089800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
089900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
090000                                                                          
090100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
090200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)              
090300         MOVE +1                   TO ASC-BLK-SUB                         
090400                                                                          
090500         PERFORM 5100-WRITE-TEMP-STORAGE                                  
090600                                                                          
090700         MOVE +1                   TO PV-BLOCK-NUMBER                     
090800                                                                          
090900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
091000             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
091100                                                                          
091200         PERFORM                                                          
091300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
091400                                                                          
091500             PERFORM 4410-READ-TEMP-STORAGE                               
091600                                                                          
091700             PERFORM 2141-CLEAR-SELECTED-INDS                             
091800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                         
091900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
092000                                                                          
092100             PERFORM 5100-WRITE-TEMP-STORAGE                              
092200                                                                          
092300             ADD +1                TO PV-BLOCK-NUMBER                     
092400                                                                          
092500         END-PERFORM                                                      
092600                                                                          
092700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
092800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
092900                                                                          
093000         PERFORM                                                          
093100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
093200                   ASC-HIGHEST-BLOCK-WRITTEN                              
093300                                                                          
093400             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
093500                                   TO PV-BLOCK-NUMBER                     
093600                                                                          
093700             PERFORM 4410-READ-TEMP-STORAGE                               
093800                                                                          
093900             PERFORM 2141-CLEAR-SELECTED-INDS                             
094000                 VARYING ASC-ITEM-SUB                                     
094100                 FROM 1 BY 1                                              
094200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
094300                                                                          
094400             PERFORM 5100-WRITE-TEMP-STORAGE                              
094500                                                                          
094600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
094700                                                                          
094800         END-PERFORM                                                      
094900                                                                          
095000         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
095100                                   TO PV-BLOCK-NUMBER                     
095200                                                                          
095300         PERFORM 4410-READ-TEMP-STORAGE                                   
095400     END-IF.                                                              
095500                                                                          
095600     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS        
095700                                      ASC-START-OF-SELECTED-RANGE         
095800                                      ASC-END-OF-SELECTED-RANGE.          
095900                                                                          
096000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
096100                                                                          
096200 EJECT                                                                    
096300*----------------------------------------------------------------*        
096400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *        
096500*----------------------------------------------------------------*        
096600 2141-CLEAR-SELECTED-INDS.                                                
096700                                                                          
096800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
096900             NOT EQUAL ZERO                                               
097000         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
097100             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
097200                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            
097300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
097400                                   TO TRUE                                
097500         END-IF                                                           
097600     END-IF.                                                              
097700                                                                          
097800 EJECT                                                                    
097900*----------------------------------------------------------------*        
098000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *        
098100*  FOR ALL ITEMS.                                                *        
098200*----------------------------------------------------------------*        
098300 2150-SELECT-ALL-ITEMS.                                                   
098400                                                                          
098500     MOVE +1                       TO ASC-BLK-SUB.                        
098600                                                                          
098700     PERFORM 2151-SET-SELECTED-INDS                                       
098800         VARYING ASC-ITEM-SUB                                             
098900         FROM 1 BY 1                                                      
099000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
099100                                                                          
099200     ADD +1                        TO ASC-BLK-SUB.                        
099300                                                                          
099400     PERFORM 2151-SET-SELECTED-INDS                                       
099500         VARYING ASC-ITEM-SUB                                             
099600         FROM 1 BY 1                                                      
099700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
099800                                                                          
099900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
100000                                   TO PV-LIST-ITEM-NUMBER.                
100100                                                                          
100200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
100300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
100400                                                                          
100500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
100600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)            
100700         MOVE +1                   TO ASC-BLK-SUB                         
100800                                                                          
100900         PERFORM 5100-WRITE-TEMP-STORAGE                                  
101000                                                                          
101100         MOVE +1                   TO PV-BLOCK-NUMBER                     
101200                                                                          
101300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
101400             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
101500                                                                          
101600         PERFORM                                                          
101700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
101800                                                                          
101900             PERFORM 4410-READ-TEMP-STORAGE                               
102000                                                                          
102100             PERFORM 2151-SET-SELECTED-INDS                               
102200                 VARYING ASC-ITEM-SUB                                     
102300                 FROM 1 BY 1                                              
102400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
102500                                                                          
102600             PERFORM 5100-WRITE-TEMP-STORAGE                              
102700                                                                          
102800             ADD +1                TO PV-BLOCK-NUMBER                     
102900                                                                          
103000         END-PERFORM                                                      
103100                                                                          
103200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
103300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
103400                                                                          
103500         PERFORM                                                          
103600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
103700                   ASC-HIGHEST-BLOCK-WRITTEN                              
103800                                                                          
103900             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
104000                                   TO PV-BLOCK-NUMBER                     
104100                                                                          
104200             PERFORM 4410-READ-TEMP-STORAGE                               
104300                                                                          
104400             PERFORM 2151-SET-SELECTED-INDS                               
104500                 VARYING ASC-ITEM-SUB                                     
104600                 FROM 1 BY 1                                              
104700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
104800                                                                          
104900             PERFORM 5100-WRITE-TEMP-STORAGE                              
105000                                                                          
105100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
105200                                                                          
105300         END-PERFORM                                                      
105400                                                                          
105500         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
105600                                   TO PV-BLOCK-NUMBER                     
105700                                                                          
105800         PERFORM 4410-READ-TEMP-STORAGE                                   
105900     END-IF.                                                              
106000                                                                          
106100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                                     
106200                       ASC-NUMBER-OF-SELECTED-ITEMS.                      
106300                                                                          
106400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
106500                                                                          
106600 EJECT                                                                    
106700*----------------------------------------------------------------*        
106800*    MARK EACH ITEM AS BEING SELECTED.                           *        
106900*----------------------------------------------------------------*        
107000 2151-SET-SELECTED-INDS.                                                  
107100                                                                          
107200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
107300             NOT EQUAL ZERO                                               
107400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
107500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
107600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                
107700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
107800                               TO  TRUE                                   
107900         END-IF                                                           
108000     END-IF.                                                              
108100                                                                          
108200 EJECT                                                                    
108300*----------------------------------------------------------------*        
108400*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *        
108500*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *        
108600*----------------------------------------------------------------*        
108700 2200-MOVE-SCREEN-TO-COMMAREA.                                            
108800                                                                          
108900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
109000     MOVE +1                       TO PV-SUB.                             
109100*                                                                         
109200     PERFORM 3100-SET-SUBSCRIPTS.                                         
109300     IF  ASTRTITL > ZERO                                                  
109400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST                  
109500     ELSE                                                                 
109600         IF  ASTRTITF = DP015-ERASE-EOF                                   
109700             INITIALIZE ASC-START-ITEM-REQUEST                            
109800         END-IF                                                           
109900     END-IF.                                                              
110000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                                  
110100         VARYING PV-SUB                                                   
110200         FROM 1 BY 1                                                      
110300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                              
110400                                                                          
110500 EJECT                                                                    
110600*----------------------------------------------------------------*        
110700*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *        
110800*----------------------------------------------------------------*        
110900 2210-MOVE-LINES-TO-COMMAREA.                                             
111000                                                                          
111100     IF  MR-SELECTL (PV-SUB) > ZERO                                       
111200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                     
111300         MOVE MR-SELECTI (PV-SUB)                                         
111400                                   TO ASC-TEMP-SELECTED-SW                
111500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
111600     ELSE                                                                 
111700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                        
111800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             
111900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW                
112000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
112100         END-IF                                                           
112200     END-IF.                                                              
112300     ADD +1                        TO ASC-ITEM-SUB.                       
112400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
112500         ADD  +1                   TO ASC-BLK-SUB                         
112600         MOVE +1                   TO ASC-ITEM-SUB                        
112700     END-IF.                                                              
112800                                                                          
112900 EJECT                                                                    
113000*----------------------------------------------------------------*        
113100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *        
113200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *        
113300*----------------------------------------------------------------*        
113400 3000-EDIT-DATA-IN-COMMAREA.                                              
113500                                                                          
113600     SET PS-NO-ERROR               TO TRUE.                               
113700     PERFORM 3200-RESET-ATTRIBUTES.                                       
113800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                             
113900*----------------------------------------------------------------*        
114000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *        
114100* EDITTING IS DONE FROM THE BOTTOM UP.                           *        
114200*----------------------------------------------------------------*        
114300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                               
114400         ASC-ITEMS-DISPLAYED - 1.                                         
114500     PERFORM 3100-SET-SUBSCRIPTS.                                         
114600     PERFORM 3300-EDIT-SELECTIONS                                         
114700         VARYING PV-SUB                                                   
114800         FROM PV-SUB BY -1                                                
114900         UNTIL PV-SUB < +1.                                               
115000*                                                                         
115100     IF  PS-NO-ERROR                                                      
115200         PERFORM 3400-CHECK-RANGE-SEQUENCE                                
115300     END-IF.                                                              
115400*                                                                         
115500     IF  ((PS-NO-ERROR)                                                   
115600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                           
115700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                            
115800             PERFORM 3500-MARK-RANGE-AS-SELECTED                          
115900     END-IF.                                                              
116000                                                                          
116100 EJECT                                                                    
116200*----------------------------------------------------------------*        
116300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
116400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *        
116500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
116600*                                                                *        
116700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
116800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
116900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
117000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
117100*----------------------------------------------------------------*        
117200 3100-SET-SUBSCRIPTS.                                                     
117300                                                                          
117400     COMPUTE ASC-ITEM-SUB =                                               
117500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
117600                                                                          
117700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
117800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
117900                                                                          
118000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
118100     ELSE                                                                 
118200         MOVE +1                     TO ASC-BLK-SUB                       
118300     END-IF.                                                              
118400                                                                          
118500 EJECT                                                                    
118600*----------------------------------------------------------------*        
118700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *        
118800*----------------------------------------------------------------*        
118900 3200-RESET-ATTRIBUTES.                                                   
119000                                                                          
119100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                           
119200     MOVE DP015-GREEN              TO ASTRTITC.                           
119300     MOVE DP015-UNDERLINE          TO ASTRTITH.                           
119400                                                                          
119500     PERFORM                                                              
119600         VARYING PV-SUB                                                   
119700         FROM 1 BY 1                                                      
119800         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                           
119900                         ASC-ITEMS-DISPLAYED)                             
120000         MOVE DP015-UNP-ALP-NOR-OFF                                       
120100                                   TO MR-SELECTA (PV-SUB)                 
120200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)                 
120300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)                 
120400     END-PERFORM.                                                         
120500                                                                          
120600 EJECT                                                                    
120700*----------------------------------------------------------------*        
120800*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *        
120900*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *        
121000*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *        
121100*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *        
121200*----------------------------------------------------------------*        
121300 3300-EDIT-SELECTIONS.                                                    
121400                                                                          
121500     EVALUATE TRUE                                                        
121600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
121700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)                 
121800                 CONTINUE                                                 
121900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)                 
122000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
122100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS           
122200                 MOVE ASC-TEMP-SELECTED-SW                                
122300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
122400                                TO ASC-SELECTED-SW                        
122500                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
122600             END-IF                                                       
122700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
122800                                = SPACE                                   
122900             EVALUATE TRUE                                                
123000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               
123100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        
123200                     MOVE SPACE TO ASC-SELECTED-SW                        
123300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
123400                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                
123500                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE            
123600                     MOVE SPACE TO ASC-SELECTED-SW                        
123700                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
123800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)                  
123900                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE              
124000                     MOVE SPACE TO ASC-SELECTED-SW                        
124100                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
124200             END-EVALUATE                                                 
124300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   
124400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
124500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
124600             END-IF                                                       
124700             PERFORM 3310-EDIT-RANGE                                      
124800         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                     
124900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
125000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
125100             END-IF                                                       
125200             PERFORM 3310-EDIT-RANGE                                      
125300         WHEN OTHER                                                       
125400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                   
125500             SET DP020-MSG-FATAL    TO TRUE                               
125600             MOVE -1                TO MR-SELECTL (PV-SUB)                
125700             SET DP030-SET-CURSOR-APPL-1                                  
125800                                    TO TRUE                               
125900             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)                
126000             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)                
126100             SET PS-ERROR TO TRUE                                         
126200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
126300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS             
126400                 MOVE SPACE         TO ASC-SELECTED-SW                    
126500                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
126600             END-IF                                                       
126700     END-EVALUATE.                                                        
126800                                                                          
126900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                         
127000     SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
127100     IF  ASC-ITEM-SUB < 1                                                 
127200         SUBTRACT +1 FROM ASC-BLK-SUB                                     
127300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                        
127400     END-IF.                                                              
127500                                                                          
127600 EJECT                                                                    
127700*----------------------------------------------------------------*        
127800*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *        
127900*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *        
128000*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *        
128100*  THE ENDING.                                                   *        
128200*----------------------------------------------------------------*        
128300 3310-EDIT-RANGE.                                                         
128400                                                                          
128500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                        
128600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                           
128700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)        
128800                                   TO ASC-SELECTED-SW                     
128900                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
129000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE         
129100         ELSE                                                             
129200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE             
129300                 CONTINUE                                                 
129400             ELSE                                                         
129500*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---                  
129600                 MOVE PC-TSYMSG-00054                                     
129700                                   TO DP020-MSG-NUMBER                    
129800                 SET DP020-MSG-FATAL                                      
129900                                   TO TRUE                                
130000                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
130100                 SET DP030-SET-CURSOR-APPL-1                              
130200                                   TO TRUE                                
130300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)                 
130400                 MOVE DP015-UNDERLINE                                     
130500                                   TO MR-SELECTH (PV-SUB)                 
130600                 SET PS-ERROR      TO TRUE                                
130700             END-IF                                                       
130800         END-IF                                                           
130900     ELSE                                                                 
131000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
131100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
131200                                   TO ASC-SELECTED-SW                     
131300                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
131400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE           
131500         ELSE                                                             
131600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE               
131700                 CONTINUE                                                 
131800             ELSE                                                         
131900*--------------- ONLY ONE END-OF-RANGE ALLOWED -------                    
132000                 MOVE PC-TSYMSG-00055                                     
132100                                   TO DP020-MSG-NUMBER                    
132200                 SET DP020-MSG-FATAL                                      
132300                                   TO TRUE                                
132400                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
132500                 SET DP030-SET-CURSOR-APPL-1                              
132600                                   TO TRUE                                
132700                 SET PS-ERROR      TO TRUE                                
132800             END-IF                                                       
132900         END-IF                                                           
133000     END-IF.                                                              
133100                                                                          
133200 EJECT                                                                    
133300*----------------------------------------------------------------*        
133400*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *        
133500*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *        
133600*----------------------------------------------------------------*        
133700 3400-CHECK-RANGE-SEQUENCE.                                               
133800                                                                          
133900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
134000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                              
134100       AND  ASC-START-OF-SELECTED-RANGE >                                 
134200                                         ASC-END-OF-SELECTED-RANGE        
134300*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                        
134400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                         
134500         SET DP020-MSG-FATAL TO TRUE                                      
134600         SET PS-ERROR TO TRUE                                             
134700         PERFORM 3410-POSITION-AT-ERROR                                   
134800     END-IF.                                                              
134900                                                                          
135000 EJECT                                                                    
135100*----------------------------------------------------------------*        
135200*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *        
135300*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *        
135400*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *        
135500*----------------------------------------------------------------*        
135600 3410-POSITION-AT-ERROR.                                                  
135700                                                                          
135800     SET DP030-SET-CURSOR-APPL-1                                          
135900                                   TO TRUE.                               
136000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
136100                    - PV-TOP-ITEM + 1.                                    
136200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
136300         CONTINUE                                                         
136400     ELSE                                                                 
136500         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
136600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
136700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
136800     END-IF.                                                              
136900*                                                                         
137000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
137100                    - PV-TOP-ITEM + 1.                                    
137200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
137300         CONTINUE                                                         
137400     ELSE                                                                 
137500         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
137600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
137700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
137800     END-IF.                                                              
137900                                                                          
138000 EJECT                                                                    
138100*----------------------------------------------------------------*        
138200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *        
138300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *        
138400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *        
138500*----------------------------------------------------------------*        
138600 3500-MARK-RANGE-AS-SELECTED.                                             
138700                                                                          
138800     MOVE +1                       TO  ASC-BLK-SUB.                       
138900     PERFORM 3510-MARK-SELECTED-INDS                                      
139000         VARYING ASC-ITEM-SUB                                             
139100         FROM 1 BY 1                                                      
139200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
139300                                                                          
139400     ADD +1                        TO ASC-BLK-SUB.                        
139500     PERFORM 3510-MARK-SELECTED-INDS                                      
139600         VARYING ASC-ITEM-SUB                                             
139700         FROM 1 BY 1                                                      
139800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
139900                                                                          
140000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
140100                                   TO  PV-LIST-ITEM-NUMBER.               
140200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
140300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                                 
140400               PC-ITEMS-PER-PANEL).                                       
140500                                                                          
140600     MOVE ASC-START-OF-SELECTED-RANGE                                     
140700                                   TO PV-START-OF-SELECTED-RANGE.         
140800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                                    
140900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                          
141000               PC-ITEMS-PER-PANEL).                                       
141100                                                                          
141200     MOVE ASC-END-OF-SELECTED-RANGE                                       
141300                                   TO  PV-END-OF-SELECTED-RANGE.          
141400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                                     
141500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                            
141600               PC-ITEMS-PER-PANEL).                                       
141700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                     
141800         PV-FIRST-BLOCK-IN-ARRAY + 1.                                     
141900                                                                          
142000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR            
142100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)                
142200         MOVE +1                   TO ASC-BLK-SUB                         
142300         PERFORM 5100-WRITE-TEMP-STORAGE                                  
142400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
142500             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
142600                                                                          
142700         PERFORM                                                          
142800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                              
142900                   PV-PREV-BLOCK-IN-ARRAY                                 
143000             MOVE PV-FIRST-BLOCK-IN-RANGE                                 
143100                                   TO PV-BLOCK-NUMBER                     
143200             PERFORM 4410-READ-TEMP-STORAGE                               
143300             PERFORM 3510-MARK-SELECTED-INDS                              
143400                 VARYING ASC-ITEM-SUB                                     
143500                 FROM 1 BY 1                                              
143600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
143700             PERFORM 5100-WRITE-TEMP-STORAGE                              
143800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE             
143900         END-PERFORM                                                      
144000                                                                          
144100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
144200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
144300         PERFORM                                                          
144400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
144500                   PV-LAST-BLOCK-IN-RANGE                                 
144600             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
144700                                   TO PV-BLOCK-NUMBER                     
144800             PERFORM 4410-READ-TEMP-STORAGE                               
144900             PERFORM 3510-MARK-SELECTED-INDS                              
145000                 VARYING ASC-ITEM-SUB                                     
145100                 FROM 1 BY 1                                              
145200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
145300             PERFORM 5100-WRITE-TEMP-STORAGE                              
145400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
145500         END-PERFORM                                                      
145600                                                                          
145700         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
145800                                   TO PV-BLOCK-NUMBER                     
145900         PERFORM 4410-READ-TEMP-STORAGE                                   
146000     END-IF.                                                              
146100                                                                          
146200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE         
146300                                      ASC-END-OF-SELECTED-RANGE.          
146400                                                                          
146500 EJECT                                                                    
146600*----------------------------------------------------------------*        
146700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *        
146800*----------------------------------------------------------------*        
146900 3510-MARK-SELECTED-INDS.                                                 
147000                                                                          
147100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
147200                                ASC-ITEM-SUB) >                           
147300         ASC-START-OF-SELECTED-RANGE)                                     
147400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
147500                                ASC-ITEM-SUB) =                           
147600         ASC-START-OF-SELECTED-RANGE)                                     
147700                                                                          
147800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
147900                                    ASC-ITEM-SUB) <                       
148000             ASC-END-OF-SELECTED-RANGE)                                   
148100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
148200                                    ASC-ITEM-SUB) =                       
148300             ASC-END-OF-SELECTED-RANGE)                                   
148400                                                                          
148500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
148600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)           
148700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)           
148800                               TO TRUE                                    
148900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      
149000                               TO TRUE                                    
149100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS            
149200             END-IF                                                       
149300         END-IF                                                           
149400     END-IF.                                                              
149500                                                                          
149600 EJECT                                                                    
149700*----------------------------------------------------------------*        
149800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
149900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
150000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
150100*    DISPLAY THE PANEL TO USER.                                  *        
150200*----------------------------------------------------------------*        
150300 4000-BUILD-INITIAL-PANEL.                                                
150400                                                                          
150500     INITIALIZE                 ASC-BLOCK-ENTRIES (1)                     
150600                                ASC-BLOCK-ENTRIES (2).                    
150700     MOVE +1                 TO ASC-BLK-SUB.                              
150800     SET DP030-SET-CURSOR-TRAILER TO TRUE.                                
150900     SET ASC-ITEMS-LEFT-ON-DB                                             
151000                             TO TRUE.                                     
151100                                                                          
151200     MOVE +0                 TO ASC-ITEM-SUB                              
151300                                ASC-NUMBER-OF-ITEMS-READ                  
151400                                ASC-NUMBER-OF-SELECTED-ITEMS              
151500                                ASC-HIGHEST-BLOCK-WRITTEN                 
151600                                ASC-START-OF-SELECTED-RANGE               
151700                                ASC-END-OF-SELECTED-RANGE                 
151800                                ASC-ITEM-AT-TOP-OF-PANEL.                 
151900     PERFORM 4010-OPEN-CURSOR.                                            
152000                                                                          
152100     PERFORM 4300-READ-ITEMS-FROM-DB.                                     
152200                                                                          
152300     PERFORM 4020-CLOSE-CURSOR.                                           
152400                                                                          
152500     MOVE +1                   TO PV-TOP-ITEM.                            
153200     MOVE -1                   TO MR-SELECTL (1).                         
153300     SET DP030-SET-CURSOR-APPL-1                                          
153400                               TO TRUE.                                   
153500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
153700                                                                          
153800 EJECT                                                                    
153810*----------------------------------------------------------------*        
153820*   DETERMINE WHAT CURSOR TO OPEN DEPENDING ON WHAT VALUES WERE  *        
153821*   PASSED FROM THE CRIT SPEC.                                   *        
153830*----------------------------------------------------------------*        
153840 4010-OPEN-CURSOR.                                                        
153850                                                                          
153851     EVALUATE TRUE                                                        
153852         WHEN ASC-KEY-CSTM-ENTRY-ID > SPACES                              
153853               PERFORM 4011-OPEN-ENTRY-CURSOR                             
153854                                                                          
153855         WHEN ASC-KEY-CONTNR-ID > SPACES                                  
153856               PERFORM 4012-OPEN-CONTNR-CURSOR                            
153857                                                                          
153858         WHEN ASC-KEY-PO-NBR > ZEROES                                     
153870               PERFORM 4013-OPEN-PO-CURSOR                                
153932                                                                          
153933         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES  AND                          
153934              ASC-KEY-MSTR-BOL-NBR > SPACES                               
153935               PERFORM 4014-OPEN-HBOL-MBOL-CURSOR                         
153936                                                                          
153937         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES                               
153939               PERFORM 4015-OPEN-HBOL-CURSOR                              
153940                                                                          
153941         WHEN ASC-KEY-MSTR-BOL-NBR  > SPACES                              
153942               PERFORM 4016-OPEN-MBOL-CURSOR                              
153943                                                                          
153944     END-EVALUATE.                                                        
153945                                                                          
153946 EJECT                                                                    
153950*----------------------------------------------------------------*        
154000*   OPEN THE CUSTOMS ENTRY CURSOR.                               *        
154100*----------------------------------------------------------------*        
154200 4011-OPEN-ENTRY-CURSOR.                                                  
154300                                                                          
154400     PERFORM                                                              
154500         WITH TEST AFTER                                                  
154600         VARYING PV-RETRY-COUNTER                                         
154700         FROM 1 BY 1                                                      
154800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
154900             OR (SQLCODE = ZERO))                                         
155000                                                                          
155100         MOVE 'CURSOR:  ENTRY-CSR'                                        
155200                        TO DP013-MESSAGE-TEXT (2)                         
155300         EXEC SQL                                                         
155400                  OPEN ENTRY-CSR                                          
155500         END-EXEC                                                         
155600                                                                          
155700*                                                                         
155800         EVALUATE TRUE                                                    
155900             WHEN SQLCODE = ZERO                                          
156000             WHEN SQLCODE = -904                                          
156100             WHEN SQLCODE = -913                                          
156200                 CONTINUE                                                 
156300             WHEN SQLWARN0 NOT = SPACES                                   
156400             WHEN SQLCODE < ZERO                                          
156500             WHEN SQLCODE > ZERO                                          
156600                 MOVE '4011-OPEN-CURSOR'                                  
156700                                   TO DP013-PARAGRAPH                     
156800                 MOVE 'OPEN ENTRY CURSOR - '                              
156900                                   TO DP013-MESSAGE-TEXT (1)              
157000                 MOVE SQLCA        TO DP013-SQLCA                         
157100                 MOVE 'TIMCSEN '   TO DP013-DB2-TABLE-NAME (1)            
157200                 SET DP013-DB2-ABEND                                      
157300                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
157400                 PERFORM DP013-0000-PROCESS-ABEND                         
157500         END-EVALUATE                                                     
157600     END-PERFORM.                                                         
157700*                                                                         
157800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
157900         MOVE '4011-OPEN-ENTRY-CURSOR'   TO DP013-PARAGRAPH               
158000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
158100                                   TO DP013-MESSAGE-TEXT (1)              
158200         MOVE SQLCA                TO DP013-SQLCA                         
158300         MOVE 'TIMCSEN '           TO DP013-DB2-TABLE-NAME (1)            
158400         SET DP013-DB2-ABEND                                              
158500             DP013-XCTL-DISPLAY-RESTART                                   
158600                                   TO TRUE                                
158700         PERFORM DP013-0000-PROCESS-ABEND                                 
158800     END-IF.                                                              
158900                                                                          
159000 EJECT                                                                    
159010*----------------------------------------------------------------*        
159020*   OPEN THE CUSTOMS CONTAINER CURSOR.                           *        
159030*----------------------------------------------------------------*        
159040 4012-OPEN-CONTNR-CURSOR.                                                 
159050                                                                          
159060     PERFORM                                                              
159070         WITH TEST AFTER                                                  
159080         VARYING PV-RETRY-COUNTER                                         
159090         FROM 1 BY 1                                                      
159091         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
159092             OR (SQLCODE = ZERO))                                         
159093                                                                          
159094         MOVE 'CURSOR:  CONTNR-CSR'                                       
159095                        TO DP013-MESSAGE-TEXT (2)                         
159096         EXEC SQL                                                         
159097                  OPEN CONTNR-CSR                                         
159098         END-EXEC                                                         
159099                                                                          
159100*                                                                         
159101         EVALUATE TRUE                                                    
159102             WHEN SQLCODE = ZERO                                          
159103             WHEN SQLCODE = -904                                          
159104             WHEN SQLCODE = -913                                          
159105                 CONTINUE                                                 
159106             WHEN SQLWARN0 NOT = SPACES                                   
159107             WHEN SQLCODE < ZERO                                          
159108             WHEN SQLCODE > ZERO                                          
159109                 MOVE '4012-OPEN-CONTNR-CURSOR'                           
159110                                   TO DP013-PARAGRAPH                     
159111                 MOVE 'OPEN CONTNR CURSOR - '                             
159112                                   TO DP013-MESSAGE-TEXT (1)              
159113                 MOVE SQLCA        TO DP013-SQLCA                         
159114                 MOVE 'TIMCSCN '   TO DP013-DB2-TABLE-NAME (1)            
159115                 SET DP013-DB2-ABEND                                      
159116                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
159117                 PERFORM DP013-0000-PROCESS-ABEND                         
159118         END-EVALUATE                                                     
159119     END-PERFORM.                                                         
159120*                                                                         
159121     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
159122         MOVE '4012-OPEN-CONTNR-CURSOR'   TO DP013-PARAGRAPH              
159123         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
159124                                   TO DP013-MESSAGE-TEXT (1)              
159125         MOVE SQLCA                TO DP013-SQLCA                         
159126         MOVE 'TIMCSCN '           TO DP013-DB2-TABLE-NAME (1)            
159127         SET DP013-DB2-ABEND                                              
159128             DP013-XCTL-DISPLAY-RESTART                                   
159129                                   TO TRUE                                
159130         PERFORM DP013-0000-PROCESS-ABEND                                 
159131     END-IF.                                                              
159132                                                                          
159133 EJECT                                                                    
159134*----------------------------------------------------------------*        
159135*   OPEN THE CUSTOMS PO CURSOR.                                  *        
159136*----------------------------------------------------------------*        
159137 4013-OPEN-PO-CURSOR.                                                     
159138                                                                          
159139     PERFORM                                                              
159140         WITH TEST AFTER                                                  
159141         VARYING PV-RETRY-COUNTER                                         
159142         FROM 1 BY 1                                                      
159143         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
159144             OR (SQLCODE = ZERO))                                         
159145                                                                          
159146         MOVE 'CURSOR:  PO-CSR'                                           
159147                        TO DP013-MESSAGE-TEXT (2)                         
159148         EXEC SQL                                                         
159149                  OPEN PO-CSR                                             
159150         END-EXEC                                                         
159151                                                                          
159152*                                                                         
159153         EVALUATE TRUE                                                    
159154             WHEN SQLCODE = ZERO                                          
159155             WHEN SQLCODE = -904                                          
159156             WHEN SQLCODE = -913                                          
159157                 CONTINUE                                                 
159158             WHEN SQLWARN0 NOT = SPACES                                   
159159             WHEN SQLCODE < ZERO                                          
159160             WHEN SQLCODE > ZERO                                          
159161                 MOVE '4013-OPEN-PO-CURSOR'                               
159162                                   TO DP013-PARAGRAPH                     
159163                 MOVE 'OPEN PO CURSOR - '                                 
159164                                   TO DP013-MESSAGE-TEXT (1)              
159165                 MOVE SQLCA        TO DP013-SQLCA                         
159166                 MOVE 'TIMCSPO '   TO DP013-DB2-TABLE-NAME (1)            
159167                 SET DP013-DB2-ABEND                                      
159168                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
159169                 PERFORM DP013-0000-PROCESS-ABEND                         
159170         END-EVALUATE                                                     
159171     END-PERFORM.                                                         
159172*                                                                         
159173     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
159174         MOVE '4013-OPEN-PO-CURSOR'   TO DP013-PARAGRAPH                  
159175         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
159176                                   TO DP013-MESSAGE-TEXT (1)              
159177         MOVE SQLCA                TO DP013-SQLCA                         
159178         MOVE 'TIMCSPO '           TO DP013-DB2-TABLE-NAME (1)            
159179         SET DP013-DB2-ABEND                                              
159180             DP013-XCTL-DISPLAY-RESTART                                   
159181                                   TO TRUE                                
159182         PERFORM DP013-0000-PROCESS-ABEND                                 
159183     END-IF.                                                              
159184                                                                          
159185 EJECT                                                                    
159186*----------------------------------------------------------------*        
159187*   OPEN THE CUSTOMS HBOL/MBOL CURSOR.                           *        
159188*----------------------------------------------------------------*        
159189 4014-OPEN-HBOL-MBOL-CURSOR.                                              
159190                                                                          
159191     PERFORM                                                              
159192         WITH TEST AFTER                                                  
159193         VARYING PV-RETRY-COUNTER                                         
159194         FROM 1 BY 1                                                      
159195         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
159196             OR (SQLCODE = ZERO))                                         
159197                                                                          
159198         MOVE 'CURSOR:  HBOL-MBOL-CSR'                                    
159199                        TO DP013-MESSAGE-TEXT (2)                         
159200         EXEC SQL                                                         
159201                  OPEN HBOL-MBOL-CSR                                      
159202         END-EXEC                                                         
159203                                                                          
159204*                                                                         
159205         EVALUATE TRUE                                                    
159206             WHEN SQLCODE = ZERO                                          
159207             WHEN SQLCODE = -904                                          
159208             WHEN SQLCODE = -913                                          
159209                 CONTINUE                                                 
159210             WHEN SQLWARN0 NOT = SPACES                                   
159211             WHEN SQLCODE < ZERO                                          
159212             WHEN SQLCODE > ZERO                                          
159213                 MOVE '4014-OPEN-HBOL-MBOL-CURSOR'                        
159214                                   TO DP013-PARAGRAPH                     
159215                 MOVE 'OPEN HBOL/MBOL CURSOR - '                          
159216                                   TO DP013-MESSAGE-TEXT (1)              
159217                 MOVE SQLCA        TO DP013-SQLCA                         
159218                 MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)            
159219                 SET DP013-DB2-ABEND                                      
159220                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
159221                 PERFORM DP013-0000-PROCESS-ABEND                         
159222         END-EVALUATE                                                     
159223     END-PERFORM.                                                         
159224*                                                                         
159225     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
159226         MOVE '4014-OPEN-HBOL-MBOL-CURSOR'   TO DP013-PARAGRAPH           
159227         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
159228                                   TO DP013-MESSAGE-TEXT (1)              
159229         MOVE SQLCA                TO DP013-SQLCA                         
159230         MOVE 'TIMCSBL '           TO DP013-DB2-TABLE-NAME (1)            
159231         SET DP013-DB2-ABEND                                              
159232             DP013-XCTL-DISPLAY-RESTART                                   
159233                                   TO TRUE                                
159234         PERFORM DP013-0000-PROCESS-ABEND                                 
159235     END-IF.                                                              
159236                                                                          
159237 EJECT                                                                    
159238*----------------------------------------------------------------*        
159239*   OPEN THE CUSTOMS HBOL CURSOR.                                *        
159240*----------------------------------------------------------------*        
159241 4015-OPEN-HBOL-CURSOR.                                                   
159242                                                                          
159243     PERFORM                                                              
159244         WITH TEST AFTER                                                  
159245         VARYING PV-RETRY-COUNTER                                         
159246         FROM 1 BY 1                                                      
159247         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
159248             OR (SQLCODE = ZERO))                                         
159249                                                                          
159250         MOVE 'CURSOR:  HBOL-CSR'                                         
159251                        TO DP013-MESSAGE-TEXT (2)                         
159252         EXEC SQL                                                         
159253                  OPEN HBOL-CSR                                           
159254         END-EXEC                                                         
159255                                                                          
159256*                                                                         
159257         EVALUATE TRUE                                                    
159258             WHEN SQLCODE = ZERO                                          
159259             WHEN SQLCODE = -904                                          
159260             WHEN SQLCODE = -913                                          
159261                 CONTINUE                                                 
159262             WHEN SQLWARN0 NOT = SPACES                                   
159263             WHEN SQLCODE < ZERO                                          
159264             WHEN SQLCODE > ZERO                                          
159265                 MOVE '4015-OPEN-HBOL-CURSOR'                             
159266                                   TO DP013-PARAGRAPH                     
159267                 MOVE 'OPEN HBOL CURSOR - '                               
159268                                   TO DP013-MESSAGE-TEXT (1)              
159269                 MOVE SQLCA        TO DP013-SQLCA                         
159270                 MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)            
159271                 SET DP013-DB2-ABEND                                      
159272                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
159273                 PERFORM DP013-0000-PROCESS-ABEND                         
159274         END-EVALUATE                                                     
159275     END-PERFORM.                                                         
159276*                                                                         
159277     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
159278         MOVE '4015-OPEN-HBOL-CURSOR'   TO DP013-PARAGRAPH                
159279         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
159280                                   TO DP013-MESSAGE-TEXT (1)              
159281         MOVE SQLCA                TO DP013-SQLCA                         
159282         MOVE 'TIMCSBL '           TO DP013-DB2-TABLE-NAME (1)            
159283         SET DP013-DB2-ABEND                                              
159284             DP013-XCTL-DISPLAY-RESTART                                   
159285                                   TO TRUE                                
159286         PERFORM DP013-0000-PROCESS-ABEND                                 
159287     END-IF.                                                              
159288                                                                          
159289 EJECT                                                                    
159290*----------------------------------------------------------------*        
159291*   OPEN THE CUSTOMS MBOL CURSOR.                                *        
159292*----------------------------------------------------------------*        
159293 4016-OPEN-MBOL-CURSOR.                                                   
159294                                                                          
159295     PERFORM                                                              
159296         WITH TEST AFTER                                                  
159297         VARYING PV-RETRY-COUNTER                                         
159298         FROM 1 BY 1                                                      
159299         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
159300             OR (SQLCODE = ZERO))                                         
159301                                                                          
159302         MOVE 'CURSOR:  MBOL-CSR'                                         
159303                        TO DP013-MESSAGE-TEXT (2)                         
159304         EXEC SQL                                                         
159305                  OPEN MBOL-CSR                                           
159306         END-EXEC                                                         
159307                                                                          
159308*                                                                         
159309         EVALUATE TRUE                                                    
159310             WHEN SQLCODE = ZERO                                          
159311             WHEN SQLCODE = -904                                          
159312             WHEN SQLCODE = -913                                          
159313                 CONTINUE                                                 
159314             WHEN SQLWARN0 NOT = SPACES                                   
159315             WHEN SQLCODE < ZERO                                          
159316             WHEN SQLCODE > ZERO                                          
159317                 MOVE '4016-OPEN-MBOL-CURSOR'                             
159318                                   TO DP013-PARAGRAPH                     
159319                 MOVE 'OPEN MBOL CURSOR - '                               
159320                                   TO DP013-MESSAGE-TEXT (1)              
159321                 MOVE SQLCA        TO DP013-SQLCA                         
159322                 MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)            
159323                 SET DP013-DB2-ABEND                                      
159324                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
159325                 PERFORM DP013-0000-PROCESS-ABEND                         
159326         END-EVALUATE                                                     
159327     END-PERFORM.                                                         
159328*                                                                         
159329     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
159330         MOVE '4016-OPEN-MBOL-CURSOR'   TO DP013-PARAGRAPH                
159331         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
159332                                   TO DP013-MESSAGE-TEXT (1)              
159333         MOVE SQLCA                TO DP013-SQLCA                         
159334         MOVE 'TIMCSBL '           TO DP013-DB2-TABLE-NAME (1)            
159335         SET DP013-DB2-ABEND                                              
159336             DP013-XCTL-DISPLAY-RESTART                                   
159337                                   TO TRUE                                
159338         PERFORM DP013-0000-PROCESS-ABEND                                 
159339     END-IF.                                                              
159340                                                                          
159341 EJECT                                                                    
159342*----------------------------------------------------------------*        
159343*   DETERMINE WHAT CURSOR TO CLOSE DEPENDING ON WHAT VALUES WERE *        
159344*   PASSED FROM THE CRIT SPEC.                                   *        
159345*----------------------------------------------------------------*        
159346 4020-CLOSE-CURSOR.                                                       
159347                                                                          
159348     EVALUATE TRUE                                                        
159349         WHEN ASC-KEY-CSTM-ENTRY-ID > SPACES                              
159350               PERFORM 4021-CLOSE-ENTRY-CURSOR                            
159351                                                                          
159352         WHEN ASC-KEY-CONTNR-ID > SPACES                                  
159353               PERFORM 4022-CLOSE-CONTNR-CURSOR                           
159356                                                                          
159357         WHEN ASC-KEY-PO-NBR > ZEROES                                     
159359               PERFORM 4023-CLOSE-PO-CURSOR                               
159360                                                                          
159361         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES  AND                          
159362              ASC-KEY-MSTR-BOL-NBR > SPACES                               
159363               PERFORM 4024-CLOSE-HBOL-MBOL-CURSOR                        
159365                                                                          
159366         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES                               
159367               PERFORM 4025-CLOSE-HBOL-CURSOR                             
159369                                                                          
159370         WHEN ASC-KEY-MSTR-BOL-NBR  > SPACES                              
159371               PERFORM 4026-CLOSE-MBOL-CURSOR                             
159373                                                                          
159374     END-EVALUATE.                                                        
159375                                                                          
159376 EJECT                                                                    
159377*----------------------------------------------------------------*        
159378*   CLOSE THE CUSTOMS ENTRY CURSOR.                              *        
159380*----------------------------------------------------------------*        
159400 4021-CLOSE-ENTRY-CURSOR.                                                 
159500                                                                          
159600     EXEC SQL                                                             
159700          CLOSE ENTRY-CSR                                                 
159800     END-EXEC                                                             
159900                                                                          
160000*                                                                         
160100     EVALUATE TRUE                                                        
160200         WHEN SQLCODE = ZERO                                              
160300             CONTINUE                                                     
160400         WHEN SQLWARN0 NOT = SPACES                                       
160500         WHEN SQLCODE < ZERO                                              
160600         WHEN SQLCODE > ZERO                                              
160700             MOVE '4021-CLOSE-ENTRY-CURSOR'                               
160800                               TO DP013-PARAGRAPH                         
160900             MOVE 'CLOSE ENTRY CURSOR '                                   
161000                               TO DP013-MESSAGE-TEXT (1)                  
161100             MOVE SQLCA        TO DP013-SQLCA                             
161200             MOVE 'TIMCSEN '   TO DP013-DB2-TABLE-NAME (1)                
161300             SET DP013-DB2-ABEND                                          
161400                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
161500             PERFORM DP013-0000-PROCESS-ABEND                             
161600     END-EVALUATE.                                                        
161700                                                                          
161800 EJECT                                                                    
161810*----------------------------------------------------------------*        
161820*   CLOSE THE CUSTOMS CONTAINER CURSOR.                          *        
161830*----------------------------------------------------------------*        
161840 4022-CLOSE-CONTNR-CURSOR.                                                
161850                                                                          
161860     EXEC SQL                                                             
161870          CLOSE CONTNR-CSR                                                
161880     END-EXEC                                                             
161890                                                                          
161891*                                                                         
161892     EVALUATE TRUE                                                        
161893         WHEN SQLCODE = ZERO                                              
161894             CONTINUE                                                     
161895         WHEN SQLWARN0 NOT = SPACES                                       
161896         WHEN SQLCODE < ZERO                                              
161897         WHEN SQLCODE > ZERO                                              
161898             MOVE '4022-CLOSE-CONTNR-CURSOR'                              
161899                               TO DP013-PARAGRAPH                         
161900             MOVE 'CLOSE CONTNR CURSOR '                                  
161901                               TO DP013-MESSAGE-TEXT (1)                  
161902             MOVE SQLCA        TO DP013-SQLCA                             
161903             MOVE 'TIMCSCN '   TO DP013-DB2-TABLE-NAME (1)                
161904             SET DP013-DB2-ABEND                                          
161905                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
161906             PERFORM DP013-0000-PROCESS-ABEND                             
161907     END-EVALUATE.                                                        
161908                                                                          
161909 EJECT                                                                    
161910*----------------------------------------------------------------*        
161911*   CLOSE THE CUSTOMS PO CURSOR.                                 *        
161912*----------------------------------------------------------------*        
161913 4023-CLOSE-PO-CURSOR.                                                    
161914                                                                          
161915     EXEC SQL                                                             
161916          CLOSE PO-CSR                                                    
161917     END-EXEC                                                             
161918                                                                          
161919*                                                                         
161920     EVALUATE TRUE                                                        
161921         WHEN SQLCODE = ZERO                                              
161922             CONTINUE                                                     
161923         WHEN SQLWARN0 NOT = SPACES                                       
161924         WHEN SQLCODE < ZERO                                              
161925         WHEN SQLCODE > ZERO                                              
161926             MOVE '4023-CLOSE-PO-CURSOR'                                  
161927                               TO DP013-PARAGRAPH                         
161928             MOVE 'CLOSE PO CURSOR '                                      
161929                               TO DP013-MESSAGE-TEXT (1)                  
161930             MOVE SQLCA        TO DP013-SQLCA                             
161931             MOVE 'TIMCSPO '   TO DP013-DB2-TABLE-NAME (1)                
161932             SET DP013-DB2-ABEND                                          
161933                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
161934             PERFORM DP013-0000-PROCESS-ABEND                             
161935     END-EVALUATE.                                                        
161936                                                                          
161937 EJECT                                                                    
161938*----------------------------------------------------------------*        
161939*   CLOSE THE CUSTOMS HBOL/MBOL CURSOR.                          *        
161940*----------------------------------------------------------------*        
161941 4024-CLOSE-HBOL-MBOL-CURSOR.                                             
161942                                                                          
161943     EXEC SQL                                                             
161944          CLOSE HBOL-MBOL-CSR                                             
161945     END-EXEC                                                             
161946                                                                          
161947*                                                                         
161948     EVALUATE TRUE                                                        
161949         WHEN SQLCODE = ZERO                                              
161950             CONTINUE                                                     
161951         WHEN SQLWARN0 NOT = SPACES                                       
161952         WHEN SQLCODE < ZERO                                              
161953         WHEN SQLCODE > ZERO                                              
161954             MOVE '4024-CLOSE-HBOL-MBOL-CURSOR'                           
161955                               TO DP013-PARAGRAPH                         
161956             MOVE 'CLOSE HBOL/MBOL CURSOR '                               
161957                               TO DP013-MESSAGE-TEXT (1)                  
161958             MOVE SQLCA        TO DP013-SQLCA                             
161959             MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)                
161960             SET DP013-DB2-ABEND                                          
161961                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
161962             PERFORM DP013-0000-PROCESS-ABEND                             
161963     END-EVALUATE.                                                        
161964                                                                          
161965 EJECT                                                                    
161966*----------------------------------------------------------------*        
161967*   CLOSE THE HBOL CURSOR.                                       *        
161968*----------------------------------------------------------------*        
161969 4025-CLOSE-HBOL-CURSOR.                                                  
161970                                                                          
161971     EXEC SQL                                                             
161972          CLOSE HBOL-CSR                                                  
161973     END-EXEC                                                             
161974                                                                          
161975*                                                                         
161976     EVALUATE TRUE                                                        
161977         WHEN SQLCODE = ZERO                                              
161978             CONTINUE                                                     
161979         WHEN SQLWARN0 NOT = SPACES                                       
161980         WHEN SQLCODE < ZERO                                              
161981         WHEN SQLCODE > ZERO                                              
161982             MOVE '4025-CLOSE-HBOL-CURSOR'                                
161983                               TO DP013-PARAGRAPH                         
161984             MOVE 'CLOSE HBOL CURSOR '                                    
161985                               TO DP013-MESSAGE-TEXT (1)                  
161986             MOVE SQLCA        TO DP013-SQLCA                             
161987             MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)                
161988             SET DP013-DB2-ABEND                                          
161989                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
161990             PERFORM DP013-0000-PROCESS-ABEND                             
161991     END-EVALUATE.                                                        
161992                                                                          
161993 EJECT                                                                    
161994*----------------------------------------------------------------*        
161995*   CLOSE THE MBOL CURSOR.                                       *        
161996*----------------------------------------------------------------*        
161997 4026-CLOSE-MBOL-CURSOR.                                                  
161998                                                                          
161999     EXEC SQL                                                             
162000          CLOSE MBOL-CSR                                                  
162001     END-EXEC                                                             
162002                                                                          
162003*                                                                         
162004     EVALUATE TRUE                                                        
162005         WHEN SQLCODE = ZERO                                              
162006             CONTINUE                                                     
162007         WHEN SQLWARN0 NOT = SPACES                                       
162008         WHEN SQLCODE < ZERO                                              
162009         WHEN SQLCODE > ZERO                                              
162010             MOVE '4026-CLOSE-MBOL-CURSOR'                                
162011                               TO DP013-PARAGRAPH                         
162012             MOVE 'CLOSE MBOL CURSOR '                                    
162013                               TO DP013-MESSAGE-TEXT (1)                  
162014             MOVE SQLCA        TO DP013-SQLCA                             
162015             MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)                
162016             SET DP013-DB2-ABEND                                          
162017                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
162018             PERFORM DP013-0000-PROCESS-ABEND                             
162019     END-EVALUATE.                                                        
162020                                                                          
162021 EJECT                                                                    
162022*----------------------------------------------------------------*        
162030*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
162100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
162200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
162300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
162400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
162500*                                                                *        
162600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
162700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
162800*    UPON INITIALIZATION.                                        *        
162900*----------------------------------------------------------------*        
163000 4300-READ-ITEMS-FROM-DB.                                                 
163100                                                                          
163200     PERFORM                                                              
163300         VARYING PV-READ-COUNT                                            
163400         FROM 1 BY 1                                                      
163500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
163600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
163700                                                                          
163800         PERFORM 4310-FETCH                                               
163900                                                                          
164000         IF  ASC-ITEMS-LEFT-ON-DB                                         
164100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
164200                 ADD +1            TO ASC-ITEM-SUB                        
164300             ELSE                                                         
164400                 ADD +1            TO ASC-BLK-SUB                         
164500                 MOVE +1           TO ASC-ITEM-SUB                        
164600                                                                          
164700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
164800                     MOVE +1       TO ASC-BLK-SUB                         
164900                     SET ASC-BLOCK-MODIFIED (1)                           
165000                                   TO TRUE                                
165100                     PERFORM 5100-WRITE-TEMP-STORAGE                      
165200                     MOVE ASC-BLOCK-ENTRIES                               
165300                               (PC-MAX-BLOCKS-IN-ARRAY)                   
165400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         
165500                     ADD +1        TO ASC-BLK-SUB                         
165600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
165700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
165800                                   TO  TRUE                               
165900                 END-IF                                                   
166000             END-IF                                                       
166100             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ           
166200             MOVE ASC-NUMBER-OF-ITEMS-READ                                
166300                                   TO  ASC-LIST-ITEM-NUMBER               
166400                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
166500             MOVE IMCSEN-CSTM-ENTR-ID TO  ASC-CSTM-ENTR-ID                
166600                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
166610             MOVE IMCSEN-ENT-ID       TO  ASC-ENT-ID                      
166620                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
166651                                                                          
166652             IF IMCSEN-MOM-DEST-POE-CDE EQUAL ZEROES OR SPACES            
166653                 MOVE SPACES                 TO ASC-POE                   
166654                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
166655             ELSE                                                         
166656                 IF IMCSEN-MOM-DEST-POE-CDE NUMERIC                       
166657                     PERFORM 4320-OPEN-POE-CURSOR                         
166658                     PERFORM 4324-FETCH-POE-CURSOR                        
166659                     PERFORM 4322-CLOSE-POE-CURSOR                        
166661                     MOVE IMPOE-POE-CDE       TO  ASC-POE                 
166662                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
166663                 ELSE                                                     
166664                     MOVE IMCSEN-MOM-DEST-POE-CDE TO ASC-POE              
166665                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
166666                 END-IF                                                   
166667             END-IF                                                       
166668                                                                          
166700             PERFORM 4330-FORMAT-FILD-DTE                                 
166800             PERFORM 4340-FORMAT-EXM-DTE                                  
166900             PERFORM 4350-FORMAT-REJ-DTE                                  
167000             PERFORM 4355-FORMAT-EST-CLR-DTE                              
167010             PERFORM 4360-FORMAT-ACT-CLR-DTE                              
167100             PERFORM 4370-FORMAT-LQDN-DTE                                 
167200             PERFORM 4380-FORMAT-LQDN-SSPNN-DTE                           
167300             PERFORM 4390-SELECT-PO-COUNT                                 
167400             PERFORM 4395-SELECT-CONTNR-COUNT                             
167410                                                                          
167411             IF IMCSEN-LAST-UPD-TMST (1:10)                               
167412                                        = SPACES OR PC-INIT-DATE          
167413                 MOVE SPACES       TO ASC-LAST-TRN                        
167414                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
167415             ELSE                                                         
167416                 STRING  IMCSEN-LAST-UPD-TMST(6:2) '/'                    
167417                         IMCSEN-LAST-UPD-TMST(9:2)                        
167418                         DELIMITED BY SIZE                                
167419                                   INTO ASC-LAST-TRN                      
167420                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
167430             END-IF                                                       
167440             PERFORM 4397-SELECT-ENTRY-HISTORY                            
167500         END-IF                                                           
167600     END-PERFORM.                                                         
167700                                                                          
167800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
167900         MOVE +1               TO ASC-BLK-SUB                             
168000         PERFORM 5100-WRITE-TEMP-STORAGE                                  
168100         ADD +1                TO ASC-BLK-SUB                             
168200         PERFORM 5100-WRITE-TEMP-STORAGE                                  
168300                                                                          
168400         MOVE 1                TO ASC-BLK-SUB                             
168500                                  PV-BLOCK-NUMBER                         
168600         PERFORM 4410-READ-TEMP-STORAGE                                   
168700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
168800             MOVE 2            TO ASC-BLK-SUB                             
168900                                  PV-BLOCK-NUMBER                         
169000             PERFORM 4410-READ-TEMP-STORAGE                               
169100         END-IF                                                           
169104     ELSE                                                                 
169105         PERFORM 4500-SELECT-CUSTOMS-DEL-HSTRY                            
169106     END-IF.                                                              
169107                                                                          
169108 EJECT                                                                    
169800*----------------------------------------------------------------*        
169801*   DETERMINE WHAT CURSOR TO FETCH DEPENDING ON WHAT VALUES WERE *        
169802*   PASSED FROM THE CRIT SPEC.                                   *        
169803*----------------------------------------------------------------*        
169804 4310-FETCH.                                                              
169805                                                                          
169806     EVALUATE TRUE                                                        
169807         WHEN ASC-KEY-CSTM-ENTRY-ID > SPACES                              
169808               PERFORM 4311-FETCH-ENTRY                                   
169809                                                                          
169810         WHEN ASC-KEY-CONTNR-ID > SPACES                                  
169811               PERFORM 4312-FETCH-CONTNR                                  
169812                                                                          
169813         WHEN ASC-KEY-PO-NBR > ZEROES                                     
169814               PERFORM 4313-FETCH-PO                                      
169815                                                                          
169816         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES  AND                          
169817              ASC-KEY-MSTR-BOL-NBR > SPACES                               
169818               PERFORM 4314-FETCH-HBOL-MBOL                               
169819                                                                          
169820         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES                               
169821               PERFORM 4315-FETCH-HBOL                                    
169822                                                                          
169823         WHEN ASC-KEY-MSTR-BOL-NBR  > SPACES                              
169824               PERFORM 4316-FETCH-MBOL                                    
169825                                                                          
169826     END-EVALUATE.                                                        
169827                                                                          
169828 EJECT                                                                    
169829*----------------------------------------------------------------*        
169830*    FETCH THE ENTRY CURSOR.                                     *        
169831*----------------------------------------------------------------*        
169840 4311-FETCH-ENTRY.                                                        
169900                                                                          
170000        EXEC SQL                                                          
170100        FETCH ENTRY-CSR                                                   
170200        INTO   :IMCSEN-CSTM-ENTR-ID                                       
170300             , :IMCSEN-FILD-TMST                                          
170400             , :IMCSEN-EXM-TMST                                           
170500             , :IMCSEN-REJ-TMST                                           
170600             , :IMCSEN-EST-CLR-TMST                                       
170610             , :IMCSEN-ACTL-CLR-TMST                                      
170700             , :IMCSEN-LQDN-TMST                                          
170800             , :IMCSEN-LQDN-SSPNN-TMST                                    
170810             , :IMCSEN-ENT-ID                                             
170820             , :IMCSEN-MOM-DEST-POE-CDE                                   
170830             , :IMCSEN-LAST-UPD-TMST                                      
170900        END-EXEC                                                          
171000                                                                          
171100                                                                          
171200     EVALUATE TRUE                                                        
171300         WHEN SQLCODE = ZERO                                              
171400         WHEN SQLCODE = +100                                              
171500         WHEN SQLCODE = -305                                              
171600              CONTINUE                                                    
171700         WHEN SQLWARN0 NOT = SPACE                                        
171800         WHEN SQLCODE NOT = ZERO                                          
171900              MOVE '4311-FETCH-ENTRY'                                     
172000                               TO DP013-PARAGRAPH                         
172100              MOVE 'FETCH ENTRY CURSOR'                                   
172200                               TO DP013-MESSAGE-TEXT (1)                  
172300              MOVE SQLCA       TO DP013-SQLCA                             
172400              SET DP013-DB2-ABEND                                         
172500                               TO TRUE                                    
172600              PERFORM DP013-0000-PROCESS-ABEND                            
172700             MOVE SQLCA        TO DP013-SQLCA                             
172800             MOVE 'TIMCSEN '   TO DP013-DB2-TABLE-NAME (1)                
172900             SET DP013-DB2-ABEND                                          
173000                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
173100             PERFORM DP013-0000-PROCESS-ABEND                             
173200     END-EVALUATE.                                                        
173300*                                                                         
173400     IF  SQLCODE EQUAL +100                                               
173500         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
173600                                   TO TRUE                                
173700     END-IF.                                                              
173800                                                                          
173900 EJECT                                                                    
173910*----------------------------------------------------------------*        
173920*    FETCH THE CONTAINER CURSOR.                                 *        
173930*----------------------------------------------------------------*        
173940 4312-FETCH-CONTNR.                                                       
173950                                                                          
173960        EXEC SQL                                                          
173970        FETCH CONTNR-CSR                                                  
173980        INTO   :IMCSEN-CSTM-ENTR-ID                                       
173990             , :IMCSEN-FILD-TMST                                          
173991             , :IMCSEN-EXM-TMST                                           
173992             , :IMCSEN-REJ-TMST                                           
173993             , :IMCSEN-EST-CLR-TMST                                       
173994             , :IMCSEN-ACTL-CLR-TMST                                      
173995             , :IMCSEN-LQDN-TMST                                          
173996             , :IMCSEN-LQDN-SSPNN-TMST                                    
173997             , :IMCSEN-ENT-ID                                             
173998             , :IMCSEN-MOM-DEST-POE-CDE                                   
173999             , :IMCSEN-LAST-UPD-TMST                                      
174000        END-EXEC                                                          
174001                                                                          
174002                                                                          
174003     EVALUATE TRUE                                                        
174004         WHEN SQLCODE = ZERO                                              
174005         WHEN SQLCODE = +100                                              
174006         WHEN SQLCODE = -305                                              
174007              CONTINUE                                                    
174008         WHEN SQLWARN0 NOT = SPACE                                        
174009         WHEN SQLCODE NOT = ZERO                                          
174010              MOVE '4312-FETCH-CONTNR'                                    
174011                               TO DP013-PARAGRAPH                         
174012              MOVE 'FETCH CONTNR CURSOR'                                  
174013                               TO DP013-MESSAGE-TEXT (1)                  
174014              MOVE SQLCA       TO DP013-SQLCA                             
174015              SET DP013-DB2-ABEND                                         
174016                               TO TRUE                                    
174017              PERFORM DP013-0000-PROCESS-ABEND                            
174018             MOVE SQLCA        TO DP013-SQLCA                             
174019             MOVE 'TIMCSCN '   TO DP013-DB2-TABLE-NAME (1)                
174020             SET DP013-DB2-ABEND                                          
174021                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
174022             PERFORM DP013-0000-PROCESS-ABEND                             
174023     END-EVALUATE.                                                        
174024*                                                                         
174025     IF  SQLCODE EQUAL +100                                               
174026         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
174027                                   TO TRUE                                
174028     END-IF.                                                              
174029                                                                          
174030 EJECT                                                                    
174031*----------------------------------------------------------------*        
174032*    FETCH THE PO CURSOR.                                        *        
174033*----------------------------------------------------------------*        
174034 4313-FETCH-PO.                                                           
174035                                                                          
174036        EXEC SQL                                                          
174037        FETCH PO-CSR                                                      
174038        INTO   :IMCSEN-CSTM-ENTR-ID                                       
174039             , :IMCSEN-FILD-TMST                                          
174040             , :IMCSEN-EXM-TMST                                           
174041             , :IMCSEN-REJ-TMST                                           
174042             , :IMCSEN-EST-CLR-TMST                                       
174043             , :IMCSEN-ACTL-CLR-TMST                                      
174044             , :IMCSEN-LQDN-TMST                                          
174045             , :IMCSEN-LQDN-SSPNN-TMST                                    
174046             , :IMCSEN-ENT-ID                                             
174047             , :IMCSEN-MOM-DEST-POE-CDE                                   
174048             , :IMCSEN-LAST-UPD-TMST                                      
174049        END-EXEC                                                          
174050                                                                          
174051                                                                          
174052     EVALUATE TRUE                                                        
174053         WHEN SQLCODE = ZERO                                              
174054         WHEN SQLCODE = +100                                              
174055         WHEN SQLCODE = -305                                              
174056              CONTINUE                                                    
174057         WHEN SQLWARN0 NOT = SPACE                                        
174058         WHEN SQLCODE NOT = ZERO                                          
174059              MOVE '4313-FETCH-PO'                                        
174060                               TO DP013-PARAGRAPH                         
174061              MOVE 'FETCH PO CURSOR'                                      
174062                               TO DP013-MESSAGE-TEXT (1)                  
174063              MOVE SQLCA       TO DP013-SQLCA                             
174064              SET DP013-DB2-ABEND                                         
174065                               TO TRUE                                    
174066              PERFORM DP013-0000-PROCESS-ABEND                            
174067             MOVE SQLCA        TO DP013-SQLCA                             
174068             MOVE 'TIMCSPO '   TO DP013-DB2-TABLE-NAME (1)                
174069             SET DP013-DB2-ABEND                                          
174070                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
174071             PERFORM DP013-0000-PROCESS-ABEND                             
174072     END-EVALUATE.                                                        
174073*                                                                         
174074     IF  SQLCODE EQUAL +100                                               
174075         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
174076                                   TO TRUE                                
174077     END-IF.                                                              
174078                                                                          
174079 EJECT                                                                    
174080*----------------------------------------------------------------*        
174081*    FETCH THE HBOL/MBOL CURSOR.                                 *        
174082*----------------------------------------------------------------*        
174083 4314-FETCH-HBOL-MBOL.                                                    
174084                                                                          
174085        EXEC SQL                                                          
174086        FETCH HBOL-MBOL-CSR                                               
174087        INTO   :IMCSEN-CSTM-ENTR-ID                                       
174088             , :IMCSEN-FILD-TMST                                          
174089             , :IMCSEN-EXM-TMST                                           
174090             , :IMCSEN-REJ-TMST                                           
174091             , :IMCSEN-EST-CLR-TMST                                       
174092             , :IMCSEN-ACTL-CLR-TMST                                      
174093             , :IMCSEN-LQDN-TMST                                          
174094             , :IMCSEN-LQDN-SSPNN-TMST                                    
174095             , :IMCSEN-ENT-ID                                             
174096             , :IMCSEN-MOM-DEST-POE-CDE                                   
174097             , :IMCSEN-LAST-UPD-TMST                                      
174098        END-EXEC                                                          
174099                                                                          
174100                                                                          
174101     EVALUATE TRUE                                                        
174102         WHEN SQLCODE = ZERO                                              
174103         WHEN SQLCODE = +100                                              
174104         WHEN SQLCODE = -305                                              
174105              CONTINUE                                                    
174106         WHEN SQLWARN0 NOT = SPACE                                        
174107         WHEN SQLCODE NOT = ZERO                                          
174108              MOVE '4314-FETCH-HBOL-MBOL'                                 
174109                               TO DP013-PARAGRAPH                         
174110              MOVE 'FETCH HBOL/MBOL CURSOR'                               
174111                               TO DP013-MESSAGE-TEXT (1)                  
174112              MOVE SQLCA       TO DP013-SQLCA                             
174113              SET DP013-DB2-ABEND                                         
174114                               TO TRUE                                    
174115              PERFORM DP013-0000-PROCESS-ABEND                            
174116             MOVE SQLCA        TO DP013-SQLCA                             
174117             MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)                
174118             SET DP013-DB2-ABEND                                          
174119                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
174120             PERFORM DP013-0000-PROCESS-ABEND                             
174121     END-EVALUATE.                                                        
174122*                                                                         
174123     IF  SQLCODE EQUAL +100                                               
174124         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
174125                                   TO TRUE                                
174126     END-IF.                                                              
174127                                                                          
174128 EJECT                                                                    
174129*----------------------------------------------------------------*        
174130*    FETCH THE HBOL CURSOR.                                      *        
174131*----------------------------------------------------------------*        
174132 4315-FETCH-HBOL.                                                         
174133                                                                          
174134        EXEC SQL                                                          
174135        FETCH HBOL-CSR                                                    
174136        INTO   :IMCSEN-CSTM-ENTR-ID                                       
174137             , :IMCSEN-FILD-TMST                                          
174138             , :IMCSEN-EXM-TMST                                           
174139             , :IMCSEN-REJ-TMST                                           
174140             , :IMCSEN-EST-CLR-TMST                                       
174141             , :IMCSEN-ACTL-CLR-TMST                                      
174142             , :IMCSEN-LQDN-TMST                                          
174143             , :IMCSEN-LQDN-SSPNN-TMST                                    
174144             , :IMCSEN-ENT-ID                                             
174145             , :IMCSEN-MOM-DEST-POE-CDE                                   
174146             , :IMCSEN-LAST-UPD-TMST                                      
174147        END-EXEC                                                          
174148                                                                          
174149                                                                          
174150     EVALUATE TRUE                                                        
174151         WHEN SQLCODE = ZERO                                              
174152         WHEN SQLCODE = +100                                              
174153         WHEN SQLCODE = -305                                              
174154              CONTINUE                                                    
174155         WHEN SQLWARN0 NOT = SPACE                                        
174156         WHEN SQLCODE NOT = ZERO                                          
174157              MOVE '4315-FETCH-HBOL'                                      
174158                               TO DP013-PARAGRAPH                         
174159              MOVE 'FETCH HBOL CURSOR'                                    
174160                               TO DP013-MESSAGE-TEXT (1)                  
174161              MOVE SQLCA       TO DP013-SQLCA                             
174162              SET DP013-DB2-ABEND                                         
174163                               TO TRUE                                    
174164              PERFORM DP013-0000-PROCESS-ABEND                            
174165             MOVE SQLCA        TO DP013-SQLCA                             
174166             MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)                
174167             SET DP013-DB2-ABEND                                          
174168                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
174169             PERFORM DP013-0000-PROCESS-ABEND                             
174170     END-EVALUATE.                                                        
174171*                                                                         
174172     IF  SQLCODE EQUAL +100                                               
174173         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
174174                                   TO TRUE                                
174175     END-IF.                                                              
174176                                                                          
174177 EJECT                                                                    
174178*----------------------------------------------------------------*        
174179*    FETCH THE MBOL CURSOR.                                      *        
174180*----------------------------------------------------------------*        
174181 4316-FETCH-MBOL.                                                         
174182                                                                          
174183        EXEC SQL                                                          
174184        FETCH MBOL-CSR                                                    
174185        INTO   :IMCSEN-CSTM-ENTR-ID                                       
174186             , :IMCSEN-FILD-TMST                                          
174187             , :IMCSEN-EXM-TMST                                           
174188             , :IMCSEN-REJ-TMST                                           
174189             , :IMCSEN-EST-CLR-TMST                                       
174190             , :IMCSEN-ACTL-CLR-TMST                                      
174191             , :IMCSEN-LQDN-TMST                                          
174192             , :IMCSEN-LQDN-SSPNN-TMST                                    
174193             , :IMCSEN-ENT-ID                                             
174194             , :IMCSEN-MOM-DEST-POE-CDE                                   
174195             , :IMCSEN-LAST-UPD-TMST                                      
174196        END-EXEC                                                          
174197                                                                          
174198                                                                          
174199     EVALUATE TRUE                                                        
174200         WHEN SQLCODE = ZERO                                              
174201         WHEN SQLCODE = +100                                              
174202         WHEN SQLCODE = -305                                              
174203              CONTINUE                                                    
174204         WHEN SQLWARN0 NOT = SPACE                                        
174205         WHEN SQLCODE NOT = ZERO                                          
174206              MOVE '4316-FETCH-MBOL'                                      
174207                               TO DP013-PARAGRAPH                         
174208              MOVE 'FETCH MBOL CURSOR'                                    
174209                               TO DP013-MESSAGE-TEXT (1)                  
174210              MOVE SQLCA       TO DP013-SQLCA                             
174211              SET DP013-DB2-ABEND                                         
174212                               TO TRUE                                    
174213              PERFORM DP013-0000-PROCESS-ABEND                            
174214             MOVE SQLCA        TO DP013-SQLCA                             
174215             MOVE 'TIMCSBL '   TO DP013-DB2-TABLE-NAME (1)                
174216             SET DP013-DB2-ABEND                                          
174217                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
174218             PERFORM DP013-0000-PROCESS-ABEND                             
174219     END-EVALUATE.                                                        
174220*                                                                         
174221     IF  SQLCODE EQUAL +100                                               
174222         SET ASC-NO-ITEMS-LEFT-ON-DB                                      
174223                                   TO TRUE                                
174224     END-IF.                                                              
174225                                                                          
174226 EJECT                                                                    
174227*----------------------------------------------------------------*        
174228*   OPEN THE POE CODE CURSOR                                     *        
174229*----------------------------------------------------------------*        
174230 4320-OPEN-POE-CURSOR.                                                    
174231                                                                          
174232     PERFORM                                                              
174233         WITH TEST AFTER                                                  
174234         VARYING PV-RETRY-COUNTER                                         
174235         FROM 1 BY 1                                                      
174236         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
174237                   OR (SQLCODE = ZERO))                                   
174238                                                                          
174239         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)            
174240                                                                          
174241         EXEC SQL                                                         
174242              OPEN POE-CSR                                                
174243         END-EXEC                                                         
174244                                                                          
174245         EVALUATE TRUE                                                    
174246             WHEN SQLCODE = ZERO                                          
174247             WHEN SQLCODE = -904                                          
174248             WHEN SQLCODE = -913                                          
174249                 CONTINUE                                                 
174250             WHEN SQLWARN0 NOT = SPACES                                   
174251             WHEN SQLCODE < ZERO                                          
174252             WHEN SQLCODE > ZERO                                          
174253                 MOVE '4320-OPEN-POE-CURSOR'                              
174254                                   TO DP013-PARAGRAPH                     
174255                 MOVE 'OPEN POE CURSOR - '                                
174256                                   TO DP013-MESSAGE-TEXT (1)              
174257                 MOVE SQLCA        TO DP013-SQLCA                         
174258                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)            
174259                 SET DP013-DB2-ABEND                                      
174260                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
174261                 PERFORM DP013-0000-PROCESS-ABEND                         
174262         END-EVALUATE                                                     
174263     END-PERFORM.                                                         
174264*                                                                         
174265     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
174266         MOVE '4320-OPEN-POE-CURSOR' TO DP013-PARAGRAPH                   
174267         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
174268                                   TO DP013-MESSAGE-TEXT (1)              
174269         MOVE SQLCA                TO DP013-SQLCA                         
174270         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)            
174271         SET DP013-DB2-ABEND                                              
174272             DP013-XCTL-DISPLAY-RESTART                                   
174273                                   TO TRUE                                
174274         PERFORM DP013-0000-PROCESS-ABEND                                 
174275     END-IF.                                                              
174276                                                                          
174277 EJECT                                                                    
174278*----------------------------------------------------------------*        
174279*   CLOSE THE POE CODE CURSOR                                    *        
174280*----------------------------------------------------------------*        
174281 4322-CLOSE-POE-CURSOR.                                                   
174282                                                                          
174283     EXEC SQL                                                             
174284          CLOSE POE-CSR                                                   
174285     END-EXEC.                                                            
174286                                                                          
174287     EVALUATE TRUE                                                        
174288         WHEN SQLCODE = ZERO                                              
174289             CONTINUE                                                     
174290         WHEN SQLWARN0 NOT = SPACES                                       
174291         WHEN SQLCODE < ZERO                                              
174292         WHEN SQLCODE > ZERO                                              
174293             MOVE '4322-CLOSE-POE-CURSOR'                                 
174294                               TO DP013-PARAGRAPH                         
174295             MOVE 'CLOSE POE CURSOR '                                     
174296                               TO DP013-MESSAGE-TEXT (1)                  
174297             MOVE SQLCA        TO DP013-SQLCA                             
174298             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)                
174299             SET DP013-DB2-ABEND                                          
174300                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
174301             PERFORM DP013-0000-PROCESS-ABEND                             
174302     END-EVALUATE.                                                        
174303                                                                          
174304 EJECT                                                                    
174305*----------------------------------------------------------------*11340099
174306*    FETCH THE POE CODE CURSOR                                   *11350099
174307*----------------------------------------------------------------*11360099
174308 4324-FETCH-POE-CURSOR.                                           11370099
174309                                                                  11380099
174310     EXEC SQL                                                     11390099
174311          FETCH POE-CSR                                           11400099
174312          INTO  :IMPOE-POE-CDE                                    11410099
174313     END-EXEC.                                                    11520099
174314                                                                  11530099
174315     EVALUATE TRUE                                                11540099
174316         WHEN SQLCODE = ZERO                                      11550099
174317         WHEN SQLCODE = -811                                              
174318              CONTINUE                                            11570099
174319         WHEN SQLCODE = +100                                      11560099
174320              MOVE SPACES TO IMPOE-POE-CDE                                
174321         WHEN SQLWARN0 NOT = SPACE                                11580099
174322         WHEN SQLCODE NOT = ZERO                                  11590099
174323              MOVE '4324-FETCH-POE-CURSOR'                        11600099
174324                               TO DP013-PARAGRAPH                 11610099
174325              MOVE 'FETCH POE CURSOR'                             11620099
174326                               TO DP013-MESSAGE-TEXT (1)          11630099
174327              MOVE SQLCA       TO DP013-SQLCA                     11640099
174328              SET DP013-DB2-ABEND                                 11650099
174329                               TO TRUE                            11660099
174330              PERFORM DP013-0000-PROCESS-ABEND                    11670099
174331     END-EVALUATE.                                                11680099
174332                                                                  11690099
174333 EJECT                                                            11750099
174334*----------------------------------------------------------------*        
174335*    FORMAT FILED DATE.                                          *        
174336*----------------------------------------------------------------*        
174340 4330-FORMAT-FILD-DTE.                                                    
174400                                                                          
174500     IF IMCSEN-FILD-TMST(1:10) EQUAL PC-INIT-DATE                         
174600         MOVE SPACES TO ASC-FILD                                          
174700                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
174800     ELSE                                                                 
174900         MOVE IMCSEN-FILD-TMST(9:2)  TO PV-FORMAT-DAY                     
175000         MOVE IMCSEN-FILD-TMST(6:2)  TO PV-FORMAT-MONTH                   
175100         MOVE PV-FORMAT-DATE         TO ASC-FILD                          
175200                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
175300     END-IF.                                                              
175400                                                                          
175500*----------------------------------------------------------------*        
175600*    FORMAT EXAM DATE.                                           *        
175700*----------------------------------------------------------------*        
175800 4340-FORMAT-EXM-DTE.                                                     
175900                                                                          
176000     IF IMCSEN-EXM-TMST(1:10) EQUAL PC-INIT-DATE                          
176100         MOVE SPACES TO ASC-EXM                                           
176200                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
176300     ELSE                                                                 
176400         MOVE IMCSEN-EXM-TMST(9:2)  TO PV-FORMAT-DAY                      
176500         MOVE IMCSEN-EXM-TMST(6:2)  TO PV-FORMAT-MONTH                    
176600         MOVE PV-FORMAT-DATE        TO ASC-EXM                            
176700                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
176800     END-IF.                                                              
176900                                                                          
177000*----------------------------------------------------------------*        
177100*    FORMAT REJECTED DATE.                                       *        
177200*----------------------------------------------------------------*        
177300 4350-FORMAT-REJ-DTE.                                                     
177400                                                                          
177500     IF IMCSEN-REJ-TMST(1:10) EQUAL PC-INIT-DATE                          
177600         MOVE SPACES TO ASC-REJ                                           
177700                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
177800     ELSE                                                                 
177900         MOVE IMCSEN-REJ-TMST(9:2)  TO PV-FORMAT-DAY                      
178000         MOVE IMCSEN-REJ-TMST(6:2)  TO PV-FORMAT-MONTH                    
178100         MOVE PV-FORMAT-DATE        TO ASC-REJ                            
178200                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
178300     END-IF.                                                              
178400                                                                          
178410*----------------------------------------------------------------*        
178420*    FORMAT ESTIMATED CLEARANCE DATE.                            *        
178430*----------------------------------------------------------------*        
178440 4355-FORMAT-EST-CLR-DTE.                                                 
178450                                                                          
178460     IF IMCSEN-EST-CLR-TMST(1:10) EQUAL PC-INIT-DATE                      
178470         MOVE SPACES TO ASC-EST-CLRD                                      
178480                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
178490     ELSE                                                                 
178491         MOVE IMCSEN-EST-CLR-TMST(9:2)  TO PV-FORMAT-DAY                  
178492         MOVE IMCSEN-EST-CLR-TMST(6:2)  TO PV-FORMAT-MONTH                
178493         MOVE PV-FORMAT-DATE             TO ASC-EST-CLRD                  
178494                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
178495     END-IF.                                                              
178496                                                                          
178500*----------------------------------------------------------------*        
178600*    FORMAT ACTUAL CLEARANCE DATE.                               *        
178700*----------------------------------------------------------------*        
178800 4360-FORMAT-ACT-CLR-DTE.                                                 
178900                                                                          
179000     IF IMCSEN-ACTL-CLR-TMST(1:10) EQUAL PC-INIT-DATE                     
179100         MOVE SPACES TO ASC-ACT-CLRD                                      
179200                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
179300     ELSE                                                                 
179400         MOVE IMCSEN-ACTL-CLR-TMST(9:2)  TO PV-FORMAT-DAY                 
179500         MOVE IMCSEN-ACTL-CLR-TMST(6:2)  TO PV-FORMAT-MONTH               
179600         MOVE PV-FORMAT-DATE             TO ASC-ACT-CLRD                  
179700                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
179800     END-IF.                                                              
179900                                                                          
180000*----------------------------------------------------------------*        
180100*    FORMAT LIQUIDATION DATE.                                    *        
180200*----------------------------------------------------------------*        
180300 4370-FORMAT-LQDN-DTE.                                                    
180400                                                                          
180500     IF IMCSEN-LQDN-TMST(1:10) EQUAL PC-INIT-DATE                         
180600         MOVE SPACES TO ASC-LQDN                                          
180700                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
180800     ELSE                                                                 
180900         MOVE IMCSEN-LQDN-TMST(9:2)  TO PV-FORMAT-DAY                     
181000         MOVE IMCSEN-LQDN-TMST(6:2)  TO PV-FORMAT-MONTH                   
181100         MOVE PV-FORMAT-DATE         TO ASC-LQDN                          
181200                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
181300     END-IF.                                                              
181400                                                                          
181500*----------------------------------------------------------------*        
181600*    FORMAT LIQUIDATION SUSPENSION DATE.                         *        
181700*----------------------------------------------------------------*        
181800 4380-FORMAT-LQDN-SSPNN-DTE.                                              
181900                                                                          
182000     IF IMCSEN-LQDN-SSPNN-TMST(1:10) EQUAL PC-INIT-DATE                   
182100         MOVE SPACES TO ASC-LQDN-SSPNN                                    
182200                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
182300     ELSE                                                                 
182400         MOVE IMCSEN-LQDN-SSPNN-TMST(9:2)  TO PV-FORMAT-DAY               
182500         MOVE IMCSEN-LQDN-SSPNN-TMST(6:2)  TO PV-FORMAT-MONTH             
182600         MOVE PV-FORMAT-DATE               TO ASC-LQDN-SSPNN              
182700                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
182800     END-IF.                                                              
182900                                                                          
183000*----------------------------------------------------------------*        
183100* SELECT THE PO COUNT FOR THE CUSTOMS ENTRY                      *        
183200*----------------------------------------------------------------*        
183300 4390-SELECT-PO-COUNT.                                                    
183400                                                                          
183500     EXEC SQL                                                             
183600         SELECT                                                           
183700               COUNT(DISTINCT PO_NBR)                                     
183800         INTO   :PV-PO-COUNT                                              
183900         FROM   TIMCSPO                                                   
184000         WHERE  CSTM_ENTR_ID   = :IMCSEN-CSTM-ENTR-ID                     
184100     END-EXEC.                                                            
184200                                                                          
184300     EVALUATE TRUE                                                        
184400         WHEN SQLCODE = ZERO                                              
184500         WHEN SQLCODE = +100                                              
184600              MOVE PV-PO-COUNT TO ASC-PO-CNT                              
184700                                  (ASC-BLK-SUB ASC-ITEM-SUB)              
184800         WHEN SQLWARN0 NOT = SPACE                                        
184900         WHEN SQLCODE NOT = ZERO                                          
185000              MOVE '4390-SELECT-PO-COUNT'                                 
185100                               TO DP013-PARAGRAPH                         
185200              MOVE 'SQL ERROR SELECTING PO COUNT'                         
185300                               TO DP013-MESSAGE-TEXT (1)                  
185400              MOVE SQLCA       TO DP013-SQLCA                             
185500              SET DP013-DB2-ABEND                                         
185600                               TO TRUE                                    
185700              PERFORM DP013-0000-PROCESS-ABEND                            
185800     END-EVALUATE.                                                        
185900                                                                          
186000 EJECT                                                                    
186100*----------------------------------------------------------------*        
186200* SELECT THE COUNTAINER COUNT FOR THE CUSTOMS ENTRY              *        
186300*----------------------------------------------------------------*        
186400 4395-SELECT-CONTNR-COUNT.                                                
186500                                                                          
186600     EXEC SQL                                                             
186700         SELECT                                                           
186800               COUNT(DISTINCT CONTNR_ID)                                  
186900         INTO   :PV-CONTNR-COUNT                                          
187000         FROM   TIMCSCN                                                   
187100         WHERE  CSTM_ENTR_ID   = :IMCSEN-CSTM-ENTR-ID                     
187200     END-EXEC.                                                            
187300                                                                          
187400     EVALUATE TRUE                                                        
187500         WHEN SQLCODE = ZERO                                              
187600         WHEN SQLCODE = +100                                              
187700              MOVE PV-CONTNR-COUNT TO ASC-CONT-CNT                        
187800                                  (ASC-BLK-SUB ASC-ITEM-SUB)              
187900         WHEN SQLWARN0 NOT = SPACE                                        
188000         WHEN SQLCODE NOT = ZERO                                          
188100              MOVE '4395-SELECT-CONTNR-COUNT'                             
188200                               TO DP013-PARAGRAPH                         
188300              MOVE 'SQL ERROR SELECTING CONTNR COUNT'                     
188400                               TO DP013-MESSAGE-TEXT (1)                  
188500              MOVE SQLCA       TO DP013-SQLCA                             
188600              SET DP013-DB2-ABEND                                         
188700                               TO TRUE                                    
188800              PERFORM DP013-0000-PROCESS-ABEND                            
188900     END-EVALUATE.                                                        
189000                                                                          
189100 EJECT                                                                    
189101*----------------------------------------------------------------*        
189102* CHECK FOR CUSTOMS ENTRY HISTORY                                *        
189103*----------------------------------------------------------------*        
189104 4397-SELECT-ENTRY-HISTORY.                                               
189105                                                                          
189106     PERFORM                                                              
189107         WITH TEST AFTER                                                  
189108         VARYING PV-RETRY-COUNTER                                         
189109         FROM 1 BY 1                                                      
189110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
189111            OR  (SQLCODE = ZERO)                                          
189112            OR  (SQLCODE = -811)                                          
189113            OR  (SQLCODE = +100))                                         
189114                                                                          
189115         EXEC SQL                                                         
189116              SELECT DISTINCT                                             
189117                     A.CSTM_ENTR_ID                                       
189118              INTO  :AUCSEN-CSTM-ENTR-ID                                  
189119              FROM   TAUCSEN A                                            
189120              WHERE  A.CSTM_ENTR_ID = :IMCSEN-CSTM-ENTR-ID                
189121                AND  A.AUD_FUNC_CDE = :PC-U                               
189122         END-EXEC                                                         
189123*                                                                         
189124         EVALUATE TRUE                                                    
189125             WHEN SQLCODE = -904                                          
189126             WHEN SQLCODE = -913                                          
189127                 CONTINUE                                                 
189128             WHEN SQLCODE = ZERO                                          
189129             WHEN SQLCODE = -811                                          
189130                  MOVE 'Y'         TO ASC-HISTORY                         
189131                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
189132             WHEN SQLCODE = +100                                          
189133                  MOVE 'N'         TO ASC-HISTORY                         
189134                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
189135             WHEN SQLWARN0 NOT = SPACES                                   
189136             WHEN SQLCODE < ZERO                                          
189137             WHEN SQLCODE > ZERO                                          
189138                 MOVE '4397-SELECT-ENTRY-HISTORY'                         
189139                                   TO DP013-PARAGRAPH                     
189140                 MOVE 'SQL ERROR SELECTING ENTRY'                         
189141                                   TO DP013-MESSAGE-TEXT (1)              
189142                 MOVE SQLCA        TO DP013-SQLCA                         
189143                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
189144                 SET DP013-DB2-ABEND                                      
189145                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
189146                 PERFORM DP013-0000-PROCESS-ABEND                         
189147         END-EVALUATE                                                     
189148     END-PERFORM.                                                         
189149*                                                                         
189150     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                                 
189151        MOVE '4397-SELECT-ENTRY-HISTORY' TO DP013-PARAGRAPH               
189152        MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'        
189153                                   TO DP013-MESSAGE-TEXT (1)              
189154        MOVE SQLCA                TO DP013-SQLCA                          
189155        MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)             
189156        SET DP013-DB2-ABEND                                               
189157            DP013-XCTL-DISPLAY-RESTART                                    
189158                                  TO TRUE                                 
189159        PERFORM DP013-0000-PROCESS-ABEND                                  
189160     END-IF.                                                              
189161                                                                          
189170 EJECT                                                                    
189200*----------------------------------------------------------------*        
189300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
189400*----------------------------------------------------------------*        
189500 4400-MOVE-COMMAREA-TO-SCREEN.                                            
189600                                                                          
189700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
189800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
189900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
190000             MOVE +1    TO ASC-BLK-SUB                                    
190100             PERFORM 5100-WRITE-TEMP-STORAGE                              
190200             ADD +1     TO ASC-BLK-SUB                                    
190300             PERFORM 5100-WRITE-TEMP-STORAGE                              
190400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
190500                 GIVING PV-BLOCK-NUMBER                                   
190600                 REMAINDER PV-REMAINDER                                   
190700             IF  PV-REMAINDER > ZERO                                      
190800                 ADD +1 TO PV-BLOCK-NUMBER                                
190900             END-IF                                                       
191000             MOVE +1    TO ASC-BLK-SUB                                    
191100             PERFORM 4410-READ-TEMP-STORAGE                               
191200             ADD +1     TO ASC-BLK-SUB                                    
191300                           PV-BLOCK-NUMBER                                
191400             PERFORM 4410-READ-TEMP-STORAGE                               
191500     END-IF.                                                              
191600     MOVE +1            TO ASC-BLK-SUB.                                   
191700     COMPUTE ASC-ITEM-SUB =                                               
191800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
191900         + PC-ITEMS-PER-PANEL).                                           
192000*                                                                         
192100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
192200         ADD +1         TO ASC-BLK-SUB                                    
192300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
192400     END-IF.                                                              
192500*                                                                         
192600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
192700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
192800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
192900     PERFORM 4420-FORMAT-LIST-LINES                                       
193000         VARYING PV-SUB                                                   
193100         FROM PC-ITEMS-PER-PANEL BY -1                                    
193200         UNTIL PV-SUB < +1.                                               
193300*                                                                         
193400     COMPUTE ASC-ITEMS-DISPLAYED =                                        
193500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
193600     PERFORM 4401-SELECT-PO-DETAILS.                                      
193700     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                                    
193701                                                                          
193710     PERFORM 4500-SELECT-CUSTOMS-DEL-HSTRY                                
193800                                                                          
193900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL            
194000                                      ASTRTITO.                           
194100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
194200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
194300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
194400                                   TO ASELITO.                            
194500                                                                          
194600     IF  DP020-MSG-NUMBER-X = SPACE                                       
194700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
194800*----------- MORE ITEMS TO DISPLAY --------                               
194900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
195000             SET DP020-MSG-INFORMATIONAL TO TRUE                          
195100         END-IF                                                           
195200     END-IF.                                                              
195300                                                                          
195400 EJECT                                                                    
195500*----------------------------------------------------------------*        
195600*    SELECT PO DETAILS.                                          *        
195700*----------------------------------------------------------------*        
195800 4401-SELECT-PO-DETAILS.                                                  
195900                                                                          
196000     PERFORM                                                              
196100         WITH TEST AFTER                                                  
196200         VARYING PV-RETRY-COUNTER                                         
196300         FROM 1 BY 1                                                      
196400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
196500            OR  (SQLCODE = ZERO)                                          
196600            OR  (SQLCODE = +100))                                         
196700                                                                          
196800         EXEC SQL                                                         
196900              SELECT B.ENT_NAME_DESC                                      
197000              INTO  :ENTNME-ENT-NAME-DESC                                 
197100              FROM   TPURCHS A,                                           
197200                     TENTNME B                                            
197300              WHERE  A.PO_NBR         = :DK-PO-NBR                        
197400                AND  A.VER_STATUS_CDE = 'A'                               
197500                AND  B.ENT_ID         =  A.ENT_ID                         
197600                AND  B.TYPE_CDE       = '01'                              
197700         END-EXEC                                                         
197800*                                                                         
197900         EVALUATE TRUE                                                    
198000             WHEN SQLCODE = ZERO                                          
198100             WHEN SQLCODE = +100                                          
198200             WHEN SQLCODE = -904                                          
198300             WHEN SQLCODE = -913                                          
198400                 CONTINUE                                                 
198500             WHEN SQLWARN0 NOT = SPACES                                   
198600             WHEN SQLCODE < ZERO                                          
198700             WHEN SQLCODE > ZERO                                          
198800                 MOVE '4401-SELECT-PO-DETAILS'                            
198900                                   TO DP013-PARAGRAPH                     
199000                 MOVE 'SQL ERROR SELECTING PO DETAILS'                    
199100                                   TO DP013-MESSAGE-TEXT (1)              
199200                 MOVE SQLCA        TO DP013-SQLCA                         
199300                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            
199400                 SET DP013-DB2-ABEND                                      
199500                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
199600                 PERFORM DP013-0000-PROCESS-ABEND                         
199700         END-EVALUATE                                                     
199800     END-PERFORM.                                                         
199900*                                                                         
200000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
200100         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH              
200200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'          
200300                                   TO DP013-MESSAGE-TEXT (1)              
200400         MOVE SQLCA                TO DP013-SQLCA                         
200500         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)            
200600         SET DP013-DB2-ABEND                                              
200700             DP013-XCTL-DISPLAY-RESTART                                   
200800                                   TO TRUE                                
200900         PERFORM DP013-0000-PROCESS-ABEND                                 
201000     END-IF.                                                              
201100                                                                          
201200 EJECT                                                                    
201300*----------------------------------------------------------------*        
201400*    MOVE PO DETAILS TO SCREEN.                                  *        
201500*----------------------------------------------------------------*        
201600 4407-MOVE-PO-DTLS-TO-SCR.                                                
201700                                                                          
201911     EVALUATE TRUE                                                        
201912                                                                          
202031         WHEN ASC-KEY-CONTNR-ID > SPACES                                  
202032               MOVE ASC-KEY-CONTNR-ID    TO PV-CONTNR-HDR-CONTNR          
202033               MOVE PV-CONTNR-HDR-LINE   TO AHDRLNEO                      
202037                                                                          
202038         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES AND                           
202039              ASC-KEY-MSTR-BOL-NBR > SPACES                               
202040               MOVE ASC-KEY-HSE-BOL-NBR   TO PV-HBOL-MBOL-HDR-HBOL        
202041               MOVE ASC-KEY-MSTR-BOL-NBR  TO PV-HBOL-MBOL-HDR-MBOL        
202042               MOVE PV-HBOL-MBOL-HDR-LINE TO AHDRLNEO                     
202043                                                                          
202044         WHEN ASC-KEY-HSE-BOL-NBR > SPACES                                
202045               MOVE ASC-KEY-HSE-BOL-NBR    TO PV-HBOL-HDR-HBOL            
202046               MOVE PV-HBOL-HDR-LINE       TO AHDRLNEO                    
202047                                                                          
202048         WHEN ASC-KEY-MSTR-BOL-NBR > SPACES                               
202049               MOVE ASC-KEY-MSTR-BOL-NBR   TO PV-MBOL-HDR-MBOL            
202050               MOVE PV-MBOL-HDR-LINE       TO AHDRLNEO                    
202051                                                                          
202052         WHEN ASC-KEY-CSTM-ENTRY-ID  > SPACES                             
202053               MOVE ASC-KEY-CSTM-ENTRY-ID  TO PV-ENTRY-HDR-ENTRY          
202054               MOVE PV-ENTRY-HDR-LINE      TO AHDRLNEO                    
202055                                                                          
202056         WHEN ASC-KEY-PO-NBR > ZEROES                                     
202057               PERFORM 4401-SELECT-PO-DETAILS                             
202058               MOVE ASC-KEY-PO-NBR-N       TO PV-PO-HDR-PO                
202059               MOVE ENTNME-ENT-NAME-DESC   TO                             
202060                                         PV-PO-HDR-ENT-NME-DESC           
202061               MOVE PV-PO-HDR-LINE         TO AHDRLNEO                    
202062                                                                          
202063     END-EVALUATE.                                                        
202064                                                                          
202130*----------------------------------------------------------------*        
202200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
202300*----------------------------------------------------------------*        
202400 4410-READ-TEMP-STORAGE.                                                  
202500                                                                          
202600     EXEC CICS                                                            
202700         READQ TS                                                         
202800             QUEUE (ASC-LIST-QUEUE-NAME)                                  
202900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
203000             ITEM  (PV-BLOCK-NUMBER)                                      
203100             RESP  (PV-CICS-RESP)                                         
203200     END-EXEC.                                                            
203300*                                                                         
203400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
203500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
203600         CONTINUE                                                         
203700     ELSE                                                                 
203800         SET DP013-CICS-ABEND     TO TRUE                                 
203900         SET DP013-NO-ROLLBACK    TO TRUE                                 
204000         MOVE '4410-READ-TEMP-STORAGE'                                    
204100                                  TO DP013-PARAGRAPH                      
204200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
204300                                  TO DP013-MESSAGE-TEXT(1)                
204400         PERFORM DP013-0000-PROCESS-ABEND                                 
204500     END-IF.                                                              
204600*                                                                         
204700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
204800*                                                                         
204900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
205000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
205100     END-IF.                                                              
205200                                                                          
205300 EJECT                                                                    
205400*----------------------------------------------------------------*        
205500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
205600*----------------------------------------------------------------*        
205700 4420-FORMAT-LIST-LINES.                                                  
205800                                                                          
205900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
206000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
206100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)              
206200         MOVE DP015-HL-OFF       TO MR-SELECTH      (PV-SUB)              
206300         MOVE SPACES             TO MR-SELECTI      (PV-SUB)              
206400                                    MR-ACTION       (PV-SUB)              
206500                                    MR-ENTRY-NBR    (PV-SUB)              
206610                                    MR-FILED        (PV-SUB)              
206700                                    MR-EXAM         (PV-SUB)              
206800                                    MR-REJ          (PV-SUB)              
206900                                    MR-EST-CLRD     (PV-SUB)              
206910                                    MR-ACT-CLRD     (PV-SUB)              
207000                                    MR-LIQ          (PV-SUB)              
207100                                    MR-SLIQ         (PV-SUB)              
207200                                    MR-POE          (PV-SUB)              
207300                                    MR-LAST-TRN     (PV-SUB)              
207310                                    MR-PO-CNT-X     (PV-SUB)              
207320                                    MR-CONTNR-CNT-X (PV-SUB)              
207330                                    MR-HISTORY      (PV-SUB)              
207500     ELSE                                                                 
207600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)              
207700                                                   > SPACE                
207800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
207900                                 TO MR-SELECTI (PV-SUB)                   
208000         ELSE                                                             
208100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)              
208200                                 TO MR-SELECTI (PV-SUB)                   
208300         END-IF                                                           
208400                                                                          
208500         IF  DP030-SET-CURSOR-TRAILER                                     
208600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)        
208700                 > SPACE)                                                 
208800               OR (PV-SUB = 1))                                           
208900                SET DP030-SET-CURSOR-APPL-1 TO TRUE                       
209000                MOVE -1          TO MR-SELECTL (PV-SUB)                   
209100             END-IF                                                       
209200         END-IF                                                           
209300                                                                          
209400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
209500             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)                 
209600                               TO MR-ACTION (PV-SUB)                      
209700             MOVE ASC-CSTM-ENTR-ID (ASC-BLK-SUB ASC-ITEM-SUB)             
209800                                 TO MR-ENTRY-NBR  (PV-SUB)                
209810             MOVE ASC-POE          (ASC-BLK-SUB ASC-ITEM-SUB)             
209820                                 TO MR-POE     (PV-SUB)                   
209900             MOVE ASC-FILD         (ASC-BLK-SUB ASC-ITEM-SUB)             
210000                                 TO MR-FILED   (PV-SUB)                   
210100             MOVE ASC-EXM          (ASC-BLK-SUB ASC-ITEM-SUB)             
210200                                 TO MR-EXAM    (PV-SUB)                   
210300             MOVE ASC-REJ          (ASC-BLK-SUB ASC-ITEM-SUB)             
210400                                 TO MR-REJ     (PV-SUB)                   
210500             MOVE ASC-EST-CLRD     (ASC-BLK-SUB ASC-ITEM-SUB)             
210600                                 TO MR-EST-CLRD (PV-SUB)                  
210610             MOVE ASC-ACT-CLRD     (ASC-BLK-SUB ASC-ITEM-SUB)             
210620                                 TO MR-ACT-CLRD (PV-SUB)                  
210700             MOVE ASC-LQDN         (ASC-BLK-SUB ASC-ITEM-SUB)             
210800                                 TO MR-LIQ     (PV-SUB)                   
210900             MOVE ASC-LQDN-SSPNN   (ASC-BLK-SUB ASC-ITEM-SUB)             
211000                                 TO MR-SLIQ    (PV-SUB)                   
211100             MOVE ASC-PO-CNT       (ASC-BLK-SUB ASC-ITEM-SUB)             
211200                                 TO MR-PO-CNT  (PV-SUB)                   
211300             MOVE ASC-CONT-CNT     (ASC-BLK-SUB ASC-ITEM-SUB)             
211400                                 TO MR-CONTNR-CNT (PV-SUB)                
211410             MOVE ASC-LAST-TRN     (ASC-BLK-SUB ASC-ITEM-SUB)             
211420                                 TO MR-LAST-TRN (PV-SUB)                  
211430             MOVE ASC-HISTORY      (ASC-BLK-SUB ASC-ITEM-SUB)             
211440                                 TO MR-HISTORY (PV-SUB)                   
211500         END-IF                                                           
211600     END-IF.                                                              
211700     SUBTRACT +1 FROM ASC-ITEM-SUB                                        
211800     IF  ASC-ITEM-SUB < + 1                                               
211900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
212000         MOVE +1                 TO ASC-BLK-SUB                           
212100     END-IF.                                                              
212200                                                                          
212300 EJECT                                                                    
212400*----------------------------------------------------------------*        
212500*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *        
212600*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *        
212700*  ISSUE A WARNING.                                              *        
212800*----------------------------------------------------------------*        
212900 4430-CHECK-FOR-BEGIN-AND-END.                                            
213000                                                                          
213100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
213200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
213300*----------- NO END-OF-RANGE SPECFIED ---                                 
213400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
213500             SET DP020-MSG-WARNING TO TRUE                                
213600             PERFORM 4431-POSITION-AT-WARNING                             
213700         END-IF                                                           
213800     ELSE                                                                 
213900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
214000*----------- NO BEGINNING-OF-RANGE SPECFIED ---                           
214100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
214200             SET DP020-MSG-WARNING TO TRUE                                
214300             PERFORM 4431-POSITION-AT-WARNING                             
214400         END-IF                                                           
214500     END-IF.                                                              
214600                                                                          
214700 EJECT                                                                    
214800*----------------------------------------------------------------*        
214900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *        
215000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *        
215100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *        
215200*  POSITION THE CURSOR THERE.                                    *        
215300*----------------------------------------------------------------*        
215400 4431-POSITION-AT-WARNING.                                                
215500                                                                          
215600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
215700                    - PV-TOP-ITEM + 1.                                    
215800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
215900         CONTINUE                                                         
216000     ELSE                                                                 
216100         SET DP030-SET-CURSOR-APPL-1                                      
216200                                   TO TRUE                                
216300         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
216400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
216500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
216600     END-IF.                                                              
216700*                                                                         
216800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
216900                    - PV-TOP-ITEM + 1.                                    
217000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
217100         CONTINUE                                                         
217200     ELSE                                                                 
217300         SET DP030-SET-CURSOR-APPL-1                                      
217400                                   TO TRUE                                
217500         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
217600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
217700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
217800     END-IF.                                                              
217900                                                                          
218000 EJECT                                                                    
218010*----------------------------------------------------------------*        
218020*   DETERMINE WHAT SELECT TO USE TO GET CUSTOMS ENTRY HISTORY    *        
218030*   DEPENDING ON WHAT VALUES WERE PASSED FROM THE CRIT SPEC.     *        
218040*----------------------------------------------------------------*        
218050 4500-SELECT-CUSTOMS-DEL-HSTRY.                                           
218060                                                                          
218070     EVALUATE TRUE                                                        
218080         WHEN ASC-KEY-CSTM-ENTRY-ID > SPACES                              
218090               PERFORM 4505-SELECT-BY-ENTRY                               
218091                                                                          
218092         WHEN ASC-KEY-CONTNR-ID > SPACES                                  
218093               PERFORM 4510-SELECT-BY-CONTNR                              
218094                                                                          
218095         WHEN ASC-KEY-PO-NBR > ZEROES                                     
218096               PERFORM 4515-SELECT-BY-PO                                  
218097                                                                          
218098         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES  AND                          
218099              ASC-KEY-MSTR-BOL-NBR > SPACES                               
218100               PERFORM 4520-SELECT-BY-HBOL-MBOL                           
218101                                                                          
218102         WHEN ASC-KEY-HSE-BOL-NBR  > SPACES                               
218103               PERFORM 4525-SELECT-BY-HBOL                                
218104                                                                          
218105         WHEN ASC-KEY-MSTR-BOL-NBR  > SPACES                              
218106               PERFORM 4530-SELECT-BY-MBOL                                
218107                                                                          
218108     END-EVALUATE.                                                        
218109                                                                          
218110 EJECT                                                                    
218111*----------------------------------------------------------------*        
218112* CHECK FOR DELETED CUSTOMS ENTRY HISTORY USING THE ENTRY ID.    *        
218113*----------------------------------------------------------------*        
218114 4505-SELECT-BY-ENTRY.                                                    
218115                                                                          
218116     PERFORM                                                              
218117         WITH TEST AFTER                                                  
218118         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
218119         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
218120                 SQLCODE = ZERO                     OR                    
218121                 SQLCODE = +100                     OR                    
218122                 SQLCODE = -811                                           
218123                                                                          
218124         EXEC SQL                                                         
218125             SELECT A.CSTM_ENTR_ID                                        
218126               INTO :AUCSEN-CSTM-ENTR-ID                                  
218127               FROM                                                       
218128                    TAUCSEN  A                                            
218129              WHERE                                                       
218130                    A.CSTM_ENTR_ID = :DK-ENTRY-ID                         
218131                AND A.AUD_FUNC_CDE = :PC-D                                
218136         END-EXEC                                                         
218137                                                                          
218138         EVALUATE TRUE                                                    
218139             WHEN SQLCODE = -904                                          
218140             WHEN SQLCODE = -913                                          
218141                 CONTINUE                                                 
218142             WHEN SQLCODE = ZERO                                          
218143             WHEN SQLCODE = -811                                          
218144                 MOVE PC-HISTORY-MSG TO AMSGO                             
218145             WHEN SQLCODE = +100                                          
218146                 MOVE SPACES TO AMSGO                                     
218147             WHEN SQLWARN0 NOT = SPACES                                   
218148             WHEN SQLCODE < ZERO                                          
218149             WHEN SQLCODE > ZERO                                          
218150                 MOVE '4505--ELECT-BY-ENTRY'                              
218151                                   TO DP013-PARAGRAPH                     
218152                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'                  
218153                                   TO DP013-MESSAGE-TEXT (1)              
218154                 MOVE SQLCA        TO DP013-SQLCA                         
218155                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
218156                 SET DP013-DB2-ABEND                                      
218157                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
218158                 PERFORM DP013-0000-PROCESS-ABEND                         
218159         END-EVALUATE                                                     
218160     END-PERFORM.                                                         
218161*                                                                         
218162     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
218163         MOVE '4505-SELECT-BY-ENTRY'                                      
218164                                   TO DP013-PARAGRAPH                     
218165         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'           
218166                                   TO DP013-MESSAGE-TEXT (1)              
218167         MOVE SQLCA                TO DP013-SQLCA                         
218168         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)            
218169         SET DP013-DB2-ABEND                                              
218170             DP013-XCTL-DISPLAY-RESTART                                   
218171                                   TO TRUE                                
218172         PERFORM DP013-0000-PROCESS-ABEND                                 
218173     END-IF.                                                              
218174                                                                          
218175 EJECT                                                                    
218176*----------------------------------------------------------------*        
218177* CHECK FOR DELETED CUSTOMS ENTRY HISTORY USING THE CONTAINER ID.*        
218178*----------------------------------------------------------------*        
218179 4510-SELECT-BY-CONTNR.                                                   
218180                                                                          
218181     PERFORM                                                              
218182         WITH TEST AFTER                                                  
218183         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
218184         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
218185                 SQLCODE = ZERO                     OR                    
218186                 SQLCODE = +100                     OR                    
218187                 SQLCODE = -811                                           
218188                                                                          
218189         EXEC SQL                                                         
218190             SELECT A.CSTM_ENTR_ID                                        
218191               INTO :AUCSEN-CSTM-ENTR-ID                                  
218192               FROM                                                       
218193                    TAUCSEN  A                                            
218194                   ,TAUCSCN  B                                            
218195              WHERE                                                       
218196                    B.CONTNR_ID    = :DK-CONTNR-ID                        
218197                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID                       
218198                AND A.AUD_FUNC_CDE = :PC-D                                
218203         END-EXEC                                                         
218204                                                                          
218205         EVALUATE TRUE                                                    
218206             WHEN SQLCODE = -904                                          
218207             WHEN SQLCODE = -913                                          
218208                 CONTINUE                                                 
218209             WHEN SQLCODE = ZERO                                          
218210             WHEN SQLCODE = -811                                          
218211                 MOVE PC-HISTORY-MSG TO AMSGO                             
218212             WHEN SQLCODE = +100                                          
218213                 MOVE SPACES TO AMSGO                                     
218214             WHEN SQLWARN0 NOT = SPACES                                   
218215             WHEN SQLCODE < ZERO                                          
218216             WHEN SQLCODE > ZERO                                          
218217                 MOVE '4510-SELECT-BY-CONTNR'                             
218218                                   TO DP013-PARAGRAPH                     
218219                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'                  
218220                                   TO DP013-MESSAGE-TEXT (1)              
218221                 MOVE SQLCA        TO DP013-SQLCA                         
218222                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
218223                 SET DP013-DB2-ABEND                                      
218224                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
218225                 PERFORM DP013-0000-PROCESS-ABEND                         
218226         END-EVALUATE                                                     
218227     END-PERFORM.                                                         
218228*                                                                         
218229     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
218230         MOVE '4510-SELECT-BY-CONTNR'                                     
218231                                   TO DP013-PARAGRAPH                     
218232         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'           
218233                                   TO DP013-MESSAGE-TEXT (1)              
218234         MOVE SQLCA                TO DP013-SQLCA                         
218235         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)            
218236         SET DP013-DB2-ABEND                                              
218237             DP013-XCTL-DISPLAY-RESTART                                   
218238                                   TO TRUE                                
218239         PERFORM DP013-0000-PROCESS-ABEND                                 
218240     END-IF.                                                              
218241                                                                          
218242 EJECT                                                                    
218243*----------------------------------------------------------------*        
218244* CHECK FOR DELETED CUSTOMS ENTRY HISTORY USING THE PO NUMBER.   *        
218245*----------------------------------------------------------------*        
218246 4515-SELECT-BY-PO.                                                       
218247                                                                          
218248     PERFORM                                                              
218249         WITH TEST AFTER                                                  
218250         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
218251         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
218252                 SQLCODE = ZERO                     OR                    
218253                 SQLCODE = +100                     OR                    
218254                 SQLCODE = -811                                           
218255                                                                          
218256         EXEC SQL                                                         
218257             SELECT B.CSTM_ENTR_ID                                        
218258               INTO :AUCSEN-CSTM-ENTR-ID                                  
218259               FROM                                                       
218260                    TAUCSPO  A                                            
218261                   ,TAUCSEN  B                                            
218262              WHERE                                                       
218263                    A.PO_NBR       = :DK-PO-NBR                           
218264                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID                       
218265                AND B.AUD_FUNC_CDE = :PC-D                                
218270         END-EXEC                                                         
218271                                                                          
218272         EVALUATE TRUE                                                    
218273             WHEN SQLCODE = -904                                          
218274             WHEN SQLCODE = -913                                          
218275                 CONTINUE                                                 
218276             WHEN SQLCODE = ZERO                                          
218277             WHEN SQLCODE = -811                                          
218278                 MOVE PC-HISTORY-MSG TO AMSGO                             
218279             WHEN SQLCODE = +100                                          
218280                 MOVE SPACES TO AMSGO                                     
218281             WHEN SQLWARN0 NOT = SPACES                                   
218282             WHEN SQLCODE < ZERO                                          
218283             WHEN SQLCODE > ZERO                                          
218284                 MOVE '4515-SELECT-BY-PO'                                 
218285                                   TO DP013-PARAGRAPH                     
218286                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'                  
218287                                   TO DP013-MESSAGE-TEXT (1)              
218288                 MOVE SQLCA        TO DP013-SQLCA                         
218289                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
218290                 SET DP013-DB2-ABEND                                      
218291                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
218292                 PERFORM DP013-0000-PROCESS-ABEND                         
218293         END-EVALUATE                                                     
218294     END-PERFORM.                                                         
218295*                                                                         
218296     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
218297         MOVE '4515-SELECT-BY-PO'                                         
218298                                   TO DP013-PARAGRAPH                     
218299         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'           
218300                                   TO DP013-MESSAGE-TEXT (1)              
218301         MOVE SQLCA                TO DP013-SQLCA                         
218302         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)            
218303         SET DP013-DB2-ABEND                                              
218304             DP013-XCTL-DISPLAY-RESTART                                   
218305                                   TO TRUE                                
218306         PERFORM DP013-0000-PROCESS-ABEND                                 
218307     END-IF.                                                              
218308                                                                          
218309 EJECT                                                                    
218310*----------------------------------------------------------------*        
218311* CHECK FOR DELETED CUSTOMS ENTRY HISTORY USING THE HBOL/MBOL.   *        
218312*----------------------------------------------------------------*        
218313 4520-SELECT-BY-HBOL-MBOL.                                                
218314                                                                          
218315     PERFORM                                                              
218316         WITH TEST AFTER                                                  
218317         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
218318         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
218319                 SQLCODE = ZERO                     OR                    
218320                 SQLCODE = +100                     OR                    
218321                 SQLCODE = -811                                           
218322                                                                          
218323         EXEC SQL                                                         
218324             SELECT B.CSTM_ENTR_ID                                        
218325               INTO :AUCSEN-CSTM-ENTR-ID                                  
218326               FROM                                                       
218327                    TAUCSBL  A                                            
218328                   ,TAUCSEN  B                                            
218329              WHERE                                                       
218330                    A.HSE_BOL_NBR   = :DK-HSE-BOL-NBR                     
218331                AND A.MSTR_BOL_NBR  = :DK-MSTR-BOL-NBR                    
218332                AND A.CSTM_ENTR_ID  = B.CSTM_ENTR_ID                      
218333                AND B.AUD_FUNC_CDE = :PC-D                                
218338         END-EXEC                                                         
218339                                                                          
218340         EVALUATE TRUE                                                    
218341             WHEN SQLCODE = -904                                          
218342             WHEN SQLCODE = -913                                          
218343                 CONTINUE                                                 
218344             WHEN SQLCODE = ZERO                                          
218345             WHEN SQLCODE = -811                                          
218346                 MOVE PC-HISTORY-MSG TO AMSGO                             
218347             WHEN SQLCODE = +100                                          
218348                 MOVE SPACES TO AMSGO                                     
218349             WHEN SQLWARN0 NOT = SPACES                                   
218350             WHEN SQLCODE < ZERO                                          
218351             WHEN SQLCODE > ZERO                                          
218352                 MOVE '4520-SELECT-BY-HBOL-MBOL'                          
218353                                   TO DP013-PARAGRAPH                     
218354                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'                  
218355                                   TO DP013-MESSAGE-TEXT (1)              
218356                 MOVE SQLCA        TO DP013-SQLCA                         
218357                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
218358                 SET DP013-DB2-ABEND                                      
218359                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
218360                 PERFORM DP013-0000-PROCESS-ABEND                         
218361         END-EVALUATE                                                     
218362     END-PERFORM.                                                         
218363*                                                                         
218364     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
218365         MOVE '4520-SELECT-BY-HBOL-MBOL'                                  
218366                                   TO DP013-PARAGRAPH                     
218367         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'           
218368                                   TO DP013-MESSAGE-TEXT (1)              
218369         MOVE SQLCA                TO DP013-SQLCA                         
218370         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)            
218371         SET DP013-DB2-ABEND                                              
218372             DP013-XCTL-DISPLAY-RESTART                                   
218373                                   TO TRUE                                
218374         PERFORM DP013-0000-PROCESS-ABEND                                 
218375     END-IF.                                                              
218376                                                                          
218377 EJECT                                                                    
218378*----------------------------------------------------------------*        
218379* CHECK FOR DELETED CUSTOMS ENTRY HISTORY USING THE HBOL.        *        
218380*----------------------------------------------------------------*        
218381 4525-SELECT-BY-HBOL.                                                     
218382                                                                          
218383     PERFORM                                                              
218384         WITH TEST AFTER                                                  
218385         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
218386         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
218387                 SQLCODE = ZERO                     OR                    
218388                 SQLCODE = +100                     OR                    
218389                 SQLCODE = -811                                           
218390                                                                          
218391         EXEC SQL                                                         
218392             SELECT B.CSTM_ENTR_ID                                        
218393               INTO :AUCSEN-CSTM-ENTR-ID                                  
218394               FROM                                                       
218395                    TAUCSBL  A                                            
218396                   ,TAUCSEN  B                                            
218397              WHERE                                                       
218398                    A.HSE_BOL_NBR     = :DK-HSE-BOL-NBR                   
218399                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID                       
218400                AND B.AUD_FUNC_CDE = :PC-D                                
218405         END-EXEC                                                         
218406                                                                          
218407         EVALUATE TRUE                                                    
218408             WHEN SQLCODE = -904                                          
218409             WHEN SQLCODE = -913                                          
218410                 CONTINUE                                                 
218411             WHEN SQLCODE = ZERO                                          
218412             WHEN SQLCODE = -811                                          
218413                 MOVE PC-HISTORY-MSG TO AMSGO                             
218414             WHEN SQLCODE = +100                                          
218415                 MOVE SPACES TO AMSGO                                     
218416             WHEN SQLWARN0 NOT = SPACES                                   
218417             WHEN SQLCODE < ZERO                                          
218418             WHEN SQLCODE > ZERO                                          
218419                 MOVE '4525-SELECT-BY-HBOL'                               
218420                                   TO DP013-PARAGRAPH                     
218421                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'                  
218422                                   TO DP013-MESSAGE-TEXT (1)              
218423                 MOVE SQLCA        TO DP013-SQLCA                         
218424                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
218425                 SET DP013-DB2-ABEND                                      
218426                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
218427                 PERFORM DP013-0000-PROCESS-ABEND                         
218428         END-EVALUATE                                                     
218429     END-PERFORM.                                                         
218430*                                                                         
218431     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
218432         MOVE '4525-SELECT-BY-HBOL'                                       
218433                                   TO DP013-PARAGRAPH                     
218434         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'           
218435                                   TO DP013-MESSAGE-TEXT (1)              
218436         MOVE SQLCA                TO DP013-SQLCA                         
218437         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)            
218438         SET DP013-DB2-ABEND                                              
218439             DP013-XCTL-DISPLAY-RESTART                                   
218440                                   TO TRUE                                
218441         PERFORM DP013-0000-PROCESS-ABEND                                 
218442     END-IF.                                                              
218443                                                                          
218444 EJECT                                                                    
218445*----------------------------------------------------------------*        
218446* CHECK FOR DELETED CUSTOMS ENTRY HISTORY USING THE MBOL.        *        
218447*----------------------------------------------------------------*        
218448 4530-SELECT-BY-MBOL.                                                     
218449                                                                          
218450     PERFORM                                                              
218451         WITH TEST AFTER                                                  
218452         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
218453         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
218454                 SQLCODE = ZERO                     OR                    
218455                 SQLCODE = +100                     OR                    
218456                 SQLCODE = -811                                           
218457                                                                          
218458         EXEC SQL                                                         
218459             SELECT B.CSTM_ENTR_ID                                        
218460               INTO :AUCSEN-CSTM-ENTR-ID                                  
218461               FROM                                                       
218462                    TAUCSBL  A                                            
218463                   ,TAUCSEN  B                                            
218464              WHERE                                                       
218465                    A.MSTR_BOL_NBR     = :DK-MSTR-BOL-NBR                 
218466                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID                       
218467                AND B.AUD_FUNC_CDE = :PC-D                                
218472         END-EXEC                                                         
218473                                                                          
218474         EVALUATE TRUE                                                    
218475             WHEN SQLCODE = -904                                          
218476             WHEN SQLCODE = -913                                          
218477                 CONTINUE                                                 
218478             WHEN SQLCODE = ZERO                                          
218479             WHEN SQLCODE = -811                                          
218480                 MOVE PC-HISTORY-MSG TO AMSGO                             
218481             WHEN SQLCODE = +100                                          
218482                 MOVE SPACES TO AMSGO                                     
218483             WHEN SQLWARN0 NOT = SPACES                                   
218484             WHEN SQLCODE < ZERO                                          
218485             WHEN SQLCODE > ZERO                                          
218486                 MOVE '4530-SELECT-BY-MBOL'                               
218487                                   TO DP013-PARAGRAPH                     
218488                 MOVE 'SQL ERROR SELECTING CUSTOM ENTRY'                  
218489                                   TO DP013-MESSAGE-TEXT (1)              
218490                 MOVE SQLCA        TO DP013-SQLCA                         
218491                 MOVE 'TAUCSEN '   TO DP013-DB2-TABLE-NAME (1)            
218492                 SET DP013-DB2-ABEND                                      
218493                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
218494                 PERFORM DP013-0000-PROCESS-ABEND                         
218495         END-EVALUATE                                                     
218496     END-PERFORM.                                                         
218497*                                                                         
218498     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
218499         MOVE '4530-SELECT-BY-MBOL'                                       
218500                                   TO DP013-PARAGRAPH                     
218501         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT ENTRY'           
218502                                   TO DP013-MESSAGE-TEXT (1)              
218503         MOVE SQLCA                TO DP013-SQLCA                         
218504         MOVE 'TAUCSEN '           TO DP013-DB2-TABLE-NAME (1)            
218505         SET DP013-DB2-ABEND                                              
218506             DP013-XCTL-DISPLAY-RESTART                                   
218507                                   TO TRUE                                
218508         PERFORM DP013-0000-PROCESS-ABEND                                 
218509     END-IF.                                                              
218510                                                                          
218511 EJECT                                                                    
218512*----------------------------------------------------------------*        
218513* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *        
218514* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *        
218515* FOR THE SELECTED ITEMS QUEUE.                                  *        
218520*                                                                *        
218600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *        
218700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *        
218800* THE ARRAY IS FULL.                                             *        
218900*----------------------------------------------------------------*        
219000 5000-PREPARE-SEL-QUEUE.                                                  
219100                                                                          
219200     MOVE +1                   TO  ASC-BLK-SUB.                           
219300     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
219400     ADD +1                    TO  ASC-BLK-SUB.                           
219500     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
219600     MOVE ASC-SEL-QUEUE-NAME   TO  TR114-SEL-QUEUE-NAME.                  
219700     PERFORM 6010-DELETE-SEL-QUEUE.                                       
219800                                                                          
219900     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
220000                                                                          
220100     SET TR112-IDX             TO  1.                                     
220200     MOVE ZERO                 TO TR114-NUMBER-OF-TS-ITEMS.               
220300     INITIALIZE TR112-SELECTED-ITEM-ARRAY.                                
220400                                                                          
220500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
220600             VARYING PV-ITEM                                              
220700             FROM 1 BY 1                                                  
220800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
220900                                                                          
221000     IF  TR112-IDX > 1                                                    
221100         PERFORM 5205-WRITE-SEL-QUEUE                                     
221200         ADD +1                    TO TR114-NUMBER-OF-TS-ITEMS            
221400     END-IF.                                                              
221500                                                                          
221600 5001-PREPARE-SEL-QUEUE.                                                  
221700                                                                          
221800     MOVE +1                   TO  ASC-BLK-SUB.                           
221900     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
222000     ADD +1                    TO  ASC-BLK-SUB.                           
222100     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
222200     MOVE ASC-SEL-QUEUE-NAME   TO  TR114-SEL-QUEUE-NAME.                  
222300     PERFORM 6010-DELETE-SEL-QUEUE.                                       
222400                                                                          
222500     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
222600                                                                          
222700     SET TR112-IDX             TO  1.                                     
222800     MOVE ZERO                 TO TR114-NUMBER-OF-TS-ITEMS.               
222900     INITIALIZE TR112-SELECTED-ITEM-ARRAY.                                
223000                                                                          
223100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
223200             VARYING PV-ITEM                                              
223300             FROM 1 BY 1                                                  
223400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
223500                                                                          
223600     IF  TR112-IDX > 1                                                    
223700         PERFORM 5205-WRITE-SEL-QUEUE                                     
223800         ADD +1                    TO TR114-NUMBER-OF-TS-ITEMS            
223900     END-IF.                                                              
224000                                                                          
224100 EJECT                                                                    
224200*----------------------------------------------------------------*        
224300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
224400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *        
224500*----------------------------------------------------------------*        
224600 5100-WRITE-TEMP-STORAGE.                                                 
224700                                                                          
224800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
224900                                   TO PV-LIST-ITEM-NUMBER.                
225000     COMPUTE PV-BLOCK-NUMBER =                                            
225100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
225200                                                                          
225300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                     
225400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                     
225500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                              
225600             PERFORM 5105-REWRITE-ASC-LISTQ                               
225700         END-IF                                                           
225800     ELSE                                                                 
225900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                               
226000         ASC-HIGHEST-BLOCK-WRITTEN + 1                                    
226100         PERFORM 5110-WRITE-ASC-LISTQ                                     
226200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN           
226300     END-IF.                                                              
226400                                                                          
226500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
226600                                                                          
226700 EJECT                                                                    
226800*----------------------------------------------------------------*        
226900*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *        
227000*  SPECIFIC COMMAREA.                                            *        
227100*----------------------------------------------------------------*        
227200 5105-REWRITE-ASC-LISTQ.                                                  
227300                                                                          
227400     EXEC CICS                                                            
227500         WRITEQ TS                                                        
227600             QUEUE (ASC-LIST-QUEUE-NAME)                                  
227700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
227800             ITEM  (PV-BLOCK-NUMBER)                                      
227900             REWRITE                                                      
228000             RESP  (PV-CICS-RESP)                                         
228100     END-EXEC.                                                            
228200                                                                          
228300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
228400         CONTINUE                                                         
228500     ELSE                                                                 
228600         SET DP013-CICS-ABEND            TO TRUE                          
228700         SET DP013-NO-ROLLBACK           TO TRUE                          
228800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH               
228900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
229000                                         TO DP013-MESSAGE-TEXT(1)         
229100         PERFORM DP013-0000-PROCESS-ABEND                                 
229200     END-IF.                                                              
229300                                                                          
229400 EJECT                                                                    
229500*----------------------------------------------------------------*        
229600*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *        
229700*  SPECIFIC COMMAREA.                                            *        
229800*----------------------------------------------------------------*        
229900 5110-WRITE-ASC-LISTQ.                                                    
230000                                                                          
230100     EXEC CICS                                                            
230200         WRITEQ TS                                                        
230300             QUEUE (ASC-LIST-QUEUE-NAME)                                  
230400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
230500             ITEM  (PV-BLOCK-NUMBER)                                      
230600             RESP  (PV-CICS-RESP)                                         
230700     END-EXEC.                                                            
230800                                                                          
230900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
231000         SET DP013-CICS-ABEND      TO TRUE                                
231100         SET DP013-NO-ROLLBACK     TO TRUE                                
231200         MOVE '5110-WRITE-ASC-LISTQ'                                      
231300                                   TO DP013-PARAGRAPH                     
231400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'                   
231500                                   TO DP013-MESSAGE-TEXT(1)               
231600         PERFORM DP013-0000-PROCESS-ABEND                                 
231700     END-IF.                                                              
231800                                                                          
231900 EJECT                                                                    
232000*----------------------------------------------------------------*        
232100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *        
232200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *        
232300*----------------------------------------------------------------*        
232400 5200-FILL-SEL-QUEUE-RECORD.                                              
232500                                                                          
232600     PERFORM 6112-READ-LIST-QUEUE.                                        
232700                                                                          
232800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
232900         PERFORM                                                          
233000         VARYING LQW-IDX                                                  
233100         FROM 1 BY 1                                                      
233200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL                    
233300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO                  
233400                                                                          
233500             IF  LQW-SELECT (LQW-IDX)                                     
233600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                      
233700                                     TO TR112-ITEM (TR112-IDX)            
233800                 MOVE LQW-ENTRY-ID (LQW-IDX)                              
233900                                     TO TR112-CSTM-ENTRY-ID               
234000                                        (TR112-IDX)                       
234001                                        TR114-CSTM-ENTRY-ID               
234010                 MOVE LQW-ENT-ID   (LQW-IDX)                              
234020                                     TO TR112-ENT-ID                      
234030                                        (TR112-IDX)                       
234100                 MOVE 'I'           TO TR112-ACTION-SW (TR112-IDX)        
234200                 SET TR112-IDX UP BY 1                                    
234300                 IF  TR112-IDX > TR112-MAX-ITEMS                          
234400                     PERFORM 5205-WRITE-SEL-QUEUE                         
234500                     ADD +1        TO TR114-NUMBER-OF-TS-ITEMS            
234600                     INITIALIZE TR112-SELECTED-ITEM-ARRAY                 
234700                     SET TR112-IDX TO  1                                  
234800                 END-IF                                                   
234900             END-IF                                                       
235000         END-PERFORM                                                      
235100     END-IF.                                                              
235200                                                                          
235300 EJECT                                                                    
235400*----------------------------------------------------------------*        
235500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *        
235600*----------------------------------------------------------------*        
235700 5205-WRITE-SEL-QUEUE.                                                    
235800                                                                          
235900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
236000                                   TO TR112-SELECTED-ITEMS.               
236100                                                                          
236200     EXEC CICS                                                            
236300          WRITEQ TS                                                       
236400             QUEUE (ASC-SEL-QUEUE-NAME)                                   
236500             FROM  (TR112-PO-SELECT-RECORD)                               
236600             ITEM  (PV-SEL-QUEUE-ITEM)                                    
236700             RESP  (PV-CICS-RESP)                                         
236800     END-EXEC.                                                            
236900                                                                          
237000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
237100         CONTINUE                                                         
237200     ELSE                                                                 
237300         SET DP013-CICS-ABEND      TO TRUE                                
237400         SET DP013-NO-ROLLBACK     TO TRUE                                
237500         MOVE '5205-WRITE-SEL-QUEUE'                                      
237600                                   TO DP013-PARAGRAPH                     
237700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'                  
237800                                   TO DP013-MESSAGE-TEXT(1)               
237900         PERFORM DP013-0000-PROCESS-ABEND                                 
238000     END-IF.                                                              
238100                                                                          
238200 EJECT                                                                    
238300*----------------------------------------------------------------*        
238400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *        
238500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *        
238600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *        
238700*  THE USER.                                                     *        
238800*----------------------------------------------------------------*        
238900 6000-REFRESH-PANEL-FROM-TEMP.                                            
239000                                                                          
239100     IF  ASC-UPDATE-TSQ                                                   
239200         SET ASC-NO-TSQ-UPDATE TO TRUE                                    
239300         MOVE ZERO                 TO PV-SAVE-ITEM                        
239400                                      PV-SEL-QUEUE-ITEM                   
239500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                
239600                                   TO PV-HOLD-SELECTED-ITEMS              
239700         MOVE +1                   TO PV-ITEMS-PROCESSED                  
239800         PERFORM 6100-UPDATE-TSQ                                          
239900             UNTIL PV-ITEMS-PROCESSED >                                   
240000                                     PV-HOLD-SELECTED-ITEMS               
240100         PERFORM 6010-DELETE-SEL-QUEUE                                    
240200         INITIALIZE ASC-BLOCK-ENTRIES (1)                                 
240300                    ASC-BLOCK-ENTRIES (2)                                 
240400     END-IF.                                                              
240500                                                                          
240600 EJECT                                                                    
240700*----------------------------------------------------------------*        
240800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *        
240900*----------------------------------------------------------------*        
241000 6010-DELETE-SEL-QUEUE.                                                   
241100                                                                          
241200     EXEC CICS                                                            
241300         DELETEQ TS                                                       
241400             QUEUE (ASC-SEL-QUEUE-NAME)                                   
241500             RESP  (PV-CICS-RESP)                                         
241600     END-EXEC.                                                            
241700*                                                                         
241800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                              
241900        (PV-CICS-RESP = DFHRESP(QIDERR)))                                 
242000         CONTINUE                                                         
242100     ELSE                                                                 
242200         SET DP013-CICS-ABEND TO TRUE                                     
242300         SET DP013-NO-ROLLBACK TO TRUE                                    
242400         MOVE '6010-DELETE-SEL-QUEUE'                                     
242500                        TO DP013-PARAGRAPH                                
242600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'                 
242700                        TO DP013-MESSAGE-TEXT (1)                         
242800         PERFORM DP013-0000-PROCESS-ABEND                                 
242900     END-IF.                                                              
243000                                                                          
243100 EJECT                                                                    
243200*----------------------------------------------------------------*        
243300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *        
243400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *        
243500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *        
243600*    THE TEMP QUEUE.                                             *        
243700*----------------------------------------------------------------*        
243800 6100-UPDATE-TSQ.                                                         
243900                                                                          
244000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.                     
244100     PERFORM 6105-READ-SEL-QUEUE.                                         
244200     PERFORM                                                              
244300         VARYING TR112-IDX                                                
244400         FROM 1 BY 1                                                      
244500         UNTIL ((PV-ITEMS-PROCESSED >                                     
244600                              PV-HOLD-SELECTED-ITEMS)                     
244700         OR (TR112-IDX GREATER THAN TR112-MAX-ITEMS))                     
244800         IF  TR112-ACTION-SW (TR112-IDX) > SPACE                          
244900             PERFORM 6110-PROCESS-ITEMS                                   
245000         END-IF                                                           
245100         ADD +1                TO PV-ITEMS-PROCESSED                      
245200     END-PERFORM.                                                         
245300     PERFORM 6111-WRITE-LIST-QUEUE.                                       
245400                                                                          
245500 EJECT                                                                    
245600*----------------------------------------------------------------*        
245700*    READ THE LIST QUEUE RECORD.                                 *        
245800*----------------------------------------------------------------*        
245900 6105-READ-SEL-QUEUE.                                                     
246000                                                                          
246100     EXEC CICS                                                            
246200          READQ TS                                                        
246300             QUEUE (ASC-SEL-QUEUE-NAME)                                   
246400             INTO  (TR112-PO-SELECT-RECORD)                               
246500             ITEM  (PV-SEL-QUEUE-ITEM)                                    
246600             RESP  (PV-CICS-RESP)                                         
246700     END-EXEC.                                                            
246800*                                                                         
246900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
247000         CONTINUE                                                         
247100     ELSE                                                                 
247200         SET DP013-CICS-ABEND      TO  TRUE                               
247300         SET DP013-NO-ROLLBACK     TO  TRUE                               
247400         MOVE '6105-READ-SEL-QUEUE'                                       
247500                                   TO  DP013-PARAGRAPH                    
247600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
247700                                   TO  DP013-MESSAGE-TEXT(1)              
247800         PERFORM DP013-0000-PROCESS-ABEND                                 
247900     END-IF.                                                              
248000                                                                          
248100 EJECT                                                                    
248200*----------------------------------------------------------------*        
248300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*        
248400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*        
248500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *        
248600*----------------------------------------------------------------*        
248700 6110-PROCESS-ITEMS.                                                      
248800                                                                          
248900     COMPUTE PV-ITEM = 1 + ((TR112-ITEM (TR112-IDX) - 1)                  
249000                     / PC-ITEMS-PER-PANEL).                               
249100                                                                          
249200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                                   
249300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                                  
249400             PERFORM 6111-WRITE-LIST-QUEUE                                
249500         END-IF                                                           
249600         MOVE PV-ITEM          TO PV-SAVE-ITEM                            
249700                                                                          
249800         PERFORM 6112-READ-LIST-QUEUE                                     
249900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                       
250000             CONTINUE                                                     
250100         END-IF                                                           
250200     END-IF.                                                              
250300                                                                          
250400     COMPUTE PV-SUB = (TR112-ITEM (TR112-IDX)                             
250500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.                      
250600     SET LQW-DESELECT (PV-SUB) TO    TRUE.                                
250700     MOVE LQW-SELECTED-SW (PV-SUB)                                        
250800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).          
250900                                                                          
251000     IF TR112-INQ (TR112-IDX)                                             
251100        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)                     
251200     END-IF.                                                              
251300                                                                          
251400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                        
251500                                                                          
251600 EJECT                                                                    
251700*----------------------------------------------------------------*        
251800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *        
251900*----------------------------------------------------------------*        
252000 6111-WRITE-LIST-QUEUE.                                                   
252100                                                                          
252200     EXEC CICS                                                            
252300         WRITEQ TS                                                        
252400             QUEUE (ASC-LIST-QUEUE-NAME)                                  
252500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
252600             ITEM  (PV-SAVE-ITEM)                                         
252700             REWRITE                                                      
252800             RESP  (PV-CICS-RESP)                                         
252900     END-EXEC.                                                            
253000*                                                                         
253100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
253200         CONTINUE                                                         
253300     ELSE                                                                 
253400         SET DP013-CICS-ABEND  TO  TRUE                                   
253500         SET DP013-NO-ROLLBACK TO  TRUE                                   
253600         MOVE '6111-WRITE-LIST-QUEUE'                                     
253700                               TO  DP013-PARAGRAPH                        
253800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                          
253900                               TO  DP013-MESSAGE-TEXT(1)                  
254000         PERFORM DP013-0000-PROCESS-ABEND                                 
254100     END-IF.                                                              
254200                                                                          
254300 EJECT                                                                    
254400*----------------------------------------------------------------*        
254500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
254600*----------------------------------------------------------------*        
254700 6112-READ-LIST-QUEUE.                                                    
254800                                                                          
254900     EXEC CICS                                                            
255000         READQ TS                                                         
255100             QUEUE (ASC-LIST-QUEUE-NAME)                                  
255200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
255300             ITEM  (PV-ITEM)                                              
255400             RESP  (PV-CICS-RESP)                                         
255500     END-EXEC.                                                            
255600*                                                                         
255700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
255800         CONTINUE                                                         
255900     ELSE                                                                 
256000         SET DP013-CICS-ABEND        TO TRUE                              
256100         SET DP013-NO-ROLLBACK       TO TRUE                              
256200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
256300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
256400                                     TO DP013-MESSAGE-TEXT(1)             
256500         PERFORM DP013-0000-PROCESS-ABEND                                 
256600     END-IF.                                                              
256700                                                                          
256800 EJECT                                                                    
256920*----------------------------------------------------------------*        
257000*    ABEND PROCESSOR MODULE                                      *        
257100*----------------------------------------------------------------*        
257200                                                                          
257300     COPY DPPD013.                                                        
