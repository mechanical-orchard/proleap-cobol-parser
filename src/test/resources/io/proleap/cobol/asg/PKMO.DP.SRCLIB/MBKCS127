00001 *************************                                         02/05/92
00002  IDENTIFICATION DIVISION.                                         MBKCS127
00003 *************************                                            LV030
00004  PROGRAM-ID.    MBKCS127.                                            CL**1
00005  AUTHOR.        MIKE FURLICK.                                        CL**1
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
00007  DATE-WRITTEN.  9-06-91.                                             CL**1
00008  DATE-COMPILED.                                                      CL**1
00009                                                                      CL**1
00010 *****************************************************************    CL**1
00011 *    R127 - MERCHANDISE LEVEL LIST                                   CL**1
00012 *                                                                    CL**1
00013 *    THIS PROGRAM GENERATES A LIST OF THE MERCHANDISE LEVEL          CL**1
00014 *    CODES FROM TMDSELV (MERCHANDISE LEVEL TABLE).                   CL**1
00015 *                                                                    CL**1
00016 *    THE OPERATOR MAY INVOKE THE MERCHANDISE LEVEL UPDATE SCREEN     CL**1
00017 *    BY PRESSING THE APPROPRIATE PFKEY.  AT LEAST ONE ITEM MUST      CL**1
00018 *    BE SELECTED TO PASS CONTROL.                                    CL**1
00019 *                                                                    CL**1
00020 *****************************************************************    CL**1
262978* CHANGED 10/22/2021    BY JIM HUNTER      WR: CHG0262978                 
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
262978* MAKING THE CALL DYNAMIC VS STATIC.                                      
262978******************************************************************        
00021                                                                      CL**1
00022 *                                                                    CL**1
00023 *                                                                    CL**1
00024 *                                                                    CL**1
00025  ENVIRONMENT DIVISION.                                               CL**1
00026 *                                                                    CL**1
00027 *                                                                    CL**1
00028 *                                                                    CL**1
00029  DATA DIVISION.                                                      CL**1
00030 *                                                                    CL**1
00031 *                                                                    CL**1
00032  WORKING-STORAGE SECTION.                                            CL**1
00033 *                                                                    CL**1
00034  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00035      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**1
00036      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**1
00037                                                      COMP SYNC.      CL**1
00038      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE           CL**1
00039      'MB127A  '.                                                     CL**1
00040      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE           CL**1
00041      'MBKM127 '.                                                     CL**1
00042      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE           CL**1
00043      'MBKCS127'.                                                     CL**1
00044      05  PC-BEGINNING                   PIC X(01)    VALUE 'B'.      CL**1
00045      05  PC-ENDING                      PIC X(01)    VALUE 'E'.      CL**1
00046      05  PC-SELECTED                    PIC X(01)    VALUE 'S'.      CL**1
00047      05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +14       CL*21
00048                                                      COMP SYNC.      CL**1
00049      05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +28       CL**1
00050                                                      COMP SYNC.      CL**1
00051      05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100      CL**1
00052                                                      COMP SYNC.      CL**1
00053      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2        CL**1
00054                                                      COMP SYNC.      CL**1
00055      05  PC-MAX-MLEVELS                 PIC S9(03)   VALUE +200      CL**2
00056                                                      COMP-3.         CL**1
00057      05  PC-MAX-ITEMS                   PIC S9(09)   VALUE           CL**1
00058                                                      +1000000        CL**1
00059                                                      COMP-3.         CL**1
00060      05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314     CL**1
00061                                                      COMP SYNC.      CL**1
00062      05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5        CL**1
00063                                                      COMP SYNC.      CL**1
00064      05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128      CL**1
00065                                                      COMP SYNC.      CL**1
00066      05  FILLER REDEFINES PC-ERASE-EOF-COMP.                         CL**1
00067          10  FILLER                     PIC X(01).                   CL**1
00068          10  PC-ERASE-EOF               PIC X(01).                   CL**1
00069      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
00070                                                      COMP-3.         CL**1
00071      05  PC-COMPANY                     PIC X(2)     VALUE '03'.     CL**1
00072 *                                                                    CL**1
00073  01  PC-TSYMSG-NUMBERS.                                              CL**1
00074      05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.     CL**1
00075      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
00076      05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.     CL*12
00077      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL*12
00078      05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.     CL**1
00079      05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.     CL**1
00080      05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.     CL**1
00081      05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.     CL**1
00082      05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.     CL**1
00083      05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.     CL**1
00084      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
00085      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
00086      05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**9
00087      05  PC-TSYMSG-00207                PIC 9(5)    VALUE 00207.     CL*25
00088 *                                                                    CL**1
00089  01  PM-PROGRAM-MESSAGES.                                            CL**1
00090      05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE           CL**1
00091      'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.          CL**1
00092      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                      CL**1
00093          10  FILLER                     PIC X(51).                   CL**1
00094          10  PM-RESP-9                  PIC Z(03)9-.                 CL**1
00095          10  FILLER                     PIC X(22).                   CL**1
00096      05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE           CL**1
00097      'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.          CL**1
00098      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                     CL**1
00099          10  FILLER                     PIC X(51).                   CL**1
00100          10  PM-RESP-10                 PIC Z(03)9-.                 CL**1
00101          10  FILLER                     PIC X(22).                   CL**1
00102      05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE           CL**1
00103      'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK   CL**1
00104 -    '     '.                                                        CL**1
00105      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                     CL**1
00106          10  FILLER                     PIC X(61).                   CL**1
00107          10  PM-BLOCK-NUMBER            PIC Z(03)9-.                 CL**1
00108          10  FILLER                     PIC X(12).                   CL**1
00109      05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE           CL**1
00110      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**1
00111      05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE           CL**1
00112      'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.            CL**1
00113      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                     CL**1
00114          10  FILLER                     PIC X(49).                   CL**1
00115          10  PM-RESP-23                 PIC Z(03)9-.                 CL**1
00116          10  FILLER                     PIC X(24).                   CL**1
00117      05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE           CL**1
00118      'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.         CL**1
00119      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                     CL**1
00120          10  FILLER                     PIC X(52).                   CL**1
00121          10  PM-RESP-24                 PIC Z(03)9-.                 CL**1
00122          10  FILLER                     PIC X(21).                   CL**1
00123      05  PM-PROGRAM-MESSAGE-26          PIC X(78)    VALUE           CL**1
00124      'CONVERSION ROUTINE ERROR'.                                     CL**1
00125      05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE           CL**1
00126      'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                    CL**1
00127 *                                                                    CL**1
00128  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
00129      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
00130                                                      COMP SYNC.      CL**1
00131      05  PS-ML-SUB1                     PIC S9(04)   VALUE +0        CL**1
00132                                                      COMP SYNC.      CL**1
00133      05  PS-ML-SUB2                     PIC S9(04)   VALUE +0        CL**1
00134                                                      COMP SYNC.      CL**1
00135      05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0        CL**1
00136                                                      COMP-3.         CL**1
00137                                                                      CL**1
00138  01  PS-PROGRAM-SWITCHES.                                            CL**1
00139      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**1
00140          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**1
00141          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**1
00142          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**1
00143          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**1
00144          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**1
00145          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**1
00146      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**1
00147          88  PS-ERROR                                VALUE 'Y'.      CL**1
00148          88  PS-NO-ERROR                             VALUE 'N'.      CL**1
00149      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**1
00150          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**1
00151          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**1
00152      05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.      CL**1
00153          88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.      CL**1
00154          88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.      CL**1
00155      05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.      CL**1
00156          88  PS-CURSOR-POSITIONED                    VALUE 'Y'.      CL**1
00157          88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.      CL**1
00158      05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.      CL**1
00159          88  PS-VALID-SELECTIONS                     VALUE 'Y'.      CL**1
00160          88  PS-INVALID-SELECTIONS                   VALUE 'N'.      CL**1
00161      05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.      CL**1
00162          88  PS-VALID-BEG-ITEM                       VALUE 'Y'.      CL**1
00163          88  PS-INVALID-BEG-ITEM                     VALUE 'N'.      CL**1
00164      05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.      CL**1
00165          88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.      CL**1
00166          88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.      CL**1
00167      05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.      CL**1
00168          88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.      CL**1
00169          88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.      CL**1
00170      05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.      CL**1
00171          88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.      CL**1
00172          88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.      CL**1
00173      05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.      CL**1
00174          88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.      CL**1
00175          88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.      CL**1
00176      05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.      CL**1
00177          88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.      CL**1
00178          88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.      CL**1
00179      05  PS-SELECTION-FOUND-SW          PIC X(01)    VALUE 'N'.      CL**1
00180          88  PS-SELECTION-FOUND                      VALUE 'Y'.      CL**1
00181          88  PS-NO-SELECTION-FOUND                   VALUE 'N'.      CL**1
00182      05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.      CL**1
00183          88  PS-WARNING                              VALUE 'Y'.      CL**1
00184          88  PS-NO-WARNING                           VALUE 'N'.      CL**1
00185      05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.      CL**1
00186          88  PS-INFORMATIONAL                        VALUE 'Y'.      CL**1
00187          88  PS-NOT-INFORMATIONAL                    VALUE 'N'.      CL**1
00188      05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.      CL**1
00189          88  PS-CONTINUE                             VALUE 'Y'.      CL*19
00190          88  PS-DONT-PROCESS                         VALUE 'N'.      CL*19
00191      05  PS-PROCESS-ITEM-SW             PIC X(01)    VALUE 'N'.      CL*12
00192          88  PS-END-OF-ITEMS                         VALUE 'Y'.      CL*19
00193          88  PS-NOT-END                              VALUE 'N'.      CL*19
00194      EJECT                                                           CL**1
00195  01  PV-PROGRAM-VARIABLES.                                           CL**1
00196      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**1
00197                                                      COMP SYNC.      CL**1
00198      05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0        CL**1
00199                                                      COMP-3.         CL**1
00200      05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0        CL**1
00201                                                      COMP-3.         CL**1
00202      05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0        CL**1
00203                                                      COMP-3.         CL**1
00204      05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
00205                                                      COMP-3.         CL**1
00206      05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL**1
00207                                                      COMP-3.         CL**1
00208      05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0        CL**1
00209                                                      COMP-3.         CL**1
00210      05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0        CL**1
00211                                                      COMP-3.         CL**1
00212      05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0        CL**1
00213                                                      COMP-3.         CL**1
00214      05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0        CL**1
00215                                                      COMP-3.         CL**1
00216      05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0        CL**1
00217                                                      COMP-3.         CL**1
00218      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0        CL**1
00219                                                      COMP-3.         CL**1
00220      05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
00221                                                      COMP SYNC.      CL**1
00222      05  PV-RESP                        PIC S9(04)   VALUE +0        CL**1
00223                                                      COMP SYNC.      CL**1
00224      05  PV-ITEM                        PIC S9(04)   VALUE +0        CL**1
00225                                                      COMP SYNC.      CL**1
00226      05  PV-ML-ITEM                     PIC S9(04)   VALUE +0        CL*12
00227                                                      COMP SYNC.      CL**1
00228      05  PV-SAVE-ITEM                   PIC S9(04)   VALUE +0        CL*12
00229                                                      COMP SYNC.      CL*12
00230      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
00231                                                      COMP SYNC.      CL**1
00232      05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
00233                                                      COMP SYNC.      CL**1
00234      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)   VALUE +0        CL**1
00235                                                      COMP SYNC.      CL**1
00236      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**1
00237                                                      COMP SYNC.      CL**1
00238      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**1
00239                                                      COMP SYNC.      CL**1
00240      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)   VALUE +0        CL**1
00241                                                      COMP SYNC.      CL**1
00242      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)   VALUE +0        CL**1
00243                                                      COMP SYNC.      CL**1
00244      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)   VALUE +0        CL**1
00245                                                      COMP SYNC.      CL**1
00246      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)   VALUE +0        CL**1
00247                                                      COMP SYNC.      CL**1
00248      05  PV-ITEMS-READ                  PIC S9(04)   VALUE +0        CL**9
00249                                                      COMP SYNC.      CL**9
00250      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**1
00251      05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
00252      05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.         CL**1
00253      05  PV-BEGITMI.                                                 CL**1
00254          10  PV-BEGITMI-N               PIC 9(5).                    CL**1
00255      05  PV-DISPLAY5                    PIC ZZZZ9.                   CL**1
00256      05  PV-ML-QUEUE-NAME.                                           CL**2
00257          10  PV-ML-TERM-ID              PIC X(4).                    CL**2
00258          10  PV-ML-TASK-NUMBER          PIC S9(7)    COMP-3.         CL**2
00259 *                                                                    CL**1
00260  01  PV-TEMP-WORK-AREA.                                              CL**1
00261      05  PV-BLOCK-MODIFIED              PIC X.                       CL**1
00262      05  PV-TW-ITEM-ENTRIES OCCURS 28 TIMES                          CL**1
00263                             INDEXED BY PV-TW-IDX.                    CL**1
00264          10  PV-TW-LIST-ITEM-NUMBER     PIC S9(9)    COMP-3.         CL**1
00265          10  PV-TW-SELECTED-SW          PIC X.                       CL**1
00266              88  PV-TW-SELECT                        VALUE 'S'.      CL**1
00267              88  PV-TW-DESELECT                      VALUE ' '.      CL*15
00268          10  PV-TW-MLEVEL               PIC X(3).                    CL**1
00269          10  PV-TW-PLEVEL               PIC X(3).                    CL**1
00270          10  PV-TW-DESC                 PIC X(25).                   CL**1
00271 *                                                                    CL**1
00272  EJECT                                                               CL**1
00273 *****************************************************************    CL**1
00274 *    STANDARD COMMAREA.                                              CL**1
00275 *****************************************************************    CL**1
00276                                                                      CL**1
00277      COPY DPWS020.                                                   CL*30
00278      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
00279                                                                      CL**1
00280 *****************************************************************    CL**1
00281 *    INTER-APPLICATION COMMAREA.                                     CL**1
00282 *****************************************************************    CL**1
00283                                                                      CL**1
00284          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
00285      COPY MBWS005.                                                   CL*30
00286 *****************************************************************    CL**1
00287 *    SPECIFIC COMMMAREA FOR MBKCS127.                                CL**1
00288 *****************************************************************    CL**1
00289          10  MB127-SPECIFIC-COMMAREA.                                CL**1
00290              15  MB127-APPL-CURSOR-POSITION          PIC S9(04)      CL**1
00291                                                      COMP.           CL**1
00292              15  MB127-BLOCK-ENTRIES OCCURS 2 TIMES.                 CL**1
00293                  20  MB127-BLOCK-MODIFIED-SW         PIC X(01).      CL**1
00294                      88  MB127-BLOCK-NOT-MODIFIED    VALUE 'N'.      CL**1
00295                      88  MB127-BLOCK-MODIFIED        VALUE 'Y'.      CL**1
00296                  20  MB127-ITEM-ARRAY.                               CL**1
00297                      25  MB127-ITEM-ENTRIES OCCURS 28 TIMES.         CL**1
00298                          30  MB127-LIST-ITEM-NUMBER                  CL**1
00299                                                      PIC S9(09)      CL**1
00300                                                          COMP-3.     CL**1
00301                          30  MB127-SELECTED-SW       PIC X(01).      CL**1
00302                              88  MB127-NO-SELECT     VALUE ' '.      CL**1
00303                              88  MB127-SELECT        VALUE 'S'.      CL**1
00304                              88  MB127-BEGIN         VALUE 'B'.      CL**1
00305                              88  MB127-END           VALUE 'E'.      CL**1
00306                          30  MB127-MLEVEL            PIC X(3).       CL**1
00307                          30  MB127-PLEVEL            PIC X(3).       CL**1
00308                          30  MB127-DESC              PIC X(25).      CL**1
00309 *                                                                    CL**1
00310              15  MB127-BLK-SUB                       PIC S9(04)      CL**1
00311                                                          COMP        CL**1
00312                                                          SYNC.       CL**1
00313              15  MB127-ITEM-SUB                      PIC S9(04)      CL**1
00314                                                          COMP        CL**1
00315                                                          SYNC.       CL**1
00316              15  MB127-NUMBER-OF-ITEMS-READ          PIC S9(09)      CL**1
00317                                                          COMP-3.     CL**1
00318              15  MB127-NUMBER-OF-SELECTED-ITEMS      PIC S9(09)      CL**1
00319                                                          COMP-3.     CL**1
00320              15  MB127-ITEM-AT-TOP-OF-PANEL          PIC S9(09)      CL**1
00321                                                          COMP-3.     CL**1
00322              15  MB127-ITEM-AT-BOT-OF-PANEL          PIC S9(09)      CL**1
00323                                                          COMP-3.     CL**1
00324              15  MB127-HIGHEST-BLOCK-WRITTEN         PIC S9(04)      CL**1
00325                                                          COMP        CL**1
00326                                                          SYNC.       CL**1
00327              15  MB127-START-OF-SELECTED-RANGE       PIC S9(09)      CL**1
00328                                                          COMP-3.     CL**1
00329              15  MB127-END-OF-SELECTED-RANGE         PIC S9(09)      CL**1
00330                                                          COMP-3.     CL**1
00331              15  MB127-ITEMS-LEFT-INDICATOR          PIC X.          CL**1
00332                  88  MB127-ITEMS-LEFT-ON-DB            VALUE 'Y'.    CL**1
00333                  88  MB127-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.    CL**1
00334              15  MB127-TEMP-QUEUE-UPDATE-SW          PIC X.          CL*12
00335                  88  MB127-UPDATE-TSQ                  VALUE 'Y'.    CL*19
00336                  88  MB127-DONT-UPDATE-TSQ             VALUE 'N'.    CL*19
00337              15  MB127-TEMP-QUEUE-NAME.                              CL**1
00338                  20  MB127-TERM-ID                   PIC X(4).       CL**1
00339                  20  MB127-TASK-NUMBER               PIC S9(7)       CL**1
00340                                                          COMP-3.     CL**1
00341              15  MB127-LAST-MLEVEL                   PIC X(3).       CL**1
00342              15  MB127-LIST-QUEUE-NAME               PIC X(8).       CL**1
00343              15  MB127-SAVE-INTER-APPL-COMMAREA      PIC X(200).     CL**1
00344 *                                                                    CL**1
00345      EJECT                                                           CL**1
00346 *****************************************************************    CL**1
00347 *    DEPARTMENT DISCOUNT QUEUE RECORD LAYOUT.                        CL**1
00348 *****************************************************************    CL**1
00349  01 ML-LIST-RECORD.                                                  CL**1
00350      COPY MBWS127.                                                   CL*30
00351                                                                      CL**1
00352 *                                                                    CL**1
00353      EJECT                                                           CL**1
00354 *****************************************************************    CL**1
00355 *    ABEND PROCESSING COPYBOOK.                                      CL**1
00356 *****************************************************************    CL**1
00357                                                                      CL**1
00358      COPY DPWS013.                                                   CL**1
00359                                                                      CL**1
00360      EJECT                                                           CL**1
00361 *****************************************************************    CL**1
00362 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**1
00363 *****************************************************************    CL**1
00364                                                                      CL**1
00365      COPY DPWS015.                                                   CL**1
00366                                                                      CL**1
00367 *****************************************************************    CL**1
00368 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**1
00369 *****************************************************************    CL**1
00370                                                                      CL**1
00371      COPY DPWS017.                                                   CL**1
00372                                                                      CL**1
00373 *****************************************************************    CL**1
00374 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**1
00375 *****************************************************************    CL**1
00376                                                                      CL**1
00377      COPY DPWS009.                                                   CL**1
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00379 *****************************************************************    CL**1
00380 *    FUNCTION KEYS COPYBOOK.                                         CL**1
00381 *****************************************************************    CL**1
00382                                                                      CL**1
00383      COPY DPWS016.                                                   CL**1
00384                                                                      CL**1
00385 *****************************************************************    CL**1
00386 *    DPKUT045 COPYBOOK.                                              CL**1
00387 *****************************************************************    CL**1
00388                                                                      CL**1
00389      COPY DPWS045.                                                   CL**1
00390                                                                      CL**1
00391 *****************************************************************    CL**1
00392 *    NUMERIC EDIT LAYOUT.                                            CL**1
00393 *****************************************************************    CL**1
00394                                                                      CL**1
00395      COPY DPWS010I.                                                  CL**1
00396                                                                      CL**1
00397 *****************************************************************    CL**1
00398 *    MESSAGE RECORD LAYOUT                                           CL**1
00399 *****************************************************************    CL**1
00400                                                                      CL**1
00401      COPY DPRD507I.                                                  CL**1
00402                                                                      CL**1
00403 *****************************************************************    CL**1
00404 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**1
00405 *****************************************************************    CL**1
00406                                                                      CL**1
00407      COPY DFHAID.                                                    CL**1
00408                                                                      CL**1
00409 *****************************************************************    CL**1
00410 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**1
00411 *****************************************************************    CL**1
00412                                                                      CL**1
00413      COPY DFHBMSCA.                                                  CL**1
00414                                                                      CL**1
00415 *****************************************************************    CL**1
00416 *    MAP LAYOUT                                                      CL**1
00417 *****************************************************************    CL**1
00418                                                                      CL**1
00419      COPY MBKM127.                                                   CL**1
00420  01  MD-MAP-DATA-AREA  REDEFINES MB127AO PIC X(1250).                CL*21
00421 *                                                                    CL**1
00422  01  MBKM127-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.             CL**1
00423      05  FILLER                PIC X(134).                           CL**1
00424      05  MBKM127-SCROLL-AREA OCCURS 14 TIMES.                        CL*21
00425          10  MBKM127-SELECTL   PIC S9(4) COMP.                       CL**1
00426          10  MBKM127-SELECTA   PIC X.                                CL**1
00427          10  MBKM127-SELECTC   PIC X.                                CL**1
00428          10  MBKM127-SELECTH   PIC X.                                CL**1
00429          10  MBKM127-SELECTI   PIC X.                                CL**1
00430 *                                                                    CL**1
00431          10  FILLER            PIC X(5).                             CL**1
00432          10  MBKM127-MLEVEL    PIC X(3).                             CL**1
00433 *                                                                    CL**1
00434          10  FILLER            PIC X(5).                             CL**1
00435          10  MBKM127-DESC      PIC X(25).                            CL**1
00436 *                                                                    CL*21
00437          10  FILLER            PIC X(5).                             CL*21
00438          10  MBKM127-PLEVEL    PIC X(3).                             CL*21
00439  EJECT                                                               CL**1
00440 *                                                                    CL**1
00441 *    DB2 AREA FOR TMDSELV                                            CL**1
00442 *                                                                    CL**1
00443      EXEC SQL                                                        CL**1
00444           INCLUDE TMDSELV                                            CL**1
00445      END-EXEC.                                                       CL**1
00446 *                                                                    CL**1
00447 *    DB2 AREA FOR COMMUNICATIONS                                     CL**1
00448 *                                                                    CL**1
00449      EXEC SQL                                                        CL**1
00450           INCLUDE SQLCA                                              CL**1
00451      END-EXEC.                                                       CL**1
00452 *                                                                    CL**1
00453 *    CURSOR DECLARE FOR TMDSELV                                      CL**1
00454 *                                                                    CL**1
00455      EXEC SQL                                                        CL**1
00456           DECLARE ML-LIST CURSOR                                     CL**1
00457           FOR SELECT                                                 CL**1
00458               MDSELV_CDE,                                            CL**1
00459               PRNT_MDSELV_CDE,                                       CL**1
00460               MDSELV_DESC                                            CL**1
00461           FROM TMDSELV                                               CL**1
00462               WHERE MDSELV_CDE      >  :MDSELV-CDE                   CL**1
00463           ORDER BY  MDSELV_CDE                                       CL**1
00464      END-EXEC.                                                       CL**1
00465 *                                                                    CL**1
00466  EJECT                                                               CL**1
00467  LINKAGE SECTION.                                                    CL**1
00468                                                                      CL**1
00469  01  DFHCOMMAREA.                                                    CL**1
00470      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
00471                                         DEPENDING ON EIBCALEN.       CL**1
00472          10  FILLER                     PIC X.                       CL**1
00473                                                                      CL**1
00474 *                                                                    CL**1
00475 *                                                                    CL**1
00476 *                                                                    CL**1
00477  PROCEDURE DIVISION.                                                 CL**1
00478                                                                      CL**1
00479                                                                      CL**1
00480  A100-MAIN-MODULE.                                                   CL**1
00481                                                                      CL**1
00482 ******************************************************************   CL**1
00483 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**1
00484 ******************************************************************   CL**1
00485                                                                      CL**1
00486      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**1
00487                                                                      CL**1
00488      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**1
00489          PERFORM B100-CONTROL-PROCESSING                             CL**1
00490      END-IF.                                                         CL**1
00491                                                                      CL**1
00492      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**1
00493  EJECT                                                               CL**1
00494 ******************************************************************   CL**1
00495 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       CL**1
00496 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**1
00497 *                                                                    CL**1
00498 *    PERFORMED BY A100-MAIN-MODULE.                                  CL**1
00499 ******************************************************************   CL**1
00500 *                                                                    CL**1
00501  B100-CONTROL-PROCESSING.                                            CL**1
00502 *                                                                    CL**1
00503      SET PS-CONTINUE           TO  TRUE.                             CL*19
00504      MOVE LENGTH OF MB127-BLOCK-ENTRIES (1)                          CL**1
00505                                TO  PC-BLOCK-LENGTH.                  CL**1
00506      EVALUATE TRUE                                                   CL**1
00507          WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
00508              INITIALIZE MB127-SPECIFIC-COMMAREA                      CL**1
00509              SET PS-CONTINUE                                         CL*19
00510                                TO  TRUE                              CL**1
00511              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00512                                TO  TRUE                              CL**1
00513              SET DP020-NEXT-ACT-READ-MAP                             CL**1
00514                                TO  TRUE                              CL**1
00515              PERFORM D100-SETUP-INIT-PANEL                           CL**1
00516 *                                                                    CL**1
00517          WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
00518              PERFORM C300-PROCESS-PANEL                              CL**1
00519 *                                                                    CL**1
00520          WHEN DP020-NEXT-ACT-RETURN                                  CL**1
00521              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00522                                TO  TRUE                              CL**1
00523              PERFORM C400-REFRESH-PANEL-FROM-TEMP                    CL**1
00524 *                                                                    CL**1
00525          WHEN DP020-NEXT-ACT-ERROR                                   CL**1
00526              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                    CL**1
00527              IF DP020-NAV-MNEMONIC = SPACES                          CL**1
00528                  MOVE SPACES   TO  ANAVCMDO                          CL**1
00529                  MOVE DP015-UNDERLINE                                CL**1
00530                                TO  ANAVCMDH                          CL**1
00531                  MOVE DP015-GREEN                                    CL**1
00532                                TO  ANAVCMDC                          CL**1
00533              ELSE                                                    CL**1
00534                  MOVE DP015-REVERSE                                  CL**1
00535                                TO  ANAVCMDH                          CL**1
00536                  MOVE DP015-RED                                      CL**1
00537                                TO  ANAVCMDC                          CL**1
00538              END-IF                                                  CL**1
00539 *                                                                    CL**1
00540              PERFORM E100-EDIT-SELECTIONS                            CL**1
00541              MOVE -1           TO  ANAVCMDL                          CL**1
00542              MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE                 CL**1
00543                                                                      CL**1
00544              SET DP020-MSG-FATAL                                     CL**1
00545                                TO  TRUE                              CL**1
00546              SET PS-SEND-DATA-ONLY-FRSET                             CL**1
00547                                TO  TRUE                              CL**1
00548              SET PS-SAME-ITEMS-DISPLAYED                             CL**1
00549                                TO  TRUE                              CL**1
00550              SET PS-CURSOR-POSITIONED                                CL**1
00551                                TO  TRUE                              CL**1
00552              PERFORM G100-DISPLAY-PANEL                              CL**1
00553 *                                                                    CL**1
00554          WHEN OTHER                                                  CL**1
00555              SET DP013-LOGIC-ABEND TO TRUE                           CL**1
00556              SET DP013-NO-ROLLBACK TO TRUE                           CL**1
00557              MOVE 'B100-CONTROL-PROCESSING'                          CL**1
00558                                TO  DP013-PARAGRAPH                   CL**1
00559              MOVE PM-PROGRAM-MESSAGE-12                              CL**1
00560                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00561              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
00562      END-EVALUATE.                                                   CL**1
00563 *                                                                    CL**1
00564  EJECT                                                               CL**1
00565 ******************************************************************   CL**1
00566 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL**1
00567 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL**1
00568 *                                                                    CL**1
00569 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00570 ******************************************************************   CL**1
00571 *                                                                    CL**1
00572  C300-PROCESS-PANEL.                                                 CL**1
00573 *                                                                    CL**1
00574      PERFORM DP007-0000-GET-PANEL.                                   CL**1
00575      SET PS-SEND-DATA-ONLY-FRSET                                     CL**1
00576                                TO TRUE.                              CL**1
00577      EVALUATE TRUE                                                   CL**1
00578 *                                                                    CL**1
00579          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
00580              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**1
00581              SET PS-SAME-ITEMS-DISPLAYED  TO TRUE                    CL**1
00582              PERFORM E100-EDIT-SELECTIONS                            CL**1
00583              PERFORM G100-DISPLAY-PANEL                              CL**1
00584 *                                                                    CL**1
00585          WHEN DP020-SRC-AID = DP016-PF5                              CL**1
00586              MOVE SPACES       TO  ANAVCMDO                          CL*29
00587                                    ANAVKEYO                          CL*29
00588              PERFORM Z050-DELETE-TEMP-STORAGE                        CL**1
00589              PERFORM D100-SETUP-INIT-PANEL                           CL**1
00590 *                                                                    CL**1
00591          WHEN DP020-SRC-AID = DP016-PA2                              CL**1
00592              PERFORM DP009-0000-LOAD-FK-LINES                        CL**1
00593              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**1
00594              SET PS-SEND-DATA-ONLY                                   CL**1
00595                                TO  TRUE                              CL**1
00596              MOVE -1           TO  ANAVCMDL                          CL**1
00597              PERFORM DP008-0000-WRITE-PANEL                          CL**1
00598 *                                                                    CL**1
00599          WHEN OTHER                                                  CL**1
00600              PERFORM D200-RECORD-SELECTIONS                          CL**1
00601              IF PS-VALID-SELECTIONS                                  CL**1
00602                  PERFORM D300-CHECK-FUNCTION-KEY                     CL**1
00603              ELSE                                                    CL**1
00604                  SET PS-SAME-ITEMS-DISPLAYED TO TRUE                 CL**1
00605                  PERFORM G100-DISPLAY-PANEL                          CL**1
00606              END-IF                                                  CL**1
00607      END-EVALUATE.                                                   CL**1
00608 *                                                                    CL**1
00609  EJECT                                                               CL**1
00610 ******************************************************************   CL**1
00611 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**1
00612 *    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.          CL**1
00613 *    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL     CL**1
00614 *    TO THE USER.  ALSO, RESTORE THE REQUESTED UPC AND SKU NBRS.     CL**1
00615 *                                                                    CL**1
00616 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00617 ******************************************************************   CL**1
00618 *                                                                    CL**1
00619  C400-REFRESH-PANEL-FROM-TEMP.                                       CL**1
00620 *                                                                    CL**1
00621      IF (MB127-DONT-UPDATE-TSQ                                       CL*29
00622      OR  MB005-LIST-QUEUE-NAME EQUAL SPACES)                         CL*29
00623          MOVE MB127-SAVE-INTER-APPL-COMMAREA                         CL*12
00624                                TO  MB005-INTER-APPL-COMMAREA         CL*12
00625      ELSE                                                            CL*12
00626          MOVE ZERO             TO  PV-SAVE-ITEM                      CL*12
00627                                    PV-ML-ITEM                        CL*12
00628          SET PS-NOT-END        TO  TRUE                              CL*19
00629          PERFORM C500-UPDATE-TSQ                                     CL*12
00630                  UNTIL PS-END-OF-ITEMS                               CL*19
00631          PERFORM X900-DELETE-LIST-QUEUE                              CL*26
00632          MOVE SPACES           TO  MB005-LIST-QUEUE-NAME             CL*26
00633      END-IF.                                                         CL*12
00634 *                                                                    CL*12
00635      PERFORM D400-REFRESH-BLOCK-ARRAY.                               CL**1
00636      PERFORM E100-EDIT-SELECTIONS.                                   CL**1
00637 *                                                                    CL**1
00638      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                       CL**1
00639      MOVE MB127-LIST-QUEUE-NAME                                      CL**1
00640                                TO  MB005-LIST-QUEUE-NAME.            CL**1
00641 *                                                                    CL**1
00642      MOVE PC-COMPANY           TO  AOPERCOO.                         CL**8
00643      PERFORM G100-DISPLAY-PANEL.                                     CL**1
00644 *                                                                    CL*12
00645  EJECT                                                               CL*12
00646 *                                                                    CL*12
00647 ******************************************************************   CL*12
00648 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.          CL*12
00649 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER      CL*12
00650 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN        CL*12
00651 *    THE TEMP QUEUE.                                                 CL*12
00652 *                                                                    CL*12
00653 *    PERFORMED BY C400                                               CL*12
00654 ******************************************************************   CL*12
00655 *                                                                    CL*12
00656  C500-UPDATE-TSQ.                                                    CL*12
00657 *                                                                    CL*12
00658      ADD 1                     TO  PV-ML-ITEM.                       CL*12
00659      PERFORM X600-READ-LIST-QUEUE.                                   CL*12
00660      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL*12
00661          SET MBWS127-IDX       TO  1                                 CL*12
00662          PERFORM C600-PROCESS-ITEMS                                  CL*12
00663              UNTIL MBWS127-MLEVEL (MBWS127-IDX) EQUAL SPACES         CL*12
00664                OR  MBWS127-IDX GREATER THAN MBWS127-MAX-MLEVELS      CL*12
00665          PERFORM X550-WRITE-TS-QUEUE                                 CL*12
00666      ELSE                                                            CL*12
00667          SET PS-END-OF-ITEMS   TO  TRUE                              CL*20
00668      END-IF.                                                         CL*20
00669 *                                                                    CL*12
00670  EJECT                                                               CL*12
00671 *                                                                    CL*12
00672 ******************************************************************   CL*12
00673 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    CL*12
00674 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE    CL*12
00675 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               CL*12
00676 *                                                                    CL*12
00677 *    PERFORMED BY C500                                               CL*12
00678 ******************************************************************   CL*12
00679 *                                                                    CL*12
00680  C600-PROCESS-ITEMS.                                                 CL*12
00681 *                                                                    CL*12
00682      COMPUTE PV-ITEM = 1 + ((MBWS127-ITEM (MBWS127-IDX) - 1)         CL*12
00683                      / PC-ITEMS-PER-BLOCK).                          CL*12
00684 *                                                                    CL*12
00685      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                              CL*12
00686          IF  PV-SAVE-ITEM NOT EQUAL ZERO                             CL*12
00687              PERFORM X550-WRITE-TS-QUEUE                             CL*12
00688          END-IF                                                      CL*12
00689          MOVE PV-ITEM          TO  PV-SAVE-ITEM                      CL*12
00690 *                                                                    CL*12
00691          PERFORM X300-READ-TS-QUEUE                                  CL*18
00692          IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                       CL*12
00693              SET PS-END-OF-ITEMS TO TRUE                             CL*19
00694          END-IF                                                      CL*12
00695      END-IF.                                                         CL*12
00696 *                                                                    CL*12
00697      IF  PS-NOT-END                                                  CL*19
00698          COMPUTE PS-SUB = (MBWS127-ITEM (MBWS127-IDX)                CL*12
00699                         - PV-TW-LIST-ITEM-NUMBER (1)) + 1            CL*12
00700          SET PV-TW-DESELECT (PS-SUB)                                 CL*12
00701                                TO  TRUE                              CL*12
00702          SUBTRACT 1          FROM  MB005-NUMBER-PROCESSED-ITEMS      CL*12
00703                                    MB127-NUMBER-OF-SELECTED-ITEMS    CL*12
00704          IF  MB005-NUMBER-PROCESSED-ITEMS EQUAL ZERO                 CL*12
00705              SET PS-END-OF-ITEMS TO TRUE                             CL*19
00706              SET MBWS127-IDX   TO  MBWS127-MAX-MLEVELS               CL*12
00707          END-IF                                                      CL*12
00708          SET MBWS127-IDX    UP BY  1                                 CL*12
00709      END-IF.                                                         CL*12
00710 *                                                                    CL*12
00711  EJECT                                                               CL**1
00712 *                                                                    CL**1
00713 ******************************************************************   CL**1
00714 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                            CL**1
00715 *    INITIALIZE ALL COUNTERS AND FLAGS.                              CL**1
00716 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      CL**1
00717 *    DISPLAY THE PANEL TO USER.                                      CL**1
00718 *                                                                    CL**1
00719 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00720 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00721 ******************************************************************   CL**1
00722 *                                                                    CL**1
00723  D100-SETUP-INIT-PANEL.                                              CL**1
00724 *                                                                    CL**1
00725      INITIALIZE                  MB127-BLOCK-ENTRIES (1).            CL**1
00726      INITIALIZE                  MB127-BLOCK-ENTRIES (2).            CL**1
00727      MOVE SPACES             TO  MB127-LIST-QUEUE-NAME.              CL**1
00728      MOVE +1                 TO  MB127-BLK-SUB.                      CL**1
00729      MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.         CL**1
00730      SET MB127-ITEMS-LEFT-ON-DB                                      CL**1
00731                              TO  TRUE.                               CL**1
00732 *                                                                    CL**1
00733      MOVE +0                 TO  MB127-ITEM-SUB                      CL**1
00734                                  MB127-NUMBER-OF-ITEMS-READ          CL**1
00735                                  MB127-NUMBER-OF-SELECTED-ITEMS      CL**1
00736                                  MB127-HIGHEST-BLOCK-WRITTEN         CL**1
00737                                  MB127-START-OF-SELECTED-RANGE       CL**1
00738                                  MB127-END-OF-SELECTED-RANGE.        CL**1
00739 *                                                                    CL**1
00740      MOVE SPACES             TO  MB127-LAST-MLEVEL.                  CL**1
00741      PERFORM L100-OPEN-CURSOR.                                       CL**1
00742 *                                                                    CL**1
00743      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**1
00744      SET PS-DIFFERENT-ITEMS-DISPLAYED                                CL**1
00745                              TO  TRUE.                               CL**1
00746 *                                                                    CL**1
00747      MOVE +1                 TO  MB127-ITEM-AT-TOP-OF-PANEL.         CL**1
00748 *                                                                    CL**1
00749      MOVE PC-COMPANY           TO  AOPERCOO.                         CL**8
00750      PERFORM G100-DISPLAY-PANEL.                                     CL**1
00751 *                                                                    CL**1
00752  EJECT                                                               CL**1
00753 ******************************************************************   CL**1
00754 *    IF THE USER HIT THE DESELECT KEY, OR A KEY WHICH INVOLVES       CL**1
00755 *    LEAVING THIS TRANSACTION AND GOING TO ANOTHER, SET A FLAG       CL**1
00756 *    INDICATING THAT ALL SELECTIONS ARE VALID.  IF ANY OTHER KEY     CL**1
00757 *    IS HIT, MOVE THE SELECTIONS MADE TO THE COMMAREA, AND EDIT      CL**1
00758 *    THOSE SELECTIONS.                                               CL**1
00759 *                                                                    CL**1
00760 *    IF THE USER ENTERED SOMETHING IN THE COMMAND LINE OR HIT        CL**1
00761 *    AN INVALID FUNCTION KEY, DO NOT EDIT THE SELECTIONS.            CL**1
00762 *                                                                    CL**1
00763 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00764 ******************************************************************   CL**1
00765 *                                                                    CL**1
00766  D200-RECORD-SELECTIONS.                                             CL**1
00767 *                                                                    CL**1
00768      IF (DP020-FK-DESELECT(DP020-SRC-AID))   OR                      CL**1
00769         (DP020-FK-SELECT-ALL(DP020-SRC-AID)) OR                      CL**1
00770         (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)) OR                      CL**1
00771         (DP020-FK-RETURN(DP020-SRC-AID))                             CL**1
00772          SET PS-VALID-SELECTIONS TO TRUE                             CL**1
00773      ELSE                                                            CL**1
00774 *                                                                    CL**1
00775          PERFORM E200-MOVE-SELECTS-TO-COMMAREA                       CL**1
00776          IF (DP020-SRC-AID          = DP016-ENTER) AND               CL**1
00777             (DP020-NAV-MNEMONIC NOT = SPACES)      AND               CL**1
00778             (DP020-NAV-MNEMONIC NOT = LOW-VALUES)                    CL**1
00779              SET PS-VALID-SELECTIONS TO TRUE                         CL**1
00780          ELSE                                                        CL**1
00781 *                                                                    CL**1
00782 *            IF (DP020-FK-FIRST-PAGE(DP020-SRC-AID)) OR              CL*24
00783 *               (DP020-FK-PREV-PAGE(DP020-SRC-AID))  OR              CL*24
00784 *               (DP020-FK-NEXT-PAGE(DP020-SRC-AID))  OR              CL*24
00785 *               (DP020-FK-EDIT-GOTO(DP020-SRC-AID))  OR              CL*24
00786 *               (DP020-SRC-AID = DP016-ENTER)                        CL*24
00787                  PERFORM E100-EDIT-SELECTIONS                        CL**1
00788 *            ELSE                                                    CL*24
00789 *                SET PS-VALID-SELECTIONS TO TRUE                     CL*28
00790 *            END-IF                                                  CL*24
00791          END-IF                                                      CL**1
00792      END-IF.                                                         CL**1
00793  EJECT                                                               CL**1
00794 ******************************************************************   CL**1
00795 *    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION       CL**1
00796 *    KEY HAD BEEN SELECTED BY THE USER.                              CL**1
00797 *                                                                    CL**1
00798 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00799 ******************************************************************   CL**1
00800 *                                                                    CL**1
00801  D300-CHECK-FUNCTION-KEY.                                            CL**1
00802 *                                                                    CL**1
00803      EVALUATE TRUE                                                   CL**1
00804 *                                                                    CL**1
00805          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                     CL**1
00806               SET MB127-DONT-UPDATE-TSQ                              CL*19
00807                                TO  TRUE                              CL*14
00808               PERFORM E300-NAVIGATE                                  CL**1
00809 *                                                                    CL**1
00810 *    FOR THE ADD FUNCTION (PF13) NO SELECTED ITEMS REQUIRED.         CL**1
00811 *                                                                    CL**1
00812          WHEN DP020-FK-EDIT-GOTO(DP020-SRC-AID)                      CL**1
00813            IF PS-CONTINUE                                            CL*19
00814               IF  DP020-SRC-AID = DP016-PF13                         CL**1
00815                   MOVE SPACES  TO  MB005-LIST-QUEUE-NAME             CL**1
00816                   SET MB127-DONT-UPDATE-TSQ                          CL*19
00817                                TO  TRUE                              CL*14
00818                   PERFORM E300-NAVIGATE                              CL**1
00819               ELSE                                                   CL**1
00820                   IF  MB127-NUMBER-OF-SELECTED-ITEMS > ZERO          CL**1
00821                       PERFORM X100-PREPARE-LIST-QUEUE                CL**1
00822                       IF  PS-CONTINUE                                CL*19
00823                           SET MB127-UPDATE-TSQ                       CL*19
00824                                TO  TRUE                              CL*14
00825                           PERFORM E300-NAVIGATE                      CL**1
00826                       ELSE                                           CL**1
00827 *                                                                    CL**1
00828                           SET DP013-LOGIC-ABEND TO TRUE              CL**1
00829                           SET DP013-NO-ROLLBACK TO TRUE              CL**1
00830                           MOVE 'D300-CHECK-FUNCTION-KEY'             CL**1
00831                                TO  DP013-PARAGRAPH                   CL**1
00832                           MOVE PM-PROGRAM-MESSAGE-28                 CL**1
00833                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00834                           PERFORM DP013-0000-PROCESS-ABEND           CL**1
00835                       END-IF                                         CL**1
00836                   ELSE                                               CL**1
00837 *                                                                    CL**1
00838                       MOVE PC-TSYMSG-00057                           CL**1
00839                                TO  DP020-MSG-NUMBER                  CL**1
00840                       SET DP020-MSG-WARNING                          CL**1
00841                                TO TRUE                               CL**1
00842                       PERFORM G100-DISPLAY-PANEL                     CL**1
00843                   END-IF                                             CL**1
00844               END-IF                                                 CL*17
00845            ELSE                                                      CL*17
00846               PERFORM G100-DISPLAY-PANEL                             CL*17
00847            END-IF                                                    CL*17
00848 *                                                                    CL**1
00849          WHEN DP020-FK-RETURN(DP020-SRC-AID)                         CL**1
00850               PERFORM X900-DELETE-LIST-QUEUE                         CL**1
00851               PERFORM E300-NAVIGATE                                  CL**1
00852 *                                                                    CL**1
00853          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**1
00854               PERFORM E400-DISPLAY-TOP-OF-LIST                       CL**1
00855 *                                                                    CL**1
00856          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**1
00857               PERFORM E500-BROWSE-BACKWARD                           CL**1
00858 *                                                                    CL**1
00859          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**1
00860               PERFORM E600-BROWSE-FORWARD                            CL**1
00861 *                                                                    CL**1
00862          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                       CL**1
00863               PERFORM E700-DESELECT-ALL-ITEMS                        CL**1
00864 *                                                                    CL**1
00865          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                     CL**1
00866               PERFORM E900-SELECT-ALL-ITEMS                          CL**1
00867 *                                                                    CL**1
00868          WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
00869              IF (DP020-NAV-MNEMONIC = LOW-VALUES) OR                 CL**1
00870                 (DP020-NAV-MNEMONIC = SPACES)                        CL**1
00871                  PERFORM E800-CHECK-FOR-JUMP-BROWSE                  CL**1
00872              ELSE                                                    CL**1
00873                  SET MB127-DONT-UPDATE-TSQ                           CL*19
00874                                TO  TRUE                              CL*14
00875                  PERFORM E300-NAVIGATE                               CL**1
00876              END-IF                                                  CL**1
00877 *                                                                    CL**1
00878          WHEN OTHER                                                  CL**1
00879              MOVE PC-TSYMSG-00045                                    CL*13
00880                                TO  DP020-MSG-NUMBER                  CL*13
00881              SET DP020-MSG-FATAL                                     CL*13
00882                                TO  TRUE                              CL*13
00883              PERFORM G100-DISPLAY-PANEL                              CL*13
00884 *                                                                    CL**1
00885      END-EVALUATE.                                                   CL**1
00886  EJECT                                                               CL**1
00887 ******************************************************************   CL**1
00888 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**1
00889 *    READ TEMPORARY STORAGE FILLING IN BOTH BLOCKS IN THE ARRAY      CL**1
00890 *    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE         CL**1
00891 *    HAD LEFT PREVIOUSLY.                                            CL**1
00892 *                                                                    CL**1
00893 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
00894 ******************************************************************   CL**1
00895 *                                                                    CL**1
00896  D400-REFRESH-BLOCK-ARRAY.                                           CL**1
00897 *                                                                    CL**1
00898      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
00899          1 + ((MB127-LIST-ITEM-NUMBER(1 1) - 1) /                    CL**1
00900                PC-ITEMS-PER-BLOCK).                                  CL**1
00901                                                                      CL**1
00902      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**1
00903      MOVE +1                   TO MB127-BLK-SUB.                     CL**1
00904                                                                      CL**1
00905      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
00906                                                                      CL**1
00907      ADD +1 TO PV-BLOCK-NUMBER.                                      CL**1
00908                                                                      CL**1
00909      IF (PV-BLOCK-NUMBER < MB127-HIGHEST-BLOCK-WRITTEN) OR           CL**1
00910         (PV-BLOCK-NUMBER = MB127-HIGHEST-BLOCK-WRITTEN)              CL**1
00911          ADD +1 TO MB127-BLK-SUB                                     CL**1
00912                                                                      CL**1
00913          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
00914      END-IF.                                                         CL**1
00915 *                                                                    CL**1
00916  EJECT                                                               CL**1
00917 ******************************************************************   CL**1
00918 *    EDIT EACH SELECTION ENTRY.  IF EACH ENTRY IS CONSIDERED         CL**1
00919 *    VALID, CHECK IF A BEGINNING AND ENDING ENTRY WAS ENTERED,       CL**1
00920 *    AND CHECK THE FOLLOWING.                                        CL**1
00921 *                                                                    CL**1
00922 *    1) IF THERE IS A BEGINNING RANGE, THERE MUST BE AN ENDING.      CL**1
00923 *    2) IF THERE IS A ENDING RANGE, THERE MUST BE AN BEGINNING.      CL**1
00924 *    3) BEGINNING RANGE MUST PRECEDE ENDING RANGE.                   CL**1
00925 *                                                                    CL**1
00926 *    IF A VALID BEGINNING AND ENDING RANGE HAVE BEEN SELECTED,       CL**1
00927 *    MARK ALL ITEMS IN THAT RANGE AS BEING SELECTED.                 CL**1
00928 *                                                                    CL**1
00929 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00930 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00931 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
00932 *    PERFORMED BY D200-RECORD-SELECTIONS.                            CL**1
00933 ******************************************************************   CL**1
00934 *                                                                    CL**1
00935  E100-EDIT-SELECTIONS.                                               CL**1
00936 *                                                                    CL**1
00937      SET PS-VALID-SELECTIONS TO TRUE.                                CL**1
00938                                                                      CL**1
00939      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
00940          (MB127-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
00941      MOVE MB127-ITEM-AT-TOP-OF-PANEL                                 CL**1
00942                                TO  PV-ITEM-IN-USE.                   CL**1
00943      MOVE +1                   TO  PS-SUB.                           CL**1
00944 *                                                                    CL**1
00945      PERFORM F100-EDIT                                               CL**1
00946          UNTIL (PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL)            CL**1
00947             OR (PV-ITEM-IN-USE > MB127-NUMBER-OF-ITEMS-READ).        CL**1
00948 *                                                                    CL**1
00949      IF  PS-VALID-SELECTIONS                                         CL**1
00950          IF  MB127-START-OF-SELECTED-RANGE GREATER ZERO              CL**1
00951              IF  MB127-END-OF-SELECTED-RANGE GREATER                 CL**1
00952                  MB127-START-OF-SELECTED-RANGE                       CL**1
00953                  PERFORM F200-MARK-RANGE-AS-SELECTED                 CL**1
00954              ELSE                                                    CL**1
00955 *                                                                    CL**1
00956                  IF  MB127-END-OF-SELECTED-RANGE = +0                CL**1
00957                      SET PS-CURSOR-POSITIONED                        CL**1
00958                                TO  TRUE                              CL**1
00959                      SET PS-WARNING                                  CL**1
00960                                TO  TRUE                              CL**1
00961                      MOVE PC-TSYMSG-00051                            CL**1
00962                                TO  DP020-MSG-NUMBER                  CL**1
00963                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**1
00964                          SET DP020-MSG-WARNING TO TRUE               CL**1
00965                      END-IF                                          CL**1
00966                  ELSE                                                CL**1
00967 *                                                                    CL**1
00968                      SET PS-CURSOR-POSITIONED                        CL**1
00969                                TO  TRUE                              CL**1
00970                      SET PS-INVALID-SELECTIONS                       CL**1
00971                                TO  TRUE                              CL**1
00972                      SET DP020-MSG-FATAL                             CL**1
00973                                TO  TRUE                              CL**1
00974                      MOVE PC-TSYMSG-00052                            CL**1
00975                                TO  DP020-MSG-NUMBER                  CL**1
00976                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**1
00977                          MOVE MB127-ITEM-AT-TOP-OF-PANEL             CL**1
00978                                TO  PV-ITEM-IN-USE                    CL**1
00979                          MOVE +1                                     CL**1
00980                                TO  PS-SUB                            CL**1
00981 *                                                                    CL**1
00982                          PERFORM                                     CL**1
00983                              UNTIL (PV-ITEM-IN-USE >                 CL**1
00984                                     PV-ENDING-ITEM-ON-PANEL)         CL**1
00985                                 OR (PV-ITEM-IN-USE >                 CL**1
00986                                     MB127-NUMBER-OF-ITEMS-READ)      CL**1
00987 *                                                                    CL**1
00988                              PERFORM K100-SET-SUBSCRIPTS             CL**1
00989                              IF (MB127-BEGIN(MB127-BLK-SUB           CL**1
00990                                              MB127-ITEM-SUB))        CL**1
00991                              OR (MB127-END(MB127-BLK-SUB             CL**1
00992                                            MB127-ITEM-SUB))          CL**1
00993                                  MOVE -1                             CL**1
00994                                     TO  MBKM127-SELECTL(PS-SUB)      CL*16
00995                                  MOVE PV-ENDING-ITEM-ON-PANEL        CL**1
00996                                     TO  PV-ITEM-IN-USE               CL**1
00997                              END-IF                                  CL**1
00998                              ADD +1 TO  PS-SUB                       CL**1
00999                              ADD +1 TO  PV-ITEM-IN-USE               CL**1
01000                          END-PERFORM                                 CL**1
01001 *                                                                    CL**1
01002                      END-IF                                          CL**1
01003                  END-IF                                              CL**1
01004              END-IF                                                  CL**1
01005          ELSE                                                        CL**1
01006 *                                                                    CL**1
01007              IF MB127-END-OF-SELECTED-RANGE > +0                     CL**1
01008                  SET PS-CURSOR-POSITIONED TO TRUE                    CL**1
01009                  SET PS-WARNING           TO TRUE                    CL**1
01010                  MOVE PC-TSYMSG-00053                                CL**1
01011                                TO  DP020-MSG-NUMBER                  CL**1
01012                  IF NOT DP020-NEXT-ACT-ERROR                         CL**1
01013                      SET DP020-MSG-WARNING TO TRUE                   CL**1
01014                  END-IF                                              CL**1
01015              END-IF                                                  CL**1
01016          END-IF                                                      CL**1
01017      END-IF.                                                         CL**1
01018 *                                                                    CL*16
01019      IF  DP020-MSG-SEVERITY-IND GREATER THAN SPACES                  CL*16
01020          SET PS-DONT-PROCESS   TO  TRUE                              CL*19
01021      END-IF.                                                         CL*16
01022 *                                                                    CL*16
01023  EJECT                                                               CL**1
01024 ******************************************************************   CL**1
01025 *    MOVE THE SELECTIONS MADE FROM THE CURRENT PAGE INTO             CL**1
01026 *    THE COMMAREA.                                                   CL**1
01027 *                                                                    CL**1
01028 *    PERFORMED BY D200-RECORD-SELECTIONS.                            CL**1
01029 ******************************************************************   CL**1
01030 *                                                                    CL**1
01031  E200-MOVE-SELECTS-TO-COMMAREA.                                      CL**1
01032 *                                                                    CL**1
01033      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
01034          (MB127-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
01035                                                                      CL**1
01036      MOVE +1                         TO PS-SUB.                      CL**1
01037      MOVE MB127-ITEM-AT-TOP-OF-PANEL TO PV-ITEM-IN-USE.              CL**1
01038                                                                      CL**1
01039      PERFORM F300-CHECK-SELECTIONS                                   CL**1
01040          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**1
01041  EJECT                                                               CL**1
01042 ******************************************************************   CL**1
01043 *    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER        CL**1
01044 *    TRANSACTION, WRITE OUT THE LAST 2 BLOCKS FROM THE ARRAY TO      CL**1
01045 *    TEMPORARY STORAGE, SET UP THE INTER APPLICATION COMMAREA,       CL**1
01046 *    AND START THE NAVIGATOR.                                        CL**1
01047 *                                                                    CL**1
01048 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01049 ******************************************************************   CL**1
01050 *                                                                    CL**1
01051  E300-NAVIGATE.                                                      CL**1
01052 *                                                                    CL**1
01053      MOVE +1 TO MB127-BLK-SUB.                                       CL**1
01054      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01055 *                                                                    CL**1
01056      ADD +1 TO MB127-BLK-SUB.                                        CL**1
01057      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01058 *                                                                    CL**1
01059      MOVE MB005-INTER-APPL-COMMAREA                                  CL**1
01060                                TO  MB127-SAVE-INTER-APPL-COMMAREA.   CL**1
01061      SET DP020-MB-MERCH-LEVEL-LIST                                   CL*23
01062                                TO  TRUE.                             CL*23
01063      PERFORM DP015-1000-START-NAVIGATOR.                             CL**1
01064  EJECT                                                               CL**1
01065 ******************************************************************   CL**1
01066 *    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM         CL**1
01067 *    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM              CL**1
01068 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01069 *    TO BE READ.                                                     CL**1
01070 *                                                                    CL**1
01071 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01072 ******************************************************************   CL**1
01073 *                                                                    CL**1
01074  E400-DISPLAY-TOP-OF-LIST.                                           CL**1
01075 *                                                                    CL**1
01076      IF  MB127-NUMBER-OF-ITEMS-READ > +0                             CL**1
01077          MOVE +1 TO PV-TOP-ITEM                                      CL**1
01078          PERFORM F500-BROWSE                                         CL**1
01079      ELSE                                                            CL**1
01080          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01081          PERFORM G100-DISPLAY-PANEL                                  CL**1
01082      END-IF.                                                         CL**1
01083  EJECT                                                               CL**1
01084 ******************************************************************   CL**1
01085 *    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP          CL**1
01086 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**1
01087 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01088 *    TO BE READ.                                                     CL**1
01089 *                                                                    CL**1
01090 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01091 ******************************************************************   CL**1
01092 *                                                                    CL**1
01093  E500-BROWSE-BACKWARD.                                               CL**1
01094 *                                                                    CL**1
01095      IF  MB127-NUMBER-OF-ITEMS-READ > +0                             CL**1
01096          COMPUTE PV-TOP-ITEM =                                       CL**1
01097              MB127-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL         CL**1
01098          PERFORM F500-BROWSE                                         CL**1
01099      ELSE                                                            CL**1
01100          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01101          PERFORM G100-DISPLAY-PANEL                                  CL**1
01102      END-IF.                                                         CL**1
01103 *                                                                    CL**1
01104  EJECT                                                               CL**1
01105 ******************************************************************   CL**1
01106 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP          CL**1
01107 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**1
01108 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01109 *    TO BE READ.                                                     CL**1
01110 *                                                                    CL**1
01111 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01112 ******************************************************************   CL**1
01113 *                                                                    CL**1
01114  E600-BROWSE-FORWARD.                                                CL**1
01115 *                                                                    CL**1
01116      IF  MB127-NUMBER-OF-ITEMS-READ > +0                             CL**1
01117          COMPUTE PV-TOP-ITEM =                                       CL**1
01118              MB127-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL         CL**1
01119          PERFORM F500-BROWSE                                         CL**1
01120      ELSE                                                            CL**1
01121          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01122          PERFORM G100-DISPLAY-PANEL                                  CL**1
01123      END-IF.                                                         CL**1
01124 *                                                                    CL**1
01125  EJECT                                                               CL**1
01126 ******************************************************************   CL**1
01127 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION          CL**1
01128 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.             CL**1
01129 *                                                                    CL**1
01130 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01131 ******************************************************************   CL**1
01132 *                                                                    CL**1
01133  E700-DESELECT-ALL-ITEMS.                                            CL**1
01134 *                                                                    CL**1
01135      IF  MB127-NUMBER-OF-ITEMS-READ > +0                             CL**1
01136          MOVE +1               TO  MB127-BLK-SUB                     CL**1
01137                                                                      CL**1
01138          PERFORM F600-CLEAR-SELECTED-INDS                            CL**1
01139              VARYING MB127-ITEM-SUB FROM 1 BY 1                      CL**1
01140              UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01141                                                                      CL**1
01142          ADD +1                TO  MB127-BLK-SUB                     CL**1
01143                                                                      CL**1
01144          PERFORM F600-CLEAR-SELECTED-INDS                            CL**1
01145              VARYING MB127-ITEM-SUB FROM 1 BY 1                      CL**1
01146              UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01147                                                                      CL**1
01148          MOVE MB127-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER     CL**1
01149                                                                      CL**1
01150          COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                           CL**1
01151              1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK)    CL**1
01152                                                                      CL**1
01153          IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    CL**1
01154             (MB127-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)   CL**1
01155              MOVE +1 TO MB127-BLK-SUB                                CL**1
01156                                                                      CL**1
01157              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01158                                                                      CL**1
01159              MOVE +1 TO PV-BLOCK-NUMBER                              CL**1
01160                                                                      CL**1
01161              COMPUTE PV-PREV-BLOCK-IN-ARRAY =                        CL**1
01162                  PV-FIRST-BLOCK-IN-ARRAY - 1                         CL**1
01163                                                                      CL**1
01164              PERFORM                                                 CL**1
01165                  UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY      CL**1
01166                                                                      CL**1
01167                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01168                                                                      CL**1
01169                  PERFORM F600-CLEAR-SELECTED-INDS                    CL**1
01170                      VARYING MB127-ITEM-SUB FROM 1 BY 1              CL**1
01171                      UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01172                                                                      CL**1
01173                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01174                                                                      CL**1
01175                  ADD +1 TO PV-BLOCK-NUMBER                           CL**1
01176                                                                      CL**1
01177              END-PERFORM                                             CL**1
01178                                                                      CL**1
01179              COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                        CL**1
01180                  PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY    CL**1
01181                                                                      CL**1
01182              PERFORM                                                 CL**1
01183                  UNTIL PV-NEXT-BLOCK-IN-ARRAY >                      CL**1
01184                        MB127-HIGHEST-BLOCK-WRITTEN                   CL**1
01185                                                                      CL**1
01186                  MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      CL**1
01187                                                                      CL**1
01188                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01189                                                                      CL**1
01190                  PERFORM F600-CLEAR-SELECTED-INDS                    CL**1
01191                      VARYING MB127-ITEM-SUB FROM 1 BY 1              CL**1
01192                      UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01193                                                                      CL**1
01194                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01195                                                                      CL**1
01196                  ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                    CL**1
01197                                                                      CL**1
01198              END-PERFORM                                             CL**1
01199                                                                      CL**1
01200              MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER         CL**1
01201                                                                      CL**1
01202              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01203          END-IF                                                      CL**1
01204                                                                      CL**1
01205      END-IF.                                                         CL**1
01206                                                                      CL**1
01207      MOVE +0 TO MB127-NUMBER-OF-SELECTED-ITEMS.                      CL**1
01208      MOVE +0 TO MB127-START-OF-SELECTED-RANGE.                       CL**1
01209      MOVE +0 TO MB127-END-OF-SELECTED-RANGE.                         CL**1
01210                                                                      CL**1
01211      SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                            CL**1
01212                                                                      CL**1
01213      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01214  EJECT                                                               CL**1
01215 ******************************************************************   CL**1
01216 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO        CL**1
01217 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.       CL**1
01218 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST      CL**1
01219 *    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.          CL**1
01220 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT         CL**1
01221 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.              CL**1
01222 *                                                                    CL**1
01223 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01224 ******************************************************************   CL**1
01225 *                                                                    CL**1
01226  E800-CHECK-FOR-JUMP-BROWSE.                                         CL**1
01227 *                                                                    CL**1
01228      SET PS-VALID-BEG-ITEM TO TRUE.                                  CL**1
01229                                                                      CL**1
01230      IF (ABEGITMA                   = PC-ERASE-EOF) OR               CL**8
01231         (MB127-NUMBER-OF-ITEMS-READ = +0)                            CL**1
01232          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01233          PERFORM G100-DISPLAY-PANEL                                  CL**1
01234      ELSE                                                            CL**1
01235 *                                                                    CL**1
01236          MOVE ABEGITMI         TO  DP010I-UNEDITED-FIELD             CL**8
01237          MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS             CL**1
01238          MOVE +0               TO  DP010I-MAXIMUM-DECIMALS           CL**1
01239          SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                     CL**1
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
262978              USING DP010I-NUMERIC-EDIT-AREA                              
01241 *                                                                    CL**1
01242          IF  NOT DP010I-ERROR-DETECTED                               CL**1
01243              MOVE DP010I-NUMERIC-FIELD                               CL**1
01244                                TO  PV-BEGITMI-N                      CL**1
01245              MOVE PV-BEGITMI-N TO  PV-BEGINNING-ITEM                 CL**1
01246 *                                                                    CL**1
01247              IF (PV-BEGINNING-ITEM >  0)          AND                CL**1
01248                 (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)                  CL**1
01249                  MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM               CL**1
01250                                                                      CL**1
01251                  COMPUTE PV-MAX-ITEMS-TO-BE-READ =                   CL**1
01252                      ((MB127-NUMBER-OF-ITEMS-READ +                  CL**1
01253                        PC-MAX-ITEMS-TO-BE-READ)   -                  CL**1
01254                        PC-ITEMS-PER-PANEL)        + 1                CL**1
01255 *                                                                    CL**1
01256                  IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ            CL**1
01257                      MOVE PV-MAX-ITEMS-TO-BE-READ                    CL**1
01258                                TO  PV-TOP-ITEM                       CL**1
01259                      MOVE -1   TO  ABEGITML                          CL**8
01260 *                                                                    CL**1
01261                      IF MB127-NO-ITEMS-LEFT-ON-DB                    CL**1
01262                          MOVE PC-TSYMSG-00070                        CL*25
01263                                TO  DP020-MSG-NUMBER                  CL**1
01264                      ELSE                                            CL**1
01265                          MOVE PC-TSYMSG-00207                        CL*25
01266                                TO  DP020-MSG-NUMBER                  CL**1
01267                      END-IF                                          CL**1
01268 *                                                                    CL**1
01269                      SET PS-CURSOR-POSITIONED                        CL**1
01270                                TO  TRUE                              CL**1
01271                      SET DP020-MSG-INFORMATIONAL                     CL**1
01272                                TO  TRUE                              CL**1
01273                  END-IF                                              CL**1
01274                  PERFORM F500-BROWSE                                 CL**1
01275              ELSE                                                    CL**1
01276                  MOVE PC-TSYMSG-00101                                CL**9
01277                                TO  DP020-MSG-NUMBER                  CL**9
01278                  MOVE -1       TO  ABEGITML                          CL**8
01279                  MOVE DP015-REVERSE                                  CL**1
01280                                TO  ABEGITMH                          CL**8
01281                  MOVE DP015-RED                                      CL**1
01282                                TO  ABEGITMC                          CL**8
01283                  MOVE DP015-UNP-NUM-BRT-MDT                          CL**1
01284                                TO  ABEGITMA                          CL**8
01285                  SET PS-CURSOR-POSITIONED                            CL**1
01286                                TO  TRUE                              CL**1
01287                  SET DP020-MSG-FATAL                                 CL**1
01288                                TO  TRUE                              CL**1
01289                  SET PS-INVALID-BEG-ITEM                             CL**1
01290                                TO  TRUE                              CL**1
01291              END-IF                                                  CL**1
01292 *                                                                    CL**1
01293          ELSE                                                        CL**1
01294              MOVE PC-TSYMSG-00008                                    CL**1
01295                                TO  DP020-MSG-NUMBER                  CL**1
01296              MOVE -1           TO  ABEGITML                          CL**8
01297              MOVE DP015-REVERSE                                      CL**1
01298                                TO  ABEGITMH                          CL**8
01299              MOVE DP015-RED    TO  ABEGITMC                          CL**8
01300              MOVE DP015-UNP-NUM-BRT-MDT                              CL**1
01301                                TO  ABEGITMA                          CL**8
01302              SET PS-CURSOR-POSITIONED                                CL**1
01303                                TO  TRUE                              CL**1
01304              SET DP020-MSG-FATAL                                     CL**1
01305                                TO  TRUE                              CL**1
01306              SET PS-INVALID-BEG-ITEM                                 CL**1
01307                                TO  TRUE                              CL**1
01308          END-IF                                                      CL**1
01309      END-IF.                                                         CL**1
01310 *                                                                    CL**1
01311      IF  PS-INVALID-BEG-ITEM                                         CL**1
01312          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01313          PERFORM DP017-0000-GET-CURR-DATE-TIME                       CL**1
01314          PERFORM I200-FORMAT-LIST-LINES                              CL**1
01315          PERFORM I300-FORMAT-NR-SELECTED                             CL**1
01316          PERFORM DP005-0000-FORMAT-MSG-LINES                         CL**1
01317          PERFORM DP008-0000-WRITE-PANEL                              CL**1
01318      END-IF.                                                         CL**1
01319 *                                                                    CL**1
01320  EJECT                                                               CL**1
01321 ******************************************************************   CL**1
01322 *    IF THE USER HITS THE SELECT KEY, SET THE SELECTION SWITCH       CL**1
01323 *    FOR ALL ITEMS.                                                  CL**1
01324 *                                                                    CL**1
01325 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01326 ******************************************************************   CL**1
01327 *                                                                    CL**1
01328  E900-SELECT-ALL-ITEMS.                                              CL**1
01329 *                                                                    CL**1
01330      IF  MB127-NUMBER-OF-ITEMS-READ > +0                             CL**1
01331          MOVE +1 TO MB127-BLK-SUB                                    CL**1
01332                                                                      CL**1
01333          PERFORM F700-SET-SELECTED-INDS                              CL**1
01334              VARYING MB127-ITEM-SUB FROM 1 BY 1                      CL**1
01335              UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01336                                                                      CL**1
01337          ADD +1 TO MB127-BLK-SUB                                     CL**1
01338                                                                      CL**1
01339          PERFORM F700-SET-SELECTED-INDS                              CL**1
01340              VARYING MB127-ITEM-SUB FROM 1 BY 1                      CL**1
01341              UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01342                                                                      CL**1
01343          MOVE MB127-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER     CL**1
01344                                                                      CL**1
01345          COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                           CL**1
01346              1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK)    CL**1
01347                                                                      CL**1
01348          IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    CL**1
01349             (MB127-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)   CL**1
01350              MOVE +1 TO MB127-BLK-SUB                                CL**1
01351                                                                      CL**1
01352              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01353                                                                      CL**1
01354              MOVE +1 TO PV-BLOCK-NUMBER                              CL**1
01355                                                                      CL**1
01356              COMPUTE PV-PREV-BLOCK-IN-ARRAY =                        CL**1
01357                  PV-FIRST-BLOCK-IN-ARRAY - 1                         CL**1
01358                                                                      CL**1
01359              PERFORM                                                 CL**1
01360                  UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY      CL**1
01361                                                                      CL**1
01362                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01363                                                                      CL**1
01364                  PERFORM F700-SET-SELECTED-INDS                      CL**1
01365                      VARYING MB127-ITEM-SUB FROM 1 BY 1              CL**1
01366                      UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01367                                                                      CL**1
01368                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01369                                                                      CL**1
01370                  ADD +1 TO PV-BLOCK-NUMBER                           CL**1
01371                                                                      CL**1
01372              END-PERFORM                                             CL**1
01373                                                                      CL**1
01374              COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                        CL**1
01375                  PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY    CL**1
01376                                                                      CL**1
01377              PERFORM                                                 CL**1
01378                  UNTIL PV-NEXT-BLOCK-IN-ARRAY >                      CL**1
01379                        MB127-HIGHEST-BLOCK-WRITTEN                   CL**1
01380                                                                      CL**1
01381                  MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      CL**1
01382                                                                      CL**1
01383                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01384                                                                      CL**1
01385                  PERFORM F700-SET-SELECTED-INDS                      CL**1
01386                      VARYING MB127-ITEM-SUB FROM 1 BY 1              CL**1
01387                      UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01388                                                                      CL**1
01389                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01390                                                                      CL**1
01391                  ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                    CL**1
01392                                                                      CL**1
01393              END-PERFORM                                             CL**1
01394                                                                      CL**1
01395              MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER         CL**1
01396                                                                      CL**1
01397              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01398          END-IF                                                      CL**1
01399                                                                      CL**1
01400      END-IF.                                                         CL**1
01401                                                                      CL**1
01402      MOVE MB127-NUMBER-OF-ITEMS-READ TO                              CL**1
01403                        MB127-NUMBER-OF-SELECTED-ITEMS.               CL**1
01404                                                                      CL**1
01405      SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                            CL**1
01406                                                                      CL**1
01407      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01408 *                                                                    CL**1
01409  EJECT                                                               CL**1
01410 ******************************************************************   CL**1
01411 *    EDIT THE SELECTION ENTRIES.                                     CL**1
01412 *                                                                    CL**1
01413 *    1) VALID ENTRIES ARE 'S' 'B' OR 'E'.                            CL**1
01414 *    2) THERE CAN ONLY BE 1 BEGINNING AND 1 ENDING RANGE.            CL**1
01415 *                                                                    CL**1
01416 *    PERFORMED BY E100-EDIT-SELECTIONS.                              CL**1
01417 ******************************************************************   CL**1
01418 *                                                                    CL**1
01419  F100-EDIT.                                                          CL**1
01420 *                                                                    CL**1
01421      PERFORM K100-SET-SUBSCRIPTS.                                    CL**1
01422                                                                      CL**1
01423      IF NOT (MB127-NO-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)) AND      CL**1
01424         NOT (MB127-SELECT(MB127-BLK-SUB MB127-ITEM-SUB))             CL**1
01425 *                                                                    CL**1
01426          IF  MB127-BEGIN(MB127-BLK-SUB MB127-ITEM-SUB)               CL**1
01427              IF  MB127-START-OF-SELECTED-RANGE                       CL**1
01428                  NOT EQUAL PV-ITEM-IN-USE                            CL**1
01429 *                                                                    CL**1
01430                  IF  MB127-START-OF-SELECTED-RANGE = +0              CL**1
01431                      MOVE PV-ITEM-IN-USE                             CL**1
01432                                TO  MB127-START-OF-SELECTED-RANGE     CL**1
01433                  ELSE                                                CL**1
01434                      IF PS-VALID-SELECTIONS                          CL**1
01435                          MOVE PC-TSYMSG-00054                        CL**1
01436                                TO  DP020-MSG-NUMBER                  CL**1
01437                          IF  NOT DP020-NEXT-ACT-ERROR                CL**1
01438                              MOVE -1                                 CL**1
01439                                TO  MBKM127-SELECTL(PS-SUB)           CL**1
01440                          END-IF                                      CL**1
01441                      END-IF                                          CL**1
01442 *                                                                    CL**1
01443                      SET DP020-MSG-FATAL                             CL**1
01444                                TO  TRUE                              CL**1
01445                      SET PS-INVALID-SELECTIONS                       CL**1
01446                                TO  TRUE                              CL**1
01447                      SET PS-CURSOR-POSITIONED                        CL**1
01448                                TO  TRUE                              CL**1
01449                  END-IF                                              CL**1
01450              END-IF                                                  CL**1
01451          ELSE                                                        CL**1
01452 *                                                                    CL**1
01453              IF  MB127-END(MB127-BLK-SUB MB127-ITEM-SUB)             CL**1
01454                  IF  MB127-END-OF-SELECTED-RANGE                     CL**1
01455                      NOT EQUAL PV-ITEM-IN-USE                        CL**1
01456 *                                                                    CL**1
01457                      IF MB127-END-OF-SELECTED-RANGE = +0             CL**1
01458                          MOVE PV-ITEM-IN-USE                         CL**1
01459                                TO  MB127-END-OF-SELECTED-RANGE       CL**1
01460                      ELSE                                            CL**1
01461 *                                                                    CL**1
01462                          IF  PS-VALID-SELECTIONS                     CL**1
01463                              MOVE PC-TSYMSG-00055                    CL**1
01464                                TO  DP020-MSG-NUMBER                  CL**9
01465                                                                      CL**1
01466                              IF  NOT DP020-NEXT-ACT-ERROR            CL**1
01467                                  MOVE -1                             CL**1
01468                                     TO  MBKM127-SELECTL(PS-SUB)      CL**1
01469                              END-IF                                  CL**1
01470                          END-IF                                      CL**1
01471                          SET PS-INVALID-SELECTIONS                   CL**1
01472                                     TO  TRUE                         CL**1
01473                          SET PS-CURSOR-POSITIONED                    CL**1
01474                                     TO  TRUE                         CL**1
01475                          SET DP020-MSG-FATAL                         CL**1
01476                                     TO  TRUE                         CL**1
01477                      END-IF                                          CL**1
01478                  END-IF                                              CL**1
01479              ELSE                                                    CL**1
01480 *                                                                    CL**1
01481                  IF  PS-VALID-SELECTIONS                             CL**1
01482                      MOVE PC-TSYMSG-00005                            CL**1
01483                                TO  DP020-MSG-NUMBER                  CL**1
01484                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**1
01485                          MOVE -1                                     CL**1
01486                                TO  MBKM127-SELECTL(PS-SUB)           CL**1
01487                      END-IF                                          CL**1
01488                  END-IF                                              CL**1
01489                  SET PS-INVALID-SELECTIONS                           CL**1
01490                                TO  TRUE                              CL**1
01491                  SET PS-CURSOR-POSITIONED                            CL**1
01492                                TO  TRUE                              CL**1
01493                  SET DP020-MSG-FATAL                                 CL**1
01494                                TO  TRUE                              CL**1
01495                  MOVE DP015-RED                                      CL**1
01496                                TO  MBKM127-SELECTC(PS-SUB)           CL**1
01497                  MOVE DP015-REVERSE                                  CL**1
01498                                TO  MBKM127-SELECTH(PS-SUB)           CL*10
01499              END-IF                                                  CL**1
01500          END-IF                                                      CL**1
01501      END-IF.                                                         CL**1
01502                                                                      CL**1
01503      ADD +1                    TO  PV-ITEM-IN-USE.                   CL**1
01504      ADD +1                    TO  PS-SUB.                           CL**1
01505  EJECT                                                               CL**1
01506 ******************************************************************   CL**1
01507 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE        CL**1
01508 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS        CL**1
01509 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.                 CL**1
01510 *                                                                    CL**1
01511 *    PERFORMED BY E100-EDIT-SELECTIONS.                              CL**1
01512 ******************************************************************   CL**1
01513 *                                                                    CL**1
01514  F200-MARK-RANGE-AS-SELECTED.                                        CL**1
01515 *                                                                    CL**1
01516      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
01517      PERFORM G200-MARK-SELECTED-INDS                                 CL**1
01518          VARYING MB127-ITEM-SUB FROM 1 BY 1                          CL**1
01519          UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK.                  CL**1
01520 *                                                                    CL**1
01521      ADD +1 TO MB127-BLK-SUB.                                        CL**1
01522      PERFORM G200-MARK-SELECTED-INDS                                 CL**1
01523          VARYING MB127-ITEM-SUB FROM 1 BY 1                          CL**1
01524          UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK.                  CL**1
01525 *                                                                    CL**1
01526      MOVE MB127-LIST-ITEM-NUMBER(1 1)                                CL**1
01527                                TO  PV-LIST-ITEM-NUMBER.              CL**1
01528      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                               CL**1
01529          1 + ((PV-LIST-ITEM-NUMBER - 1) /                            CL**1
01530                PC-ITEMS-PER-BLOCK).                                  CL**1
01531 *                                                                    CL**1
01532      MOVE MB127-START-OF-SELECTED-RANGE                              CL**1
01533                                TO  PV-START-OF-SELECTED-RANGE.       CL**1
01534      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                               CL**1
01535          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                     CL**1
01536                PC-ITEMS-PER-BLOCK).                                  CL**1
01537 *                                                                    CL**1
01538      MOVE MB127-END-OF-SELECTED-RANGE                                CL**1
01539                                TO  PV-END-OF-SELECTED-RANGE.         CL**1
01540      COMPUTE PV-LAST-BLOCK-IN-RANGE =                                CL**1
01541          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                       CL**1
01542                PC-ITEMS-PER-BLOCK).                                  CL**1
01543      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                CL**1
01544          PV-FIRST-BLOCK-IN-ARRAY + 1.                                CL**1
01545 *                                                                    CL**1
01546      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR       CL**1
01547         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)           CL**1
01548          MOVE +1               TO  MB127-BLK-SUB                     CL**1
01549          PERFORM Z150-WRITE-TEMP-STORAGE                             CL**1
01550          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                            CL**1
01551              PV-FIRST-BLOCK-IN-ARRAY - 1                             CL**1
01552 *                                                                    CL**1
01553          PERFORM                                                     CL**1
01554              UNTIL PV-FIRST-BLOCK-IN-RANGE >                         CL**1
01555                    PV-PREV-BLOCK-IN-ARRAY                            CL**1
01556              MOVE PV-FIRST-BLOCK-IN-RANGE                            CL**1
01557                                TO  PV-BLOCK-NUMBER                   CL**1
01558              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01559              PERFORM G200-MARK-SELECTED-INDS                         CL**1
01560                  VARYING MB127-ITEM-SUB FROM 1 BY 1                  CL**1
01561                  UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK           CL**1
01562              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01563              ADD +1            TO PV-FIRST-BLOCK-IN-RANGE            CL**1
01564          END-PERFORM                                                 CL**1
01565 *                                                                    CL**1
01566          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                            CL**1
01567              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY        CL**1
01568          PERFORM                                                     CL**1
01569              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                          CL**1
01570                    PV-LAST-BLOCK-IN-RANGE                            CL**1
01571              MOVE PV-NEXT-BLOCK-IN-ARRAY                             CL**1
01572                                TO  PV-BLOCK-NUMBER                   CL**1
01573              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01574              PERFORM G200-MARK-SELECTED-INDS                         CL**1
01575                  VARYING MB127-ITEM-SUB FROM 1 BY 1                  CL**1
01576                  UNTIL MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK           CL**1
01577              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01578              ADD +1            TO  PV-NEXT-BLOCK-IN-ARRAY            CL**1
01579          END-PERFORM                                                 CL**1
01580 *                                                                    CL**1
01581          MOVE PV-FIRST-BLOCK-IN-ARRAY                                CL**1
01582                                TO  PV-BLOCK-NUMBER                   CL**1
01583          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
01584      END-IF.                                                         CL**1
01585                                                                      CL**1
01586      MOVE +0                   TO  MB127-START-OF-SELECTED-RANGE     CL**1
01587                                    MB127-END-OF-SELECTED-RANGE.      CL**1
01588  EJECT                                                               CL**1
01589 ******************************************************************   CL**1
01590 *    CHECK EACH ENTRY TO DETERMINE IF THE SELECTION CRITERIA IN      CL**1
01591 *    THE MAP DIFFERS FROM THAT IN THE ARRAY.  IF THEY DO DIFFER,     CL**1
01592 *    AND THE ARRAY ENTRY SHOWS THAT THE ITEM WAS PREVIOUSLY          CL**1
01593 *    SELECTED, SUBTRACT 1 FROM THE SELECTED COUNTER.  IF THEY DO     CL**1
01594 *    DIFFER, AND THE ARRAY ENTRY SHOWS THAT THIS ITEM WAS MARKED     CL**1
01595 *    AS EITHER THE BEGINNING OR ENDING SELECTION POINT, ZERO OUT     CL**1
01596 *    THE STARTING RANGE AND/OR ENDING RANGE.  IF THE ENTRY ON        CL**1
01597 *    THE MAP SHOWS THAT THIS ITEM WAS SELECTED, ADD 1 TO THE         CL**1
01598 *    SELECTED COUNTER.                                               CL**1
01599 *                                                                    CL**1
01600 *    PERFORMED BY E200-MOVE-SELECTS-TO-COMMAREA.                     CL**1
01601 ******************************************************************   CL**1
01602 *                                                                    CL**1
01603  F300-CHECK-SELECTIONS.                                              CL**1
01604 *                                                                    CL**1
01605      IF (PV-ITEM-IN-USE < MB127-NUMBER-OF-ITEMS-READ) OR             CL**1
01606         (PV-ITEM-IN-USE = MB127-NUMBER-OF-ITEMS-READ)                CL**1
01607          PERFORM K100-SET-SUBSCRIPTS                                 CL**1
01608 *                                                                    CL**1
01609          IF  MB127-SELECTED-SW(MB127-BLK-SUB MB127-ITEM-SUB)         CL**1
01610              NOT EQUAL MBKM127-SELECTI(PS-SUB)                       CL**1
01611              SET MB127-BLOCK-MODIFIED(MB127-BLK-SUB)                 CL**1
01612                                TO  TRUE                              CL**1
01613              IF  MB127-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)          CL**1
01614                  SUBTRACT +1 FROM MB127-NUMBER-OF-SELECTED-ITEMS     CL**1
01615              ELSE                                                    CL**1
01616 *                                                                    CL**1
01617                  IF  MB127-BEGIN(MB127-BLK-SUB MB127-ITEM-SUB)       CL**1
01618                      IF  MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB        CL**1
01619                                                MB127-ITEM-SUB) =     CL**1
01620                          MB127-START-OF-SELECTED-RANGE               CL**1
01621                          MOVE +0                                     CL**1
01622                                TO  MB127-START-OF-SELECTED-RANGE     CL**1
01623                      END-IF                                          CL**1
01624                  ELSE                                                CL**1
01625 *                                                                    CL**1
01626                      IF  MB127-END(MB127-BLK-SUB MB127-ITEM-SUB)     CL**1
01627                          IF  MB127-LIST-ITEM-NUMBER                  CL**1
01628                                  (MB127-BLK-SUB MB127-ITEM-SUB)      CL**1
01629                          =  MB127-END-OF-SELECTED-RANGE              CL**1
01630                              MOVE +0                                 CL**1
01631                                TO MB127-END-OF-SELECTED-RANGE        CL**1
01632                          END-IF                                      CL**1
01633                      END-IF                                          CL**1
01634                  END-IF                                              CL**1
01635              END-IF                                                  CL**1
01636 *                                                                    CL**1
01637              IF MBKM127-SELECTI(PS-SUB) = PC-SELECTED                CL**1
01638                  ADD +1        TO MB127-NUMBER-OF-SELECTED-ITEMS     CL**1
01639              END-IF                                                  CL**1
01640 *                                                                    CL**1
01641              IF (MBKM127-SELECTA(PS-SUB) = PC-ERASE-EOF) OR          CL**1
01642                 (MBKM127-SELECTI(PS-SUB) = SPACES)                   CL**1
01643                  MOVE SPACES   TO                                    CL**1
01644                       MB127-SELECTED-SW(MB127-BLK-SUB                CL**1
01645                                         MB127-ITEM-SUB)              CL**1
01646              ELSE                                                    CL**1
01647                  MOVE MBKM127-SELECTI(PS-SUB) TO                     CL**1
01648                       MB127-SELECTED-SW(MB127-BLK-SUB                CL**1
01649                                         MB127-ITEM-SUB)              CL**1
01650              END-IF                                                  CL**1
01651          END-IF                                                      CL**1
01652      END-IF.                                                         CL**1
01653 *                                                                    CL**1
01654      ADD +1                    TO  PV-ITEM-IN-USE.                   CL**1
01655      ADD +1                    TO  PS-SUB.                           CL**1
01656 *                                                                    CL**1
01657  EJECT                                                               CL**1
01658 ******************************************************************   CL**1
01659 *    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE    CL**1
01660 *    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE        CL**1
01661 *    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).       CL**1
01662 *                                                                    CL**1
01663 *    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                          CL**1
01664 *    PERFORMED BY E500-BROWSE-BACKWARD.                              CL**1
01665 *    PERFORMED BY E600-BROWSE-FORWARD.                               CL**1
01666 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01667 ******************************************************************   CL**1
01668 *                                                                    CL**1
01669  F500-BROWSE.                                                        CL**1
01670 *                                                                    CL**1
01671      IF  PV-TOP-ITEM < +1                                            CL**1
01672          MOVE +1               TO  PV-TOP-ITEM                       CL**1
01673          IF  PS-CURSOR-NOT-POSITIONED                                CL**1
01674              MOVE PC-TSYMSG-00069                                    CL**1
01675                                TO  DP020-MSG-NUMBER                  CL**1
01676              SET DP020-MSG-INFORMATIONAL                             CL**1
01677                                TO  TRUE                              CL**1
01678              SET PS-INFORMATIONAL                                    CL**1
01679                                TO  TRUE                              CL**1
01680              SET PS-CURSOR-POSITIONED                                CL**1
01681                                TO  TRUE                              CL**1
01682          END-IF                                                      CL**1
01683      END-IF.                                                         CL**1
01684 *                                                                    CL**1
01685      IF  MB127-NO-ITEMS-LEFT-ON-DB                                   CL**1
01686          IF  PV-TOP-ITEM > MB127-NUMBER-OF-ITEMS-READ                CL**1
01687              IF  DP020-SRC-AID EQUAL DP016-ENTER                     CL*27
01688                  MOVE MB127-NUMBER-OF-ITEMS-READ                     CL*27
01689                                TO  PV-TOP-ITEM                       CL**1
01690              ELSE                                                    CL*27
01691                  MOVE MB127-ITEM-AT-TOP-OF-PANEL                     CL*27
01692                                TO  PV-TOP-ITEM                       CL*27
01693              END-IF                                                  CL*27
01694 *                                                                    CL*27
01695              IF  PS-CURSOR-NOT-POSITIONED                            CL**1
01696                  MOVE -1       TO  ANAVCMDL                          CL**1
01697                  SET DP020-MSG-INFORMATIONAL                         CL**1
01698                                TO  TRUE                              CL**1
01699                  SET PS-CURSOR-POSITIONED                            CL**1
01700                                TO  TRUE                              CL**1
01701                  MOVE PC-TSYMSG-00070                                CL*25
01702                                TO  DP020-MSG-NUMBER                  CL**1
01703                  SET PS-INFORMATIONAL                                CL*25
01704                                TO  TRUE                              CL**1
01705              END-IF                                                  CL**1
01706          END-IF                                                      CL**1
01707      END-IF.                                                         CL**1
01708 *                                                                    CL**1
01709      COMPUTE PV-BOTTOM-ITEM =                                        CL**1
01710          (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                     CL**1
01711                                                                      CL**1
01712      IF  MB127-NO-ITEMS-LEFT-ON-DB                                   CL**1
01713          IF  PV-BOTTOM-ITEM > MB127-NUMBER-OF-ITEMS-READ             CL**1
01714              MOVE MB127-NUMBER-OF-ITEMS-READ                         CL**1
01715                                TO  PV-BOTTOM-ITEM                    CL**1
01716              IF  PS-CURSOR-NOT-POSITIONED                            CL**1
01717                  IF  PV-TOP-ITEM NOT = +1                            CL**1
01718                      MOVE PC-TSYMSG-00070                            CL*25
01719                                TO  DP020-MSG-NUMBER                  CL*25
01720                      SET PS-INFORMATIONAL                            CL*25
01721                                TO  TRUE                              CL*25
01722                      SET DP020-MSG-INFORMATIONAL                     CL*25
01723                                TO  TRUE                              CL*25
01724                      SET PS-CURSOR-POSITIONED                        CL*25
01725                                TO  TRUE                              CL**1
01726                  END-IF                                              CL**1
01727              END-IF                                                  CL**1
01728          END-IF                                                      CL**1
01729      END-IF.                                                         CL**1
01730 *                                                                    CL**1
01731      PERFORM G300-DETERMINE-WHAT-IS-WHERE.                           CL**1
01732                                                                      CL**1
01733      IF  PS-TOP-ITEM-IN-ARRAY                                        CL**1
01734          IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**1
01735              IF  PS-BOTTOM-ITEM-IN-TEMP                              CL**1
01736                  PERFORM G500-SCROLL-FORWARD                         CL**1
01737              ELSE                                                    CL**1
01738                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**1
01739                      PERFORM G500-SCROLL-FORWARD                     CL**1
01740                  END-IF                                              CL**1
01741                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**1
01742              END-IF                                                  CL**1
01743          END-IF                                                      CL**1
01744      ELSE                                                            CL**1
01745 *                                                                    CL**1
01746          IF  PS-BOTTOM-ITEM-IN-ARRAY                                 CL**1
01747              PERFORM G600-SCROLL-BACKWARD                            CL**1
01748          ELSE                                                        CL**1
01749              IF  PS-TOP-ITEM-IN-TEMP                                 CL**1
01750                  PERFORM G700-GET-TOP-ITEMS-BLOCK                    CL**1
01751                  PERFORM G300-DETERMINE-WHAT-IS-WHERE                CL**1
01752                  IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                     CL**1
01753                      PERFORM G400-READ-ITEMS-INTO-ARRAY              CL**1
01754                  END-IF                                              CL**1
01755              ELSE                                                    CL**1
01756                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**1
01757                      PERFORM G800-GET-LAST-BLOCK-IN-TEMP             CL**1
01758                  END-IF                                              CL**1
01759                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**1
01760              END-IF                                                  CL**1
01761          END-IF                                                      CL**1
01762      END-IF.                                                         CL**1
01763 *                                                                    CL**1
01764      IF  PV-TOP-ITEM = MB127-ITEM-AT-TOP-OF-PANEL                    CL**1
01765          SET PS-SAME-ITEMS-DISPLAYED                                 CL**1
01766                                TO  TRUE                              CL**1
01767      ELSE                                                            CL**1
01768          SET PS-DIFFERENT-ITEMS-DISPLAYED                            CL**1
01769                                TO  TRUE                              CL**1
01770          MOVE PV-TOP-ITEM      TO  MB127-ITEM-AT-TOP-OF-PANEL        CL**1
01771      END-IF.                                                         CL**1
01772 *                                                                    CL**1
01773      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01774 *                                                                    CL**1
01775  EJECT                                                               CL**1
01776 ******************************************************************   CL**1
01777 *    MARK EACH ITEM AS BEING NOT SELECTED.                           CL**1
01778 *                                                                    CL**1
01779 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
01780 ******************************************************************   CL**1
01781 *                                                                    CL**1
01782  F600-CLEAR-SELECTED-INDS.                                           CL**1
01783 *                                                                    CL**1
01784      IF  MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB MB127-ITEM-SUB)        CL**1
01785              NOT EQUAL ZERO                                          CL**1
01786          IF  NOT MB127-NO-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)       CL**1
01787              SET MB127-NO-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)       CL**1
01788                                TO  TRUE                              CL**1
01789              SET MB127-BLOCK-MODIFIED(MB127-BLK-SUB)                 CL**1
01790                                TO  TRUE                              CL**1
01791          END-IF                                                      CL**1
01792      END-IF.                                                         CL**1
01793 *                                                                    CL**1
01794  EJECT                                                               CL**1
01795 ******************************************************************   CL**1
01796 *    MARK EACH ITEM AS BEING SELECTED.                               CL**1
01797 *                                                                    CL**1
01798 *    PERFORMED BY E900-SELECT-ALL-ITEMS.                             CL**1
01799 ******************************************************************   CL**1
01800 *                                                                    CL**1
01801  F700-SET-SELECTED-INDS.                                             CL**1
01802 *                                                                    CL**1
01803      IF  MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB MB127-ITEM-SUB)        CL**1
01804              NOT EQUAL ZERO                                          CL**1
01805          IF  NOT MB127-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)          CL**1
01806              SET MB127-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)          CL**1
01807                                TO  TRUE                              CL**1
01808              SET MB127-BLOCK-MODIFIED(MB127-BLK-SUB)                 CL**1
01809                                TO  TRUE                              CL**1
01810          END-IF                                                      CL**1
01811      END-IF.                                                         CL**1
01812 *                                                                    CL**1
01813  EJECT                                                               CL**1
01814 ******************************************************************   CL**1
01815 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**1
01816 *                                                                    CL**1
01817 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
01818 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
01819 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
01820 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
01821 *    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                          CL**1
01822 *    PERFORMED BY E500-BROWSE-BACKWARD.                              CL**1
01823 *    PERFORMED BY E600-BROWSE-FORWARD.                               CL**1
01824 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
01825 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01826 *    PERFORMED BY F500-BROWSE.                                       CL**1
01827 ******************************************************************   CL**1
01828 *                                                                    CL**1
01829  G100-DISPLAY-PANEL.                                                 CL**1
01830 *                                                                    CL**1
01831      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**1
01832      MOVE DP017-EDITED-TIME-HMS                                      CL**9
01833                                TO  ATIMEO.                           CL**9
01834                                                                      CL**1
01835      IF PS-SEND-MAP-N-DATA-FRSET                                     CL**1
01836          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**1
01837          PERFORM DP009-0000-LOAD-FK-LINES                            CL**1
01838      END-IF.                                                         CL**1
01839                                                                      CL**1
01840      PERFORM H200-FORMAT-PANEL-BODY.                                 CL**1
01841 *                                                                    CL**1
01842      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**1
01843                                                                      CL**1
01844      PERFORM DP008-0000-WRITE-PANEL.                                 CL**1
01845  EJECT                                                               CL**1
01846 ******************************************************************   CL**1
01847 *    MARK EACH ITEM THAT FALLS WITHIN THE BEGINNING AND ENDING       CL**1
01848 *    RANGE AS BEING SELECTED.                                        CL**1
01849 *                                                                    CL**1
01850 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
01851 ******************************************************************   CL**1
01852 *                                                                    CL**1
01853  G200-MARK-SELECTED-INDS.                                            CL**1
01854 *                                                                    CL**1
01855      IF (MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB                        CL**1
01856                                 MB127-ITEM-SUB) >                    CL**1
01857          MB127-START-OF-SELECTED-RANGE)                              CL**1
01858      OR (MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB                        CL**1
01859                                 MB127-ITEM-SUB) =                    CL**1
01860          MB127-START-OF-SELECTED-RANGE)                              CL**1
01861 *                                                                    CL**1
01862          IF (MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB                    CL**1
01863                                     MB127-ITEM-SUB) <                CL**1
01864              MB127-END-OF-SELECTED-RANGE)                            CL**1
01865          OR (MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB                    CL**1
01866                                     MB127-ITEM-SUB) =                CL**1
01867              MB127-END-OF-SELECTED-RANGE)                            CL**1
01868 *                                                                    CL**1
01869              IF NOT MB127-SELECT(MB127-BLK-SUB MB127-ITEM-SUB)       CL**1
01870                  SET MB127-SELECT(MB127-BLK-SUB                      CL**1
01871                                   MB127-ITEM-SUB)                    CL**1
01872                                TO  TRUE                              CL**1
01873                  SET MB127-BLOCK-MODIFIED(MB127-BLK-SUB)             CL**1
01874                                TO  TRUE                              CL**1
01875                  ADD +1        TO MB127-NUMBER-OF-SELECTED-ITEMS     CL**1
01876              END-IF                                                  CL**1
01877          END-IF                                                      CL**1
01878      END-IF.                                                         CL**1
01879  EJECT                                                               CL**1
01880 ******************************************************************   CL**1
01881 *    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND     CL**1
01882 *    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.                 CL**1
01883 *                                                                    CL**1
01884 *    PERFORMED BY F500-BROWSE.                                       CL**1
01885 ******************************************************************   CL**1
01886 *                                                                    CL**1
01887  G300-DETERMINE-WHAT-IS-WHERE.                                       CL**1
01888 *                                                                    CL**1
01889      MOVE MB127-LIST-ITEM-NUMBER(1 1)                                CL**1
01890                                TO  PV-FIRST-ITEM-IN-ARRAY.           CL**1
01891      COMPUTE PV-LAST-ITEM-IN-ARRAY =                                 CL**1
01892          (PV-FIRST-ITEM-IN-ARRAY +                                   CL**1
01893          (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.         CL**1
01894      IF  PV-LAST-ITEM-IN-ARRAY > MB127-NUMBER-OF-ITEMS-READ          CL**1
01895          MOVE MB127-NUMBER-OF-ITEMS-READ                             CL**1
01896                                TO  PV-LAST-ITEM-IN-ARRAY             CL**1
01897      END-IF.                                                         CL**1
01898 *                                                                    CL**1
01899      COMPUTE PV-LAST-ITEM-IN-TEMP =                                  CL**1
01900          MB127-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.           CL**1
01901      IF  PV-LAST-ITEM-IN-TEMP > MB127-NUMBER-OF-ITEMS-READ           CL**1
01902          MOVE MB127-NUMBER-OF-ITEMS-READ                             CL**1
01903                                TO  PV-LAST-ITEM-IN-TEMP              CL**1
01904      END-IF.                                                         CL**1
01905 *                                                                    CL**1
01906      IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                       CL**1
01907      OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                       CL**1
01908          IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                    CL**1
01909          OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                    CL**1
01910              SET PS-TOP-ITEM-IN-ARRAY                                CL**1
01911                                TO  TRUE                              CL**1
01912          ELSE                                                        CL**1
01913              SET PS-TOP-ITEM-NOT-IN-ARRAY                            CL**1
01914                                TO  TRUE                              CL**1
01915          END-IF                                                      CL**1
01916      ELSE                                                            CL**1
01917          SET PS-TOP-ITEM-NOT-IN-ARRAY                                CL**1
01918                                TO  TRUE                              CL**1
01919      END-IF.                                                         CL**1
01920 *                                                                    CL**1
01921      IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    CL**1
01922      OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    CL**1
01923          IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)                 CL**1
01924          OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)                 CL**1
01925              SET PS-BOTTOM-ITEM-IN-ARRAY                             CL**1
01926                                TO  TRUE                              CL**1
01927          ELSE                                                        CL**1
01928              SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                         CL**1
01929                                TO  TRUE                              CL**1
01930          END-IF                                                      CL**1
01931      ELSE                                                            CL**1
01932          SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**1
01933                                TO  TRUE                              CL**1
01934      END-IF.                                                         CL**1
01935 *                                                                    CL**1
01936      IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                         CL**1
01937      OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                         CL**1
01938          SET PS-TOP-ITEM-IN-TEMP                                     CL**1
01939                                TO  TRUE                              CL**1
01940      ELSE                                                            CL**1
01941          SET PS-TOP-ITEM-NOT-IN-TEMP                                 CL**1
01942                                TO  TRUE                              CL**1
01943      END-IF.                                                         CL**1
01944 *                                                                    CL**1
01945      IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                      CL**1
01946      OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                      CL**1
01947          SET PS-BOTTOM-ITEM-IN-TEMP                                  CL**1
01948                                TO  TRUE                              CL**1
01949      ELSE                                                            CL**1
01950          SET PS-BOTTOM-ITEM-NOT-IN-TEMP                              CL**1
01951                                TO  TRUE                              CL**1
01952      END-IF.                                                         CL**1
01953 *                                                                    CL**1
01954      IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY                 CL**1
01955          SET PS-LAST-BLOCK-NOT-IN-ARRAY                              CL**1
01956                                TO  TRUE                              CL**1
01957      ELSE                                                            CL**1
01958          SET PS-LAST-BLOCK-IN-ARRAY                                  CL**1
01959                                TO  TRUE                              CL**1
01960      END-IF.                                                         CL**1
01961 *                                                                    CL**1
01962  EJECT                                                               CL**1
01963 ******************************************************************   CL**1
01964 *    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM        CL**1
01965 *    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW         CL**1
01966 *    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600        CL**1
01967 *    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.      CL**1
01968 *                                                                    CL**1
01969 *    PERFORMED BY F500-BROWSE.                                       CL**1
01970 ******************************************************************   CL**1
01971 *                                                                    CL**1
01972  G400-READ-ITEMS-INTO-ARRAY.                                         CL**1
01973 *                                                                    CL**1
01974      COMPUTE PS-ITEM-SUB =                                           CL**1
01975          (MB127-NUMBER-OF-ITEMS-READ -                               CL**1
01976           MB127-LIST-ITEM-NUMBER(1 1)) + 1.                          CL**1
01977                                                                      CL**1
01978      MOVE PS-ITEM-SUB TO MB127-ITEM-SUB.                             CL**1
01979                                                                      CL**1
01980      IF  MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK                         CL**1
01981          SUBTRACT PC-ITEMS-PER-BLOCK                                 CL**1
01982                              FROM  MB127-ITEM-SUB                    CL**1
01983          MOVE PC-MAX-BLOCKS-IN-ARRAY                                 CL**1
01984                                TO  MB127-BLK-SUB                     CL**1
01985      ELSE                                                            CL**1
01986          MOVE +1               TO  MB127-BLK-SUB                     CL**1
01987      END-IF.                                                         CL**1
01988 *                                                                    CL**1
01989      MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.       CL**1
01990 *                                                                    CL**1
01991      PERFORM L100-OPEN-CURSOR.                                       CL**1
01992      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**1
01993      IF  PV-ITEMS-READ EQUAL ZERO                                    CL**9
01994          MOVE MB127-ITEM-AT-TOP-OF-PANEL                             CL**9
01995                                TO  PV-TOP-ITEM                       CL**9
01996      END-IF.                                                         CL**9
01997 *                                                                    CL**1
01998      IF  MB127-NO-ITEMS-LEFT-ON-DB                                   CL**1
01999          IF  PV-TOP-ITEM > MB127-NUMBER-OF-ITEMS-READ                CL**1
02000              MOVE MB127-NUMBER-OF-ITEMS-READ                         CL**1
02001                                TO  PV-TOP-ITEM                       CL**1
02002          END-IF                                                      CL**1
02003          MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER                  CL*25
02004          SET DP020-MSG-INFORMATIONAL                                 CL*25
02005                                TO  TRUE                              CL*25
02006          SET PS-INFORMATIONAL  TO  TRUE                              CL*25
02007      END-IF.                                                         CL**1
02008 *                                                                    CL**1
02009  EJECT                                                               CL**1
02010 ******************************************************************   CL**1
02011 *    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM         CL**1
02012 *    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ       CL**1
02013 *    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY          CL**1
02014 *    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK      CL**1
02015 *    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.      CL**1
02016 *    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE          CL**1
02017 *    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR          CL**1
02018 *    WILL BE PLACED IN THE 2ND BLOCK.                                CL**1
02019 *                                                                    CL**1
02020 *    PERFORMED BY F500-BROWSE.                                       CL**1
02021 ******************************************************************   CL**1
02022 *                                                                    CL**1
02023  G500-SCROLL-FORWARD.                                                CL**1
02024 *                                                                    CL**1
02025      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02026      SET MB127-BLOCK-MODIFIED (1)                                    CL**1
02027                                TO  TRUE.                             CL**1
02028      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02029 *                                                                    CL**1
02030      MOVE MB127-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO             CL**1
02031           MB127-BLOCK-ENTRIES(MB127-BLK-SUB).                        CL**1
02032 *                                                                    CL**1
02033      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
02034          1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).            CL**1
02035 *                                                                    CL**1
02036      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**1
02037      ADD +1                    TO  MB127-BLK-SUB.                    CL**1
02038      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02039 *                                                                    CL**1
02040  EJECT                                                               CL**1
02041 ******************************************************************   CL**1
02042 *    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM         CL**1
02043 *    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE          CL**1
02044 *    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.       CL**1
02045 *    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK    CL**1
02046 *    OF THE ARRAY.                                                   CL**1
02047 *                                                                    CL**1
02048 *    PERFORMED BY F500-BROWSE.                                       CL**1
02049 ******************************************************************   CL**1
02050 *                                                                    CL**1
02051  G600-SCROLL-BACKWARD.                                               CL**1
02052 *                                                                    CL**1
02053      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02054      SET MB127-BLOCK-MODIFIED (1)                                    CL**1
02055                                TO  TRUE.                             CL**1
02056      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02057 *                                                                    CL**1
02058      ADD +1 TO MB127-BLK-SUB.                                        CL**1
02059      SET MB127-BLOCK-MODIFIED (2)                                    CL**1
02060                                TO  TRUE.                             CL**1
02061      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02062                                                                      CL**1
02063      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02064      MOVE MB127-BLOCK-ENTRIES(MB127-BLK-SUB) TO                      CL**1
02065           MB127-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).               CL**1
02066 *                                                                    CL**1
02067      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
02068          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**1
02069 *                                                                    CL**1
02070      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**1
02071      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02072 *                                                                    CL**1
02073  EJECT                                                               CL**1
02074 ******************************************************************   CL**1
02075 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**1
02076 *    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH     CL**1
02077 *    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK       CL**1
02078 *    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY.     CL**1
02079 *    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING        CL**1
02080 *    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE      CL**1
02081 *    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.         CL**1
02082 *                                                                    CL**1
02083 *    PERFORMED BY F500-BROWSE.                                       CL**1
02084 ******************************************************************   CL**1
02085 *                                                                    CL**1
02086  G700-GET-TOP-ITEMS-BLOCK.                                           CL**1
02087 *                                                                    CL**1
02088      SET MB127-BLOCK-MODIFIED (1)                                    CL**1
02089                                TO  TRUE.                             CL**1
02090      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02091      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02092 *                                                                    CL**1
02093      SET MB127-BLOCK-MODIFIED (2)                                    CL**1
02094                                TO  TRUE.                             CL**1
02095      ADD +1                    TO  MB127-BLK-SUB.                    CL**1
02096      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02097 *                                                                    CL**1
02098      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
02099          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**1
02100 *                                                                    CL**1
02101      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**1
02102      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02103 *                                                                    CL**1
02104      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02105                                                                      CL**1
02106      ADD +1                    TO  PV-BLOCK-NUMBER.                  CL**1
02107      ADD +1                    TO  MB127-BLK-SUB.                    CL**1
02108 *                                                                    CL**1
02109      IF (PV-BLOCK-NUMBER < MB127-HIGHEST-BLOCK-WRITTEN) OR           CL**1
02110         (PV-BLOCK-NUMBER = MB127-HIGHEST-BLOCK-WRITTEN)              CL**1
02111          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
02112      ELSE                                                            CL**1
02113          PERFORM I100-INITIALIZE-BLOCK                               CL**1
02114      END-IF.                                                         CL**1
02115 *                                                                    CL**1
02116  EJECT                                                               CL**1
02117 ******************************************************************   CL**1
02118 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**1
02119 *    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE          CL**1
02120 *    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE       CL**1
02121 *    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,      CL**1
02122 *    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ      CL**1
02123 *    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK       CL**1
02124 *    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.        CL**1
02125 *    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.        CL**1
02126 *    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST         CL**1
02127 *    READ FROM THE DATA BASE.                                        CL**1
02128 *                                                                    CL**1
02129 *    PERFORMED BY F500-BROWSE.                                       CL**1
02130 ******************************************************************   CL**1
02131 *                                                                    CL**1
02132  G800-GET-LAST-BLOCK-IN-TEMP.                                        CL**1
02133 *                                                                    CL**1
02134      SET MB127-BLOCK-MODIFIED (1)                                    CL**1
02135                                TO  TRUE.                             CL**1
02136      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02137      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02138      SET MB127-BLOCK-MODIFIED (2)                                    CL**1
02139                                TO  TRUE.                             CL**1
02140      ADD +1                    TO  MB127-BLK-SUB.                    CL**1
02141      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02142 *                                                                    CL**1
02143      MOVE MB127-HIGHEST-BLOCK-WRITTEN                                CL**1
02144                                TO  PV-BLOCK-NUMBER.                  CL**1
02145      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02146      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02147 *                                                                    CL**1
02148      ADD +1                    TO  MB127-BLK-SUB.                    CL**1
02149      PERFORM I100-INITIALIZE-BLOCK.                                  CL**1
02150 *                                                                    CL**1
02151  EJECT                                                               CL**1
02152 ******************************************************************   CL**1
02153 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE        CL**1
02154 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,         CL**1
02155 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND      CL**1
02156 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE         CL**1
02157 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                       CL**1
02158 *                                                                    CL**1
02159 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
02160 *    PERFORMED BY G400-READ-ITEMS-INTO-ARRAY.                        CL**1
02161 ******************************************************************   CL**1
02162 *                                                                    CL**1
02163  H100-READ-ITEMS-FROM-DB.                                            CL**1
02164 *                                                                    CL**1
02165      PERFORM                                                         CL**1
02166          UNTIL (MB127-NO-ITEMS-LEFT-ON-DB)   OR                      CL**1
02167                (MB127-NUMBER-OF-ITEMS-READ =                         CL**1
02168                 PV-HIGHEST-ITEM-TO-BE-READ)                          CL**1
02169 *                                                                    CL**1
02170          IF MB127-ITEM-SUB < PC-ITEMS-PER-BLOCK                      CL**1
02171              ADD +1            TO  MB127-ITEM-SUB                    CL**1
02172          ELSE                                                        CL**1
02173              ADD +1            TO  MB127-BLK-SUB                     CL**1
02174              MOVE +1           TO  MB127-ITEM-SUB                    CL**1
02175 *                                                                    CL**1
02176              IF MB127-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY               CL**1
02177                  MOVE +1       TO  MB127-BLK-SUB                     CL**1
02178                  SET MB127-BLOCK-MODIFIED (1)                        CL**1
02179                                TO  TRUE                              CL**1
02180                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
02181                  MOVE MB127-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY)    CL**1
02182                  TO   MB127-BLOCK-ENTRIES(MB127-BLK-SUB)             CL**1
02183                  ADD +1        TO  MB127-BLK-SUB                     CL**1
02184                  PERFORM I100-INITIALIZE-BLOCK                       CL**1
02185              END-IF                                                  CL**1
02186          END-IF                                                      CL**1
02187 *                                                                    CL**1
02188          PERFORM L200-FETCH                                          CL**1
02189          IF  MB127-ITEMS-LEFT-ON-DB                                  CL**1
02190              SET MB127-BLOCK-MODIFIED (MB127-BLK-SUB)                CL*22
02191                                TO  TRUE                              CL*22
02192              ADD 1             TO  MB127-NUMBER-OF-ITEMS-READ        CL**1
02193                                    PV-ITEMS-READ                     CL**9
02194              MOVE MB127-NUMBER-OF-ITEMS-READ                         CL**1
02195                                TO  MB127-LIST-ITEM-NUMBER            CL**1
02196                                        (MB127-BLK-SUB                CL**1
02197                                         MB127-ITEM-SUB)              CL**1
02198              MOVE MDSELV-CDE   TO  MB127-MLEVEL                      CL**2
02199                                        (MB127-BLK-SUB                CL**1
02200                                         MB127-ITEM-SUB)              CL**1
02201              MOVE MDSELV-PRNT-MDSELV-CDE                             CL**2
02202                                TO  MB127-PLEVEL                      CL**2
02203                                        (MB127-BLK-SUB                CL**1
02204                                         MB127-ITEM-SUB)              CL**1
02205              MOVE MDSELV-DESC  TO  MB127-DESC                        CL**2
02206                                        (MB127-BLK-SUB                CL**1
02207                                         MB127-ITEM-SUB)              CL**1
02208          END-IF                                                      CL**1
02209      END-PERFORM.                                                    CL**1
02210 *                                                                    CL**1
02211      MOVE MDSELV-CDE           TO  MB127-LAST-MLEVEL.                CL**2
02212 *                                                                    CL**1
02213  EJECT                                                               CL**1
02214 *                                                                    CL**1
02215 ******************************************************************   CL**1
02216 *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.               CL**1
02217 *                                                                    CL**1
02218 *    PERFORMED BY G100-DISPLAY-PANEL.                                CL**1
02219 ******************************************************************   CL**1
02220 *                                                                    CL**1
02221  H200-FORMAT-PANEL-BODY.                                             CL**1
02222 *                                                                    CL**1
02223      PERFORM I700-FORMAT-FROM-TO-LINE.                               CL**1
02224      PERFORM I200-FORMAT-LIST-LINES.                                 CL**1
02225      PERFORM I300-FORMAT-NR-SELECTED.                                CL**1
02226                                                                      CL**1
02227      IF NOT DP020-NEXT-ACT-ERROR                                     CL**1
02228          PERFORM I800-SET-CURSOR-POSITION                            CL**1
02229      END-IF.                                                         CL**1
02230 *                                                                    CL**1
02231  EJECT                                                               CL**1
02232 ******************************************************************   CL**1
02233 *    INITIALIZE A BLOCK IN THE ARRAY.                                CL**1
02234 *                                                                    CL**1
02235 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
02236 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02237 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02238 *    PERFORMED BY H100-READ-ITEMS-FROM-DB.                           CL**1
02239 ******************************************************************   CL**1
02240 *                                                                    CL**1
02241  I100-INITIALIZE-BLOCK.                                              CL**1
02242 *                                                                    CL**1
02243      INITIALIZE  MB127-BLOCK-ENTRIES (MB127-BLK-SUB).                CL**1
02244      SET MB127-BLOCK-NOT-MODIFIED(MB127-BLK-SUB) TO TRUE.            CL**1
02245  EJECT                                                               CL**1
02246 ******************************************************************   CL**1
02247 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        CL**1
02248 *                                                                    CL**1
02249 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
02250 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02251 ******************************************************************   CL**1
02252 *                                                                    CL**1
02253  I200-FORMAT-LIST-LINES.                                             CL**1
02254 *                                                                    CL**1
02255      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
02256          (MB127-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
02257 *                                                                    CL**1
02258      MOVE MB127-ITEM-AT-TOP-OF-PANEL                                 CL**1
02259                                TO  PV-ITEM-IN-USE.                   CL**1
02260      MOVE +1                   TO  PS-SUB.                           CL**1
02261 *                                                                    CL**1
02262      PERFORM J100-PROCESS-ITEMS                                      CL**1
02263          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**1
02264 *                                                                    CL**1
02265  EJECT                                                               CL**1
02266 ******************************************************************   CL**1
02267 *    FORMAT THE FIELD WHICH WILL SHOW THE NUMBER OF ITEMS THAT       CL**1
02268 *    WERE SELECTED BY THE USER.                                      CL**1
02269 *                                                                    CL**1
02270 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
02271 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02272 ******************************************************************   CL**1
02273 *                                                                    CL**1
02274  I300-FORMAT-NR-SELECTED.                                            CL**1
02275 *                                                                    CL**1
02276      MOVE MB127-NUMBER-OF-SELECTED-ITEMS                             CL**1
02277                                TO  PV-DISPLAY5.                      CL**1
02278      MOVE PV-DISPLAY5          TO  TOTSELO.                          CL**1
02279  EJECT                                                               CL**1
02280 ******************************************************************   CL**1
02281 *    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE     CL**1
02282 *    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE       CL**1
02283 *    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE       CL**1
02284 *    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.                  CL**1
02285 *                                                                    CL**1
02286 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02287 ******************************************************************   CL**1
02288 *                                                                    CL**1
02289  I700-FORMAT-FROM-TO-LINE.                                           CL**1
02290 *                                                                    CL**1
02291      MOVE MB127-ITEM-AT-TOP-OF-PANEL                                 CL**1
02292                                TO  PV-DISPLAY5.                      CL**1
02293      MOVE PV-DISPLAY5          TO  ABEGITMO.                         CL**8
02294 *                                                                    CL**1
02295      MOVE DP015-GREEN          TO  ABEGITMC.                         CL**8
02296      MOVE DP015-UNDERLINE      TO  ABEGITMH.                         CL**8
02297      MOVE DP015-UNP-NUM-BRT-MDT                                      CL**1
02298                                TO  ABEGITMA.                         CL**8
02299 *                                                                    CL**1
02300      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
02301          (MB127-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
02302 *                                                                    CL**1
02303      IF PV-ENDING-ITEM-ON-PANEL < MB127-NUMBER-OF-ITEMS-READ         CL**1
02304          MOVE PV-ENDING-ITEM-ON-PANEL                                CL**1
02305                                TO  PV-DISPLAY5                       CL**1
02306      ELSE                                                            CL**1
02307          MOVE MB127-NUMBER-OF-ITEMS-READ                             CL**1
02308                                TO  PV-DISPLAY5                       CL**1
02309      END-IF.                                                         CL**1
02310      MOVE PV-DISPLAY5          TO  ATOITMO.                          CL**8
02311 *                                                                    CL**1
02312      MOVE MB127-NUMBER-OF-ITEMS-READ                                 CL**1
02313                                TO  PV-DISPLAY5.                      CL**1
02314      MOVE PV-DISPLAY5          TO  ATOTITMO.                         CL**8
02315 *                                                                    CL**1
02316  EJECT                                                               CL**1
02317 ******************************************************************   CL**1
02318 *    IF NO ITEMS WERE READ FROM THE DATA BASE, POINT THE CURSOR      CL**1
02319 *    TO THE COMMAND LINE, OTHERWISE POINT THE CURSOR TO ONE OF       CL**1
02320 *    THE SELECTION ENTRIES.                                          CL**1
02321 *                                                                    CL**1
02322 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02323 ******************************************************************   CL**1
02324 *                                                                    CL**1
02325  I800-SET-CURSOR-POSITION.                                           CL**1
02326 *                                                                    CL**1
02327      IF MB127-NUMBER-OF-ITEMS-READ = +0                              CL**1
02328          MOVE -1               TO  ANAVCMDL                          CL**1
02329          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
02330          SET DP020-MSG-WARNING TO  TRUE                              CL**1
02331      ELSE                                                            CL**1
02332 *                                                                    CL**1
02333          IF (PS-CURSOR-NOT-POSITIONED) OR                            CL**1
02334             (PS-WARNING)               OR                            CL**1
02335             (PS-INFORMATIONAL)                                       CL**1
02336              PERFORM J200-FIND-LAST-SELECTION                        CL**1
02337          END-IF                                                      CL**1
02338      END-IF.                                                         CL**1
02339 *                                                                    CL**1
02340  EJECT                                                               CL**1
02341 ******************************************************************   CL**1
02342 *    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.          CL**1
02343 *    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF        CL**1
02344 *    MAP ENTRIES.                                                    CL**1
02345 *                                                                    CL**1
02346 *    PERFORMED BY I200-FORMAT-LIST-LINES.                            CL**1
02347 ******************************************************************   CL**1
02348 *                                                                    CL**1
02349  J100-PROCESS-ITEMS.                                                 CL**1
02350 *                                                                    CL**1
02351      IF (PV-ITEM-IN-USE < MB127-NUMBER-OF-ITEMS-READ) OR             CL**1
02352         (PV-ITEM-IN-USE = MB127-NUMBER-OF-ITEMS-READ)                CL**1
02353          PERFORM K100-SET-SUBSCRIPTS                                 CL**1
02354          MOVE DP015-UNP-ALP-BRT-MDT                                  CL**1
02355                                TO  MBKM127-SELECTA(PS-SUB)           CL**1
02356 *                                                                    CL**1
02357          IF (MB127-SELECT(MB127-BLK-SUB MB127-ITEM-SUB))             CL**1
02358          OR (MB127-NO-SELECT(MB127-BLK-SUB MB127-ITEM-SUB))          CL**1
02359              MOVE DP015-UNDERLINE TO MBKM127-SELECTH(PS-SUB)         CL*11
02360              MOVE DP015-GREEN     TO MBKM127-SELECTC(PS-SUB)         CL**1
02361          ELSE                                                        CL**1
02362 *                                                                    CL**1
02363              IF (MB127-BEGIN(MB127-BLK-SUB MB127-ITEM-SUB))          CL**1
02364              OR (MB127-END(MB127-BLK-SUB MB127-ITEM-SUB))            CL**1
02365                  MOVE DP015-UNDERLINE   TO MBKM127-SELECTH(PS-SUB)   CL*11
02366                  MOVE DP015-GREEN       TO MBKM127-SELECTC(PS-SUB)   CL**1
02367                  IF (DP020-MSG-NUMBER  =    PC-TSYMSG-00051          CL**1
02368                                          OR PC-TSYMSG-00053          CL**1
02369                     )                                                CL**1
02370 *                    UNPAIRED RANGE CHARACTER, SET WARNING           CL**1
02371 *                    ATTRIBUTES FOR RANGE CHARACTER:                 CL**1
02372                      MOVE DP015-REVERSE TO MBKM127-SELECTH(PS-SUB)   CL*10
02373                      MOVE DP015-YELLOW  TO MBKM127-SELECTC(PS-SUB)   CL**1
02374                  END-IF                                              CL**1
02375 *                                                                    CL**1
02376                  IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00054         CL**1
02377                      AND MB127-BEGIN( MB127-BLK-SUB                  CL**1
02378                                       MB127-ITEM-SUB   )             CL**1
02379                     )                                                CL**1
02380 *                    TWO OR MORE START-OF-RANGE CHARACTERS, SET      CL**1
02381 *                    ATTRIBUTES FOR START-OF-RANGE CHARACTERS:       CL**1
02382                      MOVE DP015-REVERSE TO MBKM127-SELECTH(PS-SUB)   CL*10
02383                      MOVE DP015-RED     TO MBKM127-SELECTC(PS-SUB)   CL**1
02384                  END-IF                                              CL**1
02385 *                                                                    CL**1
02386                  IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00055         CL**1
02387                      AND MB127-END( MB127-BLK-SUB                    CL**1
02388                                     MB127-ITEM-SUB   )               CL**1
02389                     )                                                CL**1
02390 *                    TWO OR MORE END-OF-RANGE CHARACTERS, SET        CL**1
02391 *                    ATTRIBUTES FOR END-OF-RANGE CHARACTERS:         CL**1
02392                      MOVE DP015-REVERSE TO MBKM127-SELECTH(PS-SUB)   CL*10
02393                      MOVE DP015-RED     TO MBKM127-SELECTC(PS-SUB)   CL**1
02394                  END-IF                                              CL**1
02395 *                                                                    CL**1
02396                  IF  DP020-MSG-NUMBER  =  PC-TSYMSG-00052            CL**1
02397 *                    END-OF-RANGE PRECEDES START OF RANGE, SET       CL**1
02398 *                    ATTRIBUTES OF RANGE CHARACTERS:                 CL**1
02399                      MOVE DP015-REVERSE TO MBKM127-SELECTH(PS-SUB)   CL*10
02400                      MOVE DP015-RED     TO MBKM127-SELECTC(PS-SUB)   CL**1
02401                  END-IF                                              CL**1
02402              END-IF                                                  CL**1
02403                                                                      CL**1
02404          END-IF                                                      CL**1
02405                                                                      CL**1
02406          MOVE MB127-SELECTED-SW(MB127-BLK-SUB MB127-ITEM-SUB)        CL**1
02407                                TO  MBKM127-SELECTI(PS-SUB)           CL**1
02408 *                                                                    CL**1
02409          IF (PS-SEND-MAP-N-DATA-FRSET)                               CL**1
02410          OR (PS-DIFFERENT-ITEMS-DISPLAYED)                           CL**1
02411              MOVE MB127-MLEVEL      (MB127-BLK-SUB                   CL**2
02412                                      MB127-ITEM-SUB)                 CL**1
02413                                TO  MBKM127-MLEVEL      (PS-SUB)      CL**2
02414 *                                                                    CL**1
02415              MOVE MB127-PLEVEL          (MB127-BLK-SUB               CL**2
02416                                          MB127-ITEM-SUB)             CL**1
02417                                TO  MBKM127-PLEVEL      (PS-SUB)      CL**2
02418 *                                                                    CL**1
02419              MOVE MB127-DESC            (MB127-BLK-SUB               CL**2
02420                                          MB127-ITEM-SUB)             CL**1
02421                                TO  MBKM127-DESC        (PS-SUB)      CL**2
02422 *                                                                    CL**1
02423          END-IF                                                      CL**1
02424                                                                      CL**1
02425      ELSE                                                            CL**1
02426                                                                      CL**1
02427          IF (PS-SEND-MAP-N-DATA-FRSET)     OR                        CL**1
02428             (PS-DIFFERENT-ITEMS-DISPLAYED)                           CL**1
02429              MOVE SPACES       TO  MBKM127-MLEVEL      (PS-SUB)      CL**2
02430                                    MBKM127-PLEVEL      (PS-SUB)      CL**2
02431                                    MBKM127-DESC        (PS-SUB)      CL**2
02432                                    MBKM127-SELECTI     (PS-SUB)      CL**7
02433              MOVE DP015-ASK-DRK-OFF                                  CL**1
02434                                TO  MBKM127-SELECTA(PS-SUB)           CL**1
02435          END-IF                                                      CL**1
02436                                                                      CL**1
02437      END-IF.                                                         CL**1
02438                                                                      CL**1
02439      ADD +1 TO PV-ITEM-IN-USE.                                       CL**1
02440      ADD +1 TO PS-SUB.                                               CL**1
02441  EJECT                                                               CL**1
02442 ******************************************************************   CL**1
02443 *    FIND THE LAST SELECTION ENTRY IN THE MAP THAT IS NOT            CL**1
02444 *    SPACES OR LOW VALUES AND POINT THE CURSOR TO THIS ENTRY.        CL**1
02445 *    IF ALL ENTRIES ARE SPACES OR LOW VALUES, POINT THE CURSOR       CL**1
02446 *    TO THE 1ST SELECTION ENTRY IN THE MAP.                          CL**1
02447 *                                                                    CL**1
02448 *    PERFORMED BY I800-SET-CURSOR-POSITION.                          CL**1
02449 ******************************************************************   CL**1
02450 *                                                                    CL**1
02451  J200-FIND-LAST-SELECTION.                                           CL**1
02452 *                                                                    CL**1
02453      MOVE PC-ITEMS-PER-PANEL TO PS-SUB.                              CL**1
02454                                                                      CL**1
02455      SET PS-NO-SELECTION-FOUND TO TRUE.                              CL**1
02456                                                                      CL**1
02457      PERFORM                                                         CL**1
02458          UNTIL (PS-SUB = +1)                                         CL**1
02459             OR (PS-SELECTION-FOUND)                                  CL**1
02460 *                                                                    CL**1
02461          IF (MBKM127-SELECTI(PS-SUB) NOT EQUAL SPACES                CL**1
02462          AND MBKM127-SELECTI(PS-SUB) NOT EQUAL LOW-VALUE)            CL**1
02463              SET PS-SELECTION-FOUND                                  CL**1
02464                                TO  TRUE                              CL**1
02465          ELSE                                                        CL**1
02466              SUBTRACT +1     FROM  PS-SUB                            CL**1
02467          END-IF                                                      CL**1
02468      END-PERFORM.                                                    CL**1
02469                                                                      CL**1
02470      MOVE -1                 TO  MBKM127-SELECTL(PS-SUB).            CL**1
02471 *                                                                    CL**1
02472  EJECT                                                               CL**1
02473 ******************************************************************   CL**1
02474 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM     CL**1
02475 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL    CL**1
02476 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                      CL**1
02477 *                                                                    CL**1
02478 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS       CL**1
02479 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT        CL**1
02480 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION      CL**1
02481 *    US IN THE 2ND BLOCK OF THE ARRAY.                               CL**1
02482 *                                                                    CL**1
02483 *    PERFORMED BY E100-EDIT-SELECTIONS.                              CL**1
02484 *    PERFORMED BY F100-EDIT.                                         CL**1
02485 *    PERFORMED BY F300-CHECK-SELECTIONS.                             CL**1
02486 *    PERFORMED BY J100-PROCESS-ITEMS.                                CL**1
02487 ******************************************************************   CL**1
02488 *                                                                    CL**1
02489  K100-SET-SUBSCRIPTS.                                                CL**1
02490 *                                                                    CL**1
02491      COMPUTE PS-ITEM-SUB =                                           CL**1
02492          (PV-ITEM-IN-USE - MB127-LIST-ITEM-NUMBER(1 1)) + 1.         CL**1
02493                                                                      CL**1
02494      MOVE PS-ITEM-SUB TO MB127-ITEM-SUB.                             CL**1
02495                                                                      CL**1
02496      IF MB127-ITEM-SUB > PC-ITEMS-PER-BLOCK                          CL**1
02497          SUBTRACT PC-ITEMS-PER-BLOCK FROM MB127-ITEM-SUB             CL**1
02498                                                                      CL**1
02499          MOVE PC-MAX-BLOCKS-IN-ARRAY TO MB127-BLK-SUB                CL**1
02500      ELSE                                                            CL**1
02501          MOVE +1                     TO MB127-BLK-SUB                CL**1
02502      END-IF.                                                         CL**1
02503 *                                                                    CL**1
02504  EJECT                                                               CL**1
02505 ******************************************************************   CL**1
02506 *    OPEN THE BUSINESS GROUP LIST CURSOR.                            CL**1
02507 *                                                                    CL**1
02508 *    PERFORMED BY D100                                               CL**1
02509 ******************************************************************   CL**1
02510 *                                                                    CL**1
02511  L100-OPEN-CURSOR.                                                   CL**1
02512 *                                                                    CL**1
02513      MOVE MB127-LAST-MLEVEL                                          CL**1
02514                                TO  MDSELV-CDE.                       CL**2
02515      PERFORM                                                         CL**1
02516          WITH TEST AFTER                                             CL**1
02517          VARYING PV-SQL-SUB                                          CL**1
02518          FROM 1 BY 1                                                 CL**1
02519          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
02520             OR SQLCODE = 0                                           CL**1
02521             OR SQLCODE = +100                                        CL**1
02522 *                                                                    CL**1
02523          EXEC SQL                                                    CL**1
02524               OPEN ML-LIST                                           CL**1
02525          END-EXEC                                                    CL**1
02526 *                                                                    CL**1
02527          EVALUATE TRUE                                               CL**1
02528              WHEN SQLCODE = -904                                     CL**1
02529              WHEN SQLCODE = -913                                     CL**1
02530              WHEN SQLCODE = ZERO                                     CL**1
02531              WHEN SQLCODE = +100                                     CL**1
02532                   CONTINUE                                           CL**1
02533              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
02534              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
02535                   MOVE 'L100-OPEN-CURSOR'                            CL**1
02536                                TO  DP013-PARAGRAPH                   CL**1
02537                   MOVE 'OPEN ML-LIST CURSOR'                         CL**1
02538                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02539                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
02540                   SET DP013-DB2-ABEND                                CL**1
02541                                TO  TRUE                              CL**1
02542                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
02543          END-EVALUATE                                                CL**1
02544      END-PERFORM.                                                    CL**1
02545 *                                                                    CL**1
02546      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
02547          MOVE 'L100-OPEN-CURSOR'                                     CL**1
02548                                TO  DP013-PARAGRAPH                   CL**1
02549          MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'                 CL**1
02550                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02551          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
02552          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
02553          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02554      END-IF.                                                         CL**1
02555 *                                                                    CL**1
02556  EJECT                                                               CL**1
02557 ******************************************************************   CL**1
02558 *    FETCH THE ROWS FROM TMDSEBG.                                    CL**1
02559 *                                                                    CL**1
02560 *    PERFORMED BY H100                                               CL**1
02561 ******************************************************************   CL**1
02562 *                                                                    CL**1
02563  L200-FETCH.                                                         CL**1
02564 *                                                                    CL**1
02565      PERFORM                                                         CL**1
02566          WITH TEST AFTER                                             CL**1
02567          VARYING PV-SQL-SUB                                          CL**1
02568          FROM 1 BY 1                                                 CL**1
02569          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
02570             OR SQLCODE = 0                                           CL**1
02571             OR SQLCODE = +100                                        CL**1
02572 *                                                                    CL**1
02573          EXEC SQL                                                    CL**1
02574               FETCH ML-LIST                                          CL**1
02575               INTO                                                   CL**1
02576                     :MDSELV-CDE,                                     CL**2
02577                     :MDSELV-PRNT-MDSELV-CDE,                         CL**2
02578                     :MDSELV-DESC                                     CL**2
02579          END-EXEC                                                    CL**1
02580 *                                                                    CL**1
02581          EVALUATE TRUE                                               CL**1
02582              WHEN SQLCODE = -904                                     CL**1
02583              WHEN SQLCODE = -913                                     CL**1
02584              WHEN SQLCODE = ZERO                                     CL**1
02585              WHEN SQLCODE = +100                                     CL**1
02586                   CONTINUE                                           CL**1
02587              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
02588              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
02589                   MOVE 'L200-FETCH'                                  CL**1
02590                                TO  DP013-PARAGRAPH                   CL**1
02591                   MOVE 'FETCH ML-LIST CURSOR'                        CL**1
02592                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02593                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
02594                   SET DP013-DB2-ABEND                                CL**1
02595                                TO  TRUE                              CL**1
02596                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
02597          END-EVALUATE                                                CL**1
02598      END-PERFORM.                                                    CL**1
02599 *                                                                    CL**1
02600      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
02601          MOVE 'L200-FETCH'                                           CL**1
02602                                TO  DP013-PARAGRAPH                   CL**1
02603          MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'                CL**1
02604                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02605          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
02606          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
02607          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02608      END-IF.                                                         CL**1
02609 *                                                                    CL**1
02610      IF  SQLCODE EQUAL +100                                          CL**1
02611          SET MB127-NO-ITEMS-LEFT-ON-DB                               CL**1
02612                                TO  TRUE                              CL**1
02613      END-IF.                                                         CL**1
02614 *                                                                    CL**1
02615  EJECT                                                               CL**1
02616 ******************************************************************   CL**1
02617 *    PREPARE THE TEMPORARY STORAGE QUEUE.  MOVE ALL SELECTED         CL**1
02618 *    GROUPS FROM EITHER TEMP STORAGE OR THE ARRAY IN THE COMM        CL**1
02619 *    AREA TO THE LIST TS QUEUE RECORD(S).                            CL**1
02620 *                                                                    CL**1
02621 *    PERFORMED BY D300                                               CL**1
02622 ******************************************************************   CL**1
02623 *                                                                    CL**1
02624  X100-PREPARE-LIST-QUEUE.                                            CL**1
02625 *                                                                    CL**1
02626      MOVE +1                   TO  MB127-BLK-SUB.                    CL**1
02627      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02628      ADD +1                    TO  MB127-BLK-SUB.                    CL**1
02629      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02630 *                                                                    CL**1
02631      IF  MB127-HIGHEST-BLOCK-WRITTEN = ZERO                          CL**1
02632          MOVE EIBTRMID         TO  PV-ML-TERM-ID                     CL**2
02633          MOVE EIBTASKN         TO  PV-ML-TASK-NUMBER                 CL**2
02634      ELSE                                                            CL**1
02635          MOVE MB127-TERM-ID    TO  PV-ML-TERM-ID                     CL**2
02636          MOVE MB127-TASK-NUMBER                                      CL**1
02637                                TO  PV-ML-TASK-NUMBER                 CL**2
02638      END-IF.                                                         CL**1
02639      SUBTRACT 1              FROM  PV-ML-TASK-NUMBER.                CL**2
02640 *                                                                    CL**1
02641      MOVE PV-ML-QUEUE-NAME     TO  MB005-LIST-QUEUE-NAME             CL**2
02642                                    MB127-LIST-QUEUE-NAME.            CL**1
02643      MOVE LENGTH OF ML-LIST-RECORD                                   CL**1
02644                                TO  MB005-LIST-QUEUE-LENGTH.          CL**1
02645      PERFORM X900-DELETE-LIST-QUEUE.                                 CL**1
02646 *                                                                    CL**1
02647      SET MBWS127-IDX           TO  1.                                CL**2
02648      INITIALIZE ML-LIST-RECORD.                                      CL**1
02649      PERFORM X200-PROCESS-TS-QUEUE                                   CL**1
02650              VARYING PV-ITEM                                         CL**1
02651              FROM 1 BY 1                                             CL**1
02652              UNTIL PV-ITEM GREATER MB127-HIGHEST-BLOCK-WRITTEN.      CL**1
02653 *                                                                    CL**1
02654      PERFORM X500-WRITE-LIST-QUEUE.                                  CL**1
02655 *                                                                    CL**1
02656  EJECT                                                               CL**1
02657 ******************************************************************   CL**1
02658 *    READ A TS QUEUE RECORD, MOVE SELECTED RECORDS TO THE            CL**1
02659 *    BUSINESS GROUP LIST QUEUE RECORD.                               CL**1
02660 *                                                                    CL**1
02661 *    PERFORMED BY X100                                               CL**1
02662 ******************************************************************   CL**1
02663 *                                                                    CL**1
02664  X200-PROCESS-TS-QUEUE.                                              CL**1
02665 *                                                                    CL*12
02666      PERFORM X300-READ-TS-QUEUE.                                     CL*18
02667      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL**1
02668          PERFORM                                                     CL**1
02669          VARYING PV-TW-IDX                                           CL**1
02670          FROM 1 BY 1                                                 CL**1
02671          UNTIL PV-TW-IDX GREATER THAN PC-ITEMS-PER-BLOCK             CL**1
02672            OR  PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX) EQUAL ZERO         CL**1
02673 *                                                                    CL**1
02674              IF  PV-TW-SELECT (PV-TW-IDX)                            CL**1
02675                  MOVE PV-TW-MLEVEL      (PV-TW-IDX)                  CL**2
02676                                TO  MBWS127-MLEVEL (MBWS127-IDX)      CL**2
02677                                    MBWS127-LAST-MLEVEL               CL**2
02678                  MOVE PV-TW-LIST-ITEM-NUMBER  (PV-TW-IDX)            CL*12
02679                                TO  MBWS127-ITEM   (MBWS127-IDX)      CL*12
02680                  IF  MBWS127-IDX EQUAL 1                             CL**2
02681                      MOVE MBWS127-LAST-MLEVEL                        CL**2
02682                                TO  MBWS127-FIRST-MLEVEL              CL**2
02683                  END-IF                                              CL**1
02684                  SET MBWS127-IDX UP BY 1                             CL**2
02685                  IF  MBWS127-IDX GREATER PC-MAX-MLEVELS              CL**2
02686                      PERFORM X500-WRITE-LIST-QUEUE                   CL**1
02687                  END-IF                                              CL**1
02688              END-IF                                                  CL**1
02689 *                                                                    CL**1
02690          END-PERFORM                                                 CL**1
02691      END-IF.                                                         CL**1
02692 *                                                                    CL*12
02693  EJECT                                                               CL*12
02694 ******************************************************************   CL*12
02695 *    READ A TS QUEUE RECORD, MOVE SELECTED RECORDS TO THE            CL*12
02696 *    BUSINESS GROUP LIST QUEUE RECORD.                               CL*12
02697 *                                                                    CL*12
02698 *    PERFORMED BY C500, X100                                         CL*12
02699 ******************************************************************   CL*12
02700 *                                                                    CL*12
02701  X300-READ-TS-QUEUE.                                                 CL*18
02702 *                                                                    CL*12
02703      EXEC CICS                                                       CL*12
02704          READQ TS                                                    CL*12
02705          QUEUE(MB127-TEMP-QUEUE-NAME)                                CL*12
02706          INTO(PV-TEMP-WORK-AREA)                                     CL*12
02707          LENGTH(PC-BLOCK-LENGTH)                                     CL*12
02708          ITEM(PV-ITEM)                                               CL*12
02709          RESP(PV-RESP)                                               CL*12
02710      END-EXEC.                                                       CL*12
02711 *                                                                    CL*12
02712  EJECT                                                               CL**1
02713 ******************************************************************   CL**1
02714 *    WRITE THE SKU LIST QUEUE RECORD.                                CL**1
02715 *                                                                    CL**1
02716 *    PERFORMED BY X100                                               CL**1
02717 ******************************************************************   CL**1
02718 *                                                                    CL**1
02719  X500-WRITE-LIST-QUEUE.                                              CL**1
02720 *                                                                    CL**1
02721      IF  MBWS127-IDX GREATER THAN 1                                  CL**2
02722          MOVE PC-MAX-MLEVELS   TO  MBWS127-MAX-MLEVELS               CL**2
02723          MOVE MB127-NUMBER-OF-SELECTED-ITEMS                         CL**1
02724                                TO  MBWS127-SELECTED-MLEVELS          CL**2
02725 *                                                                    CL**6
02726          IF  DP020-SRC-AID EQUAL DP016-PF15                          CL**6
02727              SET MBWS127-UPDATE  TO  TRUE                            CL**6
02728          END-IF                                                      CL**6
02729 *                                                                    CL**1
02730          EXEC CICS                                                   CL**1
02731               WRITEQ TS                                              CL**1
02732               QUEUE(MB005-LIST-QUEUE-NAME)                           CL**1
02733               FROM(ML-LIST-RECORD)                                   CL**1
02734               LENGTH(MB005-LIST-QUEUE-LENGTH)                        CL**1
02735               ITEM(PV-ML-ITEM)                                       CL*12
02736               RESP(PV-RESP)                                          CL**1
02737          END-EXEC                                                    CL**1
02738 *                                                                    CL**1
02739          IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                       CL**1
02740              SET PS-DONT-PROCESS                                     CL*19
02741                                TO  TRUE                              CL**1
02742          END-IF                                                      CL**1
02743 *                                                                    CL**1
02744          INITIALIZE ML-LIST-RECORD                                   CL**1
02745          SET MBWS127-IDX       TO  1                                 CL**2
02746      END-IF.                                                         CL**1
02747 *                                                                    CL*12
02748  EJECT                                                               CL*12
02749 ******************************************************************   CL*12
02750 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.                 CL*12
02751 *                                                                    CL*12
02752 *    PERFORMED BY C500, C600                                         CL*12
02753 ******************************************************************   CL*12
02754 *                                                                    CL*12
02755  X550-WRITE-TS-QUEUE.                                                CL*12
02756 *                                                                    CL*12
02757      EXEC CICS                                                       CL*12
02758          WRITEQ TS                                                   CL*12
02759          REWRITE                                                     CL*12
02760          QUEUE(MB127-TEMP-QUEUE-NAME)                                CL*12
02761          FROM(PV-TEMP-WORK-AREA)                                     CL*12
02762          LENGTH(PC-BLOCK-LENGTH)                                     CL*12
02763          ITEM(PV-SAVE-ITEM)                                          CL*12
02764          RESP(PV-RESP)                                               CL*12
02765      END-EXEC.                                                       CL*12
02766 *                                                                    CL*12
02767  EJECT                                                               CL*12
02768 ******************************************************************   CL*12
02769 *    READ THE LIST QUEUE RECORD.                                     CL*12
02770 *                                                                    CL*12
02771 *    PERFORMED BY C500                                               CL*12
02772 ******************************************************************   CL*12
02773 *                                                                    CL*12
02774  X600-READ-LIST-QUEUE.                                               CL*12
02775 *                                                                    CL*12
02776      EXEC CICS                                                       CL*12
02777           READQ TS                                                   CL*12
02778           QUEUE(MB005-LIST-QUEUE-NAME)                               CL*12
02779           INTO(ML-LIST-RECORD)                                       CL*12
02780           LENGTH(MB005-LIST-QUEUE-LENGTH)                            CL*12
02781           ITEM(PV-ML-ITEM)                                           CL*12
02782           RESP(PV-RESP)                                              CL*12
02783      END-EXEC.                                                       CL*12
02784 *                                                                    CL**1
02785  EJECT                                                               CL**1
02786 ******************************************************************   CL**1
02787 *    DELETE THE SKU LIST TEMP STORAGE QUEUE.                         CL**1
02788 *                                                                    CL**1
02789 *    PERFORMED BY X100                                               CL**1
02790 ******************************************************************   CL**1
02791 *                                                                    CL**1
02792  X900-DELETE-LIST-QUEUE.                                             CL**1
02793 *                                                                    CL**1
02794      EXEC CICS                                                       CL**1
02795          DELETEQ TS                                                  CL**1
02796          QUEUE(MB005-LIST-QUEUE-NAME)                                CL**1
02797          RESP(PV-RESP)                                               CL**1
02798      END-EXEC.                                                       CL**1
02799  EJECT                                                               CL**1
02800 *                                                                    CL**1
02801 ******************************************************************   CL**1
02802 *    DELETE THE TEMPORARY STORAGE QUEUE.                             CL**1
02803 *                                                                    CL**1
02804 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
02805 ******************************************************************   CL**1
02806 *                                                                    CL**1
02807  Z050-DELETE-TEMP-STORAGE.                                           CL**1
02808 *                                                                    CL**1
02809      EXEC CICS                                                       CL**1
02810          DELETEQ TS                                                  CL**1
02811          QUEUE(MB127-TEMP-QUEUE-NAME)                                CL**1
02812          RESP(PV-RESP)                                               CL**1
02813      END-EXEC.                                                       CL**1
02814                                                                      CL**1
02815      IF (PV-RESP NOT = DFHRESP(NORMAL)) AND                          CL**1
02816         (PV-RESP NOT = DFHRESP(QIDERR))                              CL**1
02817          MOVE PV-RESP TO PM-RESP-23                                  CL**1
02818                                                                      CL**1
02819          SET DP013-LOGIC-ABEND TO TRUE                               CL**1
02820          SET DP013-NO-ROLLBACK TO TRUE                               CL**1
02821                                                                      CL**1
02822          MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH          CL**1
02823          MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1)    CL**1
02824                                                                      CL**1
02825          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02826      END-IF.                                                         CL**1
02827                                                                      CL**1
02828      MOVE +0 TO MB127-HIGHEST-BLOCK-WRITTEN.                         CL**1
02829  EJECT                                                               CL**1
02830 ******************************************************************   CL**1
02831 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.             CL**1
02832 *                                                                    CL**1
02833 *    PERFORMED BY D400-REFRESH-BLOCK-ARRAY.                          CL**1
02834 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
02835 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
02836 *    PERFORMED BY G500-SCROLL-FORWARD.                               CL**1
02837 *    PERFORMED BY G600-SCROLL-BACKWARD.                              CL**1
02838 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02839 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02840 ******************************************************************   CL**1
02841 *                                                                    CL**1
02842  Z100-READ-TEMP-STORAGE.                                             CL**1
02843 *                                                                    CL**1
02844      EXEC CICS                                                       CL**1
02845          READQ TS                                                    CL**1
02846          QUEUE(MB127-TEMP-QUEUE-NAME)                                CL**1
02847          INTO(MB127-BLOCK-ENTRIES(MB127-BLK-SUB))                    CL**1
02848          LENGTH(PC-BLOCK-LENGTH)                                     CL**1
02849          ITEM(PV-BLOCK-NUMBER)                                       CL**1
02850          RESP(PV-RESP)                                               CL**1
02851      END-EXEC.                                                       CL**1
02852 *                                                                    CL**1
02853      IF PV-RESP NOT = DFHRESP(NORMAL)                                CL**1
02854          MOVE PV-RESP          TO  PM-RESP-24                        CL**1
02855          EXEC CICS                                                   CL**1
02856               DELETEQ TS                                             CL**1
02857               QUEUE(MB127-TEMP-QUEUE-NAME)                           CL**1
02858               RESP(PV-RESP)                                          CL**1
02859          END-EXEC                                                    CL**1
02860          SET DP013-LOGIC-ABEND TO  TRUE                              CL**1
02861          SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
02862          MOVE 'Z100-READ-TEMP-STORAGE'                               CL**1
02863                                TO  DP013-PARAGRAPH                   CL**1
02864          MOVE PM-PROGRAM-MESSAGE-24                                  CL**1
02865                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02866          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02867      END-IF.                                                         CL**1
02868                                                                      CL**1
02869      SET MB127-BLOCK-NOT-MODIFIED(MB127-BLK-SUB) TO TRUE.            CL**1
02870  EJECT                                                               CL**1
02871 ******************************************************************   CL**1
02872 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.          CL**1
02873 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.        CL**1
02874 *                                                                    CL**1
02875 *    PERFORMED BY E300-NAVIGATE.                                     CL**1
02876 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
02877 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
02878 *    PERFORMED BY G500-SCROLL-FORWARD.                               CL**1
02879 *    PERFORMED BY G600-SCROLL-BACKWARD.                              CL**1
02880 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02881 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02882 *    PERFORMED BY H100-READ-ITEMS-FROM-DB.                           CL**1
02883 ******************************************************************   CL**1
02884 *                                                                    CL**1
02885  Z150-WRITE-TEMP-STORAGE.                                            CL**1
02886 *                                                                    CL**1
02887      IF MB127-HIGHEST-BLOCK-WRITTEN = +0                             CL**1
02888          MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER             CL**1
02889          MOVE EIBTASKN         TO  MB127-TASK-NUMBER                 CL**1
02890          MOVE EIBTRMID         TO  MB127-TERM-ID                     CL**1
02891      END-IF.                                                         CL**1
02892 *                                                                    CL**1
02893      MOVE MB127-LIST-ITEM-NUMBER(MB127-BLK-SUB 1)                    CL**1
02894                                TO  PV-LIST-ITEM-NUMBER.              CL**1
02895      COMPUTE PV-BLOCK-NUMBER =                                       CL**1
02896          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).       CL**1
02897 *                                                                    CL**1
02898      IF (PV-BLOCK-NUMBER < MB127-HIGHEST-BLOCK-WRITTEN)              CL**1
02899      OR (PV-BLOCK-NUMBER = MB127-HIGHEST-BLOCK-WRITTEN)              CL**1
02900          IF  MB127-BLOCK-MODIFIED(MB127-BLK-SUB)                     CL**1
02901              EXEC CICS                                               CL**1
02902                  WRITEQ TS                                           CL**1
02903                  QUEUE(MB127-TEMP-QUEUE-NAME)                        CL**1
02904                  FROM(MB127-BLOCK-ENTRIES(MB127-BLK-SUB))            CL**1
02905                  LENGTH(PC-BLOCK-LENGTH)                             CL**1
02906                  ITEM(PV-BLOCK-NUMBER)                               CL**1
02907                  REWRITE                                             CL**1
02908                  RESP(PV-RESP)                                       CL**1
02909              END-EXEC                                                CL**1
02910 *                                                                    CL**1
02911              IF  PV-RESP NOT = DFHRESP(NORMAL)                       CL**1
02912                  MOVE PV-RESP  TO  PM-RESP-9                         CL**1
02913                  EXEC CICS                                           CL**1
02914                      DELETEQ TS                                      CL**1
02915                      QUEUE(MB127-TEMP-QUEUE-NAME)                    CL**1
02916                      RESP(PV-RESP)                                   CL**1
02917                  END-EXEC                                            CL**1
02918 *                                                                    CL**1
02919                  SET DP013-LOGIC-ABEND                               CL**1
02920                                TO  TRUE                              CL**1
02921                  SET DP013-NO-ROLLBACK                               CL**1
02922                                TO  TRUE                              CL**1
02923                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**1
02924                                TO  DP013-PARAGRAPH                   CL**1
02925                  MOVE PM-PROGRAM-MESSAGE-9                           CL**1
02926                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02927                  PERFORM DP013-0000-PROCESS-ABEND                    CL**1
02928              END-IF                                                  CL**1
02929          END-IF                                                      CL**1
02930      ELSE                                                            CL**1
02931 *                                                                    CL**1
02932          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                          CL**1
02933              MB127-HIGHEST-BLOCK-WRITTEN + 1                         CL**1
02934          IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN              CL**1
02935              EXEC CICS                                               CL**1
02936                  WRITEQ TS                                           CL**1
02937                  QUEUE(MB127-TEMP-QUEUE-NAME)                        CL**1
02938                  FROM(MB127-BLOCK-ENTRIES(MB127-BLK-SUB))            CL**1
02939                  LENGTH(PC-BLOCK-LENGTH)                             CL**1
02940                  ITEM(PV-BLOCK-NUMBER)                               CL**1
02941                  RESP(PV-RESP)                                       CL**1
02942              END-EXEC                                                CL**1
02943 *                                                                    CL**1
02944              IF  PV-RESP NOT = DFHRESP(NORMAL)                       CL**1
02945                  MOVE PV-RESP  TO  PM-RESP-10                        CL**1
02946                  EXEC CICS                                           CL**1
02947                      DELETEQ TS                                      CL**1
02948                      QUEUE(MB127-TEMP-QUEUE-NAME)                    CL**1
02949                      RESP(PV-RESP)                                   CL**1
02950                  END-EXEC                                            CL**1
02951 *                                                                    CL**1
02952                  SET DP013-LOGIC-ABEND                               CL**1
02953                                TO  TRUE                              CL**1
02954                  SET DP013-NO-ROLLBACK                               CL**1
02955                                TO  TRUE                              CL**1
02956                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**1
02957                                TO  DP013-PARAGRAPH                   CL**1
02958                  MOVE PM-PROGRAM-MESSAGE-10                          CL**1
02959                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02960                  PERFORM DP013-0000-PROCESS-ABEND                    CL**1
02961              END-IF                                                  CL**1
02962              ADD +1            TO  MB127-HIGHEST-BLOCK-WRITTEN       CL**1
02963          ELSE                                                        CL**1
02964              SET DP013-LOGIC-ABEND                                   CL**1
02965                                TO  TRUE                              CL**1
02966              SET DP013-NO-ROLLBACK                                   CL**1
02967                                TO  TRUE                              CL**1
02968              MOVE 'Z150-WRITE-TEMP-STORAGE'                          CL**1
02969                                TO  DP013-PARAGRAPH                   CL**1
02970              MOVE PV-BLOCK-NUMBER                                    CL**1
02971                                TO  PM-BLOCK-NUMBER                   CL**1
02972              MOVE PM-PROGRAM-MESSAGE-11                              CL**1
02973                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02974              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
02975          END-IF                                                      CL**1
02976      END-IF.                                                         CL**1
02977                                                                      CL**1
02978      SET MB127-BLOCK-NOT-MODIFIED(MB127-BLK-SUB) TO TRUE.            CL**1
02979 *                                                                    CL**1
02980  EJECT                                                               CL**1
02981 ******************************************************************   CL**1
02982 *    FILL IN SCREEN HEADER MODULE                                    CL**1
02983 ******************************************************************   CL**1
02984                                                                      CL**1
02985      COPY DPPD002.                                                   CL**1
02986  EJECT                                                               CL**1
02987 ******************************************************************   CL**1
02988 *    RETURN TO CICS MODULE                                           CL**1
02989 ******************************************************************   CL**1
02990                                                                      CL**1
02991      COPY DPPD003.                                                   CL**1
02992  EJECT                                                               CL**1
02993 ******************************************************************   CL**1
02994 *    FORMAT MESSAGE LINES MODULE                                     CL**1
02995 ******************************************************************   CL**1
02996                                                                      CL**1
02997      COPY DPPD005.                                                   CL**1
02998  EJECT                                                               CL**1
02999 ******************************************************************   CL**1
03000 *    GET PANEL MODULE                                                CL**1
03001 ******************************************************************   CL**1
03002                                                                      CL**1
03003      COPY DPPD007.                                                   CL**1
03004  EJECT                                                               CL**1
03005 ******************************************************************   CL**1
03006 *    WRITE PANEL MODULE                                              CL**1
03007 ******************************************************************   CL**1
03008                                                                      CL**1
03009      COPY DPPD008.                                                   CL**1
03010  EJECT                                                               CL**1
03011 ******************************************************************   CL**1
03012 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**1
03013 ******************************************************************   CL**1
03014                                                                      CL**1
03015      COPY DPPD009.                                                   CL**1
03016  EJECT                                                               CL**1
03017 ******************************************************************   CL**1
03018 *    ABEND PROCESSOR MODULE                                          CL**1
03019 ******************************************************************   CL**1
03020                                                                      CL**1
03021      COPY DPPD013.                                                   CL**1
03022  EJECT                                                               CL**1
03023 ******************************************************************   CL**1
03024 *    CHECK COMMUNICATION AREA MODULE                                 CL**1
03025 ******************************************************************   CL**1
03026                                                                      CL**1
03027      COPY DPPD015.                                                   CL**1
03028  EJECT                                                               CL**1
03029 ******************************************************************   CL**1
03030 *    UPDATE TIME AND DATE MODULE                                     CL**1
03031 ******************************************************************   CL**1
03032                                                                      CL**1
03033      COPY DPPD017.                                                   CL**1
03034  EJECT                                                               CL**1
