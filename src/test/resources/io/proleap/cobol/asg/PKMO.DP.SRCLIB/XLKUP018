000100 TITLE 'DETERMINE SOURCE OF CHANGE PO'.                                   
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    XLKUP018.                                                 
000400 AUTHOR.        LYNN MCADAMS.                                             
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  APRIL 2003.                                               
000700 DATE-COMPILED.                                                           
000800*                                                                         
000900*                                                                         
001000*                                                                         
001100******************************************************************        
001200* CALLED MODULE                                                           
001300******************************************************************        
001400* THIS PROGRAM WILL:                                                      
001400* 1.  CHECK THE POT_RMS_RLOUT_CTL TO DETERMINE IF                         
001500* A PARTICULAR DEPARTMENT SWITCHED TO RMS PROCESSING.                     
      * NUMBER 1 ABOVE OBSOLETED JANUARY 2004                                   
      *                                                                         
      * 2.  CHECK TO SEE IF AN ODD UNIT SKU MESSAGE IS COMING THROUGH           
      * IF THE DEPARTMENT IS NOT SWITCHED TO RMS PROCESSING ALL                 
      * MESSAGES FOR THE PO WILL BE NOT BY APPLIED TO LEGACY                    
      * IF THE MESSAGE COMING THROUGH IS AN ODD UNIT SKU, THIS                  
      * MMESSAGE WILL NOT BY APPLIED TO LEGACY                                  
001800*                                                                         
001900* THIS PROGRAM IS CALLED BY XLKUT023 BEFORE ANY OTHER LOGIC               
002000* CHECKS ARE DONE. THE XLKUT023 WILL PASS THE DEPT_NBR USING              
002100* XLRD011 (XL011-HA-DEPT).                                                
002200******************************************************************        
002300*                                                                         
002400*                                                                         
002500 ENVIRONMENT DIVISION.                                                    
002600 CONFIGURATION SECTION.                                                   
002700 SOURCE-COMPUTER.  IBM-3090.                                              
002800 OBJECT-COMPUTER.  IBM-3090.                                              
002900 DATA DIVISION.                                                           
003000                                                                          
003100 WORKING-STORAGE SECTION.                                                 
003200                                                                          
003300 01  PS-PROGRAM-SWITCHES.                                                 
003400     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.               
003500         88  PS-ERROR                            VALUE 'Y'.               
003600         88  PS-NO-ERROR                         VALUE 'N'.               
003700                                                                          
003800 01  PV-PROGRAM-VARIABLES.                                                
003900     05  PV-CURRENT-DATE              PIC X(10)  VALUE SPACE.             
004000     05  PV-DISP-NBR                  PIC 9(05)  VALUE ZERO.              
004100                                                                          
004200 01  DK-DB-KEYS.                                                          
004300     05  DK-PO-NBR                      PIC  S9(9) COMP.                  
004400     05  DK-DEPT-NBR                    PIC  S9(4)V COMP-3.               
004500                                                                          
004600                                                                          
004700*PO-PURCHASE TABLE                                                        
004800     EXEC SQL                                                             
004900         INCLUDE TPURCHS                                                  
005000     END-EXEC.                                                            
005100                                                                          
005200                                                                          
005300*PO - RMS ROLLOUT CONTROL TABLE                                           
005400*POT_RMS_RLOUT_CTL                                                        
005500*    EXEC SQL                                                             
005600*        INCLUDE POT00006                                                 
005700*    END-EXEC.                                                            
005800                                                                          
005900     EXEC SQL                                                             
006000          INCLUDE SQLCA                                                   
006100     END-EXEC.                                                            
006200                                                                          
006300     COPY SQLCA2.                                                         
006400                                                                          
006500                                                                          
006600 LINKAGE SECTION.                                                         
006700 01  XLRD011-RECORD.                                                      
006800     COPY XLRD011.                                                        
006900/                                                                         
007000 PROCEDURE DIVISION USING XLRD011-RECORD.                                 
007100                                                                          
007200     PERFORM 1000-INITIALIZATION.                                         
007300                                                                          
007400     PERFORM 2000-PROCESSING.                                             
007500                                                                          
007600     PERFORM 9999-WRAPUP.                                                 
007700                                                                          
007800     GOBACK.                                                              
007900                                                                          
008000                                                                          
008100*****************************************************************         
008200 1000-INITIALIZATION.                                                     
008300*****************************************************************         
008400                                                                          
008500     INITIALIZE XL011-RETURN-AREA                                         
008600                                                                          
008700     INITIALIZE XL011-PROCESS-MSGS-SW                                     
008800                                                                          
008900     MOVE 'XLKUP018'                  TO XL011-ERROR-PROGRAM              
009000                                                                          
009100     INITIALIZE PS-ERROR-SW                                               
009200                                                                          
009300     INITIALIZE DK-PO-NBR                                                 
009400     MOVE XL011-ORDER-NBR TO DK-PO-NBR.                                   
009500                                                                          
009600     IF XL011-DEBUG-YES                                                   
009700         DISPLAY 'XLKUP018 - 1000-INITIALIZATION'                         
009800     END-IF                                                               
009900                                                                          
010000     EXEC SQL                                                             
010100         SET :PV-CURRENT-DATE = CURRENT DATE                              
010200     END-EXEC.                                                            
010300/                                                                         
010400*****************************************************************         
010500 2000-PROCESSING.                                                         
010600*****************************************************************         
010700                                                                          
010800         EVALUATE TRUE                                                    
010900           WHEN XL011-MSG-ID = 'HDR_ADD'                                  
011000*             INITIALIZE DK-DEPT-NBR                                      
011100*             MOVE XL011-HA-DEPT   TO DK-DEPT-NBR                         
011200*             PERFORM 2200-SELECT-POT-RMS-RLOUT-CTL                       
018600              SET XL011-PROCESS-MESSAGES  TO TRUE                         
018700              SET XL011-SUCCESSFUL        TO TRUE                         
011300           WHEN OTHER                                                     
011400              PERFORM 2100-SELECT-TPURCHS                                 
011500                                                                          
011600              IF PS-NO-ERROR                                              
011700*                MOVE PURCHS-DEPT-NBR TO DK-DEPT-NBR                      
011800*                PERFORM 2200-SELECT-POT-RMS-RLOUT-CTL                    
018600                 SET XL011-PROCESS-MESSAGES  TO TRUE                      
018700                 SET XL011-SUCCESSFUL        TO TRUE                      
011900*                IF XL011-PROCESS-MESSAGES                                
012000                     PERFORM 2300-ODD-UNIT-SKU-CHK                        
012100*                END-IF                                                   
012200              ELSE                                                        
012300                 CONTINUE                                                 
012400              END-IF                                                      
012500         END-EVALUATE.                                                    
012600/                                                                         
012700                                                                          
012800*GET DEPT FROM TPURCHS                                                    
012900*****************************************************************         
013000 2100-SELECT-TPURCHS.                                                     
013100*****************************************************************         
013200      EXEC SQL                                                            
013300         SELECT  DEPT_NBR                                                 
013400                ,PKGNG_CDE                                                
013500           INTO  :PURCHS-DEPT-NBR                                         
013600                ,:PURCHS-PKGNG-CDE                                        
013700           FROM  TPURCHS                                                  
013800          WHERE  PO_NBR              = :DK-PO-NBR                         
013900           AND  VER_STATUS_CDE       = 'A'                                
014000*                                                                         
014100      WITH UR                                                             
014200      END-EXEC.                                                           
014300                                                                          
014400      MOVE SQLCODE                     TO XL011-SQLCODE.                  
014500      EVALUATE TRUE                                                       
014600          WHEN SQLCODE = ZERO                                             
014700          WHEN SQLCODE = -811                                             
014800              SET PS-NO-ERROR          TO TRUE                            
014900              SET XL011-SUCCESSFUL     TO TRUE                            
015000          WHEN OTHER                                                      
015100              SET PS-ERROR             TO TRUE                            
015200              SET XL011-SQL-ERROR      TO TRUE                            
015300              MOVE '2100-SELECT-TPURCHS'                                  
015400                    TO XL011-ERROR-PARAGRAPH                              
015500              MOVE 'TPURCHS ' TO XL011-DB2-TABLE-NAME(1)                  
015600              MOVE 'NOT FOUND ON TPURCHS '                                
015700                              TO XL011-ERROR-TEXT                         
015800              MOVE 'XLKUP018' TO XL011-ERROR-PROGRAM                      
015900      END-EVALUATE.                                                       
016000/                                                                         
016100                                                                          
016200*CHECK TO SEE IF PO CREATED IN LEGACY OR RMS PO                           
016300*****************************************************************         
016400*2200-SELECT-POT-RMS-RLOUT-CTL.                                           
016500*****************************************************************         
016600*     EXEC SQL                                                            
016700*        SELECT  DEPT_NBR                                                 
016800*              , ACTV_PO_TO_RMS_DTE                                       
016900*              , HIST_PO_TO_RMS_DTE                                       
017000*              , HIST_STRT_DTE                                            
017100*              , PO_ENTR_IN_RMS_DTE                                       
017200*          INTO  :POT00006-DEPT-NBR                                       
017300*              , :POT00006-ACTV-PO-TO-RMS-DTE                             
017400*              , :POT00006-HIST-PO-TO-RMS-DTE                             
017500*              , :POT00006-HIST-STRT-DTE                                  
017600*              , :POT00006-PO-ENTR-IN-RMS-DTE                             
017700*          FROM  POT_RMS_RLOUT_CTL                                        
017800*         WHERE  DEPT_NBR            = :DK-DEPT-NBR                       
017900*           AND  PO_ENTR_IN_RMS_DTE <= :PV-CURRENT-DATE                   
018000*     WITH UR                                                             
018100*     END-EXEC.                                                           
018200                                                                          
018300*     MOVE SQLCODE                     TO XL011-SQLCODE.                  
018400*     EVALUATE TRUE                                                       
018500*         WHEN SQLCODE = ZERO                                             
018600*             SET XL011-PROCESS-MESSAGES  TO TRUE                         
018700*             SET XL011-SUCCESSFUL        TO TRUE                         
018800* * * +100 INDICATES THE PO FROM RMS IS NOT TO BE PROCESSED               
018900*         WHEN SQLCODE = +100                                             
019000*             SET XL011-NOT-PROCESS       TO TRUE                         
019100*             SET XL011-SUCCESSFUL        TO TRUE                         
019200*         WHEN OTHER                                                      
019300*             SET PS-ERROR             TO TRUE                            
019400*             SET XL011-SQL-ERROR      TO TRUE                            
019500*             MOVE '2200-SELECT-POT-RMS-RLOUT-CTL'                        
019600*                   TO XL011-ERROR-PARAGRAPH                              
019700*             MOVE 'POT_RMS_RLOUT-CTL'                                    
019800*                   TO XL011-DB2-TABLE-NAME(1)                            
019900*             MOVE 'INVALID SELECT ON POT_RMS_RLOUT_CTL'                  
020000*                             TO XL011-ERROR-TEXT                         
020100*             MOVE 'XLKUP018' TO XL011-ERROR-PROGRAM                      
020200*     END-EVALUATE.                                                       
020300                                                                          
020400*    IF XL011-DEBUG-YES                                                   
020500*        DISPLAY 'XLKUP018 - 2200-SELECT-POT-RMS-RLOUT-CTL'               
020600*        MOVE DK-DEPT-NBR TO PV-DISP-NBR                                  
020700*        DISPLAY 'XLKUP018 - XL011-PROCESS-MSGS-SW = '                    
020800*                            XL011-PROCESS-MSGS-SW                        
020900*         ' DEPT_NBR = '  PV-DISP-NBR                                     
021000*    END-IF.                                                              
021100/                                                                         
021200 2300-ODD-UNIT-SKU-CHK.                                                   
021300* * * LOOK FOR A PREPACK ORDER WITH NON-PREPACK MESSAGES                  
021400* * * THE NON-PREPACK MESSAGES ARE FROM ODD UNITS SKU'S                   
021500     IF PURCHS-PKGNG-CDE = 'M' OR 'I'                                     
021600         EVALUATE TRUE                                                    
021700           WHEN XL011-MSG-ID = 'ORD_SKU_ADD'                              
021800                            AND XL011-SA-PACK-SKU-IND = 'N'               
021900               SET XL011-ODD-UNIT-SKU TO TRUE                             
022000*          WHEN XL011-MSG-ID = 'ORD_SKU_ATTR_CHANGE'                      
022100*                           AND XL011-SAC-PK-SKU-IND = 'N'                
022200*              SET XL011-ODD-UNIT-SKU TO TRUE                             
022300           WHEN XL011-MSG-ID = 'ORD_QTY_CHANGE'                           
022400                            AND XL011-SKQC-PK-SKU-IND = 'N'               
022500               SET XL011-ODD-UNIT-SKU TO TRUE                             
022600           WHEN XL011-MSG-ID = 'ORD_SKU_DELETE'                           
022700                            AND XL011-SD-PK-SKU-IND = 'N'                 
022800               SET XL011-ODD-UNIT-SKU TO TRUE                             
023200           WHEN XL011-MSG-ID = 'ORD_LOCATION_ADD'                         
                                  AND XL011-LA-PK-SKU-IND = 'N'                 
023300               SET XL011-ODD-UNIT-SKU TO TRUE                             
023400           WHEN XL011-MSG-ID = 'ORD_LOC_QTY_CHANGE'                       
023500                            AND XL011-LQC-PK-SKU-IND = 'N'                
023600               SET XL011-ODD-UNIT-SKU TO TRUE                             
023700           WHEN XL011-MSG-ID = 'ORD_LOC_ATT_CHANGE'                       
023800                            AND XL011-LAC-PK-SKU-IND = 'N'                
023900               SET XL011-ODD-UNIT-SKU TO TRUE                             
024000           WHEN XL011-MSG-ID = 'ORD_LOCATION_DELETE'                      
024100                            AND XL011-LD-PK-SKU-IND = 'N'                 
024200               SET XL011-ODD-UNIT-SKU TO TRUE                             
024300           WHEN XL011-MSG-ID = 'STORE_ADD'                                
024400                            AND XL011-STRA-PK-SKU-IND = 'N'               
024500               SET XL011-ODD-UNIT-SKU TO TRUE                             
024600           WHEN XL011-MSG-ID = 'STORE_QTY_CHANGE'                         
024700                            AND XL011-STQC-PK-SKU-IND = 'N'               
024800               SET XL011-ODD-UNIT-SKU TO TRUE                             
024900           WHEN XL011-MSG-ID = 'STORE_ATTR_CHANGE'                        
025000                            AND XL011-STAC-PK-SKU-IND = 'N'               
025100               SET XL011-ODD-UNIT-SKU TO TRUE                             
025200           WHEN XL011-MSG-ID = 'STORE_DELETE'                             
025300                            AND XL011-STD-PK-SKU-IND = 'N'                
025400               SET XL011-ODD-UNIT-SKU TO TRUE                             
025500         END-EVALUATE                                                     
025600     END-IF.                                                              
025700/                                                                         
025800*****************************************************************         
025900 9999-WRAPUP.                                                             
026000*****************************************************************         
026100                                                                          
026200     MOVE SQLCA                       TO XL011-SQLCA.                     
026300                                                                          
026400******************************************************************        
