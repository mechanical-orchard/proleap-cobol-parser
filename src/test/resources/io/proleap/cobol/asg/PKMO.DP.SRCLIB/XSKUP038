000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030000
000400 PROGRAM-ID.    XSKUP038.                                         00040000
000500 AUTHOR.        ALEXIS KEIKER.                                    00050000
000600 DATE-WRITTEN.  OCTOBER 1, 2002.                                  00060000
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900*        PRICING STORE GROUP BUSINESS EVENT LOADER                00090000
001000*----------------------------------------------------------       00100000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00110000
001020* LOAD FOR THE PRICING STORE GROUP BUSINESS EVENT.  THIS PROGRAM  00120000
001030* IS A MODULE AND WILL BE CALLED BY ANOTHER PROGRAM(XSKUT034).    00130000
001040* THERE ARE 5 PARAMETERS PASSED IN THIS PROGRAM.  ONE WILL        00140000
001050* BE THE ACTUAL PRICING STORE GROUP BUSINESS RECORD, MAXIMUM      00150000
001060* FUTURE OFFSET DATE IN CCYYMMDD, A LOAD SQL RETURN CODE FIELD,   00160000
001070* A PROGRAM STATUS CODE, AND A LOAD SEVERITY LEVEL.  THIS         00170000
001080* PROGRAM WILL EITHER UPDATE OR INSERT A RECORD TO THE            00180000
001090* XST_PROMO_STR_GP (PROMO STORE GROUP TABLE) OR THE               00190000
001091* XST_PROMO_ADHC_RLT (PROMO ADHOC GROUP TABLE).  IT FIGURES       00200000
001092* OUT WHICH TABLE TO LOAD DEPENDING ON THE STORE SELECTION        00210000
001093* TYPE CODE.  IF THE CODE IS A 'A' IT WILL UPDATE OR INSERT TO    00220000
001094* THE XST_PROMO_ADHC_RLT TABLE.  IF THE CODE IS A 'P' IT WILL     00230000
001095* INSERT OR UPDATE TO THE XST_PROMO_STR_GP TABLE.                 00240000
001096* THIS PROGRAM WILL ALWAYS SEND BACK A LOAD SQL RETURN CODE,      00250000
001097* A PROGRAM STATUS CODE, AND A LOAD SEVERITY CODE.  IF THIS       00260000
001098* PROGRAM DOES NOT UPDATE OR INSERT THE RECORD CORRECTLY IT       00270000
001099* WILL SELECT THE CORRECT ERROR CODES, FIND THE LOAD SEVERITY     00280000
001100* LEVEL, AND EXIT OUT OF THE PROGRAM.                             00290000
001102*                                                                 00300000
001103*          SQL CODES - LOAD SQL RETURN CODE                       00310000
001104*             - THIS IS THE LAST SQL RETURN CODE RECEIVED         00320000
001105*               FROM A DATABASE ACTION.                           00330000
001106*                                                                 00340000
001107*          PROGRAM CODES - PROGRAM STATUS CODE                    00350000
001108*           - 00 - ALL DATABASE ACTION WAS SUCCESSFUL AND         00360000
001109*                  WORKED ACCORDING TO THE MESSAGE TYPE.          00370000
001110*           - 01 - AN 'ADD' RECORD WAS TURNED INTO AN             00380000
001111*                  UPDATE AND THE BUSINESS EVENT WAS FOUND        00390000
001112*                  TO BE THE ONE NEEDED ON THE DATABASE.          00400000
001113*           - 02 - AN 'ADD' RECORD WAS TURNED INTO AN UPDATE      00410000
001114*                  AND THE BUSINESS EVENT WAS FOUND TO BE         00420000
001115*                  THE ONE NOT NEEDED ON THE DATABASE.            00430000
001116*           - 03 - AN 'UPDATE' RECORD WAS TURNED INTO AN ADD.     00440000
001117*           - 04 - AN 'UPDATE' RECORD WAS BYPASSED BECAUSE THE    00450000
001118*                  RECORD CURRENTLY ON THE DATABASE WAS THE       00460000
001119*                  MOST RECENT DATA.                              00470000
001123*           - 05 - THE DATABASE ACTION WAS NOT SUCCESSFUL DUE     00480000
001124*                  TO THE RETURNED SQL CODE.                      00490000
001125*           - 06 - UNEXPECTED ACTION CODE RECEIVED.               00500000
001126*                                                                 00510000
001127*          ERROR CODES - LOAD SEVERITY LEVEL                      00520000
001128*            THIS CODE IS FOUND BY TAKING THE MAXIMUM OFFSET      00530000
001129*            DATE AND COMPARING IT TO THE STORE GROUP START       00540000
001130*            DATE.  IF THE MAXIMUM OFFSET DATE IS LESS THAN       00550000
001131*            THE STORE GROUP START DATE THE LOAD IS NOT CRITICAL, 00560000
001132*            OTHERWISE IT IS CRITICAL TO THE SYSTEM.              00570000
001133*           - 00 - THE LOAD OF THE DATA WAS SUCCESSFUL AND        00580000
001134*                  THEREFORE THE SEVERITY OF THE LOAD DID         00590000
001135*                  NOT NEED TO BE DETERMINED.                     00600000
001136*           - 01 - THE LOAD IS CRITICAL TO A SYSTEM AND           00610000
001137*                  THEREFORE MUST BE RESOLVED ASAP.               00620000
001138*           - 02 - THE LOAD IS NOT CRITICAL AND THEREFORE CAN     00630000
001139*                  WAIT UNTIL A LATER TIME TO BE RESOLVED.        00640000
001140*                                                                 00650000
001141*----------------------------------------------------------       00660000
001142* HISTORY LOG:                                                    00670000
001143*                                                                 00680000
001144*----------------------------------------------------------       00690000
C52736* DATE: 04/29/2013                                                00700001
C52736* WR/IR#: CHG0052736                                              00710001
C52736* PROGRAMMER: JOHN SELWITSCHKA                                    00720001
C52736* DESCRIPTION: MQPROMO PERFORMANCE IMPROVEMENT.                   00730001
001149*                                                                 00740000
001150*----------------------------------------------------------       00750000
001151 ENVIRONMENT DIVISION.                                            00760000
001152*----------------------------------------------------------       00770000
001153 CONFIGURATION SECTION.                                           00780000
001154 SOURCE-COMPUTER. IBM-3090.                                       00790000
001155 OBJECT-COMPUTER. IBM-3090.                                       00800000
001156                                                                  00810000
001157 INPUT-OUTPUT SECTION.                                            00820000
001160                                                                  00830000
001170 FILE-CONTROL.                                                    00840000
001180                                                                  00850000
001190*----------------------------------------------------------       00860000
001200 DATA DIVISION.                                                   00870000
001300*----------------------------------------------------------       00880000
001400 FILE SECTION.                                                    00890000
001500                                                                  00900000
001600                                                                  00910000
001700*---------------------------------------------------------        00920000
001800                                                                  00930000
001900 WORKING-STORAGE SECTION.                                         00940000
002000*---------------------------------------------------------        00950000
002100* PC- PROGRAM CONSTANTS                                           00960000
002200*----------------------------------------------------------       00970000
002300 01  PC-PROGRAM-CONSTANTS.                                        00980000
002400     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUP038'. 00990000
002500     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   01000000
002600                                                                  01010000
002700*----------------------------------------------------------       01020000
002800* PS- PROGRAM SWITCHES                                            01030000
002900*----------------------------------------------------------       01040000
003000 01  PS-PROGRAM-SWITCHES.                                         01050000
003100     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       01060000
003200         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       01070000
003300         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       01080000
003400                                                                  01090000
003500*----------------------------------------------------------       01100000
003600* PV- PROGRAM VARIABLES                                           01110000
003700*----------------------------------------------------------       01120000
003800 01 PV-PROGRAM-VARIABLES.                                         01130000
003900    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   01140000
003910    05  PV-SQL-CODE                   PIC S9(4)  VALUE +0.        01150000
004000    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         01160000
004100    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    01170000
004230    05  PV-STR-SELN-TYP-CDE           PIC X(01).                  01180000
004240        88  PV-ADHOC-CDE                         VALUE 'A'.       01190000
004250        88  PV-PRC-ZONE-CDE                      VALUE 'P'.       01200000
004300    05  PV-ACTION-CODE                PIC X(01).                  01210000
004400        88  PV-INSERT-DATA                       VALUE 'I'.       01220000
004500        88  PV-UPDATE-DATA                       VALUE 'U'.       01230000
004600    05  PV-LD-STATUS-CDE              PIC X(02).                  01240000
004700        88  PV-NO-ERROR                          VALUE '00'.      01250000
004800        88  PV-CRITICAL-ERROR                    VALUE '01'.      01260000
004900        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      01270000
005000    05  PV-PGM-STATUS-CDE             PIC X(02).                  01280000
005100        88  PV-SUCCESS-CDE                       VALUE '00'.      01290000
005200        88  PV-UPDATE-NEED                       VALUE '01'.      01300000
005300        88  PV-UPDATE-NOT-NEED                   VALUE '02'.      01310000
005400        88  PV-ADD-CDE                           VALUE '03'.      01320000
005410        88  PV-UPDATE-BYPASS                     VALUE '04'.      01330000
005500        88  PV-NO-SUCCESS-CDE                    VALUE '05'.      01340000
005600        88  PV-UNEXPECT-CDE                      VALUE '06'.      01350000
005700                                                                  01360000
005710    05  PV-NULLS-INDICATORS.                                      01370000
005720        10  PV-PRIC-VER-IND           PIC S9(4) COMP VALUE +0.    01380000
005721        10  PV-PRNT-GP-TYP-IND        PIC S9(4) COMP VALUE +0.    01390000
005730        10  PV-PRNT-STR-GP-IND        PIC S9(4) COMP VALUE +0.    01400000
005750        10  PV-PRNT-STR-GP-ID-IND     PIC S9(4) COMP VALUE +0.    01410000
005760        10  PV-PRNT-ADHC-GP-IND       PIC S9(4) COMP VALUE +0.    01420000
005780                                                                  01430000
005800    05  PV-PRC-STR-STRT-DTE-NBR.                                  01440000
005900        10  PV-PRC-STR-DTE-CCYY       PIC 9(04).                  01450000
006000        10  PV-PRC-STR-DTE-MM         PIC 9(02).                  01460000
006100        10  PV-PRC-STR-DTE-DD         PIC 9(02).                  01470000
006200                                                                  01480000
006300    05  PV-PRC-STR-STRT-DTE-TM.                                   01490000
006400        10  PV-PRC-STR-STRT-DTE.                                  01500000
006500            15  PV-PRC-STR-DTE-TM-CCYY    PIC X(04).              01510000
006600            15  FILLER                    PIC X(01).              01520000
006700            15  PV-PRC-STR-DTE-TM-MM      PIC X(02).              01530000
006800            15  FILLER                    PIC X(01).              01540000
006900            15  PV-PRC-STR-DTE-TM-DD      PIC X(02).              01550000
007000        10  PV-PRC-STR-STRT-TM            PIC X(16).              01560000
008000                                                                  01570000
008100*----------------------------------------------------------       01580000
008200*  PRICING STORE GROUP BUSINESS EVENT RECORD LAYOUT               01590000
008300*----------------------------------------------------------       01600000
008400     COPY XSRD022.                                                01610000
008500                                                                  01620000
009100*----------------------------------------------------------       01630000
009200* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01640000
009300*----------------------------------------------------------       01650000
009400     COPY DPWS004.                                                01660000
009500                                                                  01670000
009600*---------------------------------------------                    01680000
009700*  DB2 COMMUNICATION AREA.                                        01690000
009800*---------------------------------------------                    01700000
009900     EXEC SQL                                                     01710000
010000          INCLUDE SQLCA                                           01720000
010100     END-EXEC.                                                    01730000
010200                                                                  01740000
010300*---------------------------------------------                    01750000
010400*  DB2 TABLE XST00029(XST_PROMO_STR_GP) - PROMO STORE GROUP TABLE 01760000
010500*---------------------------------------------                    01770000
010600     EXEC SQL                                                     01780000
010700          INCLUDE XST00029                                        01790000
010800     END-EXEC.                                                    01800000
010900                                                                  01810000
010910*---------------------------------------------                    01820000
010920*  DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) - PROMO ADHOC TABLE     01830000
010930*---------------------------------------------                    01840000
010940     EXEC SQL                                                     01850000
010950          INCLUDE XST00031                                        01860000
010960     END-EXEC.                                                    01870000
010970                                                                  01880000
011000 LINKAGE SECTION.                                                 01890000
011100                                                                  01900000
011200*----------------------------------------------------------       01910000
011300* FILE INFORMATION BEING PASSED TO AND FROM THIS MODULE.          01920000
011400*----------------------------------------------------------       01930000
011500 01 LV-LINKAGE-VARIABLES.                                         01940000
011600    05  LV-PRC-STR-BUS-REC         PIC X(300).                    01950000
011700    05  LV-MAX-OFFSET-DTE          PIC X(08).                     01960000
011800    05  LV-LD-SQL-RETURN-CDE       PIC S9(4).                     01970000
011900    05  LV-PGM-STATUS-CDE          PIC X(02).                     01980000
012000    05  LV-LD-SEVERITY-LVL         PIC X(02).                     01990000
012100                                                                  02000000
012200                                                                  02010000
012300*----------------------------------------------------------       02020000
012400 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   02030000
012500*----------------------------------------------------------       02040000
012600 0000-MAINLINE.                                                   02050000
012700                                                                  02060000
012800     PERFORM 1000-INITIALIZATION.                                 02070000
012900                                                                  02080000
013000     PERFORM 2000-PROCESS-MESSAGE                                 02090000
013100             UNTIL PS-PROCESS-COMPLETE.                           02100000
013200                                                                  02110000
013300     PERFORM 9999-WRAPUP.                                         02120000
013400                                                                  02130000
013500     EXIT PROGRAM.                                                02140000
013600                                                                  02150000
013700*0000-EXIT.                                                       02160000
013800 EJECT.                                                           02170000
013900                                                                  02180000
014000*----------------------------------------------------------       02190000
014100* 1000-INITIALIZATION.                                            02200000
014200*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            02210000
014300*     UPDATE OR INSERT A RECORD.                                  02220000
014400*----------------------------------------------------------       02230000
014500 1000-INITIALIZATION.                                             02240000
014600                                                                  02250000
014700     INITIALIZE DCLXST00029.                                      02260000
014710     INITIALIZE DCLXST00031.                                      02270000
014711     INITIALIZE PV-SQL-CODE                                       02280000
014720                PV-NULLS-INDICATORS.                              02290000
014800     MOVE LV-PRC-STR-BUS-REC      TO XS022-PRICING-STR-GP-RECORD. 02300000
014900     MOVE XS022-ACTION-CDE        TO PV-ACTION-CODE.              02310000
015000     MOVE XS022-STRT-TMST         TO PV-PRC-STR-STRT-DTE-TM.      02320000
015230     MOVE XS022-STR-SELN-TYP-CDE  TO PV-STR-SELN-TYP-CDE.         02330000
015300     SET PV-NO-ERROR              TO TRUE.                        02340000
015400     SET PV-SUCCESS-CDE           TO TRUE.                        02350000
015500     SET PS-PROCESS-CONTINUE      TO TRUE.                        02360000
015600                                                                  02370000
015601     IF LV-MAX-OFFSET-DTE = SPACES                                02380000
015602        INITIALIZE PV-MAX-OFFSET-DTE                              02390000
015603     ELSE                                                         02400000
015604        MOVE LV-MAX-OFFSET-DTE    TO PV-MAX-OFFSET-DTE            02410000
015605     END-IF.                                                      02420000
015606                                                                  02430000
015610     EVALUATE TRUE                                                02440000
015620        WHEN PV-ADHOC-CDE                                         02450000
015631             PERFORM 1100-POPULATE-ADHOC-DCLGEN                   02460000
015640        WHEN PV-PRC-ZONE-CDE                                      02470000
015650             PERFORM 1200-POPULATE-STR-GP-DCLGEN                  02480000
015660        WHEN OTHER                                                02490000
015670             SET PS-PROCESS-COMPLETE TO TRUE                      02500000
015680             SET PV-UNEXPECT-CDE     TO TRUE                      02510000
015690             PERFORM 9000-LOAD-SEVERITY-ERROR                     02520000
015691     END-EVALUATE.                                                02530000
015692                                                                  02540000
016600*1000-EXIT.                                                       02550000
016700 EJECT.                                                           02560000
016800                                                                  02570000
016900*----------------------------------------------------------       02580000
017000* 1100-POPULATE-ADHOC-DCLGEN.                                     02590000
017100*     POPULATES THE ADHOC STORE GROUP TABLE VARIABLES.            02600000
017300*----------------------------------------------------------       02610000
017400 1100-POPULATE-ADHOC-DCLGEN.                                      02620000
017500                                                                  02630000
017600     MOVE XS022-PROMO-INTFC-ID  TO XST00031-PROMO-INTFC-ID.       02640000
017700     MOVE XS022-MDSE-LNE-ID     TO XST00031-MDSE-LNE-ID.          02650000
017900     MOVE XS022-ADHC-STR-GP-ID  TO XST00031-ADHC-STR-GP-ID.       02660000
017901     MOVE XS022-STR-SELN-HIER-LVL-CDE                             02670000
017902                                TO XST00031-STR-SELN-HIER-CDE.    02680000
017910     MOVE XS022-STRT-TMST       TO XST00031-PROMO-STRT-TMST.      02690000
017920     MOVE XS022-END-TMST        TO XST00031-PROMO-END-TMST.       02700000
018000     MOVE XS022-ACT-STRT-TMST   TO XST00031-ACTL-STRT-TMST.       02710000
018010     MOVE XS022-ACT-END-TMST    TO XST00031-ACTL-END-TMST.        02720000
018709     MOVE XS022-ESL-TOPR-TYP-CDE                                  02730000
018709                                TO XST00031-ESL-TOPR-TYP-CDE.     02740000
018100     MOVE XS022-STAT-CDE        TO XST00031-STAT-CDE.             02750000
018200     MOVE XS022-LAST-UPD-TMST   TO XST00031-SOR-LAST-UPD-TMST.    02760000
018202                                                                  02770000
018203     IF XS022-PROMO-PRIC-VER-ID = ZEROES                          02780000
018204        MOVE -1                 TO PV-PRIC-VER-IND                02790000
018205     ELSE                                                         02800000
018210        MOVE XS022-PROMO-PRIC-VER-ID                              02810000
018220                                TO XST00031-PROMO-PRIC-VER-ID     02820000
018230     END-IF.                                                      02830000
018300                                                                  02840000
018400*1100-EXIT.                                                       02850000
018500 EJECT.                                                           02860000
018600                                                                  02870000
018610*----------------------------------------------------------       02880000
018620* 1200-POPULATE-STR-GP-DCLGEN.                                    02890000
018630*     POPULATES THE STORE GROUP TABLE VARIABLES.                  02900000
018650*----------------------------------------------------------       02910000
018660 1200-POPULATE-STR-GP-DCLGEN.                                     02920000
018670                                                                  02930000
018680     MOVE XS022-PROMO-INTFC-ID  TO XST00029-PROMO-INTFC-ID.       02940000
018690     MOVE XS022-MDSE-LNE-ID     TO XST00029-MDSE-LNE-ID.          02950000
018693     MOVE XS022-STR-GP-TYP-CDE  TO XST00029-STR-GP-TYP-CDE.       02960000
018694     MOVE XS022-STR-GP-ID       TO XST00029-STR-GP-ID.            02970000
018695     MOVE XS022-STR-SELN-HIER-LVL-CDE                             02980000
018696                                TO XST00029-STR-SELN-HIER-CDE.    02990000
018705     MOVE XS022-STRT-TMST       TO XST00029-PROMO-STRT-TMST.      03000000
018706     MOVE XS022-END-TMST        TO XST00029-PROMO-END-TMST.       03010000
018707     MOVE XS022-ACT-STRT-TMST   TO XST00029-ACTL-STRT-TMST.       03020000
018708     MOVE XS022-ACT-END-TMST    TO XST00029-ACTL-END-TMST.        03030000
018709     MOVE XS022-ESL-TOPR-TYP-CDE                                  03040000
018709                                TO XST00029-ESL-TOPR-TYP-CDE.     03050000
018709     MOVE XS022-STAT-CDE        TO XST00029-STAT-CDE.             03060000
018710     MOVE XS022-LAST-UPD-TMST   TO XST00029-SOR-LAST-UPD-TMST.    03070000
018712                                                                  03080000
018713     IF XS022-PROMO-PRIC-VER-ID = ZEROES                          03090000
018714        MOVE -1                 TO PV-PRIC-VER-IND                03100000
018715     ELSE                                                         03110000
018716        MOVE XS022-PROMO-PRIC-VER-ID                              03120000
018717                                TO XST00029-PROMO-PRIC-VER-ID     03130000
018718     END-IF.                                                      03140000
018719                                                                  03150000
018720     IF XS022-PRNT-OV-STR-SELN-CDE = SPACES                       03160000
018721        MOVE -1                 TO PV-PRNT-GP-TYP-IND             03170000
018722     ELSE                                                         03180000
018723        MOVE XS022-PRNT-OV-STR-SELN-CDE                           03190000
018724                                TO XST00029-PRNT-GP-TYP-CDE       03200000
018725     END-IF.                                                      03210000
018726                                                                  03220000
018727     IF XS022-PRNT-OV-STR-GP-CDE = ZEROES                         03230000
018728        MOVE -1                 TO PV-PRNT-STR-GP-IND             03240000
018729     ELSE                                                         03250000
018730        MOVE XS022-PRNT-OV-STR-GP-CDE                             03260000
018731                                TO XST00029-PRNT-STR-GP-CDE       03270000
018732     END-IF.                                                      03280000
018733                                                                  03290000
018734     IF XS022-PRNT-OV-STR-GP-ID = ZEROES                          03300000
018735        MOVE -1                 TO PV-PRNT-STR-GP-ID-IND          03310000
018736     ELSE                                                         03320000
018737        MOVE XS022-PRNT-OV-STR-GP-ID                              03330000
018738                                TO XST00029-PRNT-STR-GP-ID        03340000
018739     END-IF.                                                      03350000
018740                                                                  03360000
018741     IF XS022-PRNT-ADHC-STR-GP-ID = ZEROES                        03370000
018742        MOVE -1                 TO PV-PRNT-ADHC-GP-IND            03380000
018743     ELSE                                                         03390000
018744        MOVE XS022-PRNT-ADHC-STR-GP-ID                            03400000
018745                                TO XST00029-PRNT-ADHC-GP-ID       03410000
018746     END-IF.                                                      03420000
018747                                                                  03430000
018748*1200-EXIT.                                                       03440000
018749 EJECT.                                                           03450000
018750                                                                  03460000
018760*----------------------------------------------------------       03470000
018800* 2000-PROCESS-MESSAGE.                                           03480000
018900*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            03490000
019000*     SHOULD BE INSERTED OR UPDATED INTO THE STORE GROUP          03500000
019010*     TABLE OR THE ADHOC GROUP TABLE.                             03510000
019100*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          03520000
019200*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      03530000
019300*----------------------------------------------------------       03540000
019400 2000-PROCESS-MESSAGE.                                            03550000
019500                                                                  03560000
019510     IF PV-ADHOC-CDE                                              03570000
019600        EVALUATE TRUE                                             03580000
019700           WHEN PV-INSERT-DATA                                    03590000
019800                PERFORM 2100-INSERT-ADHC-DATA                     03600000
019900           WHEN PV-UPDATE-DATA                                    03610000
020000                PERFORM 2200-UPDATE-ADHC-DATA                     03620000
020100           WHEN OTHER                                             03630000
020200                SET PS-PROCESS-COMPLETE TO TRUE                   03640000
020300                SET PV-UNEXPECT-CDE     TO TRUE                   03650000
020400                PERFORM 9000-LOAD-SEVERITY-ERROR                  03660000
020500        END-EVALUATE                                              03670000
020510     ELSE                                                         03680000
020520        EVALUATE TRUE                                             03690000
020530           WHEN PV-INSERT-DATA                                    03700000
020540                PERFORM 2400-INSERT-STR-GP-DATA                   03710000
020550           WHEN PV-UPDATE-DATA                                    03720000
020560                PERFORM 2500-UPDATE-STR-GP-DATA                   03730000
020570           WHEN OTHER                                             03740000
020580                SET PS-PROCESS-COMPLETE TO TRUE                   03750000
020590                SET PV-UNEXPECT-CDE     TO TRUE                   03760000
020591                PERFORM 9000-LOAD-SEVERITY-ERROR                  03770000
020592        END-EVALUATE                                              03780000
020593     END-IF.                                                      03790000
020600                                                                  03800000
020700*2000-EXIT.                                                       03810000
020800 EJECT.                                                           03820000
020900                                                                  03830000
021000*------------------------------------------------------           03840000
021100* 2100-INSERT-ADHC-DATA.                                          03850000
021200*     INSERT THE PRICING ADHOC GROUP RECORD.                      03860000
021300*------------------------------------------------------           03870000
021400 2100-INSERT-ADHC-DATA.                                           03880000
021500                                                                  03890000
021600     PERFORM                                                      03900000
021700         WITH TEST AFTER                                          03910000
021800         VARYING PV-SQL-SUB                                       03920000
021900         FROM 1 BY 1                                              03930000
022000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03940000
022100                   OR  SQLCODE NOT = -904 AND -911 AND -913)      03950000
022400                                                                  03960000
022500         EXEC SQL                                                 03970000
022600             INSERT INTO XST_PROMO_ADHC_RLT                       03980000
022610                                      (PROMO_INTFC_ID             03990000
022700                                      ,MDSE_LNE_ID                04000000
022800                                      ,ADHC_STR_GP_ID             04010000
022900                                      ,PROMO_PRIC_VER_ID          04020000
023000                                      ,STR_SELN_HIER_CDE          04030000
023100                                      ,STAT_CDE                   04040000
023110                                      ,PROMO_STRT_TMST            04050000
023120                                      ,PROMO_END_TMST             04060000
023130                                      ,ACTL_STRT_TMST             04070000
023140                                      ,ACTL_END_TMST              04080000
                                            ,ESL_TOPR_TYP_CDE           04090000
023200                                      ,LAST_UPD_TMST              04100000
023210                                      ,SOR_LAST_UPD_TMST          04110000
023220                                      ,LAST_ACTN_CDE)             04120000
023300             VALUES                                               04130000
023400                (:XST00031-PROMO-INTFC-ID                         04140000
023500                ,:XST00031-MDSE-LNE-ID                            04150000
023600                ,:XST00031-ADHC-STR-GP-ID                         04160000
023700                ,:XST00031-PROMO-PRIC-VER-ID :PV-PRIC-VER-IND     04170000
023800                ,:XST00031-STR-SELN-HIER-CDE                      04180000
023900                ,:XST00031-STAT-CDE                               04190000
023910                ,:XST00031-PROMO-STRT-TMST                        04200000
023920                ,:XST00031-PROMO-END-TMST                         04210000
023930                ,:XST00031-ACTL-STRT-TMST                         04220000
023940                ,:XST00031-ACTL-END-TMST                          04230000
                      ,:XST00031-ESL-TOPR-TYP-CDE                       04240000
024000                ,CURRENT TIMESTAMP                                04250000
024010                ,:XST00031-SOR-LAST-UPD-TMST                      04260000
024020                ,'A')                                             04270000
024100         END-EXEC                                                 04280000
024200                                                                  04290000
024210         MOVE SQLCODE TO PV-SQL-CODE                              04300000
024220                                                                  04310000
024300         EVALUATE TRUE                                            04320000
024400             WHEN SQLCODE = -904                                  04330000
024500             WHEN SQLCODE = -911                                  04340000
024600             WHEN SQLCODE = -913                                  04350000
024700                  CONTINUE                                        04360000
024800             WHEN SQLCODE = 0                                     04370000
024900                  SET PS-PROCESS-COMPLETE TO TRUE                 04380000
025000             WHEN SQLCODE = -803                                  04390000
025100                  PERFORM 2300-SELECT-ADHC-DATA                   04400000
025110                  MOVE -803 TO SQLCODE                            04410000
025200             WHEN OTHER                                           04420000
025300                  SET PS-PROCESS-COMPLETE TO TRUE                 04430000
025400                  SET PV-NO-SUCCESS-CDE TO TRUE                   04440000
025500                  PERFORM 9000-LOAD-SEVERITY-ERROR                04450000
025600         END-EVALUATE                                             04460000
025700     END-PERFORM.                                                 04470000
025800                                                                  04480000
025900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04490000
026000        SET PS-PROCESS-COMPLETE TO TRUE                           04500000
026100        SET PV-NO-SUCCESS-CDE TO TRUE                             04510000
026200        PERFORM 9000-LOAD-SEVERITY-ERROR                          04520000
026300     END-IF.                                                      04530000
026400                                                                  04540000
026500*2100-EXIT.                                                       04550000
026600 EJECT.                                                           04560000
026700                                                                  04570000
033100*------------------------------------------------------           04580000
033200* 2200-UPDATE-ADHC-DATA.                                          04590000
033300*     UPDATE THE PRICING ADHOC GROUP RECORD.                      04600000
C52736*                                                                 04610002
C52736*  -- REMOVED SETTING OF PRIMARY KEY FIELDS                       04620002
033400*------------------------------------------------------           04630000
033500 2200-UPDATE-ADHC-DATA.                                           04640000
033600                                                                  04650000
033700     PERFORM                                                      04660000
033800         WITH TEST AFTER                                          04670000
033900         VARYING PV-SQL-SUB                                       04680000
034000         FROM 1 BY 1                                              04690000
034100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04700000
034200                   OR  SQLCODE NOT = -904 AND -911 AND -913)      04710000
034500                                                                  04720000
034600         EXEC SQL                                                 04730000
034700             UPDATE XST_PROMO_ADHC_RLT                            04740000
C52736             SET  PROMO_PRIC_VER_ID = :XST00031-PROMO-PRIC-VER-ID 04750001
035101                                        :PV-PRIC-VER-IND,         04760000
035102                  STR_SELN_HIER_CDE = :XST00031-STR-SELN-HIER-CDE,04770000
035300                  STAT_CDE          = :XST00031-STAT-CDE,         04780000
035310                  PROMO_STRT_TMST   = :XST00031-PROMO-STRT-TMST,  04790000
035320                  PROMO_END_TMST    = :XST00031-PROMO-END-TMST,   04800000
035330                  ACTL_STRT_TMST    = :XST00031-ACTL-STRT-TMST,   04810000
035340                  ACTL_END_TMST     = :XST00031-ACTL-END-TMST,    04820000
                        ESL_TOPR_TYP_CDE  = :XST00031-ESL-TOPR-TYP-CDE, 04830000
035400                  LAST_UPD_TMST     = CURRENT TIMESTAMP,          04840000
035410                  SOR_LAST_UPD_TMST = :XST00031-SOR-LAST-UPD-TMST,04850000
035420                  LAST_ACTN_CDE     = 'U'                         04860000
035500             WHERE PROMO_INTFC_ID   = :XST00031-PROMO-INTFC-ID    04870000
035510               AND MDSE_LNE_ID      = :XST00031-MDSE-LNE-ID       04880000
035520               AND ADHC_STR_GP_ID   = :XST00031-ADHC-STR-GP-ID    04890000
035530               AND SOR_LAST_UPD_TMST                              04900000
035540                                   <= :XST00031-SOR-LAST-UPD-TMST 04910000
035600         END-EXEC                                                 04920000
035700                                                                  04930000
035710         MOVE SQLCODE TO PV-SQL-CODE                              04940000
035720                                                                  04950000
035800         EVALUATE TRUE                                            04960000
035900             WHEN SQLCODE = -904                                  04970000
036000             WHEN SQLCODE = -911                                  04980000
036100             WHEN SQLCODE = -913                                  04990000
036200                  CONTINUE                                        05000000
036300             WHEN SQLCODE = 0                                     05010000
036400                  SET PS-PROCESS-COMPLETE TO TRUE                 05020000
036500             WHEN SQLCODE = +100                                  05030000
036600                  PERFORM 2300-SELECT-ADHC-DATA                   05040000
036700                  MOVE +100 TO SQLCODE                            05050000
036800             WHEN OTHER                                           05060000
036900                  SET PS-PROCESS-COMPLETE TO TRUE                 05070000
037000                  SET PV-NO-SUCCESS-CDE TO TRUE                   05080000
037100                  PERFORM 9000-LOAD-SEVERITY-ERROR                05090000
037200         END-EVALUATE                                             05100000
037300     END-PERFORM.                                                 05110000
037400                                                                  05120000
037500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05130000
037600        SET PS-PROCESS-COMPLETE TO TRUE                           05140000
037700        SET PV-NO-SUCCESS-CDE TO TRUE                             05150000
037800        PERFORM 9000-LOAD-SEVERITY-ERROR                          05160000
037900     END-IF.                                                      05170000
038000                                                                  05180000
038100*2200-EXIT.                                                       05190000
038200 EJECT.                                                           05200000
038300                                                                  05210000
038301*------------------------------------------------------           05220000
038302* 2300-SELECT-ADHC-DATA.                                          05230000
038303*     SELECT THE TIMESTAMP IN THE PRICING ADHOC GROUP RECORD.     05240000
038304*------------------------------------------------------           05250000
038305 2300-SELECT-ADHC-DATA.                                           05260000
038306                                                                  05270000
038307     PERFORM                                                      05280000
038308         WITH TEST AFTER                                          05290000
038309         VARYING PV-SQL-SUB                                       05300000
038310         FROM 1 BY 1                                              05310000
038311         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05320000
038312                   OR  SQLCODE NOT = -904 AND -911 AND -913)      05330000
038313                                                                  05340000
038314         EXEC SQL                                                 05350000
038315             SELECT  SOR_LAST_UPD_TMST                            05360000
038316               INTO :PV-LAST-UPD-TMST                             05370000
038317               FROM  XST_PROMO_ADHC_RLT                           05380000
038318              WHERE  PROMO_INTFC_ID  = :XST00031-PROMO-INTFC-ID   05390000
038319                AND  MDSE_LNE_ID     = :XST00031-MDSE-LNE-ID      05400000
038320                AND  ADHC_STR_GP_ID  = :XST00031-ADHC-STR-GP-ID   05410000
038321         END-EXEC                                                 05420000
038322                                                                  05430000
038323         MOVE SQLCODE TO PV-SQL-CODE                              05440000
038324                                                                  05450000
038325         EVALUATE TRUE                                            05460000
038326             WHEN SQLCODE = -904                                  05470000
038327             WHEN SQLCODE = -911                                  05480000
038328             WHEN SQLCODE = -913                                  05490000
038329                  CONTINUE                                        05500000
038330             WHEN SQLCODE = 0                                     05510000
038331                  IF PV-UPDATE-DATA                               05520000
038332                     SET PS-PROCESS-COMPLETE TO TRUE              05530000
038333                     SET PV-UPDATE-BYPASS TO TRUE                 05540000
038334                  ELSE                                            05550000
038335                     PERFORM 2700-TMST-COMPARE                    05560000
038336                  END-IF                                          05570000
038337             WHEN SQLCODE = +100                                  05580000
038338                  SET PV-INSERT-DATA TO TRUE                      05590000
038339                  SET PV-ADD-CDE TO TRUE                          05600000
038340             WHEN OTHER                                           05610000
038341                  SET PS-PROCESS-COMPLETE TO TRUE                 05620000
038342                  SET PV-NO-SUCCESS-CDE TO TRUE                   05630000
038343                  PERFORM 9000-LOAD-SEVERITY-ERROR                05640000
038344         END-EVALUATE                                             05650000
038345     END-PERFORM.                                                 05660000
038346                                                                  05670000
038347     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05680000
038348        SET PS-PROCESS-COMPLETE TO TRUE                           05690000
038349        SET PV-NO-SUCCESS-CDE TO TRUE                             05700000
038350        PERFORM 9000-LOAD-SEVERITY-ERROR                          05710000
038351     END-IF.                                                      05720000
038352                                                                  05730000
038353*2300-EXIT.                                                       05740000
038354 EJECT.                                                           05750000
038355                                                                  05760000
038356*------------------------------------------------------           05770000
038357* 2400-INSERT-STR-GP-DATA.                                        05780000
038358*     INSERT THE PRICING STORE GROUP RECORD.                      05790000
038359*------------------------------------------------------           05800000
038360 2400-INSERT-STR-GP-DATA.                                         05810000
038361                                                                  05820000
038370     PERFORM                                                      05830000
038380         WITH TEST AFTER                                          05840000
038390         VARYING PV-SQL-SUB                                       05850000
038391         FROM 1 BY 1                                              05860000
038392         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05870000
038393                   OR  SQLCODE NOT = -904 AND -911 AND -913)      05880000
038396                                                                  05890000
038397         EXEC SQL                                                 05900000
038398             INSERT INTO XST_PROMO_STR_GP                         05910000
038399                                      (PROMO_INTFC_ID             05920000
038400                                      ,MDSE_LNE_ID                05930000
038401                                      ,STR_GP_TYP_CDE             05940000
038402                                      ,STR_GP_ID                  05950000
038403                                      ,PROMO_PRIC_VER_ID          05960000
038404                                      ,STR_SELN_HIER_CDE          05970000
038405                                      ,STAT_CDE                   05980000
038406                                      ,PRNT_GP_TYP_CDE            05990000
038407                                      ,PRNT_STR_GP_CDE            06000000
038408                                      ,PRNT_STR_GP_ID             06010000
038409                                      ,PRNT_ADHC_GP_ID            06020000
038410                                      ,PROMO_STRT_TMST            06030000
038411                                      ,PROMO_END_TMST             06040000
038412                                      ,ACTL_STRT_TMST             06050000
038413                                      ,ACTL_END_TMST              06060000
                                            ,ESL_TOPR_TYP_CDE           06070000
038415                                      ,LAST_UPD_TMST              06080000
038416                                      ,SOR_LAST_UPD_TMST          06090000
038417                                      ,LAST_ACTN_CDE)             06100000
038418             VALUES                                               06110000
038419                (:XST00029-PROMO-INTFC-ID                         06120000
038420                ,:XST00029-MDSE-LNE-ID                            06130000
038421                ,:XST00029-STR-GP-TYP-CDE                         06140000
038422                ,:XST00029-STR-GP-ID                              06150000
038423                ,:XST00029-PROMO-PRIC-VER-ID :PV-PRIC-VER-IND     06160000
038424                ,:XST00029-STR-SELN-HIER-CDE                      06170000
038425                ,:XST00029-STAT-CDE                               06180000
038426                ,:XST00029-PRNT-GP-TYP-CDE :PV-PRNT-GP-TYP-IND    06190000
038427                ,:XST00029-PRNT-STR-GP-CDE :PV-PRNT-STR-GP-IND    06200000
038428                ,:XST00029-PRNT-STR-GP-ID :PV-PRNT-STR-GP-ID-IND  06210000
038429                ,:XST00029-PRNT-ADHC-GP-ID :PV-PRNT-ADHC-GP-IND   06220000
038430                ,:XST00029-PROMO-STRT-TMST                        06230000
038431                ,:XST00029-PROMO-END-TMST                         06240000
038432                ,:XST00029-ACTL-STRT-TMST                         06250000
038433                ,:XST00029-ACTL-END-TMST                          06260000
                      ,:XST00029-ESL-TOPR-TYP-CDE                       06270000
038434                ,CURRENT TIMESTAMP                                06280000
038435                ,:XST00029-SOR-LAST-UPD-TMST                      06290000
038436                ,'A')                                             06300000
038437         END-EXEC                                                 06310000
038438                                                                  06320000
038439         MOVE SQLCODE TO PV-SQL-CODE                              06330000
038440                                                                  06340000
038441         EVALUATE TRUE                                            06350000
038442             WHEN SQLCODE = -904                                  06360000
038443             WHEN SQLCODE = -911                                  06370000
038444             WHEN SQLCODE = -913                                  06380000
038445                  CONTINUE                                        06390000
038446             WHEN SQLCODE = 0                                     06400000
038447                  SET PS-PROCESS-COMPLETE TO TRUE                 06410000
038448             WHEN SQLCODE = -803                                  06420000
038449                  PERFORM 2600-SELECT-STR-GP-DATA                 06430000
038450                  MOVE -803 TO SQLCODE                            06440000
038451             WHEN OTHER                                           06450000
038452                  SET PS-PROCESS-COMPLETE TO TRUE                 06460000
038453                  SET PV-NO-SUCCESS-CDE TO TRUE                   06470000
038454                  PERFORM 9000-LOAD-SEVERITY-ERROR                06480000
038455         END-EVALUATE                                             06490000
038456     END-PERFORM.                                                 06500000
038457                                                                  06510000
038458     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         06520000
038459        SET PS-PROCESS-COMPLETE TO TRUE                           06530000
038460        SET PV-NO-SUCCESS-CDE TO TRUE                             06540000
038461        PERFORM 9000-LOAD-SEVERITY-ERROR                          06550000
038462     END-IF.                                                      06560000
038463                                                                  06570000
038464*2400-EXIT.                                                       06580000
038465 EJECT.                                                           06590000
038466                                                                  06600000
038539*------------------------------------------------------           06610000
038540* 2500-UPDATE-STR-GP-DATA.                                        06620000
038541*     UPDATE THE PRICING STORE GROUP RECORD.                      06630000
C52736*                                                                 06640002
C52736*  -- REMOVED SETTING OF PRIMARY KEY FIELDS                       06650002
038542*------------------------------------------------------           06660000
038543 2500-UPDATE-STR-GP-DATA.                                         06670000
038544                                                                  06680000
038545     PERFORM                                                      06690000
038546         WITH TEST AFTER                                          06700000
038547         VARYING PV-SQL-SUB                                       06710000
038548         FROM 1 BY 1                                              06720000
038549         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06730000
038550                   OR  SQLCODE NOT = -904 AND -911 AND -913)      06740000
038551                                                                  06750000
038552         EXEC SQL                                                 06760000
038553             UPDATE XST_PROMO_STR_GP                              06770000
C52736             SET  PROMO_PRIC_VER_ID = :XST00029-PROMO-PRIC-VER-ID 06780001
038559                                         :PV-PRIC-VER-IND,        06790000
038560                  STR_SELN_HIER_CDE = :XST00029-STR-SELN-HIER-CDE,06800000
038561                  STAT_CDE          = :XST00029-STAT-CDE,         06810000
038562                  PRNT_GP_TYP_CDE   = :XST00029-PRNT-GP-TYP-CDE   06820000
038563                                         :PV-PRNT-GP-TYP-IND,     06830000
038564                  PRNT_STR_GP_CDE   = :XST00029-PRNT-STR-GP-CDE   06840000
038565                                         :PV-PRNT-STR-GP-IND,     06850000
038566                  PRNT_STR_GP_ID    = :XST00029-PRNT-STR-GP-ID    06860000
038567                                         :PV-PRNT-STR-GP-ID-IND,  06870000
038568                  PRNT_ADHC_GP_ID   = :XST00029-PRNT-ADHC-GP-ID   06880000
038569                                         :PV-PRNT-ADHC-GP-IND,    06890000
038570                  PROMO_STRT_TMST   = :XST00029-PROMO-STRT-TMST,  06900000
038571                  PROMO_END_TMST    = :XST00029-PROMO-END-TMST,   06910000
038572                  ACTL_STRT_TMST    = :XST00029-ACTL-STRT-TMST,   06920000
038573                  ACTL_END_TMST     = :XST00029-ACTL-END-TMST,    06930000
                        ESL_TOPR_TYP_CDE  = :XST00029-ESL-TOPR-TYP-CDE, 06940000
038574                  LAST_UPD_TMST     = CURRENT TIMESTAMP,          06950000
038575                  SOR_LAST_UPD_TMST = :XST00029-SOR-LAST-UPD-TMST,06960000
038576                  LAST_ACTN_CDE     = 'U'                         06970000
038577             WHERE PROMO_INTFC_ID   = :XST00029-PROMO-INTFC-ID    06980000
038578               AND MDSE_LNE_ID      = :XST00029-MDSE-LNE-ID       06990000
038579               AND STR_GP_TYP_CDE   = :XST00029-STR-GP-TYP-CDE    07000000
038580               AND STR_GP_ID        = :XST00029-STR-GP-ID         07010000
038581               AND SOR_LAST_UPD_TMST                              07020000
038582                                   <= :XST00029-SOR-LAST-UPD-TMST 07030000
038583         END-EXEC                                                 07040000
038584                                                                  07050000
038585         MOVE SQLCODE TO PV-SQL-CODE                              07060000
038586                                                                  07070000
038587         EVALUATE TRUE                                            07080000
038588             WHEN SQLCODE = -904                                  07090000
038589             WHEN SQLCODE = -911                                  07100000
038590             WHEN SQLCODE = -913                                  07110000
038591                  CONTINUE                                        07120000
038592             WHEN SQLCODE = 0                                     07130000
038593                  SET PS-PROCESS-COMPLETE TO TRUE                 07140000
038594             WHEN SQLCODE = +100                                  07150000
038595                  PERFORM 2600-SELECT-STR-GP-DATA                 07160000
038596                  MOVE +100 TO SQLCODE                            07170000
038597             WHEN OTHER                                           07180000
038598                  SET PS-PROCESS-COMPLETE TO TRUE                 07190000
038599                  SET PV-NO-SUCCESS-CDE TO TRUE                   07200000
038600                  PERFORM 9000-LOAD-SEVERITY-ERROR                07210000
038601         END-EVALUATE                                             07220000
038602     END-PERFORM.                                                 07230000
038603                                                                  07240000
038604     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07250000
038605        SET PS-PROCESS-COMPLETE TO TRUE                           07260000
038606        SET PV-NO-SUCCESS-CDE TO TRUE                             07270000
038607        PERFORM 9000-LOAD-SEVERITY-ERROR                          07280000
038608     END-IF.                                                      07290000
038609                                                                  07300000
038610*2500-EXIT.                                                       07310000
038611 EJECT.                                                           07320000
038612                                                                  07330000
038613*------------------------------------------------------           07340000
038614* 2600-SELECT-STR-GP-DATA.                                        07350000
038615*     SELECT THE TIMESTAMP IN THE PRICING STORE GROUP RECORD.     07360000
038616*------------------------------------------------------           07370000
038617 2600-SELECT-STR-GP-DATA.                                         07380000
038618                                                                  07390000
038619     PERFORM                                                      07400000
038620         WITH TEST AFTER                                          07410000
038621         VARYING PV-SQL-SUB                                       07420000
038622         FROM 1 BY 1                                              07430000
038623         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07440000
038624                   OR  SQLCODE NOT = -904 AND -911 AND -913)      07450000
038625                                                                  07460000
038626         EXEC SQL                                                 07470000
038627             SELECT  SOR_LAST_UPD_TMST                            07480000
038628               INTO :PV-LAST-UPD-TMST                             07490000
038629               FROM  XST_PROMO_STR_GP                             07500000
038630              WHERE  PROMO_INTFC_ID  = :XST00029-PROMO-INTFC-ID   07510000
038631                AND  MDSE_LNE_ID     = :XST00029-MDSE-LNE-ID      07520000
038632                AND  STR_GP_TYP_CDE  = :XST00029-STR-GP-TYP-CDE   07530000
038633                AND  STR_GP_ID       = :XST00029-STR-GP-ID        07540000
038634         END-EXEC                                                 07550000
038635                                                                  07560000
038636         MOVE SQLCODE TO PV-SQL-CODE                              07570000
038637                                                                  07580000
038638         EVALUATE TRUE                                            07590000
038639             WHEN SQLCODE = -904                                  07600000
038640             WHEN SQLCODE = -911                                  07610000
038641             WHEN SQLCODE = -913                                  07620000
038642                  CONTINUE                                        07630000
038643             WHEN SQLCODE = 0                                     07640000
038644                  IF PV-UPDATE-DATA                               07650000
038645                     SET PS-PROCESS-COMPLETE TO TRUE              07660000
038646                     SET PV-UPDATE-BYPASS TO TRUE                 07670000
038647                  ELSE                                            07680000
038648                     PERFORM 2700-TMST-COMPARE                    07690000
038649                  END-IF                                          07700000
038650             WHEN SQLCODE = +100                                  07710000
038651                  SET PV-INSERT-DATA TO TRUE                      07720000
038652                  SET PV-ADD-CDE TO TRUE                          07730000
038653             WHEN OTHER                                           07740000
038654                  SET PS-PROCESS-COMPLETE TO TRUE                 07750000
038655                  SET PV-NO-SUCCESS-CDE TO TRUE                   07760000
038656                  PERFORM 9000-LOAD-SEVERITY-ERROR                07770000
038657         END-EVALUATE                                             07780000
038658     END-PERFORM.                                                 07790000
038659                                                                  07800000
038660     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07810000
038661        SET PS-PROCESS-COMPLETE TO TRUE                           07820000
038662        SET PV-NO-SUCCESS-CDE TO TRUE                             07830000
038663        PERFORM 9000-LOAD-SEVERITY-ERROR                          07840000
038664     END-IF.                                                      07850000
038665                                                                  07860000
038666*2600-EXIT.                                                       07870000
038667 EJECT.                                                           07880000
038668                                                                  07890000
038669*--------------------------------------------------------         07900000
038670* 2700-TMST-COMPARE.                                              07910000
038671*     COMPARE TIMESTAMP OF EXISTING ROW TO MESSAGE RECORD         07920000
038672*     AND UPDATE IF MESSAGE HAS A NEWER TIMESTAMP.                07930000
038673*--------------------------------------------------------         07940000
038674 2700-TMST-COMPARE.                                               07950000
038675                                                                  07960000
038676     IF XS022-LAST-UPD-TMST >= PV-LAST-UPD-TMST                   07970000
038677        SET PV-UPDATE-DATA      TO TRUE                           07980000
038678        SET PV-UPDATE-NEED      TO TRUE                           07990000
038679     ELSE                                                         08000000
038680        SET PS-PROCESS-COMPLETE TO TRUE                           08010000
038681        SET PV-UPDATE-NOT-NEED  TO TRUE                           08020000
038682     END-IF.                                                      08030000
038683                                                                  08040000
038684*2700-EXIT.                                                       08050000
038685 EJECT.                                                           08060000
038686                                                                  08070000
038687*----------------------------------------------------------       08080000
038688* 9000-LOAD-SEVERITY-ERROR.                                       08090000
038690*     THIS PROCEDURE IS CALLED IF THE RECORD WAS NOT UPDATED      08100000
038700*     OR INSERTED INTO THE PROMO ADHOC GROUP TABLE OR THE         08110000
038710*     PROMO STORE GROUP TABLE.  COMPARE THE MAXIMUM OFFSET        08120000
038800*     DATE TO THE BUSINESS EVENT PRICING STORE GROUP START        08130000
038900*     DATE.  IF THE MAXIMUM OFFSET DATE IS LESS THAN THE          08140000
039000*     PRICING STORE GROUP START DATE THE ERROR IS UNCRITICAL,     08150000
039100*     OTHERWISE IT IS CRITICAL.                                   08160000
039200*----------------------------------------------------------       08170000
039300 9000-LOAD-SEVERITY-ERROR.                                        08180000
039400                                                                  08190000
039500     IF PV-PRC-STR-STRT-DTE = SPACES                              08200000
039600        MOVE ZEROES TO PV-PRC-STR-STRT-DTE-NBR                    08210000
039700     ELSE                                                         08220000
039800        PERFORM 9100-FORMAT-DATE-INFO                             08230000
039900     END-IF.                                                      08240000
040000                                                                  08250000
040100     IF (PV-MAX-OFFSET-DTE < PV-PRC-STR-STRT-DTE-NBR) AND         08260000
040200       (PV-MAX-OFFSET-DTE NOT = ZEROES) AND                       08270000
040300       (PV-PRC-STR-STRT-DTE-NBR NOT = ZEROES)                     08280000
040400        SET PV-NOT-CRITICAL-ERROR TO TRUE                         08290000
040500     ELSE                                                         08300000
040600        SET PV-CRITICAL-ERROR TO TRUE                             08310000
040700     END-IF.                                                      08320000
040800                                                                  08330000
040810     INITIALIZE PV-SQL-SUB.                                       08340000
040820                                                                  08350000
040900*9000-EXIT.                                                       08360000
041000 EJECT.                                                           08370000
041100                                                                  08380000
041200*----------------------------------------------------------       08390000
041300* 9100-FORMAT-DATE-INFO.                                          08400000
041400*     FORMATS THE DATE FOR COMPARING.                             08410000
041500*----------------------------------------------------------       08420000
041600 9100-FORMAT-DATE-INFO.                                           08430000
041700                                                                  08440000
041800     MOVE PV-PRC-STR-DTE-TM-CCYY TO PV-PRC-STR-DTE-CCYY.          08450000
041900     MOVE PV-PRC-STR-DTE-TM-MM   TO PV-PRC-STR-DTE-MM.            08460000
042000     MOVE PV-PRC-STR-DTE-TM-DD   TO PV-PRC-STR-DTE-DD.            08470000
042100                                                                  08480000
042200*9100-EXIT.                                                       08490000
042300 EJECT.                                                           08500000
042400                                                                  08510000
042500*----------------------------------------------------------       08520000
042600* 9999-WRAPUP.                                                    08530000
042700*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           08540000
042800*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           08550000
042900*     PROGRAM.                                                    08560000
043000*----------------------------------------------------------       08570000
043100 9999-WRAPUP.                                                     08580000
043200                                                                  08590000
043300     MOVE PV-PGM-STATUS-CDE TO LV-PGM-STATUS-CDE.                 08600000
043400     MOVE PV-SQL-CODE       TO LV-LD-SQL-RETURN-CDE.              08610000
043500     MOVE PV-LD-STATUS-CDE  TO LV-LD-SEVERITY-LVL.                08620000
043600                                                                  08630000
043700*9999-EXIT.                                                       08640000
043800 EJECT.                                                           08650000
043900                                                                  08660000
