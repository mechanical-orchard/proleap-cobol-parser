000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.   DLKUT023.                                          00020000
000300 AUTHOR.       MIKE MACHNIK.                                      00030000
000400 INSTALLATION. KOHLS DEPARTMENT STORES.                           00040000
000500 DATE-WRITTEN. SEPTEMBER 2006.                                    00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*                   SHIPPING ASSIGNMENT EXTRACT                   00080000
000900* THIS PROGRAM WILL EXTRACT LABOR ASSIGNMENTS FROM DLT_ASGMT      00090000
001000* (DLT00004) AND CREATE AN EXTRACT FILE AS OUTPUT.                00100000
001100******************************************************************00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300******************************************************************00130000
001400 CONFIGURATION SECTION.                                           00140000
001500 SOURCE-COMPUTER.        IBM-3090.                                00150000
001600 OBJECT-COMPUTER.        IBM-3090.                                00160000
001700******************************************************************00170000
001800 INPUT-OUTPUT SECTION.                                            00180000
001900 FILE-CONTROL.                                                    00190000
002000                                                                  00200000
002100     SELECT SHIP-ASSIGN-EXTRACT-FILE ASSIGN TO OUT01.             00210000
002200     SELECT SELECT-TMST-EXTRACT-FILE ASSIGN TO OUT02.             00220000
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500 FILE SECTION.                                                    00250000
002600 FD  SHIP-ASSIGN-EXTRACT-FILE                                     00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000                                                                  00300000
003100 01  SHIP-ASSIGN-EXTRACT-REC       PIC X(29).                     00310000
003200                                                                  00320000
003300 FD  SELECT-TMST-EXTRACT-FILE                                     00330000
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700                                                                  00370000
003800 01  SELECT-TMST-EXTRACT-REC       PIC X(52).                     00380000
003900                                                                  00390000
004000                                                                  00400000
004100 WORKING-STORAGE SECTION.                                         00410000
004200                                                                  00420000
004300                                                                  00430000
004400 01  PS-PROGRAM-SWITCHES.                                         00440000
004500     05  PS-END-OF-ASGMT-CSR-SW      PIC X(01) VALUE 'N'.         00450000
004600         88  PS-END-OF-ASGMT-CSR-YES           VALUE 'Y'.         00460000
004700         88  PS-END-OF-ASGMT-CSR-NO            VALUE 'N'.         00470000
004800                                                                  00480000
004900 01  PC-PROGRAM-CONSTANTS.                                        00490000
005000     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'DLKUT023'.  00500000
005100     05  PC-DLKUT023                 PIC X(08) VALUE 'DLKUT023'.  00510000
005200     05  PC-MAX-RETRIES              PIC S9(03) VALUE 3 COMP-3.   00520000
005300                                                                  00530000
005400 01  PA-TOTALS.                                                   00540000
005500     05  PA-ASGMT-FETCH-COUNT        PIC  9(9) VALUE 0.           00550000
005600     05  PA-EXTRACT-WRITE-COUNT      PIC  9(9) VALUE 0.           00560000
005700     05  PA-SEL-TMST-WRITE-COUNT     PIC  9(1) VALUE 0.           00570000
005800                                                                  00580000
005900 01  ABEND-CODE                      PIC S9(4) VALUE +0           00590000
006000                                               COMP SYNC.         00600000
006100                                                                  00610000
006200 01  PV-PROGRAM-VARIABLES.                                        00620000
006300     05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.      00630000
006400     05  PV-DC-NBR                   PIC S9(4) COMP.              00640000
006500     05  PV-HOLD-COMPLETION-CODE     PIC S9(9) BINARY.            00650000
006600     05  PV-HOLD-REASON              PIC S9(9) BINARY.            00660000
006700     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            00670000
006800     05  PV-DISPLAY-RECORD           PIC ZZZ,ZZ9.                 00680000
006900     05  PV-CURRENT-TMST             PIC X(26) VALUE SPACES.      00690000
007000     05  PV-SELECT-TMST              PIC X(26) VALUE SPACES.      00700000
007100                                                                  00710000
007200     05  PV-NUMERIC-SEVEN            PIC 9(07).                   00720000
007300                                                                  00730000
007400 01  CC-CONTROL-CARD.                                             00740000
007500     05  CC-DC-NBR                    PIC X(04)  VALUE ZEROS.     00750000
007600     05  PV-CC-DC-NBR  REDEFINES CC-DC-NBR                        00760000
007700                                      PIC 9(04).                  00770000
007800                                                                  00780000
007900 01  PV-ABEND-VARIABLES.                                          00790000
008000     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP      00800000
008100                                                        SYNC.     00810000
008200     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP.     00820000
008300     05  PV-SQLCODE                  PIC S9(9).                   00830000
008400     05  PV-DISPLAY-SQLCODE          PIC -------999.              00840000
008500     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'DLKUT023'.  00850000
008600     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      00860000
008700     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      00870000
008800     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      00880000
008900     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      00890000
009000                                                                  00900000
009100******************************************************************00910000
009200*    EXTRACT FILE LAYOUT                                          00920000
009300******************************************************************00930000
009400     COPY DLRD011.                                                00940000
009500                                                                  00950000
009600******************************************************************00960000
009700*    SELECT TMST EXTRACT FILE LAYOUT                              00970000
009800******************************************************************00980000
009900     COPY DLRD012.                                                00990000
010000                                                                  01000000
010100******************************************************************01010000
010200*  COMMUNICATIONS AREA FOR DB2                                    01020000
010300******************************************************************01030000
010400     EXEC SQL                                                     01040000
010500         INCLUDE SQLCA                                            01050000
010600     END-EXEC.                                                    01060000
010700                                                                  01070000
010800******************************************************************01080000
010900*  DB2 FORMATTED MESSAGE AREA                                     01090000
011000******************************************************************01100000
011100     COPY DPWS004.                                                01110000
011200                                                                  01120000
011300******************************************************************01130000
011400*  ASSIGNMENT TABLE                                               01140000
011500*  DLT_ASGMT - DLT00004                                           01150000
011600******************************************************************01160000
011700     EXEC SQL                                                     01170000
011800         INCLUDE DLT00004                                         01180000
011900     END-EXEC.                                                    01190000
012000                                                                  01200000
012100******************************************************************01210000
012200*  DC PARAMETER TABLE (TKRPRPM)                                   01220000
012300******************************************************************01230000
012400     EXEC SQL                                                     01240000
012500         INCLUDE TKRPRPM                                          01250000
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
012800******************************************************************01280000
012900* COBOL CURSOR DECLARATION TO READ THE ASN CONTROL TABLE         *01290000
013000******************************************************************01300000
013100     EXEC SQL                                                     01310000
013200       DECLARE ASGMT_CSR CURSOR FOR                               01320000
013300        SELECT ASGMT_STRT_DTE                                     01330000
013400             , ASGMT_NBR_TXT                                      01340000
013500             , ASGMT_NBR_SEQ_NBR                                  01350000
013600          FROM DLT_ASGMT                                          01360000
013700         WHERE WK_TYP_DESC = 'SHIP'  AND                          01370000
013800               ASGMT_STP_TMST <= :PV-SELECT-TMST AND              01380000
013900               ASGMT_STP_RSN_CDE <> 'N' AND                       01390000
014000               DC_NBR = :PV-DC-NBR                                01400000
014100     END-EXEC.                                                    01410000
014200                                                                  01420000
014300 PROCEDURE DIVISION.                                              01430000
014400                                                                  01440000
014500 0000-PROGRAM-MAINLINE.                                           01450000
014600                                                                  01460000
014700     PERFORM 1000-INITIALIZE.                                     01470000
014800                                                                  01480000
014900     PERFORM 2000-CREATE-EXTRACT-FILE.                            01490000
015000                                                                  01500000
015100     CLOSE SHIP-ASSIGN-EXTRACT-FILE                               01510000
015200           SELECT-TMST-EXTRACT-FILE.                              01520000
015300                                                                  01530000
015400     PERFORM 8000-EOJ-ROUTINE.                                    01540000
015500                                                                  01550000
015600     STOP RUN.                                                    01560000
015700                                                                  01570000
015800******************************************************************01580000
015900*                I N I T I A L I Z A T I O N                     *01590000
016000******************************************************************01600000
016100 1000-INITIALIZE.                                                 01610000
016200                                                                  01620000
016300*ACCEPT CC DC NBR                                                 01630000
016400     ACCEPT CC-DC-NBR.                                            01640000
016500                                                                  01650000
016600     MOVE PV-CC-DC-NBR TO PV-DC-NBR.                              01660000
016700                                                                  01670000
016800     DISPLAY 'INPUT DC CONTROL CARD => ' PV-CC-DC-NBR.            01680000
016900                                                                  01690000
017000     PERFORM 1100-FETCH-SELECT-TIMESTAMP.                         01700000
017100                                                                  01710000
017200     DISPLAY ' '.                                                 01720000
017300     DISPLAY 'CURRENT TIMESTAMP =====> ' PV-CURRENT-TMST.         01730000
017400     DISPLAY 'SELECT TIMESTAMP ======> ' PV-SELECT-TMST.          01740000
017500                                                                  01750000
017600     OPEN OUTPUT SHIP-ASSIGN-EXTRACT-FILE                         01760000
017700                 SELECT-TMST-EXTRACT-FILE.                        01770000
017800                                                                  01780000
017900     MOVE 0 TO PA-SEL-TMST-WRITE-COUNT.                           01790000
018000                                                                  01800000
018100     PERFORM 3100-WRITE-SEL-TMST-REC.                             01810000
018200                                                                  01820000
018300     MOVE 0 TO PA-ASGMT-FETCH-COUNT                               01830000
018400               PA-EXTRACT-WRITE-COUNT.                            01840000
018500                                                                  01850000
018600     MOVE PV-CC-DC-NBR TO PV-DC-NBR.                              01860000
018700                                                                  01870000
018800******************************************************************01880000
018900* FETCH THE TIMESTAMP THAT WILL BE USED IN THE ASGMT SELECT       01890000
019000* PROCESS.                                                        01900000
019100******************************************************************01910000
019200 1100-FETCH-SELECT-TIMESTAMP.                                     01920000
019300                                                                  01930000
019400      PERFORM                                                     01940000
019500          WITH TEST AFTER                                         01950000
019600          VARYING PV-RETRY-COUNTER                                01960000
019700          FROM 1 BY 1                                             01970000
019800          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)              01980000
019900             OR  (SQLCODE = +100)                                 01990000
020000             OR  (SQLCODE = +0))                                  02000000
020100      EXEC SQL                                                    02010000
020200         SELECT CURRENT TIMESTAMP                                 02020000
020300              , CURRENT TIMESTAMP - FUNC_QTY SECONDS              02030000
020400           INTO :PV-CURRENT-TMST                                  02040000
020500              , :PV-SELECT-TMST                                   02050000
020600           FROM TKRPRPM                                           02060000
020700          WHERE LOC_ID           = 90                             02070000
020800            AND INTFC_SYS_CDE    = 'DLX'                          02080000
020900            AND SYS_PRC_FUNC_CDE = 'DLBEEO'                       02090000
021000      END-EXEC                                                    02100000
021100                                                                  02110000
021200      EVALUATE TRUE                                               02120000
021300          WHEN SQLCODE = 0                                        02130001
021310          WHEN SQLCODE = -904                                     02131001
021320          WHEN SQLCODE = -913                                     02132001
021330          WHEN SQLCODE = -911                                     02133001
021400               CONTINUE                                           02140001
021410          WHEN SQLWARN0 NOT = SPACES                              02141001
021420          WHEN SQLCODE NOT = ZERO                                 02142001
021600               MOVE '1100-FETCH-SELECT-TIMESTAMP'                 02160001
021700                                      TO PV-ABEND-PARAGRAPH       02170001
021800               MOVE 'FETCH SELECT TIMESTAMP'                      02180001
021900                                      TO PV-ABEND-OPERATION       02190001
022000               MOVE 'TKRPRPM'         TO PV-ABEND-STRUCTURE-1     02200001
022100               MOVE 'FETCH TIMESTAMP TO USE FOR ASGMT SELECT'     02210001
022200                                    TO PV-DB2-OPERATION-MESSAGE-1 02220001
022300               PERFORM 9900-DB2-ABEND                             02230001
022400      END-EVALUATE                                                02240000
022410                                                                  02241001
022500      END-PERFORM                                                 02250000
022600                                                                  02260001
022700      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                   02270001
022800          SQLCODE NOT = ZERO                                      02280001
022900              DISPLAY '**************************************'    02290001
023000              DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '    02300001
023100              DISPLAY 'FETCH SELECT TIMESTAMP '                   02310001
023200              DISPLAY '**************************************'    02320001
023300              MOVE '1100-FETCH-SELECT-TIMESTAMP'                  02330001
023400                                    TO PV-ABEND-PARAGRAPH         02340001
023500              MOVE 'SELECT'         TO PV-ABEND-OPERATION         02350001
023600              MOVE 'SELECT'         TO PV-ABEND-STRUCTURE-1       02360001
023700              MOVE 'SELECT QUERY'   TO PV-DB2-OPERATION-MESSAGE-1 02370001
023800              PERFORM 9900-DB2-ABEND                              02380001
023900      END-IF.                                                     02390000
024000                                                                  02400000
024100******************************************************************02410000
024200* OPEN CURSOR, FETCH UNTIL PS-END-OF-ASGMT-CSR-YES, CLOSE CURSOR *02420000
024300******************************************************************02430000
024400 2000-CREATE-EXTRACT-FILE.                                        02440000
024500                                                                  02450000
024600     PERFORM 2100-OPEN-ASGMT-CSR.                                 02460000
024700                                                                  02470000
024800     PERFORM 2200-FETCH-ASGMT-CSR                                 02480000
024900        UNTIL PS-END-OF-ASGMT-CSR-YES.                            02490000
025000                                                                  02500000
025100     PERFORM 2300-CLOSE-ASGMT-CSR.                                02510000
025200                                                                  02520000
025300******************************************************************02530000
025400* OPEN ASGMT_CSR CURSOR                                           02540000
025500******************************************************************02550000
025600 2100-OPEN-ASGMT-CSR.                                             02560000
025700                                                                  02570000
025800      PERFORM                                                     02580000
025900          WITH TEST AFTER                                         02590000
026000          VARYING PV-RETRY-COUNTER                                02600000
026100          FROM 1 BY 1                                             02610000
026200          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)              02620000
026300             OR  (SQLCODE = +100)                                 02630000
026400             OR  (SQLCODE = +0))                                  02640000
026500       EXEC SQL                                                   02650000
026600           OPEN ASGMT_CSR                                         02660000
026700       END-EXEC                                                   02670000
026800                                                                  02680000
026900       EVALUATE TRUE                                              02690000
027000         WHEN SQLCODE = ZERO                                      02700000
027010         WHEN SQLCODE = -904                                      02701001
027020         WHEN SQLCODE = -913                                      02702001
027030         WHEN SQLCODE = -911                                      02703001
027100             CONTINUE                                             02710000
027200         WHEN OTHER                                               02720000
027300             MOVE '2100-OPEN-CNTL-CURSOR'                         02730000
027400                                   TO PV-ABEND-PARAGRAPH          02740000
027500             MOVE 'OPEN CNTL-CSR ' TO PV-ABEND-OPERATION          02750000
027600             MOVE 'DLT00004'       TO PV-ABEND-STRUCTURE-1        02760000
027700             MOVE 'OPEN CURSOR USING DLT_ASGMT TABLE'             02770000
027800                                   TO PV-DB2-OPERATION-MESSAGE-1  02780000
027900             PERFORM 9900-DB2-ABEND                               02790000
028000       END-EVALUATE                                               02800000
028100       END-PERFORM.                                               02810000
028200                                                                  02820000
028300      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                   02830000
028400          SQLCODE NOT = ZERO                                      02840000
028500          DISPLAY '**************************************'        02850000
028600          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        02860000
028700          DISPLAY 'OPEN ASSIGNMENT CURSOR '                       02870000
028800          DISPLAY '**************************************'        02880000
028900          MOVE '2100-OPEN-ASGMT-CSR'                              02890000
029000                                TO PV-ABEND-PARAGRAPH             02900000
029100          MOVE 'OPEN ASSIGNMENT' TO PV-ABEND-OPERATION            02910000
029200          MOVE 'DLT00004'        TO PV-ABEND-STRUCTURE-1          02920000
029300          MOVE 'OPEN CURSOR'     TO PV-DB2-OPERATION-MESSAGE-1    02930000
029400          PERFORM 9900-DB2-ABEND                                  02940000
029500      END-IF.                                                     02950000
029600                                                                  02960000
029700******************************************************************02970000
029800* FETCH ASGMT_CSR CURSOR                                          02980000
029900******************************************************************02990000
030000 2200-FETCH-ASGMT-CSR.                                            03000000
030100                                                                  03010000
030200      PERFORM                                                     03020000
030300          WITH TEST AFTER                                         03030000
030400          VARYING PV-RETRY-COUNTER                                03040000
030500          FROM 1 BY 1                                             03050000
030600          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)              03060000
030700             OR  (SQLCODE = +100)                                 03070000
030800             OR  (SQLCODE = +0))                                  03080000
030900       EXEC SQL                                                   03090000
031000           FETCH ASGMT_CSR                                        03100000
031100            INTO :DLT00004-ASGMT-STRT-DTE                         03110000
031200               , :DLT00004-ASGMT-NBR-TXT                          03120000
031300               , :DLT00004-ASGMT-NBR-SEQ-NBR                      03130000
031400       END-EXEC                                                   03140000
031500                                                                  03150000
031600       EVALUATE TRUE                                              03160000
031700         WHEN SQLCODE = 0                                         03170000
031800             ADD 1 TO PA-ASGMT-FETCH-COUNT                        03180000
031900             PERFORM 3000-WRITE-EXTRACT-REC                       03190000
032000         WHEN SQLCODE = +100                                      03200000
032100             SET PS-END-OF-ASGMT-CSR-YES TO TRUE                  03210000
032110         WHEN SQLCODE = -904                                      03211001
032120         WHEN SQLCODE = -913                                      03212001
032130         WHEN SQLCODE = -911                                      03213001
032140             CONTINUE                                             03214001
032200         WHEN OTHER                                               03220000
032300             MOVE '2200-FETCH-ASGMT-CSR'                          03230000
032400                                    TO PV-ABEND-PARAGRAPH         03240000
032500             MOVE 'FETCH ASGMT_CSR' TO PV-ABEND-OPERATION         03250000
032600             MOVE 'DLT00004'       TO PV-ABEND-STRUCTURE-1        03260000
032700             MOVE 'FETCH CURSOR USING DLT_ASGMT TABLE'            03270000
032800                                   TO PV-DB2-OPERATION-MESSAGE-1  03280000
032900             PERFORM 9900-DB2-ABEND                               03290000
033000       END-EVALUATE                                               03300000
033100       END-PERFORM.                                               03310000
033200                                                                  03320000
033300     IF   PV-RETRY-COUNTER > PC-MAX-RETRIES AND                   03330000
033400          SQLCODE NOT = ZERO                                      03340000
033500          DISPLAY '**************************************'        03350000
033600          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        03360000
033700          DISPLAY 'FETCH ASSIGNMENT CURSOR'                       03370000
033800          DISPLAY '**************************************'        03380000
033900          MOVE '2200-FETCH-ASGMT-CSR'                             03390000
034000                                    TO PV-ABEND-PARAGRAPH         03400000
034100          MOVE 'FETCH ASSIGNMENT'   TO PV-ABEND-OPERATION         03410000
034200          MOVE 'DLT00004'           TO PV-ABEND-STRUCTURE-1       03420000
034300          MOVE 'FETCH CURSOR'       TO PV-DB2-OPERATION-MESSAGE-1 03430000
034400          PERFORM 9900-DB2-ABEND                                  03440000
034500      END-IF.                                                     03450000
034600                                                                  03460000
034700******************************************************************03470000
034800* CLOSE ASGMT_CSR CURSOR                                          03480000
034900******************************************************************03490000
035000 2300-CLOSE-ASGMT-CSR.                                            03500000
035100      PERFORM                                                     03510000
035200          WITH TEST AFTER                                         03520000
035300          VARYING PV-RETRY-COUNTER                                03530000
035400          FROM 1 BY 1                                             03540000
035500          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)              03550000
035600             OR  (SQLCODE = +100)                                 03560000
035700             OR  (SQLCODE = +0))                                  03570000
035800       EXEC SQL                                                   03580000
035900           CLOSE ASGMT_CSR                                        03590000
036000       END-EXEC                                                   03600000
036100                                                                  03610000
036200       EVALUATE TRUE                                              03620000
036300         WHEN SQLCODE = 0                                         03630000
036310         WHEN SQLCODE = -904                                      03631001
036320         WHEN SQLCODE = -913                                      03632001
036330         WHEN SQLCODE = -911                                      03633001
036400             CONTINUE                                             03640000
036500         WHEN OTHER                                               03650000
036600             MOVE '2300-CLOSE-ASGMT-CSR'                          03660000
036700                                    TO PV-ABEND-PARAGRAPH         03670000
036800             MOVE 'CLOSE ASGMT_CSR' TO PV-ABEND-OPERATION         03680000
036900             MOVE 'DLT00004'       TO PV-ABEND-STRUCTURE-1        03690000
037000             MOVE 'CLOSE CURSOR USING DLT_ASGMT TABLE'            03700000
037100                                   TO PV-DB2-OPERATION-MESSAGE-1  03710000
037200             PERFORM 9900-DB2-ABEND                               03720000
037300       END-EVALUATE                                               03730000
037400       END-PERFORM.                                               03740000
037500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    03750000
037600         SQLCODE NOT = ZERO                                       03760000
037700          DISPLAY '**************************************'        03770000
037800          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        03780000
037900          DISPLAY 'CLOSE ASSIGNMENT CURSOR'                       03790000
038000          DISPLAY '**************************************'        03800000
038100          MOVE '2300-CLOSE-ASGMT-CSR'                             03810000
038200                                TO PV-ABEND-PARAGRAPH             03820000
038300          MOVE 'CLOSE ASSIGNMENT' TO PV-ABEND-OPERATION           03830000
038400          MOVE 'DLT00004'         TO PV-ABEND-STRUCTURE-1         03840000
038500          MOVE 'CLOSE CURSOR'     TO PV-DB2-OPERATION-MESSAGE-1   03850000
038600          PERFORM 9900-DB2-ABEND                                  03860000
038700      END-IF.                                                     03870000
038800                                                                  03880000
038900 3000-WRITE-EXTRACT-REC.                                          03890000
039000                                                                  03900000
039100     MOVE DLT00004-ASGMT-STRT-DTE    TO DL011-ASGMT-STRT-DTE.     03910000
039200     MOVE DLT00004-ASGMT-NBR-TXT     TO DL011-ASGMT-NBR-TXT.      03920000
039300     MOVE DLT00004-ASGMT-NBR-SEQ-NBR TO DL011-ASGMT-NBR-SEQ-NBR.  03930000
039400                                                                  03940000
039500     ADD 1 TO PA-EXTRACT-WRITE-COUNT.                             03950000
039600                                                                  03960000
039700     WRITE SHIP-ASSIGN-EXTRACT-REC FROM                           03970000
039800           DL011-SHIP-ASGMT-EXTRACT.                              03980000
039900                                                                  03990000
040000******************************************************************04000000
040100* WRITE A RECORD TO THE SELECT TIMESTAMP EXTRACT FILE.            04010000
040200******************************************************************04020000
040300 3100-WRITE-SEL-TMST-REC.                                         04030000
040400                                                                  04040000
040500     INITIALIZE DL012-CONTROL-RECORD.                             04050000
040600     MOVE PV-SELECT-TMST             TO DL012-CONTROL-TMST.       04060000
040700                                                                  04070000
040800     ADD 1 TO PA-SEL-TMST-WRITE-COUNT.                            04080000
040900                                                                  04090000
041000     WRITE SELECT-TMST-EXTRACT-REC FROM                           04100000
041100           DL012-CONTROL-RECORD.                                  04110000
041200                                                                  04120000
041300******************************************************************04130000
041400* EOJ DISPLAYS                                                    04140000
041500******************************************************************04150000
041600 8000-EOJ-ROUTINE.                                                04160000
041700                                                                  04170000
041800     DISPLAY '*******************************************'        04180000
041900     DISPLAY '      * DLKUT023 SUMMARY STATISTICS *      '        04190000
042000     DISPLAY ' '                                                  04200000
042100     DISPLAY '        ---------------------------        '        04210000
042200     DISPLAY '               ASGMT EXTRACT               '        04220000
042300     DISPLAY '        ---------------------------        '        04230000
042400     DISPLAY ' '                                                  04240000
042500     DISPLAY ' TOTAL FETCHES               :'                     04250000
042600                                    PA-ASGMT-FETCH-COUNT.         04260000
042700     DISPLAY ' '                                                  04270000
042800     DISPLAY ' TOTAL SELECT TMST EXT RECS  :'                     04280000
042900                                    PA-SEL-TMST-WRITE-COUNT.      04290000
043000     DISPLAY ' '                                                  04300000
043100     DISPLAY ' TOTAL EXTRACT RECS          :'                     04310000
043200                                    PA-EXTRACT-WRITE-COUNT.       04320000
043300     DISPLAY ' '.                                                 04330000
043400     DISPLAY '************  END OF DLKUT023  ***************'.    04340000
043500                                                                  04350000
043600******************************************************************04360000
043700* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      04370000
043800* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 04380000
043900******************************************************************04390000
044000 9900-DB2-ABEND.                                                  04400001
044100                                                                  04410001
044200     MOVE SQLCODE    TO PV-SQLCODE.                               04420000
044300     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       04430000
044400     DISPLAY '*** DB2 ERROR ***'.                                 04440000
044500     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               04450000
044600     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04460000
044700     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04470000
044800     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04480000
044900     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04490000
045000     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             04500000
045100                                                                  04510000
045110                                                                  04511001
045200******************************************************************04520000
045300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04530000
045400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04540000
045500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04550000
045600* FORMAT.                                                         04560000
045700******************************************************************04570000
045800     COPY DPPD004.                                                04580000
045900                                                                  04590000
046000     MOVE +4013         TO PV-ABEND-CODE.                         04600000
046100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04610000
046200******************************************************************04620000
