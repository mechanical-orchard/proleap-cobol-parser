000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS071.                                         00040000
000500 AUTHOR.        JIM SCHNEIDER.                                    00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04-18-95.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    W071 - EDI INVOICE INQUIRY.                                * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM DISPLAYS EDI INVOICE INFORMATION. IT IS A     * 00130000
001400*    READ ONLY SCREEN.                                          * 00140000
001500*                                                               * 00150000
001600*---------------------------------------------------------------* 00160000
      *     CHANGE LOG                                                * 00170005
      ***************************************************************** 00180005
      *    DATE  04/30/99                                             * 00190005
      *  CHANGE MADE: REMOVE SQL INLCUDE OF TINCEDI FROM WORKING      * 00200005
      *  STORAGE BECAUSE PROGRAM DOES NOT ACCESS THE TABLE. ALSO      * 00210005
      *  CHANGED ++INCLUDES TO COPY STATEMENTS.                       * 00220005
      *  MADE BY: DAVE COLOMBO - COMPUWARE               WR #: 3127   * 00230005
      ***************************************************************** 00240005
C98147*    DATE  11/20/14                                               00250013
C98147*  CHANGE MADE: EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND         00260013
C98147*               COMMAREA.                                         00270013
C98147*               EXPANDED PO-NBR FIELDS IN WS TO 8 DIGITS.         00280013
C98147*               UPDATED COUNTER FROM 7 TO 8 IN PARAGRAPH 4315.    00290013
C98147*                                                                 00300013
C98147*  MADE BY: LINDA FRIESS                           CHG0098147     00310013
C98147***************************************************************** 00320013
076319* DATE  10/27/2021                                                00321015
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00322015
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00323015
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00324015
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00325016
076312*                                                               * 00326015
076318*---------------------------------------------------------------* 00327015
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00328018
CICS  *                                                               * 00329017
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00329117
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00329217
CICS  *---------------------------------------------------------------* 00329317
001700                                                                  00330000
001800 ENVIRONMENT DIVISION.                                            00340000
001900                                                                  00350000
002000 DATA DIVISION.                                                   00360000
002100                                                                  00370000
002200 WORKING-STORAGE SECTION.                                         00380000
002300                                                                  00390000
002400 01  PC-PROGRAM-CONSTANTS.                                        00400000
002500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00410000
002600                                                    'PO071A  '.   00420000
002700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00430000
002800                                                    'POKM071 '.   00440000
002900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00450000
003000                                                    'POKCS071'.   00460000
003300     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00470000
003400     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00480000
003500     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00490000
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00500000
003700                                                    COMP SYNC.    00510000
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00520000
003900                                                    COMP SYNC.    00530000
004000     05  PC-MAX-TABLE                   PIC S9(09)  VALUE         00540000
004100                                                    +2500.        00550000
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00560000
004300                                                    +1000000      00570000
004400                                                    COMP-3.       00580000
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00590000
004600                                                    COMP SYNC.    00600000
004700     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00610000
004800                                                     COMP-3.      00620000
004900                                                                  00630000
005000 01  PC-TSYMSG-NUMBERS.                                           00640000
005100     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00650000
005200     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00660000
005300     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00670000
005400     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00680000
005500     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00690000
005600     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00700000
005700     05  PC-TSYMSG-00984                PIC 9(5)    VALUE 00984.  00710000
005800     05  PC-TSYMSG-00994                PIC 9(5)    VALUE 00994.  00720000
005900                                                                  00730000
006000 01  PS-PROGRAM-SUBSCRIPTS.                                       00740000
006100     05  PS-SUB                         PIC S9(04)   VALUE +0     00750000
006200                                                     COMP SYNC.   00760000
006300                                                                  00770000
006400 01  PS-PROGRAM-SWITCHES.                                         00780000
006500     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00790000
006600         88  PS-NO-ERROR                             VALUE 'Y'.   00800000
006700         88  PS-ERROR                                VALUE 'N'.   00810000
006800     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   00820000
006900         88  PS-COMMAREA-VALID                       VALUE 'Y'.   00830000
007000         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00840000
007100     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00850000
007200         88  PS-LIST-END                             VALUE 'Y'.   00860000
007300         88  PS-NO-LIST-END                          VALUE 'N'.   00870000
007400     05  PS-END-OF-TABLE-SW             PIC X(01)    VALUE 'N'.   00880000
007500         88  PS-END-OF-TABLE                         VALUE 'Y'.   00890000
007600         88  PS-NOT-END-OF-TABLE                     VALUE 'N'.   00900000
007700                                                                  00910000
007800 01  PV-PROGRAM-VARIABLES.                                        00920000
007810     05  PV-DEFAULT-DATE                PIC X(10)    VALUE        00930001
007820                                                  '9999-09-09'.   00940001
007830     05  PV-DEFAULT-TIME                PIC X(05)    VALUE        00950001
007840                                                         '09:09'. 00960001
007900     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     00970000
008000                                                     COMP SYNC.   00980000
008100     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     00990000
008200                                                     COMP-3.      01000000
008300     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01010000
008400                                                     COMP-3.      01020000
008500     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01030000
008600                                                     COMP-3.      01040000
008700     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01050000
008800                                                     COMP SYNC.   01060000
008900     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01070000
009000                                                     COMP SYNC.   01080000
009100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01090000
009200                                                     COMP SYNC.   01100000
009300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01110000
009400                                                     COMP SYNC.   01120000
009500     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01130000
009600                                                                  01140000
009700     05  PV-DATE-10.                                              01150000
009800         10  PV-CENTURY-10              PIC 9(02).                01160000
009900         10  PV-YEAR-10                 PIC 9(02).                01170000
010000         10  FILLER                     PIC X(01)    VALUE SPACES.01180000
010100         10  PV-MONTH-10                PIC 9(02).                01190000
010200         10  FILLER                     PIC X(01)    VALUE SPACES.01200000
010300         10  PV-DAY-10                  PIC 9(02).                01210000
010400                                                                  01220000
010500     05  PV-DATE-8.                                               01230000
010600         10  PV-MONTH-8                 PIC X(02).                01240000
010700         10  PV-SLASH-1                 PIC X(01)    VALUE SPACES.01250000
010800         10  PV-DAY-8                   PIC X(02).                01260000
010900         10  PV-SLASH-2                 PIC X(01)    VALUE SPACES.01270000
011000         10  PV-YEAR-8                  PIC X(02).                01280000
011100                                                                  01290000
011200     05  PV-PRE-CONV-DATE               PIC X(10).                01300000
011300                                                                  01310000
011400     05  PV-TIME.                                                 01320000
011500         10 PV-HOUR                     PIC 9(02).                01330000
011600         10 PV-COLON                    PIC X(01).                01340000
011700         10 PV-MINUTE                   PIC 9(02).                01350000
011800                                                                  01360000
011900     05  PV-SAVE-INV-CTR                PIC 99      VALUE ZEROES. 01370000
012000     05  PV-PO-SEGMENT                  PIC 9       VALUE ZEROES. 01380000
012100     05  PV-INV-CTR                     PIC 99      VALUE ZEROES. 01390000
012200     05  PV-PO-CTR                      PIC 9       VALUE ZEROES. 01400000
012300     05  PV-HOLD-INV-CTR                PIC 9       VALUE ZEROES. 01410000
012400     05  PV-UNITS                       PIC 9(5)    VALUE ZEROES. 01420000
012500     05  PV-FACILITY                    PIC X(5).                 01430000
012600     05  PV-DISCOUNT-AMT                PIC 9(6)V99 VALUE ZEROES. 01440000
012700     05  PV-NETCOST-DOLS                PIC 9(8)V99 VALUE ZEROES. 01450000
012800     05  PV-TOTAL-DISCOUNT-AMT          PIC 9(6)V99 VALUE ZEROES. 01460000
012900     05  PV-GR-TOT-UNITS                PIC 9(6)    VALUE ZEROES. 01470000
013000     05  PV-GR-TOT-COST-DOLLARS         PIC 9(9)V99 VALUE ZEROES. 01480000
013100     05  PV-GR-TOT-DISC-AMT             PIC 9(7)V99 VALUE ZEROES. 01490000
013200     05  PV-GR-TOT-NETCOST-DOLS         PIC 9(9)V99 VALUE ZEROES. 01500000
013300     05  PV-PO-NBR-COMP                 PIC S9(9)   COMP.         01510000
013400     05  PV-STR-NBR                     PIC 9(3).                 01520000
013500     05  PV-STR-NBR-X                   PIC X(3).                 01530000
013600     05  PV-ZERO-CNT                    PIC 9(2)    VALUE ZEROES. 01540000
013700     05  PV-SORTED-ORDER                PIC 9(4)    VALUE ZEROES. 01550000
013800     05  PV-PO-MESSAGE.                                           01560000
013900         10  FILLER                     PIC X(12)   VALUE         01570000
014000             'PO NUMBER = '.                                      01580000
C98147         10  PV-PO-NUMBER-MESSAGE       PIC 9(8).                 01590013
014200     05  PV-INVC-MESSAGE.                                         01600000
014300         10  FILLER                     PIC X(17)   VALUE         01610000
014400             'INVOICE NUMBER = '.                                 01620000
014500         10  PV-INVC-NBR-MESSAGE        PIC X(30).                01630000
014600                                                                  01640000
014700     05  PV-INVOICE-NBR                 PIC X(22).                01650000
014800     05  FILLER REDEFINES PV-INVOICE-NBR.                         01660000
014900         10  PV-INVOICE-NBR-TABLE OCCURS 10 TIMES.                01670000
015000             15  PV-INVOICE-NBR-UNIT    PIC X.                    01680000
015100         10  FILLER                     PIC X(12).                01690000
015200                                                                  01700000
C98147     05  PV-PO-NBR-NUM                  PIC 9(8)    VALUE ZEROES. 01710013
C98147     05  PV-PO-NBR-X                    PIC X(8).                 01720013
015500     05  FILLER REDEFINES PV-PO-NBR-X.                            01730000
C98147         10  PV-PO-NBR-TABLE OCCURS 8 TIMES.                      01740013
015700             15  PV-PO-NBR-UNIT         PIC X.                    01750000
015800                                                                  01760000
015900     05  PV-HOLD-INV-NUMBER             PIC X(3).                 01770000
016000     05  FILLER REDEFINES PV-HOLD-INV-NUMBER.                     01780000
016100         10  PV-HOLD-INV-NUMBER-TABLE OCCURS 3 TIMES.             01790000
016200             15  PV-HOLD-INV-SEGMENT    PIC X.                    01800000
016300                                                                  01810000
016400     05  PV-HOLD-PO-NUMBER              PIC X(3).                 01820000
016500     05  FILLER REDEFINES PV-HOLD-PO-NUMBER.                      01830000
016600         10  PV-HOLD-PO-NUMBER-TABLE OCCURS 3 TIMES.              01840000
016700             15  PV-HOLD-PO-SEGMENT     PIC X.                    01850000
016800                                                                  01860000
016900     05  PV-COMPARE-ROW                 PIC 9(4)     VALUE ZEROES.01870000
017000     05  PV-COMPARE-TO-ROW              PIC 9(4)     VALUE ZEROES.01880000
017100     05  PV-SORT-TABLE-CTR              PIC 9(4)     VALUE ZEROES.01890000
017200     05  PV-SORT-HOLD-TABLE             PIC X(78).                01900000
017300                                                                  01910000
017400     05  PV-SORT-TABLE OCCURS 2500 TIMES.                         01920000
017500         10  PV-SORT-TABLE-FIELDS.                                01930000
017600             15  PV-SORT-KEY-FIELDS.                              01940000
017700                 20  PV-SORT-DATE               PIC X(10).        01950000
017800                 20  PV-SORT-TIME               PIC X(5).         01960000
017900                 20  PV-SORT-INVC-NBR           PIC X(22).        01970000
018000             15  PV-SORT-NON-KEY-FIELDS.                          01980000
018100                 20  PV-SORT-UNITS              PIC 9(5).         01990000
018200                 20  PV-SORT-COST-DOLLARS       PIC 9(8)V99.      02000000
018300                 20  PV-SORT-DISC-DOLLARS       PIC 9(6)V99.      02010000
018400                 20  PV-SORT-NETCOST-DOLS       PIC 9(8)V99.      02020000
018500                 20  PV-SORT-FACILITY           PIC X(5).         02030000
018600                 20  PV-SORT-LIST-ITEM-NUMBER   PIC 9(03).        02040000
018700                                                                  02050000
018800 01  PV-DB2-CRITERIA-AREA.                                        02060000
018900     15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO    02070000
019000                                                    COMP-3.       02080000
019100                                                                  02090000
019200 EJECT                                                            02100000
019300*---------------------------------------------------------------* 02110000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02120017
019500*---------------------------------------------------------------* 02130000
019600                                                                  02140000
019700     COPY DPWS030.                                                02150004
CICS       COPY DPWS930.                                                02151017
019800 EJECT                                                            02160000
019900*---------------------------------------------------------------* 02170000
020000*    STANDARD COMMAREA.                                         * 02180000
020100*---------------------------------------------------------------* 02190000
020200                                                                  02200000
020300     COPY DPWS020.                                                02210004
020400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02220000
020500                                                                  02230000
020600*---------------------------------------------------------------* 02240000
020700*    INTER-APPLICATION COMMAREA.                                * 02250000
020800*---------------------------------------------------------------* 02260000
020900                                                                  02270000
021000         10  INTER-APPL-COMM-AREA       PIC X(200).               02280000
021100     COPY POWS017.                                                02290004
021200*---------------------------------------------------------------* 02300000
021300*    SPECIFIC COMMMAREA FOR POKCS071.                           * 02310000
021400*---------------------------------------------------------------* 02320000
021500         10  ASC-SPECIFIC-COMMAREA.                               02330000
021600             15  ASC-LIST-KEYS.                                   02340000
C98147                 20  ASC-KEY-PO-NUMBER           PIC Z(8).        02350013
021800                 20  ASC-KEY-INV-NBR             PIC X(30).       02360000
021900                 20  ASC-ENT-NAME-DESC           PIC X(30).       02370000
022000                 20  ASC-NETWK-NAME              PIC X(05).       02380000
022100                 20  ASC-ORDERED-UNITS           PIC ZZZZ9.       02390000
022200                 20  ASC-ORDERED-COST            PIC ZZZZZZZ9.99. 02400000
022300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02410000
022400                 20  ASC-ITEM-ENTRIES OCCURS 12 TIMES.            02420000
022500                     25  ASC-LIST-ITEM-NUMBER    PIC S9(09)       02430000
022600                                                 COMP-3.          02440000
022700                     25  ASC-INV-DATE            PIC X(8).        02450000
022800                     25  ASC-INV-TIME            PIC X(5).        02460000
022900                     25  ASC-INV-NUMBER          PIC X(15).       02470000
023000                     25  ASC-UNITS               PIC ZZZZ9.       02480000
023100                     25  ASC-COST-DOLLARS        PIC ZZZZZZZ9.99. 02490000
023200                     25  ASC-DISC-DOLLARS        PIC ZZZZZ9.99.   02500000
023300                     25  ASC-NETCOST-DOLLARS     PIC ZZZZZZZ9.99. 02510000
023400                     25  ASC-FACILITY            PIC X(5).        02520000
023500             15  ASC-GR-TOT-UNITS                PIC ZZZZZ9.      02530000
023600             15  ASC-GR-TOT-COST-DOLLARS         PIC ZZZZZZZZ9.99.02540000
023700             15  ASC-GR-TOT-DISC-AMT             PIC ZZZZZZ9.99.  02550000
023800             15  ASC-GR-TOT-NETCOST-DOLS         PIC ZZZZZZZZ9.99.02560000
023900             15  ASC-BLK-SUB                         PIC S9(04)   02570000
024000                                                         COMP     02580000
024100                                                         SYNC.    02590000
024200             15  ASC-ITEM-SUB                        PIC S9(04)   02600000
024300                                                         COMP     02610000
024400                                                         SYNC.    02620000
024500             15  ASC-SEL-SUB                         PIC S9(04)   02630000
024600                                                         COMP.    02640000
024700             15  ASC-SEL-ITEM                        PIC S9(04)   02650000
024800                                                         COMP.    02660000
024900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02670000
025000                                                         COMP-3.  02680000
025100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02690000
025200                                                         COMP-3.  02700000
025300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02710000
025400                                                         COMP-3.  02720000
025500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02730000
025600                                                         COMP-3.  02740000
025700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02750000
025800                                                         COMP-3.  02760000
025900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02770000
026000                                                         COMP-3.  02780000
026100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02790000
026200                                                         COMP     02800000
026300                                                         SYNC.    02810000
026400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02820000
026500                                                         COMP-3.  02830000
026600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02840000
026700                                                         COMP-3.  02850000
026800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02860000
026900                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 02870000
027000                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 02880000
027100             15  ASC-ITEMS-ON-TALCHRG-IND            PIC  X(01).  02890000
027200                 88  ASC-ITEMS-ON-TALCHRG              VALUE 'Y'. 02900000
027300                 88  ASC-NO-ITEMS-ON-TALCHRG           VALUE 'N'. 02910000
027400             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02920000
027500                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02930000
027600             15  ASC-DESC-LINE-IND                   PIC  X(01).  02940000
027700                 88  ASC-DESC-LINE-DONE                VALUE 'Y'. 02950000
027800             15  ASC-CORR-LINE-IND                   PIC  X(01).  02960000
027900                 88  ASC-CORR-LINE-DONE                VALUE 'Y'. 02970000
028000             15  ASC-LIST-QUEUE-NAME.                             02980000
028100                 20  ASC-LIST-TERM-ID                PIC  X(04).  02990000
028200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03000000
028300                                                         COMP-3.  03010000
028400                 20  ASC-LIST-SEQ                    PIC  9(01).  03020000
028500             15  ASC-SEL-QUEUE-NAME.                              03030000
028600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03040000
028700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03050000
028800                                                          COMP-3. 03060000
028900                 20  ASC-SEL-SEQ                     PIC  9(01).  03070000
029000             15  ASC-DTL-QUEUE-NAME.                              03080000
029100                 20  ASC-DTL-TERM-ID                 PIC  X(04).  03090000
029200                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   03100000
029300                                                         COMP-3.  03110000
029400                 20  ASC-DTL-SEQ                     PIC  9(01).  03120000
029500                                                                  03130000
029600             15  ASC-START-ITEM-REQUEST.                          03140000
029700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03150000
029800                                                                  03160000
029900     EJECT                                                        03170000
030000*---------------------------------------------------------------* 03180000
030100*    MESSAGE SELECTION TSQ B QUEUE RECORD LAYOUT.               * 03190000
030200*---------------------------------------------------------------* 03200000
030300                                                                  03210000
030400     COPY DPWS057.                                                03220004
030500                                                                  03230000
030600     EJECT                                                        03240000
030700*---------------------------------------------------------------* 03250000
030800*    ABEND PROCESSING COPYBOOK.                                 * 03260000
030900*---------------------------------------------------------------* 03270000
031000                                                                  03280000
031100     COPY DPWS013.                                                03290004
031200                                                                  03300000
031300     EJECT                                                        03310000
031400*---------------------------------------------------------------* 03320000
031500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03330000
031600*---------------------------------------------------------------* 03340000
031700                                                                  03350000
031800     COPY DPWS015.                                                03360004
031900                                                                  03370000
032000*---------------------------------------------------------------* 03380000
032100*    FUNCTION KEYS COPYBOOK.                                    * 03390000
032200*---------------------------------------------------------------* 03400000
032300                                                                  03410000
032400     COPY DPWS016.                                                03420004
032500                                                                  03430000
032600*---------------------------------------------------------------* 03440000
032700*    NUMERIC EDIT LAYOUT.                                       * 03450000
032800*---------------------------------------------------------------* 03460000
032900                                                                  03470000
033000     COPY DPWS010I.                                               03480004
033100                                                                  03490000
033200*---------------------------------------------------------------* 03500000
033300*    DATE CONVERSION ROUTINE                                    * 03510000
033400*---------------------------------------------------------------* 03520000
033500                                                                  03530000
033600     COPY DPWS500.                                                03540004
033700                                                                  03550000
033800*---------------------------------------------------------------* 03560000
033900*    MAP LAYOUT                                                 * 03570000
034000*---------------------------------------------------------------* 03580000
034100                                                                  03590000
034200     COPY POKM071.                                                03600000
034300                                                                  03610000
034400 01  MR-OCCURS-LAYOUT          REDEFINES  PO071AO.                03620000
034500     05  FILLER                PIC X(48).                         03630000
034600                                                                  03640000
034700     05  MR-PO-NBR-L            PIC S9(04) COMP.                  03650000
034800     05  MR-PO-NBR-A            PIC  X(01).                       03660000
034900     05  MR-PO-NBR-C            PIC  X(01).                       03670000
035000     05  MR-PO-NBR-H            PIC  X(01).                       03680000
C98147     05  MR-PO-NBR              PIC  X(08).                       03690013
035200                                                                  03700000
035300     05  MR-NTWK-NAME-L         PIC S9(04) COMP.                  03710000
035400     05  MR-NTWK-NAME-A         PIC  X(01).                       03720000
035500     05  MR-NTWK-NAME-C         PIC  X(01).                       03730000
035600     05  MR-NTWK-NAME-H         PIC  X(01).                       03740000
035700     05  MR-NTWK-NAME           PIC  X(05).                       03750000
035800                                                                  03760000
035900     05  MR-ORD-UNITS-L         PIC S9(04) COMP.                  03770000
036000     05  MR-ORD-UNITS-A         PIC  X(01).                       03780000
036100     05  MR-ORD-UNITS-C         PIC  X(01).                       03790000
036200     05  MR-ORD-UNITS-H         PIC  X(01).                       03800000
036300     05  MR-ORD-UNITS           PIC  X(05).                       03810000
036400                                                                  03820000
036500     05  MR-ENT-NAME-DESC-L     PIC S9(04) COMP.                  03830000
036600     05  MR-ENT-NAME-DESC-A     PIC  X(01).                       03840000
036700     05  MR-ENT-NAME-DESC-C     PIC  X(01).                       03850000
036800     05  MR-ENT-NAME-DESC-H     PIC  X(01).                       03860000
036900     05  MR-ENT-NAME-DESC       PIC  X(30).                       03870000
037000                                                                  03880000
037100     05  MR-ORD-COST-L          PIC S9(04) COMP.                  03890000
037200     05  MR-ORD-COST-A          PIC  X(01).                       03900000
037300     05  MR-ORD-COST-C          PIC  X(01).                       03910000
037400     05  MR-ORD-COST-H          PIC  X(01).                       03920000
037500     05  MR-ORD-COST            PIC  X(11).                       03930000
037600                                                                  03940000
037700     05  MR-SCROLL-AREA OCCURS 12 TIMES.                          03950000
037800         10  MR-INV-DTE-L       PIC S9(04) COMP.                  03960000
037900         10  MR-INV-DTE-A       PIC  X(01).                       03970000
038000         10  MR-INV-DTE-C       PIC  X(01).                       03980000
038100         10  MR-INV-DTE-H       PIC  X(01).                       03990000
038200         10  MR-INV-DTE         PIC  X(08).                       04000000
038300                                                                  04010000
038400         10  MR-INV-TME-L       PIC S9(04) COMP.                  04020000
038500         10  MR-INV-TME-A       PIC  X(01).                       04030000
038600         10  MR-INV-TME-C       PIC  X(01).                       04040000
038700         10  MR-INV-TME-H       PIC  X(01).                       04050000
038800         10  MR-INV-TME         PIC  X(05).                       04060000
038900                                                                  04070000
039000         10  MR-INV-NBR-L       PIC S9(04) COMP.                  04080000
039100         10  MR-INV-NBR-A       PIC  X(01).                       04090000
039200         10  MR-INV-NBR-C       PIC  X(01).                       04100000
039300         10  MR-INV-NBR-H       PIC  X(01).                       04110000
039400         10  MR-INV-NBR         PIC  X(15).                       04120000
039500                                                                  04130000
039600         10  MR-UNITS-L         PIC S9(04) COMP.                  04140000
039700         10  MR-UNITS-A         PIC  X(01).                       04150000
039800         10  MR-UNITS-C         PIC  X(01).                       04160000
039900         10  MR-UNITS-H         PIC  X(01).                       04170000
040000         10  MR-UNITS           PIC  X(05).                       04180000
040100                                                                  04190000
040200         10  MR-COST-DOL-L      PIC S9(04) COMP.                  04200000
040300         10  MR-COST-DOL-A      PIC  X(01).                       04210000
040400         10  MR-COST-DOL-C      PIC  X(01).                       04220000
040500         10  MR-COST-DOL-H      PIC  X(01).                       04230000
040600         10  MR-COST-DOL        PIC  X(11).                       04240000
040700                                                                  04250000
040800         10  MR-DISC-DOL-L      PIC S9(04) COMP.                  04260000
040900         10  MR-DISC-DOL-A      PIC  X(01).                       04270000
041000         10  MR-DISC-DOL-C      PIC  X(01).                       04280000
041100         10  MR-DISC-DOL-H      PIC  X(01).                       04290000
041200         10  MR-DISC-DOL        PIC  X(09).                       04300000
041300                                                                  04310000
041400         10  MR-NETCOST-DOL-L   PIC S9(04) COMP.                  04320000
041500         10  MR-NETCOST-DOL-A   PIC  X(01).                       04330000
041600         10  MR-NETCOST-DOL-C   PIC  X(01).                       04340000
041700         10  MR-NETCOST-DOL-H   PIC  X(01).                       04350000
041800         10  MR-NETCOST-DOL     PIC  X(11).                       04360000
041900                                                                  04370000
042000         10  MR-FACILITY-L      PIC S9(04) COMP.                  04380000
042100         10  MR-FACILITY-A      PIC  X(01).                       04390000
042200         10  MR-FACILITY-C      PIC  X(01).                       04400000
042300         10  MR-FACILITY-H      PIC  X(01).                       04410000
042400         10  MR-FACILITY        PIC  X(05).                       04420000
042500                                                                  04430000
042600     05  MR-TOT-UNITS-L         PIC S9(04) COMP.                  04440000
042700     05  MR-TOT-UNITS-A         PIC  X(01).                       04450000
042800     05  MR-TOT-UNITS-C         PIC  X(01).                       04460000
042900     05  MR-TOT-UNITS-H         PIC  X(01).                       04470000
043000     05  MR-TOT-UNITS           PIC  X(06).                       04480000
043100                                                                  04490000
043200     05  MR-TOT-COST-DOL-L      PIC S9(04) COMP.                  04500000
043300     05  MR-TOT-COST-DOL-A      PIC  X(01).                       04510000
043400     05  MR-TOT-COST-DOL-C      PIC  X(01).                       04520000
043500     05  MR-TOT-COST-DOL-H      PIC  X(01).                       04530000
043600     05  MR-TOT-COST-DOL        PIC  X(12).                       04540000
043700                                                                  04550000
043800     05  MR-TOT-DISC-DOL-L      PIC S9(04) COMP.                  04560000
043900     05  MR-TOT-DISC-DOL-A      PIC  X(01).                       04570000
044000     05  MR-TOT-DISC-DOL-C      PIC  X(01).                       04580000
044100     05  MR-TOT-DISC-DOL-H      PIC  X(01).                       04590000
044200     05  MR-TOT-DISC-DOL        PIC  X(10).                       04600000
044300                                                                  04610000
044400     05  MR-TOT-NETCOST-DOL-L   PIC S9(04) COMP.                  04620000
044500     05  MR-TOT-NETCOST-DOL-A   PIC  X(01).                       04630000
044600     05  MR-TOT-NETCOST-DOL-C   PIC  X(01).                       04640000
044700     05  MR-TOT-NETCOST-DOL-H   PIC  X(01).                       04650000
044800     05  MR-TOT-NETCOST-DOL     PIC  X(12).                       04660000
044900                                                                  04670000
045000 EJECT                                                            04680000
045100*---------------------------------------------------------------* 04690000
045200*    DB2 AREA FOR COMMUNICATIONS                                * 04700000
045300*---------------------------------------------------------------* 04710000
045400     EXEC SQL                                                     04720000
045500          INCLUDE SQLCA                                           04730000
045600     END-EXEC.                                                    04740000
045700                                                                  04750000
045800*---------------------------------------------------------------* 04760000
045900*    DB2 AREA FOR TMESSAGE                                      * 04770000
046000*---------------------------------------------------------------* 04780000
046100     EXEC SQL                                                     04790000
046200          INCLUDE TSYMSG                                          04800000
046300     END-EXEC.                                                    04810000
046400                                                                  04820000
047200*---------------------------------------------------------------* 04830000
047300*    DB2 AREA FOR INVOICE TABLE                                 * 04840000
047400*---------------------------------------------------------------* 04850000
047500     EXEC SQL                                                     04860000
047600          INCLUDE TINVOIC                                         04870000
047700     END-EXEC.                                                    04880000
047800                                                                  04890000
048600*---------------------------------------------------------------* 04900000
048700*    DB2 AREA FOR PAYMENT REQUEST ITEM TABLE                    * 04910000
048800*---------------------------------------------------------------* 04920000
048900     EXEC SQL                                                     04930000
049000          INCLUDE TPREQIT                                         04940000
049100     END-EXEC.                                                    04950000
049200                                                                  04960000
049300*---------------------------------------------------------------* 04970000
049400*    DB2 AREA FOR AP-ALLOWANCE/CHARGE TABLE                     * 04980000
049500*---------------------------------------------------------------* 04990000
049600     EXEC SQL                                                     05000000
049700          INCLUDE TALCHRG                                         05010000
049800     END-EXEC.                                                    05020000
049900                                                                  05030000
050000*---------------------------------------------------------------* 05040000
050100*    DB2 AREA FOR TRADING PARTNERSHIP TABLE                     * 05050000
050200*---------------------------------------------------------------* 05060000
050300     EXEC SQL                                                     05070000
050400          INCLUDE TTRDPRT                                         05080000
050500     END-EXEC.                                                    05090000
050600                                                                  05100000
050700*---------------------------------------------------------------* 05110000
050800*    DB2 AREA FOR TRADING PARTNER TRANSACTION SET TABLE         * 05120000
050900*---------------------------------------------------------------* 05130000
051000     EXEC SQL                                                     05140000
051100          INCLUDE TTRDTRN                                         05150000
051200     END-EXEC.                                                    05160000
051300                                                                  05170000
051400*---------------------------------------------------------------* 05180000
051500*    DB2 AREA FOR INTERCHANGE TRANSMISSION TABLE                * 05190000
051600*---------------------------------------------------------------* 05200000
051700     EXEC SQL                                                     05210000
051800          INCLUDE TINTTRN                                         05220000
051900     END-EXEC.                                                    05230000
052000                                                                  05240000
052100*---------------------------------------------------------------* 05250000
052200*    DB2 AREA FOR FUNCTION GROUP/TRAN SET TRANSMISSION TABLE    * 05260000
052300*---------------------------------------------------------------* 05270000
052400     EXEC SQL                                                     05280000
052500          INCLUDE TFGTRST                                         05290000
052600     END-EXEC.                                                    05300000
052700                                                                  05310000
052800*---------------------------------------------------------------* 05320000
052900*    DB2 AREA FOR PURCHASE ORDER HEADER                         * 05330000
053000*---------------------------------------------------------------* 05340000
053100     EXEC SQL                                                     05350000
053200          INCLUDE TPURCHS                                         05360000
053300     END-EXEC.                                                    05370000
053400                                                                  05380000
053500*---------------------------------------------------------------* 05390000
053600*    DB2 AREA FOR NETWORK TABLE                                 * 05400000
053700*---------------------------------------------------------------* 05410000
053800     EXEC SQL                                                     05420000
053900          INCLUDE TNETWRK                                         05430000
054000     END-EXEC.                                                    05440000
054100                                                                  05450000
054200*---------------------------------------------------------------* 05460000
054300*    DB2 AREA FOR LOCATION TABLE                                * 05470011
054400*---------------------------------------------------------------* 05480000
054500     EXEC SQL                                                     05490000
054600          INCLUDE XMT00001                                        05500011
054700     END-EXEC.                                                    05510000
054800                                                                  05520000
054900*---------------------------------------------------------------* 05530000
055000*    INVOICE CURSOR                                             * 05540000
055100*---------------------------------------------------------------* 05550000
055200                                                                  05560000
055300     EXEC SQL                                                     05570000
055400          DECLARE INV_CURSOR CURSOR FOR                           05580000
055500          SELECT                                                  05590000
055600              B.PAYT_REQ_SEQ_NBR,                                 05600012
055700              B.INVC_ID,                                          05610000
055800              B.STR_NBR,                                          05620000
055900              B.GRO_COST_AMT                                      05630000
056000          FROM                                                    05640000
056200              TINVOIC B                                           05650000
056300          WHERE B.PO_NBR           = :PV-PO-NBR-COMP              05660012
056500            AND B.ENTR_MTHD_CDE    = 'ED'                         05670000
056600            AND NOT B.STATUS_CDE   = 'DE'                         05680000
056700     END-EXEC.                                                    05690000
056800                                                                  05700000
056900*---------------------------------------------------------------* 05710000
057000*    DISCOUNT PERCENTAGE CURSOR                                 * 05720000
057100*---------------------------------------------------------------* 05730000
057200                                                                  05740000
057300     EXEC SQL                                                     05750000
057400          DECLARE PCT_CURSOR CURSOR FOR                           05760000
057500          SELECT ALW_CHRG_PCT,                                    05770000
057600                 ALW_CHRG_AMT                                     05780000
057700          FROM TALCHRG                                            05790000
057800          WHERE PO_NBR           = :PV-PO-NBR-COMP                05800006
                  AND INVC_ID          = :INVOIC-INVC-ID                05810006
057900            AND ALW_CHRG_TYP_CDE = 'A'                            05820000
058000     END-EXEC.                                                    05830000
058100                                                                  05840000
058200*---------------------------------------------------------------* 05850000
058300*    EDI DATE/TIME RETRIEVAL CURSOR                             * 05860000
058400*---------------------------------------------------------------* 05870000
058500                                                                  05880000
058600     EXEC SQL                                                     05890000
058700          DECLARE EDI_CURSOR CURSOR FOR                           05900000
058800          SELECT                                                  05910000
058900              C.MAILBOX_PU_DTE,                                   05920000
059000              C.MAILBOX_PU_TME                                    05930000
059100          FROM                                                    05940000
059200              TTRDPRT A,                                          05950000
059300              TTRDTRN B,                                          05960000
059400              TINTTRN C,                                          05970000
059500              TFGTRST D,                                          05980000
059600              TPURCHS E,                                          05990000
059700              TINVOIC F                                           06000012
059800          WHERE E.PO_NBR         = :PV-PO-NBR-COMP    AND         06010000
                      E.PO_NBR         = F.PO_NBR           AND         06020012
059900                E.VER_STATUS_CDE = 'A'                AND         06030000
060000                A.ENT_ID         = E.ENT_ID           AND         06040000
060100                B.TP_DKEY        = A.TP_DKEY          AND         06050000
060200                B.TRAN_SET_CDE   = '810'              AND         06060000
060300                B.DIR_IND        = 'R'                AND         06070000
060400                B.INACTV_DTE     > CURRENT DATE       AND         06080000
060500                C.TP_DKEY        = A.TP_DKEY          AND         06090000
060600                C.DIR_IND        = 'R'                AND         06100000
060700                D.TP_DKEY        = C.TP_DKEY          AND         06110000
060800                D.TP_DKEY_TMST   = C.TP_DKEY_TMST     AND         06120000
060900                D.TRN_DTL_TXT    = :ASC-KEY-INV-NBR   AND         06130000
061000                D.TRN_SET_CDE    = '810'              AND         06140000
061100                F.PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR     06150012
061200                                                      AND         06160000
061300                F.CRE_DTE        >= C.MAILBOX_PU_DTE              06170012
061400          ORDER BY C.MAILBOX_PU_DTE DESC,                         06180000
061500                   C.MAILBOX_PU_TME DESC                          06190000
061600     END-EXEC.                                                    06200000
061700                                                                  06210000
061800 EJECT                                                            06220000
061900 LINKAGE SECTION.                                                 06230000
062000                                                                  06240000
062100 01  DFHCOMMAREA.                                                 06250000
062200     05  FILLER                         OCCURS  1 TO 4072 TIMES   06260000
062300                                        DEPENDING ON EIBCALEN.    06270000
062400         10  FILLER                     PIC X.                    06280000
062500                                                                  06290000
062600 EJECT                                                            06300000
062700 PROCEDURE DIVISION.                                              06310000
062800                                                                  06320000
062900 0000-MAIN-MODULE.                                                06330000
063000                                                                  06340000
063100     INITIALIZE DP030-CICS-API-FIELDS.                            06350000
063200     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        06360000
063300     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           06370000
063400     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          06380000
063500     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        06390000
063600     MOVE LENGTH OF PO071AI       TO DP030-MAP-LENGTH (1).        06400000
063700     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      06410000
063800     PERFORM 9000-CALL-CICS-ARCH-API.                             06420000
063900                                                                  06430000
064000     PERFORM 1000-CONTROL-PROCESSING.                             06440000
064100                                                                  06450000
064200     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      06460000
064300     PERFORM 9000-CALL-CICS-ARCH-API.                             06470000
064400                                                                  06480000
064500*----------------------------------------------------------------*06490000
064600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *06500000
064700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *06510000
064800*----------------------------------------------------------------*06520000
064900                                                                  06530000
065000 1000-CONTROL-PROCESSING.                                         06540000
065100                                                                  06550000
065200     EVALUATE TRUE                                                06560000
065300         WHEN DP020-NEXT-ACT-INITIAL                              06570000
065400             INITIALIZE ASC-SPECIFIC-COMMAREA                     06580000
065500             MOVE SPACE             TO ASC-START-ITEM-REQUEST     06590000
065600             MOVE EIBTRMID          TO ASC-DTL-TERM-ID            06600000
065700             MOVE DP020-SRC-TASK-NUMBER                           06610000
065800                                    TO ASC-DTL-TASK-NUMBER        06620000
065900             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                06630000
066000             PERFORM 2050-DELETE-DETAIL-QUEUE                     06640000
066100             PERFORM 4000-BUILD-INITIAL-PANEL                     06650000
066200                                                                  06660000
066300         WHEN DP020-NEXT-ACT-READ-MAP                             06670000
066400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06680000
066500                               TO PV-TOP-ITEM                     06690000
066600             PERFORM 2000-PROCESS-PANEL                           06700000
066700                                                                  06710000
066800         WHEN DP020-NEXT-ACT-RETURN                               06720000
066900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06730000
067000                               TO PV-TOP-ITEM                     06740000
067100             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        06750000
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06760000
067300                                                                  06770000
067400         WHEN OTHER                                               06780000
067500             SET DP013-LOGIC-ABEND TO TRUE                        06790000
067600             SET DP013-NO-ROLLBACK TO TRUE                        06800000
067700             MOVE '1000-CONTROL-PROCESSING'                       06810000
067800                               TO  DP013-PARAGRAPH                06820000
067900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06830000
068000                               TO  DP013-MESSAGE-TEXT(1)          06840000
068100             PERFORM DP013-0000-PROCESS-ABEND                     06850000
068200     END-EVALUATE.                                                06860000
068300                                                                  06870000
068400 EJECT                                                            06880000
068500*----------------------------------------------------------------*06890000
068600*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *06900000
068700*    ON WHAT FUNCTION KEY WAS SELECTED.                          *06910000
068800*----------------------------------------------------------------*06920000
068900                                                                  06930000
069000 2000-PROCESS-PANEL.                                              06940000
069100                                                                  06950000
069200     EVALUATE TRUE                                                06960000
069300         WHEN DP020-SRC-AID = DP016-CLEAR                         06970000
069400             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06980000
069500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06990000
069600             PERFORM 3200-RESET-ATTRIBUTES                        07000000
069700                                                                  07010000
069800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07020000
069900             PERFORM 2050-DELETE-DETAIL-QUEUE                     07030000
070000             PERFORM 4000-BUILD-INITIAL-PANEL                     07040000
070100             PERFORM 3200-RESET-ATTRIBUTES                        07050000
070200                                                                  07060000
070300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07070000
070400             MOVE +1 TO PV-TOP-ITEM                               07080000
070500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07090000
070600             PERFORM 3200-RESET-ATTRIBUTES                        07100000
070700                                                                  07110000
070800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07120000
070900             PERFORM 2110-BROWSE-BACKWARD                         07130000
071000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07140000
071100             PERFORM 3200-RESET-ATTRIBUTES                        07150000
071200                                                                  07160000
071300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07170000
071400             PERFORM 2120-BROWSE-FORWARD                          07180000
071500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07190000
071600             PERFORM 3200-RESET-ATTRIBUTES                        07200000
071700                                                                  07210000
071800         WHEN DP020-SRC-AID = DP016-ENTER                         07220000
071900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07230000
072000             IF  PS-ERROR                                         07240000
072100                 CONTINUE                                         07250000
072200             ELSE                                                 07260000
072300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07270000
072400                 PERFORM 3200-RESET-ATTRIBUTES                    07280000
072500             END-IF                                               07290000
072600                                                                  07300000
072700         WHEN OTHER                                               07310000
072800             SET DP013-NO-ROLLBACK TO TRUE                        07320000
072900             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               07330000
073000             SET DP013-CICS-ABEND TO TRUE                         07340000
073100             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    07350000
073200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07360000
073300                                   TO DP013-MESSAGE-TEXT (1)      07370000
073400             PERFORM DP013-0000-PROCESS-ABEND                     07380000
073500                                                                  07390000
073600     END-EVALUATE.                                                07400000
073700 EJECT                                                            07410000
073800*----------------------------------------------------------------*07420000
073900*    DELETE THE TEMPORARY STORAGE QUEUE.                         *07430000
074000*----------------------------------------------------------------*07440000
074100                                                                  07450000
074200 2050-DELETE-DETAIL-QUEUE.                                        07460000
074300                                                                  07470000
074400     EXEC CICS                                                    07480000
074500         DELETEQ TS                                               07490000
074600             QUEUE (ASC-DTL-QUEUE-NAME)                           07500000
074700             RESP  (PV-CICS-RESP)                                 07510000
074800     END-EXEC.                                                    07520000
074900                                                                  07530000
075000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07540000
075100        (PV-CICS-RESP = DFHRESP(QIDERR))                          07550000
075200         CONTINUE                                                 07560000
075300     ELSE                                                         07570000
075400         SET DP013-CICS-ABEND TO TRUE                             07580000
075500         SET DP013-NO-ROLLBACK TO TRUE                            07590000
075600                                                                  07600000
075700         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       07610000
075800         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  07620000
075900                        TO DP013-MESSAGE-TEXT (1)                 07630000
076000         PERFORM DP013-0000-PROCESS-ABEND                         07640000
076100     END-IF.                                                      07650000
076200                                                                  07660000
076300     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        07670000
076400 EJECT                                                            07680000
076500*----------------------------------------------------------------*07690000
076600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07700000
076700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07710000
076800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07720000
076900*    MESSAGE.                                                    *07730000
077000*----------------------------------------------------------------*07740000
077100                                                                  07750000
077200 2110-BROWSE-BACKWARD.                                            07760000
077300                                                                  07770000
077400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07780000
077500         GIVING PV-TOP-ITEM.                                      07790000
077600                                                                  07800000
077700     IF  PV-TOP-ITEM < +1                                         07810000
077800         MOVE +1              TO PV-TOP-ITEM                      07820000
077900*        -- TOP OF LIST --                                        07830000
078000         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 07840000
078100         SET DP020-MSG-INFORMATIONAL TO TRUE                      07850000
078200     END-IF.                                                      07860000
078300                                                                  07870000
078400 EJECT                                                            07880000
078500                                                                  07890000
078600*----------------------------------------------------------------*07900000
078700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07910000
078800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07920000
078900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07930000
079000*----------------------------------------------------------------*07940000
079100                                                                  07950000
079200 2120-BROWSE-FORWARD.                                             07960000
079300                                                                  07970000
079400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07980000
079500         GIVING PV-TOP-ITEM.                                      07990000
079600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08000000
079700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08010000
079800                                   TO PV-TOP-ITEM                 08020000
079900*        -- BOTTOM OF LIST --                                     08030000
080000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08040000
080100         SET DP020-MSG-INFORMATIONAL                              08050000
080200                                   TO TRUE                        08060000
080300     ELSE                                                         08070000
080400         COMPUTE PV-BOTTOM-ITEM =                                 08080000
080500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08090000
080600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08100000
080700*            -- BOTTOM OF LIST --                                 08110000
080800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08120000
080900             SET DP020-MSG-INFORMATIONAL                          08130000
081000                                   TO TRUE                        08140000
081100         END-IF                                                   08150000
081200     END-IF.                                                      08160000
081300 EJECT                                                            08170000
081400*----------------------------------------------------------------*08180000
081500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08190000
081600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08200000
081700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08210000
081800*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *08220000
081900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08230000
082000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08240000
082100*----------------------------------------------------------------*08250000
082200                                                                  08260000
082300 2130-CHECK-FOR-JUMP-BROWSE.                                      08270000
082400                                                                  08280000
082500     IF ASTRTITL > ZERO                                           08290000
082600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      08300000
082700     ELSE                                                         08310000
082800         IF ASTRTITF = DP015-ERASE-EOF                            08320000
082900             INITIALIZE ASC-START-ITEM-REQUEST                    08330000
083000         END-IF                                                   08340000
083100     END-IF.                                                      08350000
083200                                                                  08360000
083300     SET PS-NO-ERROR               TO TRUE.                       08370000
083400     IF (ASC-START-ITEM-REQUEST = SPACE)                          08380000
083500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08390000
083600                                   TO PV-TOP-ITEM                 08400000
083700     ELSE                                                         08410000
083800         MOVE ASC-START-ITEM-REQUEST                              08420000
083900                                   TO DP010I-UNEDITED-FIELD       08430000
084000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08440000
084100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08450000
084200         SET DP010I-NEGATIVE-NOT-ALLOWED                          08460000
084300                                   TO TRUE                        08470000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08481014
264230                         USING DP010I-NUMERIC-EDIT-AREA           08482014
084500                                                                  08490000
084600         IF  NOT DP010I-ERROR-DETECTED                            08500000
084700             MOVE DP010I-NUMERIC-FIELD                            08510000
084800                                   TO  ASC-START-ITEM-REQUEST-N   08520000
084900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08530000
085000                 IF  ASC-START-ITEM-REQUEST-N >                   08540000
085100                                          ASC-NUMBER-OF-ITEMS-READ08550000
085200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08560000
085300                     COMPUTE PV-TOP-ITEM =                        08570000
085400                             ASC-NUMBER-OF-ITEMS-READ             08580000
085500                             - PC-ITEMS-PER-PANEL + 1             08590000
085600                     IF  PV-TOP-ITEM < +1                         08600000
085700                         MOVE +1   TO PV-TOP-ITEM                 08610000
085800                         MOVE PC-TSYMSG-00070                     08620000
085900                                   TO DP020-MSG-NUMBER            08630000
086000                         SET DP020-MSG-INFORMATIONAL              08640000
086100                                   TO TRUE                        08650000
086200                     END-IF                                       08660000
086300                 ELSE                                             08670000
086400                     MOVE ASC-START-ITEM-REQUEST-N                08680000
086500                                   TO PV-TOP-ITEM                 08690000
086600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08700000
086700                     COMPUTE PV-BOTTOM-ITEM =                     08710000
086800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08720000
086900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08730000
087000*                        -- BOTTOM OF LIST --                     08740000
087100                         MOVE PC-TSYMSG-00070                     08750000
087200                                   TO DP020-MSG-NUMBER            08760000
087300                         SET DP020-MSG-INFORMATIONAL              08770000
087400                                   TO TRUE                        08780000
087500                     END-IF                                       08790000
087600                 END-IF                                           08800000
087700             ELSE                                                 08810000
087800*                --- VALUE OUT OF RANGE ----                      08820000
087900                 MOVE PC-TSYMSG-00101                             08830000
088000                                   TO DP020-MSG-NUMBER            08840000
088100                 MOVE -1           TO ASTRTITL                    08850000
088200                 SET DP030-SET-CURSOR-APPL-1                      08860000
088300                                   TO TRUE                        08870000
088400                 MOVE DP015-REVERSE                               08880000
088500                                   TO ASTRTITH                    08890000
088600                 MOVE DP015-RED    TO ASTRTITC                    08900000
088700                 MOVE DP015-UNP-NUM-BRT-MDT                       08910000
088800                                   TO ASTRTITA                    08920000
088900                 SET DP020-MSG-FATAL                              08930000
089000                                   TO TRUE                        08940000
089100                 SET PS-ERROR      TO TRUE                        08950000
089200             END-IF                                               08960000
089300                                                                  08970000
089400         ELSE                                                     08980000
089500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08990000
089600             MOVE -1               TO ASTRTITL                    09000000
089700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09010000
089800             MOVE DP015-REVERSE    TO ASTRTITH                    09020000
089900             MOVE DP015-RED        TO ASTRTITC                    09030000
090000             MOVE DP015-UNP-NUM-BRT-MDT                           09040000
090100                                   TO ASTRTITA                    09050000
090200             SET DP020-MSG-FATAL   TO TRUE                        09060000
090300             SET PS-ERROR          TO TRUE                        09070000
090400         END-IF                                                   09080000
090500     END-IF.                                                      09090000
090600 EJECT                                                            09100000
090700                                                                  09110000
090800*----------------------------------------------------------------*09120000
090900*    RESET ATTRIBUTES.                                           *09130000
091000*----------------------------------------------------------------*09140000
091100                                                                  09150000
091200 3200-RESET-ATTRIBUTES.                                           09160000
091300                                                                  09170000
091400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   09180000
091500     MOVE DP015-GREEN              TO ASTRTITC.                   09190000
091600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   09200000
091700     MOVE -1                       TO ASTRTITL.                   09210000
091800     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       09220000
091900                                                                  09230000
092000 EJECT                                                            09240000
092100                                                                  09250000
092200*----------------------------------------------------------------*09260000
092300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *09270000
092400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *09280000
092500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *09290000
092600*    DISPLAY THE PANEL TO USER.                                  *09300000
092700*----------------------------------------------------------------*09310000
092800                                                                  09320000
092900 4000-BUILD-INITIAL-PANEL.                                        09330000
093000                                                                  09340000
093100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            09350000
093200                                 ASC-BLOCK-ENTRIES (2).           09360000
093300     SET ASC-ITEMS-LEFT-ON-DB                                     09370000
093400                             TO  TRUE.                            09380000
093500                                                                  09390000
093600     MOVE +0                 TO  ASC-NUMBER-OF-ITEMS-READ         09400000
093700                                 ASC-NUMBER-OF-SELECTED-ITEMS     09410000
093800                                 ASC-HIGHEST-BLOCK-WRITTEN        09420000
093900                                 ASC-START-OF-SELECTED-RANGE      09430000
094000                                 ASC-END-OF-SELECTED-RANGE        09440000
094100                                 ASC-ITEM-AT-TOP-OF-PANEL.        09450000
094200                                                                  09460000
094300     MOVE SPACE                  TO  ASC-DESC-LINE-IND            09470000
094400                                     ASC-CORR-LINE-IND.           09480000
094500                                                                  09490000
094600     MOVE ZEROES                 TO  PV-GR-TOT-UNITS              09500000
094700                                     PV-SORT-TABLE-CTR            09510000
094800                                     PV-GR-TOT-DISC-AMT           09520000
094900                                     PV-GR-TOT-NETCOST-DOLS       09530000
095000                                     PV-GR-TOT-COST-DOLLARS.      09540000
095100                                                                  09550000
095200     MOVE PO017-PO-NBR            TO PV-PO-NBR-COMP               09560000
095300                                     ASC-KEY-PO-NUMBER.           09570000
095400     MOVE PO017-ENT-NAME-DESC     TO ASC-ENT-NAME-DESC.           09580000
095500                                                                  09590000
095600     PERFORM 4100-SELECT-NETWORK-NAME.                            09600000
095700     PERFORM 4150-SELECT-ORDER-UNITS-COST.                        09610000
095800                                                                  09620000
095900     PERFORM 4200-OPEN-INV-CURSOR.                                09630000
096000     PERFORM 4210-READ-ITEMS-FROM-DB.                             09640000
096100     PERFORM 4230-CLOSE-INV-CURSOR.                               09650000
096200                                                                  09660000
096300     MOVE +1                 TO  PV-TOP-ITEM.                     09670000
096400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          09680000
096500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    09690000
096600         SET DP020-MSG-FATAL   TO  TRUE                           09700000
096700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               09710000
096800     ELSE                                                         09720000
096900         MOVE -1             TO ASTRTITL                          09730000
097000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      09740000
097100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09750000
097200     END-IF.                                                      09760000
097300 EJECT                                                            09770000
097400                                                                  09780000
097500*----------------------------------------------------------------*09790000
097600*    SELECT TNETWRK TABLE TO RETRIEVE THE NETWORK NAME & ID      *09800000
097700*----------------------------------------------------------------*09810000
097800 4100-SELECT-NETWORK-NAME.                                        09820000
097900                                                                  09830000
098000     EXEC SQL                                                     09840000
098100         SELECT DISTINCT C.NETWK_ID, C.NETWK_NME                  09850000
098200           INTO :NETWRK-NETWK-ID,                                 09860000
098300                :NETWRK-NETWK-NME                                 09870000
098400           FROM TPURCHS A,                                        09880000
098500                TTRDPRT B,                                        09890000
098600                TNETWRK C                                         09900000
098700           WHERE A.PO_NBR           = :PV-PO-NBR-COMP             09910000
098800             AND A.VER_STATUS_CDE   = 'A'                         09920000
098900             AND A.ENT_ID           = B.ENT_ID                    09930000
099000             AND B.NETWK_ID         = C.NETWK_ID                  09940000
099100     END-EXEC.                                                    09950000
099200                                                                  09960000
099300     EVALUATE TRUE                                                09970000
099400         WHEN SQLCODE = +0                                        09980000
099500             MOVE NETWRK-NETWK-NME TO ASC-NETWK-NAME              09990000
099600         WHEN SQLCODE = +100                                      10000000
099700             MOVE SPACES           TO ASC-NETWK-NAME              10010000
099600         WHEN SQLCODE = -811                                      10020008
099700             MOVE 'MULTI'          TO ASC-NETWK-NAME              10030007
099800         WHEN SQLCODE = -904                                      10040000
099900         WHEN SQLCODE = -911                                      10050000
100000         WHEN SQLCODE = -913                                      10060000
100100              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       10070000
100200              SET PS-ERROR                                        10080000
100300                  DP020-NEXT-ACT-APPL-ERROR                       10090000
100400                  DP020-MSG-FATAL                                 10100000
100500                      TO TRUE                                     10110000
100600              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 10120000
100700              PERFORM 9000-CALL-CICS-ARCH-API                     10130000
100800                                                                  10140000
100900         WHEN SQLWARN0 NOT = SPACES                               10150000
101000         WHEN SQLCODE < +0                                        10160000
101100         WHEN SQLCODE > +0                                        10170000
101200              MOVE '4100-SELECT-NETWORK-NAME'                     10180000
101300                              TO DP013-PARAGRAPH                  10190000
101400              MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'               10200007
101500                              TO DP013-MESSAGE-TEXT (1)           10210000
101600              MOVE SQLCA      TO DP013-SQLCA                      10220000
101700              MOVE 'TTRDPRT ' TO DP013-DB2-TABLE-NAME (1)         10230007
101700              MOVE 'TNETWRK ' TO DP013-DB2-TABLE-NAME (2)         10240007
101800              SET DP013-DB2-ABEND                                 10250000
101900                  DP013-XCTL-DISPLAY-RESTART                      10260000
102000                              TO TRUE                             10270000
102100              PERFORM DP013-0000-PROCESS-ABEND                    10280000
102200     END-EVALUATE.                                                10290000
102300                                                                  10300000
102400*----------------------------------------------------------------*10310000
102500*    RETRIEVES THE ORDERED AMOUNT AND ORDERED COST FROM THE       10320000
102600*    TPURCHS TABLE                                                10330000
102700*----------------------------------------------------------------*10340000
102800                                                                  10350000
102900 4150-SELECT-ORDER-UNITS-COST.                                    10360000
103000                                                                  10370000
103100     EXEC SQL                                                     10380000
103200         SELECT TOT_UNT_QTY,                                      10390000
103300                TOT_VAL_COST_AMT                                  10400000
103400           INTO :PURCHS-TOT-UNT-QTY,                              10410000
103500                :PURCHS-TOT-VAL-COST-AMT                          10420000
103600           FROM TPURCHS                                           10430000
103700           WHERE PO_NBR             = :PV-PO-NBR-COMP             10440000
103800             AND VER_STATUS_CDE     = 'A'                         10450000
103900             AND PO_CATEG_CDE       = 'MR'                        10460000
104000     END-EXEC.                                                    10470000
104100                                                                  10480000
104200     EVALUATE TRUE                                                10490000
104300         WHEN SQLCODE = +0                                        10500000
104400             MOVE PURCHS-TOT-UNT-QTY TO ASC-ORDERED-UNITS         10510000
104500             MOVE PURCHS-TOT-VAL-COST-AMT TO ASC-ORDERED-COST     10520000
104600         WHEN SQLCODE = +100                                      10530000
104700             MOVE ZEROES             TO ASC-ORDERED-UNITS         10540000
104800                                        ASC-ORDERED-COST          10550000
104900         WHEN SQLCODE = -904                                      10560000
105000         WHEN SQLCODE = -911                                      10570000
105100         WHEN SQLCODE = -913                                      10580000
105200              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       10590000
105300              SET PS-ERROR                                        10600000
105400                  DP020-NEXT-ACT-APPL-ERROR                       10610000
105500                  DP020-MSG-FATAL                                 10620000
105600                      TO TRUE                                     10630000
105700              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 10640000
105800              PERFORM 9000-CALL-CICS-ARCH-API                     10650000
105900                                                                  10660000
106000         WHEN SQLWARN0 NOT = SPACES                               10670000
106100         WHEN SQLCODE < +0                                        10680000
106200         WHEN SQLCODE > +0                                        10690000
106300              MOVE '4150-SELECT-ORDER-UNITS-COST'                 10700000
106400                              TO DP013-PARAGRAPH                  10710000
106500              MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'               10720000
106600                              TO DP013-MESSAGE-TEXT (1)           10730000
106700              MOVE SQLCA      TO DP013-SQLCA                      10740000
106800              MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)         10750000
106900              SET DP013-DB2-ABEND                                 10760000
107000                  DP013-XCTL-DISPLAY-RESTART                      10770000
107100                              TO TRUE                             10780000
107200              PERFORM DP013-0000-PROCESS-ABEND                    10790000
107300     END-EVALUATE.                                                10800000
107400                                                                  10810000
107500*----------------------------------------------------------------*10820000
107600*    OPEN THE INV CURSOR                                          10830000
107700*----------------------------------------------------------------*10840000
107800 4200-OPEN-INV-CURSOR.                                            10850000
107900                                                                  10860000
108000     EXEC SQL                                                     10870000
108100          OPEN INV_CURSOR                                         10880000
108200     END-EXEC                                                     10890000
108300                                                                  10900000
108400     EVALUATE TRUE                                                10910000
108500         WHEN SQLCODE = ZERO                                      10920000
108600                 CONTINUE                                         10930000
108700                                                                  10940000
108800         WHEN SQLCODE = -904                                      10950000
108900         WHEN SQLCODE = -911                                      10960000
109000         WHEN SQLCODE = -913                                      10970000
109100              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       10980000
109200              SET PS-ERROR                                        10990000
109300                  DP020-NEXT-ACT-APPL-ERROR                       11000000
109400                  DP020-MSG-FATAL                                 11010000
109500                      TO TRUE                                     11020000
109600              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 11030000
109700              PERFORM 9000-CALL-CICS-ARCH-API                     11040000
109800                                                                  11050000
109900         WHEN SQLWARN0 NOT = SPACES                               11060000
110000         WHEN SQLCODE < ZERO                                      11070000
110100         WHEN SQLCODE > ZERO                                      11080000
110200             MOVE '4200-OPEN-INV-CURSOR'                          11090000
110300                               TO DP013-PARAGRAPH                 11100000
110400             MOVE 'OPEN INV CURSOR - '                            11110000
110500                               TO DP013-MESSAGE-TEXT (1)          11120000
110600             MOVE SQLCA        TO DP013-SQLCA                     11130000
110700             SET DP013-DB2-ABEND                                  11140000
110800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11150000
110900             PERFORM DP013-0000-PROCESS-ABEND                     11160000
111000     END-EVALUATE.                                                11170000
111100                                                                  11180000
111200*----------------------------------------------------------------*11190000
111300*    THIS PARAGRAPH FETCHES ALL ROWS FROM THE INV CURSOR          11200000
111400*    AND WRITES THEM OUT TO THE SCREEN.                           11210000
111500*----------------------------------------------------------------*11220000
111600                                                                  11230000
111700 4210-READ-ITEMS-FROM-DB.                                         11240000
111800                                                                  11250000
111900     PERFORM                                                      11260000
112000         VARYING PV-READ-COUNT                                    11270000
112100         FROM 1 BY 1                                              11280000
112200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    11290000
112300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         11300000
112400                                                                  11310000
112500         PERFORM 4220-FETCH-INV-CURSOR                            11320000
112600                                                                  11330000
112700         IF  ASC-ITEMS-LEFT-ON-DB                                 11340000
112800             ADD +1                TO PV-SORT-TABLE-CTR           11350000
112900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    11360000
113000                                                                  11370000
113300             PERFORM 4300-RETRIEVE-STORE-NAME                     11380000
113400             PERFORM 4310-REFORMAT-INVOICE-NUMBER                 11390000
113500             PERFORM 4320-RETRIEVE-DATE-TIME                      11400000
113600             PERFORM 4330-OUTPUT-DATE-TIME                        11410000
113700             PERFORM 4340-RETRIEVE-UNITS                          11420000
113800             PERFORM 4350-OPEN-PCT-CURSOR                         11430000
113900             PERFORM 4360-PROCESS-PCT-CURSOR                      11440000
114000             PERFORM 4370-CLOSE-PCT-CURSOR                        11450000
114100                                                                  11460000
114200             SUBTRACT PV-TOTAL-DISCOUNT-AMT FROM                  11470000
114300               INVOIC-GRO-COST-AMT GIVING PV-NETCOST-DOLS         11480000
114400                                                                  11490000
114500             ADD PV-NETCOST-DOLS TO PV-GR-TOT-NETCOST-DOLS        11500000
114600                                                                  11510000
114700             MOVE INVOIC-INVC-ID                                  11520000
114800               TO PV-SORT-INVC-NBR         (PV-SORT-TABLE-CTR)    11530000
114900             MOVE PV-UNITS                                        11540000
115000               TO PV-SORT-UNITS            (PV-SORT-TABLE-CTR)    11550000
115100             MOVE INVOIC-GRO-COST-AMT                             11560000
115200               TO PV-SORT-COST-DOLLARS     (PV-SORT-TABLE-CTR)    11570000
115300             MOVE PV-TOTAL-DISCOUNT-AMT                           11580000
115400               TO PV-SORT-DISC-DOLLARS     (PV-SORT-TABLE-CTR)    11590000
115500             MOVE PV-NETCOST-DOLS                                 11600000
115600               TO PV-SORT-NETCOST-DOLS     (PV-SORT-TABLE-CTR)    11610000
115700             MOVE PV-FACILITY                                     11620000
115800               TO PV-SORT-FACILITY         (PV-SORT-TABLE-CTR)    11630000
115900                                                                  11640000
116000             IF PV-SORT-TABLE-CTR = PC-MAX-TABLE                  11650000
116100                 SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE              11660000
116200*                --- TABLE EXCEEDED ----                          11670000
116300                 MOVE PC-TSYMSG-00994  TO DP020-MSG-NUMBER        11680000
116400                 SET DP020-MSG-INFORMATIONAL TO TRUE              11690000
116500             END-IF                                               11700000
116600         END-IF                                                   11710000
116700     END-PERFORM.                                                 11720000
116800                                                                  11730000
116900     PERFORM 4380-SORT-BY-EDI-DATE-TIME.                          11740000
117000     PERFORM 4390-FILL-ASC-COMMAREA.                              11750000
117100                                                                  11760000
117200     MOVE PV-GR-TOT-UNITS        TO ASC-GR-TOT-UNITS.             11770000
117300     MOVE PV-GR-TOT-COST-DOLLARS TO ASC-GR-TOT-COST-DOLLARS.      11780000
117400     MOVE PV-GR-TOT-NETCOST-DOLS TO ASC-GR-TOT-NETCOST-DOLS.      11790000
117500     MOVE PV-GR-TOT-DISC-AMT     TO ASC-GR-TOT-DISC-AMT.          11800000
117600                                                                  11810000
117700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          11820000
117800         MOVE +1               TO ASC-BLK-SUB                     11830000
117900         PERFORM 5100-WRITE-TEMP-STORAGE                          11840000
118000         ADD +1                TO ASC-BLK-SUB                     11850000
118100         PERFORM 5100-WRITE-TEMP-STORAGE                          11860000
118200                                                                  11870000
118300         MOVE 1                TO ASC-BLK-SUB                     11880000
118400                                  PV-BLOCK-NUMBER                 11890000
118500         PERFORM 4410-READ-TEMP-STORAGE                           11900000
118600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             11910000
118700             MOVE 2            TO ASC-BLK-SUB                     11920000
118800                                  PV-BLOCK-NUMBER                 11930000
118900             PERFORM 4410-READ-TEMP-STORAGE                       11940000
119000         END-IF                                                   11950000
119100     END-IF.                                                      11960000
119200 EJECT                                                            11970000
119300                                                                  11980000
119400*----------------------------------------------------------------*11990000
119500*    FETCH INV CURSOR.                                            12000000
119600*----------------------------------------------------------------*12010000
119700 4220-FETCH-INV-CURSOR.                                           12020000
119800                                                                  12030000
119900     EXEC SQL                                                     12040000
120000         FETCH INV_CURSOR                                         12050000
120100          INTO :INVOIC-PAYT-REQ-SEQ-NBR,                          12060012
120200               :INVOIC-INVC-ID,                                   12070000
120300               :INVOIC-STR-NBR,                                   12080000
120400               :INVOIC-GRO-COST-AMT                               12090000
120500     END-EXEC.                                                    12100000
120600                                                                  12110000
120700     EVALUATE TRUE                                                12120000
120800         WHEN SQLCODE = ZERO                                      12130000
120900             ADD INVOIC-GRO-COST-AMT TO PV-GR-TOT-COST-DOLLARS    12140000
121000         WHEN SQLCODE = +100                                      12150000
121100              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 12160000
121200         WHEN SQLCODE = -904                                      12170000
121300         WHEN SQLCODE = -911                                      12180000
121400         WHEN SQLCODE = -913                                      12190000
121500              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       12200000
121600              SET PS-ERROR                                        12210000
121700                  DP020-NEXT-ACT-APPL-ERROR                       12220000
121800                  DP020-MSG-FATAL                                 12230000
121900                      TO TRUE                                     12240000
122000              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 12250000
122100              PERFORM 9000-CALL-CICS-ARCH-API                     12260000
122200                                                                  12270000
122300         WHEN SQLWARN0 NOT = SPACE                                12280000
122400         WHEN SQLCODE NOT = ZERO                                  12290000
122500              MOVE '4220-FETCH-INV-CURSOR'                        12300000
122600                                   TO DP013-PARAGRAPH             12310000
122700              MOVE 'FETCH INV CURSOR'                             12320000
122800                                   TO DP013-MESSAGE-TEXT (1)      12330000
122900              MOVE SQLCA           TO DP013-SQLCA                 12340000
123000              SET DP013-DB2-ABEND                                 12350000
123100                                   TO TRUE                        12360000
123200              PERFORM DP013-0000-PROCESS-ABEND                    12370000
123300     END-EVALUATE.                                                12380000
123400                                                                  12390000
123500*----------------------------------------------------------------*12400000
123600*    CLOSE INV CURSOR.                                            12410000
123700*----------------------------------------------------------------*12420000
123800                                                                  12430000
123900 4230-CLOSE-INV-CURSOR.                                           12440000
124000                                                                  12450000
124100     EXEC SQL                                                     12460000
124200         CLOSE INV_CURSOR                                         12470000
124300     END-EXEC.                                                    12480000
124400                                                                  12490000
124500     EVALUATE TRUE                                                12500000
124600         WHEN SQLCODE = ZERO                                      12510000
124700             CONTINUE                                             12520000
124800         WHEN SQLWARN0 NOT = SPACES                               12530000
124900         WHEN SQLCODE < ZERO                                      12540000
125000         WHEN SQLCODE > ZERO                                      12550000
125100             MOVE '4230-CLOSE-INV-CURSOR'                         12560000
125200                                   TO DP013-PARAGRAPH             12570000
125300             MOVE 'CLOSE INV CURSOR '                             12580000
125400                                   TO DP013-MESSAGE-TEXT (1)      12590000
125500             MOVE SQLCA            TO DP013-SQLCA                 12600000
125600             SET DP013-DB2-ABEND                                  12610000
125700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12620000
125800             PERFORM DP013-0000-PROCESS-ABEND                     12630000
125900     END-EVALUATE.                                                12640000
126000                                                                  12650000
126100*----------------------------------------------------------------*12660000
126200*    VERIFY THE STORE NUMBER EXISTS. IF SO, THE STORE NAME IS    *12670000
126300*    EXTRACTED. IF NOT, 'UNK' IS MOVED TO THE SCREEN.            *12680000
126400*----------------------------------------------------------------*12690000
126500                                                                  12700000
126600 4300-RETRIEVE-STORE-NAME.                                        12710000
126700                                                                  12720000
126800     EXEC SQL                                                     12730000
126900         SELECT LOC_5_ABBR_NM                                     12740011
127000           INTO :XMT00001-LOC-5-ABBR-NM                           12750011
127100           FROM XMT_LOC                                           12760011
127200           WHERE LOC_NBR = :INVOIC-STR-NBR                        12770011
127400     END-EXEC.                                                    12780000
127500                                                                  12790000
127600     EVALUATE TRUE                                                12800000
127700         WHEN SQLCODE = +0                                        12810000
127800             MOVE XMT00001-LOC-5-ABBR-NM TO PV-FACILITY           12820011
127900         WHEN SQLCODE = +100                                      12830000
128000             MOVE 'UNK  ' TO PV-FACILITY                          12840000
128100         WHEN SQLCODE = -904                                      12850000
128200         WHEN SQLCODE = -911                                      12860000
128300         WHEN SQLCODE = -913                                      12870000
128400              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       12880000
128500              SET PS-ERROR                                        12890000
128600                  DP020-NEXT-ACT-APPL-ERROR                       12900000
128700                  DP020-MSG-FATAL                                 12910000
128800                      TO TRUE                                     12920000
128900              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 12930000
129000              PERFORM 9000-CALL-CICS-ARCH-API                     12940000
129100                                                                  12950000
129200         WHEN SQLWARN0 NOT = SPACES                               12960000
129300         WHEN SQLCODE < +0                                        12970000
129400         WHEN SQLCODE > +0                                        12980000
129500              MOVE '4300-RETRIEVE-STORE-NAME'                     12990000
129600                              TO DP013-PARAGRAPH                  13000000
129700              MOVE 'UNSUCCESSFUL SELECT ON XMT_LOC'               13010011
129800                              TO DP013-MESSAGE-TEXT (1)           13020000
129900              MOVE SQLCA      TO DP013-SQLCA                      13030000
130000              MOVE 'XMT_LOC ' TO DP013-DB2-TABLE-NAME (1)         13040011
130100              SET DP013-DB2-ABEND                                 13050000
130200                  DP013-XCTL-DISPLAY-RESTART                      13060000
130300                              TO TRUE                             13070000
130400              PERFORM DP013-0000-PROCESS-ABEND                    13080000
130500     END-EVALUATE.                                                13090000
130600                                                                  13100000
130700*----------------------------------------------------------------*13110000
130800*    THE A/P TABLES WILL QUALIFY SOME INVOICE NUMBERS WITH THE    13120000
130900*    LAST FEW DIGITS OF THE PO NUMBER BECAUSE OF DUPLICATION      13130000
131000*    PROBLEMS. IF AN INV # IS 6 BYTES LONG, THE LAST 3 PO # DIGITS13140000
131100*    WILL BE TACKED ONTO THE INVOICE NUMBER SEPARATED BY A DASH.  13150000
131200*    IF AN INV # IS 7 BYTES LONG, THE LAST 2 PO # DIGITS WILL BE  13160000
131300*    USED, ETC. (E.G. INVOICE # = 123456-789, PO # = 903789).     13170000
131400*                                                                 13180000
131500*    ALL QUALIFIED INVOICE NUMBERS ARE 10 BYTES LONG WITH THE     13190000
131600*    DASH LOCATED IN THE 7TH, 8TH OR 9TH POSITION.                13200000
131700*                                                                 13210000
131800*    THE EDI TABLES DO NOT STORE THE INVOICE NUMBERS WITH THE     13220000
131900*    SUFFIX MENTIONED ABOVE.                                      13230000
132000*                                                                 13240000
132100*    IN ORDER TO EXTRACT THE PICKUP DATE & TIME FROM THE EDI      13250000
132200*    TABLES, THE SUFFIX NEEDS TO BE REMOVED FROM THE END OF THE   13260000
132300*    INVOICE NUMBER.                                              13270000
132400*                                                                 13280000
132500*    THIS PARAGRAPH SCANS EACH INVOICE NUMBER FOR DASHES, IF FOUND13290000
132600*    PROCESSING IS PASSED TO PGH 4315-. IF NOT FOUND, ADDITIONAL  13300000
132700*    INVOICE NUMBER EDITS ARE BYPASSED.                           13310000
132800*----------------------------------------------------------------*13320000
132900                                                                  13330000
133000 4310-REFORMAT-INVOICE-NUMBER.                                    13340000
133100                                                                  13350000
133200     MOVE SPACES TO PV-INVOICE-NBR.                               13360000
133300     MOVE ZEROES TO PV-SAVE-INV-CTR.                              13370000
133400     MOVE INVOIC-INVC-ID TO PV-INVOICE-NBR.                       13380000
133500     SET PS-NOT-END-OF-TABLE TO TRUE.                             13390000
133600                                                                  13400000
133700     PERFORM                                                      13410000
133800         VARYING PV-INV-CTR FROM 1 BY 1                           13420000
133900         UNTIL PV-INV-CTR > 10 OR                                 13430000
134000               PS-END-OF-TABLE                                    13440000
134100                                                                  13450000
134200         IF PV-INVOICE-NBR-UNIT (PV-INV-CTR) = '-'                13460000
134300             MOVE PV-INV-CTR TO PV-SAVE-INV-CTR                   13470000
134400             PERFORM 4315-COMPARE-SUFFIX-TO-PO                    13480000
134500             SET PS-END-OF-TABLE TO TRUE                          13490000
134600         END-IF                                                   13500000
134700                                                                  13510000
134800     END-PERFORM.                                                 13520000
134900                                                                  13530000
135000*----------------------------------------------------------------*13540000
135100*    COMPARES THE INVOICE NUMBER SUFFIX TO THE LAST DIGITS OF THE 13550000
135200*    PO NUMBER. IF THERE IS A MATCH, THE SUFFIX IS REMOVED TO     13560000
135300*    PROPERLY ACCESS THE EDI TABLES, OTHERWISE THE PROCESSING     13570000
135400*    CONTINUES NORMALLY.                                          13580000
135500*----------------------------------------------------------------*13590000
135600                                                                  13600000
135700 4315-COMPARE-SUFFIX-TO-PO.                                       13610000
135800                                                                  13620000
135900     MOVE SPACES TO PV-HOLD-INV-NUMBER                            13630000
136000                    PV-HOLD-PO-NUMBER.                            13640000
136100     MOVE ZERO TO PV-HOLD-INV-CTR                                 13650000
136200                  PV-PO-SEGMENT.                                  13660000
136300                                                                  13670000
136400*---- PV-INV-CTR REPRESENTS THE POSITION THE DASH IS IN.          13680000
136500*---- PV-PO-SEGMENT REPRESENTS THE LENGTH OF THE SUFFIX, WHICH    13690000
136600*---- IS ALSO HOW MANY DIGITS TO EXTRACT FROM THE END OF THE PO.  13700000
136700*---- 1 IS ADDED TO PV-INV-CTR TO POSITION THE COUNTER ON THE     13710000
136800*---- FIRST DIGIT OF THE SUFFIX                                   13720000
136900                                                                  13730000
137000     MOVE PV-PO-NBR-COMP TO PV-PO-NBR-NUM.                        13740000
137100     MOVE PV-PO-NBR-NUM TO PV-PO-NBR-X.                           13750000
137200     SUBTRACT PV-INV-CTR FROM 10 GIVING PV-PO-SEGMENT.            13760000
137300     ADD 1 TO PV-INV-CTR.                                         13770000
137400                                                                  13780000
137500*---- THIS TABLE EXTRACTS THE SUFFIX FROM THE INVOICE # AND PUTS  13790000
137600*---- IT INTO A HOLD TABLE.                                       13800000
137700                                                                  13810000
137800     PERFORM                                                      13820000
137900         VARYING PV-INV-CTR FROM PV-INV-CTR BY 1                  13830000
138000         UNTIL PV-INV-CTR > 10                                    13840000
138100                                                                  13850000
138200         ADD 1 TO PV-HOLD-INV-CTR                                 13860000
138300         MOVE PV-INVOICE-NBR-UNIT (PV-INV-CTR) TO                 13870000
138400              PV-HOLD-INV-SEGMENT (PV-HOLD-INV-CTR)               13880000
138500                                                                  13890000
138600     END-PERFORM.                                                 13900000
138700                                                                  13910000
138800*---- THIS TABLE EXTRACTS THE NUMBER OF DIGITS SPECIFIED BY THE   13920000
138900*---- PV-PO-SEGMENT FROM THE PO NUMBER. IT STARTS AT THE LAST     13930000
139000*---- POSITION OF THE TABLE AND READS BACKWARDS.                  13940000
139100                                                                  13950000
C98147     MOVE 8 TO PV-PO-CTR.                                         13960013
139300     PERFORM                                                      13970000
139400         UNTIL PV-PO-SEGMENT = 0                                  13980000
139500                                                                  13990000
139600         IF PV-PO-NBR-UNIT (PV-PO-CTR) > SPACES                   14000000
139700             MOVE PV-PO-NBR-UNIT (PV-PO-CTR) TO                   14010000
139800                  PV-HOLD-PO-SEGMENT (PV-PO-SEGMENT)              14020000
139900             SUBTRACT 1 FROM PV-PO-SEGMENT                        14030000
140000         END-IF                                                   14040000
140100         SUBTRACT 1 FROM PV-PO-CTR                                14050000
140200                                                                  14060000
140300     END-PERFORM.                                                 14070000
140400                                                                  14080000
140500*---- THIS TABLE COMPARES THE SUFFIX TO THE EXTRACTED PORTION     14090000
140600*---- OF THE PO NUMBER. IF THEY MATCH, THE THE SUFFIX PORTION     14100000
140700*---- OF THE INVOICE # IS SPACED OUT STARTING AT THE DASH.        14110000
140800                                                                  14120000
140900     IF PV-HOLD-INV-NUMBER = PV-HOLD-PO-NUMBER                    14130000
141000         PERFORM                                                  14140000
141100             VARYING PV-SAVE-INV-CTR FROM PV-SAVE-INV-CTR BY 1    14150000
141200             UNTIL PV-SAVE-INV-CTR > 10                           14160000
141300                                                                  14170000
141400             MOVE SPACES TO PV-INVOICE-NBR-UNIT (PV-SAVE-INV-CTR) 14180000
141500         END-PERFORM                                              14190000
141600     END-IF.                                                      14200000
141700                                                                  14210000
141800*----------------------------------------------------------------*14220000
141900*    THIS PARAGRAPH RETRIEVES PICKUP DATE AND TIME. THE EDI       14230000
142000*    TABLES DO NOT STORE LEADING ZEROES ON THE INVOICE NUMBERS    14240000
142100*    SO THEY ARE REMOVED USING THE INSPECT COMMAND.               14250000
142200*----------------------------------------------------------------*14260000
142300                                                                  14270000
142400 4320-RETRIEVE-DATE-TIME.                                         14280000
142500                                                                  14290000
142600     MOVE SPACES TO ASC-KEY-INV-NBR.                              14300000
142700     MOVE ZEROES TO PV-ZERO-CNT.                                  14310000
142800                                                                  14320000
142900     INSPECT PV-INVOICE-NBR                                       14330000
143000         TALLYING PV-ZERO-CNT                                     14340000
143100         FOR LEADING ZEROES.                                      14350000
143200                                                                  14360000
143300     MOVE PV-INVOICE-NBR (1 + PV-ZERO-CNT:22 - PV-ZERO-CNT)       14370000
143400       TO ASC-KEY-INV-NBR.                                        14380000
143500                                                                  14390000
143600     PERFORM 4323-OPEN-EDI-CURSOR.                                14400000
143700     PERFORM 4325-FETCH-EDI-CURSOR.                               14410000
143800     PERFORM 4327-CLOSE-EDI-CURSOR.                               14420000
143900                                                                  14430000
144000*----------------------------------------------------------------*14440000
144100*    OPEN THE EDI CURSOR                                          14450000
144200*----------------------------------------------------------------*14460000
144300                                                                  14470000
144400 4323-OPEN-EDI-CURSOR.                                            14480000
144500                                                                  14490000
144600     EXEC SQL                                                     14500000
144700          OPEN EDI_CURSOR                                         14510000
144800     END-EXEC                                                     14520000
144900                                                                  14530000
145000     EVALUATE TRUE                                                14540000
145100         WHEN SQLCODE = ZERO                                      14550000
145200                 CONTINUE                                         14560000
145300                                                                  14570000
145400         WHEN SQLCODE = -904                                      14580000
145500         WHEN SQLCODE = -911                                      14590000
145600         WHEN SQLCODE = -913                                      14600000
145700              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       14610000
145800              SET PS-ERROR                                        14620000
145900                  DP020-NEXT-ACT-APPL-ERROR                       14630000
146000                  DP020-MSG-FATAL                                 14640000
146100                      TO TRUE                                     14650000
146200              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 14660000
146300              PERFORM 9000-CALL-CICS-ARCH-API                     14670000
146400                                                                  14680000
146500         WHEN SQLWARN0 NOT = SPACES                               14690000
146600         WHEN SQLCODE < ZERO                                      14700000
146700         WHEN SQLCODE > ZERO                                      14710000
146800             MOVE '4323-OPEN-EDI-CURSOR'                          14720000
146900                               TO DP013-PARAGRAPH                 14730000
147000             MOVE 'OPEN EDI CURSOR - '                            14740000
147100                               TO DP013-MESSAGE-TEXT (1)          14750000
147200             MOVE SQLCA        TO DP013-SQLCA                     14760000
147300             SET DP013-DB2-ABEND                                  14770000
147400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14780000
147500             PERFORM DP013-0000-PROCESS-ABEND                     14790000
147600     END-EVALUATE.                                                14800000
147700                                                                  14810000
147800*----------------------------------------------------------------*14820000
147900*    FETCH THE EDI CURSOR TO RETURN ONE AND ONLY ONE ROW FROM THE 14830000
148000*    TABLES. DUPLICATE INVOICE NUMBERS WILL OCCASIONALLY APPEAR   14840000
148100*    ON THE EDI TABLES. BY ORDERING BY PU-DATE AND PU-TIME (DESC) 14850000
148200*    IN THE CURSOR, WE WILL RETRIEVE THE LATEST VERSION OF THE    14860000
148300*    INVOICE.                                                     14870000
148400*----------------------------------------------------------------*14880000
148500                                                                  14890000
148600 4325-FETCH-EDI-CURSOR.                                           14900000
148700                                                                  14910000
148800     EXEC SQL                                                     14920000
148900         FETCH EDI_CURSOR                                         14930000
149000          INTO :INTTRN-MAILBOX-PU-DTE,                            14940000
149100               :INTTRN-MAILBOX-PU-TME                             14950000
149200     END-EXEC.                                                    14960000
149300                                                                  14970000
149400     EVALUATE TRUE                                                14980000
149500         WHEN SQLCODE = +0                                        14990000
149600              CONTINUE                                            15000000
149700         WHEN SQLCODE = +100                                      15010000
149800              MOVE SPACES TO INTTRN-MAILBOX-PU-DTE                15020000
149900                             INTTRN-MAILBOX-PU-TME                15030000
150000         WHEN SQLCODE = -904                                      15040000
150100         WHEN SQLCODE = -911                                      15050000
150200         WHEN SQLCODE = -913                                      15060000
150300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       15070000
150400              SET PS-ERROR                                        15080000
150500                  DP020-NEXT-ACT-APPL-ERROR                       15090000
150600                  DP020-MSG-FATAL                                 15100000
150700                      TO TRUE                                     15110000
150800              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 15120000
150900              PERFORM 9000-CALL-CICS-ARCH-API                     15130000
151000                                                                  15140000
151100         WHEN SQLWARN0 NOT = SPACES                               15150000
151200         WHEN SQLCODE < +0                                        15160000
151300         WHEN SQLCODE > +0                                        15170000
151400              MOVE '4325-FETCH-EDI-CURSOR'                        15180000
151500                              TO DP013-PARAGRAPH                  15190000
151600              MOVE 'UNSUCCESSFUL JOIN TO RETRIEVE PICKUP DATE'    15200000
151700                              TO DP013-MESSAGE-TEXT (1)           15210000
151800              MOVE PV-PO-NBR-COMP TO PV-PO-NUMBER-MESSAGE         15220000
151900              MOVE PV-PO-MESSAGE  TO DP013-MESSAGE-TEXT (2)       15230000
152000              MOVE ASC-KEY-INV-NBR TO PV-INVC-NBR-MESSAGE         15240000
152100              MOVE PV-INVC-MESSAGE TO DP013-MESSAGE-TEXT (3)      15250000
152200              MOVE SQLCA      TO DP013-SQLCA                      15260000
152300              MOVE 'TTRDPRT ' TO DP013-DB2-TABLE-NAME (1)         15270000
152400              MOVE 'TTRDTRN ' TO DP013-DB2-TABLE-NAME (2)         15280000
152500              MOVE 'TINTTRN ' TO DP013-DB2-TABLE-NAME (3)         15290000
152600              MOVE 'TFGTRST ' TO DP013-DB2-TABLE-NAME (4)         15300000
152700              MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (5)         15310000
152800              SET DP013-DB2-ABEND                                 15320000
152900                  DP013-XCTL-DISPLAY-RESTART                      15330000
153000                              TO TRUE                             15340000
153100              PERFORM DP013-0000-PROCESS-ABEND                    15350000
153200     END-EVALUATE.                                                15360000
153300                                                                  15370000
153400*----------------------------------------------------------------*15380000
153500*    CLOSE EDI CURSOR.                                            15390000
153600*----------------------------------------------------------------*15400000
153700                                                                  15410000
153800 4327-CLOSE-EDI-CURSOR.                                           15420000
153900                                                                  15430000
154000     EXEC SQL                                                     15440000
154100         CLOSE EDI_CURSOR                                         15450000
154200     END-EXEC.                                                    15460000
154300                                                                  15470000
154400     EVALUATE TRUE                                                15480000
154500         WHEN SQLCODE = ZERO                                      15490000
154600             CONTINUE                                             15500000
154700         WHEN SQLWARN0 NOT = SPACES                               15510000
154800         WHEN SQLCODE < ZERO                                      15520000
154900         WHEN SQLCODE > ZERO                                      15530000
155000             MOVE '4327-CLOSE-EDI-CURSOR'                         15540000
155100                                   TO DP013-PARAGRAPH             15550000
155200             MOVE 'CLOSE EDI CURSOR '                             15560000
155300                                   TO DP013-MESSAGE-TEXT (1)      15570000
155400             MOVE SQLCA            TO DP013-SQLCA                 15580000
155500             SET DP013-DB2-ABEND                                  15590000
155600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15600000
155700             PERFORM DP013-0000-PROCESS-ABEND                     15610000
155800     END-EVALUATE.                                                15620000
155900                                                                  15630000
156000*----------------------------------------------------------------*15640000
156100*    THIS PARAGRAPH SPACES OUT THE PICKUP DATE & TIME FIELD IF    15650000
156200*    THEY EQUAL 9999-09-09 AND 09-09 RESPECTIVELY. ADDITIONAL     15660000
156300*    EDITS ARE NEEDED BECAUSE SEARS (NETWK-ID = 2) USES THE       15670000
156400*    EASTERN STANDARD TIME FOR THIS FIELD AND THEY NEED TO BE     15680000
156500*    CONVERTED TO CENTRAL STANDARD TIME. MOST OF THE TIME         15690000
156600*    AN HOUR WILL BE SUBTRACTED FROM THE TIME FIELD, BUT IF THE   15700000
156700*    TIME IS BETWEEN 12-12:59 AM (0-0:59 MILITARY TIME), 23 IS    15710000
156800*    MOVED TO THE HOUR FIELD (TIMES ARE DISPLAYED IN MILITARY     15720000
156900*    TIME) AND THE DATE IS ROLLED BACK ONE DAY. IF THE DAY        15730000
157000*    HAPPENS TO BE THE FIRST DAY OF THE MONTH, THE CALENDAR       15740000
157100*    ROUTINE IS USED TO ROLL BACK ONE DAY.                        15750000
157200*----------------------------------------------------------------*15760000
157300                                                                  15770000
157400 4330-OUTPUT-DATE-TIME.                                           15780000
157500                                                                  15790000
157600     IF INTTRN-MAILBOX-PU-DTE = SPACES AND                        15800000
157700        INTTRN-MAILBOX-PU-TME = SPACES                            15810000
157800         MOVE SPACES TO PV-SORT-DATE (PV-SORT-TABLE-CTR)          15820000
157900                        PV-SORT-TIME (PV-SORT-TABLE-CTR)          15830000
158000     ELSE                                                         15840000
158100         MOVE INTTRN-MAILBOX-PU-TME  TO PV-TIME                   15850000
158200         MOVE ':'                    TO PV-COLON                  15860000
158310         IF (INTTRN-MAILBOX-PU-DTE = PV-DEFAULT-DATE) AND         15870001
158410            (PV-TIME = PV-DEFAULT-TIME)                           15880001
158500             MOVE SPACES TO PV-SORT-DATE (PV-SORT-TABLE-CTR)      15890000
158600                            PV-SORT-TIME (PV-SORT-TABLE-CTR)      15900000
158700         ELSE                                                     15910000
158800             IF NETWRK-NETWK-ID = '2'                             15920000
158900                 MOVE INTTRN-MAILBOX-PU-DTE TO PV-DATE-10         15930000
159000                 IF PV-HOUR = ZEROES                              15940000
159100                     MOVE 23 TO PV-HOUR                           15950000
159200                     IF PV-DAY-10 = 01                            15960000
159300                         MOVE INTTRN-MAILBOX-PU-DTE               15970000
159400                           TO PV-PRE-CONV-DATE                    15980000
159500                         PERFORM 4336-DATE-CONVERSION-ROUTINE     15990000
159600                     ELSE                                         16000000
159700                         SUBTRACT 1 FROM PV-DAY-10                16010000
159800                     END-IF                                       16020000
159900                  ELSE                                            16030000
160000                     SUBTRACT 1 FROM PV-HOUR                      16040000
160100                  END-IF                                          16050000
160200             ELSE                                                 16060000
160300                 MOVE INTTRN-MAILBOX-PU-DTE TO PV-DATE-10         16070000
160400             END-IF                                               16080000
160500             MOVE PV-DATE-10                                      16090000
160600               TO PV-SORT-DATE (PV-SORT-TABLE-CTR)                16100000
160700             MOVE PV-TIME                                         16110000
160800               TO PV-SORT-TIME (PV-SORT-TABLE-CTR)                16120000
160900         END-IF                                                   16130000
161000     END-IF.                                                      16140000
161100                                                                  16150000
161200*----------------------------------------------------------------*16160000
161300*    THE CALENDAR ROUTINE IS USED TO ROLL THE DATE BACK ONE DAY.  16170000
161400*----------------------------------------------------------------*16180000
161500                                                                  16190000
161600 4336-DATE-CONVERSION-ROUTINE.                                    16200000
161700                                                                  16210000
161800     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     16220000
161900     SET DPG51-DECREMENT-DATE        TO TRUE.                     16230000
162000     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     16240000
162100     MOVE 1                          TO DPG51-INCR-DECR-DAYS-9.   16250000
162200     MOVE PV-PRE-CONV-DATE           TO DPG52-LK-DATE-INPUT.      16260000
162300                                                                  16270000
162410     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      16280001
162500          DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                    16290001
162600                                                                  16300000
162700     IF  (DPG54-NO-ERROR                                          16310000
162800      OR  DPG54-WARNING-ERROR)                                    16320000
162900      AND DPG54-DATE-VALID                                        16330000
163000          MOVE DPG55-DB2-ISO-DATE-FMT                             16340000
163100            TO PV-DATE-10.                                        16350000
163200                                                                  16360000
163300*----------------------------------------------------------------*16370000
163400*    RETRIEVES INVOICE UNITS.                                    *16380000
163500*----------------------------------------------------------------*16390000
163600                                                                  16400000
163700 4340-RETRIEVE-UNITS.                                             16410000
163800                                                                  16420000
163900     EXEC SQL                                                     16430000
164000          SELECT SUM (PAY_REQ_LNE_QTY)                            16440000
164100          INTO :PREQIT-PAY-REQ-LNE-QTY                            16450000
164200          FROM TPREQIT                                            16460000
164300          WHERE PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR       16470012
164400     END-EXEC.                                                    16480000
164500                                                                  16490000
164600     EVALUATE TRUE                                                16500000
164700         WHEN SQLCODE = +0                                        16510000
164800              MOVE PREQIT-PAY-REQ-LNE-QTY TO PV-UNITS             16520000
164900              ADD PV-UNITS TO PV-GR-TOT-UNITS                     16530000
165000         WHEN SQLCODE = +100                                      16540000
165100              MOVE ZEROES TO PV-UNITS                             16550000
165200         WHEN SQLCODE = -904                                      16560000
165300         WHEN SQLCODE = -911                                      16570000
165400         WHEN SQLCODE = -913                                      16580000
165500              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       16590000
165600              SET PS-ERROR                                        16600000
165700                  DP020-NEXT-ACT-APPL-ERROR                       16610000
165800                  DP020-MSG-FATAL                                 16620000
165900                      TO TRUE                                     16630000
166000              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 16640000
166100              PERFORM 9000-CALL-CICS-ARCH-API                     16650000
166200                                                                  16660000
166300         WHEN SQLWARN0 NOT = SPACES                               16670000
166400         WHEN SQLCODE < +0                                        16680000
166500         WHEN SQLCODE > +0                                        16690000
166600              MOVE '4340-RETRIEVE-UNITS'                          16700000
166700                              TO DP013-PARAGRAPH                  16710000
166800              MOVE 'UNSUCCESSFUL SELECT ON TPREQIT'               16720000
166900                              TO DP013-MESSAGE-TEXT (1)           16730000
167000              MOVE SQLCA      TO DP013-SQLCA                      16740000
167100              MOVE 'TPREQIT ' TO DP013-DB2-TABLE-NAME (1)         16750000
167200              SET DP013-DB2-ABEND                                 16760000
167300                  DP013-XCTL-DISPLAY-RESTART                      16770000
167400                              TO TRUE                             16780000
167500              PERFORM DP013-0000-PROCESS-ABEND                    16790000
167600     END-EVALUATE.                                                16800000
167700                                                                  16810000
167800*----------------------------------------------------------------*16820000
167900*    OPEN PERCENT CURSOR.                                        *16830000
168000*----------------------------------------------------------------*16840000
168100                                                                  16850000
168200 4350-OPEN-PCT-CURSOR.                                            16860000
168300                                                                  16870000
168400     EXEC SQL                                                     16880000
168500          OPEN PCT_CURSOR                                         16890000
168600     END-EXEC                                                     16900000
168700                                                                  16910000
168800     EVALUATE TRUE                                                16920000
168900         WHEN SQLCODE = ZERO                                      16930000
169000                 CONTINUE                                         16940000
169100                                                                  16950000
169200         WHEN SQLCODE = -904                                      16960000
169300         WHEN SQLCODE = -911                                      16970000
169400         WHEN SQLCODE = -913                                      16980000
169500              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       16990000
169600              SET PS-ERROR                                        17000000
169700                  DP020-NEXT-ACT-APPL-ERROR                       17010000
169800                  DP020-MSG-FATAL                                 17020000
169900                      TO TRUE                                     17030000
170000              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 17040000
170100              PERFORM 9000-CALL-CICS-ARCH-API                     17050000
170200                                                                  17060000
170300         WHEN SQLWARN0 NOT = SPACES                               17070000
170400         WHEN SQLCODE < ZERO                                      17080000
170500         WHEN SQLCODE > ZERO                                      17090000
170600             MOVE '4350-OPEN-PCT-CURSOR'                          17100000
170700                               TO DP013-PARAGRAPH                 17110000
170800             MOVE 'OPEN PCT CURSOR - '                            17120000
170900                               TO DP013-MESSAGE-TEXT (1)          17130000
171000             MOVE SQLCA        TO DP013-SQLCA                     17140000
171100             SET DP013-DB2-ABEND                                  17150000
171200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17160000
171300             PERFORM DP013-0000-PROCESS-ABEND                     17170000
171400     END-EVALUATE.                                                17180000
171500                                                                  17190000
171600*----------------------------------------------------------------*17200000
171700*    ACCUMULATE DISCOUNT PRICE                                   *17210000
171800*    THE TALCHRG TABLE WILL EITHER HAVE A VALUE IN               *17220000
171900*    ALCHRG-ALW-CHRG-AMT OR IN ALCHRG-ALW-CHRG-PCT BUT NOT IN    *17230000
172000*    BOTH.                                                       *17240000
172100*----------------------------------------------------------------*17250000
172200                                                                  17260000
172300 4360-PROCESS-PCT-CURSOR.                                         17270000
172400                                                                  17280000
172500     MOVE ZEROES TO PV-TOTAL-DISCOUNT-AMT.                        17290000
172600     SET ASC-ITEMS-ON-TALCHRG TO TRUE.                            17300000
172700                                                                  17310000
172800     PERFORM                                                      17320000
172900         VARYING PV-READ-COUNT                                    17330000
173000         FROM 1 BY 1                                              17340000
173100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17350000
173200            OR (ASC-NO-ITEMS-ON-TALCHRG))                         17360000
173300                                                                  17370000
173400         PERFORM 4365-FETCH-PCT-CURSOR                            17380000
173500                                                                  17390000
173600         IF ASC-ITEMS-ON-TALCHRG                                  17400000
173700             IF ALCHRG-ALW-CHRG-AMT > ZEROES                      17410000
173800                 ADD ALCHRG-ALW-CHRG-AMT TO PV-TOTAL-DISCOUNT-AMT 17420000
173900             ELSE                                                 17430000
174000                 IF ALCHRG-ALW-CHRG-PCT > ZEROES                  17440000
174100                     MULTIPLY ALCHRG-ALW-CHRG-PCT                 17450000
174200                           BY INVOIC-GRO-COST-AMT                 17460000
174300                       GIVING PV-DISCOUNT-AMT                     17470000
174400                     ADD PV-DISCOUNT-AMT TO PV-TOTAL-DISCOUNT-AMT 17480000
174500                 END-IF                                           17490000
174600             END-IF                                               17500000
174700         END-IF                                                   17510000
174800                                                                  17520000
174900     END-PERFORM.                                                 17530000
175000                                                                  17540000
175100     ADD PV-TOTAL-DISCOUNT-AMT TO PV-GR-TOT-DISC-AMT.             17550000
175200                                                                  17560000
175300*----------------------------------------------------------------*17570000
175400*    FETCH PERCENT CURSOR.                                       *17580000
175500*----------------------------------------------------------------*17590000
175600                                                                  17600000
175700 4365-FETCH-PCT-CURSOR.                                           17610000
175800                                                                  17620000
175900     EXEC SQL                                                     17630000
176000         FETCH PCT_CURSOR                                         17640000
176100          INTO :ALCHRG-ALW-CHRG-PCT,                              17650000
176200               :ALCHRG-ALW-CHRG-AMT                               17660000
176300     END-EXEC.                                                    17670000
176400                                                                  17680000
176500     EVALUATE TRUE                                                17690000
176600         WHEN SQLCODE = ZERO                                      17700000
176700              SET ASC-ITEMS-ON-TALCHRG TO TRUE                    17710000
176800         WHEN SQLCODE = +100                                      17720000
176900              SET ASC-NO-ITEMS-ON-TALCHRG TO TRUE                 17730000
177000         WHEN SQLCODE = -904                                      17740000
177100         WHEN SQLCODE = -911                                      17750000
177200         WHEN SQLCODE = -913                                      17760000
177300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       17770000
177400              SET PS-ERROR                                        17780000
177500                  DP020-NEXT-ACT-APPL-ERROR                       17790000
177600                  DP020-MSG-FATAL                                 17800000
177700                      TO TRUE                                     17810000
177800              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 17820000
177900              PERFORM 9000-CALL-CICS-ARCH-API                     17830000
178000                                                                  17840000
178100         WHEN SQLWARN0 NOT = SPACE                                17850000
178200         WHEN SQLCODE NOT = ZERO                                  17860000
178300              MOVE '4365-FETCH-PCT-CURSOR'                        17870000
178400                                   TO DP013-PARAGRAPH             17880000
178500              MOVE 'FETCH PCT CURSOR'                             17890000
178600                                   TO DP013-MESSAGE-TEXT (1)      17900000
178700              MOVE SQLCA           TO DP013-SQLCA                 17910000
178800              SET DP013-DB2-ABEND                                 17920000
178900                                   TO TRUE                        17930000
179000              PERFORM DP013-0000-PROCESS-ABEND                    17940000
179100     END-EVALUATE.                                                17950000
179200                                                                  17960000
179300*----------------------------------------------------------------*17970000
179400*    CLOSE PERCENT CURSOR.                                       *17980000
179500*----------------------------------------------------------------*17990000
179600                                                                  18000000
179700 4370-CLOSE-PCT-CURSOR.                                           18010000
179800                                                                  18020000
179900     EXEC SQL                                                     18030000
180000         CLOSE PCT_CURSOR                                         18040000
180100     END-EXEC.                                                    18050000
180200                                                                  18060000
180300     EVALUATE TRUE                                                18070000
180400         WHEN SQLCODE = ZERO                                      18080000
180500             CONTINUE                                             18090000
180600         WHEN SQLWARN0 NOT = SPACES                               18100000
180700         WHEN SQLCODE < ZERO                                      18110000
180800         WHEN SQLCODE > ZERO                                      18120000
180900             MOVE '4370-CLOSE-PCT-CURSOR'                         18130000
181000                                   TO DP013-PARAGRAPH             18140000
181100             MOVE 'CLOSE PCT CURSOR '                             18150000
181200                                   TO DP013-MESSAGE-TEXT (1)      18160000
181300             MOVE SQLCA            TO DP013-SQLCA                 18170000
181400             SET DP013-DB2-ABEND                                  18180000
181500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18190000
181600             PERFORM DP013-0000-PROCESS-ABEND                     18200000
181700     END-EVALUATE.                                                18210000
181800                                                                  18220000
181900*----------------------------------------------------------------*18230000
182000*    A BUBBLE SORT NEEDS TO BE PERFORMED IN ORDER TO SORT RETURNED18240000
182100*    ROWS BY EDI DATE, TIME AND INVOICE NUMBER.                   18250000
182200*----------------------------------------------------------------*18260000
182300                                                                  18270000
182400 4380-SORT-BY-EDI-DATE-TIME.                                      18280000
182500                                                                  18290000
182600     PERFORM                                                      18300000
182700         VARYING PV-SORT-TABLE-CTR FROM 1 BY 1                    18310000
182800         UNTIL PV-SORT-TABLE-CTR > ASC-NUMBER-OF-ITEMS-READ       18320000
182900                                                                  18330000
183000         PERFORM                                                  18340000
183100             VARYING PV-COMPARE-ROW                               18350000
183200                FROM ASC-NUMBER-OF-ITEMS-READ BY -1               18360000
183300               UNTIL PV-COMPARE-ROW = 1                           18370000
183400                                                                  18380000
183500             SUBTRACT 1 FROM PV-COMPARE-ROW                       18390000
183600               GIVING PV-COMPARE-TO-ROW                           18400000
183700                                                                  18410000
183800             IF PV-SORT-KEY-FIELDS (PV-COMPARE-ROW) >             18420000
183900                PV-SORT-KEY-FIELDS (PV-COMPARE-TO-ROW)            18430000
184000                 PERFORM 4385-REVERSE-TABLE-POSITION              18440000
184100             END-IF                                               18450000
184200         END-PERFORM                                              18460000
184300     END-PERFORM.                                                 18470000
184400                                                                  18480000
184500*----------------------------------------------------------------*18490000
184600*    ASC COMMAREA FIELDS ARE FILLED FROM SORT TABLE.             *18500000
184700*----------------------------------------------------------------*18510000
184800                                                                  18520000
184900 4385-REVERSE-TABLE-POSITION.                                     18530000
185000                                                                  18540000
185100     MOVE PV-SORT-TABLE-FIELDS (PV-COMPARE-TO-ROW)                18550000
185200       TO PV-SORT-HOLD-TABLE.                                     18560000
185300     MOVE PV-SORT-TABLE-FIELDS (PV-COMPARE-ROW)                   18570000
185400       TO PV-SORT-TABLE-FIELDS (PV-COMPARE-TO-ROW).               18580000
185500     MOVE PV-SORT-HOLD-TABLE                                      18590000
185600       TO PV-SORT-TABLE-FIELDS (PV-COMPARE-ROW).                  18600000
185700                                                                  18610000
185800*----------------------------------------------------------------*18620000
185900*    ASC COMMAREA FIELDS ARE FILLED FROM SORT TABLE.             *18630000
186000*----------------------------------------------------------------*18640000
186100                                                                  18650000
186200 4390-FILL-ASC-COMMAREA.                                          18660000
186300                                                                  18670000
186400     MOVE +1                 TO  ASC-BLK-SUB.                     18680000
186500     MOVE +0                 TO  ASC-ITEM-SUB.                    18690000
186600     MOVE +0                 TO  PV-SORTED-ORDER                  18700000
186700                                                                  18710000
186800     PERFORM                                                      18720000
186900         VARYING PV-SORT-TABLE-CTR FROM 1 BY 1                    18730000
187000           UNTIL PV-SORT-TABLE-CTR > ASC-NUMBER-OF-ITEMS-READ     18740000
187100                                                                  18750000
187200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18760000
187300                 ADD +1            TO ASC-ITEM-SUB                18770000
187400             ELSE                                                 18780000
187500                 ADD +1            TO ASC-BLK-SUB                 18790000
187600                 MOVE +1           TO ASC-ITEM-SUB                18800000
187700                                                                  18810000
187800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18820000
187900                     MOVE +1       TO ASC-BLK-SUB                 18830000
188000                     PERFORM 5100-WRITE-TEMP-STORAGE              18840000
188100                     MOVE ASC-BLOCK-ENTRIES                       18850000
188200                               (PC-MAX-BLOCKS-IN-ARRAY)           18860000
188300                                TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)18870000
188400                     ADD +1        TO ASC-BLK-SUB                 18880000
188500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18890000
188600                 END-IF                                           18900000
188700             END-IF                                               18910000
188800         PERFORM 4395-DB2-DATE-REFORMAT                           18920000
188900         MOVE PV-DATE-8                                           18930000
189000           TO ASC-INV-DATE             (ASC-BLK-SUB ASC-ITEM-SUB) 18940000
189100         MOVE PV-SORT-TIME             (PV-SORT-TABLE-CTR)        18950000
189200           TO ASC-INV-TIME             (ASC-BLK-SUB ASC-ITEM-SUB) 18960000
189300         MOVE PV-SORT-INVC-NBR         (PV-SORT-TABLE-CTR)        18970000
189400           TO ASC-INV-NUMBER           (ASC-BLK-SUB ASC-ITEM-SUB) 18980000
189500         MOVE PV-SORT-UNITS            (PV-SORT-TABLE-CTR)        18990000
189600           TO ASC-UNITS                (ASC-BLK-SUB ASC-ITEM-SUB) 19000000
189700         MOVE PV-SORT-COST-DOLLARS     (PV-SORT-TABLE-CTR)        19010000
189800           TO ASC-COST-DOLLARS         (ASC-BLK-SUB ASC-ITEM-SUB) 19020000
189900         MOVE PV-SORT-DISC-DOLLARS     (PV-SORT-TABLE-CTR)        19030000
190000           TO ASC-DISC-DOLLARS         (ASC-BLK-SUB ASC-ITEM-SUB) 19040000
190100         MOVE PV-SORT-NETCOST-DOLS     (PV-SORT-TABLE-CTR)        19050000
190200           TO ASC-NETCOST-DOLLARS      (ASC-BLK-SUB ASC-ITEM-SUB) 19060000
190300         MOVE PV-SORT-FACILITY         (PV-SORT-TABLE-CTR)        19070000
190400           TO ASC-FACILITY             (ASC-BLK-SUB ASC-ITEM-SUB) 19080000
190500         ADD  +1                   TO  PV-SORTED-ORDER            19090000
190600         MOVE PV-SORTED-ORDER                                     19100000
190700           TO ASC-LIST-ITEM-NUMBER     (ASC-BLK-SUB ASC-ITEM-SUB) 19110000
190800     END-PERFORM.                                                 19120000
190900                                                                  19130000
191000*----------------------------------------------------------------*19140000
191100*    CONVERTS CCYY-MM-DD DATE FORMAT TO MM/DD/YY.                 19150000
191200*----------------------------------------------------------------*19160000
191300                                                                  19170000
191400 4395-DB2-DATE-REFORMAT.                                          19180000
191500                                                                  19190000
191600     MOVE PV-SORT-DATE (PV-SORT-TABLE-CTR) TO PV-DATE-10.         19200000
191700     IF PV-DATE-10 = SPACES                                       19210000
191800         MOVE SPACES  TO PV-SLASH-1                               19220000
191900                         PV-SLASH-2                               19230000
192000     ELSE                                                         19240000
192100         MOVE '/'     TO PV-SLASH-1                               19250000
192200                         PV-SLASH-2.                              19260000
192300     MOVE PV-MONTH-10 TO PV-MONTH-8.                              19270000
192400     MOVE PV-DAY-10   TO PV-DAY-8.                                19280000
192500     MOVE PV-YEAR-10  TO PV-YEAR-8.                               19290000
192600                                                                  19300000
192700*----------------------------------------------------------------*19310000
192800*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *19320000
192900*----------------------------------------------------------------*19330000
193000                                                                  19340000
193100 4400-MOVE-COMMAREA-TO-SCREEN.                                    19350000
193200                                                                  19360000
193300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19370000
193400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19380000
193500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19390000
193600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19400000
193700                 GIVING PV-BLOCK-NUMBER                           19410000
193800                 REMAINDER PV-REMAINDER                           19420000
193900             IF  PV-REMAINDER > ZERO                              19430000
194000                 ADD +1 TO PV-BLOCK-NUMBER                        19440000
194100             END-IF                                               19450000
194200             MOVE +1    TO ASC-BLK-SUB                            19460000
194300             PERFORM 4410-READ-TEMP-STORAGE                       19470000
194400             ADD +1     TO ASC-BLK-SUB                            19480000
194500                           PV-BLOCK-NUMBER                        19490000
194600             PERFORM 4410-READ-TEMP-STORAGE                       19500000
194700     END-IF.                                                      19510000
194800     MOVE +1                       TO ASC-BLK-SUB.                19520000
194900     COMPUTE ASC-ITEM-SUB =                                       19530000
195000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19540000
195100         + PC-ITEMS-PER-PANEL).                                   19550000
195200                                                                  19560000
195300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19570000
195400         ADD +1   TO ASC-BLK-SUB                                  19580000
195500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19590000
195600     END-IF.                                                      19600000
195700                                                                  19610000
195800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19620000
195900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19630000
196000                                                                  19640000
196100     PERFORM 4415-FORMAT-HEADING-LIST-LINES.                      19650000
196200     PERFORM 4420-FORMAT-LIST-LINES                               19660000
196300         VARYING PS-SUB                                           19670000
196400         FROM PC-ITEMS-PER-PANEL BY -1                            19680000
196500         UNTIL PS-SUB < +1.                                       19690000
196600                                                                  19700000
196700     COMPUTE ASC-ITEMS-DISPLAYED =                                19710000
196800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19720000
196900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19730000
197000                                      ASTRTITO.                   19740000
197100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19750000
197200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19760000
197300                                                                  19770000
197400     IF  DP020-MSG-NUMBER-X = SPACE                               19780000
197500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19790000
197600*            --- MORE ITEMS TO DISPLAY ----                       19800000
197700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19810000
197800             SET DP020-MSG-INFORMATIONAL TO TRUE                  19820000
197900         END-IF                                                   19830000
198000     END-IF.                                                      19840000
198100                                                                  19850000
198200*----------------------------------------------------------------*19860000
198300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19870000
198400*----------------------------------------------------------------*19880000
198500                                                                  19890000
198600 4410-READ-TEMP-STORAGE.                                          19900000
198700                                                                  19910000
198800     EXEC CICS                                                    19920000
198900         READQ TS                                                 19930000
199000             QUEUE (ASC-DTL-QUEUE-NAME)                           19940000
199100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19950000
199200             ITEM  (PV-BLOCK-NUMBER)                              19960000
199300             RESP  (PV-CICS-RESP)                                 19970000
199400     END-EXEC.                                                    19980000
199500                                                                  19990000
199600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20000000
199700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20010000
199800         CONTINUE                                                 20020000
199900     ELSE                                                         20030000
200000         SET DP013-CICS-ABEND TO  TRUE                            20040000
200100         SET DP013-NO-ROLLBACK TO  TRUE                           20050000
200200         MOVE '4410-READ-TEMP-STORAGE'                            20060000
200300                               TO  DP013-PARAGRAPH                20070000
200400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20080000
200500                               TO  DP013-MESSAGE-TEXT(1)          20090000
200600         PERFORM DP013-0000-PROCESS-ABEND                         20100000
200700     END-IF.                                                      20110000
200800                                                                  20120000
200900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20130000
201000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20140000
201100     END-IF.                                                      20150000
201200 EJECT                                                            20160000
201300                                                                  20170000
201400*----------------------------------------------------------------*20180000
201500*    WRITES HEADING INFORMATION (NON-SCROLLABLE) TO THE SCREEN.  *20190000
201600*----------------------------------------------------------------*20200000
201700                                                                  20210000
201800 4415-FORMAT-HEADING-LIST-LINES.                                  20220000
201900                                                                  20230000
202000     MOVE ASC-KEY-PO-NUMBER       TO MR-PO-NBR.                   20240000
202100     MOVE ASC-ENT-NAME-DESC       TO MR-ENT-NAME-DESC.            20250000
202200     MOVE ASC-NETWK-NAME          TO MR-NTWK-NAME.                20260000
202300     MOVE ASC-ORDERED-UNITS       TO MR-ORD-UNITS.                20270000
202400     MOVE ASC-ORDERED-COST        TO MR-ORD-COST.                 20280000
202500     MOVE ASC-GR-TOT-UNITS        TO MR-TOT-UNITS.                20290000
202600     MOVE ASC-GR-TOT-COST-DOLLARS TO MR-TOT-COST-DOL.             20300000
202700     MOVE ASC-GR-TOT-DISC-AMT     TO MR-TOT-DISC-DOL.             20310000
202800     MOVE ASC-GR-TOT-NETCOST-DOLS TO MR-TOT-NETCOST-DOL.          20320000
202900                                                                  20330000
203000*----------------------------------------------------------------*20340000
203100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20350000
203200*----------------------------------------------------------------*20360000
203300                                                                  20370000
203400 4420-FORMAT-LIST-LINES.                                          20380000
203500                                                                  20390000
203600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20400000
203700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20410000
203800         MOVE SPACE              TO MR-INV-DTE  (PS-SUB)          20420000
203900                                    MR-INV-TME  (PS-SUB)          20430000
204000                                    MR-INV-NBR  (PS-SUB)          20440000
204100                                    MR-UNITS    (PS-SUB)          20450000
204200                                    MR-COST-DOL (PS-SUB)          20460000
204300                                    MR-DISC-DOL (PS-SUB)          20470000
204400                                    MR-NETCOST-DOL (PS-SUB)       20480000
204500                                    MR-FACILITY (PS-SUB)          20490000
204600     ELSE                                                         20500000
204700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20510000
204800             MOVE ASC-INV-DATE        (ASC-BLK-SUB ASC-ITEM-SUB)  20520000
204900               TO MR-INV-DTE          (PS-SUB)                    20530000
205000             MOVE ASC-INV-TIME        (ASC-BLK-SUB ASC-ITEM-SUB)  20540000
205100               TO MR-INV-TME          (PS-SUB)                    20550000
205200             MOVE ASC-INV-NUMBER      (ASC-BLK-SUB ASC-ITEM-SUB)  20560000
205300               TO MR-INV-NBR          (PS-SUB)                    20570000
205400             MOVE ASC-UNITS           (ASC-BLK-SUB ASC-ITEM-SUB)  20580000
205500               TO MR-UNITS            (PS-SUB)                    20590000
205600             MOVE ASC-COST-DOLLARS    (ASC-BLK-SUB ASC-ITEM-SUB)  20600000
205700               TO MR-COST-DOL         (PS-SUB)                    20610000
205800             MOVE ASC-DISC-DOLLARS    (ASC-BLK-SUB ASC-ITEM-SUB)  20620000
205900               TO MR-DISC-DOL         (PS-SUB)                    20630000
206000             MOVE ASC-NETCOST-DOLLARS (ASC-BLK-SUB ASC-ITEM-SUB)  20640000
206100               TO MR-NETCOST-DOL      (PS-SUB)                    20650000
206200             MOVE ASC-FACILITY        (ASC-BLK-SUB ASC-ITEM-SUB)  20660000
206300               TO MR-FACILITY         (PS-SUB)                    20670000
206400         END-IF                                                   20680000
206500     END-IF.                                                      20690000
206600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               20700000
206700     IF  ASC-ITEM-SUB < + 1                                       20710000
206800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20720000
206900         MOVE +1                 TO ASC-BLK-SUB                   20730000
207000     END-IF.                                                      20740000
207100                                                                  20750000
207200*----------------------------------------------------------------*20760000
207300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20770000
207400*----------------------------------------------------------------*20780000
207500                                                                  20790000
207600 5100-WRITE-TEMP-STORAGE.                                         20800000
207700                                                                  20810000
207800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20820000
207900                               TO  PV-LIST-ITEM-NUMBER.           20830000
208000     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           20840000
208100         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           20850000
208200                                                                  20860000
208300     EXEC CICS                                                    20870000
208400         WRITEQ TS                                                20880000
208500             QUEUE (ASC-DTL-QUEUE-NAME)                           20890000
208600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20900000
208700             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     20910000
208800             RESP  (PV-CICS-RESP)                                 20920000
208900     END-EXEC.                                                    20930000
209000                                                                  20940000
209100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20950000
209200         SET DP013-CICS-ABEND                                     20960000
209300                       TO  TRUE                                   20970000
209400         SET DP013-NO-ROLLBACK                                    20980000
209500                       TO  TRUE                                   20990000
209600         MOVE '5100-WRITE-TEMP-STORAGE'                           21000000
209700                       TO  DP013-PARAGRAPH                        21010000
209800         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       21020000
209900                       TO  DP013-MESSAGE-TEXT(1)                  21030000
210000         PERFORM DP013-0000-PROCESS-ABEND                         21040000
210100     END-IF.                                                      21050000
210200     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             21060000
210300                                                                  21070000
210400 EJECT                                                            21080000
210500*----------------------------------------------------------------*21090000
210600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *21100000
210700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *21110000
210800*----------------------------------------------------------------*21120000
210900                                                                  21130000
211000 9000-CALL-CICS-ARCH-API.                                         21140000
211100                                                                  21150000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      21160017
211300                                    DFHCOMMAREA                   21170017
211400                                    DP030-CICS-API-FIELDS         21180017
211500                                    DP020-STANDARD-COMMAREA       21190017
211600                                    PO071AI.                      21200017
211700                                                                  21210000
211800     IF  DP030-RC-CALL-SUCCESSFUL                                 21220000
211900         CONTINUE                                                 21230000
212000     ELSE                                                         21240000
212100         SET DP013-NO-ROLLBACK TO TRUE                            21250000
212200         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   21260000
212300         SET DP013-CICS-ABEND TO TRUE                             21270000
CICS           MOVE '9000-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        21280017
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O21290017
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      21300017
212700         MOVE DP030-RETURN-CODE                                   21310000
212800                               TO DP013-MESSAGE-TEXT (3)          21320000
212900         PERFORM DP013-0000-PROCESS-ABEND                         21330000
213000     END-IF.                                                      21340000
213100                                                                  21350000
213200*----------------------------------------------------------------*21360000
213300*    ABEND PROCESSOR MODULE                                      *21370000
213400*----------------------------------------------------------------*21380000
213500                                                                  21390000
213600     COPY DPPD013.                                                21400004
