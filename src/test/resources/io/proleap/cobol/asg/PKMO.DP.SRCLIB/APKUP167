000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKUP167.                                         00020000
000300 AUTHOR.        ANIL BEDEKAR.                                     00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  JULY 2011.                                        00050000
000600                                                                  00060000
000700***************************************************************** 00070000
000800*  RELOAD THE FINANCIAL DOMAIN STORE LOCATION ASSIGNMENT TABLE. * 00080000
000900*                                                               * 00090000
001000*  THIS IS A DAILY PROGRAM THAT RELOADS THE XFT_LOC_ASGMT       * 00100000
001100*  FROM A FLAT FILE. THE FLAT FILE IS AN EXTRACT OF THE ORACLE  * 00110000
001200*  ORACLE STORE TABLES PROVIDED BY RETEK (RMS).                 * 00120000
001300*                                                               * 00130000
001400*  PROGRAM COPIED FROM XFKUP005, THEN COPIED FROM XFKUP136.     * 00140000
001400*  IF THIS PROGRAM CHANGES, THE ORIGINAL PROGRAM MAY ALSO NEED  * 00141000
001500*  TO CHANGE.                                                   * 00142000
001600***************************************************************** 00143000
001700*  CHANGE LOG:                                                  * 00144000
001800*                                                               * 00145000
001900*  DATE  07/27/2011                                             * 00146000
002000*      CHANGE MADE: INITIAL PROGRAM                             * 00147000
002100*      MADE BY: ANIL BEDEKAR            WR/IR  #: WR37038       * 00148000
002200*                                                               * 00149000
002300***************************************************************** 00150000
002400 ENVIRONMENT DIVISION.                                            00160000
002500                                                                  00170000
002600 CONFIGURATION SECTION.                                           00180000
002700 SOURCE-COMPUTER.       IBM-3090.                                 00190000
002800 OBJECT-COMPUTER.       IBM-3090.                                 00200000
002900                                                                  00210000
003000 INPUT-OUTPUT SECTION.                                            00220000
003100                                                                  00230000
003200 FILE-CONTROL.                                                    00240000
003300     SELECT DC-LOC-ASG-FILE           ASSIGN TO INP01.            00250000
003400                                                                  00260000
003500 DATA DIVISION.                                                   00270000
003600                                                                  00280000
003700 FILE SECTION.                                                    00290000
003800                                                                  00300000
003900 FD  DC-LOC-ASG-FILE                                              00310000
004000     RECORDING MODE IS F                                          00320000
004100     BLOCK CONTAINS 0 RECORDS                                     00330000
004200     LABEL RECORDS ARE STANDARD.                                  00340000
004300                                                                  00350000
004400 01  DC-LOC-ASG-RECORD                PIC X(30).                  00360000
004500                                                                  00370000
004600*************************                                         00380000
004700 WORKING-STORAGE SECTION.                                         00390000
004800*************************                                         00400000
004900                                                                  00410000
005000 01  PC-PROGRAM-CONSTANTS.                                        00420000
005100     05  PC-PGM-NAME           PIC X(08)  VALUE 'APKUP167'.       00430000
005200     05  PC-DEFAULT-DATE       PIC X(10)  VALUE '9999-09-09'.     00440000
005300                                                                  00450000
005400 01  PS-PROGRAM-SWITCHES.                                         00460000
005500     05  PS-END-OF-DC-LOC-ASG-FILE    PIC X(01)   VALUE 'N'.      00470000
005600         88  NOT-END-OF-DC-LOC-ASG-FILE           VALUE 'N'.      00480000
005700         88  END-OF-DC-LOC-ASG-FILE               VALUE 'Y'.      00490000
005800     05  PS-PROCESS-LOCATION-SW       PIC X(01)   VALUE 'Y'.      00500000
005900         88  PROCESS-LOCATION                     VALUE 'Y'.      00510000
006000         88  DO-NOT-PROCESS-LOCATION              VALUE 'N'.      00520000
006100                                                                  00530000
006200 01  WS-CURRENT-DATETIME.                                         00540000
006300     05  WS-CURRENT-DATE              PIC  X(08)  VALUE SPACES.   00550000
006400     05  FILLER REDEFINES WS-CURRENT-DATE.                        00560000
006500         10 WS-CURRENT-DATE-CCYY      PIC  X(04).                 00570000
006600         10 WS-CURRENT-DATE-MM        PIC  X(02).                 00580000
006700         10 WS-CURRENT-DATE-DD        PIC  X(02).                 00590000
006800     05  WS-CURRENT-TIME              PIC  X(06)  VALUE SPACES.   00600000
006900     05  FILLER REDEFINES WS-CURRENT-TIME.                        00610000
007000         10 WS-CURRENT-TIME-HH        PIC  X(02).                 00620000
007100         10 WS-CURRENT-TIME-MM        PIC  X(02).                 00630000
007200         10 WS-CURRENT-TIME-SS        PIC  X(02).                 00640000
007300                                                                  00650000
007400 01  WS-WORKING-STORAGE.                                          00660000
007500     05  WS-PROCESS-LOCATION          PIC  X(01)  VALUE SPACE.    00670000
007600                                                                  00680000
007700 01  WS-PROGRAM-COUNTERS.                                         00690000
007800     05  WS-IN-DC-LOC-ASG-COUNT       PIC  9(05)  VALUE ZEROS.    00700000
007900     05  WS-INSERT-LOC-ASGMT          PIC  9(05)  VALUE ZEROS.    00710000
008000     05  WS-SKIPPED-LOCATION          PIC  9(05)  VALUE ZEROS.    00720000
008100     05  WS-RETRY-COUNTER             PIC  9(01)  VALUE ZEROS.    00730000
008200                                                                  00740000
008300*---------------------------------------------------------------* 00750000
008400* RECORD LAYOUT FOR INPUT LOCATION FILE                         * 00760000
008500*---------------------------------------------------------------* 00770000
008600     COPY HORD007.                                                00780000
008700                                                                  00790000
008800*---------------------------------------------------------------* 00800000
008900*    STANDARD DB2 ERROR HANDLING AREA                           * 00810000
009000*---------------------------------------------------------------* 00820000
009100     COPY DPWS004.                                                00830000
009200                                                                  00840000
009300*---------------------------------------------------------------* 00850000
009400*    DCLGEN FOR THE LOCATION ASSIGNMENT TABLE, XFT_LOC          * 00860000
009500*---------------------------------------------------------------* 00870000
009600     EXEC SQL                                                     00880000
009700         INCLUDE XFT00017                                         00890000
009800     END-EXEC.                                                    00900000
009900                                                                  00910000
010000*---------------------------------------------------------------* 00920000
010100*    DCLGEN FOR THE LOCATION ASSIGNMENT TABLE, XFT_LOC_ASGMT    * 00930000
010200*---------------------------------------------------------------* 00940000
010300     EXEC SQL                                                     00950000
010400         INCLUDE XFT00018                                         00960000
010500     END-EXEC.                                                    00970000
010600                                                                  00980000
010700*----------------------------------------------------------------*00990000
010800*    STANDARD DB2 COMMUNICATIONS AREA                            *01000000
010900*----------------------------------------------------------------*01010000
011000     EXEC SQL                                                     01020000
011100         INCLUDE SQLCA                                            01030000
011200     END-EXEC.                                                    01040000
011300                                                                  01050000
011400****************************************************************  01060000
011500* WORKING STORAGE FOR ABEND PROCESSING                            01070000
011600****************************************************************  01080000
011700                                                                  01090000
011800 01  ABEND-CODE                PIC S9(04)  VALUE ZEROS COMP SYNC. 01100000
011900     88  AC-DB2-ERROR                        VALUE +4013.         01110000
012000                                                                  01120000
012100 01  ABEND-AREAS.                                                 01130000
012200     05  AA-ABEND-LIT          PIC  X(40)  VALUE                  01140000
012300             '*****       ABEND'.                                 01150000
012400     05  AA-PROGRAM-LIT        PIC  X(40)  VALUE                  01160000
012500             '*****   PROGRAM: APKUP167'.                         01170000
012600     05  AA-PARAGRAPH-LIT.                                        01180000
012700         10  FILLER            PIC  X(17)  VALUE                  01190000
012800             '***** PARAGRAPH: '.                                 01200000
012900         10  AA-PARAGRAPH-NAME PIC  X(35)  VALUE SPACES.          01210000
013000     05  AA-MESSAGE-LINE.                                         01220000
013100         10  FILLER            PIC  X(06)  VALUE '*****'.         01230000
013200         10  AA-MESSAGE        PIC  X(127) VALUE SPACES.          01240000
013300         10  FILLER REDEFINES AA-MESSAGE.                         01250000
013400             15 AA-MESSAGE-1   PIC  X(45).                        01260000
013500             15 AA-MESSAGE-2   PIC  X(45).                        01270000
013600             15 AA-MESSAGE-3   PIC  X(37).                        01280000
013700     05  AA-DB2-ERROR-LIT      PIC  X(40)  VALUE                  01290000
013800             '*****    DB2 ERROR'.                                01300000
013900     05  AA-DB2-OPERATION-LIT.                                    01310000
014000         10  FILLER            PIC  X(17)  VALUE                  01320000
014100             '***** OPERATION: '.                                 01330000
014200         10  AA-DB2-OPERATION.                                    01340000
014300             15  AA-DB2-OP-1   PIC  X(25)  VALUE SPACES.          01350000
014400             15  AA-DB2-OP-2   PIC  X(25)  VALUE SPACES.          01360000
014500     05  AA-DB2-TABLE-1        PIC  X(18)  VALUE SPACES.          01370000
014600     05  AA-DB2-TABLE-2        PIC  X(18)  VALUE SPACES.          01380000
014700     05  AA-DB2-TABLE-3        PIC  X(18)  VALUE SPACES.          01390000
014800                                                                  01400000
014900*********************                                             01410000
015000 PROCEDURE DIVISION.                                              01420000
015100*********************                                             01430000
015200 A100-MAINLINE-ROUTINE.                                           01440000
015300                                                                  01450000
015400     PERFORM B100-INITIALIZAION THRU                              01460000
015500             B100-INITIALIZAION-EXIT.                             01470000
015600                                                                  01480000
015700     PERFORM B200-PROCESS-RETEK-FILE THRU                         01490000
015800             B200-PROCESS-RETEK-FILE-EXIT                         01500000
015900       UNTIL END-OF-DC-LOC-ASG-FILE.                              01510000
016000                                                                  01520000
016100     PERFORM Z900-END-OF-JOB THRU                                 01530000
016200             Z900-END-OF-JOB-EXIT.                                01540000
016300                                                                  01550000
016400     GOBACK.                                                      01560000
016500                                                                  01570000
016600 A100-MAINLINE-ROUTINE-EXIT.                                      01580000
016700     EXIT.                                                        01590000
016800                                                                  01600000
016900*************************************************************     01610000
017000** INITIALIZATION ROUTINE                                         01620000
017100*************************************************************     01630000
017200 B100-INITIALIZAION.                                              01640000
017300                                                                  01650000
017400     DISPLAY '***** BEGIN PROGRAM: ' PC-PGM-NAME ' *****'.        01660000
017500     MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATETIME.           01670000
017600     DISPLAY 'DATE: ' WS-CURRENT-DATE-MM '-' WS-CURRENT-DATE-DD   01680000
017700             '-'      WS-CURRENT-DATE-CCYY '    '                 01690000
017800             'TIME: ' WS-CURRENT-TIME-HH ':' WS-CURRENT-TIME-MM   01700000
017900             ':' WS-CURRENT-TIME-SS.                              01710000
018000     DISPLAY ' '.                                                 01720000
018100                                                                  01730000
018200     OPEN INPUT DC-LOC-ASG-FILE.                                  01740000
018300                                                                  01750000
018400     PERFORM R100-READ-DC-LOC-ASG-FILE THRU                       01760000
018500             R100-READ-DC-LOC-ASG-FILE-EXIT.                      01770000
018600                                                                  01780000
018700 B100-INITIALIZAION-EXIT.                                         01790000
018800     EXIT.                                                        01800000
018900                                                                  01810000
019000***************************************************************   01820000
019100** THIS ROUTINE PROCESS THE LOCATION ASIGNMENT FILE FROM RETEK    01830000
019200***************************************************************   01840000
019300 B200-PROCESS-RETEK-FILE.                                         01850000
019400                                                                  01860000
019500     MOVE HO007-DCLOC-LOC-NBR TO XFT00017-LOC-NBR.                01870000
019600                                                                  01880000
019700     PERFORM C100-VALIDATE-LOCATION THRU                          01890000
019800             C100-VALIDATE-LOCATION-EXIT.                         01900000
019900                                                                  01910000
020000     IF PROCESS-LOCATION                                          01920000
020100        PERFORM C200-PROCESS-LOCATION THRU                        01930000
020200                C200-PROCESS-LOCATION-EXIT                        01940000
020300     END-IF.                                                      01950000
020400                                                                  01960000
020500     PERFORM R100-READ-DC-LOC-ASG-FILE THRU                       01970000
020600             R100-READ-DC-LOC-ASG-FILE-EXIT.                      01980000
020700                                                                  01990000
020800 B200-PROCESS-RETEK-FILE-EXIT.                                    02000000
020900     EXIT.                                                        02010000
021000                                                                  02020000
021100*************************************************************     02030000
021200** THIS ROUTINE CHECKS TO SEE IF THE LOCATION EXISTS ON THE       02040000
021300** XFT_LOC TABLE, IF IT DOES IT CONTIUES TO PROCESS THE           02050000
021400** LOCATION, IF NOT WE DO NOT INSERT THE LOCATION INTO THE        02060000
021500** XFT_LOC_ASGMT TABLE.                                           02070000
021600*************************************************************     02080000
021700 C100-VALIDATE-LOCATION.                                          02090000
021800                                                                  02100000
021900     EXEC SQL                                                     02110000
022000       SELECT 'X'                                                 02120000
022100         INTO :WS-PROCESS-LOCATION                                02130000
022200         FROM XFT_LOC                                             02140000
022300        WHERE LOC_NBR = :XFT00017-LOC-NBR                         02150000
022400     END-EXEC.                                                    02160000
022500                                                                  02170000
022600     EVALUATE TRUE                                                02180000
022700       WHEN SQLCODE = ZERO                                        02190000
022800          SET PROCESS-LOCATION TO TRUE                            02200000
022900       WHEN SQLCODE = +100                                        02210000
023000          SET DO-NOT-PROCESS-LOCATION TO TRUE                     02220000
023100          ADD 1 TO WS-SKIPPED-LOCATION                            02230000
023200       WHEN SQLCODE NOT = ZERO                                    02240000
023300          DISPLAY 'LOCATION NUMBER: '      XFT00017-LOC-NBR       02250000
023400          MOVE 'C100-VALIDATE-LOCATION'    TO AA-PARAGRAPH-NAME   02260000
023500          MOVE 'SELECT'                    TO AA-DB2-OPERATION    02270000
023600          MOVE 'XFT_LOC'                   TO AA-DB2-TABLE-1      02280000
023700          PERFORM Z999-DB2-ABEND                                  02290000
023800     END-EVALUATE.                                                02300000
023900                                                                  02310000
024000 C100-VALIDATE-LOCATION-EXIT.                                     02320000
024100     EXIT.                                                        02330000
024200                                                                  02340000
024300*************************************************************     02350000
024400** THIS ROUTINE PROCESS THE LOCATIONS FROM THE DC_LOC_ASGMT       02360000
024500*************************************************************     02370000
024600 C200-PROCESS-LOCATION.                                           02380000
024700                                                                  02390000
024800*   PROCESS LOCATIONS FOUND LOAD IN XFT_LOC_ASGMT TABLE           02400000
024900                                                                  02410000
025000     INITIALIZE DCLXFT00018.                                      02420000
025100                                                                  02430000
025200     MOVE HO007-DCLOC-LOC-NBR      TO XFT00018-LOC-NBR            02440000
025300     MOVE HO007-DCLOC-EFF-BEG-DTE  TO XFT00018-EFF-BEG-DTE        02450000
025400     MOVE HO007-DCLOC-DC-NBR       TO XFT00018-DC-NBR             02460000
025500     MOVE HO007-DCLOC-PO-STRT-DTE  TO XFT00018-PO-STRT-DTE        02470000
025600                                                                  02480000
025700     PERFORM I100-INSERT-XST-LOC-ASGMT THRU                       02490000
025800             I100-INSERT-XST-LOC-ASGMT-EXIT.                      02500000
025900                                                                  02510000
026000*    CREATE LOCATION 900 LIKE LOCATION 90                         02520000
026100     IF HO007-DCLOC-LOC-NBR = 90                                  02530000
026200*       DISPLAY '***** CREATING LOCATION 900 FROM 90'             02540000
026300        MOVE 900 TO XFT00018-LOC-NBR                              02550000
026400        PERFORM I100-INSERT-XST-LOC-ASGMT THRU                    02560000
026500                I100-INSERT-XST-LOC-ASGMT-EXIT                    02570000
026600     END-IF.                                                      02580000
026700                                                                  02590000
026800 C200-PROCESS-LOCATION-EXIT.                                      02600000
026900     EXIT.                                                        02610000
027000                                                                  02620000
027100*************************************************************     02630000
027200** THIS ROUTINE INSERT INTO THE XFT_LOC_ASGMT TABLE               02640000
027300*************************************************************     02650000
027400 I100-INSERT-XST-LOC-ASGMT.                                       02660000
027500                                                                  02670000
027600     EXEC SQL                                                     02680000
027700        INSERT INTO XFT_LOC_ASGMT                                 02690000
027800           (LOC_NBR                                               02700000
027900           ,EFF_BEG_DTE                                           02710000
028000           ,DC_NBR                                                02720000
028100           ,PO_STRT_DTE                                           02730000
028200           )                                                      02740000
028300        VALUES                                                    02750000
028400           (:XFT00018-LOC-NBR                                     02760000
028500           ,:XFT00018-EFF-BEG-DTE                                 02770000
028600           ,:XFT00018-DC-NBR                                      02780000
028700           ,:XFT00018-PO-STRT-DTE                                 02790000
028800           )                                                      02800000
028900     END-EXEC.                                                    02810000
029000                                                                  02820000
029100     EVALUATE TRUE                                                02830000
029200       WHEN SQLCODE = ZERO                                        02840000
029300         ADD 1 TO WS-INSERT-LOC-ASGMT                             02850000
029400       WHEN SQLCODE NOT = ZERO                                    02860000
029500         DISPLAY 'LOCATION NUMBER: '      XFT00018-LOC-NBR        02870000
029600         MOVE 'I100-INSERT-XST-LOC-ASGMT' TO AA-PARAGRAPH-NAME    02880000
029700         MOVE 'INSERT'                    TO AA-DB2-OPERATION     02890000
029800         MOVE 'XFT_LOC_ASGMT'             TO AA-DB2-TABLE-1       02900000
029900         PERFORM Z999-DB2-ABEND                                   02910000
030000     END-EVALUATE.                                                02920000
030100                                                                  02930000
030200 I100-INSERT-XST-LOC-ASGMT-EXIT.                                  02940000
030300     EXIT.                                                        02950000
030400                                                                  02960000
030500*************************************************************     02970000
030600** THIS ROUTINE READS THE DCLOCASG FILE FROM RMS                  02980000
030700*************************************************************     02990000
030800 R100-READ-DC-LOC-ASG-FILE.                                       03000000
030900                                                                  03010000
031000     READ DC-LOC-ASG-FILE INTO HORD007-RECORD                     03020000
031100        AT END                                                    03030000
031200           SET END-OF-DC-LOC-ASG-FILE TO TRUE                     03040000
031300        NOT AT END                                                03050000
031400           ADD 1 TO WS-IN-DC-LOC-ASG-COUNT                        03060000
031500     END-READ.                                                    03070000
031600                                                                  03080000
031700 R100-READ-DC-LOC-ASG-FILE-EXIT.                                  03090000
031800     EXIT.                                                        03100000
031900                                                                  03110000
032000*************************************************************     03120000
032100** END OF PROGRAM PROCESSING                                      03130000
032200*************************************************************     03140000
032300 Z900-END-OF-JOB.                                                 03150000
032400                                                                  03160000
032500     CLOSE DC-LOC-ASG-FILE.                                       03170000
032600                                                                  03180000
032700     DISPLAY ' '.                                                 03190000
032800     DISPLAY '********* PROGRAM COUNTS: *********'.               03200000
032900     DISPLAY 'IN LOCATION REC:  ' WS-IN-DC-LOC-ASG-COUNT          03210000
033000     DISPLAY ' '.                                                 03220000
033100     DISPLAY 'INSERTS LOC ASGMT: ' WS-INSERT-LOC-ASGMT            03230000
033200     DISPLAY ' '.                                                 03240000
033300     DISPLAY 'SKIPPED LOCATIONS: ' WS-SKIPPED-LOCATION            03250000
033400     DISPLAY '****** END PROGRAM ' PC-PGM-NAME ' *******'.        03260000
033500                                                                  03270000
033600 Z900-END-OF-JOB-EXIT.                                            03280000
033700     EXIT.                                                        03290000
033800                                                                  03300000
033900*************************************************************     03310000
034000*     DB2 ABEND ROUTINE                                           03320000
034100*************************************************************     03330000
034200 Z999-DB2-ABEND.                                                  03340000
034300                                                                  03350000
034400     DISPLAY AA-ABEND-LIT.                                        03360000
034500     DISPLAY AA-DB2-ERROR-LIT.                                    03370000
034600     DISPLAY AA-PROGRAM-LIT.                                      03380000
034700     DISPLAY AA-PARAGRAPH-LIT.                                    03390000
034800     DISPLAY AA-DB2-OPERATION-LIT.                                03400000
034900     DISPLAY AA-DB2-TABLE-1.                                      03410000
035000     DISPLAY AA-DB2-TABLE-2.                                      03420000
035100     DISPLAY AA-DB2-TABLE-3.                                      03430000
035200     SET AC-DB2-ERROR TO TRUE.                                    03440000
035300                                                                  03450000
035400     COPY DPPD004.                                                03460000
035500                                                                  03470000
035600     CALL 'ILBOABN0' USING ABEND-CODE.                            03480000
035700                                                                  03490000
