000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.             RCKUP061.                                00040001
000500 AUTHOR.                 V.SUDHAN.                                00050001
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060001
000700 DATE-WRITTEN.           MARCH, 2010.                             00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*                                                               * 00100001
001100*  THIS PROGRAM WILL READ THE EXTRACT FILE OF PO-RCVR TRACKING  * 00110001
001200*  MESSAGES THAT NEED TO BE DELETED.  THE EXTRACT FILE IS       * 00120001
001300*  CREATED BY PROGRAM RCKUT146/RCKUT147.                        * 00130001
001400*                                                               * 00140001
001500***************************************************************** 00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700***************************************************************** 00170001
001800*                                                                 00180001
001900 CONFIGURATION SECTION.                                           00190001
002000*                                                                 00200001
002100 SOURCE-COMPUTER.        IBM-3090.                                00210001
002200 OBJECT-COMPUTER.        IBM-3090.                                00220001
002300*                                                                 00230001
002400 INPUT-OUTPUT SECTION.                                            00240001
002500*                                                                 00250001
002600 FILE-CONTROL.                                                    00260001
002700*                                                                 00270001
002800     SELECT RCVR-PURGE-REC-FILE                                   00280001
002900            ASSIGN TO INP01.                                      00290001
003000*                                                                 00300001
003100***************************************************************** 00310001
003200 DATA DIVISION.                                                   00320001
003300***************************************************************** 00330001
003400*                                                                 00340001
003500 FILE SECTION.                                                    00350001
003600*                                                                 00360001
003700 FD  RCVR-PURGE-REC-FILE                                          00370001
003800     RECORDING MODE IS F                                          00380001
003900     BLOCK CONTAINS 0  RECORDS.                                   00390001
004000 01  RCVR-PURGE-EXT-REC              PIC  X(110).                 00400001
004100*                                                                 00410001
004200 WORKING-STORAGE SECTION.                                         00420001
004300*                                                                 00430001
004400 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00440001
004500                                                   COMP SYNC.     00450001
004600*                                                                 00460001
004700 01  PROGRAM-SWITCHES.                                            00470001
004800     05  PS-EOF-RCVR-FILE-SW         PIC  X(01)    VALUE 'N'.     00480001
004900         88  PS-EOF-RCVR-FILE                      VALUE 'Y'.     00490001
005000         88  PS-NOT-EOF-RCVR-FILE                  VALUE 'N'.     00500001
005100*                                                                 00510001
005200 01  PC-PROGRAM-CONSTANTS.                                        00520001
005300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00530001
005400                                                   'RCKUP061'.    00540001
005500     05  PC-FROM-DATE                PIC  X(10)  VALUE SPACES.    00550001
005600     05  PC-TO-DATE                  PIC  X(10)  VALUE SPACES.    00560001
005700     05  PC-VERIFY-B4-DATE           PIC  X(10)  VALUE SPACES.    00570001
005800*                                                                 00580001
005900 01  PV-PROGRAM-VARIABLES.                                        00590001
006000     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00600001
006100     05  PV-DB2-OPERATION            PIC  X(30)  VALUE SPACES.    00610001
006200     05  PV-RCVR-DATA-CNT            PIC  9(09)  VALUE ZEROS.     00620001
006300     05  PV-REC-READ-COUNT           PIC  9(09)  VALUE ZEROS.     00630001
006400     05  PV-COMMIT-COUNTER           PIC  9(09)  VALUE ZEROS.     00640001
006500     05  PV-NUMBER-OF-COMMITS        PIC  9(09)  VALUE ZEROS.     00650001
006600*                                                                 00660001
006700 01  PV-DISP-KEY-MSG.                                             00670001
006800     05  FILLER                      PIC X(10) VALUE              00680002
006900         'PO NUMBER='.                                            00690002
007000     05  PV-PO-NBR                   PIC 9(09) VALUE ZEROES.      00700001
007100                                                                  00710001
007200     05  FILLER                      PIC X(07) VALUE              00720002
007300         '  RCVR='.                                               00730002
007400     05  PV-PO-RCVR                  PIC 9(04) VALUE ZEROES.      00740002
007500     05  FILLER                      PIC X(10) VALUE              00750002
007600         '  USER ID='.                                            00760002
007700     05  PV-USER-ID                  PIC X(08) VALUE SPACES.      00770001
007800     05  FILLER                      PIC X(07) VALUE              00780002
007900         '  TMST='.                                               00790002
008000     05  PV-TIME-STAMP               PIC X(26) VALUE ZEROES.      00800001
008100******************************************************************00810001
008200*  COPY BOOK FOR THE RECEIVER TRACKING TABLE                      00820001
008300******************************************************************00830001
008400     COPY RCRD090.                                                00840001
008500******************************************************************00850001
008600*  DB2 FORMATTED MESSAGE AREA                                     00860001
008700******************************************************************00870001
008800     COPY DPWS004.                                                00880001
008900******************************************************************00890001
009000*  DB2 COMMUNICATION AREA                                         00900001
009100******************************************************************00910001
009200     EXEC SQL                                                     00920001
009300         INCLUDE SQLCA                                            00930001
009400     END-EXEC.                                                    00940001
009500******************************************************************00950001
009600*  DB2 COMMUNICATION AREA2                                        00960001
009700******************************************************************00970001
009800     COPY SQLCA2.                                                 00980001
009900******************************************************************00990001
010000*  COPY BOOK FOR THE RECEIVER TABLE                               01000001
010100******************************************************************01010001
010200*                                                                 01020001
010300     EXEC SQL                                                     01030001
010400          INCLUDE RCT00017                                        01040001
010500     END-EXEC.                                                    01050001
010600*                                                                 01060001
010700 PROCEDURE DIVISION.                                              01070001
010800*                                                                 01080001
010900******************************************************************01090001
011000**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                    **01100001
011100******************************************************************01110001
011200*                                                                 01120001
011300 0000-MAINLINE-PROCESSING.                                        01130001
011400*                                                                 01140001
011500     PERFORM 1000-INITIALIZATION.                                 01150001
011600*                                                                 01160001
011700     PERFORM 2000-PROCESS-RCVR-EXT-DATA UNTIL                     01170001
011800             PS-EOF-RCVR-FILE.                                    01180001
011900*                                                                 01190001
012000     DISPLAY '                                             '.     01200001
012100     DISPLAY '** RCKUP061-TOTAL NO OF RECORDS READ       : '      01210001
012200             PV-REC-READ-COUNT                                    01220001
012300     DISPLAY '** RCKUP061-TOTAL NO OF RECORDS DELETED    : '      01230001
012400             PV-RCVR-DATA-CNT                                     01240001
012500     DISPLAY '** RCKUP061-NUMBER OF COMMITS TAKEN        : '      01250001
012600             PV-NUMBER-OF-COMMITS                                 01260001
012700     DISPLAY '                                             '.     01270001
012800     DISPLAY '** PROGRAM RCKUP061 EXECUTION ENDED   **     '.     01280001
012900*                                                                 01290001
013000     CLOSE RCVR-PURGE-REC-FILE.                                   01300001
013100*                                                                 01310001
013200     GOBACK.                                                      01320001
013300*                                                                 01330001
013400******************************************************************01340001
013500** PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.              **01350001
013600******************************************************************01360001
013700*                                                                 01370001
013800 1000-INITIALIZATION.                                             01380001
013900*                                                                 01390001
014000     DISPLAY '** PROGRAM RCKUP061 EXECUTION STARTED **'.          01400001
014100*                                                                 01410001
014200     MOVE ZEROES                   TO PV-COMMIT-COUNTER           01420001
014300                                      PV-NUMBER-OF-COMMITS        01430001
014400     OPEN INPUT  RCVR-PURGE-REC-FILE.                             01440001
014500*                                                                 01450001
014600     SET  PS-NOT-EOF-RCVR-FILE     TO TRUE.                       01460001
014700     PERFORM 8000-READ-RCVR-DATA-FILE.                            01470001
014800     IF PS-EOF-RCVR-FILE                                          01480001
014900        DISPLAY '                                       '         01490001
015000        DISPLAY '** RCKUP061-RECEIVER DATA FILE IS EMPTY'         01500001
015100     END-IF.                                                      01510001
015200*                                                                 01520001
015300******************************************************************01530001
015400**  THIS PARAGRAPH READS THE RECORDS FROM PO ORD NBR PURGE CSR  **01540001
015500**  RCVR-DATA-CSR  AND WRITE A RECORD TO THE OUTPUT FILE.       **01550001
015600******************************************************************01560001
015700*                                                                 01570001
015800 2000-PROCESS-RCVR-EXT-DATA.                                      01580001
015900*                                                                 01590001
016000      IF PV-COMMIT-COUNTER > 100                                  01600001
016100         PERFORM 8200-COMMIT-DB2                                  01610001
016110         DISPLAY 'COMMIT:'                                        01611003
016120                 '   RECORDS READ-' PV-REC-READ-COUNT             01612003
016130                 '   RECORDS DELETED-' PV-RCVR-DATA-CNT           01613003
016200         MOVE ZEROES      TO  PV-COMMIT-COUNTER                   01620001
016300      END-IF.                                                     01630001
016400      PERFORM 8100-DELETE-RCVR-DATA                               01640001
016500      PERFORM 8000-READ-RCVR-DATA-FILE.                           01650001
016600*                                                                 01660001
016700******************************************************************01670001
016800** THIS PARAGRAPH WILL SELECT THE DATE RANGE TO FETCH THE       **01680001
016900** RECORDS FROM THE RECEIVER TABLES (TRECEIV AND TRECITM)       **01690001
017000******************************************************************01700001
017100*                                                                 01710001
017200 8000-READ-RCVR-DATA-FILE.                                        01720001
017300*                                                                 01730001
017400     MOVE '8000-READ-RCVR-DATA-FILE' TO  PV-PARAGRAPH-NAME.       01740001
017500*                                                                 01750001
017600     READ RCVR-PURGE-REC-FILE                                     01760001
017700         INTO                                                     01770001
017800             RC090-PO-RCVR-TRKG-DELETE                            01780001
017900         AT END                                                   01790001
018000             SET PS-EOF-RCVR-FILE      TO TRUE                    01800001
018100         NOT AT END                                               01810001
018200             ADD 1                     TO PV-REC-READ-COUNT       01820001
018300     END-READ.                                                    01830001
018400*                                                                 01840001
018500******************************************************************01850001
018600**  THIS PARAGRAPH OPENS THE CURSOR WHICH WILL CONTAIN THE NO   **01860001
018700**  OF PO ORD THAT CAN BEOLD ENOUGH AND CAN BE PURGED.          **01870001
018800******************************************************************01880001
018900*                                                                 01890001
019000 8100-DELETE-RCVR-DATA.                                           01900001
019100*                                                                 01910001
019200     EXEC SQL                                                     01920001
019300          DELETE FROM RCT_PO_RCVR_TRKG                            01930001
019400                 WHERE  PO_NBR        = :RC090-PO-NBR             01940001
019500                   AND  RCVR_SEQ_NBR  = :RC090-RCVR-SEQ-NBR       01950001
019600                   AND  CRE_BY_USR_ID = :RC090-CRE-BY-USR-ID      01960001
019700                   AND  CRE_TMST      = :RC090-CRE-TMST           01970001
019800     END-EXEC.                                                    01980001
019900*                                                                 01990001
020000     EVALUATE TRUE                                                02000001
020100         WHEN SQLCODE = 0                                         02010001
020200              ADD +1 TO PV-RCVR-DATA-CNT                          02020001
020300                        PV-COMMIT-COUNTER                         02030001
020400         WHEN SQLCODE = +100                                      02040001
020500              MOVE RC090-PO-NBR        TO PV-PO-NBR               02050001
020600              MOVE RC090-RCVR-SEQ-NBR  TO PV-PO-RCVR              02060001
020700              MOVE RC090-CRE-BY-USR-ID TO PV-USER-ID              02070001
020800              MOVE RC090-CRE-TMST      TO PV-TIME-STAMP           02080001
020900              DISPLAY 'NOT FOUND : ' PV-DISP-KEY-MSG              02090002
021000         WHEN SQLCODE = -904                                      02100001
021100         WHEN SQLCODE = -911                                      02110001
021200         WHEN SQLCODE = -913                                      02120001
021300             CONTINUE                                             02130001
021400         WHEN SQLCODE < ZERO                                      02140001
021500             MOVE RC090-PO-NBR        TO PV-PO-NBR                02150001
021600             MOVE RC090-RCVR-SEQ-NBR  TO PV-PO-RCVR               02160001
021700             MOVE RC090-CRE-BY-USR-ID TO PV-USER-ID               02170001
021800             MOVE RC090-CRE-TMST      TO PV-TIME-STAMP            02180001
021900             DISPLAY '**************************************'     02190001
022000             DISPLAY 'ERROR ISSUED'                               02200001
022100             DISPLAY 'DELETE RCT_PO_RCVR_TRKG               '     02210001
022200             DISPLAY PV-DISP-KEY-MSG                              02220001
022300             DISPLAY '**************************************'     02230001
022400             MOVE '8100-DELETE-RCVR-DATA'                         02240001
022500                             TO PV-PARAGRAPH-NAME                 02250001
022600             MOVE 'DELETE FROM RCT_PO_RCVR_TRKG  '                02260001
022700                             TO PV-DB2-OPERATION                  02270001
022800             PERFORM 9000-SQL-ABEND                               02280001
022900     END-EVALUATE.                                                02290001
023000*                                                                 02300001
023100******************************************************************02310001
023200* DB2 COMMIT                                                      02320001
023300******************************************************************02330001
023400 8200-COMMIT-DB2.                                                 02340001
023500                                                                  02350001
023600     EXEC SQL                                                     02360001
023700        COMMIT                                                    02370001
023800     END-EXEC.                                                    02380001
023900                                                                  02390001
024000     EVALUATE SQLCODE                                             02400001
024100         WHEN ZERO                                                02410001
024200             ADD +1 TO PV-NUMBER-OF-COMMITS                       02420001
024300         WHEN OTHER                                               02430001
024400             MOVE '8200-COMMIT-DB2'   TO  PV-PARAGRAPH-NAME       02440001
024500             MOVE 'RCKUP061 ABENDING ON COMMIT'                   02450001
024600                                      TO  PV-DB2-OPERATION        02460001
024700             PERFORM 9000-SQL-ABEND                               02470001
024800     END-EVALUATE.                                                02480001
024900******************************************************************02490001
025000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL   *02500001
025100*  ERROR OR WARNING CODE OCCURS.                                 *02510001
025200******************************************************************02520001
025300*                                                                 02530001
025400 9000-SQL-ABEND.                                                  02540001
025500*                                                                 02550001
025600     DISPLAY '9000-SQL-ABEND'.                                    02560001
025700     DISPLAY '** ABEND     **'.                                   02570001
025800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02580001
025900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02590001
026000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               02600001
026100*                                                                 02610001
026200******************************************************************02620001
026300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *02630001
026400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *02640001
026500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *02650001
026600* FORMAT.                                                        *02660001
026700******************************************************************02670001
026800*                                                                 02680001
026900     COPY DPPD004.                                                02690001
027000*                                                                 02700001
027100     MOVE +4013         TO ABEND-CODE.                            02710001
027200     CALL 'ILBOABN0' USING ABEND-CODE.                            02720001
027300*                                                                 02730001
