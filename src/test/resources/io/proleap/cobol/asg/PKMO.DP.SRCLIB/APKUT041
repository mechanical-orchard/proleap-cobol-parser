000100 IDENTIFICATION DIVISION.                                         00010023
000200 PROGRAM-ID.     APKUT041.                                        00020023
000300 AUTHOR.         M WILKINSON.                                     00030023
000400*DATE-WRITTEN.   NOV 19, 1996.                                    00040023
000500*DATE-COMPILED.                                                   00050023
000600*************************************************************     00060023
000700*    COBOL 2                                                *     00070023
000800*                                                           *     00080023
000900*    BUMP INVOICE TO RECEIVING TO PULL OFF THE RECEIVING    *     00090023
001000*    DETAIL WHERE THE INVOICE HAS NO DETAIL ENTERED         *     00100023
001100*                                                           *     00110023
001200*************************************************************     00120023
001300*                                                           *     00130023
001400* INPUT                                                     *     00140023
001500* INP01   -  INVOICE FILE                                   *     00150023
001600* INP02   -  DUMP OF RECEIVE - SORTED INTO REPORT REC(DESC),*     00160023
001700*            PURCHASE ORDER, STORE NUMBER                   *     00170023
001800*                                                           *     00180023
001900* OUTPUT                                                    *     00190023
002000* OUT01   -  RECEIVING DETAIL FILE THAT MATCHES INVOICES    *     00200023
002100*            WITH NO DETAIL ENTERED                         *     00210023
002200*            ALL REPORT TYPE 01 AND 02 RECORDS              *     00220023
002300*************************************************************     00230023
002400* CHANGE LOG:                                               *     00240023
002500*                                                           *     00250023
002600* 11/19/96  INITIAL VERSION.                                *     00260023
002700*                                                           *     00270023
002800* 01/16/98  RECOMPILED DUE TO ADDITIONAL FIELD IN COPYBOOK  *     00280023
002900*           APRD060.                                        *     00290023
003000*           BY:  MARK BURNSIDE                    WR# 4164  *     00300023
003100*                                                           *     00310023
003110* 03/11/07  MATCH BY DC PROJECT.                            *     00311034
003120*           ADDED NEW OUTPUT FILE FOR UNMATCHED RECEIVING   *     00312030
003121*           RECORDS.  IF THERE IS NOT A MATCH FOR BULK OR   *     00312130
003122*           STORE THE RECORD IS WRITTEN TO THE NEW          *     00312230
003123*           UNMATCHED FILE.                                 *     00312330
003130*           BY:  ROLF NOHE                        WR# 21578 *     00313024
003140*                                                           *     00314024
003141* DATE  11/14/2014                                          *     00315036
003142*      RECOMPILED THE PROGRAM. CHANGES WERE MADE TO APRD271 *     00316036
003143*      COPYBOOK.                                            *     00317036
003144*      MADE BY: COGNIZANT              WR/IR: CHG0094517    *     00318036
003140*                                                           *     00319037
003141* DATE  05/11/2021                                          *     00319138
003142*      RECOMPILED FOR UPDATED COPYBOOK APWS008              *     00319237
003144*      MADE BY: JEAN KURK              WR/IR: CHG0256545    *     00319437
003200*************************************************************     00320023
003300                                                                  00330023
003400 ENVIRONMENT DIVISION.                                            00340023
003500                                                                  00350023
003600 INPUT-OUTPUT SECTION.                                            00360023
003700                                                                  00370023
003800 FILE-CONTROL.                                                    00380023
003900     SELECT INVOICES-FILE      ASSIGN    TO UT-S-INP01.           00390023
004000     SELECT DTL-ENTRY-FILE     ASSIGN    TO UT-S-INP02.           00400023
004100     SELECT UPDT-DTL-ENTRY-FILE ASSIGN   TO UT-S-OUT01.           00410023
004110     SELECT UNMTCH-DTL-ENTRY-FILE ASSIGN TO UT-S-OUT02.           00411025
004200 DATA DIVISION.                                                   00420023
004300                                                                  00430023
004400 FILE SECTION.                                                    00440023
004500 FD  INVOICES-FILE                                                00450023
004600         LABEL RECORDS  ARE STANDARD                              00460023
004700         RECORDING MODE IS  F                                     00470023
004800         DATA RECORD    IS  INVOICE-RECORD.                       00480023
004900                                                                  00490023
005000 01  INVOICE-RECORD                PIC X(175).                    00500023
005100                                                                  00510023
005200 FD  DTL-ENTRY-FILE                                               00520023
005300         LABEL RECORDS  ARE STANDARD                              00530023
005400         RECORDING MODE IS  F                                     00540023
005500         DATA RECORD    IS  DTL-ENTRY-IN.                         00550023
005600                                                                  00560023
005700 01  DTL-ENTRY-IN                  PIC X(150).                    00570023
005800                                                                  00580023
005900 FD  UPDT-DTL-ENTRY-FILE                                          00590023
006000         LABEL RECORDS  ARE STANDARD                              00600023
006100         RECORDING MODE IS  F                                     00610023
006200         DATA RECORD    IS  UPDT-DTL-ENTRY-RECORD.                00620023
006300                                                                  00630023
006400 01  UPDT-DTL-ENTRY-RECORD         PIC X(150).                    00640023
006401                                                                  00640125
006411 FD  UNMTCH-DTL-ENTRY-FILE                                        00641125
006420         LABEL RECORDS  ARE STANDARD                              00642025
006430         RECORDING MODE IS  F                                     00643025
006440         DATA RECORD    IS  UNMTCH-DTL-ENTRY-RECORD.              00644025
006450                                                                  00645025
006460 01  UNMTCH-DTL-ENTRY-RECORD       PIC X(150).                    00646025
006500                                                                  00650023
006600/                                                                 00660023
006700 WORKING-STORAGE SECTION.                                         00670023
006800                                                                  00680023
006900 01  FILLER                        PIC X(25) VALUE                00690023
007000                             'WS FOR APKUT041 BEGINS==>'.         00700023
007100 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00710023
007200                                             VALUE ZEROS.         00720023
007300                                                                  00730023
007400 01  PV-ABEND-FIELDS.                                             00740023
007500     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT041'. 00750023
007600     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     00760023
007700     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00770023
007800     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00780023
007900     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00790023
008000     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00800023
008100     05  PV-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     00810023
008200     05  PV-ABEND-STRUCTURE-4         PIC X(8)  VALUE SPACES.     00820023
008300     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     00830023
008400                                                                  00840023
008500 01  PV-WORK-AREA.                                                00850023
008600     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUT041'.  00860023
008700     05  PV-INVOICE-IN-REC-CNT   PIC 9(09)     VALUE 0.           00870023
008800     05  PV-DTL-ENTRY-IN-REC-CNT PIC 9(09)     VALUE 0.           00880023
008900     05  PV-RECEIV-OUT-REC-CNT PIC 9(09)        VALUE 0.          00890023
008920     05  PV-UNMATCH-OUT-REC-CNT  PIC 9(09)     VALUE 0.           00892025
009000*                                                                 00900023
009100 01  PV-SWITCHES.                                                 00910023
009200     05  END-OF-INVOICE-SW       PIC X(01) VALUE 'N'.             00920023
009300         88  END-OF-INVOICES               VALUE 'Y'.             00930023
009400         88  NOT-END-OF-INVOICES           VALUE 'N'.             00940023
009500     05  END-OF-RECEIV-SW        PIC X(01) VALUE 'N'.             00950023
009600         88  END-OF-RECEIV                 VALUE 'Y'.             00960023
009700         88  NOT-END-OF-RECEIV             VALUE 'N'.             00970023
009800     05  END-OF-RECEIV-POLINE-SW PIC X(01) VALUE 'N'.             00980023
009900         88  END-OF-RECEIV-PO-LNE-REC      VALUE 'Y'.             00990023
010000         88  NOT-END-OF-RECEIV-PO-LNE-REC  VALUE 'N'.             01000023
010100                                                                  01010023
010200 01  FILLER                      PIC X(35)  VALUE                 01020023
010300     'BEGINNING OF AP060 INPUT FILE    **'.                       01030023
010400     COPY APRD060.                                                01040023
010500                                                                  01050023
010600 01  FILLER                      PIC X(35)  VALUE                 01060023
010700     'BEGINNING OF AP271 OUTPUT FILE   **'.                       01070023
010800     COPY APRD271.                                                01080023
010900                                                                  01090023
011000 01  FILLER                      PIC X(35)  VALUE                 01100023
011100     'END OF AP WORK RECORD AREA       **'.                       01110023
011200                                                                  01120023
011300 01  FILLER                        PIC X(25) VALUE                01130023
011400          '<====PV FOR APKUT041 ENDS'.                            01140023
011500                                                                  01150023
011600*LINKAGE SECTION.                                                 01160023
011700                                                                  01170023
011800                                                                  01180023
011900 PROCEDURE DIVISION.                                              01190023
012000                                                                  01200023
012100 A100-MAINLINE.                                                   01210023
012200                                                                  01220023
012310     PERFORM H100-HOUSEKEEPING.                                   01231026
012400                                                                  01240023
012500     PERFORM B100-PROCESSING                                      01250023
012600        UNTIL END-OF-INVOICES                                     01260023
012700           OR END-OF-RECEIV                                       01270023
012800           OR END-OF-RECEIV-PO-LNE-REC.                           01280023
012900                                                                  01290023
013000     IF NOT END-OF-RECEIV                                         01300023
013100        PERFORM B300-PROCESS-REST                                 01310023
013200           UNTIL END-OF-RECEIV                                    01320023
013300     END-IF.                                                      01330023
013400                                                                  01340023
013500     PERFORM Z900-END-OF-JOB.                                     01350023
013600                                                                  01360023
013700     GOBACK.                                                      01370023
013800        EJECT                                                     01380023
013900                                                                  01390023
014000 B100-PROCESSING.                                                 01400023
014100     MOVE 'B100-PROCESSING  '    TO PV-ABEND-PARAGRAPH.           01410023
014200                                                                  01420023
014300     IF AP060-PO-NBR =  AP271-PURCHASE-ORDER                      01430023
014400        IF AP060-MTCH-LOC-NBR = 0                                 01440025
014500          PERFORM B200-PROCESS-UPDT                               01450023
014600             UNTIL END-OF-RECEIV             OR                   01460023
014700                   END-OF-RECEIV-PO-LNE-REC  OR                   01470023
014800                  (AP060-PO-NBR NOT = AP271-PURCHASE-ORDER)       01480023
014900           PERFORM R100-READ-INVOICE                              01490023
015000        ELSE                                                      01500023
015100           IF AP060-MTCH-LOC-NBR = AP271-STORE-NUMBER             01510025
015200              PERFORM B200-PROCESS-UPDT                           01520023
015300               UNTIL END-OF-RECEIV             OR                 01530023
015400                     END-OF-RECEIV-PO-LNE-REC  OR                 01540023
015500                    (AP060-PO-NBR NOT = AP271-PURCHASE-ORDER) OR  01550023
015600                    (AP060-PO-NBR     = AP271-PURCHASE-ORDER AND  01560023
015700                     AP060-MTCH-LOC-NBR NOT = AP271-STORE-NUMBER) 01570025
015800           ELSE                                                   01580023
015900              IF AP060-MTCH-LOC-NBR > AP271-STORE-NUMBER          01590025
016000                 PERFORM W200-WRITE-UNMATCHED                     01600033
016010                 PERFORM R200-READ-AP271                          01601025
016100              ELSE                                                01610023
016200                 PERFORM R100-READ-INVOICE                        01620023
016300              END-IF                                              01630023
016400           END-IF                                                 01640023
016500     ELSE                                                         01650023
016600        IF AP060-PO-NBR > AP271-PURCHASE-ORDER                    01660023
016610                 PERFORM W200-WRITE-UNMATCHED                     01661034
016700           PERFORM R200-READ-AP271                                01670023
016800        ELSE                                                      01680023
016900           PERFORM R100-READ-INVOICE                              01690023
017000        END-IF                                                    01700023
017100     END-IF.                                                      01710023
017200                                                                  01720023
017300 B200-PROCESS-UPDT.                                               01730023
017400                                                                  01740023
017500     MOVE AP060-VENDOR-NAME      TO AP271-VENDOR-NAME.            01750023
017600     IF AP060-MTCH-LOC-NBR = 0                                    01760025
017700        MOVE ZEROS               TO AP271-STORE-NUMBER            01770031
017710     ELSE                                                         01771031
017720        MOVE AP060-MTCH-LOC-NBR  TO AP271-STORE-NUMBER            01772031
017730        MOVE AP060-DC-NBR        TO AP271-DC-NBR                  01773031
017731        MOVE AP060-MTCH-LVL-CDE  TO AP271-MTCH-LVL-CDE            01773134
017740     END-IF.                                                      01774031
017800                                                                  01780023
017900     PERFORM W100-WRITE-MATCHED.                                  01790023
018000                                                                  01800023
018100     PERFORM R200-READ-AP271.                                     01810023
018200                                                                  01820023
018300 B300-PROCESS-REST.                                               01830023
018400                                                                  01840023
018500     IF NOT PO-LINE-REC                                           01850023
018600        PERFORM W200-WRITE-UNMATCHED.                             01860032
018700                                                                  01870023
018800     PERFORM R200-READ-AP271.                                     01880023
018900                                                                  01890023
019000 H100-HOUSEKEEPING.                                               01900023
019100*                                                                 01910023
019200***************************************************************** 01920023
019300*    OPEN FILES                                                   01930023
019400***************************************************************** 01940023
019500*                                                                 01950023
019600     MOVE 'H100-HOUSEKEEPING' TO PV-ABEND-PARAGRAPH.              01960023
019700                                                                  01970023
019800     SET NOT-END-OF-INVOICES     TO TRUE.                         01980023
019900     SET NOT-END-OF-RECEIV       TO TRUE.                         01990023
020000     SET NOT-END-OF-RECEIV-PO-LNE-REC TO TRUE.                    02000023
020100                                                                  02010023
020200     OPEN INPUT  INVOICES-FILE                                    02020023
020300                 DTL-ENTRY-FILE                                   02030023
020410          OUTPUT UPDT-DTL-ENTRY-FILE                              02041027
020411          OUTPUT UNMTCH-DTL-ENTRY-FILE.                           02041127
020500                                                                  02050023
020600     PERFORM R100-READ-INVOICE.                                   02060023
020700                                                                  02070023
020800     PERFORM R200-READ-AP271.                                     02080023
020900                                                                  02090023
021000 R100-READ-INVOICE.                                               02100023
021100*                                                                 02110023
021200***************************************************************** 02120023
021300*     READ THE SELECTED INVOICE FILE                              02130023
021400***************************************************************** 02140023
021500*                                                                 02150023
021600     MOVE 'R100-READ-INVOICE' TO PV-ABEND-PARAGRAPH.              02160023
021700                                                                  02170023
021800     IF NOT END-OF-INVOICES                                       02180023
021900        READ INVOICES-FILE INTO AP060-INVOICE-EXTRACT             02190023
022000          AT END  SET END-OF-INVOICES TO TRUE.                    02200023
022100                                                                  02210023
022200     IF NOT END-OF-INVOICES                                       02220023
022300        ADD 1 TO PV-INVOICE-IN-REC-CNT.                           02230023
022400                                                                  02240023
022500 R200-READ-AP271.                                                 02250023
022600*                                                                 02260023
022700***************************************************************** 02270023
022800*     READ THE DUMPED RECEIV BATCH MATCH FILE                     02280023
022900***************************************************************** 02290023
023000*                                                                 02300023
023100     MOVE 'R200-READ-AP271  ' TO PV-ABEND-PARAGRAPH.              02310023
023200                                                                  02320023
023300     IF NOT END-OF-RECEIV                                         02330023
023400        READ DTL-ENTRY-FILE INTO AP271-RECORD                     02340023
023500          AT END  SET END-OF-RECEIV TO TRUE.                      02350023
023600                                                                  02360023
023700     IF NOT END-OF-RECEIV                                         02370023
023800        ADD 1 TO PV-DTL-ENTRY-IN-REC-CNT                          02380023
023900        IF NOT PO-LINE-REC                                        02390023
024000           SET END-OF-RECEIV-PO-LNE-REC TO TRUE                   02400023
024100        END-IF                                                    02410023
024200     END-IF.                                                      02420023
024300                                                                  02430023
024400 W100-WRITE-MATCHED.                                              02440023
024500*                                                                 02450023
024600***************************************************************** 02460023
024700*     WRITE THE DUMPED BATCH MATCH FILE    - BULK                 02470023
024800***************************************************************** 02480023
024900*                                                                 02490023
025000     MOVE 'W100-WRITE-MATCHED' TO PV-ABEND-PARAGRAPH.             02500023
025100                                                                  02510023
025200     WRITE UPDT-DTL-ENTRY-RECORD FROM AP271-RECORD.               02520023
025300                                                                  02530023
025400     ADD 1 TO PV-RECEIV-OUT-REC-CNT.                              02540023
025500                                                                  02550023
025510 W200-WRITE-UNMATCHED.                                            02551025
025520*                                                                 02552025
025530***************************************************************** 02553025
025540*     WRITE THE DUMPED UNMATCH FILE                               02554025
025550***************************************************************** 02555025
025560*                                                                 02556025
025570     MOVE 'W200-WRITE-UNMATCHED' TO PV-ABEND-PARAGRAPH.           02557025
025580                                                                  02558025
025590     WRITE UNMTCH-DTL-ENTRY-RECORD FROM AP271-RECORD.             02559025
025591                                                                  02559125
025592     ADD 1 TO PV-UNMATCH-OUT-REC-CNT.                             02559225
025593                                                                  02559325
025600 Z900-END-OF-JOB.                                                 02560023
025700*                                                                 02570023
025800***************************************************************** 02580023
025900*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 02590023
026000***************************************************************** 02600023
026100*                                                                 02610023
026200     MOVE 'Z900-END-OF-JOB  ' TO PV-ABEND-PARAGRAPH.              02620023
026300                                                                  02630023
026400     DISPLAY '************************************************'.  02640023
026500     DISPLAY 'TOTAL INVOICE  RECORDS READ    = '                  02650023
026600              PV-INVOICE-IN-REC-CNT.                              02660023
026700     DISPLAY 'TOTAL AP271 RECEIV RECS READ   = '                  02670023
026800              PV-DTL-ENTRY-IN-REC-CNT.                            02680023
026900     DISPLAY '************************************************'.  02690023
027000     DISPLAY 'TOTAL AP271 INVC MATCH RECS OUT= '                  02700023
027100              PV-RECEIV-OUT-REC-CNT.                              02710023
027200     DISPLAY '************************************************'.  02720023
027210     DISPLAY 'TOTAL AP271 INV UNMTCH RECS OUT= '                  02721025
027220              PV-UNMATCH-OUT-REC-CNT.                             02722025
027230     DISPLAY '************************************************'.  02723025
027300                                                                  02730023
027400     DISPLAY ' PROGRAM APKUT041 ENDS NORMALLY '.                  02740023
027500                                                                  02750023
027600     CLOSE       INVOICES-FILE                                    02760023
027700                 DTL-ENTRY-FILE                                   02770023
027810                 UPDT-DTL-ENTRY-FILE                              02781025
027820                 UNMTCH-DTL-ENTRY-FILE.                           02782025
027900                                                                  02790023
