000400 IDENTIFICATION DIVISION.                                         00040002
000500 PROGRAM-ID.    DLKUT031.                                         00050002
000600 AUTHOR.        DENISE HAHN.                                      00060002
000700                                                                  00070002
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080002
000900 DATE-WRITTEN.  DECEMBER 2008.                                    00090002
001000 DATE-COMPILED.                                                   00100002
001100                                                                  00110002
001200 ENVIRONMENT DIVISION.                                            00120002
001300 CONFIGURATION SECTION.                                           00130002
001400 SOURCE-COMPUTER. IBM-3090.                                       00140002
001500 OBJECT-COMPUTER. IBM-3090.                                       00150002
001600                                                                  00160002
001700****************************************************************  00170002
001800*                                                              *  00180002
001900*  IF THERE ARE CURRENTLY MULTIPLE ASSIGNMENTS OPEN FOR THE    *  00190002
002000*  SAME DC/WORK TYPE/WORK AREA THIS MODULE IS CALLED TO        *  00200002
002100*  END THE ASSOCIATES ON THE ASSIGNMENT AND END THE ASSIGNMENT *  00210002
002200*                                                              *  00220002
002300*  THIS MODULE IS CALLED BY DLKUT410                           *  00230002
002400*                                                              *  00240002
002500*  DB2 ACCESS:                                                 *  00250002
002600*     DLT_TEM_ASGMT (DLT00003) TABLE                           *  00260002
002700*                SELECTS                                       *  00270002
002800*                                                              *  00280002
002900*     DLT_ASGMT (DLT00004) TABLE                               *  00290002
003000*                SELECTS                                       *  00300002
003100*                                                              *  00310002
003200*     TUPLDER (TUPLDER) - UPLOAD ERROR TABLE                   *  00320002
003300*                INSERTS                                       *  00330002
003400*                                                              *  00340002
003500****************************************************************  00350002
003600                                                                  00360002
003700 DATA DIVISION.                                                   00370002
003800 WORKING-STORAGE SECTION.                                         00380002
003900*                                                                 00390002
004000 01  DK-DB2-KEUS.                                                 00400002
004110     05  DK-ASGMT-DC-NBR          PIC S9(4) COMP.                 00411002
004120     05  DK-ASGMT-WK-TYPE         PIC  X(15).                     00412002
004130     05  DK-ASGMT-WK-AREA         PIC  X(20).                     00413003
004140     05  DK-USER-ID               PIC  X(08).                     00414003
004150     05  DK-CURRENT-TIMESTAMP     PIC  X(26)   VALUE SPACES.      00415007
004160     05  DK-CURRENT-TIMESTAMP-R REDEFINES DK-CURRENT-TIMESTAMP.   00416007
004170         10  DK-CURRENT-DATE      PIC  X(10).                     00417007
004180         10  FILLER               PIC  X(01).                     00418007
004190         10  DK-CURRENT-TIME      PIC  X(08).                     00419007
004191         10  FILLER               PIC  X(07).                     00419107
004200*                                                                 00420002
004300 01  PV-PROGRAM-VARIABLES.                                        00430002
004400     05  PV-USR-TYP-CDE           PIC  X(01).                     00440003
004500         88  PV-USER-IS-KOHLS                VALUE 'K'.           00450003
004600         88  PV-USER-IS-TEMP                 VALUE 'T'.           00460003
004700     05  PV-DISPLAY-TEXT          PIC  XXXXX  VALUE ZEROS.        00470002
004800     05  PV-DISPLAY-SQLCODE       PIC  -999.                      00480002
004900     05  PV-DISPLAY-OPER          PIC  Z(04).                     00490002
005000     05  PV-HOLD-TIMESTAMP        PIC  X(26).                     00500002
005100     05  PV-LABOR-CURRENT-TMST    PIC  X(26).                     00510002
005200                                                                  00520002
005210     05  PV-ASGMT-COUNT                 PIC S9(09)  COMP.         00521008
005220                                                                  00522008
005300     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00530002
005400     05  PV-MODULE-FAIL-MSG.                                      00540002
005500         10  FILLER               PIC  X(05)  VALUE 'PARA:'.      00550002
005600         10  PV-MODULE-PARAGRPAH  PIC  X(30)  VALUE SPACE.        00560002
005700                                                                  00570002
005800     05  PV-MSG-AREA              PIC  X(80)  VALUE SPACE.        00580002
005900     05  PV-MSG-AREA2             PIC  X(100) VALUE SPACE.        00590002
006000     05  PV-MSG-HOLD.                                             00600002
006100         10  FILLER               PIC  X(01)  VALUE SPACE.        00610002
006200         10  PV-MSG-DATA          PIC  X(79)  VALUE SPACE.        00620002
006300     05  PV-COMMAREA-LENGTH       PIC S9(04)  COMP                00630002
006400                                              VALUE +0.           00640002
006500     05  PV-NULL-IND1             PIC S9(04)  VALUE ZEROS         00650002
006600                                              COMP SYNC.          00660002
006700     05  PV-NULL-IND2             PIC S9(04)  VALUE ZEROS         00670002
006800                                              COMP SYNC.          00680002
006900                                                                  00690002
007000 01  PS-SWITCHES.                                                 00700002
007100     05  PS-DISPLAY-PARA-SW           PIC X(01)  VALUE 'N'.       00710002
007200         88  PS-DISPLAY-PARA                     VALUE 'Y'.       00720002
007300         88  PS-DONT-DISPLAY-PARA                VALUE 'N'.       00730002
007400     05  PS-DISPLAY-DETAIL-SW         PIC X(01)  VALUE 'N'.       00740002
007500         88  PS-DISPLAY-DETAIL                   VALUE 'Y'.       00750002
007600         88  PS-DONT-DISPLAY-DETAIL              VALUE 'N'.       00760002
007700     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00770002
007800         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00780002
007900         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00790002
008000     05  PS-CALLED-MODULE-ERROR-SW    PIC X(01)  VALUE 'N'.       00800002
008100         88  PS-CALLED-MODULE-ERROR              VALUE 'Y'.       00810002
008200         88  PS-CALLED-MODULE-ERROR-NO           VALUE 'N'.       00820002
008300     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00830002
008400         88  PS-ERROR                            VALUE 'Y'.       00840002
008500         88  PS-ERROR-NO                         VALUE 'N'.       00850002
008600                                                                  00860002
008700 01  PC-CONSTANTS.                                                00870002
008800     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00880002
008900     05  PC-ASTERISK-LINE         PIC X(40)  VALUE ALL '*'.       00890002
009000     05  PC-CURRENT-PROGRAM-NAME  PIC X(08)  VALUE 'DLKUT031'.    00900002
009100                                                                  00910002
009200*----------------------------------------------------------------*00920002
009300*    COMMAREA TO BE PASSED TO DLKUP025                            00930002
009400*----------------------------------------------------------------*00940002
009500     COPY DLWS021.                                                00950002
009600                                                                  00960002
009700*----------------------------------------------------------------*00970002
009800*    COMMAREA TO BE PASSED TO DKLUP046                            00980002
009900*----------------------------------------------------------------*00990002
010000     COPY XLWS091.                                                01000002
010100                                                                  01010002
010200*----------------------------------------------------------------*01020002
010300*  DLT_ASGMT - LABOR ASSIGNMENT HEADER                            01030002
010400*----------------------------------------------------------------*01040002
010500     EXEC SQL                                                     01050002
010600         INCLUDE DLT00004                                         01060002
010700     END-EXEC.                                                    01070002
010800                                                                  01080002
010900*----------------------------------------------------------------*01090002
011000*   DLT_TEM_ASGMT - ASSOCIATES THAT ARE ATTACHED TO ASSIGNMENT    01100002
011100*----------------------------------------------------------------*01110002
011200     EXEC SQL                                                     01120002
011300         INCLUDE DLT00003                                         01130002
011400     END-EXEC.                                                    01140002
011500                                                                  01150002
011600*----------------------------------------------------------------*01160002
011700*   TUPLDER - UPLOAD ERROR TABLE                                  01170002
011800*----------------------------------------------------------------*01180002
011900     EXEC SQL                                                     01190002
012000         INCLUDE TUPLDER                                          01200002
012100     END-EXEC.                                                    01210002
012200                                                                  01220002
012210*----------------------------------------------------------------*01221011
012220*   TKRPRPM - PARM TABLE - USED TO DISPLAY                        01222011
012230*----------------------------------------------------------------*01223011
012240     EXEC SQL                                                     01224011
012250         INCLUDE TKRPRPM                                          01225011
012260     END-EXEC.                                                    01226011
012270                                                                  01227011
012300*----------------------------------------------------------------*01230002
012400*                                                                 01240002
012500*----------------------------------------------------------------*01250002
012600     EXEC SQL                                                     01260002
012700          INCLUDE SQLCA                                           01270002
012800     END-EXEC.                                                    01280002
012900                                                                  01290002
013000*---------------------------------------------------------------* 01300002
013100*   CURSOR CONTAINING THE ACTIVE ASSIGNMENTS THAT ARE OPEN FOR  * 01310002
013200*   THE DC/WORK TYPE/WORK AREA AND THE ASSOCIATES               * 01320002
013300*---------------------------------------------------------------* 01330002
013400     EXEC SQL                                                     01340002
013500          DECLARE ACTIVE_ASGMT_CSR CURSOR WITH HOLD FOR           01350002
013600           SELECT A.ASGMT_STRT_DTE                                01360002
013700                 ,A.ASGMT_NBR_TXT                                 01370002
013800                 ,A.ASGMT_NBR_SEQ_NBR                             01380002
013900                 ,A.TEM_ASGMT_SEQ_NBR                             01390002
014000                 ,A.KOHLS_USR_ID                                  01400002
014100                 ,A.TMP_USR_ID                                    01410002
014200                 ,A.JN_TMST                                       01420002
014300                 ,A.CRE_BY_USR_ID                                 01430002
014400                 ,B.ASGMT_STRT_TM                                 01440002
014500                 ,B.WK_TYP_DESC                                   01450002
014600                 ,B.WK_AREA_DESC                                  01460002
014700                 ,B.DC_NBR                                        01470002
014800            FROM  DLT_TEM_ASGMT   A                               01480002
014900                 ,DLT_ASGMT       B                               01490002
015110           WHERE  B.DC_NBR            =  :DK-ASGMT-DC-NBR         01511002
015120             AND  B.WK_TYP_DESC       =  :DK-ASGMT-WK-TYPE        01512002
015130             AND  B.WK_AREA_DESC      =  :DK-ASGMT-WK-AREA        01513003
015140             AND  B.ASGMT_STRT_DTE    =  A.ASGMT_STRT_DTE         01514006
015150             AND  B.ASGMT_NBR_TXT     =  A.ASGMT_NBR_TXT          01515006
015160             AND  B.ASGMT_NBR_SEQ_NBR =  A.ASGMT_NBR_SEQ_NBR      01516006
015170             AND  B.ASGMT_STP_RSN_CDE = 'N'                       01517006
015200             AND  A.LVE_RSN_CDE       = 'N'                       01520006
015700           ORDER BY  A.JN_TMST                                    01570002
015800     END-EXEC.                                                    01580002
015900                                                                  01590002
016000 LINKAGE SECTION.                                                 01600002
016100     COPY DLWS027.                                                01610002
016200                                                                  01620002
016300                                                                  01630002
016400 PROCEDURE DIVISION USING DL027-ASGMT-COMMAREA.                   01640002
016500                                                                  01650002
016520     EXEC SQL                                                     01652007
016530          SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           01653007
016540     END-EXEC.                                                    01654007
016550                                                                  01655007
016600     SET DL027-SUCCESSFUL                                         01660002
016700         PS-ERROR-NO       TO  TRUE.                              01670002
016800                                                                  01680002
016810     PERFORM 7030-SELECT-TKRPRPM.                                 01681011
017000                                                                  01700011
017010     MOVE  DL027-KEY-DC-NBR      TO  DK-ASGMT-DC-NBR.             01701002
017011     MOVE  DL027-KEY-WK-TYP      TO  DK-ASGMT-WK-TYPE.            01701102
017020     MOVE  DL027-KEY-WK-AREA     TO  DK-ASGMT-WK-AREA.            01702003
017100                                                                  01710002
017200     SET  PS-END-OF-CURSOR-NO TO  TRUE.                           01720002
017300                                                                  01730002
017400     PERFORM 4000-OPEN-CURSOR.                                    01740002
017500     PERFORM 4010-FETCH-CURSOR.                                   01750002
017600     IF  PS-END-OF-CURSOR-NO                                      01760002
017700         PERFORM 2000-PROCESS-CURSOR                              01770002
017800           UNTIL PS-END-OF-CURSOR                                 01780002
017900              OR PS-ERROR                                         01790002
018000     END-IF.                                                      01800002
018100     PERFORM 4020-CLOSE-CURSOR.                                   01810002
018200                                                                  01820002
018210     PERFORM 4030-COUNT-OPEN-ASGMTS.                              01821008
018220                                                                  01822008
018230                                                                  01823008
018300     GOBACK.                                                      01830002
018400                                                                  01840002
018500                                                                  01850002
018600*--------------------------------------------------------------*  01860002
018700*                                                              *  01870002
018800*--------------------------------------------------------------*  01880002
018900 2000-PROCESS-CURSOR.                                             01890002
018901                                                                  01890111
018910     IF KRPRPM-FUNC-TXT = 'Y'                                     01891011
018930         DISPLAY ' DLKUT031 2000-PROCESS-CURSOR'                  01893011
018940     END-IF.                                                      01894011
019300                                                                  01930002
019400     IF  SQLCODE = ZERO                                           01940002
019500         PERFORM 4500-INSERT-TUPLDER                              01950002
019600         PERFORM 3000-PROCESS-ASGMT                               01960002
019700         IF  PS-ERROR-NO                                          01970002
019800            PERFORM 3500-CREATE-S-MOVE                            01980002
019900         END-IF                                                   01990002
020000     END-IF.                                                      02000002
020100                                                                  02010002
020200     IF  PS-ERROR-NO                                              02020002
020300         PERFORM 4010-FETCH-CURSOR                                02030002
020400     END-IF.                                                      02040002
020500                                                                  02050002
020600                                                                  02060002
020700*--------------------------------------------------------------*  02070002
020800* THE FOLLOWING IS TO PROCESS THE CALL TO DLKUP025 TO          *  02080002
020900* END ASSOCIATE FROM AN ASSIGNMENT                             *  02090002
021000*--------------------------------------------------------------*  02100002
021100 3000-PROCESS-ASGMT.                                              02110002
021110                                                                  02111011
021120     IF KRPRPM-FUNC-TXT = 'Y'                                     02112011
021130         DISPLAY ' DLKUT031 3000-PROCESS-ASGMT '                  02113011
021140     END-IF.                                                      02114011
021200                                                                  02120002
021300     INITIALIZE DL021-ASGMT-COMMAREA.                             02130002
021400                                                                  02140002
021500     MOVE DLT00003-ASGMT-STRT-DTE TO  DL021-KEY-START-DTE.        02150002
021600     MOVE DLT00003-ASGMT-NBR-TXT  TO  DL021-KEY-NBR-TXT.          02160002
021700     MOVE DLT00003-ASGMT-NBR-SEQ-NBR                              02170002
021800                                  TO  DL021-KEY-NBR-SEQ-NBR.      02180002
021900     MOVE DLT00003-TEM-ASGMT-SEQ-NBR                              02190002
022000                                  TO  DL021-KEY-TEM-ASGMT-SEQ-NBR.02200002
022100     MOVE DK-USER-ID              TO  DL021-KEY-ADD-BY-USER-ID    02210004
022200                                      DL021-KEY-USER-ID.          02220002
022300     MOVE PV-USR-TYP-CDE          TO  DL021-KEY-USR-TYPE-CDE.     02230002
022400     MOVE PC-CURRENT-PROGRAM-NAME TO  DL021-KEY-LVE-PGM-NM        02240002
022500                                      DL021-ORIG-CALLING-PGM-NM.  02250002
022600                                                                  02260002
022700     SET DL021-BY-ASGMT-NBR                                       02270002
022800         DL021-END-FROM-ASGMT                                     02280002
022900         DL021-COMMIT-UPDATE                                      02290002
023000         DL021-KEY-LVE-RSN-SMOVE                                  02300002
023100         PS-CALLED-MODULE-ERROR-NO TO TRUE.                       02310002
023200                                                                  02320002
023300     MOVE ' END ' TO PV-DISPLAY-TEXT.                             02330002
023400                                                                  02340002
023500     PERFORM 6300-CALL-DLKUP025.                                  02350002
023600                                                                  02360002
023700     IF  PS-CALLED-MODULE-ERROR                                   02370002
023800         SET PS-ERROR           TO TRUE                           02380002
023900         MOVE 'DLKUP025'        TO DL027-CALL-MOD-FAIL-NM         02390002
024000         MOVE DL021-RETURN-CODE TO DL027-CALL-MOD-FAIL-ERR-CDE    02400002
024100         SET DL027-CALLED-MODULE-FAILURE TO TRUE                  02410002
024200         IF  DL021-SQL-ERROR                                      02420002
024300             MOVE DL021-ASGMT-SQLCODE TO                          02430002
024400                  DL027-CALL-MOD-FAIL-SQL-CDE                     02440002
024500             MOVE DL021-SQL-ERROR-PARA TO                         02450002
024600                  DL027-CALL-MOD-FAIL-SQL-PARA                    02460002
024700         END-IF                                                   02470002
024800     END-IF.                                                      02480002
024900                                                                  02490002
025000                                                                  02500002
025100 3220-GET-TIMESTAMP.                                              02510002
025200                                                                  02520002
025300     EXEC SQL                                                     02530002
025400          SET  :PV-LABOR-CURRENT-TMST =                           02540002
025500               (TIMESTAMP(:PV-HOLD-TIMESTAMP) - 1 SECOND)         02550002
025600     END-EXEC.                                                    02560002
025700                                                                  02570002
025800                                                                  02580002
025900*--------------------------------------------------------------*  02590002
026000* THE FOLLOWING IS TO PROCESS THE CALL TO DKLUP046 TO LOG AN   *  02600002
026100* INDIRECT CODE OF AN S (SYSTEM) MOVE FOR THE ASSOCIATE        *  02610002
026200*--------------------------------------------------------------*  02620002
026300 3500-CREATE-S-MOVE.                                              02630002
026310                                                                  02631011
026320     IF KRPRPM-FUNC-TXT = 'Y'                                     02632011
026330         DISPLAY ' DLKUT031 3500-CREATE-S-MOVE '                  02633011
026340     END-IF.                                                      02634011
026400                                                                  02640002
026500     INITIALIZE XL091-EAI-EXPORT-COMMAREA.                        02650002
026600                                                                  02660002
026700     SET XL091-PC-APP-ID                                          02670002
026800         XL091-COMMIT-UPDATE TO TRUE.                             02680002
026900                                                                  02690002
027000     MOVE PC-CURRENT-PROGRAM-NAME TO XL091-CRE-PGM-NM.            02700002
027100                                                                  02710002
027200     MOVE ZEROES                  TO XL091-EVNT-KY-1-NBR          02720002
027300                                     XL091-EVNT-KY-2-NBR          02730002
027400                                     XL091-EVNT-KY-3-NBR          02740002
027500                                     XL091-EVNT-KY-4-NBR          02750002
027600                                     XL091-EVNT-KY-5-NBR.         02760002
027700                                                                  02770002
027800     MOVE SPACES                  TO XL091-EVNT-KY-1-TXT          02780002
027900                                     XL091-EVNT-KY-2-TXT          02790002
028000                                     XL091-EVNT-KY-3-TXT          02800002
028100                                     XL091-EVNT-KY-4-TXT          02810002
028200                                     XL091-EVNT-KY-5-TXT          02820002
028300                                     XL091-EVNT-KY-1-TMST         02830002
028400                                     XL091-EVNT-KY-2-TMST         02840002
028500                                     XL091-EVNT-KY-3-TMST         02850002
028600                                     XL091-EVNT-KY-4-TMST         02860002
028700                                     XL091-EVNT-KY-5-TMST.        02870002
028800                                                                  02880002
028900     MOVE 'DC LABOR'          TO XL091-EVNT-OBJ-TXT.              02890002
029000     MOVE 'INDIRECT LABOR'    TO XL091-EVNT-OBJ-ACTN-TXT.         02900002
029100     MOVE DK-USER-ID          TO XL091-CRE-BY-USR-ID.             02910004
029200     MOVE DL027-KEY-DC-NBR    TO XL091-EVNT-KY-1-NBR.             02920002
029300**                                                                02930002
029400     IF  DLT00004-WK-TYP-DESC   = 'RECV'                          02940002
029500         MOVE 'SRMOVE'        TO XL091-EVNT-KY-1-TXT              02950002
029600     END-IF.                                                      02960002
029700     IF  DLT00004-WK-TYP-DESC   = 'SHIP'                          02970002
029800         MOVE 'SSMOVE'        TO XL091-EVNT-KY-1-TXT              02980002
029900     END-IF.                                                      02990002
030000     IF  DLT00004-WK-TYP-DESC   = 'P2L'                           03000002
030100         MOVE 'SPMOVE'        TO XL091-EVNT-KY-1-TXT              03010002
030200     END-IF.                                                      03020002
030300     IF  DLT00004-WK-TYP-DESC   = 'FLAT'                          03030002
030400         MOVE 'SFMOVE'        TO XL091-EVNT-KY-1-TXT              03040002
030500     END-IF.                                                      03050002
030600     IF  DLT00004-WK-TYP-DESC   = 'RLABL'                         03060002
030700         MOVE 'SLMOVE'        TO XL091-EVNT-KY-1-TXT              03070002
030800     END-IF.                                                      03080002
030900     IF  DLT00004-WK-TYP-DESC   = 'MASTCON'                       03090002
031000         MOVE 'SMMOVE'        TO XL091-EVNT-KY-1-TXT              03100002
031100     END-IF.                                                      03110002
031200                                                                  03120002
031300     MOVE DL021-ASSOC-TMST    TO PV-HOLD-TIMESTAMP.               03130002
031400     PERFORM 3220-GET-TIMESTAMP.                                  03140002
031500     MOVE PV-LABOR-CURRENT-TMST  TO  XL091-EVNT-KY-1-TMST.        03150002
031600                                                                  03160002
031700     SET XL091-COPYBOOK-NOT-USED TO TRUE.                         03170002
031800                                                                  03180002
031900     PERFORM 6500-CALL-DKLUP046.                                  03190002
032000                                                                  03200002
032100     IF  PS-CALLED-MODULE-ERROR                                   03210002
032200         SET PS-ERROR TO TRUE                                     03220002
032300         MOVE 'DKLUP046'        TO DL027-CALL-MOD-FAIL-NM         03230002
032400         MOVE XL091-RETURN-CODE TO DL027-CALL-MOD-FAIL-ERR-CDE    03240002
032500         SET DL027-CALLED-MODULE-FAILURE TO TRUE                  03250002
032600         IF  XL091-SQL-ERROR                                      03260002
032700             MOVE XL091-EAI-DB-SQLCODE TO                         03270002
032800                  DL027-CALL-MOD-FAIL-SQL-CDE                     03280002
032900             MOVE XL091-SQL-ERROR-PARA TO                         03290002
033000                  DL027-CALL-MOD-FAIL-SQL-PARA                    03300002
033100         END-IF                                                   03310002
033200     END-IF.                                                      03320002
033300                                                                  03330002
033400                                                                  03340002
033500*--------------------------------------------------------------*  03350002
033600*                                                              *  03360002
033700*--------------------------------------------------------------*  03370002
033800 4000-OPEN-CURSOR.                                                03380002
033810                                                                  03381011
033820     IF KRPRPM-FUNC-TXT = 'Y'                                     03382011
033830         DISPLAY ' DLKUT031 4000-OPEN-CURSOR   '                  03383011
033840     END-IF.                                                      03384011
034100                                                                  03410002
034200     PERFORM                                                      03420002
034300         WITH TEST AFTER                                          03430002
034400             VARYING PV-RETRY-COUNTER                             03440002
034500             FROM 1 BY 1                                          03450002
034600             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              03460002
034700                OR SQLCODE = ZERO                                 03470002
034800                                                                  03480002
034900         EXEC SQL                                                 03490002
035000              OPEN  ACTIVE_ASGMT_CSR                              03500002
035100         END-EXEC                                                 03510002
035200                                                                  03520002
035300         EVALUATE TRUE                                            03530002
035400             WHEN SQLCODE = ZERO                                  03540002
035500                  CONTINUE                                        03550002
035600                                                                  03560002
035700             WHEN SQLCODE = +100                                  03570002
035800             WHEN SQLCODE = -904                                  03580002
035900             WHEN SQLCODE = -913                                  03590002
036000             WHEN SQLCODE = -911                                  03600002
036100             WHEN SQLWARN0 NOT = SPACES                           03610002
036200             WHEN SQLCODE NOT = ZERO                              03620002
036300                  MOVE +4             TO PV-RETRY-COUNTER         03630002
036400         END-EVALUATE                                             03640002
036500     END-PERFORM.                                                 03650002
036600                                                                  03660002
036700                                                                  03670002
036800     IF  SQLCODE = ZERO                                           03680002
036900         CONTINUE                                                 03690002
037000     ELSE                                                         03700002
037100         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    03710002
037200             MOVE '4000-'         TO DL027-CALL-MOD-FAIL-SQL-PARA 03720002
037300             MOVE SQLCODE         TO DL027-ASGMT-SQLCODE          03730002
037400             SET DL027-SQL-ERROR  TO TRUE                         03740002
037500             MOVE SQLCA           TO DL027-SQLCA                  03750002
037600                                                                  03760002
037700             MOVE SPACES TO PV-MSG-AREA2                          03770002
037800             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           03780002
037900             STRING ' DLKUT031 -'                                 03790002
038000                    PV-DISPLAY-OPER  '-'                          03800002
038100                    DL027-KEY-WK-TYP '-'                          03810002
038200                    DL027-KEY-WK-AREA                             03820004
038400                                             DELIMITED BY SIZE    03840004
038500                                        INTO PV-MSG-AREA2         03850002
038600             MOVE LENGTH OF PV-MSG-AREA2                          03860002
038700               TO PV-COMMAREA-LENGTH                              03870002
038800             PERFORM 9200-WRITE-TO-LOG                            03880002
038900                                                                  03890002
039000             MOVE SPACES TO PV-MSG-AREA2                          03900002
039100             MOVE SQLCODE          TO  PV-DISPLAY-SQLCODE         03910002
039200             STRING ' DLKUT031 -'                                 03920002
039300                   ' PARA: 4000 - '                               03930002
039400                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         03940002
039500                                       DELIMITED BY SIZE          03950002
039600                                  INTO PV-MSG-AREA2               03960002
039700             MOVE LENGTH OF PV-MSG-AREA2                          03970002
039800               TO PV-COMMAREA-LENGTH                              03980002
039900             PERFORM 9200-WRITE-TO-LOG                            03990002
040000        END-IF                                                    04000002
040100     END-IF.                                                      04010002
040200                                                                  04020002
040300                                                                  04030002
040400*--------------------------------------------------------------*  04040002
040500*                                                              *  04050002
040600*--------------------------------------------------------------*  04060002
040700 4010-FETCH-CURSOR.                                               04070002
040710                                                                  04071011
040720     IF KRPRPM-FUNC-TXT = 'Y'                                     04072011
040730         DISPLAY ' DLKUT031 4010-FETCH-CURSOR  '                  04073011
040740     END-IF.                                                      04074011
041000                                                                  04100002
041100     PERFORM                                                      04110002
041200         WITH TEST AFTER                                          04120002
041300         VARYING PV-RETRY-COUNTER                                 04130002
041400         FROM 1 BY 1                                              04140002
041500         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  04150002
041600            OR SQLCODE = ZERO                                     04160002
041700            OR SQLCODE = +100                                     04170002
041800                                                                  04180002
041900         EXEC SQL                                                 04190002
042000             FETCH  ACTIVE_ASGMT_CSR                              04200002
042100                                                                  04210002
042200              INTO :DLT00003-ASGMT-STRT-DTE                       04220002
042300                 , :DLT00003-ASGMT-NBR-TXT                        04230002
042400                 , :DLT00003-ASGMT-NBR-SEQ-NBR                    04240002
042500                 , :DLT00003-TEM-ASGMT-SEQ-NBR                    04250002
042600                 , :DLT00003-KOHLS-USR-ID  :PV-NULL-IND1          04260002
042700                 , :DLT00003-TMP-USR-ID    :PV-NULL-IND2          04270002
042800                 , :DLT00003-JN-TMST                              04280002
042900                 , :DLT00003-CRE-BY-USR-ID                        04290002
043000                 , :DLT00004-ASGMT-STRT-TM                        04300002
043100                 , :DLT00004-WK-TYP-DESC                          04310002
043200                 , :DLT00004-WK-AREA-DESC                         04320002
043300                 , :DLT00004-DC-NBR                               04330002
043400                                                                  04340002
043500         END-EXEC                                                 04350002
043600                                                                  04360002
043700         EVALUATE TRUE                                            04370002
043800             WHEN SQLCODE = ZERO                                  04380002
043900                  IF  PV-NULL-IND1  =  -1                         04390002
044000                      MOVE  SPACES  TO  DLT00003-KOHLS-USR-ID     04400002
044010                      MOVE  DLT00003-TMP-USR-ID                   04401003
044020                        TO  DK-USER-ID                            04402003
044040                       SET  PV-USER-IS-TEMP   TO  TRUE            04404003
044100                  END-IF                                          04410002
044200                  IF  PV-NULL-IND2  =  -1                         04420002
044300                      MOVE  SPACES  TO  DLT00003-TMP-USR-ID       04430002
044310                      MOVE  DLT00003-KOHLS-USR-ID                 04431003
044320                        TO  DK-USER-ID                            04432003
044330                       SET  PV-USER-IS-KOHLS  TO  TRUE            04433003
044400                  END-IF                                          04440002
044520                                                                  04452003
044600             WHEN SQLCODE = +100                                  04460002
044700                  SET PS-END-OF-CURSOR TO TRUE                    04470002
044800                                                                  04480002
044900             WHEN SQLCODE = -904                                  04490002
045000             WHEN SQLCODE = -911                                  04500002
045100             WHEN SQLCODE = -913                                  04510002
045200             WHEN SQLWARN0 NOT = SPACES                           04520002
045300             WHEN SQLCODE NOT = ZERO                              04530002
045400                  MOVE +4             TO PV-RETRY-COUNTER         04540002
045500         END-EVALUATE                                             04550002
045600     END-PERFORM.                                                 04560002
045700                                                                  04570002
045800     IF SQLCODE = ZERO  OR                                        04580002
045900        SQLCODE = +100                                            04590002
046000        CONTINUE                                                  04600002
046100     ELSE                                                         04610002
046200        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     04620002
046300            MOVE '4010-'         TO DL027-CALL-MOD-FAIL-SQL-PARA  04630002
046400            MOVE SQLCODE         TO DL027-ASGMT-SQLCODE           04640002
046500            SET DL027-SQL-ERROR  TO TRUE                          04650002
046600            SET PS-ERROR         TO TRUE                          04660002
046700            MOVE SQLCA           TO DL027-SQLCA                   04670002
046800                                                                  04680002
046900             MOVE SPACES TO PV-MSG-AREA2                          04690002
047000             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           04700002
047100             STRING ' DLKUT031 -'                                 04710002
047200                    PV-DISPLAY-OPER  '-'                          04720002
047300                    DL027-KEY-WK-TYP '-'                          04730002
047400                    DL027-KEY-WK-AREA '-'                         04740002
047500                    DLT00003-KOHLS-USR-ID '-'                     04750002
047510                    DLT00003-TMP-USR-ID '-'                       04751002
047600                                             DELIMITED BY SIZE    04760002
047700                                        INTO PV-MSG-AREA2         04770002
047800             MOVE LENGTH OF PV-MSG-AREA2                          04780002
047900               TO PV-COMMAREA-LENGTH                              04790002
048000             PERFORM 9200-WRITE-TO-LOG                            04800002
048100                                                                  04810002
048200             MOVE SPACES TO PV-MSG-AREA2                          04820002
048300             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        04830002
048400             STRING ' DLKUT031 -'                                 04840002
048500                   ' PARA: 4010 - '                               04850002
048600                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         04860002
048700                                       DELIMITED BY SIZE          04870002
048800                                  INTO PV-MSG-AREA2               04880002
048900             MOVE LENGTH OF PV-MSG-AREA2                          04890002
049000               TO PV-COMMAREA-LENGTH                              04900002
049100             PERFORM 9200-WRITE-TO-LOG                            04910002
049200        END-IF                                                    04920002
049300     END-IF.                                                      04930002
049400                                                                  04940002
049500                                                                  04950002
049600*--------------------------------------------------------------*  04960002
049700*                                                              *  04970002
049800*--------------------------------------------------------------*  04980002
049900 4020-CLOSE-CURSOR.                                               04990002
049910                                                                  04991011
049920     IF KRPRPM-FUNC-TXT = 'Y'                                     04992011
049930         DISPLAY ' DLKUT031 4020-CLOSE-CURSOR  '                  04993011
049940     END-IF.                                                      04994011
050200                                                                  05020002
050300     PERFORM                                                      05030002
050400         WITH TEST AFTER                                          05040002
050500         VARYING PV-RETRY-COUNTER                                 05050002
050600         FROM 1 BY 1                                              05060002
050700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  05070002
050800            OR SQLCODE = ZERO                                     05080002
050900                                                                  05090002
051000         EXEC SQL                                                 05100002
051100              CLOSE ACTIVE_ASGMT_CSR                              05110002
051200         END-EXEC                                                 05120002
051300                                                                  05130002
051400         EVALUATE TRUE                                            05140002
051500             WHEN SQLCODE = ZERO                                  05150002
051600                  CONTINUE                                        05160002
051700                                                                  05170002
051800             WHEN SQLCODE = -904                                  05180002
051900             WHEN SQLCODE = -913                                  05190002
052000             WHEN SQLCODE = -911                                  05200002
052100             WHEN SQLCODE = +100                                  05210002
052200             WHEN SQLWARN0 NOT = SPACES                           05220002
052300             WHEN SQLCODE NOT = ZERO                              05230002
052400                  MOVE +4             TO PV-RETRY-COUNTER         05240002
052500         END-EVALUATE                                             05250002
052600     END-PERFORM.                                                 05260002
052700                                                                  05270002
052800     IF SQLCODE = ZERO                                            05280002
052900        CONTINUE                                                  05290002
053000     ELSE                                                         05300002
053100        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     05310002
053200            MOVE '3000-'         TO DL027-CALL-MOD-FAIL-SQL-PARA  05320002
053300            MOVE SQLCODE         TO DL027-ASGMT-SQLCODE           05330002
053400            SET DL027-SQL-ERROR  TO TRUE                          05340002
053500            MOVE SQLCA           TO DL027-SQLCA                   05350002
053600                                                                  05360002
053700             MOVE SPACES TO PV-MSG-AREA2                          05370002
053800             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           05380002
053900             STRING ' DLKUT031 -'                                 05390002
054000                    PV-DISPLAY-OPER  '-'                          05400002
054100                    DL027-KEY-WK-TYP '-'                          05410002
054200                    DL027-KEY-WK-AREA '-'                         05420002
054300                    DLT00003-KOHLS-USR-ID '-'                     05430002
054310                    DLT00003-TMP-USR-ID  '-'                      05431002
054400                                             DELIMITED BY SIZE    05440002
054500                                        INTO PV-MSG-AREA2         05450002
054600             MOVE LENGTH OF PV-MSG-AREA2                          05460002
054700               TO PV-COMMAREA-LENGTH                              05470002
054800             PERFORM 9200-WRITE-TO-LOG                            05480002
054900                                                                  05490002
055000             MOVE SPACES TO PV-MSG-AREA2                          05500002
055100             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        05510002
055200             STRING ' DLKUT031 -'                                 05520002
055300                   ' PARA: 4020 - '                               05530002
055400                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         05540002
055500                                       DELIMITED BY SIZE          05550002
055600                                  INTO PV-MSG-AREA2               05560002
055700             MOVE LENGTH OF PV-MSG-AREA2                          05570002
055800               TO PV-COMMAREA-LENGTH                              05580002
055900             PERFORM 9200-WRITE-TO-LOG                            05590002
056000        END-IF                                                    05600002
056100     END-IF.                                                      05610002
056200                                                                  05620002
056201                                                                  05620108
056202*--------------------------------------------------------------*  05620208
056203*                                                              *  05620308
056204*--------------------------------------------------------------*  05620408
056210 4030-COUNT-OPEN-ASGMTS.                                          05621008
056211                                                                  05621111
056212     IF KRPRPM-FUNC-TXT = 'Y'                                     05621211
056213         DISPLAY ' DLKUT031 4030-COUNT-OPEN-ASGMTS'               05621311
056214     END-IF.                                                      05621411
056301                                                                  05630108
056302     EXEC SQL                                                     05630208
056303          SELECT  COUNT(*)                                        05630308
056305            INTO :PV-ASGMT-COUNT                                  05630508
056306            FROM  DLT_ASGMT                                       05630610
056307           WHERE  DC_NBR              =  :DK-ASGMT-DC-NBR         05630708
056308             AND  WK_TYP_DESC         =  :DK-ASGMT-WK-TYPE        05630808
056309             AND  WK_AREA_DESC        =  :DK-ASGMT-WK-AREA        05630908
056310             AND  ASGMT_STRT_DTE     <=  :DK-CURRENT-DATE         05631008
056311             AND  ASGMT_STRT_TM      <=  :DK-CURRENT-TIME         05631108
056312             AND  ASGMT_STP_TMST     IS  NULL                     05631208
056339     END-EXEC                                                     05633908
056340                                                                  05634008
056341     EVALUATE TRUE                                                05634108
056342         WHEN SQLCODE = ZERO                                      05634208
056343              IF  PV-ASGMT-COUNT  > 0                             05634309
056344                  PERFORM 4040-END-ASGMT                          05634408
056345              END-IF                                              05634508
056356                                                                  05635608
056357         WHEN SQLCODE = +100                                      05635708
056358              CONTINUE                                            05635808
056359                                                                  05635908
056360         WHEN SQLCODE = -904                                      05636008
056361         WHEN SQLCODE = -911                                      05636108
056362         WHEN SQLCODE = -913                                      05636208
056363         WHEN SQLWARN0 NOT = SPACES                               05636308
056364         WHEN SQLCODE NOT = ZERO                                  05636408
056368                                                                  05636808
056374             MOVE '4030-'        TO DL027-CALL-MOD-FAIL-SQL-PARA  05637408
056375             MOVE SQLCODE        TO DL027-ASGMT-SQLCODE           05637508
056376             SET DL027-SQL-ERROR TO TRUE                          05637608
056377             SET PS-ERROR        TO TRUE                          05637708
056378             MOVE SQLCA          TO DL027-SQLCA                   05637808
056379                                                                  05637908
056380             MOVE SPACES TO PV-MSG-AREA2                          05638008
056381             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           05638108
056382             STRING ' DLKUT031 -'                                 05638208
056383                    PV-DISPLAY-OPER  '-'                          05638308
056384                    DL027-KEY-WK-TYP '-'                          05638408
056385                    DL027-KEY-WK-AREA '-'                         05638508
056386                    DLT00003-KOHLS-USR-ID '-'                     05638608
056387                    DLT00003-TMP-USR-ID '-'                       05638708
056388                                             DELIMITED BY SIZE    05638808
056389                                        INTO PV-MSG-AREA2         05638908
056390             MOVE LENGTH OF PV-MSG-AREA2                          05639008
056391               TO PV-COMMAREA-LENGTH                              05639108
056392             PERFORM 9200-WRITE-TO-LOG                            05639208
056393                                                                  05639308
056394             MOVE SPACES TO PV-MSG-AREA2                          05639408
056395             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        05639508
056396             STRING ' DLKUT031 -'                                 05639608
056397                   ' PARA: 4030 - '                               05639708
056398                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         05639808
056399                                       DELIMITED BY SIZE          05639908
056400                                  INTO PV-MSG-AREA2               05640008
056401             MOVE LENGTH OF PV-MSG-AREA2                          05640108
056402               TO PV-COMMAREA-LENGTH                              05640208
056403             PERFORM 9200-WRITE-TO-LOG                            05640308
056406                                                                  05640608
056407     END-EVALUATE.                                                05640708
056408                                                                  05640808
056409                                                                  05640908
056410*--------------------------------------------------------------*  05641008
056411*                                                              *  05641108
056412*--------------------------------------------------------------*  05641208
056413 4040-END-ASGMT.                                                  05641308
056414                                                                  05641411
056415     IF KRPRPM-FUNC-TXT = 'Y'                                     05641511
056416         DISPLAY ' DLKUT031 4040-END-ASGMT        '               05641611
056417     END-IF.                                                      05641711
056420                                                                  05642008
056421     EXEC SQL                                                     05642108
056422          UPDATE  DLT_ASGMT                                       05642208
056423             SET  ASGMT_STP_TMST      =  CURRENT TIMESTAMP        05642308
056424                , ASGMT_STP_RSN_CDE   = 'S'                       05642408
056425                , STP_BY_PGM_NM       = 'DLKUT031'                05642508
056426           WHERE  DC_NBR              =  :DK-ASGMT-DC-NBR         05642608
056427             AND  WK_TYP_DESC         =  :DK-ASGMT-WK-TYPE        05642708
056428             AND  WK_AREA_DESC        =  :DK-ASGMT-WK-AREA        05642808
056429             AND  ASGMT_STRT_DTE     <=  :DK-CURRENT-DATE         05642908
056430             AND  ASGMT_STRT_TM      <=  :DK-CURRENT-TIME         05643008
056431             AND  ASGMT_STP_TMST     IS  NULL                     05643108
056432     END-EXEC                                                     05643208
056433                                                                  05643308
056434     EVALUATE TRUE                                                05643408
056435         WHEN SQLCODE = ZERO                                      05643508
056436         WHEN SQLCODE = +100                                      05643608
056437              CONTINUE                                            05643708
056438                                                                  05643808
056439         WHEN SQLCODE = -904                                      05643908
056440         WHEN SQLCODE = -911                                      05644008
056441         WHEN SQLCODE = -913                                      05644108
056442         WHEN SQLWARN0 NOT = SPACES                               05644208
056443         WHEN SQLCODE NOT = ZERO                                  05644308
056444                                                                  05644408
056445             MOVE '4040-'        TO DL027-CALL-MOD-FAIL-SQL-PARA  05644508
056446             MOVE SQLCODE        TO DL027-ASGMT-SQLCODE           05644608
056447             SET DL027-SQL-ERROR TO TRUE                          05644708
056448             SET PS-ERROR        TO TRUE                          05644808
056449             MOVE SQLCA          TO DL027-SQLCA                   05644908
056450                                                                  05645008
056451             MOVE SPACES TO PV-MSG-AREA2                          05645108
056452             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           05645208
056453             STRING ' DLKUT031 -'                                 05645308
056454                    PV-DISPLAY-OPER  '-'                          05645408
056455                    DL027-KEY-WK-TYP '-'                          05645508
056456                    DL027-KEY-WK-AREA '-'                         05645608
056457                    DLT00003-KOHLS-USR-ID '-'                     05645708
056458                    DLT00003-TMP-USR-ID '-'                       05645808
056459                                             DELIMITED BY SIZE    05645908
056460                                        INTO PV-MSG-AREA2         05646008
056461             MOVE LENGTH OF PV-MSG-AREA2                          05646108
056462               TO PV-COMMAREA-LENGTH                              05646208
056463             PERFORM 9200-WRITE-TO-LOG                            05646308
056464                                                                  05646408
056465             MOVE SPACES TO PV-MSG-AREA2                          05646508
056466             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        05646608
056467             STRING ' DLKUT031 -'                                 05646708
056468                   ' PARA: 4040 - '                               05646808
056469                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         05646908
056470                                       DELIMITED BY SIZE          05647008
056471                                  INTO PV-MSG-AREA2               05647108
056472             MOVE LENGTH OF PV-MSG-AREA2                          05647208
056473               TO PV-COMMAREA-LENGTH                              05647308
056474             PERFORM 9200-WRITE-TO-LOG                            05647408
056475                                                                  05647508
056476     END-EVALUATE.                                                05647608
056477                                                                  05647708
056478                                                                  05647808
056479*--------------------------------------------------------------*  05647908
056480*                                                              *  05648008
056481*--------------------------------------------------------------*  05648108
056490 4500-INSERT-TUPLDER.                                             05649002
056491                                                                  05649111
056492     IF KRPRPM-FUNC-TXT = 'Y'                                     05649211
056493         DISPLAY ' DLKUT031 4040-END-ASGMT        '               05649311
056494     END-IF.                                                      05649411
056500                                                                  05650002
056600     MOVE DLT00004-DC-NBR              TO UPLDER-OPER-UNT-ID.     05660002
056700     MOVE 'F'                          TO UPLDER-UPLD-TRN-CDE.    05670002
056800     MOVE '102'                        TO UPLDER-ERR-CDE.         05680002
056900     MOVE  0                           TO UPLDER-UPLD-SEQ-NBR.    05690002
057000                                                                  05700002
057100     INITIALIZE  UPLDER-PKT-TXT.                                  05710002
057200     MOVE DLT00004-DC-NBR  TO  PV-DISPLAY-OPER                    05720002
057300     STRING   PV-DISPLAY-OPER         ' '                         05730002
057400              DLT00003-KOHLS-USR-ID   ' '                         05740002
057410              DLT00003-TMP-USR-ID     ' '                         05741002
057500              DLT00004-WK-TYP-DESC    ' '                         05750002
057600              DLT00004-WK-AREA-DESC   ' '                         05760002
057700              DLT00003-ASGMT-STRT-DTE ' '                         05770002
057800              DLT00003-ASGMT-NBR-TXT  ' '                         05780002
057900              DLT00003-JN-TMST        DELIMITED BY SIZE           05790002
058000                                     INTO UPLDER-PKT-TXT.         05800002
058100                                                                  05810002
058200     EXEC SQL                                                     05820002
058300         INSERT                                                   05830002
058400           INTO TUPLDER                                           05840002
058500             ( OPER_UNT_ID                                        05850002
058600             , UPLD_TRN_CDE                                       05860002
058700             , ERR_CDE                                            05870002
058800             , PRC_TMST                                           05880002
058900             , UPLD_SEQ_NBR                                       05890002
059000             , PKT_TXT                                            05900002
059100             )                                                    05910002
059200             VALUES                                               05920002
059300             ( :UPLDER-OPER-UNT-ID                                05930002
059400             , :UPLDER-UPLD-TRN-CDE                               05940002
059500             , :UPLDER-ERR-CDE                                    05950002
059600             ,  CURRENT TIMESTAMP                                 05960002
059700             , :UPLDER-UPLD-SEQ-NBR                               05970002
059800             , :UPLDER-PKT-TXT                                    05980002
059900             )                                                    05990002
060000     END-EXEC.                                                    06000002
060100                                                                  06010002
060200     EVALUATE TRUE                                                06020002
060300         WHEN SQLCODE = ZERO                                      06030002
060400             CONTINUE                                             06040002
060500         WHEN SQLWARN0 NOT = SPACES                               06050002
060600         WHEN SQLCODE  NOT = ZERO                                 06060002
060700                                                                  06070002
060800            MOVE '4500-'         TO DL027-CALL-MOD-FAIL-SQL-PARA  06080002
060900            MOVE SQLCODE         TO DL027-ASGMT-SQLCODE           06090002
061000            SET DL027-SQL-ERROR  TO TRUE                          06100002
061100            MOVE SQLCA           TO DL027-SQLCA                   06110002
061200                                                                  06120002
061300             MOVE SPACES TO PV-MSG-AREA2                          06130002
061400             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           06140002
061500             STRING ' DLKUT031 -'                                 06150002
061600                    PV-DISPLAY-OPER  '-'                          06160002
061700                    DL027-KEY-WK-TYP '-'                          06170002
061800                    DL027-KEY-WK-AREA '-'                         06180002
061900                    DLT00003-KOHLS-USR-ID '-'                     06190002
061910                    DLT00003-TMP-USR-ID '-'                       06191002
062000                                             DELIMITED BY SIZE    06200002
062100                                        INTO PV-MSG-AREA2         06210002
062200             MOVE LENGTH OF PV-MSG-AREA2                          06220002
062300               TO PV-COMMAREA-LENGTH                              06230002
062400             PERFORM 9200-WRITE-TO-LOG                            06240002
062500                                                                  06250002
062600             MOVE SPACES TO PV-MSG-AREA2                          06260002
062700             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        06270002
062800             STRING ' DLKUT031 -'                                 06280002
062900                   ' PARA: 4500-INSERT-TUPLDER'                   06290002
063000                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         06300002
063100                                       DELIMITED BY SIZE          06310002
063200                                  INTO PV-MSG-AREA2               06320002
063300             MOVE LENGTH OF PV-MSG-AREA2                          06330002
063400               TO PV-COMMAREA-LENGTH                              06340002
063500             PERFORM 9200-WRITE-TO-LOG                            06350002
063600                                                                  06360002
063700     END-EVALUATE.                                                06370002
063800                                                                  06380002
063900*-----------------------------------------------------------------06390002
064000*  CALL DLKUP025 TO EITHER END THE ASSOCIATE FORM AN ASSIGNMENT  *06400002
064100*  OR ADD THE ASSOCIATE TO AN ASSIGNMENT.                        *06410002
064200*-----------------------------------------------------------------06420002
064300 6300-CALL-DLKUP025.                                              06430002
064310                                                                  06431011
064320     IF KRPRPM-FUNC-TXT = 'Y'                                     06432011
064330         DISPLAY ' DLKUT031 6300-CALL-DLKUP025    '               06433011
064340     END-IF.                                                      06434011
064400                                                                  06440002
064500     CALL DL021-USER-PGM USING DL021-ASGMT-COMMAREA.              06450002
064600                                                                  06460002
064700     EVALUATE TRUE                                                06470002
064800         WHEN DL021-SUCCESSFUL                                    06480002
064900             CONTINUE                                             06490002
065000         WHEN OTHER                                               06500002
065100             SET PS-CALLED-MODULE-ERROR TO TRUE                   06510002
065200             MOVE SPACES TO PV-MSG-AREA2                          06520002
065300             STRING ' DLKUT031 - '           DELIMITED BY SIZE    06530002
065400                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    06540002
065500                                           INTO PV-MSG-AREA2      06550002
065600             MOVE LENGTH OF PV-MSG-AREA2                          06560002
065700               TO PV-COMMAREA-LENGTH                              06570002
065800             PERFORM 9200-WRITE-TO-LOG                            06580002
065900                                                                  06590002
066000             MOVE SPACES TO PV-MSG-AREA2                          06600002
066100             MOVE '6300-CALL-DLKUP025' TO PV-MODULE-PARAGRPAH     06610002
066200             MOVE DL021-ASGMT-SQLCODE  TO PV-DISPLAY-SQLCODE      06620002
066300             STRING ' DLKUT031 - '        PV-MODULE-FAIL-MSG      06630002
066400                    ' TO '                PV-DISPLAY-TEXT         06640002
066500                    ' ASSIGNMENT'                                 06650002
066600                    ' RETURN CODE: '      DL021-RETURN-CODE       06660002
066700                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      06670002
066800                                          DELIMITED BY SIZE       06680002
066900                                     INTO PV-MSG-AREA2            06690002
067000             MOVE LENGTH OF PV-MSG-AREA2                          06700002
067100               TO PV-COMMAREA-LENGTH                              06710002
067200             PERFORM 9200-WRITE-TO-LOG                            06720002
067300                                                                  06730002
067400             MOVE SPACES TO PV-MSG-AREA2                          06740002
067500             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           06750002
067600             STRING ' DLKUT031 -'                                 06760002
067700                    PV-DISPLAY-OPER  '-'                          06770002
067800                    DL027-KEY-WK-TYP '-'                          06780002
067900                    DL027-KEY-WK-AREA '-'                         06790002
068000                    DK-USER-ID        '-'                         06800005
068100                    PV-USR-TYP-CDE           DELIMITED BY SIZE    06810005
068200                                        INTO PV-MSG-AREA2         06820002
068300             MOVE LENGTH OF PV-MSG-AREA2                          06830002
068400               TO PV-COMMAREA-LENGTH                              06840002
068500             PERFORM 9200-WRITE-TO-LOG                            06850002
068600     END-EVALUATE.                                                06860002
068700                                                                  06870002
068800                                                                  06880002
068900*-----------------------------------------------------------------06890002
069000*  CALL DKLUP046 TO LOG AN INDIRECT SYSTEM MOVE TO THE EAI       *06900002
069100*  BUSINESS EVENT TABLES.                                        *06910002
069200*-----------------------------------------------------------------06920002
069300 6500-CALL-DKLUP046.                                              06930002
069310                                                                  06931011
069320     IF KRPRPM-FUNC-TXT = 'Y'                                     06932011
069330         DISPLAY ' DLKUT031 6500-CALL-DKLUP046    '               06933011
069340     END-IF.                                                      06934011
069400                                                                  06940002
069500     CALL XL091-USER-PGM USING XL091-EAI-EXPORT-COMMAREA.         06950002
069600                                                                  06960002
069700     EVALUATE TRUE                                                06970002
069800         WHEN XL091-SUCCESSFUL                                    06980002
069900             CONTINUE                                             06990002
070000         WHEN OTHER                                               07000002
070100             SET PS-CALLED-MODULE-ERROR TO TRUE                   07010002
070200             MOVE SPACES TO PV-MSG-AREA2                          07020002
070300             STRING ' DLKUT031 - '                                07030002
070400                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    07040002
070500                                           INTO PV-MSG-AREA2      07050002
070600             MOVE LENGTH OF PV-MSG-AREA2                          07060002
070700               TO PV-COMMAREA-LENGTH                              07070002
070800             PERFORM 9200-WRITE-TO-LOG                            07080002
070900                                                                  07090002
071000             MOVE SPACES TO PV-MSG-AREA2                          07100002
071100             MOVE '6500-CALL-DKLUP046' TO PV-MODULE-PARAGRPAH     07110002
071200             MOVE XL091-EAI-DB-SQLCODE TO PV-DISPLAY-SQLCODE      07120002
071300             STRING ' DLKUT031 - '        PV-MODULE-FAIL-MSG      07130002
071400                    ' RETURN CODE: '      XL091-RETURN-CODE       07140002
071500                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      07150002
071600                                          DELIMITED BY SIZE       07160002
071700                                     INTO PV-MSG-AREA2            07170002
071800             MOVE LENGTH OF PV-MSG-AREA2                          07180002
071900               TO PV-COMMAREA-LENGTH                              07190002
072000             PERFORM 9200-WRITE-TO-LOG                            07200002
072100                                                                  07210002
072200             MOVE SPACES TO PV-MSG-AREA2                          07220002
072300             MOVE DL027-KEY-DC-NBR  TO  PV-DISPLAY-OPER           07230002
072400             STRING ' DLKUT031 -'                                 07240002
072500                    PV-DISPLAY-OPER  '-'                          07250002
072600                    DL027-KEY-WK-TYP '-'                          07260002
072700                    DL027-KEY-WK-AREA '-'                         07270002
072800                    DLT00003-KOHLS-USR-ID '-'                     07280002
072810                    DLT00003-TMP-USR-ID '-'                       07281002
072900                                             DELIMITED BY SIZE    07290002
073000                                        INTO PV-MSG-AREA2         07300002
073100             MOVE LENGTH OF PV-MSG-AREA2                          07310002
073200               TO PV-COMMAREA-LENGTH                              07320002
073300             PERFORM 9200-WRITE-TO-LOG                            07330002
073400     END-EVALUATE.                                                07340002
073500                                                                  07350002
073501                                                                  07350111
073510 7030-SELECT-TKRPRPM.                                             07351011
073520                                                                  07352011
073530     MOVE 90                          TO KRPRPM-LOC-ID.           07353011
073540                                                                  07354011
073550     EXEC SQL                                                     07355011
073560         SELECT FUNC_TXT                                          07356011
073570         INTO :KRPRPM-FUNC-TXT                                    07357011
073580         FROM                                                     07358011
073590             TKRPRPM                                              07359011
073591         WHERE                                                    07359111
073592             LOC_ID                   = :KRPRPM-LOC-ID            07359211
073593         AND INTFC_SYS_CDE            = 'DLX'                     07359311
073594         AND SYS_PRC_FUNC_CDE         = 'DLPLDI'                  07359411
073595         AND CURRENT TIMESTAMP BETWEEN                            07359511
073596             FUNC_BEG_TMST AND FUNC_END_TMST                      07359611
073597         WITH UR                                                  07359711
073598     END-EXEC.                                                    07359811
073599                                                                  07359911
073600     EVALUATE TRUE                                                07360011
073601         WHEN SQLCODE = ZERO                                      07360111
073602             CONTINUE                                             07360211
073603                                                                  07360311
073604         WHEN OTHER                                               07360411
073605                                                                  07360511
073606             MOVE SQLCODE             TO  PV-DISPLAY-SQLCODE      07360613
073608             DISPLAY ' DLKUT410 - 7030 - '                        07360811
073609                     ' SQLCODE: '         PV-DISPLAY-SQLCODE      07360913
073610                     ' TKRPRPM - OPER 90 - DLPLDI'                07361011
073611             DISPLAY ' DLKUT410 - 7030 - '                        07361111
073612                       DL027-KEYS                                 07361214
073613                                                                  07361311
073614     END-EVALUATE.                                                07361411
073615                                                                  07361511
073620                                                                  07362002
073700 9200-WRITE-TO-LOG.                                               07370002
073710                                                                  07371011
073720     IF KRPRPM-FUNC-TXT = 'Y'                                     07372011
073730         DISPLAY ' DLKUT031 9200-WRITE-TO-LOG     '               07373011
073740     END-IF.                                                      07374011
073800                                                                  07380002
073900     DISPLAY PV-MSG-AREA2.                                        07390002
074000                                                                  07400002
