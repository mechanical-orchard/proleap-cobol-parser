000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.             TMKRP013.                                00030001
000400 AUTHOR.                 MICHAEL WALTERS                          00040015
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN            09/25/96.                                00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900**************************************************************    00090015
001000*  THIS PROGRAM CREATES THE UNRESOLVED TROUBLE BY DC REPORT  *    00100015
001100**************************************************************    00110015
001200                                                                  00120000
001300 ENVIRONMENT DIVISION.                                            00130000
001400 INPUT-OUTPUT SECTION.                                            00140000
001500                                                                  00150000
001600 FILE-CONTROL.                                                    00160000
001700                                                                  00170000
001800     SELECT TROUBLE-EXTRACT-FILE      ASSIGN TO INP01.            00180000
001900     SELECT TROUBLE-REPORT-FILE       ASSIGN TO RPT01.            00190004
002000                                                                  00200000
002100                                                                  00210000
002200 DATA DIVISION.                                                   00220000
002300                                                                  00230000
002400 FILE SECTION.                                                    00240000
002500 FD  TROUBLE-EXTRACT-FILE                                         00250000
002600     RECORDING MODE IS F                                          00260000
002700     LABEL RECORDS ARE STANDARD                                   00270000
002800     BLOCK CONTAINS 0 RECORDS.                                    00280000
002900                                                                  00290000
003000 01  TROUBLE-EXTRACT-RECORD         PIC X(400).                   00300000
003100                                                                  00310000
003200 FD  TROUBLE-REPORT-FILE                                          00320004
003300     RECORDING MODE IS F                                          00330000
003400     LABEL RECORDS ARE STANDARD                                   00340000
003500     BLOCK CONTAINS 0 RECORDS.                                    00350000
003600                                                                  00360000
003700 01  TROUBLE-REPORT-RECORD          PIC X(132).                   00370004
003800                                                                  00380000
003900 WORKING-STORAGE SECTION.                                         00390000
004000 01  PS-SWITCHES.                                                 00400000
004100     05  PS-EOF-INPUT-FILE-SW        PIC X(01) VALUE 'N'.         00410011
004200         88  PS-EOF-INPUT-FILE                     VALUE 'Y'.     00420005
004300         88  PS-NOT-EOF-INPUT-FILE                 VALUE 'N'.     00430005
004400     05  PS-NO-DETAILS-SW            PIC  X(01)    VALUE ' '.     00440000
004500         88  PS-NO-DETAILS                         VALUE 'N'.     00450000
004600     05  PS-FIRST-TIME-THRU-SW       PIC  X(01)    VALUE 'F'.     00460000
004700         88  PS-FIRST-TIME-THRU                    VALUE 'F'.     00470000
004800         88  PS-NOT-FIRST-TIME-THRU                VALUE 'N'.     00480000
004900     05  PS-RECEIVER-UNITS-ADD-SW    PIC  X(01)    VALUE 'N'.     00490061
005000         88  PS-RECEIVER-UNITS-ADDED               VALUE 'Y'.     00500020
005100         88  PS-NO-RECEIVER-UNITS-ADDED            VALUE 'N'.     00510020
           05  PS-PACK-UNITS-ADD-SW        PIC  X(01)    VALUE 'N'.     00511059
               88  PS-PACK-UNITS-ADDED                   VALUE 'Y'.     00512047
               88  PS-PACK-UNITS-NOT-ADDED               VALUE 'N'.     00513047
005200                                                                  00520020
005300 01  PC-PROGRAM-CONSTANTS.                                        00530000
005400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00540000
005500                                    'TMKRP013'.                   00550001
005600     05  PC-MAX-REPORT-LINES         PIC S9(04)    VALUE +60      00560024
005700                                                   COMP SYNC.     00570000
005800     05  PC-SPECIAL-RUN-NOTE         PIC X(27)     VALUE          00580000
005900                                    '** SPECIAL REQUESTED RUN **'.00590000
006000     05  PC-ONE                      PIC 9(01)     VALUE  1.      00600000
006100     05  PC-TWO                      PIC 9(01)     VALUE  2.      00610000
006200     05  PC-THREE                    PIC 9(01)     VALUE  3.      00620000
006300     05  PC-NOT-FOUND                PIC X(17)     VALUE          00630000
006400                                         '*** NOT FOUND ***'.     00640000
006500     05  PC-ENROUTE                  PIC X(19)     VALUE          00650000
006600                                         '*** ENROUTE ***    '.   00660000
006700                                                                  00670011
006800 01  ABEND-CODE                          PIC S9(04) VALUE +0      00680010
006900                                                     COMP SYNC.   00690010
007000 01  PA-PROGRAM-ACCUMULATORS.                                     00700018
007100     05  PA-DC-TROUBLE-COUNT         PIC S9(09)    VALUE +0       00710018
007200                                                     COMP.        00720018
007300     05  PA-DC-TROUBLE-UNIT-QTY      PIC S9(09)    VALUE +0       00730018
007400                                                     COMP.        00740018
007100*    05  PA-BYR-TROUBLE-COUNT        PIC S9(09)    VALUE +0       00741044
007200*                                                    COMP.        00742044
007300*    05  PA-BYR-TROUBLE-UNIT-QTY     PIC S9(09)    VALUE +0       00743044
007400*                                                    COMP.        00744044
007500 01  PV-PROGRAM-VARIABLES.                                        00750018
007600     05  PV-PARAGRAPH-NAME           PIC X(30)     VALUE SPACES.  00760018
007700     05  PV-DB2-OPERATION-ATTEMPTED  PIC X(80)     VALUE SPACES.  00770018
007800     05  PV-REPORT-LINE              PIC X(132)    VALUE SPACES.  00780010
007900     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00790000
008000                                                   COMP SYNC.     00800000
008100     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00810004
008100     05  PV-ABEND-SQLCODE            PIC  X(10)    VALUE SPACES.  00811063
008200     05  PV-LINE-COUNT               PIC S9(04)    VALUE +80      00820000
008300                                                   COMP.          00830005
008400     05  PV-PAGE-NUMBER             PIC  S9(04)    VALUE ZERO     00840006
008500                                                   COMP.          00850005
008600     05  PV-START-DATE               PIC  X(08)    VALUE SPACE.   00860000
008700     05  PV-END-DATE                 PIC  X(08)    VALUE SPACE.   00870000
008800*                                                                 00880004
008900     05  PV-CURRENT-DATE             PIC X(10)     VALUE SPACE.   00890009
009000     05  PV-CURRENT-DATE-RDF.                                     00900008
009100         10 PV-CURRENT-YEAR          PIC 9(04)     VALUE 0.       00910004
009200         10 FILLER                   PIC X(01)     VALUE SPACE.   00920000
009300         10 PV-CURRENT-MONTH         PIC 9(02)     VALUE 0.       00930004
009400         10 FILLER                   PIC X(01)     VALUE SPACE.   00940000
009500         10 PV-CURRENT-DAY           PIC 9(02)     VALUE 0.       00950004
009600*                                                                 00960004
009700     05  PV-CURRENT-TIME             PIC X(08)     VALUE SPACE.   00970009
009800     05  PV-CURRENT-TIME-RDF.                                     00980008
009900         10 PV-CURRENT-HOUR          PIC 9(02)     VALUE 0.       00990004
010000         10 FILLER                   PIC X(01)     VALUE SPACE.   01000004
010100         10 PV-CURRENT-MINUTE        PIC 9(02)     VALUE 0.       01010004
010200         10 FILLER                   PIC X(01)     VALUE SPACE.   01020004
010300         10 PV-CURRENT-SECOND        PIC 9(02)     VALUE 0.       01030004
010400*                                                                 01040004
010500     05  PV-START-EXTRACT.                                        01050004
010600         10 PV-START-YYYY            PIC 9(04)     VALUE 0.       01060004
010700         10 FILLER                   PIC X(01)     VALUE SPACE.   01070004
010800         10 PV-START-MM              PIC 9(02)     VALUE 0.       01080004
010900         10 FILLER                   PIC X(01)     VALUE SPACE.   01090004
011000         10 PV-START-DD              PIC 9(02)     VALUE 0.       01100004
011100         10 FILLER                   PIC X(01)     VALUE SPACE.   01110004
011200     05  PV-END-EXTRACT.                                          01120000
011300         10 PV-END-YYYY              PIC 9(04)     VALUE 0.       01130000
011400         10 FILLER                   PIC X(01)     VALUE SPACE.   01140000
011500         10 PV-END-MM                PIC 9(02)     VALUE 0.       01150000
011600         10 FILLER                   PIC X(01)     VALUE SPACE.   01160000
011700         10 PV-END-DD                PIC 9(02)     VALUE 0.       01170000
011800         10 FILLER                   PIC X(01)     VALUE SPACE.   01180000
011900     05  PV-REPORT-DATE              PIC X(10)     VALUE SPACE.   01190000
012000     05  PV-OPER-UNT-ID-NUM          PIC 9(04)     VALUE 0.       01200065
012100     05  PV-OPER-UNT-ID-X            PIC X(04)     VALUE SPACE.   01210065
012400     05  PV-TMST-HOLD.                                            01240000
012500         88  PV-TMST-ENROUTE                  VALUE               01250000
012600             '9999-09-09-09.09.09.999999'.                        01260000
012700         10 PV-TMST-YYYY            PIC X(04) VALUE SPACES.       01270000
012800         10 FILLER                  PIC X(01) VALUE SPACES.       01280000
012900         10 PV-TMST-MM              PIC X(02) VALUE SPACES.       01290000
013000         10 FILLER                  PIC X(01) VALUE SPACES.       01300000
013100         10 PV-TMST-DD              PIC X(02) VALUE SPACES.       01310000
013200         10 FILLER                  PIC X(01) VALUE SPACES.       01320000
013300         10 PV-TMST-HH              PIC X(02) VALUE SPACES.       01330000
013400         10 FILLER                  PIC X(01) VALUE SPACES.       01340000
013500         10 PV-TMST-MIN             PIC X(02) VALUE SPACES.       01350000
013600         10 FILLER                  PIC X(01) VALUE SPACES.       01360000
013700         10 PV-TMST-SS              PIC X(02) VALUE SPACES.       01370000
013800         10 FILLER                  PIC X(07) VALUE SPACES.       01380000
013900     05  PV-BYR-SAVE                PIC X(03) VALUE SPACES.       01390000
014000     05  PV-DPT-SAVE                PIC X(03) VALUE SPACES.       01400000
014100     05  PV-NOTIF-DATE-SAVE         PIC  X(8) VALUE SPACES.       01410000
014200     05  PV-REC-SEQ-NBR-SAVE        PIC S9(9) VALUE 0 COMP.       01420000
014300     05  PV-TRBL-RSN-CDE-SAVE       PIC S9(4) VALUE 0 COMP.       01430000
014400     05  PV-PO-NBR-SAVE             PIC S9(9) VALUE 0 COMP.       01440000
014600     05  PV-FCLTY-AREA-ID-SAVE      PIC  X(6) VALUE 'XXXXXX'.     01460000
014700     05  PV-SAVE-VARIABLES.                                       01470005
014800         10  PV-SAVE-OPER-UNT-ID          PIC S9(04) COMP         01480005
014900                                                   VALUE +0.      01490005
015000         10  PV-SAVE-BYR-NBR              PIC  X(03) VALUE SPACE. 01500005
015100         10  PV-SAVE-BYR-NAME             PIC  X(30) VALUE SPACE. 01510005
015200         10  PV-SAVE-DEPT-NBR             PIC  X(03) VALUE SPACE. 01520005
015300         10  PV-SAVE-DEPT-DESC            PIC  X(32) VALUE SPACE. 01530005
015400         10  PV-SAVE-PO-SEQ-NBR.                                  01540005
015500             15  PV-SAVE-PO-NBR           PIC S9(09) COMP         01550005
015600                                                   VALUE +0.      01560005
015700             15  PV-SAVE-REC-SEQ-NBR      PIC S9(09) COMP         01570005
015800                                                   VALUE +0.      01580005
015900         10  PV-SAVE-VENDOR-NAME          PIC  X(30) VALUE SPACE. 01590006
016000         10  PV-SAVE-RECEIPT-DATE.                                01600006
016100             15 PV-SAVE-RECEIPT-YYYY      PIC  X(04) VALUE SPACE. 01610006
016200             15 PV-SAVE-RECEIPT-MM        PIC  X(02) VALUE SPACE. 01620006
016300             15 PV-SAVE-RECEIPT-DD        PIC  X(02) VALUE SPACE. 01630006
016400         10  PV-SAVE-PO-LNE-NBR           PIC S9(09) COMP         01640006
016500                                                   VALUE +0.      01650005
               10  PV-SAVE-PREPK-ID             PIC S9(04) COMP         01651052
                                                         VALUE +0.      01652046
016600                                                                  01660000
016700     COPY DPWS132O.                                               01670000
016800                                                                  01680000
016900 01  CT-CPU-TIME.                                                 01690000
017000     03  CT-HOUR                     PIC  9(02)    VALUE ZERO.    01700000
017100     03  CT-MINUTE                   PIC  9(02)    VALUE ZERO.    01710000
017200     03  FILLER                      PIC  9(04)    VALUE ZERO.    01720000
017300                                                                  01730000
017400 01  CD-CPU-DATE.                                                 01740000
017500     03  CD-YEAR                     PIC  9(02)    VALUE ZERO.    01750000
017600     03  CD-MONTH                    PIC  9(02)    VALUE ZERO.    01760000
017700     03  CD-DAY                      PIC  9(02)    VALUE ZERO.    01770000
017800                                                                  01780000
017900 01  HL1-HEADING-LINE-1.                                          01790000
018000     05  FILLER                      PIC  X(02)    VALUE SPACES.  01800000
018100     05  HL1-SPECIAL-RUN-NOTE        PIC  X(27)    VALUE SPACES.  01810000
018200     05  FILLER                      PIC  X(10)    VALUE SPACES.  01820032
018300     05  FILLER                      PIC  X(36)    VALUE          01830000
018400                         'UNRESOLVED TROUBLE REPORT BY DC FOR '.  01840000
018500     05  HL1-REPORT-DATE             PIC  X(10)    VALUE SPACES.  01850000
018600     05  FILLER                      PIC  X(04)    VALUE ' AT '.  01860032
018700     05  HL1-REPORT-TIME             PIC  X(05)    VALUE SPACES.  01870000
018800     05  FILLER                      PIC  X(34)    VALUE SPACES.  01880000
018900                                                                  01890000
019000 01  HL2-HEADING-LINE-2.                                          01900000
019100     05  FILLER                      PIC  X(58)    VALUE SPACES.  01910033
019200     05  FILLER                      PIC  X(14)    VALUE          01920033
019300                                    'BUYER SEQUENCE'.             01930033
019400     05  FILLER                      PIC  X(69)    VALUE SPACES.  01940032
019500                                                                  01950000
019600 01  HL3-HEADING-LINE-3.                                          01960000
019700     05  FILLER                      PIC  X(02)  VALUE SPACES.    01970000
021400     05  FILLER                      PIC  X(11)  VALUE            01980039
               ' OPER UNIT:'.                                           01981039
019900     05  FILLER                      PIC  X(01)  VALUE SPACE.     01990014
020000     05  HL3-DC-NBR                  PIC  9(04)  VALUE 0.         02000039
020000     05  FILLER                      PIC  X(03)  VALUE ' - '.     02001039
020000     05  HL3-DC-NAME                 PIC  X(30)  VALUE SPACE.     02002039
020100     05  FILLER                      PIC  X(99)  VALUE SPACES.    02010000
020200                                                                  02020000
020300 01  HL4-HEADING-LINE-4.                                          02030000
020400     05  FILLER                      PIC  X(02)  VALUE SPACES.    02040000
021400     05  FILLER                      PIC  X(11)  VALUE            02050039
               '     BUYER:'.                                           02051039
020600     05  FILLER                      PIC  X(01)  VALUE SPACE.     02060000
020700     05  HL4-BUYER-NBR               PIC  X(03)  VALUE SPACE.     02070033
020800     05  FILLER                      PIC  X(01)  VALUE SPACE.     02080033
020900     05  HL4-BUYER-NAME              PIC  X(20)  VALUE SPACE.     02090000
021000     05  FILLER                      PIC  X(101) VALUE SPACES.    02100000
021100                                                                  02110002
021200 01  HL5-HEADING-LINE-5.                                          02120000
021300     05  FILLER                      PIC  X(02)  VALUE SPACES.    02130000
021400     05  FILLER                      PIC  X(11)  VALUE            02140039
               'DEPARTMENT:'.                                           02141039
021500     05  FILLER                      PIC  X(01)  VALUE SPACE.     02150000
021600     05  HL5-DPT-NBR                 PIC  X(03)  VALUE SPACE.     02160000
021700     05  FILLER                      PIC  X(01)  VALUE SPACE.     02170000
021800     05  HL5-DPT-DESC                PIC  X(20)  VALUE SPACE.     02180006
021900     05  FILLER                      PIC  X(101) VALUE SPACES.    02190000
022000                                                                  02200000
022100 01  HL6-HEADING-LINE-6.                                          02210000
           05  FILLER                      PIC  X(02)  VALUE SPACE.     02211046
           05  FILLER                      PIC  X(61)  VALUE SPACE.     02212046
           05  FILLER                      PIC  X(05)  VALUE 'PACK/'.   02213046
           05  FILLER                      PIC  X(45)  VALUE SPACES.    02220046
022300     05  FILLER                      PIC  X(07)  VALUE  'PROCESS'.02230000
022400     05  FILLER                      PIC  X(13)  VALUE SPACE.     02240000
022500                                                                  02250000
022600 01  HL7-HEADING-LINE-7.                                          02260000
022700     05  FILLER                      PIC  X(02)    VALUE SPACES.  02270000
022800     05  FILLER                      PIC  X(12)    VALUE          02280000
022900                                                  'RECEIPT DATE'. 02290000
023000     05  FILLER                      PIC  X(02)    VALUE SPACES.  02300000
023100     05  FILLER                      PIC  X(11)    VALUE          02310000
023200                                                  'PO/RECEIVER'.  02320000
023300     05  FILLER                      PIC  X(04)    VALUE SPACE.   02330000
023400     05  FILLER                      PIC  X(11)    VALUE          02340000
023500                                                  'VENDOR NAME'.  02350000
023600     05  FILLER                      PIC  X(21)    VALUE SPACES.  02360000
023700     05  FILLER                      PIC  X(04)    VALUE 'LINE'.  02370000
023800     05  FILLER                      PIC  X(02)    VALUE SPACES.  02380000
023900     05  FILLER                      PIC  X(14)    VALUE          02390000
024000                                                 'TROUBLE REASON'.02400000
024100     05  FILLER                      PIC  X(08)    VALUE SPACES.  02410000
024200     05  FILLER                      PIC  X(18)    VALUE          02420000
024300                                              'NOTIFY DATE/TIME'. 02430000
024400     05  FILLER                      PIC  X(05)    VALUE SPACE.   02440000
024500     05  FILLER                      PIC  X(04)    VALUE          02450000
024600                                              'AREA'.             02460000
024700     05  FILLER                      PIC  X(06)    VALUE SPACE.   02470000
024800     05  FILLER                      PIC  X(05)    VALUE          02480000
024900                                              'UNITS'.            02490000
025000     05  FILLER                      PIC  X(04)    VALUE SPACE.   02500000
025100                                                                  02510000
025200 01  HL8-HEADING-LINE-8.                                          02520029
025300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02530000
025400     05  FILLER                      PIC  X(12)    VALUE ALL '_'. 02540030
025500     05  FILLER                      PIC  X(02)    VALUE SPACES.  02550030
025600     05  FILLER                      PIC  X(13)    VALUE ALL '_'. 02560028
025700     05  FILLER                      PIC  X(02)    VALUE SPACES.  02570000
025800     05  FILLER                      PIC  X(30)    VALUE ALL '_'. 02580028
025900     05  FILLER                      PIC  X(02)    VALUE SPACES.  02590000
026000     05  FILLER                      PIC  X(04)    VALUE ALL '_'. 02600028
026100     05  FILLER                      PIC  X(02)    VALUE SPACES.  02610000
026200     05  FILLER                      PIC  X(20)    VALUE ALL '_'. 02620028
026300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02630000
026400     05  FILLER                      PIC  X(19)    VALUE ALL '_'. 02640028
026500     05  FILLER                      PIC  X(04)    VALUE SPACES.  02650014
026600     05  FILLER                      PIC  X(06)    VALUE ALL '_'. 02660028
026700     05  FILLER                      PIC  X(02)    VALUE SPACES.  02670014
026800     05  FILLER                      PIC  X(07)    VALUE ALL '_'. 02680028
026900     05  FILLER                      PIC  X(05)    VALUE SPACES.  02690000
027000                                                                  02700000
027100 01  DL1-DETAIL-LINE-1.                                           02710028
027200     05  FILLER                      PIC  X(02)    VALUE SPACES.  02720028
027300     05  DL1-RECEIPT-DATE            PIC  X(10)    VALUE SPACES.  02730028
027400     05  FILLER                      PIC  X(04)    VALUE SPACES.  02740028
027500     05  DL1-RECEIVER.                                            02750028
027600         10 DL1-PO-NBR               PIC  9(08)    VALUE 0.       02760028
027700         10 DL1-DASH                 PIC  X(01)    VALUE '-'.     02770028
027800         10 DL1-REC-SEQ-NBR          PIC  9(04)    VALUE 0.       02780028
027900     05  FILLER                      PIC  X(02)    VALUE SPACES.  02790028
028000     05  DL1-VENDOR-NAME             PIC  X(30)    VALUE ZERO.    02800028
028100     05  FILLER                      PIC  X(02)    VALUE SPACES.  02810028
028200     05  DL1-LINE-X.                                              02820028
028300         10  DL1-LINE                PIC  9(04)    VALUE ZERO.    02830028
028400     05  FILLER                      PIC  X(02)    VALUE SPACES.  02840028
028500     05  DL1-TROUBLE-REASON          PIC  X(20)    VALUE ZERO.    02850028
028600     05  FILLER                      PIC  X(02)    VALUE SPACES.  02860028
028700     05  DL1-NOTIFY-DT-TM.                                        02870028
028800         15  DL1-NOTIFY-DATE.                                     02880028
028900             20  DL1-NOTIFY-MM       PIC   X(02)   VALUE SPACE.   02890028
029000             20  FILLER              PIC   X(01)   VALUE '/'.     02900028
029100             20  DL1-NOTIFY-DD       PIC   X(02)   VALUE SPACE.   02910028
029200             20  FILLER              PIC   X(01)   VALUE '/'.     02920028
029300             20  DL1-NOTIFY-YYYY     PIC   X(04)   VALUE SPACE.   02930028
029400         15  FILLER                  PIC   X(01)   VALUE SPACE.   02940028
029500         15 DL1-NOTIFY-TIME.                                      02950028
029600             20  DL1-NOTIFY-HH       PIC   X(02).                 02960028
029700             20  FILLER              PIC   X(01)   VALUE ':'.     02970028
029800             20  DL1-NOTIFY-MN       PIC   X(02).                 02980028
029900             20  FILLER              PIC   X(01)   VALUE ':'.     02990028
030000             20  DL1-NOTIFY-SS       PIC   X(02).                 03000028
030100     05  FILLER                      PIC  X(04)    VALUE SPACES.  03010028
030200     05  DL1-AREA                    PIC  X(06)    VALUE SPACES.  03020028
030300     05  FILLER                      PIC  X(02)    VALUE SPACES.  03030028
030400     05  DL1-UNITS-X.                                             03040028
030500         10  DL1-UNITS               PIC  Z(3),ZZ9  VALUE ZERO.   03050028
030600     05  FILLER                      PIC  X(05)    VALUE SPACES.  03060028
030700                                                                  03070028
030800 01  TL1-TOTAL-LINE-1.                                            03080028
030900     05  FILLER                      PIC  X(43)    VALUE          03090006
031000         'DC TOTALS:   NUMBER OF UNRESOLVED TROUBLE: '.           03100006
031100     05  TL1-UNRES-TROUBLE-COUNT     PIC ZZZ,ZZZ,ZZ9  VALUE ZERO. 03110006
031200                                                                  03120006
031300 01  TL2-TOTAL-LINE-2.                                            03130006
031400     05  FILLER                      PIC  X(43)    VALUE          03140006
031500         '                   TOTAL UNITS UNRESOLVED: '.           03150006
031600     05  TL2-UNRES-TROUBLE-UNITS     PIC ZZZ,ZZZ,ZZ9 VALUE ZERO.  03160006
031700                                                                  03170000
031800 01  BL-BLANK-LINE                   PIC  X(132)   VALUE SPACES.  03180000
031900                                                                  03190000
032000 01  ND-NO-DATA-LINE.                                             03200004
032100     05  FILLER                      PIC X(02)  VALUE SPACE.      03210000
032200     05  FILLER                      PIC X(23)  VALUE             03220000
032300                                     '** NO DATA TO REPORT **'.   03230000
032400     05  FILLER                      PIC X(108) VALUE SPACE.      03240000
032500                                                                  03250000
032600 01  ER-END-REPORT-LINE.                                          03260000
032700     05  FILLER                      PIC X(02)  VALUE SPACE.      03270000
032800     05  FILLER                      PIC X(16)  VALUE             03280000
032900                                     '** END REPORT **'.          03290000
033000     05  FILLER                      PIC X(116) VALUE SPACE.      03300000
033100                                                                  03310000
033200     COPY DPWS004.                                                03320000
033300                                                                  03330000
033400     COPY TMRD001.                                                03340000
033400                                                                  03341063
033400* COPYBOOK FOR LOCATION CALLED MODULE XLKUT071                    03342063
033400                                                                  03342163
033400     COPY XLWS071.                                                03343063
033500                                                                  03350000
035400*---------------------------------------------------------------* 03540000
035500*    DB2 AREA FOR COMMUNICATIONS                                * 03550000
035600*---------------------------------------------------------------* 03560000
035700     EXEC SQL                                                     03570000
035800          INCLUDE SQLCA                                           03580000
035900     END-EXEC.                                                    03590000
036000***************************************************************** 03600000
036100 PROCEDURE DIVISION.                                              03610000
036200***************************************************************** 03620000
036300                                                                  03630000
036400 0000-MAINLINE.                                                   03640000
036500***************************************************************** 03650000
036600*  THIS PARAGRAPH DRIVES THE PROGRAM.                           * 03660000
036700***************************************************************** 03670000
036800     PERFORM 1000-INITIALIZE.                                     03680000
036900                                                                  03690000
037000     PERFORM 2000-MAIN-PROCESS                                    03700000
037100           UNTIL  PS-EOF-INPUT-FILE.                              03710005
037200                                                                  03720000
037300     PERFORM 9000-END-PROCESS                                     03730006
037400                                                                  03740000
037500     STOP RUN.                                                    03750006
037600                                                                  03760000
037700******************************************************************03770004
037800* OPEN INPUT/OUTPUT FILES, READ THE FIRST INPUT FIELD.           *03780004
037900******************************************************************03790004
038000 1000-INITIALIZE.                                                 03800000
038100     OPEN INPUT  TROUBLE-EXTRACT-FILE.                            03810004
038200     OPEN OUTPUT TROUBLE-REPORT-FILE.                             03820010
038300                                                                  03830005
038400     INITIALIZE PA-PROGRAM-ACCUMULATORS.                          03840018
038500                                                                  03850018
038600     EXEC SQL                                                     03860005
038700         SET :PV-CURRENT-DATE   = CURRENT DATE                    03870005
038800     END-EXEC.                                                    03880007
038900     IF SQLCODE = 0                                               03890006
039000         MOVE PV-CURRENT-DATE TO PV-CURRENT-DATE-RDF              03900008
039100     ELSE                                                         03910006
039200         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              03920006
039300         MOVE 'SET THE CURRENT DATE'                              03930006
039400                               TO  PV-DB2-OPERATION-ATTEMPTED     03940006
039500         PERFORM 9999-SQL-ABEND                                   03950006
039600     END-IF.                                                      03960006
039700                                                                  03970005
039800     EXEC SQL                                                     03980005
039900         SET :PV-CURRENT-TIME   = CURRENT TIME                    03990005
040000     END-EXEC.                                                    04000007
040100     IF SQLCODE = 0                                               04010006
040200         MOVE PV-CURRENT-TIME TO PV-CURRENT-TIME-RDF              04020008
040300     ELSE                                                         04030006
040400         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              04040006
040500         MOVE 'SET THE CURRENT TIME'                              04050006
040600                               TO  PV-DB2-OPERATION-ATTEMPTED     04060006
040700         PERFORM 9999-SQL-ABEND                                   04070006
040800     END-IF.                                                      04080006
040900                                                                  04090005
041000     MOVE PV-CURRENT-HOUR               TO DP132O-RUN-HOUR.       04100005
041100     MOVE PV-CURRENT-MINUTE             TO DP132O-RUN-MINUTE.     04110005
041200                                                                  04120005
041300     MOVE PV-CURRENT-YEAR               TO DP132O-RUN-YEAR.       04130005
041400     MOVE PV-CURRENT-MONTH              TO DP132O-RUN-MONTH.      04140005
041500     MOVE PV-CURRENT-DAY                TO DP132O-RUN-DAY.        04150005
041600                                                                  04160005
041700     MOVE PC-CURRENT-PROGRAM-NAME       TO DP132O-PROGRAM-NAME.   04170005
041800     MOVE 1                             TO DP132O-REPORT-NUMBER.  04180010
041900                                                                  04190004
042000     PERFORM 8000-READ-INPUT-FILE.                                04200005
042100                                                                  04210004
042200     EVALUATE TRUE                                                04220005
042300     WHEN PS-EOF-INPUT-FILE                                       04230005
042400         PERFORM 3000-PRINT-PAGE-HEADING                          04240026
042500                                                                  04250026
042600         WRITE TROUBLE-REPORT-RECORD                              04260026
042700               FROM ND-NO-DATA-LINE                               04270027
042800         AFTER ADVANCING 3                                        04280026
042900                                                                  04290026
043000                                                                  04300005
043100     WHEN TM001-RECORD-TYPE-HEADER                                04310005
043200         IF TM001-RUN-SPECIAL                                     04320004
043300             MOVE PC-SPECIAL-RUN-NOTE   TO HL1-SPECIAL-RUN-NOTE   04330004
043400             STRING TM001-END-MM '/'                              04340021
043500                    TM001-END-DD '/'                              04350021
043600                    TM001-END-YYYY DELIMITED BY SIZE              04360021
043700                                      INTO HL1-REPORT-DATE        04370021
043800             MOVE '24:00'               TO HL1-REPORT-TIME        04380033
043900         ELSE                                                     04390004
044000             MOVE SPACES                TO HL1-SPECIAL-RUN-NOTE   04400033
044100             STRING PV-CURRENT-MONTH '/'                          04410021
044200                    PV-CURRENT-DAY  '/'                           04420021
044300                    PV-CURRENT-YEAR  DELIMITED BY SIZE            04430023
044400                                      INTO HL1-REPORT-DATE        04440021
044500             STRING PV-CURRENT-HOUR ':'                           04450033
044600                    PV-CURRENT-MINUTE  DELIMITED BY SIZE          04460033
044700                                      INTO HL1-REPORT-TIME        04470033
044800         END-IF                                                   04480004
044900                                                                  04490021
045000                                                                  04500021
045100         PERFORM 8000-READ-INPUT-FILE                             04510005
045300         MOVE TM001-OPER-UNT-ID         TO PV-SAVE-OPER-UNT-ID    04530006
045400         MOVE TM001-BYR-NBR             TO PV-SAVE-BYR-NBR        04540006
045500         MOVE TM001-BYR-NAME            TO PV-SAVE-BYR-NAME       04550006
045600         MOVE TM001-DEPT-NBR            TO PV-SAVE-DEPT-NBR       04560006
045700         MOVE TM001-DEPT-DESC           TO PV-SAVE-DEPT-DESC      04570006
045800         MOVE TM001-PO-NBR              TO PV-SAVE-PO-NBR         04580006
045900         MOVE TM001-REC-SEQ-NBR         TO PV-SAVE-REC-SEQ-NBR    04590006
046000         MOVE TM001-RECEIPT-DATE        TO PV-SAVE-RECEIPT-DATE   04600006
046100         MOVE TM001-ENT-NAME-DESC       TO PV-SAVE-VENDOR-NAME    04610006
046200         MOVE TM001-PO-LNE-NBR          TO PV-SAVE-PO-LNE-NBR     04620006
               MOVE TM001-RECITM-PREPK-ID     TO PV-SAVE-PREPK-ID       04621056
046300                                                                  04630006
046400         MOVE +0                        TO PV-PAGE-NUMBER         04640006
046300                                                                  04640139
               PERFORM 7000-GET-DC-NAME                                 04641039
046300                                                                  04642039
046500         PERFORM 3000-PRINT-PAGE-HEADING                          04650006
046600         PERFORM 3300-PRINT-DC-HEADING                            04660022
046700         PERFORM 3200-PRINT-BYR-HEADING                           04670022
046800         PERFORM 3100-PRINT-DEPT-HEADING                          04680022
046900                                                                  04690005
047000     WHEN OTHER                                                   04700005
047100*        DISPLAY SORT ERROR                                       04710005
047200         DISPLAY '** ABEND **'                                    04720006
047300         DISPLAY '** PROGRAM = TMKRP013   '                       04730006
047400         DISPLAY '** PARAGRAPH = 1000-INITIALIZE.       '         04740006
047500         DISPLAY '** FIRST RECORD NOT THE HEADER RECORD   '       04750006
047600         MOVE +4003 TO ABEND-CODE                                 04760006
047700         CALL 'ILBOABN0' USING ABEND-CODE                         04770006
047800     END-EVALUATE.                                                04780005
047900*                                                                 04790005
048000****************************************************************  04800005
048100* 2000-MAIN-PROCESS                                            *  04810005
048200*  PERFORM THIS PARAGRAPH UNTIL ALL THE INPUT FIELDS ARE READ  *  04820005
      *  IF THE RECORD ID UNRESOLVED TROUBLE, REPORT ON IT, OTHERWISE*  04821041
      *  READ THE NEXT RECORD.  FOR UNRESOLVED TROUBLE, CONTINUE TO  *  04822041
      *  WRITE TROUBLE LINES UNTIL THERE IS A BREAK IN ONE OF THE    *  04823041
      *  KEY VARIABLES.  AT THAT POINT, IT WILL PERFORM THE BREAK    *  04824041
      *  LOGIC FOR THE CURRENT LEVEL AFTER PERFORMING THE LOGIC OF   *  04825041
      *  ALL THE BREAK LEVELS BEFORE IT.                             *  04826041
048300****************************************************************  04830005
048400 2000-MAIN-PROCESS.                                               04840000
                                                                        04840141
           IF TM001-RPT-UNRESOLVED                                      04841041
048500        IF TM001-OPER-UNT-ID             = PV-SAVE-OPER-UNT-ID    04850041
048600           IF TM001-BYR-NBR              = PV-SAVE-BYR-NBR        04860041
048700              IF TM001-DEPT-NBR          = PV-SAVE-DEPT-NBR       04870041
048800                 IF  TM001-PO-NBR        = PV-SAVE-PO-NBR         04880041
048900                 AND TM001-REC-SEQ-NBR   = PV-SAVE-REC-SEQ-NBR    04890041
048901                   IF TM001-PO-LNE-NBR       = PV-SAVE-PO-LNE-NBR 04900062
048902                   AND TM001-RECITM-PREPK-ID = PV-SAVE-PREPK-ID   04901162
049100                        PERFORM 2100-WRITE-TROUBLE-LINE           04903057
049200                   ELSE                                           04920057
049300                        PERFORM 2200-PO-LNE-BREAK                 04922057
049400                   END-IF                                         04940057
049500                 ELSE                                             04950041
049600                    PERFORM 2300-RECEIVER-BREAK                   04960041
049700                 END-IF                                           04970041
049800              ELSE                                                04980041
049900                 PERFORM 3400-PRINT-BLANK-LINE                    04990041
050000                 PERFORM 2400-DEPT-NBR-BREAK                      05000041
050100              END-IF                                              05010041
050200           ELSE                                                   05020041
050300              PERFORM 3400-PRINT-BLANK-LINE                       05030041
050400              PERFORM 2500-BYR-NBR-BREAK                          05040041
050500           END-IF                                                 05050041
050600        ELSE                                                      05060041
050700           PERFORM 3400-PRINT-BLANK-LINE                          05070041
050800           PERFORM 2600-OPER-UNT-ID-BREAK                         05080041
050900        END-IF                                                    05090041
050900     END-IF.                                                      05091041
051000                                                                  05100012
051100     PERFORM 8000-READ-INPUT-FILE.                                05110012
051200*                                                                 05120005
051300****************************************************************  05130005
051400* 2100-WRITE-TROUBLE-LINE                                      *  05140005
051500*  THIS PARAGRAPH WILL WRITE A TROUBLE DETAIL LINE -- IF END OF*  05150005
051600*  PAGE HAS BEEN REACHED, WRITE PAGE HEADINGS                  *  05160005
051700****************************************************************  05170005
051800 2100-WRITE-TROUBLE-LINE.                                         05180005
051900                                                                  05190005
052000     MOVE TM001-TRBL-RSN-CDE-DESC        TO DL1-TROUBLE-REASON.   05200005
052100                                                                  05210005
052200     MOVE TM001-NOTIF-YYYY               TO DL1-NOTIFY-YYYY.      05220005
052300     MOVE TM001-NOTIF-MM                 TO DL1-NOTIFY-MM.        05230005
052400     MOVE TM001-NOTIF-DD                 TO DL1-NOTIFY-DD.        05240005
052500                                                                  05250005
052600     MOVE TM001-NOTIF-HH                 TO DL1-NOTIFY-HH.        05260005
052700     MOVE TM001-NOTIF-MN                 TO DL1-NOTIFY-MN.        05270005
052800     MOVE TM001-NOTIF-SS                 TO DL1-NOTIFY-SS.        05280005
052900                                                                  05290005
           IF TM001-FCLTY-AREA-ID = '      '                            05291038
               MOVE SPACES                     TO DL1-AREA              05292037
           ELSE                                                         05293037
053000         MOVE TM001-FCLTY-AREA-ID        TO DL1-AREA              05300037
           END-IF.                                                      05301037
053100                                                                  05310005
053200     PERFORM 8100-WRITE-REPORT-LINE.                              05320005
053300                                                                  05330005
056300*    ADD +1                           TO PA-BYR-TROUBLE-COUNT     05332044
056300     ADD +1                           TO PA-DC-TROUBLE-COUNT.     05332144
056200                                                                  05333043
053400     MOVE SPACES TO   DL1-RECEIPT-DATE                            05340005
053500                      DL1-RECEIVER                                05350005
053600                      DL1-VENDOR-NAME                             05360005
053700                      DL1-LINE-X                                  05370016
053800                      DL1-UNITS-X.                                05380014
053900                                                                  05390005
054000****************************************************************  05400005
054100* 2200-PO-LNE-BREAK.                                           *  05410005
054200*  THIS PARAGRAPH WILL FIRST ACCUMULATE THE TROUBLE COUNT AND  *  05420018
054300*  UNIT QUANTITY FIELDS.  IT WILL THEN MOVE THE CURRENT VALUES *  05430018
054400*  TO THE SAVE AND DETAIL FIELDS, THEN WRITE THE TROUBLE LINE  *  05440018
054500*  FIELDS WITH THE NEW DATA                                    *  05450005
054600****************************************************************  05460005
054700 2200-PO-LNE-BREAK.                                               05470005
                                                                        05481056
           IF  TM001-RECITM-PREPK-ID NOT = PV-SAVE-PREPK-ID             05482056
                   SET PS-PACK-UNITS-NOT-ADDED  TO TRUE                 05484056
           END-IF                                                       05485056
                                                                        05486056
054900*    IF LINE NUMBER IS 0, ADD THE UNITS (THEY ARE THE UNITS FOR   05490018
055000*    THE ENTIRE RECEIVER SO NOTHING ELSE SHOULD BE ADDED FOR THIS 05500018
055100*    RECEIVER)                                                    05510018
055200     IF TM001-PO-LNE-NBR = 0 AND TM001-PREPK-ID = 0               05520050
055300         SET PS-RECEIVER-UNITS-ADDED  TO TRUE                     05530018
055400         ADD TM001-LINE-ITEM-QTY      TO PA-DC-TROUBLE-UNIT-QTY   05540018
055400*                                        PA-BYR-TROUBLE-UNIT-QTY  05541044
055500     ELSE                                                         05550018
055600*        IF LINE NUMBER IS > 0, ADD THE UNITS ONLY IF THERE WERE  05560018
055700*        NO RECEIVER UNITS OR PACK UNITS ADDED PREVIOUSLY         05570056
                                                                        05580056
               IF PS-NO-RECEIVER-UNITS-ADDED                            05581056
                 IF  TM001-PREPK-ID > 0                                 05590057
                 AND PS-PACK-UNITS-NOT-ADDED                            05590157
                   ADD TM001-PACK-ITEM-QTY TO PA-DC-TROUBLE-UNIT-QTY    05590257
                   SET PS-PACK-UNITS-ADDED TO TRUE                      05590357
                 ELSE                                                   05590457
                   IF  TM001-PO-LNE-NBR > 0                             05590557
                   AND PS-PACK-UNITS-NOT-ADDED                          05590657
                         ADD TM001-LINE-ITEM-QTY                        05591257
                                             TO PA-DC-TROUBLE-UNIT-QTY  05591356
      *                                         PA-BYR-TROUBLE-UNIT-QTY 05591456
                   END-IF                                               05591557
                 END-IF                                                 05591756
056000         END-IF                                                   05600018
056100     END-IF.                                                      05610018
056400                                                                  05640018
           IF TM001-PREPK-ID > 0                                        05641057
               MOVE TM001-RECITM-PREPK-ID   TO PV-SAVE-PREPK-ID         05643058
               MOVE TM001-PO-LNE-NBR        TO PV-SAVE-PO-LNE-NBR       05643162
               MOVE TM001-PREPK-ID          TO DL1-LINE                 05643258
               MOVE TM001-PACK-ITEM-QTY     TO DL1-UNITS                05644049
           ELSE                                                         05645049
               MOVE TM001-PO-LNE-NBR        TO DL1-LINE                 05650049
                                               PV-SAVE-PO-LNE-NBR       05660049
               MOVE TM001-LINE-ITEM-QTY     TO DL1-UNITS                05670049
               MOVE TM001-RECITM-PREPK-ID   TO PV-SAVE-PREPK-ID         05670158
           END-IF.                                                      05671049
056800                                                                  05680005
056900     PERFORM 2100-WRITE-TROUBLE-LINE.                             05690005
057000                                                                  05700005
057100                                                                  05710005
057200                                                                  05720005
057300*                                                                 05730005
057400****************************************************************  05740005
057500* 2300-RECEIVER-BREAK.                                         *  05750005
057600*  THIS PARAGRAPH WILL PERFORM THE LOGIC NEED AT A CHANGE IN   *  05760005
057700*  PO-SEQ  NUMBER -- FIRST MOVE THE CURRENT PO-SEQ  INFO TO THE*  05770005
057800*  DETAIL LINE - PERFORM THE PO LINE BREAK, THE RESET THE SAVE *  05780005
057900*  FIELDS WITH THE NEW DATA                                    *  05790005
058000****************************************************************  05800005
058100 2300-RECEIVER-BREAK.                                             05810005
058200                                                                  05820005
058300     MOVE TM001-PO-NBR                   TO DL1-PO-NBR            05830017
058400                                            PV-SAVE-PO-NBR.       05840017
058500     MOVE '-'                            TO DL1-DASH.             05850014
058600     MOVE TM001-REC-SEQ-NBR              TO DL1-REC-SEQ-NBR       05860017
058700                                            PV-SAVE-REC-SEQ-NBR.  05870017
058800                                                                  05880017
058900     IF TM001-RECEIPT-DATE = '99990909'                           05890017
059000         MOVE '*ENROUTE* '               TO DL1-RECEIPT-DATE      05900006
059100     ELSE                                                         05910006
059200         STRING TM001-RECEIPT-MM         DELIMITED BY SIZE        05920017
059300                '/'                      DELIMITED BY SIZE        05930006
059400                TM001-RECEIPT-DD         DELIMITED BY SIZE        05940017
059500                '/'                      DELIMITED BY SIZE        05950006
059600                TM001-RECEIPT-YYYY       DELIMITED BY SIZE        05960017
059700                                       INTO DL1-RECEIPT-DATE      05970010
059800     END-IF.                                                      05980006
059900     MOVE TM001-RECEIPT-DATE             TO PV-SAVE-RECEIPT-DATE. 05990018
060000                                                                  06000018
060100     MOVE TM001-ENT-NAME-DESC            TO DL1-VENDOR-NAME       06010018
060200                                            PV-SAVE-VENDOR-NAME.  06020018
060300                                                                  06030005
060400*    RE-SET ACCUMULATOR FLAG -- USED TO MAKE SURE THAT IF THERE   06040018
060500*    IS RECEIVER LEVEL TROUBLE, ONLY THE RECEIVER LEVEL TROUBLE   06050018
060600*    UNITS ARE ADDED (IE IF RCVR LEVEL TROUBLE HAS BEEN ADDED,    06060018
060700*    AND THERE IS LINE LEVEL TROUBLE ALSO, DON'T ADD THE LINE     06070018
060800*    LEVEL QUANTITIES)                                            06080018
060900     SET PS-NO-RECEIVER-UNITS-ADDED  TO TRUE                      06090018
           SET PS-PACK-UNITS-NOT-ADDED     TO TRUE                      06091056
061000                                                                  06100018
061100     PERFORM 2200-PO-LNE-BREAK.                                   06110005
061200                                                                  06120005
061300*                                                                 06130006
061400****************************************************************  06140006
061500* 2400-DEPT-NBR-BREAK.                                         *  06150006
061600*  THIS PARAGRAPH WILL PERFORM THE LOGIC NEED AT A CHANGE IN   *  06160006
061700*  DEPT NUMBER - FIRST PRINT THE DEPTARTMENT HEADING, THEN     *  06170006
061800*  PERFORM THE RECEIVER BREAK, THEN RESET THE SAVE FIELDS WITH *  06180006
061900*  THE NEW DEPARTMENT.                                         *  06190006
062000****************************************************************  06200006
062100 2400-DEPT-NBR-BREAK.                                             06210006
062200                                                                  06220006
062300*    IF NO DETAIL WILL FIT ON THE PAGE AFTER THESE HEADINGS ARE   06230018
062400*    PRINTED, START AT THE TOP OF THE NEXT PAGE.                  06240018
062500     MOVE TM001-DEPT-NBR                 TO PV-SAVE-DEPT-NBR.     06250006
062600     MOVE TM001-DEPT-DESC                TO PV-SAVE-DEPT-DESC.    06260006
062700                                                                  06270006
062800     IF (PV-LINE-COUNT + 5) > PC-MAX-REPORT-LINES                 06280031
062900         PERFORM 3000-PRINT-PAGE-HEADING                          06290022
063000         PERFORM 3300-PRINT-DC-HEADING                            06300024
063100         PERFORM 3200-PRINT-BYR-HEADING                           06310024
063200     END-IF.                                                      06320022
063300                                                                  06330022
063400     PERFORM 3100-PRINT-DEPT-HEADING.                             06340006
063500                                                                  06350006
063600     PERFORM 2300-RECEIVER-BREAK.                                 06360006
063700                                                                  06370006
063800*                                                                 06380006
063900****************************************************************  06390006
064000* 2500-BYR-NBR-BREAK.                                          *  06400006
064100*  THIS PARAGRAPH WILL PERFORM THE LOGIC NEED AT A CHANGE IN   *  06410006
064200*  BUYER NUMBER - FIRST PRINT THE BUYER NUMBER HEADING, THEN   *  06420006
064300*  PERFORM THE DEPARTMENT BREA, THEN RESET THE SAVE FIELDS WITH*  06430006
064400*  THE NEW BUYER NUMBER/NAME.                                  *  06440006
064500****************************************************************  06450006
064600 2500-BYR-NBR-BREAK.                                              06460006
064700                                                                  06470006
067200*    MOVE PA-BYR-TROUBLE-COUNT       TO TL1-UNRES-TROUBLE-COUNT.  06471044
067300*                                                                 06472044
067400*    MOVE PA-BYR-TROUBLE-UNIT-QTY    TO TL2-UNRES-TROUBLE-UNITS.  06473044
067500*                                                                 06474044
067600*    PERFORM 3500-PRINT-TOTAL-LINES.                              06475044
067700*                                                                 06476044
067800*    INITIALIZE PA-BYR-TROUBLE-COUNT                              06477044
067900*               PA-BYR-TROUBLE-UNIT-QTY.                          06478044
068000*                                                                 06479044
064800*    IF NO DETAIL WILL FIT ON THE PAGE AFTER THESE HEADINGS ARE   06480018
064900*    PRINTED, START AT THE TOP OF THE NEXT PAGE.                  06490018
065000     IF (PV-LINE-COUNT + 7) > PC-MAX-REPORT-LINES                 06500031
065100         PERFORM 3000-PRINT-PAGE-HEADING                          06510018
065200         PERFORM 3300-PRINT-DC-HEADING                            06520024
065300     END-IF.                                                      06530018
065400                                                                  06540018
065500     MOVE TM001-BYR-NBR                  TO PV-SAVE-BYR-NBR.      06550006
065600     MOVE TM001-BYR-NAME                 TO PV-SAVE-BYR-NAME.     06560006
065700                                                                  06570006
065800     PERFORM 3200-PRINT-BYR-HEADING.                              06580006
065900                                                                  06590006
066000     PERFORM 2400-DEPT-NBR-BREAK.                                 06600006
066100                                                                  06610006
066200*                                                                 06620006
066300****************************************************************  06630006
066400* 2600-OPER-UNT-ID-BREAK.                                      *  06640006
066500*  THIS PARAGRAPH WILL PERFORM THE LOGIC NEED AT A CHANGE IN   *  06650006
066600*  DC - FIRST PRINT THE DC TOTAL LINES FROM THE PREVIOUS DC,   *  06660006
066700*  THE PRINT THE NEW DC-HEADING, THEN PERFORM THE BUYER BREAK  *  06670006
066800*  LOGIC, THEN MOVE THE DC SAVE FIELDS.                        *  06680006
066900****************************************************************  06690006
067000 2600-OPER-UNT-ID-BREAK.                                          06700006
067100                                                                  06710006
067200     MOVE PA-DC-TROUBLE-COUNT        TO TL1-UNRES-TROUBLE-COUNT.  06720019
067300                                                                  06730018
067400     MOVE PA-DC-TROUBLE-UNIT-QTY     TO TL2-UNRES-TROUBLE-UNITS.  06740019
067500                                                                  06750018
067600     PERFORM 3500-PRINT-TOTAL-LINES.                              06760018
                                                                        06760145
087400     WRITE TROUBLE-REPORT-RECORD                                  06761045
087500       FROM ER-END-REPORT-LINE                                    06762045
087600           AFTER ADVANCING 2 LINES.                               06763045
067700                                                                  06770018
067800     INITIALIZE PA-DC-TROUBLE-COUNT                               06780018
067900                PA-DC-TROUBLE-UNIT-QTY.                           06790018
068000                                                                  06800018
           MOVE +0 TO PV-PAGE-NUMBER                                    06810036
                                                                        06811036
046500     PERFORM 3000-PRINT-PAGE-HEADING.                             06820036
068600                                                                  06860018
068700     MOVE TM001-OPER-UNT-ID              TO PV-SAVE-OPER-UNT-ID.  06870006
                                                                        06870139
           PERFORM 7000-GET-DC-NAME.                                    06871039
068800                                                                  06880006
068900     PERFORM 3300-PRINT-DC-HEADING.                               06890006
069000                                                                  06900006
069100     PERFORM 2500-BYR-NBR-BREAK.                                  06910006
069200                                                                  06920006
069300                                                                  06930006
069400****************************************************************  06940006
069500* 3000-PRINT-PAGE-HEADING.                                     *  06950006
069600* PRINTS THE HEADINGS AT THE TOP OF EACH PAGE.                 *  06960006
069700****************************************************************  06970006
069800 3000-PRINT-PAGE-HEADING.                                         06980006
069900                                                                  06990006
070000     ADD +1 TO PV-PAGE-NUMBER.                                    07000006
070100     MOVE PV-PAGE-NUMBER            TO DP132O-PAGE-NUMBER.        07010006
070200                                                                  07020006
070300     WRITE TROUBLE-REPORT-RECORD                                  07030006
070400         FROM DP132O-STANDRD-HEADER-132-COLS                      07040006
070500     AFTER ADVANCING PAGE.                                        07050006
070600                                                                  07060006
070700     WRITE TROUBLE-REPORT-RECORD                                  07070006
070800         FROM HL1-HEADING-LINE-1                                  07080006
070900     AFTER ADVANCING 2.                                           07090006
071000                                                                  07100006
071100     WRITE TROUBLE-REPORT-RECORD                                  07110006
071200         FROM HL2-HEADING-LINE-2                                  07120006
071300     AFTER ADVANCING 1.                                           07130006
071400                                                                  07140006
071500     MOVE +4 TO PV-LINE-COUNT.                                    07150018
071600                                                                  07160006
071700* MOVE COMPLETE INFORMATION TO THE DETAIL LINE FOR THE FIRST      07170018
071800* LINE OF THE PAGE                                                07180018
           IF TM001-PREPK-ID > 0                                        07190153
               MOVE TM001-PREPK-ID          TO DL1-LINE                 07190253
               MOVE TM001-PACK-ITEM-QTY     TO DL1-UNITS                07190453
           ELSE                                                         07190553
               MOVE TM001-PO-LNE-NBR        TO DL1-LINE                 07190653
               MOVE TM001-LINE-ITEM-QTY     TO DL1-UNITS                07190853
           END-IF.                                                      07190953
072100     MOVE TM001-PO-NBR                   TO DL1-PO-NBR.           07210018
072200     MOVE '-'                            TO DL1-DASH.             07220018
072300     MOVE TM001-REC-SEQ-NBR              TO DL1-REC-SEQ-NBR.      07230020
072400                                                                  07240018
072500     IF TM001-RECEIPT-DATE = '99990909'                           07250018
072600         MOVE '*ENROUTE* '               TO DL1-RECEIPT-DATE      07260018
072700     ELSE                                                         07270018
072800         STRING TM001-RECEIPT-MM         DELIMITED BY SIZE        07280018
072900                '/'                      DELIMITED BY SIZE        07290018
073000                TM001-RECEIPT-DD         DELIMITED BY SIZE        07300018
073100                '/'                      DELIMITED BY SIZE        07310018
073200                TM001-RECEIPT-YYYY       DELIMITED BY SIZE        07320018
073300                                       INTO DL1-RECEIPT-DATE      07330018
073400     END-IF.                                                      07340018
073500                                                                  07350018
073600     MOVE TM001-ENT-NAME-DESC            TO DL1-VENDOR-NAME.      07360018
073700                                                                  07370018
073800                                                                  07380006
073900****************************************************************  07390013
074000* 3050-PRINT-COLUMN-HEADINGS                                   *  07400013
074100* PRINTS THE COLUMN HEADINGS                                   *  07410013
074200****************************************************************  07420013
074300 3050-PRINT-COLUMN-HEADINGS.                                      07430013
074400                                                                  07440013
074500     WRITE TROUBLE-REPORT-RECORD                                  07450013
074600         FROM HL6-HEADING-LINE-6                                  07460013
074700     AFTER ADVANCING 1.                                           07470018
074800                                                                  07480013
074900     WRITE TROUBLE-REPORT-RECORD                                  07490013
075000         FROM HL7-HEADING-LINE-7                                  07500013
075100     AFTER ADVANCING 1.                                           07510013
075200                                                                  07520028
075300     WRITE TROUBLE-REPORT-RECORD                                  07530028
075400         FROM HL8-HEADING-LINE-8                                  07540028
075500     AFTER ADVANCING 0.                                           07550028
075600                                                                  07560028
075700     ADD +2 TO PV-LINE-COUNT.                                     07570028
075800                                                                  07580028
075900                                                                  07590028
076000****************************************************************  07600006
076100* 3100-PRINT-DEPT-HEADING                                      *  07610006
076200* PRINTS THE HEADING LINE ON A CHANGE IN DEPARTMENT.           *  07620006
076300****************************************************************  07630006
076400 3100-PRINT-DEPT-HEADING.                                         07640006
076500                                                                  07650006
076600     MOVE TM001-DEPT-NBR             TO HL5-DPT-NBR.              07660018
076700     MOVE TM001-DEPT-DESC            TO HL5-DPT-DESC.             07670018
076800                                                                  07680006
076900     WRITE TROUBLE-REPORT-RECORD                                  07690010
077000            FROM HL5-HEADING-LINE-5                               07700006
077100     AFTER ADVANCING 2.                                           07710006
077200                                                                  07720006
077300     ADD +2 TO PV-LINE-COUNT.                                     07730010
077400                                                                  07740013
077500     PERFORM 3050-PRINT-COLUMN-HEADINGS.                          07750013
077600                                                                  07760006
077700                                                                  07770006
077800****************************************************************  07780006
077900* 3200-PRINT-BYR-HEADING                                       *  07790006
078000* PRINTS THE HEADING LINE ON A CHANGE IN BUYER.                *  07800006
078100****************************************************************  07810006
078200 3200-PRINT-BYR-HEADING.                                          07820006
078300                                                                  07830006
078400     MOVE TM001-BYR-NBR              TO HL4-BUYER-NBR.            07840018
078500     MOVE TM001-BYR-NAME             TO HL4-BUYER-NAME.           07850018
078600                                                                  07860006
078700     WRITE TROUBLE-REPORT-RECORD                                  07870010
078800            FROM HL4-HEADING-LINE-4                               07880006
078900     AFTER ADVANCING 2.                                           07890006
079000                                                                  07900006
079100     ADD +2 TO PV-LINE-COUNT.                                     07910010
079200                                                                  07920006
079300****************************************************************  07930006
079400* 3300-PRINT-DC-HEADING                                        *  07940006
079500* PRINTS THE HEADING LINE ON A CHANGE IN DC                    *  07950006
079600****************************************************************  07960006
079700 3300-PRINT-DC-HEADING.                                           07970006
079800                                                                  07980006
079900     MOVE TM001-OPER-UNT-ID          TO HL3-DC-NBR.               07990039
           MOVE XL071-LOC-NM               TO HL3-DC-NAME.              07990167
080000                                                                  08000006
080100     WRITE TROUBLE-REPORT-RECORD                                  08010010
080200            FROM HL3-HEADING-LINE-3                               08020006
080300     AFTER ADVANCING 2.                                           08030006
080400                                                                  08040006
080500     ADD +2 TO PV-LINE-COUNT.                                     08050010
080600                                                                  08060006
080700                                                                  08070018
080800****************************************************************  08080018
080900* 3400-PRINT-BLANK-LINE                                        *  08090018
081000* PRINTS THE HEADING LINE ON A CHANGE IN DC                    *  08100018
081100****************************************************************  08110018
081200 3400-PRINT-BLANK-LINE.                                           08120018
081300                                                                  08130018
081400     WRITE TROUBLE-REPORT-RECORD                                  08140018
081500            FROM BL-BLANK-LINE                                    08150018
081600     AFTER ADVANCING 1.                                           08160018
081700                                                                  08170018
081800     ADD +1 TO PV-LINE-COUNT.                                     08180018
081900                                                                  08190018
082000                                                                  08200018
082100****************************************************************  08210018
082200* 3500-PRINT-TOTAL-LINES                                       *  08220018
082300* PRINTS THE TOTAL LINES FOR A CHANGE IN DC                    *  08230018
082400****************************************************************  08240018
082500 3500-PRINT-TOTAL-LINES.                                          08250018
082600                                                                  08260018
082700*    IF THESE TOTAL LINES WILL NOT FIT ON THE PAGE, START AT THE  08270019
082800*    TOP OF THE NEXT PAGE.                                        08280019
082900     IF (PV-LINE-COUNT + 2) > PC-MAX-REPORT-LINES                 08290019
083000         PERFORM 3000-PRINT-PAGE-HEADING                          08300019
046600         PERFORM 3300-PRINT-DC-HEADING                            08301045
083100     END-IF.                                                      08310019
083200                                                                  08320019
083300     WRITE TROUBLE-REPORT-RECORD                                  08330018
083400            FROM TL1-TOTAL-LINE-1                                 08340019
083500     AFTER ADVANCING 1.                                           08350018
083600                                                                  08360019
083700     WRITE TROUBLE-REPORT-RECORD                                  08370019
083800            FROM TL2-TOTAL-LINE-2                                 08380019
083900     AFTER ADVANCING 1.                                           08390019
087700                                                                  08404045
084100     ADD +2 TO PV-LINE-COUNT.                                     08410019
084200                                                                  08420019
084300*                                                                 08430018
085000****************************************************************  08431039
085100* 7000-GET-DC-NAME                                             *  08432039
085200* SELECT THE DC NAME USING LOCATION CALLED MODULE              *  08433063
085300****************************************************************  08434039
084400 7000-GET-DC-NAME.                                                08440039
084410     INITIALIZE XL071-COMMAREA-REC.                               08440165
084420     MOVE TM001-OPER-UNT-ID         TO XL071-LOCATION-NUMBER      08440265
084430                                       PV-OPER-UNT-ID-NUM.        08440965
084430     MOVE PV-OPER-UNT-ID-NUM        TO PV-OPER-UNT-ID-X.          08441065
084440                                                                  08441165
069400     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC          08441265
070000                                                                  08441439
070200     EVALUATE TRUE                                                08441639
070300         WHEN XL071-NO-ERRORS                                     08441763
070400           CONTINUE                                               08441839
070500         WHEN XL071-LOC-NOT-FOUND                                 08441963
070600         WHEN XL071-SQLCODE-N = -904                              08442068
070700         WHEN XL071-SQLCODE-N = -913                              08442168
070800             MOVE PC-NOT-FOUND   TO XL071-LOC-NM                  08442267
070900         WHEN XL071-BAD-DB2-RETURN                                08442363
071000             MOVE XL071-SQLCODE TO PV-ABEND-SQLCODE               08442463
071010             DISPLAY '** SQLCODE   ** = ' PV-ABEND-SQLCODE        08442566
071100             MOVE '7000-GET-DC-NAME'                              08442663
071200                               TO PV-PARAGRAPH-NAME               08442763
071300             STRING 'CALL LOCATION MODULE.  STORE NUMBER'         08442963
071400                    ' USED IS: '                                  08443063
071500                    PV-OPER-UNT-ID-X DELIMITED BY SIZE            08443165
071510                             INTO  PV-DB2-OPERATION-ATTEMPTED     08443263
071600             PERFORM 9999-SQL-ABEND                               08444063
071700     END-EVALUATE.                                                08450039
084900                                                                  08490004
084300*                                                                 08531039
084400 8000-READ-INPUT-FILE.                                            08532039
084500      READ TROUBLE-EXTRACT-FILE                                   08533039
084600            INTO TM001-TROUBLE-EXT-RECORD                         08534039
084700      AT END                                                      08535039
084800             SET PS-EOF-INPUT-FILE TO TRUE.                       08536039
084900                                                                  08537039
085000****************************************************************  08538039
085100* 8100-WRITE-REPORT-LINE                                       *  08539039
085200* WRITE A TROUBLE REPORT RECORD                                *  08539139
085300****************************************************************  08539239
085400 8100-WRITE-REPORT-LINE.                                          08540004
085500                                                                  08550006
085600     IF (PV-LINE-COUNT + 1)  > PC-MAX-REPORT-LINES                08560025
085700         PERFORM 3000-PRINT-PAGE-HEADING                          08570006
085800         PERFORM 3300-PRINT-DC-HEADING                            08580022
085900         PERFORM 3200-PRINT-BYR-HEADING                           08590022
086000         PERFORM 3100-PRINT-DEPT-HEADING                          08600022
086100     END-IF.                                                      08610006
086200                                                                  08620006
086300     WRITE TROUBLE-REPORT-RECORD                                  08630006
086400           FROM DL1-DETAIL-LINE-1                                 08640026
086500     AFTER ADVANCING 1.                                           08650006
086600                                                                  08660006
086700     ADD +1 TO PV-LINE-COUNT.                                     08670006
086800                                                                  08680004
086900****************************************************************  08690006
087000* 9000-END-PROCESS.                                            *  08700006
087100* END OF PROGRAM PROCESSING                                    *  08710006
087200****************************************************************  08720006
087300 9000-END-PROCESS.                                                08730000
067100                                                                  08731042
067200     MOVE PA-DC-TROUBLE-COUNT        TO TL1-UNRES-TROUBLE-COUNT.  08732042
067400     MOVE PA-DC-TROUBLE-UNIT-QTY     TO TL2-UNRES-TROUBLE-UNITS.  08734042
067600     PERFORM 3500-PRINT-TOTAL-LINES.                              08736042
067700                                                                  08737042
087400     WRITE TROUBLE-REPORT-RECORD                                  08739045
087500       FROM ER-END-REPORT-LINE                                    08740045
087600           AFTER ADVANCING 2 LINES.                               08750045
084000                                                                  08760045
087800     CLOSE  TROUBLE-EXTRACT-FILE                                  08780000
087900            TROUBLE-REPORT-FILE.                                  08790010
088000                                                                  08800000
088100 9999-SQL-ABEND.                                                  08810006
088200                                                                  08820000
088300     DISPLAY '** ABEND     **'.                                   08830006
088400     DISPLAY '** PROGRAM   ** = TMKRP013'.                        08840063
088500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08850006
088600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     08860006
088700                                                                  08870006
088800* DISPLAY SQLCA IN READABLE FORMAT.                               08880006
088900     COPY DPPD004.                                                08890000
089000                                                                  08900000
089100     MOVE +4013 TO PV-ABEND-CODE.                                 08910000
089200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08920000
089300                                                                  08930000
