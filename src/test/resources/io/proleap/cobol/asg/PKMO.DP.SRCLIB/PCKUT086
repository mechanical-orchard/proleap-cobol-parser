000100 TITLE 'EXTRACT TRIP DATA'.                                       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    PCKUT086.                                         00030000
000400 AUTHOR.        BRENDA ROCKWELL.                                  00040000
000500 DATE-WRITTEN.  NOVEMBER, 2009.                                   00050000
000600                                                                  00060000
000700*THIS PROGRAM WILL EXTRACT TRIPS THAT ARE ENROUTE, ARRIVED, OR    00070000
000800*IN A RECEIVING DOOR.                                             00080000
000900*THERE IS 1 OUTPUT FILE PRODUCED (USING LAYOUT PCRD068)           00090000
001000*WHICH IS USED AS INPUT INTO PCKUT087 TO EXTRACT DETAIL           00100000
001100*INFORMATION.                                                     00110000
001200*                                                                 00120000
001300 ENVIRONMENT DIVISION.                                            00130000
001400 INPUT-OUTPUT SECTION.                                            00140000
001500                                                                  00150000
001600 FILE-CONTROL.                                                    00160000
001700     SELECT TRIP-EXTRACT-FILE       ASSIGN TO OUT01.              00170000
001800                                                                  00180002
001900* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  00190000
002000     SELECT TRIP-EXTRACT-FILE2      ASSIGN TO OUT02.              00200000
002100* RMK 6/2010 - END                                                00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400 FILE SECTION.                                                    00240000
002500                                                                  00250000
002600 FD  TRIP-EXTRACT-FILE                                            00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000                                                                  00300000
003100 01  TRIP-EXTRACT-RECORD              PIC X(400).                 00310000
003200                                                                  00320000
003300* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  00330000
003400 FD  TRIP-EXTRACT-FILE2                                           00340000
003500     RECORDING MODE IS F                                          00350000
003600     LABEL RECORDS ARE STANDARD                                   00360000
003700     BLOCK CONTAINS 0 RECORDS.                                    00370000
003800                                                                  00380000
003900 01  TRIP-EXTRACT-RECORD2             PIC X(400).                 00390000
004000* RMK 6/2010 - END                                                00400000
004100                                                                  00410000
004200 WORKING-STORAGE SECTION.                                         00420000
004300                                                                  00430000
004400 01  WS-RESND-CODE                    PIC S9(04)   VALUE ZERO.    00440000
004500                                                                  00450000
004600 01  WS-PROGRAM-SWITCHES.                                         00460000
004700     05  WS-END-CSR-SW                PIC X(1)   VALUE 'N'.       00470000
004800         88  WS-END-CSR                          VALUE 'Y'.       00480000
004900                                                                  00490000
005000 01  CC-CONTROL-CARD-PARAMETERS.                                  00500000
005100      05 CC-DC-NBR                      PIC 9(04).                00510000
005200      05 FILLER                         PIC X(76) VALUE SPACE.    00520000
005300                                                                  00530000
005400 01  WS-PROGRAM-VARIABLES.                                        00540000
005500     05  WS-SQLCODE                   PIC 9(9)    VALUE ZERO.     00550000
005600     05  WS-PREV-DC-NBR               PIC 9(4)    VALUE ZERO.     00560000
005700     05  WS-DC-COUNT                  PIC 9(4)    VALUE ZERO.     00570000
005800     05  WS-DISPLAY-NUMBER            PIC 9999999999.             00580000
005900     05  WS-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00590000
006000     05  WS-FETCH-COUNT               PIC S9(9)   COMP-3          00600000
006100                                                  VALUE ZEROS.    00610000
006200     05  WS-WRITE-COUNT               PIC S9(9)   COMP-3          00620000
006300                                                  VALUE ZEROS.    00630000
006400     05  WS-OPER-UNT-ID               PIC S9(04) COMP SYNC        00640000
006500                                                    VALUE ZERO.   00650000
006600* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  00660000
006700     05  WS-SHIPT-UNT-ID-CNT          PIC S9(09) COMP-3.          00670000
006800     05  WS-WRITE-COUNT2              PIC S9(9)  COMP-3 VALUE 0.  00680000
006900* RMK 6/2010 - END                                                00690000
007000                                                                  00700000
007100 01  WS-DC-COUNT-TABLE.                                           00710000
007200     05  WS-DC-ENTRY                  OCCURS 50 TIMES             00720002
007300                                      INDEXED BY WS-DC-IDX.       00730000
007400         10  WS-DC-NBR                PIC ZZ99.                   00740000
007500         10  WS-DC-COUNTER            PIC S9(9)   COMP-3          00750000
007600                                                  VALUE ZEROS.    00760000
007700 01  PC-PROGRAM-CONSTANTS.                                        00770000
007800     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT086'.00780000
007900 01  WS-ABEND-FIELDS.                                             00790000
008000     05  WS-ABEND-CODE                PIC S9(04)   VALUE ZERO.    00800000
008100     05  WS-ABEND-PROGRAM             PIC X(8)   VALUE 'PCKUT086'.00810000
008200     05  WS-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00820000
008300     05  WS-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00830000
008400     05  WS-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    00840000
008500     05  WS-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    00850000
008600     05  WS-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    00860000
008700     05  WS-ABEND-STATUS              PIC XX     VALUE SPACES.    00870000
008800     05  WS-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00880000
008900     05  WS-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00890000
009000     05  WS-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00900000
009100     05  WS-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00910000
009200                                                                  00920000
009300/                                                                 00930000
009400*    EXPORT EXTRACT FILE LAYOUT                                   00940000
009500     COPY PCRD068.                                                00950000
009600                                                                  00960000
009700*    DCLGEN FOR THE PARAMETER TABLE                               00970000
009800     EXEC SQL                                                     00980000
009900         INCLUDE TKRPRPM                                          00990000
010000     END-EXEC                                                     01000000
010100                                                                  01010000
010200*    DCLGEN FOR SU APPLICATION ID INBOUND VEHICLE TRIP TABLE      01020000
010300     EXEC SQL                                                     01030000
010400         INCLUDE TVHTRIP                                          01040000
010500     END-EXEC                                                     01050000
010600                                                                  01060000
010700*    DCLGEN FOR SU APPLICATION ID TRIP STATUS TABLE               01070000
010800     EXEC SQL                                                     01080000
010900         INCLUDE TTRIPST                                          01090000
011000     END-EXEC                                                     01100000
011100                                                                  01110000
011200*    DCLGEN FOR SU APPLICATION ID TRIP STATUS TYPE TABLE          01120000
011300     EXEC SQL                                                     01130000
011400         INCLUDE TTRSTYP                                          01140000
011500     END-EXEC                                                     01150000
011600                                                                  01160000
011700*    DCLGEN FOR XL APPLICATION ID XLT_LOC TABLE                   01170000
011800     EXEC SQL                                                     01180000
011900         INCLUDE XLT00010                                         01190000
012000     END-EXEC                                                     01200000
012100                                                                  01210000
012200*    DCLGEN FOR SU APPLICATION ID INBOUND TRIP DOOR ASSC TABLE    01220000
012300*    (SUT_INBD_TRIP_DOOR)                                         01230000
012400     EXEC SQL                                                     01240000
012500         INCLUDE SUT00040                                         01250000
012600     END-EXEC                                                     01260000
012700                                                                  01270000
012800* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  01280000
012900*    DCLGEN FOR VEHICL DATA TABLE                                 01290000
013000     EXEC SQL                                                     01300000
013100         INCLUDE TVEHICL                                          01310000
013200     END-EXEC                                                     01320000
013300                                                                  01330000
013400*    DCLGEN FOR PROCESS FILE TABLE                                01340000
013500     EXEC SQL                                                     01350000
013600         INCLUDE SUT00113                                         01360000
013700     END-EXEC                                                     01370000
013800/                                                                 01380000
013900     EXEC SQL                                                     01390000
014000         DECLARE IBF-TR-SQL-2 CURSOR FOR                          01400000
014100             SELECT DISTINCT                                      01410000
014200                A.TRIP_ID                                         01420000
014300              , B.OPER_UNT_ID                                     01430000
014400              , A.OWNER_SCAC_ID                                   01440000
014500              , A.VEH_NBR                                         01450000
014600              , B.TRIP_STATUS_CDE                                 01460000
014700              , C.PRTY_CDE                                        01470000
014800              , B.STATUS_DTE                                      01480000
014900              , B.STATUS_TME                                      01490000
015000              , A.MANIFEST_NBR                                    01500000
015100             FROM                                                 01510000
015200                   TVHTRIP A                                      01520000
015300              ,    TTRIPST B                                      01530000
015400              ,    TTRSTYP C                                      01540000
015500              ,    TVEHICL F                                      01550000
015600              ,    XLT_LOC G                                      01560000
015700             WHERE A.TRIP_ID         = B.TRIP_ID                  01570000
015800               AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE          01580000
015900               AND C.TRIP_STATUS_CDE IN ('EN' ,                   01590000
016000                                         'AR' ,                   01600000
016100                                         'UG' )                   01610000
016200               AND B.STATUS_DTE >                                 01620000
016300                            (CURRENT DATE - :KRPRPM-FUNC-QTY DAYS)01630000
016400               AND B.OPER_UNT_ID = :WS-OPER-UNT-ID                01640000
016500               AND F.CURR_TRIP_ID    = A.TRIP_ID                  01650000
016600               AND G.LOC_NBR         = B.OPER_UNT_ID              01660000
016700               AND G.LOC_TYP_CDE     = 'DC'                       01670000
016800               AND A.VEH_NBR        IS NOT NULL                   01680000
016900               AND C.PRTY_CDE    =                                01690000
017000             (SELECT MAX(E.PRTY_CDE)                              01700000
017100              FROM TTRIPST D                                      01710000
017200                 , TTRSTYP E                                      01720000
017300             WHERE D.TRIP_ID         = A.TRIP_ID                  01730000
017400               AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)         01740000
017500               GROUP BY B.OPER_UNT_ID                             01750000
017600                      , A.TRIP_ID                                 01760000
017700                      , A.OWNER_SCAC_ID                           01770000
017800                      , A.VEH_NBR                                 01780000
017900                      , B.TRIP_STATUS_CDE                         01790000
018000                      , C.PRTY_CDE                                01800000
018100                      , B.STATUS_DTE                              01810000
018200                      , B.STATUS_TME                              01820000
018300                      , A.MANIFEST_NBR                            01830000
018400             ORDER BY 2,6,7,3                                     01840000
018500           WITH UR                                                01850000
018600     END-EXEC                                                     01860000
018700/                                                                 01870000
018800* RMK 6/2010 - END                                                01880000
018900                                                                  01890000
019000*  USED FOR DB2 ERROR MESSAGE BUILDING                            01900000
019100     COPY DPWS004.                                                01910000
019200                                                                  01920000
019300*   DB2 SQL COMMUNICATION AREA                                    01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE SQLCA                                           01950000
019600     END-EXEC.                                                    01960000
019700/                                                                 01970000
019800 PROCEDURE DIVISION.                                              01980000
019900                                                                  01990000
020000     PERFORM 1000-INIT.                                           02000000
020100                                                                  02010000
020200     PERFORM 2000-PROCESS UNTIL WS-END-CSR.                       02020000
020300                                                                  02030000
020400     PERFORM 9000-TERMINATE.                                      02040000
020500                                                                  02050000
020600     GOBACK.                                                      02060000
020700                                                                  02070000
020800 1000-INIT.                                                       02080000
020900                                                                  02090000
021000     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                02100000
021100     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              02110000
021200             CC-CONTROL-CARD-PARAMETERS.                          02120000
021300     MOVE CC-DC-NBR             TO WS-OPER-UNT-ID.                02130000
021400*                                                                 02140000
021500     EXEC SQL                                                     02150000
021600         SELECT FUNC_QTY                                          02160000
021700           INTO :KRPRPM-FUNC-QTY                                  02170000
021800           FROM TKRPRPM                                           02180000
021900          WHERE LOC_ID            = :WS-OPER-UNT-ID               02190000
022000            AND FUNC_PRC_STAT_CDE = 'AC'                          02200000
022100            AND SYS_PRC_FUNC_CDE  = 'IBFRCS'                      02210000
022200           WITH UR                                                02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500     EVALUATE TRUE                                                02250000
022600         WHEN SQLCODE = ZERO                                      02260000
022700             CONTINUE                                             02270000
022800         WHEN SQLCODE = +100                                      02280000
022900             MOVE +30 TO KRPRPM-FUNC-QTY                          02290000
023000         WHEN SQLWARN0 NOT = SPACE                                02300000
023100         WHEN SQLCODE  NOT = ZERO                                 02310000
023200             MOVE '1000-INIT'          TO WS-ABEND-PARAGRAPH      02320000
023300             MOVE 'SELECT FUNC_QTY'    TO WS-ABEND-OPERATION      02330000
023400             MOVE 'TKRPRPM'            TO WS-ABEND-STRUCTURE-1    02340000
023500             PERFORM 9900-DB2-ABEND                               02350000
023600     END-EVALUATE.                                                02360000
023700                                                                  02370000
023800     OPEN OUTPUT TRIP-EXTRACT-FILE.                               02380000
023900* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  02390000
024000     OPEN OUTPUT TRIP-EXTRACT-FILE2.                              02400000
024100* RMK 6/2010 - END                                                02410000
024200                                                                  02420000
024300     SET WS-DC-IDX TO +1.                                         02430000
024400                                                                  02440000
024500     PERFORM 7000-OPEN-TRIP-CSR.                                  02450000
024600     PERFORM 7010-FETCH-TRIP-CSR.                                 02460000
024700                                                                  02470000
024800 2000-PROCESS.                                                    02480000
024900                                                                  02490000
025000     INITIALIZE PC068-RECORD-LAYOUT.                              02500000
025100                                                                  02510000
025200     IF TRIPST-TRIP-STATUS-CDE = 'EN'                             02520000
025300         MOVE '01-01-0001' TO PC068-ARRIVAL-DATE                  02530000
025400         MOVE 'ENROUTE'    TO PC068-TRLR-LOC                      02540000
025500         MOVE '3'          TO PC068-SORT-BY-LOC-IND               02550000
025600     ELSE                                                         02560000
025700         MOVE TRIPST-STATUS-DTE TO PC068-ARRIVAL-DATE             02570000
025800         MOVE TRIPST-STATUS-TME TO PC068-ARRIVAL-TIME             02580000
025900         PERFORM 3000-RETRIEVE-DOOR-DATA                          02590000
026000     END-IF.                                                      02600000
026100                                                                  02610000
026200     MOVE TRIPST-OPER-UNT-ID     TO PC068-OPER-UNT-ID.            02620000
026300     MOVE VHTRIP-TRIP-ID         TO PC068-TRIP-ID.                02630000
026400     MOVE VHTRIP-OWNER-SCAC-ID   TO PC068-SCAC.                   02640000
026500     MOVE VHTRIP-VEH-NBR         TO PC068-TRLR-NBR.               02650000
026510*                                                                 02651003
026520*** 6/27/14 - DMH BEGIN                                           02652003
026521*** REMOVE PC068-VHTRIP-MNFST-NBR  FROM COPYBOOK                  02652103
026530*** REUSING SPACE FOR CONTROLLED FLOW AND HAZARDOUS               02653003
026600***  MOVE VHTRIP-MANIFEST-NBR    TO PC068-VHTRIP-MNFST-NBR.       02660003
026601     MOVE ZEROES                 TO PC068-HAZ-CTN-CNT             02660103
026602                                    PC068-HAZ-UNT-CNT             02660203
026603                                    PC068-CNTL-FLOW-CTN-CNT       02660303
026604                                    PC068-CNTL-FLOW-UNT-CNT.      02660403
026605     MOVE SPACES                 TO PC068-HAZ-SW                  02660503
026606                                    PC068-CNTL-FLOW-SW.           02660603
026610*** 6/27/14 - DMH END                                             02661003
026620*                                                                 02662003
026700* SMA 10/2011 -  WR40392  IB CARTON FORECAST SUMMARY RPT          02670000
026800     MOVE 1                      TO PC068-PROCESS-GROUP.          02680000
026900* SMA 10/2011 - END                                               02690000
027000                                                                  02700000
027100* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  02710000
027200     PERFORM 5000-GET-PROCESS-CARTON.                             02720000
027300* RMK 6/2010 - END                                                02730000
027400     PERFORM 8100-WRITE-OUTPUT-REC.                               02740000
027500                                                                  02750000
027600     IF PC068-OPER-UNT-ID = WS-PREV-DC-NBR                        02760000
027700        ADD +1 TO WS-DC-COUNTER (WS-DC-IDX)                       02770000
027800     ELSE                                                         02780000
027900        ADD +1 TO WS-DC-COUNT                                     02790000
028000        SET WS-DC-IDX UP BY 1                                     02800000
028100        MOVE +1 TO WS-DC-COUNTER (WS-DC-IDX)                      02810000
028200        MOVE PC068-OPER-UNT-ID TO WS-DC-NBR (WS-DC-IDX)           02820000
028300        MOVE PC068-OPER-UNT-ID TO WS-PREV-DC-NBR.                 02830000
028400                                                                  02840000
028500     PERFORM 7010-FETCH-TRIP-CSR.                                 02850000
028600/                                                                 02860000
028700 3000-RETRIEVE-DOOR-DATA.                                         02870000
028800                                                                  02880000
028900     EXEC SQL                                                     02890000
029000         SELECT DOOR1.DOOR_ID                                     02900000
029100           INTO :SUT00040-DOOR-ID                                 02910000
029200           FROM SUT_INBD_TRIP_DOOR DOOR1                          02920000
029300          WHERE DOOR1.TRIP_ID  = :VHTRIP-TRIP-ID                  02930000
029400            AND DOOR1.CRE_TMST =                                  02940000
029500            ( SELECT MAX (DOOR2.CRE_TMST)                         02950000
029600                FROM SUT_INBD_TRIP_DOOR DOOR2                     02960000
029700               WHERE DOOR1.TRIP_ID = DOOR2.TRIP_ID )              02970000
029800           WITH UR                                                02980000
029900     END-EXEC.                                                    02990000
030000                                                                  03000000
030100     EVALUATE TRUE                                                03010000
030200         WHEN SQLCODE = ZERO                                      03020000
030300             MOVE SUT00040-DOOR-ID TO PC068-TRLR-LOC              03030000
030400             MOVE '1'              TO PC068-SORT-BY-LOC-IND       03040000
030500         WHEN SQLCODE = +100                                      03050000
030600             MOVE 'YARD'           TO PC068-TRLR-LOC              03060000
030700             MOVE '2'              TO PC068-SORT-BY-LOC-IND       03070000
030800     END-EVALUATE.                                                03080000
030900                                                                  03090000
031000/                                                                 03100000
031100* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  03110000
031200 5000-GET-PROCESS-CARTON.                                         03120000
031300     EXEC SQL                                                     03130000
031400         SELECT COUNT(DISTINCT(SHIPT_UNT_ID))                     03140000
031500           INTO :WS-SHIPT-UNT-ID-CNT                              03150000
031600           FROM SUT_TRLR_RPLN_CART                                03160000
031700         WHERE INBND_TRIP_ID = :VHTRIP-TRIP-ID                    03170000
031800           WITH UR                                                03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100     EVALUATE TRUE                                                03210000
032200         WHEN SQLCODE = ZERO                                      03220000
032300* JAK 7/2011 - REQUEST #3253 - FIX BUG WITH IMPORT REPLEN         03230000
032400*            IF WS-SHIPT-UNT-ID-CNT > ZERO                        03240000
032500*              MOVE WS-SHIPT-UNT-ID-CNT TO PC068-REPLEN-CARTON-CNT03250000
032600*              MOVE WS-SHIPT-UNT-ID-CNT TO PC068-TOT-CTN-CNT      03260000
032700*              MOVE 'REPLEN'        TO PC068-STORE-ZONE           03270000
032800*            END-IF                                               03280000
032900             CONTINUE                                             03290000
033000* JAK 7/2011 - END                                                03300000
033100         WHEN SQLCODE = +100                                      03310000
033200             CONTINUE                                             03320000
033300         WHEN OTHER                                               03330000
033400             MOVE '5000-GET-PROCESS-CARTON' TO WS-ABEND-PARAGRAPH 03340000
033500             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03350000
033600             MOVE 'SUTTRLR'       TO WS-ABEND-STRUCTURE-1         03360000
033700             PERFORM 9900-DB2-ABEND                               03370000
033800     END-EVALUATE.                                                03380000
033900* RMK 6/2010 - END                                                03390000
034000                                                                  03400000
034100/                                                                 03410000
034200 7000-OPEN-TRIP-CSR.                                              03420000
034300     EXEC SQL                                                     03430000
034400         OPEN IBF-TR-SQL-2                                        03440000
034500     END-EXEC.                                                    03450000
034600                                                                  03460000
034700     EVALUATE TRUE                                                03470000
034800         WHEN SQLCODE = ZERO                                      03480000
034900             CONTINUE                                             03490000
035000         WHEN SQLWARN0 NOT = SPACE                                03500000
035100         WHEN SQLCODE  NOT = ZERO                                 03510000
035200             MOVE '7000-OPEN-TRIP-CSR' TO WS-ABEND-PARAGRAPH      03520000
035300             MOVE 'OPEN CURSOR'        TO WS-ABEND-OPERATION      03530000
035400             MOVE 'TVHTRIP'            TO WS-ABEND-STRUCTURE-1    03540000
035500             PERFORM 9900-DB2-ABEND                               03550000
035600     END-EVALUATE.                                                03560000
035700                                                                  03570000
035800 7010-FETCH-TRIP-CSR.                                             03580000
035900     EXEC SQL                                                     03590000
036000         FETCH IBF-TR-SQL-2                                       03600000
036100         INTO                                                     03610000
036200             :VHTRIP-TRIP-ID                                      03620000
036300         ,   :TRIPST-OPER-UNT-ID                                  03630000
036400         ,   :VHTRIP-OWNER-SCAC-ID                                03640000
036500         ,   :VHTRIP-VEH-NBR                                      03650000
036600         ,   :TRIPST-TRIP-STATUS-CDE                              03660000
036700         ,   :TRSTYP-PRTY-CDE                                     03670000
036800         ,   :TRIPST-STATUS-DTE                                   03680000
036900         ,   :TRIPST-STATUS-TME                                   03690000
037000         ,   :VHTRIP-MANIFEST-NBR                                 03700000
037100     END-EXEC.                                                    03710000
037200                                                                  03720000
037300     EVALUATE TRUE                                                03730000
037400         WHEN SQLCODE = ZERO                                      03740000
037500             ADD 1                    TO WS-FETCH-COUNT           03750000
037600         WHEN SQLCODE = +100                                      03760000
037700             SET WS-END-CSR           TO TRUE                     03770000
037800         WHEN SQLWARN0 NOT = SPACE                                03780000
037900         WHEN SQLCODE  NOT = ZERO                                 03790000
038000             MOVE '7010-FETCH-TRIP-CSR' TO WS-ABEND-PARAGRAPH     03800000
038100             MOVE 'FETCH CURSOR'        TO WS-ABEND-OPERATION     03810000
038200             MOVE 'TVHTRIP'             TO WS-ABEND-STRUCTURE-1   03820000
038300             PERFORM 9900-DB2-ABEND                               03830000
038400     END-EVALUATE.                                                03840000
038500                                                                  03850000
038600 7020-CLOSE-TRIP-CSR.                                             03860000
038700     EXEC SQL                                                     03870000
038800         CLOSE IBF-TR-SQL-2                                       03880000
038900     END-EXEC.                                                    03890000
039000                                                                  03900000
039100     EVALUATE TRUE                                                03910000
039200         WHEN SQLCODE = ZERO                                      03920000
039300             CONTINUE                                             03930000
039400         WHEN SQLWARN0 NOT = SPACE                                03940000
039500         WHEN SQLCODE  NOT = ZERO                                 03950000
039600             MOVE '7020-CLOSE-TRIP-CSR' TO WS-ABEND-PARAGRAPH     03960000
039700             MOVE 'CLOSE CURSOR'        TO WS-ABEND-OPERATION     03970000
039800             MOVE 'TVHTRIP'             TO WS-ABEND-STRUCTURE-1   03980000
039900             PERFORM 9900-DB2-ABEND                               03990000
040000     END-EVALUATE.                                                04000000
040100                                                                  04010000
040200 8100-WRITE-OUTPUT-REC.                                           04020000
040300* JAK 7/2011 - REQUEST #3253 - FIX BUG WITH IMPORT REPLEN         04030000
040400* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  04040000
040500*    IF PC068-REPLEN-CARTON-CNT > ZERO                            04050000
040600*     WRITE TRIP-EXTRACT-RECORD2 FROM                             04060000
040700*      PC068-RECORD-LAYOUT                                        04070000
040800*     ADD 1 TO WS-WRITE-COUNT2                                    04080000
040900*    ELSE                                                         04090000
041000*     MOVE SPACES TO PC068-STORE-ZONE                             04100000
041100*     WRITE TRIP-EXTRACT-RECORD  FROM                             04110000
041200*      PC068-RECORD-LAYOUT                                        04120000
041300*     ADD 1 TO WS-WRITE-COUNT                                     04130000
041400*    END-IF.                                                      04140000
041500* RMK 6/2010 - END                                                04150000
041600                                                                  04160000
041700     WRITE TRIP-EXTRACT-RECORD     FROM PC068-RECORD-LAYOUT.      04170000
041800     ADD 1                         TO WS-WRITE-COUNT.             04180000
041900                                                                  04190000
042000     IF WS-SHIPT-UNT-ID-CNT > ZERO                                04200000
042100        MOVE WS-SHIPT-UNT-ID-CNT   TO PC068-REPLEN-CARTON-CNT     04210000
042200        MOVE WS-SHIPT-UNT-ID-CNT   TO PC068-TOT-CTN-CNT           04220000
042300        MOVE 'REPLEN'              TO PC068-STORE-ZONE            04230000
042400        WRITE TRIP-EXTRACT-RECORD2 FROM PC068-RECORD-LAYOUT       04240000
042500        ADD 1                      TO WS-WRITE-COUNT2             04250000
042600     END-IF.                                                      04260000
042700* JAK 7/2011 - END                                                04270000
042800                                                                  04280000
042900 9000-TERMINATE.                                                  04290000
043000                                                                  04300000
043100     PERFORM 7020-CLOSE-TRIP-CSR.                                 04310000
043200                                                                  04320000
043300     CLOSE TRIP-EXTRACT-FILE.                                     04330000
043400* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  04340000
043500     CLOSE TRIP-EXTRACT-FILE2.                                    04350000
043600                                                                  04360000
043700     IF  WS-WRITE-COUNT = 0 AND WS-WRITE-COUNT2 = 0               04370000
043800         MOVE 1 TO RETURN-CODE                                    04380000
043900     END-IF.                                                      04390000
044000* RMK 6/2010 - END                                                04400000
044100                                                                  04410000
044200     DISPLAY '************************'.                          04420000
044300     DISPLAY '******* PCKUT086 *******'.                          04430000
044400     DISPLAY '************************'.                          04440000
044500     DISPLAY SPACES                                               04450000
044600                                                                  04460000
044700     PERFORM                                                      04470000
044800         VARYING WS-DC-IDX                                        04480000
044900         FROM 2 BY 1                                              04490000
045000         UNTIL (WS-DC-IDX > WS-DC-COUNT + 1)                      04500000
045100           MOVE WS-DC-COUNTER (WS-DC-IDX) TO WS-DISPLAY-COUNT     04510000
045200           DISPLAY 'TOTAL RECORDS FETCHED FOR DC '                04520000
045300                   WS-DC-NBR (WS-DC-IDX) ' = ' WS-DISPLAY-COUNT   04530000
045400           DISPLAY 'TOTAL RECORDS WRITTEN FOR DC '                04540000
045500                   WS-DC-NBR (WS-DC-IDX) ' = ' WS-DISPLAY-COUNT   04550000
045600     END-PERFORM.                                                 04560000
045700                                                                  04570000
045800     MOVE WS-FETCH-COUNT        TO WS-DISPLAY-COUNT.              04580000
045900     DISPLAY 'TOTAL RECORDS FETCHED = ' WS-DISPLAY-COUNT.         04590000
046000                                                                  04600000
046100     MOVE WS-WRITE-COUNT         TO WS-DISPLAY-COUNT.             04610000
046200* RMK 6/2010 - REQUEST #3032B - ADD PROCESS FILE                  04620000
046300     DISPLAY 'TOTAL RECORDS WRITTEN TO FILE 1 = '                 04630000
046400                                               WS-DISPLAY-COUNT.  04640000
046500     MOVE WS-WRITE-COUNT2        TO WS-DISPLAY-COUNT.             04650000
046600     DISPLAY 'TOTAL RECORDS WRITTEN TO FILE 2 = '                 04660000
046700                                               WS-DISPLAY-COUNT.  04670000
046800* RMK 6/2010 - END                                                04680000
046900                                                                  04690000
047000     DISPLAY SPACES                                               04700000
047100     DISPLAY '************************'.                          04710000
047200                                                                  04720000
047300                                                                  04730000
047400 9900-DB2-ABEND.                                                  04740000
047500                                                                  04750000
047600     MOVE SQLCODE TO WS-SQLCODE.                                  04760000
047700     DISPLAY '*** DB2 ERROR '.                                    04770000
047800     DISPLAY '*** SQLCODE   = ' WS-SQLCODE.                       04780000
047900     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 04790000
048000     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               04800000
048100     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               04810000
048200     DISPLAY '*** MESSAGE   = ' WS-DB2-OPERATION-MESSAGE-1.       04820000
048300     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-2.       04830000
048400     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-3.       04840000
048500     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             04850000
048600                                                                  04860000
048700     IF WS-ABEND-STRUCTURE-2 > SPACES                             04870000
048800         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2          04880000
048900     END-IF.                                                      04890000
049000                                                                  04900000
049100     COPY DPPD004.                                                04910000
049200                                                                  04920000
049300     MOVE +4013                  TO WS-ABEND-CODE.                04930000
049400     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         04940000
