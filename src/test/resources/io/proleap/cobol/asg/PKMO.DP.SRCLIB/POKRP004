000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKRP004.                                         00020000
000300 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN.  01/94.                                            00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800* THIS PROGRAM WILL GENERATE SHIPPING INSTRUCTIONS FOR A PO.      00080000
000900******************************************************************00090000
001000* DATE     WHO      DESCRIPTION                                 * 00100000
001100* 062399   TKMA340  WR6181 ADD LOGIC FOR BLUE SPRINGS DC 840.   * 00110000
001200***************************************************************** 00120000
001300* DATE     WHO      DESCRIPTION                                 * 00130000
001400* 072699   TKMA340  PITS335756 CORRECT LOOP PROBLEM IN PARAGRAPH* 00140000
001500*                   2354-PROCESS-SPLIT-CSR BY REPLACING NESTED  * 00150000
001600*                   IF STATEMENTS WITH EVALUATE/WHEN STATEMENTS.* 00160000
001700***************************************************************** 00170000
001800* DATE     WHO      DESCRIPTION                                 * 00180000
001900* 101399   TKMA537  ADDED DC # 845 TO 2354-PROCESS-SPLIT-CSR    * 00190000
002000***************************************************************** 00200000
002100* DATE  02/18/00                                                 *00210000
002200*   WR20853 INCREASE 300 STORE LIMIT TO 500, 999 WAS TOO LARGE   *00220000
002300*           FOR PROGRAM MEMORY.                                  *00230000
002400******************************************************************00240000
002500* DATE     WHO      DESCRIPTION                                  *00250000
002600* 080100   TKMA609  REMOVED RETRY LOGIC FROM SQL                 *00260000
002700******************************************************************00270000
002500* DATE     WHO      DESCRIPTION                                  *00280000
002600* 070102   TKMA700  INCREASED STORE LIMIT FROM 500 TO 1000       *00290000
002700******************************************************************00300000
002500* DATE     WHO      DESCRIPTION                                  *00310000
002600* 080702   TKMA609  ADDED DC 855 TO 2354-PROCESS-SPLIT-CSR       *00320000
002700******************************************************************00330000
W24803* 05/09/2003  RAMA KRISHNA, IGSI                      WR 24803   *00340000
W24803*   NON-INTELLIGENT SKU PROJECT : CHANGES BEING INCORPORATED     *00350000
W24803*   INTO THIS PROGRAM                                            *00360000
W24803*                                                                *00370000
003300******************************************************************00380000
003300* DATE     WHO      DESCRIPTION                                  *00390000
003300* 021004   TKMA609  ADDED STORE DISTRO QUANTITY GREATER THAN ZERO*00400000
003300* CHECK TO ALLOC CURSOR AND ALLOC CURSOR 2 AND ALLOCATIONS COUNT.*00410000
003300* ALSO ADDED CURRENT SPLIT QUANTITY GREATER THAN ZERO CHECK TO   *00420000
003300* TALLPLN CURSOR.                                                *00430000
003300******************************************************************00440000
EFC2  ***************************************************************** 00450000
||    * DATE  03/22/10                                                 *00460000
||    *   WR38216 ADDDED DC 806 TO 2354-PROCESS-SPLIT-CSR              *00470000
||    *           TO HANDLE THE NEW EFC LOCATION                       *00480000
EFC2  ******************************************************************00490000
MLOF  * DATE  07/20/11                                                 *00500000
MLOF  *   WR38972 REMOVED DC HARD CODING                               *00510000
MLOF  ******************************************************************00520000
P15284* DATE  10/07/11                                                  00530000
P15284*   P15284  CHANGED QUERY TO FETCH THE "DC" NUMBERS WHICH WAS NOT 00540000
P15284*   P15284  HANDLED CORRECTLY.                                    00550000
P15284******************************************************************00560000
C98147* 11/04/2014 - LINDA FRIESS   CHG0098147                          00570012
C98147*   EXPANDED PO NUMBER IN REPORT TO 8 DIGITS.                     00580012
C98147***************************************************************** 00590012
C98147* 03/2021    - JEAN KURK                                          00591014
C98147*   REMOVED TABLE TSTVNDC                                         00592014
C98147***************************************************************** 00593014
002800 ENVIRONMENT DIVISION.                                            00600008
002900 CONFIGURATION SECTION.                                           00610000
003000 SOURCE-COMPUTER. IBM-3090.                                       00620000
003100 OBJECT-COMPUTER. IBM-3090.                                       00630000
003200 INPUT-OUTPUT SECTION.                                            00640000
003300 FILE-CONTROL.                                                    00650000
003400                                                                  00660000
003500     SELECT INPUT-FILE                                            00670000
003600         ASSIGN TO INP01.                                         00680000
003700     SELECT POSIRPT-FILE                                          00690000
003800         ASSIGN TO RPT01.                                         00700000
003900                                                                  00710000
004000******************************************************************00720000
004100 DATA DIVISION.                                                   00730000
004200******************************************************************00740000
004300 FILE SECTION.                                                    00750000
004400                                                                  00760000
004500 FD  INPUT-FILE                                                   00770000
004600     RECORDING MODE IS F                                          00780000
004700     LABEL RECORDS ARE STANDARD                                   00790000
004800     RECORD CONTAINS 80 CHARACTERS                                00800000
004900     BLOCK CONTAINS 0 RECORDS.                                    00810000
005000 01  INPUT-RECORD                     PIC  X(80).                 00820000
005100                                                                  00830000
005200 FD  POSIRPT-FILE                                                 00840000
005300     RECORDING MODE F                                             00850000
005400     BLOCK CONTAINS 0 RECORDS                                     00860000
005500     RECORD CONTAINS 150 CHARACTERS                               00870000
005600     LABEL RECORDS ARE OMITTED                                    00880000
005700     DATA RECORD IS POSIRPT-RECORD.                               00890000
005800 01  POSIRPT-RECORD                   PIC  X(150).                00900000
005900                                                                  00910000
006000 WORKING-STORAGE SECTION.                                         00920000
006100                                                                  00930000
006200 01  IR-INPUT-RECORD.                                             00940000
006300     05  IR-PO-NBR                    PIC S9(09) COMP.            00950000
006400     05  IR-RPT-TYPE-BY               PIC  X(02).                 00960000
006500     05  IR-RPT-TYPE-VN               PIC  X(02).                 00970000
006600     05  FILLER                       PIC  X(72).                 00980000
006700                                                                  00990000
006800 01  SD-SYSTEM-DATE.                                              01000000
006900     05  SD-SYSTEM-YY                 PIC  9(02) VALUE ZEROES.    01010000
007000     05  SD-SYSTEM-MM                 PIC  9(02) VALUE ZEROES.    01020000
007100     05  SD-SYSTEM-DD                 PIC  9(02) VALUE ZEROES.    01030000
007200                                                                  01040000
007300 01  ST-SYSTEM-TIME.                                              01050000
007400     05  ST-SYSTEM-HH                 PIC  9(02) VALUE ZEROES.    01060000
007500     05  ST-SYSTEM-MM                 PIC  9(02) VALUE ZEROES.    01070000
007600     05  ST-SYSTEM-SS                 PIC  9(02) VALUE ZEROES.    01080000
007700     05  FILLER                       PIC  9(02) VALUE ZEROES.    01090000
007800                                                                  01100000
007900 01  PS-PROGRAM-SWITCHES.                                         01110000
008000     05  PS-ADD-SUB-SW                PIC  X(01) VALUE ' '.       01120000
008100         88  PS-ADD                              VALUE '1'.       01130000
008200         88  PS-SUBTR                            VALUE '2'.       01140000
008300     05  PS-EOF-INPUT-FILE-SW         PIC  X(01) VALUE 'N'.       01150000
008400         88  PS-EOF-INPUT-FILE                   VALUE 'Y'.       01160000
008500     05  PS-EOF-SHIP-CSR-SW           PIC  X(01) VALUE 'N'.       01170000
008600         88  PS-EOF-SHIP-CSR                     VALUE 'Y'.       01180000
008700         88  PS-NOT-EOF-SHIP-CSR                 VALUE 'N'.       01190000
008800*    05  PS-EOF-UPC-CSR-SW            PIC  X(01) VALUE 'N'.       01200016
008900*        88  PS-EOF-UPC-CSR                      VALUE 'Y'.       01210016
009000*        88  PS-NOT-EOF-UPC-CSR                  VALUE 'N'.       01220016
009100     05  PS-EOF-INST-CSR-SW           PIC  X(01) VALUE 'N'.       01230000
009200         88  PS-EOF-INST-CSR                     VALUE 'Y'.       01240000
009300         88  PS-NOT-EOF-INST-CSR                 VALUE 'N'.       01250000
009400     05  PS-EOF-PO-LINE-CSR-SW        PIC  X(01) VALUE 'N'.       01260000
009500         88  PS-EOF-PO-LINE-CSR                  VALUE 'Y'.       01270000
009600         88  PS-NOT-EOF-PO-LINE-CSR              VALUE 'N'.       01280000
009700     05  PS-EOF-TALLPLN-CSR-SW        PIC  X(01) VALUE 'N'.       01290000
009800         88  PS-EOF-TALLPLN-CSR                  VALUE 'Y'.       01300000
009900         88  PS-NOT-EOF-TALLPLN-CSR              VALUE 'N'.       01310000
010000     05  PS-EOF-ALLOC-CSR-SW          PIC  X(01) VALUE 'N'.       01320000
010100         88  PS-EOF-ALLOC-CSR                    VALUE 'Y'.       01330000
010200         88  PS-NOT-EOF-ALLOC-CSR                VALUE 'N'.       01340000
010300     05  PS-EOF-ALLOC2-CSR-SW         PIC  X(01) VALUE 'N'.       01350000
010400         88  PS-EOF-ALLOC2-CSR                   VALUE 'Y'.       01360000
010500         88  PS-NOT-EOF-ALLOC2-CSR               VALUE 'N'.       01370000
010600     05  PS-EOF-SPLIT-CSR-SW          PIC  X(01) VALUE 'N'.       01380000
010700         88  PS-EOF-SPLIT-CSR                    VALUE 'Y'.       01390000
010800         88  PS-NOT-EOF-SPLIT-CSR                VALUE 'N'.       01400000
010900     05  PS-PACK-BY-STORE-SW          PIC  X(01) VALUE 'N'.       01410000
011000         88  PS-PACK-BY-STORE                    VALUE 'Y'.       01420000
011100         88  PS-NO-PACK-BY-STORE                 VALUE 'N'.       01430000
011200                                                                  01440000
011300 01  PC-PROGRAM-CONSTANTS.                                        01450000
011400     05  PC-INIT-DATE                 PIC  X(10) VALUE            01460000
011500                                                     '0001-01-01'.01470000
011600     05  PC-MIN-UPC                   PIC S9(15)V VALUE           01480000
011700                                        +000400000000000 COMP-3.  01490000
011800     05  PC-MAX-UPC                   PIC S9(15)V VALUE           01500000
011900                                         000409999999999 COMP-3.  01510000
012000     05  PC-STORE-QTY                 PIC  X(35) VALUE            01520000
012100         ' --STORE--  ---SIZE---  QUANTITY   '.                   01530000
012200     05  PC-STORE-QTY-BULK            PIC  X(35) VALUE            01540000
012300         '            ---SIZE---  QUANTITY   '.                   01550000
012400     05  PC-STORE-QTY-OLD             PIC  X(21) VALUE            01560000
012500         ' --STORE-- QUANTITY  '.                                 01570000
012600     05  PC-DPKUT410                  PIC  X(08) VALUE 'DPKUT410'.01580000
012700                                                                  01590000
012800                                                                  01600000
012900 01  PV-PROGRAM-VARIABLES.                                        01610000
013000     05  PV-END                       PIC S9(06) VALUE +0         01620000
013100                                                 COMP-3.          01630000
013200     05  PV-NBR-TIMES                 PIC S9(09) COMP-3.          01640000
013300     05  PV-NBR-WRITES                PIC S9(06) VALUE +0         01650000
013400                                                 COMP-3.          01660000
013500     05  PV-STR-NBR                   PIC S9(4) COMP.             01670000
013700     05  PV-DC-NBR                    PIC S9(4) COMP.             01680000
013800     05  PV-SUB                       PIC S9(04) COMP VALUE +0.   01690000
013900     05  PV-SUB1                      PIC S9(04) COMP VALUE +0.   01700000
014000     05  PV-SUB2                      PIC S9(04) COMP VALUE +0.   01710000
014100     05  PV-SUB3                      PIC S9(04) COMP VALUE +0.   01720000
014200     05  PV-SUB4                      PIC S9(04) COMP VALUE +0.   01730000
014300     05  PV-SUB5                      PIC S9(04) COMP VALUE +0.   01740000
014400     05  PV-NBR-WRITE                 PIC S9(04) COMP VALUE +0.   01750000
014500     05  PV-TIMES                     PIC S9(06) VALUE +0         01760000
014600                                                 COMP-3.          01770000
014700     05  PV-TIMES2                    PIC S9(06) VALUE +0         01780000
014800                                                 COMP-3.          01790000
014900     05  PV-TIMES3                    PIC S9(06) VALUE +0         01800000
015000                                                 COMP-3.          01810000
015100     05  PV-TIMES4                    PIC S9(06) VALUE +0         01820000
015200                                                 COMP-3.          01830000
015300     05  PV-TIMES-THROUGH             PIC S9(06) VALUE +0         01840000
015400                                                 COMP.            01850000
015500     05  PV-START                     PIC S9(06) VALUE +0         01860000
015600                                                 COMP-3.          01870000
015700     05  PV-DIFF                      PIC S9(06) VALUE +0         01880000
015800                                                 COMP SYNC.       01890000
015900     05  PV-ABS-DIFF                  PIC 9(06).                  01900000
016000     05  PV-QTY                       PIC S9(09) VALUE +0         01910000
016100                                                 COMP SYNC.       01920000
016200     05  PV-UPC-PCT                   PIC S9(9)V9(9)              01930000
016300                                                 VALUE +0 COMP.   01940000
016400     05  PV-UPC-TOTAL-QTY             PIC S9(09) VALUE +0         01950000
016500                                                 COMP-3.          01960000
016600     05  PV-UPC-QTY-TEMP              PIC S9(09) VALUE +0         01970000
016700                                                 COMP-3.          01980000
016800     05  PV-NBR-STORES                PIC S9(06) VALUE +0         01990000
016900                                                 COMP-3.          02000000
017000     05  PV-NBR-STORES-PLAN           PIC S9(06) VALUE +0         02010000
017100                                                 COMP-3.          02020000
017200     05  PV-STR-ADJ                   PIC S9(06) VALUE +0         02030000
017300                                                 COMP-3.          02040000
017400     05  IR-PO-NBR2                   PIC S9(09) VALUE +0 COMP.   02050000
017500     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    02060000
017600     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         02070000
017700                                                 COMP.            02080000
017800     05  PV-NULL-IND                  PIC S9(04) VALUE +0         02090000
017900                                                 COMP.            02100000
018000     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         02110000
018100                                                 COMP-3.          02120000
018200     05  PV-PAGE-CNT                  PIC S9(07) VALUE  0         02130000
018300                                                 COMP-3.          02140000
018400     05  PV-QUOTIENT                  PIC S9(04) VALUE +0         02150000
018500                                                 COMP.            02160000
018600     05  PV-REMAINDER                 PIC S9(04) VALUE +0         02170000
018700                                                 COMP.            02180000
018800     05  PV-LINE-CNT                  PIC S9(03) VALUE +0.        02190000
018900     05  PV-TEMP-LINE-CNT             PIC S9(03) VALUE +0.        02200000
019000     05  PV-SHIP-NBR                  PIC S9(03) VALUE +0.        02210000
019100     05  PV-SHIP-NBR-DISP             PIC 9(03).                  02220000
019200     05  PV-DATE-BREAK.                                           02230000
019300         10  PV-DB-CC                 PIC  X(02).                 02240000
019400         10  PV-DB-YY                 PIC  X(02).                 02250000
019500         10  FILLER                   PIC  X(01).                 02260000
019600         10  PV-DB-MM                 PIC  X(02).                 02270000
019700         10  FILLER                   PIC  X(01).                 02280000
019800         10  PV-DB-DD                 PIC  X(02).                 02290000
019900     05  PV-DATE-BREAK-SLASH.                                     02300000
020000         10  PV-DBS-MM                PIC  X(02).                 02310000
020100         10  FILLER                   PIC  X(01) VALUE '/'.       02320000
020200         10  PV-DBS-DD                PIC  X(02).                 02330000
020300         10  FILLER                   PIC  X(01) VALUE '/'.       02340000
020400         10  PV-DBS-YY                PIC  X(02).                 02350000
020500     05  PV-EDIT-ZIP-CODE             PIC  X(10).                 02360000
020600     05  PV-EDIT-ZIP-NO-DASH REDEFINES PV-EDIT-ZIP-CODE.          02370000
020700         10  PV-EZND-1-5              PIC  X(05).                 02380000
020800         10  PV-EZND-6-9              PIC  X(04).                 02390000
020900         10  FILLER                   PIC  X(01).                 02400000
021000     05  PV-EDIT-ZIP-DASH REDEFINES PV-EDIT-ZIP-CODE.             02410000
021100         10  PV-EZD-1-5               PIC  X(05).                 02420000
021200         10  PV-EZD-DASH              PIC  X(01).                 02430000
               10  PV-EZD-6-9               PIC  X(04).                 02440000
           05  PV-ZIP-CODE-DISPLAY.                                     02450000
               10  PV-ZCD-1-5               PIC  X(05).                 02460000
               10  FILLER                   PIC  X(01) VALUE '-'.       02470000
               10  PV-ZCD-6-9               PIC  X(04).                 02480000
021300     05  PV-ALLOC-CNT                 PIC S9(09) COMP-3.          02490000
021400*    05  PV-UPC-DTL-CNT               PIC S9(09) COMP-3.          02500017
021400     05  PV-UPC-DTL-CNT               PIC S9(09) COMP-3 VALUE +0. 02501017
021500     05  PV-CITY                      PIC  X(15).                 02510000
021600     05  PV-STATE-PROV                PIC  X(30).                 02520000
021700     05  PV-COUNTRY                   PIC  X(30).                 02530000
021800                                                                  02540000
W24803     05  PV-NULL-INDICATOR-VARIABLES.                             02550000
W24803         10 PV-MAJ-CL-NBR-IND         PIC S9(04) COMP VALUE +0.   02560000
W24803         10 PV-SUB-CL-NBR-IND         PIC S9(04) COMP VALUE +0.   02570000
W24803         10 PV-SKU-NBR-IND            PIC S9(04) COMP VALUE +0.   02580000
W24803         10 PV-VS-NBR-IND             PIC S9(04) COMP VALUE +0.   02590000
W24803         10 PV-SKU-DESC-IND           PIC S9(04) COMP VALUE +0.   02600000
W24803         10 PV-CSTM-CLOR-DESC-IND     PIC S9(04) COMP VALUE +0.   02610000
W24803         10 PV-SIZE-DESC-IND          PIC S9(04) COMP VALUE +0.   02620000
W24803     05 PV-TEMP-SKU.                                              02630000
W24803         10 PV-TEMP-DEPT              PIC 9(03) VALUE ZEROES.     02640000
W24803         10 PV-TEMP-CLASS             PIC 9(02) VALUE ZEROES.     02650000
W24803         10 PV-TEMP-SEQ               PIC 9(03) VALUE ZEROES.     02660000
W24803     05 PV-TEMP-MAJ-CL.                                           02670000
W24803         10 PV-TEMP-MAJ-CL-1          PIC 9(01) VALUE 0.          02680000
W24803         10 FILLER                    PIC 9(01) VALUE 0.          02690000
021900* THIS TABLE WILL HOLD UP TO 1000 STORES                          02700000
022000* BUMP OCCURS UP IF KOHL'S IS OPERATING > 1000 STORES             02710000
022100* THIS TABLE HOLDS ALL THE STORES FOR A SKU ON AN ORDER           02720000
022200* IT IS CLEARED OUT BETWEEN LINE NUMBERS                          02730000
022300     05  PV-SAVE-TABLE.                                           02740000
022400         10  PV-SAVE-OCC                OCCURS 2000 TIMES         02750000
022500                                        INDEXED BY PV-STR-IDX.    02760000
022600             15  PV-SAVE-STR-NBR         PIC 9(04).               02770000
022700             15  PV-SAVE-STR-NAME        PIC X(05).               02780000
022800             15  PV-SAVE-STR-QTY         PIC 9(06).               02790000
022900             15  PV-SAVE-STR-SUBTOTAL    PIC S9(09) COMP-3.       02800000
023000*            15  PV-UPC-OCC             OCCURS 50 TIMES           02810018
023100*                                       INDEXED BY PV-UPC-IDX.    02820018
023200*                20  PV-SAVE-UPC-DESC        PIC X(10).           02830016
023300*                20  PV-SAVE-UPC-QTY-STR     PIC 9(06).           02840018
023400*                20  PV-SAVE-POUPC-QTY       PIC 9(06).           02850016
023500*                20  PV-SAVE-UPC-SUBTOTAL    PIC S9(09) COMP-3.   02860018
023600     05  PV-DC-TABLE.                                             02870000
023700         10  PV-DC-OCC                  OCCURS 2000 TIMES         02880000
023800                                        INDEXED BY PV-DC-STR-IDX. 02890000
023900             15  PV-DC-STR-NBR           PIC 9(04).               02900000
024000             15  PV-DC-STR-NAME          PIC X(05).               02910000
024100             15  PV-DC-STR-QTY           PIC 9(06).               02920000
024200             15  PV-DC-STR-SUBTOTAL      PIC S9(09) COMP-3.       02930000
024300*            15  PV-UPC-OCC             OCCURS 50 TIMES           02940021
024400*                                       INDEXED BY PV-DC-UPC-IDX. 02950021
024500*                20  PV-DC-UPC-DESC          PIC X(10).           02960021
024600*                20  PV-DC-UPC-QTY-STR       PIC 9(06).           02970021
024700*                20  PV-DC-POUPC-QTY         PIC 9(06).           02980021
024800*                20  PV-DC-UPC-SUBTOTAL      PIC S9(09) COMP-3.   02990021
024900                                                                  03000000
025000******************************************************************03010000
025100*  COMMUNICATIONS AREA2 FOR DB2                                   03020000
025200******************************************************************03030000
025300     COPY SQLCA2.                                                 03040000
025400                                                                  03050000
025500******************************************************************03060000
025600*  WORKING STORAGE AREA FOR NAME REFORMAT DPPD024                 03070000
025700******************************************************************03080000
025800     COPY DPWS024.                                                03090000
025900                                                                  03100000
026000******************************************************************03110000
026100*  WORKING STORAGE AREA FOR PAYMENT TERMS                         03120000
026200******************************************************************03130000
026300     COPY POWS020.                                                03140000
026400                                                                  03150000
026500******************************************************************03160000
026600*  WORKING STORAGE AREA FOR COUNTRY AND STATE RETRIEVAL           03170000
026700******************************************************************03180000
026800     COPY DPWS410.                                                03190000
026900                                                                  03200000
027000******************************************************************03210000
027100*  PURCHASE ORDER REPORT PRINT LINES                              03220000
027200******************************************************************03230000
027300 01  HEADER-LINE1.                                                03240000
027400     05  FILLER                       PIC  X(11) VALUE            03250000
027500         'PO NUMBER: '.                                           03260000
C98147     05  HL1-PO-NBR                   PIC  ZZZZZZZZ.              03270012
C98147     05  FILLER                       PIC  X(03) VALUE SPACES.    03280012
027800     05  FILLER                       PIC  X(12) VALUE            03290000
027900         'ORDER DATE: '.                                          03300000
028000     05  HL1-ORD-DATE                 PIC  X(08).                 03310000
028100     05  FILLER                       PIC  X(09) VALUE SPACES.    03320000
028200     05  FILLER                       PIC  X(08) VALUE 'K O H L '.03330000
028300     05  FILLER                       PIC  X(01) VALUE QUOTE.     03340000
028400     05  FILLER                       PIC  X(38) VALUE            03350000
028500         ' S   D E P A R T M E N T   S T O R E S'.                03360000
028600     05  FILLER                       PIC  X(18) VALUE SPACES.    03370000
028700     05  FILLER                       PIC  X(06) VALUE 'DATE: '.  03380000
028800     05  HL1-RUN-MONTH                PIC  X(02).                 03390000
028900     05  FILLER                       PIC  X(01) VALUE '/'.       03400000
029000     05  HL1-RUN-DAY                  PIC  X(02).                 03410000
029100     05  FILLER                       PIC  X(01) VALUE '/'.       03420000
029200     05  HL1-RUN-YEAR                 PIC  X(02).                 03430000
029300     05  FILLER                       PIC  X(06) VALUE SPACES.    03440000
029400     05  FILLER                       PIC  X(06) VALUE 'TIME: '.  03450000
029500     05  HL1-RUN-HOUR                 PIC  X(02).                 03460000
029600     05  FILLER                       PIC  X(01) VALUE ':'.       03470000
029700     05  HL1-RUN-MINUTE               PIC  X(02).                 03480000
029800     05  FILLER                       PIC  X(01) VALUE ':'.       03490000
029900     05  HL1-RUN-SECOND               PIC  X(02).                 03500000
030000                                                                  03510000
030100 01  HEADER-LINE2.                                                03520000
030200     05  FILLER                       PIC  X(11) VALUE            03530000
030300         'DEPT.....: '.                                           03540000
030400     05  HL2-DEPT-NBR                 PIC  X(03).                 03550000
030500     05  FILLER                       PIC  X(02) VALUE SPACES.    03560000
030600     05  HL2-DEPT-NAME                PIC  X(25).                 03570000
030700     05  FILLER                       PIC  X(13) VALUE SPACES.    03580000
030800     05  FILLER                       PIC  X(41) VALUE            03590000
030900         'S H I P P I N G   I N S T R U C T I O N S'.             03600000
031000     05  FILLER                       PIC  X(41) VALUE SPACES.    03610000
031100     05  FILLER                       PIC  X(06) VALUE 'PAGE: '.  03620000
031200     05  HL2-PAGE                     PIC  ZZZZ,ZZZ.              03630000
031300                                                                  03640000
031400 01  HEADER-LINE3.                                                03650000
031500     05  FILLER                       PIC  X(69) VALUE SPACES.    03660000
031600     05  HL3-VERSION                  PIC  X(12).                 03670000
031700     05  FILLER                       PIC  X(69) VALUE SPACES.    03680000
031800                                                                  03690000
031900 01  HEADER-LINE4.                                                03700000
032000     05  FILLER                       PIC  X(20) VALUE            03710000
032100         ' ** S H I P M E N T '.                                  03720000
032200     05  HL4-SHIP-NBR                 PIC  ZZZ.                   03730000
032300     05  FILLER                       PIC  X(06) VALUE '  O F '.  03740000
032400     05  HL4-NBR-SHIP                 PIC  ZZZ.                   03750000
032500     05  FILLER                       PIC  X(03) VALUE ' **'.     03760000
032600     05  FILLER                       PIC  X(17) VALUE SPACES.    03770000
032700     05  FILLER                       PIC  X(10) VALUE            03780000
032800         ' VENDOR.: '.                                            03790000
032900     05  HL4-VEND-NAME                PIC  X(30).                 03800000
033000     05  FILLER                       PIC  X(12) VALUE SPACES.    03810000
033100     05  FILLER                       PIC  X(17) VALUE            03820000
033200         'TOTAL UNITS....: '.                                     03830000
033300     05  HL4-UNITS                    PIC  Z,ZZZ,ZZZ.             03840000
033400     05  FILLER                       PIC  X(20) VALUE SPACES.    03850000
033500                                                                  03860000
033600 01  HEADER-LINE5.                                                03870000
033700     05  FILLER                       PIC  X(10) VALUE            03880000
033800         ' SHIP TO: '.                                            03890000
033900     05  HL5-SHIP-TO-NAME             PIC  X(40).                 03900000
034000     05  FILLER                       PIC  X(12) VALUE SPACES.    03910000
034100     05  HL5-VEND-ADDR-1              PIC  X(40).                 03920000
034200     05  FILLER                       PIC  X(02) VALUE SPACES.    03930000
034300     05  FILLER                       PIC  X(21) VALUE            03940000
034400         'TOTAL LINES....:     '.                                 03950000
034500     05  HL5-LINES                    PIC  Z,ZZZ.                 03960000
034600     05  FILLER                       PIC  X(20) VALUE SPACES.    03970000
034700                                                                  03980000
034800 01  HEADER-LINE6.                                                03990000
034900     05  FILLER                       PIC  X(10) VALUE SPACES.    04000000
035000     05  HL6-SHIP-TO-ADDR-1           PIC  X(40).                 04010000
035100     05  FILLER                       PIC  X(12) VALUE SPACES.    04020000
035200     05  HL6-VEND-ADDR-2              PIC  X(40).                 04030000
035300     05  FILLER                       PIC  X(02) VALUE SPACES.    04040000
035400     05  FILLER                       PIC  X(21) VALUE            04050000
035500         'TOTAL SKUS.....:     '.                                 04060000
035600     05  HL6-SKUS                     PIC  Z,ZZZ.                 04070000
035700     05  FILLER                       PIC  X(20) VALUE SPACES.    04080000
035800                                                                  04090000
035900 01  HEADER-LINE7.                                                04100000
036000     05  FILLER                       PIC  X(10) VALUE SPACES.    04110000
036100     05  HL7-SHIP-TO-ADDR-2           PIC  X(40).                 04120000
036200     05  FILLER                       PIC  X(12) VALUE SPACES.    04130000
036300     05  HL7-VEND-ADDR-3              PIC  X(40).                 04140000
036400     05  FILLER                       PIC  X(48) VALUE SPACES.    04150000
036500                                                                  04160000
036600 01  HEADER-LINE8-A.                                              04170000
036700     05  FILLER                       PIC  X(10) VALUE SPACES.    04180000
036800     05  HL8-SHIP-TO-ADDR-3A          PIC  X(40).                 04190000
036900     05  FILLER                       PIC  X(02) VALUE SPACES.    04200000
037000     05  FILLER                       PIC  X(10) VALUE            04210000
037100         ' CONTACT: '.                                            04220000
037200     05  HL8-CONTACT                  PIC  X(40).                 04230000
037300     05  FILLER                       PIC  X(02) VALUE SPACES.    04240000
037400     05  FILLER                       PIC  X(26) VALUE            04250000
037500         'FOB POINT...............: '.                            04260000
037600     05  HL8-FOB-PT                   PIC  X(20).                 04270000
037700                                                                  04280000
037800 01  HEADER-LINE8-B.                                              04290000
037900     05  FILLER                       PIC  X(10) VALUE SPACES.    04300000
038000     05  HL8-SHIP-TO-ADDR-3B          PIC  X(40).                 04310000
038100     05  FILLER                       PIC  X(100) VALUE SPACES.   04320000
038200                                                                  04330000
038300 01  HEADER-LINE9.                                                04340000
038400     05  FILLER                       PIC  X(52) VALUE SPACES.    04350000
038500     05  FILLER                       PIC  X(10) VALUE            04360000
038600         ' FAX #..: '.                                            04370000
038700     05  HL9-VEND-FAX                 PIC  X(24).                 04380000
038800     05  FILLER                       PIC  X(18) VALUE SPACES.    04390000
038900     05  FILLER                       PIC  X(26) VALUE            04400000
039000         'DO NOT SHIP BEFORE......: '.                            04410000
039100     05  HL9-DNSB-MONTH               PIC  X(02).                 04420000
039200     05  FILLER                       PIC  X(01) VALUE '/'.       04430000
039300     05  HL9-DNSB-DAY                 PIC  X(02).                 04440000
039400     05  FILLER                       PIC  X(01) VALUE '/'.       04450000
039500     05  HL9-DNSB-YEAR                PIC  X(02).                 04460000
039600     05  FILLER                       PIC  X(12) VALUE SPACES.    04470000
039700                                                                  04480000
039800 01  HEADER-LINE10.                                               04490000
039900     05  FILLER                       PIC  X(104) VALUE SPACES.   04500000
040000     05  FILLER                       PIC  X(26) VALUE            04510000
040100         'CANCEL IF NOT SHIPPED BY: '.                            04520000
040200     05  HL10-CNSB-MONTH              PIC  X(02).                 04530000
040300     05  FILLER                       PIC  X(01) VALUE '/'.       04540000
040400     05  HL10-CNSB-DAY                PIC  X(02).                 04550000
040500     05  FILLER                       PIC  X(01) VALUE '/'.       04560000
040600     05  HL10-CNSB-YEAR               PIC  X(02).                 04570000
040700     05  FILLER                       PIC  X(12) VALUE SPACES.    04580000
040800                                                                  04590000
040900 01  HEADER-LINE11.                                               04600000
041000     05  FILLER                       PIC  X(104) VALUE SPACES.   04610000
041100     05  FILLER                       PIC  X(26) VALUE            04620000
041200         'EARLIEST AD DATE........: '.                            04630000
041300     05  HL11-AD-DATE                 PIC  X(08).                 04640000
041400     05  FILLER                       PIC  X(12) VALUE SPACES.    04650000
041500                                                                  04660000
041600 01  HEADER-LINE12.                                               04670000
041700     05  FILLER                       PIC  X(104) VALUE SPACES.   04680000
041800     05  FILLER                       PIC  X(26) VALUE            04690000
041900         'PICTURED AD.............: '.                            04700000
042000     05  HL12-PIC-AD-IND              PIC  X(03).                 04710000
042100     05  FILLER                       PIC  X(17) VALUE SPACES.    04720000
042200                                                                  04730000
042300 01  INSTR-HEADER.                                                04740000
042400     05  FILLER                       PIC  X(13) VALUE            04750000
042500         'INSTRUCTIONS:'.                                         04760000
042600     05  FILLER                       PIC  X(137) VALUE SPACES.   04770000
042700                                                                  04780000
042800 01  INSTR-LINE.                                                  04790000
042900     05  INSTR-DESC                   PIC  X(150).                04800000
043000                                                                  04810000
043100 01  SKU-LINE-1.                                                  04820000
043200     05  SL1-SKU-NBR                  PIC  999.                   04830000
W24803     05  FILLER                       PIC  X(06) VALUE ' DEPT:'.  04840000
043400     05  SL1-DEPT                     PIC  X(03).                 04850000
043500     05  FILLER                       PIC  X(01) VALUE SPACES.    04860000
W24803     05  FILLER                       PIC  X(04) VALUE 'MCL:'.    04870000
W24803     05  SL1-MAJ-CLASS                PIC  9(02).                 04880000
043700     05  FILLER                       PIC  X(01) VALUE SPACES.    04890000
W24803     05  FILLER                       PIC  X(04) VALUE 'SCL:'.    04900000
W24803     05  SL1-CLASS                    PIC  9(02).                 04910000
W24803     05  FILLER                       PIC  X(01) VALUE SPACES.    04920000
W24803     05  FILLER                       PIC  X(04) VALUE 'SKU:'.    04930000
W24803     05  SL1-SKU                      PIC  9(08).                 04940000
043900     05  FILLER                       PIC  X(09) VALUE            04950000
044000         '  STYLE: '.                                             04960000
044100     05  SL1-STYLE                    PIC  X(20).                 04970000
044200     05  FILLER                       PIC  X(15) VALUE            04980000
044300         '  DESCRIPTION: '.                                       04990000
044400     05  SL1-DESC                     PIC  X(25).                 05000000
044500     05  FILLER                       PIC  X(12) VALUE            05010000
044600         '  QUANTITY: '.                                          05020000
044700     05  SL1-QTY                      PIC  ZZZ,ZZZ.               05030000
W24803     05  FILLER                       PIC  X(23) VALUE SPACES.    05040000
044900                                                                  05050000
045000 01  SKU-LINE-2.                                                  05060000
045100     05  FILLER                       PIC  X(10) VALUE            05070000
045200         '   COLOR: '.                                            05080000
045300     05  SL2-COLOR                    PIC  X(25).                 05090000
045400     05  FILLER                       PIC  X(07) VALUE ' SIZE: '. 05100000
045500     05  SL2-SIZE                     PIC  X(25).                 05110000
045600     05  FILLER                       PIC  X(83) VALUE SPACES.    05120000
045700                                                                  05130000
045800 01  DISTR-HEADER-1.                                              05140000
045900     05  FILLER                       PIC  X(22) VALUE            05150000
046000         '   STORE DISTRIBUTION:'.                                05160000
046100     05  FILLER                       PIC  X(128) VALUE SPACES.   05170000
046200                                                                  05180000
046300 01  DISTR-HEADER-2.                                              05190000
046400     05  FILLER                       PIC  X(03) VALUE SPACES.    05200000
046500     05  DH2-COL-HDR                  OCCURS 4 TIMES              05210000
046600                                      PIC  X(35).                 05220000
046700 01  DISTR-HEADER-3.                                              05230000
046800     05  FILLER                       PIC  X(03) VALUE SPACES.    05240000
046900     05  DH2-COL-HDR-OLD              OCCURS 7 TIMES              05250000
047000                                      PIC  X(21).                 05260000
047100*01  DISTR-HEADER-3.                                              05270000
047200*    05  FILLER                       PIC  X(03) VALUE SPACES.    05280000
047300*    05  DH3-COL-HDR                  OCCURS 4 TIMES              05290000
047400*                                     PIC  X(22).                 05300000
047500                                                                  05310000
047600 01  DISTR-LINE-OLD.                                              05320000
047700     05  FILLER                       PIC  X(03) VALUE SPACES.    05330000
047800     05  DL-DISTR-OLD                 OCCURS 7 TIMES.             05340000
047900         10  DL-STR-NBR-OLD           PIC  ZZZZ.                  05350000
048000         10  FILLER                   PIC  X(01) VALUE SPACES.    05360000
048100         10  DL-STR-NAME-OLD          PIC  X(05).                 05370000
048200         10  FILLER                   PIC  X(02) VALUE SPACES.    05380000
048300         10  DL-QTY-OLD               PIC  ZZZ,ZZZ.               05390000
048400         10  FILLER                   PIC  X(02) VALUE SPACES.    05400000
048500                                                                  05410000
048600 01  DISTR-LINE.                                                  05420000
048700     05  FILLER                       PIC  X(03) VALUE SPACES.    05430000
048800     05  DL-DISTR                     OCCURS 4 TIMES.             05440000
048900         10  FILLER                   PIC  X(01) VALUE SPACES.    05450000
049000         10  DL-STR-NBR               PIC  ZZZZ.                  05460000
049100         10  FILLER                   PIC  X(01) VALUE SPACES.    05470000
049200         10  DL-STR-NAME              PIC  X(05).                 05480000
049300         10  FILLER                   PIC  X(02) VALUE SPACES.    05490000
049400         10  DL-TOTAL-HDR             PIC  X(05) VALUE SPACES.    05500000
049500         10  FILLER                   PIC  X(08) VALUE SPACES.    05510000
049600         10  DL-QTY                   PIC  ZZZ,ZZZ.               05520000
049700         10  FILLER                   PIC  X(02) VALUE SPACES.    05530000
049800                                                                  05540000
049900 01  UPC-LINE.                                                    05550000
050000     05  FILLER                       PIC  X(15) VALUE SPACES.    05560000
050100     05  DL-UPC                       OCCURS 4 TIMES.             05570000
050200         10  DL-UPC-DESC              PIC  X(10) VALUE SPACES.    05580000
050300         10  FILLER                   PIC  X(03) VALUE SPACES.    05590000
050400         10  DL-UPC-QTY               PIC  ZZZ,ZZZ.               05600000
050500         10  FILLER                   PIC  X(15) VALUE SPACES.    05610000
050600                                                                  05620000
050700 01  END-REPORT-LINE.                                             05630000
050800     05  FILLER                       PIC  X(61) VALUE SPACES.    05640000
050900     05  FILLER                       PIC  X(28) VALUE            05650000
051000         'END OF SHIPPING INSTRUCTIONS'.                          05660000
051100     05  FILLER                       PIC  X(61) VALUE SPACES.    05670000
051200                                                                  05680000
051300 01  BLANK-REPORT-LINE.                                           05690000
051400     05  FILLER                       PIC  X(58) VALUE SPACES.    05700000
051500     05  FILLER                       PIC  X(34) VALUE            05710000
051600         'THIS PAGE INTENTIONALLY LEFT BLANK'.                    05720000
051700     05  FILLER                       PIC  X(58) VALUE SPACES.    05730000
051800                                                                  05740000
051900******************************************************************05750000
052000*  COMMUNICATIONS AREA FOR DB2                                    05760000
052100******************************************************************05770000
052200     EXEC SQL                                                     05780000
052300          INCLUDE SQLCA                                           05790000
052400     END-EXEC.                                                    05800000
052500******************************************************************05810000
052600*  COPY BOOK FOR PURCHASE ORDER TABLE                             05820000
052700******************************************************************05830000
052800     EXEC SQL                                                     05840000
052900          INCLUDE TPURCHS                                         05850000
053000     END-EXEC.                                                    05860000
053100******************************************************************05870000
053200*  COPY BOOK FOR UPC DETAIL TABLE                                 05880000
053300******************************************************************05890000
053400*    EXEC SQL                                                     05900013
053500*         INCLUDE TPOUPC                                          05910013
053600*    END-EXEC.                                                    05920013
053700******************************************************************05930000
053800*  COPY BOOK FOR PURCHASE ITEM TABLE                              05940000
053900******************************************************************05950000
054000     EXEC SQL                                                     05960000
054100          INCLUDE TPURITM                                         05970000
054200     END-EXEC.                                                    05980000
W24803******************************************************************05990000
W24803*  COPY BOOK FOR SKU TABLE                                        06000000
W24803******************************************************************06010000
W24803     EXEC SQL                                                     06020000
W24803          INCLUDE XLT00003                                        06030000
W24803     END-EXEC.                                                    06040000
W24803******************************************************************06050000
W24803*  COPY BOOK FOR VENDOR STYLE  TABLE                              06060000
W24803******************************************************************06070000
W24803     EXEC SQL                                                     06080000
W24803          INCLUDE XLT00004                                        06090000
W24803     END-EXEC.                                                    06100000
W24803******************************************************************06110000
W24803*  COPY BOOK FOR UPC TABLE                                        06120000
W24803******************************************************************06130000
W24803     EXEC SQL                                                     06140000
W24803          INCLUDE XLT00006                                        06150000
W24803     END-EXEC.                                                    06160000
055200******************************************************************06170000
055300*  COPY BOOK FOR PO PLANNED SHIPMENT TABLE                        06180000
055400******************************************************************06190000
055500     EXEC SQL                                                     06200000
055600          INCLUDE TPLNSHP                                         06210000
055700     END-EXEC.                                                    06220000
055800******************************************************************06230000
055900*  COPY BOOK FOR PO AGREEMENT TABLE                               06240000
056000******************************************************************06250000
056100     EXEC SQL                                                     06260000
056200          INCLUDE TPOAGMT                                         06270000
056300     END-EXEC.                                                    06280000
056400******************************************************************06290000
056500*  COPY BOOK FOR ALLOCATION PLAN TABLE                            06300000
056600******************************************************************06310000
056700     EXEC SQL                                                     06320000
056800          INCLUDE TALLPLN                                         06330000
056900     END-EXEC.                                                    06340000
057000******************************************************************06350000
057100*  COPY BOOK FOR PO INSTRUCTION TABLE                             06360000
057200******************************************************************06370000
057300     EXEC SQL                                                     06380000
057400          INCLUDE TPOINST                                         06390000
057500     END-EXEC.                                                    06400000
057600******************************************************************06410000
057700*  COPY BOOK FOR INSTRUCTION CODE TABLE                           06420000
057800******************************************************************06430000
057900     EXEC SQL                                                     06440000
058000          INCLUDE TINSTCD                                         06450000
058100     END-EXEC.                                                    06460000
058200******************************************************************06470000
058300*  COPY BOOK FOR MERCHANDISE STORE DISTRIBUTION TABLE             06480000
058400******************************************************************06490000
058500     EXEC SQL                                                     06500000
058600          INCLUDE TMESTDS                                         06510000
058700     END-EXEC.                                                    06520000
058800******************************************************************06530000
058900*  COPY BOOK FOR EXTERNAL ENTERPRISE NAME TABLE                   06540000
059000******************************************************************06550000
059100     EXEC SQL                                                     06560000
059200          INCLUDE TENTNME                                         06570000
059300     END-EXEC.                                                    06580000
059400******************************************************************06590000
059500*  COPY BOOK FOR ENTERPRISE LOCATION TABLE                        06600000
059600******************************************************************06610000
059700     EXEC SQL                                                     06620000
059800          INCLUDE TBUSLOC                                         06630000
059900     END-EXEC.                                                    06640000
060000******************************************************************06650000
060100*  COPY BOOK FOR ENTERPRISE REP TABLE                             06660000
060200******************************************************************06670000
060300     EXEC SQL                                                     06680000
060400          INCLUDE TENTREP                                         06690000
060500     END-EXEC.                                                    06700000
060600******************************************************************06710000
060700*  COPY BOOK FOR LOCATION TABLE                                   06720000
060800******************************************************************06730000
060900     EXEC SQL                                                     06740000
061000          INCLUDE XMT00001                                        06750000
061100     END-EXEC.                                                    06760000
      *---------------------------------------------------------------* 06770000
      *    DB2 AREA FOR DC LOCATION ASSIGNMENT                        * 06780000
      *---------------------------------------------------------------* 06790000
           EXEC SQL                                                     06800000
                INCLUDE XMT00002                                        06810000
           END-EXEC.                                                    06820000
061200******************************************************************06830000
061300*  COPY BOOK FOR TEMP DC TABLE                                    06840000
061400******************************************************************06850000
061500*    EXEC SQL                                                     06860014
061600*         INCLUDE TSTVNDC                                         06870014
061700*    END-EXEC.                                                    06880014
061800******************************************************************06890000
061900*  COPY BOOK FOR MERCHANDISE AREA                                 06900000
062000******************************************************************06910000
062100     EXEC SQL                                                     06920000
062200          INCLUDE TMDSEAR                                         06930000
062300     END-EXEC.                                                    06940000
062400******************************************************************06950000
062500*    PULL ALL VENDOR UPC'S FOR EACH SKU THAT HAVE POUPC QUANTITIES06960000
062600******************************************************************06970000
062700*    EXEC SQL                                                     06980015
062800*        DECLARE UPC_CURSOR CURSOR FOR                            06990015
W24803*        SELECT A.SIZE_DESC,                                      07000015
063000*               B.UPC_QTY,                                        07010015
W24803*               A.KOHLS_SIZE_CDE                                  07020015
W24803*        FROM XLT_SKU A,                                          07030015
063500*             TPOUPC  B,                                          07040015
W24803*             XLT_UPC C                                           07050015
W24803*        WHERE A.SKU_NBR         = :XLT00003-SKU-NBR              07060015
W24803*              AND A.INTR_UPC_ID = C.INTR_UPC_ID                  07070015
064200*              AND B.UPC_ID      = C.UPC_ID                       07080015
W24803*              AND B.PO_NBR      = :POUPC-PO-NBR                  07090015
064400*              AND B.PO_LNE_NBR  = :PURITM-PO-LNE-NBR             07100015
064500*              AND C.UPC_TYP_CDE = 'V'                            07110015
W24803*         ORDER BY 3                                              07120015
064800*         FOR FETCH ONLY                                          07130015
064900*    END-EXEC.                                                    07140015
065000*EJECT                                                            07150015
065100******************************************************************07160000
065200*  CURSOR FOR SHIPMENTS                                           07170000
065300******************************************************************07180000
065400     EXEC SQL                                                     07190000
065500         DECLARE SHIP-CSR CURSOR FOR                              07200000
065600         SELECT DISTINCT(DEST_NBR)                                07210000
065700         FROM TALLPLN A, TPURITM B                                07220000
065800         WHERE A.PO_NBR = :IR-PO-NBR2                             07230000
065900           AND A.CURR_SPLIT_QTY > +0                              07240000
066000           AND B.PO_NBR = A.PO_NBR                                07250000
066100           AND B.PO_LNE_NBR = A.PO_LNE_NBR                        07260000
066200           AND B.VER_STATUS_CDE = 'A'                             07270000
066300           AND B.STATUS_CDE NOT IN ('CA', 'CB')                   07280000
066400         ORDER BY DEST_NBR                                        07290000
066500     END-EXEC.                                                    07300000
066600******************************************************************07310000
066700*  CURSOR FOR INSTRUCTIONS                                        07320000
066800******************************************************************07330000
066900     EXEC SQL                                                     07340000
067000         DECLARE INST-CSR CURSOR FOR                              07350000
067100         SELECT B.INSTR_DESC,                                     07360000
067200                B.INSTR_NBR                                       07370000
067300         FROM   TPOINST A,                                        07380000
067400                TINSTCD B                                         07390000
067500         WHERE A.PO_NBR = :IR-PO-NBR2                             07400000
067600           AND A.RECIP_CDE = 'VN'                                 07410000
067700           AND B.INSTR_NBR = A.INSTR_NBR                          07420000
067800         ORDER BY INSTR_NBR                                       07430000
067900     END-EXEC.                                                    07440000
068000******************************************************************07450000
068100*  CURSOR FOR PO LINE ITEMS APPROVED                              07460000
068200******************************************************************07470000
068300     EXEC SQL                                                     07480000
068400         DECLARE APP-PO-LINE-CSR CURSOR FOR                       07490000
068500         SELECT A.CURR_SPLIT_QTY,                                 07500000
068600                A.PLAN_NBR,                                       07510000
068700                B.CL_NBR,                                         07520000
068800                B.SKU_SEQ_NBR,                                    07530000
068900                B.VEND_STYL_NAME,                                 07540000
069000                B.SKU_DESC,                                       07550000
069100                B.COLOR_DESC,                                     07560000
069200                B.SIZE_DESC,                                      07570000
W24803                D.MAJ_CL_NBR,                                     07580000
W24803                D.SUB_CL_NBR,                                     07590000
W24803                C.SKU_NBR,                                        07600000
W24803                D.VS_NBR,                                         07610000
W24803                C.SKU_DESC,                                       07620000
W24803                C.CSTM_CLOR_DESC,                                 07630000
W24803                C.SIZE_DESC,                                      07640000
069300                B.APP_PO_LNE_NBR,                                 07650000
069400                B.PO_LNE_NBR,                                     07660000
069500                B.ITM_NBR,                                        07670000
069600                B.UNT_QTY                                         07680000
W24803         FROM   TALLPLN A,                                        07690000
W24803                TPURITM B LEFT OUTER JOIN                         07700000
W24803                XLT_SKU C ON B.ITM_NBR = C.ITM_NBR                07710000
W24803                LEFT OUTER JOIN                                   07720000
W24803                XLT_VND_STYL D ON C.STYL_ID = D.STYL_ID           07730000
W24803         WHERE  A.PO_NBR = :ALLPLN-PO-NBR                         07740000
069900           AND  A.CURR_SPLIT_QTY > +0                             07750000
070000           AND  A.DEST_NBR = :ALLPLN-DEST-NBR                     07760000
070100           AND  B.PO_NBR = A.PO_NBR                               07770000
070200           AND  B.PO_LNE_NBR = A.PO_LNE_NBR                       07780000
070300           AND  B.VER_STATUS_CDE = 'A'                            07790000
070400           AND  B.STATUS_CDE NOT IN ('CA', 'CB')                  07800000
070500         ORDER BY B.APP_PO_LNE_NBR, B.PO_LNE_NBR                  07810000
070600     END-EXEC.                                                    07820000
070700******************************************************************07830000
070800*  CURSOR FOR STORE DISTRIBUTIONS (ALLOCATIONS) (1 PLAN AT A TIME)07840000
070900******************************************************************07850000
071000     EXEC SQL                                                     07860000
071100         DECLARE ALLOC-CSR CURSOR FOR                             07870000
071200         SELECT A.STR_NBR,                                        07880000
071300                A.STR_DISTRO_QTY,                                 07890000
071400                B.LOC_5_ABBR_NM                                   07900000
071500         FROM TMESTDS A,                                          07910000
071600              XMT_LOC B                                           07920000
071700         WHERE A.PO_NBR = :IR-PO-NBR2                             07930000
071800           AND A.PO_LNE_NBR = :PURITM-PO-LNE-NBR                  07940000
071900           AND A.PLAN_NBR = :ALLPLN-PLAN-NBR                      07950000
072000           AND B.LOC_NBR = A.STR_NBR                              07960000
                 AND A.STR_DISTRO_QTY > 0                               07970000
072200         ORDER BY A.STR_NBR                                       07980000
072300     END-EXEC.                                                    07990000
072400******************************************************************08000000
072500*  CURSOR FOR STORE DISTRIBUTIONS (ALL PLANS)                     08010000
072600******************************************************************08020000
072700     EXEC SQL                                                     08030000
072800         DECLARE ALLOC-CSR2 CURSOR FOR                            08040000
072900         SELECT A.STR_NBR,                                        08050000
073000                A.STR_DISTRO_QTY,                                 08060000
073100                B.LOC_5_ABBR_NM                                   08070000
073200         FROM TMESTDS A,                                          08080000
073300              XMT_LOC B                                           08090000
073400         WHERE A.PO_NBR = :IR-PO-NBR2                             08100000
073500           AND A.PO_LNE_NBR = :PURITM-PO-LNE-NBR                  08110000
073600           AND B.LOC_NBR = A.STR_NBR                              08120000
                 AND A.STR_DISTRO_QTY > 0                               08130000
073800         ORDER BY A.STR_NBR                                       08140000
073900     END-EXEC.                                                    08150000
074000******************************************************************08160000
074100*  CURSOR FOR TALLPLN                                             08170000
074200******************************************************************08180000
074300     EXEC SQL                                                     08190000
074400         DECLARE TALLPLN-CSR CURSOR WITH HOLD FOR                 08200000
074500         SELECT CURR_SPLIT_QTY,                                   08210000
074600                PO_LNE_NBR,                                       08220000
074700                PLAN_NBR                                          08230000
074800         FROM   TALLPLN                                           08240000
074900         WHERE  PO_NBR = :IR-PO-NBR2                              08250000
                 AND  CURR_SPLIT_QTY > 0                                08260000
075000     END-EXEC.                                                    08270000
075100                                                                  08280000
075200******************************************************************08290000
075300*  CURSOR FOR TALLPLN FOR BULK ORDER ONLY                         08300000
075400******************************************************************08310000
075500     EXEC SQL                                                     08320000
075600         DECLARE SPLIT-CSR CURSOR FOR                             08330000
075700         SELECT CURR_SPLIT_QTY,                                   08340000
075800                DEST_NBR                                          08350000
075900         FROM   TALLPLN                                           08360000
076000         WHERE  PO_NBR = :IR-PO-NBR2                              08370000
076100           AND  PO_LNE_NBR = :PURITM-PO-LNE-NBR                   08380000
076200           AND  CURR_SPLIT_QTY > +0                               08390000
076300         ORDER BY DEST_NBR                                        08400000
076400         FOR FETCH ONLY                                           08410000
076500     END-EXEC.                                                    08420000
076600                                                                  08430000
076700 PROCEDURE DIVISION.                                              08440000
076800                                                                  08450000
076900******************************************************************08460000
077000*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   08470000
077100******************************************************************08480000
077200 0000-MAINLINE.                                                   08490000
077300                                                                  08500000
077400     PERFORM 1000-INITIALIZE.                                     08510000
077500                                                                  08520000
077600     IF IR-RPT-TYPE-BY = 'BY'                                     08530000
077700         MOVE 'BUYER COPY  '       TO HL3-VERSION                 08540000
077800         PERFORM 2000-PROCESS-REPORT.                             08550000
077900                                                                  08560000
078000     IF IR-RPT-TYPE-VN = 'VN'                                     08570000
078100         MOVE 'VENDOR COPY '       TO HL3-VERSION                 08580000
078200         PERFORM 2000-PROCESS-REPORT.                             08590000
078700                                                                  08600000
078800     CLOSE INPUT-FILE                                             08610000
078900           POSIRPT-FILE.                                          08620000
079000                                                                  08630000
079100     STOP RUN.                                                    08640000
079200                                                                  08650000
079300                                                                  08660000
079400******************************************************************08670000
079500*  OPENS THE FILES  READ INPUT FILE, INITS HEADER FIELDS          08680000
079600******************************************************************08690000
079700 1000-INITIALIZE.                                                 08700000
079800                                                                  08710000
079900     OPEN INPUT  INPUT-FILE.                                      08720000
080000     OPEN OUTPUT POSIRPT-FILE.                                    08730000
080100                                                                  08740000
080200     READ INPUT-FILE                                              08750000
080300         INTO IR-INPUT-RECORD                                     08760000
080400         AT END SET PS-EOF-INPUT-FILE                             08770008
080500                                   TO TRUE.                       08780008
080600     IF  PS-EOF-INPUT-FILE                                        08790008
080700         DISPLAY  '****** ABEND IN PROGRAM POKRP004 *******'      08800008
080800         DISPLAY  'EMPTY INPUT FILE'                              08810008
080900         MOVE +4003                TO PV-ABEND-CODE               08820008
081000         CALL 'ILBOABN0' USING PV-ABEND-CODE                      08830008
081100     END-IF.                                                      08840008
081200                                                                  08850000
081300     DISPLAY IR-PO-NBR ' PO NUMBER BEING PROCESSED '.             08860000
081400     MOVE IR-PO-NBR                TO IR-PO-NBR2.                 08870000
081500     ACCEPT SD-SYSTEM-DATE FROM DATE.                             08880000
081600     MOVE SD-SYSTEM-MM             TO HL1-RUN-MONTH.              08890000
081700     MOVE SD-SYSTEM-DD             TO HL1-RUN-DAY.                08900000
081800     MOVE SD-SYSTEM-YY             TO HL1-RUN-YEAR.               08910000
081900                                                                  08920000
082000     ACCEPT ST-SYSTEM-TIME FROM TIME.                             08930000
082100     MOVE ST-SYSTEM-HH             TO HL1-RUN-HOUR.               08940000
082200     MOVE ST-SYSTEM-MM             TO HL1-RUN-MINUTE.             08950000
082300     MOVE ST-SYSTEM-SS             TO HL1-RUN-SECOND.             08960000
082400                                                                  08970000
082500                                                                  08980000
082600******************************************************************08990000
082700*  CONTROLS REPORT PROCESSING                                     09000000
082800******************************************************************09010000
082900 2000-PROCESS-REPORT.                                             09020000
083000                                                                  09030000
083100     MOVE +0 TO PV-SHIP-NBR-DISP.                                 09040000
083200     PERFORM 2100-GET-HEADER-INFO.                                09050000
083300     PERFORM 2200-OPEN-SHIPMENT-CURSOR.                           09060000
083400     PERFORM 2300-PROCESS-SHIPMENT-CURSOR                         09070000
083500         UNTIL PS-EOF-SHIP-CSR.                                   09080000
083600     PERFORM 2400-CLOSE-SHIPMENT-CURSOR.                          09090000
083700                                                                  09100000
083800                                                                  09110000
083900******************************************************************09120000
084000*  CONTROLS HEADER PROCESSING                                     09130000
084100******************************************************************09140000
084200 2100-GET-HEADER-INFO.                                            09150000
084300                                                                  09160000
084400     PERFORM 2101-GET-TPURCHS.                                    09170000
084500     PERFORM 2102-GET-TENTNME.                                    09180000
084600     PERFORM 2103-GET-TBUSLOC.                                    09190000
084700     PERFORM 2104-GET-TPLNSHP.                                    09200000
084800     PERFORM 2105-GET-TMDSEAR.                                    09210000
084900     PERFORM 2106-DETERMINE-PACK-BY-STORE.                        09220000
085000     PERFORM 2107-DETERMINE-NBR-OF-SHIPS.                         09230000
085100     PERFORM 2108-GET-ADDATE.                                     09240000
085200     PERFORM 2109-DETERMINE-PIC-AD.                               09250000
085300                                                                  09260000
085400******************************************************************09270000
085500*  RETRIEVES AND FORMATS PO DATA ON TPURCHS                       09280000
085600******************************************************************09290000
085700 2101-GET-TPURCHS.                                                09300000
085800                                                                  09310000
085900       EXEC SQL                                                   09320000
086000         SELECT ORD_DTE,                                          09330000
086100                ENT_ID,                                           09340000
086200                DEPT_NBR,                                         09350000
086300                ADR_SEQ_NBR,                                      09360000
086400                DIR_STR_IND                                       09370000
086500         INTO  :PURCHS-ORD-DTE,                                   09380000
086600               :PURCHS-ENT-ID,                                    09390000
086700               :PURCHS-DEPT-NBR,                                  09400000
086800               :PURCHS-ADR-SEQ-NBR,                               09410000
086900               :PURCHS-DIR-STR-IND                                09420000
087000         FROM TPURCHS                                             09430000
087100         WHERE PO_NBR         = :IR-PO-NBR2                       09440000
087200           AND VER_STATUS_CDE = 'A'                               09450000
087300           AND PO_CATEG_CDE   = 'MR'                              09460000
087400       END-EXEC.                                                  09470000
087600       EVALUATE TRUE                                              09480000
087700         WHEN SQLCODE = +0                                        09490000
087800             CONTINUE                                             09500000
087900         WHEN SQLWARN NOT = SPACE                                 09510000
088000         WHEN SQLCODE NOT = +0                                    09520000
088100             MOVE '2101-GET-TPURCHS'                              09530000
088200                                   TO PV-ABEND-PARAGRAPH          09540000
088300             PERFORM 9000-SQL-ABEND                               09550000
088400       END-EVALUATE.                                              09560000
088500                                                                  09570000
088600     MOVE IR-PO-NBR2               TO HL1-PO-NBR.                 09580000
088700     MOVE PURCHS-DEPT-NBR          TO HL2-DEPT-NBR.               09590000
088800     MOVE PURCHS-ORD-DTE           TO PV-DATE-BREAK.              09600000
088900     MOVE PV-DB-MM                 TO PV-DBS-MM.                  09610000
089000     MOVE PV-DB-DD                 TO PV-DBS-DD.                  09620000
089100     MOVE PV-DB-YY                 TO PV-DBS-YY.                  09630000
089200     MOVE PV-DATE-BREAK-SLASH      TO HL1-ORD-DATE.               09640000
089300                                                                  09650000
089400                                                                  09660000
089500******************************************************************09670000
089600*  RETRIEVES AND FORMATS PO DATA ON TENTNME                       09680000
089700******************************************************************09690000
089800 2102-GET-TENTNME.                                                09700000
089900                                                                  09710000
090000     EXEC SQL                                                     09720000
090100         SELECT ENT_NAME_DESC                                     09730000
090200         INTO  :ENTNME-ENT-NAME-DESC                              09740000
090300         FROM TENTNME                                             09750000
090400         WHERE ENT_ID = :PURCHS-ENT-ID                            09760000
090500           AND TYPE_CDE = '01'                                    09770000
090600     END-EXEC.                                                    09780000
090700                                                                  09790000
090800     EVALUATE TRUE                                                09800000
090900         WHEN SQLCODE = +0                                        09810000
091000         WHEN SQLCODE = +100                                      09820000
091100             CONTINUE                                             09830000
091200         WHEN SQLWARN NOT = SPACE                                 09840000
091300         WHEN SQLCODE NOT = +0                                    09850000
091400             MOVE '2102-GET-TENTNME'                              09860000
091500                                   TO PV-ABEND-PARAGRAPH          09870000
091600             PERFORM 9000-SQL-ABEND                               09880000
091700     END-EVALUATE.                                                09890000
091800                                                                  09900000
091900     IF SQLCODE = +100                                            09910000
092000         MOVE SPACES               TO ENTNME-ENT-NAME-DESC        09920000
092100     END-IF.                                                      09930000
092200                                                                  09940000
092300     MOVE ENTNME-ENT-NAME-DESC     TO HL4-VEND-NAME.              09950000
092400                                                                  09960000
092500                                                                  09970000
092600******************************************************************09980000
092700*  RETRIEVES AND FORMATS PO DATA ON TBUSLOC AND TENTREP           09990000
092800******************************************************************10000000
092900 2103-GET-TBUSLOC.                                                10010000
093000                                                                  10020000
093100     EXEC SQL                                                     10030000
093200         SELECT ADDRESS_LINE1_DESC,                               10040000
093300                ADDRESS_LINE2_DESC,                               10050000
093400                ATTENTION_TO_TXT,                                 10060000
093500                CITY_NAME,                                        10070000
093600                ZIP_CDE,                                          10080000
093700                ST_PROV_CDE,                                      10090000
093800                CNTRY_CDE                                         10100000
093900         INTO  :BUSLOC-ADDRESS-LINE1-DESC,                        10110000
094000               :BUSLOC-ADDRESS-LINE2-DESC,                        10120000
094100               :BUSLOC-ATTENTION-TO-TXT,                          10130000
094200               :BUSLOC-CITY-NAME,                                 10140000
094300               :BUSLOC-ZIP-CDE,                                   10150000
094400               :BUSLOC-ST-PROV-CDE,                               10160000
094500               :BUSLOC-CNTRY-CDE                                  10170000
094600         FROM TBUSLOC                                             10180000
094700         WHERE ENT_ID = :PURCHS-ENT-ID                            10190000
094800           AND FUNCTION_ID = 2                                    10200000
094900           AND SEQ_NBR = :PURCHS-ADR-SEQ-NBR                      10210000
095000     END-EXEC.                                                    10220000
095100                                                                  10230000
095200     EVALUATE TRUE                                                10240000
095300         WHEN SQLCODE = +0                                        10250000
095400         WHEN SQLCODE = +100                                      10260000
095500             CONTINUE                                             10270000
095600         WHEN SQLWARN NOT = SPACE                                 10280000
095700         WHEN SQLCODE NOT = +0                                    10290000
095800             MOVE '2103-GET-TBUSLOC'                              10300000
095900                                   TO PV-ABEND-PARAGRAPH          10310000
096000             PERFORM 9000-SQL-ABEND                               10320000
096100     END-EVALUATE.                                                10330000
096200                                                                  10340000
096300     IF SQLCODE = +100                                            10350000
096400         MOVE SPACES               TO HL5-VEND-ADDR-1             10360000
096500         MOVE SPACES               TO HL6-VEND-ADDR-2             10370000
096600         MOVE SPACES               TO HL7-VEND-ADDR-3             10380000
096700     ELSE                                                         10390000
096800         MOVE BUSLOC-CITY-NAME TO PV-CITY                         10400000
096900         IF BUSLOC-CNTRY-CDE = 'US ' OR SPACES                    10410000
097000             MOVE SPACES             TO PV-COUNTRY                10420000
097100                                        PV-STATE-PROV             10430000
097200             MOVE BUSLOC-ST-PROV-CDE TO PV-STATE-PROV             10440000
097300         ELSE                                                     10450000
097400             PERFORM 2150-RETRIEVE-PROV-COUNTRY                   10460000
097500         END-IF                                                   10470000
097600         MOVE BUSLOC-ADDRESS-LINE1-DESC                           10480000
097700                                   TO HL5-VEND-ADDR-1             10490000
097800         IF BUSLOC-ADDRESS-LINE2-DESC > SPACES                    10500000
097900             MOVE BUSLOC-ADDRESS-LINE2-DESC                       10510000
098000                                   TO HL6-VEND-ADDR-2             10520000
098100             INITIALIZE HL7-VEND-ADDR-3                           10530000
098200             STRING PV-CITY             DELIMITED BY '  '         10540000
098300                    ', '                DELIMITED BY SIZE         10550000
098400                    PV-STATE-PROV       DELIMITED BY '  '         10560000
098500                    '  '                DELIMITED BY SIZE         10570000
098600                    BUSLOC-ZIP-CDE      DELIMITED BY '  '         10580000
098700                    '  '                DELIMITED BY SIZE         10590000
098800                    PV-COUNTRY          DELIMITED BY '  '         10600000
098900                                 INTO HL7-VEND-ADDR-3             10610000
099000         ELSE                                                     10620000
099100             INITIALIZE HL6-VEND-ADDR-2                           10630000
099200             STRING BUSLOC-CITY-NAME    DELIMITED BY '  '         10640000
099300                    ', '                DELIMITED BY SIZE         10650000
099400                    PV-STATE-PROV       DELIMITED BY '  '         10660000
099500                    '  '                DELIMITED BY SIZE         10670000
099600                    BUSLOC-ZIP-CDE      DELIMITED BY '  '         10680000
099700                    '  '                DELIMITED BY SIZE         10690000
099800                    PV-COUNTRY          DELIMITED BY '  '         10700000
099900                                 INTO HL6-VEND-ADDR-2             10710000
100000             MOVE BUSLOC-ATTENTION-TO-TXT                         10720000
100100                                   TO HL7-VEND-ADDR-3             10730000
100200         END-IF                                                   10740000
100300     END-IF.                                                      10750000
100400                                                                  10760000
100500     EXEC SQL                                                     10770000
100600         SELECT A.FAX_NBR,                                        10780000
100700                A.FIRST_NAME,                                     10790000
100800                A.LAST_NAME                                       10800000
100900         INTO  :ENTREP-FAX-NBR,                                   10810000
101000               :ENTREP-FIRST-NAME,                                10820000
101100               :ENTREP-LAST-NAME                                  10830000
101200         FROM TENTREP A                                           10840000
101300         WHERE A.ENT_ID = :PURCHS-ENT-ID                          10850000
101400           AND A.FUNCTION_ID = 13                                 10860000
101500           AND A.SEQ_NBR = (SELECT MIN(B.SEQ_NBR)                 10870000
101600                            FROM TENTREP B                        10880000
101700                            WHERE B.ENT_ID = A.ENT_ID             10890000
101800                              AND B.FUNCTION_ID = A.FUNCTION_ID)  10900000
101900     END-EXEC.                                                    10910000
102000                                                                  10920000
102100     EVALUATE TRUE                                                10930000
102200         WHEN SQLCODE = +0                                        10940000
102300         WHEN SQLCODE = +100                                      10950000
102400             CONTINUE                                             10960000
102500         WHEN SQLWARN NOT = SPACE                                 10970000
102600         WHEN SQLCODE NOT = +0                                    10980000
102700             MOVE '2103-GET-TENTREP'                              10990000
102800                                   TO PV-ABEND-PARAGRAPH          11000000
102900             PERFORM 9000-SQL-ABEND                               11010000
103000     END-EVALUATE.                                                11020000
103100                                                                  11030000
103200     IF SQLCODE = +100                                            11040000
103300         MOVE SPACES               TO HL8-CONTACT                 11050000
103400         MOVE SPACES               TO HL9-VEND-FAX                11060000
103500     ELSE                                                         11070000
103600         MOVE 40                   TO DP024-FLNAME-LENGTH         11080000
103700         MOVE ENTREP-LAST-NAME     TO DP024-LNAME                 11090000
103800         MOVE ENTREP-FIRST-NAME    TO DP024-FNAME                 11100000
103900         PERFORM DP024-0000-FORMAT-NAME                           11110000
104000         MOVE DP024-FLNAME         TO HL8-CONTACT                 11120000
104100         MOVE ENTREP-FAX-NBR       TO HL9-VEND-FAX                11130000
104200     END-IF.                                                      11140000
104300                                                                  11150000
104400                                                                  11160000
104500******************************************************************11170000
104600*  RETRIEVES AND FORMATS PO DATA ON TPLNSHP                       11180000
104700******************************************************************11190000
104800 2104-GET-TPLNSHP.                                                11200000
104900                                                                  11210000
105000     EXEC SQL                                                     11220000
105100         SELECT FOB_POINT_TXT,                                    11230000
105200                DONT_SHIP_BEF_DTE,                                11240000
105300                CAN_IFNOT_SHIP_DTE                                11250000
105400         INTO  :PLNSHP-FOB-POINT-TXT,                             11260000
105500               :PLNSHP-DONT-SHIP-BEF-DTE,                         11270000
105600               :PLNSHP-CAN-IFNOT-SHIP-DTE                         11280000
105700         FROM TPLNSHP                                             11290000
105800         WHERE PO_NBR = :IR-PO-NBR2                               11300000
105900           AND VER_STATUS_CDE = 'A'                               11310000
106000     END-EXEC.                                                    11320000
106100                                                                  11330000
106200     EVALUATE TRUE                                                11340000
106300         WHEN SQLCODE = +0                                        11350000
106400             CONTINUE                                             11360000
106500         WHEN SQLWARN NOT = SPACE                                 11370000
106600         WHEN SQLCODE NOT = +0                                    11380000
106700             MOVE '2104-GET-TPLNSHP'                              11390000
106800                                   TO PV-ABEND-PARAGRAPH          11400000
106900             PERFORM 9000-SQL-ABEND                               11410000
107000     END-EVALUATE.                                                11420000
107100                                                                  11430000
107200     MOVE PLNSHP-FOB-POINT-TXT     TO HL8-FOB-PT.                 11440000
107300     MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DATE-BREAK.              11450000
107400     MOVE PV-DB-MM                 TO HL9-DNSB-MONTH.             11460000
107500     MOVE PV-DB-DD                 TO HL9-DNSB-DAY.               11470000
107600     MOVE PV-DB-YY                 TO HL9-DNSB-YEAR.              11480000
107700     MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                               11490000
107800                                   TO PV-DATE-BREAK.              11500000
107900     MOVE PV-DB-MM                 TO HL10-CNSB-MONTH.            11510000
108000     MOVE PV-DB-DD                 TO HL10-CNSB-DAY.              11520000
108100     MOVE PV-DB-YY                 TO HL10-CNSB-YEAR.             11530000
108200                                                                  11540000
108300                                                                  11550000
108400******************************************************************11560000
108500*  GET DEPARTMENT NAME FROM TMDSEAR                               11570000
108600******************************************************************11580000
108700 2105-GET-TMDSEAR.                                                11590000
108800                                                                  11600000
108900     EXEC SQL                                                     11610000
109000         SELECT MDSEAR_DESC                                       11620000
109100         INTO  :MDSEAR-DESC                                       11630000
109200         FROM TMDSEAR                                             11640000
109300         WHERE OPERCO_NBR = '03'                                  11650000
109400           AND DEPT_NBR = :PURCHS-DEPT-NBR                        11660000
109500           AND MDSELV_CDE = 'DPT'                                 11670000
109600           AND STRT_DTE <= CURRENT DATE                           11680000
109700           AND END_DTE >= CURRENT DATE                            11690000
109800     END-EXEC.                                                    11700000
109900                                                                  11710000
110000     EVALUATE TRUE                                                11720000
110100         WHEN SQLCODE = +0                                        11730000
110200         WHEN SQLCODE = +100                                      11740000
110300             CONTINUE                                             11750000
110400         WHEN SQLWARN NOT = SPACE                                 11760000
110500         WHEN SQLCODE NOT = +0                                    11770000
110600             MOVE '2105-GET-TMDSEAR'                              11780000
110700                                   TO PV-ABEND-PARAGRAPH          11790000
110800             PERFORM 9000-SQL-ABEND                               11800000
110900     END-EVALUATE.                                                11810000
111000                                                                  11820000
111100     IF SQLCODE = +100                                            11830000
111200         MOVE SPACES               TO HL2-DEPT-NAME               11840000
111300     ELSE                                                         11850000
111400         MOVE MDSEAR-DESC          TO HL2-DEPT-NAME               11860000
111500     END-IF.                                                      11870000
111600                                                                  11880000
111700                                                                  11890000
111800******************************************************************11900000
111900*  BY EXISTENCE PO IS A PACK BY STORE PO                          11910000
112000******************************************************************11920000
112100 2106-DETERMINE-PACK-BY-STORE.                                    11930000
112200                                                                  11940000
112300     EXEC SQL                                                     11950000
112400         SELECT TYP_CDE                                           11960000
112500         INTO  :POAGMT-TYP-CDE                                    11970000
112600         FROM TPOAGMT                                             11980000
112700         WHERE PO_NBR = :IR-PO-NBR2                               11990000
112800           AND VER_STATUS_CDE = 'A'                               12000000
112900           AND AGRMT_TYP_ID = '4'                                 12010000
113000           AND TYP_CDE = 4                                        12020000
113100     END-EXEC.                                                    12030000
113200                                                                  12040000
113300     EVALUATE TRUE                                                12050000
113400         WHEN SQLCODE = +0                                        12060000
113500         WHEN SQLCODE = +100                                      12070000
113600             CONTINUE                                             12080000
113700         WHEN SQLWARN NOT = SPACE                                 12090000
113800         WHEN SQLCODE NOT = +0                                    12100000
113900             MOVE '2106-DETERMINE-PACK-BY-STORE'                  12110000
114000                                   TO PV-ABEND-PARAGRAPH          12120000
114100             PERFORM 9000-SQL-ABEND                               12130000
114200     END-EVALUATE.                                                12140000
114300                                                                  12150000
114400     IF SQLCODE = +0                                              12160000
114500         SET PS-PACK-BY-STORE      TO TRUE                        12170000
114600     ELSE                                                         12180000
114700         SET PS-NO-PACK-BY-STORE   TO TRUE                        12190000
114800     END-IF.                                                      12200000
114900                                                                  12210000
115000                                                                  12220000
115100******************************************************************12230000
115200*  DETERMINE NUMBER OF SHIPMENTS FOR THIS ORDER                   12240000
115300******************************************************************12250000
115400 2107-DETERMINE-NBR-OF-SHIPS.                                     12260000
115500                                                                  12270000
115600     MOVE +0                       TO PV-DB2-COUNT.               12280000
115700     EXEC SQL                                                     12290000
115800         SELECT COUNT(DISTINCT(DEST_NBR))                         12300000
115900         INTO  :PV-DB2-COUNT                                      12310000
116000         FROM TALLPLN A, TPURITM B                                12320000
116100         WHERE A.PO_NBR = :IR-PO-NBR2                             12330000
116200           AND A.CURR_SPLIT_QTY > +0                              12340000
116300           AND B.PO_NBR = A.PO_NBR                                12350000
116400           AND B.PO_LNE_NBR = A.PO_LNE_NBR                        12360000
116500           AND B.VER_STATUS_CDE = 'A'                             12370000
116600           AND B.STATUS_CDE NOT IN ('CA', 'CB')                   12380000
116700     END-EXEC.                                                    12390000
116800                                                                  12400000
116900     EVALUATE TRUE                                                12410000
117000         WHEN SQLCODE = +0                                        12420000
117100         WHEN SQLCODE = +100                                      12430000
117200             CONTINUE                                             12440000
117300         WHEN SQLWARN NOT = SPACE                                 12450000
117400         WHEN SQLCODE NOT = +0                                    12460000
117500             MOVE '2107-DETERMINE-NBR-OF-SHIPS'                   12470000
117600                                   TO PV-ABEND-PARAGRAPH          12480000
117700             PERFORM 9000-SQL-ABEND                               12490000
117800     END-EVALUATE.                                                12500000
117900                                                                  12510000
118000     IF SQLCODE = +0                                              12520000
118100         MOVE PV-DB2-COUNT         TO HL4-NBR-SHIP                12530000
118200     ELSE                                                         12540000
118300         MOVE 0                    TO HL4-NBR-SHIP                12550000
118400     END-IF.                                                      12560000
118500                                                                  12570000
118600                                                                  12580000
118700******************************************************************12590000
118800*  RETRIEVES ANY AD MERCHANDISE FROM TPURITM                      12600000
118900******************************************************************12610000
119000 2108-GET-ADDATE.                                                 12620000
119100                                                                  12630000
119200     EXEC SQL                                                     12640000
119300         SELECT MIN(AD_EVNT_DTE)                                  12650000
119400         INTO  :PURITM-AD-EVNT-DTE:PV-NULL-IND                    12660000
119500         FROM TPURITM                                             12670000
119600         WHERE PO_NBR  = :IR-PO-NBR2                              12680000
119700           AND VER_STATUS_CDE = 'A'                               12690000
119800           AND AD_EVNT_DTE > :PC-INIT-DATE                        12700000
119900           AND STATUS_CDE NOT IN ('CA', 'CB')                     12710000
120000     END-EXEC.                                                    12720000
120100                                                                  12730000
120200     EVALUATE TRUE                                                12740000
120300         WHEN SQLCODE = +0                                        12750000
120400         WHEN SQLCODE = +100                                      12760000
120500             CONTINUE                                             12770000
120600         WHEN SQLWARN NOT = SPACE                                 12780000
120700         WHEN SQLCODE NOT = +0                                    12790000
120800             MOVE '2108-GET-ADDATE'                               12800000
120900                                   TO PV-ABEND-PARAGRAPH          12810000
121000             PERFORM 9000-SQL-ABEND                               12820000
121100     END-EVALUATE.                                                12830000
121200                                                                  12840000
121300     IF SQLCODE = +100 OR                                         12850000
121400        PV-NULL-IND < +0                                          12860000
121500         MOVE SPACES               TO HL11-AD-DATE                12870000
121600     ELSE                                                         12880000
121700         MOVE PURITM-AD-EVNT-DTE   TO PV-DATE-BREAK               12890000
121800         MOVE PV-DB-MM             TO PV-DBS-MM                   12900000
121900         MOVE PV-DB-DD             TO PV-DBS-DD                   12910000
122000         MOVE PV-DB-YY             TO PV-DBS-YY                   12920000
122100         MOVE PV-DATE-BREAK-SLASH  TO HL11-AD-DATE                12930000
122200     END-IF.                                                      12940000
122300                                                                  12950000
122400                                                                  12960000
122500******************************************************************12970000
122600*  CHECKS IF ITEM IS PICTURED IN AD                               12980000
122700******************************************************************12990000
122800 2109-DETERMINE-PIC-AD.                                           13000000
122900                                                                  13010000
123000                                                                  13020000
123100     MOVE +0                       TO PV-DB2-COUNT.               13030000
123200     EXEC SQL                                                     13040000
123300         SELECT COUNT(*)                                          13050000
123400         INTO  :PV-DB2-COUNT                                      13060000
123500         FROM TPURITM                                             13070000
123600         WHERE PO_NBR = :IR-PO-NBR2                               13080000
123700           AND PIC_ITM_IND = 'Y'                                  13090000
123800     END-EXEC.                                                    13100000
123900                                                                  13110000
124000     EVALUATE TRUE                                                13120000
124100         WHEN SQLCODE = +0                                        13130000
124200         WHEN SQLCODE = +100                                      13140000
124300             CONTINUE                                             13150000
124400         WHEN SQLWARN NOT = SPACE                                 13160000
124500         WHEN SQLCODE NOT = +0                                    13170000
124600             MOVE '2109-DETERMINE-PIC-AD'                         13180000
124700                                   TO PV-ABEND-PARAGRAPH          13190000
124800             PERFORM 9000-SQL-ABEND                               13200000
124900     END-EVALUATE.                                                13210000
125000                                                                  13220000
125100     IF PV-DB2-COUNT > ZERO                                       13230000
125200         MOVE 'YES'                TO HL12-PIC-AD-IND             13240000
125300     ELSE                                                         13250000
125400         MOVE ' NO'                TO HL12-PIC-AD-IND             13260000
125500     END-IF.                                                      13270000
125600                                                                  13280000
125700******************************************************************13290000
125800*  RETRIEVE THE COUNTRY AND PROVINCE FROM THE PEOPLESOFT TABLES   13300000
125900******************************************************************13310000
126000 2150-RETRIEVE-PROV-COUNTRY.                                      13320000
126100                                                                  13330000
126200     MOVE BUSLOC-ST-PROV-CDE     TO DP410-STATE-CODE.             13340000
126300     MOVE BUSLOC-CNTRY-CDE       TO DP410-COUNTRY-CODE.           13350000
126400                                                                  13360000
126500     CALL PC-DPKUT410 USING DP410-ST-PROV-CNTRY-ROUTINE.          13370000
126600                                                                  13380000
126700     EVALUATE TRUE                                                13390000
126800                                                                  13400000
126900         WHEN  DP410-DB2-ERROR                                    13410000
127000             DISPLAY 'STATE/PROV = ' DP410-STATE-CODE             13420000
127100             DISPLAY 'COUNTRY = ' DP410-COUNTRY-CODE              13430000
127200             MOVE '2150-RETRIEVE-PROV-COUNTRY'                    13440000
127300                                   TO PV-ABEND-PARAGRAPH          13450000
127400             PERFORM 9000-SQL-ABEND                               13460000
127500                                                                  13470000
127600         WHEN  DP410-DEADLOCK-BYPASS-ROUTINE                      13480000
127700             MOVE DP410-STATE-CODE TO PV-STATE-PROV               13490000
127800             MOVE DP410-COUNTRY-CODE TO PV-COUNTRY                13500000
127900                                                                  13510000
128000         WHEN  OTHER                                              13520000
128100             MOVE SPACES             TO PV-STATE-PROV             13530000
128200                                        PV-COUNTRY                13540000
128300             MOVE DP410-STATE-NAME   TO PV-STATE-PROV             13550000
128400             MOVE DP410-COUNTRY-NAME TO PV-COUNTRY                13560000
128500     END-EVALUATE.                                                13570000
128600                                                                  13580000
128700******************************************************************13590000
128800*  OPENS SHIPMENT CURSOR                                          13600000
128900******************************************************************13610000
129000 2200-OPEN-SHIPMENT-CURSOR.                                       13620000
129100                                                                  13630000
129200     EXEC SQL                                                     13640000
129300         OPEN SHIP-CSR                                            13650000
129400     END-EXEC.                                                    13660000
129500                                                                  13670000
129600     EVALUATE TRUE                                                13680000
129700         WHEN SQLCODE = +0                                        13690000
129800             CONTINUE                                             13700000
129900         WHEN SQLWARN NOT = SPACE                                 13710000
130000         WHEN SQLCODE NOT = +0                                    13720000
130100             MOVE '2200-OPEN-SHIP-CSR'                            13730000
130200                                   TO PV-ABEND-PARAGRAPH          13740000
130300             PERFORM 9000-SQL-ABEND                               13750000
130400     END-EVALUATE.                                                13760000
130500     SET PS-NOT-EOF-SHIP-CSR       TO TRUE.                       13770000
130600     INITIALIZE PV-SHIP-NBR.                                      13780000
130700     MOVE +0 TO PV-SHIP-NBR-DISP.                                 13790000
130800                                                                  13800000
130900                                                                  13810000
131000******************************************************************13820000
131100*  FETCHS SHIPMENT CURSOR AND CONTROLS PROCESSING FOR PRINTING    13830000
131200*  OF SHIPMENT                                                    13840000
131300******************************************************************13850000
131400 2300-PROCESS-SHIPMENT-CURSOR.                                    13860000
131500                                                                  13870000
131600     EXEC SQL                                                     13880000
131700         FETCH SHIP-CSR                                           13890000
131800         INTO  :ALLPLN-DEST-NBR                                   13900000
131900     END-EXEC.                                                    13910000
132000                                                                  13920000
132100     EVALUATE TRUE                                                13930000
132200         WHEN SQLCODE = +0                                        13940000
132300         WHEN SQLCODE = +100                                      13950000
132400             CONTINUE                                             13960000
132500         WHEN SQLWARN NOT = SPACE                                 13970000
132600         WHEN SQLCODE NOT = +0                                    13980000
132700             MOVE '2300-PROCESS-SHIPMENT-CURSOR'                  13990000
132800                                   TO PV-ABEND-PARAGRAPH          14000000
132900             PERFORM 9000-SQL-ABEND                               14010000
133000     END-EVALUATE.                                                14020000
133100                                                                  14030000
133200     IF SQLCODE = +100                                            14040000
133300         SET PS-EOF-SHIP-CSR       TO TRUE                        14050000
133400     ELSE                                                         14060000
133500         ADD  +1                   TO PV-SHIP-NBR-DISP            14070000
133600         PERFORM 2310-GET-SHIPMENT-DATA                           14080000
133700         PERFORM 2320-GET-SHIPMENT-COUNTS                         14090000
133800         ADD +1                    TO PV-SHIP-NBR                 14100000
133900         MOVE PV-SHIP-NBR          TO HL4-SHIP-NBR                14110000
134000         MOVE +1                   TO PV-PAGE-CNT                 14120000
134100         MOVE PV-PAGE-CNT          TO HL2-PAGE                    14130000
134200         MOVE +0                   TO PV-LINE-CNT                 14140000
134300         WRITE POSIRPT-RECORD FROM HEADER-LINE1                   14150000
134400             AFTER ADVANCING PAGE                                 14160000
134500         WRITE POSIRPT-RECORD FROM HEADER-LINE2                   14170000
134600             AFTER 1 LINES                                        14180000
134700         WRITE POSIRPT-RECORD FROM HEADER-LINE3                   14190000
134800             AFTER 1 LINES                                        14200000
134900         WRITE POSIRPT-RECORD FROM HEADER-LINE4                   14210000
135000             AFTER 2 LINES                                        14220000
135100         WRITE POSIRPT-RECORD FROM HEADER-LINE5                   14230000
135200             AFTER 1 LINES                                        14240000
135300         WRITE POSIRPT-RECORD FROM HEADER-LINE6                   14250000
135400             AFTER 1 LINES                                        14260000
135500         WRITE POSIRPT-RECORD FROM HEADER-LINE7                   14270000
135600             AFTER 1 LINES                                        14280000
135700         WRITE POSIRPT-RECORD FROM HEADER-LINE8-A                 14290000
135800             AFTER 1 LINES                                        14300000
135900         WRITE POSIRPT-RECORD FROM HEADER-LINE9                   14310000
136000             AFTER 1 LINES                                        14320000
136100         WRITE POSIRPT-RECORD FROM HEADER-LINE10                  14330000
136200             AFTER 1 LINES                                        14340000
136300         WRITE POSIRPT-RECORD FROM HEADER-LINE11                  14350000
136400             AFTER 1 LINES                                        14360000
136500         WRITE POSIRPT-RECORD FROM HEADER-LINE12                  14370000
136600             AFTER 1 LINES                                        14380000
136700                                                                  14390000
136800         MOVE +13                  TO PV-LINE-CNT                 14400000
136900                                                                  14410000
137000         PERFORM 2330-PROCESS-INSTRUCTION                         14420000
137100         PERFORM 2340-PROCESS-SKUS                                14430000
137200         PERFORM 2370-ADVANCE-TO-NEWPAGE                          14440000
137300                                                                  14450000
137400         WRITE POSIRPT-RECORD FROM END-REPORT-LINE                14460000
137500             AFTER 3 LINES                                        14470000
137600                                                                  14480000
139300     END-IF.                                                      14490000
139400                                                                  14500000
139500                                                                  14510000
139600******************************************************************14520000
139700*  RETRIEVES AND FORMATS SHIP TO DATA FROM XMT_LOC                14530000
139800******************************************************************14540000
139900 2310-GET-SHIPMENT-DATA.                                          14550000
140000                                                                  14560000
140100     EXEC SQL                                                     14570000
140200         SELECT LOC_NM,                                           14580000
140300                LNE_1_ADDR,                                       14590000
140400                LNE_2_ADDR,                                       14600000
140500                CTY_NM,                                           14610000
140600                ST_CDE,                                           14620000
140700                ZIP_10_CDE                                        14630000
140800         INTO  :XMT00001-LOC-NM,                                  14640000
140900               :XMT00001-LNE-1-ADDR,                              14650000
141000               :XMT00001-LNE-2-ADDR,                              14660000
141100               :XMT00001-CTY-NM,                                  14670000
141200               :XMT00001-ST-CDE,                                  14680000
141300               :XMT00001-ZIP-10-CDE                               14690000
141400         FROM XMT_LOC                                             14700000
141500         WHERE LOC_NBR = :ALLPLN-DEST-NBR                         14710000
141700     END-EXEC.                                                    14720000
141800                                                                  14730000
141900     EVALUATE TRUE                                                14740000
142000         WHEN SQLCODE = +0                                        14750000
142100         WHEN SQLCODE = +100                                      14760000
142200             CONTINUE                                             14770000
142300         WHEN SQLWARN NOT = SPACE                                 14780000
142400         WHEN SQLCODE NOT = +0                                    14790000
142500             MOVE '2310-GET-SHIPMENT-DATA'                        14800000
142600                                   TO PV-ABEND-PARAGRAPH          14810000
142700             PERFORM 9000-SQL-ABEND                               14820000
142800     END-EVALUATE.                                                14830000
142900                                                                  14840000
143000     IF SQLCODE = 0                                               14850000
143100         MOVE XMT00001-LOC-NM   TO HL5-SHIP-TO-NAME               14860000
143200         MOVE XMT00001-LNE-1-ADDR                                 14870000
143300                                   TO HL6-SHIP-TO-ADDR-1          14880000
143400         MOVE XMT00001-ZIP-10-CDE                                 14890000
143500                                   TO PV-EDIT-ZIP-CODE            14900000
               IF PV-EZD-DASH EQUAL '-' OR ' '                          14910000
                  MOVE PV-EZD-1-5          TO PV-ZCD-1-5                14920000
                  MOVE PV-EZD-6-9          TO PV-ZCD-6-9                14930000
               ELSE                                                     14940000
                  MOVE PV-EZND-1-5          TO PV-ZCD-1-5               14950000
                  MOVE PV-EZND-6-9          TO PV-ZCD-6-9               14960000
               END-IF                                                   14970000
143800         MOVE SPACES               TO HL7-SHIP-TO-ADDR-2          14980000
143900         IF XMT00001-LNE-2-ADDR > SPACES                          14990000
144000             MOVE XMT00001-LNE-2-ADDR                             15000000
144100                                   TO HL7-SHIP-TO-ADDR-2          15010000
144200             STRING XMT00001-CTY-NM        DELIMITED BY '  '      15020000
144300                    ', '                   DELIMITED BY SIZE      15030000
144400                    XMT00001-ST-CDE        DELIMITED BY '  '      15040000
144500                    '  '                   DELIMITED BY SIZE      15050000
144600                    PV-ZIP-CODE-DISPLAY    DELIMITED BY SIZE      15060000
144700                                 INTO HL8-SHIP-TO-ADDR-3A         15070000
144800             MOVE HL8-SHIP-TO-ADDR-3A TO HL8-SHIP-TO-ADDR-3B      15080000
144900         ELSE                                                     15090000
145000             STRING XMT00001-CTY-NM        DELIMITED BY '  '      15100000
145100                    ', '                   DELIMITED BY SIZE      15110000
145200                    XMT00001-ST-CDE        DELIMITED BY '  '      15120000
145300                    '  '                   DELIMITED BY SIZE      15130000
145400                    PV-ZIP-CODE-DISPLAY    DELIMITED BY SIZE      15140000
145500                                 INTO HL7-SHIP-TO-ADDR-2          15150000
145600             MOVE SPACES           TO HL8-SHIP-TO-ADDR-3A         15160000
145700                                      HL8-SHIP-TO-ADDR-3B         15170000
145800         END-IF                                                   15180000
145900     ELSE                                                         15190000
146000         MOVE SPACES               TO HL5-SHIP-TO-NAME            15200000
146100                                      HL6-SHIP-TO-ADDR-1          15210000
146200                                      HL7-SHIP-TO-ADDR-2          15220000
146300                                      HL8-SHIP-TO-ADDR-3A         15230000
146400                                      HL8-SHIP-TO-ADDR-3B         15240000
146500     END-IF.                                                      15250000
146600                                                                  15260000
146700                                                                  15270000
146800******************************************************************15280000
146900*  OPENS UPC CURSOR                                               15290000
147000******************************************************************15300000
147100*2320-OPEN-UPC-CSR.                                               15310016
W24803*        MOVE IR-PO-NBR2 TO POUPC-PO-NBR                          15320016
147200*        EXEC SQL                                                 15330016
147300*            OPEN UPC_CURSOR                                      15340016
147400*        END-EXEC.                                                15350016
147500*                                                                 15360016
147600*      EVALUATE TRUE                                              15370016
147700*          WHEN SQLCODE = +0                                      15380016
147800*              CONTINUE                                           15390016
147900*          WHEN SQLWARN NOT = SPACE                               15400016
148000*          WHEN SQLCODE NOT = +0                                  15410016
148100*              MOVE '2320-OPEN-UPC-CSR'                           15420016
148200*                                   TO PV-ABEND-PARAGRAPH         15430016
148300*              PERFORM 9000-SQL-ABEND                             15440016
148400*      END-EVALUATE.                                              15450016
148500                                                                  15460000
148600******************************************************************15470000
148700*  DETERMINES COUNTS OF UNITS, LINES, AND SKUS FOR A GIVEN        15480000
148800*  SHIPPING DESTINATION                                           15490000
148900******************************************************************15500000
149000 2320-GET-SHIPMENT-COUNTS.                                        15510000
149100                                                                  15520000
149200     EXEC SQL                                                     15530000
149300         SELECT SUM(A.CURR_SPLIT_QTY)                             15540000
149400         INTO  :ALLPLN-CURR-SPLIT-QTY                             15550000
149500         FROM TALLPLN A, TPURITM B                                15560000
149600         WHERE A.PO_NBR = :IR-PO-NBR2                             15570000
149700           AND A.CURR_SPLIT_QTY > +0                              15580000
149800           AND A.DEST_NBR = :ALLPLN-DEST-NBR                      15590000
149900           AND B.PO_NBR = A.PO_NBR                                15600000
150000           AND B.PO_LNE_NBR = A.PO_LNE_NBR                        15610000
150100           AND B.VER_STATUS_CDE = 'A'                             15620000
150200           AND B.STATUS_CDE NOT IN ('CA', 'CB')                   15630000
150300     END-EXEC.                                                    15640000
150400                                                                  15650000
150500     EVALUATE TRUE                                                15660000
150600         WHEN SQLCODE = +0                                        15670000
150700         WHEN SQLCODE = +100                                      15680000
150800             CONTINUE                                             15690000
150900         WHEN SQLWARN NOT = SPACE                                 15700000
151000         WHEN SQLCODE NOT = +0                                    15710000
151100             MOVE '2320-GET-SHIPMENT-COUNTS - UNITS'              15720000
151200                                   TO PV-ABEND-PARAGRAPH          15730000
151300             PERFORM 9000-SQL-ABEND                               15740000
151400     END-EVALUATE.                                                15750000
151500                                                                  15760000
151600     IF SQLCODE = +0                                              15770000
151700         MOVE ALLPLN-CURR-SPLIT-QTY                               15780000
151800                                   TO HL4-UNITS                   15790000
151900     ELSE                                                         15800000
152000         MOVE 0                    TO HL4-UNITS                   15810000
152100     END-IF.                                                      15820000
152200                                                                  15830000
152300     EXEC SQL                                                     15840000
152400         SELECT COUNT(DISTINCT(B.PO_LNE_NBR))                     15850000
152500         INTO  :PV-DB2-COUNT                                      15860000
152600         FROM TALLPLN A, TPURITM B                                15870000
152700         WHERE A.PO_NBR = :IR-PO-NBR2                             15880000
152800           AND A.CURR_SPLIT_QTY > +0                              15890000
152900           AND A.DEST_NBR = :ALLPLN-DEST-NBR                      15900000
153000           AND B.PO_NBR = A.PO_NBR                                15910000
153100           AND B.PO_LNE_NBR = A.PO_LNE_NBR                        15920000
153200           AND B.VER_STATUS_CDE = 'A'                             15930000
153300           AND B.STATUS_CDE NOT IN ('CA', 'CB')                   15940000
153400     END-EXEC.                                                    15950000
153500                                                                  15960000
153600     EVALUATE TRUE                                                15970000
153700         WHEN SQLCODE = +0                                        15980000
153800         WHEN SQLCODE = +100                                      15990000
153900             CONTINUE                                             16000000
154000         WHEN SQLWARN NOT = SPACE                                 16010000
154100         WHEN SQLCODE NOT = +0                                    16020000
154200             MOVE '2320-GET-SHIPMENT-COUNTS - LINES'              16030000
154300                                   TO PV-ABEND-PARAGRAPH          16040000
154400             PERFORM 9000-SQL-ABEND                               16050000
154500     END-EVALUATE.                                                16060000
154600                                                                  16070000
154700     IF SQLCODE = +0                                              16080000
154800         MOVE PV-DB2-COUNT         TO HL5-LINES                   16090000
154900     ELSE                                                         16100000
155000         MOVE 0                    TO HL5-LINES                   16110000
155100     END-IF.                                                      16120000
155200                                                                  16130000
155300     EXEC SQL                                                     16140000
W24803         SELECT COUNT(DISTINCT(ITM_NBR))                          16150000
155500         INTO  :PV-DB2-COUNT                                      16160000
155600         FROM TALLPLN A, TPURITM B                                16170000
155700         WHERE A.PO_NBR = :IR-PO-NBR2                             16180000
155800           AND A.CURR_SPLIT_QTY > +0                              16190000
155900           AND A.DEST_NBR = :ALLPLN-DEST-NBR                      16200000
156000           AND B.PO_NBR = A.PO_NBR                                16210000
156100           AND B.PO_LNE_NBR = A.PO_LNE_NBR                        16220000
156200           AND B.VER_STATUS_CDE = 'A'                             16230000
156300           AND B.STATUS_CDE NOT IN ('CA', 'CB')                   16240000
156400     END-EXEC.                                                    16250000
156500                                                                  16260000
156600     EVALUATE TRUE                                                16270000
156700         WHEN SQLCODE = +0                                        16280000
156800         WHEN SQLCODE = +100                                      16290000
156900             CONTINUE                                             16300000
157000         WHEN SQLWARN NOT = SPACE                                 16310000
157100         WHEN SQLCODE NOT = +0                                    16320000
157200             MOVE '2320-GET-SHIPMENT-COUNTS - SKUS'               16330000
157300                                   TO PV-ABEND-PARAGRAPH          16340000
157400             PERFORM 9000-SQL-ABEND                               16350000
157500     END-EVALUATE.                                                16360000
157600                                                                  16370000
157700     IF SQLCODE = +0                                              16380000
157800         MOVE PV-DB2-COUNT         TO HL6-SKUS                    16390000
157900     ELSE                                                         16400000
158000         MOVE 0                    TO HL6-SKUS                    16410000
158100     END-IF.                                                      16420000
158200                                                                  16430000
158300                                                                  16440000
158400******************************************************************16450000
158500*  CLOSES UPC CURSOR                                              16460000
158600******************************************************************16470000
158700*2326-CLOSE-UPC-CSR.                                              16480016
158800*                                                                 16490016
158900*    EXEC SQL                                                     16500016
159000*        CLOSE UPC_CURSOR                                         16510016
159100*    END-EXEC.                                                    16520016
159200*                                                                 16530016
159300*    EVALUATE TRUE                                                16540016
159400*        WHEN SQLCODE = +0                                        16550016
159500*            CONTINUE                                             16560016
159600*        WHEN SQLWARN NOT = SPACE                                 16570016
159700*        WHEN SQLCODE NOT = +0                                    16580016
159800*            MOVE '2326-CLOSE-UPC-CSR'                            16590016
159900*                                  TO PV-ABEND-PARAGRAPH          16600016
160000*            PERFORM 9000-SQL-ABEND                               16610016
160100*    END-EVALUATE.                                                16620016
160200                                                                  16630000
160300******************************************************************16640000
160400*  CONTROLS INSTRUCTION PROCESSING                                16650000
160500******************************************************************16660000
160600 2330-PROCESS-INSTRUCTION.                                        16670000
160700                                                                  16680000
160800     WRITE POSIRPT-RECORD FROM INSTR-HEADER                       16690000
160900         AFTER 2 LINES.                                           16700000
161000     ADD +2                        TO PV-LINE-CNT.                16710000
161100     SET PS-NOT-EOF-INST-CSR       TO TRUE.                       16720000
161200     PERFORM 2331-OPEN-INST-CSR.                                  16730000
161300     PERFORM 2332-PROCESS-INST-CSR                                16740000
161400         UNTIL PS-EOF-INST-CSR.                                   16750000
161500     PERFORM 2333-CLOSE-INST-CSR.                                 16760000
161600                                                                  16770000
161700                                                                  16780000
161800******************************************************************16790000
161900*  OPENS INSTRUCTION CODE CSR                                     16800000
162000******************************************************************16810000
162100 2331-OPEN-INST-CSR.                                              16820000
162200                                                                  16830000
162300     EXEC SQL                                                     16840000
162400         OPEN INST-CSR                                            16850000
162500     END-EXEC.                                                    16860000
162600                                                                  16870000
162700     EVALUATE TRUE                                                16880000
162800         WHEN SQLCODE = +0                                        16890000
162900             CONTINUE                                             16900000
163000         WHEN SQLWARN NOT = SPACE                                 16910000
163100         WHEN SQLCODE NOT = +0                                    16920000
163200             MOVE '2331-OPEN-INST-CSR'                            16930000
163300                                   TO PV-ABEND-PARAGRAPH          16940000
163400             PERFORM 9000-SQL-ABEND                               16950000
163500     END-EVALUATE.                                                16960000
163600                                                                  16970000
163700                                                                  16980000
163800******************************************************************16990000
163900*  FETCHS INSTRUCTION CSR AND PRINTS                              17000000
164000******************************************************************17010000
164100 2332-PROCESS-INST-CSR.                                           17020000
164200                                                                  17030000
164300     EXEC SQL                                                     17040000
164400         FETCH INST-CSR                                           17050000
164500         INTO  :INSTCD-INSTR-DESC,                                17060000
164600               :INSTCD-INSTR-NBR                                  17070000
164700     END-EXEC.                                                    17080000
164800                                                                  17090000
164900     EVALUATE TRUE                                                17100000
165000         WHEN SQLCODE = +0                                        17110000
165100         WHEN SQLCODE = +100                                      17120000
165200             CONTINUE                                             17130000
165300         WHEN SQLWARN NOT = SPACE                                 17140000
165400         WHEN SQLCODE NOT = +0                                    17150000
165500             MOVE '2332-PROCESS-INST-CSR'                         17160000
165600                                   TO PV-ABEND-PARAGRAPH          17170000
165700             PERFORM 9000-SQL-ABEND                               17180000
165800     END-EVALUATE.                                                17190000
165900                                                                  17200000
166000     IF SQLCODE = +100                                            17210000
166100         SET PS-EOF-INST-CSR       TO TRUE                        17220000
166200     ELSE                                                         17230000
166300         IF PV-LINE-CNT > +58                                     17240000
166400             ADD +1                TO PV-PAGE-CNT                 17250000
166500             MOVE PV-PAGE-CNT      TO HL2-PAGE                    17260000
166600             MOVE +0               TO PV-LINE-CNT                 17270000
166700                                                                  17280000
166800             WRITE POSIRPT-RECORD FROM HEADER-LINE1               17290000
166900                 AFTER ADVANCING PAGE                             17300000
167000             WRITE POSIRPT-RECORD FROM HEADER-LINE2               17310000
167100                 AFTER 1 LINES                                    17320000
167200             WRITE POSIRPT-RECORD FROM HEADER-LINE3               17330000
167300                 AFTER 1 LINES                                    17340000
167400             WRITE POSIRPT-RECORD FROM HEADER-LINE4               17350000
167500                 AFTER 2 LINES                                    17360000
167600             WRITE POSIRPT-RECORD FROM HEADER-LINE5               17370000
167700                 AFTER 1 LINES                                    17380000
167800             WRITE POSIRPT-RECORD FROM HEADER-LINE6               17390000
167900                 AFTER 1 LINES                                    17400000
168000             WRITE POSIRPT-RECORD FROM HEADER-LINE7               17410000
168100                 AFTER 1 LINES                                    17420000
168200             WRITE POSIRPT-RECORD FROM HEADER-LINE8-B             17430000
168300                 AFTER 1 LINES                                    17440000
168400             WRITE POSIRPT-RECORD FROM INSTR-HEADER               17450000
168500                 AFTER 2 LINES                                    17460000
168600             MOVE +11              TO PV-LINE-CNT                 17470000
168700         END-IF                                                   17480000
168800                                                                  17490000
168900         MOVE INSTCD-INSTR-DESC    TO INSTR-DESC                  17500000
169000         WRITE POSIRPT-RECORD FROM INSTR-LINE                     17510000
169100             AFTER 1 LINES                                        17520000
169200         ADD +1                    TO PV-LINE-CNT                 17530000
169300     END-IF.                                                      17540000
169400                                                                  17550000
169500                                                                  17560000
169600******************************************************************17570000
169700*  CLOSES INSTRUCTION CODE CSR                                    17580000
169800******************************************************************17590000
169900 2333-CLOSE-INST-CSR.                                             17600000
170000                                                                  17610000
170100     EXEC SQL                                                     17620000
170200         CLOSE INST-CSR                                           17630000
170300     END-EXEC.                                                    17640000
170400                                                                  17650000
170500     EVALUATE TRUE                                                17660000
170600         WHEN SQLCODE = +0                                        17670000
170700             CONTINUE                                             17680000
170800         WHEN SQLWARN NOT = SPACE                                 17690000
170900         WHEN SQLCODE NOT = +0                                    17700000
171000             MOVE '2333-CLOSE-INST-CSR'                           17710000
171100                                   TO PV-ABEND-PARAGRAPH          17720000
171200             PERFORM 9000-SQL-ABEND                               17730000
171300     END-EVALUATE.                                                17740000
171400                                                                  17750000
171500                                                                  17760000
171600******************************************************************17770000
171700*  CONTROLS SKUS PROCESSING                                       17780000
171800******************************************************************17790000
171900 2340-PROCESS-SKUS.                                               17800000
172000                                                                  17810000
172100     SET PS-NOT-EOF-PO-LINE-CSR    TO TRUE.                       17820000
172200     PERFORM 2341-OPEN-PO-LINE-CSR.                               17830000
172300     PERFORM 2342-PROCESS-PO-LINE-CSR                             17840000
172400         UNTIL PS-EOF-PO-LINE-CSR.                                17850000
172500     PERFORM 2343-CLOSE-PO-LINE-CSR.                              17860000
172600                                                                  17870000
172700                                                                  17880000
172800******************************************************************17890000
172900*  OPENS PO LINE CSR                                              17900000
173000******************************************************************17910000
173100 2341-OPEN-PO-LINE-CSR.                                           17920000
173200                                                                  17930000
W24803     MOVE IR-PO-NBR2 TO ALLPLN-PO-NBR.                            17940000
173300     EXEC SQL                                                     17950000
173400         OPEN APP-PO-LINE-CSR                                     17960000
173500     END-EXEC.                                                    17970000
173600                                                                  17980000
173700     EVALUATE TRUE                                                17990000
173800         WHEN SQLCODE = +0                                        18000000
173900             CONTINUE                                             18010000
174000         WHEN SQLWARN NOT = SPACE                                 18020000
174100         WHEN SQLCODE NOT = +0                                    18030000
174200             MOVE '2341-OPEN-PO-LINE-CSR'                         18040000
174300                                   TO PV-ABEND-PARAGRAPH          18050000
174400             PERFORM 9000-SQL-ABEND                               18060000
174500     END-EVALUATE.                                                18070000
174600                                                                  18080000
174700                                                                  18090000
174800******************************************************************18100000
174900*  FETCHS PO LINE CSR AND PRINTS                                  18110000
175000******************************************************************18120000
175100 2342-PROCESS-PO-LINE-CSR.                                        18130000
175200                                                                  18140000
W24803     INITIALIZE  PV-NULL-INDICATOR-VARIABLES                      18150000
175300     EXEC SQL                                                     18160000
175400         FETCH APP-PO-LINE-CSR                                    18170000
175500         INTO :ALLPLN-CURR-SPLIT-QTY,                             18180000
175600              :ALLPLN-PLAN-NBR,                                   18190000
175700              :PURITM-CL-NBR,                                     18200000
175800              :PURITM-SKU-SEQ-NBR,                                18210000
175900              :PURITM-VEND-STYL-NAME,                             18220000
176000              :PURITM-SKU-DESC,                                   18230000
176100              :PURITM-COLOR-DESC,                                 18240000
176200              :PURITM-SIZE-DESC,                                  18250000
W24803              :XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND,             18260000
W24803              :XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND,             18270000
W24803              :XLT00003-SKU-NBR:PV-SKU-NBR-IND,                   18280000
W24803              :XLT00004-VS-NBR:PV-VS-NBR-IND,                     18290000
W24803              :XLT00003-SKU-DESC:PV-SKU-DESC-IND,                 18300000
W24803              :XLT00003-CSTM-CLOR-DESC:PV-CSTM-CLOR-DESC-IND,     18310000
W24803              :XLT00003-SIZE-DESC:PV-SIZE-DESC-IND,               18320000
176300              :PURITM-APP-PO-LNE-NBR,                             18330000
176400              :PURITM-PO-LNE-NBR,                                 18340000
176500              :PURITM-ITM-NBR,                                    18350000
176600              :PURITM-UNT-QTY                                     18360000
176700     END-EXEC.                                                    18370000
176800                                                                  18380000
176900     EVALUATE TRUE                                                18390000
177000         WHEN SQLCODE = +0                                        18400000
177100         WHEN SQLCODE = +100                                      18410000
177200             CONTINUE                                             18420000
177300         WHEN SQLWARN NOT = SPACE                                 18430000
177400         WHEN SQLCODE NOT = +0                                    18440000
177500             MOVE '2342-PROCESS-PO-LINE-CSR'                      18450000
177600                                   TO PV-ABEND-PARAGRAPH          18460000
177700             PERFORM 9000-SQL-ABEND                               18470000
177800     END-EVALUATE.                                                18480000
177900                                                                  18490000
178000     IF SQLCODE = +100                                            18500000
178100         SET PS-EOF-PO-LINE-CSR    TO TRUE                        18510000
178200     ELSE                                                         18520000
178300         MOVE +0                   TO PV-ALLOC-CNT                18530000
178400                                      PV-NBR-WRITES               18540000
178500                                      PV-UPC-DTL-CNT              18550000
178600*        PERFORM 2322-COUNT-POUPC-ROWS                            18560016
178700         IF PS-PACK-BY-STORE                                      18570000
178800             PERFORM 2351-COUNT-ALLOCATIONS                       18580000
178900             IF PV-ALLOC-CNT = +0                                 18590000
179000                    COMPUTE PV-TEMP-LINE-CNT = PV-LINE-CNT + 3    18600000
179100             ELSE                                                 18610000
179200                 IF PV-UPC-DTL-CNT = 0                            18620000
179300                    COMPUTE PV-TEMP-LINE-CNT ROUNDED =            18630000
179400                         PV-LINE-CNT + 7 + (PV-ALLOC-CNT / 7)     18640000
179500*                ELSE                                             18650018
179600*                   COMPUTE PV-TEMP-LINE-CNT ROUNDED =            18660018
179700*                        PV-LINE-CNT + 4 + (PV-ALLOC-CNT / 4)     18670018
179800                 END-IF                                           18680000
179900             END-IF                                               18690000
180000         ELSE                                                     18700000
180100               COMPUTE PV-TEMP-LINE-CNT = PV-LINE-CNT + 3         18710000
180200         END-IF                                                   18720000
180300                                                                  18730000
180400         IF PV-TEMP-LINE-CNT > +60                                18740000
180500             ADD +1                TO PV-PAGE-CNT                 18750000
180600             MOVE PV-PAGE-CNT      TO HL2-PAGE                    18760000
180700             MOVE +0               TO PV-LINE-CNT                 18770000
180800                                                                  18780000
180900             WRITE POSIRPT-RECORD FROM HEADER-LINE1               18790000
181000                 AFTER ADVANCING PAGE                             18800000
181100             WRITE POSIRPT-RECORD FROM HEADER-LINE2               18810000
181200                 AFTER 1 LINES                                    18820000
181300             WRITE POSIRPT-RECORD FROM HEADER-LINE3               18830000
181400                 AFTER 1 LINES                                    18840000
181500             WRITE POSIRPT-RECORD FROM HEADER-LINE4               18850000
181600                 AFTER 2 LINES                                    18860000
181700             WRITE POSIRPT-RECORD FROM HEADER-LINE5               18870000
181800                 AFTER 1 LINES                                    18880000
181900             WRITE POSIRPT-RECORD FROM HEADER-LINE6               18890000
182000                 AFTER 1 LINES                                    18900000
182100             WRITE POSIRPT-RECORD FROM HEADER-LINE7               18910000
182200                 AFTER 1 LINES                                    18920000
182300             WRITE POSIRPT-RECORD FROM HEADER-LINE8-B             18930000
182400                 AFTER 1 LINES                                    18940000
182500             MOVE +9               TO PV-LINE-CNT                 18950000
182600         END-IF                                                   18960000
182700                                                                  18970000
182800         MOVE PURITM-APP-PO-LNE-NBR                               18980000
182900                                   TO SL1-SKU-NBR                 18990000
183000                                                                  19000000
183100         MOVE PURCHS-DEPT-NBR      TO SL1-DEPT                    19010000
W24803         IF PV-SKU-NBR-IND = +0                                   19020000
W24803            MOVE XLT00004-MAJ-CL-NBR     TO SL1-MAJ-CLASS         19030000
W24803            MOVE XLT00004-SUB-CL-NBR     TO SL1-CLASS             19040000
W24803            MOVE XLT00003-SKU-NBR        TO SL1-SKU               19050000
W24803            MOVE XLT00004-VS-NBR         TO SL1-STYLE             19060000
W24803            MOVE XLT00003-SKU-DESC       TO SL1-DESC              19070000
W24803            MOVE XLT00003-CSTM-CLOR-DESC TO SL2-COLOR             19080000
W24803            MOVE XLT00003-SIZE-DESC      TO SL2-SIZE              19090000
W24803         ELSE                                                     19100000
W24803            MOVE PURITM-CL-NBR           TO SL1-CLASS             19110000
W24803            MOVE PURCHS-DEPT-NBR         TO PV-TEMP-DEPT          19120000
W24803            MOVE PURITM-CL-NBR           TO PV-TEMP-CLASS         19130000
W24803            MOVE PURITM-SKU-SEQ-NBR      TO PV-TEMP-SEQ           19140000
W24803            MOVE PV-TEMP-SKU             TO SL1-SKU               19150000
W24803            MOVE PURITM-CL-NBR(1:1)      TO PV-TEMP-MAJ-CL-1      19160000
W24803            MOVE PV-TEMP-MAJ-CL          TO SL1-MAJ-CLASS         19170000
W24803            MOVE PURITM-VEND-STYL-NAME   TO SL1-STYLE             19180000
W24803            MOVE PURITM-SKU-DESC         TO SL1-DESC              19190000
W24803            MOVE PURITM-COLOR-DESC       TO SL2-COLOR             19200000
W24803            MOVE PURITM-SIZE-DESC        TO SL2-SIZE              19210000
W24803         END-IF                                                   19220000
183700         MOVE ALLPLN-CURR-SPLIT-QTY                               19230000
183800                                   TO SL1-QTY                     19240000
184100*        IF SL2-SIZE = 'ASSORTED' AND PV-UPC-DTL-CNT > 0          19250018
184200*           MOVE 'SEE BELOW' TO SL2-SIZE                          19260018
184300*        END-IF                                                   19270018
184400                                                                  19280000
184500         WRITE POSIRPT-RECORD FROM SKU-LINE-1                     19290000
184600             AFTER 2 LINES                                        19300000
184700         WRITE POSIRPT-RECORD FROM SKU-LINE-2                     19310000
184800             AFTER 1 LINES                                        19320000
184900         ADD +3                    TO PV-LINE-CNT                 19330000
185000                                                                  19340000
185100         IF PV-ALLOC-CNT = +0                                     19350000
185200* IT'S A BULK ORDER - ONLY PROCESS DC SPLITS                      19360000
185300             PERFORM 2353-OPEN-SPLIT-CSR                          19370000
185400             MOVE +0               TO PV-SUB                      19380000
185500                                   PV-NBR-STORES                  19390000
185600                                   PV-NBR-STORES-PLAN             19400000
185700             SET PV-STR-IDX        TO +1                          19410000
                   MOVE +1 TO PV-NBR-STORES-PLAN                        19420000
185800             INITIALIZE PV-SAVE-TABLE                             19430000
185900             INITIALIZE DISTR-LINE                                19440000
186000             SET PS-NOT-EOF-SPLIT-CSR                             19450000
186100                                   TO TRUE                        19460000
186200             PERFORM 2354-PROCESS-SPLIT-CSR                       19470000
186300                 UNTIL PS-EOF-SPLIT-CSR                           19480000
186400             PERFORM 2355-CLOSE-SPLIT-CSR                         19490000
186500* GET ALL THE UPC'S FOR THIS SKU                                  19500000
186600*            SET PV-UPC-IDX TO +1                                 19510017
W24803*            IF PV-SKU-NBR-IND = +0                               19520017
186700*               SET PS-NOT-EOF-UPC-CSR TO TRUE                    19530016
186800*               PERFORM 2320-OPEN-UPC-CSR                         19540016
186900*               PERFORM 2350-FETCH-UPC-CSR                        19550016
187000*                       UNTIL PS-EOF-UPC-CSR                      19560016
187100*               PERFORM 2326-CLOSE-UPC-CSR                        19570016
W24803*            END-IF                                               19580017
187200* CALCULATE THE UPC QUANTITIES PER STORE                          19590000
187300*            PERFORM F100-COMPUTE-UPC-QTYS                        19600018
187400*            PERFORM F150-CHECK-IF-TOTALS                         19610018
187500             IF PS-PACK-BY-STORE                                  19620000
187600                IF PV-NBR-STORES-PLAN > 0                         19630000
187700                   PERFORM F160-MOVETO-DC-TABLE                   19640000
187800                   PERFORM F175-DISPLAY-PBS-QUANTITIES            19650000
187900*               ELSE                                              19660018
188000*                  PERFORM F175-DISP-UPC-QTY-BULK                 19670018
188100                END-IF                                            19680000
188200*            ELSE                                                 19690018
188300*               PERFORM F175-DISP-UPC-QTY-BULK                    19700018
188400             END-IF                                               19710000
188500                                                                  19720000
188600         ELSE                                                     19730000
188700             PERFORM 2370-ADVANCE-TO-NEWPAGE                      19740000
188800             WRITE POSIRPT-RECORD FROM DISTR-HEADER-1             19750000
188900                 AFTER 2 LINES                                    19760000
189000                 ADD  +2           TO PV-LINE-CNT                 19770000
189100             IF PV-UPC-DTL-CNT = 0                                19780000
189200                IF PV-ALLOC-CNT < +7                              19790000
189300                    CONTINUE                                      19800000
189400                ELSE                                              19810000
189500                    MOVE +7          TO PV-ALLOC-CNT              19820000
189600                END-IF                                            19830000
189700*            ELSE                                                 19840018
189800*               IF PV-ALLOC-CNT < +4                              19850018
189900*                   CONTINUE                                      19860018
190000*               ELSE                                              19870018
190100*                   MOVE +4   TO PV-ALLOC-CNT                     19880018
190200*               END-IF                                            19890018
190300             END-IF                                               19900000
190400                                                                  19910000
190500             INITIALIZE DISTR-LINE                                19920000
190600             PERFORM 2353-OPEN-ALLOC-CSR                          19930000
190700* THIS IS THE NBR WANT TO USE WHEN WRITING STORES PER PLAN!!!     19940000
190800             MOVE +0            TO PV-NBR-STORES-PLAN             19950000
190900             SET PS-NOT-EOF-ALLOC-CSR                             19960000
191000                                   TO TRUE                        19970000
191100             PERFORM 2354-PROCESS-ALLOC-CSR                       19980000
191200                 UNTIL PS-EOF-ALLOC-CSR                           19990000
191300             PERFORM 2355-CLOSE-ALLOC-CSR                         20000000
191400* HERE                                                            20010000
191500             PERFORM 2353-OPEN-ALLOC-CSR2                         20020000
191600             MOVE +0               TO PV-SUB                      20030000
191700* THIS IS NBR OF ALL STORES FOR ALL PLANS                         20040000
191800                                   PV-NBR-STORES                  20050000
191900             SET PV-STR-IDX        TO +1                          20060000
192000             INITIALIZE PV-SAVE-TABLE                             20070000
192100             SET PS-NOT-EOF-ALLOC2-CSR                            20080000
192200                                   TO TRUE                        20090000
192300             PERFORM 2354-PROCESS-ALLOC-CSR2                      20100000
192400                 UNTIL PS-EOF-ALLOC2-CSR                          20110000
192500             PERFORM 2355-CLOSE-ALLOC-CSR2                        20120000
192600                                                                  20130000
192700* GET ALL THE UPC'S FOR THIS SKU                                  20140000
192800*            SET PV-UPC-IDX TO +1                                 20150017
W24803*            IF PV-SKU-NBR-IND = +0                               20160017
192900*               SET PS-NOT-EOF-UPC-CSR TO TRUE                    20170016
193000*               PERFORM 2320-OPEN-UPC-CSR                         20180016
193100*               PERFORM 2350-FETCH-UPC-CSR                        20190016
193200*                       UNTIL PS-EOF-UPC-CSR                      20200016
193300*               PERFORM 2326-CLOSE-UPC-CSR                        20210016
W24803*            END-IF                                               20220017
193400* CALCULATE THE UPC QUANTITIES PER STORE                          20230000
193500*            PERFORM F100-COMPUTE-UPC-QTYS                        20240018
193600*            PERFORM F150-CHECK-IF-TOTALS                         20250018
193700             IF PS-PACK-BY-STORE                                  20260000
193800                IF PV-NBR-STORES-PLAN > 0                         20270000
193900                   PERFORM F160-MOVETO-DC-TABLE                   20280000
194000                   PERFORM F175-DISPLAY-PBS-QUANTITIES            20290000
194100*               ELSE                                              20300018
194200*                  PERFORM F175-DISP-UPC-QTY-BULK                 20310018
194300                END-IF                                            20320000
194400*            ELSE                                                 20330018
194500*               PERFORM F175-DISP-UPC-QTY-BULK                    20340018
194600             END-IF                                               20350000
194700         END-IF                                                   20360000
194800     END-IF.                                                      20370000
194900                                                                  20380000
195000                                                                  20390000
195100******************************************************************20400000
195200*  CLOSES PO LINE CSR                                             20410000
195300******************************************************************20420000
195400 2343-CLOSE-PO-LINE-CSR.                                          20430000
195500                                                                  20440000
195600     EXEC SQL                                                     20450000
195700         CLOSE APP-PO-LINE-CSR                                    20460000
195800     END-EXEC.                                                    20470000
195900                                                                  20480000
196000     EVALUATE TRUE                                                20490000
196100         WHEN SQLCODE = +0                                        20500000
196200             CONTINUE                                             20510000
196300         WHEN SQLWARN NOT = SPACE                                 20520000
196400         WHEN SQLCODE NOT = +0                                    20530000
196500             MOVE '2343-CLOSE-PO-LINE-CSR'                        20540000
196600                                   TO PV-ABEND-PARAGRAPH          20550000
196700             PERFORM 9000-SQL-ABEND                               20560000
196800     END-EVALUATE.                                                20570000
196900                                                                  20580000
197000                                                                  20590000
197100******************************************************************20600000
197200*  FETCHS UPC_CURSOR                                              20610000
197300******************************************************************20620000
197400*2350-FETCH-UPC-CSR.                                              20630016
197500*                                                                 20640016
197600*    EXEC SQL                                                     20650016
197700*        FETCH UPC_CURSOR                                         20660016
W24803*         INTO :XLT00003-SIZE-DESC                                20670016
197900*              ,:POUPC-UPC-QTY                                    20680016
W24803*              ,:XLT00003-KOHLS-SIZE-CDE                          20690016
198300*    END-EXEC.                                                    20700016
198400*                                                                 20710016
198500*    EVALUATE TRUE                                                20720016
198600*        WHEN SQLCODE = +0                                        20730016
198700*        WHEN SQLCODE = +100                                      20740016
198800*            CONTINUE                                             20750016
198900*        WHEN SQLWARN NOT = SPACE                                 20760016
199000*        WHEN SQLCODE NOT = +0                                    20770016
199100*            MOVE '2350-FETCH-UPC-CSR'                            20780016
199200*                                  TO PV-ABEND-PARAGRAPH          20790016
199300*            PERFORM 9000-SQL-ABEND                               20800016
199400*    END-EVALUATE.                                                20810016
199500*                                                                 20820016
199600*    IF SQLCODE = +100                                            20830016
199700*        SET PS-EOF-UPC-CSR      TO TRUE                          20840016
199800*    ELSE                                                         20850016
199900* MOVE THE UPC'S TO THE SAVE TABLE IN EACH STORE POSITION         20860000
200000*          PERFORM                                                20870016
200100*          VARYING PV-STR-IDX                                     20880016
200200*          FROM 1 BY 1                                            20890016
200300*          UNTIL PV-STR-IDX > PV-NBR-STORES                       20900016
200400*            OR PV-STR-IDX > 2000                                 20910016
W24803*                   MOVE XLT00003-SIZE-DESC TO                    20920016
200600*                        PV-SAVE-UPC-DESC (PV-STR-IDX PV-UPC-IDX) 20930016
200700*                   MOVE POUPC-UPC-QTY TO                         20940016
200800*                        PV-SAVE-POUPC-QTY(PV-STR-IDX PV-UPC-IDX) 20950016
200900*          END-PERFORM                                            20960016
201000*          SET PV-UPC-IDX UP BY +1                                20970016
201100*    END-IF.                                                      20980016
201200                                                                  20990000
201300******************************************************************21000000
201400*  COUNT ALLOCATIONS FOR PO                                       21010000
201500******************************************************************21020000
201600 2351-COUNT-ALLOCATIONS.                                          21030000
201700                                                                  21040000
201800     EXEC SQL                                                     21050000
201900         SELECT COUNT(*)                                          21060000
202000         INTO :PV-ALLOC-CNT                                       21070000
202100         FROM TMESTDS                                             21080000
202200         WHERE PO_NBR = :IR-PO-NBR2                               21090000
202300           AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                    21100000
202400           AND PLAN_NBR = :ALLPLN-PLAN-NBR                        21110000
                 AND STR_DISTRO_QTY > 0                                 21120000
202500     END-EXEC.                                                    21130000
202600                                                                  21140000
202700     EVALUATE TRUE                                                21150000
202800         WHEN SQLCODE = +0                                        21160000
202900             CONTINUE                                             21170000
203000         WHEN SQLWARN NOT = SPACE                                 21180000
203100         WHEN SQLCODE NOT = +0                                    21190000
203200             MOVE '2351-COUNT-ALLOCATIONS'                        21200000
203300                                   TO PV-ABEND-PARAGRAPH          21210000
203400             PERFORM 9000-SQL-ABEND                               21220000
203500     END-EVALUATE.                                                21230000
203600                                                                  21240000
203700******************************************************************21250000
203800*  GET THE DC NBR FOR THE STORE - USED IN PACK BY STORE DISPLAYING21260000
203900******************************************************************21270000
204000 2360-GET-DC-NMBR.                                                21280000
204200     EXEC SQL                                                     21290000
204300              SELECT C.LOC_NBR                                    21300000
204400                INTO :PV-DC-NBR                                   21310000
204500                FROM XMT_LOC A,                                   21320000
204600                     TPLNSHP B,                                   21330000
204700                     XMT_LOC C                                    21340000
204800              WHERE  A.LOC_NBR = :PV-STR-NBR                      21350000
P15284                AND  A.LOC_TYP_CDE IN ('CS', 'DS', 'RV', 'DC')    21360000
205000                AND  B.PO_NBR = :IR-PO-NBR2                       21370000
205100                AND  B.VER_STATUS_CDE = 'A'                       21380000
                      AND  C.LOC_NBR =                                  21390000
                          (SELECT DC_NBR                                21400000
                             FROM XMT_DC_LOC_ASGMT DLA1                 21410000
                            WHERE DLA1.LOC_NBR = A.LOC_NBR              21420000
                              AND DLA1.PO_STRT_DTE =                    21430000
                                 (SELECT MAX(PO_STRT_DTE)               21440000
                                    FROM XMT_DC_LOC_ASGMT DLA2          21450000
                                   WHERE DLA2.PO_STRT_DTE <=            21460000
                                         B.DONT_SHIP_BEF_DTE            21470000
                                     AND DLA1.LOC_NBR = DLA2.LOC_NBR))  21480000
205600                AND C.LOC_TYP_CDE = 'DC'                          21490000
205700*               AND NOT EXISTS (                                  21500014
205800*                 SELECT G.SHIP_TO_TMP_DC_NBR                     21510014
205900*                   FROM TSTVNDC G,                               21520014
206000*                        TPLNSHP H,                               21530014
206100*                        TPURCHS I                                21540014
206200*                 WHERE  G.STR_NBR = :PV-STR-NBR                  21550014
206300*                   AND  H.PO_NBR = B.PO_NBR                      21560014
206400*                   AND  H.PO_NBR = I.PO_NBR                      21570014
206500*                   AND  H.VER_STATUS_CDE = 'A'                   21580014
206600*                   AND  I.VER_STATUS_CDE = 'A'                   21590014
206700*                   AND  G.ENT_ID = I.ENT_ID                      21600014
206800*                   AND (G.DEPT_NBR = '999'                       21610014
206900*                          OR G.DEPT_NBR = I.DEPT_NBR)            21620014
207000*                   AND  H.DONT_SHIP_BEF_DTE BETWEEN              21630014
207100*                        G.EFF_BEG_DTE AND                        21640014
207200*                               G.EFF_END_DTE)                    21650014
210400*             UNION                                               21660014
210500*             SELECT J.LOC_NBR                                    21670014
210600*               INTO :PV-DC-NBR                                   21680014
210700*               FROM TSTVNDC G,                                   21690014
210800*                    TPLNSHP H,                                   21700014
210900*                    TPURCHS I,                                   21710014
211000*                    XMT_LOC J                                    21720014
211100*             WHERE  G.STR_NBR = :PV-STR-NBR                      21730014
211200*               AND  H.PO_NBR = :IR-PO-NBR2                       21740014
211300*               AND  H.PO_NBR = I.PO_NBR                          21750014
211400*               AND  H.VER_STATUS_CDE = 'A'                       21760014
211500*               AND  I.VER_STATUS_CDE = 'A'                       21770014
211600*               AND  G.ENT_ID = I.ENT_ID                          21780014
211700*               AND (G.DEPT_NBR = '999'                           21790014
211800*                      OR G.DEPT_NBR = I.DEPT_NBR)                21800014
211900*               AND  H.DONT_SHIP_BEF_DTE BETWEEN                  21810014
212000*                    G.EFF_BEG_DTE AND                            21820014
212100*                           G.EFF_END_DTE                         21830014
212200*               AND  G.SHIP_TO_TMP_DC_NBR = J.LOC_NBR             21840014
212300     END-EXEC.                                                    21850000
212400                                                                  21860000
212500     EVALUATE TRUE                                                21870000
212600         WHEN SQLCODE = ZERO                                      21880000
212700             CONTINUE                                             21890000
212800         WHEN SQLCODE = +100                                      21900000
212900             MOVE ZERO TO PV-DC-NBR                               21910000
213000                                                                  21920000
213100         WHEN SQLWARN0 NOT = SPACES                               21930000
213200         WHEN SQLCODE NOT = +0                                    21940000
213300             MOVE '2360-GET-DC-NMBR'                              21950000
213400                                   TO PV-ABEND-PARAGRAPH          21960000
213500             DISPLAY ' BAD PO # IS ' IR-PO-NBR2                   21970000
213600             DISPLAY ' BAD STR # IS ' PV-STR-NBR                  21980000
213700             PERFORM 9000-SQL-ABEND                               21990000
213800     END-EVALUATE.                                                22000000
213900                                                                  22010000
214000 2370-ADVANCE-TO-NEWPAGE.                                         22020000
214100        IF PV-LINE-CNT > +58                                      22030000
214200            ADD +1                 TO PV-PAGE-CNT                 22040000
214300            MOVE PV-PAGE-CNT       TO HL2-PAGE                    22050000
214400            MOVE +0                TO PV-LINE-CNT                 22060000
214500                                                                  22070000
214600            WRITE POSIRPT-RECORD FROM HEADER-LINE1                22080000
214700                AFTER ADVANCING PAGE                              22090000
214800            WRITE POSIRPT-RECORD FROM HEADER-LINE2                22100000
214900                AFTER 1 LINES                                     22110000
215000            WRITE POSIRPT-RECORD FROM HEADER-LINE3                22120000
215100                AFTER 1 LINES                                     22130000
215200            WRITE POSIRPT-RECORD FROM HEADER-LINE4                22140000
215300                AFTER 2 LINES                                     22150000
215400            WRITE POSIRPT-RECORD FROM HEADER-LINE5                22160000
215500                AFTER 1 LINES                                     22170000
215600            WRITE POSIRPT-RECORD FROM HEADER-LINE6                22180000
215700                AFTER 1 LINES                                     22190000
215800            WRITE POSIRPT-RECORD FROM HEADER-LINE7                22200000
215900                AFTER 1 LINES                                     22210000
216000            WRITE POSIRPT-RECORD FROM HEADER-LINE8-B              22220000
216100                AFTER 1 LINES                                     22230000
216200            MOVE +9                TO PV-LINE-CNT                 22240000
216300        END-IF.                                                   22250000
216400                                                                  22260000
216500                                                                  22270000
216600******************************************************************22280000
216700*  COUNT UPC DETAIL ROWS FOR THIS LINE.                           22290000
216800******************************************************************22300000
216900*2322-COUNT-POUPC-ROWS.                                           22310016
217000*                                                                 22320016
217100*    EXEC SQL                                                     22330016
217200*        SELECT COUNT(*)                                          22340016
217300*        INTO :PV-UPC-DTL-CNT                                     22350016
217400*        FROM TPOUPC                                              22360016
217500*        WHERE PO_NBR = :IR-PO-NBR2                               22370016
217600*          AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                    22380016
217700*    END-EXEC.                                                    22390016
217800*                                                                 22400016
217900*    EVALUATE TRUE                                                22410016
218000*        WHEN SQLCODE = +0                                        22420016
218100*            CONTINUE                                             22430016
218200*        WHEN SQLWARN NOT = SPACE                                 22440016
218300*        WHEN SQLCODE NOT = +0                                    22450016
218400*            MOVE '2322-COUNT-POUPC-ROWS'                         22460016
218500*                                  TO PV-ABEND-PARAGRAPH          22470016
218600*            PERFORM 9000-SQL-ABEND                               22480016
218700*    END-EVALUATE.                                                22490016
218800                                                                  22500000
218900                                                                  22510000
219000******************************************************************22520000
219100*  FILL DISTRIBUTION HEADER LINE 2 WITH HEADINGS BASED ON         22530000
219200*  NUMBER OF ALLOCATIONS PRESENT                                  22540000
219300******************************************************************22550000
219400*2322-FILL-DIST-HEAD3.                                            22560000
219500                                                                  22570000
219600*    MOVE PC-UPC-QTY               TO DH3-COL-HDR (PV-SUB2).      22580000
219700                                                                  22590000
219800******************************************************************22600000
219900*  FILL DISTRIBUTION HEADER LINE 2 WITH HEADINGS BASED ON         22610000
220000*  NUMBER OF ALLOCATIONS PRESENT                                  22620000
220100******************************************************************22630000
220200*2352-FILL-DIST-HEAD2.                                            22640018
220300*                                                                 22650018
220400*    MOVE PC-STORE-QTY             TO DH2-COL-HDR (PV-SUB1).      22660018
220500******************************************************************22670000
220600*  FILL DISTRIBUTION HEADER LINE 2 WITH HEADINGS BASED ON         22680000
220700*  NUMBER OF ALLOCATIONS PRESENT                                  22690000
220800******************************************************************22700000
220900 2352-FILL-DIST-HEAD2-OLD.                                        22710000
221000                                                                  22720000
221100     MOVE PC-STORE-QTY-OLD         TO DH2-COL-HDR-OLD (PV-SUB1).  22730000
221200                                                                  22740000
221300                                                                  22750000
221400******************************************************************22760000
221500*  FILL DISTRIBUTION HEADER LINE 2 WITH HEADINGS BASED ON         22770000
221600*  NUMBER OF ALLOCATIONS PRESENT                                  22780000
221700******************************************************************22790000
221800*2352-FILL-DIST-HEAD2-BULK.                                       22800011
221900*                                                                 22810011
222000*    MOVE PC-STORE-QTY-BULK        TO DH2-COL-HDR (PV-SUB1).      22820011
222100*                                                                 22830011
222200                                                                  22840000
222300******************************************************************22850000
222400*  OPENS ALLOCATION CSR                                           22860000
222500******************************************************************22870000
222600 2353-OPEN-ALLOC-CSR.                                             22880000
222700                                                                  22890000
222800     EXEC SQL                                                     22900000
222900         OPEN ALLOC-CSR                                           22910000
223000     END-EXEC.                                                    22920000
223100                                                                  22930000
223200     EVALUATE TRUE                                                22940000
223300         WHEN SQLCODE = +0                                        22950000
223400             CONTINUE                                             22960000
223500         WHEN SQLWARN NOT = SPACE                                 22970000
223600         WHEN SQLCODE NOT = +0                                    22980000
223700             MOVE '2353-OPEN-ALLOC-CSR'                           22990000
223800                                   TO PV-ABEND-PARAGRAPH          23000000
223900             PERFORM 9000-SQL-ABEND                               23010000
224000     END-EVALUATE.                                                23020000
224100******************************************************************23030000
224200*  OPENS ALLOCATION CSR2                                          23040000
224300******************************************************************23050000
224400 2353-OPEN-ALLOC-CSR2.                                            23060000
224500                                                                  23070000
224600     EXEC SQL                                                     23080000
224700         OPEN ALLOC-CSR2                                          23090000
224800     END-EXEC.                                                    23100000
224900                                                                  23110000
225000     EVALUATE TRUE                                                23120000
225100         WHEN SQLCODE = +0                                        23130000
225200             CONTINUE                                             23140000
225300         WHEN SQLWARN NOT = SPACE                                 23150000
225400         WHEN SQLCODE NOT = +0                                    23160000
225500             MOVE '2353-OPEN-ALLOC-CSR2'                          23170000
225600                                   TO PV-ABEND-PARAGRAPH          23180000
225700             PERFORM 9000-SQL-ABEND                               23190000
225800     END-EVALUATE.                                                23200000
225900******************************************************************23210000
226000*  OPENS SPLIT CSR                                                23220000
226100******************************************************************23230000
226200 2353-OPEN-SPLIT-CSR.                                             23240000
226300                                                                  23250000
226400     EXEC SQL                                                     23260000
226500         OPEN SPLIT-CSR                                           23270000
226600     END-EXEC.                                                    23280000
226700                                                                  23290000
226800     EVALUATE TRUE                                                23300000
226900         WHEN SQLCODE = +0                                        23310000
227000             CONTINUE                                             23320000
227100         WHEN SQLWARN NOT = SPACE                                 23330000
227200         WHEN SQLCODE NOT = +0                                    23340000
227300             MOVE '2353-OPEN-SPLIT-CSR'                           23350000
227400                                   TO PV-ABEND-PARAGRAPH          23360000
227500             PERFORM 9000-SQL-ABEND                               23370000
227600     END-EVALUATE.                                                23380000
227700                                                                  23390000
227800******************************************************************23400000
227900*  FETCHS ALLOCATION CSR AND WRITES ALLOCATION LINES              23410000
228000******************************************************************23420000
228100 2354-PROCESS-ALLOC-CSR.                                          23430000
228200                                                                  23440000
228300     EXEC SQL                                                     23450000
228400         FETCH ALLOC-CSR                                          23460000
228500         INTO  :MESTDS-STR-NBR,                                   23470000
228600               :MESTDS-STR-DISTRO-QTY,                            23480000
228700               :XMT00001-LOC-5-ABBR-NM                            23490000
228800     END-EXEC.                                                    23500000
228900                                                                  23510000
229000     EVALUATE TRUE                                                23520000
229100         WHEN SQLCODE = +0                                        23530000
229200         WHEN SQLCODE = +100                                      23540000
229300             CONTINUE                                             23550000
229400         WHEN SQLWARN NOT = SPACE                                 23560000
229500         WHEN SQLCODE NOT = +0                                    23570000
229600             MOVE '2354-PROCESS-ALLOC-CSR'                        23580000
229700                                   TO PV-ABEND-PARAGRAPH          23590000
229800             PERFORM 9000-SQL-ABEND                               23600000
229900     END-EVALUATE.                                                23610000
230000                                                                  23620000
230100     IF SQLCODE = +100                                            23630000
230200         SET PS-EOF-ALLOC-CSR      TO TRUE                        23640000
230300     ELSE                                                         23650000
230400         ADD +1              TO PV-NBR-STORES-PLAN                23660000
230500     END-IF.                                                      23670000
230600                                                                  23680000
230700                                                                  23690000
230800******************************************************************23700000
230900*  FETCHS ALLOCATION CSR AND WRITES ALLOCATION LINES              23710000
231000******************************************************************23720000
231100 2354-PROCESS-ALLOC-CSR2.                                         23730000
231200                                                                  23740000
231300     EXEC SQL                                                     23750000
231400         FETCH ALLOC-CSR2                                         23760000
231500         INTO  :MESTDS-STR-NBR,                                   23770000
231600               :MESTDS-STR-DISTRO-QTY,                            23780000
231700               :XMT00001-LOC-5-ABBR-NM                            23790000
231800     END-EXEC.                                                    23800000
231900                                                                  23810000
232000     EVALUATE TRUE                                                23820000
232100         WHEN SQLCODE = +0                                        23830000
232200         WHEN SQLCODE = +100                                      23840000
232300             CONTINUE                                             23850000
232400         WHEN SQLWARN NOT = SPACE                                 23860000
232500         WHEN SQLCODE NOT = +0                                    23870000
232600             MOVE '2354-PROCESS-ALLOC-CSR2'                       23880000
232700                                   TO PV-ABEND-PARAGRAPH          23890000
232800             PERFORM 9000-SQL-ABEND                               23900000
232900     END-EVALUATE.                                                23910000
233000                                                                  23920000
233100     IF SQLCODE = +100                                            23930000
233200         SET PS-EOF-ALLOC2-CSR     TO TRUE                        23940000
233300     ELSE                                                         23950000
233400         ADD +1              TO PV-NBR-STORES                     23960000
233500         MOVE MESTDS-STR-NBR TO PV-SAVE-STR-NBR(PV-STR-IDX)       23970000
233600         MOVE XMT00001-LOC-5-ABBR-NM                              23980000
233700                             TO PV-SAVE-STR-NAME(PV-STR-IDX)      23990000
233800         MOVE MESTDS-STR-DISTRO-QTY                               24000000
233900                             TO PV-SAVE-STR-QTY(PV-STR-IDX)       24010000
234000         SET PV-STR-IDX UP BY +1                                  24020000
234100     END-IF.                                                      24030000
234200                                                                  24040000
234300                                                                  24050000
234400******************************************************************24060000
234500*  FETCHS SPLIT CSR AND WRITES DC SPLITS                          24070000
234600******************************************************************24080000
234700 2354-PROCESS-SPLIT-CSR.                                          24090000
234800                                                                  24100000
234900     EXEC SQL                                                     24110000
235000         FETCH SPLIT-CSR                                          24120000
235100         INTO  :ALLPLN-CURR-SPLIT-QTY,                            24130000
235200               :ALLPLN-DEST-NBR                                   24140000
235300     END-EXEC.                                                    24150000
235400                                                                  24160000
235500     EVALUATE TRUE                                                24170000
235600         WHEN SQLCODE = +0                                        24180000
235700         WHEN SQLCODE = +100                                      24190000
235800             CONTINUE                                             24200000
235900         WHEN SQLWARN NOT = SPACE                                 24210000
236000         WHEN SQLCODE NOT = +0                                    24220000
236100             MOVE '2354-PROCESS-SPLIT-CSR'                        24230000
236200                                   TO PV-ABEND-PARAGRAPH          24240000
236300             PERFORM 9000-SQL-ABEND                               24250000
236400     END-EVALUATE.                                                24260000
236500                                                                  24270000
236600     EVALUATE TRUE                                                24280000
236700     WHEN SQLCODE = +100                                          24290000
236800         SET PS-EOF-SPLIT-CSR      TO TRUE                        24300000
236700     WHEN SQLCODE = +0                                            24310000
238600          MOVE ALLPLN-DEST-NBR TO PV-SAVE-STR-NBR(PV-STR-IDX)     24320000
238700          MOVE SPACES TO PV-SAVE-STR-NAME(PV-STR-IDX)             24330000
238800          MOVE ALLPLN-CURR-SPLIT-QTY                              24340000
238900                               TO PV-SAVE-STR-QTY(PV-STR-IDX)     24350000
236800          ADD +1              TO PV-NBR-STORES-PLAN               24360000
                                       PV-NBR-STORES                    24370000
                SET PV-STR-IDX UP BY +1                                 24380000
           WHEN OTHER                                                   24390000
               IF PURCHS-DIR-STR-IND = 'N'                              24400000
053700            DISPLAY '** DC ' ALLPLN-DEST-NBR                      24410000
053700                    ' NOT FOUND IN LIST **'                       24420000
053800            MOVE '2354-PROCESS-SPLIT-CSR ' TO PV-ABEND-PARAGRAPH  24430000
053900            MOVE +4003 TO PV-ABEND-CODE                           24440000
054000            PERFORM 9900-ABEND                                    24450000
               END-IF                                                   24460000
238400     END-EVALUATE.                                                24470000
238500                                                                  24480000
239000                                                                  24490000
239100     IF PURCHS-DIR-STR-IND = 'Y'                                  24500000
239200        SET PV-STR-IDX UP BY +1                                   24510000
239300        ADD +1 TO PV-NBR-STORES                                   24520000
239400     END-IF.                                                      24530000
239500                                                                  24540000
239600                                                                  24550000
239700******************************************************************24560000
239800*  CLOSES ALLOCATION                                              24570000
239900******************************************************************24580000
240000 2355-CLOSE-ALLOC-CSR.                                            24590000
240100                                                                  24600000
240200     EXEC SQL                                                     24610000
240300         CLOSE ALLOC-CSR                                          24620000
240400     END-EXEC.                                                    24630000
240500                                                                  24640000
240600     EVALUATE TRUE                                                24650000
240700         WHEN SQLCODE = +0                                        24660000
240800             CONTINUE                                             24670000
240900         WHEN SQLWARN NOT = SPACE                                 24680000
241000         WHEN SQLCODE NOT = +0                                    24690000
241100             MOVE '2355-CLOSE-ALLOC-CSR'                          24700000
241200                                   TO PV-ABEND-PARAGRAPH          24710000
241300             PERFORM 9000-SQL-ABEND                               24720000
241400     END-EVALUATE.                                                24730000
241500******************************************************************24740000
241600*  CLOSES ALLOCATION CSR2                                         24750000
241700******************************************************************24760000
241800 2355-CLOSE-ALLOC-CSR2.                                           24770000
241900                                                                  24780000
242000     EXEC SQL                                                     24790000
242100         CLOSE ALLOC-CSR2                                         24800000
242200     END-EXEC.                                                    24810000
242300                                                                  24820000
242400     EVALUATE TRUE                                                24830000
242500         WHEN SQLCODE = +0                                        24840000
242600             CONTINUE                                             24850000
242700         WHEN SQLWARN NOT = SPACE                                 24860000
242800         WHEN SQLCODE NOT = +0                                    24870000
242900             MOVE '2355-CLOSE-ALLOC-CSR2'                         24880000
243000                                   TO PV-ABEND-PARAGRAPH          24890000
243100             PERFORM 9000-SQL-ABEND                               24900000
243200     END-EVALUATE.                                                24910000
243300******************************************************************24920000
243400*  CLOSES SPLIT CSR                                               24930000
243500******************************************************************24940000
243600 2355-CLOSE-SPLIT-CSR.                                            24950000
243700                                                                  24960000
243800     EXEC SQL                                                     24970000
243900         CLOSE SPLIT-CSR                                          24980000
244000     END-EXEC.                                                    24990000
244100                                                                  25000000
244200     EVALUATE TRUE                                                25010000
244300         WHEN SQLCODE = +0                                        25020000
244400             CONTINUE                                             25030000
244500         WHEN SQLWARN NOT = SPACE                                 25040000
244600         WHEN SQLCODE NOT = +0                                    25050000
244700             MOVE '2355-CLOSE-SPLIT-CSR'                          25060000
244800                                   TO PV-ABEND-PARAGRAPH          25070000
244900             PERFORM 9000-SQL-ABEND                               25080000
245000     END-EVALUATE.                                                25090000
245100                                                                  25100000
245200                                                                  25110000
245300******************************************************************25120000
245400*  CLOSES SHIPMENT CURSOR                                         25130000
245500******************************************************************25140000
245600 2400-CLOSE-SHIPMENT-CURSOR.                                      25150000
245700                                                                  25160000
245800     EXEC SQL                                                     25170000
245900         CLOSE SHIP-CSR                                           25180000
246000     END-EXEC.                                                    25190000
246100                                                                  25200000
246200     EVALUATE TRUE                                                25210000
246300         WHEN SQLCODE = +0                                        25220000
246400             CONTINUE                                             25230000
246500         WHEN SQLWARN NOT = SPACE                                 25240000
246600         WHEN SQLCODE NOT = +0                                    25250000
246700             MOVE '2400-CLOSE-SHIP-CSR'                           25260000
246800                                   TO PV-ABEND-PARAGRAPH          25270000
246900             PERFORM 9000-SQL-ABEND                               25280000
247000     END-EVALUATE.                                                25290000
247100                                                                  25300000
247200*----------------------------------------------------------------*25310000
247300*    NAME REFORMATOR MODULE                                      *25320000
247400*----------------------------------------------------------------*25330000
247500                                                                  25340000
247600     COPY DPPD024.                                                25350000
247700                                                                  25360000
260000                                                                  25370000
260100*F100-COMPUTE-UPC-QTYS.                                           25380018
260200*     PERFORM                                                     25390018
260300*       VARYING PV-STR-IDX                                        25400018
260400*       FROM +1 BY +1                                             25410018
260500*       UNTIL PV-STR-IDX > PV-NBR-STORES                          25420018
260600*          OR PV-STR-IDX > 2000                                   25430018
260700*            PERFORM                                              25440018
260800*              VARYING PV-UPC-IDX                                 25450018
260900*              FROM +1 BY +1                                      25460018
261000*              UNTIL PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) =    25470018
261100*                          SPACES                                 25480018
261200*                 OR PV-UPC-IDX > 50                              25490018
261300*                   COMPUTE PV-UPC-PCT = PV-SAVE-POUPC-QTY        25500018
261400*                       (PV-STR-IDX PV-UPC-IDX) / PURITM-UNT-QTY  25510018
261500*                   COMPUTE PV-QTY ROUNDED =                      25520018
261600*                       PV-UPC-PCT * PV-SAVE-STR-QTY(PV-STR-IDX)  25530018
261700*                   COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-IDX) =    25540018
261800*                        PV-QTY + PV-SAVE-STR-SUBTOTAL(PV-STR-IDX)25550018
261900* KEEP A RUNNING TOTAL OF THE UPC QUANTITIES FOR ALL STORES       25560000
262000*                   IF PV-STR-IDX = +1                            25570018
262100*                     MOVE PV-QTY TO PV-SAVE-UPC-SUBTOTAL         25580018
262200*                      (PV-STR-IDX PV-UPC-IDX)                    25590018
262300*                   ELSE                                          25600018
262400*                        SET PV-STR-ADJ TO PV-STR-IDX             25610018
262500*                        SET PV-STR-IDX DOWN BY +1                25620018
262600*                        COMPUTE PV-SAVE-UPC-SUBTOTAL(PV-STR-ADJ  25630018
262700*                      PV-UPC-IDX) = PV-QTY + PV-SAVE-UPC-SUBTOTAL25640018
262800*                                          (PV-STR-IDX PV-UPC-IDX)25650018
262900*                        SET PV-STR-IDX UP BY +1                  25660018
263000*                   END-IF                                        25670018
263100*                   MOVE PV-QTY TO PV-SAVE-UPC-QTY-STR            25680018
263200*                                         (PV-STR-IDX PV-UPC-IDX) 25690018
263300*            END-PERFORM                                          25700018
263400*     END-PERFORM.                                                25710018
263500                                                                  25720000
263600 EJECT                                                            25730000
263700                                                                  25740000
263800*F150-CHECK-IF-TOTALS.                                            25750018
263900* MAKE SURE THE UPC TOTALS ARE WHAT IS GIVEN ON TPOUPC            25760000
264000* ALSO MAKE SURE THE STORE QUANTITIES ADD UP TO TMESTDS TOTAL     25770000
264100*     PERFORM                                                     25780018
264200*       VARYING PV-STR-IDX                                        25790018
264300*       FROM +1 BY +1                                             25800018
264400*       UNTIL PV-STR-IDX > PV-NBR-STORES                          25810018
264500*          OR PV-STR-IDX > 2000                                   25820018
264600*          MOVE ZERO TO PV-UPC-TOTAL-QTY                          25830018
264700*            PERFORM                                              25840018
264800*              VARYING PV-UPC-IDX                                 25850018
264900*              FROM +1 BY +1                                      25860018
265000*              UNTIL PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) =    25870018
265100*                          SPACES                                 25880018
265200*                 OR PV-UPC-IDX > 50                              25890018
265300*                   ADD PV-SAVE-UPC-QTY-STR(PV-STR-IDX PV-UPC-IDX)25900018
265400*                          TO PV-UPC-TOTAL-QTY                    25910018
265500*            END-PERFORM                                          25920018
265600* VERIFY THAT THE SPLIT QUANTITIES ADD UP TO THE UPC TOTAL        25930000
265700*            IF PV-UPC-TOTAL-QTY NOT = PV-SAVE-STR-QTY(PV-STR-IDX)25940018
265800*                 SET PV-STR-ADJ TO PV-STR-IDX                    25950018
265900*                 IF PURCHS-DIR-STR-IND = 'Y'                     25960018
266000*                    PERFORM F200-ADJUST-SPLIT-QTYS-DTS           25970018
266100*                 ELSE                                            25980018
266200*                    PERFORM F200-ADJUST-SPLIT-QUANTITIES         25990018
266300*                 END-IF                                          26000018
266400*            END-IF                                               26010018
266500*     END-PERFORM.                                                26020018
266600*                                                                 26030018
266700*     SET PV-STR-IDX DOWN BY +1.                                  26040018
266800*     PERFORM                                                     26050018
266900*       VARYING PV-UPC-IDX                                        26060018
267000*       FROM +1 BY +1                                             26070018
267100*       UNTIL PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) = SPACES    26080018
267200*           OR PV-UPC-IDX > 50                                    26090018
267300*           IF (NOT PV-SAVE-UPC-SUBTOTAL(PV-STR-IDX PV-UPC-IDX) = 26100018
267400*                  PV-SAVE-POUPC-QTY(1 PV-UPC-IDX))               26110018
267500*                 PERFORM F200-ADJUST-SPLIT-QTY-STR               26120018
267600*           END-IF                                                26130018
267700*     END-PERFORM.                                                26140018
267800                                                                  26150000
267900                                                                  26160000
268000 F160-MOVETO-DC-TABLE.                                            26170000
268100* MOVE ONLY THE STORES FOR THE CURRENT DC TO THE DC-TABLE FOR     26180000
268200* DISPLAY ON THE SHIPPING INSTRUCTIONS REPORT                     26190000
268300      INITIALIZE PV-DC-TABLE.                                     26200000
268400      PERFORM                                                     26210000
268500        VARYING PV-DC-STR-IDX                                     26220000
268600        FROM +1 BY +1                                             26230000
268700        UNTIL PV-DC-STR-IDX > PV-NBR-STORES                       26240000
268800*            PERFORM                                              26250018
268900*              VARYING PV-UPC-IDX                                 26260018
269000*              FROM +1 BY +1                                      26270018
269100*              UNTIL PV-UPC-IDX > 50                              26280018
269200*                MOVE SPACES TO PV-DC-UPC-DESC(PV-DC-STR-IDX      26290018
269300*                                                     PV-UPC-IDX) 26300018
269400*            END-PERFORM                                          26310018
269500      END-PERFORM.                                                26320000
269600                                                                  26330000
269700      SET PV-DC-STR-IDX TO +1.                                    26340000
269800      PERFORM                                                     26350000
269900        VARYING PV-STR-IDX                                        26360000
270000        FROM +1 BY +1                                             26370000
270100        UNTIL PV-STR-IDX > PV-NBR-STORES                          26380000
270200           OR PV-STR-IDX > 2000                                   26390000
270300             MOVE PV-SAVE-STR-NBR(PV-STR-IDX) TO PV-STR-NBR       26400000
270400             PERFORM 2360-GET-DC-NMBR                             26410000
270500             IF PV-DC-NBR = ALLPLN-DEST-NBR                       26420000
270600                MOVE PV-SAVE-STR-NBR(PV-STR-IDX) TO PV-DC-STR-NBR 26430000
270700                                                  (PV-DC-STR-IDX) 26440000
270800                MOVE PV-SAVE-STR-NAME(PV-STR-IDX) TO              26450000
270900                                    PV-DC-STR-NAME(PV-DC-STR-IDX) 26460000
271000                MOVE PV-SAVE-STR-QTY(PV-STR-IDX) TO PV-DC-STR-QTY 26470000
271100                                                  (PV-DC-STR-IDX) 26480000
271200*               PERFORM                                           26490018
271300*                 VARYING PV-UPC-IDX                              26500018
271400*                 FROM +1 BY +1                                   26510018
271500*                 UNTIL PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) = 26520018
271600*                          SPACES                                 26530018
271700*                    OR PV-UPC-IDX > 50                           26540018
271800*                    MOVE PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) 26550018
271900*                      TO PV-DC-UPC-DESC(PV-DC-STR-IDX PV-UPC-IDX)26560018
272000*                    MOVE PV-SAVE-UPC-QTY-STR(PV-STR-IDX          26570018
272100*                                      PV-UPC-IDX)                26580018
272200*                      TO PV-DC-UPC-QTY-STR(PV-DC-STR-IDX         26590018
272300*                                      PV-UPC-IDX)                26600018
272400*               END-PERFORM                                       26610018
272500                SET PV-DC-STR-IDX UP BY +1                        26620000
272600             END-IF                                               26630000
272700      END-PERFORM.                                                26640000
272800                                                                  26650000
272900                                                                  26660000
273000                                                                  26670000
273100        INITIALIZE DISTR-LINE.                                    26680000
273200        MOVE +0           TO PV-SUB                               26690000
273300                             PV-SUB3                              26700000
273400                             PV-SUB4                              26710000
273500                             PV-SUB5                              26720000
273600                             PV-TIMES2.                           26730000
273700        PERFORM                                                   26740000
273800          VARYING PV-STR-IDX                                      26750000
273900          FROM +1 BY +1                                           26760000
274000          UNTIL PV-SUB4    = PV-NBR-STORES-PLAN                   26770000
274100          OR PV-STR-IDX > 2000                                    26780000
274200* PV-SUB REPRESENTS THE IDX VALUE IN PV-SAVE-STR-TABLE            26790000
274300                ADD +1         TO PV-SUB                          26800000
274400                                  PV-SUB5                         26810000
274500                MOVE PV-SAVE-STR-NBR(PV-STR-IDX) TO PV-STR-NBR    26820000
274600                PERFORM 2360-GET-DC-NMBR                          26830000
274700                IF PV-DC-NBR = ALLPLN-DEST-NBR                    26840000
274800* PV-SUB3 REPRESENTS WHICH 1 OF 4 STORES TO DISPLAY ON THE SCREEN 26850000
274900                   ADD +1         TO PV-SUB3                      26860000
275000                   MOVE PV-SAVE-STR-NBR(PV-STR-IDX)               26870000
275100                                     TO DL-STR-NBR(PV-SUB3)       26880000
275200                                                                  26890000
275300                   ADD +1 TO PV-SUB4                              26900000
275400                   MOVE PV-SAVE-STR-NAME(PV-STR-IDX)              26910000
275500                                     TO DL-STR-NAME(PV-SUB3)      26920000
275600                   MOVE 'TOTAL' TO DL-TOTAL-HDR(PV-SUB3)          26930000
275700                   MOVE PV-SAVE-STR-QTY(PV-STR-IDX)               26940000
275800                                     TO DL-QTY(PV-SUB3)           26950000
275900                ELSE                                              26960000
276000* KEEP GOING THRU SAVE-TABLE UNTIL HIT A STR FOR THE CURRENT DC   26970000
276100* THAT YOU HAVEN'T ALREADY DISPLAYED QUANTITIES FOR               26980000
276200                   PERFORM                                        26990000
276300                   VARYING PV-STR-IDX                             27000000
276400                   FROM PV-STR-IDX BY +1                          27010000
276500                     UNTIL PV-SUB4    > PV-NBR-STORES-PLAN        27020000
276600                       OR  PV-DC-NBR = ALLPLN-DEST-NBR            27030000
P15284                       OR  PV-STR-IDX > 2000                      27040009
276700                          ADD +1         TO PV-SUB                27050000
276800                          MOVE PV-SAVE-STR-NBR(PV-STR-IDX)        27060000
276900                                         TO PV-STR-NBR            27070000
277000                          PERFORM 2360-GET-DC-NMBR                27080000
277100                                                                  27090000
277200                          IF PV-DC-NBR = ALLPLN-DEST-NBR          27100000
277300* PV-SUB3 REPRESENTS WHICH 1 OF 4 STORES TO DISPLAY ON THE SCREEN 27110000
277400                              ADD +1         TO PV-SUB3           27120000
277500                              MOVE PV-SAVE-STR-NBR(PV-STR-IDX)    27130000
277600                                           TO DL-STR-NBR(PV-SUB3) 27140000
277700                              ADD +1 TO PV-SUB4                   27150000
277800                              MOVE PV-SAVE-STR-NAME(PV-STR-IDX)   27160000
277900                                          TO DL-STR-NAME(PV-SUB3) 27170000
278000                              MOVE 'TOTAL' TO DL-TOTAL-HDR        27180000
278100                                                  (PV-SUB3)       27190000
278200                              MOVE PV-SAVE-STR-QTY(PV-STR-IDX)    27200000
278300                                          TO DL-QTY(PV-SUB3)      27210000
278400                          END-IF                                  27220000
278500                          ADD +1 TO         PV-SUB5               27230000
278600                   END-PERFORM                                    27240000
278700                   SUBTRACT +1 FROM PV-SUB5                       27250000
278800                   SET PV-STR-IDX DOWN BY +1                      27260000
278900                END-IF                                            27270000
279000                IF PV-SUB3 = +4                                   27280000
279100                   ADD +1 TO PV-TIMES2                            27290000
279200*               PERFORM                                           27300018
279300*                 VARYING PV-UPC-IDX                              27310018
279400*                 FROM +1 BY +1                                   27320018
279500*                 UNTIL PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) = 27330018
279600*                       SPACES OR PV-UPC-IDX > 50                 27340018
279700*                    COMPUTE PV-START = PV-TIMES2 * 4             27350018
279800*                    COMPUTE PV-START = PV-START - 3              27360018
279900*                    MOVE 0 TO PV-TIMES                           27370018
280000*                              PV-SUB5                            27380018
280100*                              PV-TIMES4                          27390018
280200*                    PERFORM                                      27400018
280300*                      VARYING PV-START                           27410018
280400*                      FROM PV-START BY +1                        27420018
280500*                      UNTIL PV-SUB5 = 4                          27430018
280600*                        MOVE PV-SAVE-STR-NBR(PV-START)           27440018
280700*                                      TO PV-STR-NBR              27450018
280800*                        ADD +1 TO PV-TIMES4                      27460018
280900*                        PERFORM 2360-GET-DC-NMBR                 27470018
281000*                        IF PV-DC-NBR = ALLPLN-DEST-NBR           27480018
281100*                           ADD +1 TO PV-TIMES                    27490018
281200*                                     PV-SUB5                     27500018
281300*                           MOVE PV-SAVE-UPC-DESC(PV-START        27510018
281400*                            PV-UPC-IDX) TO DL-UPC-DESC(PV-TIMES) 27520018
281500*                           MOVE PV-SAVE-UPC-QTY-STR(PV-START     27530018
281600*                             PV-UPC-IDX) TO DL-UPC-QTY(PV-TIMES) 27540018
281700*                        END-IF                                   27550018
281800*                    END-PERFORM                                  27560018
281900*                    PERFORM 2370-ADVANCE-TO-NEWPAGE              27570018
282000*                    IF PV-LINE-CNT = 9                           27580018
282100*                       WRITE POSIRPT-RECORD FROM UPC-LINE        27590018
282200*                                      AFTER 2 LINES              27600018
282300*                       ADD +2                   TO PV-LINE-CNT   27610018
282400*                    ELSE                                         27620018
282500*                       WRITE POSIRPT-RECORD FROM UPC-LINE        27630018
282600*                                      AFTER 1 LINES              27640018
282700*                       ADD +1                   TO PV-LINE-CNT   27650018
282800*                    END-IF                                       27660018
282900*               END-PERFORM                                       27670018
283000                MOVE +0           TO PV-SUB                       27680000
283100                                     PV-SUB3                      27690000
283200                INITIALIZE DISTR-LINE                             27700000
283300             ELSE                                                 27710000
283400               IF PV-SUB3 < 4 AND PV-SUB4 = PV-NBR-STORES-PLAN    27720000
283500                   COMPUTE PV-START = PV-TIMES2 * 4               27730000
283600                   COMPUTE PV-NBR-WRITE = PV-NBR-STORES-PLAN      27740000
283700                                                       - PV-START 27750000
283800                   INITIALIZE DISTR-HEADER-2                      27760000
283900* WRITE ALL THE UPCS FOR THIS SKU (UP TO 4 STORES WORTH)          27770000
284000                IF PV-TIMES2  = 0                                 27780000
284100                   MOVE +1 TO PV-TIMES4                           27790000
284200                ELSE                                              27800000
284300                   ADD  +1 TO PV-TIMES4                           27810000
284400                END-IF                                            27820000
284500*               PERFORM                                           27830018
284600*                 VARYING PV-UPC-IDX                              27840018
284700*                 FROM +1 BY +1                                   27850018
284800*                 UNTIL PV-SAVE-UPC-DESC(PV-STR-IDX PV-UPC-IDX) = 27860018
284900*                       SPACES OR PV-UPC-IDX > 50                 27870018
285000*                    COMPUTE PV-START = PV-TIMES2 * 4             27880018
285100*                    COMPUTE PV-NBR-WRITE = PV-NBR-STORES-PLAN    27890018
285200*                                                      - PV-START 27900018
285300*                    MOVE 0 TO PV-TIMES PV-SUB5                   27910018
285400*                    PERFORM                                      27920018
285500*                      VARYING PV-START                           27930018
285600*                      FROM PV-TIMES4 BY +1                       27940018
285700*                      UNTIL PV-SUB5 = PV-NBR-WRITE               27950018
285800*                        MOVE PV-SAVE-STR-NBR(PV-START)           27960018
285900*                                      TO PV-STR-NBR              27970018
286000*                        PERFORM 2360-GET-DC-NMBR                 27980018
286100*                        IF PV-DC-NBR = ALLPLN-DEST-NBR           27990018
286200*                           ADD +1 TO PV-SUB5                     28000018
286300*                                     PV-TIMES                    28010018
286400*                           MOVE PV-SAVE-UPC-DESC(PV-START        28020018
286500*                            PV-UPC-IDX) TO DL-UPC-DESC(PV-TIMES) 28030018
286600*                           MOVE PV-SAVE-UPC-QTY-STR(PV-START     28040018
286700*                             PV-UPC-IDX) TO DL-UPC-QTY(PV-TIMES) 28050018
286800*                        END-IF                                   28060018
286900*                    END-PERFORM                                  28070018
287000*                    PERFORM 2370-ADVANCE-TO-NEWPAGE              28080018
287100*                    IF PV-LINE-CNT = 9                           28090018
287200*                       WRITE POSIRPT-RECORD FROM UPC-LINE        28100018
287300*                                      AFTER 2 LINES              28110018
287400*                       ADD +2                   TO PV-LINE-CNT   28120018
287500*                    ELSE                                         28130018
287600*                       WRITE POSIRPT-RECORD FROM UPC-LINE        28140018
287700*                                      AFTER 1 LINES              28150018
287800*                       ADD +1                   TO PV-LINE-CNT   28160018
287900*                    END-IF                                       28170018
288000*               END-PERFORM                                       28180018
288100                MOVE +0           TO PV-SUB                       28190000
288200                                     PV-SUB3                      28200000
288300             END-IF                                               28210000
288400             END-IF                                               28220000
288500          END-PERFORM.                                            28230000
288600                                                                  28240000
288700 EJECT                                                            28250000
288800                                                                  28260000
288900 F175-DISPLAY-PBS-QUANTITIES.                                     28270000
289000        INITIALIZE DISTR-LINE.                                    28280000
289100        INITIALIZE DISTR-LINE-OLD.                                28290000
289200        MOVE +0           TO PV-SUB                               28300000
289300                             PV-TIMES2.                           28310000
289400                                                                  28320000
289500        IF PV-UPC-DTL-CNT = 0                                     28330000
289600           INITIALIZE DISTR-HEADER-3                              28340000
289700           IF PV-NBR-STORES-PLAN > 7                              28350000
289800              MOVE PV-ALLOC-CNT TO PV-NBR-TIMES                   28360000
289900           ELSE                                                   28370000
290000              MOVE PV-NBR-STORES-PLAN TO PV-NBR-TIMES             28380000
290100           END-IF                                                 28390000
290200           PERFORM 2370-ADVANCE-TO-NEWPAGE                        28400000
290300           PERFORM 2352-FILL-DIST-HEAD2-OLD                       28410000
290400               VARYING PV-SUB1 FROM +1 BY +1                      28420000
290500               UNTIL PV-SUB1 > PV-NBR-TIMES                       28430000
290600*    PRINT ' --STORE--  QUANTITY   '.                             28440000
290700           WRITE POSIRPT-RECORD FROM DISTR-HEADER-3               28450000
290800               AFTER 1 LINES                                      28460000
290900           ADD +1              TO PV-LINE-CNT                     28470000
291000*       ELSE                                                      28480018
291100*           INITIALIZE DISTR-HEADER-2                             28490018
291200*           IF PV-NBR-STORES > 5                                  28500018
291300*              MOVE PV-ALLOC-CNT TO PV-NBR-TIMES                  28510018
291400*           ELSE                                                  28520018
291500*              MOVE PV-NBR-STORES TO PV-NBR-TIMES                 28530018
291600*           END-IF                                                28540018
291700*           PERFORM 2370-ADVANCE-TO-NEWPAGE                       28550018
291800*           PERFORM 2352-FILL-DIST-HEAD2                          28560018
291900*               VARYING PV-SUB1 FROM +1 BY +1                     28570018
292000*               UNTIL PV-SUB1 > PV-NBR-TIMES                      28580018
292100* PRINT  ' --STORE--  ---SIZE---  QUANTITY   '.                   28590000
292200*           WRITE POSIRPT-RECORD FROM DISTR-HEADER-2              28600018
292300*               AFTER 1 LINES                                     28610018
292400*           ADD +1             TO PV-LINE-CNT                     28620018
292500        END-IF.                                                   28630000
292600        PERFORM                                                   28640000
292700          VARYING PV-DC-STR-IDX                                   28650000
292800          FROM +1 BY +1                                           28660000
292900          UNTIL PV-DC-STR-IDX > PV-NBR-STORES-PLAN                28670000
293000            OR PV-DC-STR-NBR(PV-DC-STR-IDX) = 0                   28680000
293100            OR PV-DC-STR-IDX > 2000                               28690000
293200             ADD +1            TO PV-SUB                          28700000
293300             IF PV-UPC-DTL-CNT = 0                                28710000
293400               MOVE PV-DC-STR-NBR(PV-DC-STR-IDX)                  28720000
293500                                 TO DL-STR-NBR-OLD(PV-SUB)        28730000
293600               MOVE PV-DC-STR-NAME(PV-DC-STR-IDX)                 28740000
293700                                 TO DL-STR-NAME-OLD(PV-SUB)       28750000
293800               MOVE PV-DC-STR-QTY(PV-DC-STR-IDX)                  28760000
293900                                 TO DL-QTY-OLD(PV-SUB)            28770000
294000               PERFORM 2375-DISPLAY-NON-POUPC-LINES               28780000
294100*            ELSE                                                 28790018
294200*              MOVE PV-DC-STR-NBR(PV-DC-STR-IDX)                  28800018
294300*                                TO DL-STR-NBR(PV-SUB)            28810018
294400*              MOVE PV-DC-STR-NAME(PV-DC-STR-IDX)                 28820018
294500*                                TO DL-STR-NAME(PV-SUB)           28830018
294600*              MOVE PV-DC-STR-QTY(PV-DC-STR-IDX)                  28840018
294700*                                TO DL-QTY(PV-SUB)                28850018
294800*              MOVE 'TOTAL' TO DL-TOTAL-HDR(PV-SUB)               28860018
294900*              PERFORM 2375-DISPLAY-POUPC-LINES                   28870018
295000             END-IF                                               28880000
295100        END-PERFORM.                                              28890000
295200                                                                  28900000
295300 EJECT                                                            28910000
295400*F175-DISP-UPC-QTY-BULK.                                          28920018
295500* WRITE ALL THE UPCS FOR THIS SKU (1 DC WORTH) BULK ORDER         28930000
296700*           IF PURCHS-DIR-STR-IND = 'Y'                           28940018
296800*               PERFORM                                           28950018
296900*                 VARYING PV-UPC-IDX                              28960018
297000*                 FROM +1 BY +1                                   28970018
297100*                 UNTIL PV-SAVE-UPC-DESC(PV-SHIP-NBR              28980018
297200*                       PV-UPC-IDX)                               28990018
297300*                    =  SPACES OR PV-UPC-IDX > 50                 29000018
297400*                        MOVE PV-SAVE-UPC-DESC(PV-SHIP-NBR        29010018
297500*                         PV-UPC-IDX)  TO DL-UPC-DESC(1)          29020018
297600*                        MOVE PV-SAVE-UPC-QTY-STR(PV-SHIP-NBR     29030018
297700*                          PV-UPC-IDX)   TO DL-UPC-QTY(1)         29040018
297800*                    PERFORM 2370-ADVANCE-TO-NEWPAGE              29050018
297900*                    IF PV-LINE-CNT = 9                           29060018
298000*                       WRITE POSIRPT-RECORD FROM UPC-LINE        29070018
298100*                                         AFTER 2 LINES           29080018
298200*                       ADD +2                   TO PV-LINE-CNT   29090018
298300*                    ELSE                                         29100018
298400*                       WRITE POSIRPT-RECORD FROM UPC-LINE        29110018
298500*                                        AFTER 1 LINES            29120018
298600*                       ADD +1                   TO PV-LINE-CNT   29130018
298700*                    END-IF                                       29140018
298800*               END-PERFORM                                       29150018
298900*             ELSE                                                29160018
299000*               PERFORM                                           29170018
299100*                 VARYING PV-UPC-IDX                              29180018
299200*                 FROM +1 BY +1                                   29190018
299300*                 UNTIL PV-SAVE-UPC-DESC(PV-SHIP-NBR-DISP         29200018
299400*                       PV-UPC-IDX)                               29210018
299500*                    =  SPACES OR PV-UPC-IDX > 50                 29220018
299600*                        MOVE PV-SAVE-UPC-DESC(PV-SHIP-NBR-DISP   29230018
299700*                         PV-UPC-IDX)  TO DL-UPC-DESC(1)          29240018
299800*                        MOVE PV-SAVE-UPC-QTY-STR(PV-SHIP-NBR-DISP29250018
299900*                          PV-UPC-IDX)   TO DL-UPC-QTY(1)         29260018
300000*                    PERFORM 2370-ADVANCE-TO-NEWPAGE              29270018
300100*                    IF PV-LINE-CNT = 9                           29280018
300200*                       WRITE POSIRPT-RECORD FROM UPC-LINE        29290018
300300*                                         AFTER 2 LINES           29300018
300400*                       ADD +2                   TO PV-LINE-CNT   29310018
300500*                    ELSE                                         29320018
300600*                       WRITE POSIRPT-RECORD FROM UPC-LINE        29330018
300700*                                         AFTER 1 LINES           29340018
300800*                       ADD +1                   TO PV-LINE-CNT   29350018
300900*                    END-IF                                       29360018
301000*               END-PERFORM                                       29370018
301100*             END-IF.                                             29380018
301200                                                                  29390000
301300*F200-ADJUST-SPLIT-QUANTITIES.                                    29400020
301400* SORT THE TABLE BY QUANTITY (DESCENDING ORDER)                   29410000
301500*     PERFORM F300-SORT-QUANTITIES-DESC.                          29420000
301600*     COMPUTE PV-DIFF =                                           29430020
301700*              PV-SAVE-STR-QTY(PV-STR-ADJ) - PV-UPC-TOTAL-QTY     29440020
301800*     IF PV-DIFF > 0                                              29450020
301900*        SET PS-ADD     TO TRUE                                   29460020
302000*     ELSE                                                        29470020
302100*        SET PS-SUBTR   TO TRUE                                   29480020
302200*     END-IF.                                                     29490020
302300*                                                                 29500020
302400*     MOVE PV-DIFF TO PV-ABS-DIFF.                                29510020
302500*     MOVE +0 TO PV-TIMES-THROUGH.                                29520020
302600*                                                                 29530020
302700*        PERFORM                                                  29540018
302800*           VARYING PV-UPC-IDX                                    29550018
302900*           FROM +1 BY +1                                         29560018
303000*           UNTIL PV-UPC-IDX > 50                                 29570018
303100*             OR PV-SAVE-UPC-DESC(PV-STR-ADJ PV-UPC-IDX) = SPACES 29580018
303200*             OR PV-TIMES-THROUGH = PV-ABS-DIFF                   29590018
303300*              ADD +1 TO PV-TIMES-THROUGH                         29600018
303400*           IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 0 OR  29610018
303500*              PV-SAVE-STR-QTY(PV-STR-ADJ) > 0                    29620018
303600*              IF PS-ADD                                          29630018
303700*                IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX)29640018
303800*                     >= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 29650018
303900*                  AND (PV-UPC-TOTAL-QTY = PV-SAVE-STR-QTY(       29660018
304000*                  PV-STR-ADJ))                                   29670018
304100*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            29680018
304200*                 ELSE                                            29690018
304300*                    ADD +1 TO PV-SAVE-UPC-QTY-STR(PV-STR-ADJ     29700018
304400*                                                     PV-UPC-IDX) 29710018
304500*                              PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES 29720018
304600*                                                     PV-UPC-IDX) 29730018
304700*                              PV-UPC-TOTAL-QTY                   29740018
304800*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   29750018
304900*                           1 + PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)  29760018
305000*                 END-IF                                          29770018
305100*              ELSE                                               29780018
305200*                IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 029790018
305300*               IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX) 29800018
305400*                     <= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 29810018
305500*                  AND (PV-UPC-TOTAL-QTY = PV-SAVE-STR-QTY(       29820018
305600*                  PV-STR-ADJ)                                    29830018
305700*                  AND PV-UPC-IDX = PV-UPC-DTL-CNT)               29840018
305800*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            29850018
305900*                ELSE                                             29860018
306000*                    SUBTRACT +1 FROM                             29870018
306100*                       PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX)29880018
306200*                      PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES         29890018
306300*                                           PV-UPC-IDX)           29900018
306400*                       PV-UPC-TOTAL-QTY                          29910018
306500*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   29920018
306600*                            PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1 29930018
306700*                END-IF                                           29940018
306800*               END-IF                                            29950018
306900*              END-IF                                             29960018
307000*           END-IF                                                29970018
307100*        END-PERFORM.                                             29980018
307200                                                                  29990000
307300                                                                  30000000
307400*        IF PV-SAVE-UPC-DESC(PV-STR-ADJ PV-UPC-IDX) = SPACES      30010018
307500*           AND NOT PV-TIMES-THROUGH = PV-ABS-DIFF                30020018
307600*        PERFORM                                                  30030018
307700*           VARYING PV-UPC-IDX                                    30040018
307800*           FROM +1 BY +1                                         30050018
307900*           UNTIL PV-UPC-IDX > 50                                 30060018
308000*             OR PV-SAVE-UPC-DESC(PV-STR-ADJ PV-UPC-IDX) = SPACES 30070018
308100*             OR PV-TIMES-THROUGH = PV-ABS-DIFF                   30080018
308200*              ADD +1 TO PV-TIMES-THROUGH                         30090018
308300*           IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 0 OR  30100018
308400*              PV-SAVE-STR-QTY(PV-STR-ADJ) > 0                    30110018
308500*              IF PS-ADD                                          30120018
308600*                COMPUTE PV-UPC-QTY-TEMP = 1 +                    30130018
308700*                PV-SAVE-UPC-SUBTOTAL(PV-STR-ADJ PV-UPC-IDX)      30140018
308800*                 IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES           30150018
308900*                       PV-UPC-IDX) = PV-SAVE-POUPC-QTY(PV-STR-ADJ30160018
309000*                            PV-UPC-IDX)                          30170018
309100*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            30180018
309200*                 ELSE                                            30190018
309300*                    ADD +1 TO PV-SAVE-UPC-QTY-STR(PV-STR-ADJ     30200018
309400*                                                     PV-UPC-IDX) 30210018
309500*                              PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES 30220018
309600*                                                     PV-UPC-IDX) 30230018
309700*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   30240018
309800*                           1 + PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)  30250018
309900*                 END-IF                                          30260018
310000*              ELSE                                               30270018
310100*                IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 030280018
310200*                  COMPUTE PV-UPC-QTY-TEMP =                      30290018
310300*                  PV-SAVE-UPC-SUBTOTAL(PV-STR-ADJ PV-UPC-IDX) - 130300018
310400*               IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX) 30310018
310500*                     = PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX)  30320018
310600*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            30330018
310700*                ELSE                                             30340018
310800*                    SUBTRACT +1 FROM                             30350018
310900*                       PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX)30360018
311000*                      PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES         30370018
311100*                                           PV-UPC-IDX)           30380018
311200*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   30390018
311300*                            PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1 30400018
311400*                END-IF                                           30410018
311500*               END-IF                                            30420018
311600*              END-IF                                             30430018
311700*           END-IF                                                30440018
311800*        END-PERFORM                                              30450018
311900*       END-IF.                                                   30460018
312000                                                                  30470000
312100*F200-ADJUST-SPLIT-QTYS-DTS.                                      30480020
312200*     COMPUTE PV-DIFF =                                           30490020
312300*              PV-SAVE-STR-QTY(PV-STR-ADJ) - PV-UPC-TOTAL-QTY     30500020
312400*     IF PV-DIFF > 0                                              30510020
312500*        SET PS-ADD     TO TRUE                                   30520020
312600*     ELSE                                                        30530020
312700*        SET PS-SUBTR   TO TRUE                                   30540020
312800*     END-IF.                                                     30550020
312900*                                                                 30560020
313000*     MOVE PV-DIFF TO PV-ABS-DIFF.                                30570020
313100*     MOVE +0 TO PV-TIMES-THROUGH.                                30580020
313200*                                                                 30590020
313300*        PERFORM                                                  30600018
313400*           VARYING PV-UPC-IDX                                    30610018
313500*           FROM +1 BY +1                                         30620018
313600*           UNTIL PV-UPC-IDX > 50                                 30630018
313700*             OR PV-SAVE-UPC-DESC(PV-STR-ADJ PV-UPC-IDX) = SPACES 30640018
313800*             OR PV-TIMES-THROUGH = PV-ABS-DIFF                   30650018
313900*              ADD +1 TO PV-TIMES-THROUGH                         30660018
314000*           IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 0 OR  30670018
314100*              PV-SAVE-STR-QTY(PV-STR-ADJ) > 0                    30680018
314200*              IF PS-ADD                                          30690018
314300*                IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX)30700018
314400*                     >= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 30710018
314500*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            30720018
314600*                 ELSE                                            30730018
314700*                    ADD +1 TO PV-SAVE-UPC-QTY-STR(PV-STR-ADJ     30740018
314800*                                                     PV-UPC-IDX) 30750018
314900*                              PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES 30760018
315000*                                                     PV-UPC-IDX) 30770018
315100*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   30780018
315200*                           1 + PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)  30790018
315300*                 END-IF                                          30800018
315400*              ELSE                                               30810018
315500*                IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 030820018
315600*               IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX) 30830018
315700*                     <= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 30840018
315800*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            30850018
315900*                ELSE                                             30860018
316000*                    SUBTRACT +1 FROM                             30870018
316100*                       PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX)30880018
316200*                      PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES         30890018
316300*                                           PV-UPC-IDX)           30900018
316400*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   30910018
316500*                            PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1 30920018
316600*                END-IF                                           30930018
316700*               END-IF                                            30940018
316800*              END-IF                                             30950018
316900*           END-IF                                                30960018
317000*        END-PERFORM.                                             30970018
317100                                                                  30980000
317200                                                                  30990000
317300*        IF PV-SAVE-UPC-DESC(PV-STR-ADJ PV-UPC-IDX) = SPACES      31000018
317400*           AND NOT PV-TIMES-THROUGH = PV-ABS-DIFF                31010018
317500*        PERFORM                                                  31020018
317600*           VARYING PV-UPC-IDX                                    31030018
317700*           FROM +1 BY +1                                         31040018
317800*           UNTIL PV-UPC-IDX > 50                                 31050018
317900*             OR PV-SAVE-UPC-DESC(PV-STR-ADJ PV-UPC-IDX) = SPACES 31060018
318000*             OR PV-TIMES-THROUGH = PV-ABS-DIFF                   31070018
318100*              ADD +1 TO PV-TIMES-THROUGH                         31080018
318200*           IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 0 OR  31090018
318300*              PV-SAVE-STR-QTY(PV-STR-ADJ) > 0                    31100018
318400*              IF PS-ADD                                          31110018
318500*                COMPUTE PV-UPC-QTY-TEMP = 1 +                    31120018
318600*                PV-SAVE-UPC-SUBTOTAL(PV-STR-ADJ PV-UPC-IDX)      31130018
318700*                 IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES           31140018
318800*                       PV-UPC-IDX) = PV-SAVE-POUPC-QTY(PV-STR-ADJ31150018
318900*                            PV-UPC-IDX)                          31160018
319000*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            31170018
319100*                 ELSE                                            31180018
319200*                    ADD +1 TO PV-SAVE-UPC-QTY-STR(PV-STR-ADJ     31190018
319300*                                                     PV-UPC-IDX) 31200018
319400*                              PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES 31210018
319500*                                                     PV-UPC-IDX) 31220018
319600*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   31230018
319700*                           1 + PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)  31240018
319800*                 END-IF                                          31250018
319900*              ELSE                                               31260018
320000*                IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 031270018
320100*                  COMPUTE PV-UPC-QTY-TEMP =                      31280018
320200*                  PV-SAVE-UPC-SUBTOTAL(PV-STR-ADJ PV-UPC-IDX) - 131290018
320300*               IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX) 31300018
320400*                     = PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX)  31310018
320500*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            31320018
320600*                ELSE                                             31330018
320700*                    SUBTRACT +1 FROM                             31340018
320800*                       PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX)31350018
320900*                      PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES         31360018
321000*                                           PV-UPC-IDX)           31370018
321100*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   31380018
321200*                            PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1 31390018
321300*                END-IF                                           31400018
321400*               END-IF                                            31410018
321500*              END-IF                                             31420018
321600*           END-IF                                                31430018
321700*        END-PERFORM                                              31440018
321800*       END-IF.                                                   31450018
321900                                                                  31460000
322000                                                                  31470000
322100*F200-ADJUST-SPLIT-QTY-STR.                                       31480020
322200*          COMPUTE PV-DIFF =                                      31490018
322300*               PV-SAVE-POUPC-QTY(1 PV-UPC-IDX) -                 31500018
322400*                  PV-SAVE-UPC-SUBTOTAL(PV-STR-IDX PV-UPC-IDX).   31510018
322500*                                                                 31520020
322600*     IF PV-DIFF > 0                                              31530018
322700*        SET PS-ADD     TO TRUE                                   31540018
322800*     ELSE                                                        31550018
322900*        SET PS-SUBTR   TO TRUE                                   31560020
323000*     END-IF.                                                     31570018
323100*                                                                 31580020
323200*     MOVE PV-DIFF TO PV-ABS-DIFF.                                31590020
323300*     MOVE +0 TO PV-TIMES-THROUGH.                                31600020
323400*        PERFORM                                                  31610019
323500*           VARYING PV-STR-ADJ                                    31620019
323600*           FROM +1 BY +1                                         31630019
323700*           UNTIL PV-STR-ADJ > 2000                               31640019
323800*             OR PV-SAVE-STR-NBR(PV-STR-ADJ) = 0                  31650019
323900*             OR PV-TIMES-THROUGH = PV-ABS-DIFF                   31660019
324000*              ADD +1 TO PV-TIMES-THROUGH                         31670019
324100*           IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 0 OR  31680019
324200*              PV-SAVE-STR-QTY(PV-STR-ADJ) > 0                    31690019
324300*              IF PS-ADD                                          31700019
324400*                COMPUTE PV-UPC-QTY-TEMP = 1 +                    31710019
324500*                 PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)                31720019
324600*                IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX)31730019
324700*                     >= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 31740019
324800*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            31750019
324900*                 ELSE                                            31760019
325000*                  IF (PV-UPC-QTY-TEMP <= PV-SAVE-STR-QTY(        31770019
325100*                    PV-STR-ADJ) AND PV-UPC-IDX = PV-UPC-DTL-CNT) 31780019
325200*                    ADD +1 TO PV-SAVE-UPC-QTY-STR(PV-STR-ADJ     31790019
325300*                                                     PV-UPC-IDX) 31800019
325400*                              PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES 31810019
325500*                                                     PV-UPC-IDX) 31820019
325600*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   31830019
325700*                           1 + PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)  31840019
325800*                  ELSE                                           31850019
325900*                     SUBTRACT +1 FROM PV-TIMES-THROUGH           31860019
326000*                  END-IF                                         31870019
326100*                 END-IF                                          31880019
326200*              ELSE                                               31890019
326300*                IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 031900019
326400*                  COMPUTE PV-UPC-QTY-TEMP =                      31910019
326500*                  PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1           31920019
326600*               IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX) 31930019
326700*                     <= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 31940019
326800*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            31950019
326900*                ELSE                                             31960019
327000*                  IF (PV-UPC-QTY-TEMP >= PV-SAVE-STR-QTY(        31970019
327100*                    PV-STR-ADJ) AND PV-UPC-IDX = PV-UPC-DTL-CNT) 31980019
327200*                    OR (NOT PV-UPC-IDX = PV-UPC-DTL-CNT)         31990019
327300*                    SUBTRACT +1 FROM                             32000019
327400*                       PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX)32010019
327500*                      PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES         32020019
327600*                                           PV-UPC-IDX)           32030019
327700*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   32040019
327800*                            PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1 32050019
327900*                  ELSE                                           32060019
328000*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            32070019
328100*                  END-IF                                         32080019
328200*                END-IF                                           32090019
328300*               END-IF                                            32100019
328400*              END-IF                                             32110019
328500*           END-IF                                                32120019
328600*        END-PERFORM.                                             32130019
328700                                                                  32140000
328800*        IF NOT PV-TIMES-THROUGH = PV-ABS-DIFF                    32150020
328900*          PERFORM F250-ADJUST-SPLIT-QTY-STR                      32160020
329000*            UNTIL PV-TIMES-THROUGH = PV-ABS-DIFF                 32170020
329100*        END-IF.                                                  32180020
329200 EJECT                                                            32190000
329300                                                                  32200000
329400*F250-ADJUST-SPLIT-QTY-STR.                                       32210020
329500*                                                                 32220020
329600*        PERFORM                                                  32230020
329700*           VARYING PV-STR-ADJ                                    32240020
329800*           FROM +1 BY +1                                         32250020
329900*           UNTIL PV-STR-ADJ > 2000                               32260020
330000*             OR PV-SAVE-STR-NBR(PV-STR-ADJ) = 0                  32270020
330100*             OR PV-TIMES-THROUGH = PV-ABS-DIFF                   32280020
330200*              ADD +1 TO PV-TIMES-THROUGH                         32290020
330300*           IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 0 OR  32300020
330400*              PV-SAVE-STR-QTY(PV-STR-ADJ) > 0                    32310020
330500*              IF PS-ADD                                          32320020
330600*                 COMPUTE PV-UPC-QTY-TEMP = 1 +                   32330020
330700*                 PV-SAVE-UPC-SUBTOTAL(PV-STR-ADJ PV-UPC-IDX)     32340020
330800*                 COMPUTE PV-UPC-QTY-TEMP = 1 +                   32350020
330900*                 PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)                32360020
331000*                IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX)32370020
331100*                     >= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 32380020
331200*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            32390020
331300*                ELSE                                             32400020
331400*                  IF (PV-UPC-QTY-TEMP <= PV-SAVE-STR-QTY(        32410020
331500*                     PV-STR-ADJ) AND PV-UPC-IDX = PV-UPC-DTL-CNT)32420020
331600*                     OR (NOT PV-UPC-IDX = PV-UPC-DTL-CNT)        32430020
331700*                    ADD +1 TO PV-SAVE-UPC-QTY-STR(PV-STR-ADJ     32440020
331800*                                                     PV-UPC-IDX) 32450020
331900*                              PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES 32460020
332000*                                                     PV-UPC-IDX) 32470020
332100*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   32480020
332200*                           1 + PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)  32490020
332300*                  ELSE                                           32500020
332400*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            32510020
332500*                  END-IF                                         32520020
332600*                 END-IF                                          32530020
332700*              ELSE                                               32540020
332800*                IF PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX) > 032550020
332900*                 COMPUTE PV-UPC-QTY-TEMP =                       32560020
333000*                 PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ)- 1             32570020
333100*               IF PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES PV-UPC-IDX) 32580020
333200*                     <= PV-SAVE-POUPC-QTY(PV-STR-ADJ PV-UPC-IDX) 32590020
333300*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            32600020
333400*                ELSE                                             32610020
333500*                  IF (PV-UPC-QTY-TEMP >= PV-SAVE-STR-QTY(        32620020
333600*                     PV-STR-ADJ) AND PV-UPC-IDX = PV-UPC-DTL-CNT)32630020
333700*                     OR (NOT PV-UPC-IDX = PV-UPC-DTL-CNT)        32640020
333800*                    SUBTRACT +1 FROM                             32650020
333900*                       PV-SAVE-UPC-QTY-STR(PV-STR-ADJ PV-UPC-IDX)32660020
334000*                      PV-SAVE-UPC-SUBTOTAL(PV-NBR-STORES         32670020
334100*                                           PV-UPC-IDX)           32680020
334200*                    COMPUTE PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) =   32690020
334300*                            PV-SAVE-STR-SUBTOTAL(PV-STR-ADJ) - 1 32700020
334400*                  ELSE                                           32710020
334500*                    SUBTRACT +1 FROM PV-TIMES-THROUGH            32720020
334600*                  END-IF                                         32730020
334700*                END-IF                                           32740020
334800*               END-IF                                            32750020
334900*              END-IF                                             32760020
335000*           END-IF                                                32770020
335100*        END-PERFORM.                                             32780020
343500*                                                                 32790020
343600 EJECT                                                            32800000
343700                                                                  32810000
343800                                                                  32820000
343900 2375-DISPLAY-NON-POUPC-LINES.                                    32830000
344000             IF PV-SUB = +7                                       32840000
344100* NOW WRITE THE STORES                                            32850000
344200                IF PV-LINE-CNT > 58                               32860000
344300                   PERFORM 2370-ADVANCE-TO-NEWPAGE                32870000
344400                   WRITE POSIRPT-RECORD FROM DISTR-LINE-OLD       32880000
344500                                        AFTER 2 LINES             32890000
344600                   ADD +2         TO PV-LINE-CNT                  32900000
344700                ELSE                                              32910000
344800                   WRITE POSIRPT-RECORD FROM DISTR-LINE-OLD       32920000
344900                                        AFTER 1 LINES             32930000
345000                   ADD +1         TO PV-LINE-CNT                  32940000
345100                END-IF                                            32950000
345200                MOVE +0        TO PV-SUB                          32960000
345300                INITIALIZE DISTR-LINE-OLD                         32970000
345400             ELSE                                                 32980000
345500              IF PV-SUB < 7 AND PV-DC-STR-IDX = PV-NBR-STORES-PLAN32990000
345600                IF PV-LINE-CNT > 58                               33000000
345700                   PERFORM 2370-ADVANCE-TO-NEWPAGE                33010000
345800                   WRITE POSIRPT-RECORD FROM DISTR-LINE-OLD       33020000
345900                                        AFTER 2 LINES             33030000
346000                   ADD +2         TO PV-LINE-CNT                  33040000
346100                ELSE                                              33050000
346200                   WRITE POSIRPT-RECORD FROM DISTR-LINE-OLD       33060000
346300                                        AFTER 1 LINES             33070000
346400                   ADD +1         TO PV-LINE-CNT                  33080000
346500                END-IF                                            33090000
346600                INITIALIZE DISTR-LINE-OLD                         33100000
346700                MOVE +0           TO PV-SUB                       33110000
346800             END-IF                                               33120000
346900             END-IF.                                              33130000
347000                                                                  33140000
347100                                                                  33150000
347200                                                                  33160000
347300*2375-DISPLAY-POUPC-LINES.                                        33170018
347400*            IF PV-SUB = +4                                       33180018
347500*               ADD +1 TO PV-TIMES2                               33190018
347600*               PERFORM 2370-ADVANCE-TO-NEWPAGE                   33200018
347700* NOW WRITE THE STORES                                            33210000
347800*               WRITE POSIRPT-RECORD FROM DISTR-LINE              33220018
347900*                                    AFTER 1 LINES                33230018
348000*               ADD +1         TO PV-LINE-CNT                     33240018
348100*               IF PV-LINE-CNT > 58                               33250018
348200*                  PERFORM 2370-ADVANCE-TO-NEWPAGE                33260018
348300*                  PERFORM 2352-FILL-DIST-HEAD2                   33270018
348400*                      VARYING PV-SUB1 FROM +1 BY +1              33280018
348500*                      UNTIL PV-SUB1 > PV-NBR-TIMES               33290018
348600* PRINT ' --STORE--  ---SIZE---  QUANTITY   '.                    33300000
348700*                  WRITE POSIRPT-RECORD FROM DISTR-HEADER-2       33310018
348800*                      AFTER 1 LINES                              33320018
348900*                  ADD +1      TO PV-LINE-CNT                     33330018
349000*               END-IF                                            33340018
349100*               INITIALIZE UPC-LINE                               33350018
349200* WRITE ALL THE UPCS FOR THIS SKU ( 4 STORES WORTH)               33360000
349300*               PERFORM                                           33370018
349400*                 VARYING PV-DC-UPC-IDX                           33380018
349500*                 FROM +1 BY +1                                   33390018
349600*               UNTIL PV-DC-UPC-DESC(PV-DC-STR-IDX PV-DC-UPC-IDX) 33400018
349700*                      = SPACES OR PV-DC-UPC-IDX > 50             33410018
349800*                    COMPUTE PV-START = PV-TIMES2 * 4             33420018
349900*                    COMPUTE PV-START = PV-START - 3              33430018
350000*                    COMPUTE PV-END = PV-START + 3                33440018
350100*                    MOVE 0 TO PV-TIMES                           33450018
350200*                    PV-END                                       33460018
350300*                    PERFORM                                      33470018
350400*                      VARYING PV-START                           33480018
350500*                      FROM PV-START BY +1                        33490018
350600*                      UNTIL PV-START > PV-END                    33500018
350700*                        ADD +1 TO PV-TIMES                       33510018
350800*                        MOVE PV-DC-UPC-DESC(PV-START             33520018
350900*                         PV-DC-UPC-IDX) TO DL-UPC-DESC(PV-TIMES) 33530018
351000*                        MOVE PV-DC-UPC-QTY-STR(PV-START          33540018
351100*                         PV-DC-UPC-IDX) TO DL-UPC-QTY(PV-TIMES)  33550018
351200*                    END-PERFORM                                  33560018
351300*                    PERFORM 2370-ADVANCE-TO-NEWPAGE              33570018
351400*                    IF PV-LINE-CNT = 9                           33580018
351500*                       WRITE POSIRPT-RECORD FROM UPC-LINE        33590018
351600*                                         AFTER 2 LINES           33600018
351700*                       ADD +2                   TO PV-LINE-CNT   33610018
351800*                    ELSE                                         33620018
351900*                       WRITE POSIRPT-RECORD FROM UPC-LINE        33630018
352000*                                         AFTER 1 LINES           33640018
352100*                       ADD +1                   TO PV-LINE-CNT   33650018
352200*                    END-IF                                       33660018
352300*               END-PERFORM                                       33670018
352400*               MOVE +0           TO PV-SUB                       33680018
352500*               INITIALIZE DISTR-LINE                             33690018
352600*            ELSE                                                 33700018
352700*             IF PV-SUB < 4 AND PV-DC-STR-IDX = PV-NBR-STORES-PLAN33710018
352800*               ADD +1 TO PV-TIMES2                               33720018
352900*               PERFORM 2370-ADVANCE-TO-NEWPAGE                   33730018
353000*               WRITE POSIRPT-RECORD FROM DISTR-LINE              33740018
353100*                                    AFTER 1 LINES                33750018
353200*               ADD +1         TO PV-LINE-CNT                     33760018
353300*               IF PV-LINE-CNT > 58                               33770018
353400*                  PERFORM 2370-ADVANCE-TO-NEWPAGE                33780018
353500*                  PERFORM 2352-FILL-DIST-HEAD2                   33790018
353600*                      VARYING PV-SUB1 FROM +1 BY +1              33800018
353700*                      UNTIL PV-SUB1 > PV-NBR-TIMES               33810018
353800* PRINT ' --STORE--  ---SIZE---  QUANTITY   '.                    33820000
353900*                  WRITE POSIRPT-RECORD FROM DISTR-HEADER-2       33830018
354000*                      AFTER 1 LINES                              33840018
354100*                  ADD +1      TO PV-LINE-CNT                     33850018
354200*               END-IF                                            33860018
354300*               INITIALIZE UPC-LINE                               33870018
354400*               PERFORM                                           33880018
354500*                 VARYING PV-DC-UPC-IDX                           33890018
354600*                 FROM +1 BY +1                                   33900018
354700*              UNTIL PV-DC-UPC-DESC(PV-DC-STR-IDX PV-DC-UPC-IDX)  33910018
354800*                     = SPACES OR PV-DC-UPC-IDX > 50              33920018
354900*                    COMPUTE PV-START = PV-TIMES2 * 4             33930018
355000*                    COMPUTE PV-START = PV-START - 3              33940018
355100*                    COMPUTE PV-END = PV-START + 3                33950018
355200*                    MOVE 0 TO PV-TIMES                           33960018
355300*                    PERFORM                                      33970018
355400*                      VARYING PV-START                           33980018
355500*                      FROM PV-START BY +1                        33990018
355600*                      UNTIL PV-START > PV-END                    34000018
355700*                        ADD +1 TO PV-TIMES                       34010018
355800*                        MOVE PV-DC-UPC-DESC(PV-START             34020018
355900*                         PV-DC-UPC-IDX)  TO DL-UPC-DESC(PV-TIMES)34030018
356000*                        MOVE PV-DC-UPC-QTY-STR(PV-START          34040018
356100*                         PV-DC-UPC-IDX)  TO DL-UPC-QTY(PV-TIMES) 34050018
356200*                    END-PERFORM                                  34060018
356300*                    PERFORM 2370-ADVANCE-TO-NEWPAGE              34070018
356400*                    IF PV-LINE-CNT = 9                           34080018
356500*                       WRITE POSIRPT-RECORD FROM UPC-LINE        34090018
356600*                                         AFTER 2 LINES           34100018
356700*                       ADD +2                   TO PV-LINE-CNT   34110018
356800*                    ELSE                                         34120018
356900*                       WRITE POSIRPT-RECORD FROM UPC-LINE        34130018
357000*                                         AFTER 1 LINES           34140018
357100*                       ADD +1                   TO PV-LINE-CNT   34150018
357200*                    END-IF                                       34160018
357300*               END-PERFORM                                       34170018
357400*               MOVE +0           TO PV-SUB                       34180018
357500*            END-IF                                               34190018
357600*            END-IF.                                              34200018
357700                                                                  34210000
357800                                                                  34220000
357900******************************************************************34230000
358000*  - ERROR ROUTINE FOR DB2 ABENDS                                 34240000
358100******************************************************************34250000
358200 9000-SQL-ABEND.                                                  34260000
358300                                                                  34270000
358400     MOVE SQLCODE                  TO SQLCODE2.                   34280000
358500     MOVE SQLERRD(3)               TO SQLERRD3.                   34290000
358600     DISPLAY '** ABEND          **'.                              34300000
358700     DISPLAY '** PROGRAM        ** = POKRP004'.                   34310000
358800     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        34320000
358900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  34330000
359000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  34340000
359100     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   34350000
359200     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  34360000
359300     MOVE +4013                    TO PV-ABEND-CODE.              34370000
359400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         34380000
192700******************************************************************34390000
192800*    A NON SQL/NON IMS ERROR HAS OCCURRED.                        34400000
192900******************************************************************34410000
193000 9900-ABEND.                                                      34420000
193100     DISPLAY '** ABEND     **'.                                   34430000
193200     DISPLAY '** PROGRAM   ** = POKRP004'.                        34440000
193300     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             34450000
193400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         34460000
