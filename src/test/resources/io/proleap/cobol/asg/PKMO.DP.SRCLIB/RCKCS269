000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    RCKCS269.                                         00040002
000500 AUTHOR.        MICHAEL WALTERS.                                  00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  04-20-95.                                         00070002
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*---------------------------------------------------------------* 00100002
001100*    E269 - FORCAST OPEN SHIPMENT LIST.                         * 00110002
001200*                                                               * 00120002
001300*    THIS PROGRAM GENERATES A LIST OF PURCHASE ORDERS ASSOCIATED* 00130002
001400*    TO ALL THE SHIPMENTS ACCORDING TO F/B NUMBER OR BOL NUMBER * 00140002
001500*                                                               * 00150002
001600*---------------------------------------------------------------* 00160002
001700* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00170002
001800* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00180002
001900* MAKING THE CALL DYNAMIC VS STATIC.                              00190002
002000*---------------------------------------------------------------* 00200002
002100 EJECT                                                            00210002
002200 ENVIRONMENT DIVISION.                                            00220002
002300                                                                  00230002
002400 DATA DIVISION.                                                   00240002
002500                                                                  00250002
002600 WORKING-STORAGE SECTION.                                         00260002
002700                                                                  00270002
002800 01  DK-DB2-KEYS.                                                 00280002
002900     15  DK-PRO-NBR                     PIC  X(22)  VALUE SPACES. 00290002
003000     15  DK-BOL-NBR                     PIC  X(30)  VALUE SPACES. 00300002
003100     15  DK-SCAC-ID                     PIC  X(04)  VALUE SPACES. 00310002
003200     15  DK-TRIP-ID                     PIC S9(09)  VALUE +0 COMP.00320002
003300                                                                  00330002
003400 01  DN-DB2-NULL-INDICATORS.                                      00340002
003500     05  DN-AD-EVNT-DTE                  PIC S9(04) VALUE +0      00350002
003600                                                    COMP.         00360002
003700                                                                  00370002
003800 01  PC-PROGRAM-CONSTANTS.                                        00380002
003900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00390002
004000                                                    'RC269A  '.   00400002
004100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00410002
004200                                                    'RCKM269 '.   00420002
004300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00430002
004400                                                    'RCKCS269'.   00440002
004500     05  PC-RCKUT023                    PIC  X(08)  VALUE         00450002
004600                                                    'RCKUT023'.   00460002
004700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00470002
004800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00480002
004900     05  PC-MAINT-DEL-FORMAT            PIC  X(01)  VALUE '1'.    00490002
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00500002
005100                                                    COMP SYNC.    00510002
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00520002
005300                                                    COMP SYNC.    00530002
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00540002
005500                                                    +1000000      00550002
005600                                                    COMP-3.       00560002
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00570002
005800                                                    COMP SYNC.    00580002
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00590002
006000                                                    COMP-3.       00600002
006100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00610002
006200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00620002
006300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00630002
006400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00640002
006500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00650002
006600*                                                                 00660002
006700     05  PC-TSYMSG-NUMBERS.                                       00670002
006800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00680002
006900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00690002
007000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00700002
007100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00710002
007200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00720002
007300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00730002
007400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00740002
007500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00750002
007600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00760002
007700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00770002
007800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00780002
007900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00790002
008000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00800002
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00810002
008200         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00820002
008300*                                                                 00830002
008400 01  PS-PROGRAM-SWITCHES.                                         00840002
008500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00850002
008600         88  PS-NO-ERROR                            VALUE 'Y'.    00860002
008700         88  PS-ERROR                               VALUE 'N'.    00870002
008800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00880002
008900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00890002
009000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00900002
009100*                                                                 00910002
009200 01  PV-PROGRAM-VARIABLES.                                        00920002
009300     05  PV-SUB                         PIC S9(04)  VALUE +0      00930002
009400                                                    COMP SYNC.    00940002
009500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00950002
009600                                                    COMP SYNC.    00960002
009700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00970002
009800                                                    COMP-3.       00980002
009900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00990002
010000                                                    COMP-3.       01000002
010100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01010002
010200                                                    COMP-3.       01020002
010300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01030002
010400                                                    COMP-3.       01040002
010500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01050002
010600                                                    COMP-3.       01060002
010700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01070002
010800                                                    COMP-3.       01080002
010900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01090002
011000                                                    COMP-3.       01100002
011100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01110002
011200                                                    COMP SYNC.    01120002
011300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01130002
011400                                                    COMP SYNC.    01140002
011500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01150002
011600                                                    COMP SYNC.    01160002
011700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01170002
011800                                                    COMP SYNC.    01180002
011900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01190002
012000                                                    COMP SYNC.    01200002
012100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01210002
012200                                                    COMP SYNC.    01220002
012300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01230002
012400                                                    COMP SYNC.    01240002
012500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01250002
012600                                                    COMP SYNC.    01260002
012700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01270002
012800                                                    COMP SYNC.    01280002
012900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290002
013000                                                    COMP SYNC.    01300002
013100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01310002
013200                                                    COMP SYNC.    01320002
013300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01330002
013400                                                    COMP SYNC.    01340002
013500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01350002
013600                                                    COMP SYNC.    01360002
013700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01370002
013800                                                    COMP SYNC.    01380002
013900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01390002
014000                                                    COMP SYNC.    01400002
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410002
014200                                                    COMP SYNC.    01420002
014300     05  PV-NULL-INDICATORS.                                      01430002
014400         10  PV-NI-VEH-NBR              PIC S9(4)   VALUE +0      01440002
014500                                                    COMP.         01450002
014600                                                                  01460002
014700     05  PV-SELECT-FOUND-IND            PIC  X(01)  VALUE 'N'.    01470002
014800         88  PV-SELECT-FOUND                        VALUE 'Y'.    01480002
014900         88  PV-SELECT-NOT-FOUND                    VALUE 'N'.    01490002
015000                                                                  01500002
015100     05  PV-WORK-DATE.                                            01510002
015200         10  PV-WORK-CC                 PIC  X(02)  VALUE SPACES. 01520002
015300         10  PV-WORK-YY                 PIC  X(02)  VALUE SPACES. 01530002
015400         10  FILLER                     PIC  X      VALUE SPACE.  01540002
015500         10  PV-WORK-MM                 PIC  X(02)  VALUE SPACES. 01550002
015600         10  FILLER                     PIC  X      VALUE SPACE.  01560002
015700         10  PV-WORK-DD                 PIC  X(02)  VALUE SPACES. 01570002
015800                                                                  01580002
015900     05  PV-DISP-DATE.                                            01590002
016000         10  PV-DISP-MM                 PIC  X(02)  VALUE SPACES. 01600002
016100         10  FILLER                     PIC  X      VALUE '/'.    01610002
016200         10  PV-DISP-DD                 PIC  X(02)  VALUE SPACES. 01620002
016300******************************************************************01630002
016400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01640002
016500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01650002
016600**  APPLICATION-SPECIFIC COMMAREA.                              **01660002
016700******************************************************************01670002
016800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01680002
016900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01690002
017000     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           01700002
017100                                        INDEXED BY LQW-IDX.       01710002
017200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01720002
017300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01730002
017400         10  LQW-SELECTED-SW            PIC  X(01).               01740002
017500             88  LQW-SELECT                         VALUE 'S'.    01750002
017600             88  LQW-DESELECT                       VALUE ' '.    01760002
017700         10  LQW-SHIPT-ID               PIC S9(09)  COMP-3.       01770002
017800* CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                   01780002
017900         10  LQW-PO-NBR                 PIC  9(08).               01790002
018000         10  LQW-REC-IND                PIC  X(01).               01800002
018100         10  LQW-VEND-NME               PIC  X(10).               01810002
018200         10  LQW-COMPLETE-PRO-NBR       PIC  X(22).               01820002
018300         10  LQW-COMPLETE-BOL-NBR       PIC  X(30).               01830002
018400         10  LQW-CART-CNT               PIC S9(04)  COMP-3.       01840002
018500         10  LQW-OPER-UNT-ID            PIC  X(04).               01850002
018600         10  LQW-USER-RECORD-IND        PIC  X(01).               01860002
018700             88  LQW-USER-RECORD         VALUE 'U'.               01870002
018800             88  LQW-LIST-RECORD         VALUE 'L'.               01880002
018900                                                                  01890002
019000                                                                  01900002
019100     EJECT                                                        01910002
019200*---------------------------------------------------------------* 01920002
019300*    MAP LAYOUT                                                 * 01930002
019400*---------------------------------------------------------------* 01940002
019500                                                                  01950002
019600     COPY RCKM269.                                                01960002
019700*                                                                 01970002
019800 01  MR-OCCURS-LAYOUT                   REDEFINES  RC269AO.       01980002
019900     05  FILLER                         PIC X(51).                01990002
020000     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02000002
020100         10  MR-SELECTL                 PIC S9(04) COMP.          02010002
020200         10  MR-SELECTA                 PIC  X(01).               02020002
020300         10  MR-SELECTC                 PIC  X(01).               02030002
020400         10  MR-SELECTH                 PIC  X(01).               02040002
020500         10  MR-SELECTI                 PIC  X(01).               02050002
020600                                                                  02060002
020700         10  FILLER                     PIC  X(05).               02070002
020800* CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                   02080002
020900         10  MR-PO-NBR                  PIC  X(08).               02090002
021000                                                                  02100002
021100         10  FILLER                     PIC  X(05).               02110002
021200         10  MR-REC-IND                 PIC  X(01).               02120002
021300                                                                  02130002
021400         10  FILLER                     PIC  X(05).               02140002
021500         10  MR-VEND-NME                PIC  X(10).               02150002
021600                                                                  02160002
021700         10  FILLER                     PIC  X(05).               02170002
021800         10  MR-PRO-NBR                 PIC  X(19).               02180002
021900                                                                  02190002
022000         10  FILLER                     PIC  X(05).               02200002
022100         10  MR-BOL-NBR                 PIC  X(25).               02210002
022200                                                                  02220002
022300         10  FILLER                     PIC  X(05).               02230002
022400         10  MR-CART-CNT                PIC  X(04).               02240002
022500         10  MR-CART-CNT-N REDEFINES MR-CART-CNT                  02250002
022600                                        PIC  9(04).               02260002
022700                                                                  02270002
022800         10  FILLER                     PIC  X(05).               02280002
022900         10  MR-OPER-UNT-ID             PIC  X(04).               02290002
023000                                                                  02300002
023100     EJECT                                                        02310002
023200*---------------------------------------------------------------* 02320002
023300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02330002
023400*---------------------------------------------------------------* 02340002
023500                                                                  02350002
023600     COPY DPWS015.                                                02360002
023700                                                                  02370002
023800*---------------------------------------------------------------* 02380002
023900*    FUNCTION KEYS COPYBOOK.                                    * 02390002
024000*---------------------------------------------------------------* 02400002
024100                                                                  02410002
024200     COPY DPWS016.                                                02420002
024300                                                                  02430002
024400*---------------------------------------------------------------* 02440002
024500*    NUMERIC EDIT LAYOUT.                                       * 02450002
024600*---------------------------------------------------------------* 02460002
024700                                                                  02470002
024800     COPY DPWS010I.                                               02480002
024900 EJECT                                                            02490002
025000                                                                  02500002
025100***************************************************************** 02510002
025200*    COPY BOOKS FOR THE VALIDATION ROUTINE FOR THE FREIGHT BILL   02520002
025300*    BILL OF LADING, AND VEHICLE NUMBER                           02530002
025400***************************************************************** 02540002
025500     COPY RCWS023.                                                02550002
025600                                                                  02560002
025700 EJECT                                                            02570002
025800******************************************************************02580003
025900** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **02590003
025910** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **02591003
026000******************************************************************02600003
026100                                                                  02610002
026200     COPY DPWS030.                                                02620002
026210     COPY DPWS930.                                                02621003
026300 EJECT                                                            02630002
026400*---------------------------------------------------------------* 02640002
026500*    STANDARD COMMAREA.                                         * 02650002
026600*---------------------------------------------------------------* 02660002
026700                                                                  02670002
026800     COPY DPWS020.                                                02680002
026900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02690002
027000                                                                  02700002
027100*---------------------------------------------------------------* 02710002
027200* INTER-APPLICATION COMMAREA.                                   * 02720002
027300*   TRWS001 - IS THE INPUT LAYOUT                               * 02730002
027400*---------------------------------------------------------------* 02740002
027500                                                                  02750002
027600         10  INTER-APPL-COMM-AREA       PIC X(200).               02760002
027700     COPY TRWS001.                                                02770002
027800*---------------------------------------------------------------* 02780002
027900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02790002
028000*---------------------------------------------------------------* 02800002
028100         10  ASC-SPECIFIC-COMMAREA.                               02810002
028200             15  ASC-LIST-KEYS.                                   02820002
028300                 20  ASC-KEY-PRO-NBR                 PIC  X(22).  02830002
028400                 20  ASC-KEY-BOL-NBR                 PIC  X(30).  02840002
028500                 20  ASC-KEY-SCAC-ID                 PIC  X(04).  02850002
028600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02860002
028700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02870002
028800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02880002
028900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02890002
029000                                                                  02900002
029100                 20  ASC-ITEM-ARRAY.                              02910002
029200                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        02920002
029300                         30  ASC-LIST-ITEM-NUMBER                 02930002
029400                                                     PIC S9(09)   02940002
029500                                                     COMP-3.      02950002
029600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02960002
029700                             88  ASC-VALID-SELECT    VALUE ' '    02970002
029800                                                           'S'    02980002
029900                                                           'B'    02990002
030000                                                           'E'.   03000002
030100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03010002
030200                             88  ASC-TEMP-SELECT     VALUE 'S'.   03020002
030300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03030002
030400                             88  ASC-TEMP-END        VALUE 'E'.   03040002
030500                         30  ASC-SELECTED-SW         PIC  X(01).  03050002
030600                             88  ASC-NO-SELECT       VALUE ' '.   03060002
030700                             88  ASC-SELECT          VALUE 'S'.   03070002
030800                             88  ASC-BEGIN           VALUE 'B'.   03080002
030900                             88  ASC-END             VALUE 'E'.   03090002
031000                         30  ASC-SHIPT-ID            PIC S9(09)   03100002
031100                                                          COMP-3. 03110002
031200* CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                   03120002
031300                         30  ASC-PO-NBR              PIC  9(08).  03130002
031400                         30  ASC-REC-IND             PIC  X(01).  03140002
031500                         30  ASC-VEND-NAME           PIC  X(10).  03150002
031600                         30  ASC-COMPLETE-PRO-NBR    PIC  X(22).  03160002
031700                         30  ASC-COMPLETE-BOL-NBR    PIC  X(30).  03170002
031800                         30  ASC-CART-CNT            PIC S9(04)   03180002
031900                                                          COMP-3. 03190002
032000                         30  ASC-OPER-UNT-ID         PIC  X(04).  03200002
032100                         30  ASC-USER-RECORD-IND     PIC  X(01).  03210002
032200                             88  ASC-USER-RECORD     VALUE 'U'.   03220002
032300                             88  ASC-LIST-RECORD     VALUE 'L'.   03230002
032400                                                                  03240002
032500             15  ASC-BLK-SUB                         PIC S9(04)   03250002
032600                                                          COMP    03260002
032700                                                          SYNC.   03270002
032800             15  ASC-ITEM-SUB                        PIC S9(04)   03280002
032900                                                          COMP    03290002
033000                                                          SYNC.   03300002
033100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03310002
033200                                                          COMP-3. 03320002
033300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03330002
033400                                                          COMP-3. 03340002
033500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03350002
033600                                                          COMP-3. 03360002
033700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03370002
033800                                                          COMP-3. 03380002
033900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03390002
034000                                                          COMP-3. 03400002
034100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03410002
034200                                                          COMP    03420002
034300                                                          SYNC.   03430002
034400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03440002
034500                                                          COMP-3. 03450002
034600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03460002
034700                                                          COMP-3. 03470002
034800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03480002
034900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03490002
035000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03500002
035100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03510002
035200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03520002
035300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03530002
035400             15  ASC-LIST-QUEUE-NAME.                             03540002
035500                 20  ASC-LIST-TERM-ID                PIC  X(04).  03550002
035600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03560002
035700                                                          COMP-3. 03570002
035800                 20  ASC-LIST-SEQ                    PIC  9(01).  03580002
035900             15  ASC-SEL-QUEUE-NAME.                              03590002
036000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03600002
036100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03610002
036200                                                          COMP-3. 03620002
036300                 20  ASC-SEL-SEQ                     PIC  9(01).  03630002
036400             15  ASC-START-ITEM-REQUEST.                          03640002
036500                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03650002
036600             15  ASC-CURSOR-IND                      PIC  X(01).  03660002
036700                 88  ASC-PO-BOTH-CSR                 VALUE 'X'.   03670002
036800                 88  ASC-PO-BOL-CSR                  VALUE 'B'.   03680002
036900                 88  ASC-PO-PRO-CSR                  VALUE 'P'.   03690002
037000     EJECT                                                        03700002
037100*---------------------------------------------------------------* 03710002
037200*    ABEND PROCESSING COPYBOOK.                                 * 03720002
037300*---------------------------------------------------------------* 03730002
037400                                                                  03740002
037500     COPY DPWS013.                                                03750002
037600                                                                  03760002
037700 EJECT                                                            03770002
037800*---------------------------------------------------------------* 03780002
037900*    DB2 AREA FOR COMMUNICATIONS                                * 03790002
038000*---------------------------------------------------------------* 03800002
038100     EXEC SQL                                                     03810002
038200          INCLUDE SQLCA                                           03820002
038300     END-EXEC.                                                    03830002
038400*---------------------------------------------------------------* 03840002
038500*    DB2 AREA FOR SHIPMENT TABLE                                * 03850002
038600*---------------------------------------------------------------* 03860002
038700     EXEC SQL                                                     03870002
038800          INCLUDE TSHIPMT                                         03880002
038900     END-EXEC.                                                    03890002
039000*---------------------------------------------------------------* 03900002
039100*    DB2 AREA FOR SHIPMENT PO ASSOCIATION TABLE                 * 03910002
039200*---------------------------------------------------------------* 03920002
039300     EXEC SQL                                                     03930002
039400          INCLUDE TSHPTPO                                         03940002
039500     END-EXEC.                                                    03950002
039600*---------------------------------------------------------------* 03960002
039700*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 03970002
039800*---------------------------------------------------------------* 03980002
039900     EXEC SQL                                                     03990002
040000          INCLUDE TTRIPST                                         04000002
040100     END-EXEC.                                                    04010002
040200*---------------------------------------------------------------* 04020002
040300*    DB2 AREA FOR PLANNED SHIPMENT TABLE                        * 04030002
040400*---------------------------------------------------------------* 04040002
040500     EXEC SQL                                                     04050002
040600          INCLUDE TPLNSHP                                         04060002
040700     END-EXEC.                                                    04070002
040800*---------------------------------------------------------------* 04080002
040900*    DB2 AREA FOR PURCHASE ORDER HEADER TABLE                   * 04090002
041000*---------------------------------------------------------------* 04100002
041100     EXEC SQL                                                     04110002
041200          INCLUDE TPURCHS                                         04120002
041300     END-EXEC.                                                    04130002
041400*---------------------------------------------------------------* 04140002
041500*    DB2 AREA FOR PURCHASE ORDER LINE TABLE                     * 04150002
041600*---------------------------------------------------------------* 04160002
041700     EXEC SQL                                                     04170002
041800          INCLUDE TPURITM                                         04180002
041900     END-EXEC.                                                    04190002
042000*---------------------------------------------------------------* 04200002
042100*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 04210002
042200*---------------------------------------------------------------* 04220002
042300     EXEC SQL                                                     04230002
042400          INCLUDE TSHIPST                                         04240002
042500     END-EXEC.                                                    04250002
042600*---------------------------------------------------------------* 04260002
042700*    DB2 AREA FOR VENDOR TABLE                                  * 04270002
042800*---------------------------------------------------------------* 04280002
042900     EXEC SQL                                                     04290002
043000          INCLUDE TENTNME                                         04300002
043100     END-EXEC.                                                    04310002
043200                                                                  04320002
043300*---------------------------------------------------------------* 04330002
043400*    PO-BOTH-CSR CURSOR - CURSOR WHEN BOTH THE PRO, AND BOL     * 04340002
043500*    NUMBER ARE SUPPLIED                                        * 04350002
043600*---------------------------------------------------------------* 04360002
043700                                                                  04370002
043800     EXEC SQL                                                     04380002
043900          DECLARE PO-BOTH-CSR CURSOR                              04390002
044000          FOR SELECT                                              04400002
044100                B.PO_NBR                                          04410002
044200              , A.TRIP_ID                                         04420002
044300              , A.SHIPT_ID                                        04430002
044400              , A.PRO_NBR                                         04440002
044500              , A.BOL_NBR                                         04450002
044600              , A.COMPLETE_PRO_NBR                                04460002
044700              , A.COMPLETE_BOL_NBR                                04470002
044800              , B.REC_SEQ_NBR                                     04480002
044900              , B.VEND_NAME                                       04490002
045000              , B.EXPTED_CART_CNT                                 04500002
045100              , B.ACTL_CART_CNT                                   04510002
045200          FROM                                                    04520002
045300                TSHIPMT A                                         04530002
045400              , TSHPTPO B                                         04540002
045500          WHERE                                                   04550002
045600                A.PRO_NBR        = :DK-PRO-NBR                    04560002
045700            AND A.BOL_NBR        = :DK-BOL-NBR                    04570002
045800            AND A.PRO_SCAC_ID    = :DK-SCAC-ID                    04580002
045900            AND A.SHIPT_ID       = B.SHIPT_ID                     04590002
046000          ORDER BY                                                04600002
046100                A.PRO_NBR                                         04610002
046200              , A.BOL_NBR                                         04620002
046300              , B.PO_NBR                                          04630002
046400     END-EXEC.                                                    04640002
046500                                                                  04650002
046600*---------------------------------------------------------------* 04660002
046700*    PO-BOL-CSR CURSOR - CURSOR WHEN ONLY THE BOL NUMBER IS     * 04670002
046800*    SUPPLIED                                                   * 04680002
046900*---------------------------------------------------------------* 04690002
047000                                                                  04700002
047100     EXEC SQL                                                     04710002
047200          DECLARE PO-BOL-CSR CURSOR                               04720002
047300          FOR SELECT                                              04730002
047400                B.PO_NBR                                          04740002
047500              , A.TRIP_ID                                         04750002
047600              , A.SHIPT_ID                                        04760002
047700              , A.PRO_NBR                                         04770002
047800              , A.BOL_NBR                                         04780002
047900              , A.COMPLETE_PRO_NBR                                04790002
048000              , A.COMPLETE_BOL_NBR                                04800002
048100              , B.REC_SEQ_NBR                                     04810002
048200              , B.VEND_NAME                                       04820002
048300              , B.EXPTED_CART_CNT                                 04830002
048400              , B.ACTL_CART_CNT                                   04840002
048500          FROM                                                    04850002
048600                TSHIPMT A                                         04860002
048700              , TSHPTPO B                                         04870002
048800          WHERE                                                   04880002
048900                A.BOL_NBR        = :DK-BOL-NBR                    04890002
049000            AND A.PRO_SCAC_ID    = :DK-SCAC-ID                    04900002
049100            AND A.SHIPT_ID       = B.SHIPT_ID                     04910002
049200          ORDER BY                                                04920002
049300                A.PRO_NBR                                         04930002
049400              , A.BOL_NBR                                         04940002
049500              , B.PO_NBR                                          04950002
049600     END-EXEC.                                                    04960002
049700                                                                  04970002
049800*---------------------------------------------------------------* 04980002
049900*    PO-PRO-CSR CURSOR - CURSOR WHEN ONLY THE PRO NUMBER IS     * 04990002
050000*    SUPPLIED                                                   * 05000002
050100*---------------------------------------------------------------* 05010002
050200                                                                  05020002
050300     EXEC SQL                                                     05030002
050400          DECLARE PO-PRO-CSR CURSOR                               05040002
050500          FOR SELECT                                              05050002
050600                B.PO_NBR                                          05060002
050700              , A.TRIP_ID                                         05070002
050800              , A.SHIPT_ID                                        05080002
050900              , A.PRO_NBR                                         05090002
051000              , A.BOL_NBR                                         05100002
051100              , A.COMPLETE_PRO_NBR                                05110002
051200              , A.COMPLETE_BOL_NBR                                05120002
051300              , B.REC_SEQ_NBR                                     05130002
051400              , B.VEND_NAME                                       05140002
051500              , B.EXPTED_CART_CNT                                 05150002
051600              , B.ACTL_CART_CNT                                   05160002
051700          FROM                                                    05170002
051800                TSHIPMT A                                         05180002
051900              , TSHPTPO B                                         05190002
052000          WHERE                                                   05200002
052100                A.PRO_NBR        = :DK-PRO-NBR                    05210002
052200            AND A.PRO_SCAC_ID    = :DK-SCAC-ID                    05220002
052300            AND A.SHIPT_ID       = B.SHIPT_ID                     05230002
052400          ORDER BY                                                05240002
052500                A.PRO_NBR                                         05250002
052600              , A.BOL_NBR                                         05260002
052700              , B.PO_NBR                                          05270002
052800     END-EXEC.                                                    05280002
052900                                                                  05290002
053000                                                                  05300002
053100*---------------------------------------------------------------* 05310002
053200*    STATUS_CURSOR - TO SELECT THE OPERATING UNIT ID FROM THE   * 05320002
053300*    MOST CURRENT TRIP STATUS TABLE.                            * 05330002
053400*---------------------------------------------------------------* 05340002
053500     EXEC SQL                                                     05350002
053600         DECLARE STATUS_CURSOR CURSOR FOR                         05360002
053700         SELECT                                                   05370002
053800                  OPER_UNT_ID                                     05380002
053900                , STATUS_DTE                                      05390002
054000                , STATUS_TME                                      05400002
054100         FROM                                                     05410002
054200                  TTRIPST                                         05420002
054300         WHERE                                                    05430002
054400                  TRIP_ID   = :DK-TRIP-ID                         05440002
054500         ORDER BY                                                 05450002
054600                  STATUS_DTE DESC,                                05460002
054700                  STATUS_TME DESC                                 05470002
054800                                                                  05480002
054900     END-EXEC                                                     05490002
055000                                                                  05500002
055100                                                                  05510002
055200 EJECT                                                            05520002
055300 LINKAGE SECTION.                                                 05530002
055400                                                                  05540002
055500 01  DFHCOMMAREA.                                                 05550002
055600     05  FILLER                         OCCURS  1 TO 4072 TIMES   05560002
055700                                        DEPENDING ON EIBCALEN.    05570002
055800         10  FILLER                     PIC X.                    05580002
055900                                                                  05590002
056000 EJECT                                                            05600002
056100 PROCEDURE DIVISION.                                              05610002
056200******************************************************************05620002
056300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05630002
056400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05640002
056500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05650002
056600******************************************************************05660002
056700 0000-MAIN-MODULE.                                                05670002
056800     INITIALIZE DP030-CICS-API-FIELDS.                            05680002
056900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05690002
057000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05700002
057100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05710002
057200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05720002
057300     MOVE LENGTH OF RC269AI        TO DP030-MAP-LENGTH (1).       05730002
057400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05740002
057500     PERFORM 0001-CALL-CICS-ARCH-API.                             05750002
057600*                                                                 05760002
057700     PERFORM 1000-CONTROL-PROCESSING                              05770002
057800*                                                                 05780002
057900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05790002
058000     PERFORM 0001-CALL-CICS-ARCH-API.                             05800002
058100                                                                  05810002
058200******************************************************************05820002
058300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05830002
058400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05840002
058500******************************************************************05850002
058600 0001-CALL-CICS-ARCH-API.                                         05860002
058710     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05871003
058800                                    DFHCOMMAREA                   05880003
058900                                    DP030-CICS-API-FIELDS         05890003
059000                                    DP020-STANDARD-COMMAREA       05900003
059100                                    RC269AI.                      05910003
059200*                                                                 05920002
059300     IF  DP030-RC-CALL-SUCCESSFUL                                 05930002
059400         CONTINUE                                                 05940002
059500     ELSE                                                         05950002
059600         SET DP013-NO-ROLLBACK                                    05960002
059700             DP013-XCTL-DISPLAY-RESTART                           05970002
059800             DP013-CICS-ABEND      TO TRUE                        05980002
059900         MOVE '0001-CALL-CICS-ARCH-API'                           05990002
060000                                   TO DP013-PARAGRAPH             06000002
060020         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O06002003
060030-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06003003
060300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06030002
060400         PERFORM DP013-0000-PROCESS-ABEND                         06040002
060500     END-IF.                                                      06050002
060600*----------------------------------------------------------------*06060002
060700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06070002
060800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06080002
060900*                                                                *06090002
061000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06100002
061100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06110002
061200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06120002
061300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06130002
061400*----------------------------------------------------------------*06140002
061500                                                                  06150002
061600 1000-CONTROL-PROCESSING.                                         06160002
061700                                                                  06170002
061800     EVALUATE TRUE                                                06180002
061900         WHEN DP020-NEXT-ACT-INITIAL                              06190002
062000             INITIALIZE ASC-SPECIFIC-COMMAREA                     06200002
062100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06210002
062200                                      ASC-SEL-TERM-ID             06220002
062300             MOVE DP020-SRC-TASK-NUMBER                           06230002
062400                                   TO ASC-LIST-TASK-NUMBER        06240002
062500                                      ASC-SEL-TASK-NUMBER         06250002
062600             MOVE PC-LIST-QUEUE-SEQ                               06260002
062700                                   TO ASC-LIST-SEQ                06270002
062800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06280002
062900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06290002
063000***-----$TEMPLATE NOTE$-------------------------------------------06300002
063100*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06310002
063200*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06320002
063300*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06330002
063400***---------------------------------------------------------------06340002
063500             IF  PS-COMMAREA-NOT-VALID                            06350002
063600                 MOVE PC-TSYMSG-99901                             06360002
063700                                   TO DP020-MSG-NUMBER            06370002
063800                 SET DP020-MSG-FATAL                              06380002
063900                                   TO TRUE                        06390002
064000                 SET DP020-NEXT-ACT-APPL-ERROR                    06400002
064100                                   TO TRUE                        06410002
064200             ELSE                                                 06420002
064300                 PERFORM 4000-BUILD-INITIAL-PANEL                 06430002
064400             END-IF                                               06440002
064500                                                                  06450002
064600         WHEN DP020-NEXT-ACT-READ-MAP                             06460002
064700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06470002
064800                                   TO PV-TOP-ITEM                 06480002
064900             PERFORM 2000-PROCESS-PANEL                           06490002
065000                                                                  06500002
065100         WHEN DP020-NEXT-ACT-RETURN                               06510002
065200             MOVE ASC-KEY-PRO-NBR  TO DK-PRO-NBR                  06520002
065300             MOVE ASC-KEY-BOL-NBR  TO DK-BOL-NBR                  06530002
065400             MOVE ASC-KEY-SCAC-ID  TO DK-SCAC-ID                  06540002
065500                                                                  06550002
065600             PERFORM 2050-DELETE-LIST-QUEUE                       06560002
065700             PERFORM 4000-BUILD-INITIAL-PANEL                     06570002
065800                                                                  06580002
065900         WHEN OTHER                                               06590002
066000             SET DP013-LOGIC-ABEND TO TRUE                        06600002
066100             SET DP013-NO-ROLLBACK TO TRUE                        06610002
066200             MOVE '1000-CONTROL-PROCESSING'                       06620002
066300                                   TO DP013-PARAGRAPH             06630002
066400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06640002
066500                                   TO DP013-MESSAGE-TEXT(1)       06650002
066600             PERFORM DP013-0000-PROCESS-ABEND                     06660002
066700     END-EVALUATE.                                                06670002
066800                                                                  06680002
066900 EJECT                                                            06690002
067000*----------------------------------------------------------------*06700002
067100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06710002
067200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06720002
067300*----------------------------------------------------------------*06730002
067400                                                                  06740002
067500 1100-PROCESS-INTER-APPL-COMM.                                    06750002
067600                                                                  06760002
067700     SET PS-COMMAREA-VALID         TO TRUE.                       06770002
067800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06780002
067900                                                                  06790002
068000     IF  (TR001-PRO-NBR > SPACES OR TR001-BOL-NBR > SPACES)       06800002
068100         IF  (TR001-PRO-NBR > SPACES AND                          06810002
068200              TR001-BOL-NBR > SPACES)                             06820002
068300             SET ASC-PO-BOTH-CSR   TO TRUE                        06830002
068400         ELSE                                                     06840002
068500             IF  (TR001-PRO-NBR > SPACES)                         06850002
068600                 SET ASC-PO-PRO-CSR   TO TRUE                     06860002
068700             ELSE                                                 06870002
068800                 SET ASC-PO-BOL-CSR   TO TRUE                     06880002
068900             END-IF                                               06890002
069000         END-IF                                                   06900002
069100                                                                  06910002
069200         MOVE TR001-PRO-NBR        TO ASC-KEY-PRO-NBR             06920002
069300                                      RC023-FREIGHT-BILL          06930002
069400         CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA            06940002
069500         MOVE RC023-FREIGHT-BILL   TO DK-PRO-NBR                  06950002
069600                                                                  06960002
069700         MOVE TR001-BOL-NBR        TO ASC-KEY-BOL-NBR             06970002
069800                                      RC023-BILL-OF-LADING        06980002
069900         CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA            06990002
070000         MOVE RC023-BILL-OF-LADING TO DK-BOL-NBR                  07000002
070100                                                                  07010002
070200         MOVE TR001-SCAC           TO ASC-KEY-SCAC-ID             07020002
070300                                      DK-SCAC-ID                  07030002
070400                                                                  07040002
070500     ELSE                                                         07050002
070600          SET PS-COMMAREA-NOT-VALID                               07060002
070700                                   TO TRUE                        07070002
070800     END-IF.                                                      07080002
070900                                                                  07090002
071000 EJECT                                                            07100002
071100*----------------------------------------------------------------*07110002
071200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07120002
071300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07130002
071400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07140002
071500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07150002
071600* FUNCTION KEYS CAN GET THIS FAR.                                *07160002
071700*----------------------------------------------------------------*07170002
071800                                                                  07180002
071900 2000-PROCESS-PANEL.                                              07190002
072000     EVALUATE TRUE                                                07200002
072100         WHEN DP020-SRC-AID = DP016-CLEAR                         07210002
072200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07220002
072300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07230002
072400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07240002
072500                                                                  07250002
072600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07260002
072700             PERFORM 2140-DESELECT-ALL-ITEMS                      07270002
072800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07280002
072900                                                                  07290002
073000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07300002
073100             MOVE ASC-KEY-BOL-NBR  TO DK-BOL-NBR                  07310002
073200             MOVE ASC-KEY-PRO-NBR  TO DK-PRO-NBR                  07320002
073300             MOVE ASC-KEY-SCAC-ID  TO DK-SCAC-ID                  07330002
073400                                                                  07340002
073500             PERFORM 2050-DELETE-LIST-QUEUE                       07350002
073600             PERFORM 4000-BUILD-INITIAL-PANEL                     07360002
073700                                                                  07370002
073800         WHEN OTHER                                               07380002
073900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07390002
074000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07400002
074100             IF  PS-NO-ERROR                                      07410002
074200                 SET DP030-CONTINUE-GO                            07420002
074300                                 TO TRUE                          07430002
074400                 PERFORM 2100-CHECK-FUNCTION-KEY                  07440002
074500             ELSE                                                 07450002
074600                 SET DP030-OVERRIDE-GO                            07460002
074700                                 TO TRUE                          07470002
074800             END-IF                                               07480002
074900     END-EVALUATE.                                                07490002
075000 EJECT                                                            07500002
075100*----------------------------------------------------------------*07510002
075200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07520002
075300*----------------------------------------------------------------*07530002
075400 2050-DELETE-LIST-QUEUE.                                          07540002
075500                                                                  07550002
075600     EXEC CICS                                                    07560002
075700         DELETEQ TS                                               07570002
075800             QUEUE (ASC-LIST-QUEUE-NAME)                          07580002
075900             RESP  (PV-CICS-RESP)                                 07590002
076000     END-EXEC.                                                    07600002
076100                                                                  07610002
076200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07620002
076300        (PV-CICS-RESP = DFHRESP(QIDERR))                          07630002
076400         CONTINUE                                                 07640002
076500     ELSE                                                         07650002
076600         SET DP013-CICS-ABEND      TO TRUE                        07660002
076700         SET DP013-NO-ROLLBACK     TO TRUE                        07670002
076800                                                                  07680002
076900         MOVE '2050-DELETE-LIST-QUEUE'                            07690002
077000                                   TO DP013-PARAGRAPH             07700002
077100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07710002
077200                                   TO DP013-MESSAGE-TEXT (1)      07720002
077300         PERFORM DP013-0000-PROCESS-ABEND                         07730002
077400     END-IF.                                                      07740002
077500                                                                  07750002
077600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07760002
077700 EJECT                                                            07770002
077800*----------------------------------------------------------------*07780002
077900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07790002
078000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07800002
078100* CICS ARCHITECTURE API.                                         *07810002
078200*----------------------------------------------------------------*07820002
078300 2100-CHECK-FUNCTION-KEY.                                         07830002
078400     EVALUATE TRUE                                                07840002
078500                                                                  07850002
078600         WHEN DP020-FK-LOCAL-RETURN(DP020-SRC-AID)                07860002
078700             PERFORM 5000-GET-SEL-ITEM                            07870002
078800                                                                  07880002
078900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07890002
079000             MOVE +1               TO PV-TOP-ITEM                 07900002
079100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07910002
079200                                                                  07920002
079300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07930002
079400             PERFORM 2110-BROWSE-BACKWARD                         07940002
079500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07950002
079600                                                                  07960002
079700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07970002
079800             PERFORM 2120-BROWSE-FORWARD                          07980002
079900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07990002
080000                                                                  08000002
080100         WHEN DP020-SRC-AID = DP016-ENTER                         08010002
080200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08020002
080300             IF  PS-ERROR                                         08030002
080400                 CONTINUE                                         08040002
080500             ELSE                                                 08050002
080600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08060002
080700             END-IF                                               08070002
080800                                                                  08080002
080900         WHEN OTHER                                               08090002
081000             SET DP013-NO-ROLLBACK                                08100002
081100                 DP013-XCTL-DISPLAY-RESTART                       08110002
081200                 DP013-CICS-ABEND  TO TRUE                        08120002
081300             MOVE '2100-CHECK-FUNCTION-KEY'                       08130002
081400                                   TO DP013-PARAGRAPH             08140002
081500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08150002
081600                                   TO DP013-MESSAGE-TEXT (1)      08160002
081700             PERFORM DP013-0000-PROCESS-ABEND                     08170002
081800     END-EVALUATE.                                                08180002
081900*                                                                 08190002
082000*----------------------------------------------------------------*08200002
082100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08210002
082200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08220002
082300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08230002
082400*    MESSAGE.                                                    *08240002
082500*----------------------------------------------------------------*08250002
082600                                                                  08260002
082700 2110-BROWSE-BACKWARD.                                            08270002
082800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08280002
082900         GIVING PV-TOP-ITEM.                                      08290002
083000*                                                                 08300002
083100     IF  ((PV-TOP-ITEM < +1)                                      08310002
083200       OR (PV-TOP-ITEM = +1))                                     08320002
083300         MOVE +1                   TO PV-TOP-ITEM                 08330002
083400*        -- TOP OF LIST --                                        08340002
083500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08350002
083600         SET DP020-MSG-INFORMATIONAL TO TRUE                      08360002
083700     END-IF.                                                      08370002
083800                                                                  08380002
083900 EJECT                                                            08390002
084000*----------------------------------------------------------------*08400002
084100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08410002
084200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08420002
084300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08430002
084400*----------------------------------------------------------------*08440002
084500                                                                  08450002
084600 2120-BROWSE-FORWARD.                                             08460002
084700                                                                  08470002
084800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08480002
084900         GIVING PV-TOP-ITEM.                                      08490002
085000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08500002
085100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08510002
085200                                   TO PV-TOP-ITEM                 08520002
085300*        -- BOTTOM OF LIST --                                     08530002
085400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08540002
085500         SET DP020-MSG-INFORMATIONAL                              08550002
085600                                   TO TRUE                        08560002
085700     ELSE                                                         08570002
085800         COMPUTE PV-BOTTOM-ITEM =                                 08580002
085900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08590002
086000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08600002
086100*            -- BOTTOM OF LIST --                                 08610002
086200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08620002
086300             SET DP020-MSG-INFORMATIONAL                          08630002
086400                                   TO TRUE                        08640002
086500         END-IF                                                   08650002
086600     END-IF.                                                      08660002
086700 EJECT                                                            08670002
086800*----------------------------------------------------------------*08680002
086900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08690002
087000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08700002
087100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08710002
087200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08720002
087300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08730002
087400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08740002
087500*----------------------------------------------------------------*08750002
087600                                                                  08760002
087700 2130-CHECK-FOR-JUMP-BROWSE.                                      08770002
087800     SET PS-NO-ERROR               TO TRUE.                       08780002
087900     IF (ASC-START-ITEM-REQUEST = SPACE)                          08790002
088000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08800002
088100                                   TO PV-TOP-ITEM                 08810002
088200     ELSE                                                         08820002
088300         MOVE ASC-START-ITEM-REQUEST                              08830002
088400                                   TO DP010I-UNEDITED-FIELD       08840002
088500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08850002
088600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08860002
088700         SET DP010I-NEGATIVE-NOT-ALLOWED                          08870002
088800                                   TO TRUE                        08880002
088900         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08890002
089000              USING DP010I-NUMERIC-EDIT-AREA                      08900002
089100                                                                  08910002
089200         IF  NOT DP010I-ERROR-DETECTED                            08920002
089300             MOVE DP010I-NUMERIC-FIELD                            08930002
089400                                   TO  ASC-START-ITEM-REQUEST-N   08940002
089500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08950002
089600                 IF  ASC-START-ITEM-REQUEST-N >                   08960002
089700                                          ASC-NUMBER-OF-ITEMS-READ08970002
089800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08980002
089900                     COMPUTE PV-TOP-ITEM =                        08990002
090000                             ASC-NUMBER-OF-ITEMS-READ             09000002
090100                             - PC-ITEMS-PER-PANEL + 1             09010002
090200                     IF  PV-TOP-ITEM < +1                         09020002
090300                         MOVE +1   TO PV-TOP-ITEM                 09030002
090400                         MOVE PC-TSYMSG-00070                     09040002
090500                                   TO DP020-MSG-NUMBER            09050002
090600                         SET DP020-MSG-INFORMATIONAL              09060002
090700                                   TO TRUE                        09070002
090800                     END-IF                                       09080002
090900                 ELSE                                             09090002
091000                     MOVE ASC-START-ITEM-REQUEST-N                09100002
091100                                   TO PV-TOP-ITEM                 09110002
091200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09120002
091300                     COMPUTE PV-BOTTOM-ITEM =                     09130002
091400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09140002
091500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09150002
091600*                        -- BOTTOM OF LIST --                     09160002
091700                         MOVE PC-TSYMSG-00070                     09170002
091800                                   TO DP020-MSG-NUMBER            09180002
091900                         SET DP020-MSG-INFORMATIONAL              09190002
092000                                   TO TRUE                        09200002
092100                     END-IF                                       09210002
092200                 END-IF                                           09220002
092300             ELSE                                                 09230002
092400*                --- VALUE OUT OF RANGE ----                      09240002
092500                 MOVE PC-TSYMSG-00101                             09250002
092600                                   TO DP020-MSG-NUMBER            09260002
092700                 MOVE -1           TO ASTRTITL                    09270002
092800                 SET DP030-SET-CURSOR-APPL-1                      09280002
092900                                   TO TRUE                        09290002
093000                 MOVE DP015-REVERSE                               09300002
093100                                   TO ASTRTITH                    09310002
093200                 MOVE DP015-RED    TO ASTRTITC                    09320002
093300                 MOVE DP015-UNP-NUM-BRT-MDT                       09330002
093400                                   TO ASTRTITA                    09340002
093500                 SET DP020-MSG-FATAL                              09350002
093600                                   TO TRUE                        09360002
093700                 SET PS-ERROR      TO TRUE                        09370002
093800             END-IF                                               09380002
093900                                                                  09390002
094000         ELSE                                                     09400002
094100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09410002
094200             MOVE -1               TO ASTRTITL                    09420002
094300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09430002
094400             MOVE DP015-REVERSE    TO ASTRTITH                    09440002
094500             MOVE DP015-RED        TO ASTRTITC                    09450002
094600             MOVE DP015-UNP-NUM-BRT-MDT                           09460002
094700                                   TO ASTRTITA                    09470002
094800             SET DP020-MSG-FATAL   TO TRUE                        09480002
094900             SET PS-ERROR          TO TRUE                        09490002
095000         END-IF                                                   09500002
095100     END-IF.                                                      09510002
095200*----------------------------------------------------------------*09520002
095300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09530002
095400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09540002
095500*----------------------------------------------------------------*09550002
095600 2140-DESELECT-ALL-ITEMS.                                         09560002
095700     MOVE +1                       TO ASC-BLK-SUB.                09570002
095800                                                                  09580002
095900     PERFORM 2141-CLEAR-SELECTED-INDS                             09590002
096000         VARYING ASC-ITEM-SUB                                     09600002
096100         FROM 1 BY 1                                              09610002
096200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09620002
096300                                                                  09630002
096400     ADD +1                        TO ASC-BLK-SUB.                09640002
096500                                                                  09650002
096600     PERFORM 2141-CLEAR-SELECTED-INDS                             09660002
096700         VARYING ASC-ITEM-SUB                                     09670002
096800         FROM 1 BY 1                                              09680002
096900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09690002
097000                                                                  09700002
097100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09710002
097200                                   TO PV-LIST-ITEM-NUMBER.        09720002
097300                                                                  09730002
097400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09740002
097500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09750002
097600                                                                  09760002
097700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09770002
097800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09780002
097900         MOVE +1                   TO ASC-BLK-SUB                 09790002
098000                                                                  09800002
098100         PERFORM 5100-WRITE-TEMP-STORAGE                          09810002
098200                                                                  09820002
098300         MOVE +1                   TO PV-BLOCK-NUMBER             09830002
098400                                                                  09840002
098500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09850002
098600             PV-FIRST-BLOCK-IN-ARRAY - 1                          09860002
098700                                                                  09870002
098800         PERFORM                                                  09880002
098900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09890002
099000                                                                  09900002
099100             PERFORM 4410-READ-TEMP-STORAGE                       09910002
099200                                                                  09920002
099300             PERFORM 2141-CLEAR-SELECTED-INDS                     09930002
099400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09940002
099500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09950002
099600                                                                  09960002
099700             PERFORM 5100-WRITE-TEMP-STORAGE                      09970002
099800                                                                  09980002
099900             ADD +1                TO PV-BLOCK-NUMBER             09990002
100000                                                                  10000002
100100         END-PERFORM                                              10010002
100200                                                                  10020002
100300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10030002
100400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10040002
100500                                                                  10050002
100600         PERFORM                                                  10060002
100700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10070002
100800                   ASC-HIGHEST-BLOCK-WRITTEN                      10080002
100900                                                                  10090002
101000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10100002
101100                                   TO PV-BLOCK-NUMBER             10110002
101200                                                                  10120002
101300             PERFORM 4410-READ-TEMP-STORAGE                       10130002
101400                                                                  10140002
101500             PERFORM 2141-CLEAR-SELECTED-INDS                     10150002
101600                 VARYING ASC-ITEM-SUB                             10160002
101700                 FROM 1 BY 1                                      10170002
101800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10180002
101900                                                                  10190002
102000             PERFORM 5100-WRITE-TEMP-STORAGE                      10200002
102100                                                                  10210002
102200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10220002
102300                                                                  10230002
102400         END-PERFORM                                              10240002
102500                                                                  10250002
102600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10260002
102700                                   TO PV-BLOCK-NUMBER             10270002
102800                                                                  10280002
102900         PERFORM 4410-READ-TEMP-STORAGE                           10290002
103000     END-IF.                                                      10300002
103100                                                                  10310002
103200                                                                  10320002
103300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 10330002
103400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10340002
103500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10350002
103600                                                                  10360002
103700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10370002
103800                                                                  10380002
103900 EJECT                                                            10390002
104000*----------------------------------------------------------------*10400002
104100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10410002
104200*----------------------------------------------------------------*10420002
104300                                                                  10430002
104400 2141-CLEAR-SELECTED-INDS.                                        10440002
104500                                                                  10450002
104600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10460002
104700             NOT EQUAL ZERO                                       10470002
104800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10480002
104900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10490002
105000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10500002
105100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10510002
105200                                   TO TRUE                        10520002
105300         END-IF                                                   10530002
105400     END-IF.                                                      10540002
105500                                                                  10550002
105600 EJECT                                                            10560002
105700******************************************************************10570002
105800** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10580002
105900** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10590002
106000******************************************************************10600002
106100 2200-MOVE-SCREEN-TO-COMMAREA.                                    10610002
106200                                                                  10620002
106300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10630002
106400     MOVE +1                       TO PV-SUB.                     10640002
106500*                                                                 10650002
106600     PERFORM 3100-SET-SUBSCRIPTS.                                 10660002
106700     IF  ASTRTITL > ZERO                                          10670002
106800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10680002
106900     ELSE                                                         10690002
107000         IF  ASTRTITF = DP015-ERASE-EOF                           10700002
107100             INITIALIZE ASC-START-ITEM-REQUEST                    10710002
107200         END-IF                                                   10720002
107300     END-IF.                                                      10730002
107400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10740002
107500         VARYING PV-SUB                                           10750002
107600         FROM 1 BY 1                                              10760002
107700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10770002
107800******************************************************************10780002
107900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10790002
108000******************************************************************10800002
108100 2210-MOVE-LINES-TO-COMMAREA.                                     10810002
108200     IF  MR-SELECTL (PV-SUB) > ZERO                               10820002
108300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10830002
108400         MOVE MR-SELECTI (PV-SUB)                                 10840002
108500                                   TO ASC-TEMP-SELECTED-SW        10850002
108600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10860002
108700     ELSE                                                         10870002
108800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10880002
108900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10890002
109000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10900002
109100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10910002
109200         END-IF                                                   10920002
109300     END-IF.                                                      10930002
109400     ADD +1                        TO ASC-ITEM-SUB.               10940002
109500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10950002
109600         ADD +1                    TO ASC-BLK-SUB                 10960002
109700         MOVE +1                   TO ASC-ITEM-SUB                10970002
109800     END-IF.                                                      10980002
109900******************************************************************10990002
110000** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **11000002
110100** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11010002
110200******************************************************************11020002
110300 3000-EDIT-DATA-IN-COMMAREA.                                      11030002
110400     SET PS-NO-ERROR               TO TRUE.                       11040002
110500     PERFORM 3200-RESET-ATTRIBUTES.                               11050002
110600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11060002
110700**                                                                11070002
110800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11080002
110900* EDITTING IS DONE FROM THE BOTTOM UP.                            11090002
111000**                                                                11100002
111100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11110002
111200         ASC-ITEMS-DISPLAYED - 1.                                 11120002
111300     PERFORM 3100-SET-SUBSCRIPTS.                                 11130002
111400     PERFORM 3300-EDIT-SELECTIONS                                 11140002
111500         VARYING PV-SUB                                           11150002
111600         FROM PV-SUB BY -1                                        11160002
111700         UNTIL PV-SUB < +1                                        11170002
111800                                                                  11180002
111900     IF ASC-NUMBER-OF-SELECTED-ITEMS > +1                         11190002
112000         MOVE PC-TSYMSG-00047   TO DP020-MSG-NUMBER               11200002
112100         SET DP020-MSG-FATAL    TO TRUE                           11210002
112200         SET DP030-SET-CURSOR-APPL-1                              11220002
112300                                TO TRUE                           11230002
112400         SET PS-ERROR           TO TRUE                           11240002
112500     END-IF.                                                      11250002
112600 EJECT                                                            11260002
112700*----------------------------------------------------------------*11270002
112800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11280002
112900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11290002
113000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11300002
113100*                                                                *11310002
113200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11320002
113300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11330002
113400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11340002
113500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11350002
113600*----------------------------------------------------------------*11360002
113700                                                                  11370002
113800 3100-SET-SUBSCRIPTS.                                             11380002
113900                                                                  11390002
114000     COMPUTE ASC-ITEM-SUB =                                       11400002
114100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11410002
114200                                                                  11420002
114300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11430002
114400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11440002
114500                                                                  11450002
114600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11460002
114700     ELSE                                                         11470002
114800         MOVE +1                     TO ASC-BLK-SUB               11480002
114900     END-IF.                                                      11490002
115000******************************************************************11500002
115100** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11510002
115200******************************************************************11520002
115300                                                                  11530002
115400 3200-RESET-ATTRIBUTES.                                           11540002
115500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11550002
115600     MOVE DP015-GREEN              TO ASTRTITC.                   11560002
115700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11570002
115800*                                                                 11580002
115900     PERFORM                                                      11590002
116000         VARYING PV-SUB                                           11600002
116100         FROM 1 BY 1                                              11610002
116200         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11620002
116300         MOVE DP015-UNP-ALP-NOR-OFF                               11630002
116400                                   TO MR-SELECTA (PV-SUB)         11640002
116500         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11650002
116600         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11660002
116700     END-PERFORM.                                                 11670002
116800******************************************************************11680002
116900** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11690002
117000** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11700002
117100** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11710002
117200** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11720002
117300******************************************************************11730002
117400 3300-EDIT-SELECTIONS.                                            11740002
117500     EVALUATE TRUE                                                11750002
117600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11760002
117700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11770002
117800                 CONTINUE                                         11780002
117900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11790002
118000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11800002
118100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11810002
118200                 MOVE ASC-TEMP-SELECTED-SW                        11820002
118300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11830002
118400                                TO ASC-SELECTED-SW                11840002
118500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11850002
118600             END-IF                                               11860002
118700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11870002
118800                 = SPACE                                          11880002
118900             EVALUATE TRUE                                        11890002
119000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11900002
119100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11910002
119200                     MOVE SPACE TO ASC-SELECTED-SW                11920002
119300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11930002
119400                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11940002
119500                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11950002
119600                     MOVE SPACE TO ASC-SELECTED-SW                11960002
119700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11970002
119800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11980002
119900                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11990002
120000                     MOVE SPACE TO ASC-SELECTED-SW                12000002
120100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12010002
120200             END-EVALUATE                                         12020002
120300         WHEN OTHER                                               12030002
120400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12040002
120500             SET DP020-MSG-FATAL    TO TRUE                       12050002
120600             MOVE -1                TO MR-SELECTL (PV-SUB)        12060002
120700             SET DP030-SET-CURSOR-APPL-1                          12070002
120800                                    TO TRUE                       12080002
120900             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12090002
121000             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12100002
121100             SET PS-ERROR TO TRUE                                 12110002
121200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12120002
121300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12130002
121400                 MOVE SPACE         TO ASC-SELECTED-SW            12140002
121500                                        (ASC-BLK-SUB ASC-ITEM-SUB)12150002
121600             END-IF                                               12160002
121700     END-EVALUATE.                                                12170002
121800                                                                  12180002
121900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12190002
122000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12200002
122100     IF  ASC-ITEM-SUB < 1                                         12210002
122200         SUBTRACT +1 FROM ASC-BLK-SUB                             12220002
122300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12230002
122400     END-IF.                                                      12240002
122500 EJECT                                                            12250002
122600*----------------------------------------------------------------*12260002
122700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *12270002
122800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *12280002
122900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *12290002
123000*    DISPLAY THE PANEL TO USER.                                  *12300002
123100*----------------------------------------------------------------*12310002
123200                                                                  12320002
123300 4000-BUILD-INITIAL-PANEL.                                        12330002
123400                                                                  12340002
123500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            12350002
123600                                 ASC-BLOCK-ENTRIES (2).           12360002
123700     MOVE +1                 TO ASC-BLK-SUB.                      12370002
123800     SET ASC-ITEMS-LEFT-ON-DB                                     12380002
123900                             TO TRUE.                             12390002
124000                                                                  12400002
124100     MOVE +0                 TO ASC-ITEM-SUB                      12410002
124200                                ASC-NUMBER-OF-ITEMS-READ          12420002
124300                                ASC-NUMBER-OF-SELECTED-ITEMS      12430002
124400                                ASC-HIGHEST-BLOCK-WRITTEN         12440002
124500                                ASC-START-OF-SELECTED-RANGE       12450002
124600                                ASC-END-OF-SELECTED-RANGE         12460002
124700                                ASC-ITEM-AT-TOP-OF-PANEL.         12470002
124800                                                                  12480002
124900     PERFORM 4010-OPEN-CURSOR.                                    12490002
125000                                                                  12500002
125100     PERFORM 4300-READ-ITEMS-FROM-DB.                             12510002
125200                                                                  12520002
125300     PERFORM 4020-CLOSE-CURSOR.                                   12530002
125400                                                                  12540002
125500     MOVE +1                   TO  PV-TOP-ITEM.                   12550002
125600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          12560002
125700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    12570002
125800         SET DP020-MSG-FATAL   TO  TRUE                           12580002
125900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               12590002
126000     ELSE                                                         12600002
126100         MOVE -1               TO MR-SELECTL (1)                  12610002
126200         SET DP030-SET-CURSOR-APPL-1                              12620002
126300                               TO TRUE                            12630002
126400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     12640002
126500     END-IF.                                                      12650002
126600 EJECT                                                            12660002
126700*----------------------------------------------------------------*12670002
126800* OPEN THE PO CURSOR.                                            *12680002
126900*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *12690002
127000*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *12700002
127100*   USER.                                                        *12710002
127200*----------------------------------------------------------------*12720002
127300                                                                  12730002
127400 4010-OPEN-CURSOR.                                                12740002
127500     PERFORM                                                      12750002
127600         WITH TEST AFTER                                          12760002
127700         VARYING PV-RETRY-COUNTER                                 12770002
127800         FROM 1 BY 1                                              12780002
127900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12790002
128000                   OR (SQLCODE = ZERO))                           12800002
128100                                                                  12810002
128200         EVALUATE TRUE                                            12820002
128300             WHEN ASC-PO-BOTH-CSR                                 12830002
128400                 MOVE 'CURSOR:  PO-BOTH-CSR'                      12840002
128500                                      TO  DP013-MESSAGE-TEXT (2)  12850002
128600                 EXEC SQL                                         12860002
128700                      OPEN PO-BOTH-CSR                            12870002
128800                 END-EXEC                                         12880002
128900                                                                  12890002
129000             WHEN ASC-PO-PRO-CSR                                  12900002
129100                 MOVE 'CURSOR:  PO-PRO-CSR '                      12910002
129200                                      TO  DP013-MESSAGE-TEXT (2)  12920002
129300                 EXEC SQL                                         12930002
129400                      OPEN PO-PRO-CSR                             12940002
129500                 END-EXEC                                         12950002
129600                                                                  12960002
129700             WHEN ASC-PO-BOL-CSR                                  12970002
129800                 MOVE 'CURSOR:  PO-BOL-CSR '                      12980002
129900                                      TO  DP013-MESSAGE-TEXT (2)  12990002
130000                 EXEC SQL                                         13000002
130100                      OPEN PO-BOL-CSR                             13010002
130200                 END-EXEC                                         13020002
130300                                                                  13030002
130400         END-EVALUATE                                             13040002
130500                                                                  13050002
130600         EVALUATE TRUE                                            13060002
130700             WHEN SQLCODE = ZERO                                  13070002
130800             WHEN SQLCODE = -904                                  13080002
130900             WHEN SQLCODE = -913                                  13090002
131000                 CONTINUE                                         13100002
131100             WHEN SQLWARN0 NOT = SPACES                           13110002
131200             WHEN SQLCODE < ZERO                                  13120002
131300             WHEN SQLCODE > ZERO                                  13130002
131400                 MOVE '4010-OPEN-CURSOR'                          13140002
131500                                   TO DP013-PARAGRAPH             13150002
131600                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             13160002
131700                                   TO DP013-MESSAGE-TEXT (1)      13170002
131800                 MOVE SQLCA        TO DP013-SQLCA                 13180002
131900                 MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    13190002
132000                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)    13200002
132100                 SET DP013-DB2-ABEND                              13210002
132200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13220002
132300                 PERFORM DP013-0000-PROCESS-ABEND                 13230002
132400         END-EVALUATE                                             13240002
132500     END-PERFORM.                                                 13250002
132600*                                                                 13260002
132700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13270002
132800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             13280002
132900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   13290002
133000                                   TO DP013-MESSAGE-TEXT (1)      13300002
133100         MOVE SQLCA                TO DP013-SQLCA                 13310002
133200         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    13320002
133300         MOVE 'TSHPTPO '           TO DP013-DB2-TABLE-NAME (2)    13330002
133400         SET DP013-DB2-ABEND                                      13340002
133500             DP013-XCTL-DISPLAY-RESTART                           13350002
133600                                   TO TRUE                        13360002
133700         PERFORM DP013-0000-PROCESS-ABEND                         13370002
133800     END-IF.                                                      13380002
133900                                                                  13390002
134000 EJECT                                                            13400002
134100*----------------------------------------------------------------*13410002
134200* CLOSE THE TMESSAGE CURSOR.                                     *13420002
134300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *13430002
134400*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *13440002
134500*   USER.                                                        *13450002
134600*----------------------------------------------------------------*13460002
134700                                                                  13470002
134800 4020-CLOSE-CURSOR.                                               13480002
134900                                                                  13490002
135000     EVALUATE TRUE                                                13500002
135100         WHEN ASC-PO-BOTH-CSR                                     13510002
135200             MOVE 'CURSOR:  PO-BOTH-CSR'                          13520002
135300                                     TO  DP013-MESSAGE-TEXT (2)   13530002
135400             EXEC SQL                                             13540002
135500                  CLOSE PO-BOTH-CSR                               13550002
135600             END-EXEC                                             13560002
135700                                                                  13570002
135800         WHEN ASC-PO-PRO-CSR                                      13580002
135900             MOVE 'CURSOR:  PO-PRO-CSR '                          13590002
136000                                     TO  DP013-MESSAGE-TEXT (2)   13600002
136100             EXEC SQL                                             13610002
136200                  CLOSE PO-PRO-CSR                                13620002
136300             END-EXEC                                             13630002
136400                                                                  13640002
136500         WHEN ASC-PO-BOL-CSR                                      13650002
136600             MOVE 'CURSOR:  PO-BOL-CSR '                          13660002
136700                                     TO  DP013-MESSAGE-TEXT (2)   13670002
136800             EXEC SQL                                             13680002
136900                  CLOSE PO-BOL-CSR                                13690002
137000             END-EXEC                                             13700002
137100     END-EVALUATE                                                 13710002
137200*                                                                 13720002
137300     EVALUATE TRUE                                                13730002
137400         WHEN SQLCODE = ZERO                                      13740002
137500             CONTINUE                                             13750002
137600         WHEN SQLWARN0 NOT = SPACES                               13760002
137700         WHEN SQLCODE < ZERO                                      13770002
137800         WHEN SQLCODE > ZERO                                      13780002
137900             MOVE '4020-CLOSE-CURSOR'                             13790002
138000                               TO DP013-PARAGRAPH                 13800002
138100             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  13810002
138200                               TO DP013-MESSAGE-TEXT (1)          13820002
138300             MOVE SQLCA        TO DP013-SQLCA                     13830002
138400             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        13840002
138500             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        13850002
138600             SET DP013-DB2-ABEND                                  13860002
138700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13870002
138800             PERFORM DP013-0000-PROCESS-ABEND                     13880002
138900     END-EVALUATE.                                                13890002
139000*----------------------------------------------------------------*13900002
139100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *13910002
139200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *13920002
139300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *13930002
139400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *13940002
139500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *13950002
139600*                                                                *13960002
139700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *13970002
139800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *13980002
139900*    UPON INITIALIZATION.                                        *13990002
140000*----------------------------------------------------------------*14000002
140100                                                                  14010002
140200 4300-READ-ITEMS-FROM-DB.                                         14020002
140300                                                                  14030002
140400     PERFORM                                                      14040002
140500         VARYING PV-READ-COUNT                                    14050002
140600         FROM 1 BY 1                                              14060002
140700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    14070002
140800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         14080002
140900                                                                  14090002
141000         PERFORM 4310-FETCH                                       14100002
141100                                                                  14110002
141200                                                                  14120002
141300         IF  ASC-ITEMS-LEFT-ON-DB                                 14130002
141400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                14140002
141500                 ADD +1            TO ASC-ITEM-SUB                14150002
141600             ELSE                                                 14160002
141700                 ADD +1            TO ASC-BLK-SUB                 14170002
141800                 MOVE +1           TO ASC-ITEM-SUB                14180002
141900                                                                  14190002
142000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         14200002
142100                     MOVE +1       TO ASC-BLK-SUB                 14210002
142200                     SET ASC-BLOCK-MODIFIED (1)                   14220002
142300                                   TO TRUE                        14230002
142400                     PERFORM 5100-WRITE-TEMP-STORAGE              14240002
142500                     MOVE ASC-BLOCK-ENTRIES                       14250002
142600                               (PC-MAX-BLOCKS-IN-ARRAY)           14260002
142700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14270002
142800                     ADD +1        TO ASC-BLK-SUB                 14280002
142900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14290002
143000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14300002
143100                                   TO TRUE                        14310002
143200                 END-IF                                           14320002
143300             END-IF                                               14330002
143400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14340002
143500                                                                  14350002
143600             MOVE ASC-NUMBER-OF-ITEMS-READ                        14360002
143700                                   TO ASC-LIST-ITEM-NUMBER        14370002
143800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14380002
143900* SELECT THE REST OF THE PO INFORMATION                           14390002
144000                                                                  14400002
144100             IF SHIPMT-TRIP-ID = DK-TRIP-ID                       14410002
144200                 CONTINUE                                         14420002
144300             ELSE                                                 14430002
144400                 MOVE SHIPMT-TRIP-ID TO DK-TRIP-ID                14440002
144500                 PERFORM 4320-SELECT-OPER-UNT-ID                  14450002
144600             END-IF                                               14460002
144700                                                                  14470002
144800* MOVE PO INFORMATION TO COMM AREA                                14480002
144900                                                                  14490002
145000             MOVE SHPTPO-PO-NBR    TO ASC-PO-NBR                  14500002
145100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14510002
145200                                                                  14520002
145300             MOVE SHIPMT-SHIPT-ID  TO ASC-SHIPT-ID                14530002
145400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14540002
145500                                                                  14550002
145600             MOVE SHIPMT-COMPLETE-PRO-NBR                         14560002
145700                                   TO  ASC-COMPLETE-PRO-NBR       14570002
145800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14580002
145900                                                                  14590002
146000             MOVE SHIPMT-COMPLETE-BOL-NBR                         14600002
146100                                   TO  ASC-COMPLETE-BOL-NBR       14610002
146200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14620002
146300                                                                  14630002
146400             IF SHPTPO-REC-SEQ-NBR > 0                            14640002
146500                 MOVE 'Y'          TO ASC-REC-IND                 14650002
146600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14660002
146700             ELSE                                                 14670002
146800                 MOVE 'N'          TO ASC-REC-IND                 14680002
146900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14690002
147000             END-IF                                               14700002
147100                                                                  14710002
147200             MOVE SHPTPO-VEND-NAME TO  ASC-VEND-NAME              14720002
147300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14730002
147400                                                                  14740002
147500             IF SHPTPO-ACTL-CART-CNT > 0                          14750002
147600                 MOVE SHPTPO-ACTL-CART-CNT                        14760002
147700                                   TO  ASC-CART-CNT               14770002
147800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14780002
147900             ELSE                                                 14790002
148000                 MOVE SHPTPO-EXPTED-CART-CNT                      14800002
148100                                   TO  ASC-CART-CNT               14810002
148200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14820002
148300             END-IF                                               14830002
148400                                                                  14840002
148500             MOVE TRIPST-OPER-UNT-ID                              14850002
148600                                   TO ASC-OPER-UNT-ID             14860002
148700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14870002
148800                                                                  14880002
148900             SET ASC-LIST-RECORD (ASC-BLK-SUB ASC-ITEM-SUB)       14890002
149000                                   TO TRUE                        14900002
149100                                                                  14910002
149200         END-IF                                                   14920002
149300     END-PERFORM.                                                 14930002
149400                                                                  14940002
149500*    PUT USER DEFINED SHIPMENT INFORMATION TRANSERFER FROM THE    14950002
149600*    SHIPMENT FORCAST ADD SCREEN AT THE END OF THE LIST.          14960002
149700                                                                  14970002
149800     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        14980002
149900         ADD +1                    TO ASC-ITEM-SUB                14990002
150000     ELSE                                                         15000002
150100         ADD +1                    TO ASC-BLK-SUB                 15010002
150200         MOVE +1                   TO ASC-ITEM-SUB                15020002
150300                                                                  15030002
150400         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 15040002
150500             MOVE +1               TO ASC-BLK-SUB                 15050002
150600             SET ASC-BLOCK-MODIFIED (1)                           15060002
150700                                   TO TRUE                        15070002
150800             PERFORM 5100-WRITE-TEMP-STORAGE                      15080002
150900             MOVE ASC-BLOCK-ENTRIES (PC-MAX-BLOCKS-IN-ARRAY)      15090002
151000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 15100002
151100             ADD +1                TO ASC-BLK-SUB                 15110002
151200             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           15120002
151300             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              15130002
151400                                   TO TRUE                        15140002
151500         END-IF                                                   15150002
151600     END-IF                                                       15160002
151700     ADD +1                        TO ASC-NUMBER-OF-ITEMS-READ    15170002
151800                                                                  15180002
151900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER        15190002
152000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15200002
152100                                                                  15210002
152200     MOVE TR001-PO-NBR             TO ASC-PO-NBR                  15220002
152300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15230002
152400                                                                  15240002
152500     MOVE TR001-SHIPT-ID           TO ASC-SHIPT-ID                15250002
152600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15260002
152700                                                                  15270002
152800     MOVE TR001-PRO-NBR            TO  ASC-COMPLETE-PRO-NBR       15280002
152900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15290002
153000                                                                  15300002
153100     MOVE TR001-BOL-NBR            TO  ASC-COMPLETE-BOL-NBR       15310002
153200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15320002
153300                                                                  15330002
153400     MOVE 'N'                      TO  ASC-REC-IND                15340002
153500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15350002
153600                                                                  15360002
153700     MOVE SPACES                   TO  ASC-VEND-NAME              15370002
153800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15380002
153900                                       ASC-OPER-UNT-ID            15390002
154000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15400002
154100                                                                  15410002
154200     MOVE 0                        TO  ASC-CART-CNT               15420002
154300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15430002
154400                                                                  15440002
154500     SET ASC-USER-RECORD (ASC-BLK-SUB ASC-ITEM-SUB)               15450002
154600                                   TO TRUE                        15460002
154700                                                                  15470002
154800                                                                  15480002
154900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          15490002
155000         MOVE +1               TO ASC-BLK-SUB                     15500002
155100         PERFORM 5100-WRITE-TEMP-STORAGE                          15510002
155200         ADD +1                TO ASC-BLK-SUB                     15520002
155300         PERFORM 5100-WRITE-TEMP-STORAGE                          15530002
155400                                                                  15540002
155500         MOVE 1                TO ASC-BLK-SUB                     15550002
155600                                  PV-BLOCK-NUMBER                 15560002
155700         PERFORM 4410-READ-TEMP-STORAGE                           15570002
155800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             15580002
155900             MOVE 2            TO ASC-BLK-SUB                     15590002
156000                                  PV-BLOCK-NUMBER                 15600002
156100             PERFORM 4410-READ-TEMP-STORAGE                       15610002
156200         END-IF                                                   15620002
156300     END-IF.                                                      15630002
156400 EJECT                                                            15640002
156500*----------------------------------------------------------------*15650002
156600*    FETCH THE MESSAGE CURSOR.                                   *15660002
156700*----------------------------------------------------------------*15670002
156800                                                                  15680002
156900 4310-FETCH.                                                      15690002
157000                                                                  15700002
157100     EVALUATE TRUE                                                15710002
157200         WHEN ASC-PO-BOTH-CSR                                     15720002
157300             EXEC SQL                                             15730002
157400                  FETCH PO-BOTH-CSR                               15740002
157500                  INTO  :SHPTPO-PO-NBR                            15750002
157600                      , :SHIPMT-TRIP-ID                           15760002
157700                      , :SHIPMT-SHIPT-ID                          15770002
157800                      , :SHIPMT-PRO-NBR                           15780002
157900                      , :SHIPMT-BOL-NBR                           15790002
158000                      , :SHIPMT-COMPLETE-PRO-NBR                  15800002
158100                      , :SHIPMT-COMPLETE-BOL-NBR                  15810002
158200                      , :SHPTPO-REC-SEQ-NBR                       15820002
158300                      , :SHPTPO-VEND-NAME                         15830002
158400                      , :SHPTPO-EXPTED-CART-CNT                   15840002
158500                      , :SHPTPO-ACTL-CART-CNT                     15850002
158600             END-EXEC                                             15860002
158700                                                                  15870002
158800         WHEN ASC-PO-BOL-CSR                                      15880002
158900             EXEC SQL                                             15890002
159000                  FETCH PO-BOL-CSR                                15900002
159100                  INTO  :SHPTPO-PO-NBR                            15910002
159200                      , :SHIPMT-TRIP-ID                           15920002
159300                      , :SHIPMT-SHIPT-ID                          15930002
159400                      , :SHIPMT-PRO-NBR                           15940002
159500                      , :SHIPMT-BOL-NBR                           15950002
159600                      , :SHIPMT-COMPLETE-PRO-NBR                  15960002
159700                      , :SHIPMT-COMPLETE-BOL-NBR                  15970002
159800                      , :SHPTPO-REC-SEQ-NBR                       15980002
159900                      , :SHPTPO-VEND-NAME                         15990002
160000                      , :SHPTPO-EXPTED-CART-CNT                   16000002
160100                      , :SHPTPO-ACTL-CART-CNT                     16010002
160200             END-EXEC                                             16020002
160300                                                                  16030002
160400         WHEN ASC-PO-PRO-CSR                                      16040002
160500             EXEC SQL                                             16050002
160600                  FETCH PO-PRO-CSR                                16060002
160700                  INTO  :SHPTPO-PO-NBR                            16070002
160800                      , :SHIPMT-TRIP-ID                           16080002
160900                      , :SHIPMT-SHIPT-ID                          16090002
161000                      , :SHIPMT-PRO-NBR                           16100002
161100                      , :SHIPMT-BOL-NBR                           16110002
161200                      , :SHIPMT-COMPLETE-PRO-NBR                  16120002
161300                      , :SHIPMT-COMPLETE-BOL-NBR                  16130002
161400                      , :SHPTPO-REC-SEQ-NBR                       16140002
161500                      , :SHPTPO-VEND-NAME                         16150002
161600                      , :SHPTPO-EXPTED-CART-CNT                   16160002
161700                      , :SHPTPO-ACTL-CART-CNT                     16170002
161800             END-EXEC                                             16180002
161900     END-EVALUATE.                                                16190002
162000                                                                  16200002
162100                                                                  16210002
162200     EVALUATE TRUE                                                16220002
162300         WHEN SQLCODE = ZERO                                      16230002
162400         WHEN SQLCODE = +100                                      16240002
162500              CONTINUE                                            16250002
162600         WHEN SQLWARN0 NOT = SPACE                                16260002
162700         WHEN SQLCODE NOT = ZERO                                  16270002
162800              MOVE '4310-FETCH-CURSOR'                            16280002
162900                               TO DP013-PARAGRAPH                 16290002
163000              MOVE 'FETCH PO CURSOR'                              16300002
163100                               TO DP013-MESSAGE-TEXT (1)          16310002
163200              MOVE SQLCA       TO DP013-SQLCA                     16320002
163300              SET DP013-DB2-ABEND                                 16330002
163400                               TO TRUE                            16340002
163500              PERFORM DP013-0000-PROCESS-ABEND                    16350002
163600     END-EVALUATE.                                                16360002
163700                                                                  16370002
163800     IF  SQLCODE EQUAL +100                                       16380002
163900         SET ASC-NO-ITEMS-LEFT-ON-DB                              16390002
164000                                   TO TRUE                        16400002
164100     END-IF.                                                      16410002
164200                                                                  16420002
164300 EJECT                                                            16430002
164400                                                                  16440002
164500                                                                  16450002
164600*----------------------------------------------------------------*16460002
164700*    SELECT THE OPERATING UNIT ID                                *16470002
164800*----------------------------------------------------------------*16480002
164900 4320-SELECT-OPER-UNT-ID.                                         16490002
165000                                                                  16500002
165100     EXEC SQL                                                     16510002
165200         OPEN STATUS_CURSOR                                       16520002
165300     END-EXEC                                                     16530002
165400                                                                  16540002
165500     EVALUATE TRUE                                                16550002
165600         WHEN SQLCODE = ZERO                                      16560002
165700              CONTINUE                                            16570002
165800         WHEN SQLWARN0 NOT = SPACE                                16580002
165900         WHEN SQLCODE NOT = ZERO                                  16590002
166000              MOVE '4320-SELECT-OPER-UNT-ID'                      16600002
166100                               TO DP013-PARAGRAPH                 16610002
166200              MOVE 'OPEN STATUS_CURSOR'                           16620002
166300                               TO DP013-MESSAGE-TEXT (1)          16630002
166400              MOVE SQLCA       TO DP013-SQLCA                     16640002
166500              SET DP013-DB2-ABEND                                 16650002
166600                               TO TRUE                            16660002
166700              PERFORM DP013-0000-PROCESS-ABEND                    16670002
166800     END-EVALUATE.                                                16680002
166900                                                                  16690002
167000     EXEC SQL                                                     16700002
167100         FETCH STATUS_CURSOR                                      16710002
167200         INTO :TRIPST-OPER-UNT-ID                                 16720002
167300             ,:TRIPST-STATUS-DTE                                  16730002
167400             ,:TRIPST-STATUS-TME                                  16740002
167500                                                                  16750002
167600     END-EXEC                                                     16760002
167700                                                                  16770002
167800     EVALUATE TRUE                                                16780002
167900         WHEN SQLCODE = ZERO                                      16790002
168000              CONTINUE                                            16800002
168100         WHEN SQLWARN0 NOT = SPACE                                16810002
168200         WHEN SQLCODE NOT = ZERO                                  16820002
168300              MOVE '4320-SELECT-OPER-UNT-ID'                      16830002
168400                               TO DP013-PARAGRAPH                 16840002
168500              MOVE 'FETCH STATUS_CURSOR'                          16850002
168600                               TO DP013-MESSAGE-TEXT (1)          16860002
168700              MOVE SQLCA       TO DP013-SQLCA                     16870002
168800              SET DP013-DB2-ABEND                                 16880002
168900                               TO TRUE                            16890002
169000              PERFORM DP013-0000-PROCESS-ABEND                    16900002
169100     END-EVALUATE.                                                16910002
169200                                                                  16920002
169300     EXEC SQL                                                     16930002
169400         CLOSE STATUS_CURSOR                                      16940002
169500     END-EXEC                                                     16950002
169600                                                                  16960002
169700     EVALUATE TRUE                                                16970002
169800         WHEN SQLCODE = ZERO                                      16980002
169900              CONTINUE                                            16990002
170000         WHEN SQLWARN0 NOT = SPACE                                17000002
170100         WHEN SQLCODE NOT = ZERO                                  17010002
170200              MOVE '4320-SELECT-OPER-UNT-ID'                      17020002
170300                               TO DP013-PARAGRAPH                 17030002
170400              MOVE 'CLOSE STATUS_CURSOR'                          17040002
170500                               TO DP013-MESSAGE-TEXT (1)          17050002
170600              MOVE SQLCA       TO DP013-SQLCA                     17060002
170700              SET DP013-DB2-ABEND                                 17070002
170800                               TO TRUE                            17080002
170900              PERFORM DP013-0000-PROCESS-ABEND                    17090002
171000     END-EVALUATE.                                                17100002
171100                                                                  17110002
171200 EJECT                                                            17120002
171300                                                                  17130002
171400*----------------------------------------------------------------*17140002
171500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17150002
171600*----------------------------------------------------------------*17160002
171700                                                                  17170002
171800 4400-MOVE-COMMAREA-TO-SCREEN.                                    17180002
171900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17190002
172000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17200002
172100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17210002
172200             MOVE +1    TO ASC-BLK-SUB                            17220002
172300             PERFORM 5100-WRITE-TEMP-STORAGE                      17230002
172400             ADD +1     TO ASC-BLK-SUB                            17240002
172500             PERFORM 5100-WRITE-TEMP-STORAGE                      17250002
172600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17260002
172700                 GIVING PV-BLOCK-NUMBER                           17270002
172800                 REMAINDER PV-REMAINDER                           17280002
172900             IF  PV-REMAINDER > ZERO                              17290002
173000                 ADD +1 TO PV-BLOCK-NUMBER                        17300002
173100             END-IF                                               17310002
173200             MOVE +1    TO ASC-BLK-SUB                            17320002
173300             PERFORM 4410-READ-TEMP-STORAGE                       17330002
173400             ADD +1     TO ASC-BLK-SUB                            17340002
173500                           PV-BLOCK-NUMBER                        17350002
173600             PERFORM 4410-READ-TEMP-STORAGE                       17360002
173700     END-IF.                                                      17370002
173800     MOVE +1            TO ASC-BLK-SUB.                           17380002
173900     COMPUTE ASC-ITEM-SUB =                                       17390002
174000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17400002
174100         + PC-ITEMS-PER-PANEL).                                   17410002
174200*                                                                 17420002
174300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17430002
174400         ADD +1         TO ASC-BLK-SUB                            17440002
174500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17450002
174600     END-IF.                                                      17460002
174700*                                                                 17470002
174800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17480002
174900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17490002
175000     PERFORM 4420-FORMAT-LIST-LINES                               17500002
175100         VARYING PV-SUB                                           17510002
175200         FROM PC-ITEMS-PER-PANEL BY -1                            17520002
175300         UNTIL PV-SUB < +1.                                       17530002
175400*                                                                 17540002
175500     COMPUTE ASC-ITEMS-DISPLAYED =                                17550002
175600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17560002
175700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17570002
175800                                      ASTRTITO.                   17580002
175900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17590002
176000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17600002
176100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17610002
176200                                   TO ASELPOO.                    17620002
176300*                                                                 17630002
176400     MOVE ASC-KEY-SCAC-ID          TO ADSCACO.                    17640002
176500*                                                                 17650002
176600     IF  DP020-MSG-NUMBER-X = SPACE                               17660002
176700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17670002
176800*            --- MORE ITEMS TO DISPLAY ----                       17680002
176900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17690002
177000             SET DP020-MSG-INFORMATIONAL TO TRUE                  17700002
177100         END-IF                                                   17710002
177200     END-IF.                                                      17720002
177300*----------------------------------------------------------------*17730002
177400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17740002
177500*----------------------------------------------------------------*17750002
177600                                                                  17760002
177700 4410-READ-TEMP-STORAGE.                                          17770002
177800                                                                  17780002
177900     EXEC CICS                                                    17790002
178000         READQ TS                                                 17800002
178100             QUEUE (ASC-LIST-QUEUE-NAME)                          17810002
178200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17820002
178300             ITEM  (PV-BLOCK-NUMBER)                              17830002
178400             RESP  (PV-CICS-RESP)                                 17840002
178500     END-EXEC.                                                    17850002
178600                                                                  17860002
178700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17870002
178800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17880002
178900         CONTINUE                                                 17890002
179000     ELSE                                                         17900002
179100         SET DP013-CICS-ABEND     TO TRUE                         17910002
179200         SET DP013-NO-ROLLBACK    TO TRUE                         17920002
179300         MOVE '4410-READ-TEMP-STORAGE'                            17930002
179400                                  TO DP013-PARAGRAPH              17940002
179500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17950002
179600                                  TO DP013-MESSAGE-TEXT(1)        17960002
179700         PERFORM DP013-0000-PROCESS-ABEND                         17970002
179800     END-IF.                                                      17980002
179900                                                                  17990002
180000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18000002
180100*                                                                 18010002
180200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18020002
180300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18030002
180400     END-IF.                                                      18040002
180500 EJECT                                                            18050002
180600*----------------------------------------------------------------*18060002
180700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18070002
180800*----------------------------------------------------------------*18080002
180900                                                                  18090002
181000 4420-FORMAT-LIST-LINES.                                          18100002
181100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18110002
181200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18120002
181300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           18130002
181400         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           18140002
181500         MOVE SPACE              TO MR-SELECTI (PV-SUB)           18150002
181600                                    MR-PO-NBR (PV-SUB)            18160002
181700                                    MR-REC-IND (PV-SUB)           18170002
181800                                    MR-VEND-NME (PV-SUB)          18180002
181900                                    MR-PRO-NBR (PV-SUB)           18190002
182000                                    MR-BOL-NBR (PV-SUB)           18200002
182100                                    MR-OPER-UNT-ID (PV-SUB)       18210002
182200                                    MR-CART-CNT (PV-SUB)          18220002
182300     ELSE                                                         18230002
182400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18240002
182500                                                   > SPACE        18250002
182600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18260002
182700                                 TO MR-SELECTI (PV-SUB)           18270002
182800         ELSE                                                     18280002
182900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18290002
183000                                 TO MR-SELECTI (PV-SUB)           18300002
183100         END-IF                                                   18310002
183200*                                                                 18320002
183300         IF  DP030-SET-CURSOR-TRAILER                             18330002
183400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)18340002
183500                 > SPACE)                                         18350002
183600               OR (PV-SUB = 1))                                   18360002
183700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               18370002
183800                MOVE -1          TO MR-SELECTL (PV-SUB)           18380002
183900             END-IF                                               18390002
184000         END-IF                                                   18400002
184100*                                                                 18410002
184200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18420002
184300             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           18430002
184400                                TO  MR-PO-NBR (PV-SUB)            18440002
184500             MOVE ASC-REC-IND (ASC-BLK-SUB ASC-ITEM-SUB)          18450002
184600                                TO  MR-REC-IND (PV-SUB)           18460002
184700             MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        18470002
184800                                TO  MR-VEND-NME (PV-SUB)          18480002
184900             MOVE ASC-COMPLETE-PRO-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 18490002
185000                                TO  MR-PRO-NBR (PV-SUB)           18500002
185100             MOVE ASC-COMPLETE-BOL-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 18510002
185200                                TO  MR-BOL-NBR (PV-SUB)           18520002
185300             MOVE ASC-OPER-UNT-ID (ASC-BLK-SUB ASC-ITEM-SUB)      18530002
185400                                TO  MR-OPER-UNT-ID (PV-SUB)       18540002
185500             MOVE ASC-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)         18550002
185600                                TO  MR-CART-CNT-N (PV-SUB)        18560002
185700         END-IF                                                   18570002
185800     END-IF.                                                      18580002
185900     SUBTRACT +1 FROM ASC-ITEM-SUB                                18590002
186000     IF  ASC-ITEM-SUB < + 1                                       18600002
186100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18610002
186200         MOVE +1                 TO ASC-BLK-SUB                   18620002
186300     END-IF.                                                      18630002
186400*----------------------------------------------------------------*18640002
186500* GET THE SELECTED ITEM AND RETURN IT TO THE CALLING PROGRAM     *18650002
186600*----------------------------------------------------------------*18660002
186700                                                                  18670002
186800 5000-GET-SEL-ITEM.                                               18680002
186900                                                                  18690002
187000     MOVE +1                   TO  ASC-BLK-SUB.                   18700002
187100     PERFORM 5100-WRITE-TEMP-STORAGE.                             18710002
187200     ADD +1                    TO  ASC-BLK-SUB.                   18720002
187300     PERFORM 5100-WRITE-TEMP-STORAGE.                             18730002
187400                                                                  18740002
187500     SET PV-SELECT-NOT-FOUND   TO  TRUE.                          18750002
187600                                                                  18760002
187700     PERFORM 5200-SEARCH-QUEUE                                    18770002
187800             VARYING PV-ITEM                                      18780002
187900             FROM 1 BY 1                                          18790002
188000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      18800002
188100                OR PV-SELECT-FOUND.                               18810002
188200 EJECT                                                            18820002
188300*----------------------------------------------------------------*18830002
188400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18840002
188500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18850002
188600*----------------------------------------------------------------*18860002
188700                                                                  18870002
188800 5100-WRITE-TEMP-STORAGE.                                         18880002
188900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18890002
189000                                   TO PV-LIST-ITEM-NUMBER.        18900002
189100     COMPUTE PV-BLOCK-NUMBER =                                    18910002
189200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18920002
189300                                                                  18930002
189400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18940002
189500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18950002
189600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18960002
189700             PERFORM 5105-REWRITE-ASC-LISTQ                       18970002
189800         END-IF                                                   18980002
189900     ELSE                                                         18990002
190000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19000002
190100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19010002
190200         PERFORM 5110-WRITE-ASC-LISTQ                             19020002
190300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19030002
190400     END-IF.                                                      19040002
190500                                                                  19050002
190600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19060002
190700******************************************************************19070002
190800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19080002
190900** SPECIFIC COMMAREA.                                           **19090002
191000******************************************************************19100002
191100 5105-REWRITE-ASC-LISTQ.                                          19110002
191200     EXEC CICS                                                    19120002
191300         WRITEQ TS                                                19130002
191400             QUEUE (ASC-LIST-QUEUE-NAME)                          19140002
191500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19150002
191600             ITEM  (PV-BLOCK-NUMBER)                              19160002
191700             REWRITE                                              19170002
191800             RESP  (PV-CICS-RESP)                                 19180002
191900     END-EXEC.                                                    19190002
192000                                                                  19200002
192100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19210002
192200         CONTINUE                                                 19220002
192300     ELSE                                                         19230002
192400         SET DP013-CICS-ABEND            TO TRUE                  19240002
192500         SET DP013-NO-ROLLBACK           TO TRUE                  19250002
192600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19260002
192700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19270002
192800                                         TO DP013-MESSAGE-TEXT(1) 19280002
192900         PERFORM DP013-0000-PROCESS-ABEND                         19290002
193000     END-IF.                                                      19300002
193100                                                                  19310002
193200******************************************************************19320002
193300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19330002
193400** SPECIFIC COMMAREA.                                           **19340002
193500******************************************************************19350002
193600 5110-WRITE-ASC-LISTQ.                                            19360002
193700     EXEC CICS                                                    19370002
193800         WRITEQ TS                                                19380002
193900             QUEUE (ASC-LIST-QUEUE-NAME)                          19390002
194000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19400002
194100             ITEM  (PV-BLOCK-NUMBER)                              19410002
194200             RESP  (PV-CICS-RESP)                                 19420002
194300     END-EXEC.                                                    19430002
194400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19440002
194500         SET DP013-CICS-ABEND      TO TRUE                        19450002
194600         SET DP013-NO-ROLLBACK     TO TRUE                        19460002
194700         MOVE '5110-WRITE-ASC-LISTQ'                              19470002
194800                                   TO DP013-PARAGRAPH             19480002
194900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19490002
195000                                   TO DP013-MESSAGE-TEXT(1)       19500002
195100         PERFORM DP013-0000-PROCESS-ABEND                         19510002
195200     END-IF.                                                      19520002
195300 EJECT                                                            19530002
195400*----------------------------------------------------------------*19540002
195500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19550002
195600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19560002
195700*----------------------------------------------------------------*19570002
195800                                                                  19580002
195900 5200-SEARCH-QUEUE.                                               19590002
196000                                                                  19600002
196100     PERFORM 6112-READ-LIST-QUEUE.                                19610002
196200                                                                  19620002
196300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19630002
196400         PERFORM                                                  19640002
196500         VARYING LQW-IDX                                          19650002
196600         FROM 1 BY 1                                              19660002
196700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19670002
196800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19680002
196900           OR  PV-SELECT-FOUND                                    19690002
197000                                                                  19700002
197100             IF  LQW-SELECT (LQW-IDX)                             19710002
197200                 SET PV-SELECT-FOUND         TO TRUE              19720002
197300                                                                  19730002
197400                 MOVE LQW-COMPLETE-PRO-NBR (LQW-IDX)              19740002
197500                                             TO TR001-PRO-NBR     19750002
197600                                                                  19760002
197700                 MOVE LQW-COMPLETE-BOL-NBR (LQW-IDX)              19770002
197800                                             TO TR001-BOL-NBR     19780002
197900                                                                  19790002
198000* IF THE USER SELECTS THE RECORD THAT WAS TRANSFERRED FROM THE ADD19800002
198100* SCREEN, THEY ARE ADDING A NEW SHIPMENT...OTHERWISE THEY ARE ADDI19810002
198200* A PO TO AN EXISTING SHIPMENT -- SET THE FLAG ACCORDINGLY.       19820002
198300                                                                  19830002
198400                 IF LQW-USER-RECORD (LQW-IDX)                     19840002
198500                    SET TR001-NEW-SHIP       TO TRUE              19850002
198600                 ELSE                                             19860002
198700                    SET TR001-SHIP-EXIST     TO TRUE              19870002
198800                    MOVE LQW-SHIPT-ID (LQW-IDX)                   19880002
198900                                             TO TR001-SHIPT-ID    19890002
199000                 END-IF                                           19900002
199100             END-IF                                               19910002
199200         END-PERFORM                                              19920002
199300     END-IF.                                                      19930002
199400                                                                  19940002
199500 EJECT                                                            19950002
199600*----------------------------------------------------------------*19960002
199700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*19970002
199800*----------------------------------------------------------------*19980002
199900                                                                  19990002
200000 6112-READ-LIST-QUEUE.                                            20000002
200100                                                                  20010002
200200     EXEC CICS                                                    20020002
200300         READQ TS                                                 20030002
200400             QUEUE (ASC-LIST-QUEUE-NAME)                          20040002
200500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     20050002
200600             ITEM  (PV-ITEM)                                      20060002
200700             RESP  (PV-CICS-RESP)                                 20070002
200800     END-EXEC.                                                    20080002
200900*                                                                 20090002
201000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20100002
201100         CONTINUE                                                 20110002
201200     ELSE                                                         20120002
201300         SET DP013-CICS-ABEND        TO TRUE                      20130002
201400         SET DP013-NO-ROLLBACK       TO TRUE                      20140002
201500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           20150002
201600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    20160002
201700                                     TO DP013-MESSAGE-TEXT(1)     20170002
201800         PERFORM DP013-0000-PROCESS-ABEND                         20180002
201900     END-IF.                                                      20190002
202000                                                                  20200002
202100 EJECT                                                            20210002
202200*----------------------------------------------------------------*20220002
202300*    ABEND PROCESSOR MODULE                                      *20230002
202400*----------------------------------------------------------------*20240002
202500                                                                  20250002
202600     COPY DPPD013.                                                20260002
