000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS163.                                         00040099
000500 AUTHOR.        NIRMAL KUMAR.                                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  04/98.                                            00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y163 - PO BOOKING LIST PROGRAM.                            * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ALL PO BOOKINGS BASED ON  * 00130099
001400*    THE DELIVERY DATE.                                         * 00140099
001500*                                                               * 00150099
001600*---------------------------------------------------------------* 00160099
001610*****************************************************************         
001620* DATE  05/16/2011                                                        
001630*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL          
001640*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR                 
001650*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC           
001660*  AND TSKXREF.                                                           
001670*  MADE BY: GERMAN BANDA                                                  
263697*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001700                                                                  00170099
001800 ENVIRONMENT DIVISION.                                            00180099
001900                                                                  00190099
002000 DATA DIVISION.                                                   00200099
002100                                                                  00210099
002200 WORKING-STORAGE SECTION.                                         00220099
002300                                                                  00230099
002400 01  DK-DB2-KEYS.                                                 00240099
002500     15  DK-PO-NBR                      PIC S9(09)  COMP.         00250099
002600                                                                  00260099
002700 01  PC-PROGRAM-CONSTANTS.                                        00270099
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280099
002900                                                    'TR163A  '.   00290099
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300099
003100                                                    'TRKM163 '.   00310099
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320099
003300                                                    'TRKCS163'.   00330099
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340099
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350099
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     00360099
003700                                                    COMP SYNC.    00370099
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00380099
003900                                                    COMP SYNC.    00390099
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00400099
004100                                                    +1000000      00410099
004200                                                    COMP-3.       00420099
004300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00430099
004400                                                    COMP SYNC.    00440099
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00450099
004600                                                    COMP-3.       00460099
004700     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00470099
004800                                                    '0001-01-01'. 00480099
004900     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
005000                                                                  00560099
005100     05  PC-TSYMSG-NUMBERS.                                               
005200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
005300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
005400         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.          
005500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
005600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
005700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
005800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
005900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
006000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
006100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
006200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
006300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
006400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
006500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
006600                                                                          
006700 01  PS-PROGRAM-SWITCHES.                                         00570099
006800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00580099
006900         88  PS-NO-ERROR                            VALUE 'Y'.    00590099
007000         88  PS-ERROR                               VALUE 'N'.    00600099
007100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00610099
007200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00620099
007300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00630099
007400     05  PS-HISTORY-SW                  PIC  X(01)  VALUE 'N'.            
007500         88  PS-HISTORY                             VALUE 'Y'.            
007600         88  PS-HISTORY-NO                          VALUE 'N'.            
007700                                                                          
007800 01  PV-PROGRAM-VARIABLES.                                        00650099
007900     05  PV-DEPT-NBR                    PIC  X(04).                       
008000     05  PV-DEPT-NBR-N REDEFINES                                          
008100         PV-DEPT-NBR                    PIC S9(04).                       
008200     05  PV-SUB                         PIC S9(04)  VALUE +0      00660099
008300                                                    COMP SYNC.    00670099
008400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00680099
008500                                                    COMP SYNC.    00690099
008600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00700099
008700                                                    COMP-3.       00710099
008800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
008900                                                    COMP-3.               
009000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00720099
009100                                                    COMP-3.       00730099
009200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00740099
009300                                                    COMP-3.       00750099
009400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00760099
009500                                                    COMP-3.       00770099
009600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00780099
009700                                                    COMP SYNC.    00790099
009800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00800099
009900                                                    COMP SYNC.    00810099
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00820099
010100                                                    COMP SYNC.    00830099
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00840099
010300                                                    COMP SYNC.    00850099
010400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
010500                                                    COMP-3.               
010600     05  PV-ITEM                        PIC S9(04)  VALUE +0              
010700                                                    COMP SYNC.            
010800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0              
010900                                                    COMP SYNC.            
011000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
011100                                                    COMP SYNC.            
011200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
011300                                                    COMP SYNC.            
011400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
011500                                                    COMP SYNC.            
011600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
011700                                                    COMP SYNC.            
011800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
011900                                                    COMP SYNC.            
012000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
012100                                                    COMP SYNC.            
012200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
012300                                                    COMP SYNC.            
012400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
012500                                                    COMP SYNC.            
012600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
012700                                                    COMP SYNC.            
012800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
012900                                                    COMP SYNC.            
013000     05  PV-TAUBKPO-CNT                 PIC S9(04)  VALUE +0      00880099
013100                                                    COMP SYNC.    00890099
013200     05  PV-TIMBKPO-CNT                 PIC S9(04)  VALUE +0      00900099
013300                                                    COMP SYNC.    00910099
013400     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      00920099
013500                                                    COMP.         00930099
013600     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      00940099
013700                                                    COMP.         00950099
013800     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      00960099
013900                                                    COMP.         00970099
014000     05  PV-DATE-BREAK.                                           00980099
014100         10 FILLER                      PIC  X(02).               00990099
014200         10 PV-DB-YY                    PIC  X(02).               01000099
014300         10 FILLER                      PIC  X(01).               01010099
014400         10 PV-DB-MM                    PIC  X(02).               01020099
014500         10 FILLER                      PIC  X(01).               01030099
014600         10 PV-DB-DD                    PIC  X(02).               01040099
014700     05  PV-DATE-DISPLAY.                                         01050099
014800         10 PV-DD-MM                    PIC  X(02).               01060099
014900         10 FILLER                      PIC  X(01)  VALUE '/'.    01070099
015000         10 PV-DD-DD                    PIC  X(02).               01080099
015100         10 FILLER                      PIC  X(01)  VALUE '/'.    01090099
015200         10 PV-DD-YY                    PIC  X(02).               01100099
015300                                                                  01110099
015400                                                                          
015500*----------------------------------------------------------------*        
015600*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *        
015700*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *        
015800*   APPLICATION-SPECIFIC COMMAREA.                               *        
015900*----------------------------------------------------------------*        
016000 01  LQW-LIST-QUEUE-WORK-AREA.                                            
016100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.          
016200     05  LQW-ITEM-ENTRIES               OCCURS 08   TIMES                 
016300                                        INDEXED BY  LQW-IDX.              
016400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.               
016500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).                       
016600         10  LQW-SELECTED-SW            PIC  X(01).                       
016700             88  LQW-SELECT                         VALUE 'S'.            
016800             88  LQW-DESELECT                       VALUE ' '.            
016900         10  LQW-ACTION                 PIC  X(03).                       
017000         10  LQW-DELY-DT                PIC  X(10).                       
017100         10  LQW-TYPE                   PIC  X(03).                       
017200         10  LQW-VSL-NAME               PIC  X(18).                       
017300         10  LQW-TRIP-CODE              PIC  X(01).                       
017400         10  LQW-ETD                    PIC  X(05).                       
017500         10  LQW-UNTS                   PIC S9(09)  COMP.                 
017600         10  LQW-CTN                    PIC S9(04)  COMP.                 
017700         10  LQW-CBM                    PIC S9(4)V9(2) COMP-3.            
017800         10  LQW-TRN-CNT                PIC  9(02).                       
017900         10  LQW-LAST-TRN               PIC  X(05).                       
018000         10  LQW-PO-BKG-SEQ-NBR         PIC S9(04)  COMP.                 
018100                                                                          
018200 EJECT                                                                    
018300*---------------------------------------------------------------*         
018400*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.                    
018500*---------------------------------------------------------------*         
018600                                                                          
018700     COPY TRWS118.                                                        
018800                                                                          
018900 EJECT                                                                    
019000*---------------------------------------------------------------* 01120099
019100*    MAP LAYOUT                                                 * 01130099
019200*---------------------------------------------------------------* 01140099
019300                                                                  01150099
019400     COPY TRKM163.                                                01160099
019500                                                                  01170099
019600 01  MR-OCCURS-LAYOUT                    REDEFINES  TR163AO.      01180099
019700     05  FILLER                          PIC X(260).              01190099
019800                                                                  01200099
019900     05  MR-SCROLL-AREA                  OCCURS 8 TIMES.          01210099
020000         10  MR-SELECTL                  PIC S9(04) COMP.         01220099
020100         10  MR-SELECTA                  PIC  X(01).              01230099
020200         10  MR-SELECTC                  PIC  X(01).              01240099
020300         10  MR-SELECTH                  PIC  X(01).              01250099
020400         10  MR-SELECTI                  PIC  X(01).              01260099
020500                                                                  01270099
020600         10  MR-ACTIONL                  PIC S9(04) COMP.         01280099
020700         10  MR-ACTIONA                  PIC  X(01).              01290099
020800         10  MR-ACTIONC                  PIC  X(01).              01300099
020900         10  MR-ACTIONH                  PIC  X(01).              01310099
021000         10  MR-ACTION                   PIC  X(03).              01320099
021100                                                                  01330099
021200         10  MR-DELY-DTL                 PIC S9(04) COMP.         01340099
021300         10  MR-DELY-DTA                 PIC  X(01).              01350099
021400         10  MR-DELY-DTC                 PIC  X(01).              01360099
021500         10  MR-DELY-DTH                 PIC  X(01).              01370099
021600         10  MR-DELY-DT                  PIC  X(05).              01380099
021700                                                                  01390099
021800         10  MR-TYPEL                    PIC S9(04) COMP.         01400099
021900         10  MR-TYPEA                    PIC  X(01).              01410099
022000         10  MR-TYPEC                    PIC  X(01).              01420099
022100         10  MR-TYPEH                    PIC  X(01).              01430099
022200         10  MR-TYPE                     PIC  X(03).              01440099
022300                                                                  01450099
022400         10  MR-VSL-NAMEL                PIC S9(04) COMP.         01460099
022500         10  MR-VSL-NAMEA                PIC  X(01).              01470099
022600         10  MR-VSL-NAMEC                PIC  X(01).              01480099
022700         10  MR-VSL-NAMEH                PIC  X(01).              01490099
022800         10  MR-VSL-NAME                 PIC  X(18).              01500099
022900                                                                  01510099
023000         10  MR-TRIP-CODEL               PIC S9(04) COMP.         01520099
023100         10  MR-TRIP-CODEA               PIC  X(01).              01530099
023200         10  MR-TRIP-CODEC               PIC  X(01).              01540099
023300         10  MR-TRIP-CODEH               PIC  X(01).              01550099
023400         10  MR-TRIP-CODE                PIC  X(01).              01560099
023500                                                                  01570099
023600         10  MR-ETDL                     PIC S9(04) COMP.         01580099
023700         10  MR-ETDA                     PIC  X(01).              01590099
023800         10  MR-ETDC                     PIC  X(01).              01600099
023900         10  MR-ETDH                     PIC  X(01).              01610099
024000         10  MR-ETD                      PIC  X(05).              01620099
024100                                                                  01630099
024200         10  MR-UNTSL                    PIC S9(04) COMP.         01640099
024300         10  MR-UNTSA                    PIC  X(01).              01650099
024400         10  MR-UNTSC                    PIC  X(01).              01660099
024500         10  MR-UNTSH                    PIC  X(01).              01670099
024600         10  MR-UNTS                     PIC  ZZZZZZZ9.           01680099
024700         10  MR-UNTS-X REDEFINES MR-UNTS PIC  X(08).              01690099
024800                                                                  01700099
024900         10  MR-CTNL                     PIC S9(04) COMP.         01710099
025000         10  MR-CTNA                     PIC  X(01).              01720099
025100         10  MR-CTNC                     PIC  X(01).              01730099
025200         10  MR-CTNH                     PIC  X(01).              01740099
025300         10  MR-CTN                      PIC  ZZZZ9.              01750099
025400         10  MR-CTN-X REDEFINES MR-CTN   PIC  X(05).              01760099
025500                                                                  01770099
025600         10  MR-CBML                     PIC S9(04) COMP.         01780099
025700         10  MR-CBMA                     PIC  X(01).              01790099
025800         10  MR-CBMC                     PIC  X(01).              01800099
025900         10  MR-CBMH                     PIC  X(01).              01810099
026000         10  MR-CBM                      PIC  ZZZ9.99.            01820099
026100         10  MR-CBM-X REDEFINES MR-CBM   PIC  X(07).              01830099
026200                                                                  01840099
026300         10  MR-TRN-CNTL                 PIC S9(04) COMP.         01850099
026400         10  MR-TRN-CNTA                 PIC  X(01).              01860099
026500         10  MR-TRN-CNTC                 PIC  X(01).              01870099
026600         10  MR-TRN-CNTH                 PIC  X(01).              01880099
026700         10  MR-TRN-CNT                  PIC  ZZ.                 01890099
026800                                                                  01900099
026900         10  MR-LAST-TRNL                PIC S9(04) COMP.         01910099
027000         10  MR-LAST-TRNA                PIC  X(01).              01920099
027100         10  MR-LAST-TRNC                PIC  X(01).              01930099
027200         10  MR-LAST-TRNH                PIC  X(01).              01940099
027300         10  MR-LAST-TRN                 PIC  X(05).              01950099
027400                                                                  01960099
027500     05  FILLER                          PIC  X(12).              01970099
027600                                                                  01980099
027700 EJECT                                                            01990099
027800*---------------------------------------------------------------* 02000099
027900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02010099
028000*---------------------------------------------------------------* 02020099
028100                                                                  02030099
028200     COPY DPWS015.                                                02040099
028300                                                                  02050099
028400 EJECT                                                            02060099
028500*---------------------------------------------------------------* 02070099
028600*    FUNCTION KEYS COPYBOOK.                                    * 02080099
028700*---------------------------------------------------------------* 02090099
028800                                                                  02100099
028900     COPY DPWS016.                                                02110099
029000                                                                  02120099
029100 EJECT                                                            02130099
029200*---------------------------------------------------------------* 02140099
029300*    NUMERIC EDIT LAYOUT.                                       * 02150099
029400*---------------------------------------------------------------* 02160099
029500                                                                  02170099
029600     COPY DPWS010I.                                               02180099
029700                                                                  02190099
029800 EJECT                                                            02200099
029900*---------------------------------------------------------------* 02210099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02220099
030100*---------------------------------------------------------------* 02230099
030200                                                                  02240099
030300     COPY DPWS030.                                                02250099
CICS       COPY DPWS930.                                                02260099
030500 EJECT                                                            02270099
030600*---------------------------------------------------------------* 02280099
030700*    STANDARD COMMAREA.                                         * 02290099
030800*---------------------------------------------------------------* 02300099
030900                                                                  02310099
031000     COPY DPWS020.                                                02320099
031100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02330099
031200                                                                  02340099
031300*---------------------------------------------------------------* 02350099
031400* INTER-APPLICATION COMMAREA.                                   * 02360099
031500*   TRWS105 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02370099
031600*             SPEC SCREEN OR SUMMARY.                           * 02380099
031700*   TRWS117 - IS THE OUTPUT LAYOUT WHEN GOING TO THE BOOKING PO *         
031800*             HISTORY SCREEN OR THE BOOKING REF NBR SCREEN.     *         
031900*---------------------------------------------------------------* 02390099
032000                                                                  02400099
032100         10  INTER-APPL-COMM-AREA       PIC X(200).               02410099
032200     COPY TRWS105.                                                02420099
032300     COPY TRWS117.                                                02420099
032400                                                                  02430099
032500*---------------------------------------------------------------* 02440099
032600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02450099
032700*---------------------------------------------------------------* 02460099
032800         10  ASC-SPECIFIC-COMMAREA.                               02470099
032900             15  ASC-LIST-KEYS.                                   02480099
033000                 20  ASC-KEY-PO-NBR                 PIC S9(09)    02490099
033100                                                    COMP.         02500099
033200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02510099
033300                 20  ASC-BLOCK-MODIFIED-SW          PIC  X(01).   02520099
033400                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    02530099
033500                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    02540099
033600                                                                  02550099
033700                 20  ASC-ITEM-ARRAY.                              02560099
033800                     25  ASC-ITEM-ENTRIES OCCURS 8 TIMES.         02570099
033900                         30  ASC-LIST-ITEM-NUMBER                 02580099
034000                                                    PIC S9(09)    02590099
034100                                                    COMP-3.       02600099
034200                         30  ASC-TEMP-SELECTED-SW   PIC  X(01).   02610099
034300                             88  ASC-VALID-SELECT   VALUE ' '     02620099
034400                                                          'S'     02630099
034500                                                          'B'     02640099
034600                                                          'E'.    02650099
034700                             88  ASC-TEMP-NO-SELECT VALUE ' '.    02660099
034800                             88  ASC-TEMP-SELECT    VALUE 'S'.    02670099
034900                             88  ASC-TEMP-BEGIN     VALUE 'B'.    02680099
035000                             88  ASC-TEMP-END       VALUE 'E'.    02690099
035100                         30  ASC-SELECTED-SW        PIC  X(01).   02700099
035200                             88  ASC-NO-SELECT      VALUE ' '.    02710099
035300                             88  ASC-SELECT         VALUE 'S'.    02720099
035400                             88  ASC-BEGIN          VALUE 'B'.    02730099
035500                             88  ASC-END            VALUE 'E'.    02740099
035600                         30  ASC-ACTION             PIC  X(03).   02750099
035700                         30  ASC-DELY-DT            PIC  X(10).   02760099
035800                         30  ASC-TYPE               PIC  X(03).   02770099
035900                         30  ASC-VSL-NAME           PIC  X(18).   02780099
036000                         30  ASC-TRIP-CODE          PIC  X(01).   02790099
036100                         30  ASC-ETD                PIC  X(05).   02800099
036200                         30  ASC-UNTS               PIC S9(09)    02810099
036300                                                    COMP.         02820099
036400                         30  ASC-CTN                PIC S9(04)    02830099
036500                                                    COMP.         02840099
036600                         30  ASC-CBM                PIC S9(4)V9(2)02850099
036700                                                    COMP-3.       02860099
036800                         30  ASC-TRN-CNT            PIC  9(02).   02870099
036900                         30  ASC-LAST-TRN           PIC  X(05).   02880099
037000                         30  ASC-PO-BKG-SEQ-NBR     PIC S9(04)            
037100                                                    COMP.                 
037200                                                                  02890099
037300             15  ASC-BLK-SUB                         PIC S9(04)   02900099
037400                                                          COMP    02910099
037500                                                          SYNC.   02920099
037600             15  ASC-ITEM-SUB                        PIC S9(04)   02930099
037700                                                          COMP    02940099
037800                                                          SYNC.   02950099
037900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02960099
038000                                                          COMP-3. 02970099
038100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02980099
038200                                                          COMP-3. 02990099
038300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03000099
038400                                                          COMP-3. 03010099
038500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03020099
038600                                                          COMP-3. 03030099
038700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03040099
038800                                                          COMP-3. 03050099
038900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03060099
039000                                                          COMP    03070099
039100                                                          SYNC.   03080099
039200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03090099
039300                                                          COMP-3. 03100099
039400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03110099
039500                                                          COMP-3. 03120099
039600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03130099
039700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03140099
039800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03150099
039900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03160099
040000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03170099
040100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03180099
040200             15  ASC-LIST-QUEUE-NAME.                             03190099
040300                 20  ASC-LIST-TERM-ID                PIC  X(04).  03200099
040400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03210099
040500                                                          COMP-3. 03220099
040600                 20  ASC-LIST-SEQ                    PIC  9(01).  03230099
040700             15  ASC-SEL-QUEUE-NAME.                              03240099
040800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03250099
040900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03260099
041000                                                          COMP-3. 03270099
041100                 20  ASC-SEL-SEQ                     PIC  9(01).  03280099
041200             15  ASC-START-ITEM-REQUEST.                          03290099
041300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03300099
041400             15  ASC-TOT-UNITS               PIC  S9(08).         03290099
041500             15  ASC-TOT-CARTONS             PIC  S9(05).         03290099
041600             15  ASC-TOT-CBM                 PIC  S9(04)V9(02).   03290099
041700                                                                  03310099
041800 EJECT                                                            03320099
041900*---------------------------------------------------------------* 03330099
042000*    ABEND PROCESSING COPYBOOK.                                 * 03340099
042100*---------------------------------------------------------------* 03350099
042200                                                                  03360099
042300     COPY DPWS013.                                                03370099
042400                                                                  03380099
042500 EJECT                                                            03390099
042600*---------------------------------------------------------------* 03400099
042700*    DB2 AREA FOR TPURCHS                                       * 03410099
042800*---------------------------------------------------------------* 03420099
042900     EXEC SQL                                                     03430099
043000          INCLUDE TPURCHS                                         03440099
043100     END-EXEC.                                                    03450099
043200*---------------------------------------------------------------* 03460099
043300*    DB2 AREA FOR TPLNSHP                                       * 03470099
043400*---------------------------------------------------------------* 03480099
043500     EXEC SQL                                                     03490099
043600          INCLUDE TPLNSHP                                         03500099
043700     END-EXEC.                                                    03510099
043800*---------------------------------------------------------------* 03520099
043900*    DB2 AREA FOR TENTNME                                       * 03530099
044000*---------------------------------------------------------------* 03540099
044100     EXEC SQL                                                     03550099
044200          INCLUDE TENTNME                                         03560099
044300     END-EXEC.                                                    03570099
044400*---------------------------------------------------------------* 03580099
044500*    DB2 AREA FOR TPURITM                                       * 03590099
044600*---------------------------------------------------------------* 03600099
044700     EXEC SQL                                                     03610099
044800          INCLUDE TPURITM                                         03620099
044900     END-EXEC.                                                    03630099
045000*---------------------------------------------------------------* 03640099
045100*    DB2 AREA FOR TIMBKPO                                       * 03650099
045200*---------------------------------------------------------------* 03660099
045300     EXEC SQL                                                     03670099
045400          INCLUDE TIMBKPO                                         03680099
045500     END-EXEC.                                                    03690099
045600*---------------------------------------------------------------* 03700099
045700*    DB2 AREA FOR TAUBKPO                                       * 03710099
045800*---------------------------------------------------------------* 03720099
045900     EXEC SQL                                                     03730099
046000          INCLUDE TAUBKPO                                         03740099
046100     END-EXEC.                                                    03750099
046200*---------------------------------------------------------------* 03760099
046300*    DB2 AREA FOR TSKXREF                                       * 03770099
046400*---------------------------------------------------------------* 03780099
046500     EXEC SQL                                                     03790099
046600          INCLUDE TSKXREF                                         03800099
046700     END-EXEC.                                                    03810099
046800*---------------------------------------------------------------* 03760099
046900*    DB2 AREA FOR TUPC                                          * 03770099
047000*---------------------------------------------------------------* 03780099
047100     EXEC SQL                                                     03790099
047200          INCLUDE TUPC                                            03800099
047300     END-EXEC.                                                    03810099
047400*---------------------------------------------------------------*         
047500*    DB2 AREA FOR XLT_SKU                                       *         
047600*---------------------------------------------------------------*         
047700     EXEC SQL                                                             
047800          INCLUDE XLT00003                                                
047900     END-EXEC.                                                            
048000*---------------------------------------------------------------*         
048100*    DB2 AREA FOR XLT_VND_STYL                                  *         
048200*---------------------------------------------------------------*         
048300     EXEC SQL                                                             
048400          INCLUDE XLT00004                                                
048500     END-EXEC.                                                            
048600*---------------------------------------------------------------* 03820099
048700*    DB2 AREA FOR COMMUNICATIONS                                * 03830099
048800*---------------------------------------------------------------* 03840099
048900     EXEC SQL                                                     03850099
049000          INCLUDE SQLCA                                           03860099
049100     END-EXEC.                                                    03870099
049200*---------------------------------------------------------------* 03880099
049300*    CURSOR FOR PO BOOKING LIST.                                * 03890099
049400*---------------------------------------------------------------* 03900099
049500                                                                  03910099
049600     EXEC SQL                                                     03920099
049700          DECLARE  BOOKING-CSR CURSOR                             03930099
049800              FOR  SELECT                                         03940099
049900                   PO_BKG_DELY_TMST                               03950099
050000                 , PO_BKG_SEQ_NBR                                 03960099
050100                 , PO_CART_CNT                                    03970099
050200                 , PO_CBMT_QTY                                    03980099
050300                 , PO_UNT_QTY                                     03990099
050400                 , ORGN_SHPD_FR_CDE                               04000099
050500                 , IMPRT_VEH_NM                                   04010099
050600                 , DPRTR_TMST                                     04020099
050700                 , POE_DELY_TMST                                  04030099
050800                 , TRIP_TYP_CDE                                   04040099
050900                 , LAST_UPD_TMST                                  04050099
051000            FROM   TIMBKPO                                        04060099
051100           WHERE   PO_NBR         = :DK-PO-NBR                    04070099
051200        ORDER BY   PO_BKG_DELY_TMST                               04080099
051300     END-EXEC.                                                    04090099
051400                                                                  04100099
051500 EJECT                                                            04110099
051600*----------------------------------------------------------------*04120099
051700*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *04130099
051800*----------------------------------------------------------------*04140099
051900                                                                  04150099
052000     EXEC SQL                                                     04160099
052100          DECLARE  OUTR-PCK-CSR CURSOR                            02970099
052200             FOR   SELECT                                         02980099
052300                   A.UNT_QTY                                      03000099
052400                ,  A.OUTR_PK_QTY                                  02990099
052500             FROM  TPURITM  A                                     03010099
052800             WHERE A.PO_NBR         = :DK-PO-NBR                          
053200             AND   A.VER_STATUS_CDE = 'A'                         03050099
053300             FOR   FETCH ONLY                                     03060099
053400     END-EXEC.                                                    04270099
053500                                                                  04280099
053600 EJECT                                                            04290099
053700*----------------------------------------------------------------*04300099
053800 LINKAGE SECTION.                                                 04310099
053900                                                                  04320099
054000 01  DFHCOMMAREA.                                                 04330099
054100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04340099
054200                                        DEPENDING ON EIBCALEN.    04350099
054300         10  FILLER                     PIC X.                    04360099
054400                                                                  04370099
054500 EJECT                                                            04380099
054600*----------------------------------------------------------------*04390099
054700 PROCEDURE DIVISION.                                              04400099
054800*----------------------------------------------------------------*04410099
054900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *04420099
055000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *04430099
055100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *04440099
055200*----------------------------------------------------------------*04450099
055300 0000-MAIN-MODULE.                                                04460099
055400                                                                  04470099
055500     INITIALIZE DP030-CICS-API-FIELDS.                            04480099
055600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04490099
055700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04500099
055800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04510099
055900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04520099
056000     MOVE LENGTH OF TR163AI        TO DP030-MAP-LENGTH (1).       04530099
056100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04540099
056200     PERFORM 0001-CALL-CICS-ARCH-API.                             04550099
056300*                                                                 04560099
056400     PERFORM 1000-CONTROL-PROCESSING                              04570099
056500*                                                                 04580099
056600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04590099
056700     PERFORM 0001-CALL-CICS-ARCH-API.                             04600099
056800                                                                  04610099
056900*----------------------------------------------------------------*04620099
057000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *04630099
057100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *04640099
057200*----------------------------------------------------------------*04650099
057300 0001-CALL-CICS-ARCH-API.                                         04660099
057400                                                                  04670099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04680099
057600                                    DFHCOMMAREA                           
057700                                    DP030-CICS-API-FIELDS                 
057800                                    DP020-STANDARD-COMMAREA               
057900                                    TR163AI.                              
058000*                                                                 04730099
058100     IF  DP030-RC-CALL-SUCCESSFUL                                 04740099
058200         CONTINUE                                                 04750099
058300     ELSE                                                         04760099
058400         SET DP013-NO-ROLLBACK                                    04770099
058500             DP013-XCTL-DISPLAY-RESTART                           04780099
058600             DP013-CICS-ABEND      TO TRUE                        04790099
058700         MOVE '0001-CALL-CICS-ARCH-API'                           04800099
058800                                   TO DP013-PARAGRAPH             04810099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
059100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04840099
059200         PERFORM DP013-0000-PROCESS-ABEND                         04850099
059300     END-IF.                                                      04860099
059400                                                                  04870099
059500 EJECT                                                            04880099
059600*----------------------------------------------------------------*04890099
059700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04900099
059800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04910099
059900*                                                                *04920099
060000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04930099
060100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04940099
060200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04950099
060300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04960099
060400*----------------------------------------------------------------*04970099
060500 1000-CONTROL-PROCESSING.                                         04980099
060600                                                                  04990099
060700     EVALUATE TRUE                                                05000099
060800         WHEN DP020-NEXT-ACT-INITIAL                              05010099
060900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05020099
061000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05030099
061100                                      ASC-SEL-TERM-ID             05040099
061200             MOVE DP020-SRC-TASK-NUMBER                           05050099
061300                                   TO ASC-LIST-TASK-NUMBER        05060099
061400                                      ASC-SEL-TASK-NUMBER         05070099
061500             MOVE PC-LIST-QUEUE-SEQ                               05080099
061600                                   TO ASC-LIST-SEQ                05090099
061700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05100099
061800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05110099
061900*-------$TEMPLATE NOTE$------------------------------------------*05120099
062000* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,* 05130099
062100* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO *  05140099
062200* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.* 05150099
062300*----------------------------------------------------------------*05160099
062400             IF  PS-COMMAREA-NOT-VALID                            05170099
062500                 SET DP020-NEXT-ACT-APPL-ERROR                    05180099
062600                                   TO TRUE                        05190099
062700             ELSE                                                 05200099
062800                 PERFORM 4000-BUILD-INITIAL-PANEL                 05210099
062900             END-IF                                               05220099
063000                                                                  05230099
063100         WHEN DP020-NEXT-ACT-READ-MAP                             05240099
063200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05250099
063300                                   TO PV-TOP-ITEM                 05260099
063400             PERFORM 2000-PROCESS-PANEL                           05270099
063500                                                                  05280099
063600         WHEN DP020-NEXT-ACT-RETURN                               05290099
063700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05300099
063800                                   TO PV-TOP-ITEM                 05310099
063900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05320099
064000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                         
064100             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05330099
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05340099
064300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05350099
064400                                                                  05360099
064500         WHEN OTHER                                               05370099
064600             SET DP013-LOGIC-ABEND TO TRUE                        05380099
064700             SET DP013-NO-ROLLBACK TO TRUE                        05390099
064800             MOVE '1000-CONTROL-PROCESSING'                       05400099
064900                                   TO DP013-PARAGRAPH             05410099
065000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05420099
065100                                   TO DP013-MESSAGE-TEXT(1)       05430099
065200             PERFORM DP013-0000-PROCESS-ABEND                     05440099
065300     END-EVALUATE.                                                05450099
065400                                                                  05460099
065500 EJECT                                                            05470099
065600*----------------------------------------------------------------*05480099
065700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05490099
065800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05500099
065900*----------------------------------------------------------------*05510099
066000 1100-PROCESS-INTER-APPL-COMM.                                    05520099
066100                                                                  05530099
066200     SET PS-COMMAREA-VALID         TO TRUE.                       05540099
066300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05550099
066400                                                                  05560099
066500     IF  DP020-NAV-KEY-DATA > SPACE                               05570099
066600         MOVE DP020-NAV-KEY-DATA   TO ASC-KEY-PO-NBR              05580099
066700                                      DK-PO-NBR                   05590099
066800     ELSE                                                         05600099
066900         MOVE TR105-PO-NBR         TO ASC-KEY-PO-NBR              05610099
067000                                      DK-PO-NBR                   05620099
067100     END-IF.                                                      05630099
067200                                                                  05640099
067300 EJECT                                                            05650099
067400*----------------------------------------------------------------*05660099
067500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05670099
067600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05680099
067700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05690099
067800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05700099
067900* FUNCTION KEYS CAN GET THIS FAR.                                *05710099
068000*----------------------------------------------------------------*05720099
068100 2000-PROCESS-PANEL.                                              05730099
068200                                                                  05740099
068300     EVALUATE TRUE                                                05750099
068400         WHEN DP020-SRC-AID = DP016-CLEAR                         05760099
068500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05770099
068600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05780099
068700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05790099
068800                                                                  05800099
068900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05810099
069000             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05820099
069100             PERFORM 2050-DELETE-LIST-QUEUE                       05830099
069200             PERFORM 4000-BUILD-INITIAL-PANEL                     05840099
069300                                                                  05850099
069400         WHEN OTHER                                               05860099
069500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05870099
069600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05880099
069700             IF  PS-NO-ERROR                                      05890099
069800                 SET DP030-CONTINUE-GO                            05900099
069900                                 TO TRUE                          05910099
070000                 PERFORM 2100-CHECK-FUNCTION-KEY                  05920099
070100             ELSE                                                 05930099
070200                 SET DP030-OVERRIDE-GO                            05940099
070300                                 TO TRUE                          05950099
070400             END-IF                                               05960099
070500     END-EVALUATE.                                                05970099
070600                                                                  05980099
070700 EJECT                                                            05990099
070800*----------------------------------------------------------------*06000099
070900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06010099
071000*----------------------------------------------------------------*06020099
071100 2050-DELETE-LIST-QUEUE.                                          06030099
071200                                                                  06040099
071300     EXEC CICS                                                    06050099
071400         DELETEQ TS                                               06060099
071500             QUEUE (ASC-LIST-QUEUE-NAME)                          06070099
071600             RESP  (PV-CICS-RESP)                                 06080099
071700     END-EXEC.                                                    06090099
071800                                                                  06100099
071900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06110099
072000        (PV-CICS-RESP = DFHRESP(QIDERR))                          06120099
072100         CONTINUE                                                 06130099
072200     ELSE                                                         06140099
072300         SET DP013-CICS-ABEND      TO TRUE                        06150099
072400         SET DP013-NO-ROLLBACK     TO TRUE                        06160099
072500                                                                  06170099
072600         MOVE '2050-DELETE-LIST-QUEUE'                            06180099
072700                                   TO DP013-PARAGRAPH             06190099
072800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06200099
072900                                   TO DP013-MESSAGE-TEXT (1)      06210099
073000         PERFORM DP013-0000-PROCESS-ABEND                         06220099
073100     END-IF.                                                      06230099
073200                                                                  06240099
073300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06250099
073400                                                                  06260099
073500 EJECT                                                            06270099
073600*----------------------------------------------------------------*06280099
073700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06290099
073800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06300099
073900* CICS ARCHITECTURE API.                                         *06310099
074000*----------------------------------------------------------------*06320099
074100 2100-CHECK-FUNCTION-KEY.                                         06330099
074200                                                                  06340099
074300     EVALUATE TRUE                                                06350099
074400                                                                  06360099
074500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
074600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
074700            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                           
074800              INITIALIZE         TR117-INTER-APPL-COMMAREA                
074900              MOVE ASC-KEY-PO-NBR        TO TR117-PO-NBR                  
075000              MOVE IMBKPO-PO-BKG-SEQ-NBR TO TR117-PO-SEQ-NBR              
075100              PERFORM 5000-PREPARE-SEL-QUEUE                              
075200            ELSE                                                          
075300              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                         
075400                SET DP030-OVERRIDE-GO TO TRUE                             
075500                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER                 
075600                SET DP020-MSG-WARNING TO TRUE                             
075700              ELSE                                                        
075800                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                       
075900                  SET DP030-OVERRIDE-GO TO TRUE                           
076000                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER               
076100                  SET DP020-MSG-WARNING TO TRUE                           
076200                END-IF                                                    
076300              END-IF                                                      
076400            END-IF                                                        
076500                                                                          
076600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06370099
076700             MOVE +1               TO PV-TOP-ITEM                 06380099
076800             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06390099
076900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06400099
077000             PERFORM 3200-RESET-ATTRIBUTES                        06410099
077100                                                                  06420099
077200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06430099
077300             PERFORM 2110-BROWSE-BACKWARD                         06440099
077400             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06450099
077500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06460099
077600             PERFORM 3200-RESET-ATTRIBUTES                        06470099
077700                                                                  06480099
077800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06490099
077900             PERFORM 2120-BROWSE-FORWARD                          06500099
078000             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06510099
078100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06520099
078200                                                                  06530099
078300         WHEN DP020-SRC-AID = DP016-ENTER                         06540099
078400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06550099
078500             IF  PS-ERROR                                         06560099
078600                 CONTINUE                                         06570099
078700             ELSE                                                 06580099
078800                 MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR               06590099
078900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06600099
079000                 PERFORM 3200-RESET-ATTRIBUTES                    06610099
079100             END-IF                                               06620099
079200                                                                  06630099
079300         WHEN OTHER                                               06640099
079400             SET DP013-NO-ROLLBACK                                06650099
079500                 DP013-XCTL-DISPLAY-RESTART                       06660099
079600                 DP013-CICS-ABEND  TO TRUE                        06670099
079700             MOVE '2100-CHECK-FUNCTION-KEY'                       06680099
079800                                   TO DP013-PARAGRAPH             06690099
079900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06700099
080000                                   TO DP013-MESSAGE-TEXT (1)      06710099
080100             PERFORM DP013-0000-PROCESS-ABEND                     06720099
080200     END-EVALUATE.                                                06730099
080300                                                                  06740099
080400 EJECT                                                            06750099
080500*----------------------------------------------------------------*06760099
080600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06770099
080700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06780099
080800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06790099
080900*    MESSAGE.                                                    *06800099
081000*----------------------------------------------------------------*06810099
081100 2110-BROWSE-BACKWARD.                                            06820099
081200                                                                  06830099
081300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06840099
081400         GIVING PV-TOP-ITEM.                                      06850099
081500*                                                                 06860099
081600     IF  ((PV-TOP-ITEM < +1)                                      06870099
081700       OR (PV-TOP-ITEM = +1))                                     06880099
081800         MOVE +1                   TO PV-TOP-ITEM                 06890099
081900*------- TOP OF LIST --------                                     06900099
082000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06910099
082100         SET DP020-MSG-INFORMATIONAL TO TRUE                      06920099
082200     END-IF.                                                      06930099
082300                                                                  06940099
082400 EJECT                                                            06950099
082500*----------------------------------------------------------------*06960099
082600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06970099
082700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06980099
082800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06990099
082900*----------------------------------------------------------------*07000099
083000 2120-BROWSE-FORWARD.                                             07010099
083100                                                                  07020099
083200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07030099
083300         GIVING PV-TOP-ITEM.                                      07040099
083400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07050099
083500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07060099
083600                                   TO PV-TOP-ITEM                 07070099
083700*------- BOTTOM OF LIST -----------                               07080099
083800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07090099
083900         SET DP020-MSG-INFORMATIONAL                              07100099
084000                                   TO TRUE                        07110099
084100     ELSE                                                         07120099
084200         COMPUTE PV-BOTTOM-ITEM =                                 07130099
084300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07140099
084400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07150099
084500*------------BOTTOM OF LIST ---------                             07160099
084600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07170099
084700             SET DP020-MSG-INFORMATIONAL                          07180099
084800                                   TO TRUE                        07190099
084900         END-IF                                                   07200099
085000     END-IF.                                                      07210099
085100                                                                  07220099
085200 EJECT                                                            07230099
085300*----------------------------------------------------------------*07240099
085400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07250099
085500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07260099
085600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07270099
085700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07280099
085800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07290099
085900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07300099
086000*----------------------------------------------------------------*07310099
086100 2130-CHECK-FOR-JUMP-BROWSE.                                      07320099
086200                                                                  07330099
086300     SET PS-NO-ERROR               TO TRUE.                       07340099
086400     IF (ASC-START-ITEM-REQUEST = SPACE)                          07350099
086500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07360099
086600                                   TO PV-TOP-ITEM                 07370099
086700     ELSE                                                         07380099
086800         MOVE ASC-START-ITEM-REQUEST                              07390099
086900                                   TO DP010I-UNEDITED-FIELD       07400099
087000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07410099
087100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07420099
087200         SET DP010I-NEGATIVE-NOT-ALLOWED                          07430099
087300                                   TO TRUE                        07440099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
087500                                                                  07460099
087600         IF  NOT DP010I-ERROR-DETECTED                            07470099
087700             MOVE DP010I-NUMERIC-FIELD                            07480099
087800                                   TO  ASC-START-ITEM-REQUEST-N   07490099
087900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07500099
088000                 IF  ASC-START-ITEM-REQUEST-N >                   07510099
088100                                          ASC-NUMBER-OF-ITEMS-READ07520099
088200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07530099
088300                     COMPUTE PV-TOP-ITEM =                        07540099
088400                             ASC-NUMBER-OF-ITEMS-READ             07550099
088500                             - PC-ITEMS-PER-PANEL + 1             07560099
088600                     IF  PV-TOP-ITEM < +1                         07570099
088700                         MOVE +1   TO PV-TOP-ITEM                 07580099
088800                         MOVE PC-TSYMSG-00070                     07590099
088900                                   TO DP020-MSG-NUMBER            07600099
089000                         SET DP020-MSG-INFORMATIONAL              07610099
089100                                   TO TRUE                        07620099
089200                     END-IF                                       07630099
089300                 ELSE                                             07640099
089400                     MOVE ASC-START-ITEM-REQUEST-N                07650099
089500                                   TO PV-TOP-ITEM                 07660099
089600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07670099
089700                     COMPUTE PV-BOTTOM-ITEM =                     07680099
089800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07690099
089900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07700099
090000*----------------------- BOTTOM OF LIST --------------            07710099
090100                         MOVE PC-TSYMSG-00070                     07720099
090200                                   TO DP020-MSG-NUMBER            07730099
090300                         SET DP020-MSG-INFORMATIONAL              07740099
090400                                   TO TRUE                        07750099
090500                     END-IF                                       07760099
090600                 END-IF                                           07770099
090700             ELSE                                                 07780099
090800*--------------- VALUE OUT OF RANGE ------------------            07790099
090900                 MOVE PC-TSYMSG-00101                             07800099
091000                                   TO DP020-MSG-NUMBER            07810099
091100                 MOVE -1           TO ASTRTITL                    07820099
091200                 SET DP030-SET-CURSOR-APPL-1                      07830099
091300                                   TO TRUE                        07840099
091400                 MOVE DP015-REVERSE                               07850099
091500                                   TO ASTRTITH                    07860099
091600                 MOVE DP015-RED    TO ASTRTITC                    07870099
091700                 MOVE DP015-UNP-NUM-BRT-MDT                       07880099
091800                                   TO ASTRTITA                    07890099
091900                 SET DP020-MSG-FATAL                              07900099
092000                                   TO TRUE                        07910099
092100                 SET PS-ERROR      TO TRUE                        07920099
092200             END-IF                                               07930099
092300                                                                  07940099
092400         ELSE                                                     07950099
092500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07960099
092600             MOVE -1               TO ASTRTITL                    07970099
092700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07980099
092800             MOVE DP015-REVERSE    TO ASTRTITH                    07990099
092900             MOVE DP015-RED        TO ASTRTITC                    08000099
093000             MOVE DP015-UNP-NUM-BRT-MDT                           08010099
093100                                   TO ASTRTITA                    08020099
093200             SET DP020-MSG-FATAL   TO TRUE                        08030099
093300             SET PS-ERROR          TO TRUE                        08040099
093400         END-IF                                                   08050099
093500     END-IF.                                                      08060099
093600                                                                  08070099
093700 EJECT                                                            08080099
093800*----------------------------------------------------------------*        
093900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *        
094000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *        
094100*----------------------------------------------------------------*        
094200 2140-DESELECT-ALL-ITEMS.                                                 
094300                                                                          
094400     MOVE +1                       TO ASC-BLK-SUB.                        
094500                                                                          
094600     PERFORM 2141-CLEAR-SELECTED-INDS                                     
094700         VARYING ASC-ITEM-SUB                                             
094800         FROM 1 BY 1                                                      
094900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
095000                                                                          
095100     ADD +1                        TO ASC-BLK-SUB.                        
095200                                                                          
095300     PERFORM 2141-CLEAR-SELECTED-INDS                                     
095400         VARYING ASC-ITEM-SUB                                             
095500         FROM 1 BY 1                                                      
095600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
095700                                                                          
095800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
095900                                   TO PV-LIST-ITEM-NUMBER.                
096000                                                                          
096100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
096200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
096300                                                                          
096400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
096500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)              
096600         MOVE +1                   TO ASC-BLK-SUB                         
096700                                                                          
096800         PERFORM 5100-WRITE-TEMP-STORAGE                                  
096900                                                                          
097000         MOVE +1                   TO PV-BLOCK-NUMBER                     
097100                                                                          
097200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
097300             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
097400                                                                          
097500         PERFORM                                                          
097600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
097700                                                                          
097800             PERFORM 4410-READ-TEMP-STORAGE                               
097900                                                                          
098000             PERFORM 2141-CLEAR-SELECTED-INDS                             
098100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                         
098200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
098300                                                                          
098400             PERFORM 5100-WRITE-TEMP-STORAGE                              
098500                                                                          
098600             ADD +1                TO PV-BLOCK-NUMBER                     
098700                                                                          
098800         END-PERFORM                                                      
098900                                                                          
099000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
099100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
099200                                                                          
099300         PERFORM                                                          
099400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
099500                   ASC-HIGHEST-BLOCK-WRITTEN                              
099600                                                                          
099700             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
099800                                   TO PV-BLOCK-NUMBER                     
099900                                                                          
100000             PERFORM 4410-READ-TEMP-STORAGE                               
100100                                                                          
100200             PERFORM 2141-CLEAR-SELECTED-INDS                             
100300                 VARYING ASC-ITEM-SUB                                     
100400                 FROM 1 BY 1                                              
100500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
100600                                                                          
100700             PERFORM 5100-WRITE-TEMP-STORAGE                              
100800                                                                          
100900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
101000                                                                          
101100         END-PERFORM                                                      
101200                                                                          
101300         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
101400                                   TO PV-BLOCK-NUMBER                     
101500                                                                          
101600         PERFORM 4410-READ-TEMP-STORAGE                                   
101700     END-IF.                                                              
101800                                                                          
101900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS        
102000                                      ASC-START-OF-SELECTED-RANGE         
102100                                      ASC-END-OF-SELECTED-RANGE.          
102200                                                                          
102300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
102400                                                                          
102500 EJECT                                                                    
102600*----------------------------------------------------------------*        
102700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *        
102800*----------------------------------------------------------------*        
102900 2141-CLEAR-SELECTED-INDS.                                                
103000                                                                          
103100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
103200             NOT EQUAL ZERO                                               
103300         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
103400             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
103500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            
103600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
103700                                   TO TRUE                                
103800         END-IF                                                           
103900     END-IF.                                                              
104000                                                                          
104100 EJECT                                                                    
104200*----------------------------------------------------------------*        
104300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *        
104400*  FOR ALL ITEMS.                                                *        
104500*----------------------------------------------------------------*        
104600 2150-SELECT-ALL-ITEMS.                                                   
104700                                                                          
104800     MOVE +1                       TO ASC-BLK-SUB.                        
104900                                                                          
105000     PERFORM 2151-SET-SELECTED-INDS                                       
105100         VARYING ASC-ITEM-SUB                                             
105200         FROM 1 BY 1                                                      
105300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
105400                                                                          
105500     ADD +1                        TO ASC-BLK-SUB.                        
105600                                                                          
105700     PERFORM 2151-SET-SELECTED-INDS                                       
105800         VARYING ASC-ITEM-SUB                                             
105900         FROM 1 BY 1                                                      
106000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
106100                                                                          
106200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
106300                                   TO PV-LIST-ITEM-NUMBER.                
106400                                                                          
106500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
106600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
106700                                                                          
106800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
106900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)            
107000         MOVE +1                   TO ASC-BLK-SUB                         
107100                                                                          
107200         PERFORM 5100-WRITE-TEMP-STORAGE                                  
107300                                                                          
107400         MOVE +1                   TO PV-BLOCK-NUMBER                     
107500                                                                          
107600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
107700             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
107800                                                                          
107900         PERFORM                                                          
108000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
108100                                                                          
108200             PERFORM 4410-READ-TEMP-STORAGE                               
108300                                                                          
108400             PERFORM 2151-SET-SELECTED-INDS                               
108500                 VARYING ASC-ITEM-SUB                                     
108600                 FROM 1 BY 1                                              
108700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
108800                                                                          
108900             PERFORM 5100-WRITE-TEMP-STORAGE                              
109000                                                                          
109100             ADD +1                TO PV-BLOCK-NUMBER                     
109200                                                                          
109300         END-PERFORM                                                      
109400                                                                          
109500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
109600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
109700                                                                          
109800         PERFORM                                                          
109900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
110000                   ASC-HIGHEST-BLOCK-WRITTEN                              
110100                                                                          
110200             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
110300                                   TO PV-BLOCK-NUMBER                     
110400                                                                          
110500             PERFORM 4410-READ-TEMP-STORAGE                               
110600                                                                          
110700             PERFORM 2151-SET-SELECTED-INDS                               
110800                 VARYING ASC-ITEM-SUB                                     
110900                 FROM 1 BY 1                                              
111000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
111100                                                                          
111200             PERFORM 5100-WRITE-TEMP-STORAGE                              
111300                                                                          
111400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
111500                                                                          
111600         END-PERFORM                                                      
111700                                                                          
111800         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
111900                                   TO PV-BLOCK-NUMBER                     
112000                                                                          
112100         PERFORM 4410-READ-TEMP-STORAGE                                   
112200     END-IF.                                                              
112300                                                                          
112400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                                     
112500                       ASC-NUMBER-OF-SELECTED-ITEMS.                      
112600                                                                          
112700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
112800                                                                          
112900 EJECT                                                                    
113000*----------------------------------------------------------------*        
113100*    MARK EACH ITEM AS BEING SELECTED.                           *        
113200*----------------------------------------------------------------*        
113300 2151-SET-SELECTED-INDS.                                                  
113400                                                                          
113500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
113600             NOT EQUAL ZERO                                               
113700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
113800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
113900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                
114000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
114100                               TO  TRUE                                   
114200         END-IF                                                           
114300     END-IF.                                                              
114400                                                                          
114500 EJECT                                                                    
114600                                                                          
114700*----------------------------------------------------------------*08090099
114800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *08100099
114900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *08110099
115000*----------------------------------------------------------------*08120099
115100 2200-MOVE-SCREEN-TO-COMMAREA.                                    08130099
115200                                                                  08140099
115300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08150099
115400     MOVE +1                       TO PV-SUB.                     08160099
115500*                                                                 08170099
115600     PERFORM 3100-SET-SUBSCRIPTS.                                 08180099
115700     IF  ASTRTITL > ZERO                                          08190099
115800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08200099
115900     ELSE                                                         08210099
116000         IF  ASTRTITF = DP015-ERASE-EOF                           08220099
116100             INITIALIZE ASC-START-ITEM-REQUEST                    08230099
116200         END-IF                                                   08240099
116300     END-IF.                                                      08250099
116400                                                                  08260099
116500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                                  
116600         VARYING PV-SUB                                                   
116700         FROM 1 BY 1                                                      
116800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                              
116900                                                                          
117000 EJECT                                                            08270099
117100*----------------------------------------------------------------*        
117200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *        
117300*----------------------------------------------------------------*        
117400 2210-MOVE-LINES-TO-COMMAREA.                                             
117500                                                                          
117600     IF  MR-SELECTL (PV-SUB) > ZERO                                       
117700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                     
117800         MOVE MR-SELECTI (PV-SUB)                                         
117900                                   TO ASC-TEMP-SELECTED-SW                
118000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
118100     ELSE                                                                 
118200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                        
118300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             
118400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW                
118500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
118600         END-IF                                                           
118700     END-IF.                                                              
118800     ADD +1                        TO ASC-ITEM-SUB.                       
118900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
119000         ADD  +1                   TO ASC-BLK-SUB                         
119100         MOVE +1                   TO ASC-ITEM-SUB                        
119200     END-IF.                                                              
119300                                                                          
119400 EJECT                                                                    
119500*----------------------------------------------------------------*08280099
119600*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *08290099
119700*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *08300099
119800*----------------------------------------------------------------*08310099
119900 3000-EDIT-DATA-IN-COMMAREA.                                      08320099
120000                                                                  08330099
120100     SET PS-NO-ERROR               TO TRUE.                       08340099
120200     PERFORM 3200-RESET-ATTRIBUTES.                               08350099
120300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08360099
120400*----------------------------------------------------------------*08370099
120500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED. *            08380099
120600* EDITTING IS DONE FROM THE BOTTOM UP. *                          08390099
120700*----------------------------------------------------------------*08400099
120800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08410099
120900         ASC-ITEMS-DISPLAYED - 1.                                 08420099
121000     PERFORM 3100-SET-SUBSCRIPTS.                                 08430099
121100     PERFORM 3300-EDIT-SELECTIONS                                         
121200         VARYING PV-SUB                                                   
121300         FROM PV-SUB BY -1                                                
121400         UNTIL PV-SUB < +1.                                               
121500*                                                                         
121600     IF  PS-NO-ERROR                                                      
121700         PERFORM 3400-CHECK-RANGE-SEQUENCE                                
121800     END-IF.                                                              
121900*                                                                         
122000     IF  ((PS-NO-ERROR)                                                   
122100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                           
122200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                            
122300             PERFORM 3500-MARK-RANGE-AS-SELECTED                          
122400     END-IF.                                                              
122500                                                                          
122600 EJECT                                                            08450099
122700*----------------------------------------------------------------*08460099
122800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *08470099
122900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*08480099
123000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *08490099
123100*                                                                *08500099
123200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *08510099
123300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *08520099
123400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *08530099
123500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *08540099
123600*----------------------------------------------------------------*08550099
123700 3100-SET-SUBSCRIPTS.                                             08560099
123800                                                                  08570099
123900     COMPUTE ASC-ITEM-SUB =                                       08580099
124000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        08590099
124100                                                                  08600099
124200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08610099
124300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08620099
124400                                                                  08630099
124500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               08640099
124600     ELSE                                                         08650099
124700         MOVE +1                     TO ASC-BLK-SUB               08660099
124800     END-IF.                                                      08670099
124900                                                                  08680099
125000 EJECT                                                            08690099
125100*----------------------------------------------------------------*08700099
125200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *08710099
125300*----------------------------------------------------------------*08720099
125400 3200-RESET-ATTRIBUTES.                                           08730099
125500                                                                  08740099
125600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08750099
125700     MOVE DP015-GREEN              TO ASTRTITC.                   08760099
125800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08770099
125900*                                                                 08780099
126000     PERFORM                                                      08790099
126100         VARYING PV-SUB                                           08800099
126200         FROM 1 BY 1                                              08810099
126300         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   08820099
126400                         ASC-ITEMS-DISPLAYED)                     08830099
126500         MOVE DP015-UNP-ALP-NOR-OFF                               08840099
126600                                   TO MR-SELECTA (PV-SUB)         08850099
126700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         08860099
126800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         08870099
126900                                                                  08880099
127000     END-PERFORM.                                                 08920099
127100                                                                  08930099
127200 EJECT                                                            08940099
127300*----------------------------------------------------------------*        
127400*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *        
127500*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *        
127600*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *        
127700*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *        
127800*----------------------------------------------------------------*        
127900 3300-EDIT-SELECTIONS.                                                    
128000                                                                          
128100     EVALUATE TRUE                                                        
128200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
128300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)                 
128400                 CONTINUE                                                 
128500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)                 
128600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
128700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS           
128800                 MOVE ASC-TEMP-SELECTED-SW                                
128900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
129000                                TO ASC-SELECTED-SW                        
129100                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
129200             END-IF                                                       
129300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
129400                                = SPACE                                   
129500             EVALUATE TRUE                                                
129600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               
129700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        
129800                     MOVE SPACE TO ASC-SELECTED-SW                        
129900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
130000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                
130100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE            
130200                     MOVE SPACE TO ASC-SELECTED-SW                        
130300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
130400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)                  
130500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE              
130600                     MOVE SPACE TO ASC-SELECTED-SW                        
130700                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
130800             END-EVALUATE                                                 
130900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   
131000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
131100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
131200             END-IF                                                       
131300             PERFORM 3310-EDIT-RANGE                                      
131400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                     
131500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
131600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
131700             END-IF                                                       
131800             PERFORM 3310-EDIT-RANGE                                      
131900         WHEN OTHER                                                       
132000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                   
132100             SET DP020-MSG-FATAL    TO TRUE                               
132200             MOVE -1                TO MR-SELECTL (PV-SUB)                
132300             SET DP030-SET-CURSOR-APPL-1                                  
132400                                    TO TRUE                               
132500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)                
132600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)                
132700             SET PS-ERROR TO TRUE                                         
132800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
132900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS             
133000                 MOVE SPACE         TO ASC-SELECTED-SW                    
133100                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
133200             END-IF                                                       
133300     END-EVALUATE.                                                        
133400                                                                          
133500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                         
133600     SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
133700     IF  ASC-ITEM-SUB < 1                                                 
133800         SUBTRACT +1 FROM ASC-BLK-SUB                                     
133900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                        
134000     END-IF.                                                              
134100                                                                          
134200 EJECT                                                                    
134300*----------------------------------------------------------------*        
134400*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *        
134500*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *        
134600*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *        
134700*  THE ENDING.                                                   *        
134800*----------------------------------------------------------------*        
134900 3310-EDIT-RANGE.                                                         
135000                                                                          
135100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                        
135200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                           
135300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)        
135400                                   TO ASC-SELECTED-SW                     
135500                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
135600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE         
135700         ELSE                                                             
135800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE             
135900                 CONTINUE                                                 
136000             ELSE                                                         
136100*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---                  
136200                 MOVE PC-TSYMSG-00054                                     
136300                                   TO DP020-MSG-NUMBER                    
136400                 SET DP020-MSG-FATAL                                      
136500                                   TO TRUE                                
136600                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
136700                 SET DP030-SET-CURSOR-APPL-1                              
136800                                   TO TRUE                                
136900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)                 
137000                 MOVE DP015-UNDERLINE                                     
137100                                   TO MR-SELECTH (PV-SUB)                 
137200                 SET PS-ERROR      TO TRUE                                
137300             END-IF                                                       
137400         END-IF                                                           
137500     ELSE                                                                 
137600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
137700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
137800                                   TO ASC-SELECTED-SW                     
137900                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
138000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE           
138100         ELSE                                                             
138200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE               
138300                 CONTINUE                                                 
138400             ELSE                                                         
138500*--------------- ONLY ONE END-OF-RANGE ALLOWED -------                    
138600                 MOVE PC-TSYMSG-00055                                     
138700                                   TO DP020-MSG-NUMBER                    
138800                 SET DP020-MSG-FATAL                                      
138900                                   TO TRUE                                
139000                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
139100                 SET DP030-SET-CURSOR-APPL-1                              
139200                                   TO TRUE                                
139300                 SET PS-ERROR      TO TRUE                                
139400             END-IF                                                       
139500         END-IF                                                           
139600     END-IF.                                                              
139700                                                                          
139800 EJECT                                                                    
139900*----------------------------------------------------------------*        
140000*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *        
140100*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *        
140200*----------------------------------------------------------------*        
140300 3400-CHECK-RANGE-SEQUENCE.                                               
140400                                                                          
140500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
140600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                              
140700       AND  ASC-START-OF-SELECTED-RANGE >                                 
140800                                         ASC-END-OF-SELECTED-RANGE        
140900*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                        
141000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                         
141100         SET DP020-MSG-FATAL TO TRUE                                      
141200         SET PS-ERROR TO TRUE                                             
141300         PERFORM 3410-POSITION-AT-ERROR                                   
141400     END-IF.                                                              
141500                                                                          
141600 EJECT                                                                    
141700*----------------------------------------------------------------*        
141800*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *        
141900*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *        
142000*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *        
142100*----------------------------------------------------------------*        
142200 3410-POSITION-AT-ERROR.                                                  
142300                                                                          
142400     SET DP030-SET-CURSOR-APPL-1                                          
142500                                   TO TRUE.                               
142600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
142700                    - PV-TOP-ITEM + 1.                                    
142800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
142900         CONTINUE                                                         
143000     ELSE                                                                 
143100         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
143200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
143300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
143400     END-IF.                                                              
143500*                                                                         
143600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
143700                    - PV-TOP-ITEM + 1.                                    
143800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
143900         CONTINUE                                                         
144000     ELSE                                                                 
144100         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
144200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
144300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
144400     END-IF.                                                              
144500                                                                          
144600 EJECT                                                                    
144700*----------------------------------------------------------------*        
144800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *        
144900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *        
145000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *        
145100*----------------------------------------------------------------*        
145200 3500-MARK-RANGE-AS-SELECTED.                                             
145300                                                                          
145400     MOVE +1                       TO  ASC-BLK-SUB.                       
145500     PERFORM 3510-MARK-SELECTED-INDS                                      
145600         VARYING ASC-ITEM-SUB                                             
145700         FROM 1 BY 1                                                      
145800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
145900                                                                          
146000     ADD +1                        TO ASC-BLK-SUB.                        
146100     PERFORM 3510-MARK-SELECTED-INDS                                      
146200         VARYING ASC-ITEM-SUB                                             
146300         FROM 1 BY 1                                                      
146400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
146500                                                                          
146600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
146700                                   TO  PV-LIST-ITEM-NUMBER.               
146800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
146900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                                 
147000               PC-ITEMS-PER-PANEL).                                       
147100                                                                          
147200     MOVE ASC-START-OF-SELECTED-RANGE                                     
147300                                   TO PV-START-OF-SELECTED-RANGE.         
147400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                                    
147500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                          
147600               PC-ITEMS-PER-PANEL).                                       
147700                                                                          
147800     MOVE ASC-END-OF-SELECTED-RANGE                                       
147900                                   TO  PV-END-OF-SELECTED-RANGE.          
148000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                                     
148100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                            
148200               PC-ITEMS-PER-PANEL).                                       
148300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                     
148400         PV-FIRST-BLOCK-IN-ARRAY + 1.                                     
148500                                                                          
148600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR            
148700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)                
148800         MOVE +1                   TO ASC-BLK-SUB                         
148900         PERFORM 5100-WRITE-TEMP-STORAGE                                  
149000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
149100             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
149200                                                                          
149300         PERFORM                                                          
149400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                              
149500                   PV-PREV-BLOCK-IN-ARRAY                                 
149600             MOVE PV-FIRST-BLOCK-IN-RANGE                                 
149700                                   TO PV-BLOCK-NUMBER                     
149800             PERFORM 4410-READ-TEMP-STORAGE                               
149900             PERFORM 3510-MARK-SELECTED-INDS                              
150000                 VARYING ASC-ITEM-SUB                                     
150100                 FROM 1 BY 1                                              
150200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
150300             PERFORM 5100-WRITE-TEMP-STORAGE                              
150400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE             
150500         END-PERFORM                                                      
150600                                                                          
150700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
150800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
150900         PERFORM                                                          
151000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
151100                   PV-LAST-BLOCK-IN-RANGE                                 
151200             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
151300                                   TO PV-BLOCK-NUMBER                     
151400             PERFORM 4410-READ-TEMP-STORAGE                               
151500             PERFORM 3510-MARK-SELECTED-INDS                              
151600                 VARYING ASC-ITEM-SUB                                     
151700                 FROM 1 BY 1                                              
151800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
151900             PERFORM 5100-WRITE-TEMP-STORAGE                              
152000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
152100         END-PERFORM                                                      
152200                                                                          
152300         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
152400                                   TO PV-BLOCK-NUMBER                     
152500         PERFORM 4410-READ-TEMP-STORAGE                                   
152600     END-IF.                                                              
152700                                                                          
152800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE         
152900                                      ASC-END-OF-SELECTED-RANGE.          
153000                                                                          
153100 EJECT                                                                    
153200*----------------------------------------------------------------*        
153300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *        
153400*----------------------------------------------------------------*        
153500 3510-MARK-SELECTED-INDS.                                                 
153600                                                                          
153700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
153800                                ASC-ITEM-SUB) >                           
153900         ASC-START-OF-SELECTED-RANGE)                                     
154000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
154100                                ASC-ITEM-SUB) =                           
154200         ASC-START-OF-SELECTED-RANGE)                                     
154300                                                                          
154400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
154500                                    ASC-ITEM-SUB) <                       
154600             ASC-END-OF-SELECTED-RANGE)                                   
154700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
154800                                    ASC-ITEM-SUB) =                       
154900             ASC-END-OF-SELECTED-RANGE)                                   
155000                                                                          
155100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
155200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)           
155300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)           
155400                               TO TRUE                                    
155500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      
155600                               TO TRUE                                    
155700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS            
155800             END-IF                                                       
155900         END-IF                                                           
156000     END-IF.                                                              
156100                                                                          
156200 EJECT                                                                    
156300*----------------------------------------------------------------*08950099
156400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08960099
156500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08970099
156600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08980099
156700*    DISPLAY THE PANEL TO USER.                                  *08990099
156800*----------------------------------------------------------------*09000099
156900 4000-BUILD-INITIAL-PANEL.                                        09010099
157000                                                                  09020099
157100     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             09030099
157200                                ASC-BLOCK-ENTRIES (2)             09040099
157300                                ASC-TOT-UNITS                             
157400                                ASC-TOT-CARTONS                           
157500                                ASC-TOT-CBM.                              
157600     MOVE +1                 TO ASC-BLK-SUB.                      09050099
157700     SET DP030-SET-CURSOR-TRAILER TO TRUE.                                
157800     SET ASC-ITEMS-LEFT-ON-DB                                     09060099
157900                             TO TRUE.                             09070099
158000                                                                  09080099
158100     MOVE +0                 TO ASC-ITEM-SUB                      09090099
158200                                ASC-NUMBER-OF-ITEMS-READ          09100099
158300                                ASC-NUMBER-OF-SELECTED-ITEMS      09110099
158400                                ASC-HIGHEST-BLOCK-WRITTEN         09120099
158500                                ASC-START-OF-SELECTED-RANGE       09130099
158600                                ASC-END-OF-SELECTED-RANGE         09140099
158700                                ASC-ITEM-AT-TOP-OF-PANEL.         09150099
158800     PERFORM 4010-OPEN-CURSOR.                                    09160099
158900                                                                  09170099
159000     PERFORM 4300-READ-ITEMS-FROM-DB.                             09180099
159100                                                                  09190099
159200     PERFORM 4020-CLOSE-CURSOR.                                   09200099
159300                                                                          
159400     MOVE +1                   TO  PV-TOP-ITEM.                           
159500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
159600          PERFORM 4360-SELECT-TAUBKPO                                     
159700          IF PS-HISTORY-NO                                                
159800              SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       
159900              SET DP020-MSG-FATAL   TO  TRUE                              
160000*------- PURCHASE ORDER DOES NOT EXIST                                    
160100              MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  
160200          ELSE                                                            
160300              MOVE -1               TO MR-SELECTL (1)                     
160400              SET DP030-SET-CURSOR-APPL-1 TO TRUE                         
160500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        
160600          END-IF                                                          
160700     ELSE                                                         09280099
160800         MOVE -1               TO MR-SELECTL (1)                          
160900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
161000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09290099
161100     END-IF.                                                              
161200                                                                          
161300*MAM MOVE +1                   TO  PV-TOP-ITEM.                           
161400*MAM IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          09230099
161500*MAM     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    09240099
161600*MAM     SET DP020-MSG-FATAL   TO  TRUE                           09250099
161700*------- PURCHASE ORDER DOES NOT EXIST                            09260099
161800*MAM     MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               09270099
161900*MAM ELSE                                                         09280099
162000*MAM     MOVE -1               TO MR-SELECTL (1)                          
162100*MAM     SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
162200*MAM     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09290099
162300*MAM END-IF.                                                      09300099
162400                                                                  09310099
162500 EJECT                                                            09320099
162600*----------------------------------------------------------------*09330099
162700*   OPEN THE PO-BOOKING CURSOR.                                  *09340099
162800*----------------------------------------------------------------*09350099
162900 4010-OPEN-CURSOR.                                                09360099
163000                                                                  09370099
163100     PERFORM                                                      09380099
163200         WITH TEST AFTER                                          09390099
163300         VARYING PV-RETRY-COUNTER                                 09400099
163400         FROM 1 BY 1                                              09410099
163500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09420099
163600                   OR (SQLCODE = ZERO))                           09430099
163700                                                                  09440099
163800         MOVE 'CURSOR:  BOOKING-CSR' TO DP013-MESSAGE-TEXT (2)    09450099
163900                                                                  09460099
164000         EXEC SQL                                                 09470099
164100              OPEN BOOKING-CSR                                    09480099
164200         END-EXEC                                                 09490099
164300*                                                                 09500099
164400         EVALUATE TRUE                                            09510099
164500             WHEN SQLCODE = ZERO                                  09520099
164600             WHEN SQLCODE = -904                                  09530099
164700             WHEN SQLCODE = -913                                  09540099
164800                 CONTINUE                                         09550099
164900             WHEN SQLWARN0 NOT = SPACES                           09560099
165000             WHEN SQLCODE < ZERO                                  09570099
165100             WHEN SQLCODE > ZERO                                  09580099
165200                 MOVE '4010-OPEN-CURSOR'                          09590099
165300                                   TO DP013-PARAGRAPH             09600099
165400                 MOVE 'OPEN BOOKING CURSOR - '                    09610099
165500                                   TO DP013-MESSAGE-TEXT (1)      09620099
165600                 MOVE SQLCA        TO DP013-SQLCA                 09630099
165700                 MOVE 'TIMBKPO '   TO DP013-DB2-TABLE-NAME (1)    09640099
165800                 SET DP013-DB2-ABEND                              09650099
165900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09660099
166000                 PERFORM DP013-0000-PROCESS-ABEND                 09670099
166100         END-EVALUATE                                             09680099
166200     END-PERFORM.                                                 09690099
166300*                                                                 09700099
166400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09710099
166500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09720099
166600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09730099
166700                                   TO DP013-MESSAGE-TEXT (1)      09740099
166800         MOVE SQLCA                TO DP013-SQLCA                 09750099
166900         MOVE 'TIMBKPO '           TO DP013-DB2-TABLE-NAME (1)    09760099
167000         SET DP013-DB2-ABEND                                      09770099
167100             DP013-XCTL-DISPLAY-RESTART                           09780099
167200                                   TO TRUE                        09790099
167300         PERFORM DP013-0000-PROCESS-ABEND                         09800099
167400     END-IF.                                                      09810099
167500                                                                  09820099
167600 EJECT                                                            09830099
167700*----------------------------------------------------------------*09840099
167800*   CLOSE THE PO-BOOKING CURSOR                                  *09850099
167900*----------------------------------------------------------------*09860099
168000 4020-CLOSE-CURSOR.                                               09870099
168100                                                                  09880099
168200     EXEC SQL                                                     09890099
168300          CLOSE BOOKING-CSR                                       09900099
168400     END-EXEC.                                                    09910099
168500*                                                                 09920099
168600     EVALUATE TRUE                                                09930099
168700         WHEN SQLCODE = ZERO                                      09940099
168800             CONTINUE                                             09950099
168900         WHEN SQLWARN0 NOT = SPACES                               09960099
169000         WHEN SQLCODE < ZERO                                      09970099
169100         WHEN SQLCODE > ZERO                                      09980099
169200             MOVE '4020-CLOSE-CURSOR'                             09990099
169300                               TO DP013-PARAGRAPH                 10000099
169400             MOVE 'CLOSE BOOKING CURSOR '                         10010099
169500                               TO DP013-MESSAGE-TEXT (1)          10020099
169600             MOVE SQLCA        TO DP013-SQLCA                     10030099
169700             MOVE 'TIMBKPO '   TO DP013-DB2-TABLE-NAME (1)        10040099
169800             SET DP013-DB2-ABEND                                  10050099
169900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10060099
170000             PERFORM DP013-0000-PROCESS-ABEND                     10070099
170100     END-EVALUATE.                                                10080099
170200                                                                  10090099
170300 EJECT                                                            10100099
170400*----------------------------------------------------------------*10110099
170500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *10120099
170600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *10130099
170700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *10140099
170800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *10150099
170900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *10160099
171000*                                                                *10170099
171100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *10180099
171200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *10190099
171300*    UPON INITIALIZATION.                                        *10200099
171400*----------------------------------------------------------------*10210099
171500 4300-READ-ITEMS-FROM-DB.                                         10220099
171600                                                                  10230099
171700     PERFORM                                                      10240099
171800         VARYING PV-READ-COUNT                                    10250099
171900         FROM 1 BY 1                                              10260099
172000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10270099
172100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10280099
172200                                                                  10290099
172300         PERFORM 4310-FETCH                                       10300099
172400                                                                  10310099
172500         IF  ASC-ITEMS-LEFT-ON-DB                                 10320099
172600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                10330099
172700                 ADD +1            TO ASC-ITEM-SUB                10340099
172800             ELSE                                                 10350099
172900                 ADD +1            TO ASC-BLK-SUB                 10360099
173000                 MOVE +1           TO ASC-ITEM-SUB                10370099
173100                                                                  10380099
173200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         10390099
173300                     MOVE +1       TO ASC-BLK-SUB                 10400099
173400                     SET ASC-BLOCK-MODIFIED (1)                   10410099
173500                                   TO TRUE                        10420099
173600                     PERFORM 5100-WRITE-TEMP-STORAGE              10430099
173700                     MOVE ASC-BLOCK-ENTRIES                       10440099
173800                               (PC-MAX-BLOCKS-IN-ARRAY)           10450099
173900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 10460099
174000                     ADD +1        TO ASC-BLK-SUB                 10470099
174100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   10480099
174200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      10490099
174300                                   TO  TRUE                       10500099
174400                 END-IF                                           10510099
174500             END-IF                                               10520099
174600             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   10530099
174700             MOVE ASC-NUMBER-OF-ITEMS-READ                        10540099
174800                                   TO  ASC-LIST-ITEM-NUMBER       10550099
174900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10560099
175000             MOVE IMBKPO-ORGN-SHPD-FR-CDE                         10570099
175100                                   TO  ASC-TYPE                   10580099
175200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10590099
175300             MOVE IMBKPO-IMPRT-VEH-NM                             10600099
175400                                   TO  ASC-VSL-NAME               10610099
175500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10620099
175600             MOVE IMBKPO-TRIP-TYP-CDE                             10630099
175700                                   TO  ASC-TRIP-CODE              10640099
175800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10650099
175900             MOVE IMBKPO-PO-UNT-QTY                               10660099
176000                                   TO  ASC-UNTS                   10670099
176100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10680099
176200             ADD IMBKPO-PO-UNT-QTY                                        
176300                                   TO  ASC-TOT-UNITS                      
176400                                                                          
176500             MOVE IMBKPO-PO-CART-CNT                              10690099
176600                                   TO  ASC-CTN                    10700099
176700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10710099
176800             ADD IMBKPO-PO-CART-CNT                               10690099
176900                                   TO  ASC-TOT-CARTONS                    
177000                                                                          
177100             MOVE IMBKPO-PO-CBMT-QTY                              10720099
177200                                   TO  ASC-CBM                    10730099
177300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10740099
177400             ADD IMBKPO-PO-CBMT-QTY                               10690099
177500                                   TO  ASC-TOT-CBM                        
177600                                                                          
177700             MOVE IMBKPO-PO-BKG-SEQ-NBR                                   
177800                                   TO  ASC-PO-BKG-SEQ-NBR                 
177900                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
178000             PERFORM 4340-SELECT-TAUBKPO-CNT                      10750099
178100             PERFORM 4350-SELECT-TIMBKPO-CNT                      10760099
178200             ADD  PV-TAUBKPO-CNT PV-TIMBKPO-CNT                   10770099
178300             GIVING  ASC-TRN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)       10780099
178400*                                                                 10790099
178500             MOVE IMBKPO-PO-BKG-DELY-TMST (1:10)                          
178600                                   TO  ASC-DELY-DT                        
178700                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
178800*                                                                 10910099
178900             IF  IMBKPO-DPRTR-TMST (1:10)       = SPACES  OR      10920099
179000                                                  PC-INIT-DATE    10930099
179100                 MOVE SPACES       TO  ASC-ETD                    10940099
179200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10950099
179300             ELSE                                                 10960099
179400                 STRING  IMBKPO-DPRTR-TMST (6:2) '/'              10970099
179500                         IMBKPO-DPRTR-TMST (9:2)                  10980099
179600                         DELIMITED BY SIZE                        10990099
179700                                 INTO ASC-ETD                     11000099
179800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11010099
179900             END-IF                                               11020099
180000             IF  IMBKPO-LAST-UPD-TMST (1:10)                      11030099
180100                                          = SPACES OR PC-INIT-DATE11040099
180200                MOVE SPACES         TO ASC-LAST-TRN               11050099
180300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 11060099
180400             ELSE                                                 11070099
180500                STRING  IMBKPO-LAST-UPD-TMST(6:2) '/'             11080099
180600                        IMBKPO-LAST-UPD-TMST(9:2)                 11090099
180700                        DELIMITED BY SIZE                         11100099
180800                                  INTO ASC-LAST-TRN               11110099
180900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11120099
181000             END-IF                                               11130099
181100         END-IF                                                   11140099
181200     END-PERFORM.                                                 11150099
181300                                                                  11160099
181400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          11170099
181500         MOVE +1               TO ASC-BLK-SUB                     11180099
181600         PERFORM 5100-WRITE-TEMP-STORAGE                          11190099
181700         ADD +1                TO ASC-BLK-SUB                     11200099
181800         PERFORM 5100-WRITE-TEMP-STORAGE                          11210099
181900                                                                  11220099
182000         MOVE 1                TO ASC-BLK-SUB                     11230099
182100                                  PV-BLOCK-NUMBER                 11240099
182200         PERFORM 4410-READ-TEMP-STORAGE                           11250099
182300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             11260099
182400             MOVE 2            TO ASC-BLK-SUB                     11270099
182500                                  PV-BLOCK-NUMBER                 11280099
182600             PERFORM 4410-READ-TEMP-STORAGE                       11290099
182700         END-IF                                                   11300099
182800     END-IF.                                                      11310099
182900                                                                  11320099
183000 EJECT                                                            11330099
183100*----------------------------------------------------------------*11340099
183200*    FETCH THE BOOKING CURSOR.                                   *11350099
183300*----------------------------------------------------------------*11360099
183400 4310-FETCH.                                                      11370099
183500                                                                  11380099
183600     EXEC SQL                                                     11390099
183700          FETCH BOOKING-CSR                                       11400099
183800          INTO  :IMBKPO-PO-BKG-DELY-TMST                          11410099
183900              , :IMBKPO-PO-BKG-SEQ-NBR                            11420099
184000              , :IMBKPO-PO-CART-CNT                               11430099
184100              , :IMBKPO-PO-CBMT-QTY                               11440099
184200              , :IMBKPO-PO-UNT-QTY                                11450099
184300              , :IMBKPO-ORGN-SHPD-FR-CDE                          11460099
184400              , :IMBKPO-IMPRT-VEH-NM                              11470099
184500              , :IMBKPO-DPRTR-TMST                                11480099
184600              , :IMBKPO-POE-DELY-TMST                             11490099
184700              , :IMBKPO-TRIP-TYP-CDE                              11500099
184800              , :IMBKPO-LAST-UPD-TMST                             11510099
184900     END-EXEC.                                                    11520099
185000                                                                  11530099
185100     EVALUATE TRUE                                                11540099
185200         WHEN SQLCODE = ZERO                                      11550099
185300         WHEN SQLCODE = +100                                      11560099
185400              CONTINUE                                            11570099
185500         WHEN SQLWARN0 NOT = SPACE                                11580099
185600         WHEN SQLCODE NOT = ZERO                                  11590099
185700              MOVE '4310-FETCH-CURSOR'                            11600099
185800                               TO DP013-PARAGRAPH                 11610099
185900              MOVE 'FETCH BOOKING CURSOR'                         11620099
186000                               TO DP013-MESSAGE-TEXT (1)          11630099
186100              MOVE SQLCA       TO DP013-SQLCA                     11640099
186200              SET DP013-DB2-ABEND                                 11650099
186300                               TO TRUE                            11660099
186400              PERFORM DP013-0000-PROCESS-ABEND                    11670099
186500     END-EVALUATE.                                                11680099
186600                                                                  11690099
186700     IF  SQLCODE EQUAL +100                                       11700099
186800         SET ASC-NO-ITEMS-LEFT-ON-DB                              11710099
186900                                   TO TRUE                        11720099
187000     END-IF.                                                      11730099
187100                                                                  11740099
187200 EJECT                                                            11750099
187300*----------------------------------------------------------------*11760099
187400*        FORMAT THE DB2 DATE TO MM/DD/YY.                        *11770099
187500*----------------------------------------------------------------*11780099
187600 4320-PROCESS-DATE.                                               11790099
187700                                                                  11800099
187800     MOVE PV-DB-MM          TO  PV-DD-MM.                         11810099
187900     MOVE PV-DB-DD          TO  PV-DD-DD.                         11820099
188000     MOVE PV-DB-YY          TO  PV-DD-YY.                         11830099
188100                                                                  11840099
188200 EJECT                                                            11850099
188300*----------------------------------------------------------------*11860099
188400*    SELECT COUNT FROM TAUBKPO                                   *11870099
188500*----------------------------------------------------------------*11880099
188600 4340-SELECT-TAUBKPO-CNT.                                         11890099
188700                                                                  11900099
188800     EXEC SQL                                                     11910099
188900         SELECT                                                   11920099
189000                COUNT (*)                                         11930099
189100         INTO  :PV-TAUBKPO-CNT                                    11940099
189200         FROM   TAUBKPO                                           11950099
189300         WHERE  PO_NBR         = :DK-PO-NBR                       11960099
189400         AND    PO_BKG_SEQ_NBR = :IMBKPO-PO-BKG-SEQ-NBR           11970099
189500     END-EXEC.                                                    11980099
189600                                                                  11990099
189700     EVALUATE TRUE                                                12000099
189800         WHEN SQLCODE = ZERO                                      12010099
189900         WHEN SQLCODE = +100                                      12020099
190000              CONTINUE                                            12030099
190100         WHEN SQLWARN0 NOT = SPACE                                12040099
190200         WHEN SQLCODE NOT = ZERO                                  12050099
190300              MOVE '4340-SELECT-TAUBKPO-CNT'                      12060099
190400                               TO DP013-PARAGRAPH                 12070099
190500              MOVE 'SQL ERROR SELECTING COUNT FROM TAUBKPO'       12080099
190600                               TO DP013-MESSAGE-TEXT (1)          12090099
190700              MOVE SQLCA       TO DP013-SQLCA                     12100099
190800              SET DP013-DB2-ABEND                                 12110099
190900                               TO TRUE                            12120099
191000              PERFORM DP013-0000-PROCESS-ABEND                    12130099
191100     END-EVALUATE.                                                12140099
191200                                                                  12150099
191300 EJECT                                                            12160099
191400*----------------------------------------------------------------*12170099
191500*    SELECT COUNT FROM TIMCNTK                                   *12180099
191600*----------------------------------------------------------------*12190099
191700 4350-SELECT-TIMBKPO-CNT.                                         12200099
191800                                                                  12210099
191900     EXEC SQL                                                     12220099
192000         SELECT                                                   12230099
192100                COUNT (*)                                         12240099
192200         INTO  :PV-TIMBKPO-CNT                                    12250099
192300         FROM   TIMBKPO                                           12260099
192400         WHERE  PO_NBR         = :DK-PO-NBR                       12270099
192500         AND    PO_BKG_SEQ_NBR = :IMBKPO-PO-BKG-SEQ-NBR           12280099
192600     END-EXEC.                                                    12290099
192700*                                                                 12300099
192800     EVALUATE TRUE                                                12310099
192900         WHEN SQLCODE = ZERO                                      12320099
193000         WHEN SQLCODE = +100                                      12330099
193100              CONTINUE                                            12340099
193200         WHEN SQLWARN0 NOT = SPACE                                12350099
193300         WHEN SQLCODE NOT = ZERO                                  12360099
193400              MOVE '4350-SELECT-TIMBKPO-CNT'                      12370099
193500                               TO DP013-PARAGRAPH                 12380099
193600              MOVE 'SQL ERROR SELECTING COUNT FROM TIMBKPO'       12390099
193700                               TO DP013-MESSAGE-TEXT (1)          12400099
193800              MOVE SQLCA       TO DP013-SQLCA                     12410099
193900              SET DP013-DB2-ABEND                                 12420099
194000                               TO TRUE                            12430099
194100              PERFORM DP013-0000-PROCESS-ABEND                    12440099
194200     END-EVALUATE.                                                12450099
194300                                                                  12460099
194400 EJECT                                                            12470099
194500*----------------------------------------------------------------*11860099
194600*    SELECT ROW FROM TAUBKPO                                     *11870099
194700*----------------------------------------------------------------*11880099
194800 4360-SELECT-TAUBKPO.                                             11890099
194900                                                                  11900099
195000     EXEC SQL                                                     11910099
195100         SELECT PO_NBR                                            11920099
195200         INTO  :AUBKPO-PO-NBR                                     11940099
195300         FROM   TAUBKPO                                           11950099
195400         WHERE  PO_NBR         = :DK-PO-NBR                       11960099
195500*MAM     AND    PO_BKG_SEQ_NBR = :IMBKPO-PO-BKG-SEQ-NBR           11970099
195600     END-EXEC.                                                    11980099
195700                                                                  11990099
195800     EVALUATE TRUE                                                12000099
195900         WHEN SQLCODE = ZERO                                      12010099
196000         WHEN SQLCODE = -811                                              
196100              SET PS-HISTORY    TO TRUE                           12030099
196200                                                                          
196300         WHEN SQLCODE = +100                                      12020099
196400              SET PS-HISTORY-NO TO TRUE                           12030099
196500                                                                          
196600         WHEN SQLWARN0 NOT = SPACE                                12040099
196700         WHEN SQLCODE NOT = ZERO                                  12050099
196800              MOVE '4360-SELECT-TAUBKPO'                          12060099
196900                               TO DP013-PARAGRAPH                 12070099
197000              MOVE 'SQL ERROR SELECTING ROW FROM TAUBKPO'         12080099
197100                               TO DP013-MESSAGE-TEXT (1)          12090099
197200              MOVE SQLCA       TO DP013-SQLCA                     12100099
197300              SET DP013-DB2-ABEND                                 12110099
197400                               TO TRUE                            12120099
197500              PERFORM DP013-0000-PROCESS-ABEND                    12130099
197600     END-EVALUATE.                                                12140099
197700                                                                  12150099
197800 EJECT                                                            12160099
197900*----------------------------------------------------------------*12480099
198000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *12490099
198100*----------------------------------------------------------------*12500099
198200 4400-MOVE-COMMAREA-TO-SCREEN.                                    12510099
198300                                                                  12520099
198400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             12530099
198500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          12540099
198600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          12550099
198700             MOVE +1    TO ASC-BLK-SUB                            12560099
198800             PERFORM 5100-WRITE-TEMP-STORAGE                      12570099
198900             ADD +1     TO ASC-BLK-SUB                            12580099
199000             PERFORM 5100-WRITE-TEMP-STORAGE                      12590099
199100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12600099
199200                 GIVING PV-BLOCK-NUMBER                           12610099
199300                 REMAINDER PV-REMAINDER                           12620099
199400             IF  PV-REMAINDER > ZERO                              12630099
199500                 ADD +1 TO PV-BLOCK-NUMBER                        12640099
199600             END-IF                                               12650099
199700             MOVE +1    TO ASC-BLK-SUB                            12660099
199800             PERFORM 4410-READ-TEMP-STORAGE                       12670099
199900             ADD +1     TO ASC-BLK-SUB                            12680099
200000                           PV-BLOCK-NUMBER                        12690099
200100             PERFORM 4410-READ-TEMP-STORAGE                       12700099
200200     END-IF.                                                      12710099
200300     MOVE +1            TO ASC-BLK-SUB.                           12720099
200400     COMPUTE ASC-ITEM-SUB =                                       12730099
200500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12740099
200600         + PC-ITEMS-PER-PANEL).                                   12750099
200700*                                                                 12760099
200800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12770099
200900         ADD +1         TO ASC-BLK-SUB                            12780099
201000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12790099
201100     END-IF.                                                      12800099
201200*                                                                 12810099
201300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12820099
201400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12830099
201500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
201600     PERFORM 4420-FORMAT-LIST-LINES                               12840099
201700         VARYING PV-SUB                                           12850099
201800         FROM PC-ITEMS-PER-PANEL BY -1                            12860099
201900         UNTIL PV-SUB < +1.                                       12870099
202000*                                                                 12880099
202100     COMPUTE ASC-ITEMS-DISPLAYED =                                12890099
202200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          12900099
202300*                                                                 12910099
202400     PERFORM 4401-SELECT-PO-DETAILS.                              12920099
202500     PERFORM 4402-SELECT-AD-DTE.                                  12930099
202600     PERFORM 4403-SELECT-VND-STYL.                                12940099
202700     PERFORM 4404-OPEN-OUTR-PCK-CSR.                              12950099
202800     PERFORM 4405-FETCH-OUTR-PCK.                                 12960099
202900     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                             12970099
203000     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            12980099
203100*                                                                 12990099
203200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    13000099
203300                                      ASTRTITO.                   13010099
203400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    13020099
203500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    13030099
203600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            13040099
203700                                   TO ASELITO.                    13050099
203800*                                                                 13060099
203900     IF  DP020-MSG-NUMBER-X = SPACE                               13070099
204000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  13080099
204100*----------- MORE ITEMS TO DISPLAY ----                           13090099
204200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            13100099
204300             SET DP020-MSG-INFORMATIONAL TO TRUE                  13110099
204400         END-IF                                                   13120099
204500     END-IF.                                                      13130099
204600                                                                  13140099
204700 EJECT                                                            13150099
204800*----------------------------------------------------------------*13160099
204900*    SELECT PO DETAILS.                                          *13170099
205000*----------------------------------------------------------------*13180099
205100 4401-SELECT-PO-DETAILS.                                          13190099
205200                                                                  13200099
205300     PERFORM                                                      13210099
205400         WITH TEST AFTER                                          13220099
205500         VARYING PV-RETRY-COUNTER                                 13230099
205600         FROM 1 BY 1                                              13240099
205700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13250099
205800            OR  (SQLCODE = ZERO)                                  13260099
205900            OR  (SQLCODE = +100))                                 13270099
206000                                                                  13280099
206100         EXEC SQL                                                 13290099
206200              SELECT A.DEPT_NBR,                                  13300099
206300                     A.OTB_PER_NBR,                               13310099
206400                     A.TOT_UNT_QTY,                               13320099
206500                     A.PROD_CNTRY_CDE,                                    
206600                     B.ENT_NAME_DESC,                             13330099
206700                     C.CAN_IFNOT_SHIP_DTE,                        13340099
206800                     C.EXT_CAN_DTE,                               13350099
206900                     C.STRT_FCTRY_DTE,                            13360099
207000                     C.LAST_FCTRY_DTE,                            13370099
207100                     C.DONT_SHIP_BEF_DTE,                         13380099
207200                     C.FOB_CDE,                                   13390099
207300                     C.POE_CDE                                    13400099
207400               INTO :PURCHS-DEPT-NBR,                             13410099
207500                    :PURCHS-OTB-PER-NBR,                          13420099
207600                    :PURCHS-TOT-UNT-QTY,                          13430099
207700                    :PURCHS-PROD-CNTRY-CDE,                               
207800                    :ENTNME-ENT-NAME-DESC,                        13440099
207900                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                   13450099
208000                    :PLNSHP-EXT-CAN-DTE,                          13460099
208100                    :PLNSHP-STRT-FCTRY-DTE,                       13470099
208200                    :PLNSHP-LAST-FCTRY-DTE,                       13480099
208300                    :PLNSHP-DONT-SHIP-BEF-DTE,                    13490099
208400                    :PLNSHP-FOB-CDE,                              13500099
208500                    :PLNSHP-POE-CDE                               13510099
208600                FROM TPURCHS A,                                   13520099
208700                     TENTNME B,                                   13530099
208800                     TPLNSHP C                                    13540099
208900               WHERE A.PO_NBR         = :DK-PO-NBR                13550099
209000                 AND A.VER_STATUS_CDE = 'A'                       13560099
209100                 AND B.ENT_ID         =  A.ENT_ID                 13570099
209200                 AND B.TYPE_CDE       = '01'                      13580099
209300                 AND C.PO_NBR         =  A.PO_NBR                 13590099
209400                 AND C.VER_STATUS_CDE =  A.VER_STATUS_CDE         13600099
209500         END-EXEC                                                 13610099
209600*                                                                 13620099
209700         EVALUATE TRUE                                            13630099
209800             WHEN SQLCODE = ZERO                                  13640099
209900             WHEN SQLCODE = +100                                  13650099
210000             WHEN SQLCODE = -904                                  13660099
210100             WHEN SQLCODE = -913                                  13670099
210200                 CONTINUE                                         13680099
210300             WHEN SQLWARN0 NOT = SPACES                           13690099
210400             WHEN SQLCODE < ZERO                                  13700099
210500             WHEN SQLCODE > ZERO                                  13710099
210600                 MOVE '4401-SELECT-PO-DETAILS'                    13720099
210700                                   TO DP013-PARAGRAPH             13730099
210800                 MOVE 'SQL ERROR SELECTING PO DETAILS'            13740099
210900                                   TO DP013-MESSAGE-TEXT (1)      13750099
211000                 MOVE SQLCA        TO DP013-SQLCA                 13760099
211100                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    13770099
211200                 SET DP013-DB2-ABEND                              13780099
211300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13790099
211400                 PERFORM DP013-0000-PROCESS-ABEND                 13800099
211500         END-EVALUATE                                             13810099
211600     END-PERFORM.                                                 13820099
211700*                                                                 13830099
211800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13840099
211900         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH      13850099
212000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  13860099
212100                                   TO DP013-MESSAGE-TEXT (1)      13870099
212200         MOVE SQLCA                TO DP013-SQLCA                 13880099
212300         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    13890099
212400         SET DP013-DB2-ABEND                                      13900099
212500             DP013-XCTL-DISPLAY-RESTART                           13910099
212600                                   TO TRUE                        13920099
212700         PERFORM DP013-0000-PROCESS-ABEND                         13930099
212800     END-IF.                                                      13940099
212900                                                                  13950099
213000 EJECT                                                            13960099
213100*----------------------------------------------------------------*13970099
213200*     SELECT AD DATE FROM TPURITM                                *13980099
213300*----------------------------------------------------------------*13990099
213400 4402-SELECT-AD-DTE.                                              14000099
213500                                                                  14010099
213600     PERFORM                                                      14020099
213700         WITH TEST AFTER                                          14030099
213800         VARYING PV-RETRY-COUNTER                                 14040099
213900         FROM 1 BY 1                                              14050099
214000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14060099
214100         OR     (SQLCODE = ZERO)                                  14070099
214200         OR     (SQLCODE = +100))                                 14080099
214300                                                                  14090099
214400         EXEC SQL                                                 14100099
214500              SELECT                                              14110099
214600                     MIN(AD_EVNT_DTE)                             14120099
214700              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND            14130099
214800              FROM   TPURITM                                      14140099
214900              WHERE  PO_NBR         = :DK-PO-NBR                  14150099
215000                AND  VER_STATUS_CDE = 'A'                         14160099
215100                AND  AD_EVNT_DTE   ^= '0001-01-01'                14170099
215200         END-EXEC                                                 14180099
215300*                                                                 14190099
215400         EVALUATE TRUE                                            14200099
215500             WHEN SQLCODE = ZERO                                  14210099
215600             WHEN SQLCODE = +100                                  14220099
215700             WHEN SQLCODE = -904                                  14230099
215800             WHEN SQLCODE = -913                                  14240099
215900                  CONTINUE                                        14250099
216000             WHEN SQLWARN0 NOT = SPACE                            14260099
216100             WHEN SQLCODE NOT = ZERO                              14270099
216200                  MOVE '4402-SELECT-AD-DTE'                       14280099
216300                                   TO DP013-PARAGRAPH             14290099
216400                  MOVE 'SQL ERROR SELECTING AD DATE'              14300099
216500                                   TO DP013-MESSAGE-TEXT (1)      14310099
216600                  MOVE SQLCA       TO DP013-SQLCA                 14320099
216700                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    14330099
216800                  SET DP013-DB2-ABEND                             14340099
216900                      DP013-XCTL-DISPLAY-RESTART TO TRUE          14350099
217000                  PERFORM DP013-0000-PROCESS-ABEND                14360099
217100         END-EVALUATE                                             14370099
217200     END-PERFORM.                                                 14380099
217300*                                                                 14390099
217400     IF SQLCODE EQUAL + 0                                         14400099
217500        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK               14410099
217600        PERFORM 4320-PROCESS-DATE                                 14420099
217700        MOVE PV-DATE-DISPLAY       TO AADDTO                      14430099
217800     ELSE                                                         14440099
217900        MOVE SPACES                TO AADDTO                      14450099
218000     END-IF.                                                      14460099
218100*                                                                 14470099
218200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14480099
218300         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH             14490099
218400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA14500099
218500-             'TE'                 TO DP013-MESSAGE-TEXT (1)      14510099
218600         MOVE SQLCA                TO DP013-SQLCA                 14520099
218700         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    14530099
218800         SET DP013-DB2-ABEND                                      14540099
218900             DP013-XCTL-DISPLAY-RESTART                           14550099
219000                                   TO TRUE                        14560099
219100         PERFORM DP013-0000-PROCESS-ABEND                         14570099
219200     END-IF.                                                      14580099
219300                                                                  14590099
219400 EJECT                                                            14600099
219500*----------------------------------------------------------------*        
219600*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *        
219700*----------------------------------------------------------------*        
219800 4403-SELECT-VND-STYL.                                                    
219900                                                                          
220000     PERFORM                                                              
220100         WITH TEST AFTER                                                  
220200         VARYING PV-RETRY-COUNTER                                         
220300         FROM 1 BY 1                                                      
220400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
220500            OR  (SQLCODE = ZERO)                                          
220600            OR  (SQLCODE = +100)                                          
220700            OR  (SQLCODE = -811))                                         
220800                                                                          
220900         EXEC SQL                                                         
221000              SELECT   DISTINCT                                           
221100                       VS_NBR                                             
221200                INTO   :XLT00004-VS-NBR                                   
221300                FROM   TPURITM A                                          
221400                   ,   XLT_SKU B                                          
221500                   ,   XLT_VND_STYL C                                     
221600               WHERE   A.PO_NBR       = :DK-PO-NBR                        
221700                 AND   A.VER_STATUS_CDE = 'A'                             
221800                 AND   A.ITM_NBR = B.ITM_NBR                              
221900                 AND   B.STYL_ID = C.STYL_ID                              
222000         END-EXEC                                                         
222100                                                                          
222200         EVALUATE TRUE                                                    
222300             WHEN SQLCODE = ZERO                                          
222400             WHEN SQLCODE = +100                                          
222500             WHEN SQLCODE = -811                                          
222600             WHEN SQLCODE = -904                                          
222700             WHEN SQLCODE = -913                                          
222800                 CONTINUE                                                 
222900             WHEN SQLWARN0 NOT = SPACES                                   
223000             WHEN SQLCODE < ZERO                                          
223100             WHEN SQLCODE > ZERO                                          
223200                 MOVE '4403-SELECT-VND-STYL'                              
223300                                     TO DP013-PARAGRAPH                   
223400                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'                  
223500                                     TO DP013-MESSAGE-TEXT (1)            
223600                 MOVE SQLCA          TO DP013-SQLCA                       
223700                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)          
223800                 SET DP013-DB2-ABEND                                      
223900                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
224000                 PERFORM DP013-0000-PROCESS-ABEND                         
224100         END-EVALUATE                                                     
224200     END-PERFORM.                                                         
224300*                                                                         
224400     IF  SQLCODE EQUAL +0                                                 
224500         MOVE XLT00004-VS-NBR       TO AVNDSTYO                           
224600     ELSE                                                                 
224700         IF  SQLCODE EQUAL -811                                           
224800             MOVE '*MULTIPLES*'     TO AVNDSTYO                           
224900         END-IF                                                           
225000     END-IF.                                                              
225100*                                                                         
225200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
225300         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH                
225400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO        
225500-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)              
225600         MOVE SQLCA                TO DP013-SQLCA                         
225700         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)            
225800         SET DP013-DB2-ABEND                                              
225900             DP013-XCTL-DISPLAY-RESTART                                   
226000                                   TO TRUE                                
226100         PERFORM DP013-0000-PROCESS-ABEND                                 
226200     END-IF.                                                              
226300                                                                          
226400 EJECT                                                                    
226500*----------------------------------------------------------------*15260099
226600*     OPEN THE OUTER PACK CURSOR                                 *15270099
226700*----------------------------------------------------------------*15280099
226800 4404-OPEN-OUTR-PCK-CSR.                                          15290099
226900                                                                  15300099
227000     PERFORM                                                      15310099
227100         WITH TEST AFTER                                          15320099
227200         VARYING PV-RETRY-COUNTER                                 15330099
227300         FROM 1 BY 1                                              15340099
227400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15350099
227500            OR  (SQLCODE = ZERO))                                 15360099
227600                                                                  15370099
227700         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)   15380099
227800                                                                  15390099
227900         EXEC SQL                                                 15400099
228000              OPEN OUTR-PCK-CSR                                   15410099
228100         END-EXEC                                                 15420099
228200*                                                                 15430099
228300         EVALUATE TRUE                                            15440099
228400             WHEN SQLCODE = ZERO                                  15450099
228500             WHEN SQLCODE = -904                                  15460099
228600             WHEN SQLCODE = -913                                  15470099
228700                 CONTINUE                                         15480099
228800             WHEN SQLWARN0 NOT = SPACES                           15490099
228900             WHEN SQLCODE < ZERO                                  15500099
229000             WHEN SQLCODE > ZERO                                  15510099
229100                 MOVE '4404-OPEN-OUTR-PCK-CSR'                    15520099
229200                                   TO DP013-PARAGRAPH             15530099
229300                 MOVE 'OPEN OUTER-PACK CURSOR - '                 15540099
229400                                   TO DP013-MESSAGE-TEXT (1)      15550099
229500                 MOVE SQLCA        TO DP013-SQLCA                 15560099
229600                 MOVE 'TUPC   '   TO DP013-DB2-TABLE-NAME (1)     15570099
229700                 SET DP013-DB2-ABEND                              15580099
229800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15590099
229900                 PERFORM DP013-0000-PROCESS-ABEND                 15600099
230000         END-EVALUATE                                             15610099
230100     END-PERFORM.                                                 15620099
230200*                                                                 15630099
230300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15640099
230400         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH       15650099
230500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15660099
230600                                   TO DP013-MESSAGE-TEXT (1)      15670099
230700         MOVE SQLCA                TO DP013-SQLCA                 15680099
230800         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)    15690099
230900         SET DP013-DB2-ABEND                                      15700099
231000             DP013-XCTL-DISPLAY-RESTART                           15710099
231100                                   TO TRUE                        15720099
231200         PERFORM DP013-0000-PROCESS-ABEND                         15730099
231300     END-IF.                                                      15740099
231400                                                                  15750099
231500 EJECT                                                            15760099
231600*----------------------------------------------------------------*15770099
231700*     FETCH THE OUTER PACK QUANTITY                              *15780099
231800*----------------------------------------------------------------*15790099
231900 4405-FETCH-OUTR-PCK.                                             15800099
232000                                                                  15810099
232100     PERFORM                                                      15820099
232200         WITH TEST AFTER                                          15830099
232300         VARYING PV-RETRY-COUNTER                                 15840099
232400         FROM 1 BY 1                                              15850099
232500         UNTIL (SQLCODE = +100)                                   15860099
232600                                                                  15870099
232700         EXEC SQL                                                 07910099
232800              FETCH OUTR-PCK-CSR                                  07920099
232900              INTO  :PURITM-UNT-QTY                               07940099
233000                 ,  :PURITM-OUTR-PK-QTY                           07930099
233100         END-EXEC                                                 07950099
233200*                                                                 15930099
233300         EVALUATE TRUE                                            15940099
233400             WHEN SQLCODE = ZERO                                  15950099
233500             WHEN SQLCODE = +100                                  15960099
233600                  CONTINUE                                        15970099
233700             WHEN SQLWARN0 NOT = SPACE                            15980099
233800             WHEN SQLCODE NOT = ZERO                              15990099
233900                  MOVE '4405-FETCH-OUTR-PCK'                      16000099
234000                                   TO DP013-PARAGRAPH             16010099
234100                  MOVE 'FETCH OUTER-PACK CURSOR'                  16020099
234200                                   TO DP013-MESSAGE-TEXT (1)      16030099
234300                  MOVE SQLCA       TO DP013-SQLCA                 16040099
234400                  SET DP013-DB2-ABEND                             16050099
234500                                   TO TRUE                        16060099
234600                  PERFORM DP013-0000-PROCESS-ABEND                16070099
234700         END-EVALUATE                                             16080099
234800*                                                                 16090099
234900         IF  SQLCODE EQUAL +0                                     16100099
235000             IF PURITM-OUTR-PK-QTY = 0                            16110099
235100                DIVIDE 1 INTO PURITM-UNT-QTY                      16120099
235200                GIVING PV-ITEM-CART-CNT ROUNDED                   16130099
235300             ELSE                                                 16140099
235400                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY     16150099
235500                GIVING PV-ITEM-CART-CNT ROUNDED                   16160099
235600             END-IF                                               16170099
235700             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT               16180099
235800         END-IF                                                   16190099
235900     END-PERFORM.                                                 16200099
236000                                                                  16210099
236100 EJECT                                                            16220099
236200*----------------------------------------------------------------*16230099
236300*     CLOSE THE OUTER PACK CURSOR                                *16240099
236400*----------------------------------------------------------------*16250099
236500 4406-CLOSE-OUTR-PCK-CSR.                                         16260099
236600                                                                  16270099
236700     EXEC SQL                                                     16280099
236800          CLOSE OUTR-PCK-CSR                                      16290099
236900     END-EXEC.                                                    16300099
237000*                                                                 16310099
237100     EVALUATE TRUE                                                16320099
237200         WHEN SQLCODE = ZERO                                      16330099
237300             CONTINUE                                             16340099
237400         WHEN SQLWARN0 NOT = SPACES                               16350099
237500         WHEN SQLCODE < ZERO                                      16360099
237600         WHEN SQLCODE > ZERO                                      16370099
237700             MOVE '4406-CLOSE-OUTR-PCK-CSR'                       16380099
237800                               TO DP013-PARAGRAPH                 16390099
237900             MOVE 'CLOSE OUTER-PACK CURSOR '                      16400099
238000                               TO DP013-MESSAGE-TEXT (1)          16410099
238100             MOVE SQLCA        TO DP013-SQLCA                     16420099
238200             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)        16430099
238300             SET DP013-DB2-ABEND                                  16440099
238400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16450099
238500             PERFORM DP013-0000-PROCESS-ABEND                     16460099
238600     END-EVALUATE.                                                16470099
238700                                                                  16480099
238800 EJECT                                                            16490099
238900*----------------------------------------------------------------*16500099
239000*    MOVE PO DETAILS TO SCREEN.                                  *16510099
239100*----------------------------------------------------------------*16520099
239200 4407-MOVE-PO-DTLS-TO-SCR.                                        16530099
239300                                                                  16540099
239400     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   16550099
239500     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.                     
239600     MOVE PV-DEPT-NBR-N             TO ADEPTO.                    DPKCS036
239700     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     16570099
239800     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    16580099
239900     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                           
240000     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  16590099
240100     MOVE PLNSHP-FOB-CDE            TO AFOBO.                     16600099
240200     MOVE PLNSHP-POE-CDE            TO APOEO.                     16610099
240300     MOVE PV-PO-CART-CNT            TO ACTNSO.                    16620099
240400     MOVE ASC-TOT-CARTONS           TO ATOTCNTO.                  16620099
240500     MOVE ASC-TOT-UNITS             TO ATOTUNTO.                  16620099
240600     MOVE ASC-TOT-CBM               TO ATOTCBMO.                  16620099
240700*                                                                 16630099
240800     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE               16640099
240900        MOVE SPACES                 TO ACANDTO                    16650099
241000     ELSE                                                         16660099
241100        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                            16670099
241200                                    TO PV-DATE-BREAK              16680099
241300        PERFORM 4320-PROCESS-DATE                                 16690099
241400        MOVE PV-DATE-DISPLAY        TO ACANDTO                    16700099
241500     END-IF.                                                      16710099
241600*                                                                 16720099
241700     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE               16730099
241800        MOVE SPACES                 TO AXCANDTO                   16740099
241900     ELSE                                                         16750099
242000        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK              16760099
242100        PERFORM 4320-PROCESS-DATE                                 16770099
242200        MOVE PV-DATE-DISPLAY        TO AXCANDTO                   16780099
242300     END-IF.                                                      16790099
242400*                                                                 16800099
242500     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE               16810099
242600        MOVE SPACES                 TO ASTXFDTO                   16820099
242700     ELSE                                                         16830099
242800        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK              16840099
242900        PERFORM 4320-PROCESS-DATE                                 16850099
243000        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                   16860099
243100     END-IF.                                                      16870099
243200*                                                                 16880099
243300     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE               16890099
243400        MOVE SPACES                 TO ALTXFDTO                   16900099
243500     ELSE                                                         16910099
243600        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK              16920099
243700        PERFORM 4320-PROCESS-DATE                                 16930099
243800        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                   16940099
243900     END-IF.                                                      16950099
244000*                                                                 16960099
244100     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE               16970099
244200        MOVE SPACES                 TO ADSHBEFO                   16980099
244300     ELSE                                                         16990099
244400        MOVE PLNSHP-DONT-SHIP-BEF-DTE                             17000099
244500                                    TO PV-DATE-BREAK              17010099
244600        PERFORM 4320-PROCESS-DATE                                 17020099
244700        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                   17030099
244800     END-IF.                                                      17040099
244900                                                                  17050099
245000 EJECT                                                            17060099
245100*----------------------------------------------------------------*17070099
245200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17080099
245300*----------------------------------------------------------------*17090099
245400 4410-READ-TEMP-STORAGE.                                          17100099
245500                                                                  17110099
245600     EXEC CICS                                                    17120099
245700         READQ TS                                                 17130099
245800             QUEUE (ASC-LIST-QUEUE-NAME)                          17140099
245900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17150099
246000             ITEM  (PV-BLOCK-NUMBER)                              17160099
246100             RESP  (PV-CICS-RESP)                                 17170099
246200     END-EXEC.                                                    17180099
246300                                                                  17190099
246400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17200099
246500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17210099
246600         CONTINUE                                                 17220099
246700     ELSE                                                         17230099
246800         SET DP013-CICS-ABEND     TO TRUE                         17240099
246900         SET DP013-NO-ROLLBACK    TO TRUE                         17250099
247000         MOVE '4410-READ-TEMP-STORAGE'                            17260099
247100                                  TO DP013-PARAGRAPH              17270099
247200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17280099
247300                                  TO DP013-MESSAGE-TEXT(1)        17290099
247400         PERFORM DP013-0000-PROCESS-ABEND                         17300099
247500     END-IF.                                                      17310099
247600                                                                  17320099
247700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17330099
247800*                                                                 17340099
247900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17350099
248000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17360099
248100     END-IF.                                                      17370099
248200                                                                  17380099
248300 EJECT                                                            17390099
248400*----------------------------------------------------------------*17400099
248500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17410099
248600*----------------------------------------------------------------*17420099
248700 4420-FORMAT-LIST-LINES.                                          17430099
248800                                                                  17440099
248900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17450099
249000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17460099
249100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        17470099
249200         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        17480099
249300         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        17490099
249400                                    MR-ACTION     (PV-SUB)        17500099
249500                                    MR-DELY-DT    (PV-SUB)        17510099
249600                                    MR-TYPE       (PV-SUB)        17520099
249700                                    MR-VSL-NAME   (PV-SUB)        17530099
249800                                    MR-TRIP-CODE  (PV-SUB)        17540099
249900                                    MR-ETD        (PV-SUB)        17550099
250000                                    MR-LAST-TRN   (PV-SUB)        17560099
250100                                    MR-CTN-X      (PV-SUB)        17570099
250200                                    MR-CBM-X      (PV-SUB)        17580099
250300                                    MR-UNTS-X     (PV-SUB)        17590099
250400                                                                  17600099
250500         MOVE ZEROS              TO MR-TRN-CNT  (PV-SUB)          17610099
250600     ELSE                                                         17620099
250700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17630099
250800                                                   > SPACE        17640099
250900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17650099
251000                                 TO MR-SELECTI (PV-SUB)           17660099
251100         ELSE                                                     17670099
251200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17680099
251300                                 TO MR-SELECTI (PV-SUB)           17690099
251400         END-IF                                                   17700099
251500                                                                          
251600         IF DP030-SET-CURSOR-TRAILER                                      
251700            IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
251800                > SPACE)                                                  
251900              OR (PV-SUB = 1))                                            
252000               SET DP030-SET-CURSOR-APPL-1 TO TRUE                        
252100               MOVE -1        TO MR-SELECTL (PV-SUB)                      
252200            END-IF                                                        
252300         END-IF                                                           
252400*                                                                 17710099
252500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17720099
252600             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         17730099
252700                               TO MR-ACTION (PV-SUB)              17740099
252800                                                                          
252900             IF ASC-DELY-DT (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL              
253000                        SPACES OR PC-INIT-DATE                            
253100                 MOVE SPACES TO MR-DELY-DT (PV-SUB)                       
253200             ELSE                                                         
253300                 STRING  ASC-DELY-DT                                      
253400                          (ASC-BLK-SUB ASC-ITEM-SUB) (6:2) '/'            
253500                         ASC-DELY-DT                                      
253600                          (ASC-BLK-SUB ASC-ITEM-SUB) (9:2)                
253700                            DELIMITED BY SIZE                             
253800                              INTO MR-DELY-DT (PV-SUB)                    
253900             END-IF                                                       
254000                                                                          
254100             MOVE ASC-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)         17770099
254200                               TO MR-TYPE (PV-SUB)                17780099
254300             MOVE ASC-VSL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)         17790099
254400                               TO MR-VSL-NAME (PV-SUB)            17800099
254500             MOVE ASC-TRIP-CODE(ASC-BLK-SUB ASC-ITEM-SUB)         17810099
254600                               TO MR-TRIP-CODE (PV-SUB)           17820099
254700             MOVE ASC-ETD      (ASC-BLK-SUB ASC-ITEM-SUB)         17830099
254800                               TO MR-ETD (PV-SUB)                 17840099
254900             MOVE ASC-UNTS     (ASC-BLK-SUB ASC-ITEM-SUB)         17850099
255000                               TO MR-UNTS (PV-SUB)                17860099
255100             MOVE ASC-CTN      (ASC-BLK-SUB ASC-ITEM-SUB)         17870099
255200                               TO MR-CTN (PV-SUB)                 17880099
255300             MOVE ASC-CBM      (ASC-BLK-SUB ASC-ITEM-SUB)         17890099
255400                               TO MR-CBM (PV-SUB)                 17900099
255500             MOVE ASC-TRN-CNT  (ASC-BLK-SUB ASC-ITEM-SUB)         17910099
255600                               TO MR-TRN-CNT (PV-SUB)             17920099
255700             MOVE ASC-LAST-TRN (ASC-BLK-SUB ASC-ITEM-SUB)         17930099
255800                               TO MR-LAST-TRN (PV-SUB)            17940099
255900         END-IF                                                   17950099
256000     END-IF.                                                      17960099
256100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17970099
256200     IF  ASC-ITEM-SUB < + 1                                       17980099
256300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17990099
256400         MOVE +1                 TO ASC-BLK-SUB                   18000099
256500     END-IF.                                                      18010099
256600                                                                  18020099
256700 EJECT                                                            18030099
256800*----------------------------------------------------------------*        
256900*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *        
257000*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *        
257100*  ISSUE A WARNING.                                              *        
257200*----------------------------------------------------------------*        
257300 4430-CHECK-FOR-BEGIN-AND-END.                                            
257400                                                                          
257500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
257600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
257700*----------- NO END-OF-RANGE SPECFIED ---                                 
257800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
257900             SET DP020-MSG-WARNING TO TRUE                                
258000             PERFORM 4431-POSITION-AT-WARNING                             
258100         END-IF                                                           
258200     ELSE                                                                 
258300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
258400*----------- NO BEGINNING-OF-RANGE SPECFIED ---                           
258500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
258600             SET DP020-MSG-WARNING TO TRUE                                
258700             PERFORM 4431-POSITION-AT-WARNING                             
258800         END-IF                                                           
258900     END-IF.                                                              
259000                                                                          
259100 EJECT                                                                    
259200*----------------------------------------------------------------*        
259300*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *        
259400*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *        
259500*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *        
259600*  POSITION THE CURSOR THERE.                                    *        
259700*----------------------------------------------------------------*        
259800 4431-POSITION-AT-WARNING.                                                
259900                                                                          
260000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
260100                    - PV-TOP-ITEM + 1.                                    
260200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
260300         CONTINUE                                                         
260400     ELSE                                                                 
260500         SET DP030-SET-CURSOR-APPL-1                                      
260600                                   TO TRUE                                
260700         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
260800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
260900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
261000     END-IF.                                                              
261100*                                                                         
261200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
261300                    - PV-TOP-ITEM + 1.                                    
261400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
261500         CONTINUE                                                         
261600     ELSE                                                                 
261700         SET DP030-SET-CURSOR-APPL-1                                      
261800                                   TO TRUE                                
261900         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
262000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
262100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
262200     END-IF.                                                              
262300                                                                          
262400 EJECT                                                                    
262500*----------------------------------------------------------------*        
262600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *        
262700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *        
262800* FOR THE SELECTED ITEMS QUEUE.                                  *        
262900*                                                                *        
263000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *        
263100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *        
263200* THE ARRAY IS FULL.                                             *        
263300*----------------------------------------------------------------*        
263400 5000-PREPARE-SEL-QUEUE.                                                  
263500                                                                          
263600     MOVE +1                   TO  ASC-BLK-SUB.                           
263700     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
263800     ADD +1                    TO  ASC-BLK-SUB.                           
263900     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
264000     MOVE ASC-SEL-QUEUE-NAME   TO  TR117-SEL-QUEUE-NAME.                  
264100     PERFORM 6010-DELETE-SEL-QUEUE.                                       
264200                                                                          
264300     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
264400                                                                          
264500     SET TR118-IDX             TO  1.                                     
264600     MOVE ZERO                 TO TR117-NUMBER-OF-TS-ITEMS.               
264700     INITIALIZE TR118-SELECTED-ITEM-ARRAY.                                
264800                                                                          
264900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
265000             VARYING PV-ITEM                                              
265100             FROM 1 BY 1                                                  
265200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
265300                                                                          
265400     IF  TR118-IDX > 1                                                    
265500         PERFORM 5205-WRITE-SEL-QUEUE                                     
265600         ADD +1                    TO TR117-NUMBER-OF-TS-ITEMS            
265700     END-IF.                                                              
265800                                                                          
265900 5001-PREPARE-SEL-QUEUE.                                                  
266000                                                                          
266100     MOVE +1                   TO  ASC-BLK-SUB.                           
266200     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
266300     ADD +1                    TO  ASC-BLK-SUB.                           
266400     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
266500     MOVE ASC-SEL-QUEUE-NAME   TO  TR117-SEL-QUEUE-NAME.                  
266600     PERFORM 6010-DELETE-SEL-QUEUE.                                       
266700                                                                          
266800     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
266900                                                                          
267000     SET TR118-IDX             TO  1.                                     
267100     MOVE ZERO                 TO TR117-NUMBER-OF-TS-ITEMS.               
267200     INITIALIZE TR118-SELECTED-ITEM-ARRAY.                                
267300                                                                          
267400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
267500             VARYING PV-ITEM                                              
267600             FROM 1 BY 1                                                  
267700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
267800                                                                          
267900     IF  TR118-IDX > 1                                                    
268000         PERFORM 5205-WRITE-SEL-QUEUE                                     
268100         ADD +1                    TO TR117-NUMBER-OF-TS-ITEMS            
268200     END-IF.                                                              
268300                                                                          
268400 EJECT                                                                    
268500*----------------------------------------------------------------*18040099
268600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18050099
268700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18060099
268800*----------------------------------------------------------------*18070099
268900 5100-WRITE-TEMP-STORAGE.                                         18080099
269000                                                                  18090099
269100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18100099
269200                                   TO PV-LIST-ITEM-NUMBER.        18110099
269300     COMPUTE PV-BLOCK-NUMBER =                                    18120099
269400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18130099
269500                                                                  18140099
269600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18150099
269700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18160099
269800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18170099
269900             PERFORM 5105-REWRITE-ASC-LISTQ                       18180099
270000         END-IF                                                   18190099
270100     ELSE                                                         18200099
270200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       18210099
270300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            18220099
270400         PERFORM 5110-WRITE-ASC-LISTQ                             18230099
270500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   18240099
270600     END-IF.                                                      18250099
270700                                                                  18260099
270800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18270099
270900                                                                  18280099
271000 EJECT                                                            18290099
271100*----------------------------------------------------------------*18300099
271200*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *18310099
271300*  SPECIFIC COMMAREA.                                            *18320099
271400*----------------------------------------------------------------*18330099
271500 5105-REWRITE-ASC-LISTQ.                                          18340099
271600                                                                  18350099
271700     EXEC CICS                                                    18360099
271800         WRITEQ TS                                                18370099
271900             QUEUE (ASC-LIST-QUEUE-NAME)                          18380099
272000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18390099
272100             ITEM  (PV-BLOCK-NUMBER)                              18400099
272200             REWRITE                                              18410099
272300             RESP  (PV-CICS-RESP)                                 18420099
272400     END-EXEC.                                                    18430099
272500                                                                  18440099
272600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18450099
272700         CONTINUE                                                 18460099
272800     ELSE                                                         18470099
272900         SET DP013-CICS-ABEND            TO TRUE                  18480099
273000         SET DP013-NO-ROLLBACK           TO TRUE                  18490099
273100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18500099
273200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18510099
273300                                         TO DP013-MESSAGE-TEXT(1) 18520099
273400         PERFORM DP013-0000-PROCESS-ABEND                         18530099
273500     END-IF.                                                      18540099
273600                                                                  18550099
273700 EJECT                                                            18560099
273800*----------------------------------------------------------------*18570099
273900*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *18580099
274000*  SPECIFIC COMMAREA.                                            *18590099
274100*----------------------------------------------------------------*18600099
274200 5110-WRITE-ASC-LISTQ.                                            18610099
274300                                                                  18620099
274400     EXEC CICS                                                    18630099
274500         WRITEQ TS                                                18640099
274600             QUEUE (ASC-LIST-QUEUE-NAME)                          18650099
274700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18660099
274800             ITEM  (PV-BLOCK-NUMBER)                              18670099
274900             RESP  (PV-CICS-RESP)                                 18680099
275000     END-EXEC.                                                    18690099
275100                                                                  18700099
275200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18710099
275300         SET DP013-CICS-ABEND      TO TRUE                        18720099
275400         SET DP013-NO-ROLLBACK     TO TRUE                        18730099
275500         MOVE '5110-WRITE-ASC-LISTQ'                              18740099
275600                                   TO DP013-PARAGRAPH             18750099
275700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           18760099
275800                                   TO DP013-MESSAGE-TEXT(1)       18770099
275900         PERFORM DP013-0000-PROCESS-ABEND                         18780099
276000     END-IF.                                                      18790099
276100                                                                  18800099
276200 EJECT                                                            18810099
276300*----------------------------------------------------------------*        
276400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *        
276500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *        
276600*----------------------------------------------------------------*        
276700 5200-FILL-SEL-QUEUE-RECORD.                                              
276800                                                                          
276900     PERFORM 6112-READ-LIST-QUEUE.                                        
277000                                                                          
277100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
277200         PERFORM                                                          
277300         VARYING LQW-IDX                                                  
277400         FROM 1 BY 1                                                      
277500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL                    
277600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO                  
277700                                                                          
277800             IF  LQW-SELECT (LQW-IDX)                                     
277900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                      
278000                                     TO TR118-ITEM (TR118-IDX)            
278100                 MOVE LQW-PO-BKG-SEQ-NBR  (LQW-IDX)  TO                   
278200                                 TR118-PO-SEQ-NBR (TR118-IDX)             
278300                                 TR117-PO-SEQ-NBR                         
278400                 MOVE LQW-TYPE        (LQW-IDX)      TO                   
278500                               TR118-ORGN-SHPD-FR-TYP (TR118-IDX)         
278600                                 TR117-ORGN-SHPD-FR-TYP                   
278700                 MOVE LQW-DELY-DT     (LQW-IDX)      TO                   
278800                                   TR118-DELY-DTE     (TR118-IDX)         
278900                                   TR117-DELY-DTE                         
279000                                                                          
279100                 MOVE 'I'           TO TR118-ACTION-SW (TR118-IDX)        
279200                 SET TR118-IDX UP BY 1                                    
279300                 IF  TR118-IDX > TR118-MAX-ITEMS                          
279400                     PERFORM 5205-WRITE-SEL-QUEUE                         
279500                     ADD +1        TO TR117-NUMBER-OF-TS-ITEMS            
279600                     INITIALIZE TR118-SELECTED-ITEM-ARRAY                 
279700                     SET TR118-IDX TO  1                                  
279800                 END-IF                                                   
279900             END-IF                                                       
280000         END-PERFORM                                                      
280100     END-IF.                                                              
280200                                                                          
280300 EJECT                                                                    
280400*----------------------------------------------------------------*        
280500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *        
280600*----------------------------------------------------------------*        
280700 5205-WRITE-SEL-QUEUE.                                                    
280800                                                                          
280900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
281000                                   TO TR118-SELECTED-ITEMS.               
281100                                                                          
281200     EXEC CICS                                                            
281300          WRITEQ TS                                                       
281400             QUEUE (ASC-SEL-QUEUE-NAME)                                   
281500             FROM  (TR118-PO-SELECT-RECORD)                               
281600             ITEM  (PV-SEL-QUEUE-ITEM)                                    
281700             RESP  (PV-CICS-RESP)                                         
281800     END-EXEC.                                                            
281900                                                                          
282000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
282100         CONTINUE                                                         
282200     ELSE                                                                 
282300         SET DP013-CICS-ABEND      TO TRUE                                
282400         SET DP013-NO-ROLLBACK     TO TRUE                                
282500         MOVE '5205-WRITE-SEL-QUEUE'                                      
282600                                   TO DP013-PARAGRAPH                     
282700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'                  
282800                                   TO DP013-MESSAGE-TEXT(1)               
282900         PERFORM DP013-0000-PROCESS-ABEND                                 
283000     END-IF.                                                              
283100                                                                          
283200 EJECT                                                                    
283300*----------------------------------------------------------------*        
283400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *        
283500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *        
283600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *        
283700*  THE USER.                                                     *        
283800*----------------------------------------------------------------*        
283900 6000-REFRESH-PANEL-FROM-TEMP.                                            
284000                                                                          
284100     IF  ASC-UPDATE-TSQ                                                   
284200         SET ASC-NO-TSQ-UPDATE TO TRUE                                    
284300         MOVE ZERO                 TO PV-SAVE-ITEM                        
284400                                      PV-SEL-QUEUE-ITEM                   
284500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                
284600                                   TO PV-HOLD-SELECTED-ITEMS              
284700         MOVE +1                   TO PV-ITEMS-PROCESSED                  
284800         PERFORM 6100-UPDATE-TSQ                                          
284900             UNTIL PV-ITEMS-PROCESSED >                                   
285000                                     PV-HOLD-SELECTED-ITEMS               
285100         PERFORM 6010-DELETE-SEL-QUEUE                                    
285200         INITIALIZE ASC-BLOCK-ENTRIES (1)                                 
285300                    ASC-BLOCK-ENTRIES (2)                                 
285400     END-IF.                                                              
285500                                                                          
285600 EJECT                                                                    
285700*----------------------------------------------------------------*        
285800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *        
285900*----------------------------------------------------------------*        
286000 6010-DELETE-SEL-QUEUE.                                                   
286100                                                                          
286200     EXEC CICS                                                            
286300         DELETEQ TS                                                       
286400             QUEUE (ASC-SEL-QUEUE-NAME)                                   
286500             RESP  (PV-CICS-RESP)                                         
286600     END-EXEC.                                                            
286700*                                                                         
286800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                              
286900        (PV-CICS-RESP = DFHRESP(QIDERR)))                                 
287000         CONTINUE                                                         
287100     ELSE                                                                 
287200         SET DP013-CICS-ABEND TO TRUE                                     
287300         SET DP013-NO-ROLLBACK TO TRUE                                    
287400         MOVE '6010-DELETE-SEL-QUEUE'                                     
287500                        TO DP013-PARAGRAPH                                
287600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'                 
287700                        TO DP013-MESSAGE-TEXT (1)                         
287800         PERFORM DP013-0000-PROCESS-ABEND                                 
287900     END-IF.                                                              
288000                                                                          
288100 EJECT                                                                    
288200*----------------------------------------------------------------*        
288300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *        
288400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *        
288500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *        
288600*    THE TEMP QUEUE.                                             *        
288700*----------------------------------------------------------------*        
288800 6100-UPDATE-TSQ.                                                         
288900                                                                          
289000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.                     
289100     PERFORM 6105-READ-SEL-QUEUE.                                         
289200     PERFORM                                                              
289300         VARYING TR118-IDX                                                
289400         FROM 1 BY 1                                                      
289500         UNTIL ((PV-ITEMS-PROCESSED >                                     
289600                              PV-HOLD-SELECTED-ITEMS)                     
289700         OR (TR118-IDX GREATER THAN TR118-MAX-ITEMS))                     
289800         IF  TR118-ACTION-SW (TR118-IDX) > SPACE                          
289900             PERFORM 6110-PROCESS-ITEMS                                   
290000         END-IF                                                           
290100         ADD +1                TO PV-ITEMS-PROCESSED                      
290200     END-PERFORM.                                                         
290300     PERFORM 6111-WRITE-LIST-QUEUE.                                       
290400                                                                          
290500 EJECT                                                                    
290600*----------------------------------------------------------------*        
290700*    READ THE LIST QUEUE RECORD.                                 *        
290800*----------------------------------------------------------------*        
290900 6105-READ-SEL-QUEUE.                                                     
291000                                                                          
291100     EXEC CICS                                                            
291200          READQ TS                                                        
291300             QUEUE (ASC-SEL-QUEUE-NAME)                                   
291400             INTO  (TR118-PO-SELECT-RECORD)                               
291500             ITEM  (PV-SEL-QUEUE-ITEM)                                    
291600             RESP  (PV-CICS-RESP)                                         
291700     END-EXEC.                                                            
291800*                                                                         
291900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
292000         CONTINUE                                                         
292100     ELSE                                                                 
292200         SET DP013-CICS-ABEND      TO  TRUE                               
292300         SET DP013-NO-ROLLBACK     TO  TRUE                               
292400         MOVE '6105-READ-SEL-QUEUE'                                       
292500                                   TO  DP013-PARAGRAPH                    
292600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
292700                                   TO  DP013-MESSAGE-TEXT(1)              
292800         PERFORM DP013-0000-PROCESS-ABEND                                 
292900     END-IF.                                                              
293000                                                                          
293100 EJECT                                                                    
293200*----------------------------------------------------------------*        
293300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*        
293400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*        
293500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *        
293600*----------------------------------------------------------------*        
293700 6110-PROCESS-ITEMS.                                                      
293800                                                                          
293900     COMPUTE PV-ITEM = 1 + ((TR118-ITEM (TR118-IDX) - 1)                  
294000                     / PC-ITEMS-PER-PANEL).                               
294100                                                                          
294200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                                   
294300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                                  
294400             PERFORM 6111-WRITE-LIST-QUEUE                                
294500         END-IF                                                           
294600         MOVE PV-ITEM          TO PV-SAVE-ITEM                            
294700                                                                          
294800         PERFORM 6112-READ-LIST-QUEUE                                     
294900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                       
295000             CONTINUE                                                     
295100         END-IF                                                           
295200     END-IF.                                                              
295300                                                                          
295400     COMPUTE PV-SUB = (TR118-ITEM (TR118-IDX)                             
295500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.                      
295600     SET LQW-DESELECT (PV-SUB) TO    TRUE.                                
295700     MOVE LQW-SELECTED-SW (PV-SUB)                                        
295800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).          
295900                                                                          
296000     IF TR118-INQ (TR118-IDX)                                             
296100        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)                     
296200     END-IF.                                                              
296300                                                                          
296400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                        
296500                                                                          
296600 EJECT                                                                    
296700*----------------------------------------------------------------*        
296800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *        
296900*----------------------------------------------------------------*        
297000 6111-WRITE-LIST-QUEUE.                                                   
297100                                                                          
297200     EXEC CICS                                                            
297300         WRITEQ TS                                                        
297400             QUEUE (ASC-LIST-QUEUE-NAME)                                  
297500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
297600             ITEM  (PV-SAVE-ITEM)                                         
297700             REWRITE                                                      
297800             RESP  (PV-CICS-RESP)                                         
297900     END-EXEC.                                                            
298000*                                                                         
298100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
298200         CONTINUE                                                         
298300     ELSE                                                                 
298400         SET DP013-CICS-ABEND  TO  TRUE                                   
298500         SET DP013-NO-ROLLBACK TO  TRUE                                   
298600         MOVE '6111-WRITE-LIST-QUEUE'                                     
298700                               TO  DP013-PARAGRAPH                        
298800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                          
298900                               TO  DP013-MESSAGE-TEXT(1)                  
299000         PERFORM DP013-0000-PROCESS-ABEND                                 
299100     END-IF.                                                              
299200                                                                          
299300 EJECT                                                                    
299400*----------------------------------------------------------------*        
299500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
299600*----------------------------------------------------------------*        
299700 6112-READ-LIST-QUEUE.                                                    
299800                                                                          
299900     EXEC CICS                                                            
300000         READQ TS                                                         
300100             QUEUE (ASC-LIST-QUEUE-NAME)                                  
300200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
300300             ITEM  (PV-ITEM)                                              
300400             RESP  (PV-CICS-RESP)                                         
300500     END-EXEC.                                                            
300600*                                                                         
300700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
300800         CONTINUE                                                         
300900     ELSE                                                                 
301000         SET DP013-CICS-ABEND        TO TRUE                              
301100         SET DP013-NO-ROLLBACK       TO TRUE                              
301200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
301300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
301400                                     TO DP013-MESSAGE-TEXT(1)             
301500         PERFORM DP013-0000-PROCESS-ABEND                                 
301600     END-IF.                                                              
301700                                                                          
301800 EJECT                                                                    
301900*----------------------------------------------------------------*18820099
302000*    ABEND PROCESSOR MODULE                                      *18830099
302100*----------------------------------------------------------------*18840099
302200                                                                  18850099
302300     COPY DPPD013.                                                18860099
