*********************************************************************** 00010003
*******                                                               * 00020004
*******  MUST USE BATCH COMPILE FOR THIS EXIT PROGRAM                 * 00021004
*******                                                               * 00022004
*                                                                     * 00023004
*   MODULE NAME = DPKCS107                                            * 00030003
*                                                                     * 00040003
* DESCRIPTIVE NAME = CICS     (RDO) Sample User Exit Program 6        * 00050003
*                                                                     * 00060003
*        @BANNER_START@                                               * 00070003
*        5655-147                                                     * 00080003
*        CICS 5.3.0                                                   * 00090003
*        (Element of CICS Transaction Server                          * 00100003
*          Version 1 Release 3)                                       * 00110003
*        @BANNER_END@                                                 * 00120003
*                                                                     * 00130003
* STATUS = 5.1.0                                                      * 00140003
*                                                                     * 00150003
* FUNCTION =                                                          * 00160003
*        Provides a sample user exit to show how to change the        * 00170003
*        routing of a message from a Transient data queue to          * 00180003
*        a list of consoles.                                          * 00190003
*                                                                     * 00200003
*        This sample shows how to route a message destined for        * 00210003
*        transient data queue CSCS, to consoles with route codes      * 00220003
*        2 & 11.                                                      * 00230003
*                                                                     * 00240003
* NOTES :                                                             * 00250003
*    DEPENDENCIES = S/370                                             * 00260003
*        None.                                                        * 00270003
*                                                                     * 00280003
*    RESTRICTIONS =                                                   * 00290003
*        None.                                                        * 00300003
*                                                                     * 00310003
*    PATCH LABEL = Via DFHPATCH Macro                                 * 00320003
*    MODULE TYPE = Executable | Table                                 * 00330003
*    PROCESSOR = Assembler                                            * 00340003
*    ATTRIBUTES = Read only, Serially Reusable, <Authorized>          * 00350003
*                                                                     * 00360003
*------------------------------------------------------------------ *   00370003
*                                                                     * 00380003
* CHANGE ACTIVITY :                                                   * 00390003
*        $MOD(DFH$SXP4),COMP(SAMPLES),PROD(CICS    ):                 * 00400003
*                                                                     * 00410003
*     PN= REASON REL YYMMDD HDXIII : REMARKS                          * 00420003
*    $P0= 507    320 890814 HD5EISR: Implicit flag.                   * 00430003
*    $P1= M60695 320 900129 HD6ISS: Change Message Number in code From* 00440003
*                                 : 0101 to 0108.                     * 00450003
*    $P2= M62307 320 900602 HD3BADW: Use UERCNORM return code EQU     * 00460003
*    $P3= M96433 510 960205 HD4PALS : Add RMODE ANY & Change SN0108   * 00470003
*                                   : to SN1100                       * 00480003
*                                                                     * 00490003
*********************************************************************** 00500003
*/*(   Start of ABSTRACT commenting                     */              00510003
**********************************************************              00520003
* This instruction sets up the Sample user exit point.   *              00530003
**********************************************************              00540003
*                                                                       00550003
         DFHUEXIT TYPE=EP,ID=XMEOUT                                     00560003
*                                                                       00570003
**********************************************************              00580003
* The following DSECT maps a storage area you can use to *              00590003
* make the exit program reentrant by storing the address *              00600003
* of the storage you acquire in the first four bytes of  *              00610003
* the 260-byte area provided by the user exit handler    *              00620003
* (DFHUEH) and addressed by UEPXSTOR.                    *              00630003
**********************************************************              00640003
*                                                                       00650003
TRANSTOR DSECT                                                          00660003
*                                                                       00670003
**********************************************************              00680003
* Register Equates                                       *              00690003
**********************************************************              00700003
*                                                                       00710003
R0       EQU   0                                                        00720003
R1       EQU   1                                                        00730003
R2       EQU   2                                                        00740003
R3       EQU   3                                                        00750003
R4       EQU   4                                                        00760003
R5       EQU   5                                                        00770003
R6       EQU   6                                                        00780003
R7       EQU   7                                                        00790003
R8       EQU   8                                                        00800003
R9       EQU   9                                                        00810003
R10      EQU   10                                                       00820003
R11      EQU   11                                                       00830003
R12      EQU   12                                                       00840003
R13      EQU   13                                                       00850003
R14      EQU   14                                                       00860003
R15      EQU   15                                                       00870003
PMNTD    EQU   R3                  Number of TD queues                  00880003
PMNRC    EQU   R4                  Number of Route codes                00890003
PMTDQ    EQU   R5                  Array of TD queues                   00900003
PMNUM    EQU   R6                  Message number                       00910003
PMDOM    EQU   R7                  Domain id                            00920003
PMROU    EQU   R8                  Route code array                     00930003
EXIT_RC  EQU   R15                                                      00940003
*                                                                       00950003
**********************************************************              00960003
* The next seven instructions form the normal start of a *              00970003
* Sample user exit program, setting the addressing mode  *              00980003
* to 31-bit, saving the calling program's registers,     *              00990003
* establishing base addressing, and establishing the     *              01000003
* addressing of the user exit parameter list             *              01010003
**********************************************************              01020003
DPKCS107 CSECT                                                          01030003
DPKCS107 AMODE 31                                                       01040003
DPKCS107 RMODE ANY                                                 @P3A 01050003
         SAVE  (14,12)             SAVE REGISTERS                       01060003
         LR    R11,R15                                                  01070003
         USING DPKCS107,R11        SET UP PROGRAM BASE REGISTER         01080003
         LR    R2,R1                                                    01090003
         USING DFHUEPAR,R2         ADDRESS USER EXIT PARAMETER LIST     01100003
*                                                                       01110003
**********************************************************              01120003
* <<<<<< Section to be Modified by the Users.     >>>>>> *              01130003
*                        START.                          *              01140003
**********************************************************              01150003
*                                                                       01160003
**********************************************************              01170003
*/*|   Is the number of TD queues zero ?  NTD = 0 ?     */              01180003
*/*|   If yes, then we have no work to do, and exit     */              01190003
*/*|            Return code NORMAL                      */              01200003
**********************************************************              01210003
         L     PMNTD,UEPMNTD       Get address of Number of TD queues   01220003
         CLC   0(2,PMNTD),=H'0'                                         01230003
         BE    RCNORMAL                                                 01240003
**********************************************************              01250003
*/*|   Set up Message Number, Domain Id, and transient  */              01260003
*/*|            data queue.                             */              01270003
**********************************************************              01280003
         L     PMNUM,UEPMNUM       Get address of Message Number        01290003
         L     PMDOM,UEPMDOM       Get address of Domain Id             01300003
         L     PMTDQ,UEPMTDQ       Get address of transient data queue  01310003
         L     PMROU,UEPMROU       Get address of Route Codes array     01320003
         L     PMNRC,UEPMNRC       Get address of Number of Routes      01330003
**********************************************************              01340003
*/*|   Is Message number = 1100?...                     */              01350003
*/*|     & Domain Id = SN?...                           */              01360003
*/*|     & only TD queue = CSCS?                        */              01370003
*/*|   Yes? Then we've found what we want               */              01380003
*/*|   No?  Exit - return code NORMAL                   */              01390003
**********************************************************              01400003
         CLC   0(4,PMNUM),=F'2411' MESSAGE NUMBER = 2411?          @P3C 01410005
         BNE   RCNORMAL                                                 01420003
         CLC   0(2,PMDOM),=C'ZC'   DOMAIN ID = ZC?                      01430005
         BNE   RCNORMAL                                                 01440003
         CLC   0(4,PMTDQ),=C'CSNE' TD QUEUE = CSNE?                     01450005
         BNE   RCNORMAL                                                 01460003
         CLC   0(2,PMNTD),=H'1'    Number TD queues = 1?                01470003
         BNE   RCNORMAL                                                 01480003
**********************************************************              01490003
*/*|   Having found the correct message,                */              01500003
*/*|   We decrease the number of transient data queues  */              01510003
*/*|   ...increase the number of route codes to 2       */              01520003
*/*|   ...and set the route codes to 2 and 11           */              01530003
**********************************************************              01540003
         MVC   0(2,PMNTD),=H'0'    Set Number of TD queues to 0         01550003
         MVC   0(2,PMNRC),=H'2'    Set Number Route codes to 2          01560003
         MVI   0(PMROU),X'02'      Set first route code to 2            01570003
         MVI   1(PMROU),X'0B'      Set second route code to 11     @P1C 01580003
*                                                                       01590003
**********************************************************              01600003
*                         END.                           *              01610003
* <<<<<< Section to be Modified by the Users.     >>>>>> *              01620003
**********************************************************              01630003
*                                                                       01640003
*/*)   Return code NORMAL                              */               01650003
*                                                                       01660003
**********************************************************              01670003
*   RCNORMAL will set the return code to UERCNORM        *              01680003
**********************************************************              01690003
*                                                                       01700003
RCNORMAL DS    0H                                                       01710003
         LA    EXIT_RC,UERCNORM    Set the Return Code to NORMAL   @P2C 01720003
         B     STEND                                                    01730003
*                                                                       01740003
**********************************************************              01750003
* Restore registers, set return code, and return to user *              01760003
* exit handler.                                          *              01770003
**********************************************************              01780003
*                                                                       01790003
STEND    DS    0H                                                       01800003
         L     R13,UEPEPSA                                              01810003
         RETURN (14,12),RC=(15)                                         01820003
         LTORG                                                          01830003
         END   DPKCS107                                                 01840003
