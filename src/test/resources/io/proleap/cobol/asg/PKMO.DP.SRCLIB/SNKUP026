000600 IDENTIFICATION DIVISION.                                         00060000
000700 PROGRAM-ID.             SNKUP026.                                00070099
000800 AUTHOR.                 PAUL JORGENSEN.                          00080099
000900 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00090000
001000 DATE-WRITTEN.           JULY 2009.                               00100099
001100 DATE-COMPILED.                                                   00110000
001200                                                                  00120023
005100 ENVIRONMENT DIVISION.                                            00510000
005200                                                                  00520023
005300 CONFIGURATION SECTION.                                           00530000
005400 SOURCE-COMPUTER.        IBM-3090.                                00540000
005500 OBJECT-COMPUTER.        IBM-3090.                                00550000
005600 INPUT-OUTPUT SECTION.                                            00560099
005700                                                                  00570099
005800 FILE-CONTROL.                                                    00580099
005900                                                                  00590099
005910     SELECT SN-CNTL-ID-FILE                                       00591099
005920         ASSIGN TO INP01.                                         00592099
006900*                                                                 00690099
007000 DATA DIVISION.                                                   00700099
007100*                                                                 00710099
007200*                                                                 00720099
007300 FILE SECTION.                                                    00730099
007301                                                                  00730199
007310 FD  SN-CNTL-ID-FILE                                              00731099
007320     RECORDING MODE IS F                                          00732099
007330     LABEL RECORDS ARE STANDARD                                   00733099
007340     BLOCK CONTAINS 0 RECORDS                                     00734099
007350     RECORD CONTAINS 20 CHARACTERS                                00735099
007360     DATA RECORD IS SN-CNTL-ID-RECORD.                            00736099
007370                                                                  00737099
007380 01  SN-CNTL-ID-RECORD                  PIC X(20).                00738099
007760                                                                  00776099
009400 WORKING-STORAGE SECTION.                                         00940000
009600 01  PS-PROGRAM-SWITCHES.                                         00960006
009601     05  PS-END-OF-FILE-SW             PIC  X(01)    VALUE 'N'.   00960199
009602         88  PS-END-OF-FILE-YES                      VALUE 'Y'.   00960299
009603         88  PS-END-OF-FILE-NO                       VALUE 'N'.   00960399
009630 01  PV-ABEND-VARIABLES.                                          00963099
           05  PV-DISPLAY-CNTL-ID          PIC 9(9).                    00963199
009640     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.00964099
009650     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP.     00965099
009650     05  PV-INPUT-COUNTER            PIC S9(4) VALUE +0 COMP.     00965199
009650     05  PV-UPDATE-C-COUNTER         PIC S9(4) VALUE +0 COMP.     00965299
009650     05  PV-NOT-FOUND-C-COUNTER      PIC S9(4) VALUE +0 COMP.     00965399
009650     05  PV-UPDATE-H-COUNTER         PIC S9(4) VALUE +0 COMP.     00965499
009650     05  PV-NOT-FOUND-H-COUNTER      PIC S9(4) VALUE +0 COMP.     00965599
009670     05  PV-DISPLAY-COUNTER          PIC ZZZ,ZZZ,ZZ9.             00965699
009660     05  PV-SQLCODE                  PIC S9(9).                   00966099
009670     05  PV-DISPLAY-SQLCODE          PIC -------999.              00967099
009680     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SNKUP026'.  00968099
009690     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      00969099
009700     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      00970099
009800     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      00980099
009900     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      00990099
011800                                                                  01180006
011900 01  PC-PROGRAM-CONSTANTS.                                        01190006
012000     05  PC-MAX-RETRIES              PIC S9(03) VALUE +5 COMP-3.  01200006
012100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SNKUP026'. 01210099
012110     05  PC-NEG-1                    PIC S9(03) VALUE -1 COMP-3.  01211099
012200     05  PC-C                        PIC  X(01) VALUE 'C'.        01220031
012300     05  PC-H                        PIC  X(01) VALUE 'H'.        01230031
012310     05  PC-E                        PIC  X(01) VALUE 'E'.        01231031
012400     05  PC-DEFAULT-TMST             PIC  X(26) VALUE             01240006
012500                                    '0001-01-01-00.00.00.000000'. 01250006
012800                                                                  01280006
012900 01  ABEND-CODE                      PIC S9(04) VALUE +0          01290006
013000                                                COMP SYNC.        01300006
013028 01  WS-ORACLE-TRANSFER-AREA.                                     01302899
013029     05  WS-ORACLE-PO                PIC 9(8).                    01302999
013032     05  WS-ORACLE-SUPPLIER          PIC 9(10).                   01303299
013035     05  WS-ORACLE-RC                PIC 9(1).                    01303599
013036 01  WS-PO-TABLE.                                                 01303699
013037     05  WS-PO-TBL OCCURS 10000 TIMES.                            01303799
013038         10  WS-PO                   PIC 9(7).                    01303899
013039         10  WS-VEND                 PIC 9(10).                   01303999
013040         10  WS-VEND-X REDEFINES WS-VEND                          01304099
013050                                     PIC X(10).                   01305099
013100 01  PV-PROGRAM-VARIABLES.                                        01310006
013200     05  SUB                         PIC  9(7)  VALUE 0.          01320031
013201     05  SUB1                        PIC  9(7)  VALUE 0.          01320132
013202     05  SUB2                        PIC  9(7)  VALUE 0.          01320276
013203     05  SUB3                        PIC  9(7)  VALUE 0.          01320376
013204     05  WS-PO-COUNT                 PIC  9(7)  VALUE 0.          01320499
013205     05  WS-ASN-COUNT                PIC  9(7)  VALUE 0.          01320599
013206     05  WS-NUMERIC-1                PIC  S9(11) VALUE 0.         01320699
013207     05  WS-NUMERIC-2                PIC  S9(11) VALUE 0.         01320799
013208     05  WS-NUMERIC-3                PIC  S9(9) VALUE 0.          01320899
013210     05  WS-NUMERIC-4                PIC  S9(7) VALUE 0.          01321099
013214     05  WS-CURR-ELEMENT             PIC  9(7)  VALUE 0.          01321499
013215     05  WS-CURR-ASN1-OFF            PIC  9(7)  VALUE 0.          01321599
013220     05  PW-PO-NBR-N                 PIC 9(7)   VALUE 0.          01322031
013300     05  PV-PARAGRAPH                PIC  X(48) VALUE SPACES.     01330006
013400     05  PV-REC-SEQ-NBR              PIC S9(09) VALUE +0 COMP.    01340006
013500     05  PV-MSG-LENGTH               PIC S9(09) BINARY.           01350006
013510     05  WS-HOLD-ASN-HDR-ID          PIC S9(9)  VALUE 0  COMP.    01351099
013520     05  WS-HOLD-SHIPT-HDR-ID        PIC S9(9)  VALUE 0  COMP.    01352099
013600     05  PV-DATA-LENGTH              PIC S9(09) BINARY.           01360006
013700     05  PV-HOLD-COMPLETION-CODE     PIC S9(09) BINARY.           01370006
013800     05  PV-HOLD-REASON              PIC S9(09) BINARY.           01380006
013900     05  PV-HOLD-CORRELID            PIC  X(24) VALUE SPACES.     01390006
014000     05  PV-RETRY-COUNTER            PIC S9(04) VALUE +0          01400006
014100                                                COMP SYNC.        01410006
014200     05  PV-CURRENT-PRC-CNTL-TMST    PIC  X(26) VALUE SPACES.     01420006
014210     05  WS-BSN03-SHIPT-DTE.                                      01421099
014220         10  WS-BSN03-YY             PIC  X(2)  VALUE SPACES.     01422099
014230         10  WS-BSN03-MM             PIC  X(2)  VALUE SPACES.     01423099
014240         10  WS-BSN03-DD             PIC  X(2)  VALUE SPACES.     01424099
014250     05  WS-BSN03-SHIPT-DTE-REDEF.                                01425099
014251         10  WS-BSN03-REDEF-CC       PIC  X(2)  VALUE SPACES.     01425199
014252         10  WS-BSN03-REDEF-YY       PIC  X(2)  VALUE SPACES.     01425299
014253         10  FILLER                  PIC  X(1)  VALUE '-'.        01425399
014260         10  WS-BSN03-REDEF-MM       PIC  X(2)  VALUE SPACES.     01426099
014261         10  FILLER                  PIC  X(1)  VALUE '-'.        01426199
014270         10  WS-BSN03-REDEF-DD       PIC  X(2)  VALUE SPACES.     01427099
014291     05  WS-BSN04-SHIPT-TIME.                                     01429199
014292         10  WS-BSN04-HH             PIC  X(2)  VALUE SPACES.     01429299
014293         10  WS-BSN04-MM             PIC  X(2)  VALUE SPACES.     01429399
014295     05  WS-BSN04-SHIPT-TIME-REDEF.                               01429599
014296         10  WS-BSN04-REDEF-HH       PIC  X(2)  VALUE SPACES.     01429699
014297         10  FILLER                  PIC  X(1)  VALUE '.'.        01429799
014298         10  WS-BSN04-REDEF-MM       PIC  X(2)  VALUE SPACES.     01429899
014299         10  FILLER                  PIC  X(1)  VALUE '.'.        01429999
014300         10  WS-BSN04-REDEF-SS       PIC  X(2)  VALUE SPACES.     01430099
014400     05  WS-DTM02-SHIPT-DTE.                                      01440099
014500         10  WS-DTM02-YY             PIC  X(2)  VALUE SPACES.     01450099
014600         10  WS-DTM02-MM             PIC  X(2)  VALUE SPACES.     01460099
014700         10  WS-DTM02-DD             PIC  X(2)  VALUE SPACES.     01470099
014800     05  WS-DTM02-SHIPT-DTE-REDEF.                                01480099
014900         10  WS-DTM02-REDEF-CC       PIC  X(2)  VALUE SPACES.     01490099
015000         10  WS-DTM02-REDEF-YY       PIC  X(2)  VALUE SPACES.     01500099
015100         10  FILLER                  PIC  X(1)  VALUE '-'.        01510099
015200         10  WS-DTM02-REDEF-MM       PIC  X(2)  VALUE SPACES.     01520099
015300         10  FILLER                  PIC  X(1)  VALUE '-'.        01530099
015400         10  WS-DTM02-REDEF-DD       PIC  X(2)  VALUE SPACES.     01540099
015500     05  WS-DTM03-SHIPT-TIME.                                     01550099
015600         10  WS-DTM03-HH             PIC  X(2)  VALUE SPACES.     01560099
015601         10  WS-DTM03-MM             PIC  X(2)  VALUE SPACES.     01560199
015602     05  WS-DTM03-SHIPT-TIME-REDEF.                               01560299
015603         10  WS-DTM03-REDEF-HH       PIC  X(2)  VALUE SPACES.     01560399
015604         10  FILLER                  PIC  X(1)  VALUE '.'.        01560499
015605         10  WS-DTM03-REDEF-MM       PIC  X(2)  VALUE SPACES.     01560599
015606         10  FILLER                  PIC  X(1)  VALUE '.'.        01560699
015607         10  WS-DTM03-REDEF-SS       PIC  X(2)  VALUE SPACES.     01560799
015610 01  WS-NULL-INDICATORS.                                          01561099
015620     05  WS-INCHG-ID-QUAL-CDE-NULL   PIC S9(04) VALUE +0 COMP.    01562099
015630     05  WS-INCHG-SNDR-ID-NULL       PIC S9(04) VALUE +0 COMP.    01563099
015640     05  WS-ERR-ROW-ID-NULL          PIC S9(04) VALUE +0 COMP.    01564099
015650     05  WS-EQUIP-DESC-CDE-NULL      PIC S9(04) VALUE +0 COMP.    01565099
015660     05  WS-WT-QTY-NULL              PIC S9(04) VALUE +0 COMP.    01566099
015670     05  WS-RTEG-SEQ-CDE-NULL        PIC S9(04) VALUE +0 COMP.    01567099
015680     05  WS-TRANS-MTHD-TYP-CDE-NULL  PIC S9(04) VALUE +0 COMP.    01568099
015690     05  WS-RTEG-DESC-TXT-NULL       PIC S9(04) VALUE +0 COMP.    01569099
015691******************************************************************01569199
015692*  SYSTEM DATE AND TIME STORAGE AREA                              01569299
015693******************************************************************01569399
015694                                                                  01569499
015699 01  WS-TODAYS-DATE.                                              01569999
015700     05  WS-YY                           PIC 9(02)   VALUE ZEROES.01570099
015701     05  WS-MO                           PIC 9(02)   VALUE ZEROES.01570199
015702     05  WS-DD                           PIC 9(02)   VALUE ZEROES.01570299
015703                                                                  01570399
015704 01  WS-TODAYS-DATE-DB2.                                          01570499
015705     05  WS-CC-DB2                       PIC 9(02)   VALUE 19.    01570599
015706     05  WS-YY-DB2                       PIC 9(02)   VALUE ZEROES.01570699
015707     05  FILLER                          PIC X(01)   VALUE '-'.   01570799
015708     05  WS-MO-DB2                       PIC 9(02)   VALUE ZEROES.01570899
015709     05  FILLER                          PIC X(01)   VALUE '-'.   01570999
015710     05  WS-DD-DB2                       PIC 9(02)   VALUE ZEROES.01571099
015711                                                                  01571199
015712 01  WS-TODAYS-TIME.                                              01571299
015713     05  WS-HH                           PIC 9(02)   VALUE ZEROES.01571399
015714     05  WS-MM                           PIC 9(02)   VALUE ZEROES.01571499
015715     05  WS-SS                           PIC 9(02)   VALUE ZEROES.01571599
015716                                                                  01571699
015717 01  WS-PO-NUM-DIG                       PIC S9(09)  COMP.        01571799
015718                                                                  01571899
015719 01  PV-PROGRAM-VARIABLES.                                        01571999
015720     05  PV-PARAGRAPH-NAME               PIC X(30).               01572099
015721     05  PV-DB2-OPER-ATTEMPTED           PIC X(30).               01572199
015722     05  PV-COUNTER                      PIC S9(4) COMP.          01572299
015723                                                                  01572399
015724 01  PS-PROGRAM-SWITCHES.                                         01572499
015725     05  PS-ENT-ID-SW                    PIC X(01).               01572599
015726         88  PS-ENT-ID-FOUND                VALUE 'Y'.            01572699
015727         88  PS-ENT-ID-NOT-FOUND            VALUE 'N'.            01572799
015728     05  PS-MULTIPLE-ENT-ID-SW           PIC X(01).               01572899
015729         88  PS-MULTIPLE-ENT-ID             VALUE 'Y'.            01572999
015730         88  PS-SINGLE-ENT-ID               VALUE 'N'.            01573099
015731     05  PS-END-OF-FILE-SW               PIC X(01).               01573199
015732         88  PS-END-OF-FILE                 VALUE 'Y'.            01573299
015733         88  PS-NOT-END-OF-FILE             VALUE 'N'.            01573399
015734     05  PS-TP-SETUP-SW                  PIC X(01).               01573499
015735         88  PS-TP-SETUP                    VALUE 'Y'.            01573599
015736         88  PS-TP-NOT-SETUP                VALUE 'N'.            01573699
015774                                                                  01577499
015780******************************************************************01578099
015800*    REVERSE PO PARTICIPANTS                                      01580099
015900******************************************************************01590099
016000     COPY SNWS002.                                                01600099
016100******************************************************************01610099
016200*    NUMERIC EDIT ROUTINE                                         01620099
016300******************************************************************01630099
016400     COPY DPWS010I.                                               01640099
016500                                                                  01650099
016600* COMMUNICATIONS AREA FOR DB2                                     01660099
016610     EXEC SQL                                                     01661099
016620         INCLUDE SQLCA                                            01662099
016630     END-EXEC.                                                    01663099
016640                                                                  01664099
016720* DB2 TABLE DECLARATION                                           01672099
016730* (SNT_DAT_CNTL - ASN DATA TRANSFER CONTROL TABLE)                01673099
016740     EXEC SQL                                                     01674099
016750         INCLUDE SNT00000                                         01675099
016760     END-EXEC.                                                    01676099
016770                                                                  01677099
016780* DB2 TABLE DECLARATION                                           01678099
016790* (SNT_DAT_XFER - ASN DATA TRANSFER DETAIL TABLE)                 01679099
016791     EXEC SQL                                                     01679199
016792         INCLUDE SNT00001                                         01679299
016793     END-EXEC.                                                    01679399
016794                                                                  01679499
016801* DB2 TABLE DECLARATION                                           01680199
016802* (XLT_VND DOMAIN VENDOR)                                         01680299
016803     EXEC SQL                                                     01680399
016804         INCLUDE XLT00035                                         01680499
016805     END-EXEC.                                                    01680599
016806                                                                  01680699
016807* INPUT LAYOUT                                                    01680799
016810     COPY SNRD006.                                                01681099
016820                                                                  01682099
016830*  DB2 FORMATTED MESSAGE AREA.                                    01683099
016840     COPY DPWS004.                                                01684099
016850                                                                  01685099
017020     EXEC SQL                                                     01702099
017021         DECLARE CNTL CURSOR WITH HOLD FOR                        01702199
017022            SELECT DAT_XFER_CNTL_ID                               01702299
017023                 , CRE_TMST                                       01702399
017024                 , STAT_CDE                                       01702499
017025            FROM SNT_DAT_CNTL                                     01702599
017026            WHERE STAT_CDE    = 'R'  AND                          01702699
017027                  ASN_TYP_CDE = 'R'                               01702799
017029            FOR UPDATE OF STAT_CDE, END_PRC_TMST                  01702999
017030     END-EXEC.                                                    01703099
017040     EXEC SQL                                                     01704099
017050         DECLARE XFER CURSOR WITH HOLD FOR                        01705099
017060            SELECT PRC_LOD_SEQ_NBR,                               01706099
017061                   LOD_DAT_TXT                                    01706199
017070            FROM SNT_DAT_XFER                                     01707099
017080            WHERE DAT_XFER_CNTL_ID = :SNT00001-DAT-XFER-CNTL-ID   01708099
017082            ORDER BY PRC_LOD_SEQ_NBR                              01708299
017090     END-EXEC.                                                    01709099
017091     EXEC SQL                                                     01709199
017092         DECLARE PO CURSOR FOR                                    01709299
017093            SELECT DAT_CTG_CDE,                                   01709399
017094                   LOD_DAT_TXT                                    01709499
017095            FROM SNT_DAT_XFER                                     01709599
017096            WHERE DAT_XFER_CNTL_ID = :SNT00001-DAT-XFER-CNTL-ID   01709699
017098              AND DAT_CTG_CDE      = 'PRF'                        01709899
017099     END-EXEC.                                                    01709999
023000                                                                  02300025
032900 PROCEDURE DIVISION.                                              03290099
032910 0000-MAINLINE.                                                   03291099
032911                                                                  03291199
032912     PERFORM 1000-INITIALIZE.                                     03291299
032913                                                                  03291399
032924     PERFORM 2000-PROCESS-INPUT                                   03292499
032930        UNTIL PS-END-OF-FILE-YES.                                 03293099
032932                                                                  03293299
032933     PERFORM 9000-EOJ-ROUTINE.                                    03293399
032934                                                                  03293499
032935     CLOSE SN-CNTL-ID-FILE                                        03293599
032937                                                                  03293799
032970     STOP RUN.                                                    03297099
032980                                                                  03298099
033000 1000-INITIALIZE.                                                 03300099
033100     MOVE '1000-INITIALIZE'        TO PV-PARAGRAPH.               03310099
033110                                                                  03311099
033111     OPEN INPUT  SN-CNTL-ID-FILE                                  03311199
033113                                                                  03311399
033120     SET PS-END-OF-FILE-NO TO TRUE.                               03312099
033160                                                                  03316099
034565     PERFORM 8000-READ-INPUT-FILE.                                03316199
033174                                                                  03317499
033180 2000-PROCESS-INPUT.                                              03318099
033190     MOVE '2000-PROCESS-INPUT' TO PV-PARAGRAPH.                   03319099
           ADD +1 TO PV-INPUT-COUNTER                                   03319199
033191                                                                  03319299
           EVALUATE SN006-STAT-CDE                                      03319399
              WHEN PC-C                                                 03319499
                  PERFORM 3000-UPDATE-CNTL-STAT-CMPLT                   03319699
034448            PERFORM 4000-DB2-COMMIT                               03319799
              WHEN PC-H                                                 03319899
                  PERFORM 3100-UPDATE-CNTL-STAT-HOLD                    03319999
034448            PERFORM 4000-DB2-COMMIT                               03320099
              WHEN OTHER                                                03320199
                  DISPLAY '***  CONTROL ID ' SN006-DAT-XFER-CNTL-ID     03320299
                  DISPLAY '***  UNKNOWN STAT CDE ' SN006-STAT-CDE       03320399
              END-EVALUATE.                                             03320499
                                                                        03321099
034565     PERFORM 8000-READ-INPUT-FILE.                                03330099
033950                                                                  03395099
033960 3000-UPDATE-CNTL-STAT-CMPLT.                                     03396099
033970     MOVE '3000-UPDATE-CNTL-STAT-CMPLT' TO PV-PARAGRAPH.          03397099
033980                                                                  03398099
033990     EXEC SQL                                                     03399099
033991         UPDATE SNT_DAT_CNTL                                      03399199
033992            SET STAT_CDE         = :SN006-STAT-CDE,               03399299
033993                END_PRC_TMST     = CURRENT TIMESTAMP              03399399
033994          WHERE DAT_XFER_CNTL_ID = :SN006-DAT-XFER-CNTL-ID        03399499
017026            AND STAT_CDE         = 'R'                            03399599
017027            AND ASN_TYP_CDE      = 'R'                            03399699
033995     END-EXEC.                                                    03399799
033996                                                                  03399899
033997     EVALUATE TRUE                                                03399999
033998       WHEN SQLCODE = 0                                           03400099
033999           ADD +1 TO PV-UPDATE-C-COUNTER                          03400199
033998       WHEN SQLCODE = +100                                        03400299
033999           ADD +1 TO PV-NOT-FOUND-C-COUNTER                       03400399
034000       WHEN OTHER                                                 03400499
034030           MOVE '3000-UPDATE-CNTL-STAT-CMPLT'                     03403099
                                               TO PV-ABEND-PARAGRAPH    03403199
034040           MOVE 'UPDATE'                 TO PV-ABEND-OPERATION    03404099
034060           PERFORM 9100-SQL-ABEND                                 03406099
034070     END-EVALUATE.                                                03407099
034080                                                                  03408099
033960 3100-UPDATE-CNTL-STAT-HOLD.                                      03409099
033970     MOVE '3100-UPDATE-CNTL-STAT-HOLD' TO PV-PARAGRAPH.           03410099
033980                                                                  03411099
033990     EXEC SQL                                                     03412099
033991         UPDATE SNT_DAT_CNTL                                      03413099
033992            SET STAT_CDE         = :SN006-STAT-CDE                03414099
033994          WHERE DAT_XFER_CNTL_ID = :SN006-DAT-XFER-CNTL-ID        03416099
017026            AND STAT_CDE         = 'R'                            03417099
017027            AND ASN_TYP_CDE      = 'R'                            03418099
033995     END-EXEC.                                                    03419099
033996                                                                  03419199
033997     EVALUATE TRUE                                                03419299
033998       WHEN SQLCODE = 0                                           03419399
033999           ADD +1 TO PV-UPDATE-H-COUNTER                          03419499
033998       WHEN SQLCODE = +100                                        03419599
033999           ADD +1 TO PV-NOT-FOUND-H-COUNTER                       03419699
034000       WHEN OTHER                                                 03419799
034030           MOVE '3100-UPDATE-CNTL-STAT-HOLD'                      03419899
                                               TO PV-ABEND-PARAGRAPH    03419999
034040           MOVE 'UPDATE'                 TO PV-ABEND-OPERATION    03420099
034060           PERFORM 9100-SQL-ABEND                                 03420199
034070     END-EVALUATE.                                                03420299
034192                                                                  03421099
034296******************************************************************03429699
034297* COMMITTED RECORDS WILL REMAIN IN DB2 TABLES AFTER AN ABEND.     03429799
034298******************************************************************03429899
034299 4000-DB2-COMMIT.                                                 03429999
034310                                                                  03431099
034320     EXEC SQL                                                     03432099
034330         COMMIT                                                   03433099
034340     END-EXEC.                                                    03434099
034350                                                                  03435099
034360     EVALUATE TRUE                                                03436099
034370       WHEN SQLCODE = +0                                          03437099
034380           CONTINUE                                               03438099
034390       WHEN OTHER                                                 03439099
                 MOVE '4000-DB2-COMMIT'      TO PV-ABEND-PARAGRAPH      03439199
034040           MOVE 'COMMIT'               TO PV-ABEND-OPERATION      03439299
034397           PERFORM 9100-SQL-ABEND                                 03439899
034398     END-EVALUATE.                                                03439999
034399                                                                  03440099
063900 8000-READ-INPUT-FILE.                                            06390099
064600                                                                  06460099
033170     READ SN-CNTL-ID-FILE                                         06461099
033170          INTO SN006-CONTROL-RECORD                               06462099
                AT END                                                  06463099
                    SET PS-END-OF-FILE-YES TO TRUE.                     06464099
064900                                                                  06490099
065010******************************************************************06501099
065100*                   E O J   P R O C E S S I N G                  *06510099
065200******************************************************************06520099
065300 9000-EOJ-ROUTINE.                                                06530099
065400                                                                  06540099
065600     DISPLAY ' '.                                                 06560099
065700     DISPLAY '*************************************'.             06570099
065800     DISPLAY '   * SNKUP026 SUMMARY STATISTICS *    '.            06580099
065900     DISPLAY ' '.                                                 06590099
           MOVE PV-INPUT-COUNTER                  TO PV-DISPLAY-COUNTER 06600099
066900     DISPLAY ' RECORDS READ                = ' PV-DISPLAY-COUNTER 06690099
           MOVE PV-UPDATE-C-COUNTER               TO PV-DISPLAY-COUNTER 06691099
066900     DISPLAY ' ROWS UPDATED COMPLETE       = ' PV-DISPLAY-COUNTER 06692099
           MOVE PV-NOT-FOUND-C-COUNTER            TO PV-DISPLAY-COUNTER 06693099
066900     DISPLAY ' ROWS NOT FOUND FOR COMPLETE = ' PV-DISPLAY-COUNTER 06694099
           MOVE PV-UPDATE-H-COUNTER               TO PV-DISPLAY-COUNTER 06695099
066900     DISPLAY ' ROWS UPDATED HOLD           = ' PV-DISPLAY-COUNTER 06696099
           MOVE PV-NOT-FOUND-H-COUNTER            TO PV-DISPLAY-COUNTER 06697099
066900     DISPLAY ' ROWS NOT FOUND FOR HOLD     = ' PV-DISPLAY-COUNTER 06698099
067000     DISPLAY '*************************************'.             06700099
067100                                                                  06710099
133700******************************************************************13370099
133800* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      13380099
133900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 13390099
134000******************************************************************13400099
134100 9100-SQL-ABEND.                                                  13410099
134200                                                                  13420099
134210     MOVE SQLCODE    TO PV-SQLCODE.                               13421099
134220     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       13422099
134230     DISPLAY '*** DB2 ERROR ***'.                                 13423099
134240     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               13424099
134250     DISPLAY '*** PROGRAM   = SNKUP026'.                          13425099
134260     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               13426099
134270     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               13427099
134280*    DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       13428099
134290     DISPLAY '*** TABLE 1   = SNT_DAT_CNTL'.                      13429099
134291                                                                  13429199
134300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    13430099
134400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         13440099
134500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     13450099
134600* FORMAT                                                          13460099
134700     COPY DPPD004.                                                13470099
134701                                                                  13470199
134710     IF SQLCODE NOT = -911                                        13471099
134720         EXEC SQL                                                 13472099
134730             ROLLBACK                                             13473099
134740         END-EXEC                                                 13474099
134750     END-IF.                                                      13475099
134800                                                                  13480099
136300     MOVE +4013 TO ABEND-CODE.                                    13630099
136400     CALL 'ILBOABN0' USING ABEND-CODE.                            13640099
136500                                                                  13650099
136600                                                                  13660099
136700******************************************************************13670099
136800*                       END OF PROGRAM                            13680099
136900******************************************************************13690099
