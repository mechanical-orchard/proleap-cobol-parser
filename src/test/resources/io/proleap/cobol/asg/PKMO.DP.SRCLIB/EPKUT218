000100*------------------------------------------------------------     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------------------------------------------     00030000
000400 PROGRAM-ID.    EPKUT218.                                         00040001
000500 AUTHOR.        MEDHA CHOUDHURY.                                  00050000
000510 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00051000
000600 DATE-WRITTEN.  JAN 17, 2009.                                     00060000
000700                                                                  00070000
000710*-------------------------------------------------------------*   00071000
000720*    SKU FORMATTER                                            *   00072001
000730*-------------------------------------------------------------*   00073000
001020*    THIS PROGRAM WILL FORMAT THE SKU INFORMATION             *   00102001
001030*    DATA FILE FOR THE SQL SERVER STORE DATABASE TABLE,       *   00103000
001040*    AND ADD DISTRIBUTION HEADER RECORDS, AS APPROPRIATE.     *   00104000
001041*    POS 2009 FALL - PRICING INFRASTRUCTURE PROJECT WR# 35484 *   00104100
001050*                                                             *   00105000
001060*------------------------------------------------------------ *   00106000
003800*  INPUT:                                                     *   00380000
003900*        INPUT-SKU-FILE                   EPRD219             *   00390001
004000*        CC-TODAYS-DATE                   EPCC140             *   00400024
004100*        CC-TIME                          EPCC130             *   00410028
004400*                                                             *   00440000
004500*  OUTPUT:                                                    *   00450000
004600*        FORMATTED-SKU-FILE               EPRD217             *   00460001
004700*                                (FOR HEADER FORMAT)          *   00470000
004800*-------------------------------------------------------------*   00480000
004900* HISTORY LOG:                                                *   00490000
005000*                                                             *   00500000
005100*-------------------------------------------------------------*   00510000
005110* DATE: JAN 17 2009                                           *   00511023
005120* WR/IR#: WR #35484                                           *   00512023
005130* PROGRAMMER: MEDHA CHOUDHURY                                 *   00513023
005140* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00514023
005150*-------------------------------------------------------------*   00515023
005200* DATE:                                                       *   00520000
005300* WR/IR#:                                                     *   00530000
005400* PROGRAMMER:                                                 *   00540000
005500* DESCRIPTION:                                                *   00550000
005600*                                                             *   00560000
005700*-------------------------------------------------------------*   00570000
005800 ENVIRONMENT DIVISION.                                            00580000
005900*-------------------------------------------------------------*   00590000
006000 CONFIGURATION SECTION.                                           00600000
006100 SOURCE-COMPUTER. IBM-3090.                                       00610000
006200 OBJECT-COMPUTER. IBM-3090.                                       00620000
006300                                                                  00630000
006400 INPUT-OUTPUT SECTION.                                            00640000
006500                                                                  00650000
006600 FILE-CONTROL.                                                    00660000
006700                                                                  00670000
006800*  INPUT:                                                     *   00680000
006900           SELECT INPUT-SKU-FILE                                  00690001
007000             ASSIGN TO INP01.                                     00700013
008300                                                                  00830000
008310           SELECT CC-TODAYS-DATE                                  00831025
008320             ASSIGN TO INP02.                                     00832025
008330                                                                  00833025
008340           SELECT CC-TIME                                         00834028
008350             ASSIGN TO INP03.                                     00835028
008360                                                                  00836028
008400*  OUTPUT:                                                    *   00840000
008500           SELECT FORMATTED-SKU-FILE                              00850003
008600             ASSIGN TO OUT01.                                     00860013
008700                                                                  00870000
008800*-------------------------------------------------------------*   00880000
008900 DATA DIVISION.                                                   00890000
009000*----------------------------------------------------------       00900000
009100 FILE SECTION.                                                    00910000
009200                                                                  00920000
009300 FD  INPUT-SKU-FILE                                               00930001
009400     RECORDING MODE IS F                                          00940000
009500     LABEL RECORDS ARE STANDARD                                   00950000
009600     RECORD CONTAINS 170 CHARACTERS                               00960005
009700     BLOCK CONTAINS 0 RECORDS                                     00970000
009800     DATA RECORD IS INPUT-SKU-RECORD.                             00980001
009900                                                                  00990000
010000 01  INPUT-SKU-RECORD             PIC X(170).                     01000005
010100                                                                  01010000
010200 FD  CC-TODAYS-DATE                                               01020024
010300     RECORDING MODE IS F                                          01030024
010400     BLOCK CONTAINS 0 RECORDS                                     01040024
010500     LABEL RECORDS ARE STANDARD.                                  01050024
010600                                                                  01060024
010700 01  CC-TODAYS-DATE-RECORD        PIC X(80).                      01070024
010800                                                                  01080024
010900 FD  CC-TIME                                                      01090028
011000     RECORDING MODE IS F                                          01100028
011100     BLOCK CONTAINS 0 RECORDS                                     01110028
011200     LABEL RECORDS ARE STANDARD.                                  01120028
011300                                                                  01130028
011400 01  CC-TIME-RECORD  PIC X(80).                                   01140028
011500                                                                  01150028
013800 FD  FORMATTED-SKU-FILE                                           01380003
013900     RECORDING MODE IS V                                          01390000
014000     RECORD IS VARYING IN SIZE                                    01400000
014100     FROM 1 TO 200 CHARACTERS                                     01410013
014200     DEPENDING ON PV-BYTE-COUNT                                   01420000
014300     LABEL RECORDS ARE STANDARD                                   01430000
014400     DATA RECORD IS FORMATTED-SKU-RECORD.                         01440003
014500                                                                  01450000
014600 01  FORMATTED-SKU-RECORD.                                        01460003
014700     05  FORM-SKU-FLD                  PIC X(01)                  01470001
014800         OCCURS 200 TIMES                                         01480013
014900              INDEXED BY                                          01490000
015000              FORM-SKU-LEN.                                       01500001
015100                                                                  01510000
015200*----------------------------------------------------------       01520000
015300 WORKING-STORAGE SECTION.                                         01530000
015400                                                                  01540000
015500 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01550000
015600                                                  COMP SYNC.      01560000
015700     88  AC-INPUT-CONTROL-CARD-ERROR              VALUE +4003.    01570000
016100                                                                  01610000
016200*----------------------------------------------------------       01620000
016300* PC- PROGRAM CONSTANTS                                           01630000
016400*----------------------------------------------------------       01640000
016500 01  PC-PROGRAM-CONSTANTS.                                        01650000
016600     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT218'. 01660001
016900     05  PC-CSV-DELIMITER             PIC X(01) VALUE '|'.        01690000
017000     05  PC-NULL-VALUE                PIC X(01) VALUE '~'.        01700000
017100     05  PC-UNDER-SCORE               PIC X(01) VALUE '_'.        01710000
017300     05  PC-ONE-SPACE                 PIC X(01) VALUE ' '.        01730000
017400     05  PC-ONE-ZERO                  PIC X(01) VALUE '0'.        01740000
017500     05  PC-TIME-START                PIC X(08) VALUE '00:00:01'. 01750000
017600     05  PC-TIME-END                  PIC X(08) VALUE '23:59:59'. 01760000
017700     05  PC-STORE-SPECIFIC-GRP        PIC X(05) VALUE '05000'.    01770000
017800     05  PC-FIVE-ZERO                 PIC X(05) VALUE '00000'.    01780000
017900     05  PC-HDR-IND                   PIC X(03) VALUE 'HDR'.      01790000
018100                                                                  01810000
018110*----------------------------------------------------------       01811028
018120* TIME                                                            01812028
018130*----------------------------------------------------------       01813028
018140 01  PC-TIME.                                                     01814028
018150     05  PC-TIME-HHMM                 PIC X(04).                  01815028
018160     05  PC-TIME-SS                   PIC X(02).                  01816028
018200*----------------------------------------------------------       01820000
018300* PV- PROGRAM VARIABLES                                           01830000
018400*----------------------------------------------------------       01840000
018500 01  PV-PROGRAM-STATUS.                                           01850000
018600     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.     01860000
018700     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     01870000
018800     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     01880000
019100*                                                                 01910000
019200 01  PV-PROGRAM-VARIABLES.                                        01920000
019300     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01930000
019400     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      01940000
019700     05  PV-SPACE                     PIC  X(01).                 01970000
019900                                                                  01990000
020000     05  PV-VARIABLE-OUTPUT-FIELD.                                02000000
020100         10  PV-BIT-VARIABLE          PIC X(01)                   02010000
020200                                          VALUE SPACES            02020000
020300                                          OCCURS 12 TIMES         02030006
020400                                          INDEXED BY              02040000
020500                                          PV-BIT-IDX              02050000
020700                                          PV-EOF-IDX.             02070000
020800                                                                  02080000
020900     05  PV-VARIABLE-CHAR-FIELD.                                  02090006
021000         10  PV-BIT-CHR-VARIABLE      PIC X(01)                   02100006
021100                                          VALUE SPACES            02110006
021200                                          OCCURS 30 TIMES         02120006
021300                                          INDEXED BY              02130006
021400                                          PV-CHR-BIT-IDX          02140006
021500                                          PV-CHR-EOF-IDX.         02150006
021600                                                                  02160006
024210     05  PV-HEADER-TMST.                                          02421028
024220         10  PV-HDR-BATCH-DT          PIC X(08).                  02422028
024230         10  PV-HDR-BATCH-TIME        PIC X(06).                  02423028
024240                                                                  02424028
025100     05  PV-FORMAT-HDR-DIST-DTE.                                  02510000
025200         10  PV-FORMAT-YYYY           PIC X(04).                  02520000
025300         10  PV-FORMAT-MM             PIC X(02).                  02530000
025400         10  PV-FORMAT-DD             PIC X(02).                  02540000
025500                                                                  02550000
026500     05  PV-PLU-FILE-DIST-DTE.                                    02650027
026600         10  PV-FILE-D-YYYY           PIC X(04).                  02660027
026700         10  PV-FILE-D-DASH-1         PIC X(01) VALUE '-'.        02670027
026800         10  PV-FILE-D-MM             PIC X(02).                  02680027
026900         10  PV-FILE-D-DASH-2         PIC X(01) VALUE '-'.        02690027
027000         10  PV-FILE-D-DD             PIC X(02).                  02700027
027300                                                                  02730000
027310     05  PV-STR-GRP-TYP-CDE           PIC 9(05) VALUE ZERO.       02731000
027320     05  PV-STR-GRP-ID-GRP.                                       02732000
027321         10  PV-FIRST-BYTES           PIC 9(05) VALUE ZERO.       02732100
027330         10  PV-STR-GRP-ID            PIC 9(05) VALUE ZERO.       02733000
027340     05  PV-FILE-TYPE                 PIC X(03) VALUE SPACES.     02734016
027350                                                                  02735000
027920 01  PV-TIME-CALC                     PIC 9(06).                  02792028
027930                                                                  02793028
027940 01  PV-TIME.                                                     02794028
027950     05  PV-TIME-HH                   PIC 9(02).                  02795028
027960     05  PV-TIME-MM                   PIC 9(02).                  02796028
027970     05  PV-TIME-SS                   PIC 9(02).                  02797028
027980                                                                  02798028
028000*----------------------------------------------------------       02800000
028100* PV- PROGRAM COUNT VARIABLES                                     02810000
028200*----------------------------------------------------------       02820000
028300 01  PV-PROGRAM-COUNTERS.                                         02830000
028400     05  PV-DATA-REC-WRITEN           PIC 9(09) VALUE 0.          02840000
028410     05  PV-HDR-REC-WRITEN            PIC 9(09) VALUE 0.          02841000
028500     05  PV-RECORDS-READ              PIC 9(09) VALUE 0.          02850000
028600     05  PV-PIPE-COUNT                PIC 9(04) VALUE 0.          02860003
029100                                                                  02910000
031300*----------------------------------------------------------------*03130000
031400* PS- PROGRAM SWITCHES                                           *03140000
031500*----------------------------------------------------------------*03150000
031600 01  PS-PROGRAM-SWITCHES.                                         03160000
031700     05  PS-END-OF-SKU-SW             PIC  X(01) VALUE 'N'.       03170001
031800         88  PS-END-OF-SKU-FILE                  VALUE 'Y'.       03180001
031900         88  PS-NOT-END-SKU-FILE                 VALUE 'N'.       03190001
033200     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       03320000
033300         88  PS-END-OF-PROCESSING                VALUE 'Y'.       03330000
033400         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       03340000
033500     05  PS-READY-TRACE-SW            PIC  X(01) VALUE 'N'.       03350000
033600         88 PS-READY-TRACE                       VALUE 'Y'.       03360000
033700         88 PS-RESET-TRACE                       VALUE 'N'.       03370000
033710     05  PS-END-OF-TODAYS-DATE-SW     PIC X(01)  VALUE 'N'.       03371026
033720         88  PS-END-OF-TODAYS-DATE-FILE          VALUE 'Y'.       03372026
033730     05  PS-END-OF-TOMORR-DATE-SW     PIC X(01)  VALUE 'N'.       03373026
033740         88  PS-END-OF-TOMORR-DATE-FILE          VALUE 'Y'.       03374026
033741     05  PS-END-OF-TIME-SW            PIC X(01)  VALUE 'N'.       03374128
033742         88  PS-END-OF-TIME-FILE                 VALUE 'Y'.       03374228
033750                                                                  03375026
037400*----------------------------------------------------------       03740000
037500* COPYBOOK  EPRD217 HOLDS THE HEADER LAYOUT                       03750032
037600*----------------------------------------------------------       03760000
037700     COPY EPRD217.                                                03770000
037800                                                                  03780000
037900*----------------------------------------------------------       03790000
038000* COPYBOOK  EPRD219 - USED TO READ THE INPUT FILE (XST_SKU LAYOUT)03800032
038100*----------------------------------------------------------       03810000
038200     COPY EPRD219.                                                03820001
038400                                                                  03840024
038500*----------------------------------------------------------       03850024
038600* TODAYS DATE - BASED ON DAY THE JOB WAS SCHEDULED TO RUN         03860024
038700*----------------------------------------------------------       03870024
038800     COPY EPWS140.                                                03880024
038900                                                                  03890024
039000*----------------------------------------------------------       03900028
039100* CC-TIME - COPYBOOK USED TO READ THE TIME CONTROL CARD           03910028
039200*----------------------------------------------------------       03920028
039300     COPY EPRD130.                                                03930028
039400                                                                  03940028
042200*----------------------------------------------------------       04220000
042300 PROCEDURE DIVISION.                                              04230000
042400*----------------------------------------------------------       04240000
042500 0000-MAINLINE.                                                   04250000
042600                                                                  04260000
042700     PERFORM 1000-INITIALIZATION.                                 04270000
042800                                                                  04280000
042900     PERFORM 2000-PROCESS-SKU                                     04290015
043000             UNTIL PS-END-OF-PROCESSING.                          04300000
043100                                                                  04310000
043200     PERFORM 9200-WRAPUP.                                         04320000
043300                                                                  04330000
043400     GOBACK.                                                      04340000
043500                                                                  04350000
043600*0000-EXIT.                                                       04360000
043800                                                                  04380000
043900*----------------------------------------------------------       04390000
044000* 1000-INITIALIZATION.                                            04400000
044100*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           04410000
044200*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      04420000
044300*     FILES.                                                      04430000
044400*----------------------------------------------------------       04440000
044500 1000-INITIALIZATION.                                             04450000
044600                                                                  04460000
044700     DISPLAY '****************************************'.          04470000
044800     DISPLAY '**          EPKUT218 STARTED          **'.          04480001
044900     DISPLAY '****************************************'.          04490000
045000                                                                  04500000
045100     INITIALIZE PV-PROGRAM-VARIABLES.                             04510000
045200                                                                  04520000
045700     SET PS-NOT-END-SKU-FILE      TO TRUE.                        04570001
046200                                                                  04620000
046300     PERFORM 1100-OPEN-FILES.                                     04630000
046400                                                                  04640000
046620     PERFORM 1300-READ-TODAYS-DATE.                               04662024
046630                                                                  04663024
046640     PERFORM 1400-READ-TIME-CC.                                   04664028
046650                                                                  04665028
046700     PERFORM 6000-READ-SKU-FILE.                                  04670003
046800                                                                  04680000
047800     IF PS-END-OF-SKU-FILE                                        04780001
047900        DISPLAY '***    SKU EXTRACT FILE IS EMPTY    ****'        04790001
047910        SET PS-END-OF-PROCESSING TO TRUE                          04791000
048200     END-IF.                                                      04820000
048300                                                                  04830000
050900                                                                  05090000
051000*1000-EXIT.                                                       05100000
051200                                                                  05120000
051300*----------------------------------------------------------       05130000
051400* 1100-OPEN-FILES.                                                05140000
051500*     THIS PARAGRAPH OPENS ALL THE FILES IN MODE REQUIRED         05150000
051600*----------------------------------------------------------       05160000
051700 1100-OPEN-FILES.                                                 05170000
051800                                                                  05180000
051900     OPEN INPUT INPUT-SKU-FILE                                    05190024
052000                CC-TIME                                           05200029
052100                CC-TODAYS-DATE.                                   05210029
052500                                                                  05250000
052600     OPEN OUTPUT FORMATTED-SKU-FILE.                              05260003
052700                                                                  05270000
052800*1100-EXIT.                                                       05280000
053000                                                                  05300000
063120*----------------------------------------------------------       06312024
063130* 1300-READ-TODAYS-DATE.                                          06313024
063140*     THIS PARAGRAPH GETS THE DB2 TIMESTAMP WHICH WILL BE         06314024
063150*     USED TO UPDATE THE CRT-TIMESTAMP ON THE HEADER RECORD       06315024
063160*----------------------------------------------------------       06316024
063170 1300-READ-TODAYS-DATE.                                           06317024
063180                                                                  06318024
063190     READ CC-TODAYS-DATE INTO CC-EPCC140-CONTROL-CARD             06319024
063191         AT END                                                   06319124
063192             SET PS-END-OF-TODAYS-DATE-FILE TO TRUE.              06319224
063193                                                                  06319324
063194     DISPLAY '    '                                               06319424
063195     DISPLAY '   TODAYS DATE CONTROL CARD   '.                    06319524
063196     DISPLAY CC-EPCC140-CONTROL-CARD-DISPLY.                      06319624
063197     DISPLAY '  '.                                                06319724
063198                                                                  06319824
063199     IF PS-END-OF-TODAYS-DATE-FILE                                06319924
063200         MOVE '1300-READ-TODAYS-DATE'  TO PV-PARAGRAPH-NAME       06320024
063201         MOVE 'EMPTY TODAYS DATE CC '   TO PV-OPERATION-MSG-1     06320124
063202         SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                  06320224
063203         PERFORM 9910-ABEND                                       06320324
063204     END-IF.                                                      06320424
063205                                                                  06320524
063206*                                                                 06320624
063207*-- CONVERT FORMAT OF DATE FROM CCYY-MM-DD TO CCYYMMDD            06320724
063208*                                                                 06320824
063209     MOVE CC-EPCC140-TODAY-DATE  TO PV-PLU-FILE-DIST-DTE.         06320927
063210                                                                  06321024
063211     MOVE PV-FILE-D-YYYY       TO PV-FORMAT-YYYY.                 06321127
063212     MOVE PV-FILE-D-MM         TO PV-FORMAT-MM.                   06321227
063213     MOVE PV-FILE-D-DD         TO PV-FORMAT-DD.                   06321327
063214                                                                  06321424
063215*1300-EXIT.                                                       06321524
063217                                                                  06321724
063218******************************************************************06321828
063219* 1400-READ-TIME-CC                                               06321928
063220******************************************************************06322028
063221                                                                  06322128
063222 1400-READ-TIME-CC.                                               06322228
063223                                                                  06322328
063224     READ CC-TIME INTO EP130-CC-CONTROL-CARD                      06322428
063225         AT END                                                   06322528
063226             SET PS-END-OF-TIME-FILE TO TRUE.                     06322628
063227                                                                  06322728
063228     DISPLAY '----------------------------------------'.          06322828
063229     DISPLAY EP130-CC-CONTROL-CARD-DISPLY.                        06322928
063230     DISPLAY '----------------------------------------'.          06323028
063231                                                                  06323128
063232     IF PS-END-OF-TIME-FILE                                       06323228
063233         MOVE '1400-READ-TIME-CC    '  TO PV-PARAGRAPH-NAME       06323328
063234         MOVE 'EMPTY TIME CC        '   TO PV-OPERATION-MSG-1     06323428
063235         SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                  06323528
063236         PERFORM 9910-ABEND                                       06323628
063237     ELSE                                                         06323728
063238         MOVE EP130-CC-FIRST-HEADER-TIME TO PC-TIME               06323828
063239                                            PV-TIME-CALC          06323928
063240     END-IF.                                                      06324028
063241                                                                  06324128
063242                                                                  06324228
063243     CLOSE CC-TIME.                                               06324328
063244                                                                  06324428
063245*1400-EXIT.                                                       06324528
063247                                                                  06324728
063250*----------------------------------------------------------       06325000
063300* 2000-PROCESS-SKU.                                               06330015
063400* ----------------------------                                    06340000
063500* THE PARAGRAPH WILL PERFORM THE FOLLOWING                        06350000
063800*                                                                 06380000
063900* (1) CREATE HEADER RECORD IF THE PREVIOUS STORE INFORMATION IS   06390000
064000*     DIFFERENT FROM THE CURRENT.                                 06400000
064200*                                                                 06420000
064300* (2) FORMAT THE DATA RECORD                                      06430000
065800*                                                                 06580000
065900*----------------------------------------------------------       06590000
066000 2000-PROCESS-SKU.                                                06600015
066100                                                                  06610000
066110**-- FORMAT HEADER RECORD                                         06611000
066120                                                                  06612027
066130     PERFORM 2050-CHECK-IF-HEADERS-NEEDED.                        06613027
066140                                                                  06614027
066700**-- INITIALIZE VARIABLES FOR DETAIL RECORD                       06670000
066710                                                                  06671000
066711     SET FORM-SKU-LEN TO +1.                                      06671101
066712     MOVE 0 TO PV-BYTE-COUNT.                                     06671200
066713     INITIALIZE FORMATTED-SKU-RECORD.                             06671303
066714                                                                  06671400
066720**-- FORMAT DETAIL RECORD                                         06672000
067000                                                                  06700000
067010     PERFORM 2300-FORMAT-DETAIL-REC.                              06701002
070219                                                                  07021900
070220     PERFORM 6000-READ-SKU-FILE.                                  07022003
070221                                                                  07022100
070222     IF PS-END-OF-SKU-FILE                                        07022201
070223        SET PS-END-OF-PROCESSING TO TRUE                          07022300
070224     END-IF.                                                      07022400
070225                                                                  07022500
070230*2000-EXIT.                                                       07023000
094500                                                                  09450000
094501******************************************************************09450127
094502* 2050-CHECK-IF-HEADERS-NEEDED.                                   09450227
094503*     DETERMINE IF A HEADER RECORD NEED TO BE WRITTEN TO OUTPUT   09450327
094504*     FILE                                                        09450427
094505******************************************************************09450527
094506 2050-CHECK-IF-HEADERS-NEEDED.                                    09450627
094507                                                                  09450727
094508     IF EP219-STR-GRP-TYP-CDE NOT = PV-STR-GRP-TYP-CDE            09450827
094509      OR EP219-STR-GRP-ID NOT = PV-STR-GRP-ID-GRP                 09450927
094510      OR EP219-FILE-ACT-TYP  NOT = PV-FILE-TYPE                   09451027
094512        PERFORM 2100-FORMAT-AND-WRITE-HDR                         09451227
094513     END-IF.                                                      09451327
094514                                                                  09451427
094515*2050-EXIT.                                                       09451527
094530                                                                  09453027
094600*-----------------------------------------------------------------09460000
094700* 2100-FORMAT-AND-WRITE-HDR                                       09470000
094800*  THIS PARAGRAPH MOVES APPROPRIATE VALUES TO THE EPRD200 COPYBOOK09480000
094900*  LAYOUT (BEFORE WRITING OUT THE HEADER RECORD)                  09490000
095000*----------------------------------------------------------------*09500000
095100 2100-FORMAT-AND-WRITE-HDR.                                       09510000
095200                                                                  09520000
095210     MOVE EP219-STR-GRP-TYP-CDE  TO PV-STR-GRP-TYP-CDE.           09521001
095220     MOVE EP219-STR-GRP-ID       TO PV-STR-GRP-ID-GRP.            09522001
095221     MOVE EP219-FILE-ACT-TYP     TO PV-FILE-TYPE.                 09522116
095230                                                                  09523000
095300     MOVE PC-HDR-IND             TO EP217-HDR-INDICATOR.          09530000
095400     MOVE EP219-STR-GRP-TYP-CDE  TO EP217-STR-GRP-TYP.            09540001
095410     MOVE EP219-STR-GRP-ID       TO EP217-STR-GRP-ID.             09541001
095700     MOVE PC-FIVE-ZERO           TO EP217-EXCO-STR-NBR.           09570000
095800     MOVE PV-FORMAT-HDR-DIST-DTE TO EP217-FILE-DIST-DATE.         09580000
095900     SET EP217-FILE-PRICING      TO TRUE.                         09590000
096000     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-1.           09600000
096010     SET EP217-XST-SKU           TO TRUE.                         09601000
096100     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-2.           09610000
096200     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-3.           09620000
096300     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-4.           09630000
096400     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-5.           09640000
096500     MOVE EP219-FILE-ACT-TYP     TO EP217-FILE-NAME-TYPE.         09650001
096501                                                                  09650100
096510     IF EP219-STR-GRP-TYP-CDE = PC-STORE-SPECIFIC-GRP             09651001
096520         MOVE PV-STR-GRP-ID          TO EP217-STORE-NBR           09652000
096530     ELSE                                                         09653000
096600         MOVE PC-FIVE-ZERO           TO EP217-STORE-NBR           09660000
096610     END-IF.                                                      09661000
096620                                                                  09662000
096630     MOVE PV-FORMAT-HDR-DIST-DTE TO PV-HDR-BATCH-DT.              09663028
096640     MOVE PV-TIME-CALC           TO PV-HDR-BATCH-TIME.            09664028
096650                                                                  09665028
096700     MOVE PV-HEADER-TMST         TO EP217-CRT-TIMESTAMP.          09670000
096800     MOVE EP219-APPLY-IND        TO EP217-FILE-TYPE-APPLY.        09680003
096900                                                                  09690000
097000     PERFORM 2200-WRITE-HDR-RECORD.                               09700000
097100                                                                  09710000
097200*2100-EXIT.                                                       09720000
097400                                                                  09740000
097500*-----------------------------------------------------------------09750000
097600* 2200-WRITE-HDR-RECORD                                           09760000
097700*  THIS PARAGRAPH WILL WRITE THE HEADER RECORD TO THE O/P FILE    09770000
097800*-----------------------------------------------------------------09780000
097900 2200-WRITE-HDR-RECORD.                                           09790000
098000                                                                  09800000
098110     PERFORM 5100-CALC-TIME.                                      09811028
098200                                                                  09820000
098300     MOVE 64                                                      09830000
098400       TO PV-BYTE-COUNT.                                          09840000
098500     WRITE FORMATTED-SKU-RECORD                                   09850003
098600       FROM EP217-HEADER-RECORD.                                  09860000
098700                                                                  09870000
098710     ADD 1 TO PV-HDR-REC-WRITEN.                                  09871000
098720                                                                  09872000
098800*2200-EXIT.                                                       09880000
098901                                                                  09890102
098902*-----------------------------------------------------------------09890202
098903* 2300-FORMAT-DETAIL-REC                                          09890302
098904*  THIS PARAGRAPH WILL MOVE TRIGGER TYPE TO OUTPUT FILE VARIABLE  09890402
098905*----------------------------------------------------------------*09890502
098906 2300-FORMAT-DETAIL-REC.                                          09890602
098907                                                                  09890702
098908     PERFORM 2600-MOVE-DELIMITER.                                 09890802
098909     PERFORM 2400-MOVE-TRIGGER-TYPE.                              09890902
098910                                                                  09891002
098911     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09891102
098912     INITIALIZE PV-TALLY.                                         09891202
098913                                                                  09891302
098914**----  MOVE SKU-NBR ------------- NOT NULL ---------------**     09891403
098915                                                                  09891502
098916     IF EP219-SKU-NBR-IND = 'Y'                                   09891602
098917        EVALUATE TRUE                                             09891718
098918            WHEN EP219-SKU-NBR = ZEROES                           09891818
098919               PERFORM 3000-MOVE-ZERO                             09891918
098920            WHEN OTHER                                            09892018
098922               INSPECT EP219-SKU-NBR       TALLYING PV-TALLY      09892218
098923                   FOR LEADING ZEROES                             09892318
098924               SET PV-BIT-IDX TO PV-TALLY                         09892418
098925               SET PV-BIT-IDX UP BY +1                            09892518
098926                                                                  09892618
098927               MOVE EP219-SKU-NBR  TO PV-VARIABLE-OUTPUT-FIELD    09892718
098928                                                                  09892818
098929               PERFORM 2500-NUM-FIELD-MOVER VARYING PV-EOF-IDX    09892918
098930                  FROM PV-BIT-IDX  BY 1                           09893018
098931                  UNTIL PV-EOF-IDX > 8                            09893118
098932        END-EVALUATE                                              09893218
098933     END-IF.                                                      09893302
098934                                                                  09893402
098935     PERFORM 2600-MOVE-DELIMITER.                                 09893502
098936                                                                  09893602
098937**----  MOVE UPC-ID  ------------- NOT NULL ---------------**     09893703
098938     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09893802
098939     INITIALIZE PV-TALLY.                                         09893902
098940                                                                  09894002
098941     IF EP219-INTR-UPC-ID-IND = 'Y'                               09894102
098942        EVALUATE TRUE                                             09894218
098943            WHEN EP219-INTR-UPC-ID = ZERO                         09894318
098944               PERFORM 3000-MOVE-ZERO                             09894418
098945            WHEN OTHER                                            09894518
098947               INSPECT EP219-INTR-UPC-ID     TALLYING PV-TALLY    09894718
098948                   FOR LEADING ZEROES                             09894818
098949                                                                  09894918
098950               SET PV-BIT-IDX TO PV-TALLY                         09895018
098951               SET PV-BIT-IDX UP BY +1                            09895118
098952                                                                  09895218
098953               MOVE EP219-INTR-UPC-ID TO PV-VARIABLE-OUTPUT-FIELD 09895318
098954                                                                  09895418
098955               PERFORM 2500-NUM-FIELD-MOVER VARYING PV-EOF-IDX    09895518
098956                  FROM PV-BIT-IDX  BY 1                           09895618
098957                  UNTIL PV-EOF-IDX > 12                           09895718
098958        END-EVALUATE                                              09895818
098959     END-IF.                                                      09895902
098960                                                                  09896002
098961     PERFORM 2600-MOVE-DELIMITER.                                 09896102
098962                                                                  09896202
098963**----  MOVE SKU DESCRIPTION------ NOT NULL ---------------**     09896303
098964                                                                  09896403
098965     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09896506
098966     INITIALIZE PV-TALLY.                                         09896602
098967                                                                  09896702
098968     IF EP219-SKU-DESC-IND = 'Y'                                  09896802
098969        EVALUATE TRUE                                             09896918
098970            WHEN EP219-SKU-DESC = SPACES                          09897018
098971               PERFORM 3100-MOVE-SPACE                            09897118
098972            WHEN OTHER                                            09897218
098973               MOVE EP219-SKU-DESC  TO PV-VARIABLE-CHAR-FIELD     09897318
098974                                                                  09897418
098975               PERFORM 2800-FIND-DATA-END                         09897518
098976                 VARYING PV-CHR-EOF-IDX                           09897618
098977                    FROM 30 BY -1                                 09897718
098978                    UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)     09897818
098979                                                    NOT = SPACE   09897918
098980                                                                  09898018
098981               PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX09898118
098982                  FROM 1  BY 1                                    09898218
098983                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           09898318
098984        END-EVALUATE                                              09898418
098985     END-IF.                                                      09898518
098986                                                                  09898618
098987     PERFORM 2600-MOVE-DELIMITER.                                 09898718
098988                                                                  09898818
098989**----  MOVE WEB ITEM INDICATOR -- NOT NULL ---------------**     09898918
098990                                                                  09899018
098991     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09899118
098992     INITIALIZE PV-TALLY.                                         09899218
098993                                                                  09899318
098994     IF EP219-E-BUS-ITM-IND-YES                                   09899418
098995        MOVE EP219-E-BUS-ITM-IND  TO PV-VARIABLE-CHAR-FIELD       09899518
098996                                                                  09899618
098997        PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX       09899718
098998           FROM 1  BY 1                                           09899818
098999           UNTIL PV-CHR-BIT-IDX > 1                               09899918
099000                                                                  09900018
099001     END-IF.                                                      09900118
099002                                                                  09900218
099003     PERFORM 2600-MOVE-DELIMITER.                                 09900318
099004                                                                  09900418
099005**----  MOVE BUS-PRD-GP-NBR ------ NOT NULL ---------------**     09900518
099006                                                                  09900618
099007     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09900718
099008     INITIALIZE PV-TALLY.                                         09900818
099009                                                                  09900918
099010     IF EP219-E-BUS-PRD-GP-NBR-YES                                09901018
099011        EVALUATE TRUE                                             09901118
099012            WHEN EP219-E-BUS-PRD-GP-NBR = ZEROES                  09901218
099013               PERFORM 3000-MOVE-ZERO                             09901318
099014            WHEN OTHER                                            09901418
099017               INSPECT EP219-E-BUS-PRD-GP-NBR   TALLYING PV-TALLY 09901718
099018                   FOR LEADING ZEROES                             09901818
099019               SET PV-BIT-IDX TO PV-TALLY                         09901918
099020               SET PV-BIT-IDX UP BY +1                            09902018
099021                                                                  09902118
099022               MOVE EP219-E-BUS-PRD-GP-NBR   TO                   09902218
099023                                      PV-VARIABLE-OUTPUT-FIELD    09902318
099024                                                                  09902418
099025               PERFORM 2500-NUM-FIELD-MOVER VARYING PV-EOF-IDX    09902518
099026                  FROM PV-BIT-IDX  BY 1                           09902618
099027                  UNTIL PV-EOF-IDX > 8                            09902718
099028        END-EVALUATE                                              09902818
099029     END-IF.                                                      09902918
099030                                                                  09903018
099031     PERFORM 2600-MOVE-DELIMITER.                                 09903118
099032                                                                  09903218
099033**----  MOVE NRF-COLOR-DESCRPTN--- NOT NULL ---------------**     09903318
099034                                                                  09903418
099035     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09903518
099036     INITIALIZE PV-TALLY.                                         09903618
099037                                                                  09903718
099038     IF EP219-NRF-CLOR-DESC-YES                                   09903818
099039        EVALUATE TRUE                                             09903918
099040            WHEN EP219-NRF-CLOR-DESC = SPACES                     09904018
099041               PERFORM 3100-MOVE-SPACE                            09904118
099042            WHEN OTHER                                            09904218
099043               MOVE EP219-NRF-CLOR-DESC TO PV-VARIABLE-CHAR-FIELD 09904318
099044                                                                  09904418
099045               PERFORM 2800-FIND-DATA-END                         09904518
099046                 VARYING PV-CHR-EOF-IDX                           09904618
099047                    FROM 10 BY -1                                 09904718
099048                    UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)     09904818
099049                                                   NOT = SPACE    09904918
099050                                                                  09905018
099051               PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX09905118
099052                  FROM 1  BY 1                                    09905218
099053                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           09905318
099054        END-EVALUATE                                              09905418
099055     END-IF.                                                      09905518
099056                                                                  09905618
099057     PERFORM 2600-MOVE-DELIMITER.                                 09905718
099058                                                                  09905818
099059**----  MOVE SIZE DESCRIPTION ---- NOT NULL ---------------**     09905918
099060                                                                  09906018
099061     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09906118
099062     INITIALIZE PV-TALLY.                                         09906218
099063                                                                  09906318
099064     IF EP219-SIZE-DESC-YES                                       09906418
099065        EVALUATE TRUE                                             09906518
099066            WHEN EP219-SIZE-DESC = SPACES                         09906618
099067               PERFORM 3100-MOVE-SPACE                            09906719
099068            WHEN OTHER                                            09906818
099069               MOVE EP219-SIZE-DESC TO PV-VARIABLE-CHAR-FIELD     09906918
099070                                                                  09907018
099071               PERFORM 2800-FIND-DATA-END                         09907118
099072                 VARYING PV-CHR-EOF-IDX                           09907218
099073                    FROM 10 BY -1                                 09907318
099074                    UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)     09907418
099075                                                    NOT = SPACE   09907518
099076                                                                  09907618
099077               PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX09907718
099078                  FROM 1  BY 1                                    09907818
099079                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           09907918
099080        END-EVALUATE                                              09908018
099081     END-IF.                                                      09908118
099082                                                                  09908218
099083     PERFORM 2600-MOVE-DELIMITER.                                 09908318
099084                                                                  09908418
099085**----  MOVE TAX PRODUCT CDE ----- NOT NULL ---------------**     09908518
099086                                                                  09908618
099087     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09908718
099088     INITIALIZE PV-TALLY.                                         09908818
099089                                                                  09908918
099090     IF EP219-TAX-PRD-CDE-YES                                     09909018
099091        EVALUATE TRUE                                             09909118
099092            WHEN EP219-TAX-PRD-CDE = SPACES                       09909218
099093               PERFORM 3100-MOVE-SPACE                            09909318
099094            WHEN OTHER                                            09909418
099095               MOVE EP219-TAX-PRD-CDE TO PV-VARIABLE-CHAR-FIELD   09909518
099096                                                                  09909618
099097               PERFORM 2800-FIND-DATA-END                         09909718
099098                 VARYING PV-CHR-EOF-IDX                           09909818
099099                    FROM 5 BY -1                                  09909918
099100                    UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)     09910018
099101                                                      NOT = SPACE 09910118
099102                                                                  09910218
099103               PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX09910318
099104                  FROM 1  BY 1                                    09910418
099105                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           09910518
099106        END-EVALUATE                                              09910618
099107     END-IF.                                                      09910718
099108                                                                  09910818
099109     PERFORM 2600-MOVE-DELIMITER.                                 09910918
099110                                                                  09911018
099111**----  MOVE MERCH TAX CDE ------- NOT NULL ---------------**     09911118
099112                                                                  09911218
099113     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09911318
099114     INITIALIZE PV-TALLY.                                         09911418
099115                                                                  09911518
099116     IF EP219-MDSE-TX-CDE-YES                                     09911618
099117        EVALUATE TRUE                                             09911718
099118            WHEN EP219-MDSE-TX-CDE = SPACES                       09911818
099119               PERFORM 3100-MOVE-SPACE                            09911918
099120            WHEN OTHER                                            09912018
099121               MOVE EP219-MDSE-TX-CDE TO PV-VARIABLE-CHAR-FIELD   09912118
099122                                                                  09912218
099123               PERFORM 2800-FIND-DATA-END                         09912318
099124                 VARYING PV-CHR-EOF-IDX                           09912418
099125                    FROM 2 BY -1                                  09912518
099126                    UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)     09912618
099127                                                   NOT = SPACE    09912718
099128                                                                  09912818
099129               PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX09912918
099130                  FROM 1  BY 1                                    09913018
099131                  UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX           09913118
099132        END-EVALUATE                                              09913218
099133     END-IF.                                                      09913318
099134                                                                  09913418
099135     PERFORM 2600-MOVE-DELIMITER.                                 09913518
099136                                                                  09913618
099137**----  MOVE MKDN SIGN CDE ----------- NULL ---------------**     09913718
099138                                                                  09913818
099139     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09913918
099140     INITIALIZE PV-TALLY.                                         09914018
099141                                                                  09914118
099142     IF EP219-MKDN-SGN-CDE-YES                                    09914218
099143        EVALUATE TRUE                                             09914318
099144          WHEN  EP219-MKDN-SGN-CDE = '~'                          09914418
099145             PERFORM 2900-MOVE-NULL-VALUE                         09914518
099146          WHEN  EP219-MKDN-SGN-CDE = SPACES                       09914618
099147             PERFORM 3100-MOVE-SPACE                              09914718
099148          WHEN OTHER                                              09914818
099149             MOVE EP219-MDSE-TX-CDE   TO PV-VARIABLE-CHAR-FIELD   09914918
099150                                                                  09915018
099151             PERFORM 2800-FIND-DATA-END                           09915118
099152               VARYING PV-CHR-EOF-IDX                             09915218
099153                  FROM 2 BY -1                                    09915318
099154                  UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)       09915418
099155                                                NOT = SPACE       09915518
099156                                                                  09915618
099157             PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX  09915718
099158                FROM 1  BY 1                                      09915818
099159                UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX             09915918
099160        END-EVALUATE                                              09916018
099161     END-IF.                                                      09916118
099162                                                                  09916218
099163     PERFORM 2600-MOVE-DELIMITER.                                 09916318
099164                                                                  09916418
099165**----  MOVE STYLE ID ------------ NOT NULL ---------------**     09916518
099166                                                                  09916618
099167     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09916718
099168     INITIALIZE PV-TALLY.                                         09916818
099169                                                                  09916918
099170     IF EP219-STYL-ID-YES                                         09917018
099171        EVALUATE TRUE                                             09917118
099172           WHEN EP219-STYL-ID = ZERO                              09917218
099173              PERFORM 3000-MOVE-ZERO                              09917318
099174           WHEN OTHER                                             09917418
099177              INSPECT EP219-STYL-ID          TALLYING PV-TALLY    09917718
099178                  FOR LEADING ZEROES                              09917818
099179              SET PV-BIT-IDX TO PV-TALLY                          09917918
099180              SET PV-BIT-IDX UP BY +1                             09918018
099181                                                                  09918118
099182              MOVE EP219-STYL-ID  TO PV-VARIABLE-OUTPUT-FIELD     09918218
099183                                                                  09918318
099184              PERFORM 2500-NUM-FIELD-MOVER VARYING PV-EOF-IDX     09918418
099185                 FROM PV-BIT-IDX  BY 1                            09918518
099186                 UNTIL PV-EOF-IDX > 8                             09918618
099187        END-EVALUATE                                              09918718
099188     END-IF.                                                      09918818
099189                                                                  09918918
099190     PERFORM 2600-MOVE-DELIMITER.                                 09919018
099191                                                                  09919118
099192**----  MOVE DUMMY SKU IND------------ NULL ---------------**     09919218
099193                                                                  09919318
099194     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09919418
099195     INITIALIZE PV-TALLY.                                         09919518
099196                                                                  09919618
099197     IF EP219-DMY-SKU-IND-YES                                     09919718
099198        EVALUATE TRUE                                             09919818
099199           WHEN  EP219-DMY-SKU-IND  = '~'                         09919918
099200              PERFORM 2900-MOVE-NULL-VALUE                        09920018
099201           WHEN OTHER                                             09920118
099202              MOVE EP219-DMY-SKU-IND   TO PV-VARIABLE-CHAR-FIELD  09920218
099203              SET PV-CHR-EOF-IDX TO +1                            09920318
099204              PERFORM 2550-CHR-FIELD-MOVER VARYING PV-CHR-BIT-IDX 09920418
099205                 FROM 1  BY 1                                     09920518
099206                 UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX            09920618
099207        END-EVALUATE                                              09920718
099208     END-IF.                                                      09920818
099209                                                                  09920918
099210     PERFORM 2600-MOVE-DELIMITER.                                 09921018
099211                                                                  09921118
099212**-- WRITE THE FORMATTED DATA RECORD                              09921218
099213                                                                  09921318
099214     PERFORM 2700-WRITE-DATA-RECORD.                              09921418
099215                                                                  09921518
099216*2300-EXIT.                                                       09921618
099218                                                                  09921818
099219*-----------------------------------------------------------------09921918
099220* 2400-MOVE-TRIGGER-TYPE                                          09922018
099221*  THIS PARAGRAPH WILL MOVE TRIGGER TYPE TO OUTPUT FILE VARIABLE  09922118
099222*----------------------------------------------------------------*09922218
099223 2400-MOVE-TRIGGER-TYPE.                                          09922318
099224                                                                  09922418
099225     MOVE EP219-RECORD-ACTION                                     09922518
099226       TO FORM-SKU-FLD(FORM-SKU-LEN).                             09922618
099227     SET FORM-SKU-LEN                                             09922718
099228       UP BY +1.                                                  09922818
099229     ADD 1                                                        09922918
099230       TO PV-BYTE-COUNT.                                          09923018
099231     PERFORM 2600-MOVE-DELIMITER.                                 09923118
099232                                                                  09923218
099233*2400-EXIT.                                                       09923318
099235                                                                  09923518
099236*----------------------------------------------------------       09923618
099237* 2500-NUM-FIELD-MOVER                                            09923718
099238*     THIS PARAGRAPH MOVES A BIT OF DATA TO THE OUTPUT FILE RECORD09923818
099239*----------------------------------------------------------       09923918
099240 2500-NUM-FIELD-MOVER.                                            09924018
099241                                                                  09924118
099242     MOVE PV-BIT-VARIABLE(PV-EOF-IDX)                             09924218
099243       TO FORM-SKU-FLD(FORM-SKU-LEN).                             09924318
099244     SET FORM-SKU-LEN                                             09924418
099245       UP BY +1.                                                  09924518
099246     ADD 1                                                        09924618
099247       TO PV-BYTE-COUNT.                                          09924718
099248                                                                  09924818
099249*2500-EXIT.                                                       09924918
099251                                                                  09925118
099252*----------------------------------------------------------       09925218
099253* 2550-CHR-FIELD-MOVER                                            09925318
099254*     THIS PARAGRAPH MOVES A BIT OF DATA TO THE OUTPUT FILE RECORD09925418
099255*----------------------------------------------------------       09925518
099256 2550-CHR-FIELD-MOVER.                                            09925618
099257                                                                  09925718
099258     MOVE PV-BIT-CHR-VARIABLE(PV-CHR-BIT-IDX)                     09925818
099259       TO FORM-SKU-FLD(FORM-SKU-LEN).                             09925918
099260     SET FORM-SKU-LEN                                             09926018
099261       UP BY +1.                                                  09926118
099262     ADD 1                                                        09926218
099263       TO PV-BYTE-COUNT.                                          09926318
099264                                                                  09926418
099265*2550-EXIT.                                                       09926518
099267                                                                  09926718
099268*-----------------------------------------------------------------09926818
099269* 2600-MOVE-DELIMITER.                                            09926918
099270*  THIS PARAGRAPH WILL MOVE '|' TO THE OUTPUT FILE VARIABLE       09927018
099271*----------------------------------------------------------------*09927118
099272 2600-MOVE-DELIMITER.                                             09927218
099273                                                                  09927318
099274     MOVE PC-CSV-DELIMITER                                        09927418
099275       TO FORM-SKU-FLD(FORM-SKU-LEN).                             09927518
099276     SET FORM-SKU-LEN                                             09927618
099277       UP BY +1.                                                  09927718
099278     ADD 1                                                        09927818
099279       TO PV-BYTE-COUNT.                                          09927918
099280                                                                  09928018
099281*2600-EXIT.                                                       09928118
099283                                                                  09928318
099284*-----------------------------------------------------------------09928418
099290* 2700-WRITE-DATA-RECORD                                          09929018
099300*  THIS PARAGRAPH WILL WRITE THE DATA RECORD TO THE O/P FILE      09930000
099400*-----------------------------------------------------------------09940000
099500 2700-WRITE-DATA-RECORD.                                          09950002
099600                                                                  09960000
099700     WRITE FORMATTED-SKU-RECORD.                                  09970003
099800                                                                  09980000
099810     ADD 1 TO PV-DATA-REC-WRITEN.                                 09981000
099820                                                                  09982000
099900*2700-EXIT.                                                       09990002
100100                                                                  10010000
100200*-------------------------------------------------------------    10020002
100300* 2800-FIND-DATA-END.                                             10030002
100400*  THIS PARAGRAPH IS USED IN A LOOP TO DETERMINE THE LENGTH OF    10040002
100500*  THE STRING.                                                    10050002
100600*-------------------------------------------------------------    10060002
100700 2800-FIND-DATA-END.                                              10070002
100800                                                                  10080002
100900     MOVE ' '                                                     10090002
101000       TO PV-SPACE.                                               10100002
101100                                                                  10110002
101200*2800-EXIT.                                                       10120002
101400                                                                  10140002
101500*-----------------------------------------------------------------10150003
101600* 2900-MOVE-NULL-VALUE                                            10160003
101700*  THIS PARAGRAPH WILL MOVE '~' TO THE OUTPUT FILE VARIABLE       10170003
101800*----------------------------------------------------------------*10180003
101900 2900-MOVE-NULL-VALUE.                                            10190003
102000                                                                  10200003
102100     MOVE PC-NULL-VALUE                                           10210003
102200       TO FORM-SKU-FLD(FORM-SKU-LEN).                             10220003
102300     SET FORM-SKU-LEN                                             10230003
102400       UP BY +1.                                                  10240003
102500     ADD 1                                                        10250003
102600       TO PV-BYTE-COUNT.                                          10260003
102700                                                                  10270003
103000*2900-EXIT.                                                       10300003
103300                                                                  10330017
103400*-----------------------------------------------------------------10340017
103500* 3000-MOVE-ZERO                                                  10350017
103600*  THIS PARAGRAPH WILL MOVE '0' TO THE OUTPUT FILE VARIABLE       10360017
103700*----------------------------------------------------------------*10370017
103800 3000-MOVE-ZERO.                                                  10380017
103900                                                                  10390017
104000     MOVE PC-ONE-ZERO                                             10400017
104100       TO FORM-SKU-FLD(FORM-SKU-LEN).                             10410017
104200     SET FORM-SKU-LEN                                             10420017
104300       UP BY +1.                                                  10430017
104400     ADD 1                                                        10440017
104500       TO PV-BYTE-COUNT.                                          10450017
104600                                                                  10460017
104700*3000-EXIT.                                                       10470017
104900*-----------------------------------------------------------------10490017
105000* 3200-MOVE-SPACE                                                 10500017
105100*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       10510017
105200*----------------------------------------------------------------*10520017
105300 3100-MOVE-SPACE.                                                 10530017
105400                                                                  10540017
105500     MOVE PC-ONE-SPACE                                            10550017
105600       TO FORM-SKU-FLD(FORM-SKU-LEN).                             10560017
105700     SET FORM-SKU-LEN                                             10570017
105800       UP BY +1.                                                  10580017
105900     ADD 1                                                        10590017
106000       TO PV-BYTE-COUNT.                                          10600017
106100                                                                  10610017
106200*3100-EXIT.                                                       10620017
106400                                                                  10640017
212600                                                                  21260000
212610******************************************************************21261028
212620* 5100-CALC-TIME.                                                 21262028
212630*     ADD 1 SECOND TO TIME FOR EACH HEADER RECORD WRITTEN         21263028
212640******************************************************************21264028
212650 5100-CALC-TIME.                                                  21265028
212660                                                                  21266028
212670     MOVE PV-TIME-CALC TO PV-TIME.                                21267028
212680                                                                  21268028
212690     IF PV-TIME-SS = 59                                           21269028
212691        IF PV-TIME-MM = 59                                        21269128
212692           IF PV-TIME-HH = 24                                     21269228
212693              MOVE ZEROES TO PV-TIME-HH                           21269328
212694           ELSE                                                   21269428
212695              ADD +1 TO PV-TIME-HH                                21269528
212696           END-IF                                                 21269628
212697           MOVE ZEROES TO PV-TIME-MM                              21269728
212698        ELSE                                                      21269828
212699           ADD +1 TO PV-TIME-MM                                   21269928
212700        END-IF                                                    21270028
212701        MOVE ZEROES TO PV-TIME-SS                                 21270128
212702     ELSE                                                         21270228
212703        ADD +1 TO PV-TIME-SS                                      21270328
212704     END-IF.                                                      21270428
212705                                                                  21270528
212706     MOVE PV-TIME TO PV-TIME-CALC.                                21270628
212707                                                                  21270728
212709                                                                  21270928
212710*----------------------------------------------------------       21271000
212800* 6000-READ-SKU-FILE                                              21280003
212900*     THIS PARAGRAPH READS DATA FROM INPUT-SKU-FILE INTO          21290001
213000*     COPYBOOK EPRD219                                            21300001
213100*----------------------------------------------------------       21310000
213200 6000-READ-SKU-FILE.                                              21320003
213300                                                                  21330000
213400     READ INPUT-SKU-FILE                                          21340001
213500         INTO EP219-XST-SKU-RECORD                                21350001
213600     AT END                                                       21360000
213700         SET PS-END-OF-SKU-FILE TO TRUE                           21370001
213800     END-READ.                                                    21380000
213910                                                                  21391000
213920     IF PS-NOT-END-SKU-FILE                                       21392003
213921        ADD +1 TO PV-RECORDS-READ                                 21392134
213930        MOVE 0 TO PV-PIPE-COUNT                                   21393003
213940        PERFORM 6100-CHECK-INP01-FOR-PIPES                        21394003
213950     END-IF.                                                      21395003
213960                                                                  21396003
214000*6000-EXIT.                                                       21400000
214200                                                                  21420000
214300*----------------------------------------------------------       21430003
214400* 6100-CHECK-INP01-FOR-PIPES                                      21440003
214500*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 21450003
214600*     REPLACES PIPES WITH SPACE.                                  21460003
214700*----------------------------------------------------------       21470003
214800 6100-CHECK-INP01-FOR-PIPES.                                      21480003
214900                                                                  21490003
215000     INSPECT EP219-XST-SKU-RECORD                                 21500003
215100          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     21510003
215200                                                                  21520003
215300     IF PV-PIPE-COUNT > 0                                         21530003
215400        INSPECT EP219-XST-SKU-RECORD                              21540003
215500            REPLACING ALL '|'  BY  ' '                            21550003
215600        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  21560003
215700                ' | WITH A SPACE '                                21570003
215800        DISPLAY EP219-XST-SKU-RECORD                              21580003
215900     END-IF.                                                      21590003
216000                                                                  21600003
216100*6100-EXIT.                                                       21610003
253400******************************************************************25340000
253500*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *25350000
253600******************************************************************25360000
253700 9200-WRAPUP.                                                     25370000
253800     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.25380000
253900                                                                  25390000
254000     PERFORM 9920-DISPLAY-TOTALS.                                 25400000
254100                                                                  25410000
254200     DISPLAY '****************************************'.          25420000
254300     DISPLAY '**          EPKUT218 END              **'.          25430001
254400     DISPLAY '****************************************'.          25440000
254500                                                                  25450000
254600     CLOSE INPUT-SKU-FILE                                         25460027
254700           CC-TODAYS-DATE.                                        25470027
255100                                                                  25510000
255200     CLOSE FORMATTED-SKU-FILE.                                    25520003
255300                                                                  25530000
255400*9200-EXIT.  EXIT.                                                25540000
257400******************************************************************25740000
257500*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   25750000
257600******************************************************************25760000
257700 9910-ABEND.                                                      25770000
257800                                                                  25780000
257900     PERFORM 9920-DISPLAY-TOTALS.                                 25790000
258000                                                                  25800000
258100     DISPLAY '** ABEND           **'.                             25810000
258200     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          25820000
258300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        25830000
258400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       25840000
258500     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       25850000
258600                                                                  25860000
258700     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         25870000
258800                                                                  25880000
258900*9910-EXIT.  EXIT.                                                25890000
259000******************************************************************25900000
259100*     DISPLAY END OF JOB TOTALS                                  *25910000
259200******************************************************************25920000
259300 9920-DISPLAY-TOTALS.                                             25930000
259400                                                                  25940000
259500     DISPLAY '****************************************'.          25950000
259600     DISPLAY '**     STATISTICS  FOR  SKU FILE     **'.           25960020
259800     DISPLAY '****************************************'.          25980000
259900                                                                  25990000
260000     DISPLAY '**  SKU EXTRACT RECORDS READ  ====> '               26000003
260100             PV-RECORDS-READ                                      26010003
260200             ' **'.                                               26020000
260210     DISPLAY '**  SKU HEADER RECORDS WRITEN ====> '               26021003
260220             PV-HDR-REC-WRITEN                                    26022003
260230             ' **'.                                               26023003
260300     DISPLAY '**  SKU DETAIL RECORDS WRITEN ====> '               26030001
260400             PV-DATA-REC-WRITEN                                   26040000
260500             ' **'.                                               26050000
261200     DISPLAY '****************************************'.          26120000
261300                                                                  26130000
261400*9920-EXIT.  EXIT.                                                26140000
261500                                                                  26150000
