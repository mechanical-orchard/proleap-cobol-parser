000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     APKUT441.                                        00020099
000300 AUTHOR.         MEENAKSI MITTAL.                                 00030099
000400 DATE-WRITTEN.   JUNE 2015.                                       00040099
000500******************************************************************00050099
000600*    COBOL 2 WITH DB2 SQL.                                        00060099
000700*                                                                 00070099
000710*     EDIT THE DUTY FILE FROM THE CUSTOMS BROKERS                 00080099
000720*                                                                 00090099
000721*        CURRENT CUSTOMS BROKERS:                                 00100099
000722*             EXPEDITORS                                          00110099
000723*             LIVINGSTON                                          00120099
000724*                                                                 00130099
000730* THIS PROGRAM EDITS THE FILE OF DUTY FEES COMING FROM CUSTOMS    00140099
000740* BROKERS TO DETERMINE IF THEY MEET ALL OF THE REQUIREMENTS       00150099
000750* FOR FURTHER PROCESSING. MOST OF THE EDITS ARE AT A FIELD        00160099
000760* VERIFICATION LEVEL.                                             00170099
000770* ALL DUTY FEE RECORD THAT PASS THE EDITS WILL BE WRITTEN TO A    00180099
000780* FILE FOR FUTHER PROCESSING & ALL OTHER RECORDS THAT FAIL THE    00190099
000790* EDITS WILL BE WRITTEN TO EJECTION FILE WHICH WILL BE USED TO    00200099
000800* GENERATE A REPORT OF ALL REJECTIONS.                            00210099
000900*                                                                 00220099
001000******************************************************************00230099
001100* INPUT:                                                          00240099
001200* 1. DUTY FEE RECORD                      (APRD156)               00250099
001300*                                                                 00260099
001400* OUTPUT:                                                         00270099
001500* 1. OUTPUT FILE FOR FUTHER PROCESSING    (APRD016)               00280099
001600* 2. REJECTED DUTY FEE RECORDS TO REPORT  (APRD158)               00290099
001610* 3. DUTY RECYCLE FILE                    (APRD156)               00300099
001700*                                                                 00310099
001800* DB2 TABLES:                                                     00320099
001900* 1. TINVOIC  - INVOICE TABLE                                     00330099
002000* 2. TIMCSPO  - IMPORT CUSTOMS PO TABLE                           00340099
002100* 3. TIMCSEN  - IMPORT CUSTOMS ENTRY TABLE                        00350099
002200* 4. TPURCHS  - PURCHASE ORDER TABLE                              00360099
002300* 5. TADJRNL  - AP-ADJUSTMENT JOURNAL TABLE                       00370099
002400* 6. SYSDUMMY - DUMMY TABLE USED FOR EXISTENCE CHECKING           00380099
002500*                                                                 00390099
002600***************************************************************** 00400099
002800* CHANGE LOG:                                                     00410099
002900*             INITIAL VERSION                                     00420099
003000*                                                                 00430099
003010*  DATE  08/22/2017                                               00440099
003020*      CHANGE MADE: DUTY RECYCLE PROJECT. CHANGED LRECL FOR APRD1500450099
003030*      ADDED OUTPUT FILE FOR DUTY-RECYCLE AND INPUT CONTROL CARD  00460099
003040*      TO HOLD THE MAX RECYCLE DAYS.  ADDED WORK FIELDS TO MANAGE 00470099
003050*      THE RECYCLE PROCESS.  ADDED LOGIC IN B100, B200 TO CONTROL 00480099
003060*      THE RECYCLE PROCESS.  REMOVED LAST DUPLICATE LOOKUP IN C30000490099
003070*      PER PRB0063168. SEGREGATED THE EDITS BEING DONE IN ORIGINAL00500099
003080*      PARAGRAPH C300-VALIDATE-OTHER-FIELDS INTO 3 NEW PARAGRAPHS 00510099
003090*      C300-CHECK-FOR-DUPLICATES.                                 00520099
003091*      C350-VALIDATE-DUTY-AMOUNT.                                 00530099
003092*      C400-VALIDATE-ENTRY-NUMBER.                                00540099
003093*      THIS RESTRUCTURE MADE IT SIMPLER TO INCORPORATE THE RECYCLE00550099
003094*      LOGIC. ADDED NEW PARAGRAPH W300 TO WRITE THE RECYCLE RECORD00560099
003095*      MADE BY: NANCY EILBES            WR/IR #:  CHG0175427      00570099
003096*                                                                 00580099
003097* DATE  11/02/2020                                                00590099
003098*    CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO COPYBOOK       00600099
003099*    APWS010.                                                     00610099
003100*    MADE BY: NANCY EILBES            WR/IR #: CHG0250510         00620099
003101*                                                                 00630099
003102* DATE  05/10/2023                                                00640099
003103*    CHANGE MADE: ALLOW FOR MULTIPLE CUSTOMS BROKERS              00650099
003104*                 UPDATED VERSION OF COPYBOOK APWS010           * 00660099
003105*    MADE BY: JEAN KURK               WR/IR #: CHG0288104         00670099
003106*                                                                 00680099
ST3292* DATE  11/02/2023                                                00682099
ST3292*    CHANGE MADE: ADDED LOGIC TO VALIDATE WHETHER INPUT FILE      00683099
ST3292*    HAS DUPLICATE INVOICES,IF IT IS THEN WRITE ALL OF THOSE      00684099
ST3292*    DUPLICATE RECORDS TO REJECTION FILE FOR REPORTING.           00684199
ST3292*    PSEUDO CODE DETAILS HAS PROVIDED IN THE PROGRAM DOC FOR      00684299
ST3292*    UNDERSTANDING.                                               00684399
ST3292*                                                                 00684499
ST3292*    INTRODUCED NEW ERROR CODE 84 DUP-DUTYINVC-ON-INPUT IN THE    00684599
ST3292*    COPYBOOK APWS010.                                            00684699
ST3292*                                                                 00684799
ST3292*    CODING TAG: ST3292                                           00686899
ST3292*    MADE BY: SARVESWARAN KANAN       WR/IR #: CHG0297175         00686999
ST3292*                                                                 00687099
003110***************************************************************** 00690099
003200                                                                  00700099
003300 ENVIRONMENT DIVISION.                                            00710099
003400                                                                  00720099
003500 INPUT-OUTPUT SECTION.                                            00730099
003600                                                                  00740099
003700 FILE-CONTROL.                                                    00750099
003800                                                                  00760099
003900     SELECT DUTY-INPUT-FILE     ASSIGN TO INP01.                  00770099
004000     SELECT DUTY-OUTPUT-FILE    ASSIGN TO OUT01.                  00780099
004100     SELECT REJECT-DUTY-FILE    ASSIGN TO OUT02.                  00790099
004110     SELECT DUTY-RECYCLE-FILE   ASSIGN TO OUT03.                  00800099
004200                                                                  00810099
004300 DATA DIVISION.                                                   00820099
004400                                                                  00830099
004500 FILE SECTION.                                                    00840099
004600                                                                  00850099
004700 FD  DUTY-INPUT-FILE                                              00860099
004800     RECORDING MODE IS  F                                         00870099
004900     LABEL RECORDS  ARE STANDARD                                  00880099
005000     DATA RECORD    IS  DUTY-INPUT-RECORD.                        00890099
005100                                                                  00900099
005200 01  DUTY-INPUT-RECORD             PIC X(181).                    00910099
005210*01  DUTY-INPUT-RECORD             PIC X(179).                    00920099
005300                                                                  00930099
005400 FD  DUTY-OUTPUT-FILE                                             00940099
005500     RECORDING MODE IS  F                                         00950099
005600     LABEL RECORDS  ARE STANDARD                                  00960099
005700     DATA RECORD    IS  DUTY-OUTPUT-RECORD.                       00970099
005800                                                                  00980099
005900 01  DUTY-OUTPUT-RECORD            PIC X(476).                    00990099
006000                                                                  01000099
006100 FD  REJECT-DUTY-FILE                                             01010099
006200     RECORDING MODE IS  F                                         01020099
006300     LABEL RECORDS  ARE STANDARD                                  01030099
006400     DATA RECORD    IS  REJECT-DUTY-RECORD.                       01040099
006500                                                                  01050099
006600 01  REJECT-DUTY-RECORD            PIC X(118).                    01060099
006700                                                                  01070099
006710 FD  DUTY-RECYCLE-FILE                                            01080099
006720     RECORDING MODE IS  F                                         01090099
006730     LABEL RECORDS  ARE STANDARD                                  01100099
006740     DATA RECORD    IS  DUTY-RECYCLE-RECORD.                      01110099
006750                                                                  01120099
006760 01  DUTY-RECYCLE-RECORD           PIC X(181).                    01130099
006760*01  DUTY-RECYCLE-RECORD           PIC X(179).                    01140099
006770                                                                  01150099
006800 EJECT                                                            01160099
006900 WORKING-STORAGE SECTION.                                         01170099
007000                                                                  01180099
007100 01  FILLER                          PIC X(25) VALUE              01190099
007200                             'WS FOR APKUT441 BEGINS==>'.         01200099
007300                                                                  01210099
007400 01  WS-PROGRAM-COUNTERS.                                         01220099
007500     05  WS-INPUT-REC-CNT            PIC 9(9)  VALUE ZEROS.       01230099
007600     05  WS-AUDIT-COUNT              PIC 9(9)  VALUE ZEROS.       01240099
007700     05  WS-REJECT-COUNT             PIC 9(9)  VALUE ZEROS.       01250099
007710     05  WS-DISPLAY-COUNTER          PIC 9(07) VALUE ZEROS.       01260099
007720     05  WS-COUNT                    PIC S9(4) COMP SYNC          01270099
007730                                               VALUE ZEROS.       01280099
ST3292     05  WS-RECYCLE-COUNT            PIC 9(9)  VALUE ZEROS.       01290099
007750     05  WS-MAX-RECYCLE-DAYS         PIC 999   VALUE ZEROS.       01300099
ST3292     05  WS-TABL-SIZE                PIC 9(3)  VALUE ZEROS.       01320099
ST3292     05  WS-INPUT-PO-DUP-REC-CNT     PIC 9(4)  VALUE ZEROS.       01322099
ST3292     05  WS-INPUT-TOT-DUP-REC-CNT    PIC 9(9)  VALUE ZEROS.       01323099
007760                                                                  01330099
007770 01  PV-PROGRAM-VARIABLES.                                        01340099
007780*PRB0062450 START                                                 01350099
007790     05  PV-ADJRNL-COUNT         PIC S9(08) COMP VALUE ZEROS.     01360099
007800     05  PV-ADJ-START            PIC 9(06)       VALUE ZEROES.    01370099
007810*PRB0062450 END                                                   01380099
007820                                                                  01390099
007830 01  ABEND-CODE                      PIC S9(4) COMP SYNC          01400099
008000                                               VALUE ZEROS.       01410099
008001     88 AP-INVALID-CONTROL-CARD      VALUE +4003.                 01420099
008010     88 AP-TABLE-FULL                VALUE +4004.                 01430099
008020     88 AP-EMPTY-FILE                VALUE +4005.                 01440099
008030     88 AP-DB2-ERROR                 VALUE +4013.                 01450099
008040                                                                  01460099
008080                                                                  01470099
008200 01  PS-SWITCHES.                                                 01480099
008201     05 ERROR-FOUND-SW              PIC X(1) VALUE SPACES.        01490099
008202        88  ERROR-FOUND                      VALUE 'Y'.           01500099
008203        88  NO-ERROR-FOUND                   VALUE 'N'.           01510099
008210     05 END-OF-DUTY-IN-SW           PIC X(1) VALUE ' '.           01520099
008220        88  END-OF-DUTY-IN                   VALUE 'N'.           01530099
008230     05 DUPL-ADJ-FOUND-SW           PIC X(1) VALUE SPACES.        01540099
008240        88  DUPL-ADJ-FOUND                   VALUE 'Y'.           01550099
008250        88  NO-DUPL-ADJ-FOUND                VALUE 'N'.           01560099
008260     05 DUPL-PO-INV-FOUND-SW        PIC X(1) VALUE SPACES.        01570099
008270        88  DUPL-PO-INV-FOUND                VALUE 'Y'.           01580099
008271        88  NO-DUPL-PO-INV-FOUND             VALUE 'N'.           01590099
008272     05 ENTRY-NBR-FOUND-SW          PIC X(1) VALUE SPACES.        01600099
008273        88  ENTRY-NBR-FOUND                  VALUE 'Y'.           01610099
008274        88  NO-ENTRY-NBR-FOUND               VALUE 'N'.           01620099
008275     05 INVALID-PO-NBR-SW           PIC X(1) VALUE SPACES.        01630099
008276        88  PO-NBR-VALID                     VALUE 'Y'.           01640099
008277        88  PO-NBR-INVALID                   VALUE 'N'.           01650099
008278     05 INVALID-DATE-SW             PIC X(1) VALUE ' '.           01660099
008279        88  WS-DATE-VALID                    VALUE 'Y'.           01670099
008280        88  WS-DATE-INVALID                  VALUE 'N'.           01680099
008290     05 INVALID-STMT-DT-SW          PIC X(1) VALUE ' '.           01690099
008300        88  STMT-DATE-VALID                  VALUE 'Y'.           01700099
008310        88  STMT-DATE-INVALID                VALUE 'N'.           01710099
008320     05 INVALID-CUST-DT-SW          PIC X(1) VALUE ' '.           01720099
008330        88  CUST-DATE-VALID                  VALUE 'Y'.           01730099
008340        88  CUST-DATE-INVALID                VALUE 'N'.           01740099
008341     05 RECYCLE-SW                  PIC X(1) VALUE 'N'.           01750099
008342        88  RECYCLE-DUTY                     VALUE 'Y'.           01760099
008343        88  NO-RECYCLE-DUTY                  VALUE 'N'.           01770099
008350                                                                  01780099
008360 05  WS-ERROR-CODE-AREA.                                          01790099
008370     10  WS-ERR-TABLE       OCCURS 15 TIMES                       01800099
008380                                      INDEXED BY ERR-IDX.         01810099
008390          15 WS-ERR-CDE          PIC 9(02).                       01820099
008400                                                                  01830099
008500 01  RUN-TIME                        PIC 9(8).                    01840099
008600 01  DATE-IN                         PIC X(6).                    01850099
008700                                                                  01860099
008800 01  WS-ABEND-FILEDS.                                             01870099
008900     05  WS-ABEND-PROGRAM            PIC X(8)  VALUE 'APKUT441'.  01880099
009000     05  WS-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01890099
009100     05  WS-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01900099
009200     05  WS-ABEND-STRUCTURE-1        PIC X(8)  VALUE SPACES.      01910099
009300     05  WS-ABEND-STRUCTURE-2        PIC X(8)  VALUE SPACES.      01920099
009400     05  WS-ABEND-STATUS             PIC XX    VALUE SPACES.      01930099
009500                                                                  01940099
009600 01  WS-WORK-AREA.                                                01950099
009700     05  PV-ONE                      PIC X(01) VALUE SPACES.      01960099
009800*    05  PV-VND-NBR                  PIC X(09) VALUE '009207259'. 01970099
009801     05  DK-VND-NBR                  PIC X(09) VALUE '009207259'. 01980099
009810     05  PV-VND-EXPEDITORS           PIC X(09) VALUE '009207259'. 01990099
009820     05  PV-VND-LIVINGSTON           PIC X(09) VALUE '001182576'. 02000099
009900     05  PV-PO-NBR                   PIC S9(9) COMP VALUE ZEROES. 02010099
010000     05  PV-PO-NBR-DIGITS            PIC 9(9).                    02020099
010100     05  PV-PO-NBR-CHAR              PIC X(9).                    02030099
010200     05  PV-PO-NBR-CHAR-X REDEFINES PV-PO-NBR-CHAR.               02040099
010300         10 PV-PO-NBR-CHAR-5         PIC X(5).                    02050099
010301         10 PV-PO-NBR-CHAR-4         PIC X(4).                    02060099
010302     05  WS-STATEMENT-DT.                                         02070099
010303         10  WS-ST-CENTURY           PIC X(02)     VALUE '00'.    02080099
010304         10  WS-ST-YYMMDD.                                        02090099
010305             15  WS-ST-YY            PIC X(02)     VALUE '00'.    02100099
010306             15  WS-ST-MM            PIC X(02)     VALUE '00'.    02110099
010307             15  WS-ST-DD            PIC X(02)     VALUE '00'.    02120099
010308                                                                  02130099
010309     05  WS-CUSTOM-DT.                                            02140099
010310         10  WS-CST-CENTURY          PIC X(02)     VALUE '00'.    02150099
010320         10  WS-YYMMDD.                                           02160099
010330             15  WS-CST-YY           PIC X(02)     VALUE '00'.    02170099
010340             15  WS-CST-MM           PIC X(02)     VALUE '00'.    02180099
010350             15  WS-CST-DD           PIC X(02)     VALUE '00'.    02190099
010360                                                                  02200099
010370     05  WS-CCYYMMDD.                                             02210099
010380         10  WS-CENTURY              PIC X(02)     VALUE '00'.    02220099
010390         10  WS-YYMMDD.                                           02230099
010400             15  WS-YY               PIC X(02)     VALUE '00'.    02240099
010401             15  WS-MM               PIC X(02)     VALUE '00'.    02250099
010402             15  WS-DD               PIC X(02)     VALUE '00'.    02260099
010403                                                                  02270099
010404     05  WS-BRK-FOR-LIKE-COND       PIC X(16)   VALUE SPACES.     02280099
010405     05  PC-PERCENTS                PIC X(16)   VALUE ALL '%'.    02290099
010406     05  WS-INV-FOR-LIKE-COND       PIC X(16)   VALUE SPACES.     02300099
010407                                                                  02310099
010408     05  WS-INVC-DTE                 PIC X(10).                   02320099
010409                                                                  02330099
010410     05  WS-INVC-DTE-RED REDEFINES WS-INVC-DTE.                   02340099
010411         10  WS-INVC-DTE-CC          PIC X(2).                    02350099
010412         10  WS-INVC-DTE-YY          PIC X(2).                    02360099
010413         10  WS-DASH1                PIC X(1).                    02370099
010414         10  WS-INVC-DTE-MM          PIC X(2).                    02380099
010415         10  WS-DASH2                PIC X(1).                    02390099
010416         10  WS-INVC-DTE-DD          PIC X(2).                    02400099
010417                                                                  02410099
010418*EX. 231-9566039-8                                                02420099
010419 05  WS-CSTM-ENTR-ID             PIC X(16) VALUE SPACES.          02430099
010420 05  WS-CSTM-ENTRY REDEFINES WS-CSTM-ENTR-ID.                     02440099
010430     10  WS-ENTRY-PREFIX         PIC X(03).                       02450099
010440     10  WS-ENTRY-DASH           PIC X(01).                       02460099
010441     10  WS-ENTRY-SUFFIX1        PIC X(07).                       02470099
010442     10  WS-ENTRY-DASH           PIC X(01).                       02480099
010443     10  WS-ENTRY-SUFFIX2        PIC X(04).                       02490099
010444 05  WS-ENTRY-ID.                                                 02500099
010445     10  WS-ENTRY-ID-FIRST       PIC X(03).                       02510099
010446     10  WS-ENTRY-ID-LAST1       PIC X(07).                       02520099
010447     10  WS-ENTRY-ID-LAST2       PIC X(04).                       02530099
010448     10  WS-FILLER               PIC X(02) VALUE SPACES.          02540099
010449                                                                  02550099
010450     COPY DPWS500.                                                02560099
010460                                                                  02570099
010461 EJECT                                                            02580099
010462*--------------------------------------------------------------*  02590099
010463*  CONTROL CARD RECORD LAYOUT                                  *  02600099
010464*--------------------------------------------------------------*  02610099
010465 01  CONTROL-CARD-RECORD.                                         02620099
010466     05  CC-RECYCLE-DAYS         PIC  9(03).                      02630099
010467     05  FILLER                  PIC  X(77).                      02640099
010468                                                                  02650099
010470 EJECT                                                            02660099
010480*----------------------------------------------------------------*02670099
010490*  DUTY FEE INPUT FILE.                                           02680099
010500*----------------------------------------------------------------*02690099
010600     COPY APRD156.                                                02700099
010700 EJECT                                                            02710099
010800*----------------------------------------------------------------*02720099
ST3292 01  FILLER                               PIC X(35)  VALUE        02721099
ST3292     'BEGINNING OF AP WORK RECORD AREA **'.                       02722099
ST3292*----------------------------------------------------------------*02730099
ST3292 01 WS156-WORK-AREA.                                              02740099
ST3292    05  WS156-WORK-TABLE    OCCURS 100 TIMES                      02750099
ST3292                            INDEXED BY WS156-IDX.                 02760099
ST3292     10  WS156-BRANCH                     PIC X(3).               02761199
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02761299
ST3292     10  WS156-PO-NBR                     PIC 9(9).               02761399
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02761499
ST3292     10  WS156-INVOICE-NBR                PIC X(22).              02761599
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02761699
ST3292     10  WS156-BROKER-REF-NBR             PIC X(15).              02761799
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02761899
ST3292     10  WS156-ENTRY-NBR                  PIC X(16).              02761999
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02762099
ST3292     10  WS156-STATEMENT-NBR              PIC X(15).              02762199
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02762299
ST3292     10  WS156-STATEMENT-DTE              PIC X(08).              02762399
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02762499
ST3292     10  WS156-CUSTOMS-PAID-DTE           PIC X(08).              02762599
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02762699
ST3292     10  WS156-TOTAL-DUTY-AMT             PIC S9(9)V99.           02762799
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02762899
ST3292     10  WS156-DUTY-AMT                   PIC S9(9)V99.           02762999
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02763099
ST3292     10  WS156-MPF-AMT                    PIC S9(9)V99.           02763199
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02763299
ST3292     10  WS156-HMF-AMT                    PIC S9(9)V99.           02763399
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02763499
ST3292     10  WS156-FEES                       PIC S9(9)V99.           02763599
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02763699
ST3292     10  WS156-TOTAL-TAX-AMT              PIC S9(9)V99.           02763799
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02763899
ST3292     10  WS156-RECYCLE-COUNT              PIC 9(3).               02763999
ST3292     10  FILLER                           PIC X(1) VALUE SPACES.  02764099
ST3292     10  WS156-CUSTOMS-BROKER             PIC X(1).               02764199
ST3292         88  WS156-EXPEDITORS                   VALUE 'E'.        02764299
ST3292         88  WS156-LIVINGSTON                   VALUE 'L'.        02764399
010700 EJECT                                                            02765099
ST3292*----------------------------------------------------------------*03100099
010900*  DUTY FEE OUTPUT FILE.                                          03110099
011000*----------------------------------------------------------------*03120099
011100     COPY APRD016.                                                03130099
011200 EJECT                                                            03140099
011300*----------------------------------------------------------------*03150099
011400*  DUTY FEE REJECTION OUTPUT FILE.                                03160099
011500*----------------------------------------------------------------*03170099
011600     COPY APRD158.                                                03180099
011700 EJECT                                                            03190099
011800*----------------------------------------------------------------*03200099
011900*  DUTY FILE FEE RECORDS EDIT CODES.                              03210099
012000*----------------------------------------------------------------*03220099
012100 01  WS-EDIT-CODES.                                               03230099
012200     COPY APWS010.                                                03240099
012300 EJECT                                                            03250099
012400     COPY DPWS004.                                                03260099
012500*                                                                 03270099
012600*----------------------------------------------------------------*03280099
012700*  COMMUNICATIONS AREA2 FOR DB2                                   03290099
012800*----------------------------------------------------------------*03300099
012900     COPY SQLCA2.                                                 03310099
013000*                                                                 03320099
013100     EXEC SQL                                                     03330099
013200          INCLUDE SQLCA                                           03340099
013300     END-EXEC.                                                    03350099
013400*----------------------------------------------------------------*03360099
013500*  INVOICE TABLE                                                  03370099
013600*----------------------------------------------------------------*03380099
013700     EXEC SQL                                                     03390099
013800          INCLUDE TINVOIC                                         03400099
013900     END-EXEC.                                                    03410099
014000*----------------------------------------------------------------*03420099
014100*  PURCHASE ORDER TABLE                                           03430099
014200*----------------------------------------------------------------*03440099
014300     EXEC SQL                                                     03450099
014400          INCLUDE TPURCHS                                         03460099
014500     END-EXEC.                                                    03470099
014600*----------------------------------------------------------------*03480099
014700*  PO TRACKING CUSTOMS PO NUMBER                                  03490099
014800*----------------------------------------------------------------*03500099
014900     EXEC SQL                                                     03510099
015000          INCLUDE TIMCSPO                                         03520099
015100     END-EXEC.                                                    03530099
015200*----------------------------------------------------------------*03540099
015300*  PO TRACKING CUSTOMS ENTRY                                      03550099
015400*----------------------------------------------------------------*03560099
015500     EXEC SQL                                                     03570099
015600          INCLUDE TIMCSEN                                         03580099
015700     END-EXEC.                                                    03590099
015800*----------------------------------------------------------------*03600099
015900*    AP-ADJUSTMENT JOURNAL TABLE                                  03610099
016000*----------------------------------------------------------------*03620099
016100     EXEC SQL                                                     03630099
016200         INCLUDE TADJRNL                                          03640099
016300     END-EXEC.                                                    03650099
016400*----------------------------------------------------------------*03660099
016500*    DB2 AREA FOR SYSDUMMY1                                       03670099
016600*----------------------------------------------------------------*03680099
016700     EXEC SQL                                                     03690099
016800          INCLUDE SYSDUMMY                                        03700099
016900     END-EXEC.                                                    03710099
017000                                                                  03720099
017100                                                                  03730099
017200 01  FILLER                        PIC X(25) VALUE                03740099
017300          '<====WS FOR APKUT441 ENDS'.                            03750099
017400 EJECT                                                            03760099
017500 PROCEDURE DIVISION.                                              03770099
017600                                                                  03780099
017700 A100-MAINLINE.                                                   03790099
017800                                                                  03800099
017900     PERFORM B100-INITIALIZION.                                   03810099
018000                                                                  03820099
018100     PERFORM B200-PROCESS-DUTY-FEE-REC UNTIL END-OF-DUTY-IN.      03830099
018200                                                                  03840099
ST3292     PERFORM B275-PROCESS-LAST-REC.                               03850099
ST3292                                                                  03851099
018300     PERFORM B300-END-OF-JOB.                                     03852099
018400                                                                  03860099
018500     GOBACK.                                                      03870099
018600                                                                  03880099
018700 EJECT                                                            03890099
018800*---------------------------------------------------------------* 03900099
018900* GET DATE, TIME, OPEN FILES, INITIALIZE RECORD LAYOUTS AND       03910099
019000* PERFORM INITIAL READ OF INPUT FILE.                             03920099
019100*---------------------------------------------------------------* 03930099
019200 B100-INITIALIZION.                                               03940099
019300                                                                  03950099
019400     ACCEPT RUN-TIME FROM TIME.                                   03960099
019500     ACCEPT DATE-IN  FROM DATE.                                   03970099
019600     DISPLAY '------------ START OF APKUT441 ------------'.       03980099
019700     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    03990099
019800                                                                  04000099
019810     ACCEPT CONTROL-CARD-RECORD.                                  04010099
019820     IF CC-RECYCLE-DAYS IS NUMERIC                                04020099
019830        MOVE CC-RECYCLE-DAYS TO WS-MAX-RECYCLE-DAYS               04030099
019840        DISPLAY 'MAX RECYCLE DAYS = ' WS-MAX-RECYCLE-DAYS         04040099
019850     ELSE                                                         04050099
019860        DISPLAY 'CONTROL CARD = ' CONTROL-CARD-RECORD             04060099
019870        MOVE 'B100-INITIALIZATION' TO WS-ABEND-PARAGRAPH          04070099
019880        MOVE 'ERROR IN CONTROL CARD' TO WS-ABEND-OPERATION        04080099
019890        SET  AP-INVALID-CONTROL-CARD TO TRUE                      04090099
019891        PERFORM Z998-ABEND                                        04100099
019892     END-IF.                                                      04110099
019893                                                                  04120099
019900     OPEN  INPUT   DUTY-INPUT-FILE.                               04130099
020000     OPEN  OUTPUT  DUTY-OUTPUT-FILE                               04140099
020100                   REJECT-DUTY-FILE                               04150099
020110                   DUTY-RECYCLE-FILE.                             04160099
020200                                                                  04170099
020300     INITIALIZE DCLTINVOIC                                        04180099
020400                DCLTIMCSPO                                        04190099
020500                DCLTADJRNL                                        04200099
020600                DCLTIMCSEN.                                       04210099
020700                                                                  04220099
020800     INITIALIZE AP156-DUTY-INVC-RECORD                            04230099
020900                AP016-INVOICE-LOAD-RECORD                         04240099
021000                AP158-REJECT-DUTY-INVOICE                         04250099
ST3292                WS-ERROR-CODE-AREA                                04260099
ST3292                WS156-WORK-AREA.                                  04270099
ST3292                                                                  04280099
ST3292     SET WS156-IDX TO 1.                                          04290099
021200                                                                  04300099
021300     PERFORM R100-READ-DUTY-FEE-INPUT.                            04310099
021310                                                                  04320099
021320     IF END-OF-DUTY-IN                                            04330099
021330        DISPLAY '***************************************'         04340099
021340        DISPLAY '* INPUT FILE IS EMPTY.  NO RECORDS    *'         04350099
021350        DISPLAY '* TO PROCESS.                         *'         04360099
021360        DISPLAY '***************************************'         04370099
021370     END-IF.                                                      04380099
021380                                                                  04390099
021390 EJECT                                                            04400099
021400*---------------------------------------------------------------* 04410099
021500* THIS PARA PERFORMS THE VAILDATION ON THE RECORDS PRESENT IN THE 04420099
021600* DUTY FEE FILE. IF THE RECORDS ARE PASSED FROM THE EDITS THEN    04430099
021700* WRITTEN TO THE FILE FOR FURTHER PROCESSING AND THOSE WHICH ARE  04440099
021800* NOT PASSED ARE WRITTEN TO THE REJECTION FILE FOR REPORTING.     04450099
021900*---------------------------------------------------------------* 04460099
ST3292* ADDED A LOGIC TO VALIDATE WHETHER INPUT FILE HAS DUPLICATE      04461099
ST3292* INVOICES. LOGIC IS TO COMPARE CURRENT RECORD PO,INVOICE,BROKER  04461199
ST3292* NUMBER WITH PREVIOUS RECORD. IF ALL 3 VALUES ARE SAME, THEN     04462099
ST3292* CONSIDERED AS DUPLCIATE AND MOVING TO INTERNAL TABLE UNTIL      04463099
ST3292* FOUND A NON-MATCHING RECORD.ONCE FOUND A NON-MATCHING RECORD,   04463199
ST3292* CHECK CURRENT TABLE SIZE IS GREATER THAN 1, IF IT IS THEN       04463299
ST3292* WRITE ALL THOSE RECORDS INTO REJECTION FILE FOR REPORTING.      04463399
ST3292* IF TABLE SIZE IS 1 AND RECORDS ARE PASSED THE EDITS, THEN       04463599
ST3292* PROCESS THOSE RECORDS.                                          04463699
021900*---------------------------------------------------------------* 04464099
022000 B200-PROCESS-DUTY-FEE-REC.                                       04470099
022100                                                                  04480099
022200     SET AP158-IDX TO 1.                                          04490099
022300     SET ERR-IDX   TO 1.                                          04500099
022310     SET NO-ERROR-FOUND                                           04510099
022320         NO-RECYCLE-DUTY TO TRUE                                  04520099
022400     INITIALIZE AP016-INVOICE-LOAD-RECORD.                        04530099
022500     INITIALIZE AP158-REJECT-DUTY-INVOICE.                        04540099
022600     INITIALIZE WS-ERROR-CODE-AREA.                               04550099
ST3292     SET WS-TABL-SIZE TO WS156-IDX                                04570099
ST3292                                                                  04590099
ST3292*LOGIC TO CHECK THE DUPLICATES IN INPUT FILE                      04591099
ST3292*COMPARING CURRENT RECORD KEY VALUES WITH PREVIOUS RECORD TO      04592099
ST3292*IDENTIFY THE DUPLICATES                                          04593099
ST3292     IF WS-INPUT-REC-CNT IS > 1                                   04600099
ST3292      IF AP156-PO-NBR IS  = WS156-PO-NBR(WS156-IDX) AND           04610099
ST3292         AP156-INVOICE-NBR IS = WS156-INVOICE-NBR(WS156-IDX) AND  04611099
ST3292         AP156-BROKER-REF-NBR IS = WS156-BROKER-REF-NBR(WS156-IDX)04612099
ST3292                                                                  04613099
ST3292           SET WS156-IDX UP BY 1                                  04614099
ST3292           MOVE AP156-DUTY-INVC-RECORD                            04615099
ST3292                      TO WS156-WORK-TABLE (WS156-IDX)             04616099
ST3292           SET WS-TABL-SIZE TO WS156-IDX                          04617099
ST3292      ELSE                                                        04618099
ST3292           IF WS-TABL-SIZE IS = 1                                 04620099
ST3292              PERFORM VARYING WS156-IDX FROM 1 BY 1               04620599
ST3292                           UNTIL WS156-IDX > WS-TABL-SIZE         04620799
ST3292                                                                  04620899
ST3292                 INITIALIZE WS-ERROR-CODE-AREA                    04620999
ST3292                 SET ERR-IDX   TO 1                               04621099
ST3292                 INITIALIZE AP158-ERROR-CODE-AREA                 04621199
ST3292                 SET AP158-IDX TO 1                               04621299
ST3292                                                                  04621399
ST3292                 PERFORM B250-VALIDATE-DUTY-FEE-REC               04621499
ST3292                                                                  04621699
ST3292              END-PERFORM                                         04621799
ST3292           ELSE                                                   04621899
ST3292*PROCESSING DUPLICATES HERE.DO THE EDITS FOR ALL DUPLICATE        04622099
ST3292*RECORDS AND THEN WRITTEN TO REJECTION FILE WITH ERROR CODES      04626099
ST3292              PERFORM VARYING WS156-IDX  FROM 1 BY 1              04628299
ST3292                        UNTIL WS156-IDX  > WS-TABL-SIZE           04628399
ST3292                 INITIALIZE WS-ERROR-CODE-AREA                    04628599
ST3292                 SET ERR-IDX   TO 1                               04628699
ST3292                 SET DUP-DUTYINVC-ON-INPUT TO TRUE                04628799
ST3292                 SET ERROR-FOUND TO TRUE                          04628899
ST3292                 MOVE WS010-ERROR-CODES TO WS-ERR-CDE (ERR-IDX)   04628999
ST3292                 IF ERR-IDX < 15                                  04629099
ST3292                    SET ERR-IDX UP BY 1                           04629199
ST3292                 END-IF                                           04629299
ST3292                                                                  04629399
ST3292                 INITIALIZE AP158-ERROR-CODE-AREA                 04629499
ST3292                 SET AP158-IDX TO 1                               04629599
ST3292                                                                  04629699
ST3292                 PERFORM B250-VALIDATE-DUTY-FEE-REC               04629799
ST3292                                                                  04629899
ST3292                 ADD 1 TO WS-INPUT-PO-DUP-REC-CNT                 04629999
ST3292                                                                  04630199
ST3292              END-PERFORM                                         04630299
ST3292                                                                  04630399
ST3292                 ADD WS-INPUT-PO-DUP-REC-CNT TO                   04631099
ST3292                                 WS-INPUT-TOT-DUP-REC-CNT         04631199
ST3292           END-IF                                                 04631299
ST3292                                                                  04631399
ST3292           INITIALIZE WS156-WORK-AREA                             04631499
ST3292           SET WS156-IDX TO 1                                     04631599
ST3292           MOVE 0 TO WS-INPUT-PO-DUP-REC-CNT                      04631699
ST3292           MOVE AP156-DUTY-INVC-RECORD                            04631799
ST3292                      TO WS156-WORK-TABLE (WS156-IDX)             04632099
ST3292           SET WS-TABL-SIZE TO WS156-IDX                          04640099
ST3292                                                                  04650099
ST3292      END-IF                                                      04720099
ST3292     ELSE                                                         04850099
ST3292*PROCESSING THE FIRST RECORD                                      04860099
ST3292       MOVE AP156-DUTY-INVC-RECORD TO WS156-WORK-TABLE (WS156-IDX)04870099
ST3292                                                                  04880099
ST3292     END-IF                                                       04890099
ST3292                                                                  04891099
ST3292     PERFORM R100-READ-DUTY-FEE-INPUT.                            04900099
ST3292                                                                  04910099
ST3292 EJECT                                                            05070099
ST3292*---------------------------------------------------------------* 05071099
ST3292* VALIDATE DUTY FEE RECORD                                        05072099
ST3292*---------------------------------------------------------------* 05076099
ST3292 B250-VALIDATE-DUTY-FEE-REC.                                      05077099
ST3292                                                                  05078099
ST3292      PERFORM C100-VALIDATE-PO-NBR                                05079299
ST3292      PERFORM C200-VALIDATE-DATE                                  05079399
ST3292      PERFORM C300-CHECK-FOR-DUPLICATES                           05079499
ST3292      PERFORM C350-VALIDATE-DUTY-AMOUNT                           05079599
ST3292      PERFORM C400-VALIDATE-ENTRY-NUMBER                          05079699
ST3292                                                                  05079799
ST3292      IF  ERROR-FOUND                                             05080099
ST3292          PERFORM C600-CREATE-REJECT-RECORD                       05080299
ST3292      ELSE                                                        05080399
ST3292          IF RECYCLE-DUTY                                         05080499
ST3292             PERFORM C700-CREATE-RECYCLE-RECORD                   05080699
ST3292          ELSE                                                    05080799
ST3292             PERFORM C500-CREATE-OUTPUT-FILE                      05080999
ST3292          END-IF                                                  05081099
ST3292      END-IF.                                                     05081199
ST3292 EJECT                                                            05081299
ST3292*---------------------------------------------------------------* 05082099
ST3292 B275-PROCESS-LAST-REC.                                           05083099
ST3292*---------------------------------------------------------------* 05083199
ST3292                                                                  05084099
ST3292     IF WS-TABL-SIZE IS = 1                                       05084199
ST3292        PERFORM VARYING WS156-IDX   FROM 1 BY 1                   05084699
ST3292                     UNTIL WS156-IDX   > WS-TABL-SIZE             05084899
ST3292                                                                  05084999
ST3292           INITIALIZE WS-ERROR-CODE-AREA                          05085099
ST3292           SET ERR-IDX   TO 1                                     05085199
ST3292           INITIALIZE AP158-ERROR-CODE-AREA                       05085299
ST3292           SET AP158-IDX TO 1                                     05085399
ST3292                                                                  05085499
ST3292           PERFORM B250-VALIDATE-DUTY-FEE-REC                     05085599
ST3292                                                                  05085799
ST3292        END-PERFORM                                               05085899
ST3292                                                                  05085999
ST3292     ELSE                                                         05086099
ST3292        PERFORM VARYING WS156-IDX   FROM 1 BY 1                   05086799
ST3292                     UNTIL WS156-IDX > WS-TABL-SIZE               05086999
ST3292                                                                  05087099
ST3292           INITIALIZE WS-ERROR-CODE-AREA                          05087199
ST3292           SET ERR-IDX   TO 1                                     05087299
ST3292           SET DUP-DUTYINVC-ON-INPUT TO TRUE                      05087399
ST3292           SET ERROR-FOUND TO TRUE                                05087499
ST3292           MOVE WS010-ERROR-CODES TO WS-ERR-CDE (ERR-IDX)         05087599
ST3292           IF ERR-IDX < 15                                        05087699
ST3292              SET ERR-IDX UP BY 1                                 05087799
ST3292           END-IF                                                 05087899
ST3292                                                                  05087999
ST3292           INITIALIZE AP158-ERROR-CODE-AREA                       05088099
ST3292           SET AP158-IDX TO 1                                     05088199
ST3292                                                                  05088299
ST3292           PERFORM B250-VALIDATE-DUTY-FEE-REC                     05088399
ST3292                                                                  05088499
ST3292                 ADD 1 TO WS-INPUT-PO-DUP-REC-CNT                 05088799
ST3292                                                                  05088999
ST3292        END-PERFORM                                               05089399
ST3292                                                                  05089499
ST3292                 ADD WS-INPUT-PO-DUP-REC-CNT TO                   05090099
ST3292                                 WS-INPUT-TOT-DUP-REC-CNT         05090199
ST3292     END-IF.                                                      05090299
024500                                                                  05090399
024000 EJECT                                                            05090499
024100*---------------------------------------------------------------* 05090599
024200*CLOSE FILES AND DISPLAY COUNTER TOTALS.                          05091099
024300*---------------------------------------------------------------* 05100099
024400 B300-END-OF-JOB.                                                 05110099
024500                                                                  05270099
024600     CLOSE DUTY-INPUT-FILE                                        05280099
024700           DUTY-OUTPUT-FILE                                       05290099
024800           REJECT-DUTY-FILE.                                      05300099
024900                                                                  05310099
025000     DISPLAY '************************************************'.  05320099
025100     DISPLAY 'TOTAL INVOICE RECORDS READ     = ' WS-INPUT-REC-CNT 05330099
025200     DISPLAY 'TOTAL INVOICES TO AUDIT FILE   = ' WS-AUDIT-COUNT   05340099
025300     DISPLAY 'TOTAL INVOICES TO REJECT FILE  = ' WS-REJECT-COUNT  05350099
025310     DISPLAY 'TOTAL INVOICES TO RECYCLE FILE = ' WS-RECYCLE-COUNT 05360099
ST3292     DISPLAY 'TOTAL INVOICES WITH DUPLICATES   '                  05361099
ST3292     DISPLAY 'FROM  THE INPUT FILE           = '                  05361299
ST3292                                          WS-INPUT-TOT-DUP-REC-CNT05362099
025400     DISPLAY '************************************************'.  05370099
025500                                                                  05380099
025600     ACCEPT RUN-TIME FROM TIME.                                   05390099
025700     ACCEPT DATE-IN  FROM DATE.                                   05400099
025800                                                                  05410099
025900     IF WS-REJECT-COUNT > 0                                       05420099
025901         MOVE 4055 TO RETURN-CODE                                 05430099
025902     END-IF.                                                      05440099
025903                                                                  05450099
025905     DISPLAY '*-------------- END OF APKUT441 ---------------*'.  05460099
025906     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    05470099
025907     DISPLAY '*----------------------------------------------*'.  05480099
025908                                                                  05490099
025909 EJECT                                                            05500099
025910*---------------------------------------------------------------* 05510099
025911* VALIDATING THE PURCHASE ORDER.                                  05520099
025920*---------------------------------------------------------------* 05530099
025930 C100-VALIDATE-PO-NBR.                                            05540099
025940                                                                  05550099
ST3292     IF (WS156-PO-NBR(WS156-IDX) NOT NUMERIC                      05560099
ST3292     OR  WS156-PO-NBR(WS156-IDX) = ZEROS )                        05570099
025970         SET NO-PO-NBR-ERR TO TRUE                                05580099
025980         SET ERROR-FOUND TO TRUE                                  05590099
025990         MOVE WS010-ERROR-CODES TO WS-ERR-CDE (ERR-IDX)           05600099
026000         IF ERR-IDX < 15                                          05610099
026100            SET ERR-IDX UP BY 1                                   05620099
026200         END-IF                                                   05630099
026300     ELSE                                                         05640099
026400       INITIALIZE DCLTPURCHS                                      05650099
ST3292       MOVE WS156-PO-NBR(WS156-IDX) TO PV-PO-NBR                  05660099
026600                            PV-PO-NBR-DIGITS                      05670099
026700       PERFORM S100-SELECT-TPURCHS                                05680099
026800       IF PO-NBR-INVALID                                          05690099
026900          SET ERROR-FOUND TO TRUE                                 05700099
027000          SET INVALID-PO-NBR-ERR TO TRUE                          05710099
027100          MOVE WS010-ERROR-CODES TO WS-ERR-CDE(ERR-IDX)           05720099
027200          IF ERR-IDX < 15                                         05730099
027300             SET ERR-IDX UP BY 1                                  05740099
027400          END-IF                                                  05750099
027500       ELSE                                                       05760099
027600          IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'             05770099
027700             CONTINUE                                             05780099
027800          ELSE                                                    05790099
027900             SET ERROR-FOUND TO TRUE                              05800099
028000             SET NON-IMPORT-PO-NBR-ERR TO TRUE                    05810099
028100             MOVE WS010-ERROR-CODES TO WS-ERR-CDE(ERR-IDX)        05820099
028200             IF ERR-IDX < 15                                      05830099
028300                SET ERR-IDX UP BY 1                               05840099
028400             END-IF                                               05850099
028500          END-IF                                                  05860099
028600     END-IF.                                                      05870099
028700                                                                  05880099
028800  EJECT                                                           05890099
028900                                                                  05900099
029000*---------------------------------------------------------------* 05910099
029100* VALIDATE DATES.                                                 05920099
029200*---------------------------------------------------------------* 05930099
029300 C200-VALIDATE-DATE.                                              05940099
029400                                                                  05950099
029500** VALIDATING CUSTOMS-PAID-DATE                                   05960099
029600                                                                  05970099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(1:2)                  05980099
ST3292                                      TO WS-CST-CENTURY           05981099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(3:2)                  05990099
ST3292                                      TO WS-CST-YY                05991099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(5:2)                  06000099
ST3292                                      TO WS-CST-MM                06001099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(7:2)                  06010099
ST3292                                      TO WS-CST-DD                06011099
030100                                                                  06020099
030200     IF (WS-CUSTOM-DT = '00000000' OR SPACES OR LOW-VALUES)       06030099
030300        SET NO-CUSTOM-PAID-DT-ERR TO TRUE                         06040099
030400        MOVE WS010-ERROR-CODES    TO WS-ERR-CDE(ERR-IDX)          06050099
030500        SET ERROR-FOUND TO TRUE                                   06060099
030600        IF ERR-IDX < 15                                           06070099
030700           SET ERR-IDX UP BY 1                                    06080099
030800        END-IF                                                    06090099
030900     ELSE                                                         06100099
031000        MOVE ZEROES               TO WS-CCYYMMDD                  06110099
031100        MOVE WS-CUSTOM-DT         TO WS-CCYYMMDD                  06120099
031200        PERFORM G100-CHECK-DATE                                   06130099
031300        IF WS-DATE-INVALID                                        06140099
031400           SET  CUSTOM-PAID-DT-INVALID-ERR TO TRUE                06150099
031500           MOVE WS010-ERROR-CODES TO WS-ERR-CDE(ERR-IDX)          06160099
031600           SET ERROR-FOUND TO TRUE                                06170099
031700           IF ERR-IDX < 15                                        06180099
031800              SET ERR-IDX UP BY 1                                 06190099
031900           END-IF                                                 06200099
032000        END-IF                                                    06210099
032100     END-IF.                                                      06220099
032200                                                                  06230099
032300 EJECT                                                            06240099
032400*---------------------------------------------------------------* 06250099
032500* THIS PARA CHECKS FOR EXISTENCE OF DUPLICATE INVOICES OR         06260099
032600* ADJUSTMENTS.                                                    06270099
033100*---------------------------------------------------------------* 06280099
033200 C300-CHECK-FOR-DUPLICATES.                                       06290099
033300                                                                  06300099
ST3292     MOVE WS156-BROKER-REF-NBR(WS156-IDX) TO INVOIC-INVC-ID.      06310099
033500                                                                  06320099
033600     PERFORM S200-CHECK-TINVOIC-PO.                               06330099
033700                                                                  06340099
033800     IF  DUPL-PO-INV-FOUND                                        06350099
033900         SET DUPL-PO-INV-DB-ERR TO TRUE                           06360099
034000         MOVE WS010-ERROR-CODES  TO  WS-ERR-CDE(ERR-IDX)          06370099
034100         SET ERROR-FOUND TO TRUE                                  06380099
034200         IF ERR-IDX < 15                                          06390099
034300            SET ERR-IDX UP BY 1                                   06400099
034400         END-IF                                                   06410099
034500     END-IF.                                                      06420099
034600                                                                  06430099
034700     MOVE PV-PO-NBR-DIGITS TO PV-PO-NBR-CHAR.                     06440099
ST3292     STRING WS156-BROKER-REF-NBR(WS156-IDX) DELIMITED BY SPACE    06450099
034900            '-'                             DELIMITED BY SIZE     06460099
035000            PV-PO-NBR-CHAR-4                DELIMITED BY SIZE     06470099
035100            INTO INVOIC-INVC-ID.                                  06480099
035200                                                                  06490099
035300     PERFORM S200-CHECK-TINVOIC-PO.                               06500099
035400                                                                  06510099
035500     IF  DUPL-PO-INV-FOUND                                        06520099
035600         SET DUPL-PO-INV-DB-ERR TO TRUE                           06530099
035700         MOVE WS010-ERROR-CODES  TO  WS-ERR-CDE(ERR-IDX)          06540099
035800         SET ERROR-FOUND TO TRUE                                  06550099
035900         IF ERR-IDX < 15                                          06560099
036000            SET ERR-IDX UP BY 1                                   06570099
036100         END-IF                                                   06580099
036200     END-IF.                                                      06590099
036601                                                                  06600099
036602*PRB0062450 START                                                 06610099
036603     PERFORM S250-FORMAT-BRK-NBR.                                 06620099
036604*PRB0062450 END                                                   06630099
ST3292     IF WS156-EXPEDITORS(WS156-IDX)                               06640099
036606         MOVE PV-VND-EXPEDITORS  TO DK-VND-NBR                    06650099
036607     ELSE                                                         06660099
ST3292         IF WS156-LIVINGSTON(WS156-IDX)                           06670099
036609             MOVE PV-VND-LIVINGSTON                               06680099
036610                                 TO DK-VND-NBR                    06690099
036620         END-IF                                                   06700099
036630     END-IF.                                                      06710099
036800     PERFORM S300-CHECK-TADJRNL.                                  06720099
036900                                                                  06730099
037000     IF DUPL-ADJ-FOUND                                            06740099
037100        SET  DUPL-VND-BRK-ADJ-ERR  TO TRUE                        06750099
037200        MOVE WS010-ERROR-CODES     TO WS-ERR-CDE(ERR-IDX)         06760099
037300        SET ERROR-FOUND TO TRUE                                   06770099
037400        IF ERR-IDX < 15                                           06780099
037500           SET ERR-IDX UP BY 1                                    06790099
037600        END-IF                                                    06800099
037700     END-IF.                                                      06810099
037800                                                                  06820099
037900*    STRING AP156-INVOICE-NBR    DELIMITED BY SPACE               06830099
038000*           PC-PERCENTS          DELIMITED BY SIZE                06840099
038100*           INTO WS-BRK-FOR-LIKE-COND.                            06850099
038200*                                                                 06860099
038300*    PERFORM S300-CHECK-TADJRNL.                                  06870099
038400*                                                                 06880099
038500*    IF DUPL-ADJ-FOUND                                            06890099
038600*       SET  DUPL-PO-INV-DB-ERR TO TRUE                           06900099
038700*       MOVE WS010-ERROR-CODES  TO WS-ERR-CDE(ERR-IDX)            06910099
038710*       SET ERROR-FOUND TO TRUE                                   06920099
038720*       IF ERR-IDX < 15                                           06930099
038730*          SET ERR-IDX UP BY 1                                    06940099
038740*       END-IF                                                    06950099
038741*    END-IF.                                                      06960099
038759                                                                  06970099
038760*---------------------------------------------------------------* 06980099
038761* THIS CHECKS THAT A DUTY AMOUNT WAS SENT.                        06990099
038764*---------------------------------------------------------------* 07000099
038765 C350-VALIDATE-DUTY-AMOUNT.                                       07010099
038766                                                                  07020099
038767     IF (WS156-TOTAL-DUTY-AMT(WS156-IDX) IS NUMERIC OR            07030099
038768         WS156-TOTAL-DUTY-AMT(WS156-IDX) > ZEROS )                07040099
038769         CONTINUE                                                 07050099
038770     ELSE                                                         07060099
038771        SET ERROR-FOUND TO TRUE                                   07070099
038774        SET TOTAL-DUTY-AMT-ERR TO TRUE                            07080099
038775        MOVE WS010-ERROR-CODES TO WS-ERR-CDE(ERR-IDX)             07090099
038776        IF ERR-IDX < 15                                           07100099
038777           SET ERR-IDX UP BY 1                                    07110099
038778        END-IF                                                    07120099
038779     END-IF.                                                      07130099
038780 EJECT                                                            07140099
038781*---------------------------------------------------------------* 07150099
038782* THIS PARA CHECKS FOR EXISTENCE OF VALID ENTRY NUMBER/PO         07160099
038783* COMBINATION.  IF THIS ERROR IS FOUND, BUT NO OTHER ERRORS       07170099
038784* EXIST, THE INVOICE WILL BE RECYCLED INSTEAD OF REJECTED.        07180099
038788*---------------------------------------------------------------* 07190099
038789 C400-VALIDATE-ENTRY-NUMBER.                                      07200099
038790                                                                  07210099
ST3292     MOVE WS156-ENTRY-NBR(WS156-IDX)  TO WS-CSTM-ENTR-ID.         07220099
038793     MOVE WS-ENTRY-PREFIX      TO WS-ENTRY-ID-FIRST.              07230099
038794     MOVE WS-ENTRY-SUFFIX1     TO WS-ENTRY-ID-LAST1.              07240099
038795     MOVE WS-ENTRY-SUFFIX2     TO WS-ENTRY-ID-LAST2.              07250099
038796     MOVE WS-ENTRY-ID          TO IMCSPO-CSTM-ENTR-ID.            07260099
038797                                                                  07270099
038798     PERFORM S400-CHECK-ENTRY-NBR.                                07280099
038799                                                                  07290099
038800     IF NO-ENTRY-NBR-FOUND                                        07300099
038801        SET  INVALID-PO-ENTRY-ERR TO TRUE                         07310099
038802        MOVE WS010-ERROR-CODES  TO WS-ERR-CDE(ERR-IDX)            07320099
038803        IF ERROR-FOUND                                            07330099
038805           IF ERR-IDX < 15                                        07340099
038806              SET ERR-IDX UP BY 1                                 07350099
038807           END-IF                                                 07360099
038808        ELSE                                                      07370099
038809           SET RECYCLE-DUTY TO TRUE                               07380099
038810        END-IF                                                    07390099
038811     END-IF.                                                      07400099
038812 EJECT                                                            07410099
038813*---------------------------------------------------------------* 07420099
038814* WRITE OUT A RECORD TO THE AUDIT FILE.                           07430099
038815*---------------------------------------------------------------* 07440099
038816  C500-CREATE-OUTPUT-FILE.                                        07450099
038817                                                                  07460099
ST3292     IF WS156-EXPEDITORS(WS156-IDX)                               07470099
ST3292         MOVE PV-VND-EXPEDITORS    TO AP016-REMIT-TO-DUN-NBR      07480099
038820     ELSE                                                         07490099
ST3292         IF WS156-LIVINGSTON(WS156-IDX)                           07500099
038822             MOVE PV-VND-LIVINGSTON                               07510099
ST3292                                   TO AP016-REMIT-TO-DUN-NBR      07520099
038824         END-IF                                                   07530099
038825     END-IF.                                                      07540099
038827*    MOVE PV-VND-NBR            TO AP016-REMIT-TO-DUN-NBR.        07550099
ST3292     MOVE WS156-PO-NBR(WS156-IDX)  TO AP016-PO-NBR.               07560099
ST3292     MOVE 'APKUT441'               TO AP016-SRCPGM.               07570099
038830                                                                  07580099
ST3292     MOVE INVOIC-INVC-ID           TO AP016-INVC-ID.              07590099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(1:2)                  07600099
038832                                      TO WS-INVC-DTE-CC.          07601099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(3:2)                  07610099
038833                                      TO WS-INVC-DTE-YY.          07611099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(5:2)                  07620099
038834                                      TO WS-INVC-DTE-MM.          07621099
ST3292     MOVE WS156-CUSTOMS-PAID-DTE(WS156-IDX)(7:2)                  07630099
038835                                      TO WS-INVC-DTE-DD.          07631099
038836     MOVE '-' TO WS-DASH1                                         07640099
038837                 WS-DASH2.                                        07650099
ST3292     MOVE WS-INVC-DTE                 TO AP016-INVC-DTE.          07660099
ST3292     MOVE 'N'                         TO AP016-HOLD-IND.          07670099
ST3292     MOVE 'EE'                        TO AP016-ENTR-MTHD-CDE.     07680099
ST3292     MOVE WS156-TOTAL-DUTY-AMT(WS156-IDX)                         07690099
ST3292                                      TO AP016-INVC-NET-COST-AMT  07691099
ST3292     MOVE 'EN'                        TO AP016-STATUS-CDE.        07700099
038843                                                                  07710099
ST3292     MOVE WS156-INVOICE-NBR(WS156-IDX) TO AP016-BKR-REF-NBR.      07720099
ST3292     MOVE WS156-ENTRY-NBR(WS156-IDX)   TO AP016-IMPRT-ENTR-NBR.   07730099
ST3292     MOVE SPACES                       TO AP016-IMPRT-BOL-ID      07740099
ST3292                                          AP016-CONTAINER-NBR.    07750099
038848                                                                  07760099
038849     MOVE '05'                  TO AP016-TERM-TYP-CDE.            07770099
038850     MOVE '03'                  TO AP016-TERM-BASIS-DTE-CDE.      07780099
038851     MOVE '15'                  TO AP016-NET-DUE-DAY-QTY.         07790099
038852                                                                  07800099
038853     MOVE 'C'                   TO AP016-ALW-CHRG-TYP-CDE(1).     07810099
038854     MOVE 'DUT'                 TO AP016-ALW-CHRG-CDE(1).         07820099
ST3292     MOVE WS156-TOTAL-DUTY-AMT(WS156-IDX)                         07830099
ST3292                                TO AP016-ALW-CHRG-AMT(1).         07831099
038870                                                                  07840099
038880     PERFORM W100-WRITE-AUDIT-RECORD.                             07850099
038890 EJECT                                                            07860099
038900*---------------------------------------------------------------* 07870099
039000* WRITE OUT A RECORD TO THE REJECT FILE.                          07880099
039100*---------------------------------------------------------------* 07890099
039200 C600-CREATE-REJECT-RECORD.                                       07900099
039300                                                                  07910099
ST3292     MOVE WS156-PO-NBR(WS156-IDX)         TO AP158-PO-NBR.        07920099
ST3292     MOVE INVOIC-INVC-ID                  TO AP158-INVOICE-NBR.   07940099
ST3292     MOVE WS156-INVOICE-NBR(WS156-IDX)    TO AP158-BROKER-REF-NBR.07950099
ST3292     MOVE WS156-ENTRY-NBR(WS156-IDX)      TO AP158-ENTRY-NBR.     07970099
ST3292     IF WS156-EXPEDITORS(WS156-IDX)                               07980099
040320         MOVE PV-VND-EXPEDITORS  TO AP158-VENDOR-NBR              07990099
040330     ELSE                                                         08000099
ST3292         IF WS156-LIVINGSTON(WS156-IDX)                           08010099
040350             MOVE PV-VND-LIVINGSTON                               08020099
040351                                 TO AP158-VENDOR-NBR              08030099
040360         END-IF                                                   08040099
040370     END-IF.                                                      08050099
040400*    MOVE PV-VND-NBR             TO AP158-VENDOR-NBR.             08060099
040500     MOVE WS-CCYYMMDD            TO AP158-INVC-DTE.               08070099
ST3292     MOVE WS156-TOTAL-DUTY-AMT(WS156-IDX) TO AP158-TOTAL-DUTY-AMT.08080099
040700     MOVE 'DUT'                  TO AP158-CHARGE-CDE.             08090099
040800                                                                  08100099
040900     PERFORM D100-POPULATE-REJECT-ERRORS                          08110099
041000        VARYING ERR-IDX FROM 1 BY 1                               08120099
041100          UNTIL ERR-IDX > 15                                      08130099
041200             OR WS-ERR-CDE(ERR-IDX) = ZERO                        08140099
041300             OR AP158-IDX > 15.                                   08160099
041400                                                                  08161099
041500     PERFORM W200-WRITE-REJECT-RECORD.                            08170099
041600                                                                  08180099
041700 EJECT                                                            08190099
041710*---------------------------------------------------------------* 08200099
041720* CHECK IF RECYCLE HAS EXCEEDED MAX RECYCLE DAYS.  IF SO, WRITE   08210099
041721* TO REJECT FILE.  IF NOT, WRITE TO RECYCLE FILE.                 08220099
041730*---------------------------------------------------------------* 08230099
041740 C700-CREATE-RECYCLE-RECORD.                                      08240099
041750                                                                  08250099
ST3292     IF  WS156-RECYCLE-COUNT(WS156-IDX) NUMERIC                   08260099
ST3292         ADD 1 TO WS156-RECYCLE-COUNT(WS156-IDX)                  08270099
041753     ELSE                                                         08280099
ST3292         MOVE ZERO TO WS156-RECYCLE-COUNT(WS156-IDX)              08290099
041755     END-IF.                                                      08300099
041756                                                                  08310099
041756                                                                  08312099
ST3292     IF  WS156-RECYCLE-COUNT(WS156-IDX) > WS-MAX-RECYCLE-DAYS     08320099
041770         PERFORM C600-CREATE-REJECT-RECORD                        08330099
041780     ELSE                                                         08340099
041808         PERFORM W300-WRITE-RECYCLE-RECORD                        08350099
041809     END-IF.                                                      08360099
041810 EJECT                                                            08370099
041820*---------------------------------------------------------------* 08380099
041900* POPULATE THE REJECT ERRORS TO THE REJECT FILE.                  08390099
042000*---------------------------------------------------------------* 08400099
042100 D100-POPULATE-REJECT-ERRORS.                                     08410099
042200                                                                  08420099
042300     MOVE WS-ERR-CDE(ERR-IDX) TO AP158-ERR-CDE(AP158-IDX).        08430099
042400     SET AP158-IDX UP BY 1.                                       08440099
042500                                                                  08450099
042600*---------------------------------------------------------------  08460099
042700*  CALL DATE ROUTINE TO VALIDATE THE DATE                         08470099
042800*---------------------------------------------------------------  08480099
042900 G100-CHECK-DATE.                                                 08490099
043000                                                                  08500099
043100     IF WS-CCYYMMDD > '00000000'                                  08510099
043200        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    08520099
043300        SET DPG52-LK-DTE-ISO           TO TRUE                    08530099
043400        MOVE WS-CCYYMMDD               TO DPG52-LK-DATE-INPUT     08540099
043500                                                                  08550099
043600        CALL  DP500-KOHLS-CALENDAR-ROUTINE USING                  08560099
043700                                          DPG51 DPG52 DPG53       08570099
043800                                          DPG54 DPG55 DPG56       08580099
043900                                                                  08590099
044000        IF (DPG54-SEVERE-ERROR                                    08600099
044100        OR DPG54-WARNING-ERROR)                                   08610099
044200            SET WS-DATE-INVALID TO TRUE                           08620099
044300        ELSE                                                      08630099
044400            SET WS-DATE-VALID TO TRUE                             08640099
044500        END-IF                                                    08650099
044600     END-IF.                                                      08660099
044700                                                                  08670099
044800 EJECT                                                            08680099
044900*---------------------------------------------------------------* 08690099
045000* READ THE EDI 210 INVOICE FILE.                                  08700099
045100*---------------------------------------------------------------* 08710099
045200 R100-READ-DUTY-FEE-INPUT.                                        08720099
045300                                                                  08730099
045500     READ DUTY-INPUT-FILE INTO AP156-DUTY-INVC-RECORD             08740099
045600          AT END                                                  08750099
045700             SET END-OF-DUTY-IN TO TRUE.                          08760099
045800                                                                  08770099
045900     IF NOT END-OF-DUTY-IN                                        08780099
046000        ADD 1 TO WS-INPUT-REC-CNT                                 08790099
046100     END-IF.                                                      08800099
046200                                                                  08810099
046300 EJECT                                                            08820099
046400                                                                  08830099
046500*----------------------------------------------------------------*08840099
046600 S100-SELECT-TPURCHS.                                             08850099
046700                                                                  08860099
046800     EXEC SQL                                                     08870099
046900          SELECT PO_TYP_CDE                                       08880099
047000          INTO  :PURCHS-PO-TYP-CDE                                08890099
047100          FROM  TPURCHS                                           08900099
047200          WHERE PO_NBR         = :PV-PO-NBR                       08910099
047300            AND VER_STATUS_CDE = 'A'                              08920099
047400     END-EXEC                                                     08930099
047500                                                                  08940099
047600     EVALUATE TRUE                                                08950099
047700        WHEN SQLCODE = ZEROS                                      08960099
047800             SET PO-NBR-VALID TO TRUE                             08970099
047810        WHEN SQLCODE = +100                                       08980099
047820             SET PO-NBR-INVALID TO TRUE                           08990099
047830        WHEN OTHER                                                09000099
047840             MOVE 'S100-SELECT-TPURCHS' TO WS-ABEND-PARAGRAPH     09010099
047850             MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION     09020099
047860             MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1              09030099
047870             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              09040099
047880             PERFORM Z999-SQL-ERROR                               09050099
047890     END-EVALUATE.                                                09060099
047900                                                                  09070099
047901*----------------------------------------------------------------*09080099
047902*    CHECKS FOR DUPLICATE PO/INVOICE ON TINVOIC TABLE.           *09090099
047903*----------------------------------------------------------------*09100099
047904 S200-CHECK-TINVOIC-PO.                                           09110099
047905                                                                  09120099
047906     EXEC SQL                                                     09130099
047907       SELECT '1'                                                 09140099
047908         INTO :PV-ONE                                             09150099
047909         FROM SYSIBM.SYSDUMMY1 X                                  09160099
047910        WHERE EXISTS                                              09170099
047920              (SELECT 1                                           09180099
047930                 FROM TINVOIC                                     09190099
047940                 WHERE PO_NBR  = :PV-PO-NBR                       09200099
047950                   AND INVC_ID = :INVOIC-INVC-ID)                 09210099
047960     END-EXEC                                                     09220099
047961                                                                  09230099
047962     EVALUATE TRUE                                                09240099
047963         WHEN SQLCODE = ZERO                                      09250099
047964              SET DUPL-PO-INV-FOUND  TO TRUE                      09260099
047965         WHEN SQLCODE = +100                                      09270099
047966              SET NO-DUPL-PO-INV-FOUND TO TRUE                    09280099
047967         WHEN SQLWARN0 NOT = SPACES                               09290099
047968         WHEN SQLCODE  NOT = ZERO                                 09300099
047969              MOVE 'S200-CHECK-TINVOIC-PO' TO WS-ABEND-PARAGRAPH  09310099
047970              MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION    09320099
047980              MOVE 'TINVOIC'  TO WS-ABEND-STRUCTURE-1             09330099
047981              MOVE  SPACES    TO WS-ABEND-STRUCTURE-2             09340099
047982              PERFORM Z999-SQL-ERROR                              09350099
047983     END-EVALUATE.                                                09360099
047984                                                                  09370099
047985  EJECT                                                           09380099
047986*----------------------------------------------------------------*09390099
047987*PRB0062450 START                                                 09400099
047988*----------------------------------------------------------------*09410099
047989* FORMATS THE BROKER NUMBER BEFORE DUPLICATE CHECK IN S300       *09420099
047990*----------------------------------------------------------------*09430099
047991 S250-FORMAT-BRK-NBR.                                             09440099
047992                                                                  09450099
ST3292     MOVE LENGTH OF WS156-BROKER-REF-NBR(WS156-IDX)               09462099
ST3292                                               TO PV-ADJ-START.   09462199
ST3292     PERFORM UNTIL WS156-BROKER-REF-NBR(WS156-IDX)(PV-ADJ-START:1)09470099
ST3292                       > SPACES                                   09471099
047995                   OR  PV-ADJ-START = +0                          09480099
047996           COMPUTE PV-ADJ-START = PV-ADJ-START - 1                09490099
047997     END-PERFORM.                                                 09500099
047998                                                                  09510099
047999     IF PV-ADJ-START <= 8                                         09520099
048000         MOVE +1 TO PV-ADJ-START                                  09530099
048001     ELSE                                                         09540099
048002         SUBTRACT +7 FROM PV-ADJ-START                            09550099
048003     END-IF.                                                      09560099
048004                                                                  09570099
ST3292     STRING WS156-BROKER-REF-NBR(WS156-IDX)(PV-ADJ-START:8)       09581099
048006                                 DELIMITED BY SPACE               09590099
048007            PC-PERCENTS          DELIMITED BY SIZE                09600099
048009            INTO WS-BRK-FOR-LIKE-COND.                            09610099
048013*PRB0062450 END                                                   09620099
048014*---------------------------------------------------------------- 09630099
048015* CHECKS FOR DUPLICATE BROKER/INVOICE ON TADJRNL TABLE.           09640099
048016*-----------------------------------------------------------------09650099
048017  S300-CHECK-TADJRNL.                                             09660099
048018                                                                  09670099
048019     EXEC SQL                                                     09680099
048020          SELECT COUNT(*)                                         09690099
048021            INTO :PV-ADJRNL-COUNT                                 09700099
048022            FROM TADJRNL                                          09710099
048023           WHERE DOC_NBR LIKE :WS-BRK-FOR-LIKE-COND               09720099
048024             AND VND_NBR    = :DK-VND-NBR                         09730099
048025*            AND VND_NBR    = :PV-VND-NBR                         09740099
048026             AND PO_NBR     = :PV-PO-NBR                          09750099
048029     END-EXEC.                                                    09760099
048030                                                                  09770099
048031     EVALUATE TRUE                                                09780099
048032*PRB0062450 START                                                 09790099
048034        WHEN PV-ADJRNL-COUNT = 0                                  09800099
048035             SET NO-DUPL-ADJ-FOUND TO TRUE                        09810099
048036             CONTINUE                                             09820099
048037                                                                  09830099
048038        WHEN PV-ADJRNL-COUNT > 0                                  09840099
048039             SET DUPL-ADJ-FOUND TO TRUE                           09850099
048043*PRB0062450 END                                                   09860099
048049         WHEN SQLWARN0 NOT = SPACES                               09870099
048050         WHEN SQLCODE  NOT = ZERO                                 09880099
048051              MOVE 'S300-CHECK-TADJRNL' TO WS-ABEND-PARAGRAPH     09890099
048052              MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION    09900099
048053              MOVE 'TADJRNL' TO WS-ABEND-STRUCTURE-1              09910099
048054              MOVE SPACES    TO WS-ABEND-STRUCTURE-2              09920099
048055              PERFORM Z999-SQL-ERROR                              09930099
048056     END-EVALUATE.                                                09940099
048057                                                                  09950099
048058 EJECT                                                            09960099
048059                                                                  09970099
048060*---------------------------------------------------------------  09980099
048061* CHECK FOR ENTRY NUMBER                                          09990099
048062*---------------------------------------------------------------  10000099
048063 S400-CHECK-ENTRY-NBR.                                            10010099
048064                                                                  10020099
048070     EXEC SQL                                                     10030099
048080       SELECT '1'                                                 10040099
048090         INTO  :PV-ONE                                            10050099
048100         FROM SYSIBM.SYSDUMMY1 X                                  10060099
048110        WHERE EXISTS                                              10070099
048111              (SELECT 1                                           10080099
048112                 FROM TIMCSPO A,                                  10090099
048113                      TIMCSEN B                                   10100099
048114                WHERE A.PO_NBR = :PV-PO-NBR                       10110099
048115                  AND A.CSTM_ENTR_ID = :IMCSPO-CSTM-ENTR-ID       10120099
048116                  AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID             10130099
048117                  AND X.IBMREQD = X.IBMREQD)                      10140099
048118             END-EXEC.                                            10150099
048119                                                                  10160099
048120     EVALUATE TRUE                                                10170099
048121         WHEN SQLCODE = ZERO                                      10180099
048122              SET ENTRY-NBR-FOUND TO TRUE                         10190099
048123         WHEN SQLCODE = +100                                      10200099
048124              SET NO-ENTRY-NBR-FOUND TO TRUE                      10210099
048125         WHEN SQLWARN0 NOT = SPACES                               10220099
048126         WHEN SQLCODE  NOT = ZERO                                 10230099
048127              MOVE 'S400-CHECK-ENTRY-NBR' TO WS-ABEND-PARAGRAPH   10240099
048128              MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION    10250099
048129              MOVE 'TIMCSPO ' TO WS-ABEND-STRUCTURE-1             10260099
048130              MOVE 'TIMCSEN ' TO WS-ABEND-STRUCTURE-2             10270099
048140              PERFORM Z999-SQL-ERROR                              10280099
048141     END-EVALUATE.                                                10290099
048142                                                                  10300099
048143 EJECT                                                            10310099
048144*---------------------------------------------------------------* 10320099
048145* OUTPUT FILE WRITE PARAGRAPHS                                    10330099
048146*---------------------------------------------------------------* 10340099
048147 W100-WRITE-AUDIT-RECORD.                                         10350099
048148                                                                  10360099
048149     WRITE DUTY-OUTPUT-RECORD FROM AP016-INVOICE-LOAD-RECORD.     10370099
048150                                                                  10380099
048160     ADD 1 TO WS-AUDIT-COUNT.                                     10390099
048170                                                                  10400099
048180                                                                  10410099
048181 W200-WRITE-REJECT-RECORD.                                        10420099
048182                                                                  10430099
048183     WRITE REJECT-DUTY-RECORD FROM AP158-REJECT-DUTY-INVOICE.     10440099
048184                                                                  10450099
048185     ADD 1 TO WS-REJECT-COUNT.                                    10460099
048186 EJECT                                                            10470099
048187 W300-WRITE-RECYCLE-RECORD.                                       10480099
048188                                                                  10490099
ST3292     WRITE DUTY-RECYCLE-RECORD FROM                               10501099
ST3292                               WS156-WORK-TABLE (WS156-IDX).      10510099
048191     ADD 1 TO WS-RECYCLE-COUNT.                                   10520099
048192 EJECT                                                            10530099
048193*----------------------------------------------------------------*10540099
048194* Z998-ABEND                                                     *10550099
048195*  ABEND ROUTINE.                                                *10560099
048196*----------------------------------------------------------------*10570099
048197 Z998-ABEND.                                                      10580099
048198                                                                  10590099
048199     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 10600099
048200     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               10610099
048201     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               10620099
048202                                                                  10630099
048203     CALL 'ILBOABN0' USING ABEND-CODE.                            10640099
048204 EJECT                                                            10650099
048205*---------------------------------------------------------------* 10660099
048206* PROCESS DB2 ABENDS.                                             10670099
048207*---------------------------------------------------------------* 10680099
048208 Z999-SQL-ERROR.                                                  10690099
048209                                                                  10700099
048210     DISPLAY '*** DB2 ERROR '.                                    10710099
048211     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 10720099
048212     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               10730099
048213     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               10740099
048214     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             10750099
048215     IF WS-ABEND-STRUCTURE-2 > SPACES                             10760099
048216         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         10770099
048217                                                                  10780099
048220     MOVE +4013                    TO ABEND-CODE.                 10790099
048300                                                                  10800099
048400     COPY DPPD004.                                                10810099
048500     CALL 'ILBOABN0' USING ABEND-CODE.                            10820099
