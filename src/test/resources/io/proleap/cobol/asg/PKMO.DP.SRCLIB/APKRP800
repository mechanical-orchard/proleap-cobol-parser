000200 IDENTIFICATION DIVISION.                                         00020005
000300 PROGRAM-ID.     APKRP800.                                        00030005
000400 AUTHOR.         M WILKINSON.                                     00040005
000500*DATE-WRITTEN.   FEB 02, 1995.                                    00050005
000600*DATE-COMPILED.                                                   00060005
000700****************************************************************  00070017
000800* COBOL II WITH SQL                                            *  00080017
000900*--------------------------------------------------------------*  00090017
001000* EDI BULK/STORE COMBINATION REPORT PROGRAM                    *  00100017
001200*--------------------------------------------------------------*  00120017
001300* INPUT:                                                       *  00130017
001320*  1. EXTERNAL ENTERPRISE TABLE                  (TEXTENT)     *  00132017
001330*  2. EXTERNAL ENTERPRISE NAME TABLE             (TENTNME)     *  00133017
001393*  3. TRADING PARTNER TABLE                      (TTRDPRT)     *  00139317
001398*  4. EDI RECYCLED TRANSMISSION RECORDS          (APRD056)     *  00139817
001399*                                                              *  00139917
001400* OUTPUT:                                                      *  00140017
001401*  1. EDI BULK/STORE COMBINATION REPORT          (APWS132)     *  00140117
001404*--------------------------------------------------------------*  00140417
001410* CHANGE LOG:                                                  *  00141017
001500*                                                              *  00150017
001600* 12/15/97    BY MIKE BESKE                    WR #: 5091      *  00160017
001700*             CHANGED '++INCLUDE TO 'COPY' AS PART OF THE      *  00170017
001800*             Y2K SPECS.                                       *  00180017
001900*                                                              *  00190017
002000* 02/02/2000 JILL JUEL                      WR#: 20626         *  00200017
002100*            - RECOMPILED PROGRAM. CHANGES WERE MADE TO        *  00210017
002200*              APRD050, APRD051, APRD052, AND APRD056 BY       *  00220017
002300*              THE EDI TEAM.                                   *  00230017
002400*                                                              *  00240017
002500* DATE  05/15/2003                                             *  00250017
002600*     CHANGE MADE: NI-SKU PROJECT.                             *  00260017
002700*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).               *  00270017
002800*     MADE BY: MIKE BESKE              WR/IR #: WR22557        *  00280017
002900*                                                              *  00290017
003000* DATE  07/22/2003                                             *  00300017
003100*     CHANGE MADE: COMPOUND PREPACK EDI PROJECT                *  00310017
003200*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).               *  00320017
003300*     MADE BY: MIKE BESKE              WR/IR #: WR24685        *  00330017
003400*                                                              *  00340017
003500* DATE  03/29/2004                                             *  00350017
003600*     CHANGE MADE: INCREASED THE SIZE FOR THE STORE NUMBERS    *  00360017
003700*     IN DL-DETAIL-LINE1 FROM 3 TO 5.                          *  00370017
003800*     MADE BY: MIKE BESKE              WR/IR #: WR25805        *  00380017
003900*                                                              *  00390017
003910* DATE  03/11/2007                                             *  00391017
003920*     CHANGE MADE: FOR MATCH BY DC REMOVED LOGIC FOR STR       *  00392017
003930*     DISPLAY AND ADDED MATCH LEVEL                            *  00393017
003940*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR21578        *  00394017
003950*                                                              *  00395017
003960* DATE  03/18/2007                                             *  00396017
003970*     CHANGE MADE: FOR MATCH BY DC REMOVED LOGIC FOR STR       *  00397017
003980*     DISPLAY AND ADDED MATCH LEVEL                            *  00398017
003990*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR21578        *  00399017
003991*                                                              *  00399117
003992* DATE  04/06/2007                                             *  00399233
003993*     CHANGE MADE: ADDED LOGIC TO PARAGRAPH B200-PROCESS TO    *  00399332
003994*     ONLY PERFORM THE S100-FETCH-TRDPRT-CURSOR ROUTINE WHEN   *  00399432
003995*     THE VENDOR NAME AND NUMBER ON THE INPUT FILE ARE BLANK.  *  00399536
003996*     MADE BY: KRYSTEN LEARY           WR/IR #: P001003792     *  00399620
003997*                                                              *  00399717
003998* DATE  04/17/2007                                             *  00399840
003999*     CHANGE MADE: MOVED THE VALUE OF THE AP056-SORT-LOC INPUT *  00399938
004000*     FIELD INTO THE REPORT DL-LOC FIELD.  THE DL-LOC FIELD ON *  00400038
004002*     THE REPORT WAS PREVIOUSLY BEING POPULATED WITH ZEROS.    *  00400238
004003*     MADE BY: KRYSTEN LEARY           WR/IR #: P001008392     *  00400339
004005*                                                              *  00400538
004006* DATE  11/06/2014                                             *  00400641
004007*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                  *  00400741
004008*     EXTENDED PO# FROM 7 TO 9.                                *  00400941
004009*     MADE BY: COGNIZANT               WR/IR #: CHG0094517     *  00401041
004010*                                                              *  00401141
004020****************************************************************  00402041
004100 ENVIRONMENT DIVISION.                                            00410005
004400                                                                  00440005
004500 CONFIGURATION SECTION.                                           00450005
004600                                                                  00460005
004700 SOURCE-COMPUTER. IBM-3090.                                       00470005
004900 OBJECT-COMPUTER. IBM-3090.                                       00490005
005000                                                                  00500005
005100 INPUT-OUTPUT SECTION.                                            00510005
005200                                                                  00520005
005300 FILE-CONTROL.                                                    00530005
005400                                                                  00540005
005500      SELECT EDI-RECYCLE-FILE   ASSIGN TO INP01.                  00550005
005700      SELECT EDI-REPORT         ASSIGN TO RPT01.                  00570017
005800                                                                  00580005
006200 DATA DIVISION.                                                   00620005
006600 FILE SECTION.                                                    00660005
006700                                                                  00670005
006800 FD  EDI-RECYCLE-FILE                                             00680005
006900     RECORDING MODE IS F                                          00690021
007000     LABEL RECORDS ARE STANDARD                                   00700005
007100     BLOCK CONTAINS 0 RECORDS                                     00710005
007200     DATA RECORD IS EDI-RECORD.                                   00720005
007400 01  EDI-RECORD                  PIC X(370).                      00740005
007500                                                                  00750005
007600 FD  EDI-REPORT                                                   00760005
007700     RECORDING MODE IS F                                          00770005
007800     LABEL RECORDS ARE STANDARD                                   00780005
007900     RECORD CONTAINS 132 CHARACTERS                               00790005
008000     BLOCK CONTAINS 0 RECORDS                                     00800005
008100     DATA RECORD IS EDI-LINE.                                     00810005
008300 01  EDI-LINE                    PIC X(132).                      00830005
008400                                                                  00840005
008800 WORKING-STORAGE SECTION.                                         00880005
009000*--------------------------------------------------------------*  00900017
009100* STANDARD HEADER 132 COLUMNS                                  *  00910017
009200*--------------------------------------------------------------*  00920017
009400     COPY DPWS132O.                                               00940005
009500                                                                  00950017
009600*--------------------------------------------------------------*  00960017
009700* EDI RECYCLE REPORT FILE LAYOUT                               *  00970017
009800*--------------------------------------------------------------*  00980017
010000 01  WS-EDI-RECYCLE-REC.                                          01000005
010100     COPY APRD056.                                                01010005
010200                                                                  01020017
010310*----------------------------------------------------------------*01031017
010320* SQLCA FORMATTED MESSAGE AREA                                   *01032017
010330*----------------------------------------------------------------*01033017
010400     COPY DPWS004.                                                01040005
010600                                                                  01060017
010700*----------------------------------------------------------------*01070017
010800* COMMUNICATIONS AREA2 FOR DB2                                   *01080017
010900*----------------------------------------------------------------*01090017
011000     COPY SQLCA2.                                                 01100005
011010                                                                  01101017
011100*----------------------------------------------------------------*01110017
011200* DB2 AREA FOR COMMUNICATIONS                                    *01120017
011300*----------------------------------------------------------------*01130017
011400     EXEC SQL                                                     01140005
011500          INCLUDE SQLCA                                           01150005
011600     END-EXEC.                                                    01160005
011610                                                                  01161017
011620*----------------------------------------------------------------*01162017
011630* EXTERNAL ENTERPRISE TABLE                                      *01163017
011640*----------------------------------------------------------------*01164017
011800     EXEC SQL                                                     01180005
011900          INCLUDE TEXTENT                                         01190005
012000     END-EXEC.                                                    01200005
012100                                                                  01210017
012210*----------------------------------------------------------------*01221017
012220* EXTERNAL ENTERPRISE NAME TABLE                                 *01222017
012230*----------------------------------------------------------------*01223017
012300     EXEC SQL                                                     01230005
012400          INCLUDE TENTNME                                         01240005
012500     END-EXEC.                                                    01250005
012600                                                                  01260017
012610*----------------------------------------------------------------*01261017
012620* TRADING PARTNER TABLE                                          *01262017
012630*----------------------------------------------------------------*01263017
012900     EXEC SQL                                                     01290005
013000          INCLUDE TTRDPRT                                         01300005
013100     END-EXEC.                                                    01310005
013200                                                                  01320017
013210*----------------------------------------------------------------*01321017
013220* TRDPRT_CSR: RETURNS THE VENDOR NUMBER AND NAME                 *01322017
013230*----------------------------------------------------------------*01323017
013500     EXEC SQL                                                     01350005
013600          DECLARE TRDPRT_CSR CURSOR FOR                           01360005
013700            SELECT B.ENT_NAME_DESC                                01370005
013800                 , C.DUN_NBR                                      01380005
013900              FROM TTRDPRT A                                      01390020
014100                 , TENTNME B                                      01410020
014200                 , TEXTENT C                                      01420020
014400          WHERE A.VEND_INCHG_ID      = :TRDPRT-VEND-INCHG-ID      01440020
014500            AND A.VEND_INCHG_ID_DESC = :TRDPRT-VEND-INCHG-ID-DESC 01450005
014600            AND A.ENT_ID             = B.ENT_ID                   01460020
014700            AND B.ENT_ID             = C.ENT_ID                   01470020
014800            AND C.STATUS_CDE         = 'A'                        01480020
014900            AND B.TYPE_CDE           = '01'                       01490020
015000         FOR FETCH ONLY                                           01500005
015100     END-EXEC.                                                    01510005
015110                                                                  01511017
016010*----------------------------------------------------------------*01601017
016020* REPORT HEADING LINES                                           *01602017
016030*----------------------------------------------------------------*01603017
016200 01  HL-HEADING-LINE1.                                            01620005
016300     05  FILLER                  PIC X(50)     VALUE SPACES.      01630005
016400     05  FILLER                  PIC X(30)     VALUE              01640005
016500         '  LOCATION COMBINATION REPORT '.                        01650020
016600     05  FILLER                  PIC X(05)     VALUE SPACES.      01660005
016700     05  HEADER-TYPE             PIC X(25)     VALUE SPACES.      01670005
016800     05  FILLER                  PIC X(20)     VALUE SPACES.      01680005
016900                                                                  01690005
017000 01  HL-HEADING-LINE2.                                            01700005
017100     05  HL2-ENT-ID-DESC         PIC X(30)     VALUE SPACES.      01710005
017200     05  FILLER                  PIC X(02)     VALUE SPACES.      01720005
017300     05  FILLER                  PIC X(15)     VALUE              01730005
017400         'VENDOR DUN NO: '.                                       01740005
017500     05  HL2-VENDOR-NBR          PIC 999999999.                   01750005
017600     05  FILLER                  PIC X(05)     VALUE SPACES.      01760005
017700     05  FILLER                  PIC X(22)     VALUE              01770005
017800         'INVOICE NUMBER        '.                                01780005
017900     05  FILLER                  PIC X(05)     VALUE SPACES.      01790005
018000     05  FILLER                  PIC X(07)     VALUE 'PO #:  '.   01800005
018100     05  FILLER                  PIC X(05)     VALUE SPACES.      01810005
018200     05  FILLER                  PIC X(07)     VALUE 'LOC #: '.   01820011
018300     05  FILLER                  PIC X(05)     VALUE SPACES.      01830012
018310     05  FILLER                  PIC X(08)     VALUE 'MTCH LVL'.  01831012
018320     05  FILLER                  PIC X(12)     VALUE SPACES.      01832012
018400                                                                  01840005
018410*----------------------------------------------------------------*01841017
018420* REPORT DETAIL LINES                                            *01842017
018430*----------------------------------------------------------------*01843017
018500 01  DL-DETAIL-LINE1.                                             01850005
018600     05  FILLER                  PIC X(61)     VALUE SPACES.      01860005
018700     05  DL-INVOICE-NBR          PIC X(22)     VALUE SPACES.      01870005
018800     05  FILLER                  PIC X(05)     VALUE SPACES.      01880005
018900     05  DL-PO-NBR               PIC ZZZZZZZZ9.                   01890042
019000     05  FILLER                  PIC X(04)     VALUE SPACES.      01900041
019100     05  DL-LOC                  PIC ZZ999     VALUE ZERO.        01910013
019200     05  FILLER                  PIC X(09)     VALUE SPACES.      01920012
019210     05  DL-MTCH-LVL             PIC X(01)     VALUE SPACES.      01921012
019220     05  FILLER                  PIC X(07)     VALUE SPACES.      01922013
019300     05  DL-REPORT-IND           PIC X(05)     VALUE SPACES.      01930005
019400     05  FILLER                  PIC X(04)     VALUE SPACES.      01940013
019500                                                                  01950005
019510*----------------------------------------------------------------*01951017
019520* END OF REPORT LINE                                             *01952017
019530*----------------------------------------------------------------*01953017
019540 01  EOR-END-OF-REPORT-LINE.                                      01954017
019550     05  FILLER                  PIC X(37)     VALUE SPACES.      01955017
019560     05  FILLER                  PIC X(25)     VALUE              01956017
019570             'E N D   O F   R E P O R T'.                         01957017
019580     05  FILLER                  PIC X(88)     VALUE SPACES.      01958017
019590                                                                  01959017
019591*----------------------------------------------------------------*01959117
019592* NO DATA TO REPORT LINE                                         *01959217
019593*----------------------------------------------------------------*01959317
019600 01  NO-DATA-LINE.                                                01960005
019700     05  FILLER                  PIC X(44)     VALUE SPACES.      01970005
019800     05  FILLER                  PIC X(41)     VALUE              01980005
019900             ' NO LOC DIFFERENCES INVOICES FOR THIS RUN'.         01990011
020000     05  FILLER                  PIC X(46)     VALUE SPACES.      02000005
020100                                                                  02010005
021100 01  REPORT-CONTROLS.                                             02110018
021600     05  LINE-COUNT             PIC S9(03)    VALUE ZEROES COMP-3.02160018
021700     05  PAGE-COUNT             PIC S9(06)    VALUE ZEROES COMP-3.02170018
021800     05  MAX-LINE-COUNT         PIC S9(03)    VALUE +60 COMP-3.   02180018
021801     05  BLANK-LINE             PIC X(132)    VALUE SPACES.       02180125
021802                                                                  02180218
021810 01  PC-PROGRAM-CONSTANTS.                                        02181018
021820     05  PC-PROGRAM-NAME         PIC X(08)     VALUE 'APKRP800'.  02182018
021821     05  PC-MAX-RETRIES          PIC 9(02)     VALUE 3.           02182124
021830                                                                  02183018
021840 01  PV-PROGRAM-VARIABLES.                                        02184018
022000     05 PV-RETRY-COUNTER         PIC 9(02)     VALUE ZEROS.       02200018
024400     05 PV-SAVE-EDI-SENDER-ID    PIC X(15)     VALUE SPACES.      02440018
024500     05 REPORT-TYPE-CONTROL      PIC X(01)     VALUE SPACE.       02450018
024700                                                                  02470017
024800 01  PROGRAM-SWITCHES.                                            02480018
024900     05  PS-EDI-RECYCLE-EOF-SW   PIC X(01)     VALUE 'N'.         02490018
025000         88 EDI-RECYCLE-EOF                    VALUE 'Y'.         02500018
025010         88 EDI-RECYCLE-NOT-EOF                VALUE 'N'.         02501021
025320     05  PS-VENDOR-FOUND-SW      PIC X(01)     VALUE 'N'.         02532021
025330         88 VENDOR-FOUND                       VALUE 'Y'.         02533021
025340         88 VENDOR-NOT-FOUND                   VALUE 'N'.         02534021
025400                                                                  02540005
025500 01  DATE-WORK-AREA.                                              02550018
026000     05 SYSTEM-DATE              PIC 9(06)     VALUE ZEROS.       02600018
026010     05 FILLER REDEFINES SYSTEM-DATE.                             02601018
026020        10 SYSTEM-YEAR           PIC 9(02).                       02602024
026030        10 SYSTEM-MONTH          PIC 9(02).                       02603024
026040        10 SYSTEM-DAY            PIC 9(02).                       02604024
026400     05 SYSTEM-TIME              PIC 9(08)     VALUE ZEROS.       02640018
026500     05 FILLER REDEFINES SYSTEM-TIME.                             02650018
026600        10 SYSTEM-HOUR           PIC 9(02).                       02660024
026700        10 SYSTEM-MINUTE         PIC 9(02).                       02670024
026800        10 FILLER                PIC 9(04).                       02680024
026900                                                                  02690005
027000*----------------------------------------------------------------*02700018
027100* DB2 ABEND AREA                                                 *02710018
027110*----------------------------------------------------------------*02711018
027120 01  ABEND-CODE                  PIC S9(4) COMP SYNC VALUE ZERO.  02712020
027140     88 AP-TABLE-FULL                      VALUE +4004.           02714020
027150     88 AP-EMPTY-FILE                      VALUE +4005.           02715020
027160     88 AP-DB2-ERROR                       VALUE +4013.           02716020
027170                                                                  02717018
027180 01  WS-ABEND-FILEDS.                                             02718018
027190     05  WS-ABEND-PROGRAM        PIC X(8)  VALUE 'APKRP800'.      02719020
027191     05  WS-ABEND-PARAGRAPH      PIC X(50) VALUE SPACES.          02719120
027192     05  WS-ABEND-OPERATION      PIC X(50) VALUE SPACES.          02719220
027193     05  WS-ABEND-STRUCTURE-1    PIC X(8)  VALUE SPACES.          02719320
027194     05  WS-ABEND-STRUCTURE-2    PIC X(8)  VALUE SPACES.          02719420
027200                                                                  02720018
027210*----------------------*                                          02721033
027300 PROCEDURE DIVISION.                                              02730005
027400*----------------------*                                          02740033
027600 A000-MAIN-DRIVER.                                                02760005
027700                                                                  02770017
028600     PERFORM B100-HOUSEKEEPING.                                   02860019
028900     PERFORM B200-PROCESS                                         02890023
029000       UNTIL EDI-RECYCLE-EOF.                                     02900023
029200     PERFORM B300-END-OF-JOB.                                     02920019
029400     STOP RUN.                                                    02940019
029500                                                                  02950005
029601*--------------------------------------------------------------*  02960119
029602* PERFORM ALL DATE ROUTINES, FILE OPENS, ETC                   *  02960219
029603*--------------------------------------------------------------*  02960319
029604 B100-HOUSEKEEPING.                                               02960419
029605                                                                  02960519
029606     ACCEPT SYSTEM-DATE FROM DATE.                                02960619
029607     MOVE SYSTEM-YEAR                    TO DP132O-RUN-YEAR.      02960720
029608     MOVE SYSTEM-MONTH                   TO DP132O-RUN-MONTH.     02960820
029609     MOVE SYSTEM-DAY                     TO DP132O-RUN-DAY.       02960920
029610     ACCEPT SYSTEM-TIME FROM TIME.                                02961019
029611     MOVE SYSTEM-HOUR                    TO DP132O-RUN-HOUR.      02961120
029612     MOVE SYSTEM-MINUTE                  TO DP132O-RUN-MINUTE.    02961220
029613     MOVE PC-PROGRAM-NAME                TO DP132O-PROGRAM-NAME.  02961320
029615     DISPLAY 'RUN DATE = ' SYSTEM-DATE.                           02961520
029616     DISPLAY 'RUN TIME = ' SYSTEM-TIME.                           02961620
029617                                                                  02961719
029618     OPEN INPUT  EDI-RECYCLE-FILE                                 02961820
029619          OUTPUT EDI-REPORT.                                      02961920
029620                                                                  02962020
029621     INITIALIZE DCLTTRDPRT.                                       02962120
029622     INITIALIZE DCLTEXTENT.                                       02962220
029623     INITIALIZE DCLTENTNME.                                       02962320
029624                                                                  02962420
029625     ACCEPT REPORT-TYPE-CONTROL.                                  02962519
029626     EVALUATE REPORT-TYPE-CONTROL                                 02962619
029627        WHEN 'T'                                                  02962719
029628          MOVE '     EDI TEST DATA       ' TO HEADER-TYPE         02962819
029629        WHEN 'P'                                                  02962919
029630          MOVE '  EDI PRODUCTION DATA    ' TO HEADER-TYPE         02963019
029631        WHEN 'A'                                                  02963119
029632          MOVE ' EDI PRE-PRODUCTION DATA ' TO HEADER-TYPE         02963219
029633        WHEN OTHER                                                02963319
029634          MOVE '   DATA TYPE UNKNOWN     ' TO HEADER-TYPE         02963419
029635     END-EVALUATE.                                                02963519
029637     DISPLAY 'TYPE OF REPORT = ' REPORT-TYPE-CONTROL.             02963719
029638                                                                  02963819
029640     PERFORM R100-READ-EDI-RECYCLE.                               02964019
029641     IF EDI-RECYCLE-EOF                                           02964123
029642        DISPLAY '********************************* *'             02964219
029643        DISPLAY '*   EMPTY EDI BULK/STORE FILE     *'             02964319
029644        DISPLAY '*   PROGRAM ** = APKRP800         *'             02964419
029645        DISPLAY '*   PARAGRAPH  = B100-HOUSEKEEPING*'             02964533
029646        DISPLAY '***********************************'             02964619
029647        MOVE ZEROS                     TO HL2-VENDOR-NBR          02964719
029648        MOVE SPACES                    TO HL2-ENT-ID-DESC         02964819
029650        WRITE EDI-LINE FROM NO-DATA-LINE AFTER 2                  02965023
029652     END-IF.                                                      02965220
029653                                                                  02965320
029654*--------------------------------------------------------------*  02965417
029655* PROCESS THE EDI TRANSMISSION BULK/STORE INVOICES             *  02965517
029660*--------------------------------------------------------------*  02966017
029700 B200-PROCESS.                                                    02970019
029800                                                                  02980017
030300     IF AP056-EDI-SENDER-ID NOT EQUAL PV-SAVE-EDI-SENDER-ID       03030020
030310        PERFORM C100-FIND-INPUT-VENDOR                            03031020
030320        IF VENDOR-NOT-FOUND                                       03032021
030330           MOVE AP056-EDI-SENDER-ID       TO TRDPRT-VEND-INCHG-ID 03033026
030340           MOVE AP056-EDI-SENDER-ID-QUAL                          03034026
030350             TO TRDPRT-VEND-INCHG-ID-DESC                         03035026
030400           PERFORM Y100-OPEN-TRDPRT-CURSOR                        03040020
030410           PERFORM S100-FETCH-TRDPRT-CURSOR                       03041020
030420           PERFORM Y200-CLOSE-TRDPRT-CURSOR                       03042020
030500           MOVE EXTENT-DUN-NBR            TO HL2-VENDOR-NBR       03050020
030600           MOVE ENTNME-ENT-NAME-DESC      TO HL2-ENT-ID-DESC      03060020
030700           PERFORM W100-WRITE-REPORT-HEADERS                      03070022
030800           MOVE AP056-EDI-SENDER-ID       TO PV-SAVE-EDI-SENDER-ID03080021
030801        ELSE                                                      03080121
030802           MOVE AP056-EXTENT-DUN-NBR      TO HL2-VENDOR-NBR       03080221
030803           MOVE AP056-ENT-ID-DESC         TO HL2-ENT-ID-DESC      03080321
030804           PERFORM W100-WRITE-REPORT-HEADERS                      03080428
030805           MOVE AP056-EDI-SENDER-ID       TO PV-SAVE-EDI-SENDER-ID03080521
030810     END-IF.                                                      03081020
030900                                                                  03090005
031000     MOVE AP056-VENDOR-INVOICE-NBR        TO DL-INVOICE-NBR.      03100023
031100     MOVE AP056-KOHLS-PO-NBR              TO DL-PO-NBR.           03110023
031201     MOVE AP056-SORT-LOC                  TO DL-LOC.              03120137
031210     MOVE AP056-SORT-MTCH-LVL             TO DL-MTCH-LVL.         03121023
031300     EVALUATE AP056-RECYCLE-CNT                                   03130005
031400        WHEN 0                                                    03140005
031500             MOVE '**   '                 TO DL-REPORT-IND        03150023
031600        WHEN 1                                                    03160005
031700        WHEN 2                                                    03170005
031800        WHEN 3                                                    03180005
031900        WHEN 4                                                    03190005
032000             MOVE '     '                 TO DL-REPORT-IND        03200023
032100        WHEN OTHER                                                03210005
032200             MOVE '*****'                 TO DL-REPORT-IND        03220023
032300     END-EVALUATE.                                                03230005
032400                                                                  03240005
032500     PERFORM W200-WRITE-REPORT-DETAILS.                           03250022
032600     PERFORM R100-READ-EDI-RECYCLE.                               03260005
032700                                                                  03270005
032800*--------------------------------------------------------------*  03280019
032900* END OF JOB PROCESSING                                        *  03290019
033000*--------------------------------------------------------------*  03300019
033100 B300-END-OF-JOB.                                                 03310019
033200                                                                  03320019
033300     PERFORM W300-WRITE-END-OF-REPORT.                            03330023
034500     CLOSE EDI-RECYCLE-FILE                                       03450019
034600           EDI-REPORT.                                            03460019
034700                                                                  03470019
034800*--------------------------------------------------------------*  03480021
034900* DETERMINE IF THE VENDOR NUMBER AND NAME ARE ON THE INPUT     *  03490021
034910* FILE.  IF THE FIELDS CONTAIN DATA, THEN MOVE THESE VALUES TO *  03491021
034920* THE REPORT.  IF THE FIELDS DO NOT CONTAIN DATA, PERFORM THE  *  03492021
034930* FETCH ON THE TRDPRT_CSR.                                     *  03493021
035000*--------------------------------------------------------------*  03500021
035100 C100-FIND-INPUT-VENDOR.                                          03510021
035200                                                                  03520021
035300     IF AP056-EXTENT-DUN-NBR NOT EQUAL ZEROS AND                  03530036
035400        AP056-ENT-ID-DESC NOT EQUAL SPACES                        03540021
035500        SET VENDOR-FOUND            TO TRUE                       03550021
035600     ELSE                                                         03560021
035700        SET VENDOR-NOT-FOUND        TO TRUE                       03570021
036100     END-IF.                                                      03610021
036200                                                                  03620021
037600*--------------------------------------------------------------*  03760019
037700* READ THE EDI TRANSMISSION REJECTION FILE                     *  03770019
037800*--------------------------------------------------------------*  03780019
037810 R100-READ-EDI-RECYCLE.                                           03781019
037900                                                                  03790019
038000     READ EDI-RECYCLE-FILE INTO WS-EDI-RECYCLE-REC                03800005
038100       AT END                                                     03810019
038200          SET EDI-RECYCLE-EOF TO TRUE                             03820023
038210     END-READ.                                                    03821023
038300                                                                  03830005
038400*--------------------------------------------------------------*  03840019
038500* FETCH TRDPRT_CSR CURSOR                                      *  03850019
038600*--------------------------------------------------------------*  03860019
038700 S100-FETCH-TRDPRT-CURSOR.                                        03870019
038800                                                                  03880019
039204     PERFORM WITH TEST AFTER                                      03920419
039205        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      03920519
039206          UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                 03920619
039207             OR SQLCODE = ZERO                                    03920719
039208             OR SQLCODE = +100                                    03920819
039209                                                                  03920919
039210             EXEC SQL                                             03921019
039211                FETCH TRDPRT_CSR                                  03921119
039212                 INTO :ENTNME-ENT-NAME-DESC                       03921219
039213                    , :EXTENT-DUN-NBR                             03921319
039214             END-EXEC                                             03921419
039215                                                                  03921519
039216             EVALUATE TRUE                                        03921619
039217               WHEN SQLCODE = ZERO                                03921719
039218               WHEN SQLCODE = -904                                03921819
039219               WHEN SQLCODE = +100                                03921919
039220               WHEN SQLCODE = -913                                03922019
039221                 CONTINUE                                         03922119
039222               WHEN SQLWARN0 NOT = SPACES                         03922219
039223               WHEN SQLCODE  NOT = ZERO                           03922319
039224                 MOVE 'S100-FETCH-TRDPRT-CURSOR'                  03922419
039225                   TO WS-ABEND-PARAGRAPH                          03922519
039226               MOVE 'UNSUCCESSFUL FETCH' TO WS-ABEND-OPERATION    03922619
039227               MOVE 'TRDPRT'             TO WS-ABEND-STRUCTURE-1  03922719
039228               MOVE SPACES               TO WS-ABEND-STRUCTURE-2  03922819
039229               PERFORM Z999-DB2-ABEND                             03922919
039230             END-EVALUATE                                         03923019
039231         END-PERFORM.                                             03923119
039232                                                                  03923219
039233     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         03923324
039234         MOVE 'S100-FETCH-TRDPRT-CURSOR' TO WS-ABEND-PARAGRAPH    03923419
039235         MOVE 'MAX RETRIES EXCEEDED ON FETCH'                     03923519
039236           TO WS-ABEND-OPERATION                                  03923619
039237         PERFORM Z999-DB2-ABEND                                   03923719
039238     END-IF.                                                      03923819
039239                                                                  03923919
039240*--------------------------------------------------------------*  03924019
039241* OPEN TRDPRT_CSR CURSOR                                       *  03924119
039242*--------------------------------------------------------------*  03924219
039243 Y100-OPEN-TRDPRT-CURSOR.                                         03924319
039250                                                                  03925019
039300     PERFORM WITH TEST AFTER                                      03930005
039400        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      03940019
039500          UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                 03950019
039600             OR SQLCODE = ZERO                                    03960019
039700             OR SQLCODE = +100                                    03970019
039800                                                                  03980005
039900             EXEC SQL                                             03990005
040000                OPEN TRDPRT_CSR                                   04000005
040100             END-EXEC                                             04010005
040200                                                                  04020005
040300             EVALUATE TRUE                                        04030005
040400               WHEN SQLCODE = ZERO                                04040019
040500               WHEN SQLCODE = +100                                04050019
040600               WHEN SQLCODE = -904                                04060019
040700               WHEN SQLCODE = -913                                04070019
040800                 CONTINUE                                         04080019
041000               WHEN SQLWARN0 NOT = SPACES                         04100019
041100               WHEN SQLCODE  NOT = ZERO                           04110019
041200                 MOVE 'Y100-OPEN-TRDPRT-CURSOR'                   04120019
041300                   TO WS-ABEND-PARAGRAPH                          04130019
041400                 MOVE 'UNSUCCESSFUL OPEN' TO WS-ABEND-OPERATION   04140019
041600                 MOVE 'TRDPRT'            TO WS-ABEND-STRUCTURE-1 04160019
041700                 MOVE SPACES              TO WS-ABEND-STRUCTURE-2 04170019
041800                 PERFORM Z999-DB2-ABEND                           04180019
041900             END-EVALUATE                                         04190005
042000     END-PERFORM.                                                 04200005
042100                                                                  04210005
042200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04220019
042300        MOVE 'Y100-OPEN-TRDPRT-CURSOR' TO WS-ABEND-PARAGRAPH      04230033
042500        MOVE 'MAX RETRIES EXCEEDED ON OPEN TRDPRT'                04250033
042600          TO WS-ABEND-OPERATION                                   04260033
042700        PERFORM Z999-DB2-ABEND                                    04270019
042800     END-IF.                                                      04280019
042900                                                                  04290019
046910*--------------------------------------------------------------*  04691019
046920* CLOSE TRDPRT_CSR CURSOR                                      *  04692019
046930*--------------------------------------------------------------*  04693019
046940 Y200-CLOSE-TRDPRT-CURSOR.                                        04694019
046950                                                                  04695019
047000     PERFORM WITH TEST AFTER                                      04700005
047100        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      04710019
047200          UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                 04720019
047300             OR SQLCODE = ZERO                                    04730019
047400             OR SQLCODE = +100                                    04740019
047500                                                                  04750005
047600             EXEC SQL                                             04760005
047700                CLOSE TRDPRT_CSR                                  04770005
047800             END-EXEC                                             04780005
047900                                                                  04790005
048000             EVALUATE TRUE                                        04800005
048100               WHEN SQLCODE = ZERO                                04810019
048200               WHEN SQLCODE = +100                                04820019
048300               WHEN SQLCODE = -904                                04830019
048400               WHEN SQLCODE = -913                                04840019
048500                 CONTINUE                                         04850019
048700               WHEN SQLWARN0 NOT = SPACES                         04870019
048800               WHEN SQLCODE  NOT = ZERO                           04880019
048900                 MOVE 'Y200-CLOSE-TRDPRT-CURSOR'                  04890019
049000                   TO WS-ABEND-PARAGRAPH                          04900019
049100                 MOVE 'UNSUCCESSFUL CLOSE' TO WS-ABEND-OPERATION  04910019
049300                 MOVE 'TRDPRT'             TO WS-ABEND-STRUCTURE-104930019
049400                 MOVE SPACES               TO WS-ABEND-STRUCTURE-204940019
049500                 PERFORM Z999-DB2-ABEND                           04950019
049600             END-EVALUATE                                         04960005
049700     END-PERFORM.                                                 04970005
049800                                                                  04980005
049900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04990024
050000         MOVE 'Y200-CLOSE-TRDPRT-CURSOR' TO WS-ABEND-PARAGRAPH    05000019
050200         MOVE 'MAX RETRIES EXCEEDED ON CLOSE TRDPRT'              05020019
050300           TO WS-ABEND-OPERATION                                  05030019
050400         PERFORM Z999-DB2-ABEND                                   05040019
050500     END-IF.                                                      05050019
050600                                                                  05060005
050700*--------------------------------------------------------------*  05070021
050800* WRITE THE REPORT HEADING LINES                               *  05080021
050900*--------------------------------------------------------------*  05090021
050910 W100-WRITE-REPORT-HEADERS.                                       05091021
050920                                                                  05092021
050921*    INITIALIZE LINE-COUNT.                                       05092129
050930     ADD 1                             TO PAGE-COUNT.             05093023
050931     MOVE PAGE-COUNT                   TO DP132O-PAGE-NUMBER.     05093123
050932                                                                  05093221
050940     EVALUATE REPORT-TYPE-CONTROL                                 05094021
050950        WHEN 'T'                                                  05095021
050960           MOVE 1                      TO DP132O-REPORT-NUMBER    05096023
050970        WHEN 'A'                                                  05097021
050980           MOVE 3                      TO DP132O-REPORT-NUMBER    05098023
050990        WHEN 'P'                                                  05099021
050991           MOVE 5                      TO DP132O-REPORT-NUMBER    05099123
050992        WHEN OTHER                                                05099221
050993           MOVE 1                      TO DP132O-REPORT-NUMBER    05099323
050994     END-EVALUATE.                                                05099421
050996     MOVE 5                            TO LINE-COUNT.             05099629
050997                                                                  05099721
051000     WRITE EDI-LINE                                               05100023
051001           FROM DP132O-STANDRD-HEADER-132-COLS AFTER PAGE.        05100123
051002     WRITE EDI-LINE FROM BLANK-LINE AFTER 1.                      05100225
051004     WRITE EDI-LINE FROM HL-HEADING-LINE1 AFTER 2.                05100423
051005     WRITE EDI-LINE FROM BLANK-LINE AFTER 1.                      05100527
051007     WRITE EDI-LINE FROM HL-HEADING-LINE2 AFTER 2.                05100723
051008*    ADD 6                             TO LINE-COUNT.             05100829
051009                                                                  05100921
051010*--------------------------------------------------------------*  05101021
051011* WRITE THE REPORT DETAIL LINES                                *  05101121
051020*--------------------------------------------------------------*  05102021
051030 W200-WRITE-REPORT-DETAILS.                                       05103024
051040                                                                  05104021
051050     IF LINE-COUNT > MAX-LINE-COUNT                               05105021
051060        PERFORM W100-WRITE-REPORT-HEADERS                         05106021
051070     END-IF.                                                      05107021
051080                                                                  05108021
051090     WRITE EDI-LINE FROM DL-DETAIL-LINE1.                         05109021
051100     ADD 1          TO LINE-COUNT.                                05110023
051200     INITIALIZE DL-DETAIL-LINE1.                                  05120021
051300                                                                  05130021
051400*--------------------------------------------------------------*  05140023
051500* WRITE END OF REPORT LINE                                     *  05150023
051600*--------------------------------------------------------------*  05160023
051700 W300-WRITE-END-OF-REPORT.                                        05170023
051800                                                                  05180023
051810     WRITE EDI-LINE FROM BLANK-LINE AFTER 2.                      05181031
051900     WRITE EDI-LINE FROM EOR-END-OF-REPORT-LINE AFTER 1.          05190023
051910     WRITE EDI-LINE FROM BLANK-LINE AFTER 1.                      05191031
052000                                                                  05200023
057800*--------------------------------------------------------------*  05780019
057900* PROCESS DB2 ABENDS                                           *  05790019
058000*--------------------------------------------------------------*  05800019
058010 Z999-DB2-ABEND.                                                  05801024
058100                                                                  05810019
058200     DISPLAY '*** DB2 ERROR '.                                    05820005
058300     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 05830005
058400     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               05840005
058500     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               05850005
058600     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             05860005
058700     IF WS-ABEND-STRUCTURE-2 > SPACES                             05870005
058800        DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2           05880021
058810     END-IF.                                                      05881021
059000     MOVE +4013                    TO ABEND-CODE.                 05900005
059100                                                                  05910005
059200     COPY DPPD004.                                                05920005
059300     CALL 'ILBOABN0' USING ABEND-CODE.                            05930005
059400                                                                  05940005
