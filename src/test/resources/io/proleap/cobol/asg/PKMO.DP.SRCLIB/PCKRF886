000100 IDENTIFICATION DIVISION.                                         00010012
000200 PROGRAM-ID.             PCKRF886.                                00020012
000300 AUTHOR.                 VIRGENE LENNEMAN                         00030012
000400 INSTALLATION.           KOHLS.                                   00040012
000500 DATE-WRITTEN            JULY, 2007.                              00050012
000600 DATE-COMPILED.                                                   00060012
000700                                                                  00070012
000800******************************************************************00080012
000900* THIS PROGRAM IS DISPLAYED BY SELECTING OPTION 2, BUILD MASTER,  00090012
001000* ON THE CARTON FUNCTION (PCKRF884) SCREEN.                       00100012
001100*                                                                 00110012
001200* THIS PROGRAM DISPLAYS THE MASTER TYPE SUBMENU ON THE            00120012
001300* LRT (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM    00130012
001400* WHICH PROCESSES THE SELECTED FUNCTION.                          00140012
001500******************************************************************00150012
001600                                                                  00160012
001700 ENVIRONMENT DIVISION.                                            00170012
001800 DATA DIVISION.                                                   00180012
001900                                                                  00190012
002000 WORKING-STORAGE SECTION.                                         00200012
002100 01  CA-COMMAREA.                                                 00210012
002200     05  CA-COMMON-DATA.                                          00220012
002300         10  CA-TRANSACTION-STATUS                                00230012
002400                                         PIC  X(01)  VALUE SPACES.00240012
002500             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00250012
002600             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00260012
002700         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACES.00270012
002800         10  CA-CALL-FROM-PGM-NME        PIC  X(08)  VALUE SPACES.00280012
002900             88  CA-CALL-FROM-MSTR-TYP-FUNC    VALUE 'PCKRF886'.  00290012
003000     05  CA-PROGRAM-DATA.                                         00300012
003100         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACES.00310012
003200             88  CA-VALID-SELECTION                  VALUE        00320012
003300                 '1', '2', '3', '4', '5', '6'.                    00330012
003400         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00340012
003500                                         PIC  9(01).              00350012
003600             88  CA-SELECTION-ONE                    VALUE 1.     00360012
003700             88  CA-SELECTION-TWO                    VALUE 2.     00370012
003800             88  CA-SELECTION-THREE                  VALUE 3.     00380012
003900             88  CA-SELECTION-FOUR                   VALUE 4.     00390012
004000             88  CA-SELECTION-FIVE                   VALUE 5.     00400012
004100             88  CA-SELECTION-SIX                    VALUE 6.     00410012
004200         10  CA-FILLER1                  PIC  X(290) VALUE SPACES.00420012
004300                                                                  00430012
004400 01  CA-COMMAREA-2.                                               00440012
004500     COPY PCWS033.                                                00450012
004600                                                                  00460012
004700* HELP SCREEN COMMAREA                                            00470012
004800     COPY PCWS192.                                                00480012
004900* HELP SCREEN WORK AREA                                           00490012
005000     COPY PCWS188.                                                00500012
005100                                                                  00510012
005200 01  PC-PROGRAM-CONSTANTS.                                        00520012
005300     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00530012
005400         'PCKRF886'.                                              00540012
005500     05  PC-CART-MENU-PGM                PIC  X(08)  VALUE        00550012
005600         'PCKRF884'.                                              00560012
005700     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E886'.00570012
005800     05  PC-CHECK-AUTH-FOR-TRAN-E864     PIC  X(04)  VALUE 'E864'.00580012
005900     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00590012
006000         'END OF SESSION     '.                                   00600012
006100     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00610012
006200         'INVALID SELECTION  '.                                   00620012
006300     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00630012
006400         'UNRECOGNIZED PF KEY'.                                   00640012
006500     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00650012
006600         'USER NOT AUTHORIZED'.                                   00660012
006700     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00670012
006800         'NUMERIC VALUE REQ. '.                                   00680012
006900     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00690012
007000         'F3 =END            '.                                   00700012
007100     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00710012
007200         'TRANS NOT AVAILABLE'.                                   00720012
007300     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00730012
007400         'CICS ABEND -CALL DP'.                                   00740012
007500     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00750012
007600         'CICSAUTH BAD RETURN'.                                   00760012
007700     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00770012
007800         'SELECTION NOT AVAIL'.                                   00780012
007900                                                                  00790012
008000 01  PN-PGM-NAME-DATA.                                            00800012
008100     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00810012
008200         'PCKRF864'.                                              00820012
008300     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00830012
008400         'PCKRF864'.                                              00840012
008500     05  PN-SELECTION-03-PROGRAM         PIC  X(08)  VALUE        00850012
008600         'PCKRF864'.                                              00860012
008700     05  PN-SELECTION-04-PROGRAM         PIC  X(08)  VALUE        00870012
008800         'PCKRF864'.                                              00880012
008900     05  PN-SELECTION-05-PROGRAM         PIC  X(08)  VALUE        00890012
009000         'PCKRF864'.                                              00900012
009100     05  PN-SELECTION-06-PROGRAM         PIC  X(08)  VALUE        00910012
009200         'PCKRF864'.                                              00920012
009300                                                                  00930012
009400 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00940012
009500     05  PN-PGM-NAME  OCCURS 6 TIMES                              00950012
009600                      INDEXED BY PN-INDX                          00960012
009700                                         PIC  X(08).              00970012
009800                                                                  00980012
009900 01  PS-PROGRAM-SWITCHES.                                         00990012
010000     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01000012
010100         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01010012
010200         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01020012
010300                                                                  01030012
010400 01  PV-PROGRAM-VARIABLES.                                        01040012
010500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01050012
010600                                                     COMP SYNC.   01060012
010700     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  01070012
010800                                                     COMP SYNC.   01080012
010900     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACES.01090012
011000                                                                  01100012
011100     05  PV-CICS-MESSAGE-AREA            PIC X(100)  VALUE SPACES.01110012
011200     05  PV-HOLD-CA-SELECTION            PIC 9(01)   VALUE ZERO.  01120012
011300*                                                                 01130012
011400*-----------------------------------------------------------------01140012
011500*  LAYOUT FOR TEMP STORAGE QUEUE                                  01150012
011600*-----------------------------------------------------------------01160012
011700     COPY DPWS026.                                                01170012
011800                                                                  01180012
011900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01190012
012000     COPY DPWS013.                                                01200012
012100                                                                  01210012
012200*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01220012
012300     COPY DPWS008.                                                01230012
012400                                                                  01240012
012500*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01250012
012600     COPY DPWS010I.                                               01260012
012700                                                                  01270012
012800*  MAPSET                                                         01280012
012900     COPY PCKM886.                                                01290012
013000                                                                  01300012
013100*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01310012
013200     COPY DPWS015.                                                01320012
013300                                                                  01330012
013400     COPY DFHAID.                                                 01340012
013500                                                                  01350012
013600 LINKAGE SECTION.                                                 01360012
013700 01  DFHCOMMAREA.                                                 01370012
013800     05  FILLER                       OCCURS 1 TO 4072 TIMES      01380012
013900                                      DEPENDING ON EIBCALEN.      01390012
014000         10  FILLER                   PIC X.                      01400012
014100                                                                  01410012
014200 PROCEDURE DIVISION.                                              01420012
014300 0000-PROGRAM-MAINLINE.                                           01430012
014400     INITIALIZE                         CA-COMMAREA.              01440012
014500     MOVE DFHCOMMAREA                TO CA-COMMAREA.              01450012
014600     MOVE LOW-VALUES                 TO PC886AI.                  01460012
014700                                                                  01470012
014800     EVALUATE TRUE                                                01480012
014900         WHEN EIBCALEN = ZERO                                     01490012
015000         WHEN EIBTRNID = 'Z278'                                   01500012
015100         WHEN EIBAID = DFHCLEAR                                   01510012
015200         WHEN CA-INITIALIZE-SCREEN                                01520012
015300              INITIALIZE CA-COMMAREA                              01530012
015400              PERFORM 8000-SEND-MAP                               01540012
015500              PERFORM 8200-RETURN-TRANID                          01550012
015600         WHEN EIBAID = DFHENTER                                   01560012
015700              PERFORM 1000-RECEIVE-MAP                            01570012
015800              PERFORM 1100-EDIT-SELECTION                         01580012
015900         WHEN EIBAID = DFHPF3                                     01590012
016000              MOVE PC-CART-MENU-PGM TO PV-TRANSFER-PROGRAM        01600012
016100              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01610012
016200         WHEN EIBAID = DFHPF1                                     01620012
016300              PERFORM 1200-HELP-SCREEN                            01630012
016400         WHEN OTHER                                               01640012
016500              MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AMSGLNO          01650012
016600              PERFORM 8100-SEND-DATA-ONLY                         01660012
016700              PERFORM 8200-RETURN-TRANID                          01670012
016800     END-EVALUATE.                                                01680012
016900                                                                  01690012
017000     GOBACK.                                                      01700012
017100*                                                                 01710012
017200 1000-RECEIVE-MAP.                                                01720012
017300     EXEC CICS                                                    01730012
017400         RECEIVE MAP    ('PC886A')                                01740012
017500                 MAPSET ('PCKM886')                               01750012
017600                 RESP   (PV-CICS-RESP)                            01760012
017700     END-EXEC.                                                    01770012
017800                                                                  01780012
017900     EVALUATE TRUE                                                01790012
018000         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     01800012
018100              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  01810012
018200         WHEN PV-CICS-RESP = DFHRESP (MAPFAIL)                    01820012
018300              CONTINUE                                            01830012
018400         WHEN OTHER                                               01840012
018500              MOVE '1000-RECEIVE-MAP'                             01850012
018600                                     TO DP013-PARAGRAPH           01860012
018700              MOVE 'UNABLE TO RECEIVE MAP'                        01870012
018800                                     TO DP013-MESSAGE-TEXT (1)    01880012
018900              SET DP013-LOGIC-ABEND  TO TRUE                      01890012
019000              SET DP013-NO-ROLLBACK  TO TRUE                      01900012
019100              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              01910012
019200     END-EVALUATE.                                                01920012
019300*                                                                 01930012
019400 1010-RECEIVE-SCREEN-FIELDS.                                      01940012
019500     IF  ASELECTL > ZERO                                          01950012
019600         MOVE ASELECTI               TO CA-SELECTION-X            01960012
019700     END-IF.                                                      01970012
019800*                                                                 01980012
019900 1100-EDIT-SELECTION.                                             01990012
020000     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD     02000012
020100     MOVE 1                          TO DP010I-MAXIMUM-DIGITS     02010012
020200     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS   02020012
020300     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      02030012
020400                                                                  02040012
020510     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02051013
020520                         USING DP010I-NUMERIC-EDIT-AREA           02052013
020600                                                                  02060012
020700     IF DP010I-ERROR-DETECTED                                     02070012
020800         MOVE PC-NON-NUMERIC-SELECTION-MSG TO AMSGLNO             02080012
020900         PERFORM 8100-SEND-DATA-ONLY                              02090012
021000         PERFORM 8200-RETURN-TRANID                               02100012
021100     ELSE                                                         02110012
021200         MOVE DP010I-NUMERIC-FIELD TO CA-SELECTION                02120012
021300                                      PV-HOLD-CA-SELECTION        02130012
021400     END-IF.                                                      02140012
021500                                                                  02150012
021600** IN THE FOLLOWING LOGIC REFERENCES TO OPTION 2 FOR BULK JEWELRY 02160012
021700** HAS BEEN COMMENTED OUT, NOT DELETED, IN CASE IT MAY RETURN     02170012
021800     EVALUATE TRUE                                                02180012
021900*        WHEN CA-SELECTION-X = '1' OR '2' OR '3' OR '4'           02190012
022000         WHEN CA-SELECTION-X = '1' OR '3' OR '4'                  02200012
022100                                   OR '5' OR '6'                  02210012
022200*******  A 3 CHAR. CODE WILL BE INSERTED INTO MSTR CONTAINER TYP  02220012
022300*******  AND THE PC033-MSTR-TYP-ORIGINAL                          02230012
022400*******  NOT THE SELECTION NUMBER FROM THE MENU                   02240012
022500*******  HERE WE CONVERT THE NUMBER TO THE 3 CHAR. CODE TO BE     02250012
022600*******  USED BY PCKRF864                                         02260012
022700             EVALUATE PV-HOLD-CA-SELECTION                        02270012
022800                 WHEN 1                                           02280012
022900************************* FINE JEWELRY                            02290012
023000                     MOVE 'FJ '   TO PC033-MASTER-TYPE-SELECTION  02300012
023100                                     PC033-MSTR-TYP-ORIGINAL      02310012
023200*                WHEN 2                                           02320012
023300************************* BULK JEWELRY                            02330012
023400*                    MOVE 'BJ '   TO PC033-MASTER-TYPE-SELECTION  02340012
023500*                                    PC033-MSTR-TYP-ORIGINAL      02350012
023600                 WHEN 3                                           02360012
023700************************* PACK BY STORE (PBS) JEWELRY             02370012
023800                     MOVE 'PJ '   TO PC033-MASTER-TYPE-SELECTION  02380012
023900                                     PC033-MSTR-TYP-ORIGINAL      02390012
024000                 WHEN 4                                           02400012
024100************************* NON CON(VEYABLE) LARGE                  02410012
024200                     MOVE 'NCL'   TO PC033-MASTER-TYPE-SELECTION  02420012
024300                                     PC033-MSTR-TYP-ORIGINAL      02430012
024400                 WHEN 5                                           02440012
024500************************* NON CON(VEYABLE) SMALL                  02450012
024600                     MOVE 'NCS'   TO PC033-MASTER-TYPE-SELECTION  02460012
024700                                     PC033-MSTR-TYP-ORIGINAL      02470012
024800                 WHEN 6                                           02480012
024900************************* OTHER                                   02490012
025000                     MOVE 'O  '   TO PC033-MASTER-TYPE-SELECTION  02500012
025100                                     PC033-MSTR-TYP-ORIGINAL      02510012
025200             END-EVALUATE                                         02520012
025300             PERFORM 2000-PROCESS-SELECTION                       02530012
025400         WHEN OTHER                                               02540012
025500             MOVE DP015-UNP-ALP-BRT-MDT    TO ASELECTA            02550012
025600             MOVE PC-INVALID-SELECTION-MSG TO AMSGLNO             02560012
025700             PERFORM 8100-SEND-DATA-ONLY                          02570012
025800             PERFORM 8200-RETURN-TRANID                           02580012
025900     END-EVALUATE.                                                02590012
026000*                                                                 02600012
026100 1200-HELP-SCREEN.                                                02610012
026200     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02620012
026300     MOVE 'PCKRF886'                  TO PC192-PROGRAM-NAME       02630012
026400     COPY PCPD188.                                                02640012
026500     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02650012
026600     PERFORM 2200-XCTL-TO-HELP.                                   02660012
026700*                                                                 02670012
026800 2000-PROCESS-SELECTION.                                          02680012
026900     SET PN-INDX                     TO CA-SELECTION.             02690012
027000     IF CA-SELECTION < 7                                          02700012
027100         PERFORM 9000-CHECK-RACF                                  02710012
027200     ELSE                                                         02720012
027300         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02730012
027400         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02740012
027500     END-IF.                                                      02750012
027600                                                                  02760012
027700     IF  PS-ACCESS-ALLOWED                                        02770012
027800         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02780012
027900         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02790012
028000     ELSE                                                         02800012
028100         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02810012
028200         PERFORM 8100-SEND-DATA-ONLY                              02820012
028300         PERFORM 8200-RETURN-TRANID                               02830012
028400     END-IF.                                                      02840012
028500*                                                                 02850012
028600 2100-XCTL-TO-SELECTED-PROGRAM.                                   02860012
028700     INITIALIZE PC033-COMMON-DATA.                                02870012
028800     SET PC033-INITIALIZE-SCREEN      TO TRUE.                    02880012
028900     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      02890012
029000     PERFORM DP026-0000-GET-LOGON-INFO.                           02900012
029100     MOVE DP026-USERID                TO PC033-USER-ID.           02910012
029200     MOVE DP026-LOCATION-NBR          TO PC033-OPER-UNT-ID        02920012
029300     MOVE DP026-FCLTY-ID              TO PC033-FCLTY-ID           02930012
029400     MOVE DP026-QUEUE-TERM            TO PC033-TERM-ID            02940012
029500     SET PC033-PROCESS-BY-UPC         TO TRUE                     02950012
029600     MOVE 'PCKRF886'                  TO PC033-MENU-PROGRAM       02960012
029700                                                                  02970012
029800     MOVE LENGTH OF CA-COMMAREA-2 TO PV-COMMAREA-LENGTH           02980012
029900                                                                  02990012
030000     EXEC CICS                                                    03000012
030100         XCTL                                                     03010012
030200             PROGRAM   (PV-TRANSFER-PROGRAM)                      03020012
030300             COMMAREA  (PC033-COMMON-DATA)                        03030012
030400             LENGTH    (PV-COMMAREA-LENGTH)                       03040012
030500             RESP      (PV-CICS-RESP)                             03050012
030600     END-EXEC.                                                    03060012
030700                                                                  03070012
030800     EVALUATE TRUE                                                03080012
030900         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     03090012
031000              CONTINUE                                            03100012
031100         WHEN OTHER                                               03110012
031200              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                03120012
031300                                     TO DP013-PARAGRAPH           03130012
031400              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03140012
031500                                     TO DP013-MESSAGE-TEXT (1)    03150012
031600              MOVE PV-TRANSFER-PROGRAM                            03160012
031700                                     TO DP013-MESSAGE-TEXT (2)    03170012
031800              SET DP013-CICS-ABEND   TO TRUE                      03180012
031900              SET DP013-NO-ROLLBACK  TO TRUE                      03190012
032000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03200012
032100              MOVE PC-TRANS-UNAVAILABLE-MSG                       03210012
032200                                     TO AMSGLNO                   03220012
032300              SET CA-PROCESS-SCREEN TO TRUE                       03230012
032400              PERFORM 8100-SEND-DATA-ONLY                         03240012
032500              PERFORM 8200-RETURN-TRANID                          03250012
032600     END-EVALUATE.                                                03260012
032700                                                                  03270012
032800     COPY DPPD026.                                                03280012
032900*                                                                 03290012
033000 2200-XCTL-TO-HELP.                                               03300012
033100     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       03310012
033200                                                                  03320012
033300     EXEC CICS                                                    03330012
033400         XCTL                                                     03340012
033500             PROGRAM   (PV-TRANSFER-PROGRAM)                      03350012
033600             COMMAREA  (PC192-COMMAREA)                           03360012
033700             LENGTH    (PV-COMMAREA-LENGTH)                       03370012
033800             RESP      (PV-CICS-RESP)                             03380012
033900     END-EXEC.                                                    03390012
034000                                                                  03400012
034100     EVALUATE TRUE                                                03410012
034200         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     03420012
034300              CONTINUE                                            03430012
034400         WHEN OTHER                                               03440012
034500              MOVE '2200-XCTL-TO-HELP' TO DP013-PARAGRAPH         03450012
034600              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03460012
034700                                       TO DP013-MESSAGE-TEXT (1)  03470012
034800              MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)  03480012
034900              SET DP013-CICS-ABEND     TO TRUE                    03490012
035000              SET DP013-NO-ROLLBACK    TO TRUE                    03500012
035100              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03510012
035200              MOVE PC-TRANS-UNAVAILABLE-MSG                       03520012
035300                                       TO AMSGLNO                 03530012
035400              SET CA-PROCESS-SCREEN    TO TRUE                    03540012
035500              PERFORM 8100-SEND-DATA-ONLY                         03550012
035600              PERFORM 8200-RETURN-TRANID                          03560012
035700     END-EVALUATE.                                                03570012
035800*                                                                 03580012
035900 8000-SEND-MAP.                                                   03590012
036000     EXEC CICS                                                    03600012
036100         SEND MAP       ('PC886A')                                03610012
036200              MAPSET    ('PCKM886')                               03620012
036300              ERASE                                               03630012
036400              RESP      (PV-CICS-RESP)                            03640012
036500     END-EXEC.                                                    03650012
036600                                                                  03660012
036700     EVALUATE TRUE                                                03670012
036800         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     03680012
036900              CONTINUE                                            03690012
037000         WHEN OTHER                                               03700012
037100              MOVE '8000-SEND-MAP'      TO DP013-PARAGRAPH        03710012
037200              MOVE 'UNABLE TO SEND MAP' TO DP013-MESSAGE-TEXT (1) 03720012
037300              SET DP013-CICS-ABEND      TO TRUE                   03730012
037400              SET DP013-NO-ROLLBACK     TO TRUE                   03740012
037500              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03750012
037600     END-EVALUATE.                                                03760012
037700*                                                                 03770012
037800 8100-SEND-DATA-ONLY.                                             03780012
037900     MOVE -1 TO ASELECTL.                                         03790012
038000                                                                  03800012
038100     EXEC CICS                                                    03810012
038200         SEND MAP       ('PC886A')                                03820012
038300              MAPSET    ('PCKM886')                               03830012
038400              CURSOR                                              03840012
038500              DATAONLY                                            03850012
038600              RESP      (PV-CICS-RESP)                            03860012
038700     END-EXEC.                                                    03870012
038800                                                                  03880012
038900     EVALUATE TRUE                                                03890012
039000         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     03900012
039100              CONTINUE                                            03910012
039200         WHEN OTHER                                               03920012
039300              MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH       03930012
039400              MOVE 'UNABLE TO SEND DATA' TO DP013-MESSAGE-TEXT (1)03940012
039500              SET DP013-CICS-ABEND       TO TRUE                  03950012
039600              SET DP013-NO-ROLLBACK      TO TRUE                  03960012
039700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03970012
039800     END-EVALUATE.                                                03980012
039900*                                                                 03990012
040000 8200-RETURN-TRANID.                                              04000012
040100     MOVE LENGTH OF CA-COMMAREA-2     TO PV-COMMAREA-LENGTH       04010012
040200     EXEC CICS                                                    04020012
040300         RETURN TRANSID   (PC-MENU-TRANID)                        04030012
040400                COMMAREA  (CA-COMMAREA)                           04040012
040500                LENGTH    (PV-COMMAREA-LENGTH)                    04050012
040600                RESP      (PV-CICS-RESP)                          04060012
040700     END-EXEC.                                                    04070012
040800                                                                  04080012
040900     EVALUATE TRUE                                                04090012
041000         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     04100012
041100              CONTINUE                                            04110012
041200         WHEN OTHER                                               04120012
041300              MOVE '8200-RETURN-TRANID' TO DP013-PARAGRAPH        04130012
041400              MOVE 'UNABLE TO RETURN TO TRANID'                   04140012
041500                                        TO DP013-MESSAGE-TEXT (1) 04150012
041600              SET DP013-CICS-ABEND      TO TRUE                   04160012
041700              SET DP013-NO-ROLLBACK     TO TRUE                   04170012
041800              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04180012
041900     END-EVALUATE.                                                04190012
042000*                                                                 04200012
042100 8300-LOGOFF-TO-VTAM-SCREEN.                                      04210012
042200     EXEC CICS                                                    04220012
042300         START TRANSID  ('Z011')                                  04230012
042400               TERMID   (EIBTRMID)                                04240012
042500               NOHANDLE                                           04250012
042600     END-EXEC.                                                    04260012
042700*                                                                 04270012
042800 9000-CHECK-RACF.                                                 04280012
042900******************************************************************04290012
043000*  CHECK ACCESS AUTHORITY OF USER                                 04300012
043100******************************************************************04310012
043200     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04320012
043300     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04330012
043400                                                                  04340012
043500******* FOR ALL SELECTIONS CHECK AUTHORIZATION FOR E864           04350012
043600     EVALUATE TRUE                                                04360012
043700         WHEN CA-SELECTION-ONE                                    04370012
043800         WHEN CA-SELECTION-TWO                                    04380012
043900         WHEN CA-SELECTION-THREE                                  04390012
044000         WHEN CA-SELECTION-FOUR                                   04400012
044100         WHEN CA-SELECTION-FIVE                                   04410012
044200         WHEN CA-SELECTION-SIX                                    04420012
044300              MOVE PC-CHECK-AUTH-FOR-TRAN-E864                    04430012
044400                                      TO DP008-RESOURCE-NAME      04440012
044500     END-EVALUATE.                                                04450012
044600                                                                  04460012
044700     EXEC CICS                                                    04470012
044800          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04480012
044900               COMMAREA (DP008-SECURITY-COMMAREA)                 04490012
045000               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04500012
045100               RESP     (PV-CICS-RESP)                            04510012
045200     END-EXEC.                                                    04520012
045300                                                                  04530012
045400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           04540012
045500         IF  DP008-CALL-SUCCESSFUL                                04550012
045600             IF  DP008-ACCESS-ALLOWED                             04560012
045700                 SET PS-ACCESS-ALLOWED                            04570012
045800                                     TO TRUE                      04580012
045900             ELSE                                                 04590012
046000                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   04600012
046100                                     TO AMSGLNO                   04610012
046200             END-IF                                               04620012
046300         ELSE                                                     04630012
046400             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   04640012
046500         END-IF                                                   04650012
046600     ELSE                                                         04660012
046700         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           04670012
046800         MOVE 'BAD LINK TO RACF PROGRAM'                          04680012
046900                                     TO DP013-MESSAGE-TEXT (1)    04690012
047000         SET DP013-CICS-ABEND        TO TRUE                      04700012
047100         SET DP013-NO-ROLLBACK       TO TRUE                      04710012
047200         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04720012
047300     END-IF.                                                      04730012
047400*                                                                 04740012
047500 9900-WRITE-CICS-LOG.                                             04750012
047600     MOVE LENGTH OF PV-CICS-MESSAGE-AREA                          04760012
047700          TO PV-COMMAREA-LENGTH                                   04770012
047800                                                                  04780012
047900     EXEC CICS                                                    04790012
048000         WRITEQ TD                                                04800012
048100             QUEUE  ('CSSL')                                      04810012
048200             FROM   (PV-CICS-MESSAGE-AREA)                        04820012
048300             LENGTH (PV-COMMAREA-LENGTH)                          04830012
048400             RESP   (PV-CICS-RESP)                                04840012
048500     END-EXEC.                                                    04850012
048600                                                                  04860012
048700     MOVE SPACES TO PV-CICS-MESSAGE-AREA.                         04870012
048800                                                                  04880012
048900 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  04890012
049000     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04900012
049100     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04910012
049200     INITIALIZE DP013-SRC-TASK-NUMBER                             04920012
049300                DP013-STACK.                                      04930012
049400     SET DP013-LINK-RETURN           TO TRUE.                     04940012
049500                                                                  04950012
049600     EXEC CICS                                                    04960012
049700         LINK                                                     04970012
049800             PROGRAM   (DP013-NAME)                               04980012
049900             COMMAREA  (DP013-PARAMETERS)                         04990012
050000             LENGTH    (DP013-LENGTH)                             05000012
050100     END-EXEC.                                                    05010012
050200                                                                  05020012
050300*----------------------------------------------------------------*05030012
050400*    ABEND PROCESSOR MODULE                                      *05040012
050500*----------------------------------------------------------------*05050012
050600                                                                  05060012
050700     COPY DPPD014.                                                05070012
