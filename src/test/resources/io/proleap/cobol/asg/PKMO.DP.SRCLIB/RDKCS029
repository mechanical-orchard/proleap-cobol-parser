000100*-----------------------*                                         00010050
000200 IDENTIFICATION DIVISION.                                         00020050
000300*-----------------------*                                         00030050
000400 PROGRAM-ID.    RDKCS029.                                         00040050
000500 AUTHOR.        ANGIE COLE.                                       00050050
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060050
000700 DATE-WRITTEN.  01-22-97.                                         00070050
000800 DATE-COMPILED.                                                   00080050
000900                                                                  00090050
001000*---------------------------------------------------------------* 00100050
001100*    U029 - KMRC DRVIERS LICENSE CARD LIST PROGRAM.             * 00110050
001200*                                                               * 00120050
001300*    THIS PROGRAM GENERATES A LIST OF CARDS ASSOCIATED WITH     * 00130050
001400*    A GIVEN FULL OR PARTIAL DRIVERS LICENSE NUMBER.  THE       * 00140050
001500*    CARD DETAIL SCREEN IS INVOKED WHEN THE OPERATOR SELECTS    * 00150050
001600*    AN ITEM AND PRESSES THE FUNCTION KEY.  THIS PROGRAM        * 00160050
001700*    RESTRICTS THE OPERATOR FROM SELECTING MORE THAN ONE CARD   * 00170050
001800*    TO INQUIRE UPON.                                           * 00180050
001900*                                                               * 00190050
002000*    CHANGES:                                                   * 00200050
002100*    06/23/97 - AJR - WR5220                                    * 00210050
002200*    - MODIFIED THE PROGRAM TO ONLY SELECT KMRC CARDS FROM THE  * 00220050
002300*      SVT_KOHLS_CRD_ACCT                                       * 00230076
002400*              TO BE DISPLAYED ON THE SCREEN.  GIFT CARDS WILL  * 00240082
002500*      NOT BE SELECTED.                                         * 00250050
002600*---------------------------------------------------------------* 00260050
002700*   12/22/98 - DAVE MUSKAT (COMPUWARE) - WR# 6041               * 00270050
002800*     CHANGES FOR Y2K:                                          * 00280050
002900*     ADDED A CENTURY FIELD TO PV-HOLD-ISSUE-DATE2 SO THAT      * 00290051
003000*     THE ISSUE DATE DISPLAYED ON THE SCREEN SHOWS CENTURY.     * 00300082
003100*     EXPANDED WORKING STORAGE FIELDS USED TO HOLD ISSUE DATE   * 00310051
003200*     TO INCLUDE CENTURY.  CHANGED MAPSET FIELD TO DISPLAY THE  * 00320082
003300*     CENTURY.                                                  * 00330051
003400*---------------------------------------------------------------* 00340050
003500******************************************************************00350073
003600*  09/19/01 - ARCHIVE PROJECT - GREG SHEFF                       *00360074
003700*   ALSO SEARCH HISTORY TABLES TKMCHTB AND TKMCHAC FOR DL MATCHES*00370073
003800*---------------------------------------------------------------* 00380098
003900*  12/11/02 - JIM LEIKNESS   WR# 24313                          * 00390098
004000*     CHANGED TO LIMIT NUMBER OF PAGES RETURNED TO 10 AND       * 00400098
004100*     DISPLAY A MESSAGE THAT NOT ALL DATA IS DISPLAYED WHEN     * 00410098
004200*     THE NUMBER OF RECORDS IS MORE THAN THE 10 PAGES.          * 00420098
004300*---------------------------------------------------------------* 00430098
004400*  09/19/15 - JIM ARENDT     CHG0124679                         * 00440099
004500*     AS PART OF THE LP REFUND REMEDIATION PROJECT, CHANGED PGM * 00450099
004600*     SO IF THEY COME INTO THIS SCREEN WITH A CLEAR DRIVERS     * 00460099
004700*     LICENSE NUMBER IT WILL DISPLAY THE CLEAR DRIVERS LICENSE  * 00470099
004800*     NBR.  IF THEY COME IN WITH AN ENCRYPTED DRIVERS LICENSE   * 00480099
004900*     NBR IT WILL DISPLAY THE ENCRYPTED DRIVERS LICENSE NBR     * 00490099
005000*     IN THE HEADING FIELD.                                     * 00500099
005100*     ALSO, REMOVED THE DRIVERS LICENSE NUMBER FROM THE DETAIL  * 00510099
005200*     AREA OF THE SCREEN.                                       * 00520099
005300*---------------------------------------------------------------* 00530099
005310* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00531099
005320*            - CHANGE CALL OF DPKUT100 TO                       * 00532099
005330*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00533099
005340*              MAKING THE CALL DYNAMIC VS STATIC                * 00534099
005350*                                                               * 00535099
005360*---------------------------------------------------------------* 00536099
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         00537099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00538099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00539099
CICS  ******************************************************************00539199
005400 ENVIRONMENT DIVISION.                                            00540050
005500                                                                  00550050
005600 DATA DIVISION.                                                   00560050
005700                                                                  00570050
005800 WORKING-STORAGE SECTION.                                         00580050
005900                                                                  00590050
006000 01  DK-DB2-KEYS.                                                 00600050
006100     05  DK-DRV-LIC-NBR                 PIC  X(21)  VALUE SPACE.  00610050
006200     05  DK-DRV-LIC-NBR-LONG            PIC  X(50)  VALUE SPACE.  00620099
006300*    05  DK-DRV-LIC-NBR-BYTE      REDEFINES DK-DRV-LIC-NBR-LONG   00630099
006400*                                       OCCURS 50 TIMES           00640099
006500*                                       PIC  X(01).               00650099
006600                                                                  00660050
006700 01  NULL-INDICATORS.                                             00670050
006800     05  NI-BALANCE              PIC S9(4)   COMP                 00680050
006900                                             VALUE ZERO.          00690050
007000                                                                  00700050
007100 01  PC-PROGRAM-CONSTANTS.                                        00710050
007200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00720050
007300                                                    'RD029A  '.   00730050
007400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00740050
007500                                                    'RDKM029 '.   00750050
007600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00760050
007700                                                    'RDKCS029'.   00770050
007800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00780050
007900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00790050
008000     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE ' '.    00800050
008100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00810050
008200                                                    COMP SYNC.    00820050
008300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00830050
008400                                                    COMP SYNC.    00840050
008500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00850050
008600                                                    COMP SYNC.    00860050
008700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00870050
008800                                                    +130          00880098
008900                                                    COMP-3.       00890050
009000     05  PC-DRV-LIC-NBR-LENGTH          PIC S9(04)  VALUE +21     00900050
009100                                                    COMP SYNC.    00910050
009200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00920050
009300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00930050
009400                                                    COMP-3.       00940050
009500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00950050
009600*                                                                 00960050
009700     05  PC-TSYMSG-NUMBERS.                                       00970050
009800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00980050
009900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00990050
010000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01000050
010100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01010050
010200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01020050
010300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01030050
010400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01040050
010500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01050050
010600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01060050
010700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01070050
010800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01080050
010900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01090050
011000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01100050
011100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01110050
011200         10  PC-TSYMSG-03026            PIC  9(05)  VALUE 03026.  01120098
011300*                                                                 01130050
011400 01  PS-PROGRAM-SWITCHES.                                         01140050
011500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01150050
011600         88  PS-NO-ERROR                            VALUE 'Y'.    01160050
011700         88  PS-ERROR                               VALUE 'N'.    01170050
011800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01180050
011900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01190050
012000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01200050
012100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01210050
012200         88  PS-DONE                                VALUE 'Y'.    01220050
012300         88  PS-NOT-DONE                            VALUE 'N'.    01230050
012400     05  PS-ITEMS-FOUND-SW              PIC  X(01)  VALUE 'N'.    01240050
012500         88  PS-ITEMS-FOUND                         VALUE 'Y'.    01250050
012600         88  PS-ITEMS-NOT-FOUND                     VALUE 'N'.    01260061
012700     05  PS-SELECTION-MADE-SW           PIC  X(01)  VALUE 'N'.    01270050
012800         88  PS-SELECTION-FOUND                     VALUE 'Y'.    01280050
012900         88  PS-NO-SELECTION-FOUND                  VALUE 'N'.    01290050
013000     05  PS-MAX-ITEMS-SW                PIC  X(01)  VALUE 'N'.    01300098
013100         88  PS-MAX-FOUND                           VALUE 'Y'.    01310098
013200         88  PS-NOT-MAX                             VALUE 'N'.    01320098
013300     05  PS-EQUAL-SW                    PIC  X(01)  VALUE 'N'.    01330099
013400         88  PS-EQUAL                               VALUE 'Y'.    01340099
013500         88  PS-NOT-EQUAL                           VALUE 'N'.    01350099
013600*                                                                 01360098
013700 01  ITEM-VARIABLES.                                              01370098
013800     05  ITEM-COUNTER                   PIC S9(09)  VALUE +0.     01380099
013900*                                                                 01390050
014000 01  PV-PROGRAM-VARIABLES.                                        01400050
014100     05  PV-SUB                         PIC S9(04)  VALUE +0      01410090
014200                                                    COMP SYNC.    01420050
014300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01430050
014400                                                    COMP SYNC.    01440050
014500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01450050
014600                                                    COMP-3.       01460050
014700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01470050
014800                                                    COMP-3.       01480050
014900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01490050
015000                                                    COMP-3.       01500050
015100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01510050
015200                                                    COMP-3.       01520050
015300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01530050
015400                                                    COMP-3.       01540050
015500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01550050
015600                                                    COMP-3.       01560050
015700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01570050
015800                                                    COMP SYNC.    01580050
015900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01590050
016000                                                    COMP SYNC.    01600050
016100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01610050
016200                                                    COMP SYNC.    01620050
016300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01630050
016400                                                    COMP SYNC.    01640050
016500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01650050
016600                                                    COMP SYNC.    01660050
016700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01670050
016800                                                    COMP SYNC.    01680050
016900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01690050
017000                                                    COMP SYNC.    01700050
017100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01710050
017200                                                    COMP SYNC.    01720050
017300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01730050
017400                                                    COMP SYNC.    01740050
017500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01750050
017600                                                    COMP SYNC.    01760050
017700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01770050
017800                                                    COMP SYNC.    01780050
017900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01790050
018000                                                    COMP SYNC.    01800050
018100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01810050
018200                                                    COMP SYNC.    01820050
018300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01830050
018400                                                    COMP SYNC.    01840050
018500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01850050
018600                                                    COMP SYNC.    01860050
018700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01870050
018800                                                    COMP SYNC.    01880050
018900     05  PV-DB2-DL-NBR.                                           01890099
019000         10  FILLER                     PIC X(01)   VALUE '%'.    01900099
019100         10  PV-DB2-LONG-DL             PIC X(50)   VALUE SPACE.  01910099
019200                                                                  01920099
019300     05  PV-DRV-LIC-NBR-LONG            PIC X(50)   VALUE SPACE.  01930099
019400     05  PV-DRV-LIC-NBR-BYTE      REDEFINES PV-DRV-LIC-NBR-LONG   01940099
019500                                        OCCURS 50 TIMES           01950099
019600                                        PIC  X(01).               01960099
019700                                                                  01970099
019800     05  PV-HOLD-FIELDS.                                          01980050
019900         10  PV-HOLD-DRV-LIC-NBR        PIC X(21)   VALUE SPACE.  01990050
020000         10  PV-HOLD-CARD-NBR           PIC X(12)   VALUE SPACE.  02000075
020100         10  PV-HOLD-CARD-NBR-N  REDEFINES  PV-HOLD-CARD-NBR      02010050
020200                                        PIC  9(12).               02020075
020300         10  PV-HOLD-CARD-ID            PIC  9(12)  VALUE ZEROS.  02030085
020400         10  PV-HOLD-CARD-NBR-NUM       PIC S9(12)V VALUE ZERO    02040075
020500                                                    COMP-3.       02050050
020600         10  PV-HOLD-ISSUE-DATE.                                  02060050
020700             15  PV-HOLD-ISSUE-DATE-CC  PIC X(2)    VALUE SPACE.  02070050
020800             15  PV-HOLD-ISSUE-DATE-YY  PIC X(2)    VALUE SPACE.  02080050
020900             15  FILLER                 PIC X(1)    VALUE '-'.    02090050
021000             15  PV-HOLD-ISSUE-DATE-MM  PIC X(2)    VALUE SPACE.  02100050
021100             15  FILLER                 PIC X(1)    VALUE '-'.    02110050
021200             15  PV-HOLD-ISSUE-DATE-DD  PIC X(2)    VALUE SPACE.  02120050
021300         10  PV-HOLD-ISSUE-DATE2.                                 02130050
021400             15  PV-HOLD-ISSUE-DATE2-CC PIC X(2)    VALUE SPACE.  02140050
021500             15  PV-HOLD-ISSUE-DATE2-YY PIC X(2)    VALUE SPACE.  02150050
021600             15  FILLER                 PIC X(1)    VALUE '-'.    02160050
021700             15  PV-HOLD-ISSUE-DATE2-MM PIC X(2)    VALUE SPACE.  02170050
021800             15  FILLER                 PIC X(1)    VALUE '-'.    02180050
021900             15  PV-HOLD-ISSUE-DATE2-DD PIC X(2)    VALUE SPACE.  02190050
022000         10  PV-HOLD-ISSUE-STORE        PIC S9(4)   VALUE ZERO    02200050
022100                                                    COMP.         02210050
022200         10  PV-HOLD-ISSUE-AMT          PIC S9(7)V9(2) VALUE ZERO 02220050
022300                                                    COMP-3.       02230050
022400         10  PV-HOLD-CARD-STAT          PIC  X(2)   VALUE SPACES. 02240050
022500         10  PV-HOLD-BALANCE            PIC S9(7)V9(2) VALUE ZERO 02250050
022600                                                    COMP-3.       02260050
022700******************************************************************02270050
022800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02280050
022900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02290050
023000**  APPLICATION-SPECIFIC COMMAREA.                              **02300050
023100******************************************************************02310050
023200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02320050
023300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02330050
023400     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02340050
023500                                        INDEXED BY LQW-IDX.       02350050
023600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02360050
023700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02370050
023800         10  LQW-SELECTED-SW            PIC  X(01).               02380050
023900             88  LQW-SELECT                         VALUE 'S'     02390099
024000                                                          's'.    02400099
024100             88  LQW-DESELECT                       VALUE ' '.    02410050
024200*        10  LQW-DRV-LIC-NBR            PIC  X(21).               02420099
024300         10  LQW-CARD-ID                PIC  X(12).               02430080
024400         10  LQW-ISSUE-STORE            PIC  9(04).               02440050
024500         10  LQW-ISSUE-DATE             PIC  X(10).               02450050
024600         10  LQW-ISSUE-AMT              PIC  S9(04)V99.           02460050
024700         10  LQW-BALANCE                PIC  S9(04)V99.           02470050
024800         10  LQW-CARD-STATUS            PIC  X(02).               02480050
024900                                                                  02490050
025000******************************************************************02500050
025100**  THIS IS THE LAYOUT FOR THE BLOCK TEMP STORAGE QUEUE.        **02510050
025200**  THIS MUST BE THE EXACT SAME FORMAT AS A BLOCK IN THE        **02520050
025300**  APPLICATION-SPECIFIC COMMAREA.                              **02530050
025400******************************************************************02540050
025500 01  BQW-SUBSCRIPTS.                                              02550050
025600     05  BQW-ITEM-SUB                   PIC S9(04)  VALUE +0      02560050
025700                                                    COMP SYNC.    02570050
025800     05  BQW-BLOCK-SUB                  PIC S9(04)  VALUE +0      02580050
025900                                                    COMP SYNC.    02590050
026000 01  BQW-BLOCK                       PIC X(885).                  02600095
026100 01  BQW-BLOCK-ENTRIES REDEFINES BQW-BLOCK.                       02610050
026200     05  BQW-BLOCK-MODIFIED       PIC  X(01).                     02620050
026300     05  BQW-ITEM-ENTRIES         OCCURS 13 TIMES.                02630050
026400         10  BQW-LIST-ITEM-NUMBER     PIC S9(09)  COMP-3.         02640050
026500         10  BQW-TEMP-SELECTED-SW     PIC  X(01).                 02650050
026600         10  BQW-SELECTED-SW          PIC  X(01).                 02660050
026700             88  BQW-SELECTED                     VALUE 'S'       02670099
026800                                                        's'.      02680099
026900*        10  BQW-DRV-LIC-NBR          PIC  X(21).                 02690099
027000         10  BQW-CARD-ID              PIC  X(12).                 02700075
027100         10  BQW-ISSUE-STORE          PIC  9(04).                 02710050
027200         10  BQW-ISSUE-DATE           PIC  X(10).                 02720050
027300         10  BQW-ISSUE-AMT            PIC  S9(04)V99.             02730050
027400         10  BQW-BALANCE              PIC  S9(04)V99.             02740050
027500         10  BQW-CARD-STATUS          PIC  X(02).                 02750050
027600*---------------------------------------------------------------* 02760050
027700*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 02770050
027800*---------------------------------------------------------------* 02780050
027900                                                                  02790050
028000     COPY RDWS025.                                                02800050
028100                                                                  02810050
028200*---------------------------------------------------------------* 02820050
028300*    MAP LAYOUT                                                 * 02830050
028400*---------------------------------------------------------------* 02840050
028500                                                                  02850050
028600     COPY RDKM029.                                                02860050
028700*                                                                 02870050
028800 01  MR-OCCURS-LAYOUT                   REDEFINES  RD029AO.       02880050
028900*    05  FILLER                         PIC X(68).                02890099
029000     05  FILLER                         PIC X(97).                02900099
029100     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02910050
029200         10  MR-SELECTL                 PIC S9(04) COMP.          02920050
029300         10  MR-SELECTA                 PIC  X(01).               02930050
029400         10  MR-SELECTC                 PIC  X(01).               02940050
029500         10  MR-SELECTH                 PIC  X(01).               02950050
029600         10  MR-SELECTI                 PIC  X(01).               02960050
029700                                                                  02970050
029800*        10  MR-DRV-LIC-NBRL            PIC S9(04) COMP.          02980099
029900*        10  MR-DRV-LIC-NBRA            PIC  X(01).               02990099
030000*        10  MR-DRV-LIC-NBRC            PIC  X(01).               03000099
030100*        10  MR-DRV-LIC-NBRH            PIC  X(01).               03010099
030200*        10  MR-DRV-LIC-NBR             PIC  X(21).               03020099
030300                                                                  03030050
030400         10  MR-CARD-IDL                PIC S9(04) COMP.          03040050
030500         10  MR-CARD-IDA                PIC  X(01).               03050050
030600         10  MR-CARD-IDC                PIC  X(01).               03060050
030700         10  MR-CARD-IDH                PIC  X(01).               03070050
030800         10  MR-CARD-ID-X.                                        03080088
030900             15  MR-CARD-ID             PIC  Z(12).               03090094
031000                                                                  03100050
031100         10  MR-ISSUE-STRL              PIC S9(04) COMP.          03110050
031200         10  MR-ISSUE-STRA              PIC  X(01).               03120050
031300         10  MR-ISSUE-STRC              PIC  X(01).               03130050
031400         10  MR-ISSUE-STRH              PIC  X(01).               03140050
031500         10  MR-ISSUE-STR-X.                                      03150050
031600             15 MR-ISSUE-STR            PIC  9(04).               03160050
031700                                                                  03170050
031800         10  MR-ISSUE-DTEL              PIC S9(04) COMP.          03180050
031900         10  MR-ISSUE-DTEA              PIC  X(01).               03190050
032000         10  MR-ISSUE-DTEC              PIC  X(01).               03200050
032100         10  MR-ISSUE-DTEH              PIC  X(01).               03210050
032200         10  MR-ISSUE-DTE               PIC  X(10).               03220050
032300                                                                  03230050
032400         10  MR-ISSUE-AMTL              PIC S9(04) COMP.          03240050
032500         10  MR-ISSUE-AMTA              PIC  X(01).               03250050
032600         10  MR-ISSUE-AMTC              PIC  X(01).               03260050
032700         10  MR-ISSUE-AMTH              PIC  X(01).               03270050
032800         10  MR-ISSUE-AMT-X.                                      03280050
032900             15 MR-ISSUE-AMT            PIC ZZZZ.99-.             03290050
033000                                                                  03300050
033100         10  MR-BALANCEL                PIC S9(04) COMP.          03310050
033200         10  MR-BALANCEA                PIC  X(01).               03320050
033300         10  MR-BALANCEC                PIC  X(01).               03330050
033400         10  MR-BALANCEH                PIC  X(01).               03340050
033500         10  MR-BALANCE-X.                                        03350050
033600             15 MR-BALANCE              PIC ZZZZ.99-.             03360050
033700                                                                  03370050
033800         10  MR-CARD-STATUSL            PIC S9(04) COMP.          03380050
033900         10  MR-CARD-STATUSA            PIC  X(01).               03390050
034000         10  MR-CARD-STATUSC            PIC  X(01).               03400050
034100         10  MR-CARD-STATUSH            PIC  X(01).               03410050
034200         10  MR-CARD-STATUS             PIC  X(02).               03420050
034300     05  FILLER                         PIC  X(12).               03430081
034400                                                                  03440050
034500*---------------------------------------------------------------* 03450050
034600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03460050
034700*---------------------------------------------------------------* 03470050
034800                                                                  03480050
034900     COPY DPWS015.                                                03490050
035000                                                                  03500050
035100*---------------------------------------------------------------* 03510050
035200*    FUNCTION KEYS COPYBOOK.                                    * 03520050
035300*---------------------------------------------------------------* 03530050
035400                                                                  03540050
035500     COPY DPWS016.                                                03550050
035600                                                                  03560050
035700*---------------------------------------------------------------* 03570050
035800*    NUMERIC EDIT LAYOUT.                                       * 03580050
035900*---------------------------------------------------------------* 03590050
036000                                                                  03600050
036100     COPY DPWS010I.                                               03610050
036200*---------------------------------------------------------------* 03620050
036300*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03630099
036400*---------------------------------------------------------------* 03640050
036500                                                                  03650050
036600     COPY DPWS030.                                                03660050
CICS       COPY DPWS930.                                                03661099
036700*---------------------------------------------------------------* 03670050
036800*    STANDARD COMMAREA.                                         * 03680050
036900*---------------------------------------------------------------* 03690050
037000                                                                  03700050
037100     COPY DPWS020.                                                03710050
037200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03720050
037300                                                                  03730050
037400*---------------------------------------------------------------* 03740050
037500* INTER-APPLICATION COMMAREA.                                   * 03750050
037600*   RDWS024 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03760050
037700*             SPEC SCREEN.                                      * 03770050
037800*   RDWS020 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03780050
037900*             THIS LIST PROGRAMMING TO THE KMRC INQUIRY SCREEN. * 03790050
038000*   RDWS026 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03800050
038100*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03810050
038200*---------------------------------------------------------------* 03820050
038300                                                                  03830050
038400         10  INTER-APPL-COMM-AREA       PIC X(200).               03840050
038500     COPY RDWS024.                                                03850050
038600     COPY RDWS020.                                                03860050
038700     COPY RDWS026.                                                03870050
038800*---------------------------------------------------------------* 03880050
038900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03890050
039000*---------------------------------------------------------------* 03900050
039100         10  ASC-SPECIFIC-COMMAREA.                               03910050
039200             15  ASC-LIST-KEYS.                                   03920050
039300                 20  ASC-KEY-DRV-LIC-NBR             PIC  X(21).  03930050
039400                 20  ASC-KEY-DRV-LIC-NBR-LONG        PIC  X(50).  03940099
039500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03950050
039600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03960050
039700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03970050
039800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03980050
039900                                                                  03990050
040000                 20  ASC-ITEM-ARRAY.                              04000050
040100                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        04010050
040200                         30  ASC-LIST-ITEM-NUMBER                 04020050
040300                                                     PIC S9(09)   04030050
040400                                                     COMP-3.      04040050
040500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04050050
040600                             88  ASC-VALID-SELECT    VALUE ' '    04060050
040700                                                           'S'    04070099
040800                                                           's'    04080099
040900                                                           'B'    04090050
041000                                                           'b'    04100099
041100                                                           'E'    04110099
041200                                                           'e'.   04120099
041300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04130050
041400                             88  ASC-TEMP-SELECT     VALUE 'S'    04140099
041500                                                           's'.   04150099
041600                             88  ASC-TEMP-BEGIN      VALUE 'B'    04160099
041700                                                           'b'.   04170099
041800                             88  ASC-TEMP-END        VALUE 'E'    04180099
041900                                                           'e'.   04190099
042000                         30  ASC-SELECTED-SW         PIC  X(01).  04200050
042100                             88  ASC-NO-SELECT       VALUE ' '.   04210050
042200                             88  ASC-SELECT          VALUE 'S'    04220099
042300                                                           's'.   04230099
042400                             88  ASC-BEGIN           VALUE 'B'    04240099
042500                                                           'b'.   04250099
042600                             88  ASC-END             VALUE 'E'    04260099
042700                                                           'e'.   04270099
042800*                        30  ASC-DRV-LIC-NBR         PIC  X(21).  04280099
042900                         30  ASC-CARD-ID             PIC  X(12).  04290075
043000                         30  ASC-CARD-ID-N REDEFINES              04300087
043100                             ASC-CARD-ID             PIC  9(12).  04310087
043200                         30  ASC-ISSUE-STORE         PIC  9(04).  04320050
043300                         30  ASC-ISSUE-DATE          PIC  X(10).  04330050
043400                         30  ASC-ISSUE-AMT           PIC          04340050
043500                                                     S9(04)V99.   04350050
043600                         30  ASC-BALANCE             PIC          04360050
043700                                                     S9(04)V99.   04370050
043800                         30  ASC-CARD-STATUS         PIC  X(02).  04380050
043900                                                                  04390050
044000             15  ASC-BLK-SUB                         PIC S9(04)   04400050
044100                                                          COMP    04410050
044200                                                          SYNC.   04420050
044300             15  ASC-ITEM-SUB                        PIC S9(04)   04430050
044400                                                          COMP    04440050
044500                                                          SYNC.   04450050
044600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04460050
044700                                                          COMP-3. 04470050
044800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04480050
044900                                                          COMP-3. 04490050
045000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04500050
045100                                                          COMP-3. 04510050
045200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04520050
045300                                                          COMP-3. 04530050
045400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04540050
045500                                                          COMP-3. 04550050
045600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04560050
045700                                                          COMP    04570050
045800                                                          SYNC.   04580050
045900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04590050
046000                                                          COMP-3. 04600050
046100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04610050
046200                                                          COMP-3. 04620050
046300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04630050
046400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04640050
046500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04650050
046600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04660050
046700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04670050
046800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04680050
046900             15  ASC-LIST-QUEUE-NAME.                             04690050
047000                 20  ASC-LIST-TERM-ID                PIC  X(04).  04700050
047100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04710050
047200                                                          COMP-3. 04720050
047300                 20  ASC-LIST-SEQ                    PIC  9(01).  04730050
047400             15  ASC-SEL-QUEUE-NAME.                              04740050
047500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04750050
047600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04760050
047700                                                          COMP-3. 04770050
047800                 20  ASC-SEL-SEQ                     PIC  9(01).  04780050
047900                                                                  04790050
048000             15  ASC-CURSOR-SW                       PIC  X(01).  04800050
048100                 88  ASC-NO-CURSOR                   VALUE 'Z'.   04810050
048200                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   04820050
048300                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   04830050
048400                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   04840050
048500             15  ASC-START-ITEM-REQUEST.                          04850050
048600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04860050
048700         10  FILLER                                  PIC X(1012). 04870079
048800*---------------------------------------------------------------* 04880050
048900*    ABEND PROCESSING COPYBOOK.                                 * 04890050
049000*---------------------------------------------------------------* 04900050
049100                                                                  04910050
049200     COPY DPWS013.                                                04920050
049300                                                                  04930050
049400*---------------------------------------------------------------* 04940050
049500*    REFUND COPYBOOK.                                             04950050
049600*---------------------------------------------------------------* 04960050
049700                                                                  04970050
049800     COPY SVWS004.                                                04980077
049900                                                                  04990050
050000*---------------------------------------------------------------* 05000050
050100*    DB2 AREA FOR KMRC TABLE                                    * 05010050
050200*---------------------------------------------------------------* 05020050
050300     EXEC SQL                                                     05030050
050400          INCLUDE SVT00001                                        05040075
050500     END-EXEC.                                                    05050050
050600*---------------------------------------------------------------* 05060057
050700*    DB2 AREA FOR KMRC HISTORY TABLE                            * 05070057
050800*---------------------------------------------------------------* 05080072
050900     EXEC SQL                                                     05090057
051000          INCLUDE SVT00005                                        05100075
051100     END-EXEC.                                                    05110057
051200*---------------------------------------------------------------* 05120050
051300*    DB2 AREA FOR KMRC ACTIVITY TABLE                           * 05130050
051400*---------------------------------------------------------------* 05140072
051500     EXEC SQL                                                     05150050
051600          INCLUDE SVT00002                                        05160075
051700     END-EXEC.                                                    05170050
051800*---------------------------------------------------------------* 05180057
051900*    DB2 AREA FOR KMRC ACTIVITY HISTORY TABLE                   * 05190057
052000*---------------------------------------------------------------* 05200057
052100     EXEC SQL                                                     05210057
052200          INCLUDE SVT00006                                        05220075
052300     END-EXEC.                                                    05230057
052400*---------------------------------------------------------------* 05240099
052500*    DB2 AREA FOR ENCRYPTED DL NBR (RDT_DRVR_LIC_TRANSL)        * 05250099
052600*---------------------------------------------------------------* 05260099
052700     EXEC SQL                                                     05270099
052800          INCLUDE RDT00004                                        05280099
052900     END-EXEC.                                                    05290099
053000*---------------------------------------------------------------* 05300050
053100*    DB2 AREA FOR COMMUNICATIONS                                * 05310050
053200*---------------------------------------------------------------* 05320050
053300     EXEC SQL                                                     05330050
053400          INCLUDE SQLCA                                           05340050
053500     END-EXEC.                                                    05350050
053600                                                                  05360050
053700*---------------------------------------------------------------* 05370050
053800*    SVT_KOHLS_CRD_TXN                                          * 05380077
053900*            CURSOR WHEN DRVIERS LICENSE NUMBER IS REQUESTED    * 05390077
054000*            USED WHEN WILDCARD IS ENTERED                      * 05400099
054100*---------------------------------------------------------------* 05410050
054200                                                                  05420050
054300     EXEC SQL                                                     05430050
054400          DECLARE DRV-LIC-NBR-CSR CURSOR                          05440050
054500          FOR SELECT                                              05450050
054600                A.CRD_NBR                                         05460050
054700              , DRV_LIC_NBR                                       05470050
054800              , TRN_VOID_IND                                      05480050
054900              , ACTVY_TYP_CDE                                     05490050
055000              , POS_DTE                                           05500050
055100              , A.STR_NBR                                         05510050
055200              , APP_AUTH_AMT                                      05520050
055300              , ACTVY_STAT_CDE                                    05530050
055400              , B.CRD_STAT_CDE                                    05540050
055500          FROM                                                    05550050
055600                SVT_KOHLS_CRD_TXN A                               05560077
055700              , SVT_KOHLS_CRD_ACCT B                              05570076
055800          WHERE                                                   05580050
055900                (DRV_LIC_NBR  LIKE :DK-DRV-LIC-NBR)               05590050
056000            AND ACTVY_TYP_CDE = :SV004-ISSUE-KMRC-ACT-TYP-N       05600077
056100            AND CRD_TYP_CDE = :SV004-KMRC-CRD-TYP                 05610077
056200            AND B.CRD_NBR = A.CRD_NBR                             05620050
056300          ORDER BY                                                05630050
056400                DRV_LIC_NBR                                       05640099
056500          WITH UR                                                 05650099
056600     END-EXEC.                                                    05660050
056700                                                                  05670050
056800*---------------------------------------------------------------* 05680057
056900*    SVT_CRD_TXN_HIST                                           * 05690099
057000*    HISTORY CURSOR WHEN DRIVERS LICENSE NUMBER IS REQUESTED    * 05700099
057100*            USED WHEN WILDCARD IS ENTERED                      * 05710099
057200*---------------------------------------------------------------* 05720057
057300     EXEC SQL                                                     05730057
057400          DECLARE DLNBR-CSR-HIST CURSOR                           05740058
057500          FOR SELECT                                              05750057
057600                A.CRD_NBR                                         05760057
057700              , DRV_LIC_NBR                                       05770057
057800              , TRN_VOID_IND                                      05780057
057900              , ACTVY_TYP_CDE                                     05790057
058000              , POS_DTE                                           05800057
058100              , A.STR_NBR                                         05810057
058200              , APP_AUTH_AMT                                      05820057
058300              , ACTVY_STAT_CDE                                    05830057
058400              , B.CRD_STAT_CDE                                    05840057
058500          FROM                                                    05850057
058600                SVT_CRD_TXN_HIST A                                05860077
058700              , SVT_CRD_ACCT_HIST B                               05870077
058800          WHERE                                                   05880057
058900                (DRV_LIC_NBR  LIKE :DK-DRV-LIC-NBR)               05890057
059000            AND ACTVY_TYP_CDE = :SV004-ISSUE-KMRC-ACT-TYP-N       05900077
059100            AND CRD_TYP_CDE = :SV004-KMRC-CRD-TYP                 05910077
059200            AND B.CRD_NBR = A.CRD_NBR                             05920057
059300          ORDER BY                                                05930057
059400                DRV_LIC_NBR                                       05940099
059500          WITH UR                                                 05950099
059600     END-EXEC.                                                    05960057
059700                                                                  05970057
059800*---------------------------------------------------------------* 05980099
059900*    SVT_KOHLS_CRD_TXN                                          * 05990099
060000*            CURSOR WHEN DRVIERS LICENSE NUMBER IS REQUESTED    * 06000099
060100*            USED WHEN WILDCARD IS NOT ENTERED                  * 06010099
060200*---------------------------------------------------------------* 06020099
060300                                                                  06030099
060400     EXEC SQL                                                     06040099
060500          DECLARE EQUAL-CSR CURSOR                                06050099
060600          FOR SELECT                                              06060099
060700                A.CRD_NBR                                         06070099
060800              , DRV_LIC_NBR                                       06080099
060900              , TRN_VOID_IND                                      06090099
061000              , ACTVY_TYP_CDE                                     06100099
061100              , POS_DTE                                           06110099
061200              , A.STR_NBR                                         06120099
061300              , APP_AUTH_AMT                                      06130099
061400              , ACTVY_STAT_CDE                                    06140099
061500              , B.CRD_STAT_CDE                                    06150099
061600          FROM                                                    06160099
061700                SVT_KOHLS_CRD_TXN A                               06170099
061800              , SVT_KOHLS_CRD_ACCT B                              06180099
061900          WHERE                                                   06190099
062000                (DRV_LIC_NBR  = :DK-DRV-LIC-NBR)                  06200099
062100            AND ACTVY_TYP_CDE = :SV004-ISSUE-KMRC-ACT-TYP-N       06210099
062200            AND CRD_TYP_CDE = :SV004-KMRC-CRD-TYP                 06220099
062300            AND B.CRD_NBR = A.CRD_NBR                             06230099
062400          WITH UR                                                 06240099
062500     END-EXEC.                                                    06250099
062600                                                                  06260099
062700*---------------------------------------------------------------* 06270099
062800*    SVT_CRD_TXN_HIST                                           * 06280099
062900*    HISTORY CURSOR WHEN DRIVERS LICENSE NUMBER IS REQUESTED    * 06290099
063000*            USED WHEN WILDCARD IS NOT ENTERED                  * 06300099
063100*---------------------------------------------------------------* 06310099
063200     EXEC SQL                                                     06320099
063300          DECLARE EQUAL-CSR-HIST CURSOR                           06330099
063400          FOR SELECT                                              06340099
063500                A.CRD_NBR                                         06350099
063600              , DRV_LIC_NBR                                       06360099
063700              , TRN_VOID_IND                                      06370099
063800              , ACTVY_TYP_CDE                                     06380099
063900              , POS_DTE                                           06390099
064000              , A.STR_NBR                                         06400099
064100              , APP_AUTH_AMT                                      06410099
064200              , ACTVY_STAT_CDE                                    06420099
064300              , B.CRD_STAT_CDE                                    06430099
064400          FROM                                                    06440099
064500                SVT_CRD_TXN_HIST A                                06450099
064600              , SVT_CRD_ACCT_HIST B                               06460099
064700          WHERE                                                   06470099
064800                (DRV_LIC_NBR  = :DK-DRV-LIC-NBR)                  06480099
064900            AND ACTVY_TYP_CDE = :SV004-ISSUE-KMRC-ACT-TYP-N       06490099
065000            AND CRD_TYP_CDE = :SV004-KMRC-CRD-TYP                 06500099
065100            AND B.CRD_NBR = A.CRD_NBR                             06510099
065200          WITH UR                                                 06520099
065300     END-EXEC.                                                    06530099
065400                                                                  06540099
065500 LINKAGE SECTION.                                                 06550099
065600                                                                  06560050
065700 01  DFHCOMMAREA.                                                 06570050
065800     05  FILLER                         OCCURS  1 TO 4072 TIMES   06580050
065900                                        DEPENDING ON EIBCALEN.    06590050
066000         10  FILLER                     PIC X.                    06600050
066100                                                                  06610050
066200 PROCEDURE DIVISION.                                              06620050
066300******************************************************************06630050
066400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06640050
066500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06650050
066600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06660050
066700******************************************************************06670050
066800 0000-MAIN-MODULE.                                                06680050
066900     INITIALIZE DP030-CICS-API-FIELDS.                            06690050
067000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06700050
067100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06710050
067200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06720050
067300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06730050
067400     MOVE LENGTH OF RD029AI        TO DP030-MAP-LENGTH (1).       06740050
067500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06750050
067600*  THIS TURNS OFF THE MIXED CASE CONVERSION                       06760099
067700     EXEC CICS                                                    06770099
067800          SET TERMINAL(EIBTRMID) NOUCTRAN                         06780099
067900     END-EXEC.                                                    06790099
068000*                                                                 06800099
068100     PERFORM 0001-CALL-CICS-ARCH-API.                             06810050
068200                                                                  06820099
068300*  THIS TURNS BACK ON THE MIXED CASE CONVERSION                   06830099
068400     EXEC CICS                                                    06840099
068500          SET TERMINAL(EIBTRMID) UCTRAN                           06850099
068600     END-EXEC.                                                    06860099
068700*                                                                 06870099
068800     PERFORM 1000-CONTROL-PROCESSING                              06880050
068900*                                                                 06890050
069000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06900050
069100     PERFORM 0001-CALL-CICS-ARCH-API.                             06910050
069200                                                                  06920050
069300******************************************************************06930050
069400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06940050
069500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06950050
069600******************************************************************06960050
069700 0001-CALL-CICS-ARCH-API.                                         06970050
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06980099
069900                                    DFHCOMMAREA                   06990099
070000                                    DP030-CICS-API-FIELDS         07000099
070100                                    DP020-STANDARD-COMMAREA       07010099
070200                                    RD029AI.                      07020099
070300*                                                                 07030050
070400     IF  DP030-RC-CALL-SUCCESSFUL                                 07040050
070500         CONTINUE                                                 07050050
070600     ELSE                                                         07060050
070700         SET DP013-NO-ROLLBACK                                    07070050
070800             DP013-XCTL-DISPLAY-RESTART                           07080050
070900             DP013-CICS-ABEND      TO TRUE                        07090050
071000         MOVE '0001-CALL-CICS-ARCH-API'                           07100050
071100                                   TO DP013-PARAGRAPH             07110050
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07111099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07112099
071400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07140050
071500         PERFORM DP013-0000-PROCESS-ABEND                         07150050
071600     END-IF.                                                      07160050
071700*----------------------------------------------------------------*07170050
071800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07180050
071900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07190050
072000*                                                                *07200050
072100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07210050
072200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07220050
072300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07230050
072400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07240050
072500*----------------------------------------------------------------*07250050
072600                                                                  07260050
072700 1000-CONTROL-PROCESSING.                                         07270050
072800                                                                  07280050
072900     EVALUATE TRUE                                                07290050
073000         WHEN DP020-NEXT-ACT-INITIAL                              07300050
073100             INITIALIZE ASC-SPECIFIC-COMMAREA                     07310050
073200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07320050
073300                                      ASC-SEL-TERM-ID             07330050
073400             MOVE DP020-SRC-TASK-NUMBER                           07340050
073500                                   TO ASC-LIST-TASK-NUMBER        07350050
073600                                      ASC-SEL-TASK-NUMBER         07360050
073700             MOVE PC-LIST-QUEUE-SEQ                               07370050
073800                                   TO ASC-LIST-SEQ                07380050
073900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07390050
074000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07400050
074100***-----$TEMPLATE NOTE$-------------------------------------------07410050
074200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,07420050
074300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  07430050
074400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.07440050
074500***---------------------------------------------------------------07450050
074600             IF  PS-COMMAREA-NOT-VALID                            07460050
074700                 SET DP020-NEXT-ACT-APPL-ERROR                    07470050
074800                                   TO TRUE                        07480050
074900             ELSE                                                 07490050
075000                 PERFORM 4000-BUILD-INITIAL-PANEL                 07500050
075100             END-IF                                               07510050
075200                                                                  07520050
075300         WHEN DP020-NEXT-ACT-READ-MAP                             07530050
075400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07540050
075500                                   TO PV-TOP-ITEM                 07550050
075600             PERFORM 2000-PROCESS-PANEL                           07560050
075700                                                                  07570050
075800         WHEN DP020-NEXT-ACT-RETURN                               07580050
075900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07590050
076000                                   TO PV-TOP-ITEM                 07600050
076100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07610050
076200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07620050
076300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07630050
076400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07640050
076500                                                                  07650050
076600         WHEN OTHER                                               07660050
076700             SET DP013-LOGIC-ABEND TO TRUE                        07670050
076800             SET DP013-NO-ROLLBACK TO TRUE                        07680050
076900             MOVE '1000-CONTROL-PROCESSING'                       07690050
077000                                   TO DP013-PARAGRAPH             07700050
077100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07710050
077200                                   TO DP013-MESSAGE-TEXT(1)       07720050
077300             PERFORM DP013-0000-PROCESS-ABEND                     07730050
077400     END-EVALUATE.                                                07740050
077500                                                                  07750050
077600*----------------------------------------------------------------*07760050
077700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07770050
077800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07780050
077900*----------------------------------------------------------------*07790050
078000                                                                  07800050
078100 1100-PROCESS-INTER-APPL-COMM.                                    07810050
078200                                                                  07820050
078300     SET PS-COMMAREA-VALID         TO TRUE.                       07830050
078400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07840099
078500     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07850050
078600         IF RD024-DRV-LIC-NBR = SPACES                            07860099
078700            MOVE RD024-DRV-LIC-NBR-LONG                           07870099
078800                                    TO ASC-KEY-DRV-LIC-NBR-LONG   07880099
078900            PERFORM 4600-DL-ROUTINE                               07890099
079000            MOVE RDT00004-DRVR-LIC-NBR-TEXT                       07900099
079100                                    (1:RDT00004-DRVR-LIC-NBR-LEN) 07910099
079200                                    TO DK-DRV-LIC-NBR             07920099
079300         ELSE                                                     07930099
079400            MOVE RD024-DRV-LIC-NBR  TO ASC-KEY-DRV-LIC-NBR        07940099
079500                                       DK-DRV-LIC-NBR             07950099
079600         END-IF                                                   07960099
079700     ELSE                                                         07970050
079800         IF  DP020-NAV-KEY-DATA > SPACE                           07980050
079900             MOVE DP020-NAV-KEY-DATA                              07990050
080000                                     TO DK-DRV-LIC-NBR            08000099
080100                                        ASC-KEY-DRV-LIC-NBR       08010099
080200         END-IF                                                   08020050
080300     END-IF.                                                      08030050
080400                                                                  08040050
080500*----------------------------------------------------------------*08050050
080600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08060050
080700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08070050
080800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08080050
080900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08090050
081000* FUNCTION KEYS CAN GET THIS FAR.                                *08100050
081100*----------------------------------------------------------------*08110050
081200                                                                  08120050
081300 2000-PROCESS-PANEL.                                              08130050
081400     EVALUATE TRUE                                                08140050
081500         WHEN DP020-SRC-AID = DP016-CLEAR                         08150050
081600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08160050
081700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08170050
081800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08180050
081900                                                                  08190050
082000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08200050
082100             IF ASC-KEY-DRV-LIC-NBR > SPACES                      08210099
082200                MOVE ASC-KEY-DRV-LIC-NBR                          08220099
082300                                   TO DK-DRV-LIC-NBR              08230050
082400             ELSE                                                 08240099
082500                MOVE ASC-KEY-DRV-LIC-NBR-LONG                     08250099
082600                                   TO DK-DRV-LIC-NBR-LONG         08260099
082700             END-IF                                               08270099
082800             PERFORM 2050-DELETE-LIST-QUEUE                       08280050
082900             PERFORM 4000-BUILD-INITIAL-PANEL                     08290050
083000                                                                  08300050
083100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08310050
083200             PERFORM 2140-DESELECT-ALL-ITEMS                      08320050
083300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08330050
083400                                                                  08340050
083500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08350050
083600             PERFORM 2150-SELECT-ALL-ITEMS                        08360050
083700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08370050
083800                                                                  08380050
083900         WHEN OTHER                                               08390050
084000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08400050
084100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08410050
084200             IF  PS-NO-ERROR                                      08420050
084300                 SET DP030-CONTINUE-GO                            08430050
084400                                 TO TRUE                          08440050
084500                 PERFORM 2100-CHECK-FUNCTION-KEY                  08450050
084600             ELSE                                                 08460050
084700                 SET DP030-OVERRIDE-GO                            08470050
084800                                 TO TRUE                          08480050
084900             END-IF                                               08490050
085000     END-EVALUATE.                                                08500050
085100*----------------------------------------------------------------*08510050
085200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08520050
085300*----------------------------------------------------------------*08530050
085400 2050-DELETE-LIST-QUEUE.                                          08540050
085500                                                                  08550050
085600     EXEC CICS                                                    08560050
085700         DELETEQ TS                                               08570050
085800             QUEUE (ASC-LIST-QUEUE-NAME)                          08580050
085900             RESP  (PV-CICS-RESP)                                 08590050
086000     END-EXEC.                                                    08600050
086100                                                                  08610050
086200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08620050
086300        (PV-CICS-RESP = DFHRESP(QIDERR))                          08630050
086400         CONTINUE                                                 08640050
086500     ELSE                                                         08650050
086600         SET DP013-CICS-ABEND      TO TRUE                        08660050
086700         SET DP013-NO-ROLLBACK     TO TRUE                        08670050
086800                                                                  08680050
086900         MOVE '2050-DELETE-LIST-QUEUE'                            08690050
087000                                   TO DP013-PARAGRAPH             08700050
087100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08710050
087200                                   TO DP013-MESSAGE-TEXT (1)      08720050
087300         PERFORM DP013-0000-PROCESS-ABEND                         08730050
087400     END-IF.                                                      08740050
087500                                                                  08750050
087600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08760050
087700*----------------------------------------------------------------*08770050
087800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08780050
087900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08790050
088000* CICS ARCHITECTURE API.                                         *08800050
088100*----------------------------------------------------------------*08810050
088200 2100-CHECK-FUNCTION-KEY.                                         08820050
088300     EVALUATE TRUE                                                08830050
088400         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               08840050
088500             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              08850050
088600                 SET DP030-OVERRIDE-GO                            08860050
088700                               TO TRUE                            08870050
088800*                --- A LIST ITEM MUST BE SELECTED ---             08880050
088900                 MOVE PC-TSYMSG-00057                             08890050
089000                               TO DP020-MSG-NUMBER                08900050
089100                 SET DP020-MSG-FATAL                              08910050
089200                               TO TRUE                            08920050
089300             ELSE                                                 08930050
089400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1                 08940050
089500                     SET DP030-OVERRIDE-GO                        08950050
089600                               TO TRUE                            08960050
089700*                    --- ONLY ONE LIST ITEM MAY BE SELECTED ---   08970050
089800                     MOVE PC-TSYMSG-00047                         08980050
089900                               TO DP020-MSG-NUMBER                08990050
090000                     SET DP020-MSG-FATAL                          09000050
090100                               TO TRUE                            09010050
090200             ELSE                                                 09020050
090300                 INITIALIZE RD026-INTER-APPL-COMMAREA             09030050
090400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO             09040050
090500                           RD026-NUMBER-OF-SELECTED-ITEMS         09050050
090600                 PERFORM 5000-PREPARE-SEL-QUEUE                   09060050
090700                 MOVE +1 TO BQW-BLOCK-SUB                         09070050
090800                 MOVE +1 TO BQW-ITEM-SUB                          09080050
090900                 INITIALIZE RD020-INTER-APPL-COMMAREA             09090050
091000                 PERFORM 5510-READ-TEMP-STORAGE                   09100050
091100                 SET PS-NO-SELECTION-FOUND TO TRUE                09110050
091200                 PERFORM 5500-FIND-FIRST-SELECTED                 09120050
091300                   UNTIL (PS-SELECTION-FOUND) OR                  09130050
091400                         (PV-CICS-RESP = DFHRESP(ITEMERR))        09140050
091500             END-IF                                               09150050
091600           END-IF                                                 09160050
091700                                                                  09170050
091800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09180050
091900             MOVE +1               TO PV-TOP-ITEM                 09190050
092000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09200050
092100                                                                  09210050
092200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09220050
092300             PERFORM 2110-BROWSE-BACKWARD                         09230050
092400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09240050
092500                                                                  09250050
092600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09260050
092700             PERFORM 2120-BROWSE-FORWARD                          09270050
092800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09280050
092900                                                                  09290050
093000         WHEN DP020-SRC-AID = DP016-ENTER                         09300050
093100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09310050
093200             IF  PS-ERROR                                         09320050
093300                 CONTINUE                                         09330050
093400             ELSE                                                 09340050
093500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09350050
093600             END-IF                                               09360050
093700                                                                  09370050
093800         WHEN OTHER                                               09380050
093900             SET DP013-NO-ROLLBACK                                09390050
094000                 DP013-XCTL-DISPLAY-RESTART                       09400050
094100                 DP013-CICS-ABEND  TO TRUE                        09410050
094200             MOVE '2100-CHECK-FUNCTION-KEY'                       09420050
094300                                   TO DP013-PARAGRAPH             09430050
094400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09440050
094500                                   TO DP013-MESSAGE-TEXT (1)      09450050
094600             PERFORM DP013-0000-PROCESS-ABEND                     09460050
094700     END-EVALUATE.                                                09470050
094800*                                                                 09480050
094900*----------------------------------------------------------------*09490050
095000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09500050
095100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09510050
095200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09520050
095300*    MESSAGE.                                                    *09530050
095400*----------------------------------------------------------------*09540050
095500                                                                  09550050
095600 2110-BROWSE-BACKWARD.                                            09560050
095700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09570050
095800         GIVING PV-TOP-ITEM.                                      09580050
095900*                                                                 09590050
096000     IF  ((PV-TOP-ITEM < +1)                                      09600050
096100       OR (PV-TOP-ITEM = +1))                                     09610050
096200         MOVE +1                   TO PV-TOP-ITEM                 09620050
096300*        -- TOP OF LIST --                                        09630050
096400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09640050
096500         SET DP020-MSG-INFORMATIONAL TO TRUE                      09650050
096600     END-IF.                                                      09660050
096700                                                                  09670050
096800*----------------------------------------------------------------*09680050
096900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09690050
097000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09700050
097100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09710050
097200*----------------------------------------------------------------*09720050
097300                                                                  09730050
097400 2120-BROWSE-FORWARD.                                             09740050
097500                                                                  09750050
097600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09760050
097700         GIVING PV-TOP-ITEM.                                      09770050
097800                                                                  09780098
097900     IF  ASC-ITEMS-LEFT-ON-DB AND                                 09790098
098000         (ASC-NUMBER-OF-ITEMS-READ >= PC-MAX-ITEMS)               09800098
098100         SET PS-MAX-FOUND TO TRUE                                 09810098
098200     END-IF                                                       09820098
098300                                                                  09830098
098400     IF ((PS-MAX-FOUND) AND                                       09840098
098500         (PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ))                09850098
098600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09860098
098700                                   TO PV-TOP-ITEM                 09870098
098800*        -- NOT ALL DATA DISPLAYED;CONTACT DATA PROCESSING --     09880098
098900         MOVE PC-TSYMSG-03026      TO DP020-MSG-NUMBER            09890098
099000         SET DP020-MSG-INFORMATIONAL                              09900098
099100                                   TO TRUE                        09910098
099200     ELSE                                                         09920098
099300       IF PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                  09930098
099400           MOVE ASC-ITEM-AT-TOP-OF-PANEL                          09940098
099500                                     TO PV-TOP-ITEM               09950098
099600*          -- BOTTOM OF LIST --                                   09960098
099700           MOVE PC-TSYMSG-00070    TO DP020-MSG-NUMBER            09970098
099800           SET DP020-MSG-INFORMATIONAL                            09980098
099900                                     TO TRUE                      09990098
100000       ELSE                                                       10000098
100100           COMPUTE PV-BOTTOM-ITEM =                               10010098
100200               PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1               10020098
100300           IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ           10030098
100400*              -- BOTTOM OF LIST --                               10040098
100500               MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER           10050098
100600               SET DP020-MSG-INFORMATIONAL                        10060098
100700                                     TO TRUE                      10070098
100800           END-IF                                                 10080098
100900       END-IF                                                     10090098
101000     END-IF.                                                      10100098
101100*----------------------------------------------------------------*10110050
101200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10120050
101300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10130050
101400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10140050
101500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10150050
101600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10160050
101700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10170050
101800*----------------------------------------------------------------*10180050
101900                                                                  10190050
102000 2130-CHECK-FOR-JUMP-BROWSE.                                      10200050
102100     SET PS-NO-ERROR               TO TRUE.                       10210050
102200     IF (ASC-START-ITEM-REQUEST = SPACE)                          10220050
102300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10230050
102400                                   TO PV-TOP-ITEM                 10240050
102500     ELSE                                                         10250050
102600         MOVE ASC-START-ITEM-REQUEST                              10260050
102700                                   TO DP010I-UNEDITED-FIELD       10270050
102800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10280050
102900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10290050
103000         SET DP010I-NEGATIVE-NOT-ALLOWED                          10300050
103100                                   TO TRUE                        10310050
103210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10321099
103220                         USING DP010I-NUMERIC-EDIT-AREA           10322099
103300                                                                  10330050
103400         IF  NOT DP010I-ERROR-DETECTED                            10340050
103500             MOVE DP010I-NUMERIC-FIELD                            10350050
103600                                   TO  ASC-START-ITEM-REQUEST-N   10360050
103700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10370050
103800                 IF  ASC-START-ITEM-REQUEST-N >                   10380050
103900                                          ASC-NUMBER-OF-ITEMS-READ10390050
104000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10400050
104100                     COMPUTE PV-TOP-ITEM =                        10410050
104200                             ASC-NUMBER-OF-ITEMS-READ             10420050
104300                             - PC-ITEMS-PER-PANEL + 1             10430050
104400                     IF  PV-TOP-ITEM < +1                         10440050
104500                         MOVE +1   TO PV-TOP-ITEM                 10450050
104600                         MOVE PC-TSYMSG-00070                     10460050
104700                                   TO DP020-MSG-NUMBER            10470050
104800                         SET DP020-MSG-INFORMATIONAL              10480050
104900                                   TO TRUE                        10490050
105000                     END-IF                                       10500050
105100                 ELSE                                             10510050
105200                     MOVE ASC-START-ITEM-REQUEST-N                10520050
105300                                   TO PV-TOP-ITEM                 10530050
105400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10540050
105500                     COMPUTE PV-BOTTOM-ITEM =                     10550050
105600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10560050
105700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10570050
105800*                        -- BOTTOM OF LIST --                     10580050
105900                         MOVE PC-TSYMSG-00070                     10590050
106000                                   TO DP020-MSG-NUMBER            10600050
106100                         SET DP020-MSG-INFORMATIONAL              10610050
106200                                   TO TRUE                        10620050
106300                     END-IF                                       10630050
106400                 END-IF                                           10640050
106500             ELSE                                                 10650050
106600*                --- VALUE OUT OF RANGE ----                      10660050
106700                 MOVE PC-TSYMSG-00101                             10670050
106800                                   TO DP020-MSG-NUMBER            10680050
106900                 MOVE -1           TO ASTRTITL                    10690050
107000                 SET DP030-SET-CURSOR-APPL-1                      10700050
107100                                   TO TRUE                        10710050
107200                 MOVE DP015-REVERSE                               10720050
107300                                   TO ASTRTITH                    10730050
107400                 MOVE DP015-RED    TO ASTRTITC                    10740050
107500                 MOVE DP015-UNP-NUM-BRT-MDT                       10750050
107600                                   TO ASTRTITA                    10760050
107700                 SET DP020-MSG-FATAL                              10770050
107800                                   TO TRUE                        10780050
107900                 SET PS-ERROR      TO TRUE                        10790050
108000             END-IF                                               10800050
108100                                                                  10810050
108200         ELSE                                                     10820050
108300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10830050
108400             MOVE -1               TO ASTRTITL                    10840050
108500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10850050
108600             MOVE DP015-REVERSE    TO ASTRTITH                    10860050
108700             MOVE DP015-RED        TO ASTRTITC                    10870050
108800             MOVE DP015-UNP-NUM-BRT-MDT                           10880050
108900                                   TO ASTRTITA                    10890050
109000             SET DP020-MSG-FATAL   TO TRUE                        10900050
109100             SET PS-ERROR          TO TRUE                        10910050
109200         END-IF                                                   10920050
109300     END-IF.                                                      10930050
109400*----------------------------------------------------------------*10940050
109500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10950050
109600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10960050
109700*----------------------------------------------------------------*10970050
109800 2140-DESELECT-ALL-ITEMS.                                         10980050
109900     MOVE +1                       TO ASC-BLK-SUB.                10990050
110000                                                                  11000050
110100     PERFORM 2141-CLEAR-SELECTED-INDS                             11010050
110200         VARYING ASC-ITEM-SUB                                     11020050
110300         FROM 1 BY 1                                              11030050
110400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11040050
110500                                                                  11050050
110600     ADD +1                        TO ASC-BLK-SUB.                11060050
110700                                                                  11070050
110800     PERFORM 2141-CLEAR-SELECTED-INDS                             11080050
110900         VARYING ASC-ITEM-SUB                                     11090050
111000         FROM 1 BY 1                                              11100050
111100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11110050
111200                                                                  11120050
111300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11130050
111400                                   TO PV-LIST-ITEM-NUMBER.        11140050
111500                                                                  11150050
111600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11160050
111700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11170050
111800                                                                  11180050
111900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11190050
112000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11200050
112100         MOVE +1                   TO ASC-BLK-SUB                 11210050
112200                                                                  11220050
112300         PERFORM 5100-WRITE-TEMP-STORAGE                          11230050
112400                                                                  11240050
112500         MOVE +1                   TO PV-BLOCK-NUMBER             11250050
112600                                                                  11260050
112700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11270050
112800             PV-FIRST-BLOCK-IN-ARRAY - 1                          11280050
112900                                                                  11290050
113000         PERFORM                                                  11300050
113100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11310050
113200                                                                  11320050
113300             PERFORM 4410-READ-TEMP-STORAGE                       11330050
113400                                                                  11340050
113500             PERFORM 2141-CLEAR-SELECTED-INDS                     11350050
113600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11360050
113700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11370050
113800                                                                  11380050
113900             PERFORM 5100-WRITE-TEMP-STORAGE                      11390050
114000                                                                  11400050
114100             ADD +1                TO PV-BLOCK-NUMBER             11410050
114200                                                                  11420050
114300         END-PERFORM                                              11430050
114400                                                                  11440050
114500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11450050
114600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11460050
114700                                                                  11470050
114800         PERFORM                                                  11480050
114900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11490050
115000                   ASC-HIGHEST-BLOCK-WRITTEN                      11500050
115100                                                                  11510050
115200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11520050
115300                                   TO PV-BLOCK-NUMBER             11530050
115400                                                                  11540050
115500             PERFORM 4410-READ-TEMP-STORAGE                       11550050
115600                                                                  11560050
115700             PERFORM 2141-CLEAR-SELECTED-INDS                     11570050
115800                 VARYING ASC-ITEM-SUB                             11580050
115900                 FROM 1 BY 1                                      11590050
116000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11600050
116100                                                                  11610050
116200             PERFORM 5100-WRITE-TEMP-STORAGE                      11620050
116300                                                                  11630050
116400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11640050
116500                                                                  11650050
116600         END-PERFORM                                              11660050
116700                                                                  11670050
116800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11680050
116900                                   TO PV-BLOCK-NUMBER             11690050
117000                                                                  11700050
117100         PERFORM 4410-READ-TEMP-STORAGE                           11710050
117200     END-IF.                                                      11720050
117300                                                                  11730050
117400                                                                  11740050
117500     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11750050
117600     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  11760050
117700     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    11770050
117800                                                                  11780050
117900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11790050
118000                                                                  11800050
118100*----------------------------------------------------------------*11810050
118200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11820050
118300*----------------------------------------------------------------*11830050
118400                                                                  11840050
118500 2141-CLEAR-SELECTED-INDS.                                        11850050
118600                                                                  11860050
118700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11870050
118800             NOT EQUAL ZERO                                       11880050
118900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11890050
119000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11900050
119100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11910050
119200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11920050
119300                                   TO TRUE                        11930050
119400         END-IF                                                   11940050
119500     END-IF.                                                      11950050
119600                                                                  11960050
119700*----------------------------------------------------------------*11970050
119800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11980050
119900*  FOR ALL ITEMS.                                                *11990050
120000*----------------------------------------------------------------*12000050
120100                                                                  12010050
120200 2150-SELECT-ALL-ITEMS.                                           12020050
120300                                                                  12030050
120400     MOVE +1                       TO ASC-BLK-SUB.                12040050
120500                                                                  12050050
120600     PERFORM 2151-SET-SELECTED-INDS                               12060050
120700         VARYING ASC-ITEM-SUB                                     12070050
120800         FROM 1 BY 1                                              12080050
120900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12090050
121000                                                                  12100050
121100     ADD +1                        TO ASC-BLK-SUB.                12110050
121200                                                                  12120050
121300     PERFORM 2151-SET-SELECTED-INDS                               12130050
121400         VARYING ASC-ITEM-SUB                                     12140050
121500         FROM 1 BY 1                                              12150050
121600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12160050
121700                                                                  12170050
121800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12180050
121900                                   TO PV-LIST-ITEM-NUMBER.        12190050
122000                                                                  12200050
122100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12210050
122200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12220050
122300                                                                  12230050
122400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12240050
122500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12250050
122600         MOVE +1                   TO ASC-BLK-SUB                 12260050
122700                                                                  12270050
122800         PERFORM 5100-WRITE-TEMP-STORAGE                          12280050
122900                                                                  12290050
123000         MOVE +1                   TO PV-BLOCK-NUMBER             12300050
123100                                                                  12310050
123200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12320050
123300             PV-FIRST-BLOCK-IN-ARRAY - 1                          12330050
123400                                                                  12340050
123500         PERFORM                                                  12350050
123600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12360050
123700                                                                  12370050
123800             PERFORM 4410-READ-TEMP-STORAGE                       12380050
123900                                                                  12390050
124000             PERFORM 2151-SET-SELECTED-INDS                       12400050
124100                 VARYING ASC-ITEM-SUB                             12410050
124200                 FROM 1 BY 1                                      12420050
124300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12430050
124400                                                                  12440050
124500             PERFORM 5100-WRITE-TEMP-STORAGE                      12450050
124600                                                                  12460050
124700             ADD +1                TO PV-BLOCK-NUMBER             12470050
124800                                                                  12480050
124900         END-PERFORM                                              12490050
125000                                                                  12500050
125100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12510050
125200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12520050
125300                                                                  12530050
125400         PERFORM                                                  12540050
125500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12550050
125600                   ASC-HIGHEST-BLOCK-WRITTEN                      12560050
125700                                                                  12570050
125800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12580050
125900                                   TO PV-BLOCK-NUMBER             12590050
126000                                                                  12600050
126100             PERFORM 4410-READ-TEMP-STORAGE                       12610050
126200                                                                  12620050
126300             PERFORM 2151-SET-SELECTED-INDS                       12630050
126400                 VARYING ASC-ITEM-SUB                             12640050
126500                 FROM 1 BY 1                                      12650050
126600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12660050
126700                                                                  12670050
126800             PERFORM 5100-WRITE-TEMP-STORAGE                      12680050
126900                                                                  12690050
127000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12700050
127100                                                                  12710050
127200         END-PERFORM                                              12720050
127300                                                                  12730050
127400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12740050
127500                                   TO PV-BLOCK-NUMBER             12750050
127600                                                                  12760050
127700         PERFORM 4410-READ-TEMP-STORAGE                           12770050
127800     END-IF.                                                      12780050
127900                                                                  12790050
128000                                                                  12800050
128100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12810050
128200                       ASC-NUMBER-OF-SELECTED-ITEMS.              12820050
128300                                                                  12830050
128400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12840050
128500                                                                  12850050
128600*----------------------------------------------------------------*12860050
128700*    MARK EACH ITEM AS BEING SELECTED.                           *12870050
128800*----------------------------------------------------------------*12880050
128900                                                                  12890050
129000 2151-SET-SELECTED-INDS.                                          12900050
129100                                                                  12910050
129200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12920050
129300             NOT EQUAL ZERO                                       12930050
129400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12940050
129500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12950050
129600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12960050
129700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12970050
129800                               TO  TRUE                           12980050
129900         END-IF                                                   12990050
130000     END-IF.                                                      13000050
130100******************************************************************13010050
130200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13020050
130300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13030050
130400******************************************************************13040050
130500 2200-MOVE-SCREEN-TO-COMMAREA.                                    13050050
130600                                                                  13060050
130700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13070050
130800     MOVE +1                       TO PV-SUB.                     13080050
130900*                                                                 13090050
131000     PERFORM 3100-SET-SUBSCRIPTS.                                 13100050
131100     IF  ASTRTITL > ZERO                                          13110050
131200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13120050
131300     ELSE                                                         13130050
131400         IF  ASTRTITF = DP015-ERASE-EOF                           13140050
131500             INITIALIZE ASC-START-ITEM-REQUEST                    13150050
131600         END-IF                                                   13160050
131700     END-IF.                                                      13170050
131800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13180050
131900         VARYING PV-SUB                                           13190050
132000         FROM 1 BY 1                                              13200050
132100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13210050
132200******************************************************************13220050
132300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**13230050
132400******************************************************************13240050
132500 2210-MOVE-LINES-TO-COMMAREA.                                     13250050
132600     IF  MR-SELECTL (PV-SUB) > ZERO                               13260050
132700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13270050
132800         MOVE MR-SELECTI (PV-SUB)                                 13280050
132900                                   TO ASC-TEMP-SELECTED-SW        13290050
133000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13300050
133100     ELSE                                                         13310050
133200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13320050
133300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13330050
133400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13340050
133500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13350050
133600         END-IF                                                   13360050
133700     END-IF.                                                      13370050
133800     ADD +1                        TO ASC-ITEM-SUB.               13380050
133900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13390050
134000         ADD +1                    TO ASC-BLK-SUB                 13400050
134100         MOVE +1                   TO ASC-ITEM-SUB                13410050
134200     END-IF.                                                      13420050
134300******************************************************************13430050
134400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13440050
134500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13450050
134600******************************************************************13460050
134700 3000-EDIT-DATA-IN-COMMAREA.                                      13470050
134800     SET PS-NO-ERROR               TO TRUE.                       13480050
134900     PERFORM 3200-RESET-ATTRIBUTES.                               13490050
135000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13500050
135100**                                                                13510050
135200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13520050
135300* EDITTING IS DONE FROM THE BOTTOM UP.                            13530050
135400**                                                                13540050
135500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13550050
135600         ASC-ITEMS-DISPLAYED - 1.                                 13560050
135700     PERFORM 3100-SET-SUBSCRIPTS.                                 13570050
135800     PERFORM 3300-EDIT-SELECTIONS                                 13580050
135900         VARYING PV-SUB                                           13590050
136000         FROM PV-SUB BY -1                                        13600050
136100         UNTIL PV-SUB < +1                                        13610050
136200*                                                                 13620050
136300     IF  PS-NO-ERROR                                              13630050
136400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13640050
136500     END-IF.                                                      13650050
136600*                                                                 13660050
136700     IF  ((PS-NO-ERROR)                                           13670050
136800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13680050
136900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13690050
137000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13700050
137100     END-IF.                                                      13710050
137200*----------------------------------------------------------------*13720050
137300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13730050
137400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13740050
137500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13750050
137600*                                                                *13760050
137700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13770050
137800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13780050
137900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13790050
138000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13800050
138100*----------------------------------------------------------------*13810050
138200                                                                  13820050
138300 3100-SET-SUBSCRIPTS.                                             13830050
138400                                                                  13840050
138500     COMPUTE ASC-ITEM-SUB =                                       13850050
138600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13860050
138700                                                                  13870050
138800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13880050
138900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13890050
139000                                                                  13900050
139100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13910050
139200     ELSE                                                         13920050
139300         MOVE +1                     TO ASC-BLK-SUB               13930050
139400     END-IF.                                                      13940050
139500******************************************************************13950050
139600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13960050
139700******************************************************************13970050
139800                                                                  13980050
139900 3200-RESET-ATTRIBUTES.                                           13990050
140000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14000050
140100     MOVE DP015-GREEN              TO ASTRTITC.                   14010050
140200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14020050
140300*                                                                 14030050
140400     PERFORM                                                      14040050
140500         VARYING PV-SUB                                           14050050
140600         FROM 1 BY 1                                              14060050
140700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14070050
140800         MOVE DP015-UNP-ALP-NOR-OFF                               14080050
140900                                   TO MR-SELECTA (PV-SUB)         14090050
141000         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         14100050
141100         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         14110050
141200     END-PERFORM.                                                 14120050
141300******************************************************************14130050
141400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14140050
141500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14150050
141600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14160050
141700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14170050
141800******************************************************************14180050
141900 3300-EDIT-SELECTIONS.                                            14190050
142000     EVALUATE TRUE                                                14200050
142100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14210050
142200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14220050
142300                 CONTINUE                                         14230050
142400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14240050
142500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14250050
142600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14260050
142700                 MOVE ASC-TEMP-SELECTED-SW                        14270050
142800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14280050
142900                                TO ASC-SELECTED-SW                14290050
143000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14300050
143100             END-IF                                               14310050
143200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14320050
143300                 = SPACE                                          14330050
143400             EVALUATE TRUE                                        14340050
143500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14350050
143600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14360050
143700                     MOVE SPACE TO ASC-SELECTED-SW                14370050
143800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14380050
143900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14390050
144000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14400050
144100                     MOVE SPACE TO ASC-SELECTED-SW                14410050
144200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14420050
144300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14430050
144400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14440050
144500                     MOVE SPACE TO ASC-SELECTED-SW                14450050
144600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14460050
144700             END-EVALUATE                                         14470050
144800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14480050
144900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14490050
145000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14500050
145100             END-IF                                               14510050
145200             PERFORM 3310-EDIT-RANGE                              14520050
145300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14530050
145400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14540050
145500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14550050
145600             END-IF                                               14560050
145700             PERFORM 3310-EDIT-RANGE                              14570050
145800         WHEN OTHER                                               14580050
145900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14590050
146000             SET DP020-MSG-FATAL    TO TRUE                       14600050
146100             MOVE -1                TO MR-SELECTL (PV-SUB)        14610050
146200             SET DP030-SET-CURSOR-APPL-1                          14620050
146300                                    TO TRUE                       14630050
146400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14640050
146500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14650050
146600             SET PS-ERROR TO TRUE                                 14660050
146700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14670050
146800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14680050
146900                 MOVE SPACE         TO ASC-SELECTED-SW            14690050
147000                                        (ASC-BLK-SUB ASC-ITEM-SUB)14700050
147100             END-IF                                               14710050
147200     END-EVALUATE.                                                14720050
147300                                                                  14730050
147400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14740050
147500     SUBTRACT +1             FROM ASC-ITEM-SUB.                   14750050
147600     IF  ASC-ITEM-SUB < 1                                         14760050
147700         SUBTRACT +1 FROM ASC-BLK-SUB                             14770050
147800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14780050
147900     END-IF.                                                      14790050
148000******************************************************************14800050
148100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14810050
148200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14820050
148300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14830050
148400** THE ENDING.                                                  **14840050
148500******************************************************************14850050
148600 3310-EDIT-RANGE.                                                 14860050
148700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14870050
148800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14880050
148900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14890050
149000                                   TO ASC-SELECTED-SW             14900050
149100                                        (ASC-BLK-SUB ASC-ITEM-SUB)14910050
149200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14920050
149300         ELSE                                                     14930050
149400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14940050
149500                 CONTINUE                                         14950050
149600             ELSE                                                 14960050
149700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14970050
149800                 MOVE PC-TSYMSG-00054                             14980050
149900                                   TO DP020-MSG-NUMBER            14990050
150000                 SET DP020-MSG-FATAL                              15000050
150100                                   TO TRUE                        15010050
150200                 MOVE -1           TO MR-SELECTL (PV-SUB)         15020050
150300                 SET DP030-SET-CURSOR-APPL-1                      15030050
150400                                   TO TRUE                        15040050
150500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15050050
150600                 MOVE DP015-UNDERLINE                             15060050
150700                                   TO MR-SELECTH (PV-SUB)         15070050
150800                 SET PS-ERROR      TO TRUE                        15080050
150900             END-IF                                               15090050
151000         END-IF                                                   15100050
151100     ELSE                                                         15110050
151200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15120050
151300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15130050
151400                                   TO ASC-SELECTED-SW             15140050
151500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15150050
151600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15160050
151700         ELSE                                                     15170050
151800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15180050
151900                 CONTINUE                                         15190050
152000             ELSE                                                 15200050
152100*                -- ONLY ONE END-OF-RANGE ALLOWED --              15210050
152200                 MOVE PC-TSYMSG-00055                             15220050
152300                                   TO DP020-MSG-NUMBER            15230050
152400                 SET DP020-MSG-FATAL                              15240050
152500                                   TO TRUE                        15250050
152600                 MOVE -1           TO MR-SELECTL (PV-SUB)         15260050
152700                 SET DP030-SET-CURSOR-APPL-1                      15270050
152800                                   TO TRUE                        15280050
152900                 SET PS-ERROR      TO TRUE                        15290050
153000             END-IF                                               15300050
153100         END-IF                                                   15310050
153200     END-IF.                                                      15320050
153300*                                                                 15330050
153400******************************************************************15340050
153500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15350050
153600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15360050
153700******************************************************************15370050
153800 3400-CHECK-RANGE-SEQUENCE.                                       15380050
153900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15390050
154000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15400050
154100       AND  ASC-START-OF-SELECTED-RANGE >                         15410050
154200                                         ASC-END-OF-SELECTED-RANGE15420050
154300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15430050
154400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15440050
154500         SET DP020-MSG-FATAL TO TRUE                              15450050
154600         SET PS-ERROR TO TRUE                                     15460050
154700         PERFORM 3410-POSITION-AT-ERROR                           15470050
154800     END-IF.                                                      15480050
154900******************************************************************15490050
155000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15500050
155100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15510050
155200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15520050
155300******************************************************************15530050
155400 3410-POSITION-AT-ERROR.                                          15540050
155500     SET DP030-SET-CURSOR-APPL-1                                  15550050
155600                                   TO TRUE.                       15560050
155700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15570050
155800                    - PV-TOP-ITEM + 1.                            15580050
155900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15590050
156000         CONTINUE                                                 15600050
156100     ELSE                                                         15610050
156200         MOVE -1                   TO MR-SELECTL (PV-SUB)         15620050
156300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15630050
156400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15640050
156500     END-IF.                                                      15650050
156600*                                                                 15660050
156700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15670050
156800                    - PV-TOP-ITEM + 1.                            15680050
156900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15690050
157000         CONTINUE                                                 15700050
157100     ELSE                                                         15710050
157200         MOVE -1                   TO MR-SELECTL (PV-SUB)         15720050
157300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15730050
157400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15740050
157500     END-IF.                                                      15750050
157600*----------------------------------------------------------------*15760050
157700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15770050
157800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15780050
157900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15790050
158000*----------------------------------------------------------------*15800050
158100                                                                  15810050
158200 3500-MARK-RANGE-AS-SELECTED.                                     15820050
158300     MOVE +1                       TO  ASC-BLK-SUB.               15830050
158400     PERFORM 3510-MARK-SELECTED-INDS                              15840050
158500         VARYING ASC-ITEM-SUB                                     15850050
158600         FROM 1 BY 1                                              15860050
158700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15870050
158800                                                                  15880050
158900     ADD +1                        TO ASC-BLK-SUB.                15890050
159000     PERFORM 3510-MARK-SELECTED-INDS                              15900050
159100         VARYING ASC-ITEM-SUB                                     15910050
159200         FROM 1 BY 1                                              15920050
159300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15930050
159400                                                                  15940050
159500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15950050
159600                                   TO  PV-LIST-ITEM-NUMBER.       15960050
159700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15970050
159800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15980050
159900               PC-ITEMS-PER-PANEL).                               15990050
160000                                                                  16000050
160100     MOVE ASC-START-OF-SELECTED-RANGE                             16010050
160200                                   TO PV-START-OF-SELECTED-RANGE. 16020050
160300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16030050
160400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16040050
160500               PC-ITEMS-PER-PANEL).                               16050050
160600                                                                  16060050
160700     MOVE ASC-END-OF-SELECTED-RANGE                               16070050
160800                                   TO  PV-END-OF-SELECTED-RANGE.  16080050
160900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16090050
161000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16100050
161100               PC-ITEMS-PER-PANEL).                               16110050
161200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16120050
161300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16130050
161400                                                                  16140050
161500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16150050
161600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16160050
161700         MOVE +1                   TO ASC-BLK-SUB                 16170050
161800         PERFORM 5100-WRITE-TEMP-STORAGE                          16180050
161900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16190050
162000             PV-FIRST-BLOCK-IN-ARRAY - 1                          16200050
162100                                                                  16210050
162200         PERFORM                                                  16220050
162300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16230050
162400                   PV-PREV-BLOCK-IN-ARRAY                         16240050
162500             MOVE PV-FIRST-BLOCK-IN-RANGE                         16250050
162600                                   TO PV-BLOCK-NUMBER             16260050
162700             PERFORM 4410-READ-TEMP-STORAGE                       16270050
162800             PERFORM 3510-MARK-SELECTED-INDS                      16280050
162900                 VARYING ASC-ITEM-SUB                             16290050
163000                 FROM 1 BY 1                                      16300050
163100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16310050
163200             PERFORM 5100-WRITE-TEMP-STORAGE                      16320050
163300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16330050
163400         END-PERFORM                                              16340050
163500                                                                  16350050
163600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16360050
163700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16370050
163800         PERFORM                                                  16380050
163900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16390050
164000                   PV-LAST-BLOCK-IN-RANGE                         16400050
164100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16410050
164200                                   TO PV-BLOCK-NUMBER             16420050
164300             PERFORM 4410-READ-TEMP-STORAGE                       16430050
164400             PERFORM 3510-MARK-SELECTED-INDS                      16440050
164500                 VARYING ASC-ITEM-SUB                             16450050
164600                 FROM 1 BY 1                                      16460050
164700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16470050
164800             PERFORM 5100-WRITE-TEMP-STORAGE                      16480050
164900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16490050
165000         END-PERFORM                                              16500050
165100                                                                  16510050
165200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16520050
165300                                   TO PV-BLOCK-NUMBER             16530050
165400         PERFORM 4410-READ-TEMP-STORAGE                           16540050
165500     END-IF.                                                      16550050
165600                                                                  16560050
165700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16570050
165800                                      ASC-END-OF-SELECTED-RANGE.  16580050
165900                                                                  16590050
166000*----------------------------------------------------------------*16600050
166100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16610050
166200*----------------------------------------------------------------*16620050
166300                                                                  16630050
166400 3510-MARK-SELECTED-INDS.                                         16640050
166500                                                                  16650050
166600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16660050
166700                                ASC-ITEM-SUB) >                   16670050
166800         ASC-START-OF-SELECTED-RANGE)                             16680050
166900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16690050
167000                                ASC-ITEM-SUB) =                   16700050
167100         ASC-START-OF-SELECTED-RANGE)                             16710050
167200                                                                  16720050
167300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16730050
167400                                    ASC-ITEM-SUB) <               16740050
167500             ASC-END-OF-SELECTED-RANGE)                           16750050
167600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16760050
167700                                    ASC-ITEM-SUB) =               16770050
167800             ASC-END-OF-SELECTED-RANGE)                           16780050
167900                                                                  16790050
168000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16800050
168100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16810050
168200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16820050
168300                               TO TRUE                            16830050
168400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16840050
168500                               TO TRUE                            16850050
168600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16860050
168700             END-IF                                               16870050
168800         END-IF                                                   16880050
168900     END-IF.                                                      16890050
169000                                                                  16900050
169100*----------------------------------------------------------------*16910050
169200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16920050
169300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16930050
169400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16940050
169500*    DISPLAY THE PANEL TO USER.                                  *16950050
169600*----------------------------------------------------------------*16960050
169700                                                                  16970050
169800 4000-BUILD-INITIAL-PANEL.                                        16980050
169900                                                                  16990050
170000     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             17000050
170100                                ASC-BLOCK-ENTRIES (2).            17010050
170200     MOVE +1                 TO ASC-BLK-SUB.                      17020050
170300     SET ASC-ITEMS-LEFT-ON-DB                                     17030050
170400                             TO TRUE.                             17040050
170500                                                                  17050050
170600     MOVE +1                 TO ITEM-COUNTER.                     17060099
170700     MOVE +0                 TO ASC-ITEM-SUB                      17070099
170800                                ASC-NUMBER-OF-ITEMS-READ          17080050
170900                                ASC-NUMBER-OF-SELECTED-ITEMS      17090050
171000                                ASC-HIGHEST-BLOCK-WRITTEN         17100050
171100                                ASC-START-OF-SELECTED-RANGE       17110050
171200                                ASC-END-OF-SELECTED-RANGE         17120050
171300                                ASC-ITEM-AT-TOP-OF-PANEL.         17130050
171400                                                                  17140050
171500**   PERFORM 4100-PREPARE-CURSOR.                                 17150099
171600     SET PS-EQUAL TO TRUE.                                        17160099
171700                                                                  17170099
171800     IF PS-EQUAL                                                  17180099
171900         PERFORM 4030-OPEN-EQUAL-CURSOR                           17190099
172000                                                                  17200099
172100         SET PS-ITEMS-FOUND TO TRUE                               17210099
172200         PERFORM 4300-READ-ITEMS-FROM-DB                          17220099
172300                                                                  17230099
172400         PERFORM 4035-CLOSE-EQUAL-CURSOR                          17240099
172500                                                                  17250099
172600         IF ITEM-COUNTER > PC-MAX-ITEMS                           17260099
172700             CONTINUE                                             17270099
172800         ELSE                                                     17280099
172900             PERFORM 4040-OPEN-EQUAL-HIST                         17290099
173000             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     17300099
173100             PERFORM 4305-READ-ITEMS-FROM-DB-HIST                 17310099
173200             PERFORM 4045-CLOSE-EQUAL-HIST                        17320099
173300         END-IF                                                   17330099
173400     ELSE                                                         17340099
173500         PERFORM 4010-OPEN-CURSOR                                 17350099
173600                                                                  17360099
173700         SET PS-ITEMS-FOUND TO TRUE                               17370099
173800         PERFORM 4300-READ-ITEMS-FROM-DB                          17380099
173900                                                                  17390099
174000         PERFORM 4020-CLOSE-CURSOR                                17400099
174100                                                                  17410099
174200         IF ITEM-COUNTER > PC-MAX-ITEMS                           17420099
174300             CONTINUE                                             17430099
174400         ELSE                                                     17440099
174500             PERFORM 4015-OPEN-CURSOR-HIST                        17450099
174600             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     17460099
174700             PERFORM 4305-READ-ITEMS-FROM-DB-HIST                 17470099
174800             PERFORM 4025-CLOSE-CURSOR-HIST                       17480099
174900         END-IF                                                   17490099
175000     END-IF.                                                      17500099
175100                                                                  17510099
175200     MOVE +1                   TO  PV-TOP-ITEM.                   17520050
175300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17530050
175400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17540050
175500         SET DP020-MSG-FATAL   TO  TRUE                           17550050
175600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17560050
175700     ELSE                                                         17570050
175800         MOVE -1               TO MR-SELECTL (1)                  17580050
175900         SET DP030-SET-CURSOR-APPL-1                              17590050
176000                               TO TRUE                            17600050
176100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17610050
176200     END-IF.                                                      17620050
176300*----------------------------------------------------------------*17630050
176400* OPEN THE SVT_KOHLS_CRD_TXN CURSOR.                             *17640077
176500*----------------------------------------------------------------*17650050
176600                                                                  17660050
176700 4010-OPEN-CURSOR.                                                17670050
176800                                                                  17680050
176900      EXEC SQL                                                    17690050
177000          OPEN DRV-LIC-NBR-CSR                                    17700050
177100      END-EXEC                                                    17710050
177200                                                                  17720050
177300      EVALUATE TRUE                                               17730050
177400             WHEN SQLCODE = ZERO                                  17740050
177500             WHEN SQLCODE = -904                                  17750050
177600             WHEN SQLCODE = -913                                  17760050
177700                 CONTINUE                                         17770050
177800             WHEN SQLWARN0 NOT = SPACES                           17780050
177900             WHEN SQLCODE < ZERO                                  17790050
178000             WHEN SQLCODE > ZERO                                  17800050
178100                 MOVE 'PAR 4010-OPEN-CURSOR'                      17810050
178200                                   TO DP013-PARAGRAPH             17820050
178300                 MOVE 'OPEN DRV-LIC-NBR-CSR CURSOR - '            17830050
178400                                   TO DP013-MESSAGE-TEXT (1)      17840050
178500                 MOVE SQLCA        TO DP013-SQLCA                 17850050
178600                 MOVE 'SVT_KOHLS_CRD_TXN'                         17860083
178700                                   TO DP013-DB2-TABLE-NAME (1)    17870083
178800                 SET DP013-DB2-ABEND                              17880050
178900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17890050
179000                 PERFORM DP013-0000-PROCESS-ABEND                 17900050
179100     END-EVALUATE.                                                17910050
179200*                                                                 17920050
179300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17930050
179400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17940050
179500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17950050
179600                                   TO DP013-MESSAGE-TEXT (1)      17960050
179700         MOVE SQLCA                TO DP013-SQLCA                 17970050
179800         MOVE 'SVT_KOHLS_CRD_TXN'  TO DP013-DB2-TABLE-NAME (1)    17980083
179900         SET DP013-DB2-ABEND                                      17990050
180000             DP013-XCTL-DISPLAY-RESTART                           18000050
180100                                   TO TRUE                        18010050
180200         PERFORM DP013-0000-PROCESS-ABEND                         18020050
180300     END-IF.                                                      18030050
180400                                                                  18040050
180500*----------------------------------------------------------------*18050057
180600* OPEN THE SVT_CRD_TXN_HIST CURSOR.                              *18060077
180700*----------------------------------------------------------------*18070057
180800 4015-OPEN-CURSOR-HIST.                                           18080057
180900                                                                  18090057
181000      EXEC SQL                                                    18100057
181100          OPEN DLNBR-CSR-HIST                                     18110058
181200      END-EXEC                                                    18120057
181300                                                                  18130057
181400      EVALUATE TRUE                                               18140057
181500             WHEN SQLCODE = ZERO                                  18150057
181600             WHEN SQLCODE = -904                                  18160057
181700             WHEN SQLCODE = -913                                  18170057
181800                 CONTINUE                                         18180057
181900             WHEN SQLWARN0 NOT = SPACES                           18190057
182000             WHEN SQLCODE < ZERO                                  18200057
182100             WHEN SQLCODE > ZERO                                  18210057
182200                 MOVE 'PAR 4015-OPEN-CURSOR-HIST'                 18220057
182300                                   TO DP013-PARAGRAPH             18230057
182400                 MOVE 'OPEN DRV-LIC-NBR-CSR HIST CURSOR - '       18240057
182500                                   TO DP013-MESSAGE-TEXT (1)      18250057
182600                 MOVE SQLCA        TO DP013-SQLCA                 18260057
182700                 MOVE 'SVT_CRD_TXN_HIST '                         18270083
182800                                   TO DP013-DB2-TABLE-NAME (1)    18280083
182900                 SET DP013-DB2-ABEND                              18290057
183000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18300057
183100                 PERFORM DP013-0000-PROCESS-ABEND                 18310057
183200     END-EVALUATE.                                                18320057
183300*                                                                 18330057
183400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18340057
183500         MOVE '4015-OPEN-CURSOR-HIST'   TO DP013-PARAGRAPH        18350057
183600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18360057
183700                                   TO DP013-MESSAGE-TEXT (1)      18370057
183800         MOVE SQLCA                TO DP013-SQLCA                 18380057
183900         MOVE 'SVT_CRD_TXN_HIST'   TO DP013-DB2-TABLE-NAME (1)    18390083
184000         SET DP013-DB2-ABEND                                      18400057
184100             DP013-XCTL-DISPLAY-RESTART                           18410057
184200                                   TO TRUE                        18420057
184300         PERFORM DP013-0000-PROCESS-ABEND                         18430057
184400     END-IF.                                                      18440057
184500                                                                  18450057
184600*----------------------------------------------------------------*18460050
184700* CLOSE THE DRV-LIC-NBR-CSR CURSOR                               *18470050
184800*----------------------------------------------------------------*18480050
184900                                                                  18490050
185000 4020-CLOSE-CURSOR.                                               18500050
185100                                                                  18510050
185200      EXEC SQL                                                    18520050
185300          CLOSE DRV-LIC-NBR-CSR                                   18530050
185400      END-EXEC                                                    18540050
185500*                                                                 18550050
185600     EVALUATE TRUE                                                18560050
185700         WHEN SQLCODE = ZERO                                      18570050
185800             CONTINUE                                             18580050
185900         WHEN SQLWARN0 NOT = SPACES                               18590050
186000         WHEN SQLCODE < ZERO                                      18600050
186100         WHEN SQLCODE > ZERO                                      18610050
186200             MOVE '4020-CLOSE-CURSOR'                             18620050
186300                               TO DP013-PARAGRAPH                 18630050
186400             MOVE 'CLOSE DRV-LIC-NBR-CSR CURSOR '                 18640050
186500                               TO DP013-MESSAGE-TEXT (1)          18650050
186600             MOVE SQLCA        TO DP013-SQLCA                     18660050
186700             MOVE 'TKCACT  '   TO DP013-DB2-TABLE-NAME (1)        18670050
186800             SET DP013-DB2-ABEND                                  18680050
186900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18690050
187000             PERFORM DP013-0000-PROCESS-ABEND                     18700050
187100     END-EVALUATE.                                                18710050
187200                                                                  18720050
187300*----------------------------------------------------------------*18730057
187400* CLOSE THE DLNBR-CSR-HIST CURSOR                                *18740058
187500*----------------------------------------------------------------*18750057
187600 4025-CLOSE-CURSOR-HIST.                                          18760057
187700                                                                  18770057
187800      EXEC SQL                                                    18780057
187900          CLOSE DLNBR-CSR-HIST                                    18790058
188000      END-EXEC                                                    18800057
188100*                                                                 18810057
188200     EVALUATE TRUE                                                18820057
188300         WHEN SQLCODE = ZERO                                      18830057
188400             CONTINUE                                             18840057
188500         WHEN SQLWARN0 NOT = SPACES                               18850057
188600         WHEN SQLCODE < ZERO                                      18860057
188700         WHEN SQLCODE > ZERO                                      18870057
188800             MOVE '4025-CLOSE-CURSOR-HIST'                        18880057
188900                               TO DP013-PARAGRAPH                 18890057
189000             MOVE 'CLOSE DLNBR-CSR-HIST CURSOR '                  18900058
189100                               TO DP013-MESSAGE-TEXT (1)          18910057
189200             MOVE SQLCA        TO DP013-SQLCA                     18920057
189300             MOVE 'TKCHAC  '   TO DP013-DB2-TABLE-NAME (1)        18930057
189400             SET DP013-DB2-ABEND                                  18940057
189500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18950057
189600             PERFORM DP013-0000-PROCESS-ABEND                     18960057
189700     END-EVALUATE.                                                18970057
189800                                                                  18980057
189900*----------------------------------------------------------------*18990099
190000* OPEN THE SVT_KOHLS_CRD_TXN CURSOR FOR EQUAL CONDITION          *19000099
190100*----------------------------------------------------------------*19010099
190200                                                                  19020099
190300 4030-OPEN-EQUAL-CURSOR.                                          19030099
190400                                                                  19040099
190500      EXEC SQL                                                    19050099
190600          OPEN EQUAL-CSR                                          19060099
190700      END-EXEC                                                    19070099
190800                                                                  19080099
190900      EVALUATE TRUE                                               19090099
191000             WHEN SQLCODE = ZERO                                  19100099
191100             WHEN SQLCODE = -904                                  19110099
191200             WHEN SQLCODE = -913                                  19120099
191300                 CONTINUE                                         19130099
191400             WHEN SQLWARN0 NOT = SPACES                           19140099
191500             WHEN SQLCODE < ZERO                                  19150099
191600             WHEN SQLCODE > ZERO                                  19160099
191700                 MOVE 'PAR 4030-OPEN-EQUAL-CURSOR'                19170099
191800                                   TO DP013-PARAGRAPH             19180099
191900                 MOVE 'OPEN EQUAL-CSR CURSOR - '                  19190099
192000                                   TO DP013-MESSAGE-TEXT (1)      19200099
192100                 MOVE SQLCA        TO DP013-SQLCA                 19210099
192200                 MOVE 'SVT_KOHLS_CRD_TXN'                         19220099
192300                                   TO DP013-DB2-TABLE-NAME (1)    19230099
192400                 SET DP013-DB2-ABEND                              19240099
192500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19250099
192600                 PERFORM DP013-0000-PROCESS-ABEND                 19260099
192700     END-EVALUATE.                                                19270099
192800*                                                                 19280099
192900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19290099
193000         MOVE '4030-OPEN-EQUAL-CURSOR'   TO DP013-PARAGRAPH       19300099
193100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19310099
193200                                   TO DP013-MESSAGE-TEXT (1)      19320099
193300         MOVE SQLCA                TO DP013-SQLCA                 19330099
193400         MOVE 'SVT_KOHLS_CRD_TXN'  TO DP013-DB2-TABLE-NAME (1)    19340099
193500         SET DP013-DB2-ABEND                                      19350099
193600             DP013-XCTL-DISPLAY-RESTART                           19360099
193700                                   TO TRUE                        19370099
193800         PERFORM DP013-0000-PROCESS-ABEND                         19380099
193900     END-IF.                                                      19390099
194000                                                                  19400099
194100*----------------------------------------------------------------*19410099
194200* CLOSE THE EQUAL-CSR FOR EQUAL CONDITION                        *19420099
194300*----------------------------------------------------------------*19430099
194400                                                                  19440099
194500 4035-CLOSE-EQUAL-CURSOR.                                         19450099
194600                                                                  19460099
194700      EXEC SQL                                                    19470099
194800          CLOSE EQUAL-CSR                                         19480099
194900      END-EXEC                                                    19490099
195000*                                                                 19500099
195100     EVALUATE TRUE                                                19510099
195200         WHEN SQLCODE = ZERO                                      19520099
195300             CONTINUE                                             19530099
195400         WHEN SQLWARN0 NOT = SPACES                               19540099
195500         WHEN SQLCODE < ZERO                                      19550099
195600         WHEN SQLCODE > ZERO                                      19560099
195700             MOVE '4035-CLOSE-EQUAL-CURSOR'                       19570099
195800                               TO DP013-PARAGRAPH                 19580099
195900             MOVE 'CLOSE EQUAL-CSR CURSOR '                       19590099
196000                               TO DP013-MESSAGE-TEXT (1)          19600099
196100             MOVE SQLCA        TO DP013-SQLCA                     19610099
196200             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)19620099
196300             SET DP013-DB2-ABEND                                  19630099
196400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19640099
196500             PERFORM DP013-0000-PROCESS-ABEND                     19650099
196600     END-EVALUATE.                                                19660099
196700                                                                  19670099
196800*----------------------------------------------------------------*19680099
196900* OPEN THE SVT_CRD_TXN_HIST CURSOR FOR EQUAL CONDITION           *19690099
197000*----------------------------------------------------------------*19700099
197100 4040-OPEN-EQUAL-HIST.                                            19710099
197200                                                                  19720099
197300      EXEC SQL                                                    19730099
197400          OPEN EQUAL-CSR-HIST                                     19740099
197500      END-EXEC                                                    19750099
197600                                                                  19760099
197700      EVALUATE TRUE                                               19770099
197800             WHEN SQLCODE = ZERO                                  19780099
197900             WHEN SQLCODE = -904                                  19790099
198000             WHEN SQLCODE = -913                                  19800099
198100                 CONTINUE                                         19810099
198200             WHEN SQLWARN0 NOT = SPACES                           19820099
198300             WHEN SQLCODE < ZERO                                  19830099
198400             WHEN SQLCODE > ZERO                                  19840099
198500                 MOVE 'PAR 4040-OPEN-EQUAL-HIST'                  19850099
198600                                   TO DP013-PARAGRAPH             19860099
198700                 MOVE 'OPEN EQUAL-CSR-HIST CURSOR - '             19870099
198800                                   TO DP013-MESSAGE-TEXT (1)      19880099
198900                 MOVE SQLCA        TO DP013-SQLCA                 19890099
199000                 MOVE 'SVT_CRD_TXN_HIST '                         19900099
199100                                   TO DP013-DB2-TABLE-NAME (1)    19910099
199200                 SET DP013-DB2-ABEND                              19920099
199300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19930099
199400                 PERFORM DP013-0000-PROCESS-ABEND                 19940099
199500     END-EVALUATE.                                                19950099
199600*                                                                 19960099
199700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19970099
199800         MOVE '4040-OPEN-EQUAL-HIST'   TO DP013-PARAGRAPH         19980099
199900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19990099
200000                                   TO DP013-MESSAGE-TEXT (1)      20000099
200100         MOVE SQLCA                TO DP013-SQLCA                 20010099
200200         MOVE 'SVT_CRD_TXN_HIST'   TO DP013-DB2-TABLE-NAME (1)    20020099
200300         SET DP013-DB2-ABEND                                      20030099
200400             DP013-XCTL-DISPLAY-RESTART                           20040099
200500                                   TO TRUE                        20050099
200600         PERFORM DP013-0000-PROCESS-ABEND                         20060099
200700     END-IF.                                                      20070099
200800                                                                  20080099
200900*----------------------------------------------------------------*20090099
201000* CLOSE THE EQUAL-CSR-HIST CURSOR                                *20100099
201100*----------------------------------------------------------------*20110099
201200 4045-CLOSE-EQUAL-HIST.                                           20120099
201300                                                                  20130099
201400      EXEC SQL                                                    20140099
201500          CLOSE EQUAL-CSR-HIST                                    20150099
201600      END-EXEC                                                    20160099
201700*                                                                 20170099
201800     EVALUATE TRUE                                                20180099
201900         WHEN SQLCODE = ZERO                                      20190099
202000             CONTINUE                                             20200099
202100         WHEN SQLWARN0 NOT = SPACES                               20210099
202200         WHEN SQLCODE < ZERO                                      20220099
202300         WHEN SQLCODE > ZERO                                      20230099
202400             MOVE '4045-CLOSE-EQUAL-HIST'                         20240099
202500                               TO DP013-PARAGRAPH                 20250099
202600             MOVE 'CLOSE EQUAL-CSR-HIST CURSOR '                  20260099
202700                               TO DP013-MESSAGE-TEXT (1)          20270099
202800             MOVE SQLCA        TO DP013-SQLCA                     20280099
202900             MOVE 'TKCHAC  '   TO DP013-DB2-TABLE-NAME (1)        20290099
203000             SET DP013-DB2-ABEND                                  20300099
203100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20310099
203200             PERFORM DP013-0000-PROCESS-ABEND                     20320099
203300     END-EVALUATE.                                                20330099
203400                                                                  20340099
203500*----------------------------------------------------------------*20350099
203600*    SET UP THE HOST VARIABLES.                                  *20360099
203700*    FILL ALL '*' WITH A PERCENT SIGN FOR THE ENTERED DRIVERS    *20370050
203800*    LICENSE NUMBER.  IF THE LAST DIGITS ARE SPACES, CHANGE      *20380050
203900*    THOSE TO PERCENT SIGNS ALSO.  THIS ALLOWS THE FETCH TO FIND *20390050
204000*    A DRIVERS LICENSE WHICH CONTAINS THE DIGITS BETWEEN THE     *20400050
204100*    PERCENT SIGNS.                                              *20410050
204200*    EX:  USER ENTERS   *1234532                                 *20420050
204300*         TRANSLATED TO %1234532%%%%%%%%%%%%%                    *20430050
204400***  CHANGED 1/9/08.  ANY DIGITS THAT ARE NOT * WILL REMAIN AS   *20440099
204500*    THEY ARE.  IF THE USER WANTS TO USE A WILD CARD, THEY WILL  *20450099
204600*    NEED TO ENTER IT.                                           *20460099
204700*    EX:  USER ENTERS   *1234532                                 *20470099
204800*         TRANSLATED TO %1234532                                 *20480099
204900*----------------------------------------------------------------*20490050
205000                                                                  20500050
205100*4100-PREPARE-CURSOR.                                             20510099
205200*                                                                 20520099
205300*    SET PS-EQUAL TO TRUE.                                        20530099
205400*                                                                 20540099
205500*    IF  DK-DRV-LIC-NBR GREATER THAN SPACES                       20550099
205600*        IF  DK-DRV-LIC-NBR-BYTE (1) EQUAL '*'                    20560099
205700*            SET PS-NOT-EQUAL TO TRUE                             20570099
205800*            MOVE PC-PERCENT  TO DK-DRV-LIC-NBR-BYTE (1)          20580099
205900*            INSPECT DK-DRV-LIC-NBR                               20590099
206000*                    REPLACING FIRST '*' BY PC-PERCENT            20600099
206100*        END-IF                                                   20610099
206200*                                                                 20620099
206300*        SET PS-NOT-DONE   TO TRUE                                20630099
206400*                                                                 20640099
206500*        PERFORM VARYING PV-SUB                                   20650099
206600*            FROM LENGTH OF DK-DRV-LIC-NBR BY -1                  20660099
206700*            UNTIL PV-SUB EQUAL 1                                 20670099
206800*              OR  PS-DONE                                        20680099
206900*                                                                 20690099
207000*                IF  DK-DRV-LIC-NBR-BYTE (PV-SUB) = '*'           20700099
207100*                    MOVE PC-PERCENT                              20710099
207200*                              TO DK-DRV-LIC-NBR-BYTE (PV-SUB)    20720099
207300*                    INSPECT DK-DRV-LIC-NBR                       20730099
207400*                         REPLACING ALL ' ' BY PC-PERCENT         20740099
207500*                    SET PS-DONE                                  20750099
207600*                        PS-NOT-EQUAL TO TRUE                     20760099
207700*                END-IF                                           20770099
207800*                                                                 20780099
207900*                IF  DK-DRV-LIC-NBR-BYTE (PV-SUB) > SPACES        20790099
208000*                    SET PS-DONE TO TRUE                          20800099
208100*                ELSE                                             20810099
208200*                    MOVE SPACE TO DK-DRV-LIC-NBR-BYTE (PV-SUB)   20820099
208300*                END-IF                                           20830099
208400*                                                                 20840099
208500*        END-PERFORM                                              20850099
208600*                                                                 20860099
208700*    END-IF.                                                      20870099
208800*                                                                 20880099
208900*----------------------------------------------------------------*20890050
209000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20900050
209100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20910050
209200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20920050
209300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20930050
209400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20940050
209500*                                                                *20950050
209600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20960050
209700*    ROWS ARE SORTED, ONLY 10 PAGES OF DATA IS READ INTO THE     *20970099
209800*    PROGRAM.                                                    *20980099
209900*----------------------------------------------------------------*20990050
210000                                                                  21000050
210100 4300-READ-ITEMS-FROM-DB.                                         21010050
210200                                                                  21020050
210300     PERFORM                                                      21030098
210400         UNTIL ((ITEM-COUNTER > PC-MAX-ITEMS)                     21040099
210500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21050098
210600                                                                  21060050
210700         IF PS-EQUAL                                              21070099
210800             PERFORM 4320-FETCH-EQUAL                             21080099
210900         ELSE                                                     21090099
211000             PERFORM 4310-FETCH                                   21100099
211100         END-IF                                                   21110099
211200                                                                  21120050
211300         IF ASC-ITEMS-LEFT-ON-DB                                  21130050
211400             PERFORM 4330-PROCESS-CARD                            21140099
211500             PERFORM 4340-SUM-CARD-TRANS                          21150099
211600         END-IF                                                   21160050
211700                                                                  21170050
211800         IF PS-ITEMS-FOUND AND ASC-ITEMS-LEFT-ON-DB               21180050
211900            PERFORM 4350-WRITE-CARD                               21190050
212000            INITIALIZE PV-HOLD-FIELDS                             21200069
212100         END-IF                                                   21210050
212200                                                                  21220050
212300     END-PERFORM.                                                 21230050
212400                                                                  21240050
212500     IF ITEM-COUNTER > PC-MAX-ITEMS                               21250099
212600         IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                      21260099
212700             MOVE +1               TO ASC-BLK-SUB                 21270099
212800             PERFORM 5100-WRITE-TEMP-STORAGE                      21280099
212900             ADD +1                TO ASC-BLK-SUB                 21290099
213000             PERFORM 5100-WRITE-TEMP-STORAGE                      21300099
213100                                                                  21310099
213200             MOVE 1                TO ASC-BLK-SUB                 21320099
213300                                      PV-BLOCK-NUMBER             21330099
213400             PERFORM 4410-READ-TEMP-STORAGE                       21340099
213500             IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1         21350099
213600                 MOVE 2            TO ASC-BLK-SUB                 21360099
213700                                  PV-BLOCK-NUMBER                 21370099
213800                 PERFORM 4410-READ-TEMP-STORAGE                   21380099
213900             END-IF                                               21390099
214000         END-IF                                                   21400099
214100     END-IF.                                                      21410099
214200*----------------------------------------------------------------*21420057
214300 4305-READ-ITEMS-FROM-DB-HIST.                                    21430057
214400                                                                  21440057
214500     PERFORM                                                      21450098
214600         UNTIL ((ITEM-COUNTER > PC-MAX-ITEMS)                     21460098
214700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21470098
214800                                                                  21480057
214900         IF PS-EQUAL                                              21490099
215000             PERFORM 4325-FETCH-HIST-EQUAL                        21500099
215100         ELSE                                                     21510099
215200             PERFORM 4315-FETCH-HIST                              21520099
215300         END-IF                                                   21530099
215400                                                                  21540057
215500         IF ASC-ITEMS-LEFT-ON-DB                                  21550057
215600             PERFORM 4335-PROCESS-CARD-HIST                       21560099
215700             PERFORM 4345-SUM-CARD-TRANS-HIST                     21570099
215800         END-IF                                                   21580057
215900                                                                  21590057
216000         IF PS-ITEMS-FOUND AND ASC-ITEMS-LEFT-ON-DB               21600057
216100            PERFORM 4350-WRITE-CARD                               21610057
216200            INITIALIZE PV-HOLD-FIELDS                             21620057
216300         END-IF                                                   21630057
216400                                                                  21640057
216500     END-PERFORM.                                                 21650057
216600                                                                  21660057
216700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21670057
216800         MOVE +1               TO ASC-BLK-SUB                     21680057
216900         PERFORM 5100-WRITE-TEMP-STORAGE                          21690057
217000         ADD +1                TO ASC-BLK-SUB                     21700057
217100         PERFORM 5100-WRITE-TEMP-STORAGE                          21710057
217200                                                                  21720057
217300         MOVE 1                TO ASC-BLK-SUB                     21730057
217400                                  PV-BLOCK-NUMBER                 21740057
217500         PERFORM 4410-READ-TEMP-STORAGE                           21750057
217600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21760057
217700             MOVE 2            TO ASC-BLK-SUB                     21770057
217800                                  PV-BLOCK-NUMBER                 21780057
217900             PERFORM 4410-READ-TEMP-STORAGE                       21790057
218000         END-IF                                                   21800057
218100     END-IF.                                                      21810057
218200                                                                  21820057
218300*----------------------------------------------------------------*21830050
218400*    FETCH THE DRIVERS LICENSE CURSOR IN ORDER TO RETRIEVE       *21840099
218500*    A CARD WITH A DRIVERS LICENSE LIKE THE INPUT DRIVERS        *21850099
218600*    LICENSE.                                                    *21860050
218700*----------------------------------------------------------------*21870050
218800                                                                  21880050
218900 4310-FETCH.                                                      21890050
219000                                                                  21900050
219100       EXEC SQL                                                   21910050
219200            FETCH DRV-LIC-NBR-CSR                                 21920050
219300            INTO  :SVT00002-CRD-NBR                               21930077
219400                , :SVT00002-DRV-LIC-NBR                           21940077
219500                , :SVT00002-TRN-VOID-IND                          21950077
219600                , :SVT00002-ACTVY-TYP-CDE                         21960077
219700                , :SVT00002-POS-DTE                               21970077
219800                , :SVT00002-STR-NBR                               21980077
219900                , :SVT00002-APP-AUTH-AMT                          21990077
220000                , :SVT00002-ACTVY-STAT-CDE                        22000077
220100                , :PV-HOLD-CARD-STAT                              22010050
220200       END-EXEC                                                   22020050
220300                                                                  22030050
220400     EVALUATE TRUE                                                22040050
220500         WHEN SQLCODE = ZERO                                      22050050
220600              SET PS-ITEMS-FOUND TO TRUE                          22060050
220700              ADD +1 TO ITEM-COUNTER                              22070099
220800         WHEN SQLCODE = +100                                      22080050
220900              IF ITEM-COUNTER = 1                                 22090099
221000                  SET PS-ITEMS-NOT-FOUND TO TRUE                  22100099
221100              END-IF                                              22110099
221200              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 22120099
221300         WHEN SQLWARN0 NOT = SPACE                                22130050
221400         WHEN SQLCODE NOT = ZERO                                  22140050
221500              MOVE '4310-FETCH-CURSOR'                            22150050
221600                               TO DP013-PARAGRAPH                 22160050
221700              MOVE 'FETCH DRV-LIC CURSOR'                         22170050
221800                               TO DP013-MESSAGE-TEXT (1)          22180050
221900              MOVE SQLCA       TO DP013-SQLCA                     22190050
222000              SET DP013-DB2-ABEND                                 22200050
222100                               TO TRUE                            22210050
222200              PERFORM DP013-0000-PROCESS-ABEND                    22220050
222300     END-EVALUATE.                                                22230050
222400                                                                  22240050
222500*----------------------------------------------------------------*22250099
222600*    FETCH THE HISTORY DL CURSOR IN ORDER TO RETRIEVE            *22260099
222700*    A CARD WITH A DRIVERS LICENSE LIKE THE INPUT DRIVERS        *22270099
222800*    LICENSE.                                                    *22280099
222900*----------------------------------------------------------------*22290099
223000 4315-FETCH-HIST.                                                 22300057
223100                                                                  22310057
223200       EXEC SQL                                                   22320057
223300            FETCH DLNBR-CSR-HIST                                  22330062
223400            INTO  :SVT00006-CRD-NBR                               22340077
223500                , :SVT00006-DRV-LIC-NBR                           22350077
223600                , :SVT00006-TRN-VOID-IND                          22360077
223700                , :SVT00006-ACTVY-TYP-CDE                         22370077
223800                , :SVT00006-POS-DTE                               22380077
223900                , :SVT00006-STR-NBR                               22390077
224000                , :SVT00006-APP-AUTH-AMT                          22400077
224100                , :SVT00006-ACTVY-STAT-CDE                        22410077
224200                , :PV-HOLD-CARD-STAT                              22420057
224300       END-EXEC                                                   22430057
224400                                                                  22440057
224500     EVALUATE TRUE                                                22450057
224600         WHEN SQLCODE = ZERO                                      22460057
224700              SET PS-ITEMS-FOUND TO TRUE                          22470057
224800              ADD +1 TO ITEM-COUNTER                              22480099
224900         WHEN SQLCODE = +100                                      22490057
225000              IF ITEM-COUNTER = 1                                 22500099
225100                  SET PS-ITEMS-NOT-FOUND TO TRUE                  22510099
225200              END-IF                                              22520099
225300              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 22530099
225400         WHEN SQLWARN0 NOT = SPACE                                22540057
225500         WHEN SQLCODE NOT = ZERO                                  22550057
225600              MOVE '4315-FETCH-CURSOR-HIST'                       22560057
225700                               TO DP013-PARAGRAPH                 22570057
225800              MOVE 'FETCH DRV-LIC HIST CURSOR'                    22580057
225900                               TO DP013-MESSAGE-TEXT (1)          22590057
226000              MOVE SQLCA       TO DP013-SQLCA                     22600057
226100              SET DP013-DB2-ABEND                                 22610057
226200                               TO TRUE                            22620057
226300              PERFORM DP013-0000-PROCESS-ABEND                    22630057
226400     END-EVALUATE.                                                22640057
226500                                                                  22650057
226600*----------------------------------------------------------------*22660099
226700*    FETCH THE DRIVERS LICENSE CURSOR IN ORDER TO RETRIEVE       *22670099
226800*    A CARD WITH A DRIVERS LICENSE EQUAL THE INPUT DRIVERS       *22680099
226900*    LICENSE.                                                    *22690099
227000*----------------------------------------------------------------*22700099
227100                                                                  22710099
227200 4320-FETCH-EQUAL.                                                22720099
227300                                                                  22730099
227400       EXEC SQL                                                   22740099
227500            FETCH EQUAL-CSR                                       22750099
227600            INTO  :SVT00002-CRD-NBR                               22760099
227700                , :SVT00002-DRV-LIC-NBR                           22770099
227800                , :SVT00002-TRN-VOID-IND                          22780099
227900                , :SVT00002-ACTVY-TYP-CDE                         22790099
228000                , :SVT00002-POS-DTE                               22800099
228100                , :SVT00002-STR-NBR                               22810099
228200                , :SVT00002-APP-AUTH-AMT                          22820099
228300                , :SVT00002-ACTVY-STAT-CDE                        22830099
228400                , :PV-HOLD-CARD-STAT                              22840099
228500       END-EXEC                                                   22850099
228600                                                                  22860099
228700     EVALUATE TRUE                                                22870099
228800         WHEN SQLCODE = ZERO                                      22880099
228900              SET PS-ITEMS-FOUND TO TRUE                          22890099
229000              ADD +1 TO ITEM-COUNTER                              22900099
229100         WHEN SQLCODE = +100                                      22910099
229200              IF ITEM-COUNTER = 1                                 22920099
229300                  SET PS-ITEMS-NOT-FOUND TO TRUE                  22930099
229400              END-IF                                              22940099
229500              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 22950099
229600         WHEN SQLWARN0 NOT = SPACE                                22960099
229700         WHEN SQLCODE NOT = ZERO                                  22970099
229800              MOVE '4310-FETCH-CURSOR'                            22980099
229900                               TO DP013-PARAGRAPH                 22990099
230000              MOVE 'FETCH DRV-LIC CURSOR'                         23000099
230100                               TO DP013-MESSAGE-TEXT (1)          23010099
230200              MOVE SQLCA       TO DP013-SQLCA                     23020099
230300              SET DP013-DB2-ABEND                                 23030099
230400                               TO TRUE                            23040099
230500              PERFORM DP013-0000-PROCESS-ABEND                    23050099
230600     END-EVALUATE.                                                23060099
230700                                                                  23070099
230800*----------------------------------------------------------------*23080099
230900*    FETCH THE HISTORY DL CURSOR IN ORDER TO RETRIEVE            *23090099
231000*    A CARD WITH A DRIVERS LICENSE EQUAL THE INPUT DRIVERS       *23100099
231100*    LICENSE.                                                    *23110099
231200*----------------------------------------------------------------*23120099
231300                                                                  23130099
231400 4325-FETCH-HIST-EQUAL.                                           23140099
231500                                                                  23150099
231600       EXEC SQL                                                   23160099
231700            FETCH EQUAL-CSR-HIST                                  23170099
231800            INTO  :SVT00006-CRD-NBR                               23180099
231900                , :SVT00006-DRV-LIC-NBR                           23190099
232000                , :SVT00006-TRN-VOID-IND                          23200099
232100                , :SVT00006-ACTVY-TYP-CDE                         23210099
232200                , :SVT00006-POS-DTE                               23220099
232300                , :SVT00006-STR-NBR                               23230099
232400                , :SVT00006-APP-AUTH-AMT                          23240099
232500                , :SVT00006-ACTVY-STAT-CDE                        23250099
232600                , :PV-HOLD-CARD-STAT                              23260099
232700       END-EXEC                                                   23270099
232800                                                                  23280099
232900     EVALUATE TRUE                                                23290099
233000         WHEN SQLCODE = ZERO                                      23300099
233100              SET PS-ITEMS-FOUND TO TRUE                          23310099
233200              ADD +1 TO ITEM-COUNTER                              23320099
233300         WHEN SQLCODE = +100                                      23330099
233400              IF ITEM-COUNTER = 1                                 23340099
233500                  SET PS-ITEMS-NOT-FOUND TO TRUE                  23350099
233600              END-IF                                              23360099
233700              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 23370099
233800         WHEN SQLWARN0 NOT = SPACE                                23380099
233900         WHEN SQLCODE NOT = ZERO                                  23390099
234000              MOVE '4315-FETCH-CURSOR-HIST'                       23400099
234100                               TO DP013-PARAGRAPH                 23410099
234200              MOVE 'FETCH DRV-LIC HIST CURSOR'                    23420099
234300                               TO DP013-MESSAGE-TEXT (1)          23430099
234400              MOVE SQLCA       TO DP013-SQLCA                     23440099
234500              SET DP013-DB2-ABEND                                 23450099
234600                               TO TRUE                            23460099
234700              PERFORM DP013-0000-PROCESS-ABEND                    23470099
234800     END-EVALUATE.                                                23480099
234900                                                                  23490099
235000*----------------------------------------------------------------*23500099
235100*    PROCESS FIRST TRANSACTION OF THE CARD FOUND IN ORDER TO      23510050
235200*    DISPLAY THE ISSUE STORE, ISSUE DATE, AND ISSUE AMOUNT.       23520050
235300*----------------------------------------------------------------*23530050
235400                                                                  23540050
235500 4330-PROCESS-CARD.                                               23550050
235600                                                                  23560050
235700      IF SVT00002-ACTVY-TYP-CDE = 1                               23570077
235800         MOVE SVT00002-DRV-LIC-NBR TO PV-HOLD-DRV-LIC-NBR         23580077
235900         MOVE SVT00002-CRD-NBR     TO PV-HOLD-CARD-NBR-NUM        23590077
236000         MOVE PV-HOLD-CARD-NBR-NUM TO PV-HOLD-CARD-NBR            23600050
236100         MOVE SVT00002-POS-DTE     TO PV-HOLD-ISSUE-DATE          23610077
236200         MOVE SVT00002-STR-NBR     TO PV-HOLD-ISSUE-STORE         23620077
236300         MOVE SVT00002-APP-AUTH-AMT TO PV-HOLD-ISSUE-AMT          23630077
236400      END-IF.                                                     23640050
236500                                                                  23650050
236600*----------------------------------------------------------------*23660057
236700*    PROCESS FIRST TRANSACTION OF THE CARD FOUND IN ORDER TO      23670057
236800*    DISPLAY THE ISSUE STORE, ISSUE DATE, AND ISSUE AMOUNT.       23680057
236900*----------------------------------------------------------------*23690057
237000 4335-PROCESS-CARD-HIST.                                          23700057
237100                                                                  23710057
237200      IF SVT00006-ACTVY-TYP-CDE = 1                               23720077
237300         MOVE SVT00006-DRV-LIC-NBR TO PV-HOLD-DRV-LIC-NBR         23730077
237400         MOVE SVT00006-CRD-NBR     TO PV-HOLD-CARD-NBR-NUM        23740077
237500         MOVE PV-HOLD-CARD-NBR-NUM TO PV-HOLD-CARD-NBR            23750057
237600         MOVE SVT00006-POS-DTE     TO PV-HOLD-ISSUE-DATE          23760077
237700         MOVE SVT00006-STR-NBR     TO PV-HOLD-ISSUE-STORE         23770077
237800         MOVE SVT00006-APP-AUTH-AMT TO PV-HOLD-ISSUE-AMT          23780077
237900      END-IF.                                                     23790057
238000                                                                  23800057
238100*----------------------------------------------------------------*23810050
238200* SUM THE NON-VOIDED AUTH AMOUNTS OF THE TRANSACTIONS TO GET THE *23820050
238300* CURRENT BALANCE.  IF NO RECORDS ARE FOUND TO BE SUMMED, CHECK  *23830050
238400* FOR THE NULL INDICATOR.                                        *23840050
238500*----------------------------------------------------------------*23850050
238600                                                                  23860050
238700 4340-SUM-CARD-TRANS.                                             23870050
238800                                                                  23880050
238900     EXEC SQL                                                     23890050
239000          SELECT                                                  23900050
239100                SUM(APP_AUTH_AMT)                                 23910050
239200          INTO :PV-HOLD-BALANCE :NI-BALANCE                       23920050
239300          FROM                                                    23930050
239400                SVT_KOHLS_CRD_TXN                                 23940077
239500          WHERE                                                   23950050
239600                CRD_NBR  = :PV-HOLD-CARD-NBR-NUM                  23960050
239700            AND TRN_VOID_IND = :SV004-NOT-VOID-TRANS              23970077
239800     END-EXEC.                                                    23980050
239900                                                                  23990050
240000     EVALUATE TRUE                                                24000050
240100         WHEN SQLCODE = ZERO                                      24010050
240200            IF NI-BALANCE < ZERO                                  24020050
240300               MOVE ZERO TO PV-HOLD-BALANCE                       24030050
240400            END-IF                                                24040050
240500         WHEN SQLWARN0 NOT = SPACE                                24050050
240600         WHEN SQLCODE NOT = ZERO                                  24060050
240700              MOVE '4340-SUM-CARD-TRANS'                          24070050
240800                               TO DP013-PARAGRAPH                 24080050
240900              MOVE 'ERROR WITH SUM CARDS'                         24090050
241000                               TO DP013-MESSAGE-TEXT (1)          24100050
241100              MOVE SQLCA       TO DP013-SQLCA                     24110050
241200              SET DP013-DB2-ABEND                                 24120050
241300                               TO TRUE                            24130050
241400              PERFORM DP013-0000-PROCESS-ABEND                    24140050
241500     END-EVALUATE.                                                24150050
241600                                                                  24160050
241700*----------------------------------------------------------------*24170064
241800* SUM THE NON-VOIDED AUTH AMOUNTS OF THE TRANSACTIONS TO GET THE *24180064
241900* CURRENT BALANCE.  IF NO RECORDS ARE FOUND TO BE SUMMED, CHECK  *24190064
242000* FOR THE NULL INDICATOR.                                        *24200064
242100*----------------------------------------------------------------*24210064
242200                                                                  24220064
242300 4345-SUM-CARD-TRANS-HIST.                                        24230064
242400                                                                  24240064
242500     EXEC SQL                                                     24250064
242600          SELECT                                                  24260064
242700                SUM(APP_AUTH_AMT)                                 24270064
242800          INTO :PV-HOLD-BALANCE :NI-BALANCE                       24280064
242900          FROM                                                    24290064
243000                SVT_CRD_TXN_HIST                                  24300077
243100          WHERE                                                   24310064
243200                CRD_NBR  = :PV-HOLD-CARD-NBR-NUM                  24320064
243300            AND TRN_VOID_IND = :SV004-NOT-VOID-TRANS              24330077
243400     END-EXEC.                                                    24340064
243500                                                                  24350064
243600     EVALUATE TRUE                                                24360064
243700         WHEN SQLCODE = ZERO                                      24370064
243800            IF NI-BALANCE < ZERO                                  24380064
243900               MOVE ZERO TO PV-HOLD-BALANCE                       24390064
244000            END-IF                                                24400064
244100         WHEN SQLWARN0 NOT = SPACE                                24410064
244200         WHEN SQLCODE NOT = ZERO                                  24420064
244300              MOVE '4345-SUM-CARD-TRANS-HIST'                     24430064
244400                               TO DP013-PARAGRAPH                 24440064
244500              MOVE 'ERROR WITH SUM CARDS'                         24450064
244600                               TO DP013-MESSAGE-TEXT (1)          24460064
244700              MOVE SQLCA       TO DP013-SQLCA                     24470064
244800              SET DP013-DB2-ABEND                                 24480064
244900                               TO TRUE                            24490064
245000              PERFORM DP013-0000-PROCESS-ABEND                    24500064
245100     END-EVALUATE.                                                24510064
245200                                                                  24520064
245300*----------------------------------------------------------------*24530050
245400* WRITE THE CARD INFORMATION TO TEMP STORAGE                     *24540050
245500*----------------------------------------------------------------*24550050
245600                                                                  24560050
245700 4350-WRITE-CARD.                                                 24570050
245800                                                                  24580050
245900                                                                  24590050
246000       IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                      24600050
246100           ADD +1            TO ASC-ITEM-SUB                      24610050
246200       ELSE                                                       24620050
246300           ADD +1            TO ASC-BLK-SUB                       24630050
246400           MOVE +1           TO ASC-ITEM-SUB                      24640050
246500           IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY               24650050
246600               MOVE +1       TO ASC-BLK-SUB                       24660050
246700               SET ASC-BLOCK-MODIFIED (1)                         24670050
246800                             TO TRUE                              24680050
246900               PERFORM 5100-WRITE-TEMP-STORAGE                    24690050
247000               MOVE ASC-BLOCK-ENTRIES                             24700050
247100                         (PC-MAX-BLOCKS-IN-ARRAY)                 24710050
247200                          TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)       24720050
247300               ADD +1        TO ASC-BLK-SUB                       24730050
247400               INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)         24740050
247500               SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)            24750050
247600                             TO TRUE                              24760050
247700           END-IF                                                 24770050
247800        END-IF.                                                   24780050
247900                                                                  24790050
248000*       MOVE PV-HOLD-DRV-LIC-NBR  TO ASC-DRV-LIC-NBR              24800099
248100*                                    (ASC-BLK-SUB ASC-ITEM-SUB).  24810099
248200        MOVE PV-HOLD-CARD-NBR     TO ASC-CARD-ID                  24820050
248300                                     (ASC-BLK-SUB ASC-ITEM-SUB).  24830050
248400        MOVE PV-HOLD-ISSUE-STORE  TO ASC-ISSUE-STORE              24840050
248500                                     (ASC-BLK-SUB ASC-ITEM-SUB).  24850050
248600        MOVE PV-HOLD-ISSUE-DATE-CC TO PV-HOLD-ISSUE-DATE2-CC      24860050
248700        MOVE PV-HOLD-ISSUE-DATE-YY TO PV-HOLD-ISSUE-DATE2-YY      24870050
248800        MOVE PV-HOLD-ISSUE-DATE-MM TO PV-HOLD-ISSUE-DATE2-MM      24880050
248900        MOVE PV-HOLD-ISSUE-DATE-DD TO PV-HOLD-ISSUE-DATE2-DD      24890050
249000        MOVE PV-HOLD-ISSUE-DATE2  TO ASC-ISSUE-DATE               24900050
249100                                     (ASC-BLK-SUB ASC-ITEM-SUB).  24910050
249200        MOVE PV-HOLD-ISSUE-AMT    TO ASC-ISSUE-AMT                24920050
249300                                     (ASC-BLK-SUB ASC-ITEM-SUB).  24930050
249400        MOVE PV-HOLD-BALANCE      TO ASC-BALANCE                  24940050
249500                                     (ASC-BLK-SUB ASC-ITEM-SUB).  24950050
249600        MOVE PV-HOLD-CARD-STAT    TO ASC-CARD-STATUS              24960050
249700                                     (ASC-BLK-SUB ASC-ITEM-SUB).  24970050
249800                                                                  24980050
249900        ADD +1                TO ASC-NUMBER-OF-ITEMS-READ         24990050
250000        MOVE ASC-NUMBER-OF-ITEMS-READ                             25000050
250100                              TO ASC-LIST-ITEM-NUMBER             25010050
250200                                   (ASC-BLK-SUB ASC-ITEM-SUB).    25020050
250300                                                                  25030050
250400                                                                  25040050
250500*----------------------------------------------------------------*25050050
250600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *25060050
250700*----------------------------------------------------------------*25070050
250800                                                                  25080050
250900 4400-MOVE-COMMAREA-TO-SCREEN.                                    25090050
251000*    MOVE ASC-KEY-DRV-LIC-NBR       TO ADRVLICO.                  25100099
251100     IF ASC-KEY-DRV-LIC-NBR-LONG > SPACES                         25110099
251200        PERFORM 4600-DL-ROUTINE                                   25120099
251300     ELSE                                                         25130099
251400        MOVE ASC-KEY-DRV-LIC-NBR    TO ADRVLICO                   25140099
251500     END-IF.                                                      25150099
251600                                                                  25160050
251700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             25170050
251800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          25180050
251900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          25190050
252000             MOVE +1    TO ASC-BLK-SUB                            25200050
252100             PERFORM 5100-WRITE-TEMP-STORAGE                      25210050
252200             ADD +1     TO ASC-BLK-SUB                            25220050
252300             PERFORM 5100-WRITE-TEMP-STORAGE                      25230050
252400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             25240050
252500                 GIVING PV-BLOCK-NUMBER                           25250050
252600                 REMAINDER PV-REMAINDER                           25260050
252700             IF  PV-REMAINDER > ZERO                              25270050
252800                 ADD +1 TO PV-BLOCK-NUMBER                        25280050
252900             END-IF                                               25290050
253000             MOVE +1    TO ASC-BLK-SUB                            25300050
253100             PERFORM 4410-READ-TEMP-STORAGE                       25310050
253200             ADD +1     TO ASC-BLK-SUB                            25320050
253300                           PV-BLOCK-NUMBER                        25330050
253400             PERFORM 4410-READ-TEMP-STORAGE                       25340050
253500     END-IF.                                                      25350050
253600     MOVE +1            TO ASC-BLK-SUB.                           25360050
253700     COMPUTE ASC-ITEM-SUB =                                       25370050
253800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              25380050
253900         + PC-ITEMS-PER-PANEL).                                   25390050
254000*                                                                 25400050
254100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        25410050
254200         ADD +1         TO ASC-BLK-SUB                            25420050
254300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25430050
254400     END-IF.                                                      25440050
254500*                                                                 25450050
254600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           25460050
254700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                25470050
254800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        25480050
254900     PERFORM 4420-FORMAT-LIST-LINES                               25490050
255000         VARYING PV-SUB                                           25500050
255100         FROM PC-ITEMS-PER-PANEL BY -1                            25510050
255200         UNTIL PV-SUB < +1.                                       25520050
255300*                                                                 25530050
255400     COMPUTE ASC-ITEMS-DISPLAYED =                                25540050
255500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          25550050
255600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    25560050
255700                                      ASTRTITO.                   25570050
255800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    25580050
255900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    25590050
256000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25600050
256100                                   TO ASELITO.                    25610050
256200                                                                  25620098
256300     IF  DP020-MSG-NUMBER-X = SPACE                               25630098
256400       IF (ASC-ITEM-AT-BOT-OF-PANEL = ASC-NUMBER-OF-ITEMS-READ)   25640098
256500           AND PS-MAX-FOUND                                       25650098
256600*          -- NOT ALL DATA DISPLAYED;CONTACT DATA PROCESSING --   25660098
256700           MOVE PC-TSYMSG-03026    TO DP020-MSG-NUMBER            25670098
256800           SET DP020-MSG-INFORMATIONAL TO TRUE                    25680098
256900       ELSE                                                       25690098
257000         IF (ASC-ITEM-AT-BOT-OF-PANEL = ASC-NUMBER-OF-ITEMS-READ) 25700098
257100*            -- BOTTOM OF LIST --                                 25710098
257200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            25720098
257300             SET DP020-MSG-INFORMATIONAL TO TRUE                  25730098
257400         ELSE                                                     25740098
257500          IF (ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ)25750098
257600*              --- MORE ITEMS TO DISPLAY ----                     25760098
257700               MOVE PC-TSYMSG-00279 TO DP020-MSG-NUMBER           25770098
257800               SET DP020-MSG-INFORMATIONAL TO TRUE                25780098
257900           END-IF                                                 25790098
258000         END-IF                                                   25800098
258100       END-IF                                                     25810098
258200     END-IF.                                                      25820098
258300*----------------------------------------------------------------*25830050
258400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25840050
258500*----------------------------------------------------------------*25850050
258600                                                                  25860050
258700 4410-READ-TEMP-STORAGE.                                          25870050
258800                                                                  25880050
258900     EXEC CICS                                                    25890050
259000         READQ TS                                                 25900050
259100             QUEUE (ASC-LIST-QUEUE-NAME)                          25910050
259200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25920050
259300             ITEM  (PV-BLOCK-NUMBER)                              25930050
259400             RESP  (PV-CICS-RESP)                                 25940050
259500     END-EXEC.                                                    25950050
259600                                                                  25960050
259700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25970050
259800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25980050
259900         CONTINUE                                                 25990050
260000     ELSE                                                         26000050
260100         SET DP013-CICS-ABEND     TO TRUE                         26010050
260200         SET DP013-NO-ROLLBACK    TO TRUE                         26020050
260300         MOVE '4410-READ-TEMP-STORAGE'                            26030050
260400                                  TO DP013-PARAGRAPH              26040050
260500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      26050050
260600                                  TO DP013-MESSAGE-TEXT(1)        26060050
260700         PERFORM DP013-0000-PROCESS-ABEND                         26070050
260800     END-IF.                                                      26080050
260900                                                                  26090050
261000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26100050
261100*                                                                 26110050
261200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         26120050
261300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               26130050
261400     END-IF.                                                      26140050
261500*----------------------------------------------------------------*26150050
261600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *26160050
261700*----------------------------------------------------------------*26170050
261800                                                                  26180050
261900 4420-FORMAT-LIST-LINES.                                          26190050
262000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      26200050
262100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                26210050
262200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           26220050
262300         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           26230050
262400         MOVE SPACE              TO MR-SELECTI (PV-SUB)           26240050
262500*                                   MR-DRV-LIC-NBR (PV-SUB)       26250099
262600                                    MR-CARD-ID-X (PV-SUB)         26260089
262700                                    MR-ISSUE-DTE (PV-SUB)         26270050
262800                                    MR-ISSUE-STR-X (PV-SUB)       26280050
262900                                    MR-ISSUE-AMT-X (PV-SUB)       26290050
263000                                    MR-BALANCE-X (PV-SUB)         26300050
263100                                    MR-CARD-STATUS (PV-SUB)       26310050
263200     ELSE                                                         26320050
263300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26330050
263400                                                   > SPACE        26340050
263500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 26350050
263600                                 TO MR-SELECTI (PV-SUB)           26360050
263700         ELSE                                                     26370050
263800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26380050
263900                                 TO MR-SELECTI (PV-SUB)           26390050
264000         END-IF                                                   26400050
264100*                                                                 26410050
264200         IF  DP030-SET-CURSOR-TRAILER                             26420050
264300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)26430050
264400                 > SPACE)                                         26440050
264500               OR (PV-SUB = 1))                                   26450050
264600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               26460050
264700                MOVE -1          TO MR-SELECTL (PV-SUB)           26470050
264800             END-IF                                               26480050
264900         END-IF                                                   26490050
265000*                                                                 26500090
265100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           26510050
265200*            MOVE ASC-DRV-LIC-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      26520099
265300*                                TO MR-DRV-LIC-NBR (PV-SUB)       26530099
265400             MOVE ASC-CARD-ID-N (ASC-BLK-SUB ASC-ITEM-SUB)        26540091
265500                                 TO MR-CARD-ID (PV-SUB)           26550091
265600             MOVE ASC-ISSUE-STORE (ASC-BLK-SUB ASC-ITEM-SUB)      26560050
265700                                 TO MR-ISSUE-STR (PV-SUB)         26570050
265800             MOVE ASC-ISSUE-DATE (ASC-BLK-SUB ASC-ITEM-SUB)       26580050
265900                                 TO MR-ISSUE-DTE (PV-SUB)         26590050
266000             MOVE ASC-ISSUE-AMT   (ASC-BLK-SUB ASC-ITEM-SUB)      26600050
266100                                 TO MR-ISSUE-AMT (PV-SUB)         26610050
266200             MOVE ASC-BALANCE     (ASC-BLK-SUB ASC-ITEM-SUB)      26620050
266300                                 TO MR-BALANCE (PV-SUB)           26630050
266400             MOVE ASC-CARD-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)      26640050
266500                                 TO MR-CARD-STATUS (PV-SUB)       26650050
266600         END-IF                                                   26660050
266700     END-IF.                                                      26670050
266800     SUBTRACT +1 FROM ASC-ITEM-SUB                                26680050
266900     IF  ASC-ITEM-SUB < + 1                                       26690050
267000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  26700050
267100         MOVE +1                 TO ASC-BLK-SUB                   26710050
267200     END-IF.                                                      26720050
267300******************************************************************26730050
267400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **26740050
267500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **26750050
267600** ISSUE A WARNING.                                             **26760050
267700******************************************************************26770050
267800 4430-CHECK-FOR-BEGIN-AND-END.                                    26780050
267900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       26790050
268000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     26800050
268100*            -- NO END-OF-RANGE SPECFIED ---                      26810050
268200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            26820050
268300             SET DP020-MSG-WARNING TO TRUE                        26830050
268400             PERFORM 4431-POSITION-AT-WARNING                     26840050
268500         END-IF                                                   26850050
268600     ELSE                                                         26860050
268700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     26870050
268800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                26880050
268900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            26890050
269000             SET DP020-MSG-WARNING TO TRUE                        26900050
269100             PERFORM 4431-POSITION-AT-WARNING                     26910050
269200         END-IF                                                   26920050
269300     END-IF.                                                      26930050
269400******************************************************************26940050
269500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **26950050
269600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **26960050
269700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **26970050
269800** POSITION THE CURSOR THERE.                                   **26980050
269900******************************************************************26990050
270000 4431-POSITION-AT-WARNING.                                        27000050
270100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 27010050
270200                    - PV-TOP-ITEM + 1.                            27020050
270300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27030050
270400         CONTINUE                                                 27040050
270500     ELSE                                                         27050050
270600         SET DP030-SET-CURSOR-APPL-1                              27060050
270700                                   TO TRUE                        27070050
270800         MOVE -1                   TO MR-SELECTL (PV-SUB)         27080050
270900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27090050
271000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27100050
271100     END-IF.                                                      27110050
271200*                                                                 27120050
271300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   27130050
271400                    - PV-TOP-ITEM + 1.                            27140050
271500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27150050
271600         CONTINUE                                                 27160050
271700     ELSE                                                         27170050
271800         SET DP030-SET-CURSOR-APPL-1                              27180050
271900                                   TO TRUE                        27190050
272000         MOVE -1                   TO MR-SELECTL (PV-SUB)         27200050
272100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27210050
272200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27220050
272300     END-IF.                                                      27230050
272400                                                                  27240099
272500*----------------------------------------------------------------*27250099
272600 4600-DL-ROUTINE.                                                 27260099
272700                                                                  27270099
272800     MOVE ASC-KEY-DRV-LIC-NBR-LONG  TO PV-DRV-LIC-NBR-LONG.       27280099
272900                                                                  27290099
273000     PERFORM VARYING PV-SUB                                       27300099
273100        FROM 50 BY -1                                             27310099
273200          UNTIL PV-SUB EQUAL 1                                    27320099
273300                                                                  27330099
273400           IF PV-DRV-LIC-NBR-BYTE (PV-SUB) > SPACE                27340099
273500              CONTINUE                                            27350099
273600           ELSE                                                   27360099
273700              MOVE PC-PERCENT   TO PV-DRV-LIC-NBR-BYTE (PV-SUB)   27370099
273800           END-IF                                                 27380099
273900                                                                  27390099
274000     END-PERFORM.                                                 27400099
274100                                                                  27410099
274200     MOVE PV-DRV-LIC-NBR-LONG       TO PV-DB2-LONG-DL.            27420099
274300     MOVE PV-DB2-DL-NBR             TO DK-DRV-LIC-NBR-LONG.       27430099
274400                                                                  27440099
274500     PERFORM 4650-SELECT-DRVR-LIC-TRANSL.                         27450099
274600                                                                  27460099
274700     MOVE ASC-KEY-DRV-LIC-NBR-LONG   TO ADRVLICO.                 27470099
274800                                                                  27480099
274900*----------------------------------------------------------------*27490099
275000* USING THE ENCRYPTED DRIVERS LICENSE NUMBER, RETRIEVE THE       *27500099
275100* UN-ENCRYPTED VERSION FROM RDT_DRVR_LIC_TRANSL TABLE.           *27510099
275200*----------------------------------------------------------------*27520099
275300 4650-SELECT-DRVR-LIC-TRANSL.                                     27530099
275400                                                                  27540099
275500     PERFORM                                                      27550099
275600         WITH TEST AFTER                                          27560099
275700         VARYING PV-RETRY-COUNTER                                 27570099
275800         FROM 1 BY 1                                              27580099
275900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27590099
276000                   OR (SQLCODE = ZERO)                            27600099
276100                   OR (SQLCODE = +100))                           27610099
276200                                                                  27620099
276300         EXEC SQL                                                 27630099
276400           SELECT  DRVR_LIC_NBR                                   27640099
276500             INTO :RDT00004-DRVR-LIC-NBR                          27650099
276600             FROM RDT_DRVR_LIC_TRANSL                             27660099
276700            WHERE ENCRPD_DRVRLIC_NBR LIKE                         27670099
276800                                     :DK-DRV-LIC-NBR-LONG         27680099
276900         END-EXEC                                                 27690099
277000                                                                  27700099
277100         EVALUATE TRUE                                            27710099
277200             WHEN SQLCODE = ZERO                                  27720099
277300                 CONTINUE                                         27730099
277400                                                                  27740099
277500             WHEN SQLCODE = +100                                  27750099
277600                 MOVE ZEROES    TO RDT00004-DRVR-LIC-NBR-LEN      27760099
277700                 MOVE SPACES    TO RDT00004-DRVR-LIC-NBR-TEXT     27770099
277800                                                                  27780099
277900             WHEN SQLCODE = -904                                  27790099
278000             WHEN SQLCODE = -913                                  27800099
278100                 CONTINUE                                         27810099
278200                                                                  27820099
278300             WHEN SQLWARN0 NOT = SPACES                           27830099
278400             WHEN SQLCODE < ZERO                                  27840099
278500             WHEN SQLCODE > ZERO                                  27850099
278600                 MOVE '4650-SELECT-DRVR-LIC-TRANSL'               27860099
278700                                   TO DP013-PARAGRAPH             27870099
278800                 MOVE 'SELECT DL CONVERT'                         27880099
278900                                   TO DP013-MESSAGE-TEXT (1)      27890099
279000                 MOVE ASC-KEY-DRV-LIC-NBR-LONG                    27900099
279100                                   TO DP013-MESSAGE-TEXT (2)      27910099
279200                 MOVE SQLCA        TO DP013-SQLCA                 27920099
279300                 MOVE 'RDT_DRVR_LIC_TRANSL'                       27930099
279400                                   TO DP013-DB2-TABLE-NAME (1)    27940099
279500                 SET DP013-DB2-ABEND                              27950099
279600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27960099
279700                 PERFORM DP013-0000-PROCESS-ABEND                 27970099
279800         END-EVALUATE                                             27980099
279900     END-PERFORM.                                                 27990099
280000                                                                  28000099
280100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28010099
280200         MOVE '4650-SELECT-DRVR-LIC-TRANSL'                       28020099
280300                                   TO DP013-PARAGRAPH             28030099
280400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     28040099
280500                                   TO DP013-MESSAGE-TEXT (1)      28050099
280600         MOVE 'DL NBR: '           TO DP013-MESSAGE-TEXT (2)      28060099
280700         MOVE ASC-KEY-DRV-LIC-NBR-LONG                            28070099
280800                                   TO DP013-MESSAGE-TEXT (3)      28080099
280900         MOVE SQLCA                TO DP013-SQLCA                 28090099
281000         MOVE 'RDT_DRVR_LIC_TRANSL'                               28100099
281100                                   TO DP013-DB2-TABLE-NAME (1)    28110099
281200         SET DP013-DB2-ABEND                                      28120099
281300             DP013-XCTL-DISPLAY-RESTART                           28130099
281400                                   TO TRUE                        28140099
281500         PERFORM DP013-0000-PROCESS-ABEND                         28150099
281600     END-IF.                                                      28160099
281700                                                                  28170099
281800*----------------------------------------------------------------*28180050
281900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *28190050
282000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *28200050
282100* FOR THE SELECTED ITEMS QUEUE.                                  *28210050
282200*                                                                *28220050
282300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *28230050
282400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *28240050
282500* THE ARRAY IS FULL.                                             *28250050
282600*----------------------------------------------------------------*28260050
282700                                                                  28270050
282800 5000-PREPARE-SEL-QUEUE.                                          28280050
282900                                                                  28290050
283000     MOVE +1                   TO  ASC-BLK-SUB.                   28300050
283100     PERFORM 5100-WRITE-TEMP-STORAGE.                             28310050
283200     ADD +1                    TO  ASC-BLK-SUB.                   28320050
283300     PERFORM 5100-WRITE-TEMP-STORAGE.                             28330050
283400                                                                  28340050
283500     MOVE ASC-SEL-QUEUE-NAME   TO  RD026-SEL-QUEUE-NAME.          28350050
283600     PERFORM 6010-DELETE-SEL-QUEUE.                               28360050
283700                                                                  28370050
283800     SET ASC-UPDATE-TSQ        TO  TRUE.                          28380050
283900                                                                  28390050
284000     SET RD025-IDX             TO  1.                             28400050
284100     MOVE ZERO                 TO RD026-NUMBER-OF-TS-ITEMS.       28410050
284200     INITIALIZE RD025-SELECTED-ITEM-ARRAY.                        28420050
284300                                                                  28430050
284400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           28440050
284500             VARYING PV-ITEM                                      28450050
284600             FROM 1 BY 1                                          28460050
284700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     28470050
284800                                                                  28480050
284900     IF  RD025-IDX > 1                                            28490050
285000         PERFORM 5205-WRITE-SEL-QUEUE                             28500050
285100         ADD +1                TO RD026-NUMBER-OF-TS-ITEMS        28510050
285200     END-IF.                                                      28520050
285300*----------------------------------------------------------------*28530050
285400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *28540050
285500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *28550050
285600*----------------------------------------------------------------*28560050
285700                                                                  28570050
285800 5100-WRITE-TEMP-STORAGE.                                         28580050
285900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     28590050
286000                                   TO PV-LIST-ITEM-NUMBER.        28600050
286100     COMPUTE PV-BLOCK-NUMBER =                                    28610050
286200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    28620050
286300                                                                  28630050
286400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             28640050
286500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             28650050
286600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      28660050
286700             PERFORM 5105-REWRITE-ASC-LISTQ                       28670050
286800         END-IF                                                   28680050
286900     ELSE                                                         28690050
287000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       28700050
287100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            28710050
287200         PERFORM 5110-WRITE-ASC-LISTQ                             28720050
287300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   28730050
287400     END-IF.                                                      28740050
287500                                                                  28750050
287600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             28760050
287700******************************************************************28770050
287800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **28780050
287900** SPECIFIC COMMAREA.                                           **28790050
288000******************************************************************28800050
288100 5105-REWRITE-ASC-LISTQ.                                          28810050
288200     EXEC CICS                                                    28820050
288300         WRITEQ TS                                                28830050
288400             QUEUE (ASC-LIST-QUEUE-NAME)                          28840050
288500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28850050
288600             ITEM  (PV-BLOCK-NUMBER)                              28860050
288700             REWRITE                                              28870050
288800             RESP  (PV-CICS-RESP)                                 28880050
288900     END-EXEC.                                                    28890050
289000                                                                  28900050
289100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           28910050
289200         CONTINUE                                                 28920050
289300     ELSE                                                         28930050
289400         SET DP013-CICS-ABEND            TO TRUE                  28940050
289500         SET DP013-NO-ROLLBACK           TO TRUE                  28950050
289600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       28960050
289700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     28970050
289800                                         TO DP013-MESSAGE-TEXT(1) 28980050
289900         PERFORM DP013-0000-PROCESS-ABEND                         28990050
290000     END-IF.                                                      29000050
290100                                                                  29010050
290200******************************************************************29020050
290300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **29030050
290400** SPECIFIC COMMAREA.                                           **29040050
290500******************************************************************29050050
290600 5110-WRITE-ASC-LISTQ.                                            29060050
290700     EXEC CICS                                                    29070050
290800         WRITEQ TS                                                29080050
290900             QUEUE (ASC-LIST-QUEUE-NAME)                          29090050
291000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29100050
291100             ITEM  (PV-BLOCK-NUMBER)                              29110050
291200             RESP  (PV-CICS-RESP)                                 29120050
291300     END-EXEC.                                                    29130050
291400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      29140050
291500         SET DP013-CICS-ABEND      TO TRUE                        29150050
291600         SET DP013-NO-ROLLBACK     TO TRUE                        29160050
291700         MOVE '5110-WRITE-ASC-LISTQ'                              29170050
291800                                   TO DP013-PARAGRAPH             29180050
291900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           29190050
292000                                   TO DP013-MESSAGE-TEXT(1)       29200050
292100         PERFORM DP013-0000-PROCESS-ABEND                         29210050
292200     END-IF.                                                      29220050
292300*----------------------------------------------------------------*29230050
292400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *29240050
292500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *29250050
292600*----------------------------------------------------------------*29260050
292700                                                                  29270050
292800 5200-FILL-SEL-QUEUE-RECORD.                                      29280050
292900                                                                  29290050
293000     PERFORM 6112-READ-LIST-QUEUE.                                29300050
293100                                                                  29310050
293200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       29320050
293300         PERFORM                                                  29330050
293400         VARYING LQW-IDX                                          29340050
293500         FROM 1 BY 1                                              29350050
293600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            29360050
293700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          29370050
293800                                                                  29380050
293900             IF  LQW-SELECT (LQW-IDX)                             29390050
294000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              29400050
294100                                   TO RD025-ITEM (RD025-IDX)      29410050
294200                 MOVE LQW-CARD-ID (LQW-IDX)                       29420050
294300                                   TO RD025-CARD-ID (RD025-IDX)   29430050
294400                 SET RD025-IDX UP BY 1                            29440050
294500                 IF  RD025-IDX > RD025-MAX-ITEMS                  29450050
294600                     PERFORM 5205-WRITE-SEL-QUEUE                 29460050
294700                     ADD +1        TO RD026-NUMBER-OF-TS-ITEMS    29470050
294800                     INITIALIZE RD025-SELECTED-ITEM-ARRAY         29480050
294900                     SET RD025-IDX TO  1                          29490050
295000                 END-IF                                           29500050
295100             END-IF                                               29510050
295200         END-PERFORM                                              29520050
295300     END-IF.                                                      29530050
295400                                                                  29540050
295500*----------------------------------------------------------------*29550050
295600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *29560050
295700*----------------------------------------------------------------*29570050
295800                                                                  29580050
295900 5205-WRITE-SEL-QUEUE.                                            29590050
296000                                                                  29600050
296100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29610050
296200                                   TO RD025-SELECTED-ITEMS.       29620050
296300                                                                  29630050
296400     EXEC CICS                                                    29640050
296500          WRITEQ TS                                               29650050
296600              QUEUE (ASC-SEL-QUEUE-NAME)                          29660050
296700              FROM  (RD025-CARD-SEL-REC)                          29670050
296800              ITEM  (PV-SEL-QUEUE-ITEM)                           29680050
296900              RESP  (PV-CICS-RESP)                                29690050
297000     END-EXEC.                                                    29700050
297100                                                                  29710050
297200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29720050
297300         CONTINUE                                                 29730050
297400     ELSE                                                         29740050
297500         SET DP013-CICS-ABEND      TO TRUE                        29750050
297600         SET DP013-NO-ROLLBACK     TO TRUE                        29760050
297700         MOVE '5205-WRITE-SEL-QUEUE'                              29770050
297800                                   TO DP013-PARAGRAPH             29780050
297900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          29790050
298000                                   TO DP013-MESSAGE-TEXT(1)       29800050
298100         PERFORM DP013-0000-PROCESS-ABEND                         29810050
298200     END-IF.                                                      29820050
298300 5500-FIND-FIRST-SELECTED.                                        29830050
298400                                                                  29840050
298500******************************************************************29850050
298600*    FIND THE FIRST CARD SELECTED ON THE LIST AND PASS THIS       29860050
298700*    DOCUMENT TO EITHER RDKCS025.  THE 13 DIGIT CARD ID MUST BE   29870050
298800*    PASSED, SO THE KMRC CARD NUMBER MUST BE PREFIXED WITH 3 ZEROS29880050
298900******************************************************************29890050
299000                                                                  29900050
299100     IF BQW-SELECTED (BQW-ITEM-SUB)                               29910050
299200        SET PS-SELECTION-FOUND TO TRUE                            29920050
299300                                                                  29930050
299400        MOVE BQW-CARD-ID (BQW-ITEM-SUB)                           29940050
299500                            TO PV-HOLD-CARD-NBR                   29950050
299600        MOVE PV-HOLD-CARD-NBR-N                                   29960050
299700                            TO PV-HOLD-CARD-ID                    29970050
299800                               RD020-CARD-ID                      29980086
299900     ELSE                                                         29990050
300000         ADD +1 TO BQW-ITEM-SUB                                   30000050
300100     END-IF.                                                      30010050
300200                                                                  30020050
300300     IF (BQW-ITEM-SUB > PC-ITEMS-PER-PANEL) AND                   30030050
300400        (PS-NO-SELECTION-FOUND)                                   30040050
300500         MOVE +1 TO BQW-ITEM-SUB                                  30050050
300600                                                                  30060050
300700         ADD +1  TO BQW-BLOCK-SUB                                 30070050
300800                                                                  30080050
300900         PERFORM 5510-READ-TEMP-STORAGE                           30090050
301000     END-IF.                                                      30100050
301100 5510-READ-TEMP-STORAGE.                                          30110050
301200                                                                  30120050
301300******************************************************************30130050
301400*    READ A BLOCK FROM TEMPORARY STORAGE INTO WORKING STORAGE.    30140050
301500******************************************************************30150050
301600                                                                  30160050
301700     EXEC CICS                                                    30170050
301800         READQ TS                                                 30180050
301900         QUEUE(ASC-LIST-QUEUE-NAME)                               30190050
302000         INTO(BQW-BLOCK)                                          30200050
302100         ITEM(BQW-BLOCK-SUB)                                      30210050
302200         RESP(PV-CICS-RESP)                                       30220050
302300     END-EXEC.                                                    30230050
302400                                                                  30240050
302500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       30250050
302600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     30260050
302700         CONTINUE                                                 30270050
302800     ELSE                                                         30280050
302900         SET DP013-CICS-ABEND     TO TRUE                         30290050
303000         SET DP013-NO-ROLLBACK    TO TRUE                         30300050
303100         MOVE '5510-READ-TEMP-STORAGE'                            30310050
303200                                  TO DP013-PARAGRAPH              30320050
303300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      30330050
303400                                  TO DP013-MESSAGE-TEXT(1)        30340050
303500         PERFORM DP013-0000-PROCESS-ABEND                         30350050
303600     END-IF.                                                      30360050
303700                                                                  30370050
303800******************************************************************30380050
303900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **30390050
304000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **30400050
304100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **30410050
304200** THE USER.                                                    **30420050
304300******************************************************************30430050
304400 6000-REFRESH-PANEL-FROM-TEMP.                                    30440050
304500     IF  ASC-UPDATE-TSQ                                           30450050
304600         SET ASC-NO-TSQ-UPDATE TO TRUE                            30460050
304700         MOVE ZERO                 TO PV-SAVE-ITEM                30470050
304800                                      PV-SEL-QUEUE-ITEM           30480050
304900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        30490050
305000                                   TO PV-HOLD-SELECTED-ITEMS      30500050
305100         MOVE +1                   TO PV-ITEMS-PROCESSED          30510050
305200         PERFORM 6100-UPDATE-TSQ                                  30520050
305300             UNTIL PV-ITEMS-PROCESSED >                           30530050
305400                                     PV-HOLD-SELECTED-ITEMS       30540050
305500         PERFORM 6010-DELETE-SEL-QUEUE                            30550050
305600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         30560050
305700                    ASC-BLOCK-ENTRIES (2)                         30570050
305800     END-IF.                                                      30580050
305900                                                                  30590050
306000*----------------------------------------------------------------*30600050
306100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *30610050
306200*----------------------------------------------------------------*30620050
306300 6010-DELETE-SEL-QUEUE.                                           30630050
306400                                                                  30640050
306500     EXEC CICS                                                    30650050
306600         DELETEQ TS                                               30660050
306700             QUEUE (ASC-SEL-QUEUE-NAME)                           30670050
306800             RESP  (PV-CICS-RESP)                                 30680050
306900     END-EXEC.                                                    30690050
307000*                                                                 30700050
307100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      30710050
307200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         30720050
307300         CONTINUE                                                 30730050
307400     ELSE                                                         30740050
307500         SET DP013-CICS-ABEND TO TRUE                             30750050
307600         SET DP013-NO-ROLLBACK TO TRUE                            30760050
307700         MOVE '6010-DELETE-SEL-QUEUE'                             30770050
307800                        TO DP013-PARAGRAPH                        30780050
307900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         30790050
308000                        TO DP013-MESSAGE-TEXT (1)                 30800050
308100         PERFORM DP013-0000-PROCESS-ABEND                         30810050
308200     END-IF.                                                      30820050
308300                                                                  30830050
308400*----------------------------------------------------------------*30840050
308500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *30850050
308600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *30860050
308700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *30870050
308800*    THE TEMP QUEUE.                                             *30880050
308900*----------------------------------------------------------------*30890050
309000                                                                  30900050
309100 6100-UPDATE-TSQ.                                                 30910050
309200                                                                  30920050
309300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             30930050
309400     PERFORM 6105-READ-SEL-QUEUE.                                 30940050
309500     PERFORM                                                      30950050
309600         VARYING RD025-IDX                                        30960050
309700         FROM 1 BY 1                                              30970050
309800         UNTIL ((PV-ITEMS-PROCESSED >                             30980050
309900                              PV-HOLD-SELECTED-ITEMS)             30990050
310000         OR (RD025-IDX GREATER THAN RD025-MAX-ITEMS))             31000050
310100         PERFORM 6110-PROCESS-ITEMS                               31010050
310200         ADD +1                TO PV-ITEMS-PROCESSED              31020050
310300     END-PERFORM.                                                 31030050
310400     PERFORM 6111-WRITE-LIST-QUEUE.                               31040050
310500*----------------------------------------------------------------*31050050
310600*    READ THE LIST QUEUE RECORD.                                 *31060050
310700*----------------------------------------------------------------*31070050
310800                                                                  31080050
310900 6105-READ-SEL-QUEUE.                                             31090050
311000                                                                  31100050
311100     EXEC CICS                                                    31110050
311200          READQ TS                                                31120050
311300              QUEUE (ASC-SEL-QUEUE-NAME)                          31130050
311400              INTO  (RD025-CARD-SEL-REC)                          31140050
311500              ITEM  (PV-SEL-QUEUE-ITEM)                           31150050
311600              RESP  (PV-CICS-RESP)                                31160050
311700     END-EXEC.                                                    31170050
311800*                                                                 31180050
311900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31190050
312000         CONTINUE                                                 31200050
312100     ELSE                                                         31210050
312200         SET DP013-CICS-ABEND      TO  TRUE                       31220050
312300         SET DP013-NO-ROLLBACK     TO  TRUE                       31230050
312400         MOVE '6105-READ-SEL-QUEUE'                               31240050
312500                                   TO  DP013-PARAGRAPH            31250050
312600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           31260050
312700                                   TO  DP013-MESSAGE-TEXT(1)      31270050
312800         PERFORM DP013-0000-PROCESS-ABEND                         31280050
312900     END-IF.                                                      31290050
313000*----------------------------------------------------------------*31300050
313100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*31310050
313200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*31320050
313300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *31330050
313400*----------------------------------------------------------------*31340050
313500                                                                  31350050
313600 6110-PROCESS-ITEMS.                                              31360050
313700                                                                  31370050
313800     COMPUTE PV-ITEM = 1 + ((RD025-ITEM (RD025-IDX) - 1)          31380050
313900                     / PC-ITEMS-PER-PANEL).                       31390050
314000                                                                  31400050
314100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           31410050
314200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          31420050
314300             PERFORM 6111-WRITE-LIST-QUEUE                        31430050
314400         END-IF                                                   31440050
314500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    31450050
314600                                                                  31460050
314700         PERFORM 6112-READ-LIST-QUEUE                             31470050
314800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               31480050
314900             CONTINUE                                             31490050
315000         END-IF                                                   31500050
315100     END-IF.                                                      31510050
315200                                                                  31520050
315300     COMPUTE PV-SUB = (RD025-ITEM (RD025-IDX)                     31530050
315400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              31540050
315500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         31550050
315600     MOVE LQW-SELECTED-SW (PV-SUB)                                31560050
315700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  31570050
315800                                                                  31580050
315900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                31590050
316000                                                                  31600050
316100*----------------------------------------------------------------*31610050
316200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *31620050
316300*----------------------------------------------------------------*31630050
316400                                                                  31640050
316500 6111-WRITE-LIST-QUEUE.                                           31650050
316600                                                                  31660050
316700     EXEC CICS                                                    31670050
316800         WRITEQ TS                                                31680050
316900             QUEUE (ASC-LIST-QUEUE-NAME)                          31690050
317000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     31700050
317100             ITEM  (PV-SAVE-ITEM)                                 31710050
317200             REWRITE                                              31720050
317300             RESP  (PV-CICS-RESP)                                 31730050
317400     END-EXEC.                                                    31740050
317500*                                                                 31750050
317600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31760050
317700         CONTINUE                                                 31770050
317800     ELSE                                                         31780050
317900         SET DP013-CICS-ABEND  TO  TRUE                           31790050
318000         SET DP013-NO-ROLLBACK TO  TRUE                           31800050
318100         MOVE '6111-WRITE-LIST-QUEUE'                             31810050
318200                               TO  DP013-PARAGRAPH                31820050
318300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  31830050
318400                               TO  DP013-MESSAGE-TEXT(1)          31840050
318500         PERFORM DP013-0000-PROCESS-ABEND                         31850050
318600     END-IF.                                                      31860050
318700                                                                  31870050
318800*----------------------------------------------------------------*31880050
318900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*31890050
319000*----------------------------------------------------------------*31900050
319100                                                                  31910050
319200 6112-READ-LIST-QUEUE.                                            31920050
319300                                                                  31930050
319400     EXEC CICS                                                    31940050
319500         READQ TS                                                 31950050
319600             QUEUE (ASC-LIST-QUEUE-NAME)                          31960050
319700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     31970050
319800             ITEM  (PV-ITEM)                                      31980050
319900             RESP  (PV-CICS-RESP)                                 31990050
320000     END-EXEC.                                                    32000050
320100*                                                                 32010050
320200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32020050
320300         CONTINUE                                                 32030050
320400     ELSE                                                         32040050
320500         SET DP013-CICS-ABEND        TO TRUE                      32050050
320600         SET DP013-NO-ROLLBACK       TO TRUE                      32060050
320700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           32070050
320800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    32080050
320900                                     TO DP013-MESSAGE-TEXT(1)     32090050
321000         PERFORM DP013-0000-PROCESS-ABEND                         32100050
321100     END-IF.                                                      32110050
321200                                                                  32120050
321300*----------------------------------------------------------------*32130050
321400*    ABEND PROCESSOR MODULE                                      *32140050
321500*----------------------------------------------------------------*32150050
321600                                                                  32160050
321700     COPY DPPD013.                                                32170050
