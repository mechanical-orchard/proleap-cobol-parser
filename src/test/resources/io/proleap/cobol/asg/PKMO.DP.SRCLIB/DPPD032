000100******************************************************************00010047
000200*  COPY MEMBER  DPPD032.                                         *00020047
000300*                                                                *00030047
000400*  THIS COPY MEMBER CONTAINS THE PROCEDURE DIVISION STATEMENTS   *00040047
000500*  THAT ARE REQUIRED TO INVOKE THE PROTEGRITY MODULE (PTYPCSL &  *00050047
000600*  PTYPSLL) FOR ONLINE PROGRAMS                                  *00060047
000700*                                       WR/IR#: CHG0104429       *00070047
000800******************************************************************00080047
000900*                                                                *00090047
001000*  LISTED BELOW ARE NOTES ON WHAT NEEDS TO BE DEFINED IN THE     *00100047
001100*  DATA AND PROCEDURE DIVISIONS TO USE THIS COPY MEMBER:         *00110047
001200*                                                                *00120047
001300*  ENSURE THAT THE ASSOCIATED WORKING-STORAGE COPY MEMBER        *00130047
001400*  (DPWS031) IS COPIED INTO THE WORKING-STORAGE SECTION OF YOUR  *00140047
001500*  PROGRAM.                                                      *00150047
001600*                                                                *00160047
001700*  CODE THE FOLLOWING STATEMENTS IN YOUR PROGRAM WHENEVER YOU    *00170047
001800*  ARE INVOKING THE PROTEGRITY MODULE:                           *00180047
001900*                                                                *00190047
002000*    1. INTIALIZE THE PROTEGRITY CSI VARIABLES AND DPWS031       *00200053
002100*       LAYOUT VARIABLES.                                        *00210047
002200*    2. MOVE 'PPPPPPPP' TO DP031-PROGRAM-NAME.                   *00220047
002300*       (INSERT YOUR PROGRAM NAME HERE IN PLACE OF PPPPPPPP)     *00230047
002400*    3. MOVE '********' TO  DP031-FIELD.                         *00240047
002500*       (INSERT THE FIELD NAME HERE IN PLACE OF ********)        *00250047
002600*        EG: MOVE 'TNDR_ID' TO  DP031-FIELD.                     *00260047
002700*    4. SET AAAAA       TO TRUE.                                 *00270047
002800*       (INSERT CSI FUNCTION HERE IN PLACE OF AAAAA)             *00280047
002900*        EG: SET CSI-ENCRYPT-FUNCTION TO TRUE.                   *00290047
003000*    5. SET YYY         TO TRUE.                                 *00300047
003100*       (INSERT DATA ELEMENT VARIABLE HERE IN PLACE OF YYY)      *00310047
003200*        EG: SET DP031-IDNBR TO TRUE.                            *00320047
003300*    6. MOVE BBBBBB     TO DP031-CLEAR-TEXT.                     *00330047
003400*       -INCASE OF TOKENIZE OR ENCRYPT                           *00340047
003500*       MOVE CCCCCC     TO DP031-CIPHER-TEXT.                    *00350047
003600*       -INCASE OF DETOKENIZE OR DECRYPT                         *00360047
003700*    7. FOR TOKENIZE OR DETOKENIZATION MOVE THE LENGTH OF THE    *00370047
003800*       INPUT VARIABLE TO DP031-INPUT-LEN.                       *00380047
003900*    8. FOR ENCRYPT OR DECRYPT MOVE THE LENGTH OF CLEAR/CIPHER   *00390047
004000*       VARIABLES TO CSI-CLEAR-TEXT-LENGTH/CSI-CIPHER-TEXT-LENGTH*00400047
004100*                                                                *00410047
004200******************************************************************00420047
004300*  CALL THE PTYPCSL MODULE FOR TOKEN AND DE-TOKENIZATION         *00430047
004400******************************************************************00440047
004500 DP032-0000-PROTG-TOKEN-DETOKEN.                                  00450047
004600                                                                  00460047
004600     INITIALIZE DP013-MESSAGE-TABLE.                              00461055
004700     COMPUTE DP031-INPUT-LEN = DP031-INPUT-LEN + 4.               00470047
004800                                                                  00480047
004900     MOVE DP031-INPUT-LEN     TO CSI-CLEAR-TEXT-LENGTH.           00490047
005000     MOVE DP031-INPUT-LEN     TO CSI-CIPHER-TEXT-LENGTH.          00500047
005100     MOVE LOW-VALUES          TO DP031-CLEAR-KEYID                00510047
005200                                 DP031-CIPHER-KEYID.              00520047
005300     MOVE DP031-DATA-ELEMENT  TO CSI-DPS-DATA-ELEMENT.            00530047
005400                                                                  00540047
005500     CALL DP031-PROTEG-SUBRTN-PTYPCSL USING                       00551052
005600         CSI-FUNCTION                                             00560047
005700         CSI-CLEAR-TEXT-LENGTH                                    00570047
005800         DP031-CLEAR-DATA                                         00580047
005900         CSI-CIPHER-TEXT-LENGTH                                   00590047
006000         DP031-CIPHER-DATA                                        00600047
006100         CSI-DPS-DATA-ELEMENT                                     00610047
006200         CSI-RETURN-CODE                                          00620047
006300         CSI-REASON-CODE.                                         00630047
006400                                                                  00640047
006500     IF CSI-RETURN-CODE NOT = ZERO                                00650047
006600        MOVE CSI-RETURN-CODE  TO  DP031-RETURN-CODE               00660047
006700        MOVE CSI-REASON-CODE  TO  DP031-REASON-CODE               00670047
006800        STRING DP031-PROTEG-SUBRTN-PTYPCSL DELIMITED BY SIZE      00680047
006900               'ERROR: RC = '              DELIMITED BY SIZE      00690047
007000               DP031-RETURN-CODE           DELIMITED BY SIZE      00700047
007100               ', RS = '                   DELIMITED BY SIZE      00710047
007200               DP031-REASON-CODE           DELIMITED BY SIZE      00720047
007300                                 INTO DP013-MESSAGE-TEXT (1)      00730047
007400        IF CSI-ENCRYPT-FUNCTION                                   00740047
007500           STRING 'ERROR IN TOKENIZATION - '    DELIMITED BY SIZE 00750047
007600                  DP031-FIELD                   DELIMITED BY '  ' 00760047
007700                                      INTO DP013-MESSAGE-TEXT (2) 00770047
007800        ELSE                                                      00780047
007900           STRING 'ERROR IN DE-TOKENIZATION - ' DELIMITED BY SIZE 00790047
008000                  DP031-FIELD                   DELIMITED BY '  ' 00800047
008100                                      INTO DP013-MESSAGE-TEXT (2) 00810047
008200        END-IF                                                    00820047
008300        EVALUATE TRUE                                             00830047
008400           WHEN CSI-RETURN-CODE = DP031-RC-04 AND                 00840047
008500               (CSI-REASON-CODE = DP031-RS-ACCESS-DENIED1 OR      00850047
008600                CSI-REASON-CODE = DP031-RS-ACCESS-DENIED2)        00860047
008700                STRING DP031-DATA-ELEMENT   DELIMITED BY '  '     00870047
008800                ' - ACCESS DENIED '         DELIMITED BY SIZE     00880047
008900                                 INTO DP013-MESSAGE-TEXT (3)      00890047
009000           WHEN CSI-RETURN-CODE = DP031-RC-12 AND                 00900047
009100               (CSI-REASON-CODE = DP031-RS-DP-NOT-ACTIVE1 OR      00910047
009200                CSI-REASON-CODE = DP031-RS-DP-NOT-ACTIVE2)        00920047
009300                MOVE "DATA PROTECTOR NOT ACTIVE"                  00930047
009400                                 TO DP013-MESSAGE-TEXT (3)        00940047
009500           WHEN CSI-RETURN-CODE = DP031-RC-04 AND                 00950047
009600                CSI-REASON-CODE = DP031-RS-INCRCT-ELEMENT         00960047
009700                STRING DP031-DATA-ELEMENT   DELIMITED BY '  '     00970047
009800                ' - INCORRECT DATA ELEMENT' DELIMITED BY SIZE     00980047
009900                                 INTO DP013-MESSAGE-TEXT (3)      00990047
010000           WHEN CSI-RETURN-CODE = DP031-RC-04 AND                 01000047
010100                CSI-REASON-CODE = DP031-RS-INVALID-INPUT1         01010047
010200           WHEN CSI-RETURN-CODE = DP031-RC-12 AND                 01020047
010300                CSI-REASON-CODE = DP031-RS-INVALID-INPUT2         01030047
010400                MOVE "INVALID INPUT/INVALID INPUT LENGTH"         01040047
010500                                 TO DP013-MESSAGE-TEXT (3)        01050047
010600           WHEN CSI-RETURN-CODE = DP031-RC-08 AND                 01060047
010700               (CSI-REASON-CODE = DP031-RS-INP-LEN-ZERO1 OR       01070047
010800                CSI-REASON-CODE = DP031-RS-INP-LEN-ZERO2)         01080047
010900                MOVE "INPUT LENGTH ZERO"                          01090047
011000                                 TO DP013-MESSAGE-TEXT (3)        01100047
011100           WHEN OTHER                                             01110047
011200                CONTINUE                                          01120047
011300        END-EVALUATE                                              01130047
011400        SET DP013-LOGIC-ABEND TO TRUE                             01140047
011500        SET DP013-NO-ROLLBACK TO TRUE                             01150047
011600        MOVE "DP032-0000-PROTG-TOKEN-DETOKEN"                     01160047
011700                              TO DP013-PARAGRAPH                  01170047
011800        PERFORM DP013-0000-PROCESS-ABEND                          01180047
011900     END-IF.                                                      01190047
012000*                                                                 01200047
012100******************************************************************01210047
012200*  CALL THE PTYPSLL MODULE TO ENCRYPT AND DECRYPT                 01220047
012300******************************************************************01230047
012400 DP032-1000-PROTG-ENCRYP-DECRYP.                                  01240047
012500                                                                  01250047
012500     INITIALIZE DP013-MESSAGE-TABLE.                              01251054
012600     MOVE DP031-DATA-ELEMENT  TO CSI-DPS-DATA-ELEMENT.            01260047
012700                                                                  01270047
012800     CALL DP031-PROTEG-SUBRTN-PTYPSLL USING                       01280052
012900         CSI-FUNCTION                                             01290047
013000         CSI-CLEAR-TEXT-LENGTH                                    01300047
013100         DP031-CLEAR-TEXT                                         01310047
013200         CSI-CIPHER-TEXT-LENGTH                                   01320047
013300         DP031-CIPHER-TEXT                                        01330047
013400         CSI-DPS-DATA-ELEMENT                                     01340047
013500         CSI-RETURN-CODE                                          01350047
013600         CSI-REASON-CODE.                                         01360047
013700                                                                  01370047
013800     IF CSI-RETURN-CODE NOT = ZERO                                01380047
013900        MOVE CSI-RETURN-CODE  TO  DP031-RETURN-CODE               01390047
014000        MOVE CSI-REASON-CODE  TO  DP031-REASON-CODE               01400047
014100        STRING DP031-PROTEG-SUBRTN-PTYPSLL DELIMITED BY SIZE      01410047
014200               'ERROR: RC = '              DELIMITED BY SIZE      01420047
014300               DP031-RETURN-CODE           DELIMITED BY SIZE      01430047
014400               ', RS = '                   DELIMITED BY SIZE      01440047
014500               DP031-REASON-CODE           DELIMITED BY SIZE      01450047
014600                                 INTO DP013-MESSAGE-TEXT (1)      01460047
014700        IF CSI-ENCRYPT-FUNCTION                                   01470047
014800           STRING 'ERROR IN ENCRYPTION - '  DELIMITED BY SIZE     01480047
014900                  DP031-FIELD               DELIMITED BY '  '     01490047
015000                                   INTO DP013-MESSAGE-TEXT (2)    01500047
015100        ELSE                                                      01510047
015200           STRING 'ERROR IN DECRYPTION - '  DELIMITED BY SIZE     01520047
015300                  DP031-FIELD               DELIMITED BY '  '     01530047
015400                                   INTO DP013-MESSAGE-TEXT (2)    01540047
015500        END-IF                                                    01550047
015600        EVALUATE TRUE                                             01560047
015700           WHEN CSI-RETURN-CODE = DP031-RC-04 AND                 01570047
015800               (CSI-REASON-CODE = DP031-RS-ACCESS-DENIED1 OR      01580047
015900                CSI-REASON-CODE = DP031-RS-ACCESS-DENIED2)        01590047
016000                STRING DP031-DATA-ELEMENT   DELIMITED BY '  '     01600047
016100                ' - ACCESS DENIED '         DELIMITED BY SIZE     01610047
016200                                 INTO DP013-MESSAGE-TEXT (3)      01620047
016300           WHEN CSI-RETURN-CODE = DP031-RC-12 AND                 01630047
016400               (CSI-REASON-CODE = DP031-RS-DP-NOT-ACTIVE1 OR      01640047
016500                CSI-REASON-CODE = DP031-RS-DP-NOT-ACTIVE2)        01650047
016600                MOVE "DATA PROTECTOR NOT ACTIVE"                  01660047
016700                                 TO DP013-MESSAGE-TEXT (3)        01670047
016800           WHEN CSI-RETURN-CODE = DP031-RC-04 AND                 01680047
016900                CSI-REASON-CODE = DP031-RS-INCRCT-ELEMENT         01690047
017000                STRING DP031-DATA-ELEMENT   DELIMITED BY '  '     01700047
017100                ' - INCORRECT DATA ELEMENT' DELIMITED BY SIZE     01710047
017200                                 INTO DP013-MESSAGE-TEXT (3)      01720047
017300           WHEN CSI-RETURN-CODE = DP031-RC-04 AND                 01730047
017400                CSI-REASON-CODE = DP031-RS-INVALID-INPUT1         01740047
017500           WHEN CSI-RETURN-CODE = DP031-RC-12 AND                 01750047
017600                CSI-REASON-CODE = DP031-RS-INVALID-INPUT2         01760047
017700                MOVE "INVALID INPUT/INVALID INPUT LENGTH"         01770047
017800                                 TO DP013-MESSAGE-TEXT (3)        01780047
017900           WHEN CSI-RETURN-CODE = DP031-RC-12 AND                 01790047
018000               (CSI-REASON-CODE = DP031-RS-INP-TOO-SHORT)         01800047
018100                MOVE "INPUT TOO SHORT"                            01810047
018200                                 TO DP013-MESSAGE-TEXT (3)        01820047
018300           WHEN OTHER                                             01830047
018400                CONTINUE                                          01840047
018500        END-EVALUATE                                              01850047
018600        SET DP013-LOGIC-ABEND TO TRUE                             01860047
018700        SET DP013-NO-ROLLBACK TO TRUE                             01870047
018800        MOVE "DP032-1000-PROTG-ENCRYP-DECRYP"                     01880047
018900                              TO DP013-PARAGRAPH                  01890047
019000        PERFORM DP013-0000-PROCESS-ABEND                          01900047
019100     END-IF.                                                      01910047
019200*                                                                 01920047
