000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    APKUT381.                                         00040000
000500 AUTHOR.        BARB SCHULTZ.                                     00050000
000600 DATE-WRITTEN.  MARCH 2020.                                       00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*                                                               * 00090000
001000*           CREATE TRANSSOLUTION PRODUCT DOWNLOAD FILE          * 00100000
001100*                                                               * 00110000
001200* THE PURPOSE OF THIS PROGRAM IS TO CREATE A PRODUCT FILE FOR   * 00120000
001300* THE FREIGHT CLAIM SYSTEM USING ITEM EXTRACT FILES             * 00130000
001400*             PKMO.IM.ITEM.SKU.DOMAIN.EXTRACT      IMRD053      * 00140000
001500*             PKMO.IM.ITEM.SKU.LOC.DOMAIN.EXTRACT  IMRD057      * 00150000
001600*                                                               * 00160000
001610* THIS IS COPIED FROM FRKUT006                                  * 00161002
001620*---------------------------------------------------------------* 00162003
001630*                                                               * 00163003
001640* INPUT:                                                        * 00164003
001650*                                                               * 00165003
001660*  1. SKU                               (IMRD053)               * 00166003
001670*  2. SKU LOCATION                      (IMRD057)               * 00167003
001680*                                                               * 00168003
001690* OUTPUT:                                                       * 00169003
001700*                                                               * 00170003
001800*  1. FREIGHT CLAIM NEED                (APRD381)               * 00180003
001900*                                                               * 00190003
002000*---------------------------------------------------------------* 00200003
002100*  CHANGES:                                                     * 00210003
002200*                                                               * 00220003
002300*  DATE  03/11/2020                                             * 00230003
002400*      CHANGE MADE: INITIAL IMPLEMENTATION.                     * 00240003
002500*      MADE BY: BARB SCHULTZ            WR/IR #: CHG09?????     * 00250003
002600*                                                               * 00260003
002700*---------------------------------------------------------------* 00270003
002800 EJECT                                                            00280003
002900                                                                  00290003
003000 ENVIRONMENT DIVISION.                                            00300003
003100 CONFIGURATION SECTION.                                           00310003
003200 SOURCE-COMPUTER. IBM-3090.                                       00320003
003300 OBJECT-COMPUTER. IBM-3090.                                       00330003
003400                                                                  00340003
003500                                                                  00350003
003600 INPUT-OUTPUT SECTION.                                            00360003
003700 FILE-CONTROL.                                                    00370003
003800                                                                  00380003
003900     SELECT IM-SKU-FILE                ASSIGN TO UT-S-INP01.      00390003
004000     SELECT IM-SKU-LOC-FILE            ASSIGN TO UT-S-INP02.      00400003
004100     SELECT AP-CLAIM-NEED-FILE         ASSIGN TO UT-S-OUT01.      00410003
004200                                                                  00420003
004300 DATA DIVISION.                                                   00430003
004400 FILE SECTION.                                                    00440003
004500                                                                  00450003
004600 FD  IM-SKU-FILE                                                  00460003
004700     RECORDING MODE IS F                                          00470003
004800     BLOCK CONTAINS 0 CHARACTERS                                  00480003
004900     LABEL RECORDS ARE STANDARD                                   00490003
005000     DATA RECORD IS IM-SKU-RECORD.                                00500003
005100                                                                  00510003
005200 01  IM-SKU-RECORD                PIC X(500).                     00520003
005300                                                                  00530003
005400 FD  IM-SKU-LOC-FILE                                              00540003
005500     RECORDING MODE IS F                                          00550003
005600     BLOCK CONTAINS 0 CHARACTERS                                  00560003
005700     LABEL RECORDS ARE STANDARD                                   00570003
005800     DATA RECORD IS IM-SKU-LOC-RECORD.                            00580003
005900                                                                  00590003
006000 01  IM-SKU-LOC-RECORD            PIC X(173).                     00600003
006100                                                                  00610003
006200 FD  AP-CLAIM-NEED-FILE                                           00620003
006300     RECORDING MODE IS F                                          00630003
006400     BLOCK CONTAINS 0 CHARACTERS                                  00640003
006500     LABEL RECORDS ARE STANDARD                                   00650003
006600     DATA RECORD IS AP-CLAIM-NEED-RECORD.                         00660003
006700                                                                  00670003
006800 01  AP-CLAIM-NEED-RECORD         PIC X(50).                      00680003
006900                                                                  00690003
007000 EJECT                                                            00700003
007100 WORKING-STORAGE SECTION.                                         00710003
007200                                                                  00720003
007300 01  PC-PROGRAM-CONSTANTS.                                        00730003
007400     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                00740003
007500         '**** WORKING STORAGE ** APKUT381 ****'.                 00750003
007600                                                                  00760003
007700 01  PV-PROGRAM-VARIABLES.                                        00770003
007800     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      00780003
007900     05  PV-IM053-COUNT          PIC S9(9)     VALUE ZEROS        00790003
008000                                               COMP.              00800003
008100     05  PV-IM057-COUNT          PIC S9(9)     VALUE ZEROS        00810003
008200                                               COMP.              00820003
008300     05  PV-CLM-PRD-COUNT        PIC S9(9)     VALUE ZEROS        00830003
008400                                               COMP.              00840003
008500 01  PS-PROGRAM-SWITCHES.                                         00850003
008600     05  PS-END-IM053-SW         PIC  X(01)  VALUE ' '.           00860003
008700         88  PS-END-IM053                    VALUE 'Y'.           00870003
008800     05  PS-END-IM057-SW         PIC  X(01)  VALUE ' '.           00880003
008900         88  PS-END-IM057                    VALUE 'Y'.           00890003
009000                                                                  00900003
009100 01  HOLD-FIELDS.                                                 00910003
009200     05  HOLD-053-INTR-UPC-ID    PIC X(9).                        00920003
009300     05  HOLD-057-INTR-UPC-ID    PIC X(9).                        00930003
009400                                                                  00940003
009500 01  RUN-TIME.                                                    00950003
009600     05  R-HR                    PIC 99.                          00960003
009700     05  R-MIN                   PIC 99.                          00970003
009800     05  R-SEC                   PIC 99.                          00980003
009900     05  R-TH                    PIC 99.                          00990003
010000*                                                                 01000003
010100 01  DATE-IN.                                                     01010003
010200     05 DATE-IN-YY               PIC XX.                          01020003
010300     05 DATE-IN-MM               PIC XX.                          01030003
010400     05 DATE-IN-DD               PIC XX.                          01040003
010500                                                                  01050003
010600/                                                                 01060003
010700*                                                                 01070003
010800*    IM-SKU-RECORD.                                               01080003
010900*                                                                 01090003
011000     COPY IMRD053.                                                01100003
011100/                                                                 01110003
011200*                                                                 01120003
011300*    IM-SKU-LOC-RECORD.                                           01130003
011400*                                                                 01140003
011500     COPY IMRD057.                                                01150003
011600/                                                                 01160003
011700*    AP-CLAIM-NEED-RECORD.                                        01170003
011800*                                                                 01180003
011900     COPY APRD381.                                                01190003
012000/                                                                 01200003
012100*---------------------------------------------------------------- 01210003
012200*  ABEND DATA AREAS                                               01220003
012300*---------------------------------------------------------------- 01230003
012400                                                                  01240003
012500 01  ABEND-AREAS.                                                 01250003
012600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01260003
012700             '*****       ABEND'.                                 01270003
012800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01280003
012900             '*****   PROGRAM: APKUT381'.                         01290003
013000     05  AA-PARAGRAPH-LIT.                                        01300003
013100         10  FILLER              PIC  X(17)  VALUE                01310003
013200             '***** PARAGRAPH: '.                                 01320003
013300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01330003
013400     05  AA-MESSAGE-LINE.                                         01340003
013500         10  FILLER              PIC  X(06)  VALUE '*****'.       01350003
013600         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01360003
013700                                                                  01370003
013800/                                                                 01380003
013900 01  FILLER                      PIC  X(35)  VALUE                01390003
014000     '**** END OF W/S ** APKUT381 ****'.                          01400003
014100 EJECT                                                            01410003
014200 PROCEDURE DIVISION.                                              01420003
014300                                                                  01430003
014400     PERFORM A100-MAINLINE.                                       01440003
014500     GOBACK.                                                      01450003
014600                                                                  01460003
014700 EJECT                                                            01470003
014800 A100-MAINLINE.                                                   01480003
014900                                                                  01490003
015000     PERFORM B100-INITIALIZE.                                     01500003
015100                                                                  01510003
015200     PERFORM B200-PROCESS-FILES                                   01520003
015300       UNTIL PS-END-IM057                                         01530003
015400          OR PS-END-IM053.                                        01540003
015500                                                                  01550003
015600     PERFORM B300-END-OF-PROGRAM.                                 01560003
015700                                                                  01570003
015800 EJECT                                                            01580003
015900*---------------------------------------------------------------- 01590003
016000*    INITIALIZATION PROCESSING.                                   01600003
016100*---------------------------------------------------------------- 01610003
016200 B100-INITIALIZE.                                                 01620003
016300                                                                  01630003
016400     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              01640003
016500                                                                  01650003
016600     ACCEPT RUN-TIME FROM TIME.                                   01660003
016700     ACCEPT DATE-IN  FROM DATE.                                   01670003
016800                                                                  01680003
016900     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    01690003
017000                                                                  01700003
017100     OPEN INPUT  IM-SKU-FILE                                      01710003
017200                 IM-SKU-LOC-FILE                                  01720003
017300     OPEN OUTPUT AP-CLAIM-NEED-FILE.                              01730003
017400                                                                  01740003
017500     PERFORM R100-READ-IM057.                                     01750003
017600     PERFORM R300-READ-IM053.                                     01760003
017700                                                                  01770003
017800                                                                  01780003
017900 EJECT                                                            01790003
018000*---------------------------------------------------------------- 01800003
018100*    COMPARES THE UPC ON EACH INPUT FILE.  WHEN A MATCH IS FOUND  01810003
018200*    AN OUTPUT RECORD IS FORMATTED AND WRITTEN.                   01820003
018300*---------------------------------------------------------------- 01830003
018400 B200-PROCESS-FILES.                                              01840003
018500                                                                  01850003
018600     IF  HOLD-053-INTR-UPC-ID = HOLD-057-INTR-UPC-ID              01860003
018700         PERFORM D100-COMBINE-RECORD                              01870003
018800         PERFORM W100-WRITE-CLAIM-NEED                            01880003
018900         PERFORM R100-READ-IM057                                  01890003
019000         PERFORM R300-READ-IM053                                  01900003
019100     ELSE                                                         01910003
019200         IF  HOLD-053-INTR-UPC-ID > HOLD-057-INTR-UPC-ID          01920003
019300             PERFORM R100-READ-IM057                              01930003
019400         ELSE                                                     01940003
019500             IF  HOLD-057-INTR-UPC-ID > HOLD-053-INTR-UPC-ID      01950003
019600                 PERFORM R300-READ-IM053                          01960003
019700             END-IF                                               01970003
019800         END-IF                                                   01980003
019900     END-IF.                                                      01990003
020000                                                                  02000003
020100*          PERFORM D100-COMBINE-RECORD                            02010003
020200*          PERFORM W100-WRITE-CLAIM-NEED.                         02020003
020300                                                                  02030003
020400 EJECT                                                            02040003
020500*---------------------------------------------------------------- 02050003
020600*  END OF PROGRAM - DISPLAYS COUNTERS AND CLOSES FILES.           02060003
020700*---------------------------------------------------------------- 02070003
020800 B300-END-OF-PROGRAM.                                             02080003
020900                                                                  02090003
021000     DISPLAY 'PROGRAM APKUT381 RECORD COUNTS'.                    02100003
021100     DISPLAY '****************************'.                      02110003
021200     DISPLAY 'NBR OF IM057 RECS READ    = ' PV-IM057-COUNT.       02120003
021300     DISPLAY 'NBR OF IM053 RECS READ    = ' PV-IM053-COUNT.       02130003
021400     DISPLAY 'NBR OF AP381 RECS WRITTEN = ' PV-CLM-PRD-COUNT.     02140003
021500     DISPLAY '****************************'.                      02150003
021600     DISPLAY '** PROGRAM APKUT381 ENDS NORMALLY **'.              02160003
021700                                                                  02170003
021800     CLOSE IM-SKU-FILE                                            02180003
021900           IM-SKU-LOC-FILE                                        02190003
022000           AP-CLAIM-NEED-FILE.                                    02200003
022100                                                                  02210003
022200 EJECT                                                            02220003
022300*---------------------------------------------------------------- 02230003
022400*  MOVES ALL FIELDS NEEDED FOR TRANSSOLUTIONS NEED FILE           02240003
022500*---------------------------------------------------------------- 02250003
022600 D100-COMBINE-RECORD.                                             02260003
022700                                                                  02270003
022800     MOVE IM053-RMS-STYL-ID   TO AP381-RMS-STYL-ID.               02280003
022900     MOVE IM057-UNT-COST-AMT  TO AP381-057-UNIT-COST.             02290003
023000     MOVE IM057-INTR-UPC-ID   TO AP381-INTR-UPC-ID.               02300003
023100                                                                  02310003
023200 EJECT                                                            02320003
023300*---------------------------------------------------------------- 02330003
023400*  READS THE SKU LOCATION DOMAIN EXTRACT FILE  (IM057).           02340003
023500*---------------------------------------------------------------- 02350003
023600 R100-READ-IM057.                                                 02360003
023700                                                                  02370003
023800     READ IM-SKU-LOC-FILE INTO IM057-ITEM-SKU-LOC-DOMAIN-REC      02380003
023900         AT END                                                   02390003
024000             SET PS-END-IM057 TO TRUE.                            02400003
024100                                                                  02410003
024200     IF  PS-END-IM057                                             02420003
024300         MOVE HIGH-VALUES TO HOLD-057-INTR-UPC-ID                 02430003
024400     ELSE                                                         02440003
024500         ADD +1 TO PV-IM057-COUNT                                 02450003
024600         MOVE IM057-INTR-UPC-ID TO HOLD-057-INTR-UPC-ID           02460003
024700     END-IF.                                                      02470003
024800                                                                  02480003
024900 EJECT                                                            02490003
025000*---------------------------------------------------------------- 02500003
025100*  READS THE SKU DOMAIN EXTRACT FILE  (IM053).                    02510003
025200*---------------------------------------------------------------- 02520003
025300 R300-READ-IM053.                                                 02530003
025400                                                                  02540003
025500     READ IM-SKU-FILE INTO IM053-ITEM-SKU-DOMAIN-REC              02550003
025600         AT END                                                   02560003
025700             SET PS-END-IM053 TO TRUE.                            02570003
025800                                                                  02580003
025900     IF  PS-END-IM053                                             02590003
026000         MOVE HIGH-VALUES TO HOLD-053-INTR-UPC-ID                 02600003
026100     ELSE                                                         02610003
026200         ADD +1 TO PV-IM053-COUNT                                 02620003
026300         MOVE IM053-INTR-UPC-ID TO HOLD-053-INTR-UPC-ID           02630003
026400     END-IF.                                                      02640003
026500                                                                  02650003
026600 EJECT                                                            02660003
026700*---------------------------------------------------------------- 02670003
026800*  WRITES OUT THE SINGLE COMBINED RECORD FROM ALL THREE           02680003
026900*  INPUT FILES HAVING MATCHED KEYS                                02690003
027000*---------------------------------------------------------------- 02700003
027100 W100-WRITE-CLAIM-NEED.                                           02710003
027200                                                                  02720003
027300     WRITE AP-CLAIM-NEED-RECORD FROM AP381-CLAIM-NEED-RECORD.     02730003
027400                                                                  02740003
027500     ADD 1 TO PV-CLM-PRD-COUNT.                                   02750003
027600                                                                  02760003
027700                                                                  02770003
027800 EJECT                                                            02780003
027900*---------------------------------------------------------------- 02790003
028000*    ABEND ROUTINE FOR DB2 ERRORS.                                02800003
028100*---------------------------------------------------------------- 02810003
028200 Z999-DB2-ABEND.                                                  02820003
028300                                                                  02830003
028400     CLOSE IM-SKU-FILE                                            02840003
028500           IM-SKU-LOC-FILE                                        02850003
028600           AP-CLAIM-NEED-FILE.                                    02860003
028700                                                                  02870003
028800     DISPLAY AA-ABEND-LIT.                                        02880003
028900     DISPLAY AA-PROGRAM-LIT.                                      02890003
029000     DISPLAY AA-PARAGRAPH-LIT.                                    02900003
029100                                                                  02910003
