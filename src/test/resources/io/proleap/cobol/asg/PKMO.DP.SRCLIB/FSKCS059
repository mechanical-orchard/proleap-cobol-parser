00001 *-----------------------*                                         06/13/94
00002  IDENTIFICATION DIVISION.                                         FSKCS059
00003 *-----------------------*                                            LV013
00004  PROGRAM-ID.    FSKCS059.                                         FSKCS059
00005  AUTHOR.        DAVE METZGER - KOHLS.                             FSKCS059
00006  DATE-WRITTEN.  03/97.                                            FSKCS059
00007 *---------------------------------------------------------------* FSKCS059
00008 *    F059 - VENDOR/DEPARTMENT LIST PROGRAM - CLONE OF VNKCS003  * FSKCS059
00009 *                                                               * FSKCS059
00010 *    THIS PROGRAM GENERATES A LIST OF VENDORS FOR THE SPECIFIC  * FSKCS059
00011 *    DEPARTMENT AND/OR NAME ENTERED.                            * FSKCS059
00012 *                                                               * FSKCS059
00940 *  MODIFIED BY L. MOYER - 03/23/99.                             *         
00012 *  UPDATED LOGIC SO THAT IF TWO ITEMS ARE SELECTED AND THE ERROR* FSKCS059
00012 *  MESSAGE IS DISPLAYED, THE CLIENT CAN DELETE ONE SELECTION    * FSKCS059
00012 *  AND THE CORRECT SELECTION IS RETURNED.  (P3300)              * FSKCS059
00013 *---------------------------------------------------------------* FSKCS059
JP0500***************************************************************** FSKCS059
JP0500*  WORK REQUEST WR21087                                         * FSKCS059
JP0500*  MODIFIED BY JOHN PRICE 05/30/00.                             * FSKCS059
JP0500*  ADDED LOGIC AND ALL ASSOCIATED CODE TO CREATE A SECONDARY    * FSKCS059
JP0500*  VENDOR CURSOR PATH WHEN THE VENDOR NAME IS NOT ENTERED ON THE* FSKCS059
JP0500*  PRIOR (PREREQUISITE) SCREEN(S)                               * FSKCS059
JP0500*   1). SWITCH, 2). DECLARE CURSOR, 3). PROCEDURE DIVISION CODE * FSKCS059
JP0500***************************************************************** FSKCS059
272945* 08/05/2022  JIM HUNTER    CHANGE CALL OF DPKUT100 TO          *         
272945*                           CALL DP010I-NUMERIC-EDIT-ROUTINE    *         
272945*                           MAKING THE CALL DYNAMIC VS STATIC   *         
272945*                           CHG0272945                          *         
1022RM* 10/25/2022  BOB MCASEY    CHANGE PARAMETERS FOR CALLING THE   *         
1022RM*                           CICS ARCHITECTURE API.  ADDED       *         
1022RM*                           DPKCS930 COPYBOOK.                  *         
1022RM*                           CHG0                                *         
272945***************************************************************** FSKCS059
00014  ENVIRONMENT DIVISION.                                            FSKCS059
00015  DATA DIVISION.                                                   FSKCS059
00016                                                                   FSKCS059
00017  WORKING-STORAGE SECTION.                                         FSKCS059
00018                                                                   FSKCS059
00019  01  DK-DB2-KEY.                                                  FSKCS059
00021      05  DK-DEPT-LOW                    PIC  X(03)  VALUE SPACE.  FSKCS059
00021      05  DK-DEPT-HIGH                   PIC  X(03)  VALUE SPACE.  FSKCS059
00021      05  DK-VEND-NAME                   PIC  X(30)  VALUE SPACE.  FSKCS059
00022      05  DK-VEND-NAME-BYTE              REDEFINES DK-VEND-NAME    FSKCS059
00023                                         OCCURS 30 TIMES           FSKCS059
00024                                         PIC  X(01).               FSKCS059
00025      05  DK-PRIM-NAME                   PIC  X(30).               FSKCS059
00025      05  DK-VEND-TYPE-CDE               PIC  X(02).               FSKCS059
00026                                                                   FSKCS059
00027  01  PC-PROGRAM-CONSTANTS.                                        FSKCS059
00028      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         FSKCS059
00029                                                     'FS059A  '.   FSKCS059
00030      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         FSKCS059
00031                                                     'FSKM059 '.   FSKCS059
00032      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         FSKCS059
00033                                                     'FSKCS059'.   FSKCS059
00034      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      FSKCS059
00035      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      FSKCS059
00036      05  PC-FS-COLOR-SIZE-FORMAT        PIC  X(01)  VALUE '2'.    FSKCS059
00036      05  PC-FS-CRIT-SPEC-FORMAT         PIC  X(01)  VALUE '5'.    FSKCS059
00037      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     FSKCS059
00038                                                     COMP SYNC.    FSKCS059
00039      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      FSKCS059
00040                                                     COMP SYNC.    FSKCS059
00041      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         FSKCS059
00042                                                     +1000000      FSKCS059
00043                                                     COMP-3.       FSKCS059
00044      05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      FSKCS059
00045                                                     COMP SYNC.    FSKCS059
00046      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       FSKCS059
00047                                                     COMP-3.       FSKCS059
00048      05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  FSKCS059
00049      05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  FSKCS059
00050      05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  FSKCS059
00051      05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  FSKCS059
00052      05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    FSKCS059
00053      05  PC-TYPE-CODES.                                           FSKCS059
00054          10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   FSKCS059
00055          10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   FSKCS059
00056          10  PC-LABEL                   PIC  X(02)  VALUE '03'.   FSKCS059
00057          10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   FSKCS059
00058                                                                   FSKCS059
00059      05  PC-TSYMSG-NUMBERS.                                       FSKCS059
00060          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  FSKCS059
00061          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  FSKCS059
00068          10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  FSKCS059
00062          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  FSKCS059
00063          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  FSKCS059
00064          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  FSKCS059
00065          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  FSKCS059
00066          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  FSKCS059
00067          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  FSKCS059
00067          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  FSKCS059
00069          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  FSKCS059
00070          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  FSKCS059
00071          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  FSKCS059
00072          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  FSKCS059
00073          10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  FSKCS059
00074                                                                   FSKCS059
00075  01  PS-PROGRAM-SWITCHES.                                         FSKCS059
00076      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    FSKCS059
00077          88  PS-NO-ERROR                            VALUE 'Y'.    FSKCS059
00078          88  PS-ERROR                               VALUE 'N'.    FSKCS059
00079      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    FSKCS059
00080          88  PS-COMMAREA-VALID                      VALUE 'Y'.    FSKCS059
00081          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    FSKCS059
00082      05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    FSKCS059
00083          88  PS-DONE                                VALUE 'Y'.    FSKCS059
00084          88  PS-NOT-DONE                            VALUE 'N'.    FSKCS059
JP0500     05  PS-READ-CURSOR-SW              PIC  X(01)  VALUE 'N'.    FSKCS059
JP0500         88  PS-READ-CURSOR                         VALUE 'Y'.    FSKCS059
JP0500         88  PS-READ-CURSOR-DONE                    VALUE 'N'.    FSKCS059
00086                                                                   FSKCS059
00086  01  PL-PROGRAM-LITERALS.                                         FSKCS059
00087      05  PL-PRIMARY                     PIC  X(10)  VALUE         FSKCS059
00088                                                     'PRIMARY   '. FSKCS059
00089      05  PL-ALIAS                       PIC  X(10)  VALUE         FSKCS059
00090                                                     'ALIAS     '. FSKCS059
00091      05  PL-LABEL                       PIC  X(10)  VALUE         FSKCS059
00092                                                     'LABEL     '. FSKCS059
00093      05  PL-SHORTNAME                   PIC  X(10)  VALUE         FSKCS059
00094                                                     'SHORT NAME'. FSKCS059
00095                                                                   FSKCS059
00096  01  PV-PROGRAM-VARIABLES.                                        FSKCS059
00097      05  PV-SUB                         PIC S9(04)  VALUE +0      FSKCS059
00098                                                     COMP SYNC.    FSKCS059
00099      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      FSKCS059
00100                                                     COMP SYNC.    FSKCS059
00101      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      FSKCS059
00102                                                     COMP-3.       FSKCS059
00103      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      FSKCS059
00104                                                     COMP-3.       FSKCS059
00105      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      FSKCS059
00106                                                     COMP-3.       FSKCS059
00107      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      FSKCS059
00108                                                     COMP-3.       FSKCS059
00109      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      FSKCS059
00110                                                     COMP-3.       FSKCS059
00111      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      FSKCS059
00112                                                     COMP-3.       FSKCS059
00113      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      FSKCS059
00114                                                     COMP-3.       FSKCS059
00115      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      FSKCS059
00116                                                     COMP SYNC.    FSKCS059
00117      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      FSKCS059
00118                                                     COMP SYNC.    FSKCS059
00119      05  PV-ITEM                        PIC S9(04)  VALUE +0      FSKCS059
00120                                                     COMP SYNC.    FSKCS059
00121      05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      FSKCS059
00122                                                     COMP SYNC.    FSKCS059
00123      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      FSKCS059
00124                                                     COMP SYNC.    FSKCS059
00125      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      FSKCS059
00126                                                     COMP SYNC.    FSKCS059
00127      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      FSKCS059
00128                                                     COMP SYNC.    FSKCS059
00129      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      FSKCS059
00130                                                     COMP SYNC.    FSKCS059
00131      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      FSKCS059
00132                                                     COMP SYNC.    FSKCS059
00133      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      FSKCS059
00134                                                     COMP SYNC.    FSKCS059
00135      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      FSKCS059
00136                                                     COMP SYNC.    FSKCS059
00137      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      FSKCS059
00138                                                     COMP SYNC.    FSKCS059
00139      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      FSKCS059
00140                                                     COMP SYNC.    FSKCS059
00141      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      FSKCS059
00142                                                     COMP SYNC.    FSKCS059
00143      05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      FSKCS059
00144                                                     COMP SYNC.    FSKCS059
00145      05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      FSKCS059
00146                                                     COMP SYNC.    FSKCS059
00147 ******************************************************************FSKCS059
00148 **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **FSKCS059
00149 **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **FSKCS059
00150 **  APPLICATION-SPECIFIC COMMAREA.                              **FSKCS059
00151 ******************************************************************FSKCS059
00152  01  LQW-LIST-QUEUE-WORK-AREA.                                    FSKCS059
00153      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  FSKCS059
00154      05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           FSKCS059
00155                                         INDEXED BY LQW-IDX.       FSKCS059
00156          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       FSKCS059
00157          10  LQW-TEMP-SELECTED-SW       PIC  X(01).               FSKCS059
00158          10  LQW-SELECTED-SW            PIC  X(01).               FSKCS059
00159              88  LQW-SELECT                         VALUE 'S'.    FSKCS059
00160              88  LQW-DESELECT                       VALUE ' '.    FSKCS059
00161          10  LQW-ACTION                 PIC  X(03).               FSKCS059
00162          10  LQW-VEND-TYPE              PIC  X(01).                  CL**2
00163          10  LQW-VEND-NAME              PIC  X(30).                  CL**2
00164          10  LQW-TYPE-CDE               PIC  X(02).               FSKCS059
00165          10  LQW-PRM-NME                PIC  X(24).               FSKCS059
00166          10  LQW-ENT-ID                 PIC S9(09)  COMP.         FSKCS059
00167                                                                   FSKCS059
00168 *---------------------------------------------------------------* FSKCS059
00169 *  RECORD LAYOUT FOR THE VENDOR  SELECTION TEMP STORAGE QUEUE.  * FSKCS059
00170 *---------------------------------------------------------------* FSKCS059
00171      COPY VNWS003.                                                   CL*13
00172                                                                   FSKCS059
00173 *---------------------------------------------------------------* FSKCS059
00174 *    MAP LAYOUT                                                 * FSKCS059
00175 *---------------------------------------------------------------* FSKCS059
00176      COPY FSKM059.                                                FSKCS059
00177                                                                   FSKCS059
00178  01  MR-OCCURS-LAYOUT                   REDEFINES  FS059AO.       FSKCS059
00179      05  FILLER                         PIC X(48).                FSKCS059
00180      05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          FSKCS059
00181          10  MR-SELECTL                 PIC S9(04) COMP.          FSKCS059
00182          10  MR-SELECTA                 PIC  X(01).               FSKCS059
00183          10  MR-SELECTC                 PIC  X(01).               FSKCS059
00184          10  MR-SELECTH                 PIC  X(01).               FSKCS059
00185          10  MR-SELECTI                 PIC  X(01).               FSKCS059
00186                                                                   FSKCS059
00187          10  MR-ACTIONL                 PIC S9(04) COMP.          FSKCS059
00188          10  MR-ACTIONA                 PIC  X(01).               FSKCS059
00189          10  MR-ACTIONC                 PIC  X(01).               FSKCS059
00190          10  MR-ACTIONH                 PIC  X(01).               FSKCS059
00191          10  MR-ACTION                  PIC  X(03).               FSKCS059
00192                                                                   FSKCS059
00199          10  MR-VEND-NAMEL              PIC S9(04) COMP.          FSKCS059
00200          10  MR-VEND-NAMEA              PIC  X(01).               FSKCS059
00201          10  MR-VEND-NAMEC              PIC  X(01).               FSKCS059
00202          10  MR-VEND-NAMEH              PIC  X(01).               FSKCS059
00203          10  MR-VEND-NAME               PIC  X(30).                  CL**2
00204                                                                   FSKCS059
00205          10  MR-TYPE-DSCL               PIC S9(04) COMP.          FSKCS059
00206          10  MR-TYPE-DSCA               PIC  X(01).               FSKCS059
00207          10  MR-TYPE-DSCC               PIC  X(01).               FSKCS059
00208          10  MR-TYPE-DSCH               PIC  X(01).               FSKCS059
00209          10  MR-TYPE-DSC                PIC  X(10).               FSKCS059
00210                                                                   FSKCS059
00211          10  MR-PRM-NMEL                PIC S9(04) COMP.          FSKCS059
00212          10  MR-PRM-NMEA                PIC  X(01).               FSKCS059
00213          10  MR-PRM-NMEC                PIC  X(01).               FSKCS059
00214          10  MR-PRM-NMEH                PIC  X(01).               FSKCS059
00215          10  MR-PRM-NME                 PIC  X(24).               FSKCS059
00216                                                                   FSKCS059
00217 *---------------------------------------------------------------* FSKCS059
00218 *    ATTRIBUTE SETTINGS COPYBOOK.                               * FSKCS059
00219 *---------------------------------------------------------------* FSKCS059
00220      COPY DPWS015.                                                FSKCS059
00221                                                                   FSKCS059
00222 *---------------------------------------------------------------* FSKCS059
00223 *    FUNCTION KEYS COPYBOOK.                                    * FSKCS059
00224 *---------------------------------------------------------------* FSKCS059
00225      COPY DPWS016.                                                FSKCS059
00226                                                                   FSKCS059
00227 *---------------------------------------------------------------* FSKCS059
00228 *    NUMERIC EDIT LAYOUT.                                       * FSKCS059
00229 *---------------------------------------------------------------* FSKCS059
00230      COPY DPWS010I.                                               FSKCS059
00231                                                                   FSKCS059
00232 *---------------------------------------------------------------* FSKCS059
00233 *    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * FSKCS059
00234 *---------------------------------------------------------------* FSKCS059
00235      COPY DPWS030.                                                FSKCS059
1022RM     COPY DPWS930.                                                FSKCS059
00236                                                                   FSKCS059
00237 *---------------------------------------------------------------* FSKCS059
00238 *    STANDARD COMMAREA.                                         * FSKCS059
00239 *---------------------------------------------------------------* FSKCS059
00240      COPY DPWS020.                                                FSKCS059
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
00247          10  INTER-APPL-COMMAREA        PIC X(200).               FSKCS059
00013          10  CA-FASHION-SALES-COMMAREA REDEFINES                  FSWS000 
00014              INTER-APPL-COMMAREA        PIC X(200).               FSWS000 
00249      COPY FSWS000.                                                FSKCS059
00249      COPY FSWS007.                                                FSKCS059
00250 *---------------------------------------------------------------* FSKCS059
00251 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * FSKCS059
00252 *---------------------------------------------------------------* FSKCS059
00253          10  ASC-SPECIFIC-COMMAREA.                               FSKCS059
00254              15  ASC-LIST-KEYS.                                   FSKCS059
00255                  20  ASC-KEY-DEPT-NMBR               PIC  X(03).  FSKCS059
00255                  20  ASC-KEY-VEND-NAME               PIC  X(30).  FSKCS059
00256                  20  ASC-KEY-VEND-TYPE               PIC  X(02).     CL**3
00257                  20  ASC-KEY-STATUS-CODE             PIC  X(01).  FSKCS059
00258              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                FSKCS059
00259                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  FSKCS059
00260                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   FSKCS059
00261                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   FSKCS059
00262                                                                   FSKCS059
00263                  20  ASC-ITEM-ARRAY.                              FSKCS059
00264                      25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        FSKCS059
00265                          30  ASC-LIST-ITEM-NUMBER                 FSKCS059
00266                                                      PIC S9(09)   FSKCS059
00267                                                      COMP-3.      FSKCS059
00268                          30  ASC-TEMP-SELECTED-SW    PIC  X(01).  FSKCS059
00269                              88  ASC-VALID-SELECT    VALUE ' '    FSKCS059
00270                                                            'S'    FSKCS059
00271                                                            'B'    FSKCS059
00272                                                            'E'.   FSKCS059
00273                              88  ASC-TEMP-NO-SELECT  VALUE ' '.   FSKCS059
00274                              88  ASC-TEMP-SELECT     VALUE 'S'.   FSKCS059
00275                              88  ASC-TEMP-BEGIN      VALUE 'B'.   FSKCS059
00276                              88  ASC-TEMP-END        VALUE 'E'.   FSKCS059
00277                          30  ASC-SELECTED-SW         PIC  X(01).  FSKCS059
00278                              88  ASC-NO-SELECT       VALUE ' '.   FSKCS059
00279                              88  ASC-SELECT          VALUE 'S'.   FSKCS059
00280                              88  ASC-BEGIN           VALUE 'B'.   FSKCS059
00281                              88  ASC-END             VALUE 'E'.   FSKCS059
00282                          30  ASC-ACTION              PIC  X(03).  FSKCS059
00283                          30  ASC-VEND-TYPE           PIC  X(02).     CL**2
00284                          30  ASC-VEND-NAME           PIC  X(30).     CL**2
00285                          30  ASC-TYPE-CDE            PIC  X(02).  FSKCS059
00286                          30  ASC-PRM-NME             PIC  X(24).  FSKCS059
00287                          30  ASC-ENT-ID              PIC S9(09)   FSKCS059
00288                                                      COMP.        FSKCS059
00289                                                                   FSKCS059
00290              15  ASC-BLK-SUB                         PIC S9(04)   FSKCS059
00291                                                           COMP    FSKCS059
00292                                                           SYNC.   FSKCS059
00293              15  ASC-ITEM-SUB                        PIC S9(04)   FSKCS059
00294                                                           COMP    FSKCS059
00295                                                           SYNC.   FSKCS059
00296              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   FSKCS059
00297                                                           COMP-3. FSKCS059
00298              15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   FSKCS059
00299                                                           COMP-3. FSKCS059
00300              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   FSKCS059
00301                                                           COMP-3. FSKCS059
00302              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   FSKCS059
00303                                                           COMP-3. FSKCS059
00304              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   FSKCS059
00305                                                           COMP-3. FSKCS059
00306              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   FSKCS059
00307                                                           COMP    FSKCS059
00308                                                           SYNC.   FSKCS059
00309              15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   FSKCS059
00310                                                           COMP-3. FSKCS059
00311              15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   FSKCS059
00312                                                           COMP-3. FSKCS059
00313              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  FSKCS059
00314                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   FSKCS059
00315                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   FSKCS059
00316              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  FSKCS059
00317                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   FSKCS059
00318                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   FSKCS059
00319              15  ASC-LIST-QUEUE-NAME.                             FSKCS059
00320                  20  ASC-LIST-TERM-ID                PIC  X(04).  FSKCS059
00321                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   FSKCS059
00322                                                           COMP-3. FSKCS059
00323                  20  ASC-LIST-SEQ                    PIC  9(01).  FSKCS059
00324              15  ASC-SEL-QUEUE-NAME.                              FSKCS059
00325                  20  ASC-SEL-TERM-ID                 PIC  X(04).  FSKCS059
00326                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)   FSKCS059
00327                                                           COMP-3. FSKCS059
00328                  20  ASC-SEL-SEQ                     PIC  9(01).  FSKCS059
00329                                                                   FSKCS059
00330              15  ASC-START-ITEM-REQUEST.                          FSKCS059
00331                  20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  FSKCS059
00332              15  ASC-SAVE-INPUT                      PIC  X(200). FSKCS059
00333                                                                   FSKCS059
00334 *---------------------------------------------------------------* FSKCS059
00335 *    ABEND PROCESSING COPYBOOK.                                 * FSKCS059
00336 *---------------------------------------------------------------* FSKCS059
00337      COPY DPWS013.                                                FSKCS059
00338                                                                   FSKCS059
00339 *---------------------------------------------------------------* FSKCS059
00340 *    DB2 AREA FOR VENDOR DEPT TABLE                             * FSKCS059
00341 *---------------------------------------------------------------* FSKCS059
00342      EXEC SQL                                                     FSKCS059
00343           INCLUDE TVNDDPT                                         FSKCS059
00344      END-EXEC.                                                    FSKCS059
00345                                                                   FSKCS059
00339 *---------------------------------------------------------------* FSKCS059
00340 *    DB2 AREA FOR ENTERPRISE NAME                               * FSKCS059
00341 *---------------------------------------------------------------* FSKCS059
00342      EXEC SQL                                                     FSKCS059
00343           INCLUDE TENTNME                                         FSKCS059
00344      END-EXEC.                                                    FSKCS059
00345                                                                   FSKCS059
00346 *---------------------------------------------------------------* FSKCS059
00347 *    DB2 AREA FOR EXTERNAL ENTERPRISE                           * FSKCS059
00348 *---------------------------------------------------------------* FSKCS059
00349      EXEC SQL                                                     FSKCS059
00350           INCLUDE TEXTENT                                         FSKCS059
00351      END-EXEC.                                                    FSKCS059
00352                                                                   FSKCS059
00353 *---------------------------------------------------------------* FSKCS059
00354 *    DB2 AREA FOR COMMUNICATIONS                                * FSKCS059
00355 *---------------------------------------------------------------* FSKCS059
00356      EXEC SQL                                                     FSKCS059
00357           INCLUDE SQLCA                                           FSKCS059
00358      END-EXEC.                                                    FSKCS059
00359                                                                   FSKCS059
00360 *---------------------------------------------------------------* FSKCS059
00361 *    VENDOR CURSOR WHEN VENDOR NAME IS ENTERED                  * FSKCS059
00362 *---------------------------------------------------------------* FSKCS059
00363      EXEC SQL                                                     FSKCS059
00364           DECLARE VENDOR-CSR CURSOR FOR                           FSKCS059
00365            SELECT DISTINCT                                           CL**2
00365                   A.ENT_ID                                           CL**2
00366                  ,A.ENT_NAME_DESC                                    CL**2
00367                  ,A.TYPE_CDE                                         CL**2
00368                  ,B.MDSE_VENDOR_IND                                  CL**3
00369                  ,B.CARRIER_IND                                      CL**3
00370                  ,B.EXP_VEND_IND                                     CL**3
00371              FROM TENTNME A                                          CL**2
00372                  ,TEXTENT B                                          CL**2
00372                  ,TVNDDPT C                                          CL**2
00373             WHERE A.ENT_ID           =  B.ENT_ID                     CL**2
00374               AND B.ENT_ID           =  C.ENT_ID                     CL**3
00373               AND A.ENT_NAME_DESC LIKE :DK-VEND-NAME                 CL**2
                    AND (C.DEPT_NBR BETWEEN   :DK-DEPT-LOW                      
                                         AND :DK-DEPT-HIGH)                     
00375               AND B.STATUS_CDE       = 'A'                           CL**3
00375               AND A.TYPE_CDE         IN ('01','04')                  CL**3
00376          ORDER BY A.ENT_NAME_DESC                                    CL**2
00377                  ,A.TYPE_CDE                                         CL**2
00378      END-EXEC.                                                    FSKCS059
00359                                                                   FSKCS059
JP0500*---------------------------------------------------------------* FSKCS059
JP0500*    NEW VENDOR CURSOR WHEN VENDOR NAME IS NOT ENTERED          * FSKCS059
JP0500*---------------------------------------------------------------* FSKCS059
JP0500     EXEC SQL                                                     FSKCS059
JP0500          DECLARE VENDOR-CSRA CURSOR FOR                          FSKCS059
JP0500           SELECT DISTINCT                                           CL**2
JP0500                  A.ENT_ID                                           CL**2
JP0500                 ,A.ENT_NAME_DESC                                    CL**2
JP0500                 ,A.TYPE_CDE                                         CL**2
JP0500                 ,B.MDSE_VENDOR_IND                                  CL**3
JP0500                 ,B.CARRIER_IND                                      CL**3
JP0500                 ,B.EXP_VEND_IND                                     CL**3
JP0500             FROM TENTNME A                                          CL**2
JP0500                 ,TEXTENT B                                          CL**2
JP0500                 ,TVNDDPT C                                          CL**2
JP0500            WHERE A.ENT_ID           =  B.ENT_ID                     CL**2
JP0500              AND B.ENT_ID           =  C.ENT_ID                     CL**3
JP0500              AND (C.DEPT_NBR BETWEEN   :DK-DEPT-LOW                      
JP0500                                   AND :DK-DEPT-HIGH)                     
JP0500              AND B.STATUS_CDE       = 'A'                           CL**3
JP0500              AND A.TYPE_CDE         IN ('01','04')                  CL**3
JP0500         ORDER BY A.ENT_NAME_DESC                                    CL**2
JP0500                 ,A.TYPE_CDE                                         CL**2
JP0500     END-EXEC.                                                    FSKCS059
  379                                                                   FSKCS059
00380  LINKAGE SECTION.                                                 FSKCS059
00381                                                                   FSKCS059
00382  01  DFHCOMMAREA.                                                 FSKCS059
00383      05  FILLER                         OCCURS  1 TO 4072 TIMES   FSKCS059
00384                                         DEPENDING ON EIBCALEN.    FSKCS059
00385          10  FILLER                     PIC X.                    FSKCS059
00386                                                                   FSKCS059
00387  PROCEDURE DIVISION.                                              FSKCS059
00388                                                                      CL**6
00389      INITIALIZE DP030-CICS-API-FIELDS.                            FSKCS059
00390      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       FSKCS059
00391      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          FSKCS059
00392      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         FSKCS059
00393      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       FSKCS059
00394      MOVE LENGTH OF FS059AI        TO DP030-MAP-LENGTH (1).       FSKCS059
00395      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     FSKCS059
00396                                                                      CL**6
00397      PERFORM 0001-CALL-CICS-ARCH-API.                             FSKCS059
00398                                                                   FSKCS059
00399      PERFORM 1000-CONTROL-PROCESSING                              FSKCS059
00400                                                                   FSKCS059
00401      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     FSKCS059
00402                                                                      CL**6
00403      PERFORM 0001-CALL-CICS-ARCH-API.                             FSKCS059
00404                                                                   FSKCS059
00405 ******************************************************************FSKCS059
00406 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **FSKCS059
00407 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **FSKCS059
00408 ******************************************************************FSKCS059
00409  0001-CALL-CICS-ARCH-API.                                         FSKCS059
00410                                                                   FSKCS059
00411      CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     FSKCS059
00412                                      DFHCOMMAREA                  FSKCS059
00413                                      DP030-CICS-API-FIELDS        FSKCS059
00414                                      DP020-STANDARD-COMMAREA      FSKCS059
00415                                      FS059AI.                     FSKCS059
00416                                                                   FSKCS059
00417      IF DP030-RC-CALL-SUCCESSFUL                                     CL**6
00418          CONTINUE                                                 FSKCS059
00419      ELSE                                                         FSKCS059
00420          SET DP013-NO-ROLLBACK                                    FSKCS059
00421              DP013-XCTL-DISPLAY-RESTART                           FSKCS059
00422              DP013-CICS-ABEND      TO TRUE                        FSKCS059
00423          MOVE '0001-CALL-CICS-ARCH-API'                           FSKCS059
00424                                    TO DP013-PARAGRAPH             FSKCS059
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
00427          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      FSKCS059
00428          PERFORM DP013-0000-PROCESS-ABEND.                        FSKCS059
00429                                                                   FSKCS059
00430 *----------------------------------------------------------------*FSKCS059
00431 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *FSKCS059
00432 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *FSKCS059
00433 *----------------------------------------------------------------*FSKCS059
00434  1000-CONTROL-PROCESSING.                                         FSKCS059
00435                                                                   FSKCS059
00436      EVALUATE TRUE                                                FSKCS059
00437          WHEN DP020-NEXT-ACT-INITIAL                              FSKCS059
00438              INITIALIZE ASC-SPECIFIC-COMMAREA                     FSKCS059
00439              MOVE EIBTRMID              TO ASC-LIST-TERM-ID          CL**6
00440                                            ASC-SEL-TERM-ID           CL**6
00441              MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER      CL**6
00442                                            ASC-SEL-TASK-NUMBER       CL**6
00443              MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ              CL**6
00444              MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ               CL**6
00445                                                                      CL**6
00446              PERFORM 1100-PROCESS-INTER-APPL-COMM                 FSKCS059
00447                                                                      CL**6
00448              PERFORM 4000-BUILD-INITIAL-PANEL                     FSKCS059
00449                                                                   FSKCS059
00450          WHEN DP020-NEXT-ACT-READ-MAP                             FSKCS059
00451              MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM            CL**6
00452                                                                      CL**6
00453              PERFORM 2000-PROCESS-PANEL                           FSKCS059
00454                                                                   FSKCS059
00455          WHEN DP020-NEXT-ACT-RETURN                               FSKCS059
00456              MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM            CL**6
00457              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**6
00458                                                                      CL**6
00459              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 FSKCS059
00460                                                                      CL**6
00461              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 FSKCS059
00462                                                                      CL**6
00463              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   FSKCS059
00464                                                                   FSKCS059
00465          WHEN OTHER                                               FSKCS059
00466              SET DP013-LOGIC-ABEND                                   CL**6
00467                  DP013-NO-ROLLBACK TO TRUE                           CL**6
00468              MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH       CL**6
00469              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    FSKCS059
00470                                           TO DP013-MESSAGE-TEXT(1)   CL**6
00471              PERFORM DP013-0000-PROCESS-ABEND                     FSKCS059
00472      END-EVALUATE.                                                FSKCS059
00473                                                                   FSKCS059
00474 *----------------------------------------------------------------*FSKCS059
00475 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *FSKCS059
00476 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *FSKCS059
00477 *----------------------------------------------------------------*FSKCS059
00478  1100-PROCESS-INTER-APPL-COMM.                                    FSKCS059
00479                                                                   FSKCS059
00480      SET PS-COMMAREA-VALID TO TRUE.                                  CL**3
00481      MOVE SPACE TO ASC-START-ITEM-REQUEST.                           CL**3
00482                                                                      CL**3
00483      IF DP020-INT-APPL-FORMAT-IND = PC-FS-CRIT-SPEC-FORMAT OR        CL**3
00483         DP020-INT-APPL-FORMAT-IND = PC-FS-COLOR-SIZE-FORMAT       FSKCL**3
01422          MOVE FS007-DEPT-NUMBER         TO ASC-KEY-DEPT-NMBR      FSKCS059
01422          MOVE FS007-VENDOR-NAME         TO ASC-KEY-VEND-NAME      FSKCS059
01422          MOVE FS007-VENDOR-TYPE         TO ASC-KEY-VEND-TYPE      FSKCS059
00488      ELSE                                                         FSKCS059
00489          IF DP020-NAV-KEY-DATA > SPACES                              CL**3
00490              MOVE DP020-NAV-KEY-DATA    TO ASC-KEY-VEND-NAME         CL**3
00491          END-IF                                                      CL**3
00492          MOVE 'A'                       TO ASC-KEY-STATUS-CODE       CL**3
00492          MOVE '01'                      TO ASC-KEY-VEND-TYPE         CL**3
00493      END-IF.                                                         CL**3
00494                                                                   FSKCS059
00495 *----------------------------------------------------------------*FSKCS059
00496 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *FSKCS059
00497 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *FSKCS059
00498 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *FSKCS059
00499 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *FSKCS059
00500 * FUNCTION KEYS CAN GET THIS FAR.                                *FSKCS059
00501 *----------------------------------------------------------------*FSKCS059
00502  2000-PROCESS-PANEL.                                              FSKCS059
00503                                                                   FSKCS059
00504      EVALUATE TRUE                                                FSKCS059
00505          WHEN DP020-SRC-AID = DP016-CLEAR                         FSKCS059
00506               MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                  CL**6
00507                                                                      CL**6
00508               PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
00509                                                                      CL**6
00510               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
00511                                                                   FSKCS059
00512          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    FSKCS059
00513               PERFORM 2050-DELETE-LIST-QUEUE                         CL**6
00514                                                                      CL**6
00515               PERFORM 4000-BUILD-INITIAL-PANEL                       CL**6
00516                                                                   FSKCS059
00517          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    FSKCS059
00518               PERFORM 2140-DESELECT-ALL-ITEMS                        CL**6
00519                                                                      CL**6
00520               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
00521                                                                   FSKCS059
00522          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  FSKCS059
00523               PERFORM 2150-SELECT-ALL-ITEMS                          CL**6
00524                                                                      CL**6
00525               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
00526                                                                   FSKCS059
00527          WHEN OTHER                                               FSKCS059
00528               PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                   CL**6
00529                                                                      CL**6
00530               PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
00531                                                                      CL**6
00532               IF PS-NO-ERROR                                         CL**6
00533                   SET DP030-CONTINUE-GO TO TRUE                      CL**6
00534                                                                      CL**6
00535                   PERFORM 2100-CHECK-FUNCTION-KEY                    CL**6
00536               ELSE                                                   CL**6
00537                   SET DP030-OVERRIDE-GO TO TRUE                      CL**6
00538               END-IF                                                 CL**6
00539      END-EVALUATE.                                                FSKCS059
00540                                                                   FSKCS059
00541 *----------------------------------------------------------------*FSKCS059
00542 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *FSKCS059
00543 *----------------------------------------------------------------*FSKCS059
00544  2050-DELETE-LIST-QUEUE.                                          FSKCS059
00545                                                                   FSKCS059
00546      EXEC CICS                                                    FSKCS059
00547          DELETEQ TS                                               FSKCS059
00548              QUEUE (ASC-LIST-QUEUE-NAME)                          FSKCS059
00549              RESP  (PV-CICS-RESP)                                 FSKCS059
00550      END-EXEC.                                                    FSKCS059
00551                                                                   FSKCS059
00552      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       FSKCS059
00553         (PV-CICS-RESP = DFHRESP(QIDERR))                          FSKCS059
00554          CONTINUE                                                 FSKCS059
00555      ELSE                                                         FSKCS059
00556          SET DP013-CICS-ABEND                                        CL**6
00557              DP013-NO-ROLLBACK TO TRUE                               CL**6
00558                                                                   FSKCS059
00559          MOVE '2050-DELETE-LIST-QUEUE'                            FSKCS059
00560                                    TO DP013-PARAGRAPH             FSKCS059
00561          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    FSKCS059
00562                                    TO DP013-MESSAGE-TEXT (1)      FSKCS059
00563          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
00564      END-IF.                                                      FSKCS059
00565                                                                   FSKCS059
00566      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  FSKCS059
00567                                                                   FSKCS059
00568 *----------------------------------------------------------------*FSKCS059
00569 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*FSKCS059
00570 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *FSKCS059
00571 * CICS ARCHITECTURE API.                                         *FSKCS059
00572 *----------------------------------------------------------------*FSKCS059
00573  2100-CHECK-FUNCTION-KEY.                                         FSKCS059
00574                                                                   FSKCS059
00575      EVALUATE TRUE                                                FSKCS059
00609          WHEN DP020-SRC-AID = DP016-PF17                          FSKCS059
00577               IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                    CL**6
00584                   SET DP020-MSG-FATAL   TO TRUE                      CL**6
00743                   SET PS-ERROR          TO TRUE                   FSKCS059
00585                   MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER          CL**6
00537                   SET DP030-OVERRIDE-GO TO TRUE                      CL**6
00582               ELSE                                                   CL**6
                        CONTINUE                                                
00586              END-IF                                               FSKCS059
00576          WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  FSKCS059
                    CONTINUE                                                    
00577 *             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
00578 *                 INITIALIZE VN002-INTER-APPL-COMMAREA               CL**6
00579 *                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                  CL**6
00580 *                               TO VN002-NUMBER-OF-SELECTED-ITEMS FSKCS059
00581 *                 PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
00582 *             ELSE                                                   CL**6
00583 *                 SET DP030-OVERRIDE-GO                              CL**6
00584 *                     DP020-MSG-WARNING TO TRUE                      CL**6
00585 *                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER          CL**6
00586 *            END-IF                                               FSKCS059
00587                                                                   FSKCS059
00588          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  FSKCS059
00589              MOVE +1               TO PV-TOP-ITEM                 FSKCS059
00590                                                                      CL**6
00591              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 FSKCS059
00592                                                                      CL**6
00593              PERFORM 3200-RESET-ATTRIBUTES                        FSKCS059
00594                                                                   FSKCS059
00595          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   FSKCS059
00596              PERFORM 2110-BROWSE-BACKWARD                         FSKCS059
00597                                                                      CL**6
00598              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 FSKCS059
00599                                                                      CL**6
00600              PERFORM 3200-RESET-ATTRIBUTES                        FSKCS059
00601                                                                   FSKCS059
00602          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   FSKCS059
00603              PERFORM 2120-BROWSE-FORWARD                          FSKCS059
00604                                                                      CL**6
00605              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 FSKCS059
00606                                                                      CL**6
00607              PERFORM 3200-RESET-ATTRIBUTES                        FSKCS059
00608                                                                   FSKCS059
00609          WHEN DP020-SRC-AID = DP016-ENTER                         FSKCS059
00610              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   FSKCS059
00611                                                                      CL**6
00612              IF PS-ERROR                                             CL**6
00613                  CONTINUE                                         FSKCS059
00614              ELSE                                                 FSKCS059
00615                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             FSKCS059
00616              END-IF                                               FSKCS059
00617                                                                   FSKCS059
00618          WHEN OTHER                                               FSKCS059
00619              SET DP013-NO-ROLLBACK                                FSKCS059
00620                  DP013-XCTL-DISPLAY-RESTART                       FSKCS059
00621                  DP013-CICS-ABEND  TO TRUE                        FSKCS059
00622              MOVE '2100-CHECK-FUNCTION-KEY'                       FSKCS059
00623                                    TO DP013-PARAGRAPH             FSKCS059
00624              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      FSKCS059
00625                                    TO DP013-MESSAGE-TEXT (1)      FSKCS059
00626              PERFORM DP013-0000-PROCESS-ABEND                     FSKCS059
00627      END-EVALUATE.                                                FSKCS059
00628                                                                   FSKCS059
00629 *----------------------------------------------------------------*FSKCS059
00630 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *FSKCS059
00631 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *FSKCS059
00632 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *FSKCS059
00633 *    MESSAGE.                                                    *FSKCS059
00634 *----------------------------------------------------------------*FSKCS059
00635  2110-BROWSE-BACKWARD.                                            FSKCS059
00636                                                                   FSKCS059
00637      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    FSKCS059
00638          GIVING PV-TOP-ITEM.                                      FSKCS059
00639                                                                   FSKCS059
00640      IF  ((PV-TOP-ITEM < +1)                                      FSKCS059
00641        OR (PV-TOP-ITEM = +1))                                     FSKCS059
00642          MOVE +1                   TO PV-TOP-ITEM                 FSKCS059
00643 *        -- TOP OF LIST --                                        FSKCS059
00644          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            FSKCS059
00645          SET DP020-MSG-INFORMATIONAL TO TRUE                      FSKCS059
00646      END-IF.                                                      FSKCS059
00647                                                                   FSKCS059
00648 *----------------------------------------------------------------*FSKCS059
00649 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *FSKCS059
00650 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *FSKCS059
00651 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *FSKCS059
00652 *----------------------------------------------------------------*FSKCS059
00653  2120-BROWSE-FORWARD.                                             FSKCS059
00654                                                                   FSKCS059
00655      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              FSKCS059
00656          GIVING PV-TOP-ITEM.                                      FSKCS059
00657      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   FSKCS059
00658          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            FSKCS059
00659                                    TO PV-TOP-ITEM                 FSKCS059
00660 *        -- BOTTOM OF LIST --                                     FSKCS059
00661          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            FSKCS059
00662          SET DP020-MSG-INFORMATIONAL                              FSKCS059
00663                                    TO TRUE                        FSKCS059
00664      ELSE                                                         FSKCS059
00665          COMPUTE PV-BOTTOM-ITEM =                                 FSKCS059
00666              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 FSKCS059
00667          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            FSKCS059
00668 *            -- BOTTOM OF LIST --                                 FSKCS059
00669              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            FSKCS059
00670              SET DP020-MSG-INFORMATIONAL                          FSKCS059
00671                                    TO TRUE                        FSKCS059
00672          END-IF                                                   FSKCS059
00673      END-IF.                                                      FSKCS059
00674                                                                   FSKCS059
00675 *----------------------------------------------------------------*FSKCS059
00676 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *FSKCS059
00677 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *FSKCS059
00678 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *FSKCS059
00679 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *FSKCS059
00680 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *FSKCS059
00681 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *FSKCS059
00682 *----------------------------------------------------------------*FSKCS059
00683  2130-CHECK-FOR-JUMP-BROWSE.                                      FSKCS059
00684                                                                   FSKCS059
00685      SET PS-NO-ERROR               TO TRUE.                       FSKCS059
00686      IF (ASC-START-ITEM-REQUEST = SPACE)                          FSKCS059
00687          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            FSKCS059
00688                                    TO PV-TOP-ITEM                 FSKCS059
00689      ELSE                                                         FSKCS059
00690          MOVE ASC-START-ITEM-REQUEST                              FSKCS059
00691                                    TO DP010I-UNEDITED-FIELD       FSKCS059
00692          MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       FSKCS059
00693          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     FSKCS059
00694          SET DP010I-NEGATIVE-NOT-ALLOWED                          FSKCS059
00695                                    TO TRUE                        FSKCS059
272945         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
272945                         USING DP010I-NUMERIC-EDIT-AREA                   
00697                                                                   FSKCS059
00698          IF  NOT DP010I-ERROR-DETECTED                            FSKCS059
00699              MOVE DP010I-NUMERIC-FIELD                            FSKCS059
00700                                    TO  ASC-START-ITEM-REQUEST-N   FSKCS059
00701              IF  ASC-START-ITEM-REQUEST-N > ZERO                  FSKCS059
00702                  IF  ASC-START-ITEM-REQUEST-N >                   FSKCS059
00703                                           ASC-NUMBER-OF-ITEMS-READFSKCS059
00704                      MOVE SPACE TO ASC-START-ITEM-REQUEST         FSKCS059
00705                      COMPUTE PV-TOP-ITEM =                        FSKCS059
00706                              ASC-NUMBER-OF-ITEMS-READ             FSKCS059
00707                              - PC-ITEMS-PER-PANEL + 1             FSKCS059
00708                      IF  PV-TOP-ITEM < +1                         FSKCS059
00709                          MOVE +1   TO PV-TOP-ITEM                 FSKCS059
00710                          MOVE PC-TSYMSG-00070                     FSKCS059
00711                                    TO DP020-MSG-NUMBER            FSKCS059
00712                          SET DP020-MSG-INFORMATIONAL              FSKCS059
00713                                    TO TRUE                        FSKCS059
00714                      END-IF                                       FSKCS059
00715                  ELSE                                             FSKCS059
00716                      MOVE ASC-START-ITEM-REQUEST-N                FSKCS059
00717                                    TO PV-TOP-ITEM                 FSKCS059
00718                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      FSKCS059
00719                      COMPUTE PV-BOTTOM-ITEM =                     FSKCS059
00720                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     FSKCS059
00721                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READFSKCS059
00722 *                        -- BOTTOM OF LIST --                     FSKCS059
00723                          MOVE PC-TSYMSG-00070                     FSKCS059
00724                                    TO DP020-MSG-NUMBER            FSKCS059
00725                          SET DP020-MSG-INFORMATIONAL              FSKCS059
00726                                    TO TRUE                        FSKCS059
00727                      END-IF                                       FSKCS059
00728                  END-IF                                           FSKCS059
00729              ELSE                                                 FSKCS059
00730 *                --- VALUE OUT OF RANGE ----                      FSKCS059
00731                  MOVE PC-TSYMSG-00101                             FSKCS059
00732                                    TO DP020-MSG-NUMBER            FSKCS059
00733                  MOVE -1           TO ASTRTITL                    FSKCS059
00734                  SET DP030-SET-CURSOR-APPL-1                      FSKCS059
00735                                    TO TRUE                        FSKCS059
00736                  MOVE DP015-REVERSE                               FSKCS059
00737                                    TO ASTRTITH                    FSKCS059
00738                  MOVE DP015-RED    TO ASTRTITC                    FSKCS059
00739                  MOVE DP015-UNP-NUM-BRT-MDT                       FSKCS059
00740                                    TO ASTRTITA                    FSKCS059
00741                  SET DP020-MSG-FATAL                              FSKCS059
00742                                    TO TRUE                        FSKCS059
00743                  SET PS-ERROR      TO TRUE                        FSKCS059
00744              END-IF                                               FSKCS059
00745                                                                   FSKCS059
00746          ELSE                                                     FSKCS059
00747              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            FSKCS059
00748              MOVE -1               TO ASTRTITL                    FSKCS059
00749              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  FSKCS059
00750              MOVE DP015-REVERSE    TO ASTRTITH                    FSKCS059
00751              MOVE DP015-RED        TO ASTRTITC                    FSKCS059
00752              MOVE DP015-UNP-NUM-BRT-MDT                           FSKCS059
00753                                    TO ASTRTITA                    FSKCS059
00754              SET DP020-MSG-FATAL   TO TRUE                        FSKCS059
00755              SET PS-ERROR          TO TRUE                        FSKCS059
00756          END-IF                                                   FSKCS059
00757      END-IF.                                                      FSKCS059
00758                                                                   FSKCS059
00759 *----------------------------------------------------------------*FSKCS059
00760 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *FSKCS059
00761 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *FSKCS059
00762 *----------------------------------------------------------------*FSKCS059
00763  2140-DESELECT-ALL-ITEMS.                                         FSKCS059
00764                                                                   FSKCS059
00765      MOVE +1                       TO ASC-BLK-SUB.                FSKCS059
00766                                                                   FSKCS059
00767      PERFORM 2141-CLEAR-SELECTED-INDS                             FSKCS059
00768          VARYING ASC-ITEM-SUB                                     FSKCS059
00769          FROM 1 BY 1                                              FSKCS059
00770          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 FSKCS059
00771                                                                   FSKCS059
00772      ADD +1                        TO ASC-BLK-SUB.                FSKCS059
00773                                                                   FSKCS059
00774      PERFORM 2141-CLEAR-SELECTED-INDS                             FSKCS059
00775          VARYING ASC-ITEM-SUB                                     FSKCS059
00776          FROM 1 BY 1                                              FSKCS059
00777          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 FSKCS059
00778                                                                   FSKCS059
00779      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               FSKCS059
00780                                    TO PV-LIST-ITEM-NUMBER.        FSKCS059
00781                                                                   FSKCS059
00782      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            FSKCS059
00783          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    FSKCS059
00784                                                                   FSKCS059
00785      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     FSKCS059
00786         (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      FSKCS059
00787          MOVE +1                   TO ASC-BLK-SUB                 FSKCS059
00788                                                                   FSKCS059
00789          PERFORM 5100-WRITE-TEMP-STORAGE                          FSKCS059
00790                                                                   FSKCS059
00791          MOVE +1                   TO PV-BLOCK-NUMBER             FSKCS059
00792                                                                   FSKCS059
00793          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         FSKCS059
00794              PV-FIRST-BLOCK-IN-ARRAY - 1                          FSKCS059
00795                                                                   FSKCS059
00796          PERFORM                                                  FSKCS059
00797              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       FSKCS059
00798                                                                   FSKCS059
00799              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
00800                                                                   FSKCS059
00801              PERFORM 2141-CLEAR-SELECTED-INDS                     FSKCS059
00802                  VARYING ASC-ITEM-SUB FROM 1 BY 1                 FSKCS059
00803                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          FSKCS059
00804                                                                   FSKCS059
00805              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
00806                                                                   FSKCS059
00807              ADD +1                TO PV-BLOCK-NUMBER             FSKCS059
00808                                                                   FSKCS059
00809          END-PERFORM                                              FSKCS059
00810                                                                   FSKCS059
00811          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         FSKCS059
00812              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     FSKCS059
00813                                                                   FSKCS059
00814          PERFORM                                                  FSKCS059
00815              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       FSKCS059
00816                    ASC-HIGHEST-BLOCK-WRITTEN                      FSKCS059
00817                                                                   FSKCS059
00818              MOVE PV-NEXT-BLOCK-IN-ARRAY                          FSKCS059
00819                                    TO PV-BLOCK-NUMBER             FSKCS059
00820                                                                   FSKCS059
00821              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
00822                                                                   FSKCS059
00823              PERFORM 2141-CLEAR-SELECTED-INDS                     FSKCS059
00824                  VARYING ASC-ITEM-SUB                             FSKCS059
00825                  FROM 1 BY 1                                      FSKCS059
00826                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          FSKCS059
00827                                                                   FSKCS059
00828              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
00829                                                                   FSKCS059
00830              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      FSKCS059
00831                                                                   FSKCS059
00832          END-PERFORM                                              FSKCS059
00833                                                                   FSKCS059
00834          MOVE PV-FIRST-BLOCK-IN-ARRAY                             FSKCS059
00835                                    TO PV-BLOCK-NUMBER             FSKCS059
00836                                                                   FSKCS059
00837          PERFORM 4410-READ-TEMP-STORAGE                           FSKCS059
00838      END-IF.                                                      FSKCS059
00839                                                                   FSKCS059
00840                                                                   FSKCS059
00841      MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. FSKCS059
00842      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.FSKCS059
00843      MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  FSKCS059
00844                                                                   FSKCS059
00845      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        FSKCS059
00846                                                                   FSKCS059
00847 *----------------------------------------------------------------*FSKCS059
00848 *    MARK EACH ITEM AS BEING NOT SELECTED.                       *FSKCS059
00849 *----------------------------------------------------------------*FSKCS059
00850  2141-CLEAR-SELECTED-INDS.                                        FSKCS059
00851                                                                   FSKCS059
00852      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           FSKCS059
00853              NOT EQUAL ZERO                                       FSKCS059
00854          IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          FSKCS059
00855              SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          FSKCS059
00856                  ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    FSKCS059
00857                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  FSKCS059
00858                                    TO TRUE                        FSKCS059
00859          END-IF                                                   FSKCS059
00860      END-IF.                                                      FSKCS059
00861                                                                   FSKCS059
00862 *----------------------------------------------------------------*FSKCS059
00863 *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *FSKCS059
00864 *  FOR ALL ITEMS.                                                *FSKCS059
00865 *----------------------------------------------------------------*FSKCS059
00866  2150-SELECT-ALL-ITEMS.                                           FSKCS059
00867                                                                   FSKCS059
00868      MOVE +1                       TO ASC-BLK-SUB.                FSKCS059
00869                                                                   FSKCS059
00870      PERFORM 2151-SET-SELECTED-INDS                               FSKCS059
00871          VARYING ASC-ITEM-SUB                                     FSKCS059
00872          FROM 1 BY 1                                              FSKCS059
00873          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 FSKCS059
00874                                                                   FSKCS059
00875      ADD +1                        TO ASC-BLK-SUB.                FSKCS059
00876                                                                   FSKCS059
00877      PERFORM 2151-SET-SELECTED-INDS                               FSKCS059
00878          VARYING ASC-ITEM-SUB                                     FSKCS059
00879          FROM 1 BY 1                                              FSKCS059
00880          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 FSKCS059
00881                                                                   FSKCS059
00882      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               FSKCS059
00883                                    TO PV-LIST-ITEM-NUMBER.        FSKCS059
00884                                                                   FSKCS059
00885      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            FSKCS059
00886          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    FSKCS059
00887                                                                   FSKCS059
00888      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     FSKCS059
00889         (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    FSKCS059
00890          MOVE +1                   TO ASC-BLK-SUB                 FSKCS059
00891                                                                   FSKCS059
00892          PERFORM 5100-WRITE-TEMP-STORAGE                          FSKCS059
00893                                                                   FSKCS059
00894          MOVE +1                   TO PV-BLOCK-NUMBER             FSKCS059
00895                                                                   FSKCS059
00896          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         FSKCS059
00897              PV-FIRST-BLOCK-IN-ARRAY - 1                          FSKCS059
00898                                                                   FSKCS059
00899          PERFORM                                                  FSKCS059
00900              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       FSKCS059
00901                                                                   FSKCS059
00902              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
00903                                                                   FSKCS059
00904              PERFORM 2151-SET-SELECTED-INDS                       FSKCS059
00905                  VARYING ASC-ITEM-SUB                             FSKCS059
00906                  FROM 1 BY 1                                      FSKCS059
00907                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          FSKCS059
00908                                                                   FSKCS059
00909              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
00910                                                                   FSKCS059
00911              ADD +1                TO PV-BLOCK-NUMBER             FSKCS059
00912                                                                   FSKCS059
00913          END-PERFORM                                              FSKCS059
00914                                                                   FSKCS059
00915          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         FSKCS059
00916              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     FSKCS059
00917                                                                   FSKCS059
00918          PERFORM                                                  FSKCS059
00919              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       FSKCS059
00920                    ASC-HIGHEST-BLOCK-WRITTEN                      FSKCS059
00921                                                                   FSKCS059
00922              MOVE PV-NEXT-BLOCK-IN-ARRAY                          FSKCS059
00923                                    TO PV-BLOCK-NUMBER             FSKCS059
00924                                                                   FSKCS059
00925              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
00926                                                                   FSKCS059
00927              PERFORM 2151-SET-SELECTED-INDS                       FSKCS059
00928                  VARYING ASC-ITEM-SUB                             FSKCS059
00929                  FROM 1 BY 1                                      FSKCS059
00930                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          FSKCS059
00931                                                                   FSKCS059
00932              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
00933                                                                   FSKCS059
00934              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      FSKCS059
00935                                                                   FSKCS059
00936          END-PERFORM                                              FSKCS059
00937                                                                   FSKCS059
00938          MOVE PV-FIRST-BLOCK-IN-ARRAY                             FSKCS059
00939                                    TO PV-BLOCK-NUMBER             FSKCS059
00940                                                                   FSKCS059
00941          PERFORM 4410-READ-TEMP-STORAGE                           FSKCS059
00942      END-IF.                                                      FSKCS059
00943                                                                   FSKCS059
00944                                                                   FSKCS059
00945      MOVE ASC-NUMBER-OF-ITEMS-READ TO                             FSKCS059
00946                        ASC-NUMBER-OF-SELECTED-ITEMS.              FSKCS059
00947                                                                   FSKCS059
00948      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        FSKCS059
00949                                                                   FSKCS059
00950 *----------------------------------------------------------------*FSKCS059
00951 *    MARK EACH ITEM AS BEING SELECTED.                           *FSKCS059
00952 *----------------------------------------------------------------*FSKCS059
00953  2151-SET-SELECTED-INDS.                                          FSKCS059
00954                                                                   FSKCS059
00955      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           FSKCS059
00956              NOT EQUAL ZERO                                       FSKCS059
00957          IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             FSKCS059
00958              SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             FSKCS059
00959                  ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        FSKCS059
00960                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  FSKCS059
00961                                TO  TRUE                           FSKCS059
00962          END-IF                                                   FSKCS059
00963      END-IF.                                                      FSKCS059
00964                                                                   FSKCS059
00965 ******************************************************************FSKCS059
00966 ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **FSKCS059
00967 ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **FSKCS059
00968 ******************************************************************FSKCS059
00969  2200-MOVE-SCREEN-TO-COMMAREA.                                    FSKCS059
00970                                                                   FSKCS059
00971      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             FSKCS059
00972      MOVE +1                       TO PV-SUB.                     FSKCS059
00973                                                                   FSKCS059
00974      PERFORM 3100-SET-SUBSCRIPTS.                                 FSKCS059
00975      IF  ASTRTITL > ZERO                                          FSKCS059
00976          MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          FSKCS059
00977      ELSE                                                         FSKCS059
00978          IF  ASTRTITF = DP015-ERASE-EOF                           FSKCS059
00979              INITIALIZE ASC-START-ITEM-REQUEST                    FSKCS059
00980          END-IF                                                   FSKCS059
00981      END-IF.                                                      FSKCS059
00982      PERFORM 2210-MOVE-LINES-TO-COMMAREA                          FSKCS059
00983          VARYING PV-SUB                                           FSKCS059
00984          FROM 1 BY 1                                              FSKCS059
00985          UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      FSKCS059
00986                                                                   FSKCS059
00987 ******************************************************************FSKCS059
00988 ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**FSKCS059
00989 ******************************************************************FSKCS059
00990  2210-MOVE-LINES-TO-COMMAREA.                                     FSKCS059
00991                                                                   FSKCS059
00992      IF  MR-SELECTL (PV-SUB) > ZERO                               FSKCS059
00993          SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             FSKCS059
00994          MOVE MR-SELECTI (PV-SUB)                                 FSKCS059
00995                                    TO ASC-TEMP-SELECTED-SW        FSKCS059
00996                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      FSKCS059
00997      ELSE                                                         FSKCS059
00998          IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                FSKCS059
00999                  SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     FSKCS059
01000                  MOVE SPACE        TO ASC-TEMP-SELECTED-SW        FSKCS059
01001                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      FSKCS059
01002          END-IF                                                   FSKCS059
01003      END-IF.                                                      FSKCS059
01004      ADD +1                        TO ASC-ITEM-SUB.               FSKCS059
01005      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        FSKCS059
01006          ADD +1                    TO ASC-BLK-SUB                 FSKCS059
01007          MOVE +1                   TO ASC-ITEM-SUB                FSKCS059
01008      END-IF.                                                      FSKCS059
01009                                                                   FSKCS059
01010 ******************************************************************FSKCS059
01011 ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **FSKCS059
01012 ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **FSKCS059
01013 ******************************************************************FSKCS059
01014  3000-EDIT-DATA-IN-COMMAREA.                                      FSKCS059
01015                                                                   FSKCS059
01016      SET PS-NO-ERROR               TO TRUE.                       FSKCS059
01017      PERFORM 3200-RESET-ATTRIBUTES.                               FSKCS059
01018      MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     FSKCS059
01019 **                                                                FSKCS059
01020 * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              FSKCS059
01021 * EDITTING IS DONE FROM THE BOTTOM UP.                            FSKCS059
01022 **                                                                FSKCS059
01023      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       FSKCS059
01024          ASC-ITEMS-DISPLAYED - 1.                                 FSKCS059
01025      PERFORM 3100-SET-SUBSCRIPTS.                                 FSKCS059
01026      PERFORM 3300-EDIT-SELECTIONS                                 FSKCS059
01027          VARYING PV-SUB                                           FSKCS059
01028          FROM PV-SUB BY -1                                        FSKCS059
01029          UNTIL PV-SUB < +1                                        FSKCS059
01030                                                                   FSKCS059
01031      IF  PS-NO-ERROR                                              FSKCS059
01032          PERFORM 3400-CHECK-RANGE-SEQUENCE                        FSKCS059
01033      END-IF.                                                      FSKCS059
01034                                                                   FSKCS059
01035      IF  ((PS-NO-ERROR)                                           FSKCS059
01036        AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   FSKCS059
01037        AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    FSKCS059
01038              PERFORM 3500-MARK-RANGE-AS-SELECTED                  FSKCS059
01039      END-IF.                                                      FSKCS059
01040                                                                   FSKCS059
01041 *----------------------------------------------------------------*FSKCS059
01042 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *FSKCS059
01043 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*FSKCS059
01044 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *FSKCS059
01045 *                                                                *FSKCS059
01046 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *FSKCS059
01047 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *FSKCS059
01048 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *FSKCS059
01049 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *FSKCS059
01050 *----------------------------------------------------------------*FSKCS059
01051  3100-SET-SUBSCRIPTS.                                             FSKCS059
01052                                                                   FSKCS059
01053      COMPUTE ASC-ITEM-SUB =                                       FSKCS059
01054          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        FSKCS059
01055                                                                   FSKCS059
01056      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         FSKCS059
01057          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            FSKCS059
01058                                                                   FSKCS059
01059          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               FSKCS059
01060      ELSE                                                         FSKCS059
01061          MOVE +1                     TO ASC-BLK-SUB               FSKCS059
01062      END-IF.                                                      FSKCS059
01063                                                                   FSKCS059
01064 ******************************************************************FSKCS059
01065 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **FSKCS059
01066 ******************************************************************FSKCS059
01067  3200-RESET-ATTRIBUTES.                                           FSKCS059
01068                                                                   FSKCS059
01069      MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      FSKCS059
01070      MOVE DP015-GREEN           TO ASTRTITC.                      FSKCS059
01071      MOVE DP015-UNDERLINE       TO ASTRTITH.                      FSKCS059
01072                                                                   FSKCS059
01073      IF DP020-NEXT-ACT-RETURN OR                                  FSKCS059
01074         DP020-NEXT-ACT-READ-MAP                                   FSKCS059
01075          PERFORM VARYING PV-SUB  FROM 1 BY 1                      FSKCS059
01076                  UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             FSKCS059
01077                   MOVE DP015-UNP-ALP-NOR-OFF                      FSKCS059
01078                                        TO MR-SELECTA (PV-SUB)     FSKCS059
01079                   MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     FSKCS059
01080                   MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     FSKCS059
01081          END-PERFORM                                              FSKCS059
01082      ELSE                                                         FSKCS059
01083          PERFORM VARYING PV-SUB  FROM 1 BY 1                      FSKCS059
01084                  UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              FSKCS059
01085                   MOVE DP015-UNP-ALP-NOR-OFF                      FSKCS059
01086                                        TO MR-SELECTA (PV-SUB)     FSKCS059
01087                   MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     FSKCS059
01088                   MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     FSKCS059
01089          END-PERFORM.                                             FSKCS059
01090                                                                   FSKCS059
01091 ******************************************************************FSKCS059
01092 ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **FSKCS059
01093 ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **FSKCS059
01094 ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **FSKCS059
01095 ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **FSKCS059
01096 ******************************************************************FSKCS059
01097  3300-EDIT-SELECTIONS.                                            FSKCS059
01098                                                                   FSKCS059
01099      EVALUATE TRUE                                                FSKCS059
01100          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     FSKCS059
01101              = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         FSKCS059
LM                 IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)           
LM                    = 'S'                                                     
LM                     MOVE ASC-VEND-NAME   (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
LM                                    TO FS007-VENDOR-NAME              FSKCS059
LM                     MOVE ASC-VEND-TYPE   (ASC-BLK-SUB ASC-ITEM-SUB)          
LM                                    TO FS007-VENDOR-TYPE              FSKCS059
LM                     MOVE ASC-ENT-ID      (ASC-BLK-SUB ASC-ITEM-SUB)          
LM                                    TO FS007-VENDOR-ENT-ID            FSKCS059
                   END-IF                                                       
01103          WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         FSKCS059
01104              IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        FSKCS059
01105                  ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   FSKCS059
01106                  MOVE ASC-TEMP-SELECTED-SW                        FSKCS059
01107                                       (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
01108                                 TO ASC-SELECTED-SW                FSKCS059
01109                                       (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
      *-->         MOVE SELECTED VENDOR NAME TO COMMAREA                        
01106                  MOVE ASC-VEND-NAME   (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
01108                                 TO FS007-VENDOR-NAME              FSKCS059
01106                  MOVE ASC-VEND-TYPE   (ASC-BLK-SUB ASC-ITEM-SUB)          
01108                                 TO FS007-VENDOR-TYPE              FSKCS059
LM                     MOVE ASC-ENT-ID   (ASC-BLK-SUB ASC-ITEM-SUB)             
LM                                    TO FS007-VENDOR-ENT-ID            FSKCS059
01110              END-IF                                               FSKCS059
      *-->         IF PF-17 AND SELECTED ITEMS > 1 THEN ERROR                   
00609 *            IF DP020-SRC-AID = DP016-PF17 AND                    FSKCS059
01105 *               ASC-NUMBER-OF-SELECTED-ITEMS > 1                  FSKCS059
01140 *               MOVE -1                TO MR-SELECTL (PV-SUB)     FSKCS059
01141 *               SET DP030-SET-CURSOR-APPL-1 TO TRUE               FSKCS059
01143 *               MOVE DP015-RED         TO MR-SELECTC (PV-SUB)     FSKCS059
01144 *               MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)     FSKCS059
      *            END-IF                                                       
01098                                                                   FSKCS059
01111          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     FSKCS059
01112                  = SPACE                                          FSKCS059
01113              EVALUATE TRUE                                        FSKCS059
01114                  WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       FSKCS059
01115                      SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSFSKCS059
01116                      MOVE SPACE TO ASC-SELECTED-SW                FSKCS059
01117                                       (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
01118                  WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        FSKCS059
01119                      MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    FSKCS059
01120                      MOVE SPACE TO ASC-SELECTED-SW                FSKCS059
01121                                       (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
01122                  WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          FSKCS059
01123                      MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      FSKCS059
01124                      MOVE SPACE TO ASC-SELECTED-SW                FSKCS059
01125                                       (ASC-BLK-SUB ASC-ITEM-SUB)  FSKCS059
01126              END-EVALUATE                                         FSKCS059
01127          WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           FSKCS059
01128              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            FSKCS059
01129                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    FSKCS059
01130              END-IF                                               FSKCS059
01131              PERFORM 3310-EDIT-RANGE                              FSKCS059
01132          WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             FSKCS059
01133              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            FSKCS059
01134                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    FSKCS059
01135              END-IF                                               FSKCS059
01136              PERFORM 3310-EDIT-RANGE                              FSKCS059
01137          WHEN OTHER                                               FSKCS059
01138              MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           FSKCS059
01139              SET DP020-MSG-FATAL    TO TRUE                       FSKCS059
01140              MOVE -1                TO MR-SELECTL (PV-SUB)        FSKCS059
01141              SET DP030-SET-CURSOR-APPL-1                          FSKCS059
01142                                     TO TRUE                       FSKCS059
01143              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        FSKCS059
01144              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        FSKCS059
01145              SET PS-ERROR TO TRUE                                 FSKCS059
01146              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            FSKCS059
01147                  SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     FSKCS059
01148                  MOVE SPACE         TO ASC-SELECTED-SW            FSKCS059
01149                                         (ASC-BLK-SUB ASC-ITEM-SUB)FSKCS059
01150              END-IF                                               FSKCS059
01151      END-EVALUATE.                                                FSKCS059
01152                                                                   FSKCS059
01153      SUBTRACT +1             FROM PV-ITEM-IN-USE.                 FSKCS059
01154      SUBTRACT +1 FROM ASC-ITEM-SUB.                               FSKCS059
01155      IF  ASC-ITEM-SUB < 1                                         FSKCS059
01156          SUBTRACT +1 FROM ASC-BLK-SUB                             FSKCS059
01157          MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                FSKCS059
01158      END-IF.                                                      FSKCS059
01159                                                                   FSKCS059
01160 ******************************************************************FSKCS059
01161 ** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **FSKCS059
01162 ** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **FSKCS059
01163 ** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**FSKCS059
01164 ** THE ENDING.                                                  **FSKCS059
01165 ******************************************************************FSKCS059
01166  3310-EDIT-RANGE.                                                 FSKCS059
01167                                                                   FSKCS059
01168      IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                FSKCS059
01169          IF  ASC-START-OF-SELECTED-RANGE = ZERO                   FSKCS059
01170              MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)FSKCS059
01171                                    TO ASC-SELECTED-SW             FSKCS059
01172                                         (ASC-BLK-SUB ASC-ITEM-SUB)FSKCS059
01173              MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE FSKCS059
01174          ELSE                                                     FSKCS059
01175              IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     FSKCS059
01176                  CONTINUE                                         FSKCS059
01177              ELSE                                                 FSKCS059
01178 *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        FSKCS059
01179                  MOVE PC-TSYMSG-00054                             FSKCS059
01180                                    TO DP020-MSG-NUMBER            FSKCS059
01181                  SET DP020-MSG-FATAL                              FSKCS059
01182                                    TO TRUE                        FSKCS059
01183                  MOVE -1           TO MR-SELECTL (PV-SUB)         FSKCS059
01184                  SET DP030-SET-CURSOR-APPL-1                      FSKCS059
01185                                    TO TRUE                        FSKCS059
01186                  MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         FSKCS059
01187                  MOVE DP015-UNDERLINE                             FSKCS059
01188                                    TO MR-SELECTH (PV-SUB)         FSKCS059
01189                  SET PS-ERROR      TO TRUE                        FSKCS059
01190              END-IF                                               FSKCS059
01191          END-IF                                                   FSKCS059
01192      ELSE                                                         FSKCS059
01193          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     FSKCS059
01194              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) FSKCS059
01195                                    TO ASC-SELECTED-SW             FSKCS059
01196                                      (ASC-BLK-SUB ASC-ITEM-SUB)   FSKCS059
01197              MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   FSKCS059
01198          ELSE                                                     FSKCS059
01199              IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       FSKCS059
01200                  CONTINUE                                         FSKCS059
01201              ELSE                                                 FSKCS059
01202 *                -- ONLY ONE END-OF-RANGE ALLOWED --              FSKCS059
01203                  MOVE PC-TSYMSG-00055                             FSKCS059
01204                                    TO DP020-MSG-NUMBER            FSKCS059
01205                  SET DP020-MSG-FATAL                              FSKCS059
01206                                    TO TRUE                        FSKCS059
01207                  MOVE -1           TO MR-SELECTL (PV-SUB)         FSKCS059
01208                  SET DP030-SET-CURSOR-APPL-1                      FSKCS059
01209                                    TO TRUE                        FSKCS059
01210                  SET PS-ERROR      TO TRUE                        FSKCS059
01211              END-IF                                               FSKCS059
01212          END-IF                                                   FSKCS059
01213      END-IF.                                                      FSKCS059
01214                                                                   FSKCS059
01215 ******************************************************************FSKCS059
01216 ** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **FSKCS059
01217 ** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **FSKCS059
01218 ******************************************************************FSKCS059
01219  3400-CHECK-RANGE-SEQUENCE.                                       FSKCS059
01220                                                                   FSKCS059
01221      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       FSKCS059
01222        AND  ASC-END-OF-SELECTED-RANGE > ZERO                      FSKCS059
01223        AND  ASC-START-OF-SELECTED-RANGE >                         FSKCS059
01224                                          ASC-END-OF-SELECTED-RANGEFSKCS059
01225 *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                FSKCS059
01226          MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 FSKCS059
01227          SET DP020-MSG-FATAL TO TRUE                              FSKCS059
01228          SET PS-ERROR TO TRUE                                     FSKCS059
01229          PERFORM 3410-POSITION-AT-ERROR                           FSKCS059
01230      END-IF.                                                      FSKCS059
01231                                                                   FSKCS059
01232 ******************************************************************FSKCS059
01233 ** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **FSKCS059
01234 ** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **FSKCS059
01235 ** SHOULD BE POSITIONED ON A RANGE ERROR.                       **FSKCS059
01236 ******************************************************************FSKCS059
01237  3410-POSITION-AT-ERROR.                                          FSKCS059
01238                                                                   FSKCS059
01239      SET DP030-SET-CURSOR-APPL-1                                  FSKCS059
01240                                    TO TRUE.                       FSKCS059
01241      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 FSKCS059
01242                     - PV-TOP-ITEM + 1.                            FSKCS059
01243      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      FSKCS059
01244          CONTINUE                                                 FSKCS059
01245      ELSE                                                         FSKCS059
01246          MOVE -1                   TO MR-SELECTL (PV-SUB)         FSKCS059
01247          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         FSKCS059
01248          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         FSKCS059
01249      END-IF.                                                      FSKCS059
01250                                                                   FSKCS059
01251      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   FSKCS059
01252                     - PV-TOP-ITEM + 1.                            FSKCS059
01253      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      FSKCS059
01254          CONTINUE                                                 FSKCS059
01255      ELSE                                                         FSKCS059
01256          MOVE -1                   TO MR-SELECTL (PV-SUB)         FSKCS059
01257          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         FSKCS059
01258          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         FSKCS059
01259      END-IF.                                                      FSKCS059
01260                                                                   FSKCS059
01261 *----------------------------------------------------------------*FSKCS059
01262 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *FSKCS059
01263 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *FSKCS059
01264 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *FSKCS059
01265 *----------------------------------------------------------------*FSKCS059
01266  3500-MARK-RANGE-AS-SELECTED.                                     FSKCS059
01267                                                                   FSKCS059
01268      MOVE +1                       TO  ASC-BLK-SUB.               FSKCS059
01269      PERFORM 3510-MARK-SELECTED-INDS                              FSKCS059
01270          VARYING ASC-ITEM-SUB                                     FSKCS059
01271          FROM 1 BY 1                                              FSKCS059
01272          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 FSKCS059
01273                                                                   FSKCS059
01274      ADD +1                        TO ASC-BLK-SUB.                FSKCS059
01275      PERFORM 3510-MARK-SELECTED-INDS                              FSKCS059
01276          VARYING ASC-ITEM-SUB                                     FSKCS059
01277          FROM 1 BY 1                                              FSKCS059
01278          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 FSKCS059
01279                                                                   FSKCS059
01280      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               FSKCS059
01281                                    TO  PV-LIST-ITEM-NUMBER.       FSKCS059
01282      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            FSKCS059
01283          1 + ((PV-LIST-ITEM-NUMBER - 1) /                         FSKCS059
01284                PC-ITEMS-PER-PANEL).                               FSKCS059
01285                                                                   FSKCS059
01286      MOVE ASC-START-OF-SELECTED-RANGE                             FSKCS059
01287                                    TO PV-START-OF-SELECTED-RANGE. FSKCS059
01288      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            FSKCS059
01289          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  FSKCS059
01290                PC-ITEMS-PER-PANEL).                               FSKCS059
01291                                                                   FSKCS059
01292      MOVE ASC-END-OF-SELECTED-RANGE                               FSKCS059
01293                                    TO  PV-END-OF-SELECTED-RANGE.  FSKCS059
01294      COMPUTE PV-LAST-BLOCK-IN-RANGE =                             FSKCS059
01295          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    FSKCS059
01296                PC-ITEMS-PER-PANEL).                               FSKCS059
01297      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             FSKCS059
01298          PV-FIRST-BLOCK-IN-ARRAY + 1.                             FSKCS059
01299                                                                   FSKCS059
01300      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    FSKCS059
01301         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        FSKCS059
01302          MOVE +1                   TO ASC-BLK-SUB                 FSKCS059
01303          PERFORM 5100-WRITE-TEMP-STORAGE                          FSKCS059
01304          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         FSKCS059
01305              PV-FIRST-BLOCK-IN-ARRAY - 1                          FSKCS059
01306                                                                   FSKCS059
01307          PERFORM                                                  FSKCS059
01308              UNTIL PV-FIRST-BLOCK-IN-RANGE >                      FSKCS059
01309                    PV-PREV-BLOCK-IN-ARRAY                         FSKCS059
01310              MOVE PV-FIRST-BLOCK-IN-RANGE                         FSKCS059
01311                                    TO PV-BLOCK-NUMBER             FSKCS059
01312              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
01313              PERFORM 3510-MARK-SELECTED-INDS                      FSKCS059
01314                  VARYING ASC-ITEM-SUB                             FSKCS059
01315                  FROM 1 BY 1                                      FSKCS059
01316                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          FSKCS059
01317              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
01318              ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     FSKCS059
01319          END-PERFORM                                              FSKCS059
01320                                                                   FSKCS059
01321          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         FSKCS059
01322              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     FSKCS059
01323          PERFORM                                                  FSKCS059
01324              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       FSKCS059
01325                    PV-LAST-BLOCK-IN-RANGE                         FSKCS059
01326              MOVE PV-NEXT-BLOCK-IN-ARRAY                          FSKCS059
01327                                    TO PV-BLOCK-NUMBER             FSKCS059
01328              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
01329              PERFORM 3510-MARK-SELECTED-INDS                      FSKCS059
01330                  VARYING ASC-ITEM-SUB                             FSKCS059
01331                  FROM 1 BY 1                                      FSKCS059
01332                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          FSKCS059
01333              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
01334              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      FSKCS059
01335          END-PERFORM                                              FSKCS059
01336                                                                   FSKCS059
01337          MOVE PV-FIRST-BLOCK-IN-ARRAY                             FSKCS059
01338                                    TO PV-BLOCK-NUMBER             FSKCS059
01339          PERFORM 4410-READ-TEMP-STORAGE                           FSKCS059
01340      END-IF.                                                      FSKCS059
01341                                                                   FSKCS059
01342      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE FSKCS059
01343                                       ASC-END-OF-SELECTED-RANGE.  FSKCS059
01344                                                                   FSKCS059
01345 *----------------------------------------------------------------*FSKCS059
01346 * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *FSKCS059
01347 *----------------------------------------------------------------*FSKCS059
01348  3510-MARK-SELECTED-INDS.                                         FSKCS059
01349                                                                   FSKCS059
01350      IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         FSKCS059
01351                                 ASC-ITEM-SUB) >                   FSKCS059
01352          ASC-START-OF-SELECTED-RANGE)                             FSKCS059
01353      OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         FSKCS059
01354                                 ASC-ITEM-SUB) =                   FSKCS059
01355          ASC-START-OF-SELECTED-RANGE)                             FSKCS059
01356                                                                   FSKCS059
01357          IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     FSKCS059
01358                                     ASC-ITEM-SUB) <               FSKCS059
01359              ASC-END-OF-SELECTED-RANGE)                           FSKCS059
01360          OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     FSKCS059
01361                                     ASC-ITEM-SUB) =               FSKCS059
01362              ASC-END-OF-SELECTED-RANGE)                           FSKCS059
01363                                                                   FSKCS059
01364              IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          FSKCS059
01365                  SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   FSKCS059
01366                      ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   FSKCS059
01367                                TO TRUE                            FSKCS059
01368                  SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              FSKCS059
01369                                TO TRUE                            FSKCS059
01370                  ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    FSKCS059
01371              END-IF                                               FSKCS059
01372          END-IF                                                   FSKCS059
01373      END-IF.                                                      FSKCS059
01374                                                                   FSKCS059
01375 *----------------------------------------------------------------*FSKCS059
01376 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *FSKCS059
01377 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *FSKCS059
01378 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *FSKCS059
01379 *    DISPLAY THE PANEL TO USER.                                  *FSKCS059
01380 *----------------------------------------------------------------*FSKCS059
01381  4000-BUILD-INITIAL-PANEL.                                        FSKCS059
01382                                                                   FSKCS059
01383      INITIALIZE                  ASC-BLOCK-ENTRIES (1)            FSKCS059
01384                                  ASC-BLOCK-ENTRIES (2).           FSKCS059
01385      MOVE +1                 TO ASC-BLK-SUB.                      FSKCS059
01386      SET ASC-ITEMS-LEFT-ON-DB                                     FSKCS059
01387                              TO TRUE.                             FSKCS059
01388                                                                   FSKCS059
01389      MOVE +0                 TO ASC-ITEM-SUB                      FSKCS059
01390                                 ASC-NUMBER-OF-ITEMS-READ          FSKCS059
01391                                 ASC-NUMBER-OF-SELECTED-ITEMS      FSKCS059
01392                                 ASC-HIGHEST-BLOCK-WRITTEN         FSKCS059
01393                                 ASC-START-OF-SELECTED-RANGE       FSKCS059
01394                                 ASC-END-OF-SELECTED-RANGE         FSKCS059
01395                                 ASC-ITEM-AT-TOP-OF-PANEL.         FSKCS059
01396                                                                   FSKCS059
JP0500     SET PS-READ-CURSOR-DONE TO TRUE.                             FSKCS059
01397      PERFORM 4050-PREPARE-CURSOR-KEY                              FSKCS059
01398                                                                   FSKCS059
JP0500     IF  PS-READ-CURSOR                                                   
JP0500         PERFORM 4500-OPEN-CSRA                                           
JP0500         PERFORM 4200-READ-ITEMS-FROM-DB                                  
JP0500         PERFORM 4700-CLOSE-CSRA                                          
JP0500     ELSE                                                                 
JP0500         PERFORM 4100-OPEN-CURSOR                                 FSKCS059
JP0500         PERFORM 4200-READ-ITEMS-FROM-DB                          FSKCS059
JP0500         PERFORM 4300-CLOSE-CURSOR                                FSKCS059
JP0500     END-IF.                                                              
01404                                                                   FSKCS059
01405      MOVE +1                   TO  PV-TOP-ITEM.                   FSKCS059
01406      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          FSKCS059
01407          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    FSKCS059
01408          SET DP020-MSG-FATAL   TO  TRUE                           FSKCS059
01409          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               FSKCS059
01410      ELSE                                                         FSKCS059
01411          MOVE -1               TO MR-SELECTL (1)                  FSKCS059
01412          SET DP030-SET-CURSOR-APPL-1                              FSKCS059
01413                                TO TRUE                            FSKCS059
01414          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     FSKCS059
01415      END-IF.                                                      FSKCS059
01416                                                                   FSKCS059
01417 *----------------------------------------------------------------*FSKCS059
01418 * PREPARE THE DB KEY BY REPLACING * WITH %                       *FSKCS059
01419 *----------------------------------------------------------------*FSKCS059
01420  4050-PREPARE-CURSOR-KEY.                                         FSKCS059
01421                                                                   FSKCS059
01422      IF ASC-KEY-DEPT-NMBR > SPACES                                FSKCS059
01422         MOVE ASC-KEY-DEPT-NMBR    TO DK-DEPT-LOW                  FSKCS059
01422                                      DK-DEPT-HIGH                 FSKCS059
01422      ELSE                                                         FSKCS059
01422         MOVE LOW-VALUES           TO DK-DEPT-LOW                  FSKCS059
01422         MOVE HIGH-VALUES          TO DK-DEPT-HIGH                 FSKCS059
           END-IF.                                                              
                                                                                
01626      IF ASC-KEY-VEND-TYPE > SPACES                                   CL**3
01626         MOVE ASC-KEY-VEND-TYPE  TO DK-VEND-TYPE-CDE                  CL**3
           ELSE                                                                 
01626         MOVE '01'               TO DK-VEND-TYPE-CDE                  CL**3
           END-IF.                                                              
                                                                                
01422      MOVE ASC-KEY-VEND-NAME    TO DK-VEND-NAME.                   FSKCS059
01421                                                                   FSKCS059
01424      IF DK-VEND-NAME > SPACES                                     FSKCS059
01425          IF DK-VEND-NAME-BYTE (1) = '*'                           FSKCS059
01426              MOVE PC-PERCENT   TO DK-VEND-NAME-BYTE (1)           FSKCS059
01427              INSPECT DK-VEND-NAME                                 FSKCS059
01428                  REPLACING FIRST '*' BY PC-PERCENT                FSKCS059
01429          END-IF                                                   FSKCS059
01430          SET PS-NOT-DONE TO TRUE                                  FSKCS059
01431          PERFORM VARYING PV-SUB                                   FSKCS059
01432              FROM LENGTH OF DK-VEND-NAME BY -1                    FSKCS059
01433              UNTIL PV-SUB = 1                                     FSKCS059
01434                 OR PS-DONE                                        FSKCS059
01435                  IF DK-VEND-NAME-BYTE (PV-SUB) = '*'              FSKCS059
01436                      MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)FSKCS059
01437                      SET PS-DONE TO TRUE                          FSKCS059
01438                  END-IF                                           FSKCS059
01439                  IF DK-VEND-NAME-BYTE (PV-SUB) > SPACES           FSKCS059
01440                      SET PS-DONE TO TRUE                          FSKCS059
01441                  ELSE                                             FSKCS059
01442                      MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)FSKCS059
01443                  END-IF                                           FSKCS059
01444          END-PERFORM                                              FSKCS059
01445      ELSE                                                         FSKCS059
JP0500         SET PS-READ-CURSOR TO TRUE.                              FSKCS059
                                                                                
01448 *----------------------------------------------------------------*FSKCS059
01449 * OPEN  THE VENDOR   CURSOR.                                     *FSKCS059
01450 *----------------------------------------------------------------*FSKCS059
01451  4100-OPEN-CURSOR.                                                FSKCS059
01452                                                                   FSKCS059
01453      PERFORM                                                      FSKCS059
01454          WITH TEST AFTER                                          FSKCS059
01455          VARYING PV-RETRY-COUNTER                                 FSKCS059
01456          FROM 1 BY 1                                              FSKCS059
01457          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               FSKCS059
01458                    OR (SQLCODE = ZERO))                           FSKCS059
01459              MOVE 'CURSOR:  VENDOR-CSR'                           FSKCS059
01460                                TO DP013-MESSAGE-TEXT (2)          FSKCS059
01461              EXEC SQL                                             FSKCS059
01462                   OPEN VENDOR-CSR                                 FSKCS059
01463              END-EXEC                                             FSKCS059
01464                                                                   FSKCS059
01465          EVALUATE TRUE                                            FSKCS059
01466              WHEN SQLCODE = ZERO                                  FSKCS059
01467              WHEN SQLCODE = -904                                  FSKCS059
01468              WHEN SQLCODE = -913                                  FSKCS059
01469                  CONTINUE                                         FSKCS059
01470              WHEN SQLWARN0 NOT = SPACES                           FSKCS059
01471              WHEN SQLCODE < ZERO                                  FSKCS059
01472              WHEN SQLCODE > ZERO                                  FSKCS059
01473                  MOVE '4100-OPEN-CURSOR'                          FSKCS059
01474                                    TO DP013-PARAGRAPH             FSKCS059
01475                  MOVE 'OPEN VENDOR CURSOR - '                     FSKCS059
01476                                    TO DP013-MESSAGE-TEXT (1)      FSKCS059
01477                  MOVE SQLCA        TO DP013-SQLCA                 FSKCS059
01478                  MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    FSKCS059
01479                  SET DP013-DB2-ABEND                              FSKCS059
01480                      DP013-XCTL-DISPLAY-RESTART TO TRUE           FSKCS059
01481                  PERFORM DP013-0000-PROCESS-ABEND                 FSKCS059
01482          END-EVALUATE                                             FSKCS059
01483      END-PERFORM.                                                 FSKCS059
01484                                                                   FSKCS059
01485      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        FSKCS059
01486          MOVE '4100-OPEN-CURSOR'   TO DP013-PARAGRAPH             FSKCS059
01487          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   FSKCS059
01488                                    TO DP013-MESSAGE-TEXT (1)      FSKCS059
01489          MOVE SQLCA                TO DP013-SQLCA                 FSKCS059
01490          MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    FSKCS059
01491          SET DP013-DB2-ABEND                                      FSKCS059
01492              DP013-XCTL-DISPLAY-RESTART                           FSKCS059
01493                                    TO TRUE                        FSKCS059
01494          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
01495      END-IF.                                                      FSKCS059
01496                                                                   FSKCS059
01497 *----------------------------------------------------------------*FSKCS059
01498 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *FSKCS059
01499 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *FSKCS059
01500 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *FSKCS059
01501 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *FSKCS059
01502 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *FSKCS059
01503 *----------------------------------------------------------------*FSKCS059
01504  4200-READ-ITEMS-FROM-DB.                                         FSKCS059
01505                                                                   FSKCS059
01506      PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                      CL**3
01507              UNTIL   PV-READ-COUNT > PC-MAX-ITEMS OR                 CL**3
01508                      ASC-NO-ITEMS-LEFT-ON-DB                         CL**3
01509                                                                   FSKCS059
JP0500             IF  PS-READ-CURSOR                                           
JP0500                 PERFORM 4600-FETCH-CSRA                                  
JP0500             ELSE                                                         
01510                  PERFORM 4210-FETCH                                  CL**3
JP0500             END-IF                                                       
01511                                                                   FSKCS059
01512              IF ASC-ITEMS-LEFT-ON-DB                                 CL**3
01513                 IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 CL**3
01514                     CONTINUE                                         CL*10
01515                 ELSE                                                 CL**3
01516                     ADD  +1 TO ASC-BLK-SUB                           CL**3
01517                     MOVE +0 TO ASC-ITEM-SUB                          CL**9
01518                     IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          CL**3
01519                         MOVE +1 TO ASC-BLK-SUB                       CL**3
01520                         SET ASC-BLOCK-MODIFIED (1) TO TRUE           CL**3
01521                                                                      CL**3
01522                         PERFORM 5100-WRITE-TEMP-STORAGE              CL**3
01523                                                                      CL**3
01524                         MOVE ASC-BLOCK-ENTRIES                       CL**3
01525                                           (PC-MAX-BLOCKS-IN-ARRAY)   CL**3
01526                                 TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
01527                         ADD +1 TO ASC-BLK-SUB                        CL**3
01528                         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
01529                         SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)   CL**3
01530                                                            TO TRUE   CL**3
01531                     END-IF                                           CL**3
01532                 END-IF                                               CL**3
01533                 PERFORM 4220-MOVE-VENDOR-INFO THRU 4220-EXIT         CL*10
01534              END-IF                                                  CL**3
01535      END-PERFORM.                                                 FSKCS059
01536                                                                   FSKCS059
01537      IF ASC-NUMBER-OF-ITEMS-READ > ZERO                              CL**3
01538          MOVE +1 TO ASC-BLK-SUB                                      CL**3
01539                                                                      CL**3
01540          PERFORM 5100-WRITE-TEMP-STORAGE                          FSKCS059
01541                                                                      CL**3
01542          ADD  +1 TO ASC-BLK-SUB                                      CL**3
01543                                                                      CL**8
01544          PERFORM 5100-WRITE-TEMP-STORAGE                          FSKCS059
01545                                                                   FSKCS059
01546          MOVE 1  TO ASC-BLK-SUB                                      CL**3
01547                     PV-BLOCK-NUMBER                                  CL**3
01548                                                                      CL**3
01549          PERFORM 4410-READ-TEMP-STORAGE                           FSKCS059
01550                                                                      CL**3
01551          IF ASC-HIGHEST-BLOCK-WRITTEN > 1                            CL**3
01552              MOVE 2 TO ASC-BLK-SUB                                   CL**3
01553                        PV-BLOCK-NUMBER                               CL**3
01554                                                                      CL**3
01555              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
01556          END-IF                                                   FSKCS059
01557      END-IF.                                                      FSKCS059
01558                                                                   FSKCS059
01448 *----------------------------------------------------------------*FSKCS059
01449 * FETCH THE VENDOR   CURSOR.                                     *FSKCS059
01450 *----------------------------------------------------------------*FSKCS059
01559  4210-FETCH.                                                      FSKCS059
01560                                                                   FSKCS059
01561      EXEC SQL                                                     FSKCS059
01562           FETCH VENDOR-CSR                                        FSKCS059
01563           INTO  :ENTNME-ENT-ID                                       CL**3
01564                ,:ENTNME-ENT-NAME-DESC                                CL**3
01565                ,:ENTNME-TYPE-CDE                                     CL**3
01566                ,:EXTENT-MDSE-VENDOR-IND                              CL**3
01567                ,:EXTENT-CARRIER-IND                                  CL**3
01568                ,:EXTENT-EXP-VEND-IND                                 CL**3
01569      END-EXEC                                                     FSKCS059
01570                                                                   FSKCS059
01571      EVALUATE TRUE                                                FSKCS059
01572          WHEN SQLCODE = ZERO                                      FSKCS059
01573          WHEN SQLCODE = +100                                      FSKCS059
01574               CONTINUE                                            FSKCS059
01575          WHEN SQLWARN0 NOT = SPACE                                FSKCS059
01576          WHEN SQLCODE NOT = ZERO                                  FSKCS059
01577               MOVE '4310-FETCH-CURSOR'                            FSKCS059
01578                                TO DP013-PARAGRAPH                 FSKCS059
01579               MOVE 'FETCH VENDOR CURSOR'                          FSKCS059
01580                                TO DP013-MESSAGE-TEXT (1)          FSKCS059
01581               MOVE SQLCA       TO DP013-SQLCA                     FSKCS059
01582               SET DP013-DB2-ABEND                                 FSKCS059
01583                                TO TRUE                            FSKCS059
01584               PERFORM DP013-0000-PROCESS-ABEND                    FSKCS059
01585      END-EVALUATE.                                                FSKCS059
01586                                                                   FSKCS059
01587      IF  SQLCODE EQUAL +100                                       FSKCS059
01588          SET ASC-NO-ITEMS-LEFT-ON-DB                              FSKCS059
01589                                    TO TRUE                        FSKCS059
01590      END-IF.                                                      FSKCS059
                                                                                
01448 *----------------------------------------------------------------*FSKCS059
01449 * MOVE VENDOR INFORMATION TO THE APPL SPECIFIC COMMAREA          *FSKCS059
01450 *----------------------------------------------------------------*FSKCS059
01533  4220-MOVE-VENDOR-INFO.                                              CL*10
                                                                                
01622      ADD +1 TO ASC-ITEM-SUB                                          CL**7
01623                ASC-NUMBER-OF-ITEMS-READ.                             CL**7
01624      MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL**3
01625                                        (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01626 *    MOVE ASC-KEY-VEND-TYPE    TO ASC-VEND-TYPE                      CL**3
01627 *                                      (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01626      MOVE ENTNME-TYPE-CDE      TO ASC-VEND-TYPE                      CL**3
01627                                        (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01628      MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME                      CL**3
01629                                        (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01630      MOVE ENTNME-TYPE-CDE      TO ASC-TYPE-CDE                       CL**3
01631                                        (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01632      MOVE ENTNME-ENT-ID        TO ASC-ENT-ID                         CL**3
01633                                        (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01634      PERFORM 4222-GET-PRIM-NAME.                                     CL**3
01635                                                                      CL**3
01636      MOVE DK-PRIM-NAME         TO ASC-PRM-NME                        CL**3
01637                                        (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
01638  4220-EXIT.                                                          CL**3
01639      EXIT.                                                           CL**3
01640                                                                      CL**3
01641 *----------------------------------------------------------------*FSKCS059
01642 * GET THE PRIMARY NAME OF THE VENDOR                             *FSKCS059
01643 *----------------------------------------------------------------*FSKCS059
01644  4222-GET-PRIM-NAME.                                                 CL**3
01645                                                                   FSKCS059
01646      EXEC SQL                                                     FSKCS059
01647           SELECT ENT_NAME_DESC                                    FSKCS059
01648             INTO :DK-PRIM-NAME                                       CL**8
01649             FROM TENTNME                                             CL**8
01650            WHERE ENT_ID = :ENTNME-ENT-ID                             CL**8
01651              AND TYPE_CDE = '01'                                     CL**8
01652      END-EXEC                                                     FSKCS059
01653                                                                   FSKCS059
01654      EVALUATE TRUE                                                FSKCS059
01655          WHEN SQLCODE = ZERO                                      FSKCS059
01656               CONTINUE                                               CL**8
01657                                                                      CL**8
01658          WHEN SQLCODE = +100                                      FSKCS059
01659               MOVE SPACES TO DK-PRIM-NAME                            CL**8
01660                                                                      CL**8
01661          WHEN SQLWARN0 NOT = SPACES                               FSKCS059
01662          WHEN SQLCODE < ZERO                                      FSKCS059
01663          WHEN SQLCODE > ZERO                                      FSKCS059
01664              MOVE '4222-GET-PRIM-NAME'                               CL**3
01665                                TO DP013-PARAGRAPH                 FSKCS059
01666              MOVE 'SELECT TENTNME'                                FSKCS059
01667                                TO DP013-MESSAGE-TEXT (1)          FSKCS059
01668              MOVE SQLCA        TO DP013-SQLCA                     FSKCS059
01669              MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        FSKCS059
01670              SET DP013-DB2-ABEND                                  FSKCS059
01671                  DP013-XCTL-DISPLAY-RESTART TO TRUE               FSKCS059
01672              PERFORM DP013-0000-PROCESS-ABEND                     FSKCS059
01673      END-EVALUATE.                                                FSKCS059
01674                                                                   FSKCS059
01675 *----------------------------------------------------------------*FSKCS059
01676 * CLOSE THE VENDOR   CURSOR.                                     *FSKCS059
01677 *----------------------------------------------------------------*FSKCS059
01678  4300-CLOSE-CURSOR.                                               FSKCS059
01679                                                                   FSKCS059
01680      EXEC SQL                                                     FSKCS059
01681          CLOSE VENDOR-CSR                                         FSKCS059
01682      END-EXEC                                                     FSKCS059
01683                                                                   FSKCS059
01684      EVALUATE TRUE                                                FSKCS059
01685          WHEN SQLCODE = ZERO                                      FSKCS059
01686              CONTINUE                                             FSKCS059
01687          WHEN SQLWARN0 NOT = SPACES                               FSKCS059
01688          WHEN SQLCODE < ZERO                                      FSKCS059
01689          WHEN SQLCODE > ZERO                                      FSKCS059
01690              MOVE '4300-CLOSE-CURSOR'                             FSKCS059
01691                                TO DP013-PARAGRAPH                 FSKCS059
01692              MOVE 'CLOSE VENDOR CURSOR '                          FSKCS059
01693                                TO DP013-MESSAGE-TEXT (1)          FSKCS059
01694              MOVE SQLCA        TO DP013-SQLCA                     FSKCS059
01695              MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        FSKCS059
01696              SET DP013-DB2-ABEND                                  FSKCS059
01697                  DP013-XCTL-DISPLAY-RESTART TO TRUE               FSKCS059
01698              PERFORM DP013-0000-PROCESS-ABEND                     FSKCS059
01699      END-EVALUATE.                                                FSKCS059
01700                                                                   FSKCS059
01701 *----------------------------------------------------------------*FSKCS059
01702 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *FSKCS059
01703 *----------------------------------------------------------------*FSKCS059
01704  4400-MOVE-COMMAREA-TO-SCREEN.                                    FSKCS059
01705                                                                   FSKCS059
01706      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             FSKCS059
01707          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          FSKCS059
01708          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          FSKCS059
01709              MOVE +1    TO ASC-BLK-SUB                            FSKCS059
01710              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
01711              ADD +1     TO ASC-BLK-SUB                            FSKCS059
01712              PERFORM 5100-WRITE-TEMP-STORAGE                      FSKCS059
01713              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             FSKCS059
01714                  GIVING PV-BLOCK-NUMBER                           FSKCS059
01715                  REMAINDER PV-REMAINDER                           FSKCS059
01716              IF  PV-REMAINDER > ZERO                              FSKCS059
01717                  ADD +1 TO PV-BLOCK-NUMBER                        FSKCS059
01718              END-IF                                               FSKCS059
01719              MOVE +1    TO ASC-BLK-SUB                            FSKCS059
01720              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
01721              ADD +1     TO ASC-BLK-SUB                            FSKCS059
01722                            PV-BLOCK-NUMBER                        FSKCS059
01723              PERFORM 4410-READ-TEMP-STORAGE                       FSKCS059
01724      END-IF.                                                      FSKCS059
01725      MOVE +1            TO ASC-BLK-SUB.                           FSKCS059
01726      COMPUTE ASC-ITEM-SUB =                                       FSKCS059
01727          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              FSKCS059
01728          + PC-ITEMS-PER-PANEL).                                   FSKCS059
01729                                                                   FSKCS059
01730      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        FSKCS059
01731          ADD +1         TO ASC-BLK-SUB                            FSKCS059
01732          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            FSKCS059
01733      END-IF.                                                      FSKCS059
01734                                                                   FSKCS059
01735      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           FSKCS059
01736          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                FSKCS059
01737      PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        FSKCS059
01738      PERFORM 4420-FORMAT-LIST-LINES                               FSKCS059
01739          VARYING PV-SUB                                           FSKCS059
01740          FROM PC-ITEMS-PER-PANEL BY -1                            FSKCS059
01741          UNTIL PV-SUB < +1.                                       FSKCS059
01742                                                                   FSKCS059
01743      COMPUTE ASC-ITEMS-DISPLAYED =                                FSKCS059
01744          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          FSKCS059
01745      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    FSKCS059
01746                                       ASTRTITO.                   FSKCS059
01747      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    FSKCS059
01748      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    FSKCS059
01749      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            FSKCS059
01750                                    TO ASELITO.                    FSKCS059
01751                                                                   FSKCS059
01752      IF  DP020-MSG-NUMBER-X = SPACE                               FSKCS059
01753          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  FSKCS059
01754 *            --- MORE ITEMS TO DISPLAY ----                       FSKCS059
01755              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            FSKCS059
01756              SET DP020-MSG-INFORMATIONAL TO TRUE                  FSKCS059
01757          END-IF                                                   FSKCS059
01758      END-IF.                                                      FSKCS059
01759                                                                   FSKCS059
01760 *----------------------------------------------------------------*FSKCS059
01761 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *FSKCS059
01762 *----------------------------------------------------------------*FSKCS059
01763  4410-READ-TEMP-STORAGE.                                          FSKCS059
01764                                                                   FSKCS059
01765      EXEC CICS                                                    FSKCS059
01766          READQ TS                                                 FSKCS059
01767              QUEUE (ASC-LIST-QUEUE-NAME)                          FSKCS059
01768              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               FSKCS059
01769              ITEM  (PV-BLOCK-NUMBER)                              FSKCS059
01770              RESP  (PV-CICS-RESP)                                 FSKCS059
01771      END-EXEC.                                                    FSKCS059
01772                                                                   FSKCS059
01773      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       FSKCS059
01774        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     FSKCS059
01775          CONTINUE                                                 FSKCS059
01776      ELSE                                                         FSKCS059
01777          SET DP013-CICS-ABEND     TO TRUE                         FSKCS059
01778          SET DP013-NO-ROLLBACK    TO TRUE                         FSKCS059
01779          MOVE '4410-READ-TEMP-STORAGE'                            FSKCS059
01780                                   TO DP013-PARAGRAPH              FSKCS059
01781          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      FSKCS059
01782                                   TO DP013-MESSAGE-TEXT(1)        FSKCS059
01783          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
01784      END-IF.                                                      FSKCS059
01785                                                                   FSKCS059
01786      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             FSKCS059
01787                                                                   FSKCS059
01788      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         FSKCS059
01789          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               FSKCS059
01790      END-IF.                                                      FSKCS059
01791                                                                   FSKCS059
01792 *----------------------------------------------------------------*FSKCS059
01793 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *FSKCS059
01794 *----------------------------------------------------------------*FSKCS059
01795  4420-FORMAT-LIST-LINES.                                          FSKCS059
01796                                                                   FSKCS059
01797      IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ          CL**6
01798          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                FSKCS059
01799          MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA   (PV-SUB)            CL**6
01800          MOVE SPACES             TO MR-SELECTI   (PV-SUB)            CL**6
01801                                     MR-ACTION    (PV-SUB)            CL**6
01802 *                                   MR-VEND-TYPE (PV-SUB)            CL**6
01803                                     MR-VEND-NAME (PV-SUB)         FSKCS059
01804                                     MR-TYPE-DSC  (PV-SUB)            CL**6
01805                                     MR-PRM-NME   (PV-SUB)            CL**6
01806      ELSE                                                         FSKCS059
01807          IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          CL**6
01808                                                            > SPACE   CL**6
01809              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) FSKCS059
01810                                            TO MR-SELECTI (PV-SUB)    CL**6
01811          ELSE                                                     FSKCS059
01812              MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      FSKCS059
01813                                            TO MR-SELECTI (PV-SUB)    CL**6
01814          END-IF                                                   FSKCS059
01815                                                                   FSKCS059
01816          IF DP030-SET-CURSOR-TRAILER                                 CL**6
01817              IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CL**6
01818                                                            > SPACE   CL**6
01819                 OR PV-SUB = 1                                        CL**6
01820                  SET DP030-SET-CURSOR-APPL-1 TO TRUE                 CL**6
01821                  MOVE -1 TO MR-SELECTL (PV-SUB)                      CL**6
01822              END-IF                                               FSKCS059
01823          END-IF                                                   FSKCS059
01824                                                                   FSKCS059
01825          IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL               CL**6
01826              MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)           CL**6
01827                                              TO MR-ACTION (PV-SUB)   CL**6
01828 *            MOVE ASC-VEND-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)           CL**5
01829 *                                         TO MR-VEND-TYPE (PV-SUB)   CL**6
01830              MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)           CL**5
01831                                           TO MR-VEND-NAME (PV-SUB)   CL**6
01832              MOVE ASC-PRM-NME   (ASC-BLK-SUB ASC-ITEM-SUB)           CL**6
01833                                             TO MR-PRM-NME (PV-SUB)   CL**6
01834              EVALUATE ASC-TYPE-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     FSKCS059
01835                  WHEN PC-PRIMARY                                  FSKCS059
01836                       MOVE PL-PRIMARY TO MR-TYPE-DSC (PV-SUB)        CL**6
01837                  WHEN PC-ALIAS                                    FSKCS059
01838                       MOVE PL-ALIAS TO MR-TYPE-DSC (PV-SUB)          CL**6
01839                  WHEN PC-LABEL                                    FSKCS059
01840                       MOVE PL-LABEL TO MR-TYPE-DSC (PV-SUB)          CL**6
01841                  WHEN PC-SHORTNAME                                FSKCS059
01842                       MOVE PL-SHORTNAME TO MR-TYPE-DSC (PV-SUB)      CL**6
01843              END-EVALUATE                                         FSKCS059
01844          END-IF                                                   FSKCS059
01845      END-IF.                                                      FSKCS059
01846                                                                      CL**6
01847      SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**6
01848                                                                      CL**6
01849      IF ASC-ITEM-SUB < + 1                                           CL**6
01850          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  FSKCS059
01851          MOVE +1                 TO ASC-BLK-SUB                   FSKCS059
01852      END-IF.                                                      FSKCS059
01853                                                                   FSKCS059
01854 ******************************************************************FSKCS059
01855 ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **FSKCS059
01856 ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **FSKCS059
01857 ** ISSUE A WARNING.                                             **FSKCS059
01858 ******************************************************************FSKCS059
01859  4430-CHECK-FOR-BEGIN-AND-END.                                    FSKCS059
01860                                                                   FSKCS059
01861      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       FSKCS059
01862          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     FSKCS059
01863 *            -- NO END-OF-RANGE SPECFIED ---                      FSKCS059
01864              MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            FSKCS059
01865              SET DP020-MSG-WARNING TO TRUE                        FSKCS059
01866              PERFORM 4431-POSITION-AT-WARNING                     FSKCS059
01867          END-IF                                                   FSKCS059
01868      ELSE                                                         FSKCS059
01869          IF  ASC-END-OF-SELECTED-RANGE > ZERO                     FSKCS059
01870 *            -- NO BEGINNING-OF-RANGE SPECFIED ---                FSKCS059
01871              MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            FSKCS059
01872              SET DP020-MSG-WARNING TO TRUE                        FSKCS059
01873              PERFORM 4431-POSITION-AT-WARNING                     FSKCS059
01874          END-IF                                                   FSKCS059
01875      END-IF.                                                      FSKCS059
01876                                                                   FSKCS059
01877 ******************************************************************FSKCS059
01878 ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **FSKCS059
01879 ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **FSKCS059
01880 ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **FSKCS059
01881 ** POSITION THE CURSOR THERE.                                   **FSKCS059
01882 ******************************************************************FSKCS059
01883  4431-POSITION-AT-WARNING.                                        FSKCS059
01884                                                                   FSKCS059
01885      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 FSKCS059
01886                     - PV-TOP-ITEM + 1.                            FSKCS059
01887      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      FSKCS059
01888          CONTINUE                                                 FSKCS059
01889      ELSE                                                         FSKCS059
01890          SET DP030-SET-CURSOR-APPL-1                              FSKCS059
01891                                    TO TRUE                        FSKCS059
01892          MOVE -1                   TO MR-SELECTL (PV-SUB)         FSKCS059
01893          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         FSKCS059
01894          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         FSKCS059
01895      END-IF.                                                      FSKCS059
01896                                                                   FSKCS059
01897      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   FSKCS059
01898                     - PV-TOP-ITEM + 1.                            FSKCS059
01899      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      FSKCS059
01900          CONTINUE                                                 FSKCS059
01901      ELSE                                                         FSKCS059
01902          SET DP030-SET-CURSOR-APPL-1                              FSKCS059
01903                                    TO TRUE                        FSKCS059
01904          MOVE -1                   TO MR-SELECTL (PV-SUB)         FSKCS059
01905          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         FSKCS059
01906          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         FSKCS059
01907      END-IF.                                                      FSKCS059
                                                                                
JP0500*----------------------------------------------------------------*FSKCS059
JP0500* OPEN  THE SECOND VENDOR   CURSOR.                              *FSKCS059
JP0500*----------------------------------------------------------------*FSKCS059
JP0500 4500-OPEN-CSRA.                                                  FSKCS059
JP0500                                                                  FSKCS059
JP0500     PERFORM                                                      FSKCS059
JP0500         WITH TEST AFTER                                          FSKCS059
JP0500         VARYING PV-RETRY-COUNTER                                 FSKCS059
JP0500         FROM 1 BY 1                                              FSKCS059
JP0500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               FSKCS059
JP0500                   OR (SQLCODE = ZERO))                           FSKCS059
JP0500             MOVE 'CURSOR:  VENDOR-CSRA'                          FSKCS059
JP0500                               TO DP013-MESSAGE-TEXT (2)          FSKCS059
JP0500             EXEC SQL                                             FSKCS059
JP0500                  OPEN VENDOR-CSRA                                FSKCS059
JP0500             END-EXEC                                             FSKCS059
JP0500                                                                  FSKCS059
JP0500         EVALUATE TRUE                                            FSKCS059
JP0500             WHEN SQLCODE = ZERO                                  FSKCS059
JP0500             WHEN SQLCODE = -904                                  FSKCS059
JP0500             WHEN SQLCODE = -913                                  FSKCS059
JP0500                 CONTINUE                                         FSKCS059
JP0500             WHEN SQLWARN0 NOT = SPACES                           FSKCS059
JP0500             WHEN SQLCODE < ZERO                                  FSKCS059
JP0500             WHEN SQLCODE > ZERO                                  FSKCS059
JP0500                 MOVE '4500-OPEN-CSRA'                            FSKCS059
JP0500                                   TO DP013-PARAGRAPH             FSKCS059
JP0500                 MOVE 'OPEN VENDOR CURSOR A - '                   FSKCS059
JP0500                                   TO DP013-MESSAGE-TEXT (1)      FSKCS059
JP0500                 MOVE SQLCA        TO DP013-SQLCA                 FSKCS059
JP0500                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    FSKCS059
JP0500                 SET DP013-DB2-ABEND                              FSKCS059
JP0500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           FSKCS059
JP0500                 PERFORM DP013-0000-PROCESS-ABEND                 FSKCS059
JP0500         END-EVALUATE                                             FSKCS059
JP0500     END-PERFORM.                                                 FSKCS059
JP0500                                                                  FSKCS059
JP0500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        FSKCS059
JP0500         MOVE '4500-OPEN-CSRA'     TO DP013-PARAGRAPH             FSKCS059
JP0500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSRA'  FSKCS059
JP0500                                   TO DP013-MESSAGE-TEXT (1)      FSKCS059
JP0500         MOVE SQLCA                TO DP013-SQLCA                 FSKCS059
JP0500         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    FSKCS059
JP0500         SET DP013-DB2-ABEND                                      FSKCS059
JP0500             DP013-XCTL-DISPLAY-RESTART                           FSKCS059
JP0500                                   TO TRUE                        FSKCS059
JP0500         PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
JP0500     END-IF.                                                      FSKCS059
JP0500                                                                  FSKCS059
JP0500*----------------------------------------------------------------*FSKCS059
JP0500* FETCH THE SECOND VENDOR   CURSOR.                              *FSKCS059
JP0500*----------------------------------------------------------------*FSKCS059
JP0500 4600-FETCH-CSRA.                                                 FSKCS059
JP0500                                                                  FSKCS059
JP0500     EXEC SQL                                                     FSKCS059
JP0500          FETCH VENDOR-CSRA                                       FSKCS059
JP0500          INTO  :ENTNME-ENT-ID                                       CL**3
JP0500               ,:ENTNME-ENT-NAME-DESC                                CL**3
JP0500               ,:ENTNME-TYPE-CDE                                     CL**3
JP0500               ,:EXTENT-MDSE-VENDOR-IND                              CL**3
JP0500               ,:EXTENT-CARRIER-IND                                  CL**3
JP0500               ,:EXTENT-EXP-VEND-IND                                 CL**3
JP0500     END-EXEC                                                     FSKCS059
JP0500                                                                  FSKCS059
JP0500     EVALUATE TRUE                                                FSKCS059
JP0500         WHEN SQLCODE = ZERO                                      FSKCS059
JP0500         WHEN SQLCODE = +100                                      FSKCS059
JP0500              CONTINUE                                            FSKCS059
JP0500         WHEN SQLWARN0 NOT = SPACE                                FSKCS059
JP0500         WHEN SQLCODE NOT = ZERO                                  FSKCS059
JP0500              MOVE '4600-FETCH-CSRA'                              FSKCS059
JP0500                               TO DP013-PARAGRAPH                 FSKCS059
JP0500              MOVE 'FETCH VENDOR CURSOR A'                        FSKCS059
JP0500                               TO DP013-MESSAGE-TEXT (1)          FSKCS059
JP0500              MOVE SQLCA       TO DP013-SQLCA                     FSKCS059
JP0500              SET DP013-DB2-ABEND                                 FSKCS059
JP0500                               TO TRUE                            FSKCS059
JP0500              PERFORM DP013-0000-PROCESS-ABEND                    FSKCS059
JP0500     END-EVALUATE.                                                FSKCS059
JP0500                                                                  FSKCS059
JP0500     IF  SQLCODE EQUAL +100                                       FSKCS059
JP0500         SET ASC-NO-ITEMS-LEFT-ON-DB                              FSKCS059
JP0500                                   TO TRUE                        FSKCS059
JP0500     END-IF.                                                      FSKCS059
JP0500                                                                  FSKCS059
JP0500*----------------------------------------------------------------*FSKCS059
JP0500* CLOSE THE SECOND VENDOR   CURSOR.                              *FSKCS059
JP0500*----------------------------------------------------------------*FSKCS059
JP0500 4700-CLOSE-CSRA.                                                 FSKCS059
JP0500                                                                  FSKCS059
JP0500     EXEC SQL                                                     FSKCS059
JP0500         CLOSE VENDOR-CSRA                                        FSKCS059
JP0500     END-EXEC                                                     FSKCS059
JP0500                                                                  FSKCS059
JP0500     EVALUATE TRUE                                                FSKCS059
JP0500         WHEN SQLCODE = ZERO                                      FSKCS059
JP0500             CONTINUE                                             FSKCS059
JP0500         WHEN SQLWARN0 NOT = SPACES                               FSKCS059
JP0500         WHEN SQLCODE < ZERO                                      FSKCS059
JP0500         WHEN SQLCODE > ZERO                                      FSKCS059
JP0900             MOVE '4700-CLOSE-CSRA'                               FSKCS059
JP0900                               TO DP013-PARAGRAPH                 FSKCS059
JP0900             MOVE 'CLOSE VENDOR CURSOR A'                         FSKCS059
JP0900                               TO DP013-MESSAGE-TEXT (1)          FSKCS059
JP0900             MOVE SQLCA        TO DP013-SQLCA                     FSKCS059
JP0900             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        FSKCS059
JP0900             SET DP013-DB2-ABEND                                  FSKCS059
JP0900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               FSKCS059
JP0900             PERFORM DP013-0000-PROCESS-ABEND                     FSKCS059
JP0500     END-EVALUATE.                                                FSKCS059
01908                                                                   FSKCS059
01909 *----------------------------------------------------------------*FSKCS059
01910 * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *FSKCS059
01911 * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *FSKCS059
01912 * FOR THE SELECTED ITEMS QUEUE.                                  *FSKCS059
01913 *                                                                *FSKCS059
01914 * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *FSKCS059
01915 * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *FSKCS059
01916 * THE ARRAY IS FULL.                                             *FSKCS059
01917 *----------------------------------------------------------------*FSKCS059
01918  5000-PREPARE-SEL-QUEUE.                                          FSKCS059
01919                                                                   FSKCS059
01920      MOVE +1                   TO  ASC-BLK-SUB.                   FSKCS059
01921      PERFORM 5100-WRITE-TEMP-STORAGE.                             FSKCS059
01922      ADD +1                    TO  ASC-BLK-SUB.                   FSKCS059
01923      PERFORM 5100-WRITE-TEMP-STORAGE.                             FSKCS059
01924                                                                   FSKCS059
01925      MOVE ASC-SEL-QUEUE-NAME   TO  CA-SEL-QUEUE-NAME.             FSKCS059
01926      PERFORM 6010-DELETE-SEL-QUEUE.                               FSKCS059
01927                                                                   FSKCS059
01928      SET ASC-UPDATE-TSQ        TO  TRUE.                          FSKCS059
01929                                                                   FSKCS059
01930      SET VN003-IDX             TO  1.                             FSKCS059
01931      MOVE ZERO                 TO CA-NUMBER-OF-TS-ITEMS.          FSKCS059
01932      INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        FSKCS059
01933                                                                   FSKCS059
01934      PERFORM 5200-FILL-SEL-QUEUE-RECORD                           FSKCS059
01935              VARYING PV-ITEM                                      FSKCS059
01936              FROM 1 BY 1                                          FSKCS059
01937              UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     FSKCS059
01938                                                                   FSKCS059
01939      IF  VN003-IDX > 1                                            FSKCS059
01940          PERFORM 5205-WRITE-SEL-QUEUE                             FSKCS059
01941          ADD +1                TO CA-NUMBER-OF-TS-ITEMS           FSKCS059
01942      END-IF.                                                      FSKCS059
01943                                                                   FSKCS059
01944 *----------------------------------------------------------------*FSKCS059
01945 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *FSKCS059
01946 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *FSKCS059
01947 *----------------------------------------------------------------*FSKCS059
01948  5100-WRITE-TEMP-STORAGE.                                         FSKCS059
01949                                                                   FSKCS059
01950      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     FSKCS059
01951                                    TO PV-LIST-ITEM-NUMBER.        FSKCS059
01952      COMPUTE PV-BLOCK-NUMBER =                                    FSKCS059
01953          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    FSKCS059
01954                                                                   FSKCS059
01955      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             FSKCS059
01956      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             FSKCS059
01957          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      FSKCS059
01958              PERFORM 5105-REWRITE-ASC-LISTQ                       FSKCS059
01959          END-IF                                                   FSKCS059
01960      ELSE                                                         FSKCS059
01961          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       FSKCS059
01962          ASC-HIGHEST-BLOCK-WRITTEN + 1                            FSKCS059
01963          PERFORM 5110-WRITE-ASC-LISTQ                             FSKCS059
01964          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   FSKCS059
01965      END-IF.                                                      FSKCS059
01966                                                                   FSKCS059
01967      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             FSKCS059
01968 ******************************************************************FSKCS059
01969 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **FSKCS059
01970 ** SPECIFIC COMMAREA.                                           **FSKCS059
01971 ******************************************************************FSKCS059
01972  5105-REWRITE-ASC-LISTQ.                                          FSKCS059
01973                                                                   FSKCS059
01974      EXEC CICS                                                    FSKCS059
01975          WRITEQ TS                                                FSKCS059
01976              QUEUE (ASC-LIST-QUEUE-NAME)                          FSKCS059
01977              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               FSKCS059
01978              ITEM  (PV-BLOCK-NUMBER)                              FSKCS059
01979              REWRITE                                              FSKCS059
01980              RESP  (PV-CICS-RESP)                                 FSKCS059
01981      END-EXEC.                                                    FSKCS059
01982                                                                   FSKCS059
01983      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           FSKCS059
01984          CONTINUE                                                 FSKCS059
01985      ELSE                                                         FSKCS059
01986          SET DP013-CICS-ABEND            TO TRUE                  FSKCS059
01987          SET DP013-NO-ROLLBACK           TO TRUE                  FSKCS059
01988          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       FSKCS059
01989          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     FSKCS059
01990                                          TO DP013-MESSAGE-TEXT(1) FSKCS059
01991          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
01992      END-IF.                                                      FSKCS059
01993                                                                   FSKCS059
01994 ******************************************************************FSKCS059
01995 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **FSKCS059
01996 ** SPECIFIC COMMAREA.                                           **FSKCS059
01997 ******************************************************************FSKCS059
01998  5110-WRITE-ASC-LISTQ.                                            FSKCS059
01999                                                                   FSKCS059
02000      EXEC CICS                                                    FSKCS059
02001          WRITEQ TS                                                FSKCS059
02002              QUEUE (ASC-LIST-QUEUE-NAME)                          FSKCS059
02003              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               FSKCS059
02004              ITEM  (PV-BLOCK-NUMBER)                              FSKCS059
02005              RESP  (PV-CICS-RESP)                                 FSKCS059
02006      END-EXEC.                                                    FSKCS059
02007      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      FSKCS059
02008          SET DP013-CICS-ABEND      TO TRUE                        FSKCS059
02009          SET DP013-NO-ROLLBACK     TO TRUE                        FSKCS059
02010          MOVE '5110-WRITE-ASC-LISTQ'                              FSKCS059
02011                                    TO DP013-PARAGRAPH             FSKCS059
02012          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           FSKCS059
02013                                    TO DP013-MESSAGE-TEXT(1)       FSKCS059
02014          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
02015      END-IF.                                                      FSKCS059
02016                                                                   FSKCS059
02017 *----------------------------------------------------------------*FSKCS059
02018 * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *FSKCS059
02019 * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *FSKCS059
02020 *----------------------------------------------------------------*FSKCS059
02021  5200-FILL-SEL-QUEUE-RECORD.                                      FSKCS059
02022                                                                   FSKCS059
02023      PERFORM 6112-READ-LIST-QUEUE.                                FSKCS059
02024                                                                   FSKCS059
02025      IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       FSKCS059
02026          PERFORM                                                  FSKCS059
02027          VARYING LQW-IDX                                          FSKCS059
02028          FROM 1 BY 1                                              FSKCS059
02029          UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            FSKCS059
02030            OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          FSKCS059
02031                                                                   FSKCS059
02032              IF  LQW-SELECT (LQW-IDX)                             FSKCS059
02033                  MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              FSKCS059
0034                                     TO VN003-ITEM (VN003-IDX)      FSKCS059
02035                  MOVE SPACES       TO VN003-DEPARTMENT (VN003-IDX)FSKCS059
02036                  MOVE LQW-ENT-ID (LQW-IDX)                        FSKCS059
02037                                    TO VN003-ENT-ID (VN003-IDX)    FSKCS059
02038                  MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) FSKCS059
02039                  SET VN003-IDX UP BY 1                            FSKCS059
02040                  IF  VN003-IDX > VN003-MAX-ITEMS                  FSKCS059
02041                      PERFORM 5205-WRITE-SEL-QUEUE                 FSKCS059
02042                      ADD +1        TO CA-NUMBER-OF-TS-ITEMS       FSKCS059
02043                      INITIALIZE VN003-SELECTED-ITEM-ARRAY         FSKCS059
02044                      SET VN003-IDX TO  1                          FSKCS059
02045                  END-IF                                           FSKCS059
02046              END-IF                                               FSKCS059
02047          END-PERFORM                                              FSKCS059
02048      END-IF.                                                      FSKCS059
02049                                                                   FSKCS059
02050 *----------------------------------------------------------------*FSKCS059
02051 *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *FSKCS059
02052 *----------------------------------------------------------------*FSKCS059
02053  5205-WRITE-SEL-QUEUE.                                            FSKCS059
02054                                                                   FSKCS059
02055      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            FSKCS059
02056                                    TO VN003-SELECTED-ITEMS.       FSKCS059
02057                                                                   FSKCS059
02058      EXEC CICS                                                    FSKCS059
02059           WRITEQ TS                                               FSKCS059
02060               QUEUE (ASC-SEL-QUEUE-NAME)                          FSKCS059
02061               FROM  (VN003-VENDOR-SEL-REC)                        FSKCS059
02062               ITEM  (PV-SEL-QUEUE-ITEM)                           FSKCS059
02063               RESP  (PV-CICS-RESP)                                FSKCS059
02064      END-EXEC.                                                    FSKCS059
02065                                                                   FSKCS059
02066      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          FSKCS059
02067          CONTINUE                                                 FSKCS059
02068      ELSE                                                         FSKCS059
02069          SET DP013-CICS-ABEND      TO TRUE                        FSKCS059
02070          SET DP013-NO-ROLLBACK     TO TRUE                        FSKCS059
02071          MOVE '5205-WRITE-SEL-QUEUE'                              FSKCS059
02072                                    TO DP013-PARAGRAPH             FSKCS059
02073          MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          FSKCS059
02074                                    TO DP013-MESSAGE-TEXT(1)       FSKCS059
02075          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
02076      END-IF.                                                      FSKCS059
02077                                                                   FSKCS059
02078 ******************************************************************FSKCS059
02079 ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **FSKCS059
02080 ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **FSKCS059
02081 ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **FSKCS059
02082 ** THE USER.                                                    **FSKCS059
02083 ******************************************************************FSKCS059
02084  6000-REFRESH-PANEL-FROM-TEMP.                                    FSKCS059
02085                                                                   FSKCS059
02086      IF  ASC-UPDATE-TSQ                                           FSKCS059
02087          SET ASC-NO-TSQ-UPDATE TO TRUE                            FSKCS059
02088          MOVE ZERO                 TO PV-SAVE-ITEM                FSKCS059
02089                                       PV-SEL-QUEUE-ITEM           FSKCS059
02090          MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        FSKCS059
02091                                    TO PV-HOLD-SELECTED-ITEMS      FSKCS059
02092          PERFORM 6100-UPDATE-TSQ                                  FSKCS059
02093              UNTIL PV-ITEMS-PROCESSED >                           FSKCS059
02094                                      ASC-NUMBER-OF-SELECTED-ITEMS FSKCS059
02095          PERFORM 6010-DELETE-SEL-QUEUE                            FSKCS059
02096          INITIALIZE ASC-BLOCK-ENTRIES (1)                         FSKCS059
02097                     ASC-BLOCK-ENTRIES (2)                         FSKCS059
02098      END-IF.                                                      FSKCS059
02099                                                                   FSKCS059
02100 *----------------------------------------------------------------*FSKCS059
02101 *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *FSKCS059
02102 *----------------------------------------------------------------*FSKCS059
02103  6010-DELETE-SEL-QUEUE.                                           FSKCS059
02104                                                                   FSKCS059
02105      EXEC CICS                                                    FSKCS059
02106          DELETEQ TS                                               FSKCS059
02107              QUEUE (ASC-SEL-QUEUE-NAME)                           FSKCS059
02108              RESP  (PV-CICS-RESP)                                 FSKCS059
02109      END-EXEC.                                                    FSKCS059
02110                                                                   FSKCS059
02111      IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      FSKCS059
02112         (PV-CICS-RESP = DFHRESP(QIDERR)))                         FSKCS059
02113          CONTINUE                                                 FSKCS059
02114      ELSE                                                         FSKCS059
02115          SET DP013-CICS-ABEND TO TRUE                             FSKCS059
02116          SET DP013-NO-ROLLBACK TO TRUE                            FSKCS059
02117          MOVE '6010-DELETE-SEL-QUEUE'                             FSKCS059
02118                         TO DP013-PARAGRAPH                        FSKCS059
02119          MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         FSKCS059
02120                         TO DP013-MESSAGE-TEXT (1)                 FSKCS059
02121          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
02122      END-IF.                                                      FSKCS059
02123                                                                   FSKCS059
02124 *----------------------------------------------------------------*FSKCS059
02125 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *FSKCS059
02126 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *FSKCS059
02127 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *FSKCS059
02128 *    THE TEMP QUEUE.                                             *FSKCS059
02129 *----------------------------------------------------------------*FSKCS059
02130  6100-UPDATE-TSQ.                                                 FSKCS059
02131                                                                   FSKCS059
02132      ADD 1                     TO  PV-SEL-QUEUE-ITEM.             FSKCS059
02133      PERFORM 6105-READ-SEL-QUEUE.                                 FSKCS059
02134      PERFORM                                                      FSKCS059
02135          VARYING VN003-IDX                                        FSKCS059
02136          FROM 1 BY 1                                              FSKCS059
02137          UNTIL ((PV-ITEMS-PROCESSED >                             FSKCS059
02138                               PV-HOLD-SELECTED-ITEMS)             FSKCS059
02139          OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             FSKCS059
02140          IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  FSKCS059
02141              PERFORM 6110-PROCESS-ITEMS                           FSKCS059
02142          END-IF                                                   FSKCS059
02143          ADD +1                TO PV-ITEMS-PROCESSED              FSKCS059
02144      END-PERFORM.                                                 FSKCS059
02145                                                                   FSKCS059
02146      PERFORM 6111-WRITE-LIST-QUEUE.                               FSKCS059
02147                                                                   FSKCS059
02148 *----------------------------------------------------------------*FSKCS059
02149 *    READ THE LIST QUEUE RECORD.                                 *FSKCS059
02150 *----------------------------------------------------------------*FSKCS059
02151  6105-READ-SEL-QUEUE.                                             FSKCS059
02152                                                                   FSKCS059
02153      EXEC CICS                                                    FSKCS059
02154           READQ TS                                                FSKCS059
02155               QUEUE (ASC-SEL-QUEUE-NAME)                          FSKCS059
02156               INTO  (VN003-VENDOR-SEL-REC)                        FSKCS059
02157               ITEM  (PV-SEL-QUEUE-ITEM)                           FSKCS059
02158               RESP  (PV-CICS-RESP)                                FSKCS059
02159      END-EXEC.                                                    FSKCS059
02160                                                                   FSKCS059
02161      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          FSKCS059
02162          CONTINUE                                                 FSKCS059
02163      ELSE                                                         FSKCS059
02164          SET DP013-CICS-ABEND      TO  TRUE                       FSKCS059
02165          SET DP013-NO-ROLLBACK     TO  TRUE                       FSKCS059
02166          MOVE '6105-READ-SEL-QUEUE'                               FSKCS059
02167                                    TO  DP013-PARAGRAPH            FSKCS059
02168          MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           FSKCS059
02169                                    TO  DP013-MESSAGE-TEXT(1)      FSKCS059
02170          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
02171      END-IF.                                                      FSKCS059
02172                                                                   FSKCS059
02173 *----------------------------------------------------------------*FSKCS059
02174 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*FSKCS059
02175 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*FSKCS059
02176 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *FSKCS059
02177 *----------------------------------------------------------------*FSKCS059
02178  6110-PROCESS-ITEMS.                                              FSKCS059
02179                                                                   FSKCS059
02180      COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          FSKCS059
02181                      / PC-ITEMS-PER-PANEL).                       FSKCS059
02182                                                                   FSKCS059
02183      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           FSKCS059
02184          IF  PV-SAVE-ITEM NOT EQUAL ZERO                          FSKCS059
02185              PERFORM 6111-WRITE-LIST-QUEUE                        FSKCS059
02186          END-IF                                                   FSKCS059
02187          MOVE PV-ITEM          TO PV-SAVE-ITEM                    FSKCS059
02188                                                                   FSKCS059
02189          PERFORM 6112-READ-LIST-QUEUE                             FSKCS059
02190          IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               FSKCS059
02191              CONTINUE                                             FSKCS059
02192          END-IF                                                   FSKCS059
02193      END-IF.                                                      FSKCS059
02194                                                                   FSKCS059
02195      COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     FSKCS059
02196                     - LQW-LIST-ITEM-NUMBER (1)) + 1.              FSKCS059
02197      SET LQW-DESELECT (PV-SUB) TO    TRUE                         FSKCS059
02198      MOVE LQW-SELECTED-SW (PV-SUB)                                FSKCS059
02199                                TO LQW-TEMP-SELECTED-SW (PV-SUB).  FSKCS059
02200      EVALUATE TRUE                                                FSKCS059
02201          WHEN VN003-INQ (VN003-IDX)                               FSKCS059
02202               MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             FSKCS059
02203                                                                   FSKCS059
02204          WHEN VN003-UPD (VN003-IDX)                               FSKCS059
02205               MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             FSKCS059
02206                                                                   FSKCS059
02207          WHEN VN003-DEL (VN003-IDX)                               FSKCS059
02208               MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             FSKCS059
02209                                                                   FSKCS059
02210          WHEN VN003-ERR (VN003-IDX)                               FSKCS059
02211               MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             FSKCS059
02212      END-EVALUATE.                                                FSKCS059
02213                                                                   FSKCS059
02214      SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                FSKCS059
02215                                                                   FSKCS059
02216 *----------------------------------------------------------------*FSKCS059
02217 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *FSKCS059
02218 *----------------------------------------------------------------*FSKCS059
02219  6111-WRITE-LIST-QUEUE.                                           FSKCS059
02220                                                                   FSKCS059
02221      EXEC CICS                                                    FSKCS059
02222          WRITEQ TS                                                FSKCS059
02223              QUEUE (ASC-LIST-QUEUE-NAME)                          FSKCS059
02224              FROM  (LQW-LIST-QUEUE-WORK-AREA)                     FSKCS059
02225              ITEM  (PV-SAVE-ITEM)                                 FSKCS059
02226              REWRITE                                              FSKCS059
02227              RESP  (PV-CICS-RESP)                                 FSKCS059
02228      END-EXEC.                                                    FSKCS059
02229                                                                   FSKCS059
02230      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          FSKCS059
02231          CONTINUE                                                 FSKCS059
02232      ELSE                                                         FSKCS059
02233          SET DP013-CICS-ABEND  TO  TRUE                           FSKCS059
02234          SET DP013-NO-ROLLBACK TO  TRUE                           FSKCS059
02235          MOVE '6111-WRITE-LIST-QUEUE'                             FSKCS059
02236                                TO  DP013-PARAGRAPH                FSKCS059
02237          MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  FSKCS059
02238                                TO  DP013-MESSAGE-TEXT(1)          FSKCS059
02239          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
02240      END-IF.                                                      FSKCS059
02241                                                                   FSKCS059
02242 *----------------------------------------------------------------*FSKCS059
02243 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*FSKCS059
02244 *----------------------------------------------------------------*FSKCS059
02245  6112-READ-LIST-QUEUE.                                            FSKCS059
02246                                                                   FSKCS059
02247      EXEC CICS                                                    FSKCS059
02248          READQ TS                                                 FSKCS059
02249              QUEUE (ASC-LIST-QUEUE-NAME)                          FSKCS059
02250              INTO  (LQW-LIST-QUEUE-WORK-AREA)                     FSKCS059
02251              ITEM  (PV-ITEM)                                      FSKCS059
02252              RESP  (PV-CICS-RESP)                                 FSKCS059
02253      END-EXEC.                                                    FSKCS059
02254                                                                   FSKCS059
02255      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          FSKCS059
02256          CONTINUE                                                 FSKCS059
02257      ELSE                                                         FSKCS059
02258          SET DP013-CICS-ABEND        TO TRUE                      FSKCS059
02259          SET DP013-NO-ROLLBACK       TO TRUE                      FSKCS059
02260          MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           FSKCS059
02261          MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    FSKCS059
02262                                      TO DP013-MESSAGE-TEXT(1)     FSKCS059
02263          PERFORM DP013-0000-PROCESS-ABEND                         FSKCS059
02264      END-IF.                                                      FSKCS059
02265                                                                   FSKCS059
02266 *----------------------------------------------------------------*FSKCS059
02267 *    ABEND PROCESSOR MODULE                                      *FSKCS059
02268 *----------------------------------------------------------------*FSKCS059
02269      COPY DPPD013.                                                FSKCS059
