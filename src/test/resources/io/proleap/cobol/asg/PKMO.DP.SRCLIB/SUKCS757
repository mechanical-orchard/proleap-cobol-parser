000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'PO ARCHIVE REQUEST CRIT SPEC - SUCARCH'.                          
000300 PROGRAM-ID.    SUKCS757.                                                 
000400 AUTHOR.        PATRICK BURKE.                                            
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  FEBRUARY 2003.                                            
000700 DATE-COMPILED.                                                           
263968*---------------------------------------------------------------*         
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968                 
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263968* MAKING THE CALL DYNAMIC VS STATIC.                                      
001130*                                                                         
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099                 
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                                   
263968*---------------------------------------------------------------*         
000800                                                                          
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100 WORKING-STORAGE SECTION.                                                 
001200                                                                          
001300 01  DK-DB2-KEYS.                                                         
001400     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE ZERO.         
001500     05  DK-PO-NBR                    PIC S9(09) COMP VALUE ZERO.         
001600     05  DK-REC-SEQ-NBR               PIC S9(04) COMP VALUE ZERO.         
001700     05  DK-USR-ID                    PIC  X(08) VALUE SPACES.            
001710     05  DK-STORE-NBR                 PIC S9(04) COMP VALUE ZERO.         
001800                                                                          
002300     05  DK-OPER-FROM                 PIC S9(04) COMP VALUE ZERO.         
002400     05  DK-OPER-TO                   PIC S9(04) COMP VALUE ZERO.         
002500                                                                          
002510 01  SD-SYSTEM-DATE.                                                      
002521     05  SD-SYSTEM-DATE-YY          PIC  9(02)   VALUE ZERO.              
002530     05  SD-SYSTEM-DATE-MM          PIC  9(02)   VALUE ZERO.              
002540     05  SD-SYSTEM-DATE-DD          PIC  9(02)   VALUE ZERO.              
002550                                                                          
002600                                                                          
002700 01  PV-PROGRAM-VARIABLES.                                                
003300     05  PV-CICS-RESPONSE            PIC S9(04)  VALUE ZERO               
003310                                                 COMP SYNC.               
003400     05  PV-STATUS-COUNT              PIC S9(03) COMP-3                   
003500                                                 VALUE ZERO.              
003501     05  PV-DB2-COUNT                    PIC S9(09)   VALUE +0            
003502                                                      COMP-3.             
003510     05  PV-FROM-DATE.                                                    
003520         10  PV-FROM-YYYY            PIC X(04).                           
003530         10  FILLER                  PIC X(01).                           
003540         10  PV-FROM-MM              PIC X(02).                           
003550         10  FILLER                  PIC X(01).                           
003560         10  PV-FROM-DD              PIC X(02).                           
003580     05  PV-TO-DATE.                                                      
003590         10  PV-TO-YYYY              PIC X(04).                           
003591         10  FILLER                  PIC X(01).                           
003592         10  PV-TO-MM                PIC X(02).                           
003593         10  FILLER                  PIC X(01).                           
003594         10  PV-TO-DD                PIC X(02).                           
003595     05  PV-TO-DATE-X                PIC X(10)  VALUE SPACE.              
003596     05  PV-FROM-DATE-X              PIC X(10)  VALUE SPACE.              
003597                                                                          
003598     05  PV-USER-ID                  PIC X(08)  VALUE SPACE.              
003599     05  PV-RETRY-COUNTER            PIC S9(04)  VALUE +0                 
003600                                                COMP SYNC.                
003610                                                                          
003700 01  PC-PROGRAM-CONSTANTS.                                                
003800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU757A'.           
003900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM757 '.         
004000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS757'.         
004001     05  PC-CALENDAR-MODULE        PIC  X(08)  VALUE  'DPKUT500'.         
009400     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE  'XLKUT071'.         
004002     05  PC-MAX-RETRIES            PIC S9(04)  VALUE  +3 COMP.            
004003                                                                          
004004*----------------------------------------------------------------*        
004005*  SYSTEM MESSAGES                                               *        
004006*----------------------------------------------------------------*        
004020* 00005-INVALID VALUE                                            *        
004021* 00007-REQUIRED ENTRY                                           *        
004022* 00008-MUST BE NUMERIC                                          *        
004023* 00009-INVALID DATE                                             *        
004024* 00308-AT LEAST ONE ENTRY IS REQUIRED                           *        
004025* 00594-STORE NUMBER NOT FOUND                                   *        
004026* 00955-WRONG OPERATING UNIT/FACILITY FOR THIS RECEIVER          *        
004027* 00973-AT LEAST ONE ENTRY IS REQUIRED                           *        
004028* 02294-INVALID STORE NUMBER                                     *        
004029* 02572-INVALID VALUE - OPER UNIT ID MUST BE A DC LOCATION       *        
004030* 02805-UNABLE TO SELECT UNLOADED AT STORE WITH ANY OTHER STATUS *        
004031* 02806-FROM DATE MUST BE BEFORE THE TO DATE                     *        
004032* 02810-REQUESTED STORE IS NOT WITHIN YOUR DISTRICT              *        
004033* 02858-INVALID PURCHASE ORDER NUMBER                            *        
004034* 02859-LINE NUMBER IS ONLY VALID FOR BULK/CSEPK PURCHASE ORDER  *        
004035* 02860-PACK ID IS ONLY VALID FOR PREPACK PURCHASE ORDERS        *        
004036* 02861-INVALID LINE NUMBER FOR PURCHASE ORDER ENTERED           *        
004037* 02862-INVALID PACK ID FOR PURCHASE ORDER ENTERED               *        
004038* 02864-PURCHASE ORDER AUDIT EXCEPTION ALREADY EXISTS - USE UPD  *        
004039* 02865-PURCHASE ORDER AUDIT EXCEPTION DOES NOT EXIST - USE ADD  *        
004040* 02866-YOU DO NOT HAVE AUTHORITY TO ADD PURCHASE ORDER AUDIT EXC*        
004041* 02867-YOU DO NOT HAVE AUTHORITY TO UPDATE PURCHASE ORDER AUDIT *        
004042* 02892-PURCHASE ORDER AND/OR OPER UNIT ID ARE REQ FOR THE LIST  *        
004050******************************************************************        
004100     05  PC-TSYMSG-NUMBERS.                                               
004200         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.              
004300         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.              
004400         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.              
004500         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.              
004510         10  PC-TSYMSG-00117       PIC  9(05)  VALUE  00117.              
004600         10  PC-TSYMSG-00308       PIC  9(05)  VALUE  00308.              
004610         10  PC-TSYMSG-00594       PIC  9(05)  VALUE  00594.              
004620         10  PC-TSYMSG-00955       PIC  9(05)  VALUE  00955.              
004700         10  PC-TSYMSG-00973       PIC  9(05)  VALUE  00973.              
004710         10  PC-TSYMSG-01134       PIC  9(05)  VALUE  01134.              
004800         10  PC-TSYMSG-02294       PIC  9(05)  VALUE  02294.              
004900         10  PC-TSYMSG-02572       PIC  9(05)  VALUE  02572.              
004910         10  PC-TSYMSG-02698       PIC  9(05)  VALUE  02698.              
005000         10  PC-TSYMSG-02805       PIC  9(05)  VALUE  02805.              
005100         10  PC-TSYMSG-02806       PIC  9(05)  VALUE  02806.              
005200         10  PC-TSYMSG-02810       PIC  9(05)  VALUE  02810.              
005300         10  PC-TSYMSG-02858       PIC  9(05)  VALUE  02858.              
005400         10  PC-TSYMSG-02859       PIC  9(05)  VALUE  02859.              
005500         10  PC-TSYMSG-02860       PIC  9(05)  VALUE  02860.              
005600         10  PC-TSYMSG-02861       PIC  9(05)  VALUE  02861.              
005700         10  PC-TSYMSG-02862       PIC  9(05)  VALUE  02862.              
005800         10  PC-TSYMSG-02864       PIC  9(05)  VALUE  02864.              
005900         10  PC-TSYMSG-02865       PIC  9(05)  VALUE  02865.              
006000         10  PC-TSYMSG-02866       PIC  9(05)  VALUE  02866.              
006100         10  PC-TSYMSG-02867       PIC  9(05)  VALUE  02867.              
006200         10  PC-TSYMSG-02892       PIC  9(05)  VALUE  02892.              
006210         10  PC-TSYMSG-03009       PIC  9(05)  VALUE  03009.              
006300*                                                                         
006400                                                                          
006500 01  PM-CICSAUTH-MESSAGE.                                                 
006600     05  FILLER                       PIC  X(36)     VALUE                
006700         'INVALID RETURN CODE FROM CICSAUTH - '.                          
006800     05  PM-CM-RETURN-CODE            PIC  9(04).                         
006900                                                                          
007000                                                                          
007100 01  PS-PROGRAM-SWITCHES.                                                 
007200     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.                
007300         88  PS-ERROR                          VALUE  'Y'.                
007400         88  PS-NO-ERROR                       VALUE  'N'.                
007500     05  PS-DATE-ERROR-SW          PIC  X(01)  VALUE  'N'.                
007600         88  PS-DATE-ERROR                     VALUE  'Y'.                
007700         88  PS-NO-DATE-ERROR                  VALUE  'N'.                
009300     05  PS-PO-EXISTS-SW           PIC  X(01)  VALUE  'N'.                
009400         88  PS-PO-EXISTS                      VALUE  'Y'.                
009500         88  PS-PO-DOESNT-EXIST                VALUE  'N'.                
009900     05  PS-RECEIVER-EXISTS-SW     PIC  X(01)  VALUE  'N'.                
010000         88  PS-RECEIVER-EXISTS                VALUE  'Y'.                
010100         88  PS-RECEIVER-DOESNT-EXIST          VALUE  'N'.                
010110     05  PS-OPER-EXISTS-SW         PIC  X(01)  VALUE  'N'.                
010120         88  PS-OPER-EXISTS                    VALUE  'Y'.                
010130         88  PS-OPER-DOESNT-EXIST              VALUE  'N'.                
010200     05  PS-STORE-EXISTS-SW        PIC  X(01)  VALUE  'N'.                
010300         88  PS-STORE-EXISTS                   VALUE  'Y'.                
010400         88  PS-STORE-EXISTS-NO                VALUE  'N'.                
010500                                                                          
010600 01  PM-PROGRAM-MESSAGES.                                                 
010700     05  PM-ABEND-INFO-A.                                                 
010800         10  FILLER                PIC X(15)   VALUE                      
010900                                   'DP020-SRC-AID: '.                     
011000         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.              
011100         10  FILLER                PIC X(19)   VALUE                      
011200                                   '. DP020-FK-ACTION: '.                 
011300         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.              
011400         10  FILLER                PIC X(22)   VALUE                      
011500                                   '. DP020-FK-DISPN-IND: '.              
011600         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.              
011700         10  FILLER                PIC X(01)   VALUE '.'.                 
011800         10  FILLER                PIC X(19)   VALUE SPACE.               
011900                                                                          
012000                                                                          
012100*    MAP LAYOUT                                                  *        
012200     COPY SUKM757.                                                        
012300                                                                          
012400*    RACF                                                                 
012500     COPY DPWS008.                                                        
012300                                                                          
012600*    ATTRIBUTE SETTINGS                                                   
012700     COPY DPWS015.                                                        
012800                                                                          
012900*    FUNCTION KEYS                                                        
013000                                                                          
013100     COPY DPWS016.                                                        
013200                                                                          
042200*---------------------------------------------------------------*         
042300* COPYBOOK FOR THE LOCATION MODULE - XLKUT071                             
042400*---------------------------------------------------------------*         
042500     COPY XLWS071.                                                        
042600                                                                          
013300** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **        
013400** SUB-ROUTINE (DPKUT100).                                      **        
013500     COPY DPWS010I.                                                       
013600/                                                                         
013800** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **        
013900     COPY DPWS030.                                                        
013900     COPY DPWS930.                                                        
014000/                                                                         
014100*    STANDARD COMMAREA.                                                   
014200     COPY DPWS020.                                                        
014300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
014400                                                                          
014500*    INTER-APPLICATION COMMAREA.                                          
014600                                                                          
014700         10  INTER-APPL-COMM-AREA PIC X(200).                             
014800     COPY SUWS040.                                                        
014900         10  ASC-SPECIFIC-COMMAREA.                                       
015400             15  ASC-PO-NBR                  PIC X(09).                   
015500             15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                        
015600                                             PIC 9(09).                   
015700             15  ASC-REC-SEQ-NBR             PIC X(04).                   
015710             15  ASC-REC-SEQ-NBR-N REDEFINES ASC-REC-SEQ-NBR              
015720                                             PIC 9(04).                   
015800             15  ASC-REC-SEQ-NBR-ALL-SW      PIC X(01).                   
015810                 88  ASC-REC-ALL                 VALUE 'Y'.               
015820                 88  ASC-REC-ALL-NO              VALUE 'N'.               
015900             15  ASC-OPER-UNT-ID             PIC X(04).                   
016000             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID              
016100                                             PIC 9(04).                   
016300             15  ASC-STORE-NBR               PIC X(04).                   
016400             15  ASC-STORE-NAME              PIC X(25).                   
016500             15  ASC-TK-NUMBER               PIC X(08).                   
017000             15  ASC-FROM-DATE               PIC X(10).                   
017100             15  FILLER REDEFINES ASC-FROM-DATE.                          
017200                 20  ASC-FROM-MM             PIC X(02).                   
017300                 20  ASC-DASH-1              PIC X(01).                   
017400                 20  ASC-FROM-DD             PIC X(02).                   
017500                 20  ASC-DASH-2              PIC X(01).                   
017600                 20  ASC-FROM-YYYY           PIC X(04).                   
017700             15  ASC-TO-DATE                 PIC X(10).                   
017800             15  FILLER REDEFINES ASC-TO-DATE.                            
017900                 20  ASC-TO-MM               PIC X(02).                   
018000                 20  ASC-DASH-3              PIC X(01).                   
018100                 20  ASC-TO-DD               PIC X(02).                   
018200                 20  ASC-DASH-4              PIC X(01).                   
018300                 20  ASC-TO-YYYY             PIC X(04).                   
018400/                                                                         
018500*    ABEND PROCESSING                                                     
018600     COPY DPWS013.                                                        
018700/                                                                         
018800*    DATE ROUTINE WORK AREA                                               
018900     COPY DPWS500.                                                        
019000                                                                          
020100*    PO MASTER                                                            
020200     EXEC SQL                                                             
020300          INCLUDE TPURCHS                                                 
020400     END-EXEC.                                                            
020500                                                                          
020600*                                                                         
020700     EXEC SQL                                                             
020800          INCLUDE TRECEIV                                                 
020900     END-EXEC.                                                            
021000                                                                          
021100*                                                                         
021200     EXEC SQL                                                             
021300          INCLUDE TKRPRPM                                                 
021400     END-EXEC.                                                            
021500                                                                          
021501*                                                                         
021502     EXEC SQL                                                             
021503          INCLUDE SUT00029                                                
021504     END-EXEC.                                                            
021505                                                                          
021510*                                                                         
021600*  COMMUNICATION AREAS FOR DB2                                            
021700*                                                                         
021800     EXEC SQL                                                             
021900         INCLUDE SQLCA                                                    
022000     END-EXEC.                                                            
022100*----------------------------------------------------------------*        
022200                                                                          
022300 EJECT                                                                    
022400 LINKAGE SECTION.                                                         
022500                                                                          
022600 01  DFHCOMMAREA.                                                         
022700     05  FILLER                         OCCURS  1 TO 4072 TIMES           
022800                                        DEPENDING ON EIBCALEN.            
022900         10  FILLER                     PIC X.                            
023000                                                                          
023100                                                                          
023200 PROCEDURE DIVISION.                                                      
023300 0000-MAIN-MODULE.                                                        
023400     INITIALIZE DP030-CICS-API-FIELDS.                                    
023500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
023600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
023700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
023800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
023900     MOVE LENGTH OF SU757AI        TO DP030-MAP-LENGTH (1).               
024000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
024100     PERFORM 0001-CALL-CICS-ARCH-API.                                     
024200*                                                                         
024300     PERFORM 1000-CONTROL-PROCESSING                                      
024400*                                                                         
024500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
024600     PERFORM 0001-CALL-CICS-ARCH-API.                                     
024700                                                                          
024800 0001-CALL-CICS-ARCH-API.                                                 
024900*    CALL 'DPKCS030' USING DFHEIBLK                                       
024900     CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
025000                           DFHCOMMAREA                                    
025100                           DP030-CICS-API-FIELDS                          
025200                           DP020-STANDARD-COMMAREA                        
025300                           SU757AI.                                       
025400*                                                                         
025500     IF  DP030-RC-CALL-SUCCESSFUL                                         
025600         CONTINUE                                                         
025700     ELSE                                                                 
025800         SET DP013-NO-ROLLBACK                                            
025900             DP013-XCTL-DISPLAY-RESTART                                   
026000             DP013-CICS-ABEND      TO TRUE                                
026100         MOVE 'BEFORE 0000-MAIN-MODULE'                                   
026200                                   TO DP013-PARAGRAPH                     
026300*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
026400*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
026300         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
026400-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
026500         MOVE DP030-RETURN-CODE                                           
026600                                   TO DP013-MESSAGE-TEXT (3)              
026700         PERFORM DP013-0000-PROCESS-ABEND                                 
026800     END-IF.                                                              
026900 EJECT                                                                    
027000*----------------------------------------------------------------*        
027100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
027200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
027300*----------------------------------------------------------------*        
027400                                                                          
027500 1000-CONTROL-PROCESSING.                                                 
027600                                                                          
027700     EVALUATE TRUE                                                        
027800         WHEN DP020-NEXT-ACT-INITIAL                                      
027900             INITIALIZE ASC-SPECIFIC-COMMAREA                             
028000                        SU040-INTER-APPL-COMMAREA                         
028100             PERFORM 4000-BUILD-INITIAL-PANEL                             
028200             PERFORM 3200-RESET-ATTRIBUTES                                
028300         WHEN DP020-NEXT-ACT-RETURN                                       
028400             MOVE -1                  TO APOL                             
028500             SET DP030-SET-CURSOR-APPL-1                                  
028600                                      TO TRUE                             
028700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
028800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
028900                                                                          
029000                                                                          
029100         WHEN DP020-NEXT-ACT-READ-MAP                                     
029200             PERFORM 2000-FKEY-PROCESSING                                 
029300                                                                          
029400         WHEN OTHER                                                       
029500             SET DP013-LOGIC-ABEND                                        
029600                 DP013-NO-ROLLBACK TO TRUE                                
029700             MOVE '1000-CONTROL-PROCESSING'                               
029800                                   TO  DP013-PARAGRAPH                    
029900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
030000                                   TO  DP013-MESSAGE-TEXT(1)              
030100             MOVE DP020-NEXT-APPL-ACTIVITY                                
030200                                   TO DP013-MESSAGE-TEXT(2)               
030300             PERFORM DP013-0000-PROCESS-ABEND                             
030400     END-EVALUATE.                                                        
030500                                                                          
030600*----------------------------------------------------------------*        
030700* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*        
030800* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*        
030900* EDITS.                                                         *        
031000*----------------------------------------------------------------*        
031100                                                                          
031200 2000-FKEY-PROCESSING.                                                    
031300                                                                          
031400     EVALUATE TRUE                                                        
031500                                                                          
031600         WHEN DP020-SRC-AID = DP016-CLEAR                                 
031700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
031800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
031900                                                                          
032000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
032100             INITIALIZE ASC-SPECIFIC-COMMAREA                             
032200             PERFORM 4000-BUILD-INITIAL-PANEL                             
032300             PERFORM 3200-RESET-ATTRIBUTES                                
032400                                                                          
032500         WHEN OTHER                                                       
032600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
032700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
032800*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
032900             IF  PS-NO-ERROR                                              
033000                 SET DP030-CONTINUE-GO TO TRUE                            
033100                 PERFORM 2100-CHECK-FUNCTION-KEY                          
033200             ELSE                                                         
033300                 SET DP030-OVERRIDE-GO TO TRUE                            
033400             END-IF                                                       
033500     END-EVALUATE.                                                        
033600******************************************************************        
033700** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **        
033800** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **        
033900** FROM THE CICS ARCHITECTURE API.                              **        
034000******************************************************************        
034100 2100-CHECK-FUNCTION-KEY.                                                 
034200     EVALUATE TRUE                                                        
034310*************                                                             
034320*F13 ADD REQ                                                              
034330*************                                                             
034340         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
034360             IF PS-PO-EXISTS                                              
034391                PERFORM 2110-PREPARE-INTER-APPL-COMM                      
034392                PERFORM 5060-CHECK-PENDING-SUT00029                       
034393                IF PV-DB2-COUNT > 0                                       
034394                  INITIALIZE SU040-INTER-APPL-COMMAREA                    
034395                      SET PS-ERROR                                        
034396                          DP020-MSG-FATAL  TO TRUE                        
034397                      MOVE PC-TSYMSG-00117 TO DP020-MSG-NUMBER            
034398                      MOVE DP015-UNP-ALP-BRT-OFF                          
034399                                           TO APOA                        
034400                      MOVE DP015-RED       TO APOC                        
034401                      MOVE DP015-REVERSE   TO APOH                        
034402                      MOVE -1              TO APOL                        
034403                      SET DP030-SET-CURSOR-APPL-1                         
034404                                           TO TRUE                        
034405                      SET DP030-OVERRIDE-GO TO TRUE                       
034406                ELSE                                                      
034407                  PERFORM 5070-INSERT-SUT00029                            
034408                END-IF                                                    
034409             ELSE                                                         
034410                INITIALIZE SU040-INTER-APPL-COMMAREA                      
034411                    SET PS-ERROR                                          
034412                        DP020-MSG-FATAL  TO TRUE                          
034413                    MOVE PC-TSYMSG-02858 TO DP020-MSG-NUMBER              
034414                    MOVE DP015-UNP-ALP-BRT-OFF                            
034415                                         TO APOA                          
034420                    MOVE DP015-RED       TO APOC                          
034440                    MOVE DP015-REVERSE   TO APOH                          
034470                    MOVE -1              TO APOL                          
034480                    SET DP030-SET-CURSOR-APPL-1                           
034490                                         TO TRUE                          
034491                    SET DP030-OVERRIDE-GO TO TRUE                         
034492             END-IF                                                       
034496*************                                                             
034497*F23 RCVRLIST                                                             
034498*************                                                             
034499                                                                          
034500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
034501*            IF PS-PO-EXISTS                                              
034504                PERFORM 2110-PREPARE-INTER-APPL-COMM                      
034505*            ELSE                                                         
034508*               INITIALIZE SU040-INTER-APPL-COMMAREA                      
034509*               SET PS-ERROR                                              
034510*                   DP020-MSG-FATAL  TO TRUE                              
034511*               MOVE PC-TSYMSG-02858 TO DP020-MSG-NUMBER                  
034513*               MOVE DP015-UNP-ALP-BRT-OFF                                
034514*                                    TO APOA                              
034516*               MOVE DP015-REVERSE   TO APOH                              
034518*               MOVE -1              TO APOL                              
034519*               SET DP030-SET-CURSOR-APPL-1                               
034520*                                    TO TRUE                              
034521*               SET DP030-OVERRIDE-GO TO TRUE                             
034570*            END-IF                                                       
034700                                                                          
034800         WHEN DP020-SRC-AID = DP016-ENTER                                 
034900             MOVE -1                  TO APOL                             
035000             SET DP030-SET-CURSOR-APPL-1                                  
035100                                      TO TRUE                             
035200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
035300                                                                          
035400         WHEN OTHER                                                       
035500             SET DP013-NO-ROLLBACK                                        
035600                 DP013-XCTL-DISPLAY-RESTART                               
035700                 DP013-CICS-ABEND  TO TRUE                                
035800             MOVE '2100-CHECK-FUNCTION-KEY'                               
035900                                   TO DP013-PARAGRAPH                     
036000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
036100                                   TO DP013-MESSAGE-TEXT (1)              
036200             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:'         
036300                                   TO DP013-MESSAGE-TEXT (2)              
036400             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                        
036500             MOVE DP020-FK-ACTION (DP020-SRC-AID)                         
036600                                   TO PM-A-FK-ACTION                      
036700             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)                      
036800                                   TO PM-A-FK-DISPN                       
036900             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)              
037000             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'                
037100                                   TO DP013-MESSAGE-TEXT (4)              
037200             PERFORM DP013-0000-PROCESS-ABEND                             
037300     END-EVALUATE.                                                        
037400                                                                          
037500******************************************************************        
037600** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **        
037700** INTER-APPLICATION COMMAREA.                                  **        
037800******************************************************************        
037900 2110-PREPARE-INTER-APPL-COMM.                                            
038000     INITIALIZE SU040-INTER-APPL-COMMAREA.                                
038100     MOVE ASC-OPER-UNT-ID-N           TO SU040-OPER-UNT-ID                
038210     MOVE '0001'                      TO SU040-FCLTY-ID                   
038211     MOVE ASC-STORE-NAME              TO SU040-FCLTY-NME                  
038212     MOVE ASC-TK-NUMBER               TO SU040-USR-ID                     
038900                                                                          
039000     IF ASC-FROM-DATE = SPACES                                            
039100         MOVE '01-01-0001'            TO ASC-FROM-DATE                    
039200     END-IF                                                               
039300     IF ASC-TO-DATE = SPACES                                              
039400         MOVE '09-09-9999'            TO ASC-TO-DATE                      
039500     END-IF                                                               
039600     STRING                                                               
039700            ASC-FROM-YYYY                                                 
039800*           '-'                                                           
039900            ASC-FROM-MM                                                   
040000*           '-'                                                           
040100            ASC-FROM-DD                                                   
040200             DELIMITED BY SIZE        INTO SU040-REQ-FROM-DATE            
040300     STRING                                                               
040400             ASC-TO-YYYY                                                  
040500*           '-'                                                           
040600            ASC-TO-MM                                                     
040700*           '-'                                                           
040800            ASC-TO-DD                                                     
040900             DELIMITED BY SIZE        INTO SU040-REQ-TO-DATE.             
041000                                                                          
041100/                                                                         
041110********************************************************************      
041200 2200-MOVE-SCREEN-TO-COMMAREA.                                            
041210                                                                          
041300     IF  APOL > ZERO                                                      
041400         MOVE APOI                TO ASC-PO-NBR                           
041500     ELSE                                                                 
041600         IF APOF = DP015-ERASE-EOF                                        
041700             MOVE SPACES           TO ASC-PO-NBR                          
041900         END-IF                                                           
042000     END-IF                                                               
042100                                                                          
042110     IF  ARECL > ZERO                                                     
042120         MOVE ARECI                TO ASC-REC-SEQ-NBR                     
042121                                      DK-REC-SEQ-NBR                      
042130     ELSE                                                                 
042140         IF ARECF = DP015-ERASE-EOF                                       
042150             MOVE SPACES           TO ASC-REC-SEQ-NBR                     
042151             SET ASC-REC-ALL-NO    TO TRUE                                
042160         END-IF                                                           
042170     END-IF                                                               
042180                                                                          
042200     IF  AOPERL > ZERO                                                    
042300         MOVE AOPERI               TO ASC-OPER-UNT-ID                     
042400     ELSE                                                                 
042500         IF AOPERF = DP015-ERASE-EOF                                      
042600             MOVE SPACE            TO ASC-OPER-UNT-ID                     
042800         END-IF                                                           
042900     END-IF                                                               
043000                                                                          
043100     IF  ASTRL > ZERO                                                     
043200         MOVE ASTRI               TO ASC-STORE-NBR                        
043210                                      DK-STORE-NBR                        
043300     ELSE                                                                 
043400         IF ASTRF = DP015-ERASE-EOF                                       
043500             MOVE SPACE            TO ASC-STORE-NBR                       
043700         END-IF                                                           
043800     END-IF                                                               
043900                                                                          
044000     IF  ATKNOL    > ZERO                                                 
044100         MOVE ATKNOI               TO ASC-TK-NUMBER                       
044200                                      DK-USR-ID                           
044300     ELSE                                                                 
044400         IF ATKNOF = DP015-ERASE-EOF                                      
044500             MOVE SPACE            TO ASC-TK-NUMBER                       
044600         END-IF                                                           
044610     END-IF                                                               
044620                                                                          
044700     IF  AFMML > ZERO                                                     
044800         MOVE AFMMI               TO ASC-FROM-MM                          
044900     ELSE                                                                 
045000         IF AFMMF = DP015-ERASE-EOF                                       
045100             MOVE SPACE            TO ASC-FROM-MM                         
045200                                      ASC-DASH-1                          
045300         END-IF                                                           
045400     END-IF                                                               
045500                                                                          
045600     IF  AFDDL > ZERO                                                     
045700         MOVE AFDDI               TO ASC-FROM-DD                          
045800     ELSE                                                                 
045900         IF AFDDF = DP015-ERASE-EOF                                       
046000             MOVE SPACE            TO ASC-FROM-DD                         
046100                                      ASC-DASH-2                          
046200         END-IF                                                           
046300     END-IF                                                               
046400                                                                          
046500     IF  AFYYL > ZERO                                                     
046600         MOVE AFYYI               TO ASC-FROM-YYYY                        
046700     ELSE                                                                 
046800         IF AFYYF = DP015-ERASE-EOF                                       
046900             MOVE SPACE            TO ASC-FROM-YYYY                       
047000                                      ASC-DASH-3                          
047100         END-IF                                                           
047200     END-IF                                                               
047300                                                                          
047400                                                                          
047500     IF  ATMML > ZERO                                                     
047600         MOVE ATMMI               TO ASC-TO-MM                            
047700     ELSE                                                                 
047800         IF ATMMF = DP015-ERASE-EOF                                       
047900             MOVE SPACE            TO ASC-TO-MM                           
048000                                      ASC-DASH-4                          
048100         END-IF                                                           
048200     END-IF                                                               
048300                                                                          
048400     IF  ATDDL > ZERO                                                     
048500         MOVE ATDDI               TO ASC-TO-DD                            
048600     ELSE                                                                 
048700         IF ATDDF = DP015-ERASE-EOF                                       
048800             MOVE SPACE            TO ASC-TO-DD                           
048900         END-IF                                                           
049000     END-IF                                                               
049100                                                                          
049200     IF  ATYYL > ZERO                                                     
049300         MOVE ATYYI               TO ASC-TO-YYYY                          
049400     ELSE                                                                 
049500         IF ATYYF = DP015-ERASE-EOF                                       
049600             MOVE SPACE            TO ASC-TO-YYYY                         
049700         END-IF                                                           
049800     END-IF.                                                              
051100/                                                                         
051110*********************************************************************     
051200 3000-EDIT-DATA-IN-COMMAREA.                                              
051210*********************************************************************     
051300     PERFORM 3200-RESET-ATTRIBUTES.                                       
051400                                                                          
052100*    BOTH DATES HAVE TO BE ENTERED OR NONE AT ALL                         
052200     EVALUATE TRUE                                                        
052300         WHEN ASC-FROM-DATE = SPACES                                      
052400                 AND ASC-TO-DATE = SPACES                                 
052500             CONTINUE                                                     
052600         WHEN ASC-FROM-DATE > SPACES                                      
052700               AND ASC-TO-DATE = SPACES                                   
052800             MOVE -1          TO ATMML                                    
052900             MOVE DP015-RED   TO ATMMC                                    
053000                                 ATDDC                                    
053100                                 ATYYC                                    
053200             SET DP020-MSG-FATAL                                          
053300                 DP030-SET-CURSOR-APPL-1                                  
053400                 PS-DATE-ERROR                                            
053500                 PS-ERROR     TO TRUE                                     
053600                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 
053700         WHEN ASC-FROM-DATE = SPACES                                      
053800                  AND ASC-TO-DATE > SPACES                                
053900             MOVE -1          TO AFMML                                    
054000             MOVE DP015-RED   TO AFMMC                                    
054100                                 AFDDC                                    
054200                                 AFYYC                                    
054300             SET DP020-MSG-FATAL                                          
054400                 DP030-SET-CURSOR-APPL-1                                  
054500                 PS-DATE-ERROR                                            
054600                 PS-ERROR     TO TRUE                                     
054700                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 
054800         WHEN OTHER                                                       
054900             PERFORM 3007-EDIT-DATES                                      
055000         END-EVALUATE                                                     
055100                                                                          
055200            IF ASC-OPER-UNT-ID > SPACES                                   
055201                PERFORM 3005-EDIT-OPER-UNT                                
055202            ELSE                                                          
055203                MOVE -1              TO AOPERL                            
055204                MOVE DP015-RED       TO AOPERC                            
055205                MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                  
055206                SET DP020-MSG-FATAL                                       
055207                    DP030-SET-CURSOR-APPL-1                               
055208                    PS-ERROR                 TO TRUE                      
055209            END-IF                                                        
055210                                                                          
055211         IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                        
055220            IF ASC-PO-NBR > SPACES                                        
055300                PERFORM 3003-EDIT-PO-NBR                                  
055310            ELSE                                                          
055320                MOVE -1              TO APOL                              
055330                MOVE DP015-RED       TO APOC                              
055340                MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                  
055350                SET DP020-MSG-FATAL                                       
055360                    DP030-SET-CURSOR-APPL-1                               
055370                    PS-ERROR                 TO TRUE                      
055400            END-IF                                                        
055401                                                                          
055403            IF ASC-REC-SEQ-NBR   > SPACES                                 
055404                MOVE ASC-REC-SEQ-NBR  TO DP010I-UNEDITED-FIELD            
055405                MOVE LENGTH OF ASC-REC-SEQ-NBR                            
055406                                    TO DP010I-MAXIMUM-DIGITS              
055407                MOVE ZERO           TO DP010I-MAXIMUM-DECIMALS            
055408                SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   
263968                CALL DP010I-NUMERIC-EDIT-ROUTINE                          
263968                     USING DP010I-NUMERIC-EDIT-AREA                       
055410                IF  DP010I-ERROR-DETECTED                                 
055420                    SET PS-ERROR                                          
055430                        DP020-MSG-FATAL        TO TRUE                    
055440                    MOVE PC-TSYMSG-00008       TO DP020-MSG-NUMBER        
055450                    MOVE DP015-UNP-ALP-BRT-OFF TO ARECA                   
055460                    MOVE DP015-RED             TO ARECC                   
055470                    MOVE DP015-REVERSE         TO ARECH                   
055480                    MOVE -1                    TO ARECL                   
055490                    SET DP030-SET-CURSOR-APPL-1 TO TRUE                   
055491                ELSE                                                      
055492                    MOVE DP010I-NUMERIC-FIELD TO ASC-REC-SEQ-NBR-N        
055493                                                 DK-REC-SEQ-NBR           
055494                END-IF                                                    
055495            ELSE                                                          
055496                PERFORM 3080-CHECK-ALL-RECEIVERS                          
055497            END-IF                                                        
059500                                                                          
060000            IF PS-NO-ERROR                                                
060100                 PERFORM 3009-PO-OPER-CHECK                               
060200            END-IF                                                        
060300                                                                          
060400            IF ASC-STORE-NBR   > SPACES                                   
060500                PERFORM 7021-VALIDATE-STORE-NUMBER                        
060600                IF PS-STORE-EXISTS                                        
060610                   CONTINUE                                               
060620                ELSE                                                      
060700                   MOVE -1              TO ASTRL                          
060800                   MOVE DP015-RED       TO ASTRC                          
060900                   MOVE PC-TSYMSG-00594 TO DP020-MSG-NUMBER               
061000                   SET DP020-MSG-FATAL                                    
061100                       DP030-SET-CURSOR-APPL-1                            
061200                       PS-ERROR                 TO TRUE                   
061300                END-IF                                                    
061301            END-IF                                                        
061302         END-IF.                                                          
061310                                                                          
061400/                                                                         
061500*-----------------------------------------------------------------        
061600*  VALIDATE CREATE FROM AND TO DATES                                      
061700*-----------------------------------------------------------------        
061800 3000H1-VALIDATE-FROM-TO.                                                 
061900                                                                          
062000     MOVE  ASC-FROM-MM    TO  PV-FROM-MM.                                 
062100     MOVE  ASC-FROM-DD    TO  PV-FROM-DD.                                 
062200     MOVE  ASC-FROM-YYYY  TO  PV-FROM-YYYY.                               
062300                                                                          
062400     MOVE  ASC-TO-MM      TO  PV-TO-MM.                                   
062500     MOVE  ASC-TO-DD      TO  PV-TO-DD.                                   
062600     MOVE  ASC-TO-YYYY    TO  PV-TO-YYYY.                                 
062700                                                                          
062800     IF  PV-TO-DATE  >=  PV-FROM-DATE                                     
062900         CONTINUE                                                         
063000     ELSE                                                                 
063100*        DATE RANGE IS INVALID                                            
063200         SET PS-ERROR                                                     
063300         DP020-MSG-FATAL             TO TRUE                              
063400         MOVE PC-TSYMSG-02698        TO DP020-MSG-NUMBER                  
063500         MOVE DP015-UNP-ALP-BRT-OFF  TO AFMMA                             
063600                                        AFDDA                             
063700                                        AFYYA                             
063800                                        ATMMA                             
063900                                        ATDDA                             
064000                                        ATYYA                             
064100         MOVE DP015-RED              TO AFMMC                             
064200                                        AFDDC                             
064300                                        AFYYC                             
064400                                        ATMMC                             
064500                                        ATDDC                             
064600                                        ATYYC                             
064700         MOVE DP015-REVERSE          TO AFMMH                             
064800                                        AFDDH                             
064900                                        AFYYH                             
065000                                        ATMMH                             
065100                                        ATDDH                             
065200                                        ATYYH                             
065300         MOVE -1                     TO AFMML                             
065400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
065500     END-IF.                                                              
065600                                                                          
065700     IF  PS-NO-ERROR                                                      
065800         INITIALIZE DPG51 DPG52 DPG53                                     
065900                    DPG54 DPG55 DPG56                                     
066000         SET  DPG51-ACTUAL-CALENDAR-ONLY                                  
066100              DPG51-DO-NOT-INCR-DECR-DATE                                 
066200                                    TO TRUE                               
066300*            'CCYYMMDD'                                                   
066400         SET  DPG52-LK-DTE-ISO                                            
066500                                    TO TRUE                               
066600         MOVE PV-FROM-DATE          TO DPG52-LK-DATE-INPUT                
066700         CALL PC-CALENDAR-MODULE USING DPG51 DPG52 DPG53                  
066800                                       DPG54 DPG55 DPG56                  
066900         IF (DPG54-DATE-INVALID  OR                                       
067000             DPG54-SEVERE-ERROR)                                          
067100             SET PS-ERROR                                                 
067200                 DP020-MSG-FATAL       TO TRUE                            
067300             MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER                
067400             MOVE DP015-UNP-ALP-BRT-OFF                                   
067500                                       TO AFMMA                           
067600                                          AFDDA                           
067700                                          AFYYA                           
067800             MOVE DP015-RED            TO AFMMC                           
067900                                          AFDDC                           
068000                                          AFYYC                           
068100             MOVE DP015-REVERSE        TO AFMMH                           
068200                                          AFDDH                           
068300                                          AFYYH                           
068400             MOVE -1                   TO AFMML                           
068500             SET DP030-SET-CURSOR-APPL-1                                  
068600                                       TO TRUE                            
068700         END-IF                                                           
068800                                                                          
068900         INITIALIZE DPG51 DPG52 DPG53                                     
069000                    DPG54 DPG55 DPG56                                     
069100         SET  DPG51-ACTUAL-CALENDAR-ONLY                                  
069200              DPG51-DO-NOT-INCR-DECR-DATE                                 
069300                                    TO TRUE                               
069400*            'CCYYMMDD'                                                   
069500             SET  DPG52-LK-DTE-ISO                                        
069600                                    TO TRUE                               
069700         MOVE PV-TO-DATE            TO DPG52-LK-DATE-INPUT                
069800         CALL PC-CALENDAR-MODULE USING DPG51 DPG52 DPG53                  
069900                                       DPG54 DPG55 DPG56                  
070000         IF (DPG54-DATE-INVALID                                           
070100         OR  DPG54-SEVERE-ERROR)                                          
070200             SET PS-ERROR                                                 
070300                 DP020-MSG-FATAL       TO TRUE                            
070400             MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER                
070500             MOVE DP015-UNP-ALP-BRT-OFF                                   
070600                                       TO ATMMA                           
070700                                          ATDDA                           
070800                                          ATYYA                           
070900             MOVE DP015-RED            TO ATMMC                           
071000                                          ATDDC                           
071100                                          ATYYC                           
071200             MOVE DP015-REVERSE        TO ATMMH                           
071300                                          ATDDH                           
071400                                          ATYYH                           
071500             MOVE -1                   TO ATMML                           
071600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
071700         END-IF                                                           
071800     END-IF.                                                              
071900                                                                          
072010*********************************************************************     
072100 3003-EDIT-PO-NBR.                                                        
072200     MOVE ASC-PO-NBR                  TO DP010I-UNEDITED-FIELD            
072300     MOVE +9                          TO DP010I-MAXIMUM-DIGITS            
072400     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
072500     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
072600                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
072800                                                                          
072900     IF DP010I-NO-ERROR-DETECTED                                          
073000         MOVE DP010I-NUMERIC-FIELD                                        
073100                                      TO DK-PO-NBR                        
073200                                         ASC-PO-NBR-N                     
073400     ELSE                                                                 
073500         MOVE -1                      TO APOL                             
073600         MOVE DP015-RED               TO APOC                             
073700         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER                 
073800         SET DP020-MSG-FATAL                                              
073900             DP030-SET-CURSOR-APPL-1                                      
074000             PS-ERROR                 TO TRUE                             
074100     END-IF.                                                              
074200     IF DK-PO-NBR > ZERO                                                  
074300         PERFORM 3070-VALIDATE-PO-NBR                                     
074400     END-IF.                                                              
074500/                                                                         
074600*********************************************************************     
078200 3005-EDIT-OPER-UNT.                                                      
078300                                                                          
078900     MOVE ASC-OPER-UNT-ID         TO DP010I-UNEDITED-FIELD                
079000     MOVE +4                      TO DP010I-MAXIMUM-DIGITS                
079100     MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS              
079200     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                              
079300                                                                          
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263968          USING DP010I-NUMERIC-EDIT-AREA                                  
079500                                                                          
079600     IF DP010I-NO-ERROR-DETECTED                                          
079700         MOVE DP010I-NUMERIC-FIELD TO DK-OPER-UNT-ID                      
079800                                      ASC-OPER-UNT-ID-N                   
080000     ELSE                                                                 
080100         MOVE -1                  TO AOPERL                               
080200         MOVE DP015-RED           TO AOPERC                               
080300         MOVE PC-TSYMSG-00008     TO DP020-MSG-NUMBER                     
080400         SET DP020-MSG-FATAL                                              
080500             DP030-SET-CURSOR-APPL-1                                      
080600             PS-ERROR             TO TRUE                                 
080700     END-IF                                                               
080800                                                                          
080900         IF DK-OPER-UNT-ID > ZERO                                         
081000             PERFORM 7020-GET-STORE-NAME                                  
082100         END-IF.                                                          
082400/                                                                         
082500**********************************************************************    
084900 3007-EDIT-DATES.                                                         
085000     PERFORM 30071-EDIT-FROM-DATE.                                        
085100     PERFORM 30072-EDIT-TO-DATE.                                          
085200                                                                          
085300     IF ASC-FROM-DATE = '0001-01-01'                                      
085400        OR ASC-TO-DATE = '9999-09-09'                                     
085500         CONTINUE                                                         
085600     ELSE                                                                 
085700         IF PS-NO-DATE-ERROR                                              
085800             PERFORM 30073-VALIDATE-DATES                                 
085900         END-IF                                                           
086000             IF PS-NO-DATE-ERROR                                          
086100                 PERFORM 30074-COMPARE-DATES                              
086200             END-IF                                                       
086300     END-IF.                                                              
086400                                                                          
086500                                                                          
086600 30071-EDIT-FROM-DATE.                                                    
086700     IF ASC-FROM-MM = SPACES                                              
086800         MOVE -1                      TO AFMML                            
086900         MOVE DP015-RED               TO AFMMC                            
087000         SET DP020-MSG-FATAL                                              
087100             DP030-SET-CURSOR-APPL-1                                      
087200             PS-DATE-ERROR                                                
087300             PS-ERROR                 TO TRUE                             
087400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
087500     END-IF                                                               
087600                                                                          
087700     IF ASC-FROM-DD = SPACES                                              
087800         MOVE -1                      TO AFDDL                            
087900         MOVE DP015-RED               TO AFDDC                            
088000         SET DP020-MSG-FATAL                                              
088100             DP030-SET-CURSOR-APPL-1                                      
088200             PS-DATE-ERROR                                                
088300             PS-ERROR                 TO TRUE                             
088400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
088500     END-IF                                                               
088600                                                                          
088700     IF ASC-FROM-YYYY = SPACES                                            
088800         MOVE -1                      TO AFYYL                            
088900         MOVE DP015-RED               TO AFYYC                            
089000         SET DP020-MSG-FATAL                                              
089100             DP030-SET-CURSOR-APPL-1                                      
089200             PS-DATE-ERROR                                                
089300             PS-ERROR                 TO TRUE                             
089400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
089500     END-IF.                                                              
089600                                                                          
089700 30072-EDIT-TO-DATE.                                                      
089800     IF ASC-TO-MM = SPACES                                                
089900         MOVE -1                      TO ATMML                            
090000         MOVE DP015-RED               TO ATMMC                            
090100         SET DP020-MSG-FATAL                                              
090200             DP030-SET-CURSOR-APPL-1                                      
090300             PS-DATE-ERROR                                                
090400             PS-ERROR                 TO TRUE                             
090500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
090600     END-IF                                                               
090700                                                                          
090800     IF ASC-TO-DD = SPACES                                                
090900         MOVE -1                      TO ATDDL                            
091000         MOVE DP015-RED               TO ATDDC                            
091100         SET DP020-MSG-FATAL                                              
091200             DP030-SET-CURSOR-APPL-1                                      
091300             PS-DATE-ERROR                                                
091400             PS-ERROR                 TO TRUE                             
091500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
091600     END-IF                                                               
091700                                                                          
091800     IF ASC-TO-YYYY = SPACES                                              
091900         MOVE -1                      TO ATYYL                            
092000         MOVE DP015-RED               TO ATYYC                            
092100         SET DP020-MSG-FATAL                                              
092200             DP030-SET-CURSOR-APPL-1                                      
092300             PS-DATE-ERROR                                                
092400             PS-ERROR                 TO TRUE                             
092500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
092600     END-IF.                                                              
092700                                                                          
092800 30073-VALIDATE-DATES.                                                    
092900     INITIALIZE DPG51 DPG52                                               
093000                DPG53 DPG54                                               
093100                DPG55 DPG56.                                              
093200                                                                          
093300     STRING                                                               
093400         ASC-FROM-YYYY                                                    
093500         ASC-FROM-MM                                                      
093600         ASC-FROM-DD DELIMITED BY SIZE                                    
093700                                      INTO DPG52-LK-DATE-INPUT            
093800                                                                          
093900     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
094000         DPG51-ACTUAL-CALENDAR-ONLY                                       
094100         DPG52-LK-DTE-ISO             TO TRUE                             
094200                                                                          
094300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
094400                                             DPG53 DPG54                  
094500                                             DPG55 DPG56.                 
094600     IF DPG54-DATE-INVALID                                                
094700         MOVE -1                      TO AFMML                            
094800         MOVE DP015-RED               TO AFMMC                            
094900                                         AFDDC                            
095000                                         AFYYC                            
095100         SET DP020-MSG-FATAL                                              
095200             DP030-SET-CURSOR-APPL-1                                      
095300             PS-DATE-ERROR                                                
095400             PS-ERROR                 TO TRUE                             
095500             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
095600     END-IF.                                                              
095700                                                                          
095800     INITIALIZE DPG51 DPG52                                               
095900                DPG53 DPG54                                               
096000                DPG55 DPG56.                                              
096100                                                                          
096200     STRING                                                               
096300         ASC-TO-YYYY                                                      
096400         ASC-TO-MM                                                        
096500         ASC-TO-DD DELIMITED BY SIZE                                      
096600                                      INTO DPG52-LK-DATE-INPUT            
096700                                                                          
096800     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
096900         DPG51-ACTUAL-CALENDAR-ONLY                                       
097000         DPG52-LK-DTE-ISO             TO TRUE                             
097100                                                                          
097200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
097300                                             DPG53 DPG54                  
097400                                             DPG55 DPG56.                 
097500     IF DPG54-DATE-INVALID                                                
097600         MOVE -1                      TO ATMML                            
097700         MOVE DP015-RED               TO ATMMC                            
097800                                         ATDDC                            
097900                                         ATYYC                            
098000         SET DP020-MSG-FATAL                                              
098100             DP030-SET-CURSOR-APPL-1                                      
098200             PS-DATE-ERROR                                                
098300             PS-ERROR                 TO TRUE                             
098400             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER                 
098500     END-IF.                                                              
098600                                                                          
098700 30074-COMPARE-DATES.                                                     
098800                                                                          
098900     INITIALIZE DPG51 DPG52                                               
099000                DPG53 DPG54                                               
099100                DPG55 DPG56.                                              
099200                                                                          
099300     STRING                                                               
099400         ASC-TO-YYYY                                                      
099500         ASC-TO-MM                                                        
099600         ASC-TO-DD DELIMITED BY SIZE                                      
099700                                      INTO DPG52-LK-DATE-INPUT            
099800                                                                          
099900     STRING                                                               
100000         ASC-FROM-YYYY                                                    
100100         ASC-FROM-MM                                                      
100200         ASC-FROM-DD DELIMITED BY SIZE                                    
100300                          INTO DPG53-LK-CMPR-DATE-INPUT                   
100400                                                                          
100500     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
100600         DPG51-ACTUAL-CALENDAR-ONLY                                       
100700         DPG52-LK-DTE-ISO                                                 
100800         DPG53-LK-CMPR-DTE-ISO        TO TRUE                             
100900                                                                          
101000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
101100                                             DPG53 DPG54                  
101200                                             DPG55 DPG56.                 
101300     IF DPG54-CMPR-DATE-VALID                                             
101400         IF DPG55-DAYS-DIFFERENCE < ZERO                                  
101500         MOVE -1                      TO AFMML                            
101600         MOVE DP015-RED               TO ATMMC                            
101700                                         ATDDC                            
101800                                         ATYYC                            
101900                                         AFMMC                            
102000                                         AFDDC                            
102100                                         AFYYC                            
102200         SET DP020-MSG-FATAL                                              
102300             DP030-SET-CURSOR-APPL-1                                      
102400             PS-DATE-ERROR                                                
102500             PS-ERROR                 TO TRUE                             
102600             MOVE PC-TSYMSG-02806     TO DP020-MSG-NUMBER                 
102700         END-IF                                                           
102800     END-IF.                                                              
102900/                                                                         
102910**********************************************************************    
104800 3009-PO-OPER-CHECK.                                                      
104900                                                                          
105000     EVALUATE TRUE                                                        
105100         WHEN ASC-PO-NBR-N > ZERO                                         
105200                        AND                                               
105300                ASC-REC-SEQ-NBR-N > ZERO                                  
105310                         AND                                              
105320                  ASC-OPER-UNT-ID-N > ZERO                                
105400              PERFORM 3075-VALIDATE-PO-REC-OPER                           
105500              IF RECEIV-CURR-OPER-UNT-ID = DK-OPER-UNT-ID                 
105600                 SET PS-OPER-EXISTS       TO TRUE                         
105700              ELSE                                                        
105710                 SET DP020-MSG-FATAL                                      
105720                     DP030-SET-CURSOR-APPL-1                              
105730                     PS-ERROR             TO TRUE                         
105740                 MOVE PC-TSYMSG-00955     TO DP020-MSG-NUMBER             
105750                 MOVE -1                  TO AOPERL                       
105760                 MOVE DP015-RED           TO AOPERC                       
105800              END-IF                                                      
106300                                                                          
106310         WHEN ASC-PO-NBR-N > ZERO                                         
106320                        AND                                               
106330                ASC-REC-SEQ-NBR-N = ZERO                                  
106340                         AND                                              
106350                  ASC-OPER-UNT-ID-N > ZERO                                
106398             CONTINUE                                                     
106400         WHEN OTHER                                                       
106500             SET DP020-MSG-FATAL                                          
106600                 DP030-SET-CURSOR-APPL-1                                  
106700                 PS-ERROR             TO TRUE                             
106800             MOVE PC-TSYMSG-02892     TO DP020-MSG-NUMBER                 
106900             MOVE -1                  TO APOL                             
107000             MOVE DP015-RED           TO APOC                             
107100                                         AOPERC                           
107200     END-EVALUATE.                                                        
107300                                                                          
107400/                                                                         
107410*********************************************************************     
107420 3070-VALIDATE-PO-NBR.                                                    
107430                                                                          
107440         EXEC SQL                                                         
107450            SELECT  DISTINCT                                              
107460                    ORD_NBR                                               
107470                   ,REC_SEQ_NBR                                           
107480                   ,CURR_OPER_UNT_ID                                      
107490              INTO  :RECEIV-ORD-NBR                                       
107491                   ,:RECEIV-REC-SEQ-NBR                                   
107492                   ,:RECEIV-CURR-OPER-UNT-ID                              
107493              FROM  TRECEIV                                               
107494             WHERE  ORD_NBR          = :DK-PO-NBR                         
107496         END-EXEC                                                         
107497                                                                          
107498         EVALUATE TRUE                                                    
107499             WHEN SQLCODE = +0                                            
107501             WHEN SQLCODE = -811                                          
107502                 SET PS-PO-EXISTS TO TRUE                                 
107503                                                                          
107504             WHEN SQLCODE = +100                                          
107505             WHEN SQLCODE = -904                                          
107506             WHEN SQLCODE = -913                                          
107507                 CONTINUE                                                 
107508                                                                          
107509             WHEN SQLWARN0 NOT = SPACES                                   
107510             WHEN SQLCODE < +0                                            
107511             WHEN SQLCODE > +0                                            
107512                 MOVE '3070-VALIDATE-PO-NBR'                              
107513                                 TO DP013-PARAGRAPH                       
107514                 MOVE 'SELECT PO NUMBER   '                               
107515                                 TO DP013-MESSAGE-TEXT (1)                
107516                 MOVE SQLCA      TO DP013-SQLCA                           
107517                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)              
107518                 SET DP013-DB2-ABEND  TO TRUE                             
107519                 SET DP013-XCTL-DISPLAY-RESTART  TO TRUE                  
107520                 PERFORM DP013-0000-PROCESS-ABEND                         
107521         END-EVALUATE.                                                    
107522/                                                                         
107523*********************************************************************     
107524 3075-VALIDATE-PO-REC-OPER.                                               
107525                                                                          
107526         EXEC SQL                                                         
107527            SELECT  DISTINCT                                              
107528                    ORD_NBR                                               
107529                   ,REC_SEQ_NBR                                           
107530                   ,CURR_OPER_UNT_ID                                      
107531              INTO  :RECEIV-ORD-NBR                                       
107532                   ,:RECEIV-REC-SEQ-NBR                                   
107533                   ,:RECEIV-CURR-OPER-UNT-ID                              
107534              FROM  TRECEIV                                               
107535             WHERE  ORD_NBR          = :DK-PO-NBR                         
107536               AND  REC_SEQ_NBR      = :DK-REC-SEQ-NBR                    
107537         END-EXEC                                                         
107538                                                                          
107539         EVALUATE TRUE                                                    
107540             WHEN SQLCODE = +0                                            
107544                SET PS-RECEIVER-EXISTS  TO TRUE                           
107554             WHEN SQLCODE = +100                                          
107555                SET DP020-MSG-FATAL                                       
107556                    DP030-SET-CURSOR-APPL-1                               
107557                    PS-ERROR             TO TRUE                          
107558                MOVE PC-TSYMSG-03009     TO DP020-MSG-NUMBER              
107559                MOVE -1                  TO ARECL                         
107560                MOVE DP015-RED           TO ARECC                         
107561                                                                          
107562             WHEN SQLCODE = -904                                          
107563             WHEN SQLCODE = -913                                          
107564                 CONTINUE                                                 
107565                                                                          
107566             WHEN SQLWARN0 NOT = SPACES                                   
107567             WHEN SQLCODE < +0                                            
107568             WHEN SQLCODE > +0                                            
107569                 MOVE '3075-VALIDATE-PO-REC-OPER'                         
107570                                 TO DP013-PARAGRAPH                       
107571                 MOVE 'SELECT PO NUMBER   '                               
107572                                 TO DP013-MESSAGE-TEXT (1)                
107573                 MOVE SQLCA      TO DP013-SQLCA                           
107574                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)              
107575                 SET DP013-DB2-ABEND  TO TRUE                             
107576                 SET DP013-XCTL-DISPLAY-RESTART  TO TRUE                  
107577                 PERFORM DP013-0000-PROCESS-ABEND                         
107578         END-EVALUATE.                                                    
107579/                                                                         
107580******************************************************************        
107581* IF THE ASSOCIATE SELECTS ALL RECEIVERS, THE RECEIVER FIELD MUST         
107582*  BE BLANK. ZERO WILL BE MOVED TO THE RECEIVER FIELD AND ZERO IS         
107583*  THE VALUE THAT WILL BE USED ON THE INSERT.                             
107584******************************************************************        
107585 3080-CHECK-ALL-RECEIVERS.                                                
107586                                                                          
107587     IF  ASC-REC-SEQ-NBR     = SPACES OR ZEROES                           
107588          MOVE 'N'   TO ASC-REC-SEQ-NBR-ALL-SW                            
107589          MOVE ZERO  TO ASC-REC-SEQ-NBR                                   
107590                        DK-REC-SEQ-NBR                                    
107591     ELSE                                                                 
107592          MOVE 'Y'   TO ASC-REC-SEQ-NBR-ALL-SW                            
107601     END-IF.                                                              
107602/                                                                         
107603******************************************************************        
107610** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **        
107700** MAP.                                                         **        
107800******************************************************************        
107900 3200-RESET-ATTRIBUTES.                                                   
108000     MOVE DP015-UNP-NUM-NOR-OFF       TO APOA                             
108100                                         ARECA                            
108110                                         ARCALLA                          
108200                                         AOPERA                           
108210                                         ASTRA                            
108300                                         AFMMA                            
108400                                         AFDDA                            
108500                                         AFYYA                            
108600                                         ATMMA                            
108700                                         ATDDA                            
108800                                         ATYYA                            
108900                                                                          
109000     MOVE DP015-GREEN                 TO APOC                             
109010                                         ARECC                            
109020                                         ARCALLC                          
109100                                         AOPERC                           
109200                                         ASTRC                            
109400                                         AFMMC                            
109500                                         AFDDC                            
109600                                         AFYYC                            
109700                                         ATMMC                            
109800                                         ATDDC                            
109900                                         ATYYC                            
110100                                                                          
110200     MOVE DP015-UNDERLINE             TO APOH                             
110500                                         ARECH                            
110501                                         ARCALLH                          
110510                                         AOPERH                           
110520                                         ASTRH                            
110600                                         AFMMH                            
110700                                         AFDDH                            
110800                                         AFYYH                            
110900                                         ATMMH                            
111000                                         ATDDH                            
111100                                         ATYYH.                           
111300                                                                          
111400     MOVE DP015-UNP-ALP-NOR-OFF       TO AOPERA.                          
111600/                                                                         
111610***********************************************************************   
111700 4000-BUILD-INITIAL-PANEL.                                                
111710                                                                          
111800     SET DP030-SET-CURSOR-APPL-1      TO TRUE                             
112100     MOVE DP020-LOCATION-NBR          TO ASC-OPER-UNT-ID-N                
112110                                         DK-OPER-UNT-ID                   
112200                                         AOPERO                           
112310     MOVE 'N'                         TO ARCALLO                          
112400*    PERFORM 7030-GET-TK-NUMBER                                           
112500     MOVE DP020-USERID                TO ATKNOO                           
113200                                         ASC-TK-NUMBER                    
113201                                         DK-USR-ID.                       
113210     PERFORM 7040-DEFAULT-FROM-DATE                                       
113211     MOVE PV-FROM-YYYY                TO AFYYO                            
113212                                         ASC-FROM-YYYY.                   
113213     MOVE PV-FROM-MM                  TO AFMMO                            
113214                                         ASC-FROM-MM.                     
113215     MOVE PV-FROM-DD                  TO AFDDO                            
113216                                         ASC-FROM-DD.                     
113217                                                                          
113218     MOVE PV-TO-YYYY                  TO ATYYO                            
113219                                         ASC-TO-YYYY.                     
113220     MOVE PV-TO-MM                    TO ATMMO                            
113221                                         ASC-TO-MM.                       
113222     MOVE PV-TO-DD                    TO ATDDO                            
113223                                         ASC-TO-DD.                       
113230                                                                          
113300     MOVE -1                          TO APOL.                            
113400                                                                          
113500                                                                          
113600*----------------------------------------------------------------*        
113700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
113800*----------------------------------------------------------------*        
113900 4400-MOVE-COMMAREA-TO-SCREEN.                                            
114000                                                                          
114500     MOVE ASC-PO-NBR-N                TO APOO                             
114510     MOVE ASC-REC-SEQ-NBR             TO ARECO                            
114600     MOVE ASC-OPER-UNT-ID             TO AOPERO                           
114700     MOVE ASC-STORE-NBR               TO ASTRO                            
114800     MOVE ASC-TK-NUMBER               TO ATKNOO                           
115000                                                                          
115100     IF ASC-REC-SEQ-NBR  = ZERO OR SPACES                                 
115200         MOVE 'Y'                     TO ARCALLO                          
115302     ELSE                                                                 
115303         MOVE 'N'                     TO ARCALLO                          
115304     END-IF.                                                              
115305                                                                          
115310     IF ASC-FROM-DATE = '01-01-0001'                                      
115320         MOVE SPACES                  TO ASC-FROM-DATE                    
115330     END-IF                                                               
115400         MOVE ASC-FROM-MM        TO AFMMO                                 
115500         MOVE ASC-FROM-DD        TO AFDDO                                 
115600         MOVE ASC-FROM-YYYY      TO AFYYO                                 
115700                                                                          
115800     IF ASC-TO-DATE = '09-09-9999'                                        
115900         MOVE SPACES                  TO ASC-TO-DATE                      
116000     END-IF                                                               
116100         MOVE ASC-TO-MM          TO ATMMO                                 
116200         MOVE ASC-TO-DD          TO ATDDO                                 
116300         MOVE ASC-TO-YYYY        TO ATYYO.                                
116400                                                                          
116700/                                                                         
116710*----------------------------------------------------------------*        
116720*  CHECK FOR CURRENT EXISTING REQUEST                             *       
116730*----------------------------------------------------------------*        
116740 5060-CHECK-PENDING-SUT00029.                                             
116750     MOVE ZEROES             TO PV-DB2-COUNT.                             
116751     MOVE DP020-USERID       TO SUT00029-USR-ID.                          
116752     MOVE DK-PO-NBR          TO SUT00029-PO-NBR.                          
116753     MOVE DK-REC-SEQ-NBR     TO SUT00029-REC-SEQ-NBR.                     
116754     MOVE DK-OPER-UNT-ID     TO SUT00029-ORGN-LOC-NBR.                    
116755     MOVE ASC-STORE-NBR      TO SUT00029-DEST-LOC-NBR.                    
116756                                                                          
116793                                                                          
116794         EXEC SQL                                                         
116795             SELECT COUNT(*)                                              
116797             INTO   :PV-DB2-COUNT                                         
116798             FROM   SUT_RPT_REQ                                           
116803             WHERE  USR_ID         = :SUT00029-USR-ID                     
116805               AND  PO_NBR         = :SUT00029-PO-NBR                     
116806               AND  REC_SEQ_NBR    = :SUT00029-REC-SEQ-NBR                
116807               AND  ORGN_LOC_NBR   = :SUT00029-ORGN-LOC-NBR               
116808               AND  DEST_LOC_NBR   = :SUT00029-DEST-LOC-NBR               
116810               AND  RPT_CRE_TMST   =  '9999-09-09-09.09.09.999999'        
116811         END-EXEC                                                         
116812                                                                          
116813         EVALUATE TRUE                                                    
116814             WHEN SQLCODE = +0                                            
116815                 CONTINUE                                                 
116819             WHEN SQLWARN0 NOT = SPACES                                   
116820             WHEN SQLCODE < +0                                            
116821             WHEN SQLCODE > +0                                            
116822                 MOVE '5060-CHECK-PENDING-SUT00029'                       
116823                                   TO DP013-PARAGRAPH                     
116824                 MOVE 'CHECK FOR EXISTING PEND REQ'                       
116825                                    TO DP013-MESSAGE-TEXT(1)              
116826                 MOVE SQLCA         TO DP013-SQLCA                        
116827                 MOVE 'SUT_RPT_REQ' TO DP013-DB2-TABLE-NAME (1)           
116828                 SET DP013-DB2-ABEND                                      
116829                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
116830                 PERFORM DP013-0000-PROCESS-ABEND                         
116831         END-EVALUATE.                                                    
116849                                                                          
116850/                                                                         
116851*----------------------------------------------------------------*        
116852*  INSERT A ROW TO SUT_RPT_REQ TABLE                             *        
116853*----------------------------------------------------------------*        
116854 5070-INSERT-SUT00029.                                                    
116855                                                                          
116856     MOVE DP020-USERID       TO SUT00029-USR-ID.                          
116857     MOVE DK-PO-NBR          TO SUT00029-PO-NBR.                          
116858     MOVE DK-REC-SEQ-NBR     TO SUT00029-REC-SEQ-NBR.                     
116859     MOVE DK-OPER-UNT-ID     TO SUT00029-ORGN-LOC-NBR.                    
116860     MOVE ASC-STORE-NBR      TO SUT00029-DEST-LOC-NBR.                    
116861                                                                          
116862     PERFORM                                                              
116863         WITH TEST AFTER                                                  
116864         VARYING PV-RETRY-COUNTER                                         
116865         FROM 1 BY 1                                                      
116866         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
116867             OR (SQLCODE = +0))                                           
116868                                                                          
116869         EXEC SQL                                                         
116870             INSERT  INTO SUT_RPT_REQ                                     
116871                    (USR_ID                                               
116872                    ,RPT_REQ_TMST                                         
116873                    ,PO_NBR                                               
116874                    ,REC_SEQ_NBR                                          
116875                    ,ORGN_LOC_NBR                                         
116876                    ,DEST_LOC_NBR                                         
116877                    ,RPT_CRE_TMST)                                        
116878            VALUES  (:SUT00029-USR-ID                                     
116879                    ,CURRENT_TIMESTAMP                                    
116880                    ,:SUT00029-PO-NBR                                     
116881                    ,:SUT00029-REC-SEQ-NBR                                
116882                    ,:SUT00029-ORGN-LOC-NBR                               
116883                    ,:SUT00029-DEST-LOC-NBR                               
116884                    ,'9999-09-09-09.09.09.999999')                        
116885         END-EXEC                                                         
116886                                                                          
116887         EVALUATE TRUE                                                    
116888             WHEN SQLCODE = +0                                            
116889                 MOVE PC-TSYMSG-01134 TO DP020-MSG-NUMBER                 
116890                                                                          
116891             WHEN SQLWARN0 NOT = SPACES                                   
116892             WHEN SQLCODE < +0                                            
116893             WHEN SQLCODE > +0                                            
116894                 MOVE '5070-INSERT-SUT00029'                              
116895                                   TO DP013-PARAGRAPH                     
116896                 MOVE 'INSERT A ROW ON SUT_RPT_REQ'                       
116897                                    TO DP013-MESSAGE-TEXT(1)              
116898                 MOVE SQLCA         TO DP013-SQLCA                        
116899                 MOVE 'SUT_RPT_REQ' TO DP013-DB2-TABLE-NAME (1)           
116900                 SET DP013-DB2-ABEND                                      
116901                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
116902                 PERFORM DP013-0000-PROCESS-ABEND                         
116903         END-EVALUATE                                                     
116904     END-PERFORM.                                                         
116905                                                                          
116906     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
116907             AND (SQLCODE = -904 OR -913)                                 
116908         MOVE '5070-INSERT-SUT00029'                                      
116909                                   TO DP013-PARAGRAPH                     
116910         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '                      
116911                                   TO DP013-MESSAGE-TEXT (1)              
116912         MOVE 'TO INSERT A SUT_RPT_REQ ROW'                               
116913                                   TO DP013-MESSAGE-TEXT (2)              
116914         MOVE SQLCA                TO DP013-SQLCA                         
116915         MOVE 'SUT_RPT_REQ'        TO DP013-DB2-TABLE-NAME (1)            
116916         SET DP013-DB2-ABEND                                              
116917             DP013-XCTL-DISPLAY-RESTART                                   
116918                                   TO TRUE                                
116919         PERFORM DP013-0000-PROCESS-ABEND                                 
116920     END-IF.                                                              
116921                                                                          
116922/                                                                         
116923*********************************************************************     
116924 7040-DEFAULT-FROM-DATE.                                                  
116925                                                                          
116930     INITIALIZE DCLTKRPRPM.                                               
116940                                                                          
116950     EXEC SQL                                                             
116960         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                           
116961               , CURRENT DATE                                             
116970           INTO  :PV-FROM-DATE-X                                          
116971               , :PV-TO-DATE-X                                            
116980           FROM  TKRPRPM                                                  
116990          WHERE  LOC_ID            = 90                                   
117000            AND  INTFC_SYS_CDE     = 'KHL'                                
117100            AND  SYS_PRC_FUNC_CDE  = 'ARCHDY'                             
117101            AND  FUNC_PRC_STAT_CDE = 'AC'                                 
117110     END-EXEC.                                                            
117120                                                                          
117121     EVALUATE TRUE                                                        
117122         WHEN SQLCODE = ZERO                                              
117123              MOVE PV-FROM-DATE-X  TO PV-FROM-DATE                        
117124              MOVE PV-TO-DATE-X    TO PV-TO-DATE                          
117125         WHEN SQLCODE = +100                                              
117126         WHEN SQLWARN0 NOT = SPACE                                        
117127         WHEN SQLCODE < ZERO                                              
117128         WHEN SQLCODE > ZERO                                              
117129             SET DP013-CICS-ABEND TO TRUE                                 
117130             SET DP013-NO-ROLLBACK TO TRUE                                
117131             MOVE '7040-DEFAULT-FROM-DATE' TO DP013-PARAGRAPH             
117132             PERFORM DP013-0000-PROCESS-ABEND                             
117133     END-EVALUATE.                                                        
117134                                                                          
117140/                                                                         
139410***********************************************************************   
139411 7020-GET-STORE-NAME.                                                     
139412                                                                          
493000     INITIALIZE XL071-COMMAREA-REC.                                       
493100     MOVE DK-OPER-UNT-ID   TO  XL071-LOCATION-NUMBER.                     
493200                                                                          
493300     CALL PC-LOCATION-MODULE  USING                                       
493400                                    DFHEIBLK                              
493500                                    XL071-COMMAREA                        
493600                                    XL071-COMMAREA-REC.                   
493700                                                                          
493800     EVALUATE TRUE                                                        
493900         WHEN XL071-NO-ERRORS                                             
494000             IF XL071-LOC-TYP-CDE = 'DC' OR 'HQ'                          
494100                 MOVE XL071-LOC-NM   TO ASC-STORE-NAME                    
494400             END-IF                                                       
494500         WHEN OTHER                                                       
081200             MOVE SPACES          TO ASC-STORE-NAME                       
081400             MOVE -1              TO AOPERL                               
081500             MOVE DP015-RED       TO AOPERC                               
081600             SET DP020-MSG-FATAL                                          
081700                 DP030-SET-CURSOR-APPL-1                                  
081800                 PS-ERROR         TO TRUE                                 
081900             MOVE PC-TSYMSG-02572 TO DP020-MSG-NUMBER                     
494700     END-EVALUATE.                                                        
494800                                                                          
139453*********************************************************************     
139454 7021-VALIDATE-STORE-NUMBER.                                              
139455*********************************************************************     
139456                                                                          
493000     INITIALIZE XL071-COMMAREA-REC.                                       
493100     MOVE ASC-STORE-NBR    TO  XL071-LOCATION-NUMBER.                     
493200                                                                          
493300     CALL PC-LOCATION-MODULE  USING                                       
493400                                    DFHEIBLK                              
493500                                    XL071-COMMAREA                        
493600                                    XL071-COMMAREA-REC.                   
493700                                                                          
493800     EVALUATE TRUE                                                        
493900         WHEN XL071-NO-ERRORS                                             
494000             IF XL071-LOC-TYP-CDE = 'DS'                                  
139471                 SET PS-STORE-EXISTS    TO TRUE                           
494200             ELSE                                                         
139473                 SET PS-STORE-EXISTS-NO TO TRUE                           
494400             END-IF                                                       
494500         WHEN OTHER                                                       
139473             SET PS-STORE-EXISTS-NO TO TRUE                               
494700     END-EVALUATE.                                                        
494800                                                                          
139491***********************************************************************   
139500 7030-GET-TK-NUMBER.                                                      
139800                                                                          
139900     EXEC CICS                                                            
140000         ASSIGN USERID (PV-USER-ID)                                       
140300             RESP     (PV-CICS-RESPONSE)                                  
140400     END-EXEC.                                                            
140500                                                                          
140600     IF PV-CICS-RESPONSE = DFHRESP (NORMAL)                               
140700        IF DP008-CALL-SUCCESSFUL                                          
140800           CONTINUE                                                       
140900        ELSE                                                              
141000           MOVE DP008-ERROR-CODE TO PM-CM-RETURN-CODE                     
141100           MOVE PM-CICSAUTH-MESSAGE TO DP013-MESSAGE-TEXT(1)              
141200           SET DP013-CICS-ABEND TO TRUE                                   
141300           SET DP013-NO-ROLLBACK TO TRUE                                  
141400           MOVE '7030-GET-TK-NUMBER'    TO DP013-PARAGRAPH                
141500           PERFORM DP013-0000-PROCESS-ABEND                               
141600        END-IF                                                            
141700     ELSE                                                                 
141800        MOVE 'GET TK NUMBER' TO DP013-MESSAGE-TEXT(1)                     
141900        SET DP013-CICS-ABEND TO TRUE                                      
142000        SET DP013-NO-ROLLBACK TO TRUE                                     
142100        MOVE '7030-GET-TK-NUMBER' TO DP013-PARAGRAPH                      
142200        PERFORM DP013-0000-PROCESS-ABEND                                  
142300     END-IF.                                                              
142400                                                                          
142500*----------------------------------------------------------------*        
142600*    ABEND PROCESSOR MODULE                                      *        
142700*----------------------------------------------------------------*        
142800                                                                          
142900     COPY DPPD013.                                                        
