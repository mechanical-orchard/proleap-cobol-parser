000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.   DPKUT410.                                          00030000
000400 AUTHOR.       CAROLYN GIFFORD.                                   00040000
000500 INSTALLATION. KOHLS DEPARTMENT STORES.                           00050000
000600 DATE-WRITTEN. 12/10/98.                                          00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000* THIS SUBPROGRAM WILL VALIDATE STATE OR COUNTRY CODE AS WELL AS *00100000
001100* RETURN THE COUNTRY OR PROVINCE DESCRIPTION TO THE CALLING      *00110000
001200* PROGRAM.                                                       *00120000
001300*                                                                *00130000
001400*   02/10/2003                                                  * 00140000
001500*      CHANGE MADE:  CALL TO PEOPLESOFT TABLE TO USE HR ALIASES * 00150000
001600*      UNTIL THE PEOPLESOFT FINANCIAL UPGRADE IS COMPLETE.      * 00160000
001700*   MADE BY: L SCHALLHORN                 WR#: 23417            * 00170000
001800*                                                               * 00180000
001900*   03/25/2003                                                  * 00190000
002000*      CHANGE MADE:  CALL TO PEOPLESOFT TABLE BACK TO USE FI    * 00200000
002100*      APLIASES.                                                * 00210000
002200*   MADE BY: L SCHALLHORN                 WR#: 23417            * 00220000
002300*                                                               * 00230000
002400* DATE  08/05/2011                                              * 00240000
002500*     CHANGE MADE: PROGRAM WAS MODIFIED TO REFERENCE NEW DB2    * 00250000
002600*                  TABLES AS THE EXISTING COUNTRIES AND STATE   * 00260000
002700*                  TABLES MIGARATED TO ORACLE.                  * 00270000
002800*                  TABLE          REPLACED           TABLE      * 00280000
002900*                  ======                          ========     * 00290000
003000*                  XFT_CNTRY                     FI_COUNTRY_TBL * 00300000
003100*                  XFT_ST_PROV_PS                FI_STATE_TBL   * 00310000
003200*   MADE BY: GURUNANAK                    WR/IR #: WR37038      * 00320000
003300******************************************************************00330000
003400                                                                  00340000
003500 ENVIRONMENT DIVISION.                                            00350000
003600 CONFIGURATION SECTION.                                           00360000
003700 SOURCE-COMPUTER.        IBM-3090.                                00370000
003800 OBJECT-COMPUTER.        IBM-3090.                                00380000
003900                                                                  00390000
004000 DATA DIVISION.                                                   00400000
004100 WORKING-STORAGE SECTION.                                         00410000
004200                                                                  00420000
004300 01  PC-PROGRAM-CONSTANTS.                                        00430000
004400     05  PC-MAX-RETRIES          PIC S9(04)  VALUE 3              00440000
004500                                             COMP SYNC.           00450000
004600                                                                  00460000
004700 01  PV-PROGRAM-VARIABLES.                                        00470000
004800     05  PV-RETRY-COUNTER        PIC S9(04)  VALUE +0             00480000
004900                                             COMP SYNC.           00490000
005000     05  PV-STATE-CODE           PIC X(06)   VALUE SPACES.        00500000
005100     05  PV-COUNTRY-3CHAR        PIC X(03)   VALUE SPACES.        00510000
005200                                                                  00520000
005300******************************************************************00530000
005400*  DB2 SQL ERROR MESSAGE FORMAT AREA                              00540000
005500******************************************************************00550000
005600     COPY DPWS004.                                                00560000
005700                                                                  00570000
005800******************************************************************00580000
005900***         COMMUNICATIONS AREA2 FOR DB2 ***                      00590000
006000******************************************************************00600000
006100     COPY SQLCA2.                                                 00610000
006200                                                                  00620000
006300     EXEC SQL                                                     00630000
006400          INCLUDE SQLCA                                           00640000
006500     END-EXEC.                                                    00650000
006600                                                                  00660000
006700******************************************************************00670000
006800***     DCLGEN FOR PEOPLESOFT COUNTRY TABLE                    ***00680000
006900******************************************************************00690000
007000     EXEC SQL                                                     00700000
007100          INCLUDE XFT00027                                        00710000
007200     END-EXEC.                                                    00720000
007300                                                                  00730000
007400******************************************************************00740000
007500***     DCLGEN FOR PEOPLESOFT STATE TABLE                      ***00750000
007600******************************************************************00760000
007700     EXEC SQL                                                     00770000
007800          INCLUDE XFT00028                                        00780000
007900     END-EXEC.                                                    00790000
008000                                                                  00800000
008100 LINKAGE SECTION.                                                 00810000
008200                                                                  00820000
008300******************************************************************00830000
008400*          STATE & COUNTRY CODE PARAMETER LIST LAYOUT            *00840000
008500******************************************************************00850000
008600                                                                  00860000
008700     COPY DPWS410.                                                00870000
008800                                                                  00880000
008900 PROCEDURE DIVISION USING DP410-ST-PROV-CNTRY-ROUTINE.            00890000
009000                                                                  00900000
009100 0000-MAINLINE.                                                   00910000
009200     INITIALIZE PV-PROGRAM-VARIABLES.                             00920000
009300     MOVE SPACES TO DP410-RECEIVING-FIELDS.                       00930000
009400     IF DP410-COUNTRY-CODE = SPACES OR 'US ' OR LOW-VALUES        00940000
009500         MOVE 'USA' TO PV-COUNTRY-3CHAR                           00950000
009600         MOVE 'US ' TO DP410-COUNTRY-CODE                         00960000
009700         MOVE SPACES TO DP410-COUNTRY-NAME                        00970000
009800     ELSE                                                         00980000
009900         PERFORM 1000-FIND-COUNTRY-CODE                           00990000
010000     END-IF.                                                      01000000
010100                                                                  01010000
010200     IF DP410-NO-ERRORS                                           01020000
010300         IF DP410-STATE-CODE = SPACES OR LOW-VALUES               01030000
010400             IF DP410-COUNTRY-CODE = 'US '                        01040000
010500                 SET DP410-MUST-ENTER-STATE TO TRUE               01050000
010600             ELSE                                                 01060000
010700                 MOVE SPACES TO DP410-STATE-NAME                  01070000
010800             END-IF                                               01080000
010900         ELSE                                                     01090000
011000             PERFORM 2000-FIND-STATE-CODE                         01100000
011100         END-IF                                                   01110000
011200     END-IF.                                                      01120000
011300                                                                  01130000
011400     GOBACK.                                                      01140000
011500                                                                  01150000
011600******************************************************************01160000
011700*******    VERIFY COUNTRY CODE & RETRIEVE COUNTRY NAME     *******01170000
011800******************************************************************01180000
011900 1000-FIND-COUNTRY-CODE.                                          01190000
012000                                                                  01200000
012100      PERFORM                                                     01210000
012200        WITH TEST AFTER                                           01220000
012300        VARYING PV-RETRY-COUNTER                                  01230000
012400        FROM 1 BY 1                                               01240000
012500        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                01250000
012600          OR (SQLCODE = ZERO)                                     01260000
012700          OR (SQLCODE = -904)                                     01270000
012800          OR (SQLCODE = +100))                                    01280000
012900        EXEC SQL                                                  01290000
013000         SELECT CNTRY_NM                                          01300000
013100               ,CNTRY_3_CHAR_CDE                                  01310000
013200          INTO :DP410-COUNTRY-NAME                                01320000
013300              ,:PV-COUNTRY-3CHAR                                  01330000
013400          FROM XFT_CNTRY                                          01340000
013500          WHERE CNTRY_CDE =:DP410-COUNTRY-CODE                    01350000
013600        END-EXEC                                                  01360000
013700        EVALUATE TRUE                                             01370000
013800            WHEN SQLCODE = ZERO                                   01380000
013900            WHEN SQLCODE = -913                                   01390000
014000               CONTINUE                                           01400000
014100            WHEN SQLCODE = -904                                   01410000
014200               SET DP410-DEADLOCK-BYPASS-ROUTINE TO TRUE          01420000
014300            WHEN SQLCODE = +100                                   01430000
014400               SET DP410-INVALID-COUNTRY TO TRUE                  01440000
014500            WHEN SQLWARN0 NOT = SPACES                            01450000
014600            WHEN SQLCODE < ZERO                                   01460000
014700            WHEN SQLCODE > ZERO                                   01470000
014800               SET  DP410-DB2-ERROR TO TRUE                       01480000
014900               MOVE 'DPKUT410'             TO DP410-PROGRAM-NAME  01490000
015000               MOVE '1000-FIND-CNTRY-CODE' TO DP410-PARAGRAPH-NAME01500000
015100               MOVE 'INVALID SELECT 1000 ' TO DP410-MESSAGE       01510000
015200               MOVE SQLCA                  TO DP410-SQLCODE       01520000
015300        END-EVALUATE                                              01530000
015400     END-PERFORM.                                                 01540000
015500                                                                  01550000
015600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        01560000
015700         SET  DP410-DB2-ERROR TO TRUE                             01570000
015800         MOVE 'DPKUT410'             TO DP410-PROGRAM-NAME        01580000
015900         MOVE '1000-FIND-CNTRY-CODE' TO DP410-PARAGRAPH-NAME      01590000
016000         MOVE 'TIMEOUT - PGH 1000  ' TO DP410-MESSAGE             01600000
016100         MOVE SQLCA                  TO DP410-SQLCODE             01610000
016200     END-IF.                                                      01620000
016300                                                                  01630000
016400******************************************************************01640000
016500*******      VERIFY STATE CODE & RETRIEVE STATE NAME       *******01650000
016600******************************************************************01660000
016700 2000-FIND-STATE-CODE.                                            01670000
016800                                                                  01680000
016900     PERFORM                                                      01690000
017000       WITH TEST AFTER                                            01700000
017100       VARYING PV-RETRY-COUNTER                                   01710000
017200       FROM 1 BY 1                                                01720000
017300       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 01730000
017400         OR (SQLCODE = ZERO)                                      01740000
017500         OR (SQLCODE = -904)                                      01750000
017600         OR (SQLCODE = +100))                                     01760000
017700       EXEC SQL                                                   01770000
017800        SELECT A.PS_ST_PROV_CDE,                                  01780000
017900               A.ST_PROV_NM                                       01790000
018000         INTO :PV-STATE-CODE                                      01800000
018100             ,:DP410-STATE-NAME                                   01810000
018200        FROM XFT_ST_PROV_PS A                                     01820000
018300           , XFT_CNTRY B                                          01830000
018400        WHERE A.PS_ST_PROV_CDE   = :DP410-STATE-CODE AND          01840000
018500              A.CNTRY_CDE        = B.CNTRY_CDE AND                01850000
018600              B.CNTRY_3_CHAR_CDE = :PV-COUNTRY-3CHAR              01860000
018700       END-EXEC                                                   01870000
018800       EVALUATE TRUE                                              01880000
018900           WHEN SQLCODE = ZERO                                    01890000
019000           WHEN SQLCODE = -913                                    01900000
019100               CONTINUE                                           01910000
019200           WHEN SQLCODE = +100                                    01920000
019300               SET DP410-INVALID-STATE TO TRUE                    01930000
019400           WHEN SQLCODE = -904                                    01940000
019500               SET DP410-DEADLOCK-BYPASS-ROUTINE TO TRUE          01950000
019600           WHEN SQLWARN0 NOT = SPACES                             01960000
019700           WHEN SQLCODE < ZERO                                    01970000
019800           WHEN SQLCODE > ZERO                                    01980000
019900               SET  DP410-DB2-ERROR TO TRUE                       01990000
020000               MOVE 'DPKUT410'             TO DP410-PROGRAM-NAME  02000000
020100               MOVE '2000-FIND-STATE-CODE' TO DP410-PARAGRAPH-NAME02010000
020200               MOVE 'INVALID SELECT 2000 ' TO DP410-MESSAGE       02020000
020300               MOVE SQLCA                  TO DP410-SQLCODE       02030000
020400       END-EVALUATE                                               02040000
020500     END-PERFORM.                                                 02050000
020600                                                                  02060000
020700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        02070000
020800         SET  DP410-DB2-ERROR TO TRUE                             02080000
020900         MOVE 'DPKUT410'             TO DP410-PROGRAM-NAME        02090000
021000         MOVE '2000-FIND-STATE-CODE' TO DP410-PARAGRAPH-NAME      02100000
021100         MOVE 'TIMEOUT - PGH 2000  ' TO DP410-MESSAGE             02110000
021200         MOVE SQLCA                  TO DP410-SQLCODE             02120000
021300     END-IF.                                                      02130000
021400                                                                  02140000
