000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000310 TITLE 'MANIFESTING - TRAILER AUDIT MENU SCREEN'.                 00031000
000400                                                                  00040000
000500 PROGRAM-ID.             PCKRF892.                                00050000
000600 AUTHOR.                 GERMAN BANDA.                            00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            JUNE, 2001.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE TRAILER AUDIT ASSOCIATE LOCATION      00120000
001300* SCREEN FROM SHIPPING SUBMENU                                    00130000
001400* TRANID = E892                                                   00140000
001500******************************************************************00150000
001600                                                                  00160000
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100******************************************************************00210000
002200 DATA DIVISION.                                                   00220000
002300******************************************************************00230000
002400                                                                  00240000
002500******************************************************************00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700******************************************************************00270000
002900     COPY PCWS045.                                                00290000
002910* HELP SCREEN COMMAREA                                            00291070
003000     COPY PCWS192.                                                00300070
003010* HELP SCREEN WORK AREA                                           00301070
003100     COPY PCWS188.                                                00310070
003600*                                                                 00360000
003700 01  DK-DB2-KEYS.                                                 00370000
003800     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00380000
003810     05  DK-TRLR-SRL-NBR                 PIC S9(09) COMP.         00381043
003900*                                                                 00390000
004000 01  PC-PROGRAM-CONSTANTS.                                        00400000
004100     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08)  VALUE 'PCKRF892'. 00410000
004300*    05  PC-RETURN-PGM              PIC  X(08)  VALUE 'PCKRF891'. 00430000
004500     05  PC-RANDOM-NBR-GENERATOR    PIC  X(08)  VALUE 'DPKUT902'. 00450000
004700     05  PC-AUDIT-STATUS-SCREEN     PIC  X(08)  VALUE 'PCKRF893'. 00470000
004900     05  PC-ERROR-MESSAGE-SCREEN    PIC  X(08)  VALUE 'PCKRF871'. 00490000
004910     05  PC-OPEN-FOR-AUDIT-PROGRAM  PIC  X(08)  VALUE 'PCKRF875'. 00491000
004920     05  PC-OPEN-CARTON-SCREEN      PIC  X(08)  VALUE 'PCKRF895'. 00492000
004930     05  PC-TRLR-STATUS-PGM         PIC  X(08)  VALUE 'PCKCS896'. 00493000
004931     05  PC-TRLR-AUD-SCAN-CARTON    PIC  X(08)  VALUE 'PCKRF894'. 00493181
004940     05  PC-CURRENT-TRANID          PIC  X(04)  VALUE 'E892'.     00494000
004951     05  PC-COMMAREA-LENGTH         PIC S9(04)  VALUE +1500.      00495100
004952     05  PC-HELP-SCREEN-PROGRAM     PIC  X(08)  VALUE 'DPKRF278'. 00495269
004953     05  PC-DEFAULT-STP-TMST        PIC  X(26)  VALUE             00495311
004954                                     '9999-09-09-09.09.09.999999'.00495411
004955     05  PC-TRANS-UNAVAILABLE-MSG   PIC  X(19)  VALUE             00495572
004956                                     'TRANS NOT AVAILABLE'.       00495672
004957                                                                  00495772
004958     05  PC-T                       PIC  X(01)  VALUE 'T'.        00495818
004959     05  PC-N                       PIC  X(01)  VALUE 'N'.        00495919
004960     05  PC-S                       PIC  X(01)  VALUE 'S'.        00496030
004961                                                                  00496111
004962*                                                                 00496200
004970 01  PS-PROGRAM-SWITCHES.                                         00497000
004980     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00498023
004990         88  PS-ERROR                                VALUE 'Y'.   00499023
005000         88  PS-NO-ERROR                             VALUE 'N'.   00500023
005010     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00501023
005020         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00502023
005030         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00503023
005100     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   00510000
005200         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   00520000
005300         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   00530000
005301         88  PS-MULT-TRLR-AUDITS-EXIST               VALUE 'M'.   00530143
005310     05  PS-TRLR-SRL-EXISTS-SW           PIC  X(01)  VALUE 'Y'.   00531000
005320         88  PS-TRLR-SRL-EXISTS                      VALUE 'Y'.   00532000
005330         88  PS-TRLR-SRL-NOT-EXISTS                  VALUE 'N'.   00533000
005400                                                                  00540000
005500 01  PV-PROGRAM-VARIABLES.                                        00550000
005600     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00560000
005700                                                     COMP SYNC.   00570000
005800     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 00580000
005900     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00590000
006000     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00600000
006100                                                     COMP SYNC.   00610000
006200     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00620000
006300     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  00630000
006400                                                     COMP.        00640000
006500     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  00650000
006600                                                     COMP.        00660000
006700     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   00670000
006800                                                     COMP.        00680000
006900     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   00690000
007000                                                     COMP SYNC.   00700000
007100*                                                                 00710000
007200 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  00720000
007300     05  TS-INFO-QUEUE-NAME.                                      00730000
007400         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 00740000
007500         10  FILLER                      PIC  X(04)  VALUE 'INFO'.00750000
007600                                                                  00760000
007700******************************************************************00770000
007800*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      00780000
007900******************************************************************00790000
008000     COPY DFHAID.                                                 00800000
008700                                                                  00870000
008800******************************************************************00880000
008900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00890000
009000******************************************************************00900000
009100     COPY DPWS013.                                                00910000
009200                                                                  00920000
009300******************************************************************00930000
009400*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        00940000
009500******************************************************************00950000
009600     COPY DPWS008.                                                00960000
009700                                                                  00970000
009800******************************************************************00980000
009900*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00990000
010000*****************************************************************.01000000
010100     COPY DPWS010I.                                               01010000
010200                                                                  01020000
010300******************************************************************01030000
010400*  RANDOM NUMBER AREA.                                            01040000
010500******************************************************************01050000
010600     COPY DPWS902.                                                01060000
010700                                                                  01070000
010800******************************************************************01080000
010900*  GENERATED DSECT FOR THE PCKM892 MAPSET                         01090000
011000******************************************************************01100000
011100     COPY PCKM892.                                                01110000
011200                                                                  01120000
011300******************************************************************01130000
011400*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01140000
011500******************************************************************01150000
011600     COPY DPWS015.                                                01160000
011800                                                                  01180000
013010******************************************************************01301000
013020*  COMMUNICATION AREA FOR TRAILER STATUS MODULE (PCKCS896)        01302000
013040******************************************************************01304000
013050     COPY PCWS048.                                                01305000
013060                                                                  01306000
013100******************************************************************01310000
013200*  COPY BOOK CONTAINING ERROR MESSAGES                            01320000
013400******************************************************************01340000
013500     COPY PCWS044.                                                01350000
013600                                                                  01360000
013610******************************************************************01361000
013620*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL WHEN ERROR    01362000
013630*  HANDLING PROGRAM IS CALLED (PCKRF871)                          01363000
013640******************************************************************01364000
013641 01  CA-COMMAREA.                                                 01364100
013650     COPY PCWS233.                                                01365000
013651    05  CA-PROGRAM-COMMAREA.                                      01365184
013653         10  CA-SPOT-AUDIT-CREATE-IND    PIC  X(01)  VALUE 'N'.   01365384
013654             88  CA-SPOT-AUDIT-CREATE                VALUE 'Y'.   01365484
013660                                                                  01366000
013700******************************************************************01370000
013800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01380000
013900*  AUDIT TABLE (TSUNAUD)                                          01390000
014000******************************************************************01400000
014100     EXEC SQL                                                     01410000
014200         INCLUDE TSUNAUD                                          01420000
014300     END-EXEC.                                                    01430000
014400                                                                  01440000
014410******************************************************************01441000
014411******************************************************************01441144
014412*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE OUTBOUND TRIP      01441244
014413*  TABLE (TSUOBTR)                                                01441344
014414******************************************************************01441444
014415     EXEC SQL                                                     01441544
014416         INCLUDE TSUOBTR                                          01441644
014417     END-EXEC.                                                    01441744
014418                                                                  01441844
014419******************************************************************01441944
014420*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE AUDIT TRAILER      01442000
014430*  TRIP TABLE (SUT_AUD_TRLR_TRIP)                                 01443000
014440******************************************************************01444000
014450     EXEC SQL                                                     01445000
014460         INCLUDE SUT00004                                         01446000
014470     END-EXEC.                                                    01447000
014480                                                                  01448000
014500******************************************************************01450000
014600*  COMMUNICATIONS AREA FOR DB2                                    01460000
014700******************************************************************01470000
014800     EXEC SQL                                                     01480000
014900         INCLUDE SQLCA                                            01490000
015000     END-EXEC.                                                    01500000
015100                                                                  01510000
015200******************************************************************01520000
015300 LINKAGE SECTION.                                                 01530000
015400******************************************************************01540000
015500 01  DFHCOMMAREA.                                                 01550000
015600     05  FILLER                         OCCURS  1 TO 4072 TIMES   01560000
015700                                        DEPENDING ON EIBCALEN.    01570000
015800         10  FILLER                     PIC X.                    01580000
015900                                                                  01590000
016000                                                                  01600000
016100******************************************************************01610000
016200 PROCEDURE DIVISION.                                              01620000
016300******************************************************************01630000
016400 0000-PROGRAM-MAINLINE.                                           01640000
016500     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           01650000
016510     MOVE PC233-HOST-SAVE-AREA  TO  PC045-COMMAREA-REC.           01651092
016600     MOVE LOW-VALUES   TO  PC892AI.                               01660000
016601                                                                  01660100
016602                                                                  01660200
016610     EXEC CICS                                                    01661000
016620         ASSIGN USERID  (PC045-USERID)                            01662000
016630                RESP    (PV-CICS-RESPONSE)                        01663000
016650     END-EXEC.                                                    01665000
016660                                                                  01666000
016670                                                                  01667000
016680     EVALUATE TRUE                                                01668000
016690         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 01669000
016691             MOVE PC045-USERID TO PC233-USER-ID                   01669152
016693         WHEN OTHER                                               01669300
016694            MOVE '0000-PROGRAM-MAINLINE' TO DP013-PARAGRAPH       01669400
016695            MOVE 'PCKRF892 - UNABLE TO ASSIGN USER-ID'            01669500
016696              TO DP013-MESSAGE-TEXT (1)                           01669600
016697            SET DP013-LOGIC-ABEND        TO TRUE                  01669700
016698            SET DP013-ROLLBACK           TO TRUE                  01669800
016699            PERFORM 9999-WRITE-CICS-LOG-MSG                       01669900
016700     END-EVALUATE.                                                01670000
016710                                                                  01671000
016800     EVALUATE TRUE                                                01680000
016900         WHEN EIBCALEN = ZERO                                     01690000
017000         WHEN EIBAID = DFHCLEAR                                   01700000
017200         WHEN PC233-INITIALIZE-SCREEN                             01720000
017300              SET PC233-PROCESS-SCREEN  TO  TRUE                  01730000
017310              IF (PC233-LAST-PROGRAM = PC-OPEN-FOR-AUDIT-PROGRAM) 01731055
017311                  AND                                             01731155
017312                 (PC045-OTBND-TRIP-STATUS = 'AO')                 01731255
017313* CALL TRLR STATUS MODULE TO CHECK IF THE TRLR WAS REOPEND        01731386
017314* AT A DIFFERENT DOOR                                             01731486
017320                    PERFORM 2000-VALIDATE-TRLR-SRL-NBR            01732086
017330                    PERFORM 3400-PROCESS-AUDIT-CREATE             01733086
017350              ELSE                                                01735004
017360                 INITIALIZE PC045-COMMAREA-REC                    01736092
017601                 MOVE 'PCKRF892' TO PC233-ROOT-PROGRAM            01760101
017610              END-IF                                              01761000
017700              PERFORM 8000-SEND-MAP                               01770000
017800              PERFORM 8200-RETURN-TRANID                          01780000
017900                                                                  01790000
017930*        RETURNING FROM HELP SCREEN                               01793080
017940         WHEN EIBTRNID = 'Z278'                                   01794080
017950             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01795080
017960             MOVE PC192-HOST-SAVE-AREA                            01796080
017970                                      TO CA-COMMAREA              01797080
017980             SET PC233-PROCESS-SCREEN TO TRUE                     01798080
017990             MOVE PC192-HOST-SAVE-MAP TO PC892AO                  01799080
017991             MOVE -1                  TO ATRLRL                   01799180
017992             PERFORM 8000-SEND-MAP                                01799280
017993             PERFORM 8200-RETURN-TRANID                           01799380
017994                                                                  01799480
018000         WHEN EIBAID = DFHENTER                                   01800000
018100              PERFORM 1200-RECEIVE-MAP                            01810000
018200              MOVE SPACES TO AMSGLNO                              01820000
018300              PERFORM 1300-EDIT-SELECTION                         01830000
018310              IF PC045-TRLR-SRL-NBR > ZEROES                      01831088
018400                 PERFORM 1330-EDIT-AUDIT-SELECTION                01840088
018410              END-IF                                              01841088
018500*        F2 TO CONTINUE AN AUDIT                                  01850000
018600*                                                                 01860000
019000         WHEN EIBAID = DFHPF2                                     01900000
019100             PERFORM 1200-RECEIVE-MAP                             01910000
019110             IF PC045-AUDIT-INPROCESS                             01911007
019111                SET  PC045-OPEN-FOR-AUDIT  TO TRUE                01911138
019120                IF PC045-100-AUDIT-CHECK                          01912007
019121                  MOVE PC-OPEN-CARTON-SCREEN                      01912107
019122                              TO PV-TRANSFER-PROGRAM              01912207
019123                  PERFORM 2200-XCTL-TO-SELECTED-PROGRAM           01912307
019130                ELSE                                              01913007
019131                  IF CA-SPOT-AUDIT-CREATE                         01913184
019132                     MOVE PC-TRLR-AUD-SCAN-CARTON                 01913281
019133                                TO PV-TRANSFER-PROGRAM            01913381
019134                  ELSE                                            01913481
019135                     MOVE PC-AUDIT-STATUS-SCREEN                  01913581
019136                                TO PV-TRANSFER-PROGRAM            01913681
019138                  END-IF                                          01913882
019139                    PERFORM 2200-XCTL-TO-SELECTED-PROGRAM         01913983
019140                END-IF                                            01914082
019141             END-IF                                               01914107
019150                                                                  01915042
019170             IF PC045-AUDIT-CNTL-NBR > 0                          01917042
019171                PERFORM 1300-EDIT-SELECTION                       01917142
019180                PERFORM 1350-VALIDATE-AUDIT-STATUS                01918042
019181                  IF PS-AUDIT-NBR-EXISTS                          01918142
019182                     IF PC045-AUDIT-STATUS = 'CM'                 01918242
019183                        MOVE PC-AUDIT-STATUS-SCREEN               01918342
019184                                   TO PV-TRANSFER-PROGRAM         01918442
019185                        PERFORM 2100-XCTL-TO-SELECTED-PROGRAM     01918542
019186                     ELSE                                         01918649
019188                        PERFORM 2000-VALIDATE-TRLR-SRL-NBR        01918849
019189                        PERFORM 3600-CHECK-TRLR-STAT-CONT         01918949
019191                     END-IF                                       01919142
019192                  ELSE                                            01919242
019194                     MOVE PC044-AUDIT-NOT-FOUND-MSG TO  AMSGLNO   01919442
019195                     MOVE -1                TO  ACNTLL            01919565
019196                  END-IF                                          01919642
019200             ELSE                                                 01920042
019210             IF PC045-TRLR-SRL-NBR   > 0                          01921042
019300                PERFORM 1300-EDIT-SELECTION                       01930000
019400                PERFORM 1360-SEL-AUDIT-FROM-TRLR-SRL              01940047
019500                IF PS-MULT-TRLR-AUDITS-EXIST                      01950043
019600                   MOVE  PC044-AUD-NBR-REQ-MSG                    01960043
019700                                          TO  AMSGLNO             01970047
019710                   MOVE -1                TO  ACNTLL              01971065
019800                ELSE                                              01980047
019900                  IF PS-AUDIT-NBR-NOT-EXISTS                      01990062
019910                     MOVE PC044-AUDIT-NOT-FOUND-MSG TO  AMSGLNO   01991062
019920                     MOVE -1                TO  ACNTLL            01992065
020000                  ELSE                                            02000062
020300                    PERFORM 2000-VALIDATE-TRLR-SRL-NBR            02030062
020420                    PERFORM 3600-CHECK-TRLR-STAT-CONT             02042062
021212                  END-IF                                          02121262
021213             ELSE                                                 02121322
021214                 MOVE PC044-TRLR-NBR-REQ-MSG  TO  AMSGLNO         02121422
021215                 MOVE -1                TO  ATRLRL                02121565
021240             END-IF                                               02124000
021241             END-IF                                               02124143
021250                                                                  02125000
021260*        F4 TO CREATE A NEW AUDIT                                 02126000
021270         WHEN EIBAID = DFHPF4                                     02127000
021280              PERFORM 1200-RECEIVE-MAP                            02128000
021281              IF PC045-AUDIT-INPROCESS                            02128107
021282                 MOVE PC044-UNRECOGNIZED-PF-KEY-MSG TO AMSGLNO    02128207
021283              ELSE                                                02128307
021290                 PERFORM 1300-EDIT-SELECTION                      02129007
021291                 PERFORM 1330-EDIT-AUDIT-SELECTION                02129125
021300                 IF  PC045-TRLR-SRL-NBR-X  >  0                   02130007
021400                     PERFORM 2000-VALIDATE-TRLR-SRL-NBR           02140007
021401****************************************************************  02140140
021402* IF AUDIT IS IN PROCESS, OR A 100% AUDIT HAS BEEN COMPLETED   *  02140240
021403* A MESSAGE SCREEN WITH THE AUDIT NBR WILL DISPLAY             *  02140340
021404* OTHERWISE, A NEW AUDIT NBR WILL BE CREATED                      02140440
021405****************************************************************  02140540
021410                     IF PC045-AUDIT-STATUS = 'IP' OR              02141041
021411                        (PC045-AUDIT-STATUS = 'CM' AND            02141141
021412                          PC045-100-AUDIT-CHECK)                  02141240
021420                          MOVE '21' TO PC233-PGM-MSG-NBR          02142040
021430                          MOVE PC-ERROR-MESSAGE-SCREEN            02143040
021440                                      TO PV-TRANSFER-PROGRAM      02144040
021490                          PERFORM 2200-XCTL-TO-SELECTED-PROGRAM   02149040
021500                     ELSE                                         02150039
022506                           PERFORM 3610-CHECK-TRLR-STAT-CRE       02250640
022508                     END-IF                                       02250840
022509                 ELSE                                             02250907
022510                     MOVE PC044-TRLR-NBR-REQ-MSG TO  AMSGLNO      02251007
022511                     MOVE -1                TO  ATRLRL            02251107
022512                 END-IF                                           02251207
022513              END-IF                                              02251307
022514         WHEN EIBAID = DFHPF3                                     02251400
022515             MOVE PC233-MENU-PROGRAM    TO  PV-TRANSFER-PROGRAM   02251500
022516             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                02251600
022518*                                                                 02251885
022519         WHEN EIBAID = DFHPF1                                     02251969
022520             PERFORM 1200-RECEIVE-MAP                             02252071
022521             MOVE PC892AO   TO PC192-HOST-SAVE-MAP                02252171
022522             PERFORM 1100-HELP-SCREEN                             02252270
022523                                                                  02252375
022536         WHEN OTHER                                               02253600
022537             MOVE PC044-UNRECOGNIZED-PF-KEY-MSG TO AMSGLNO        02253700
022540                                                                  02254000
022550     END-EVALUATE.                                                02255000
022560                                                                  02256000
022570     PERFORM 8100-SEND-DATA-ONLY.                                 02257000
022580     PERFORM 8200-RETURN-TRANID.                                  02258000
022590                                                                  02259000
022600     GOBACK.                                                      02260000
022700*                                                                 02270000
022800*                                                                 02280000
022810 1100-HELP-SCREEN.                                                02281069
022811     MOVE PC-HELP-SCREEN-PROGRAM     TO  PV-TRANSFER-PROGRAM.     02281170
022812     MOVE PC-CURRENT-PROGRAM-NAME    TO  PC192-PROGRAM-NAME.      02281270
022813     COPY PCPD188.                                                02281371
022814     MOVE PC188-DISPLAY-DATE         TO  PC192-DISPLAY-DATE.      02281470
022815     MOVE CA-COMMAREA                TO  PC192-HOST-SAVE-AREA.    02281571
022816     PERFORM 1110-XCTL-TO-HELP.                                   02281671
022817                                                                  02281770
022820 1110-XCTL-TO-HELP.                                               02282071
022821     MOVE LENGTH OF PC192-COMMAREA   TO PV-COMMAREA-LENGTH.       02282171
022822     EXEC CICS                                                    02282271
022823         XCTL                                                     02282371
022824            PROGRAM          (PV-TRANSFER-PROGRAM)                02282471
022825            COMMAREA         (PC192-COMMAREA)                     02282571
022826            LENGTH           (PV-COMMAREA-LENGTH)                 02282671
022827            RESP             (PV-CICS-RESPONSE)                   02282771
022828     END-EXEC.                                                    02282871
022830                                                                  02283070
022840     EVALUATE TRUE                                                02284071
022850         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02285071
022860             CONTINUE                                             02286071
022870         WHEN OTHER                                               02287071
022880             MOVE '1110-XCTL-TO-HELP'   TO DP013-PARAGRAPH        02288071
022890             MOVE 'PCKRF892 - UNABLE TO XCTL TO PROGRAMS'         02289071
022891                                        TO DP013-MESSAGE-TEXT (1) 02289171
022892             MOVE PV-TRANSFER-PROGRAM   TO DP013-MESSAGE-TEXT (2) 02289271
022893             SET DP013-CICS-ABEND                                 02289371
022894                 DP013-ROLLBACK         TO TRUE                   02289471
022895             PERFORM 9999-WRITE-CICS-LOG-MSG                      02289572
022896             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             02289671
022897             SET PC233-PROCESS-SCREEN   TO TRUE                   02289771
022898             MOVE -1                    TO ATRLRL                 02289879
022899             PERFORM 8000-SEND-MAP                                02289971
022900             PERFORM 8200-RETURN-TRANID                           02290071
022901     END-EVALUATE.                                                02290171
022902                                                                  02290271
022910 1200-RECEIVE-MAP.                                                02291000
023000     EXEC CICS                                                    02300000
023100         RECEIVE                                                  02310000
023200             MAP     ('PC892A')                                   02320000
023300             MAPSET  ('PCKM892')                                  02330000
023400             RESP    (PV-CICS-RESPONSE)                           02340000
023500     END-EXEC.                                                    02350000
023600                                                                  02360000
023700     EVALUATE TRUE                                                02370000
023800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02380000
023900              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  02390000
023910                                                                  02391000
024000         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02400000
024100              CONTINUE                                            02410000
024110                                                                  02411000
024200         WHEN OTHER                                               02420000
024300              MOVE '1200-RECEIVE-MAP'                             02430000
024400                                     TO DP013-PARAGRAPH           02440000
024500              MOVE 'UNABLE TO RECEIVE MAP'                        02450000
024600                                     TO DP013-MESSAGE-TEXT (1)    02460000
024700              SET DP013-LOGIC-ABEND  TO TRUE                      02470000
024800              SET DP013-NO-ROLLBACK  TO TRUE                      02480000
024900              PERFORM 9999-WRITE-CICS-LOG-MSG                     02490000
025000     END-EVALUATE.                                                02500000
025100                                                                  02510000
025110                                                                  02511000
025200 1210-RECEIVE-SCREEN-FIELDS.                                      02520000
025210                                                                  02521000
025300*    THE AUDIT NUMBER CHANGED.  MOVE THE NEW VALUE TO THE         02530000
025400*    COMMAREA, AND SET THE FLAG TO SAY IT ISN'T A NEW AUDIT       02540000
025410                                                                  02541000
025420     INITIALIZE  PC045-100-CHECK                                  02542056
025430                 PC045-SPOT-CHECK.                                02543056
025440                                                                  02544056
025500     IF  ACNTLL > ZERO                                            02550000
025600         MOVE ACNTLI  TO PC045-AUDIT-CNTL-NBR-X                   02560000
025700     END-IF.                                                      02570000
025800                                                                  02580000
025900     IF ATRLRL  > ZERO                                            02590000
026000         MOVE ATRLRI  TO PC045-TRLR-SRL-NBR-X                     02600000
026100     END-IF.                                                      02610000
026200                                                                  02620000
026300     IF  A100L    > ZERO                                          02630000
026400         MOVE A100I     TO  PC045-100-CHECK                       02640000
026500     END-IF.                                                      02650000
026600                                                                  02660000
026700     IF  ASPOTL   > ZERO                                          02670000
026800         MOVE ASPOTI    TO  PC045-SPOT-CHECK                      02680000
026900     END-IF.                                                      02690000
027000                                                                  02700000
027010                                                                  02701000
027100**************************************************************    02710000
027200* EDIT ALL ENTERABLE FIELDS                                  *    02720000
027300**************************************************************    02730000
027400 1300-EDIT-SELECTION.                                             02740000
027500                                                                  02750000
027510     IF  PC045-AUDIT-CNTL-NBR-X  >  SPACES                        02751000
027520         PERFORM 1310-CK-NUM-AUDIT-NBR                            02752000
027530     END-IF.                                                      02753000
027540                                                                  02754000
027550     IF  PC045-TRLR-SRL-NBR-X  >  SPACES                          02755020
027560         PERFORM 1320-CK-NUM-TRLR-SRL                             02756020
027570     END-IF.                                                      02757020
027580                                                                  02758000
031801                                                                  03180100
031802                                                                  03180200
031803****************************************************************  03180300
031804*  CHECK TO MAKE SURE THE ENTERED AUDIT CNTL NUMBER IS NUMERIC    03180400
031805****************************************************************  03180500
031810 1310-CK-NUM-AUDIT-NBR.                                           03181000
031820                                                                  03182000
031830     MOVE PC045-AUDIT-CNTL-NBR-X     TO DP010I-UNEDITED-FIELD.    03183000
031840     MOVE 9                          TO DP010I-MAXIMUM-DIGITS.    03184000
031850     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03185000
031860     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03186000
031870                                                                  03187000
031881     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03188194
031882                         USING DP010I-NUMERIC-EDIT-AREA           03188294
031890                                                                  03189000
031891     IF  DP010I-ERROR-DETECTED                                    03189100
031892         MOVE PC044-NUMERIC-VAL-REQ-MSG TO AMSGLNO                03189200
031894         PERFORM 8100-SEND-DATA-ONLY                              03189400
031895         PERFORM 8200-RETURN-TRANID                               03189500
031896     ELSE                                                         03189600
031897         MOVE DP010I-NUMERIC-FIELD   TO PC045-AUDIT-CNTL-NBR      03189700
031898     END-IF.                                                      03189800
031899                                                                  03189900
031904                                                                  03190400
031905                                                                  03190500
031906****************************************************************  03190600
031907* CHECK TO MAKE SURE THE ENTERED TRLR SERIAL NMBR IS NUMERIC      03190700
031908****************************************************************  03190800
031909 1320-CK-NUM-TRLR-SRL.                                            03190900
031910                                                                  03191000
031911     MOVE PC045-TRLR-SRL-NBR-X       TO DP010I-UNEDITED-FIELD.    03191100
031912     MOVE 9                          TO DP010I-MAXIMUM-DIGITS.    03191200
031913     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03191300
031914     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03191400
031915                                                                  03191500
031917     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03191794
031918                         USING DP010I-NUMERIC-EDIT-AREA           03191894
031919                                                                  03191900
031920     IF  DP010I-ERROR-DETECTED                                    03192000
031921         MOVE PC044-NUMERIC-VAL-REQ-MSG TO AMSGLNO                03192100
031922         PERFORM 8100-SEND-DATA-ONLY                              03192200
031923         PERFORM 8200-RETURN-TRANID                               03192300
031924     ELSE                                                         03192400
031925         MOVE DP010I-NUMERIC-FIELD   TO PC045-TRLR-SRL-NBR        03192500
031926     END-IF.                                                      03192600
031927                                                                  03192700
031928                                                                  03192800
031929****************************************************************  03192900
031930*  EDIT AUDIT SELECTION TYPE                                      03193000
031931****************************************************************  03193100
031932 1330-EDIT-AUDIT-SELECTION.                                       03193200
031933                                                                  03193300
031934* ONLY ONE SELECTION TYPE IS VALID "100%" -OR- "SPOT"             03193400
031935                                                                  03193500
031936     IF  PC045-100-CHECK  > SPACES  AND                           03193600
031937         PC045-SPOT-CHECK > SPACES                                03193700
031938             MOVE PC044-ONLY-ONE-SELECTION-MSG  TO  AMSGLNO       03193800
031939             MOVE -1 TO A100L                                     03193901
031940             PERFORM 8100-SEND-DATA-ONLY                          03194000
031941             PERFORM 8200-RETURN-TRANID                           03194100
031942     END-IF.                                                      03194200
031943                                                                  03194300
031944*    IF THE USER IS CREATING A NEW AUDIT, THEY MUST               03194400
031945*    SELECT ONE OF THE TYPE OPTIONS.                              03194500
031946                                                                  03194600
031947     IF  PC045-100-CHECK      = SPACES  AND                       03194700
031948         PC045-SPOT-CHECK     = SPACES                            03194800
031949             MOVE -1 TO A100L                                     03194900
031950             MOVE PC044-SELECT-TYPE-MSG     TO  AMSGLNO           03195000
031951             PERFORM 8100-SEND-DATA-ONLY                          03195100
031952             PERFORM 8200-RETURN-TRANID                           03195200
031953     END-IF                                                       03195300
031954                                                                  03195400
031955*    SET APPROPRIATE COMMAREA FIELD                               03195500
031956                                                                  03195600
031957     IF  PC045-100-CHECK      > SPACES                            03195700
031958           SET PC045-100-AUDIT-CHECK     TO TRUE                  03195800
031959           MOVE 'X'    TO  A100O                                  03195900
031960           MOVE ' '    TO  ASPOTO                                 03196000
031961     ELSE                                                         03196100
031962     IF  PC045-SPOT-CHECK     > SPACES                            03196200
031963           SET PC045-SPOT-AUDIT-CHECK    TO TRUE                  03196300
031964           MOVE 'X'    TO  ASPOTO                                 03196400
031965           MOVE ' '    TO  A100O                                  03196500
031966     END-IF                                                       03196600
031967     END-IF.                                                      03196700
031968                                                                  03196820
031969****************************************************************  03196942
031970* 1350-VALIDATE-AUDIT-STATUS.                                  *  03197042
031990****************************************************************  03199042
031991 1350-VALIDATE-AUDIT-STATUS.                                      03199142
031992                                                                  03199242
031993     INITIALIZE DCLTSUNAUD.                                       03199342
031994                                                                  03199442
031995     MOVE PC045-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              03199542
031996                                                                  03199642
031997     EXEC SQL                                                     03199742
031998         SELECT  C.TRLR_SRL_NBR                                   03199842
031999               , B.AUD_TYP_CDE                                    03199942
032000               , B.AUD_STAT_CDE                                   03200042
032002               , B.AUD_STP_TMST                                   03200242
032003               , B.OPER_UNT_ID                                    03200368
032004         INTO    :SUOBTR-TRLR-SRL-NBR                             03200468
032005               , :SUNAUD-AUD-TYP-CDE                              03200568
032006               , :SUNAUD-AUD-STAT-CDE                             03200668
032007               , :SUNAUD-AUD-STP-TMST                             03200742
032008               , :SUNAUD-OPER-UNT-ID                              03200868
032009          FROM   SUT_AUD_TRLR_TRIP A                              03200968
032010               , TSUNAUD B                                        03201068
032011               , TSUOBTR C                                        03201168
032012          WHERE  A.AUD_CNTL_NBR         =  B.AUD_CNTL_NBR         03201268
032013            AND  A.ORIG_OTBND_TRIP_ID   =  C.OTBND_TRIP_ID        03201368
032014            AND  A.AUD_CNTL_NBR         = :DK-AUDIT-CNTL-NBR      03201468
032023     END-EXEC.                                                    03202342
032024                                                                  03202442
032025     EVALUATE TRUE                                                03202542
032026         WHEN SQLCODE = ZERO                                      03202642
032027             SET PS-AUDIT-NBR-EXISTS   TO TRUE                    03202742
032028             MOVE SUNAUD-AUD-STAT-CDE  TO PC045-AUDIT-STATUS      03202842
032031             MOVE SUOBTR-TRLR-SRL-NBR  TO PC045-TRLR-SRL-NBR      03203142
032032             MOVE SUNAUD-AUD-TYP-CDE   TO PC045-AUDIT-TYPE        03203242
032033             MOVE SUNAUD-OPER-UNT-ID   TO PC045-OPER-UNT-ID       03203368
032034         WHEN SQLCODE = +100                                      03203442
032036             SET PS-AUDIT-NBR-NOT-EXISTS TO TRUE                  03203642
032037         WHEN SQLWARN0 NOT = SPACES                               03203742
032038         WHEN SQLCODE < ZERO                                      03203842
032039         WHEN SQLCODE > ZERO                                      03203942
032040             MOVE '3000-VALIDATE-AUDIT-NBR.'                      03204042
032041                 TO DP013-PARAGRAPH                               03204142
032042             MOVE 'SELECT OF TSUNAUD TABLE'                       03204242
032043                 TO DP013-MESSAGE-TEXT (1)                        03204342
032044             MOVE PC045-AUDIT-CNTL-NBR-X                          03204442
032045                 TO DP013-MESSAGE-TEXT (2)                        03204542
032046             MOVE SQLCA            TO DP013-SQLCA                 03204642
032047             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    03204742
032048             SET DP013-DB2-ABEND   TO TRUE                        03204842
032049             SET DP013-NO-ROLLBACK TO TRUE                        03204942
032050             PERFORM 9999-WRITE-CICS-LOG-MSG                      03205042
032051             MOVE PC044-DB2-FATAL-ERROR-MSG TO AMSGLNO            03205142
032052             MOVE -1                     TO  ACNTLL               03205242
032053             PERFORM 8100-SEND-DATA-ONLY                          03205342
032054             PERFORM 8200-RETURN-TRANID                           03205442
032055     END-EVALUATE.                                                03205542
032056                                                                  03205642
032057                                                                  03205742
032058******************************************************************03205842
032059 1360-SEL-AUDIT-FROM-TRLR-SRL.                                    03205947
032060******************************************************************03206042
032061                                                                  03206143
032063                                                                  03206343
032064     INITIALIZE DCLTSUNAUD.                                       03206443
032065                                                                  03206543
032066     MOVE PC045-TRLR-SRL-NBR TO DK-TRLR-SRL-NBR.                  03206643
032067                                                                  03206743
032068     EXEC SQL                                                     03206843
032069         SELECT  B.AUD_CNTL_NBR                                   03206943
032070               , B.AUD_TYP_CDE                                    03207045
032071               , B.AUD_STAT_CDE                                   03207143
032073               , B.AUD_STP_TMST                                   03207343
032074               , A.ORIG_OTBND_TRIP_ID                             03207446
032075         INTO    :SUNAUD-AUD-CNTL-NBR                             03207545
032076               , :SUNAUD-AUD-TYP-CDE                              03207643
032077               , :SUNAUD-AUD-STAT-CDE                             03207743
032078               , :SUNAUD-AUD-STP-TMST                             03207843
032079               , :SUOBTR-OTBND-TRIP-ID                            03207945
032080         FROM     SUT_AUD_TRLR_TRIP A                             03208045
032081               ,  TSUNAUD B                                       03208145
032082               ,  TSUOBTR C                                       03208245
032083        WHERE  A.AUD_CNTL_NBR         =  B.AUD_CNTL_NBR           03208345
032084          AND  A.ORIG_OTBND_TRIP_ID   =  C.OTBND_TRIP_ID          03208445
032085          AND  B.AUD_STP_TMST         = :PC-DEFAULT-STP-TMST      03208589
032086          AND  C.TRLR_SRL_NBR         = :DK-TRLR-SRL-NBR          03208689
032099     END-EXEC.                                                    03209943
032100                                                                  03210043
032101     EVALUATE TRUE                                                03210143
032102         WHEN SQLCODE = ZERO                                      03210243
032103             SET PS-AUDIT-NBR-EXISTS   TO TRUE                    03210343
032104             MOVE SUNAUD-AUD-STAT-CDE  TO PC045-AUDIT-STATUS      03210443
032105             MOVE SUNAUD-AUD-CNTL-NBR  TO PC045-AUDIT-CNTL-NBR    03210551
032106             MOVE SUNAUD-AUD-TYP-CDE   TO PC045-AUDIT-TYPE        03210643
032107             MOVE SUOBTR-OTBND-TRIP-ID TO PC045-OTBND-TRIP-ID     03210751
032108         WHEN SQLCODE = -811                                      03210851
032109             SET PS-MULT-TRLR-AUDITS-EXIST TO TRUE                03210951
032110         WHEN SQLCODE = +100                                      03211051
032111             SET PS-AUDIT-NBR-NOT-EXISTS TO TRUE                  03211151
032112         WHEN SQLWARN0 NOT = SPACES                               03211251
032113         WHEN SQLCODE < ZERO                                      03211351
032114         WHEN SQLCODE > ZERO                                      03211451
032115             MOVE '1360-SEL-AUDIT-FROM-TRLR'                      03211560
032116                 TO DP013-PARAGRAPH                               03211651
032117             MOVE 'SELECT OF TSUNAUD TABLE'                       03211751
032118                 TO DP013-MESSAGE-TEXT (1)                        03211851
032119             MOVE PC045-AUDIT-CNTL-NBR-X                          03211951
032120                 TO DP013-MESSAGE-TEXT (2)                        03212051
032121             MOVE SQLCA            TO DP013-SQLCA                 03212151
032122             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    03212251
032123             SET DP013-DB2-ABEND   TO TRUE                        03212351
032124             SET DP013-NO-ROLLBACK TO TRUE                        03212451
032125             PERFORM 9999-WRITE-CICS-LOG-MSG                      03212551
032126             MOVE PC044-DB2-FATAL-ERROR-MSG TO AMSGLNO            03212651
032127             MOVE -1                     TO  ACNTLL               03212751
032128             PERFORM 8100-SEND-DATA-ONLY                          03212851
032129             PERFORM 8200-RETURN-TRANID                           03212951
032130     END-EVALUATE.                                                03213051
032131                                                                  03213151
032132****************************************************************  03213251
032140 2000-VALIDATE-TRLR-SRL-NBR.                                      03214042
032200****************************************************************  03220000
032300                                                                  03230000
032310     INITIALIZE  PC048-COMMAREA-REC.                              03231000
032420     SET   PC048-FROM-TRLR-AUDIT TO  TRUE.                        03242000
032430     MOVE  PC045-TRLR-SRL-NBR    TO  PC048-TRLR-SRL-NBR.          03243000
032440                                                                  03244000
032450     EXEC CICS                                                    03245000
032460          LINK PROGRAM  (PC-TRLR-STATUS-PGM)                      03246000
032470               COMMAREA (PC048-COMMAREA-REC)                      03247000
032480               RESP     (PV-CICS-RESPONSE)                        03248000
032490     END-EXEC                                                     03249000
032491                                                                  03249100
032492     EVALUATE TRUE                                                03249200
032493         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03249300
032494              SET PS-NO-ERROR  TO TRUE                            03249422
032495              PERFORM 2100-VALIDATE-STATUS-CALL                   03249500
032497         WHEN OTHER                                               03249700
032498              MOVE  PC044-CICS-FATAL-ERROR-MSG TO AMSGLNO         03249800
032510     END-EVALUATE.                                                03251000
032600                                                                  03260000
033016                                                                  03301600
033059                                                                  03305900
033060                                                                  03306000
033070*----------------------------------------------------------------*03307000
033080* CHECK RETURN CODE FROM CRTN STATUS PROGRAM TO SEE IF SUCCESSFUL*03308000
033081*----------------------------------------------------------------*03308100
033082 2100-VALIDATE-STATUS-CALL.                                       03308200
033083                                                                  03308322
033084                                                                  03308422
033085     EVALUATE TRUE                                                03308522
033086       WHEN PC048-ERROR                                           03308622
033087         MOVE PC044-CICS-FATAL-ERROR-MSG TO  AMSGLNO              03308700
033088         SET PS-ERROR  TO TRUE                                    03308822
033089       WHEN PC048-INVALID-SQL                                     03308922
033092         MOVE PC044-DB2-FATAL-ERROR-MSG  TO  AMSGLNO              03309200
033093         SET PS-ERROR  TO TRUE                                    03309322
033095       WHEN PC048-DATABASE-BUSY                                   03309522
033096         MOVE PC044-TRANS-NOT-AVAILABLE-MSG  TO  AMSGLNO          03309600
033097         SET PS-ERROR  TO TRUE                                    03309722
033104       WHEN PC048-INVALID-TRLR                                    03310422
033105         MOVE -1 TO    ATRLRL                                     03310522
033106         MOVE PC044-TRLR-NBR-INVALID TO AMSGLNO                   03310624
033107         SET PS-ERROR  TO TRUE                                    03310722
033108       WHEN PC048-NO-ACTIVE-TRIP                                  03310822
033109         MOVE -1 TO    ATRLRL                                     03310922
033110         MOVE PC044-TRIP-NOT-ACTIVE TO AMSGLNO                    03311024
033111         SET PS-ERROR  TO TRUE                                    03311122
033112     END-EVALUATE.                                                03311222
033113                                                                  03311322
033114     IF PS-ERROR                                                  03311422
033115        PERFORM 8000-SEND-MAP                                     03311522
033116        PERFORM 8200-RETURN-TRANID                                03311622
033117     END-IF                                                       03311722
033118                                                                  03311822
033119     IF  PC048-SUCCESSFUL                                         03311900
033120         IF PC048-AUD-STAT-CDE = 'IP' OR 'CM'                     03312034
033124           MOVE  PC048-OTBND-TRIP-STATUS                          03312436
033125                                      TO PC045-OTBND-TRIP-STATUS  03312536
033126           MOVE  PC048-AUD-CNTL-NBR                               03312636
033127                                      TO  PC045-AUDIT-CNTL-NBR    03312736
033128           MOVE  PC048-AUD-STAT-CDE                               03312836
033129                                      TO  PC045-AUDIT-STATUS      03312936
033130           MOVE  PC048-AUD-TYP-CDE                                03313036
033131                                      TO  PC045-AUDIT-TYPE        03313136
033132           MOVE  PC048-AUD-TO-TRLR-SRL-NBR                        03313236
033133                                      TO  PC045-TO-TRLR-SRL-NBR   03313336
033134           MOVE  PC048-DEST-TYP-CDE                               03313436
033135                                      TO  PC045-DEST-TYP-CDE      03313536
033136         END-IF                                                   03313636
033152                                                                  03315234
033153         MOVE  PC048-TRIP-STAT-TMST      TO  PC045-TRIP-STAT-TMST 03315334
033154         MOVE  PC048-ORGN-OPER-UNT-ID    TO  PC045-OPER-UNT-ID    03315434
033155         MOVE  PC048-SCAC-CDE            TO  PC045-SCAC-CDE       03315534
033156         MOVE  PC048-OTBND-TRIP-ID       TO  PC045-OTBND-TRIP-ID  03315634
033157         MOVE  PC048-STATUS-USER-ID      TO  PC045-STATUS-USER-ID 03315734
033158         MOVE  PC048-DOOR-ID             TO  PC045-DOOR-ID        03315834
033159         MOVE  PC048-DOOR-TYP-CDE        TO  PC045-DOOR-TYP-CDE   03315953
033160         MOVE  PC048-DEST-OPER-UNT-ID    TO                       03316053
033161                                   PC045-DEST-OPER-UNT-ID         03316153
033162         MOVE  PC048-OTBND-TRIP-STATUS-DESC TO                    03316253
033163                                     PC045-OTBND-TRIP-STATUS-DESC 03316353
033172                                                                  03317234
033173         MOVE  PC048-TRIP-STAT-SHRT-DESC TO                       03317366
033174                                             PC233-TRAILER-STATUS 03317466
033175                                                                  03317566
033176     END-IF.                                                      03317666
033177                                                                  03317766
033178 2100-XCTL-TO-SELECTED-PROGRAM.                                   03317866
033179     SET PC233-INITIALIZE-SCREEN       TO  TRUE.                  03317966
033180     MOVE PC-CURRENT-PROGRAM-NAME      TO  PC233-LAST-PROGRAM.    03318066
033181     MOVE PC045-COMMAREA-REC           TO  PC233-HOST-SAVE-AREA.  03318166
033182     MOVE LENGTH OF CA-COMMAREA        TO  PV-COMMAREA-LENGTH.    03318266
033183                                                                  03318366
033184     EXEC CICS                                                    03318466
033185         XCTL                                                     03318566
033186             PROGRAM   (PV-TRANSFER-PROGRAM)                      03318666
033187             COMMAREA  (PC233-COMMON-DATA)                        03318784
033188*            COMMAREA  (CA-COMMAREA)                              03318884
033189             LENGTH    (PV-COMMAREA-LENGTH)                       03318984
033190             RESP      (PV-CICS-RESPONSE)                         03319000
033200     END-EXEC.                                                    03320000
033300                                                                  03330000
033400     EVALUATE TRUE                                                03340000
033500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03350000
033600              CONTINUE                                            03360000
033700         WHEN OTHER                                               03370000
033800              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                03380000
033900                                     TO DP013-PARAGRAPH           03390000
034000              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03400000
034100                                     TO DP013-MESSAGE-TEXT (1)    03410000
034200              MOVE PV-TRANSFER-PROGRAM                            03420000
034300                                     TO DP013-MESSAGE-TEXT (2)    03430000
034400              MOVE 'PCKRF891'        TO  PC045-LAST-PROGRAM       03440000
034500              SET DP013-CICS-ABEND   TO TRUE                      03450000
034600              SET DP013-NO-ROLLBACK  TO TRUE                      03460000
034700              PERFORM 9999-WRITE-CICS-LOG-MSG                     03470000
034800              MOVE PC044-TRANS-NOT-AVAILABLE-MSG                  03480000
034900                                     TO AMSGLNO                   03490000
035000              SET PC233-PROCESS-SCREEN TO TRUE                    03500000
035100              PERFORM 8100-SEND-DATA-ONLY                         03510000
035200              PERFORM 8200-RETURN-TRANID                          03520000
035300     END-EVALUATE.                                                03530000
035400                                                                  03540000
035500                                                                  03550000
035510 2200-XCTL-TO-SELECTED-PROGRAM.                                   03551033
035520     SET  PC233-INITIALIZE-SCREEN       TO  TRUE.                 03552000
035521     MOVE PC-CURRENT-PROGRAM-NAME       TO  PC045-LAST-PROGRAM    03552128
035522                                            PC233-LAST-PROGRAM.   03552228
035530     MOVE PC045-COMMAREA-REC            TO  PC233-HOST-SAVE-AREA. 03553000
035531     MOVE LENGTH OF CA-COMMAREA         TO  PV-COMMAREA-LENGTH.   03553100
035550                                                                  03555000
035560     EXEC CICS                                                    03556000
035570         XCTL                                                     03557000
035580             PROGRAM   (PV-TRANSFER-PROGRAM)                      03558000
035590             COMMAREA  (PC233-COMMON-DATA)                        03559084
035591*            COMMAREA  (CA-COMMAREA)                              03559184
035592             LENGTH    (PV-COMMAREA-LENGTH)                       03559200
035593             RESP      (PV-CICS-RESPONSE)                         03559300
035594     END-EXEC.                                                    03559400
035595                                                                  03559500
035596     EVALUATE TRUE                                                03559600
035597         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03559700
035598              CONTINUE                                            03559800
035599         WHEN OTHER                                               03559900
035600              MOVE '2200-XCTL-TO-SELECTED-PROGRAM'                03560081
035601                                     TO DP013-PARAGRAPH           03560100
035602              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03560200
035603                                     TO DP013-MESSAGE-TEXT (1)    03560300
035604              MOVE PV-TRANSFER-PROGRAM                            03560400
035605                                     TO DP013-MESSAGE-TEXT (2)    03560500
035606              MOVE 'PCKRF892'        TO  PC045-LAST-PROGRAM       03560600
035607              SET DP013-CICS-ABEND   TO TRUE                      03560700
035608              SET DP013-NO-ROLLBACK  TO TRUE                      03560800
035609              PERFORM 9999-WRITE-CICS-LOG-MSG                     03560900
035610              MOVE PC044-TRANS-NOT-AVAILABLE-MSG                  03561000
035611                                     TO AMSGLNO                   03561100
035612              SET PC233-PROCESS-SCREEN TO TRUE                    03561200
035613              PERFORM 8100-SEND-DATA-ONLY                         03561300
035614              PERFORM 8200-RETURN-TRANID                          03561400
035615     END-EVALUATE.                                                03561500
035616                                                                  03561600
035617                                                                  03561700
036300****************************************************************  03630000
036400* 3000-VALIDATE-AUDIT-NBR                                      *  03640000
036500*      CHECK THE USER ENTERED AUDIT CONTROL NUMBER - VALIDATE  *  03650000
036600*      EXISTENCE BY GETTING THE AUDIT STATUS                   *  03660000
036700****************************************************************  03670000
036800 3000-VALIDATE-AUDIT-NBR.                                         03680000
036900                                                                  03690000
037000     INITIALIZE DCLTSUNAUD.                                       03700000
037100                                                                  03710000
037200     MOVE PC045-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              03720000
037300                                                                  03730000
037400     EXEC SQL                                                     03740000
037500         SELECT  AUD_TYP_CDE                                      03750015
037600              ,  AUD_STAT_CDE                                     03760015
037700              ,  PRC_FCLTY_AREA_ID                                03770015
037800              ,  AUD_STP_TMST                                     03780015
037900           INTO  :SUNAUD-AUD-TYP-CDE                              03790000
038000             ,   :SUNAUD-AUD-STAT-CDE                             03800000
038100             ,   :SUNAUD-PRC-FCLTY-AREA-ID                        03810000
038110             ,   :SUNAUD-AUD-STP-TMST                             03811011
038120           FROM  TSUNAUD                                          03812015
038130          WHERE  AUD_CNTL_NBR   =  :DK-AUDIT-CNTL-NBR             03813016
038140     END-EXEC.                                                    03814000
038150                                                                  03815000
038160     EVALUATE TRUE                                                03816000
038300         WHEN SQLCODE = ZERO                                      03830000
038310             SET PS-AUDIT-NBR-EXISTS TO TRUE                      03831000
038320             IF SUNAUD-AUD-STP-TMST = PC-DEFAULT-STP-TMST         03832011
038330                SET PC045-AUDIT-INPROCESS TO TRUE                 03833011
038340             END-IF                                               03834011
038800         WHEN SQLCODE = +100                                      03880000
038900             SET PS-AUDIT-NBR-NOT-EXISTS TO TRUE                  03890000
039000         WHEN SQLWARN0 NOT = SPACES                               03900000
039100         WHEN SQLCODE < ZERO                                      03910000
039200         WHEN SQLCODE > ZERO                                      03920000
039300             MOVE '3000-VALIDATE-AUDIT-NBR.'                      03930000
039400                 TO DP013-PARAGRAPH                               03940000
039500             MOVE 'SELECT OF TSUNAUD TABLE'                       03950000
039600                 TO DP013-MESSAGE-TEXT (1)                        03960000
039700             MOVE PC045-AUDIT-CNTL-NBR-X                          03970000
039800                 TO DP013-MESSAGE-TEXT (2)                        03980000
039900             MOVE SQLCA            TO DP013-SQLCA                 03990000
040000             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    04000000
040100             SET DP013-DB2-ABEND   TO TRUE                        04010000
040200             SET DP013-NO-ROLLBACK TO TRUE                        04020000
040300             PERFORM 9999-WRITE-CICS-LOG-MSG                      04030000
040400             MOVE PC044-DB2-FATAL-ERROR-MSG TO AMSGLNO            04040000
040500             MOVE -1                     TO  ACNTLL               04050000
040600             PERFORM 8100-SEND-DATA-ONLY                          04060000
040700             PERFORM 8200-RETURN-TRANID                           04070000
040800     END-EVALUATE.                                                04080000
040810                                                                  04081014
040900******************************************************************04090014
040953 3400-PROCESS-AUDIT-CREATE.                                       04095313
040954      PERFORM 3500-CREATE-AUDIT-NBR                               04095413
040955      PERFORM 3510-INSERT-TSUNAUD                                 04095513
040956      PERFORM 3520-INSERT-AUD-TRLR-TRIP                           04095613
040957      MOVE PC045-TRLR-SRL-NBR-X TO ATRLRO                         04095713
040960      MOVE PC045-SPOT-CHECK TO ASPOTO                             04096007
040970      MOVE PC045-100-CHECK  TO A100O                              04097007
040980      MOVE DP015-ASK-NOR-MDT TO ATRLRA                            04098007
040990                                ACNTLA                            04099007
040991                                A100A                             04099107
040992                                ASPOTA                            04099207
040993      MOVE 'F2-CONT'         TO AKEYSO.                           04099307
040994      SET CA-SPOT-AUDIT-CREATE TO TRUE.                           04099484
041000****************************************************************  04100000
041100* 3500-CREATE-AUDIT-NBR                                        *  04110000
041200*   CREATE A NEW RANDOMLY GENERATED AUDIT NBR                  *  04120000
041300****************************************************************  04130000
041400 3500-CREATE-AUDIT-NBR.                                           04140000
041500                                                                  04150000
041600     SET PS-AUDIT-NBR-EXISTS  TO TRUE.                            04160000
041700                                                                  04170000
041800*    CONTINUE TO CREATE NEW NUMBERS UNTIL ONE IS FOUND THAT DOES  04180000
041900*    NOT EXIST                                                    04190000
042000     PERFORM UNTIL PS-AUDIT-NBR-NOT-EXISTS                        04200000
042100         PERFORM 4000-CREATE-RANDOM-NBR                           04210000
042200                                                                  04220000
042300         MOVE DP902-RANDOM-NUMBER TO PC045-AUDIT-CNTL-NBR         04230000
042500         PERFORM 3000-VALIDATE-AUDIT-NBR                          04250000
042600     END-PERFORM.                                                 04260000
042700                                                                  04270000
042800     MOVE PC045-AUDIT-CNTL-NBR-X TO ACNTLI.                       04280000
042900     MOVE -1                  TO A100L.                           04290000
043000                                                                  04300000
043100****************************************************************  04310000
043200* 3510-INSERT-TSUNAUD.                                         *  04320000
043300*   INSERT A NEW SHIPPING UNID AUDIT RECORD                    *  04330000
043400****************************************************************  04340000
043500 3510-INSERT-TSUNAUD.                                             04350000
043600                                                                  04360000
043700     INITIALIZE DCLTSUNAUD.                                       04370000
043800                                                                  04380000
043900     MOVE PC045-AUDIT-CNTL-NBR    TO SUNAUD-AUD-CNTL-NBR.         04390000
044000     MOVE +0                      TO SUNAUD-AUD-PSPND-MNIT-QTY    04400000
044100                                     SUNAUD-AUD-CLO-MNIT-QTY.     04410000
044200     MOVE PC045-USERID            TO SUNAUD-AUD-USR-ID.           04420000
044300     MOVE PC045-OPER-UNT-ID       TO SUNAUD-OPER-UNT-ID.          04430000
044400     MOVE 1                       TO SUNAUD-FCLTY-ID.             04440000
044500     MOVE 'SHIP  '                TO SUNAUD-PRC-FCLTY-AREA-ID     04450000
044800     MOVE 'IP'                    TO SUNAUD-AUD-STAT-CDE.         04480000
044900     MOVE PC045-AUDIT-TYPE        TO SUNAUD-AUD-TYP-CDE.          04490000
044910     MOVE PC-T                    TO SUNAUD-AUD-CAT-CDE           04491018
044911     IF PC045-SPOT-AUDIT-CHECK                                    04491130
044920        MOVE PC-S                 TO SUNAUD-DEST-TYP-CDE          04492030
044930                                     PC045-DEST-TYP-CDE           04493063
045000     ELSE                                                         04500030
045010        MOVE PC-N                 TO SUNAUD-DEST-TYP-CDE          04501030
045020     END-IF                                                       04502030
045030                                                                  04503030
045100     EXEC SQL                                                     04510000
045200         INSERT INTO TSUNAUD                                      04520000
045300             ( AUD_CNTL_NBR                                       04530000
045400              ,AUD_STRT_TMST                                      04540000
045500              ,AUD_STP_TMST                                       04550000
045600              ,AUD_PSPND_MNIT_QTY                                 04560000
045700              ,AUD_CLO_MNIT_QTY                                   04570000
045800              ,AUD_USR_ID                                         04580000
045900              ,OPER_UNT_ID                                        04590000
046000              ,FCLTY_ID                                           04600000
046100              ,PRC_FCLTY_AREA_ID                                  04610000
046200              ,AUD_STAT_CDE                                       04620000
046300              ,AUD_TYP_CDE                                        04630000
046310              ,AUD_CAT_CDE                                        04631018
046320              ,DEST_TYP_CDE                                       04632018
046400             )                                                    04640000
046500         VALUES                                                   04650000
046600             (                                                    04660000
046700               :SUNAUD-AUD-CNTL-NBR                               04670000
046800             , CURRENT TIMESTAMP                                  04680000
046900             , '9999-09-09-09.09.09.999999'                       04690000
047000             , :SUNAUD-AUD-PSPND-MNIT-QTY                         04700000
047100             , :SUNAUD-AUD-CLO-MNIT-QTY                           04710000
047200             , :SUNAUD-AUD-USR-ID                                 04720000
047300             , :SUNAUD-OPER-UNT-ID                                04730000
047400             , :SUNAUD-FCLTY-ID                                   04740000
047500             , :SUNAUD-PRC-FCLTY-AREA-ID                          04750000
047600             , :SUNAUD-AUD-STAT-CDE                               04760000
047700             , :SUNAUD-AUD-TYP-CDE                                04770000
047710             , :SUNAUD-AUD-CAT-CDE                                04771018
047720             , :SUNAUD-DEST-TYP-CDE                               04772018
047800             )                                                    04780000
047900     END-EXEC.                                                    04790000
048000                                                                  04800000
048100     EVALUATE TRUE                                                04810000
048200         WHEN SQLCODE = ZERO                                      04820000
048210              CONTINUE                                            04821000
048600         WHEN SQLCODE = -803                                      04860000
048700             MOVE PC044-CREATE-CNTL-NBR-MSG                       04870000
048800                                        TO  AMSGLNO               04880000
048900         WHEN SQLWARN0 NOT = SPACES                               04890000
049000         WHEN SQLCODE < ZERO                                      04900000
049100         WHEN SQLCODE > ZERO                                      04910000
049200             MOVE '3510-INSERT-TSUNAUD.' TO DP013-PARAGRAPH       04920000
049300             MOVE 'INSERT TSUNADU'       TO DP013-MESSAGE-TEXT (1)04930000
049400             MOVE PC045-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)04940000
049500             MOVE SQLCA                  TO DP013-SQLCA           04950000
049600             MOVE 'TSUNAUD'            TO DP013-DB2-TABLE-NAME (1)04960000
049700             SET DP013-DB2-ABEND         TO TRUE                  04970000
049800             SET DP013-NO-ROLLBACK       TO TRUE                  04980000
049900             PERFORM 9999-WRITE-CICS-LOG-MSG                      04990000
050000             MOVE PC044-DB2-FATAL-ERROR-MSG TO AMSGLNO            05000000
050100             MOVE -1                     TO  ACNTLL               05010000
050200             PERFORM 8100-SEND-DATA-ONLY                          05020000
050300             PERFORM 8200-RETURN-TRANID                           05030000
050400     END-EVALUATE.                                                05040000
050500                                                                  05050000
050600                                                                  05060000
050601****************************************************************  05060100
050602* 3520-INSERT-AUD-TRLR-TRIP.                                   *  05060200
050603*   INSERT A NEW SHIPPING UNID AUDIT RECORD                    *  05060300
050604****************************************************************  05060400
050605 3520-INSERT-AUD-TRLR-TRIP.                                       05060500
050608                                                                  05060800
050609     MOVE PC045-AUDIT-CNTL-NBR    TO SUT00004-AUD-CNTL-NBR.       05060900
050610     MOVE PC045-OTBND-TRIP-ID     TO SUT00004-ORIG-OTBND-TRIP-ID. 05061000
050619                                                                  05061900
050620     EXEC SQL                                                     05062000
050621         INSERT INTO SUT_AUD_TRLR_TRIP                            05062100
050622             ( AUD_CNTL_NBR                                       05062200
050623              ,ORIG_OTBND_TRIP_ID                                 05062300
050633             )                                                    05063300
050634         VALUES                                                   05063400
050635             (                                                    05063500
050636               :SUT00004-AUD-CNTL-NBR                             05063600
050637             , :SUT00004-ORIG-OTBND-TRIP-ID                       05063700
050647             )                                                    05064700
050648     END-EXEC.                                                    05064800
050649                                                                  05064900
050650     EVALUATE TRUE                                                05065000
050651         WHEN SQLCODE = ZERO                                      05065100
050652              SET PC045-AUDIT-INPROCESS  TO TRUE                  05065203
050656         WHEN SQLCODE = -803                                      05065600
050657             MOVE PC044-CREATE-CNTL-NBR-MSG                       05065700
050658                                        TO  AMSGLNO               05065800
050659         WHEN SQLWARN0 NOT = SPACES                               05065900
050660         WHEN SQLCODE < ZERO                                      05066000
050661         WHEN SQLCODE > ZERO                                      05066100
050662             MOVE '3520-INSERT-AUD-TRLR' TO DP013-PARAGRAPH       05066200
050663             MOVE 'INSERT SUT_AUD_TRLR'  TO DP013-MESSAGE-TEXT (1)05066300
050664             MOVE PC045-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)05066400
050665             MOVE SQLCA                  TO DP013-SQLCA           05066500
050666             MOVE 'SUT_AUD_TRLR_TRIP'  TO DP013-DB2-TABLE-NAME (1)05066600
050667             SET DP013-DB2-ABEND         TO TRUE                  05066700
050668             SET DP013-NO-ROLLBACK       TO TRUE                  05066800
050669             PERFORM 9999-WRITE-CICS-LOG-MSG                      05066900
050670             MOVE PC044-DB2-FATAL-ERROR-MSG TO AMSGLNO            05067000
050671             MOVE -1                     TO  ACNTLL               05067100
050672             PERFORM 8100-SEND-DATA-ONLY                          05067200
050673             PERFORM 8200-RETURN-TRANID                           05067300
050674     END-EVALUATE.                                                05067400
050675                                                                  05067500
050676                                                                  05067600
050677 3600-CHECK-TRLR-STAT-CONT.                                       05067700
050678                                                                  05067800
050679     EVALUATE TRUE                                                05067900
050680         WHEN PC048-DC-SHIPPED                                    05068000
050681         WHEN PC048-OPEN-AT-STORE                                 05068100
050682         WHEN PC048-UNLOADED-AT-STORE                             05068200
050683             MOVE '22' TO PC233-PGM-MSG-NBR                       05068300
050684             MOVE PC-ERROR-MESSAGE-SCREEN                         05068400
050685                          TO PV-TRANSFER-PROGRAM                  05068500
050686             MOVE PC048-TRLR-SRL-NBR                              05068600
050687                              TO PC045-TRLR-SRL-NBR               05068700
050688             MOVE PC048-OTBND-TRIP-STATUS-DESC                    05068800
050689                              TO PC045-OTBND-TRIP-STATUS-DESC     05068900
050690             PERFORM 2200-XCTL-TO-SELECTED-PROGRAM                05069000
050691         WHEN OTHER                                               05069100
050692             IF PC048-CLOSED-AT-DC                                05069200
050693                MOVE PC-CURRENT-PROGRAM-NAME TO PC233-ROOT-PROGRAM05069300
050694                MOVE '23' TO PC233-PGM-MSG-NBR                    05069400
050695                MOVE PC-ERROR-MESSAGE-SCREEN                      05069500
050696                             TO PV-TRANSFER-PROGRAM               05069600
050697                MOVE PC048-TRLR-SRL-NBR  TO PC233-SERIAL-NBR      05069700
050698                MOVE PC048-DOOR-ID       TO PC233-DOOR-ID         05069800
050699                MOVE PC048-DEST-OPER-UNT-ID                       05069900
050700                                         TO PC233-STR-NBR         05070000
050701                MOVE PC048-ORGN-OPER-UNT-ID                       05070100
050702                                         TO PC233-OPER-UNT-ID     05070200
050703                MOVE PC048-SCAC-CDE      TO PC233-OWNER-SCAC-ID   05070300
050704                MOVE PC048-OTBND-TRIP-ID TO PC233-TRIP-ID         05070400
050705                PERFORM 2200-XCTL-TO-SELECTED-PROGRAM             05070500
050706             ELSE                                                 05070600
050708                IF PC045-SPOT-AUDIT-CHECK                         05070857
050716                   MOVE PC-AUDIT-STATUS-SCREEN                    05071658
050717                                 TO PV-TRANSFER-PROGRAM           05071758
050718                   MOVE PC048-TRLR-SRL-NBR                        05071858
050719                                 TO PC045-TRLR-SRL-NBR            05071958
050720                   PERFORM 2200-XCTL-TO-SELECTED-PROGRAM          05072058
050722                ELSE                                              05072257
050723                 IF PC048-OPEN-FOR-AUDIT    OR                    05072359
050724                     PC048-CLOSE-AUDIT-KEEP OR                    05072459
050725                     PC048-CLOSE-AUDIT-REL                        05072559
050726**IF THE ASSOCIATE DOES NOT COMPLETE THE INITIAL CREATE OF        05072661
050727**THE AUDIT(IE: THEY F3 ON PCKRF895 AUDIT-TO SCREEN) THE DEST TYPE05072759
050728**CODE WILL STILL BE THE DEFAULT OF 'N' AND PCKRF895 WILL BE      05072859
050729**DISPLAYED WHEN THE RETURN TO THE AUDIT OTHERWISE, A RETURN TO   05072959
050730**AN EXISTING AUDIT WIL GO TO THE STARTED TRLR AUD PROG(PCKRF893) 05073059
050731                   IF PC045-DEST-TYP-CDE  = 'N'                   05073159
050732                      MOVE PC-OPEN-CARTON-SCREEN                  05073259
050733                                    TO PV-TRANSFER-PROGRAM        05073359
050734                      MOVE PC048-DEST-OPER-UNT-ID                 05073464
050735                                            TO PC233-STR-NBR      05073564
050736                      MOVE PC048-TRLR-SRL-NBR                     05073659
050737                                    TO PC045-TRLR-SRL-NBR         05073759
050738                      PERFORM 2200-XCTL-TO-SELECTED-PROGRAM       05073859
050739                   ELSE                                           05073959
050740                     MOVE PC-AUDIT-STATUS-SCREEN                  05074059
050741                                  TO PV-TRANSFER-PROGRAM          05074159
050742                     PERFORM 2200-XCTL-TO-SELECTED-PROGRAM        05074259
050743                   END-IF                                         05074359
050744                 ELSE                                             05074459
050745                    MOVE PC-CURRENT-PROGRAM-NAME                  05074559
050746                                      TO PC233-ROOT-PROGRAM       05074659
050747                    MOVE '25' TO PC233-PGM-MSG-NBR                05074759
050748                    MOVE PC-ERROR-MESSAGE-SCREEN                  05074859
050749                                 TO PV-TRANSFER-PROGRAM           05074959
050750                    MOVE PC048-TRLR-SRL-NBR TO PC233-SERIAL-NBR   05075059
050751                    MOVE PC048-DOOR-ID      TO PC233-DOOR-ID      05075159
050752                    MOVE PC048-DEST-OPER-UNT-ID                   05075259
050753                                            TO PC233-STR-NBR      05075359
050754                    MOVE PC048-SCAC-CDE     TO PC233-OWNER-SCAC-ID05075459
050755                    MOVE PC048-OTBND-TRIP-ID TO PC233-TRIP-ID     05075559
050756                    PERFORM 2200-XCTL-TO-SELECTED-PROGRAM         05075659
050757                 END-IF                                           05075759
050758                END-IF                                            05075859
050759             END-IF                                               05075959
050760         END-EVALUATE.                                            05076059
050761                                                                  05076159
050762                                                                  05076259
050763 3610-CHECK-TRLR-STAT-CRE.                                        05076359
050764                                                                  05076459
050765     EVALUATE TRUE                                                05076559
050766         WHEN PC048-INVALID-TRLR                                  05076659
050767             MOVE -1 TO    ATRLRL                                 05076759
050768             MOVE PC044-CREATE-CNTL-NBR-MSG TO AMSGLNO            05076859
050769         WHEN PC048-NO-ACTIVE-TRIP                                05076959
050770             MOVE -1 TO    ATRLRL                                 05077059
050771             MOVE PC044-TRIP-NOT-ACTIVE TO AMSGLNO                05077159
050772         WHEN PC048-DC-SHIPPED                                    05077259
050773         WHEN PC048-OPEN-AT-STORE                                 05077359
050774         WHEN PC048-UNLOADED-AT-STORE                             05077459
050775             MOVE '22' TO PC233-PGM-MSG-NBR                       05077559
050776             MOVE PC-ERROR-MESSAGE-SCREEN                         05077659
050777                          TO PV-TRANSFER-PROGRAM                  05077759
050778             MOVE PC048-TRLR-SRL-NBR                              05077859
050779                              TO PC045-TRLR-SRL-NBR               05077959
050780             MOVE PC048-OTBND-TRIP-STATUS-DESC                    05078059
050781                              TO PC045-OTBND-TRIP-STATUS-DESC     05078159
050782             PERFORM 2200-XCTL-TO-SELECTED-PROGRAM                05078259
050783         WHEN OTHER                                               05078359
050784           IF PC048-CLOSED-AT-DC                                  05078459
050785              IF PC045-100-AUDIT-CHECK                            05078559
050786                 MOVE PC-CURRENT-PROGRAM-NAME                     05078659
050787                                       TO PC233-ROOT-PROGRAM      05078759
050788                 MOVE '23' TO PC233-PGM-MSG-NBR                   05078859
050789                 MOVE PC-ERROR-MESSAGE-SCREEN                     05078959
050790                              TO PV-TRANSFER-PROGRAM              05079059
050791                 MOVE PC048-TRLR-SRL-NBR  TO PC233-SERIAL-NBR     05079159
050792                 MOVE PC048-DOOR-ID       TO PC233-DOOR-ID        05079259
050793                 MOVE PC048-DEST-OPER-UNT-ID                      05079359
050794                                          TO PC233-STR-NBR        05079459
050795                 MOVE PC048-SCAC-CDE      TO PC233-OWNER-SCAC-ID  05079559
050796                 MOVE PC048-OTBND-TRIP-ID TO PC233-TRIP-ID        05079659
050797                 PERFORM 2200-XCTL-TO-SELECTED-PROGRAM            05079759
050798              ELSE                                                05079859
050799                 MOVE PC-CURRENT-PROGRAM-NAME TO                  05079959
050800                                         PC233-ROOT-PROGRAM       05080059
050801                 MOVE '22' TO PC233-PGM-MSG-NBR                   05080159
050802                 MOVE PC-ERROR-MESSAGE-SCREEN                     05080259
050803                              TO PV-TRANSFER-PROGRAM              05080359
050804                 MOVE PC048-TRLR-SRL-NBR  TO PC233-SERIAL-NBR     05080459
050805                 MOVE PC048-DOOR-ID       TO PC233-DOOR-ID        05080559
050806                 MOVE PC048-DEST-OPER-UNT-ID                      05080659
050807                                          TO PC233-STR-NBR        05080759
050808                 MOVE PC048-SCAC-CDE      TO PC233-OWNER-SCAC-ID  05080859
050809                 MOVE PC048-OTBND-TRIP-ID TO PC233-TRIP-ID        05080959
050810                 PERFORM 2200-XCTL-TO-SELECTED-PROGRAM            05081059
050811              END-IF                                              05081159
050812*                                                                 05081259
050813           ELSE                                                   05081359
050814              IF PC045-100-AUDIT-CHECK                            05081459
050815                  MOVE PC-CURRENT-PROGRAM-NAME                    05081559
050816                                    TO PC233-ROOT-PROGRAM         05081659
050817                  MOVE '24' TO PC233-PGM-MSG-NBR                  05081759
050818                  MOVE PC-ERROR-MESSAGE-SCREEN                    05081859
050819                               TO PV-TRANSFER-PROGRAM             05081959
050820                  MOVE PC048-TRLR-SRL-NBR TO PC233-SERIAL-NBR     05082059
050821                  MOVE PC048-DOOR-ID      TO PC233-DOOR-ID        05082159
050822                  MOVE PC048-DEST-OPER-UNT-ID                     05082259
050823                                          TO PC233-STR-NBR        05082359
050824                  MOVE PC048-SCAC-CDE     TO PC233-OWNER-SCAC-ID  05082459
050825                  MOVE PC048-OTBND-TRIP-ID TO PC233-TRIP-ID       05082559
050826                  MOVE PC048-ORGN-OPER-UNT-ID                     05082659
050827                                           TO PC233-OPER-UNT-ID   05082759
050828                  PERFORM 2200-XCTL-TO-SELECTED-PROGRAM           05082859
050829              ELSE                                                05082959
050830                  PERFORM 3400-PROCESS-AUDIT-CREATE               05083059
050831              END-IF                                              05083159
050832           END-IF                                                 05083259
050833         END-EVALUATE.                                            05083359
050834                                                                  05083459
050835                                                                  05083559
050836******************************************************************05083659
050840*  4000-CREATE-RANDOM-NBR                                        *05084057
050900*  THIS PARAGRAPH WILL RANDOMLY CREATE A NEW AUDIT CNTL NUMBER   *05090000
051000******************************************************************05100000
051100 4000-CREATE-RANDOM-NBR.                                          05110000
051200                                                                  05120000
051300     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     05130000
051400     CALL PC-RANDOM-NBR-GENERATOR USING                           05140000
051500                            DFHEIBLK                              05150000
051600                            DFHCOMMAREA                           05160000
051700                            DP902-RANDNBR-ROUTINE-FIELDS.         05170000
051800                                                                  05180000
051900     IF DP902-SUCCESSFUL                                          05190000
052000         CONTINUE                                                 05200000
052100     ELSE                                                         05210000
052200         MOVE PC044-DB2-FATAL-ERROR-MSG TO AMSGLNO                05220000
052300         PERFORM 8100-SEND-DATA-ONLY                              05230000
052400         PERFORM 8200-RETURN-TRANID                               05240000
052500     END-IF.                                                      05250000
052600                                                                  05260000
052700******************************************************************05270000
052800*  8000-SEND-MAP                                                 *05280000
052900*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *05290000
053000******************************************************************05300000
053100 8000-SEND-MAP.                                                   05310000
053200     EXEC CICS                                                    05320000
053300         SEND                                                     05330000
053400             MAP     ('PC892A')                                   05340000
053500             MAPSET  ('PCKM892')                                  05350000
053600             ERASE                                                05360000
053700             RESP    (PV-CICS-RESPONSE)                           05370000
053800     END-EXEC.                                                    05380000
053900                                                                  05390000
054000     EVALUATE TRUE                                                05400000
054100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05410000
054200             CONTINUE                                             05420000
054300         WHEN OTHER                                               05430000
054400             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            05440000
054500             MOVE 'UNABLE TO SEND MAP'                            05450000
054600                                    TO DP013-MESSAGE-TEXT (1)     05460000
054700             SET DP013-CICS-ABEND   TO TRUE                       05470000
054800             SET DP013-NO-ROLLBACK  TO TRUE                       05480000
054900             PERFORM 9999-WRITE-CICS-LOG-MSG                      05490000
055000     END-EVALUATE.                                                05500000
055100*                                                                 05510000
055200 8100-SEND-DATA-ONLY.                                             05520000
055300                                                                  05530000
055400     EXEC CICS                                                    05540000
055500         SEND                                                     05550000
055600             MAP       ('PC892A')                                 05560000
055700             MAPSET    ('PCKM892')                                05570000
055800             CURSOR                                               05580000
055900             DATAONLY                                             05590000
056000             RESP      (PV-CICS-RESPONSE)                         05600000
056100     END-EXEC.                                                    05610000
056200                                                                  05620000
056300     EVALUATE TRUE                                                05630000
056400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05640000
056500             CONTINUE                                             05650000
056600         WHEN OTHER                                               05660000
056700             MOVE '8100-SEND-DATA-ONLY'                           05670000
056800                                    TO DP013-PARAGRAPH            05680000
056900             MOVE 'UNABLE TO SEND DATA'                           05690000
057000                                    TO DP013-MESSAGE-TEXT (1)     05700000
057100             SET DP013-CICS-ABEND   TO TRUE                       05710000
057200             SET DP013-NO-ROLLBACK  TO TRUE                       05720000
057300             PERFORM 9999-WRITE-CICS-LOG-MSG                      05730000
057400     END-EVALUATE.                                                05740000
057500*                                                                 05750000
057600 8200-RETURN-TRANID.                                              05760000
057610     MOVE PC045-COMMAREA-REC        TO  PC233-HOST-SAVE-AREA.     05761000
057700     MOVE LENGTH OF CA-COMMAREA     TO PV-COMMAREA-LENGTH.        05770000
057800                                                                  05780000
057900     EXEC CICS                                                    05790000
058000         RETURN                                                   05800000
058100             TRANSID   (PC-CURRENT-TRANID)                        05810000
058200             COMMAREA  (CA-COMMAREA)                              05820000
058300             LENGTH    (PV-COMMAREA-LENGTH)                       05830000
058400             RESP      (PV-CICS-RESPONSE)                         05840000
058500     END-EXEC.                                                    05850000
058600                                                                  05860000
058700     EVALUATE TRUE                                                05870000
058800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05880000
058900             CONTINUE                                             05890000
059000         WHEN OTHER                                               05900000
059100             MOVE '8200-RETURN-TRANID'                            05910000
059200                                    TO DP013-PARAGRAPH            05920000
059300             MOVE 'UNABLE TO RETURN TO TRANID'                    05930000
059400                                    TO DP013-MESSAGE-TEXT (1)     05940000
059500             SET DP013-CICS-ABEND   TO TRUE                       05950000
059600             SET DP013-NO-ROLLBACK  TO TRUE                       05960000
059700             PERFORM 9999-WRITE-CICS-LOG-MSG                      05970000
059800     END-EVALUATE.                                                05980000
059900*                                                                 05990000
060000*                                                                 06000000
060100 9999-WRITE-CICS-LOG-MSG.                                         06010000
060200     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            06020000
060300     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           06030000
060400     INITIALIZE DP013-SRC-TASK-NUMBER                             06040000
060500                DP013-STACK.                                      06050000
060600     SET DP013-LINK-RETURN           TO TRUE.                     06060000
060700                                                                  06070000
060800     EXEC CICS                                                    06080000
060900         LINK                                                     06090000
061000             PROGRAM   (DP013-NAME)                               06100000
061100             COMMAREA  (DP013-PARAMETERS)                         06110000
061200             LENGTH    (DP013-LENGTH)                             06120000
061300     END-EXEC.                                                    06130000
