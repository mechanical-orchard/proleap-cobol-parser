000100 ID DIVISION.                                                     00010000
000200 PROGRAM-ID.      INKUT402.                                       00020000
000300 AUTHOR.          B. GRAHAM - STRATAGEM.                          00030000
000400 DATE-WRITTEN     AUGUST 23, 2006.                                00040000
000500 DATE-COMPILED.                                                   00050000
000600******************************************************************00060000
000700*    INKUT402                                                    *00070000
000800*  - READ SHORTAGE EXTRACT RECORDS                               *00080000
000900*  - DETERMINE WHICH SHOULD HAVE BEEN INVENTORIED USING          *00090000
001000*  - STORE/DEPARTMENT FILTER INFORMATION FROM INT_INV_PARMS_MDSE *00100000
001100*    TABLE. STORE WIDE INVENTORY, ALL DEPARTMENTS ARE INCLUDED.  *00110000
001200*    FOR DEPARTMENT INVENTORY, DEFAULT DEPARTMENTS               *00120000
001300*    FOR ALL STORES IN THE CYCLE OR SPECIFIC DEPARTMENTS FOR     *00130000
001400*    SPECIFIC STORES IN THE INVENTORY CYCLE.                     *00140000
001500*    WRITE OUT THOSE THAT APPLY TO THE TYPE OF INVENTORY AND     *00150000
001600*    ASSOCIATED DEPARTMENT. FOR THOSE THAT SHOULD NOT HAVE       *00160000
001700*    BEEN COUNTED, WRITE TO A SEPARATE FILE.                     *00170000
001800*    THIS PROGRAM IS BEING USED TO FILTER BOTH BOOK VALUE        *00180000
001900*    AND PHYSICAL COUNT SHORTAGE EXTRACT RECORDS                 *00190000
002000******************************************************************00200000
002100*  CHANGE LOG                                                     00210000
002200*  DATE     CHANGED BY      DESC                                  00220000
002300*  ---------- ------------- --------------------------------------00230000
002400*  08-10-2006 B. GRAHAM     ORIGINAL CODE                         00240000
002500* W28545                    ADD LOGIC  FOR DEPARTMENT LEVEL       00250000
002600*                           INVENTORY PROCESS.                    00260000
002700*                           B. GRAHAM - STRATAGEM                 00270000
W33304*  09-17-2008  VIGNESH/     HOLDING INVENTORY LEDGER OPEN (HILO). 00272001
W33304*  W33304      INFOSYS                                            00273001
002800*                                                                 00280000
002900******************************************************************00290000
003000                                                                  00300000
003100 ENVIRONMENT DIVISION.                                            00310000
003200 CONFIGURATION SECTION.                                           00320000
003300 SOURCE-COMPUTER.        IBM-3090.                                00330000
003400 OBJECT-COMPUTER.        IBM-3090.                                00340000
003500 INPUT-OUTPUT SECTION.                                            00350000
003600 FILE-CONTROL.                                                    00360000
003700                                                                  00370000
003800     SELECT  IN-SHORTAGE-EXT-FILE ASSIGN TO INP01.                00380000
003900                                                                  00390000
004000     SELECT  OUT-SHORTAGE-EXT-FILE ASSIGN TO OUT01.               00400000
004100                                                                  00410000
004200     SELECT  OUT-SHORTAGE-FILTER-FILE ASSIGN TO OUT02.            00420000
004300                                                                  00430000
004400 DATA DIVISION.                                                   00440000
004500                                                                  00450000
004600 FILE SECTION.                                                    00460000
004700                                                                  00470000
004800 FD  IN-SHORTAGE-EXT-FILE                                         00480000
004900     RECORDING MODE F                                             00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS  0 RECORDS                                    00510000
W33304     RECORD CONTAINS 170 CHARACTERS                               00520001
005300     DATA RECORD IS IN-SHORTAGE-EXT-RECORD.                       00530000
005400                                                                  00540000
W33304 01  IN-SHORTAGE-EXT-RECORD    PIC X(170).                        00550001
005600                                                                  00560000
005700 FD  OUT-SHORTAGE-EXT-FILE                                        00570000
005800     RECORDING MODE F                                             00580000
005900     LABEL RECORDS ARE STANDARD                                   00590000
006000     BLOCK CONTAINS  0 RECORDS                                    00600000
W33304     RECORD CONTAINS 170 CHARACTERS                               00610001
006200     DATA RECORD IS OUT-SHORTAGE-EXT-RECORD.                      00620000
006300                                                                  00630000
W33304 01  OUT-SHORTAGE-EXT-RECORD   PIC X(170).                        00640001
006500                                                                  00650000
006600 FD  OUT-SHORTAGE-FILTER-FILE                                     00660000
006700     RECORDING MODE F                                             00670000
006800     LABEL RECORDS ARE STANDARD                                   00680000
006900     BLOCK CONTAINS  0 RECORDS                                    00690000
W33304     RECORD CONTAINS 170 CHARACTERS                               00700001
W33304     DATA RECORD IS OUT-SHORTAGE-FILTER-RECORD.                   00710001
007200                                                                  00720000
W33304 01  OUT-SHORTAGE-FILTER-RECORD PIC X(170).                       00730001
007400                                                                  00740000
007500 WORKING-STORAGE SECTION.                                         00750000
007600                                                                  00760000
007700 01  PA-PROGRAM-ACCUMULATORS.                                     00770000
007800     05  PA-INPUT-RECORD-COUNT     PIC S9(9) COMP-3 VALUE +0.     00780000
007900     05  PA-OUTPUT-VALID-COUNT     PIC S9(9) COMP-3 VALUE +0.     00790000
008000     05  PA-OUTPUT-FILTER-COUNT    PIC S9(9) COMP-3 VALUE +0.     00800000
008100     05  PA-WORK-RECORD-COUNT                                     00810000
008200                                   PIC S9(9) COMP-3 VALUE +0.     00820000
008300                                                                  00830000
008400 01  PC-PROGRAM-CONSTANTS.                                        00840000
008500     05  PC-MAX-RETRIES        PIC S9(04)    COMP SYNC VALUE +2.  00850000
008600     05  PC-PROGRAM-ID         PIC X(08)     VALUE 'INKUT402'.    00860000
008700     05  PC-NINETY-NINE          PIC 9(03)      VALUE 099.        00870000
008800     05  PC-9990                 PIC S9(04)     VALUE 9990 COMP-3.00880000
008900     05  PC-FOUR-THOUSAND        PIC 9(04)      VALUE 4000.       00890000
009000                                                                  00900000
009100 01  PV-PROGRAM-VARIABLES.                                        00910000
009200     05  PV-HOLD-STORE-NBR       PIC 9(04)  VALUE ZERO.           00920000
009300     05  PV-HOLD-DEPT-NBR        PIC 9(04)  VALUE ZERO.           00930000
009400     05  PV-PREV-STORE-NBR       PIC 9(04)  VALUE ZERO.           00940000
009500     05  PV-STORE-0000-COUNT     PIC S9(09) VALUE +0  COMP SYNC.  00950000
009600     05  PV-STORE-XXXX-COUNT     PIC S9(09) VALUE +0  COMP SYNC.  00960000
009700     05  PV-STORE-SUB            PIC S9(05) VALUE ZERO COMP-3.    00970000
009800     05  PV-II-TBL-SUB           PIC S9(03) VALUE ZERO COMP-3.    00980000
009900     05  PV-IIPM-TBL-SUB         PIC S9(05) VALUE ZERO COMP-3.    00990000
010000     05  PV-RETRY-COUNT        PIC S9(04)   COMP SYNC   VALUE +0. 01000000
010100     05  PV-DB2-OPER-ATTEMPTED PIC  X(30)          VALUE SPACES.  01010000
010200     05  PV-MAX-RETRIES        PIC S9(05)   COMP-3 VALUE +3.      01020000
010300     05  PV-PARAGRAPH-NAME     PIC  X(30)          VALUE SPACES.  01030000
010400                                                                  01040000
010500 01  PS-PROGRAM-SWITCHES.                                         01050000
010600     05  PS-INPUT-AT-END-SW         PIC X(01)    VALUE 'N'.       01060000
010700         88  PS-INPUT-AT-END-NO                  VALUE 'N'.       01070000
010800         88  PS-INPUT-AT-END-YES                 VALUE 'Y'.       01080000
010900     05  PS-INV-ID-FOUND-SW         PIC X(01)    VALUE 'N'.       01090000
011000         88  PS-INV-ID-FOUND-NO                  VALUE 'N'.       01100000
011100         88  PS-INV-ID-FOUND-YES                 VALUE 'Y'.       01110000
011200     05  PS-IIPM-LOADED-SW          PIC X(01)    VALUE 'N'.       01120000
011300         88  PS-IIPM-LOADED-NO                   VALUE 'N'.       01130000
011400         88  PS-IIPM-LOADED-YES                  VALUE 'Y'.       01140000
011500     05  PS-QUALIFIES-FOR-INVENTORY-SW                            01150000
011600                                    PIC X(01)    VALUE 'N'.       01160000
011700         88  PS-QUALIFIES-FOR-INVENTORY-NO       VALUE 'N'.       01170000
011800         88  PS-QUALIFIES-FOR-INVENTORY-YES      VALUE 'Y'.       01180000
011900                                                                  01190000
012000     05  PS-TINVPAR-DONE-SW         PIC X(01)    VALUE 'N'.       01200000
012100         88  PS-TINVPAR-DONE-NO                  VALUE 'N'.       01210000
012200         88  PS-TINVPAR-DONE-YES                 VALUE 'Y'.       01220000
012300                                                                  01230000
012400                                                                  01240000
012500* PT TINVPAR TABLE IS SUBSCRIPTED BY STORE NUMBER AND             01250000
012600* HOLDS A POINTER (SUBSCRIPT) INTO THE PT-INV-ID-TABLE            01260000
012700* THIS ASSOCIATES THE STORE TO THE INVENTORY CYCLE AND            01270000
012800* ITS TYPE.                                                       01280000
012900                                                                  01290000
013000 01  PT-TINVPAR-TABLE.                                            01300000
013100     05  PT-TINVPAR-TABLE-ELEMENTS   OCCURS 9990 TIMES.           01310000
013200         10  PT-INV-ID-SUB    PIC 9(03)  VALUE ZEROS.             01320000
013300                                                                  01330000
013400* THE PT-INT-INV-PARM-MDSE-TABLE TABLE HOLDS ALL OF THE           01340000
013500* DEPARTMENTS ASSOCIATED WITH ONE STORE. ORIGINALLY IT WAS        01350000
013600* INTENDED TO HOLD BOTH DEPARTMENT AND MAJOR CLASS CODE           01360000
013700* (HENCE THE SIZE OF 4000). TAKING INVENTORY AT THE MAJOR         01370000
013800* CLASS WITHIN A DEPARTMENT HAS BEEN REMOVED AS A REQUIREMENT     01380000
013900 01  PT-INT-INV-PARM-MDSE-TABLE.                                  01390000
014000     05  PT-PV-IIPM-OCC-CTR   PIC S9(04) VALUE ZEROS COMP-3.      01400000
014100     05  PT-IIPM-TABLE-ELEMENTS      OCCURS 4000 TIMES.           01410000
014200         10  PT-IIPM-DEPT-NBR PIC 9(04)  VALUE ZEROS.             01420000
014300                                                                  01430000
014400                                                                  01440000
014500* THE PT-INV-ID-TABLE IDENTIFIES EACH INVENTORY ID AND            01450000
014600* THE TYPE OF INVENTORY TO BE DONE (STORE WIDE OR DEPARTMENT)     01460000
014700                                                                  01470000
014800 01  PT-INV-ID-TABLE.                                             01480000
014900     05  PT-PV-INV-ID-OCC-CTR PIC S9(03) VALUE ZEROS COMP-3.      01490000
015000     05  PT-INV-ID-TABLE-ELEMENTS    OCCURS 99 TIMES.             01500000
015100         10  PT-INV-ID        PIC S9(09) VALUE ZEROS COMP.        01510000
015200         10  PT-INV-TYPE      PIC X(01)  VALUE SPACE.             01520000
015300         88  PT-INV-TYPE-STORE           VALUE 'S'.               01530000
015400         88  PT-INV-TYPE-DEPT            VALUE 'D'.               01540000
015500                                                                  01550000
015600                                                                  01560000
015700 01  ABEND-CODE                PIC S9(04)    VALUE +0 COMP SYNC.  01570000
015800     88  ABEND-4013-DB2-ERROR                VALUE +4013.         01580000
015900                                                                  01590000
016000                                                                  01600000
016100*************************************************************     01610000
016200*    COPYBOOK FOR INVENTORY EXTRACT FILE                          01620000
016300*************************************************************     01630000
016400     COPY INRD014.                                                01640000
016500                                                                  01650000
016600***************************************************************** 01660000
016700* TINCNTL DCLGEN                                                  01670000
016800***************************************************************** 01680000
016900     EXEC SQL                                                     01690000
017000         INCLUDE TINCNTL                                          01700000
017100     END-EXEC.                                                    01710000
017200                                                                  01720000
017300***************************************************************** 01730000
017400* TINVPAR DCLGEN                                                  01740000
017500***************************************************************** 01750000
017600     EXEC SQL                                                     01760000
017700         INCLUDE TINVPAR                                          01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000******************************************************************01800000
018100* TINVPAR CURSOR.                                                 01810000
018200******************************************************************01820000
018300     EXEC SQL                                                     01830000
018400       DECLARE TINVPAR_CURSOR CURSOR FOR                          01840000
018500         SELECT A.LOC_NBR,                                        01850000
018600                A.INV_ID                                          01860000
018700         FROM TINVPAR A                                           01870000
018800             ,TINCNTL B                                           01880000
018900              WHERE A.ACTL_FIN_BK_DTE = '9999-09-09'              01890000
019000                AND A.INV_ID = B.INV_ID                           01900000
019100                AND B.ACTV_IND = 'Y'                              01910000
W33304                AND A.LOC_INV_STAT_CDE = 'IN'                     01911001
019200         FOR FETCH ONLY                                           01920000
019300     END-EXEC.                                                    01930000
019400                                                                  01940000
019500***************************************************************** 01950000
019600* INT_INV_PARM_MDSE  INT00004                                     01960000
019700***************************************************************** 01970000
019800     EXEC SQL                                                     01980000
019900         INCLUDE INT00004                                         01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200     EXEC SQL                                                     02020000
020300       DECLARE INT00004_DEPT_CSR CURSOR FOR                       02030000
020400         SELECT DISTINCT A.DEPT_NBR                               02040000
020500         FROM INT_INV_PARM_MDSE A                                 02050000
020600              WHERE A.INV_ID  = :INT00004-INV-ID                  02060000
020700                AND A.LOC_NBR = :INT00004-LOC-NBR                 02070000
020800         FOR FETCH ONLY                                           02080000
020900     END-EXEC.                                                    02090000
021000*                                                                 02100000
021100***************************************************************** 02110000
021200                                                                  02120000
021300                                                                  02130000
021400***************************************************************** 02140000
021500* ERROR MESSAGE AREA FOR DB2                                      02150000
021600***************************************************************** 02160000
021700     COPY DPWS004.                                                02170000
021800                                                                  02180000
021900*************************************************************     02190000
022000*    DB2 COMMUNICATION AREA                                 *     02200000
022100*************************************************************     02210000
022200     EXEC SQL                                                     02220000
022300         INCLUDE SQLCA                                            02230000
022400     END-EXEC.                                                    02240000
022500                                                                  02250000
022600 PROCEDURE DIVISION.                                              02260000
022700                                                                  02270000
022800*************************************************************     02280000
022900* MAIN PROCESSING PARAGRAPH                                 *     02290000
023000*************************************************************     02300000
023100 1000-MAINLINE.                                                   02310000
023200                                                                  02320000
023300      PERFORM 2000-INITIALIZATION.                                02330000
023400                                                                  02340000
023500      PERFORM 3000-PROCESS-INPUT                                  02350000
023600         UNTIL PS-INPUT-AT-END-YES.                               02360000
023700                                                                  02370000
023800      PERFORM 4000-END-PROCESSING.                                02380000
023900                                                                  02390000
024000      STOP RUN.                                                   02400000
024100                                                                  02410000
024200***************************************************************   02420000
024300* OPEN FILES AND LOAD PT-STORE TABLE WITH INVENTORY INFO          02430000
024400***************************************************************   02440000
024500 2000-INITIALIZATION.                                             02450000
024600                                                                  02460000
024700      OPEN INPUT IN-SHORTAGE-EXT-FILE                             02470000
024800          OUTPUT OUT-SHORTAGE-EXT-FILE                            02480000
024900          OUTPUT OUT-SHORTAGE-FILTER-FILE.                        02490000
025000                                                                  02500000
025100                                                                  02510000
025200                                                                  02520000
025300*** LOAD THE TINVPAR TABLE....                                    02530000
025400     INITIALIZE PT-TINVPAR-TABLE.                                 02540000
025500     MOVE ZEROS             TO PV-STORE-SUB.                      02550000
025600     SET PS-TINVPAR-DONE-NO TO TRUE.                              02560000
025700     PERFORM 8200-OPEN-TINVPAR.                                   02570000
025800     PERFORM 8300-LOAD-TINVPAR-TABLE                              02580000
025900         UNTIL PS-TINVPAR-DONE-YES       OR                       02590000
026000               PV-STORE-SUB IS GREATER THAN PC-9990.              02600000
026100     PERFORM 8400-CLOSE-TINVPAR.                                  02610000
026200                                                                  02620000
026300***************************************************************   02630000
026400*     PROCESS INPUT                                           *   02640000
026500*     DETERMINE IF RECORD IS PART OF THE INVENTORY CYCLE      *   02650000
026600*     IF YES, WRITE IT OUT                                    *   02660000
026700***************************************************************   02670000
026800 3000-PROCESS-INPUT.                                              02680000
026900                                                                  02690000
027000     PERFORM 3100-READ-INPUT.                                     02700000
027100                                                                  02710000
027200     IF PS-INPUT-AT-END-NO                                        02720000
027300         SET PS-QUALIFIES-FOR-INVENTORY-NO                        02730000
027400                                 TO TRUE                          02740000
027500         MOVE IN014-STR-NBR      TO PV-HOLD-STORE-NBR             02750000
027600         MOVE IN014-DEPT-NBR     TO PV-HOLD-DEPT-NBR              02760000
027700         PERFORM 7000-CHECK-BY-INV-TYPE                           02770000
027800         PERFORM 3200-WRITE-OUTPUT-BY-TYPE                        02780000
027900     END-IF.                                                      02790000
028000                                                                  02800000
028100 3100-READ-INPUT.                                                 02810000
028200                                                                  02820000
028300     READ IN-SHORTAGE-EXT-FILE INTO IN014-SHORTAGE-EXTR-REC       02830000
028400         AT END                                                   02840000
028500            SET PS-INPUT-AT-END-YES TO TRUE.                      02850000
028600                                                                  02860000
028700     IF PS-INPUT-AT-END-NO                                        02870000
028800         ADD +1 TO PA-INPUT-RECORD-COUNT.                         02880000
028900                                                                  02890000
029000                                                                  02900000
029100 3200-WRITE-OUTPUT-BY-TYPE.                                       02910000
029200                                                                  02920000
029300     IF PS-QUALIFIES-FOR-INVENTORY-YES                            02930000
029400         WRITE OUT-SHORTAGE-EXT-RECORD                            02940000
029500                               FROM IN014-SHORTAGE-EXTR-REC       02950000
029600         ADD +1 TO PA-OUTPUT-VALID-COUNT                          02960000
029700     ELSE                                                         02970000
029800         WRITE OUT-SHORTAGE-FILTER-RECORD                         02980000
029900                               FROM IN014-SHORTAGE-EXTR-REC       02990000
030000         ADD +1 TO PA-OUTPUT-FILTER-COUNT                         03000000
030100     END-IF.                                                      03010000
030200                                                                  03020000
030300 4000-END-PROCESSING.                                             03030000
030400                                                                  03040000
030500     CLOSE IN-SHORTAGE-EXT-FILE                                   03050000
030600            OUT-SHORTAGE-EXT-FILE                                 03060000
030700            OUT-SHORTAGE-FILTER-FILE.                             03070000
030800                                                                  03080000
030900     DISPLAY '*** TOTAL NBR OF SHORTAGE RECS READ  '              03090000
031000          PA-INPUT-RECORD-COUNT.                                  03100000
031100     DISPLAY '*** TOTAL NBR OF VALID SHORTAGE RECS WRITTEN '      03110000
031200          PA-OUTPUT-VALID-COUNT.                                  03120000
031300     DISPLAY '*** TOTAL NBR OF FILTERED SHORTAGE RECS WRITTEN '   03130000
031400          PA-OUTPUT-FILTER-COUNT.                                 03140000
031500     DISPLAY ' '.                                                 03150000
031600     COMPUTE PA-WORK-RECORD-COUNT = PA-OUTPUT-VALID-COUNT         03160000
031700                                  + PA-OUTPUT-FILTER-COUNT.       03170000
031800                                                                  03180000
031900     IF PA-WORK-RECORD-COUNT = PA-INPUT-RECORD-COUNT              03190000
032000           DISPLAY ' JOB IN BALANCE '                             03200000
032100     ELSE                                                         03210000
032200           DISPLAY ' JOB OUT OF BALANCE '.                        03220000
032300                                                                  03230000
032400******************************************************************03240000
032500*7000-CHECK-BY-INV-TYPE.                                          03250000
032600* THE 7000 SERIES LOGIC WILL DETERMINE IF THE INVENTORY IS BEING  03260000
032700* DONE FOR THE WHOLE STORE OR SPECIFIC DEPARTMENTS IN ONE OR MORE 03270000
032800* STORES. FOR A STORE WIDE INVENTORY, ALL RECORDS ARE INCLUDED.   03280000
032900* FOR A DEPARTMENT INVENTORY, ONLY THOSE RECORDS IN THE THE       03290000
033000* DEPARTMENT(S) WILL BE INCLUDED.                                 03300000
033100* THE INFORMATION FOR THIS DECISION IS CARRIED IN THE             03310000
033200* INT_INV_PARM_MDSE TABLE. THIS INFORMATION WILL BE               03320000
033300* LOADED INTO MEMORY ONCE PER STORE.                              03330000
033400******************************************************************03340000
033500                                                                  03350000
033600 7000-CHECK-BY-INV-TYPE.                                          03360000
033700                                                                  03370000
033800     MOVE PT-INV-ID-SUB (PV-HOLD-STORE-NBR)                       03380000
033900                            TO PV-II-TBL-SUB.                     03390000
034000                                                                  03400000
034100     IF PT-INV-ID-SUB (PV-HOLD-STORE-NBR) = ZEROS                 03410000
034200         CONTINUE                                                 03420000
034300     ELSE                                                         03430000
034400         IF PT-INV-TYPE-STORE (PV-II-TBL-SUB)                     03440000
034500             SET PS-QUALIFIES-FOR-INVENTORY-YES TO TRUE           03450000
034600             MOVE PV-HOLD-STORE-NBR TO PV-PREV-STORE-NBR          03460000
034700     ELSE                                                         03470000
034800         PERFORM 7005-CHECK-BY-DEPT                               03480000
034900     END-IF.                                                      03490000
035000                                                                  03500000
035100                                                                  03510000
035200 7005-CHECK-BY-DEPT.                                              03520000
035300                                                                  03530000
035400* WHEN STORE NUMBERS ARE NOT EQUAL, A NEW STORE IS BEING          03540000
035500* PROCESSED AND THE DEPT DATA MUST BE LOADED INTO WS FROM DB2     03550000
035600                                                                  03560000
035700     IF PV-HOLD-STORE-NBR NOT EQUAL PV-PREV-STORE-NBR             03570000
035800         MOVE ZEROS TO PV-STORE-XXXX-COUNT                        03580000
035900         PERFORM 7010-COUNT-STORE-SPECIFIC                        03590000
036000             IF PV-STORE-XXXX-COUNT > ZEROS                       03600000
036100                 PERFORM 7025-LOAD-STORE-SPECIFIC                 03610000
036200             ELSE                                                 03620000
036300                 PERFORM 7075-LOAD-DEFAULTS                       03630000
036400             END-IF                                               03640000
036500         MOVE PV-HOLD-STORE-NBR TO PV-PREV-STORE-NBR              03650000
036600     END-IF.                                                      03660000
036700                                                                  03670000
036800     PERFORM                                                      03680000
036900         VARYING PV-IIPM-TBL-SUB FROM 1 BY 1                      03690000
037000         UNTIL   PV-IIPM-TBL-SUB > PT-PV-IIPM-OCC-CTR OR          03700000
037100                 PS-QUALIFIES-FOR-INVENTORY-YES                   03710000
037200                                                                  03720000
037300             IF PV-HOLD-DEPT-NBR = PT-IIPM-DEPT-NBR               03730000
037400                                           (PV-IIPM-TBL-SUB)      03740000
037500                 SET PS-QUALIFIES-FOR-INVENTORY-YES TO TRUE       03750000
037600             END-IF                                               03760000
037700     END-PERFORM.                                                 03770000
037800                                                                  03780000
037900                                                                  03790000
038000 7010-COUNT-STORE-SPECIFIC.                                       03800000
038100                                                                  03810000
038200     MOVE PT-INV-ID (PV-II-TBL-SUB) TO INT00004-INV-ID.           03820000
038300     MOVE PV-HOLD-STORE-NBR         TO INT00004-LOC-NBR.          03830000
038400                                                                  03840000
038500     EXEC SQL                                                     03850000
038600         SELECT COUNT (DISTINCT DEPT_NBR)                         03860000
038700              INTO :PV-STORE-XXXX-COUNT                           03870000
038800              FROM INT_INV_PARM_MDSE                              03880000
038900              WHERE INV_ID   = :INT00004-INV-ID                   03890000
039000                AND LOC_NBR  = :INT00004-LOC-NBR                  03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300     EVALUATE TRUE                                                03930000
039400         WHEN SQLCODE = ZERO                                      03940000
039500         WHEN SQLCODE = +100                                      03950000
039600             CONTINUE                                             03960000
039700         WHEN SQLWARN IS NOT EQUAL TO SPACES                      03970000
039800         WHEN SQLCODE IS NOT EQUAL TO ZERO                        03980000
039900         MOVE '7010-COUNT-STORE-SPECIFIC' TO PV-PARAGRAPH-NAME    03990000
040000         MOVE 'COUNT     '        TO PV-DB2-OPER-ATTEMPTED        04000000
040100         PERFORM 9000-SQL-ABEND                                   04010000
040200     END-EVALUATE.                                                04020000
040300                                                                  04030000
040400                                                                  04040000
040500 7025-LOAD-STORE-SPECIFIC.                                        04050000
040600                                                                  04060000
040700     INITIALIZE PT-INT-INV-PARM-MDSE-TABLE.                       04070000
040800                                                                  04080000
040900     PERFORM 7100-OPEN-CUR.                                       04090000
041000                                                                  04100000
041100     SET PS-IIPM-LOADED-NO TO TRUE.                               04110000
041200                                                                  04120000
041300     PERFORM 7130-LOAD-ENTRIES                                    04130000
041400         UNTIL PS-IIPM-LOADED-YES.                                04140000
041500                                                                  04150000
041600     PERFORM 7110-CLOSE-CUR.                                      04160000
041700                                                                  04170000
041800                                                                  04180000
041900 7075-LOAD-DEFAULTS.                                              04190000
042000                                                                  04200000
042100     MOVE PT-INV-ID (PV-II-TBL-SUB) TO INT00004-INV-ID.           04210000
042200     MOVE ZEROS                     TO INT00004-LOC-NBR.          04220000
042300                                                                  04230000
042400     INITIALIZE PT-INT-INV-PARM-MDSE-TABLE.                       04240000
042500                                                                  04250000
042600     PERFORM 7100-OPEN-CUR.                                       04260000
042700                                                                  04270000
042800     SET PS-IIPM-LOADED-NO TO TRUE.                               04280000
042900                                                                  04290000
043000     PERFORM 7130-LOAD-ENTRIES                                    04300000
043100         UNTIL PS-IIPM-LOADED-YES.                                04310000
043200                                                                  04320000
043300     PERFORM 7110-CLOSE-CUR.                                      04330000
043400                                                                  04340000
043500                                                                  04350000
043600 7100-OPEN-CUR.                                                   04360000
043700*                                                                 04370000
043800     EXEC SQL                                                     04380000
043900         OPEN INT00004_DEPT_CSR                                   04390000
044000     END-EXEC.                                                    04400000
044100                                                                  04410000
044200     EVALUATE TRUE                                                04420000
044300       WHEN SQLCODE IS EQUAL TO ZERO                              04430000
044400         CONTINUE                                                 04440000
044500       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04450000
044600       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04460000
044700        MOVE '7100-OPEN-CUR    ' TO PV-PARAGRAPH-NAME             04470000
044800        MOVE 'OPEN CURSOR'       TO PV-DB2-OPER-ATTEMPTED         04480000
044900        PERFORM 9000-SQL-ABEND                                    04490000
045000     END-EVALUATE.                                                04500000
045100                                                                  04510000
045200                                                                  04520000
045300 7110-CLOSE-CUR.                                                  04530000
045400*                                                                 04540000
045500     EXEC SQL                                                     04550000
045600         CLOSE INT00004_DEPT_CSR                                  04560000
045700     END-EXEC.                                                    04570000
045800*                                                                 04580000
045900     EVALUATE TRUE                                                04590000
046000       WHEN SQLCODE IS EQUAL TO ZERO                              04600000
046100         CONTINUE                                                 04610000
046200       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04620000
046300       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04630000
046400        MOVE '7110-CLOSE-CUR    ' TO PV-PARAGRAPH-NAME            04640000
046500        MOVE 'CLOSE CURSOR'       TO PV-DB2-OPER-ATTEMPTED        04650000
046600        PERFORM 9000-SQL-ABEND                                    04660000
046700     END-EVALUATE.                                                04670000
046800                                                                  04680000
046900 7130-LOAD-ENTRIES.                                               04690000
047000                                                                  04700000
047100     PERFORM 7140-FETCH-INT-INV-CUR.                              04710000
047200                                                                  04720000
047300     IF PS-IIPM-LOADED-NO                                         04730000
047400         PERFORM 7145-LOAD-IIPM-TO-TBL.                           04740000
047500                                                                  04750000
047600                                                                  04760000
047700 7140-FETCH-INT-INV-CUR.                                          04770000
047800*                                                                 04780000
047900     EXEC SQL                                                     04790000
048000         FETCH INT00004_DEPT_CSR                                  04800000
048100         INTO :INT00004-DEPT-NBR,                                 04810000
048200              :INT00004-MAJ-CL-NBR                                04820000
048300     END-EXEC.                                                    04830000
048400     EVALUATE TRUE                                                04840000
048500       WHEN SQLCODE IS EQUAL TO ZERO                              04850000
048600           CONTINUE                                               04860000
048700       WHEN SQLCODE IS EQUAL TO +100                              04870000
048800         SET  PS-IIPM-LOADED-YES TO TRUE                          04880000
048900       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04890000
049000       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04900000
049100         MOVE '7140-FETCH-INT-INV-CUR' TO PV-PARAGRAPH-NAME       04910000
049200         MOVE 'LOAD TABLE'        TO PV-DB2-OPER-ATTEMPTED        04920000
049300         PERFORM 9000-SQL-ABEND                                   04930000
049400     END-EVALUATE.                                                04940000
049500                                                                  04950000
049600                                                                  04960000
049700 7145-LOAD-IIPM-TO-TBL.                                           04970000
049800                                                                  04980000
049900     ADD 1 TO PT-PV-IIPM-OCC-CTR.                                 04990000
050000                                                                  05000000
050100     IF PT-PV-IIPM-OCC-CTR > PC-FOUR-THOUSAND                     05010000
050200         MOVE '7145-LOAD-IIPM-TO-TBL      '                       05020000
050300                                  TO PV-PARAGRAPH-NAME            05030000
050400         MOVE 'MAX ENTRIES EXCEEDED'  TO PV-DB2-OPER-ATTEMPTED    05040000
050500         DISPLAY 'WS-INT-INV-PARM-MDSE-TABLE '                    05050000
050600         DISPLAY 'PT-PV-IIPM-OCC-CTR > PC-FOUR-THOUSAND '         05060000
050700                                       PT-PV-IIPM-OCC-CTR         05070000
050800         DISPLAY 'INV STORE: ', IN014-STR-NBR                     05080000
050900         PERFORM 9000-SQL-ABEND                                   05090000
051000     ELSE                                                         05100000
051100         MOVE INT00004-DEPT-NBR TO PT-IIPM-DEPT-NBR               05110000
051200                                    (PT-PV-IIPM-OCC-CTR)          05120000
051300     END-IF.                                                      05130000
051400                                                                  05140000
051500                                                                  05150000
051600                                                                  05160000
051700***************************************************************** 05170000
051800* 8200-OPEN-TINVPAR.                                              05180000
051900***************************************************************** 05190000
052000 8200-OPEN-TINVPAR.                                               05200000
052100*                                                                 05210000
052200     EXEC SQL                                                     05220000
052300         OPEN TINVPAR_CURSOR                                      05230000
052400     END-EXEC.                                                    05240000
052500                                                                  05250000
052600     EVALUATE TRUE                                                05260000
052700       WHEN SQLCODE IS EQUAL TO ZERO                              05270000
052800         CONTINUE                                                 05280000
052900       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05290000
053000       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05300000
053100        MOVE '8200-OPEN-TINVPAR' TO PV-PARAGRAPH-NAME             05310000
053200        MOVE 'OPEN CURSOR'       TO PV-DB2-OPER-ATTEMPTED         05320000
053300        SET PS-TINVPAR-DONE-YES  TO TRUE                          05330000
053400        PERFORM 9000-SQL-ABEND                                    05340000
053500     END-EVALUATE.                                                05350000
053600*                                                                 05360000
053700***************************************************************** 05370000
053800* 8300-LOAD-TINVPAR-TABLE.                                        05380000
053900***************************************************************** 05390000
054000 8300-LOAD-TINVPAR-TABLE.                                         05400000
054100*                                                                 05410000
054200     EXEC SQL                                                     05420000
054300         FETCH TINVPAR_CURSOR                                     05430000
054400         INTO :INVPAR-LOC-NBR,                                    05440000
054500              :INVPAR-INV-ID                                      05450000
054600     END-EXEC.                                                    05460000
054700                                                                  05470000
054800     EVALUATE TRUE                                                05480000
054900       WHEN SQLCODE IS EQUAL TO ZERO                              05490000
055000         MOVE INVPAR-LOC-NBR      TO PV-STORE-SUB                 05500000
055100         PERFORM 8325-LOAD-INV-ID-TABLE                           05510000
055200       WHEN SQLCODE IS EQUAL TO +100                              05520000
055300         SET PS-TINVPAR-DONE-YES  TO TRUE                         05530000
055400       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05540000
055500       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05550000
055600         MOVE '8300-LOAD-TINVPAR-TABLE' TO PV-PARAGRAPH-NAME      05560000
055700         MOVE 'LOAD TABLE'        TO PV-DB2-OPER-ATTEMPTED        05570000
055800         SET PS-TINVPAR-DONE-YES  TO TRUE                         05580000
055900         PERFORM 9000-SQL-ABEND                                   05590000
056000     END-EVALUATE.                                                05600000
056100                                                                  05610000
056200                                                                  05620000
056300 8325-LOAD-INV-ID-TABLE.                                          05630000
056400                                                                  05640000
056500     SET PS-INV-ID-FOUND-NO TO TRUE.                              05650000
056600                                                                  05660000
056700     PERFORM                                                      05670000
056800        VARYING PV-II-TBL-SUB FROM 1 BY 1                         05680000
056900        UNTIL   PV-II-TBL-SUB > PT-PV-INV-ID-OCC-CTR OR           05690000
057000                PS-INV-ID-FOUND-YES                               05700000
057100            IF INVPAR-INV-ID = PT-INV-ID (PV-II-TBL-SUB)          05710000
057200                MOVE PV-II-TBL-SUB TO PT-INV-ID-SUB               05720000
057300                                        (PV-STORE-SUB)            05730000
057400                SET PS-INV-ID-FOUND-YES TO TRUE                   05740000
057500            END-IF                                                05750000
057600     END-PERFORM.                                                 05760000
057700                                                                  05770000
057800     IF PS-INV-ID-FOUND-NO                                        05780000
057900         ADD 1 TO PT-PV-INV-ID-OCC-CTR                            05790000
058000         IF PT-PV-INV-ID-OCC-CTR > PC-NINETY-NINE                 05800000
058100             PERFORM 8330-OUT-OF-ROOM                             05810000
058200         ELSE                                                     05820000
058300             MOVE INVPAR-INV-ID    TO PT-INV-ID                   05830000
058400                                        (PT-PV-INV-ID-OCC-CTR)    05840000
058500             MOVE PT-PV-INV-ID-OCC-CTR TO PT-INV-ID-SUB           05850000
058600                                        (PV-STORE-SUB)            05860000
058700             PERFORM 8335-COUNT-DEFAULT-ROWS                      05870000
058800         END-IF                                                   05880000
058900     END-IF.                                                      05890000
059000                                                                  05900000
059100 8330-OUT-OF-ROOM.                                                05910000
059200                                                                  05920000
059300     MOVE '8330-OUT-OF-ROOM           '                           05930000
059400                                  TO PV-PARAGRAPH-NAME.           05940000
059500     MOVE 'MAX ENTRIES EXCEEDED'  TO PV-DB2-OPER-ATTEMPTED.       05950000
059600     DISPLAY 'WS-INV-ID-TABLE EXCEEDED '.                         05960000
059700     DISPLAY 'PT-PV-INV-ID-OCC-CTR > PC-NINETY-NINE '             05970000
059800                                       PT-PV-INV-ID-OCC-CTR.      05980000
059900     DISPLAY 'INV STORE: ', IN014-STR-NBR.                        05990000
060000     PERFORM 9000-SQL-ABEND.                                      06000000
060100                                                                  06010000
060200                                                                  06020000
060300 8335-COUNT-DEFAULT-ROWS.                                         06030000
060400     MOVE INVPAR-INV-ID TO INT00004-INV-ID.                       06040000
060500     MOVE ZEROS         TO INT00004-LOC-NBR                       06050000
060600                           PV-STORE-0000-COUNT.                   06060000
060700                                                                  06070000
060800     EXEC SQL                                                     06080000
060900         SELECT COUNT (DISTINCT DEPT_NBR)                         06090000
061000              INTO :PV-STORE-0000-COUNT                           06100000
061100              FROM INT_INV_PARM_MDSE                              06110000
061200              WHERE INV_ID   = :INT00004-INV-ID                   06120000
061300                AND LOC_NBR  = :INT00004-LOC-NBR                  06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600     EVALUATE TRUE                                                06160000
061700         WHEN SQLCODE = ZERO                                      06170000
061800         WHEN SQLCODE = +100                                      06180000
061900             PERFORM 8340-SET-INV-TYPE                            06190000
062000         WHEN SQLWARN IS NOT EQUAL TO SPACES                      06200000
062100         WHEN SQLCODE IS NOT EQUAL TO ZERO                        06210000
062200         MOVE '8335-COUNT-DEFAULT-ROWS' TO PV-PARAGRAPH-NAME      06220000
062300         MOVE 'COUNT     '        TO PV-DB2-OPER-ATTEMPTED        06230000
062400         PERFORM 9000-SQL-ABEND                                   06240000
062500     END-EVALUATE.                                                06250000
062600                                                                  06260000
062700 8340-SET-INV-TYPE.                                               06270000
062800                                                                  06280000
062900     IF PV-STORE-0000-COUNT = ZEROS                               06290000
063000         SET PT-INV-TYPE-STORE (PT-PV-INV-ID-OCC-CTR) TO TRUE     06300000
063100     ELSE                                                         06310000
063200         SET PT-INV-TYPE-DEPT  (PT-PV-INV-ID-OCC-CTR) TO TRUE     06320000
063300     END-IF.                                                      06330000
063400                                                                  06340000
063500*                                                                 06350000
063600***************************************************************** 06360000
063700* 8400-CLOSE-TINVPAR.                                             06370000
063800***************************************************************** 06380000
063900 8400-CLOSE-TINVPAR.                                              06390000
064000*                                                                 06400000
064100     EXEC SQL                                                     06410000
064200         CLOSE TINVPAR_CURSOR                                     06420000
064300     END-EXEC.                                                    06430000
064400*                                                                 06440000
064500     EVALUATE TRUE                                                06450000
064600       WHEN SQLCODE IS EQUAL TO ZERO                              06460000
064700         CONTINUE                                                 06470000
064800       WHEN SQLWARN IS NOT EQUAL TO SPACES                        06480000
064900       WHEN SQLCODE IS NOT EQUAL TO ZERO                          06490000
065000        MOVE '8400-CLOSE-TINVPAR' TO PV-PARAGRAPH-NAME            06500000
065100        MOVE 'CLOSE CURSOR'       TO PV-DB2-OPER-ATTEMPTED        06510000
065200        SET PS-TINVPAR-DONE-YES   TO TRUE                         06520000
065300        PERFORM 9000-SQL-ABEND                                    06530000
065400     END-EVALUATE.                                                06540000
065500*                                                                 06550000
065600                                                                  06560000
065700***************************************************************   06570000
065800*    SQL ABEND PROCESSING                                     *   06580000
065900***************************************************************   06590000
066000 9000-SQL-ABEND.                                                  06600000
066100                                                                  06610000
066200     DISPLAY '** ABEND     **'.                                   06620000
066300     DISPLAY '** PROGRAM   = ' PC-PROGRAM-ID.                     06630000
066400     DISPLAY '** PARAGRAPH = ' PV-PARAGRAPH-NAME.                 06640000
066500     DISPLAY '** OPERATION = ' PV-DB2-OPER-ATTEMPTED.             06650000
066600                                                                  06660000
066700     COPY DPPD004.                                                06670000
066800                                                                  06680000
066900     CALL 'ILBOABN0'  USING ABEND-CODE.                           06690000
067000                                                                  06700000
