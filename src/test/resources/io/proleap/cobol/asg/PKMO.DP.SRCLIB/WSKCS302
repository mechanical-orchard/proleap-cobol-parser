000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    WSKCS302.                                         00020000
000300 AUTHOR.        RICHARD WOJTCZAK.                                 00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   FEBRUARY 2007.                                    00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00080000
000900* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00090000
001000* THIS PROGRAM USES MQSERIES.                                     00100000
001100******************************************************************00110000
001200*               ASN TRANSMISSION MODULE                           00120000
001300*               -----------------------                           00130000
001400*                                                                 00140000
001500* THIS PROGRAM WILL READ THE TEMP TABLE WST_ASN_DWNLD             00150000
001600* AND MAP INCOMING ROWS TO XML RECORD TYPES FOR PROCESSING        00160000
001700* BY THE XML GENERATOR.  THE MAPPING SUMMARY IS;                  00170000
001800*                                                                 00180000
001900* RECID 'CH' = CASE HEADER --> ASNCase (CH-SUB)                   00190000
002000* RECID 'CD' = CASE DETAIL --> ASNCaseDetail (CH-SUB CD-SUB)      00200000
002100* RECID 'AH' = ASN HEADER  --> InboundASN                         00210000
002200* RECID 'CD' = ASN DETAIL  --> ASNDetail (AD-SUB)                 00220000
002300* RECID 'AP' = APPOINTMENT --> ApptScheduleBridge                 00230000
002400*                                                                 00240000
002500* MM/DD/YYYY WHO & WHAT                                           00250000
002600* ---------- -----------------------------------------------------00260000
002700* 06/22/2017 CHERI PARMLEY                                        00270000
002800*            CHANGE in 1150-GET-INPUT-QUEUE-INFO TO MOVE THE DC   00280000
002900*            # BEFORE THE SELECT AND THEN CHECK FOR IT IT THE     00290000
003000*            WHERE CLAUSE. THIS WAS NEEDED WHEN Efc5 IS USING A   00300000
003100*            DIFFERENT QUEUE THAN THE OTHER eFCs/LFC's.           00310000
003200*                                                                 00320000
003300*            WST_ATTR_ELEM was changed to include all the eFC's   00330000
003400*            and LFC's. Included on the table are 'SH' these are  00340000
003500*            Stores for the eFC's and LFC's. RC uses 'DC' loc.    00350000
003600* 08/09/2017 Jim Hunter                    CHG0175005             00360000
003700*  CHANGE MADE: Added "Group Trouble" logic that will pass the    00370000
003800*  the trouble indicator to the EFC when any of the related       00380000
003900*  dummy ids to the shipment id has trouble. Group trouble EFCs   00390000
004000*  will be identified on the TKRPRPM table.  Initially, only      00400000
004100*  EFC5 will utilize this logic.                                  00410000
004200* 08/21/2017 Jim Hunter                    CHG0177168             00420000
004300*  CHANGE MADE: Change sql in para 3047- that looks for trouble   00430000
004400*  count.  If count is > zero, set 'TR', otherwise use original   00440000
004500*  value that was to be downloaded.                               00450000
004600* 02/25/2019 Jim Arendt                    CHG0218265             00460000
004700*  CHANGE MADE: Change made to populate new XML field AltCaseNbr. 00470000
004800******************************************************************00480000
004900 ENVIRONMENT DIVISION.                                            00490000
005000******************************************************************00500000
005100 CONFIGURATION SECTION.                                           00510000
005200 SOURCE-COMPUTER.        IBM-3090.                                00520000
005300 OBJECT-COMPUTER.        IBM-3090.                                00530000
005400                                                                  00540000
005500*INPUT-OUTPUT SECTION.                                            00550000
005600*FILE-CONTROL.                                                    00560000
005700                                                                  00570000
005800******************************************************************00580000
005900 DATA DIVISION.                                                   00590000
006000*FILE SECTION.                                                    00600000
006100*                                                                 00610000
006200 WORKING-STORAGE SECTION.                                         00620000
006300 01  PV-XML                          PIC X(5500000)  VALUE SPACES.00630000
006400 01  PV-XML2 REDEFINES PV-XML.                                    00640000
006500     05 PV-XML2-CHAR OCCURS  5500000 INDEXED BY X1 PIC X(01).     00650000
006600                                                                  00660000
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
006800     05  PV-FETCH1                   PIC S9(07) COMP VALUE +0.    00680000
006900     05  PV-XML-WRITE                PIC S9(07) COMP VALUE +0.    00690000
007000     05  PV-CH-CNT                   PIC S9(07) COMP VALUE +0.    00700000
007100     05  PV-CD-CNT                   PIC S9(07) COMP VALUE +0.    00710000
007200     05  PV-AD-CNT                   PIC S9(07) COMP VALUE +0.    00720000
007300     05  PV-AP-CNT                   PIC S9(07) COMP VALUE +0.    00730000
007400     05  PV-AH-CNT                   PIC S9(07) COMP VALUE +0.    00740000
007500     05  PV-OT-CNT                   PIC S9(07) COMP VALUE +0.    00750000
007600     05  PV-CH-XML                   PIC S9(07) COMP VALUE +0.    00760000
007700     05  PV-AH-XML                   PIC S9(07) COMP VALUE +0.    00770000
007800     05  PV-AD-XML                   PIC S9(07) COMP VALUE +0.    00780000
007900     05  PV-AP-XML                   PIC S9(07) COMP VALUE +0.    00790000
008000     05  PV-MQ-MESSAGES              PIC S9(07) COMP VALUE +0.    00800000
008100     05  PV-XML-OUT                  PIC S9(07) COMP VALUE +0.    00810000
008200     05  PV-CONVERT-NUM              PIC 99999999.9999.           00820000
008300     05  PV-LAST-CSE-DTL-NBR         PIC S9(04) COMP VALUE 0.     00830000
008400     05  PV-SHIP-CNT                 PIC 9(05)  COMP VALUE 0.     00840000
008500     05  PV-SHIP-CNT-AD              PIC 9(05)  COMP VALUE 0.     00850000
008600     05  XML-LENGTH                  PIC 9(7)   COMP VALUE 0.     00860000
008700     05  PV-DISP-SQLCODE             PIC -999.                    00870000
008800     05  PV-DISP-mq-comp-code        PIC -9(09) value zeroes.     00880000
008900     05  PV-DISP-NUM                 PIC 9(09)  VALUE 0.          00890000
009000     05  PV-DISP-PRC-GP-ID           PIC 9(09)  VALUE 0.          00900000
009100     05  PV-REC-CNT                  PIC 9(05)  COMP VALUE 0.     00910000
009200     05  PV-REC-OVER                 PIC 9(05)  COMP VALUE 0.     00920000
009300     05  PV-BYTES-REM                PIC 9(05)  COMP VALUE 0.     00930000
009400     05  PV-MIN-RECSIZE              PIC 9(05)  COMP VALUE 80.    00940000
009500     05  PV-REC-LEN                  PIC 9(05)  COMP VALUE 0.     00950000
009600     05  PV-REC-START                PIC 9(05)  COMP VALUE 1.     00960000
009700     05  PV-REC-FOR                  PIC 9(05)  COMP VALUE 1.     00970000
009800     05  PV-XML-CHAR                 PIC 9(05)  COMP VALUE 0.     00980000
009900     05  PV-BEFORE                   PIC X(99999).                00990000
010000     05  PV-AFTER                    PIC X(99999).                01000000
010100     05  PV-BEFORE-CNT               PIC 9(09)       VALUE 0.     01010000
010200     05  PV-AFTER-CNT                PIC 9(09)       VALUE 0.     01020000
010300     05  PV-HDR-LENGTH               PIC 9(05)  COMP VALUE 0.     01030000
010400     05  PV-DTL-LENGTH               PIC 9(05)  COMP VALUE 0.     01040000
010500     05  PV-MAX-BYTES                PIC 9(05)  COMP VALUE 0.     01050000
010600     05  PV-MAX-CASES                PIC 9(05)  COMP VALUE 0.     01060000
010700     05  PV-MAX-ASN                  PIC 9(05)  COMP VALUE 0.     01070000
010800     05  PV-ASN-LENGTH               PIC 9(05)  COMP VALUE 0.     01080000
010900     05  PV-MAX-XML-LENGTH           PIC 9(07)  COMP VALUE 0.     01090000
011000     05  PV-STATUS-CODE              PIC X(02)  VALUE SPACES.     01100000
011100     05  PV-CONVERT-DATE             PIC X(20)  VALUE SPACES.     01110000
011200     05  PV-USERID                   PIC X(08)  VALUE SPACES.     01120000
011300     05  PV-WHSE                     PIC X(4)   VALUE ZEROES.     01130000
011400     05  PV-WHSE-REDEF REDEFINES PV-WHSE                          01140000
011500                                     PIC 9(4).                    01150000
011600     05  PV-WHSE-NUM                 PIC S9(4) COMP VALUE ZEROES. 01160000
011700     05  PV-FUNC-TXT                 PIC X(25)  VALUE SPACES.     01170000
011800     05  PV-EXT-SHP-ID-11            PIC X(11)  VALUE SPACES.     01180000
011900     05  PV-TROUBLE-COUNT            PIC S9(4) COMP VALUE ZEROES. 01190000
011910     05  PV-ELEMENT-SEND             PIC  X(1) VALUE SPACES.      01191000
011920     05  PV-DB2-COUNT                PIC S9(09) VALUE +0 COMP-3.  01192000
011921     05  PV-INNR-PACK-QTY            PIC  S9(4) COMP.             01192100
011922     05  PV-OUTR-PACK-QTY            PIC  S9(4) COMP.             01192200
011923     05  PV-VENDOR-PO                PIC  X(10).                  01192300
011924     05  PV-VENDOR-PO-N  REDEFINES  PV-VENDOR-PO.                 01192400
011925         10 FILLER                       PIC  9(01).              01192500
011926         10 PV-VENDOR-PO-R               PIC  9(09).              01192600
011927                                                                  01192702
011928     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      01192802
011929                                                 COMP SYNC.       01192902
011930     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      01193002
011931                                                 COMP SYNC.       01193102
011932     05  PV-NULL-IND-3               PIC S9(04)  VALUE ZEROS      01193202
011933                                                 COMP SYNC.       01193302
011934     05  PV-NULL-IND-4               PIC S9(04)  VALUE ZEROS      01193402
011935                                                 COMP SYNC.       01193502
011936     05  PV-NULL-IND-5               PIC S9(04)  VALUE ZEROS      01193602
011937                                                 COMP SYNC.       01193702
011938     05  PV-NULL-IND-6               PIC S9(04)  VALUE ZEROS      01193802
011939                                                 COMP SYNC.       01193902
011940                                                                  01194000
011941                                                                  01194100
011942 01  PC-PROGRAM-CONSTANTS.                                        01194200
011943     05  PC-PROGRAM-NAME             PIC X(08) VALUE 'WSKCS302'.  01194300
011944     05  PC-CURRENT-TRANID           PIC X(04) VALUE 'S302'.      01194400
011945     05  PC-XML-ZEROES               PIC X(20) VALUE              01194500
011946                                     '00000000000000000000'.      01194600
011947     05  PC-NONE                     PIC X(05) VALUE 'NONE '.     01194700
011948     05  PC-HANG                     PIC X(05) VALUE 'HANG '.     01194800
011949     05  PC-NA                       PIC X(05) VALUE 'N/A  '.     01194900
011950     05  PC-MIXED                    PIC X(05) VALUE 'MIXED'.     01195000
011951                                                                  01195100
011952* NOTE;                                                           01195200
011953*      IF YOU CHANGE PC-XML-BANNER LENGTH YOU MUST CHANGE         01195300
011954*      THE INDEX VALUE (X1) IN PARA 2400-.  COBOL DOES NOT        01195400
011960*      ALLOW USING "LENGTH OF" FOR AN INDEX OR SUBSCRIPT.         01196000
011970*                                                                 01197000
011980     05  PC-XML-BANNER               PIC X(38) VALUE              01198000
011990         '<?xml version="1.0" encoding="UTF-8"?>'.                01199000
012000                                                                  01200000
012100 01  PS-PROGRAM-SWITCHES.                                         01210000
012200     05  PS-TBL-IN-SW                PIC X(01) VALUE 'N'.         01220000
012300         88  PS-TBL-IN-EOF                     VALUE 'Y'.         01230000
012400         88  PS-TBL-IN-NOT-EOF                 VALUE 'N'.         01240000
012500     05  PS-CICS-SWITCH-IND          PIC X(01) VALUE 'N'.         01250000
012600         88 PS-CICS-SWITCH-YES                 VALUE 'Y'.         01260000
012700         88 PS-CICS-SWITCH-NO                  VALUE 'N'.         01270000
012800     05  PS-WRITE-MQ-SW        PIC X(01) VALUE 'Y'.               01280000
012900         88 PS-WRITE-MQ-YES                    VALUE 'Y'.         01290000
013000         88 PS-WRITE-MQ-NO                     VALUE 'N'.         01300000
013100* JAK 06/2007 - ADD SWITCH                                        01310000
013200     05  PS-UPDATE-HDR-SW      PIC X(01) VALUE 'N'.               01320000
013300         88 PS-UPDATE-HDR-X                    VALUE 'Y'.         01330000
013400         88 PS-UPDATE-HDR-NO                   VALUE 'N'.         01340000
013500                                                                  01350000
013600 01  PV-ABEND-FIELDS.                                             01360000
013700     05  PV-ABEND-CODE                 PIC S9(4) VALUE +0         01370000
013800                                                       COMP SYNC. 01380000
013900     05  PV-ABEND-PROGRAM              PIC X(08) VALUE 'WSKCS302'.01390000
014000     05  PV-ABEND-PARAGRAPH            PIC X(25) VALUE SPACES.    01400000
014100     05  PV-ABEND-OPERATION            PIC X(20) VALUE SPACES.    01410000
014200     05  PV-ABEND-STRUCTURE-1          PIC X(50) VALUE SPACES.    01420000
014300     05  PV-ABEND-STRUCTURE-2          PIC X(50) VALUE SPACES.    01430000
014400     05  PV-ABEND-STATUS               PIC XX    VALUE SPACES.    01440000
014500     05  PV-DB2-OPERATION-MESSAGE-1    PIC X(79) VALUE SPACES.    01450000
014600     05  PV-DB2-OPERATION-MESSAGE-2    PIC X(79) VALUE SPACES.    01460000
014700     05  PV-PARAGRAPH                  PIC X(25) VALUE SPACES.    01470000
014800     05  PV-RETRY-COUNTER              PIC S9(04) VALUE +0        01480000
014900                                                      COMP SYNC.  01490000
015000     05  PV-HOLD-COMPLETION-CODE       PIC S9(9) BINARY.          01500000
015100     05  PV-HOLD-REASON                PIC S9(9) BINARY.          01510000
015200     05  PV-CICS-RESP                  PIC S9(04) VALUE +0        01520000
015300                                                    COMP SYNC.    01530000
015400     05  PV-CICS-MSG-AREA              PIC X(100) VALUE SPACE.    01540000
015500     05  PV-COMMAREA-LENGTH            PIC S9(04) VALUE +0        01550000
015600                                                    COMP SYNC.    01560000
015700     05  PV-CASE-SSCC                  PIC  X(20).                01570000
015800     05  FILLER  REDEFINES  PV-CASE-SSCC.                         01580000
015900         10  PV-ZERO-VALUE             PIC  X(02).                01590000
016000         10  PV-CASE-SML               PIC  9(18).                01600000
016100     05  PV-CASE-SML-COMP              PIC S9(18)V  COMP-3.       01610000
016200                                                                  01620000
016300     05  PV-XML-CASE-EXPAND            PIC  X(20).                01630000
016301                                                                  01630104
016310     05  PV-XML-LENGTH                 PIC S9(04) VALUE +0        01631004
016320                                                    COMP SYNC.    01632004
016330     05  PV-DISP-XML-LENGTH            PIC  9(04).                01633004
016400                                                                  01640000
016500****************************************************************  01650000
016600*    COMMAREA - CALL THE ASN TRANSMISSION MODULE                  01660000
016700****************************************************************  01670000
016800     COPY WSWS006.                                                01680000
016900                                                                  01690000
017000****************************************************************  01700000
017100*    INPUT RECORD COPYBOOKS                                       01710000
017200****************************************************************  01720000
017300                                                                  01730000
017400****************************************************************  01740000
017500*    RECORD PURPOSE: ASN HEADER - TRAILER INTO WMOS               01750000
017600****************************************************************  01760000
017700     COPY WSRD004.                                                01770000
017800                                                                  01780000
017900************************************************************      01790000
018000*    RECORD PURPOSE: ASN DETAIL - TRAILER INTO WMOS               01800000
018100************************************************************      01810000
018200     COPY WSRD005.                                                01820000
018300                                                                  01830000
018400************************************************************      01840000
018500*    RECORD PURPOSE: CASE HEADER - INTO WMOS                      01850000
018600************************************************************      01860000
018700     COPY WSRD006.                                                01870000
018800                                                                  01880000
018900************************************************************      01890000
019000*    RECORD PURPOSE: CASE DETAIL - INTO WMOS                      01900000
019100************************************************************      01910000
019200     COPY WSRD007.                                                01920000
019300                                                                  01930000
019400************************************************************      01940000
019500*    RECORD PURPOSE: APPOINTMENT - TRAILER INTO WMOS              01950000
019600************************************************************      01960000
019700     COPY WSRD008.                                                01970000
019800                                                                  01980000
019900****************************************************************  01990000
020000*    OUTPUT RECORD COPYBOOKS (XML FORMAT)                         02000000
020100****************************************************************  02010000
020200                                                                  02020000
020300***************************************************************** 02030000
020400*    RECORD: Case Header/detail     (for XML conversion)          02040000
020500***************************************************************** 02050000
020600     COPY WSRD023.                                                02060000
020700                                                                  02070000
020800***************************************************************** 02080000
020900*    RECORD: asn detail             (for XML conversion)          02090000
021000***************************************************************** 02100000
021100     COPY WSRD024.                                                02110000
021200                                                                  02120000
021300***************************************************************** 02130000
021400*    RECORD: ASN Header             (for XML conversion)          02140000
021500***************************************************************** 02150000
021600     COPY WSRD025.                                                02160000
021700                                                                  02170000
021800***************************************************************** 02180000
021900*    RECORD: Appointment            (for XML conversion)          02190000
022000***************************************************************** 02200000
022100     COPY WSRD026.                                                02210000
022200                                                                  02220000
022300****************************************************************  02230000
022400*      M Q   S E R I E S    W O R K I N G   S T O R A G E         02240000
022500*                   M  Q    C O P Y B O O K S                     02250000
022600****************************************************************  02260000
022700 01  MQM-OBJECT-DESCRIPTOR.                                       02270000
022800     COPY CMQODV.                                                 02280000
022900                                                                  02290000
023000 01  MQM-MESSAGE-DESCRIPTOR.                                      02300000
023100     COPY CMQMDV.                                                 02310000
023200                                                                  02320000
023300 01  MQM-GET-MESSAGE-OPTIONS.                                     02330000
023400     COPY CMQGMOV.                                                02340000
023500                                                                  02350000
023600 01  MQM-PUT-MESSAGE-OPTIONS.                                     02360000
023700     COPY CMQPMOV.                                                02370000
023800                                                                  02380000
023900 01  MQM-CONSTANTS.                                               02390000
024000     COPY CMQV.                                                   02400000
024100                                                                  02410000
024200     COPY ISWS002.                                                02420000
024300                                                                  02430000
024400****************************************************************  02440000
024500*  MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND        02450000
024600*  OPEN, CONNECT, DISCONNECT. (CICS PARMS)                        02460000
024700****************************************************************  02470000
024800 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQCCONN'.      02480000
024900 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQCOPEN'.      02490000
025000 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQCINQ'.       02500000
025100 01  PC-MQGET                    PIC X(8)  VALUE 'CSQCGET'.       02510000
025200 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQCPUT'.       02520000
025300 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQCCLOS'.      02530000
025400 01  PC-MQCOMM                   PIC X(8)  VALUE 'CSQCCOMM'.      02540000
025500 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQCDISC'.      02550000
025600 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQCBACK'.      02560000
025700 01  PC-MQCHECK                  PIC X(8)  VALUE 'MQR2C'.         02570000
025800                                                                  02580000
025900 01  MQ-WORKING-STORAGE.                                          02590000
026000     05  PC-QMGR-NAME                 PIC X(4)  VALUE SPACES.     02600000
026100         88  PC-PROD-QMGR-NAME                  VALUE 'QKSP'.     02610000
026200         88  PC-ACCEPT-QMGR-NAME                VALUE 'QKSQ'.     02620000
026300         88  PC-TEST-QMGR-NAME                  VALUE 'QKST'.     02630000
026400     05  PC-RESPONSE-QNAME            PIC X(30) VALUE SPACES.     02640000
026500     05  PC-WAIT-15-SECS              PIC S9(9) VALUE 15000.      02650000
026600     05  PC-WAIT-6-SECS               PIC S9(9) VALUE 6000.       02660000
026700     05  PC-DELAY-INTERVAL.                                       02670000
026800         10  FILLER                   PIC X(2)  VALUE SPACES.     02680000
026900         10  PC-DELAY-TIME            PIC 9(8)  VALUE 1500.       02690000
027000****************************************************************  02700000
027100*  QUEUE HANDLES                                                  02710000
027200****************************************************************  02720000
027300 01  PV-MQ-PROGRAM-VARIABLES.                                     02730000
027400     05  PV-QM-NAME              PIC X(48).                       02740000
027500     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02750000
027600     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                02760000
027700     05  PV-HANDLE               PIC S9(9) BINARY VALUE 0.        02770000
027800     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                02780000
027900     05  PV-REASON               PIC S9(9) BINARY.                02790000
028000     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          02800000
028100     05  PV-CON-REASON           PIC S9(9) BINARY.                02810000
028200     05  PV-MSG-LENGTH           PIC S9(9) BINARY.                02820000
028300     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02830000
028400     05  PV-REASON-TEXT          PIC X(30) VALUE SPACES.          02840000
028500     05  PV-ACTION               PIC X(60)        VALUE SPACES.   02850000
028600     05  PV-INTRGTN-TYP-CDE      PIC X(10) VALUE SPACES.          02860000
028700     05  PV-APPL-FUNC-DESCE      PIC X(10) VALUE SPACES.          02870000
028800***************************************************************** 02880000
028900*    PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         02890000
029000***************************************************************** 02900000
029100 01  PV-Q-MANAGER-VARIABLES.                                      02910000
029200     05  PV-QMGR-NAME                 PIC X(48).                  02920000
029300     05  PV-QUE-NAME                  PIC X(48).                  02930000
029400     05  PV-HANDLE-XXX           PIC S9(9) BINARY VALUE 0.        02940000
029500     05  PV-QMGR-NAME-PUTAWY          PIC X(48).                  02950000
029600     05  PV-QUE-NAME-PUTAWY           PIC X(48).                  02960000
029700     05  PV-HANDLE-PUTAWY        PIC S9(9) BINARY VALUE 0.        02970000
029800     05  PV-QMGR-NAME-ERROR           PIC X(48).                  02980000
029900     05  PV-QUE-NAME-ERROR            PIC X(48).                  02990000
030000     05  PV-HANDLE-ERROR         PIC S9(9) BINARY VALUE 0.        03000000
030100 01  DK-DATA-KEYS.                                                03010000
030200     05  DK-TRIP-ID                   PIC  S9(09) COMP VALUE +0.  03020000
030300     05  DK-EXT-SHP-ID                PIC  X(20)  VALUE SPACE.    03030000
030400     05  DK-CRE-TMST                  PIC  X(26)  VALUE SPACE.    03040000
030500     05  DK-OPER-UNT-ID               PIC  S9(9) COMP.            03050000
030600     05  DK-PO-NBR                    PIC  S9(9) COMP.            03060000
030700     05  DK-REC-SEQ-NBR               PIC  S9(9) COMP.            03070000
030800     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    03080000
030900     05  DK-TYP-CDE                   PIC S9(04) COMP VALUE +0.   03090000
030910 01  PV-CASE                          PIC  X(1)   VALUE SPACE.    03091000
030920                                                                  03092000
030921***************************************************************** 03092100
030922*    DB2 FORMATTED MESSAGE AREA                                   03092200
030923***************************************************************** 03092300
030924     COPY DPWS004.                                                03092400
030925     COPY ISWS007.                                                03092500
030926     COPY ISWS008.                                                03092600
030927     COPY ISWS009.                                                03092700
030928     COPY ISWS012.                                                03092800
030929                                                                  03092900
030930******************************************************************03093000
030940*  DB2 TABLE DECLARATION - WST_SHPMT_XREF_DTL                     03094000
030950******************************************************************03095000
030960     EXEC SQL                                                     03096000
030970          INCLUDE WST00002                                        03097000
030980     END-EXEC.                                                    03098000
030990                                                                  03099000
031000***************************************************************** 03100000
031100*    DB2 VIEW DECLARATION - WSV_PRVDR_QUE                         03110000
031200***************************************************************** 03120000
031300     EXEC SQL                                                     03130000
031400          INCLUDE WSV00005                                        03140000
031500     END-EXEC.                                                    03150000
031600                                                                  03160000
031700******************************************************************03170000
031800*  DB2 TABLE DECLARATION - WST_SHPMT_XREF_HDR                     03180000
031900******************************************************************03190000
032000     EXEC SQL                                                     03200000
032100          INCLUDE WST00001                                        03210000
032200     END-EXEC.                                                    03220000
032300                                                                  03230000
032400******************************************************************03240000
032500*  DB2 TABLE DECLARATION -  ST_ASN_DWNLD                          03250002
032600******************************************************************03260000
032700     EXEC SQL                                                     03270000
032800          INCLUDE WST00011                                        03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100******************************************************************03310000
033200*  DB2 TABLE DECLARATION - WST_DAT_CNTL                           03320000
033300******************************************************************03330000
033400     EXEC SQL                                                     03340000
033500          INCLUDE WST00003                                        03350000
033600     END-EXEC.                                                    03360000
033700                                                                  03370000
033800******************************************************************03380000
033900*  DB2 TABLE DECLARATION - WST_INTGRTN_TYP                        03390000
034000******************************************************************03400000
034100     EXEC SQL                                                     03410000
034200          INCLUDE WST00008                                        03420000
034300     END-EXEC.                                                    03430000
034400                                                                  03440000
034500******************************************************************03450000
034600*  DB2 TABLE DECLARATION - WST_ATTR_DEFN                          03460000
034700******************************************************************03470000
034800     EXEC SQL                                                     03480000
034900          INCLUDE WST00009                                        03490000
035000     END-EXEC.                                                    03500000
035100                                                                  03510000
035200******************************************************************03520000
035300*  DB2 TABLE DECLARATION - WST_ATTR_ELEM                          03530000
035400******************************************************************03540000
035500     EXEC SQL                                                     03550000
035600          INCLUDE WST00010                                        03560000
035700     END-EXEC.                                                    03570000
035800                                                                  03580000
035900******************************************************************03590000
036000*  PARAMATER TABLE                                                03600000
036100******************************************************************03610000
036200     EXEC SQL                                                     03620000
036300          INCLUDE TKRPRPM                                         03630000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600******************************************************************03660000
036700*    DB2 AREA FOR RECEIVER TABLE                                * 03670000
036800******************************************************************03680000
036900     EXEC SQL                                                     03690000
037000          INCLUDE TRECEIV                                         03700000
037100     END-EXEC.                                                    03710000
037200                                                                  03720000
037300******************************************************************03730000
037400*    DB2 AREA FOR SHIPMENT TABLE                                * 03740000
037500******************************************************************03750000
037600     EXEC SQL                                                     03760000
037700          INCLUDE TSHIPMT                                         03770000
037800     END-EXEC.                                                    03780000
037900                                                                  03790000
038000******************************************************************03800000
038100*    DB2 AREA FOR SHIPMENT PO TABLE                             * 03810000
038200******************************************************************03820000
038300     EXEC SQL                                                     03830000
038400          INCLUDE TSHPTPO                                         03840000
038500     END-EXEC.                                                    03850000
038600                                                                  03860000
038700******************************************************************03870000
038800*    DB2 AREA FOR TTRBNTF - TROUBLE NOTIFICATION TABLE          * 03880000
038900******************************************************************03890000
039000     EXEC SQL                                                     03900000
039100         INCLUDE TTRBNTF                                          03910000
039200     END-EXEC.                                                    03920000
039300                                                                  03930000
039400******************************************************************03940000
039500*    DB2 AREA FOR TTRBRSN - TROUBLE REASON CODE TABLE           * 03950000
039600******************************************************************03960000
039700     EXEC SQL                                                     03970000
039800         INCLUDE TTRBRSN                                          03980000
039900     END-EXEC.                                                    03990000
040000                                                                  04000000
040100******************************************************************04010000
040200*    DB2 AREA FOR TTRBRCN - TROUBLE REPORTING CONTROL TABLE     * 04020000
040300******************************************************************04030000
040400     EXEC SQL                                                     04040000
040500         INCLUDE TTRBRCN                                          04050000
040600     END-EXEC.                                                    04060000
040700                                                                  04070000
040800******************************************************************04080000
040900*    DB2 AREA FOR SUT_OTBND_CART - OUTBOUND CARTON TABLE        * 04090000
041000******************************************************************04100000
041100     EXEC SQL                                                     04110000
041200         INCLUDE SUT00024                                         04120000
041300     END-EXEC.                                                    04130000
041400                                                                  04140000
041500******************************************************************04150000
041600*    DB2 AREA FOR TPURCHS  PO TABLE                             * 04160000
041700******************************************************************04170000
041800     EXEC SQL                                                     04180000
041900         INCLUDE TPURCHS                                          04190000
042000     END-EXEC.                                                    04200000
042100                                                                  04210000
042200******************************************************************04220000
042300*    DB2 AREA FOR TPOAGMT  PO TABLE                             * 04230000
042400******************************************************************04240000
042500     EXEC SQL                                                     04250000
042600         INCLUDE TPOAGMT                                          04260000
042700     END-EXEC.                                                    04270000
042800                                                                  04280000
042900******************************************************************04290000
043000*    DB2 AREA FOR PO ITEM TABLE                                  *04300000
043100******************************************************************04310000
043200     EXEC SQL                                                     04320000
043210         INCLUDE TPURITM                                          04321000
043220     END-EXEC.                                                    04322000
043230                                                                  04323000
043240******************************************************************04324000
043250*    DB2 AREA FOR RECEIVER ITEM TABLE                            *04325000
043260******************************************************************04326000
043270     EXEC SQL                                                     04327000
043280         INCLUDE TRECITM                                          04328000
043290     END-EXEC.                                                    04329000
043300                                                                  04330000
043301******************************************************************04330100
043302*    DB2 AREA FOR XLT_SKU TABLE                                  *04330200
043303******************************************************************04330300
043304     EXEC SQL                                                     04330400
043305         INCLUDE XLT00003                                         04330500
043306     END-EXEC.                                                    04330600
043307                                                                  04330700
043308******************************************************************04330800
043309*    DB2 AREA FOR XLT_VND_STYL TABLE                             *04330900
043310******************************************************************04331000
043311     EXEC SQL                                                     04331100
043312         INCLUDE XLT00004                                         04331200
043313     END-EXEC.                                                    04331300
043314                                                                  04331400
043315******************************************************************04331500
043316*    DB2 AREA FOR TSHUUPC TABLE                             *     04331600
043317******************************************************************04331700
043318     EXEC SQL                                                     04331800
043319         INCLUDE TSHUUPC                                          04331900
043320     END-EXEC.                                                    04332000
043321                                                                  04332100
043322******************************************************************04332200
043323*    DB2 AREA FOR SUT_OTBND_UPC TABLE                       *     04332300
043324******************************************************************04332400
043325     EXEC SQL                                                     04332500
043326         INCLUDE SUT00028                                         04332600
043327     END-EXEC.                                                    04332700
043328                                                                  04332800
043329******************************************************************04332900
043330*    DB2 AREA FOR TPOINST (PO INSTRUCTIONS)                 *     04333000
043331******************************************************************04333100
043332     EXEC SQL                                                     04333200
043333         INCLUDE TPOINST                                          04333300
043334     END-EXEC.                                                    04333400
043335                                                                  04333500
043336******************************************************************04333600
043337*    DB2 AREA FOR TINSTCD (INSTRUCTION CODES)               *     04333700
043338******************************************************************04333800
043339     EXEC SQL                                                     04333900
043340         INCLUDE TINSTCD                                          04334000
043341     END-EXEC.                                                    04334100
043342                                                                  04334200
043343******************************************************************04334300
043344*    STORAGE AREA TO RETREIVE XML LENGTHS FROM DB2                04334400
043345******************************************************************04334500
043346 01  WMLENGTH.                                                    04334600
043347     05 WMLENGTH-MAX-XML-LENGTH       PIC   X(10).                04334700
043348     05 WMLENGTH-CASE-HDR-LENGTH      PIC   X(10).                04334800
043349     05 WMLENGTH-CASE-DTL-LENGTH      PIC   X(10).                04334900
043350     05 WMLENGTH-ASN-DTL-LENGTH       PIC   X(10).                04335000
043360     05 WMLENGTH-ASN-HEADER-LENGTH    PIC   X(10).                04336000
043370     05 WMLENGTH-APPT-LENGTH          PIC   X(10).                04337000
043380                                                                  04338000
043390***************************************************************** 04339000
043400*    DB2 AREA FOR COMMUNICATIONS                                  04340000
043500***************************************************************** 04350000
043600     EXEC SQL                                                     04360000
043700          INCLUDE SQLCA                                           04370000
043800     END-EXEC.                                                    04380000
043900                                                                  04390000
044000***************************************************************** 04400000
044100*    DECLARE CURSOR FOR TEMP  ST_ASN_DWNLD TABLE                * 04410002
044200***************************************************************** 04420000
044300     EXEC SQL                                                     04430000
044400        DECLARE ASN-CSR CURSOR FOR                                04440000
044500         SELECT EXT_SHP_ID                                        04450000
044600               ,CRE_TMST                                          04460000
044700               ,ROW_NBR                                           04470000
044800               ,REC_TYP_GP_NBR                                    04480000
044900               ,CASE                                              04490000
045000                   WHEN REC_TYP_CDE = 'CH' THEN '1'               04500000
045100                   WHEN REC_TYP_CDE = 'CD' THEN '2'               04510000
045200                   WHEN REC_TYP_CDE = 'AD' THEN '3'               04520000
045300                   WHEN REC_TYP_CDE = 'AH' THEN '4'               04530000
045400                   WHEN REC_TYP_CDE = 'AP' THEN '5'               04540000
045500                   ELSE '9'                                       04550000
045600                END                                               04560000
045700               ,REC_TYP_CDE                                       04570000
045800               ,CSE_DTL_NBR                                       04580000
045900               ,REC_TYP_DESC                                      04590000
046000          FROM  WST_ASN_DWNLD                                     04600000
046100         WHERE  EXT_SHP_ID      = :DK-EXT-SHP-ID                  04610000
046200           AND  CRE_TMST        = :DK-CRE-TMST                    04620000
046300         ORDER  BY EXT_SHP_ID                                     04630000
046400                  ,CRE_TMST                                       04640000
046500                  ,CSE_DTL_NBR     ASC                            04650000
046600                  ,REC_TYP_GP_NBR  DESC                           04660000
046700                  ,5               ASC                            04670000
046800                  ,REC_TYP_DESC    DESC                           04680000
046900                  ,ROW_NBR         DESC                           04690000
047000     END-EXEC.                                                    04700000
047100                                                                  04710000
047200****************************************************************  04720000
047300*    LINKAGE SECTION                                              04730000
047400****************************************************************  04740000
047500 LINKAGE SECTION.                                                 04750000
047600                                                                  04760000
047700 01  DFHCOMMAREA.                                                 04770000
047800     05  FILLER                       OCCURS  1 TO 4072 TIMES     04780000
047900                                      DEPENDING ON EIBCALEN.      04790000
048000         10 FILLER                    PIC X.                      04800000
048100                                                                  04810000
048200****************************************************************  04820000
048300*    PROCEDURE DIVISION                                           04830000
048400****************************************************************  04840000
048500 PROCEDURE DIVISION.                                              04850000
048600                                                                  04860000
048700 0000-PROGRAM-MAINLINE.                                           04870000
048800                                                                  04880000
048900     INITIALIZE            WS006-TRANS-COMMAREA.                  04890000
049000     MOVE DFHCOMMAREA   TO WS006-TRANS-COMMAREA.                  04900000
049100                                                                  04910000
049200     PERFORM 0100-INITIALIZE.                                     04920000
049300     PERFORM 1100-PROCESS-TABLE                                   04930000
049400                  UNTIL PS-TBL-IN-EOF.                            04940000
049500                                                                  04950000
049600     IF CH-SUB > 0                                                04960000
049700        PERFORM 3010-GENERATE-XML-CH                              04970000
049800     END-IF.                                                      04980000
049900                                                                  04990000
050000     IF AD-SUB > 0                                                05000000
050100        PERFORM 3070-GENERATE-XML-AD                              05010000
050200     END-IF.                                                      05020000
050300                                                                  05030000
050400     PERFORM 8990-EOJ-ROUTINE.                                    05040000
050500     PERFORM 8995-RETURN.                                         05050000
050600                                                                  05060000
050700****************************************************************  05070000
050800*   INITIALIZATIONS                                            *  05080000
050900****************************************************************  05090000
051000 0100-INITIALIZE.                                                 05100000
051100                                                                  05110000
051200     MOVE  0                 TO  PV-DISP-SQLCODE.                 05120000
051300                                                                  05130000
051400     INITIALIZE PV-CICS-MSG-AREA.                                 05140000
051500     STRING   ' ' WS006-SRC-TASK-NUMBER                           05150000
051600              ' WSKCS302-STRT:'                                   05160000
051700              ' ' WS006-OPER-UNT-ID                               05170000
051800              ' ' WS006-EXT-SHP-ID (1:15)                         05180000
051900              ' ' WS006-USERID                                    05190000
052000              ' SQLCODE=' PV-DISP-SQLCODE                         05200000
052100              ' WSKCS302 STARTED        '                         05210000
052200                DELIMITED BY SIZE                                 05220000
052300                  INTO PV-CICS-MSG-AREA.                          05230000
052400     PERFORM 9900-WRITE-TO-CICS-LOG.                              05240000
052500                                                                  05250000
052600     PERFORM 0500-CICS-LOGGING.                                   05260000
052700                                                                  05270000
052800     IF PS-CICS-SWITCH-YES                                        05280000
052900        INITIALIZE PV-CICS-MSG-AREA                               05290000
053000        STRING   ' ' WS006-SRC-TASK-NUMBER                        05300000
053100                 ' WSKCS302-0100:'                                05310000
053200                 ' ' WS006-OPER-UNT-ID                            05320000
053300                 ' ' WS006-EXT-SHP-ID (1:15)                      05330000
053400                 ' ' WS006-USERID                                 05340000
053500                 ' SQLCODE=' PV-DISP-SQLCODE                      05350000
053600                 ' 0100-INITIALIZE         '                      05360000
053700                   DELIMITED BY SIZE                              05370000
053800                      INTO PV-CICS-MSG-AREA                       05380000
053900        PERFORM 9900-WRITE-TO-CICS-LOG                            05390000
054000     END-IF.                                                      05400000
054100                                                                  05410000
054200     PERFORM 0600-CHK-MQPROCESS-ALL.                              05420000
054300                                                                  05430000
054400     PERFORM 0800-EFC-PROCESSING-PO-TYPE                          05440000
054500                                                                  05450000
054600     INITIALIZE ASN-DTL-COUNT                                     05460000
054700                AD-SUB                                            05470000
054800                CH-SUB                                            05480000
054900                CD-SUB                                            05490000
055000                CH-count                                          05500000
055100                CD-count.                                         05510000
055200                                                                  05520000
055300     IF WS006-EXT-SHP-ID  = SPACES                                05530000
055400        MOVE '1000-INITIALIZE   ' TO WS006-SQL-ERROR-PARA         05540000
055500        MOVE +0000                TO SQLCODE                      05550000
055600        MOVE '1'                  TO WS006-SUCCESS-IND            05560000
055700        MOVE 'SHIPPING ID IS MISSING ' TO WS006-CRA-RET-MSG       05570000
055800           INITIALIZE PV-CICS-MSG-AREA                            05580000
055900           STRING   ' ' WS006-SRC-TASK-NUMBER                     05590000
056000                    ' WSKCS302-0100:'                             05600000
056100                    ' ' WS006-OPER-UNT-ID                         05610000
056200                    ' ' WS006-EXT-SHP-ID (1:15)                   05620000
056300                    ' ' WS006-USERID                              05630000
056400                    ' SQLCODE=' PV-DISP-SQLCODE                   05640000
056500                      DELIMITED BY SIZE                           05650000
056600                        INTO PV-CICS-MSG-AREA                     05660000
056700                 PERFORM 9900-WRITE-TO-CICS-LOG                   05670000
056800       PERFORM 8995-RETURN                                        05680000
056900     END-IF.                                                      05690000
057000                                                                  05700000
057100     IF WS006-DWNLD-TMST  = SPACES                                05710000
057200        MOVE '1000-INITIALIZE   ' TO WS006-SQL-ERROR-PARA         05720000
057300        MOVE +0000                TO SQLCODE                      05730000
057400        MOVE '1'                  TO WS006-SUCCESS-IND            05740000
057500        MOVE 'TIMESTAMP IS MISSING   ' TO WS006-CRA-RET-MSG       05750000
057600           INITIALIZE PV-CICS-MSG-AREA                            05760000
057700           STRING   ' ' WS006-SRC-TASK-NUMBER                     05770000
057800                    ' WSKCS302-0100:'                             05780000
057900                    ' ' WS006-OPER-UNT-ID                         05790000
058000                    ' ' WS006-EXT-SHP-ID (1:15)                   05800000
058100                    ' ' WS006-USERID                              05810000
058200                    ' SQLCODE=' PV-DISP-SQLCODE                   05820000
058300                      DELIMITED BY SIZE                           05830000
058400                        INTO PV-CICS-MSG-AREA                     05840000
058500                 PERFORM 9900-WRITE-TO-CICS-LOG                   05850000
058600       PERFORM 8995-RETURN                                        05860000
058700     END-IF.                                                      05870000
058800                                                                  05880000
058900     PERFORM 1150-GET-INPUT-QUEUE-INFO.                           05890000
059000     PERFORM 1200-MQSERIES-CONNECT.                               05900000
059100     PERFORM 1300-MQSERIES-OPEN.                                  05910000
059200                                                                  05920000
059300     MOVE WS006-EXT-SHP-ID       TO DK-EXT-SHP-ID.                05930000
059400     MOVE WS006-DWNLD-TMST       TO DK-CRE-TMST.                  05940000
059500                                                                  05950000
059600     PERFORM 8100-OPEN-FETCH-CURSOR.                              05960000
059700     MOVE WST00011-CSE-DTL-NBR TO CD-count                        05970000
059800                                  PV-LAST-CSE-DTL-NBR.            05980000
059900     PERFORM 7700-RETEIVE-XML-LENGTHS.                            05990000
060000     PERFORM 2200-CALCULATE-MAX-CASE.                             06000000
060100                                                                  06010000
060200****************************************************************  06020000
060300*   CICS LOGGING                                               *  06030000
060400****************************************************************  06040000
060500                                                                  06050000
060600 0500-CICS-LOGGING.                                               06060000
060700     EXEC SQL                                                     06070000
060800         SELECT D.ATTR_ELEM_TXT                                   06080000
060900         INTO  :PS-CICS-SWITCH-IND                                06090000
061000         FROM   WST_INTGRTN_TYP A                                 06100000
061100              , WST_ATTR_DEFN   B                                 06110000
061200              , WST_ATTR_ELEM   C                                 06120000
061300              , WST_ATTR_ELEM   D                                 06130000
061400         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   06140000
061500           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           06150000
061600           AND  B.ATTR_DEFN_SEQ_NBR = 1                           06160000
061700           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           06170000
061800           AND  C.ATTR_DEFN_SEQ_NBR = 1                           06180000
061900           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           06190000
062000           AND  D.ATTR_DEFN_SEQ_NBR = 2                           06200000
062100           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         06210000
062200           AND  C.ATTR_ELEM_TXT     = 'WSKCS302'                  06220000
062300     END-EXEC.                                                    06230000
062400                                                                  06240000
062500     EVALUATE TRUE                                                06250000
062600         WHEN SQLCODE = ZERO                                      06260000
062700         WHEN SQLCODE = -904                                      06270000
062800         WHEN SQLCODE = -913                                      06280000
062900         WHEN SQLCODE = -911                                      06290000
063000         WHEN SQLCODE = -803                                      06300000
063100             IF PS-CICS-SWITCH-YES                                06310000
063200                 MOVE SQLCODE    TO PV-DISP-SQLCODE               06320000
063300                 INITIALIZE PV-CICS-MSG-AREA                      06330000
063400                 STRING   ' ' WS006-SRC-TASK-NUMBER               06340000
063500                          ' WSKCS302-0500:'                       06350000
063600                          ' ' WS006-OPER-UNT-ID                   06360000
063700                          ' ' WS006-EXT-SHP-ID (1:15)             06370000
063800                          ' ' WS006-USERID                        06380000
063900                          ' SQLCODE=' PV-DISP-SQLCODE             06390000
064000                          ' CICS LOGGING TURNED ON  '             06400000
064100                          DELIMITED BY SIZE                       06410000
064200                          INTO PV-CICS-MSG-AREA                   06420000
064300                 PERFORM 9900-WRITE-TO-CICS-LOG                   06430000
064400             END-IF                                               06440000
064500         WHEN SQLWARN0 NOT = SPACES                               06450000
064600         WHEN SQLCODE NOT = ZERO                                  06460000
064700             MOVE '2'                 TO WS006-SUCCESS-IND        06470000
064800             MOVE SQLCODE             TO PV-DISP-SQLCODE          06480000
064900                                         WS006-SQLCODE            06490000
065000             MOVE '0500-CICS-LOGGING'                             06500000
065100                                      TO WS006-SQL-ERROR-PARA     06510000
065200                 INITIALIZE PV-CICS-MSG-AREA                      06520000
065300                 MOVE SQLCODE         TO PV-DISP-SQLCODE          06530000
065400                 STRING   ' ' WS006-SRC-TASK-NUMBER               06540000
065500                          ' WSKCS302-0500:'                       06550000
065600                          ' ' WS006-OPER-UNT-ID                   06560000
065700                          ' ' WS006-EXT-SHP-ID (1:15)             06570000
065800                          ' ' WS006-USERID                        06580000
065900                          ' SQLCODE=' PV-DISP-SQLCODE             06590000
066000                          DELIMITED BY SIZE                       06600000
066100                          INTO PV-CICS-MSG-AREA                   06610000
066200             PERFORM 9900-WRITE-TO-CICS-LOG                       06620000
066300           PERFORM 8995-RETURN                                    06630000
066400     END-EVALUATE.                                                06640000
066500                                                                  06650000
066600     IF PS-CICS-SWITCH-YES                                        06660000
066700        INITIALIZE PV-CICS-MSG-AREA                               06670000
066800        STRING   ' ' WS006-SRC-TASK-NUMBER                        06680000
066900                 ' WSKCS302-0500:'                                06690000
067000                 ' ' WS006-OPER-UNT-ID                            06700000
067100                 ' ' WS006-EXT-SHP-ID (1:15)                      06710000
067200                 ' ' WS006-USERID                                 06720000
067300                 ' SQLCODE=' PV-DISP-SQLCODE                      06730000
067400                 ' 0500-CICS-LOGGING       '                      06740000
067500                   DELIMITED BY SIZE                              06750000
067600                      INTO PV-CICS-MSG-AREA                       06760000
067700        PERFORM 9900-WRITE-TO-CICS-LOG                            06770000
067800     END-IF.                                                      06780000
067900                                                                  06790000
068000****************************************************************  06800000
068100*   CHECK MQ PROCESSING FOR ALL USERS                             06810000
068200****************************************************************  06820000
068300 0600-CHK-MQPROCESS-ALL.                                          06830000
068400                                                                  06840000
068500     IF PS-CICS-SWITCH-YES                                        06850000
068600        INITIALIZE PV-CICS-MSG-AREA                               06860000
068700        STRING   ' ' WS006-SRC-TASK-NUMBER                        06870000
068800                 ' WSKCS302-0600:'                                06880000
068900                 ' ' WS006-OPER-UNT-ID                            06890000
069000                 ' ' WS006-EXT-SHP-ID (1:15)                      06900000
069100                 ' ' WS006-USERID                                 06910000
069200                 ' SQLCODE=' PV-DISP-SQLCODE                      06920000
069300                 ' 0600-CHK-MQPROCESS-ALL  '                      06930000
069400                   DELIMITED BY SIZE                              06940000
069500                      INTO PV-CICS-MSG-AREA                       06950000
069600        PERFORM 9900-WRITE-TO-CICS-LOG                            06960000
069700     END-IF.                                                      06970000
069800                                                                  06980000
069900     EXEC SQL                                                     06990000
070000         SELECT  C.ATTR_ELEM_TXT                                  07000000
070100           INTO :PV-USERID                                        07010000
070200           FROM  WST_INTGRTN_TYP  A                               07020000
070300                ,WST_ATTR_DEFN    B                               07030000
070400                ,WST_ATTR_ELEM    C                               07040000
070500           WHERE A.INTGRTN_TYP_CDE    =  'ASNTOQUE'               07050000
070600             AND C.ATTR_ELEM_TXT      =  'ALL'                    07060000
070700             AND A.INTGRTN_TYP_CDE    =   B.INTGRTN_TYP_CDE       07070000
070800             AND B.ATTR_DEFN_SEQ_NBR  =   1                       07080000
070900             AND B.INTGRTN_TYP_CDE    =   C.INTGRTN_TYP_CDE       07090000
071000             AND C.ATTR_DEFN_SEQ_NBR  =   1                       07100000
071100     END-EXEC.                                                    07110000
071200                                                                  07120000
071300     EVALUATE TRUE                                                07130000
071400       WHEN SQLCODE = ZERO                                        07140000
071500            SET PS-WRITE-MQ-NO TO TRUE                            07150000
071600               INITIALIZE PV-CICS-MSG-AREA                        07160000
071700               MOVE SQLCODE      TO PV-DISP-SQLCODE               07170000
071800               STRING   ' ' WS006-SRC-TASK-NUMBER                 07180000
071900                        ' WSKCS302-0600:'                         07190000
072000                        ' ' WS006-OPER-UNT-ID                     07200000
072100                        ' ' WS006-EXT-SHP-ID (1:15)               07210000
072200                        ' ' WS006-USERID                          07220000
072300                        ' SQLCODE=' PV-DISP-SQLCODE               07230000
072400                          ' MQPUTS ARE OFF FOR ALL '              07240000
072500                        DELIMITED BY SIZE                         07250000
072600                        INTO PV-CICS-MSG-AREA                     07260000
072700              PERFORM 9900-WRITE-TO-CICS-LOG                      07270000
072800       WHEN SQLCODE = +100                                        07280000
072900            PERFORM 0700-CHK-MQPROCESS-USER                       07290000
073000       WHEN SQLCODE NOT EQUAL ZERO                                07300000
073100            MOVE '0600-CHK-MQPROCESS-ALL' TO                      07310000
073200                                          WS006-SQL-ERROR-PARA    07320000
073300            MOVE '2'                   TO WS006-SUCCESS-IND       07330000
073400            MOVE SQLCODE               TO WS006-SQLCODE           07340000
073500               INITIALIZE PV-CICS-MSG-AREA                        07350000
073600               MOVE SQLCODE      TO PV-DISP-SQLCODE               07360000
073700               STRING   ' ' WS006-SRC-TASK-NUMBER                 07370000
073800                        ' WSKCS302-0600:'                         07380000
073900                        ' ' WS006-OPER-UNT-ID                     07390000
074000                        ' ' WS006-EXT-SHP-ID (1:15)               07400000
074100                        ' ' WS006-USERID                          07410000
074200                        ' SQLCODE=' PV-DISP-SQLCODE               07420000
074300                        DELIMITED BY SIZE                         07430000
074400                        INTO PV-CICS-MSG-AREA                     07440000
074500              PERFORM 9900-WRITE-TO-CICS-LOG                      07450000
074600            PERFORM 8995-RETURN                                   07460000
074700     END-EVALUATE.                                                07470000
074800                                                                  07480000
074900****************************************************************  07490000
075000*   CHECK MQ PROCESSING BY USER                                   07500000
075100****************************************************************  07510000
075200 0700-CHK-MQPROCESS-USER.                                         07520000
075300                                                                  07530000
075400     IF PS-CICS-SWITCH-YES                                        07540000
075500        INITIALIZE PV-CICS-MSG-AREA                               07550000
075600        STRING   ' ' WS006-SRC-TASK-NUMBER                        07560000
075700                 ' WSKCS302-0700:'                                07570000
075800                 ' ' WS006-OPER-UNT-ID                            07580000
075900                 ' ' WS006-EXT-SHP-ID (1:15)                      07590000
076000                 ' ' WS006-USERID                                 07600000
076100                 ' SQLCODE=' PV-DISP-SQLCODE                      07610000
076200                 ' 0700-CHK-MQPROCESS-USER '                      07620000
076300                   DELIMITED BY SIZE                              07630000
076400                      INTO PV-CICS-MSG-AREA                       07640000
076500        PERFORM 9900-WRITE-TO-CICS-LOG                            07650000
076600     END-IF.                                                      07660000
076700                                                                  07670000
076800     EXEC SQL                                                     07680000
076900         SELECT  C.ATTR_ELEM_TXT                                  07690000
077000           INTO :PV-USERID                                        07700000
077100           FROM  WST_INTGRTN_TYP  A                               07710000
077200                ,WST_ATTR_DEFN    B                               07720000
077300                ,WST_ATTR_ELEM    C                               07730000
077400           WHERE A.INTGRTN_TYP_CDE    =  'ASNTOQUE'               07740000
077500             AND C.ATTR_ELEM_TXT      =  :WS006-USERID            07750000
077600             AND A.INTGRTN_TYP_CDE    =   B.INTGRTN_TYP_CDE       07760000
077700             AND B.ATTR_DEFN_SEQ_NBR  =   1                       07770000
077800             AND B.INTGRTN_TYP_CDE    =   C.INTGRTN_TYP_CDE       07780000
077900             AND C.ATTR_DEFN_SEQ_NBR  =   1                       07790000
078000     END-EXEC.                                                    07800000
078100                                                                  07810000
078200     EVALUATE TRUE                                                07820000
078300       WHEN SQLCODE = ZERO                                        07830000
078400            SET PS-WRITE-MQ-NO TO TRUE                            07840000
078500               INITIALIZE PV-CICS-MSG-AREA                        07850000
078600               MOVE SQLCODE      TO PV-DISP-SQLCODE               07860000
078700               STRING   ' ' WS006-SRC-TASK-NUMBER                 07870000
078800                        ' WSKCS302-0700:'                         07880000
078900                        ' ' WS006-OPER-UNT-ID                     07890000
079000                        ' ' WS006-EXT-SHP-ID (1:15)               07900000
079100                        ' ' WS006-USERID                          07910000
079200                        ' SQLCODE=' PV-DISP-SQLCODE               07920000
079300                          ' MQPUTS ARE OFF FOR '                  07930000
079400                            PV-USERID                             07940000
079500                        DELIMITED BY SIZE                         07950000
079600                        INTO PV-CICS-MSG-AREA                     07960000
079700              PERFORM 9900-WRITE-TO-CICS-LOG                      07970000
079800       WHEN SQLCODE = +100                                        07980000
079900            CONTINUE                                              07990000
080000       WHEN SQLCODE NOT EQUAL ZERO                                08000000
080100            MOVE '0700-CHK-MQPROCESS-USER' TO                     08010000
080200                                          WS006-SQL-ERROR-PARA    08020000
080300            MOVE '2'                   TO WS006-SUCCESS-IND       08030000
080400            MOVE SQLCODE               TO WS006-SQLCODE           08040000
080500               INITIALIZE PV-CICS-MSG-AREA                        08050000
080600               MOVE SQLCODE            TO PV-DISP-SQLCODE         08060000
080700               STRING   ' ' WS006-SRC-TASK-NUMBER                 08070000
080800                        ' WSKCS302-0700:'                         08080000
080900                        ' ' WS006-OPER-UNT-ID                     08090000
081000                        ' ' WS006-EXT-SHP-ID (1:15)               08100000
081100                        ' ' WS006-USERID                          08110000
081200                        ' SQLCODE=' PV-DISP-SQLCODE               08120000
081300                        DELIMITED BY SIZE                         08130000
081400                        INTO PV-CICS-MSG-AREA                     08140000
081500              PERFORM 9900-WRITE-TO-CICS-LOG                      08150000
081600            PERFORM 8995-RETURN                                   08160000
081700     END-EVALUATE.                                                08170000
081800                                                                  08180000
081900****************************************************************  08190000
082000*   CICS LOGGING                                               *  08200000
082100****************************************************************  08210000
082200                                                                  08220000
082300 0800-EFC-PROCESSING-PO-TYPE.                                     08230000
082400                                                                  08240000
082500     MOVE 'N'                TO PV-ELEMENT-SEND.                  08250000
082600     MOVE WS006-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   08260000
082700                                                                  08270000
082710     EXEC SQL                                                     08271000
082720       SELECT D.ATTR_ELEM_TXT                                     08272000
082730          INTO :PV-ELEMENT-SEND                                   08273000
082740       FROM  WST_INTGRTN_TYP  A                                   08274000
082750            ,WST_ATTR_DEFN    B                                   08275000
082751            ,WST_ATTR_ELEM    C                                   08275100
082752            ,WST_ATTR_ELEM    D                                   08275200
082753            ,WST_ATTR_ELEM    E                                   08275300
082754            ,WST_ATTR_ELEM    F                                   08275400
082755       WHERE A.INTGRTN_TYP_CDE   = 'EFCPOTYPE'                    08275500
082756         AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE              08275600
082757         AND B.ATTR_DEFN_SEQ_NBR = 1                              08275700
082758         AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE              08275800
082759         AND C.ATTR_DEFN_SEQ_NBR = 1                              08275900
082760         AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE              08276000
082761         AND D.ATTR_DEFN_SEQ_NBR = 2                              08276100
082762         AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE              08276200
082763         AND E.ATTR_DEFN_SEQ_NBR = 3                              08276300
082764         AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE              08276400
082765         AND F.ATTR_DEFN_SEQ_NBR = 4                              08276500
082766         AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR            08276600
082767         AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR            08276700
082768         AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR            08276800
082769         AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID                08276900
082770         AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP              08277000
082771         AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP              08277100
082772     END-EXEC.                                                    08277200
082773                                                                  08277300
082774     EVALUATE TRUE                                                08277400
082775         WHEN SQLCODE = ZERO                                      08277500
082776              CONTINUE                                            08277600
082777         WHEN SQLCODE = +100                                      08277700
082778              MOVE 'N'   TO PV-ELEMENT-SEND                       08277800
082779         WHEN SQLCODE = -904                                      08277900
082780         WHEN SQLCODE = -913                                      08278000
082790         WHEN SQLCODE = -911                                      08279000
082800         WHEN SQLCODE = -803                                      08280000
082801             IF PS-CICS-SWITCH-YES                                08280100
082802                 MOVE SQLCODE    TO PV-DISP-SQLCODE               08280200
082803                 INITIALIZE PV-CICS-MSG-AREA                      08280300
082804                 STRING   ' ' WS006-SRC-TASK-NUMBER               08280400
082805                          ' WSKCS302-0800:'                       08280500
082806                          ' ' WS006-OPER-UNT-ID                   08280600
082807                          ' ' WS006-EXT-SHP-ID (1:15)             08280700
082808                          ' ' WS006-USERID                        08280800
082809                          ' SQLCODE=' PV-DISP-SQLCODE             08280900
082810                          ' CICS LOGGING TURNED ON  '             08281000
082811                          DELIMITED BY SIZE                       08281100
082812                          INTO PV-CICS-MSG-AREA                   08281200
082813                 PERFORM 9900-WRITE-TO-CICS-LOG                   08281300
082814             END-IF                                               08281400
082815         WHEN SQLWARN0 NOT = SPACES                               08281500
082816         WHEN SQLCODE NOT = ZERO                                  08281600
082817             MOVE '2'                 TO WS006-SUCCESS-IND        08281700
082818             MOVE SQLCODE             TO PV-DISP-SQLCODE          08281800
082819                                         WS006-SQLCODE            08281900
082820             MOVE '0800-EFC-PROCESSING'                           08282000
082821                                      TO WS006-SQL-ERROR-PARA     08282100
082822                 INITIALIZE PV-CICS-MSG-AREA                      08282200
082823                 MOVE SQLCODE         TO PV-DISP-SQLCODE          08282300
082824                 STRING   ' ' WS006-SRC-TASK-NUMBER               08282400
082825                          ' WSKCS302-0800:'                       08282500
082826                          ' ' WS006-OPER-UNT-ID                   08282600
082827                          ' ' WS006-EXT-SHP-ID (1:15)             08282700
082828                          ' ' WS006-USERID                        08282800
082829                          ' SQLCODE=' PV-DISP-SQLCODE             08282900
082830                          DELIMITED BY SIZE                       08283000
082831                          INTO PV-CICS-MSG-AREA                   08283100
082832             PERFORM 9900-WRITE-TO-CICS-LOG                       08283200
082833           PERFORM 8995-RETURN                                    08283300
082834     END-EVALUATE.                                                08283400
082835                                                                  08283500
082836     IF PS-CICS-SWITCH-YES                                        08283600
082837        INITIALIZE PV-CICS-MSG-AREA                               08283700
082838        STRING   ' ' WS006-SRC-TASK-NUMBER                        08283800
082839                 ' WSKCS302-0800:'                                08283900
082840                 ' ' WS006-OPER-UNT-ID                            08284000
082841                 ' ' WS006-EXT-SHP-ID (1:15)                      08284100
082842                 ' ' WS006-USERID                                 08284200
082843                 ' SQLCODE=' PV-DISP-SQLCODE                      08284300
082844                 ' 0800-CICS-LOGGING       '                      08284400
082845                   DELIMITED BY SIZE                              08284500
082846                      INTO PV-CICS-MSG-AREA                       08284600
082847        PERFORM 9900-WRITE-TO-CICS-LOG                            08284700
082848     END-IF.                                                      08284800
082849                                                                  08284900
082850****************************************************************  08285000
082851*   PROCESS THE TABLE                                             08285100
082852****************************************************************  08285200
082853 1100-PROCESS-TABLE.                                              08285300
082854                                                                  08285400
082855     IF PS-CICS-SWITCH-YES                                        08285500
082856        INITIALIZE PV-CICS-MSG-AREA                               08285600
082857        STRING   ' ' WS006-SRC-TASK-NUMBER                        08285700
082858                 ' WSKCS302-1100:'                                08285800
082859                 ' ' WS006-OPER-UNT-ID                            08285900
082860                 ' ' WS006-EXT-SHP-ID (1:15)                      08286000
082870                 ' ' WS006-USERID                                 08287000
082880                 ' SQLCODE=' PV-DISP-SQLCODE                      08288000
082890                 ' 1100-PROCESS-TABLE      '                      08289000
082900                   DELIMITED BY SIZE                              08290000
083000                      INTO PV-CICS-MSG-AREA                       08300000
083100        PERFORM 9900-WRITE-TO-CICS-LOG                            08310000
083200     END-IF.                                                      08320000
083300                                                                  08330000
083400     EVALUATE WST00011-REC-TYP-CDE                                08340000
083500         WHEN 'CH'                                                08350000
083600              PERFORM 3000-RECORD-TYPE-CH                         08360000
083700         WHEN 'CD'                                                08370000
083800              PERFORM 3020-RECORD-TYPE-CD                         08380000
083900         WHEN 'AH'                                                08390000
084000              PERFORM 3040-RECORD-TYPE-AH                         08400000
084100         WHEN 'AD'                                                08410000
084200              PERFORM 3060-RECORD-TYPE-AD                         08420000
084300         WHEN 'AP'                                                08430000
084400              PERFORM 3080-RECORD-TYPE-AP                         08440000
084500         WHEN OTHER                                               08450000
084600              MOVE '1100-PROCESS-TABLE' TO WS006-SQL-ERROR-PARA   08460000
084700              MOVE +9999                TO SQLCODE                08470000
084800              MOVE '1'                  TO WS006-SUCCESS-IND      08480000
084900                 INITIALIZE PV-CICS-MSG-AREA                      08490000
085000                 MOVE SQLCODE   TO PV-DISP-SQLCODE                08500000
085100                 STRING   ' ' WS006-SRC-TASK-NUMBER               08510000
085200                          ' WSKCS302-1100:'                       08520000
085300                          ' ' WS006-OPER-UNT-ID                   08530000
085400                          ' ' WS006-EXT-SHP-ID (1:15)             08540000
085500                          ' ' WS006-USERID                        08550000
085600                          ' SQLCODE=' PV-DISP-SQLCODE             08560000
085700                          DELIMITED BY SIZE                       08570000
085800                          INTO PV-CICS-MSG-AREA                   08580000
085900              PERFORM 9900-WRITE-TO-CICS-LOG                      08590000
086000            PERFORM 8995-RETURN                                   08600000
086100     END-EVALUATE.                                                08610000
086200                                                                  08620000
086300     PERFORM 8200-FETCH-CURSOR.                                   08630000
086400                                                                  08640000
086500***************************************************************** 08650000
086600 1150-GET-INPUT-QUEUE-INFO.                                       08660000
086700***************************************************************** 08670000
086800                                                                  08680000
086900*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       08690000
087000                                                                  08700000
087100     IF PS-CICS-SWITCH-YES                                        08710000
087200        INITIALIZE PV-CICS-MSG-AREA                               08720000
087300        STRING   ' ' WS006-SRC-TASK-NUMBER                        08730000
087400                 ' WSKCS302-1150:'                                08740000
087500                 ' ' WS006-OPER-UNT-ID                            08750000
087600                 ' ' WS006-EXT-SHP-ID (1:15)                      08760000
087700                 ' ' WS006-USERID                                 08770000
087800                 ' SQLCODE=' PV-DISP-SQLCODE                      08780000
087900                 ' 1150-GET-INPUT-QUEUE-INFO   '                  08790000
088000                   DELIMITED BY SIZE                              08800000
088100                      INTO PV-CICS-MSG-AREA                       08810000
088200        PERFORM 9900-WRITE-TO-CICS-LOG                            08820000
088300     END-IF.                                                      08830000
088400                                                                  08840000
088500       INITIALIZE DCLWSV00005.                                    08850000
088600       MOVE 'LEGCYINBDQ'      TO WSV00005-APPL-FUNC-DESC.         08860000
088700       MOVE 'ASNQ'            TO WSV00005-INTGRTN-TYP-CDE.        08870000
088800*clp 06/22/2017 - Added Move for DC and check for it in WHERE     08880000
088900       MOVE WS006-OPER-UNT-ID TO WSV00005-DC-NBR.                 08890000
089000                                                                  08900000
089100                                                                  08910000
089200       EXEC SQL                                                   08920000
089300           SELECT                                                 08930000
089400                 LCL_QUE_MGR                                      08940000
089500                ,RMT_QUE_MGR                                      08950000
089600                ,QUE_NM                                           08960000
089700           INTO                                                   08970000
089800                :WSV00005-LCL-QUE-MGR                             08980000
089900               ,:WSV00005-RMT-QUE-MGR                             08990000
090000               ,:WSV00005-QUE-NM                                  09000000
090100           FROM  WSV_PRVDR_QUE                                    09010000
090200          WHERE  APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC       09020000
090300            AND  INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE      09030000
090400            AND           DC_NBR = :WSV00005-DC-NBR               09040000
090500       END-EXEC                                                   09050000
090600                                                                  09060000
090700       EVALUATE TRUE                                              09070000
090800           WHEN SQLCODE = +0                                      09080000
090900               INITIALIZE PV-QMGR-NAME                            09090000
091000               MOVE WSV00005-LCL-QUE-MGR-TEXT  TO PV-QMGR-NAME    09100000
091100               INITIALIZE PV-QUE-NAME                             09110000
091200               MOVE WSV00005-QUE-NM-TEXT       TO PV-QUE-NAME     09120000
091300           WHEN SQLCODE = +100                                    09130000
091400           WHEN SQLWARN0 NOT = SPACES                             09140000
091500           WHEN SQLCODE  NOT = ZERO                               09150000
091600             MOVE '1150-GET-INPUT-QUEUE-INFO '                    09160000
091700                                       TO WS006-SQL-ERROR-PARA    09170000
091800             MOVE '2'                  TO WS006-SUCCESS-IND       09180000
091900                INITIALIZE PV-CICS-MSG-AREA                       09190000
092000                MOVE SQLCODE   TO PV-DISP-SQLCODE                 09200000
092100                STRING   ' ' WS006-SRC-TASK-NUMBER                09210000
092200                         ' WSKCS302-1150:'                        09220000
092300                         ' ' WS006-OPER-UNT-ID                    09230000
092400                         '-' WS006-EXT-SHP-ID (1:15)              09240000
092500                         '-' WS006-USERID                         09250000
092600                         ' SQLCODE=' PV-DISP-SQLCODE              09260000
092700                         DELIMITED BY SIZE                        09270000
092800                         INTO PV-CICS-MSG-AREA                    09280000
092900             PERFORM 9900-WRITE-TO-CICS-LOG                       09290000
093000           PERFORM 8995-RETURN                                    09300000
093100       END-EVALUATE.                                              09310000
093200                                                                  09320000
093300******************************************************************09330000
093400* CONNECT TO XXX QUEUE MANAGER.                                   09340000
093500******************************************************************09350000
093600 1200-MQSERIES-CONNECT.                                           09360000
093700                                                                  09370000
093800     MOVE '1200-MQSERIES-CONNECT '   TO PV-PARAGRAPH.             09380000
093900                                                                  09390000
094000     IF PS-CICS-SWITCH-YES                                        09400000
094100        INITIALIZE PV-CICS-MSG-AREA                               09410000
094200        STRING   ' ' WS006-SRC-TASK-NUMBER                        09420000
094300                 ' WSKCS302-1200:'                                09430000
094400                 ' ' WS006-OPER-UNT-ID                            09440000
094500                 ' ' WS006-EXT-SHP-ID (1:15)                      09450000
094600                 ' ' WS006-USERID                                 09460000
094700                 ' SQLCODE=' PV-DISP-SQLCODE                      09470000
094800                 ' 1200-MQSERIES-CONNECT   '                      09480000
094900                   DELIMITED BY SIZE                              09490000
095000                      INTO PV-CICS-MSG-AREA                       09500000
095100        PERFORM 9900-WRITE-TO-CICS-LOG                            09510000
095200     END-IF.                                                      09520000
095300                                                                  09530000
095400     CALL PC-MQCONN USING PV-QMGR-NAME                            09540000
095500                          PV-HCONN                                09550000
095600                          PV-COMPLETION-CODE                      09560000
095700                          PV-REASON.                              09570000
095800                                                                  09580000
095900                                                                  09590000
096000*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              09600000
096100*    AND EXIT                                                     09610000
096200                                                                  09620000
096300     MOVE PV-REASON TO PV-CON-REASON.                             09630000
096400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         09640000
096500         CONTINUE                                                 09650000
096600     ELSE                                                         09660000
096700             MOVE '1200-MQSERIES-CONNECT     '                    09670000
096800                                       TO WS006-SQL-ERROR-PARA    09680000
096900             MOVE '1'                  TO WS006-SUCCESS-IND       09690000
097000                INITIALIZE PV-CICS-MSG-AREA                       09700000
097100                STRING   ' ' WS006-SRC-TASK-NUMBER                09710000
097200                         ' WSKCS302-1200:'                        09720000
097300                         ' ' WS006-OPER-UNT-ID                    09730000
097400                         ' ' WS006-EXT-SHP-ID (1:15)              09740000
097500                         ' ' WS006-USERID                         09750000
097600                         ' SQLCODE=' PV-DISP-SQLCODE              09760000
097700                         DELIMITED BY SIZE                        09770000
097800                         INTO PV-CICS-MSG-AREA                    09780000
097900             PERFORM 9900-WRITE-TO-CICS-LOG                       09790000
098000                                                                  09800000
098100* dmh 11/28/17                                                    09810000
098200              move pv-completion-code to PV-DISP-mq-comp-code     09820000
098300              INITIALIZE PV-CICS-MSG-AREA                         09830000
098400              STRING   ' ' WS006-SRC-TASK-NUMBER                  09840000
098500                       ' WSKCS302-1200:'                          09850000
098600                       ' ' WS006-OPER-UNT-ID                      09860000
098700                       ' ' WS006-EXT-SHP-ID (1:15)                09870000
098800                       ' mq code:' PV-DISP-mq-comp-code           09880000
098900                       DELIMITED BY SIZE                          09890000
099000                       INTO PV-CICS-MSG-AREA                      09900000
099100             PERFORM 9900-WRITE-TO-CICS-LOG                       09910000
099200* dmh 11/28/17                                                    09920000
099300                                                                  09930000
099400             PERFORM 8995-RETURN                                  09940000
099500     END-IF.                                                      09950000
099600***************************************************************** 09960000
099700*** OPEN THE ITEM QUEUE FOR GETS (300 PIX TRANSACTIONS).          09970000
099800***************************************************************** 09980000
099900 1300-MQSERIES-OPEN.                                              09990000
100000                                                                  10000000
100100     MOVE '1300-MQSERIES-OPEN   '    TO PV-PARAGRAPH.             10010000
100200                                                                  10020000
100300     IF PS-CICS-SWITCH-YES                                        10030000
100400        INITIALIZE PV-CICS-MSG-AREA                               10040000
100500        STRING   ' ' WS006-SRC-TASK-NUMBER                        10050000
100600                 ' WSKCS302-1300:'                                10060000
100700                 ' ' WS006-OPER-UNT-ID                            10070000
100800                 ' ' WS006-EXT-SHP-ID (1:15)                      10080000
100900                 ' ' WS006-USERID                                 10090000
101000                 ' SQLCODE=' PV-DISP-SQLCODE                      10100000
101100                 ' 1300-MQSERIES-OPEN      '                      10110000
101200                   DELIMITED BY SIZE                              10120000
101300                      INTO PV-CICS-MSG-AREA                       10130000
101400        PERFORM 9900-WRITE-TO-CICS-LOG                            10140000
101500     END-IF.                                                      10150000
101600                                                                  10160000
101700                                                                  10170000
101800     INITIALIZE PV-QMGR-NAME.                                     10180000
101900     MOVE WSV00005-RMT-QUE-MGR-TEXT  TO PV-QMGR-NAME              10190000
102000                                                                  10200000
102100     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 10210000
102200                                    + MQOO-SET-IDENTITY-CONTEXT   10220000
102300                                    + MQOO-FAIL-IF-QUIESCING.     10230000
102400                                                                  10240000
102500                                                                  10250000
102600                                                                  10260000
102700     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            10270000
102800     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        10280000
102900     MOVE PV-QUE-NAME              TO MQOD-OBJECTNAME.            10290000
103000                                                                  10300000
103100     CALL PC-MQOPEN USING PV-HCONN                                10310000
103200                          MQM-OBJECT-DESCRIPTOR                   10320000
103300                          PV-OPEN-OPTIONS                         10330000
103400                          PV-HANDLE                               10340000
103500                          PV-COMPLETION-CODE                      10350000
103600                          PV-REASON.                              10360000
103700                                                                  10370000
103800                                                                  10380000
103900*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          10390000
104000                                                                  10400000
104100     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10410000
104200         CONTINUE                                                 10420000
104300     ELSE                                                         10430000
104400         MOVE '1300-MQSERIES-OPEN        '                        10440000
104500                                   TO WS006-SQL-ERROR-PARA        10450000
104600         MOVE '1'                  TO WS006-SUCCESS-IND           10460000
104700              INITIALIZE PV-CICS-MSG-AREA                         10470000
104800              STRING   ' ' WS006-SRC-TASK-NUMBER                  10480000
104900                       ' WSKCS302-1300:'                          10490000
105000                       ' ' WS006-OPER-UNT-ID                      10500000
105100                       ' ' WS006-EXT-SHP-ID (1:15)                10510000
105200                       ' ' WS006-USERID                           10520000
105300                       ' SQLCODE=' PV-DISP-SQLCODE                10530000
105400                       DELIMITED BY SIZE                          10540000
105500                       INTO PV-CICS-MSG-AREA                      10550000
105600             PERFORM 9900-WRITE-TO-CICS-LOG                       10560000
105700                                                                  10570000
105800* dmh 11/28/17                                                    10580000
105900              move pv-completion-code to PV-DISP-mq-comp-code     10590000
106000              INITIALIZE PV-CICS-MSG-AREA                         10600000
106100              STRING   ' ' WS006-SRC-TASK-NUMBER                  10610000
106200                       ' WSKCS302-1300:'                          10620000
106300                       ' ' WS006-OPER-UNT-ID                      10630000
106400                       ' ' WS006-EXT-SHP-ID (1:15)                10640000
106500                       ' mq code:' PV-DISP-mq-comp-code           10650000
106600                       DELIMITED BY SIZE                          10660000
106700                       INTO PV-CICS-MSG-AREA                      10670000
106800             PERFORM 9900-WRITE-TO-CICS-LOG                       10680000
106900* dmh 11/28/17                                                    10690000
107000                                                                  10700000
107100         PERFORM 8995-RETURN                                      10710000
107200      END-IF.                                                     10720000
107300                                                                  10730000
107400***************************************************************** 10740000
107500* PUT THE OUTGOING XML MQ MESSAGE ON QUEUE                        10750000
107600***************************************************************** 10760000
107700 1400-PUT-MQ-MESG-ON-QUEUE.                                       10770000
107800                                                                  10780000
107900     IF PS-CICS-SWITCH-YES                                        10790000
108000        INITIALIZE PV-CICS-MSG-AREA                               10800000
108100        STRING   ' ' WS006-SRC-TASK-NUMBER                        10810000
108200                 ' WSKCS302-1400:'                                10820000
108300                 ' ' WS006-OPER-UNT-ID                            10830000
108400                 ' ' WS006-EXT-SHP-ID (1:15)                      10840000
108500                 ' ' WS006-USERID                                 10850000
108600                 ' SQL=' PV-DISP-SQLCODE                          10860000
108700                 ' 1400-PUT-MQ-MESG-ON-QUEUE  '                   10870000
108800                   DELIMITED BY SIZE                              10880000
108900                      INTO PV-CICS-MSG-AREA                       10890000
109000        PERFORM 9900-WRITE-TO-CICS-LOG                            10900000
109100                                                                  10910000
109200        INITIALIZE PV-CICS-MSG-AREA                               10920000
109300        STRING  ' ' PV-QMGR-NAME                                  10930000
109400                ' ' PV-QUE-NAME                                   10940000
109500                   DELIMITED BY SIZE                              10950000
109600                      INTO PV-CICS-MSG-AREA                       10960000
109700        PERFORM 9900-WRITE-TO-CICS-LOG                            10970000
109800                                                                  10980000
109900     END-IF.                                                      10990000
110000                                                                  11000000
110100*SET OPTIONS.                                                     11010000
110200     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        11020000
110300     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   11030000
110400     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  11040000
110500                               MQPMO-SET-IDENTITY-CONTEXT.        11050000
110600                                                                  11060000
110700*THE MSG LENGTH FOR THE TRANSACTION IS XML-LENGTH                 11070000
110800     MOVE XML-LENGTH     TO PV-MSG-LENGTH.                        11080000
110900                                                                  11090000
111000*PUT MSG.                                                         11100000
111100     CALL PC-MQPUT USING PV-HCONN                                 11110000
111200                         PV-HANDLE                                11120000
111300                         MQM-MESSAGE-DESCRIPTOR                   11130000
111400                         MQM-PUT-MESSAGE-OPTIONS                  11140000
111500                         PV-MSG-LENGTH                            11150000
111600                         PV-XML (1:XML-LENGTH)                    11160000
111700                         PV-COMPLETION-CODE                       11170000
111800                         PV-REASON.                               11180000
111900                                                                  11190000
112000                                                                  11200000
112100*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         11210000
112200*AND BREAK OUT OF LOOP                                            11220000
112300     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        11230000
112400         MOVE '1400-PUT-MQ-MESG-ON-QUEUE '                        11240000
112500                                   TO WS006-SQL-ERROR-PARA        11250000
112600         MOVE '1'                  TO WS006-SUCCESS-IND           11260000
112700              INITIALIZE PV-CICS-MSG-AREA                         11270000
112800              STRING   ' ' WS006-SRC-TASK-NUMBER                  11280000
112900                       ' WSKCS302-1400:'                          11290000
113000                       ' ' WS006-OPER-UNT-ID                      11300000
113100                       ' ' WS006-EXT-SHP-ID (1:15)                11310000
113200                       ' ' WS006-USERID                           11320000
113300                       ' SQL=' PV-DISP-SQLCODE                    11330000
113400                       DELIMITED BY SIZE                          11340000
113500                       INTO PV-CICS-MSG-AREA                      11350000
113600             PERFORM 9900-WRITE-TO-CICS-LOG                       11360000
113700                                                                  11370000
113800* dmh 11/28/17                                                    11380000
113900              move pv-completion-code to PV-DISP-mq-comp-code     11390000
114000              INITIALIZE PV-CICS-MSG-AREA                         11400000
114100              STRING   ' ' WS006-SRC-TASK-NUMBER                  11410000
114200                       ' WSKCS302-1400:'                          11420000
114300                       ' ' WS006-OPER-UNT-ID                      11430000
114400                       ' ' WS006-EXT-SHP-ID (1:15)                11440000
114500                       ' mq code:' PV-DISP-mq-comp-code           11450000
114600                       DELIMITED BY SIZE                          11460000
114700                       INTO PV-CICS-MSG-AREA                      11470000
114800             PERFORM 9900-WRITE-TO-CICS-LOG                       11480000
114900* dmh 11/28/17                                                    11490000
115000                                                                  11500000
115100         PERFORM 8995-RETURN                                      11510000
115200     ELSE                                                         11520000
115300         ADD 1 TO PV-MQ-MESSAGES                                  11530000
115400     END-IF.                                                      11540000
115500                                                                  11550000
115600                                                                  11560000
115700***************************************************************** 11570000
115800* MQ SERIES CLOSE QUEUE FOR THE xxx TRANSACTIONS.                 11580000
115900***************************************************************** 11590000
116000 1500-MQ-CLOSE-QUEUE.                                             11600000
116100     MOVE '1500-MQ-CLOSE-QUEUE '     TO PV-PARAGRAPH.             11610000
116200                                                                  11620000
116300     IF PS-CICS-SWITCH-YES                                        11630000
116400        INITIALIZE PV-CICS-MSG-AREA                               11640000
116500        STRING   ' ' WS006-SRC-TASK-NUMBER                        11650000
116600                 ' WSKCS302-1500:'                                11660000
116700                 ' ' WS006-OPER-UNT-ID                            11670000
116800                 ' ' WS006-EXT-SHP-ID (1:15)                      11680000
116900                 ' ' WS006-USERID                                 11690000
117000                 ' SQLCODE=' PV-DISP-SQLCODE                      11700000
117100                 ' 1500-MQ-CLOSE-QUEUE     '                      11710000
117200                   DELIMITED BY SIZE                              11720000
117300                      INTO PV-CICS-MSG-AREA                       11730000
117400        PERFORM 9900-WRITE-TO-CICS-LOG                            11740000
117500     END-IF.                                                      11750000
117600                                                                  11760000
117700                                                                  11770000
117800     MOVE PV-QUE-NAME               TO MQOD-OBJECTNAME.           11780000
117900     MOVE PV-QMGR-NAME              TO MQOD-OBJECTQMGRNAME.       11790000
118000                                                                  11800000
118100     CALL PC-MQCLOSE USING PV-HCONN                               11810000
118200                           PV-HANDLE                              11820000
118300                           MQCO-NONE                              11830000
118400                           PV-COMPLETION-CODE                     11840000
118500                           PV-REASON.                             11850000
118600                                                                  11860000
118700*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                11870000
118800*    AND EXIT                                                     11880000
118900                                                                  11890000
119000     IF PV-COMPLETION-CODE = MQCC-OK THEN                         11900000
119100         CONTINUE                                                 11910000
119200     ELSE                                                         11920000
119300         MOVE '1500-MQ-CLOSE-QUEUE       '                        11930000
119400                                   TO WS006-SQL-ERROR-PARA        11940000
119500         MOVE '1'                  TO WS006-SUCCESS-IND           11950000
119600              INITIALIZE PV-CICS-MSG-AREA                         11960000
119700              STRING   ' ' WS006-SRC-TASK-NUMBER                  11970000
119800                       ' WSKCS302-1500:'                          11980000
119900                       ' ' WS006-OPER-UNT-ID                      11990000
120000                       ' ' WS006-EXT-SHP-ID (1:15)                12000000
120100                       ' ' WS006-USERID                           12010000
120200                       ' SQLCODE=' PV-DISP-SQLCODE                12020000
120300                       DELIMITED BY SIZE                          12030000
120400                       INTO PV-CICS-MSG-AREA                      12040000
120500             PERFORM 9900-WRITE-TO-CICS-LOG                       12050000
120600                                                                  12060000
120700* dmh 11/28/17                                                    12070000
120800              move pv-completion-code to PV-DISP-mq-comp-code     12080000
120900              INITIALIZE PV-CICS-MSG-AREA                         12090000
121000              STRING   ' ' WS006-SRC-TASK-NUMBER                  12100000
121100                       ' WSKCS302-1500:'                          12110000
121200                       ' ' WS006-OPER-UNT-ID                      12120000
121300                       ' ' WS006-EXT-SHP-ID (1:15)                12130000
121400                       ' mq code:' PV-DISP-mq-comp-code           12140000
121500                       DELIMITED BY SIZE                          12150000
121600                       INTO PV-CICS-MSG-AREA                      12160000
121700             PERFORM 9900-WRITE-TO-CICS-LOG                       12170000
121800* dmh 11/28/17                                                    12180000
121900                                                                  12190000
122000         PERFORM 8995-RETURN                                      12200000
122100     END-IF.                                                      12210000
122200                                                                  12220000
122300***************************************************************** 12230000
122400* DISCONNECT FROM QUEUE MANAGER.                                  12240000
122500***************************************************************** 12250000
122600 1800-MQ-DISCONNECT.                                              12260000
122700                                                                  12270000
122800     MOVE '1800-MQ-DISCONNECT'    TO PV-PARAGRAPH.                12280000
122900                                                                  12290000
123000     IF PS-CICS-SWITCH-YES                                        12300000
123100        INITIALIZE PV-CICS-MSG-AREA                               12310000
123200        STRING   ' ' WS006-SRC-TASK-NUMBER                        12320000
123300                 ' WSKCS302-1800:'                                12330000
123400                 ' ' WS006-OPER-UNT-ID                            12340000
123500                 ' ' WS006-EXT-SHP-ID (1:15)                      12350000
123600                 ' ' WS006-USERID                                 12360000
123700                 ' SQLCODE=' PV-DISP-SQLCODE                      12370000
123800                 ' 1800-MQ-DISCONNECT      '                      12380000
123900                   DELIMITED BY SIZE                              12390000
124000                      INTO PV-CICS-MSG-AREA                       12400000
124100        PERFORM 9900-WRITE-TO-CICS-LOG                            12410000
124200     END-IF.                                                      12420000
124300                                                                  12430000
124400     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                12440000
124500         CALL PC-MQDISC USING PV-HCONN                            12450000
124600                              PV-COMPLETION-CODE                  12460000
124700                              PV-REASON.                          12470000
124800                                                                  12480000
124900*    IF MQ DISCONNECT FAILED THEN DISPLAY ERROR MESSAGE           12490000
125000*    AND EXIT                                                     12500000
125100                                                                  12510000
125200     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12520000
125300         CONTINUE                                                 12530000
125400     ELSE                                                         12540000
125500         MOVE '1800-MQ-DISCONNECT        '                        12550000
125600                                   TO WS006-SQL-ERROR-PARA        12560000
125700         MOVE '1'                  TO WS006-SUCCESS-IND           12570000
125800              INITIALIZE PV-CICS-MSG-AREA                         12580000
125900              STRING   ' ' WS006-SRC-TASK-NUMBER                  12590000
126000                       ' WSKCS302-1800:'                          12600000
126100                       ' ' WS006-OPER-UNT-ID                      12610000
126200                       ' ' WS006-EXT-SHP-ID (1:15)                12620000
126300                       ' ' WS006-USERID                           12630000
126400                       ' SQLCODE=' PV-DISP-SQLCODE                12640000
126500                       DELIMITED BY SIZE                          12650000
126600                       INTO PV-CICS-MSG-AREA                      12660000
126700             PERFORM 9900-WRITE-TO-CICS-LOG                       12670000
126800                                                                  12680000
126900* dmh 11/28/17                                                    12690000
127000              move pv-completion-code to PV-DISP-mq-comp-code     12700000
127100              INITIALIZE PV-CICS-MSG-AREA                         12710000
127200              STRING   ' ' WS006-SRC-TASK-NUMBER                  12720000
127300                       ' WSKCS302-1800:'                          12730000
127400                       ' ' WS006-OPER-UNT-ID                      12740000
127500                       ' ' WS006-EXT-SHP-ID (1:15)                12750000
127600                       ' mq code:' PV-DISP-mq-comp-code           12760000
127700                       DELIMITED BY SIZE                          12770000
127800                       INTO PV-CICS-MSG-AREA                      12780000
127900             PERFORM 9900-WRITE-TO-CICS-LOG                       12790000
128000* dmh 11/28/17                                                    12800000
128100                                                                  12810000
128200         PERFORM 8995-RETURN                                      12820000
128300     END-IF.                                                      12830000
128400                                                                  12840000
128500****************************************************************  12850000
128600*   BUILD CASE HEADER INFO                                        12860000
128700****************************************************************  12870000
128800 2100-BUILD-CASEINFO-XML.                                         12880000
128900                                                                  12890000
129000     IF PS-CICS-SWITCH-YES                                        12900000
129100        INITIALIZE PV-CICS-MSG-AREA                               12910000
129200        STRING   ' ' WS006-SRC-TASK-NUMBER                        12920000
129300                 ' WSKCS302-2100:'                                12930000
129400                 ' ' WS006-OPER-UNT-ID                            12940000
129500                 ' ' WS006-EXT-SHP-ID (1:15)                      12950000
129600                 ' ' WS006-USERID                                 12960000
129700                 ' SQLCODE=' PV-DISP-SQLCODE                      12970000
129800                 ' 2100-BUILD-CASEINFO-XML '                      12980000
129900                   DELIMITED BY SIZE                              12990000
130000                      INTO PV-CICS-MSG-AREA                       13000000
130100        PERFORM 9900-WRITE-TO-CICS-LOG                            13010000
130200     END-IF.                                                      13020000
130300                                                                  13030000
130400     IF WST00011-EXT-SHP-ID        NOT = ShipmentNbr              13040000
130500        ADD 1                         TO PV-SHIP-CNT              13050000
130600     END-IF.                                                      13060000
130700                                                                  13070000
130800     MOVE WST00011-EXT-SHP-ID         TO ShipmentNbr              13080000
130900     MOVE WS006-CH-WHSE               TO ToLocation.              13090000
131000     MOVE WS006-CH-ORGN-TYPE          TO AsnType.                 13100000
131100     MOVE WS006-CH-HOST-INPT-ID       TO BatchCtlNbr.             13110000
131200                                                                  13120000
131300****************************************************************  13130000
131400*  CALCULATE MAX NUMBER OF CASES PER MESSAGE                      13140000
131500****************************************************************  13150000
131600 2200-CALCULATE-MAX-CASE.                                         13160000
131700                                                                  13170000
131800     IF PS-CICS-SWITCH-YES                                        13180000
131900        INITIALIZE PV-CICS-MSG-AREA                               13190000
132000        STRING   ' ' WS006-SRC-TASK-NUMBER                        13200000
132100                 ' WSKCS302-2200:'                                13210000
132200                 ' ' WS006-OPER-UNT-ID                            13220000
132300                 ' ' WS006-EXT-SHP-ID (1:15)                      13230000
132400                 ' ' WS006-USERID                                 13240000
132500                 ' SQLCODE=' PV-DISP-SQLCODE                      13250000
132600                 ' 2200-CALCULATE-MAX-CASE '                      13260000
132700                   DELIMITED BY SIZE                              13270000
132800                      INTO PV-CICS-MSG-AREA                       13280000
132900        PERFORM 9900-WRITE-TO-CICS-LOG                            13290000
133000     END-IF.                                                      13300000
133100                                                                  13310000
133200     MOVE WMLENGTH-CASE-HDR-LENGTH  TO PV-HDR-LENGTH.             13320000
133300     MOVE WMLENGTH-CASE-DTL-LENGTH  TO PV-DTL-LENGTH.             13330000
133400     MOVE WMLENGTH-MAX-XML-LENGTH   TO PV-MAX-XML-LENGTH.         13340000
133500                                                                  13350000
133600     COMPUTE PV-MAX-BYTES  =                                      13360000
133700             PV-HDR-LENGTH +                                      13370000
133800            (PV-DTL-LENGTH * WST00011-CSE-DTL-NBR).               13380000
133900                                                                  13390000
134000     COMPUTE PV-MAX-CASES  =                                      13400000
134100            (PV-MAX-XML-LENGTH / PV-MAX-BYTES).                   13410000
134200                                                                  13420000
134300****************************************************************  13430000
134400*   CALCULATE MAX NUMBER OF ASN MESSAGES                          13440000
134500****************************************************************  13450000
134600 2300-CALCULATE-MAX-ASN.                                          13460000
134700                                                                  13470000
134800     IF PS-CICS-SWITCH-YES                                        13480000
134900        INITIALIZE PV-CICS-MSG-AREA                               13490000
135000        STRING   ' ' WS006-SRC-TASK-NUMBER                        13500000
135100                 ' WSKCS302-2300:'                                13510000
135200                 ' ' WS006-OPER-UNT-ID                            13520000
135300                 ' ' WS006-EXT-SHP-ID (1:15)                      13530000
135400                 ' ' WS006-USERID                                 13540000
135500                 ' SQLCODE=' PV-DISP-SQLCODE                      13550000
135600                 ' 2300-CALCULATE-MAX-ASN  '                      13560000
135700                   DELIMITED BY SIZE                              13570000
135800                      INTO PV-CICS-MSG-AREA                       13580000
135900        PERFORM 9900-WRITE-TO-CICS-LOG                            13590000
136000     END-IF.                                                      13600000
136100                                                                  13610000
136200     MOVE WMLENGTH-ASN-DTL-LENGTH  TO PV-ASN-LENGTH.              13620000
136300     MOVE WMLENGTH-MAX-XML-LENGTH  TO PV-MAX-XML-LENGTH.          13630000
136400                                                                  13640000
136500     COMPUTE PV-MAX-ASN =                                         13650000
136600            (PV-MAX-XML-LENGTH / PV-ASN-LENGTH).                  13660000
136700                                                                  13670000
136800****************************************************************  13680000
136900*   CREATE XML BANNER                                             13690000
137000****************************************************************  13700000
137100 2400-CREATE-XML-BANNER.                                          13710000
137200                                                                  13720000
137300     IF PS-CICS-SWITCH-YES                                        13730000
137400        INITIALIZE PV-CICS-MSG-AREA                               13740000
137500        STRING   ' ' WS006-SRC-TASK-NUMBER                        13750000
137600                 ' WSKCS302-2400:'                                13760000
137700                 ' ' WS006-OPER-UNT-ID                            13770000
137800                 ' ' WS006-EXT-SHP-ID (1:15)                      13780000
137900                 ' ' WS006-USERID                                 13790000
138000                 ' SQLCODE=' PV-DISP-SQLCODE                      13800000
138100                 ' 2400-CREATE-XML-BANNER  '                      13810000
138200                   DELIMITED BY SIZE                              13820000
138300                      INTO PV-CICS-MSG-AREA                       13830000
138400        PERFORM 9900-WRITE-TO-CICS-LOG                            13840000
138500     END-IF.                                                      13850000
138600                                                                  13860000
138700     SET X1 TO XML-LENGTH.                                        13870000
138800     PERFORM UNTIL X1 = 0                                         13880000
138900       MOVE PV-XML2-CHAR (X1) TO PV-XML2-CHAR (X1 + 38)           13890000
139000       MOVE SPACE TO PV-XML2-CHAR (X1)                            13900000
139100       SET X1 DOWN BY 1                                           13910000
139200     END-PERFORM.                                                 13920000
139300                                                                  13930000
139400     MOVE PC-XML-BANNER TO                                        13940000
139500          PV-XML (1:LENGTH OF PC-XML-BANNER).                     13950000
139600                                                                  13960000
139700     ADD LENGTH OF PC-XML-BANNER TO XML-LENGTH.                   13970000
139800                                                                  13980000
139900****************************************************************  13990000
140000*   BUILD CASE HEADER XML (RECORD TYPE 'CH')                   *  14000000
140100****************************************************************  14010000
140200 3000-RECORD-TYPE-CH.                                             14020000
140300                                                                  14030000
140400     IF CH-SUB                   = PV-MAX-CASES   OR              14040000
140500        CH-SUB                   = WS023-MAX-CRTN-PER-MSG         14050000
140600        PERFORM 3010-GENERATE-XML-CH                              14060000
140700        MOVE WST00011-CSE-DTL-NBR TO CD-count                     14070000
140800        PERFORM 2200-CALCULATE-MAX-CASE                           14080000
140900     END-IF.                                                      14090000
141000                                                                  14100000
141100     IF WST00011-CSE-DTL-NBR NOT = PV-LAST-CSE-DTL-NBR            14110000
141200        PERFORM 3010-GENERATE-XML-CH                              14120000
141300        MOVE WST00011-CSE-DTL-NBR TO CD-count                     14130000
141400                                     PV-LAST-CSE-DTL-NBR          14140000
141500        PERFORM 2200-CALCULATE-MAX-CASE                           14150000
141600     END-IF.                                                      14160000
141700                                                                  14170000
141800     ADD +1 TO PV-CH-CNT.                                         14180000
141900     MOVE WST00011-REC-TYP-DESC-TEXT TO WS006-CASE-HDR-REC.       14190000
142000                                                                  14200000
142100     IF PS-CICS-SWITCH-YES                                        14210000
142200        INITIALIZE PV-CICS-MSG-AREA                               14220000
142300        STRING   ' ' WS006-SRC-TASK-NUMBER                        14230000
142400                 ' WSKCS302-3000:'                                14240000
142500                 ' ' WS006-OPER-UNT-ID                            14250000
142600                 ' ' WS006-EXT-SHP-ID (1:15)                      14260000
142700                 ' ' WS006-USERID                                 14270000
142800                 ' SQLCODE=' PV-DISP-SQLCODE                      14280000
142900                 ' ' WS006-CH-CASE-NBR                            14290000
143000                 ' 3000-RECORD-TYPE-CH  '                         14300000
143100                   DELIMITED BY SIZE                              14310000
143200                      INTO PV-CICS-MSG-AREA                       14320000
143300        PERFORM 9900-WRITE-TO-CICS-LOG                            14330000
143400                                                                  14340000
143500     END-IF.                                                      14350000
143600     ADD  1     TO CH-SUB.                                        14360000
143700     MOVE ZEROS TO CD-SUB.                                        14370000
143800                                                                  14380000
143900     IF CH-SUB = 1                                                14390000
144000        PERFORM 2100-BUILD-CASEINFO-XML                           14400000
144100     END-IF.                                                      14410000
144200                                                                  14420000
144300* Case - Build Header                                             14430000
144400                                                                  14440000
144500     MOVE WS006-CH-CASE-NBR       TO  CaseNbr                     14450000
144600                                      OF ASNCase (CH-SUB).        14460000
144700                                                                  14470000
144800     IF WS006-CH-FINDLAY-SHIPMT                                   14480000
144900        MOVE WS006-CH-CASE-NBR     TO PV-CASE-SSCC                14490000
145000        MOVE PV-CASE-SML           TO PV-CASE-SML-COMP            14500000
145100        PERFORM 3046-RETRIEVE-SSCC                                14510000
145200        MOVE PV-XML-CASE-EXPAND    TO AltCaseNbr                  14520000
145300                                      OF ASNCase (CH-SUB)         14530000
145400        PERFORM 3005-CHECK-PRST-INOUT-OTBD                        14540000
145500     ELSE                                                         14550000
145600        MOVE PC-XML-ZEROES         TO PV-XML-CASE-EXPAND          14560000
145700        MOVE PV-XML-CASE-EXPAND    TO AltCaseNbr                  14570000
145800                                      OF ASNCase (CH-SUB)         14580000
145900                                                                  14590000
146000        MOVE WS006-CH-CASE-NBR     TO PV-CASE-SSCC                14600000
146100        MOVE PV-CASE-SML           TO PV-CASE-SML-COMP            14610000
146200        PERFORM 3004-CHECK-PRST-INOUT-SSCC                        14620000
146300     END-IF.                                                      14630000
146400                                                                  14640000
146500                                                                  14650000
146600     MOVE WS006-CH-WHSE           TO  Warehouse                   14660000
146700                                      OF ASNCase (CH-SUB).        14670000
146800     MOVE '01'                    TO  Compan1                     14680000
146900                                      OF ASNCase (CH-SUB).        14690000
147000     MOVE '01'                    TO  Divisio1                    14700000
147100                                      OF ASNCase (CH-SUB).        14710000
147200     MOVE WS006-CH-ORIG-SHPMT-NBR TO  ReceivedShipmentNbr         14720000
147300                                      OF ASNCase (CH-SUB).        14730000
147400     MOVE WS006-CH-ORIG-SHPMT-NBR TO  OriginalShipmentNbr         14740000
147500                                      OF ASNCase (CH-SUB).        14750000
147600     MOVE WS006-CH-RCVR-SEQ-NBR   TO  DcOrderNbr                  14760000
147700                                      OF ASNCase (CH-SUB).        14770000
147800     MOVE WS006-CH-TRIP-ID        TO  WorkOrderNbr                14780000
147900                                      OF ASNCase (CH-SUB).        14790000
148000     MOVE 'Y'                     TO  ProcessImmdNeeds            14800000
148100                                      OF ASNCase (CH-SUB).        14810000
148200     MOVE WS006-CH-SHPD-UNT-VOL   TO  Volume                      14820000
148300                                      OF ASNCase (CH-SUB).        14830000
148400     MOVE WS006-CH-EST-WEIGHT     TO  PV-CONVERT-NUM.             14840000
148500     MOVE PV-CONVERT-NUM          TO  EstimatedWeight             14850000
148600                                      OF ASNCase (CH-SUB).        14860000
148700     MOVE WS006-CH-PO-NBR         TO  PONbr                       14870000
148800                                      OF ASNCase (CH-SUB).        14880000
148900**                                                                14890000
149000     PERFORM 3007-PO-FROM-SPCL-INSTR.                             14900000
149100     MOVE INSTCD-INSTR-DESC(1:10)  TO PV-VENDOR-PO                14910000
149200     MOVE PV-VENDOR-PO             TO AltPONbr                    14920000
149300                                      OF ASNCase (CH-SUB).        14930000
149400                                                                  14940000
149500**                                                                14950000
149510     MOVE WS006-CH-SCAC           TO  ShipVia                     14951000
149520                                      OF ASNCase (CH-SUB).        14952000
149530     MOVE WS006-CH-TRLR-ID        TO  TrailerNumber               14953000
149540                                      OF ASNCase (CH-SUB).        14954000
149550                                                                  14955000
149560     MOVE '2007-01-27T13:47:00'   TO  StatusDateTime              14956000
149570                                      OF ASNCase (CH-SUB).        14957000
149580                                                                  14958000
149590                                                                  14959000
149600     MOVE WS006-CH-CREATE-TMST (1:4)  TO PV-CONVERT-DATE (1:4).   14960000
149700     MOVE '-'                         TO PV-CONVERT-DATE (5:1)    14970000
149800                                         PV-CONVERT-DATE (8:1).   14980000
149900     MOVE WS006-CH-CREATE-TMST (6:2)  TO PV-CONVERT-DATE (6:2).   14990000
150000     MOVE WS006-CH-CREATE-TMST (9:2)  TO PV-CONVERT-DATE (9:2).   15000000
150100     MOVE 'T'                         TO PV-CONVERT-DATE (11:1).  15010000
150200     MOVE WS006-CH-CREATE-TMST (12:2) TO PV-CONVERT-DATE (12:2).  15020000
150300     MOVE ':'                         TO PV-CONVERT-DATE (14:1)   15030000
150400                                         PV-CONVERT-DATE (17:1).  15040000
150500     MOVE WS006-CH-CREATE-TMST (15:2) TO PV-CONVERT-DATE (15:2).  15050000
150600     MOVE WS006-CH-CREATE-TMST (18:2) TO PV-CONVERT-DATE (18:2).  15060000
150700                                                                  15070000
150800     MOVE PV-CONVERT-DATE         TO  StatusDateTime              15080000
150900                                      OF ASNCase (CH-SUB).        15090000
151000     MOVE WS006-CH-SNGL-SKU-CASE  TO  SingleSkuCase               15100000
151100                                      OF ASNCase (CH-SUB).        15110000
151200     MOVE WS006-CH-VENDOR-ID      TO  VendorId                    15120000
151300                                      OF ASNCase (CH-SUB).        15130000
151400     MOVE 'C'                     TO  PhysicalEntityCode          15140000
151500                                      OF ASNCase (CH-SUB).        15150000
151600     IF PV-ELEMENT-SEND  = 'Y'                                    15160000
151700        PERFORM 3002-SELECT-PO-TYPE                               15170000
151800        MOVE PURCHS-PO-TYP-CDE       TO  PoTypeCode               15180000
151900                                         OF ASNCase (CH-SUB)      15190000
152000                                                                  15200000
152100        IF XLT00004-HNG-FOLD-DESC(1:5)  = PC-HANG                 15210000
152200          PERFORM 3006-HANGER-PO-AGREEMENT                        15220000
152300          IF PV-DB2-COUNT  > 0                                    15230000
152400            MOVE XLT00004-HNG-FOLD-DESC(1:5) TO PresentDesc       15240000
152410                                         OF ASNCase (CH-SUB)      15241000
152420          ELSE                                                    15242000
152430            MOVE PC-NONE             TO PresentDesc               15243000
152440                                        OF ASNCase (CH-SUB)       15244000
152441          END-IF                                                  15244100
152442        ELSE                                                      15244200
152443          MOVE XLT00004-HNG-FOLD-DESC(1:5) TO PresentDesc         15244300
152444                                              OF ASNCase (CH-SUB) 15244400
152445        END-IF                                                    15244500
152446                                                                  15244600
152447        MOVE PV-OUTR-PACK-QTY        TO OtpkQty                   15244700
152448                                        OF ASNCase (CH-SUB)       15244800
152449        MOVE PV-INNR-PACK-QTY        TO InpkQty                   15244900
152450                                        OF ASNCase (CH-SUB)       15245000
152460     END-IF.                                                      15246000
152470                                                                  15247000
152480     ADD 1 TO CH-count.                                           15248000
152490                                                                  15249000
152500****************************************************************  15250000
152600* SELECT THE PURCHASE ORDER TYPE                                  15260000
152700****************************************************************  15270000
152710 3002-SELECT-PO-TYPE.                                             15271000
152720                                                                  15272000
152730     IF PS-CICS-SWITCH-YES                                        15273000
152740        INITIALIZE PV-CICS-MSG-AREA                               15274000
152750        STRING   ' ' WS006-SRC-TASK-NUMBER                        15275000
152760                 ' WSKCS302-3002:'                                15276000
152770                 ' ' WS006-OPER-UNT-ID                            15277000
152780                 ' ' WS006-EXT-SHP-ID (1:15)                      15278000
152790                 ' ' WS006-USERID                                 15279000
152791                 ' SQLCODE=' PV-DISP-SQLCODE                      15279100
152792                 ' 3002-SELECT-PO-TYPE  '                         15279200
152793                   DELIMITED BY SIZE                              15279300
152794                      INTO PV-CICS-MSG-AREA                       15279400
152795        PERFORM 9900-WRITE-TO-CICS-LOG                            15279500
152796     END-IF.                                                      15279600
152797                                                                  15279700
152798     MOVE WS006-CH-PO-NBR          TO DK-PO-NBR.                  15279800
152799                                                                  15279900
152800     EXEC SQL                                                     15280000
152801        SELECT PO_TYP_CDE                                         15280100
152802          INTO :PURCHS-PO-TYP-CDE                                 15280200
152803          FROM TPURCHS                                            15280300
152804         WHERE PO_NBR            = :DK-PO-NBR                     15280400
152805           AND VER_STATUS_CDE    = 'A'                            15280500
152806       WITH UR                                                    15280600
152807     END-EXEC.                                                    15280700
152808                                                                  15280800
152809     EVALUATE TRUE                                                15280900
152810       WHEN SQLCODE = ZERO                                        15281000
152811            CONTINUE                                              15281105
152812                                                                  15281205
152813       WHEN SQLCODE = +100                                        15281300
152814            MOVE 'ST'  TO  PURCHS-PO-TYP-CDE                      15281405
152815                                                                  15281505
152816       WHEN SQLCODE NOT EQUAL ZERO                                15281600
152817            MOVE '3002-SELECT-PO-TYPE  '                          15281700
152818                                       TO WS006-SQL-ERROR-PARA    15281800
152819            MOVE '2'                   TO WS006-SUCCESS-IND       15281900
152820            MOVE SQLCODE               TO WS006-SQLCODE           15282000
152821            INITIALIZE PV-CICS-MSG-AREA                           15282100
152822            MOVE SQLCODE            TO PV-DISP-SQLCODE            15282200
152823            STRING   ' ' WS006-SRC-TASK-NUMBER                    15282300
152824                     ' WSKCS302-3002:'                            15282406
152825                     ' ' WS006-OPER-UNT-ID                        15282500
152826                     ' ' WS006-EXT-SHP-ID (1:15)                  15282600
152827                     ' ' WS006-USERID                             15282700
152828                     ' SQLCODE=' PV-DISP-SQLCODE                  15282800
152829                     DELIMITED BY SIZE                            15282900
152830                     INTO PV-CICS-MSG-AREA                        15283000
152831            PERFORM 9900-WRITE-TO-CICS-LOG                        15283100
152832            PERFORM 8995-RETURN                                   15283200
152833     END-EVALUATE.                                                15283300
152834                                                                  15283400
152835****************************************************************  15283500
152836* SELECT STYLE LEVEL PRESENTATION AND INNER OUTER QUANTITIES      15283600
152837* VENDOR SSCC CARTON                                              15283700
152838****************************************************************  15283800
152839 3004-CHECK-PRST-INOUT-SSCC.                                      15283900
152840                                                                  15284000
152841     IF PS-CICS-SWITCH-YES                                        15284100
152842        INITIALIZE PV-CICS-MSG-AREA                               15284200
152843        STRING   ' ' WS006-SRC-TASK-NUMBER                        15284300
152850                 ' WSKCS302-3004:'                                15285000
152860                 ' ' WS006-OPER-UNT-ID                            15286000
152870                 ' ' WS006-EXT-SHP-ID (1:15)                      15287000
152880                 ' ' WS006-USERID                                 15288000
152890                 ' SQLCODE=' PV-DISP-SQLCODE                      15289000
152900                 ' 3004-CHECK-PRST-INOUT-SSCC '                   15290000
152910                   DELIMITED BY SIZE                              15291000
152911                      INTO PV-CICS-MSG-AREA                       15291100
152912        PERFORM 9900-WRITE-TO-CICS-LOG                            15291200
152913     END-IF.                                                      15291300
152914                                                                  15291400
152915     MOVE WS006-CH-PO-NBR          TO DK-PO-NBR.                  15291500
152916                                                                  15291600
152917     EXEC SQL                                                     15291700
152918        SELECT DISTINCT(D.HNG_FOLD_DESC)                          15291803
152919             , B.INNR_PK_QTY                                      15291900
152920             , B.OUTR_PK_QTY                                      15292000
152921          INTO :XLT00004-HNG-FOLD-DESC :PV-NULL-IND-1             15292102
152922             , :PV-INNR-PACK-QTY       :PV-NULL-IND-2             15292202
152923             , :PV-OUTR-PACK-QTY       :PV-NULL-IND-3             15292302
152924          FROM TSHUUPC A                                          15292400
152925              ,TPURITM B                                          15292500
152926              ,XLT_SKU C                                          15292600
152927              ,XLT_VND_STYL D                                     15292700
152928         WHERE A.SHIPT_UNT_ID      = :PV-CASE-SML-COMP            15292800
152929           AND A.TRN_NBR           = :DK-PO-NBR                   15292900
152930           AND A.TRN_NBR           = B.PO_NBR                     15293000
152931           AND A.TRN_LNE_NBR       = B.APP_PO_LNE_NBR             15293100
152932           AND B.ITM_NBR           = C.ITM_NBR                    15293200
152933           AND C.STYL_ID           = D.STYL_ID                    15293300
152934     END-EXEC.                                                    15293400
152935                                                                  15293500
152937     EVALUATE TRUE                                                15293700
152938       WHEN SQLCODE = ZERO                                        15293800
152939       WHEN SQLCODE = -811                                        15293913
152940             IF  PV-NULL-IND-1  =  -1                             15294013
152941                 MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC           15294113
152942             END-IF                                               15294202
152943             IF  PV-NULL-IND-2  =  -1                             15294302
152944                 MOVE +1      TO RECITM-INNR-PACK-QTY             15294402
152945                                 PV-INNR-PACK-QTY                 15294502
152946             END-IF                                               15294602
152947             IF  PV-NULL-IND-3  =  -1                             15294702
152948                 MOVE +1      TO RECITM-CASE-PACK-QTY             15294802
152949                                 PV-OUTR-PACK-QTY                 15294902
152950             END-IF                                               15295002
152951                                                                  15295102
152952            IF XLT00004-HNG-FOLD-DESC  > SPACE                    15295200
152953               IF XLT00004-HNG-FOLD-DESC(1:5)  = PC-NA            15295300
152960                  MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC          15296000
152961               END-IF                                             15296100
152962            ELSE                                                  15296200
152963               MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC             15296300
152964            END-IF                                                15296400
152975                                                                  15297512
152976       WHEN SQLCODE = +100                                        15297612
152977            MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC                15297712
152978            MOVE +1      TO RECITM-INNR-PACK-QTY                  15297812
152979                            PV-INNR-PACK-QTY                      15297912
152980            MOVE +1      TO RECITM-CASE-PACK-QTY                  15298012
152981                            PV-OUTR-PACK-QTY                      15298112
152982                                                                  15298212
152983       WHEN SQLCODE NOT EQUAL ZERO                                15298312
152984            MOVE '3004-CHECK-PRST-INOUT-SSCC '                    15298412
152985                                       TO WS006-SQL-ERROR-PARA    15298512
152986            MOVE '2'                   TO WS006-SUCCESS-IND       15298612
152987            MOVE SQLCODE               TO WS006-SQLCODE           15298712
152988            INITIALIZE PV-CICS-MSG-AREA                           15298812
152989            MOVE SQLCODE            TO PV-DISP-SQLCODE            15298912
152990            STRING   ' ' WS006-SRC-TASK-NUMBER                    15299012
152991                     ' WSKCS302-3004:'                            15299112
152992                     ' ' WS006-OPER-UNT-ID                        15299212
152993                     ' ' WS006-EXT-SHP-ID (1:15)                  15299312
152994                     ' ' WS006-USERID                             15299412
152995                     ' SQLCODE=' PV-DISP-SQLCODE                  15299512
152996                     DELIMITED BY SIZE                            15299612
152997                     INTO PV-CICS-MSG-AREA                        15299712
152998            PERFORM 9900-WRITE-TO-CICS-LOG                        15299812
152999            PERFORM 8995-RETURN                                   15299912
153000     END-EVALUATE.                                                15300012
153001                                                                  15300112
153002****************************************************************  15300212
153003* SELECT STYLE LEVEL PRESENTATION AND INNER OUTER QUANTITIES      15300312
153004* SUT OUTBOUND CARTON                                             15300412
153005****************************************************************  15300512
153006 3005-CHECK-PRST-INOUT-OTBD.                                      15300612
153007                                                                  15300712
153008     IF PS-CICS-SWITCH-YES                                        15300812
153009        INITIALIZE PV-CICS-MSG-AREA                               15300912
153010        STRING   ' ' WS006-SRC-TASK-NUMBER                        15301012
153011                 ' WSKCS302-3005:'                                15301112
153012                 ' ' WS006-OPER-UNT-ID                            15301212
153013                 ' ' WS006-EXT-SHP-ID (1:15)                      15301312
153014                 ' ' WS006-USERID                                 15301412
153015                 ' SQLCODE=' PV-DISP-SQLCODE                      15301512
153016                 ' 3005-CHECK-PRST-INOUT-OTBD '                   15301612
153017                   DELIMITED BY SIZE                              15301712
153018                      INTO PV-CICS-MSG-AREA                       15301812
153019        PERFORM 9900-WRITE-TO-CICS-LOG                            15301912
153020     END-IF.                                                      15302012
153021                                                                  15302112
153022     MOVE WS006-CH-PO-NBR          TO DK-PO-NBR.                  15302212
153023     MOVE WS006-CH-RCVR-SEQ-NBR    TO DK-REC-SEQ-NBR.             15302312
153024                                                                  15302412
153025     EXEC SQL                                                     15302512
153026        SELECT DISTINCT(D.HNG_FOLD_DESC)                          15302612
153027             , B.INNR_PACK_QTY                                    15302712
153028             , B.CASE_PACK_QTY                                    15302812
153029          INTO :XLT00004-HNG-FOLD-DESC :PV-NULL-IND-4             15302912
153030             , :PV-INNR-PACK-QTY       :PV-NULL-IND-5             15303012
153031             , :PV-OUTR-PACK-QTY       :PV-NULL-IND-6             15303112
153032          FROM SUT_OTBND_UPC A                                    15303212
153033              ,TRECITM B                                          15303312
153034              ,XLT_SKU C                                          15303412
153035              ,XLT_VND_STYL D                                     15303512
153036         WHERE A.SHIPT_UNT_ID      = :PV-CASE-SML-COMP            15303612
153037           AND A.TRN_NBR           = :DK-PO-NBR                   15303712
153038           AND A.RCVR_SEQ_NBR      = :DK-REC-SEQ-NBR              15303812
153039           AND A.TRN_NBR           = B.ORD_NBR                    15303912
153040           AND A.RCVR_SEQ_NBR      = B.REC_SEQ_NBR                15304012
153041           AND A.TRN_LNE_NBR       = B.ORD_LNE_NBR                15304112
153042           AND B.ITM_NBR           = C.ITM_NBR                    15304212
153043           AND C.STYL_ID           = D.STYL_ID                    15304312
153044     END-EXEC.                                                    15304412
153045                                                                  15304512
153046                                                                  15304612
153047     EVALUATE TRUE                                                15304712
153048       WHEN SQLCODE = ZERO                                        15304812
153049       WHEN SQLCODE = -811                                        15304912
153050             IF  PV-NULL-IND-4  =  -1                             15305012
153051                 MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC           15305112
153052             END-IF                                               15305212
153053             IF  PV-NULL-IND-5  =  -1                             15305312
153054                 MOVE +1      TO RECITM-INNR-PACK-QTY             15305412
153055                                 PV-INNR-PACK-QTY                 15305512
153056             END-IF                                               15305612
153057             IF  PV-NULL-IND-6  =  -1                             15305712
153058                 MOVE +1      TO RECITM-CASE-PACK-QTY             15305812
153059                                 PV-OUTR-PACK-QTY                 15305912
153060             END-IF                                               15306012
153061                                                                  15306112
153062            IF XLT00004-HNG-FOLD-DESC  > SPACE                    15306212
153063               IF XLT00004-HNG-FOLD-DESC(1:5)  = PC-NA            15306312
153064                  MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC          15306412
153065               END-IF                                             15306512
153066            ELSE                                                  15306612
153067               MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC             15306712
153068            END-IF                                                15306812
153069                                                                  15306912
153070       WHEN SQLCODE = +100                                        15307012
153071            MOVE PC-NONE TO XLT00004-HNG-FOLD-DESC                15307112
153072            MOVE +1      TO RECITM-INNR-PACK-QTY                  15307212
153073                            PV-INNR-PACK-QTY                      15307312
153074            MOVE +1      TO RECITM-CASE-PACK-QTY                  15307412
153075                            PV-OUTR-PACK-QTY                      15307512
153076                                                                  15307612
153077       WHEN SQLCODE NOT EQUAL ZERO                                15307712
153078            MOVE '3005-CHECK-PRST-INOUT-OTBD '                    15307812
153079                                       TO WS006-SQL-ERROR-PARA    15307912
153080            MOVE '2'                   TO WS006-SUCCESS-IND       15308012
153081            MOVE SQLCODE               TO WS006-SQLCODE           15308112
153082            INITIALIZE PV-CICS-MSG-AREA                           15308212
153083            MOVE SQLCODE            TO PV-DISP-SQLCODE            15308312
153084            STRING   ' ' WS006-SRC-TASK-NUMBER                    15308412
153085                     ' WSKCS302-3004:'                            15308512
153086                     ' ' WS006-OPER-UNT-ID                        15308612
153087                     ' ' WS006-EXT-SHP-ID (1:15)                  15308712
153088                     ' ' WS006-USERID                             15308812
153089                     ' SQLCODE=' PV-DISP-SQLCODE                  15308912
153090                     DELIMITED BY SIZE                            15309012
153091                     INTO PV-CICS-MSG-AREA                        15309112
153092            PERFORM 9900-WRITE-TO-CICS-LOG                        15309212
153093            PERFORM 8995-RETURN                                   15309312
153094     END-EVALUATE.                                                15309412
153095                                                                  15309512
153096****************************************************************  15309612
153097* SELECT THE PURCHASE ORDER AGREEMENT TYPE FOR HANG               15309712
153098****************************************************************  15309812
153099 3006-HANGER-PO-AGREEMENT.                                        15309912
153100                                                                  15310012
153101     IF PS-CICS-SWITCH-YES                                        15310112
153102        INITIALIZE PV-CICS-MSG-AREA                               15310212
153103        STRING   ' ' WS006-SRC-TASK-NUMBER                        15310312
153110                 ' WSKCS302-3006:'                                15311006
153111                 ' ' WS006-OPER-UNT-ID                            15311100
153112                 ' ' WS006-EXT-SHP-ID (1:15)                      15311200
153113                 ' ' WS006-USERID                                 15311300
153114                 ' SQLCODE=' PV-DISP-SQLCODE                      15311400
153115                 ' 3006-HANGER-PO-AGREEMENT '                     15311506
153116                   DELIMITED BY SIZE                              15311600
153117                      INTO PV-CICS-MSG-AREA                       15311700
153118        PERFORM 9900-WRITE-TO-CICS-LOG                            15311800
153119     END-IF.                                                      15311900
153120     MOVE +0                       TO PV-DB2-COUNT.               15312000
153121     MOVE WS006-CH-PO-NBR          TO DK-PO-NBR.                  15312100
153122     MOVE 4                        TO DK-AGRMT-TYP-ID.            15312200
153123     MOVE 2                        TO DK-TYP-CDE.                 15312300
153124                                                                  15312400
153125     EXEC SQL                                                     15312500
153126          SELECT COUNT(*)                                         15312600
153127            INTO :PV-DB2-COUNT                                    15312700
153128            FROM TPOAGMT                                          15312800
153129           WHERE PO_NBR         = :DK-PO-NBR                      15312900
153130             AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID                15313000
153131             AND VER_STATUS_CDE = 'A'                             15313100
153132             AND TYP_CDE        = :DK-TYP-CDE                     15313200
153133     END-EXEC                                                     15313300
153134                                                                  15313400
153135                                                                  15313500
153136     EVALUATE TRUE                                                15313600
153137       WHEN SQLCODE = ZERO                                        15313700
153138            continue                                              15313802
153139                                                                  15313902
153140       WHEN SQLCODE = +100                                        15314000
153141            MOVE ZEROES TO PV-DB2-COUNT                           15314102
153142                                                                  15314202
153143       WHEN SQLCODE NOT EQUAL ZERO                                15314302
153144            MOVE '3003-HANGER-PO-AGREEMENT '                      15314400
153145                                       TO WS006-SQL-ERROR-PARA    15314500
153146            MOVE '2'                   TO WS006-SUCCESS-IND       15314600
153147            MOVE SQLCODE               TO WS006-SQLCODE           15314700
153148            INITIALIZE PV-CICS-MSG-AREA                           15314800
153149            MOVE SQLCODE            TO PV-DISP-SQLCODE            15314900
153150            STRING   ' ' WS006-SRC-TASK-NUMBER                    15315000
153151                     ' WSKCS302-3006:'                            15315106
153152                     ' ' WS006-OPER-UNT-ID                        15315200
153153                     ' ' WS006-EXT-SHP-ID (1:15)                  15315300
153154                     ' ' WS006-USERID                             15315400
153155                     ' SQLCODE=' PV-DISP-SQLCODE                  15315500
153156                     DELIMITED BY SIZE                            15315600
153157                     INTO PV-CICS-MSG-AREA                        15315700
153158            PERFORM 9900-WRITE-TO-CICS-LOG                        15315800
153159            PERFORM 8995-RETURN                                   15315900
153160     END-EVALUATE.                                                15316000
153161                                                                  15316100
153162                                                                  15316200
153163****************************************************************  15316300
153164* SELECT THE PURCHASE ORDER NUMBER FROM SPECIAL INSTRUCTIONS      15316400
153165* SELECT THE SEPHORA PURCHASE ORDER NUMBER                        15316500
153166****************************************************************  15316600
153167 3007-PO-FROM-SPCL-INSTR.                                         15316700
153168                                                                  15316800
153169     IF PS-CICS-SWITCH-YES                                        15316900
153170        INITIALIZE PV-CICS-MSG-AREA                               15317000
153171        STRING   ' ' WS006-SRC-TASK-NUMBER                        15317100
153172                 ' WSKCS302-3007:'                                15317206
153173                 ' ' WS006-OPER-UNT-ID                            15317300
153174                 ' ' WS006-EXT-SHP-ID (1:15)                      15317400
153175                 ' ' WS006-USERID                                 15317500
153176                 ' SQLCODE=' PV-DISP-SQLCODE                      15317600
153177                 ' 3007-PO-FROM-SPCL-INSTR  '                     15317700
153178                   DELIMITED BY SIZE                              15317800
153179                      INTO PV-CICS-MSG-AREA                       15317900
153180        PERFORM 9900-WRITE-TO-CICS-LOG                            15318000
153181     END-IF.                                                      15318100
153182                                                                  15318200
153183     MOVE WS006-CH-PO-NBR          TO POINST-PO-NBR.              15318300
153184                                                                  15318400
153185     EXEC SQL                                                     15318500
153186          SELECT RTRIM(SUBSTR(INSTR_DESC,13,10))                  15318600
153187            INTO :INSTCD-INSTR-DESC                               15318700
153188            FROM TINSTCD A                                        15318800
153189          ,      TPOINST B                                        15318900
153190          WHERE UPPER(A.INSTR_DESC) LIKE 'SEPHORA PO #%'          15319000
153191          AND B.INSTR_NBR = A.INSTR_NBR                           15319100
153192          AND B.RECIP_CDE = 'VN'                                  15319200
153193          AND B.PO_NBR = :POINST-PO-NBR                           15319300
153194     END-EXEC                                                     15319400
153195                                                                  15319500
153196                                                                  15319600
153197     EVALUATE TRUE                                                15319700
153198       WHEN SQLCODE = ZERO                                        15319800
153199            CONTINUE                                              15319900
153200       WHEN SQLCODE = +100                                        15320000
153201            MOVE SPACE TO INSTCD-INSTR-DESC                       15320100
153202       WHEN SQLCODE NOT EQUAL ZERO                                15320200
153203            MOVE '3007-PO-FROM-SPCL-INSTR  '                      15320300
153210                                       TO WS006-SQL-ERROR-PARA    15321000
153211            MOVE '2'                   TO WS006-SUCCESS-IND       15321100
153212            MOVE SQLCODE               TO WS006-SQLCODE           15321200
153213            INITIALIZE PV-CICS-MSG-AREA                           15321300
153214            MOVE SQLCODE            TO PV-DISP-SQLCODE            15321400
153215            STRING   ' ' WS006-SRC-TASK-NUMBER                    15321500
153216                     ' WSKCS302-3007:'                            15321606
153217                     ' ' WS006-OPER-UNT-ID                        15321700
153218                     ' ' WS006-EXT-SHP-ID (1:15)                  15321800
153219                     ' ' WS006-USERID                             15321900
153220                     ' SQLCODE=' PV-DISP-SQLCODE                  15322000
153221                     DELIMITED BY SIZE                            15322100
153222                     INTO PV-CICS-MSG-AREA                        15322200
153223            PERFORM 9900-WRITE-TO-CICS-LOG                        15322300
153224            PERFORM 8995-RETURN                                   15322400
153225     END-EVALUATE.                                                15322500
153226                                                                  15322600
153227                                                                  15322700
153228****************************************************************  15322800
153229*   GENERATE XML HEADER AND DETAIL                                15322900
153230****************************************************************  15323000
153231 3010-GENERATE-XML-CH.                                            15323100
153232                                                                  15323200
153233     IF PS-CICS-SWITCH-YES                                        15323300
153234        INITIALIZE PV-CICS-MSG-AREA                               15323400
153235        STRING   ' ' WS006-SRC-TASK-NUMBER                        15323500
153236                 ' WSKCS302-3010:'                                15323600
153237                 ' ' WS006-OPER-UNT-ID                            15323700
153238                 ' ' WS006-EXT-SHP-ID (1:15)                      15323800
153239                 ' ' WS006-USERID                                 15323900
153240                 ' SQLCODE=' PV-DISP-SQLCODE                      15324000
153250                 ' 3010-GENERATE-XML-CH    '                      15325000
153260                   DELIMITED BY SIZE                              15326000
153270                      INTO PV-CICS-MSG-AREA                       15327000
153280        PERFORM 9900-WRITE-TO-CICS-LOG                            15328000
153290     END-IF.                                                      15329000
153300                                                                  15330000
153400     MOVE SPACES TO PV-XML.                                       15340000
153500                                                                  15350000
153600     XML GENERATE PV-XML                                          15360000
153700         FROM InboundASNBridge                                    15370000
153800         COUNT IN XML-LENGTH                                      15380000
153900         ON EXCEPTION                                             15390000
154000             PERFORM 8500-XML-ERROR                               15400000
154100         NOT ON EXCEPTION                                         15410000
154200             ADD +1 TO PV-XML-OUT                                 15420000
154300             PERFORM 8600-REPLACE-XML                             15430000
154400             PERFORM 8700-XML-SUCCESS                             15440000
154500     END-XML.                                                     15450000
154600                                                                  15460000
154700     MOVE CH-SUB TO CH-COUNT.                                     15470000
154800     PERFORM WITH TEST AFTER VARYING CH-SUB FROM 1 BY 1           15480000
154900             UNTIL CH-SUB = CH-COUNT                              15490000
155000                OR CH-SUB > CH-COUNT                              15500000
155100             MOVE SPACES TO ASNCase (CH-SUB)                      15510000
155200     END-PERFORM.                                                 15520000
155300                                                                  15530000
155400     MOVE ZEROS TO CH-SUB                                         15540000
155500                   CH-count                                       15550000
155600                   CD-SUB                                         15560000
155700                   CD-count.                                      15570000
155800                                                                  15580000
155900     PERFORM 2400-CREATE-XML-BANNER.                              15590000
156000     ADD 1 TO PV-CH-XML.                                          15600000
156100                                                                  15610000
156200     IF PS-WRITE-MQ-YES                                           15620000
156300        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         15630000
156400     END-IF.                                                      15640000
156500                                                                  15650000
156600****************************************************************  15660000
156700*   BUILD CASE DETAIL XML  (RECORD TYPE 'CD')                  *  15670000
156800****************************************************************  15680000
156900 3020-RECORD-TYPE-CD.                                             15690000
157000                                                                  15700000
157100     ADD +1 TO PV-CD-CNT.                                         15710000
157200                                                                  15720000
157300     MOVE WST00011-REC-TYP-DESC-TEXT TO WS007-CASE-DTL-REC.       15730000
157400                                                                  15740000
157500     IF PS-CICS-SWITCH-YES                                        15750000
157600        INITIALIZE PV-CICS-MSG-AREA                               15760000
157700        STRING   ' ' WS006-SRC-TASK-NUMBER                        15770000
157800                 ' WSKCS302-3020:'                                15780000
157900                 ' ' WS006-OPER-UNT-ID                            15790000
158000                 ' ' WS006-EXT-SHP-ID (1:15)                      15800000
158100                 ' ' WS006-USERID                                 15810000
158200                 ' SQLCODE=' PV-DISP-SQLCODE                      15820000
158300                 ' ' WS007-CD-CASE-NBR                            15830000
158400                 ' 3020-RECORD-TYPE-CD  '                         15840000
158500                   DELIMITED BY SIZE                              15850000
158600                      INTO PV-CICS-MSG-AREA                       15860000
158700        PERFORM 9900-WRITE-TO-CICS-LOG                            15870000
158800     END-IF.                                                      15880000
158900                                                                  15890000
159000     ADD  1 TO CD-SUB.                                            15900000
159100                                                                  15910000
159200* Build Case Contents (Details)                                   15920000
159300                                                                  15930000
159400     MOVE WS007-CD-CASE-NBR       TO  CaseNbr (CH-SUB).           15940000
159500     MOVE PV-SHIP-CNT             TO  SkuSequenceNbr              15950000
159600                                      (CH-SUB CD-SUB).            15960000
159700     MOVE '01'                    TO  Compan2                     15970000
159800                                      OF SKUDefinition            15980000
159900                                      (CH-SUB CD-SUB).            15990000
160000     MOVE '01'                    TO  Divisio2                    16000000
160100                                      OF SKUDefinition            16010000
160200                                      (CH-SUB CD-SUB).            16020000
160300     MOVE WS007-CD-SKU-NBR        TO  StyleSuffix                 16030000
160400                                      OF SKUDefinition            16040000
160500                                      (CH-SUB CD-SUB).            16050000
160600     MOVE 'F'                     TO  InventoryType               16060000
160700                                      OF SubSKUFields             16070000
160800                                      (CH-SUB CD-SUB).            16080000
160900                                                                  16090000
161000     MOVE WS007-CD-SKU-ID         TO  SkuId                       16100000
161100                                      OF SKUDefinition            16110000
161200                                      (CH-SUB CD-SUB).            16120000
161300                                                                  16130000
161400     MOVE WS007-CD-SHIPD-UNT-QTY  TO  ShippedAsnQuantity          16140000
161500                                      (CH-SUB CD-SUB).            16150000
161600     MOVE WS007-CD-PACK-SKU       TO  AssortmentNbr               16160000
161700                                      (CH-SUB CD-SUB).            16170000
161800     MOVE WST00011-EXT-SHP-ID     TO  ShipmentNb2                 16180000
161900                                      (CH-SUB CD-SUB).            16190000
162000     MOVE WS007-CD-PO-LINE-NBR    TO  CutNbr                      16200000
162100                                      (CH-SUB CD-SUB).            16210000
162200                                                                  16220000
162300****************************************************************  16230000
162400*   BUILD ASN HEADER XML (RECORD TYPE 'AH')                    *  16240000
162500****************************************************************  16250000
162600 3040-RECORD-TYPE-AH.                                             16260000
162700                                                                  16270000
162800     IF PS-CICS-SWITCH-YES                                        16280000
162900        INITIALIZE PV-CICS-MSG-AREA                               16290000
163000        STRING   ' ' WS006-SRC-TASK-NUMBER                        16300000
163100                 ' WSKCS302-3040:'                                16310000
163200                 ' ' WS006-OPER-UNT-ID                            16320000
163300                 ' ' WS006-EXT-SHP-ID (1:15)                      16330000
163400                 ' ' WS006-USERID                                 16340000
163500                 ' SQLCODE=' PV-DISP-SQLCODE                      16350000
163600                 ' 3040-RECORD-TYPE-AH     '                      16360000
163700                   DELIMITED BY SIZE                              16370000
163800                      INTO PV-CICS-MSG-AREA                       16380000
163900        PERFORM 9900-WRITE-TO-CICS-LOG                            16390000
164000     END-IF.                                                      16400000
164100                                                                  16410000
164200     IF CH-SUB > ZEROS                                            16420000
164300        PERFORM 3010-GENERATE-XML-CH                              16430000
164400     END-IF.                                                      16440000
164500                                                                  16450000
164600     IF AD-SUB > 0                                                16460000
164700        PERFORM 3070-GENERATE-XML-AD                              16470000
164800     END-IF.                                                      16480000
164900                                                                  16490000
165000     MOVE WST00011-CSE-DTL-NBR TO PV-LAST-CSE-DTL-NBR.            16500000
165100                                                                  16510000
165200     ADD +1 TO PV-AH-CNT.                                         16520000
165300     PERFORM 2300-CALCULATE-MAX-ASN.                              16530000
165400                                                                  16540000
165500     MOVE WST00011-REC-TYP-DESC-TEXT  TO  WS004-ASN-REC.          16550000
165600     MOVE WS004-AH-SHIPMT-NBR         TO  ShipmentNb4.            16560000
165700     MOVE WS004-AH-WHSE               TO  ToLocatio4.             16570000
165800*dmh MOVE WS004-AH-ORGN-TYPE          TO  AsnTyp4.                16580000
165900                                                                  16590000
166000** REMOVE PER DENICE 3/5/2007                                     16600000
166100**   MOVE WS004-AH-BOL-NBR            TO  BillOfLading.           16610000
166200     MOVE WS004-AH-CARRIER-SHIP-VIA   TO  ShipVi4.                16620000
166300     MOVE WS004-AH-TRLR-NBR           TO  TrailerNumbe4.          16630000
166400     MOVE WS004-AH-TRIP-ID            TO  ContractorLocation.     16640000
166500                                                                  16650000
166600** REMOVE PER DENICE 3/5/2007                                     16660000
166700**   MOVE WS004-AH-PRO-NBR            TO  ProNbr.                 16670000
166800                                                                  16680000
166900     MOVE WS004-AH-SHIP-DATE(1:4)     TO  ShippedDate (1:4).      16690000
167000     MOVE '-'                         TO  ShippedDate (5:1)       16700000
167100                                          ShippedDate (8:1).      16710000
167200     MOVE WS004-AH-SHIP-DATE(5:2)     TO  ShippedDate (6:2).      16720000
167300     MOVE WS004-AH-SHIP-DATE(7:2)     TO  ShippedDate (9:2).      16730000
167400                                                                  16740000
167500     MOVE 'T'                         TO  ShippedDate (11:1).     16750000
167600     MOVE WS004-AH-SHIP-DATE(9:2)     TO  ShippedDate (12:2).     16760000
167700     MOVE ':'                         TO  ShippedDate (14:1)      16770000
167800                                          ShippedDate (17:1).     16780000
167900     MOVE WS004-AH-SHIP-DATE(11:2)    TO  ShippedDate (15:2).     16790000
168000     MOVE WS004-AH-SHIP-DATE(13:2)    TO  ShippedDate (18:2).     16800000
168100                                                                  16810000
168200     MOVE WS004-AH-EXPT-START-DATE (1:4)  TO                      16820000
168300                                      SchedStartRcvDate (1:4).    16830000
168400     MOVE '-'                         TO                          16840000
168500                                      SchedStartRcvDate (5:1)     16850000
168600                                      SchedStartRcvDate (8:1).    16860000
168700     MOVE WS004-AH-EXPT-START-DATE (5:2)  TO                      16870000
168800                                      SchedStartRcvDate (6:2).    16880000
168900     MOVE WS004-AH-EXPT-START-DATE (7:2)  TO                      16890000
169000                                      SchedStartRcvDate (9:2).    16900000
169100     MOVE 'T'                         TO                          16910000
169200                                      SchedStartRcvDate (11:1).   16920000
169300     MOVE WS004-AH-EXPT-START-DATE (9:2) TO                       16930000
169400                                      SchedStartRcvDate (12:2).   16940000
169500     MOVE ':'                         TO                          16950000
169600                                      SchedStartRcvDate (14:1)    16960000
169700                                      SchedStartRcvDate (17:1).   16970000
169800     MOVE WS004-AH-EXPT-START-DATE (11:2) TO                      16980000
169900                                      SchedStartRcvDate (15:2).   16990000
170000     MOVE WS004-AH-EXPT-START-DATE (13:2) TO                      17000000
170100                                      SchedStartRcvDate (18:2).   17010000
170200                                                                  17020000
170300     MOVE '0'                         TO  StatusCode.             17030000
170400     IF WS004-AH-VENDOR-SHIPMT                                    17040000
170500         IF WS004-AH-MISC-INSTR-1 = 'TR'                          17050000
170600             MOVE WS004-AH-MISC-INSTR-1   TO  MiscInstrCode1      17060000
170700         ELSE                                                     17070000
170800             PERFORM 3045-CHECK-EFC-TRBL-GRP-PARM                 17080000
170900         END-IF                                                   17090000
171000     ELSE                                                         17100000
171100         MOVE WS004-AH-MISC-INSTR-1   TO  MiscInstrCode1          17110000
171200     END-IF.                                                      17120000
171300     MOVE WS004-AH-HOST-INPT-ID       TO  BatchCtlNb4.            17130000
171400     MOVE WS004-AH-ORGN-TYPE          TO  ASNOriginalType.        17140000
171500                                                                  17150000
171600* JAK 06/2007 - ADD SWITCH FOR UPDATE OF XREF_HDR DWNLD_CDE       17160000
171700     IF WS004-AH-CANCEL                                           17170000
171800         SET PS-UPDATE-HDR-X          TO TRUE                     17180000
171900     END-IF.                                                      17190000
172000                                                                  17200000
172100     PERFORM 3050-GENERATE-XML-AH.                                17210000
172200                                                                  17220000
172300                                                                  17230000
172400****************************************************************  17240000
172500* THIS PARAGRAPH WILL BE PROCESSED ONLY FOR VENDOR SHIPMENTS.     17250000
172600* IF THE ASN IS GOING TO AN EFC WITH A PARM INDICATING THAT       17260000
172700* TROUBLE IS BASED ON THE ENTIRE SHIPMENT GROUP (INCLUDES         17270000
172800* DUMMIES) THEN SET THE TROUBLE INDICATOR ON IF ANY OF THE        17280000
172900* SHIPMENTS HAVE THE TROUBLE INDICATOR ON.                        17290000
173000* INITIALLY, THIS LOGIC IS REQUIRED FOR EFC5 ONLY.                17300000
173100****************************************************************  17310000
173200 3045-CHECK-EFC-TRBL-GRP-PARM.                                    17320000
173300                                                                  17330000
173400     IF PS-CICS-SWITCH-YES                                        17340000
173500        INITIALIZE PV-CICS-MSG-AREA                               17350000
173600        STRING   ' ' WS006-SRC-TASK-NUMBER                        17360000
173700                 ' WSKCS302-3045:'                                17370000
173800                 ' ' WS006-OPER-UNT-ID                            17380000
173900                 ' ' WS006-EXT-SHP-ID (1:15)                      17390000
174000                 ' ' WS006-USERID                                 17400000
174100                 ' SQLCODE=' PV-DISP-SQLCODE                      17410000
174200                 ' 3045-CHECK-EFC-TRBL-GRP-PARM '                 17420000
174300                   DELIMITED BY SIZE                              17430000
174400                      INTO PV-CICS-MSG-AREA                       17440000
174500        PERFORM 9900-WRITE-TO-CICS-LOG                            17450000
174600     END-IF.                                                      17460000
174700     MOVE WS004-AH-WHSE  TO  PV-WHSE.                             17470000
174800     MOVE PV-WHSE-REDEF  TO  PV-WHSE-NUM.                         17480000
174900                                                                  17490000
175000     EXEC SQL                                                     17500000
175100        SELECT  FUNC_TXT                                          17510000
175200          INTO :PV-FUNC-TXT                                       17520000
175300          FROM  TKRPRPM                                           17530000
175400         WHERE  LOC_ID            = :PV-WHSE-NUM                  17540000
175500           AND  INTFC_SYS_CDE     = 'KHL'                         17550000
175600           AND  SYS_PRC_FUNC_CDE  = 'EFCTRB'                      17560000
175700           AND  FUNC_PRC_STAT_CDE = 'AC'                          17570000
175800           AND  FUNC_BEG_TMST    <= CURRENT TIMESTAMP             17580000
175900           AND  FUNC_END_TMST    >= CURRENT TIMESTAMP             17590000
176000     END-EXEC.                                                    17600000
176100                                                                  17610000
176200     EVALUATE TRUE                                                17620000
176300       WHEN SQLCODE = ZERO                                        17630000
176400           IF PV-FUNC-TXT  = 'Y'                                  17640000
176500               PERFORM 3047-CHECK-EFC-TRBL-FOR-GRP                17650000
176600           ELSE                                                   17660000
176700               MOVE WS004-AH-MISC-INSTR-1   TO  MiscInstrCode1    17670000
176800           END-IF                                                 17680000
176900       WHEN SQLCODE = +100                                        17690000
177000           MOVE WS004-AH-MISC-INSTR-1  TO  MiscInstrCode1         17700000
177100       WHEN SQLCODE NOT EQUAL ZERO                                17710000
177200            MOVE '3045-CHECK-EFC-TRBL-GRP-PARM'                   17720000
177300                                       TO WS006-SQL-ERROR-PARA    17730000
177400            MOVE '2'                   TO WS006-SUCCESS-IND       17740000
177500            MOVE SQLCODE               TO WS006-SQLCODE           17750000
177600               INITIALIZE PV-CICS-MSG-AREA                        17760000
177700               MOVE SQLCODE            TO PV-DISP-SQLCODE         17770000
177800               STRING   ' ' WS006-SRC-TASK-NUMBER                 17780000
177900                        ' WSKCS302-3045:'                         17790000
178000                        ' ' WS006-OPER-UNT-ID                     17800000
178100                        ' ' WS006-EXT-SHP-ID (1:15)               17810000
178200                        ' ' WS006-USERID                          17820000
178300                        ' ' WS004-AH-WHSE                         17830000
178400                        ' SQLCODE=' PV-DISP-SQLCODE               17840000
178500                        DELIMITED BY SIZE                         17850000
178600                        INTO PV-CICS-MSG-AREA                     17860000
178700              PERFORM 9900-WRITE-TO-CICS-LOG                      17870000
178800            PERFORM 8995-RETURN                                   17880000
178900     END-EVALUATE.                                                17890000
179000                                                                  17900000
179100****************************************************************  17910000
179200*   USING THE HEADER CASE NUMBER RETRIEVE THE SSCC NUMBER         17920000
179300****************************************************************  17930000
179400 3046-RETRIEVE-SSCC.                                              17940000
179500                                                                  17950000
179600     EXEC SQL                                                     17960000
179700        SELECT ORIG_CART_ID                                       17970000
179800          INTO :SUT00024-ORIG-CART-ID                             17980000
179900          FROM SUT_OTBND_CART                                     17990000
180000         WHERE SHIPT_UNT_ID  = :PV-CASE-SML-COMP                  18000000
180100     END-EXEC.                                                    18010000
180200                                                                  18020000
180300     EVALUATE TRUE                                                18030000
180400       WHEN SQLCODE = ZERO                                        18040000
180500           MOVE '00'                  TO PV-XML-CASE-EXPAND (1:2) 18050000
180600           MOVE SUT00024-ORIG-CART-ID TO PV-XML-CASE-EXPAND (3:18)18060000
180700                                                                  18070000
180800       WHEN SQLCODE = +100                                        18080000
180900           MOVE PC-XML-ZEROES         TO PV-XML-CASE-EXPAND       18090000
181000                                                                  18100000
181100       WHEN SQLCODE NOT EQUAL ZERO                                18110000
181200           MOVE '3046-RETRIEVE-SSCC'  TO WS006-SQL-ERROR-PARA     18120000
181300           MOVE '2'                   TO WS006-SUCCESS-IND        18130000
181400           MOVE SQLCODE               TO WS006-SQLCODE            18140000
181500           INITIALIZE PV-CICS-MSG-AREA                            18150000
181600           MOVE SQLCODE               TO PV-DISP-SQLCODE          18160000
181700           STRING   ' ' WS006-SRC-TASK-NUMBER                     18170000
181800                    ' WSKCS302-3046:'                             18180000
181900                    ' ' WS006-OPER-UNT-ID                         18190000
182000                    ' ' WS006-EXT-SHP-ID (1:15)                   18200000
182100                    ' ' WS006-USERID                              18210000
182200                    ' ' WS004-AH-WHSE                             18220000
182300                    ' SQLCODE=' PV-DISP-SQLCODE                   18230000
182400                      DELIMITED BY SIZE                           18240000
182500                      INTO PV-CICS-MSG-AREA                       18250000
182600           PERFORM 9900-WRITE-TO-CICS-LOG                         18260000
182700           PERFORM 8995-RETURN                                    18270000
182800     END-EVALUATE.                                                18280000
182900                                                                  18290000
183000****************************************************************  18300000
183100* THIS PARAGRAPH WILL BE PROCESSED ONLY FOR VENDOR SHIPMENTS      18310000
183200* IF THE ASN IS GOING TO AN EFC WITH A PARM INDICATING THAT       18320000
183300* TROUBLE IS BASED ON THE ENTIRE SHIPMENT GROUP (INCLUDES         18330000
183400* DUMMIES).  THIS PARAGRAPH WILL CHECK IF ANY ROWS IN THE         18340000
183500* SHIPMENT GROUP HAVE THE TROUBLE INDICATOR ON - IF ANY ARE FOUND 18350000
183600* THE TROUBLE INDICATOR WILL BE TURNED ON.                        18360000
183700* INITIALLY, THIS LOGIC IS REQUIRED FOR EFC5.                     18370000
183800****************************************************************  18380000
183900 3047-CHECK-EFC-TRBL-FOR-GRP.                                     18390000
184000                                                                  18400000
184100     IF PS-CICS-SWITCH-YES                                        18410000
184200        INITIALIZE PV-CICS-MSG-AREA                               18420000
184300        STRING   ' ' WS006-SRC-TASK-NUMBER                        18430000
184400                 ' WSKCS302-3047:'                                18440000
184500                 ' ' WS006-OPER-UNT-ID                            18450000
184600                 ' ' WS006-EXT-SHP-ID (1:15)                      18460000
184700                 ' ' WS006-USERID                                 18470000
184800                 ' SQLCODE=' PV-DISP-SQLCODE                      18480000
184900                 ' 3047-CHECK-EFC-TRBL-FOR-GRP '                  18490000
185000                   DELIMITED BY SIZE                              18500000
185100                      INTO PV-CICS-MSG-AREA                       18510000
185200        PERFORM 9900-WRITE-TO-CICS-LOG                            18520000
185300     END-IF.                                                      18530000
185400                                                                  18540000
185500     MOVE WS004-AH-TRIP-ID         TO DK-TRIP-ID.                 18550000
185600                                                                  18560000
185700     EXEC SQL                                                     18570000
185800        SELECT 1                                                  18580000
185900          INTO :PV-TROUBLE-COUNT                                  18590000
186000          FROM TSHPTPO A                                          18600000
186100              ,TSHIPMT B                                          18610000
186200              ,TRECEIV C                                          18620000
186300              ,TTRBNTF D                                          18630000
186400              ,TTRBRSN E                                          18640000
186500         WHERE B.TRIP_ID         = :DK-TRIP-ID                    18650000
186600           AND A.SHIPT_ID        = B.SHIPT_ID                     18660000
186700           AND A.PO_NBR          = C.ORD_NBR                      18670000
186800           AND A.REC_SEQ_NBR     = C.REC_SEQ_NBR                  18680000
186900           AND C.VER_STATUS_CDE  = 'A'                            18690000
187000           AND D.PO_NBR          = A.PO_NBR                       18700000
187100           AND D.REC_SEQ_NBR     = A.REC_SEQ_NBR                  18710000
187200           AND D.RESOLVED_IND   IN ('N','I','R')                  18720000
187300           AND D.TRBL_RSN_CDE    = E.TRBL_RSN_CDE                 18730000
187400           AND E.NOTIF_IND       = 'T'                            18740000
187500           AND NOT EXISTS                                         18750000
187600               ( SELECT 1                                         18760000
187700                 FROM  TTRBRCN F                                  18770000
187800                 WHERE F.RPT_PGM_NM    =  'WSKCS301'              18780000
187900                   AND D.TRBL_RSN_CDE  =  F.TRBL_RSN_CDE )        18790000
188000         FETCH FIRST 1 ROW ONLY                                   18800000
188100       WITH UR                                                    18810000
188200     END-EXEC.                                                    18820000
188300                                                                  18830000
188400     EVALUATE TRUE                                                18840000
188500       WHEN SQLCODE = ZERO                                        18850000
188600         OR SQLCODE = -811                                        18860000
188700            MOVE 'TR'                  TO MiscInstrCode1          18870000
188800            INITIALIZE PV-CICS-MSG-AREA                           18880000
188900            STRING ' WSKCS302 SETTING TR FOR GROUP TROUBLE'       18890000
189000                   ' FOR TRIP ID ' WS004-AH-TRIP-ID               18900000
189100                   ' SHIP ID ' WS006-EXT-SHP-ID                   18910000
189200                DELIMITED BY SIZE                                 18920000
189300                   INTO PV-CICS-MSG-AREA                          18930000
189400            PERFORM 9900-WRITE-TO-CICS-LOG                        18940000
189500       WHEN SQLCODE = +100                                        18950000
189600            MOVE WS004-AH-MISC-INSTR-1 TO MiscInstrCode1          18960000
189700       WHEN SQLCODE NOT EQUAL ZERO                                18970000
189800            MOVE '3047-CHECK-EFC-TRBL-FOR-GRP '                   18980000
189900                                       TO WS006-SQL-ERROR-PARA    18990000
190000            MOVE '2'                   TO WS006-SUCCESS-IND       19000000
190100            MOVE SQLCODE               TO WS006-SQLCODE           19010000
190200            INITIALIZE PV-CICS-MSG-AREA                           19020000
190300            MOVE SQLCODE            TO PV-DISP-SQLCODE            19030000
190400            STRING   ' ' WS006-SRC-TASK-NUMBER                    19040000
190500                     ' WSKCS302-3047:'                            19050000
190600                     ' ' WS006-OPER-UNT-ID                        19060000
190700                     ' ' WS006-EXT-SHP-ID (1:15)                  19070000
190800                     ' ' WS006-USERID                             19080000
190900                     ' SQLCODE=' PV-DISP-SQLCODE                  19090000
191000                     DELIMITED BY SIZE                            19100000
191100                     INTO PV-CICS-MSG-AREA                        19110000
191200            PERFORM 9900-WRITE-TO-CICS-LOG                        19120000
191300            PERFORM 8995-RETURN                                   19130000
191400     END-EVALUATE.                                                19140000
191500                                                                  19150000
191600                                                                  19160000
191700                                                                  19170000
191800                                                                  19180000
191900****************************************************************  19190000
192000*   GENERATE XML ASN HEADER                                       19200000
192100****************************************************************  19210000
192200 3050-GENERATE-XML-AH.                                            19220000
192300                                                                  19230000
192400     IF PS-CICS-SWITCH-YES                                        19240000
192500        INITIALIZE PV-CICS-MSG-AREA                               19250000
192600        STRING   ' ' WS006-SRC-TASK-NUMBER                        19260000
192700                 ' WSKCS302-3050:'                                19270000
192800                 ' ' WS006-OPER-UNT-ID                            19280000
192900                 ' ' WS006-EXT-SHP-ID (1:15)                      19290000
193000                 ' ' WS006-USERID                                 19300000
193100                 ' SQLCODE=' PV-DISP-SQLCODE                      19310000
193200                 ' 3050-GENERATE-XML-AH    '                      19320000
193300                   DELIMITED BY SIZE                              19330000
193400                      INTO PV-CICS-MSG-AREA                       19340000
193500        PERFORM 9900-WRITE-TO-CICS-LOG                            19350000
193600     END-IF.                                                      19360000
193700                                                                  19370000
193800     MOVE SPACES TO PV-XML.                                       19380000
193900                                                                  19390000
194000     XML GENERATE PV-XML                                          19400000
194100         FROM InboundASNBridg4                                    19410000
194200         COUNT IN XML-LENGTH                                      19420000
194300         ON EXCEPTION                                             19430000
194400             PERFORM 8500-XML-ERROR                               19440000
194500         NOT ON EXCEPTION                                         19450000
194600             ADD +1 TO PV-XML-OUT                                 19460000
194700             PERFORM 8600-REPLACE-XML                             19470000
194800             PERFORM 8700-XML-SUCCESS                             19480000
194900     END-XML.                                                     19490000
195000                                                                  19500000
195100     PERFORM 2400-CREATE-XML-BANNER.                              19510000
195200     ADD 1 TO PV-AH-XML.                                          19520000
195300                                                                  19530000
195400     IF PS-WRITE-MQ-YES                                           19540000
195500        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         19550000
195600     END-IF.                                                      19560000
195700                                                                  19570000
195800****************************************************************  19580000
195900*   BUILD ASN DETAIL XML (RECORD TYPE 'AD')                    *  19590000
196000****************************************************************  19600000
196100 3060-RECORD-TYPE-AD.                                             19610000
196200                                                                  19620000
196300     IF PS-CICS-SWITCH-YES                                        19630000
196400        INITIALIZE PV-CICS-MSG-AREA                               19640000
196500        STRING   ' ' WS006-SRC-TASK-NUMBER                        19650000
196600                 ' WSKCS302-3060:'                                19660000
196700                 ' ' WS006-OPER-UNT-ID                            19670000
196800                 ' ' WS006-EXT-SHP-ID (1:15)                      19680000
196900                 ' ' WS006-USERID                                 19690000
197000                 ' SQLCODE=' PV-DISP-SQLCODE                      19700000
197100                 ' 3060-RECORD-TYPE-AD     '                      19710000
197200                   DELIMITED BY SIZE                              19720000
197300                      INTO PV-CICS-MSG-AREA                       19730000
197400        PERFORM 9900-WRITE-TO-CICS-LOG                            19740000
197500     END-IF.                                                      19750000
197600                                                                  19760000
197700     IF CH-SUB > ZEROS                                            19770000
197800        PERFORM 3010-GENERATE-XML-CH                              19780000
197900        MOVE WST00011-CSE-DTL-NBR TO PV-LAST-CSE-DTL-NBR          19790000
198000     END-IF.                                                      19800000
198100                                                                  19810000
198200     IF PV-AH-CNT = ZEROS                                         19820000
198300        PERFORM 2300-CALCULATE-MAX-ASN                            19830000
198400     END-IF.                                                      19840000
198500                                                                  19850000
198600     ADD +1 TO PV-AD-CNT.                                         19860000
198700                                                                  19870000
198800     IF AD-SUB    = PV-MAX-ASN                                    19880000
198900        PERFORM 3070-GENERATE-XML-AD                              19890000
199000     END-IF.                                                      19900000
199100                                                                  19910000
199200**   IF WST00011-CSE-DTL-NBR     NOT = PV-LAST-CSE-DTL-NBR        19920000
199300**      PERFORM 3070-GENERATE-XML-AD                              19930000
199400**      MOVE WST00011-CSE-DTL-NBR   TO PV-LAST-CSE-DTL-NBR        19940000
199500**   END-IF.                                                      19950000
199600                                                                  19960000
199700     ADD 1 TO AD-SUB.                                             19970000
199800                                                                  19980000
199900     MOVE WST00011-REC-TYP-DESC-TEXT  TO  WS005-ASN-DTL-REC.      19990000
200000                                                                  20000000
200100     IF WS005-AD-SHIPMT-NBR            =  ShipmentNb3             20010000
200200        CONTINUE                                                  20020000
200300     ELSE                                                         20030000
200400        MOVE WS005-AD-SHIPMT-NBR      TO  ShipmentNb3             20040000
200500        ADD 1                         TO PV-SHIP-CNT-AD           20050000
200600     END-IF.                                                      20060000
200700                                                                  20070000
200800     MOVE WS005-AD-WHSE               TO  ToLocatio3.             20080000
200900     MOVE WS005-AD-ORGN-TYPE          TO  AsnTyp3.                20090000
201000                                                                  20100000
201100     MOVE '01'                        TO  Compan3(AD-SUB).        20110000
201200     MOVE '01'                        TO  Divisio3(AD-SUB).       20120000
201300     MOVE WS005-AD-SKU-NBR            TO  StyleSuffi3(AD-SUB).    20130000
201400                                                                  20140000
201500     MOVE WS005-AD-SKU-ID             TO  SkuI3(AD-SUB).          20150000
201600     MOVE PV-SHIP-CNT-AD              TO  SequenceNbr(AD-SUB).    20160000
201700     MOVE WS005-AD-UNITS-SHIPPED      TO  UnitsShipped(AD-SUB).   20170000
201800     MOVE 'F'                         TO  InventoryTyp3(AD-SUB).  20180000
201900     MOVE WS005-AD-PO-NBR             TO  PONb3(AD-SUB).          20190000
202000     MOVE WS005-AS-IMMED-NEEDS        TO  ProcessImmdNeed3        20200000
202100                                          (AD-SUB).               20210000
202200     MOVE 'N'                         TO  QcHoldUponReceipt       20220000
202300                                          (AD-SUB).               20230000
202400     MOVE WS005-AD-ACTION-CODE        TO  ActionCode(AD-SUB).     20240000
202500     MOVE WS005-AD-PO-LINE-NBR        TO  POLineNbr(AD-SUB).      20250000
202600     MOVE WS005-AD-TRIP-ID            TO  PrePackGroupCode        20260000
202700                                          (AD-SUB).               20270000
202800     MOVE WS005-AD-VENDOR-ID          TO  VendorI3(AD-SUB).       20280000
202900     MOVE WS005-AD-RCVR-SEQ-NBR       TO  TotalUnloadTime(AD-SUB).20290000
203000     MOVE WS005-AD-HOST-INPT-ID       TO  BatchCtlNb3.            20300000
203100                                                                  20310000
203200     ADD 1 TO ASN-DTL-COUNT.                                      20320000
203300                                                                  20330000
203400****************************************************************  20340000
203500*   GENERATE XML ASN DETAIL                                       20350000
203600****************************************************************  20360000
203700 3070-GENERATE-XML-AD.                                            20370000
203800                                                                  20380000
203900     IF PS-CICS-SWITCH-YES                                        20390000
204000        INITIALIZE PV-CICS-MSG-AREA                               20400000
204100        STRING   ' ' WS006-SRC-TASK-NUMBER                        20410000
204200                 ' WSKCS302-3070:'                                20420000
204300                 ' ' WS006-OPER-UNT-ID                            20430000
204400                 ' ' WS006-EXT-SHP-ID (1:15)                      20440000
204500                 ' ' WS006-USERID                                 20450000
204600                 ' SQLCODE=' PV-DISP-SQLCODE                      20460000
204700                 ' 3070-GENERATE-XML-AD    '                      20470000
204800                   DELIMITED BY SIZE                              20480000
204900                      INTO PV-CICS-MSG-AREA                       20490000
205000        PERFORM 9900-WRITE-TO-CICS-LOG                            20500000
205100     END-IF.                                                      20510000
205200                                                                  20520000
205300     MOVE SPACES TO PV-XML.                                       20530000
205400                                                                  20540000
205500     XML GENERATE PV-XML                                          20550000
205600         FROM InboundASNBridg3                                    20560000
205700         COUNT IN XML-LENGTH                                      20570000
205800         ON EXCEPTION                                             20580000
205900             PERFORM 8500-XML-ERROR                               20590000
206000         NOT ON EXCEPTION                                         20600000
206100             ADD +1 TO PV-XML-OUT                                 20610000
206200             PERFORM 8600-REPLACE-XML                             20620000
206300             PERFORM 8700-XML-SUCCESS                             20630000
206400     END-XML.                                                     20640000
206500                                                                  20650000
206600     MOVE AD-SUB TO ASN-DTL-COUNT.                                20660000
206700     PERFORM WITH TEST AFTER VARYING AD-SUB FROM 1 BY 1           20670000
206800             UNTIL AD-SUB = ASN-DTL-COUNT                         20680000
206900                OR AD-SUB > ASN-DTL-COUNT                         20690000
207000             MOVE SPACES TO ASNDetail (AD-SUB)                    20700000
207100     END-PERFORM.                                                 20710000
207200                                                                  20720000
207300     MOVE ZEROS TO AD-SUB                                         20730000
207400                   ASN-DTL-COUNT.                                 20740000
207500                                                                  20750000
207600     PERFORM 2400-CREATE-XML-BANNER.                              20760000
207700     ADD 1 TO PV-AD-XML.                                          20770000
207800                                                                  20780000
207900     IF PS-WRITE-MQ-YES                                           20790000
208000        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         20800000
208100     END-IF.                                                      20810000
208200                                                                  20820000
208300****************************************************************  20830000
208400*   BUILD APPOINTMENT XML (RECORD TYPE 'AP')                   *  20840000
208500****************************************************************  20850000
208600 3080-RECORD-TYPE-AP.                                             20860000
208700                                                                  20870000
208800     IF PS-CICS-SWITCH-YES                                        20880000
208900        INITIALIZE PV-CICS-MSG-AREA                               20890000
209000        STRING   ' ' WS006-SRC-TASK-NUMBER                        20900000
209100                 ' WSKCS302-3080:'                                20910000
209200                 ' ' WS006-OPER-UNT-ID                            20920000
209300                 ' ' WS006-EXT-SHP-ID (1:15)                      20930000
209400                 ' ' WS006-USERID                                 20940000
209500                 ' SQLCODE=' PV-DISP-SQLCODE                      20950000
209600                 ' 3080-RECORD-TYPE-AP     '                      20960000
209700                   DELIMITED BY SIZE                              20970000
209800                      INTO PV-CICS-MSG-AREA                       20980000
209900        PERFORM 9900-WRITE-TO-CICS-LOG                            20990000
210000     END-IF.                                                      21000000
210100                                                                  21010000
210200     IF CH-SUB > ZEROS                                            21020000
210300        PERFORM 3010-GENERATE-XML-CH                              21030000
210400     END-IF.                                                      21040000
210500                                                                  21050000
210600     IF AD-SUB > ZEROS                                            21060000
210700        PERFORM 3070-GENERATE-XML-AD                              21070000
210800     END-IF.                                                      21080000
210900                                                                  21090000
211000     ADD +1 TO PV-AP-CNT.                                         21100000
211100     MOVE WST00011-REC-TYP-DESC-TEXT  TO WS008-APPOINTMENT-REC.   21110000
211200                                                                  21120000
211300     MOVE 'I'                         TO  ShipmentType.           21130000
211400     MOVE WS008-AP-SHIPMT-NBR         TO  ShipmentNb5.            21140000
211500     MOVE WS008-AP-WHSE               TO  Warehous5.              21150000
211600     MOVE '40'                        TO  FirmApptIndic.          21160000
211700                                                                  21170000
211800     MOVE WS008-AP-EXPCT-STRT-DT-TM (1:4)                         21180000
211900                                      TO ExpectStartDate(1:4).    21190000
212000     MOVE '-'                         TO ExpectStartDate(5:1)     21200000
212100                                         ExpectStartDate(8:1).    21210000
212200     MOVE WS008-AP-EXPCT-STRT-DT-TM (5:2)                         21220000
212300                                      TO ExpectStartDate(6:2).    21230000
212400     MOVE WS008-AP-EXPCT-STRT-DT-TM (7:2)                         21240000
212500                                      TO ExpectStartDate(9:2).    21250000
212600                                                                  21260000
212700     MOVE 'T'                         TO ExpectStartDate(11:1).   21270000
212800     MOVE WS008-AP-EXPCT-STRT-DT-TM (9:2)                         21280000
212900                                      TO ExpectStartDate(12:2).   21290000
213000     MOVE ':'                         TO ExpectStartDate(14:1)    21300000
213100                                         ExpectStartDate(17:1).   21310000
213200     MOVE WS008-AP-EXPCT-STRT-DT-TM (11:2)                        21320000
213300                                      TO ExpectStartDate(15:2).   21330000
213400     MOVE WS008-AP-EXPCT-STRT-DT-TM (13:2)                        21340000
213500                                      TO ExpectStartDate(18:2).   21350000
213600                                                                  21360000
213700     MOVE WS008-AP-APPT-PRTY          TO  ApptPriority.           21370000
213800     MOVE WS008-AP-TRLR-NBR           TO  TrailerNb5.             21380000
213900** REMOVE PER DENICE 3/5/2007                                     21390000
214000**   MOVE WS008-AP-BOL                TO  BOL.                    21400000
214100** REMOVE PER DENICE 3/5/2007                                     21410000
214200**   MOVE WS008-AP-PRO-NBR            TO  ProNb5.                 21420000
214300     MOVE WS008-AP-STATUS-CODE        TO  StatusCod5.             21430000
214400     MOVE '0'                         TO  MaxSitDrn.              21440000
214500     MOVE WS008-AP-SCAC               TO  ShipVi5.                21450000
214600     MOVE WS008-AP-SEAL-NBR           TO  PromptSealNbr.          21460000
214700                                                                  21470000
214800     MOVE WS008-AP-CREATE-TMST (1:4)  TO  DateCreated (1:4).      21480000
214900     MOVE '-'                         TO  DateCreated (5:1)       21490000
215000                                          DateCreated (8:1).      21500000
215100     MOVE WS008-AP-CREATE-TMST (6:2)  TO  DateCreated (6:2).      21510000
215200     MOVE WS008-AP-CREATE-TMST (9:2)  TO  DateCreated (9:2).      21520000
215300     MOVE 'T'                         TO  DateCreated (11:1).     21530000
215400     MOVE WS008-AP-CREATE-TMST (12:2) TO  DateCreated (12:2).     21540000
215500     MOVE ':'                         TO  DateCreated (14:1)      21550000
215600                                          DateCreated (17:1).     21560000
215700     MOVE WS008-AP-CREATE-TMST (15:2) TO  DateCreated (15:2).     21570000
215800     MOVE WS008-AP-CREATE-TMST (18:2) TO  DateCreated (18:2).     21580000
215900     MOVE SPACE                       TO  DateCreated (20:1).     21590000
216000                                                                  21600000
216100     PERFORM 3090-GENERATE-XML-AP.                                21610000
216200                                                                  21620000
216300****************************************************************  21630000
216400*   GENERATE XML APPOINTMENT                                      21640000
216500****************************************************************  21650000
216600 3090-GENERATE-XML-AP.                                            21660000
216700                                                                  21670000
216800     IF PS-CICS-SWITCH-YES                                        21680000
216900        INITIALIZE PV-CICS-MSG-AREA                               21690000
217000        STRING   ' ' WS006-SRC-TASK-NUMBER                        21700000
217100                 ' WSKCS302-3090:'                                21710000
217200                 ' ' WS006-OPER-UNT-ID                            21720000
217300                 ' ' WS006-EXT-SHP-ID (1:15)                      21730000
217400                 ' ' WS006-USERID                                 21740000
217500                 ' SQLCODE=' PV-DISP-SQLCODE                      21750000
217600                 ' 3090-GENERATE-XML-AP    '                      21760000
217700                   DELIMITED BY SIZE                              21770000
217800                      INTO PV-CICS-MSG-AREA                       21780000
217900        PERFORM 9900-WRITE-TO-CICS-LOG                            21790000
218000     END-IF.                                                      21800000
218100                                                                  21810000
218200     MOVE SPACES TO PV-XML.                                       21820000
218300                                                                  21830000
218400     XML GENERATE PV-XML                                          21840000
218500         FROM ApptScheduleBridge                                  21850000
218600         COUNT IN XML-LENGTH                                      21860000
218700         ON EXCEPTION                                             21870000
218800             PERFORM 8500-XML-ERROR                               21880000
218900         NOT ON EXCEPTION                                         21890000
219000             ADD +1 TO PV-XML-OUT                                 21900000
219100             PERFORM 8600-REPLACE-XML                             21910000
219200             PERFORM 8700-XML-SUCCESS                             21920000
219300     END-XML.                                                     21930000
219400                                                                  21940000
219500     PERFORM 2400-CREATE-XML-BANNER.                              21950000
219600     ADD   1  TO PV-AP-XML.                                       21960000
219700                                                                  21970000
219800     IF PS-WRITE-MQ-YES                                           21980000
219900        PERFORM 1400-PUT-MQ-MESG-ON-QUEUE                         21990000
220000     END-IF.                                                      22000000
220100                                                                  22010000
220200****************************************************************  22020000
220300*   UPDATE CONTROL TABLE                                       *  22030000
220400****************************************************************  22040000
220500 7500-UPDATE-CONTROL.                                             22050000
220600                                                                  22060000
220700     IF PS-CICS-SWITCH-YES                                        22070000
220800        INITIALIZE PV-CICS-MSG-AREA                               22080000
220900        STRING   ' ' WS006-SRC-TASK-NUMBER                        22090000
221000                 ' WSKCS302-7500:'                                22100000
221100                 ' ' WS006-OPER-UNT-ID                            22110000
221200                 ' ' WS006-EXT-SHP-ID (1:15)                      22120000
221300                 ' ' WS006-USERID                                 22130000
221400                 ' SQLCODE=' PV-DISP-SQLCODE                      22140000
221500                 ' 7500-UPDATE-CONTROL     '                      22150000
221600                   DELIMITED BY SIZE                              22160000
221700                      INTO PV-CICS-MSG-AREA                       22170000
221800        PERFORM 9900-WRITE-TO-CICS-LOG                            22180000
221900     END-IF.                                                      22190000
222000                                                                  22200000
222100     INITIALIZE DCLWST00003.                                      22210000
222200     MOVE WS006-TRN-TYP-CDE     TO WST00003-TRN-TYP-CDE.          22220000
222300     MOVE WS006-PRC-GP-ID       TO WST00003-PRC-GP-ID.            22230000
222400                                                                  22240000
222500     EXEC SQL                                                     22250000
222600          UPDATE WST_DAT_CNTL                                     22260000
222700          SET    STAT_CDE        = 'CMPLTD'                       22270000
222800                ,END_PRC_TMST    =  CURRENT TIMESTAMP             22280000
222900          WHERE  TRN_TYP_CDE     = :WST00003-TRN-TYP-CDE          22290000
223000            AND  PRC_GP_ID       = :WST00003-PRC-GP-ID            22300000
223100     END-EXEC.                                                    22310000
223200                                                                  22320000
223300     EVALUATE TRUE                                                22330000
223400       WHEN SQLCODE = ZERO                                        22340000
223500       WHEN SQLCODE = +100                                        22350000
223600            CONTINUE                                              22360000
223700       WHEN SQLCODE NOT EQUAL ZERO                                22370000
223800            MOVE '7500-UPDATE-CONTROL' TO WS006-SQL-ERROR-PARA    22380000
223900            MOVE '2'                   TO WS006-SUCCESS-IND       22390000
224000            MOVE SQLCODE               TO WS006-SQLCODE           22400000
224100               INITIALIZE PV-CICS-MSG-AREA                        22410000
224200               MOVE SQLCODE   TO PV-DISP-SQLCODE                  22420000
224300               STRING   ' ' WS006-SRC-TASK-NUMBER                 22430000
224400                        ' WSKCS302-7500:'                         22440000
224500                        ' ' WS006-OPER-UNT-ID                     22450000
224600                        ' ' WS006-EXT-SHP-ID (1:15)               22460000
224700                        ' ' WS006-USERID                          22470000
224800                        ' SQLCODE=' PV-DISP-SQLCODE               22480000
224900                        DELIMITED BY SIZE                         22490000
225000                        INTO PV-CICS-MSG-AREA                     22500000
225100              PERFORM 9900-WRITE-TO-CICS-LOG                      22510000
225200               MOVE WS006-PRC-GP-ID TO PV-DISP-PRC-GP-ID          22520000
225300               STRING   ' ' WS006-SRC-TASK-NUMBER                 22530000
225400                        ' WSKCS302-7500:'                         22540000
225500                        ' WS006-TRN-TYP-CDE'                      22550000
225600                        ' ' WS006-TRN-TYP-CDE                     22560000
225700                        ' WS006-PRC-GP-ID'                        22570000
225800                        ' ' PV-DISP-PRC-GP-ID                     22580000
225900                        DELIMITED BY SIZE                         22590000
226000                        INTO PV-CICS-MSG-AREA                     22600000
226100              PERFORM 9900-WRITE-TO-CICS-LOG                      22610000
226200          PERFORM 8995-RETURN                                     22620000
226300     END-EVALUATE.                                                22630000
226400                                                                  22640000
226500****************************************************************  22650000
226600*   UPDATE HEADER TABLE                                           22660000
226700****************************************************************  22670000
226800 7600-UPDATE-HEADER.                                              22680000
226900                                                                  22690000
227000     IF PS-CICS-SWITCH-YES                                        22700000
227100        INITIALIZE PV-CICS-MSG-AREA                               22710000
227200        STRING   ' ' WS006-SRC-TASK-NUMBER                        22720000
227300                 ' WSKCS302-7600:'                                22730000
227400                 ' ' WS006-OPER-UNT-ID                            22740000
227500                 ' ' WS006-EXT-SHP-ID (1:15)                      22750000
227600                 ' ' WS006-USERID                                 22760000
227700                 ' SQLCODE=' PV-DISP-SQLCODE                      22770000
227800                 ' 7600-UPDATE-HEADER      '                      22780000
227900                   DELIMITED BY SIZE                              22790000
228000                      INTO PV-CICS-MSG-AREA                       22800000
228100        PERFORM 9900-WRITE-TO-CICS-LOG                            22810000
228200     END-IF.                                                      22820000
228300                                                                  22830000
228400     INITIALIZE DCLWST00001.                                      22840000
228500                                                                  22850000
228600     MOVE WS006-EXT-SHP-ID        TO WST00001-EXT-SHP-ID.         22860000
228700                                                                  22870000
228800     EXEC SQL                                                     22880000
228900          SELECT DWNLD_TMST                                       22890000
229000                ,DWNLD_CDE                                        22900000
229100                ,SOR_CDE                                          22910000
229200          INTO   :WST00001-DWNLD-TMST                             22920000
229300                ,:WST00001-DWNLD-CDE                              22930000
229400                ,:WST00001-SOR-CDE                                22940000
229500          FROM   WST_SHPMT_XREF_HDR                               22950000
229600          WHERE  EXT_SHP_ID   = :WST00001-EXT-SHP-ID              22960000
229700     END-EXEC.                                                    22970000
229800                                                                  22980000
229900     EVALUATE TRUE                                                22990000
230000       WHEN SQLCODE = ZERO                                        23000000
230100            CONTINUE                                              23010000
230200       WHEN SQLCODE NOT EQUAL ZERO                                23020000
230300            MOVE '7600-UPDATE-HEADER ' TO WS006-SQL-ERROR-PARA    23030000
230400            MOVE '2'                   TO WS006-SUCCESS-IND       23040000
230500            MOVE SQLCODE               TO WS006-SQLCODE           23050000
230600               INITIALIZE PV-CICS-MSG-AREA                        23060000
230700               MOVE SQLCODE            TO PV-DISP-SQLCODE         23070000
230800               STRING   ' ' WS006-SRC-TASK-NUMBER                 23080000
230900                        ' WSKCS302-7600:'                         23090000
231000                        ' ' WS006-OPER-UNT-ID                     23100000
231100                        ' ' WS006-EXT-SHP-ID (1:15)               23110000
231200                        ' ' WS006-USERID                          23120000
231300                        ' SQLCODE=' PV-DISP-SQLCODE               23130000
231400                        DELIMITED BY SIZE                         23140000
231500                        INTO PV-CICS-MSG-AREA                     23150000
231600              PERFORM 9900-WRITE-TO-CICS-LOG                      23160000
231700            PERFORM 8995-RETURN                                   23170000
231800     END-EVALUATE.                                                23180000
231900                                                                  23190000
232000     EVALUATE WST00001-DWNLD-CDE                                  23200000
232100        WHEN 'N'                                                  23210000
232200           MOVE 'C' TO WST00001-DWNLD-CDE                         23220000
232300        WHEN 'P'                                                  23230000
232400              IF WS006-TROUBLE-SHPMT                              23240000
232500                 CONTINUE                                         23250000
232600              ELSE                                                23260000
232700                 MOVE 'C' TO WST00001-DWNLD-CDE                   23270000
232800              END-IF                                              23280000
232900        WHEN OTHER                                                23290000
233000           CONTINUE                                               23300000
233100     END-EVALUATE.                                                23310000
233200                                                                  23320000
233300* JAK 06/2007 - IF THE TRANSACTION IS A CANCEL TRAN, THEN         23330000
233400*               CHG THE DWNLD_CDE ON XREF_HDR TO X                23340000
233500     IF PS-UPDATE-HDR-X                                           23350000
233600        MOVE 'X' TO WST00001-DWNLD-CDE                            23360000
233700     END-IF.                                                      23370000
233800                                                                  23380000
233900     EXEC SQL                                                     23390000
234000          UPDATE WST_SHPMT_XREF_HDR                               23400000
234100          SET    DWNLD_TMST    =  CURRENT TIMESTAMP               23410000
234200                ,DWNLD_CDE     = :WST00001-DWNLD-CDE              23420000
234300          WHERE  EXT_SHP_ID    = :WST00001-EXT-SHP-ID             23430000
234400     END-EXEC.                                                    23440000
234500                                                                  23450000
234600     EVALUATE TRUE                                                23460000
234700       WHEN SQLCODE = ZERO                                        23470000
234800            CONTINUE                                              23480000
234900       WHEN SQLCODE NOT EQUAL ZERO                                23490000
235000            MOVE '7600-UPDATE-HEADER ' TO WS006-SQL-ERROR-PARA    23500000
235100            MOVE '2'                   TO WS006-SUCCESS-IND       23510000
235200            MOVE SQLCODE               TO WS006-SQLCODE           23520000
235300               INITIALIZE PV-CICS-MSG-AREA                        23530000
235400               MOVE SQLCODE         TO PV-DISP-SQLCODE            23540000
235500               STRING   ' ' WS006-SRC-TASK-NUMBER                 23550000
235600                        ' WSKCS302-7600:'                         23560000
235700                        ' ' WS006-OPER-UNT-ID                     23570000
235800                        ' ' WS006-EXT-SHP-ID (1:15)               23580000
235900                        ' ' WS006-USERID                          23590000
236000                        ' SQLCODE=' PV-DISP-SQLCODE               23600000
236100                        DELIMITED BY SIZE                         23610000
236200                        INTO PV-CICS-MSG-AREA                     23620000
236300               PERFORM 9900-WRITE-TO-CICS-LOG                     23630000
236400          PERFORM 8995-RETURN                                     23640000
236500     END-EVALUATE.                                                23650000
236600                                                                  23660000
236700****************************************************************  23670000
236800*   UPDATE DETAIL TABLE                                           23680000
236900****************************************************************  23690000
237000 7650-UPDATE-DETAIL.                                              23700000
237100                                                                  23710000
237200     IF PS-CICS-SWITCH-YES                                        23720000
237300        INITIALIZE PV-CICS-MSG-AREA                               23730000
237400        STRING   ' ' WS006-SRC-TASK-NUMBER                        23740000
237500                 ' WSKCS302-7650:'                                23750000
237600                 ' ' WS006-OPER-UNT-ID                            23760000
237700                 ' ' WS006-EXT-SHP-ID (1:15)                      23770000
237800                 ' ' WS006-USERID                                 23780000
237900                 ' SQLCODE=' PV-DISP-SQLCODE                      23790000
238000                 ' 7650-UPDATE-DETAIL      '                      23800000
238100                   DELIMITED BY SIZE                              23810000
238200                      INTO PV-CICS-MSG-AREA                       23820000
238300        PERFORM 9900-WRITE-TO-CICS-LOG                            23830000
238400     END-IF.                                                      23840000
238500                                                                  23850000
238600*    INITIALIZE DCLWST00002.                                      23860000
238700                                                                  23870000
238800     EXEC SQL                                                     23880000
238900          UPDATE WST_SHPMT_XREF_DTL                               23890000
239000             SET DWNLD_CDE      =  'D'                            23900000
239100           WHERE EXT_SHP_ID     = :WST00001-EXT-SHP-ID            23910000
239200             AND DWNLD_CDE NOT IN ('T')                           23920000
239300             AND ACTV_CDE       =  'A'                            23930000
239400     END-EXEC                                                     23940000
239500                                                                  23950000
239600     EVALUATE TRUE                                                23960000
239700       WHEN SQLCODE = ZERO                                        23970000
239800       WHEN SQLCODE = +100                                        23980000
239900            CONTINUE                                              23990000
240000       WHEN SQLCODE NOT EQUAL ZERO                                24000000
240100             MOVE '2'                 TO WS006-SUCCESS-IND        24010000
240200             MOVE '7650-UPDATE-DETAIL  '                          24020000
240300                                      TO WS006-SQL-ERROR-PARA     24030000
240400             MOVE SQLCODE             TO WS006-SQLCODE            24040000
240500                 INITIALIZE PV-CICS-MSG-AREA                      24050000
240600                 MOVE SQLCODE         TO PV-DISP-SQLCODE          24060000
240700                 STRING   ' ' WS006-SRC-TASK-NUMBER               24070000
240800                          ' WSKCS302-7650:'                       24080000
240900                          ' ' WS006-OPER-UNT-ID                   24090000
241000                          ' ' WS006-EXT-SHP-ID (1:15)             24100000
241100                          ' ' WS006-USERID                        24110000
241200                          ' SQLCODE=' PV-DISP-SQLCODE             24120000
241300                          DELIMITED BY SIZE                       24130000
241400                          INTO PV-CICS-MSG-AREA                   24140000
241500                 PERFORM 9900-WRITE-TO-CICS-LOG                   24150000
241600     END-EVALUATE.                                                24160000
241700                                                                  24170000
241800****************************************************************  24180000
241900*   RETREIVE XML LENGTHS                                          24190000
242000****************************************************************  24200000
242100 7700-RETEIVE-XML-LENGTHS.                                        24210000
242200                                                                  24220000
242300     IF PS-CICS-SWITCH-YES                                        24230000
242400        INITIALIZE PV-CICS-MSG-AREA                               24240000
242500        STRING   ' ' WS006-SRC-TASK-NUMBER                        24250000
242600                 ' WSKCS302-7700:'                                24260000
242700                 ' ' WS006-OPER-UNT-ID                            24270000
242800                 ' ' WS006-EXT-SHP-ID (1:15)                      24280000
242900                 ' ' WS006-USERID                                 24290000
243000                 ' SQLCODE=' PV-DISP-SQLCODE                      24300000
243100                 ' 7700-RETEIVE-XML-LENGTHS'                      24310000
243200                   DELIMITED BY SIZE                              24320000
243300                      INTO PV-CICS-MSG-AREA                       24330000
243400        PERFORM 9900-WRITE-TO-CICS-LOG                            24340000
243500     END-IF.                                                      24350000
243600                                                                  24360000
243700* BRINGS BACK THE LENGTHS NEEDED TO BUILD ASN XML                 24370000
243800                                                                  24380000
243900     EXEC SQL                                                     24390000
244000        SELECT A.INTGRTN_TYP_CDE, A.INTGRTN_TYP_DESC              24400000
244100              ,B.ATTR_DEFN_SEQ_NBR, B.ATTR_DEFN_DESC              24410000
244200              ,DIGITS(INT(C.ATTR_ELEM_NBR))  AS MAX_XML_LENGTH    24420000
244300              ,DIGITS(INT(D.ATTR_ELEM_NBR))  AS CASE_HDR_LENGTH   24430000
244400              ,DIGITS(INT(E.ATTR_ELEM_NBR))  AS CASE_DTL_LENGTH   24440000
244500              ,DIGITS(INT(F.ATTR_ELEM_NBR))  AS ASN_DTL_LENGTH    24450000
244600              ,DIGITS(INT(G.ATTR_ELEM_NBR))  AS ASN_HDR_LENGTH    24460000
244700              ,DIGITS(INT(H.ATTR_ELEM_NBR))  AS APPT_LENGTH       24470000
244800        INTO   :WST00008-INTGRTN-TYP-CDE                          24480000
244900              ,:WST00008-INTGRTN-TYP-DESC                         24490000
245000              ,:WST00009-ATTR-DEFN-SEQ-NBR                        24500000
245100              ,:WST00009-ATTR-DEFN-DESC                           24510000
245200              ,:WMLENGTH-MAX-XML-LENGTH                           24520000
245300              ,:WMLENGTH-CASE-HDR-LENGTH                          24530000
245400              ,:WMLENGTH-CASE-DTL-LENGTH                          24540000
245500              ,:WMLENGTH-ASN-DTL-LENGTH                           24550000
245600              ,:WMLENGTH-ASN-HEADER-LENGTH                        24560000
245700              ,:WMLENGTH-APPT-LENGTH                              24570000
245800        FROM    WST_INTGRTN_TYP A                                 24580000
245900               ,WST_ATTR_DEFN   B                                 24590000
246000               ,WST_ATTR_ELEM   C                                 24600000
246100               ,WST_ATTR_ELEM   D                                 24610000
246200               ,WST_ATTR_ELEM   E                                 24620000
246300               ,WST_ATTR_ELEM   F                                 24630000
246400               ,WST_ATTR_ELEM   G                                 24640000
246500               ,WST_ATTR_ELEM   H                                 24650000
246600       WHERE A.INTGRTN_TYP_CDE    =  'XMLLENGTH'                  24660000
246700         AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE            24670000
246800         AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE            24680000
246900         AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE            24690000
247000         AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE            24700000
247100         AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE            24710000
247200         AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE            24720000
247300         AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE            24730000
247400         AND B.ATTR_DEFN_SEQ_NBR  =  1                            24740000
247500         AND C.ATTR_DEFN_SEQ_NBR  =  1                            24750000
247600         AND D.ATTR_DEFN_SEQ_NBR  =  2                            24760000
247700         AND E.ATTR_DEFN_SEQ_NBR  =  3                            24770000
247800         AND F.ATTR_DEFN_SEQ_NBR  =  4                            24780000
247900         AND G.ATTR_DEFN_SEQ_NBR  =  5                            24790000
248000         AND H.ATTR_DEFN_SEQ_NBR  =  6                            24800000
248100         AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR          24810000
248200         AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR          24820000
248300         AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR          24830000
248400         AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR          24840000
248500         AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR          24850000
248600     END-EXEC.                                                    24860000
248700                                                                  24870000
248800     EVALUATE TRUE                                                24880000
248900       WHEN SQLCODE = ZERO                                        24890000
249000            CONTINUE                                              24900000
249100       WHEN SQLCODE NOT EQUAL ZERO                                24910000
249200            MOVE '7700-RETEIVE-XML-LENGTHS'                       24920000
249300                                       TO WS006-SQL-ERROR-PARA    24930000
249400            MOVE '2'                   TO WS006-SUCCESS-IND       24940000
249500            MOVE SQLCODE               TO WS006-SQLCODE           24950000
249600               INITIALIZE PV-CICS-MSG-AREA                        24960000
249700               MOVE SQLCODE         TO PV-DISP-SQLCODE            24970000
249800               STRING   ' ' WS006-SRC-TASK-NUMBER                 24980000
249900                        ' WSKCS302-7700:'                         24990000
250000                        ' ' WS006-OPER-UNT-ID                     25000000
250100                        ' ' WS006-EXT-SHP-ID (1:15)               25010000
250200                        ' ' WS006-USERID                          25020000
250300                        ' SQLCODE=' PV-DISP-SQLCODE               25030000
250400                        DELIMITED BY SIZE                         25040000
250500                        INTO PV-CICS-MSG-AREA                     25050000
250600              PERFORM 9900-WRITE-TO-CICS-LOG                      25060000
250700           PERFORM 8995-RETURN                                    25070000
250800     END-EVALUATE.                                                25080000
250900                                                                  25090000
251000                                                                  25100000
251100****************************************************************  25110000
251200*   OPEN  TABLE CURSOR                                         *  25120000
251300****************************************************************  25130000
251400 8100-OPEN-FETCH-CURSOR.                                          25140000
251500                                                                  25150000
251600     IF PS-CICS-SWITCH-YES                                        25160000
251700        INITIALIZE PV-CICS-MSG-AREA                               25170000
251800        STRING   ' ' WS006-SRC-TASK-NUMBER                        25180000
251900                 ' WSKCS302-8100:'                                25190000
252000                 ' ' WS006-OPER-UNT-ID                            25200000
252100                 ' ' WS006-EXT-SHP-ID (1:15)                      25210000
252200                 ' ' WS006-USERID                                 25220000
252300                 ' SQLCODE=' PV-DISP-SQLCODE                      25230000
252400                 ' 8100-OPEN-FETCH-CURSOR  '                      25240000
252500                   DELIMITED BY SIZE                              25250000
252600                      INTO PV-CICS-MSG-AREA                       25260000
252700        PERFORM 9900-WRITE-TO-CICS-LOG                            25270000
252800     END-IF.                                                      25280000
252900                                                                  25290000
253000     EXEC SQL                                                     25300000
253100          OPEN ASN-CSR                                            25310000
253200     END-EXEC.                                                    25320000
253300                                                                  25330000
253400     EVALUATE TRUE                                                25340000
253500         WHEN SQLCODE = ZERO                                      25350000
253600              CONTINUE                                            25360000
253700         WHEN SQLCODE = +100                                      25370000
253800              SET PS-TBL-IN-EOF       TO TRUE                     25380000
253900         WHEN SQLWARN0 NOT EQUAL SPACE                            25390000
254000         WHEN SQLCODE  NOT EQUAL ZERO                             25400000
254100              MOVE '8100-OPEN-CURSOR' TO WS006-SQL-ERROR-PARA     25410000
254200              MOVE '2'                TO WS006-SUCCESS-IND        25420000
254300              MOVE SQLCODE            TO WS006-SQLCODE            25430000
254400               INITIALIZE PV-CICS-MSG-AREA                        25440000
254500               MOVE SQLCODE         TO PV-DISP-SQLCODE            25450000
254600               STRING   ' ' WS006-SRC-TASK-NUMBER                 25460000
254700                        ' WSKCS302-8100:'                         25470000
254800                        ' ' WS006-OPER-UNT-ID                     25480000
254900                        ' ' WS006-EXT-SHP-ID (1:15)               25490000
255000                        ' ' WS006-USERID                          25500000
255100                        ' SQLCODE=' PV-DISP-SQLCODE               25510000
255200                        DELIMITED BY SIZE                         25520000
255300                        INTO PV-CICS-MSG-AREA                     25530000
255400               PERFORM 9900-WRITE-TO-CICS-LOG                     25540000
255500          PERFORM 8995-RETURN                                     25550000
255600     END-EVALUATE.                                                25560000
255700                                                                  25570000
255800     PERFORM 8200-FETCH-CURSOR.                                   25580000
255900                                                                  25590000
256000****************************************************************  25600000
256100*   FETCH TABLE CURSOR                                         *  25610000
256200****************************************************************  25620000
256300 8200-FETCH-CURSOR.                                               25630000
256400                                                                  25640000
256500     IF PS-CICS-SWITCH-YES                                        25650000
256600        INITIALIZE PV-CICS-MSG-AREA                               25660000
256700        STRING   ' ' WS006-SRC-TASK-NUMBER                        25670000
256800                 ' WSKCS302-8200:'                                25680000
256900                 ' ' WS006-OPER-UNT-ID                            25690000
257000                 ' ' WS006-EXT-SHP-ID (1:15)                      25700000
257100                 ' ' WS006-USERID                                 25710000
257200                 ' SQLCODE=' PV-DISP-SQLCODE                      25720000
257300                 ' 8200-FETCH-CURSOR       '                      25730000
257400                   DELIMITED BY SIZE                              25740000
257500                      INTO PV-CICS-MSG-AREA                       25750000
257600        PERFORM 9900-WRITE-TO-CICS-LOG                            25760000
257700     END-IF.                                                      25770000
257800                                                                  25780000
257900     INITIALIZE DCLWST00011                                       25790000
258000                WS004-ASN-REC                                     25800000
258100                PV-CASE                                           25810000
258200                WS005-ASN-DTL-REC                                 25820000
258300                WS006-CASE-HDR-REC                                25830000
258400                WS007-CASE-DTL-REC.                               25840000
258500                                                                  25850000
258600     EXEC SQL                                                     25860000
258700         FETCH ASN-CSR                                            25870000
258800          INTO  :WST00011-EXT-SHP-ID                              25880000
258900               ,:WST00011-CRE-TMST                                25890000
259000               ,:WST00011-ROW-NBR                                 25900000
259100               ,:WST00011-REC-TYP-GP-NBR                          25910000
259200               ,:PV-CASE                                          25920000
259300               ,:WST00011-REC-TYP-CDE                             25930000
259400               ,:WST00011-CSE-DTL-NBR                             25940000
259500               ,:WST00011-REC-TYP-DESC                            25950000
259600     END-EXEC.                                                    25960000
259700                                                                  25970000
259800     EVALUATE TRUE                                                25980000
259900         WHEN SQLCODE = ZERO                                      25990000
260000              ADD +1                   TO PV-FETCH1               26000000
260100         WHEN SQLCODE = +100                                      26010000
260200              SET PS-TBL-IN-EOF        TO TRUE                    26020000
260300         WHEN SQLWARN0 NOT EQUAL SPACE                            26030000
260400         WHEN SQLCODE NOT EQUAL ZERO                              26040000
260500              MOVE '8200-FETCH-CURSOR' TO WS006-SQL-ERROR-PARA    26050000
260600              MOVE '2'                 TO WS006-SUCCESS-IND       26060000
260700              MOVE SQLCODE             TO WS006-SQLCODE           26070000
260800                 INITIALIZE PV-CICS-MSG-AREA                      26080000
260900                 MOVE SQLCODE         TO PV-DISP-SQLCODE          26090000
261000                 STRING   ' ' WS006-SRC-TASK-NUMBER               26100000
261100                          ' WSKCS302-8200:'                       26110000
261200                          ' ' WS006-OPER-UNT-ID                   26120000
261300                          ' ' WS006-EXT-SHP-ID (1:15)             26130000
261400                          ' ' WS006-USERID                        26140000
261500                          ' SQLCODE=' PV-DISP-SQLCODE             26150000
261600                          ' WS006-SUCCESS-IND: '                  26160000
261700                          WS006-SUCCESS-IND                       26170000
261800                          DELIMITED BY SIZE                       26180000
261900                          INTO PV-CICS-MSG-AREA                   26190000
262000              PERFORM 9900-WRITE-TO-CICS-LOG                      26200000
262100              PERFORM 8995-RETURN                                 26210000
262200     END-EVALUATE.                                                26220000
262300                                                                  26230000
262400                                                                  26240000
262500****************************************************************  26250000
262600*   CLOSE TABLE CURSOR                                         *  26260000
262700****************************************************************  26270000
262800 8300-CLOSE-CURSOR.                                               26280000
262900                                                                  26290000
263000     IF PS-CICS-SWITCH-YES                                        26300000
263100        INITIALIZE PV-CICS-MSG-AREA                               26310000
263200        STRING   ' ' WS006-SRC-TASK-NUMBER                        26320000
263300                 ' WSKCS302-8300:'                                26330000
263400                 ' ' WS006-OPER-UNT-ID                            26340000
263500                 ' ' WS006-EXT-SHP-ID (1:15)                      26350000
263600                 ' ' WS006-USERID                                 26360000
263700                 ' SQLCODE=' PV-DISP-SQLCODE                      26370000
263800                 ' 8300-CLOSE-CURSOR       '                      26380000
263900                   DELIMITED BY SIZE                              26390000
264000                      INTO PV-CICS-MSG-AREA                       26400000
264100        PERFORM 9900-WRITE-TO-CICS-LOG                            26410000
264200     END-IF.                                                      26420000
264300                                                                  26430000
264400     EXEC SQL                                                     26440000
264500          CLOSE ASN-CSR                                           26450000
264600     END-EXEC.                                                    26460000
264700                                                                  26470000
264800     EVALUATE TRUE                                                26480000
264900         WHEN SQLCODE = ZERO                                      26490000
265000              CONTINUE                                            26500000
265100         WHEN SQLWARN0 NOT EQUAL SPACE                            26510000
265200         WHEN SQLCODE NOT EQUAL ZERO                              26520000
265300              MOVE '8300-CLOSE-CURSOR' TO WS006-SQL-ERROR-PARA    26530000
265400              MOVE '2'                 TO WS006-SUCCESS-IND       26540000
265500              MOVE SQLCODE             TO WS006-SQLCODE           26550000
265600                 INITIALIZE PV-CICS-MSG-AREA                      26560000
265700                 MOVE SQLCODE         TO PV-DISP-SQLCODE          26570000
265800                 STRING   ' ' WS006-SRC-TASK-NUMBER               26580000
265900                          ' WSKCS302-8300:'                       26590000
266000                          ' ' WS006-OPER-UNT-ID                   26600000
266100                          ' ' WS006-EXT-SHP-ID (1:15)             26610000
266200                          ' ' WS006-USERID                        26620000
266300                          ' SQLCODE=' PV-DISP-SQLCODE             26630000
266400                          DELIMITED BY SIZE                       26640000
266500                          INTO PV-CICS-MSG-AREA                   26650000
266600              PERFORM 9900-WRITE-TO-CICS-LOG                      26660000
266700              PERFORM 8995-RETURN                                 26670000
266800     END-EVALUATE.                                                26680000
266900                                                                  26690000
267000******************************************************************26700000
267100* BACK OUT CICS PROCESSING                                        26710000
267200******************************************************************26720000
267300 8400-BACK-OUT-CICS.                                              26730000
267400                                                                  26740000
267500     IF PS-CICS-SWITCH-YES                                        26750000
267600        INITIALIZE PV-CICS-MSG-AREA                               26760000
267700        STRING   ' ' WS006-SRC-TASK-NUMBER                        26770000
267800                 ' WSKCS302-8400:'                                26780000
267900                 ' ' WS006-OPER-UNT-ID                            26790000
268000                 ' ' WS006-EXT-SHP-ID (1:15)                      26800000
268100                 ' ' WS006-USERID                                 26810000
268200                 ' SQLCODE=' PV-DISP-SQLCODE                      26820000
268300                 ' 8400-BACK-OUT-CICS 1    '                      26830000
268400                   DELIMITED BY SIZE                              26840000
268500                      INTO PV-CICS-MSG-AREA                       26850000
268600        PERFORM 9900-WRITE-TO-CICS-LOG                            26860000
268700     END-IF.                                                      26870000
268800                                                                  26880000
268900     EXEC CICS                                                    26890000
269000         SYNCPOINT ROLLBACK                                       26900000
269100     END-EXEC.                                                    26910000
269200                                                                  26920000
269300     MOVE EIBCALEN TO PV-DISP-NUM.                                26930000
269400     STRING   ' ' WS006-SRC-TASK-NUMBER                           26940000
269500              ' WSKCS302-8400:'                                   26950000
269600              ' ' WS006-OPER-UNT-ID                               26960000
269700              ' ' WS006-EXT-SHP-ID (1:15)                         26970000
269800              ' EIBCALEN=' PV-DISP-NUM                            26980000
269900              ' ' WS006-USERID                                    26990000
270000              ' SQLCODE=' PV-DISP-SQLCODE                         27000000
270100              ' 8400-BACK-OUT-CICS 2    '                         27010000
270200                DELIMITED BY SIZE                                 27020000
270300                   INTO PV-CICS-MSG-AREA.                         27030000
270400     PERFORM 9900-WRITE-TO-CICS-LOG.                              27040000
270500     INITIALIZE PV-CICS-MSG-AREA.                                 27050000
270600     STRING   ' ' WS006-SRC-TASK-NUMBER                           27060000
270700              ' DFHCOMMAREA ------->' DFHCOMMAREA                 27070000
270800              ' ' WS006-OPER-UNT-ID                               27080000
270900              ' ' WS006-EXT-SHP-ID (1:15)                         27090000
271000              ' ' WS006-USERID                                    27100000
271100              ' SQLCODE=' PV-DISP-SQLCODE                         27110000
271200              ' 8400-BACK-OUT-CICS 3    '                         27120000
271300                DELIMITED BY SIZE                                 27130000
271400                   INTO PV-CICS-MSG-AREA.                         27140000
271500     PERFORM 9900-WRITE-TO-CICS-LOG.                              27150000
271600     INITIALIZE PV-CICS-MSG-AREA.                                 27160000
271700     STRING   ' ' WS006-SRC-TASK-NUMBER                           27170000
271800              ' WSKCS302-FAIL:'                                   27180000
271900              ' ' WS006-OPER-UNT-ID                               27190000
272000              ' ' WS006-EXT-SHP-ID (1:15)                         27200000
272100              ' ' WS006-USERID                                    27210000
272200              ' SQLCODE=' PV-DISP-SQLCODE                         27220000
272300              ' WSKCS302 FAILED!!!      '                         27230000
272400                DELIMITED BY SIZE                                 27240000
272500                  INTO PV-CICS-MSG-AREA                           27250000
272600              PERFORM 9900-WRITE-TO-CICS-LOG.                     27260000
272700                                                                  27270000
272800****************************************************************  27280000
272900*   XML ERROR                                                  *  27290000
273000****************************************************************  27300000
273100 8500-XML-ERROR.                                                  27310000
273200                                                                  27320000
273300     IF PS-CICS-SWITCH-YES                                        27330000
273400        INITIALIZE PV-CICS-MSG-AREA                               27340000
273500        STRING   ' ' WS006-SRC-TASK-NUMBER                        27350000
273600                 ' WSKCS302-8500:'                                27360000
273700                 ' ' WS006-OPER-UNT-ID                            27370000
273800                 ' ' WS006-EXT-SHP-ID (1:15)                      27380000
273900                 ' ' WS006-USERID                                 27390000
274000                 ' SQLCODE=' PV-DISP-SQLCODE                      27400000
274100                 ' 8500-XML-ERROR          '                      27410000
274200                   DELIMITED BY SIZE                              27420000
274300                      INTO PV-CICS-MSG-AREA                       27430000
274400        PERFORM 9900-WRITE-TO-CICS-LOG                            27440000
274500     END-IF.                                                      27450000
274510                                                                  27451004
274514     IF PS-CICS-SWITCH-YES                                        27451404
274515        MOVE LENGTH OF PV-XML  TO  PV-XML-LENGTH                  27451504
274516        MOVE PV-XML-LENGTH     TO  PV-DISP-XML-LENGTH             27451604
274517        INITIALIZE PV-CICS-MSG-AREA                               27451704
274518        STRING   ' ' WS006-SRC-TASK-NUMBER                        27451804
274519                 ' WSKCS302-8500:'                                27451904
274520                 ' XML LENGTH: ' PV-DISP-XML-LENGTH               27452004
274525                   DELIMITED BY SIZE                              27452504
274526                      INTO PV-CICS-MSG-AREA                       27452604
274527                                                                  27452708
274528        DISPLAY PV-CICS-MSG-AREA                                  27452808
274529        DISPLAY PV-XML                                            27452910
274530                                                                  27453008
274531        PERFORM 9900-WRITE-TO-CICS-LOG                            27453104
274532     END-IF.                                                      27453204
274533                                                                  27453304
274540     IF PS-CICS-SWITCH-YES                                        27454004
274570        INITIALIZE PV-CICS-MSG-AREA                               27457004
274580        STRING   ' ' WS006-SRC-TASK-NUMBER                        27458004
274590                 ' WSKCS302-8500: '                               27459004
274591                   PV-XML                                         27459104
274592                   DELIMITED BY SIZE                              27459204
274593                      INTO PV-CICS-MSG-AREA                       27459304
274594        PERFORM 9900-WRITE-TO-CICS-LOG                            27459404
274598     END-IF.                                                      27459804
274599                                                                  27459904
274600                                                                  27460000
274700*    PERFORM 9000-EXPLAIN-XML-RESPONSE                            27470000
274800*    PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    27480000
274900*               UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           27490000
275000*    END-PERFORM.                                                 27500000
275100                                                                  27510000
275200     MOVE '8500-XML-ERROR   '  TO WS006-SQL-ERROR-PARA.           27520000
275300     MOVE +999                 TO SQLCODE                         27530000
275400                                  PV-DISP-SQLCODE.                27540000
275500     MOVE '1'                  TO WS006-SUCCESS-IND.              27550000
275600     INITIALIZE PV-CICS-MSG-AREA                                  27560000
275700     STRING   ' ' WS006-SRC-TASK-NUMBER                           27570000
275800              ' WSKCS302-8500:'                                   27580000
275900              ' ' WS006-OPER-UNT-ID                               27590000
276000              ' ' WS006-EXT-SHP-ID (1:15)                         27600000
276100              ' ' WS006-USERID                                    27610000
276200              ' SQLCODE=' PV-DISP-SQLCODE                         27620000
276300              ' 8500-XML-ERROR <--------'                         27630000
276400                DELIMITED BY SIZE                                 27640000
276500                  INTO PV-CICS-MSG-AREA                           27650000
276600        PERFORM 9900-WRITE-TO-CICS-LOG                            27660000
276601                                                                  27660111
276610     MOVE LENGTH OF PV-XML  TO  PV-XML-LENGTH                     27661011
276620     MOVE PV-XML-LENGTH     TO  PV-DISP-XML-LENGTH                27662011
276630     INITIALIZE PV-CICS-MSG-AREA                                  27663011
276640     STRING   ' ' WS006-SRC-TASK-NUMBER                           27664011
276650              ' WSKCS302-8500:'                                   27665011
276660              ' XML LENGTH: ' PV-DISP-XML-LENGTH                  27666011
276670                DELIMITED BY SIZE                                 27667011
276680                  INTO PV-CICS-MSG-AREA                           27668011
276694        PERFORM 9900-WRITE-TO-CICS-LOG                            27669411
276695                                                                  27669511
276700     PERFORM 8995-RETURN.                                         27670000
276800                                                                  27680000
276900****************************************************************  27690000
277000*   REPLACE XML CHARACTERS                                     *  27700000
277100****************************************************************  27710000
277200 8600-REPLACE-XML.                                                27720000
277300                                                                  27730000
277400     IF PS-CICS-SWITCH-YES                                        27740000
277500        INITIALIZE PV-CICS-MSG-AREA                               27750000
277600        STRING   ' ' WS006-SRC-TASK-NUMBER                        27760000
277700                 ' WSKCS302-8600:'                                27770000
277800                 ' ' WS006-OPER-UNT-ID                            27780000
277900                 ' ' WS006-EXT-SHP-ID (1:15)                      27790000
278000                 ' ' WS006-USERID                                 27800000
278100                 ' SQLCODE=' PV-DISP-SQLCODE                      27810000
278200                 ' 8600-REPLACE-XML        '                      27820000
278300                   DELIMITED BY SIZE                              27830000
278400                      INTO PV-CICS-MSG-AREA                       27840000
278500        PERFORM 9900-WRITE-TO-CICS-LOG                            27850000
278600     END-IF.                                                      27860000
278700                                                                  27870000
278800*  INSPECT ... REPLACING command to change the tag.               27880000
278900     INSPECT PV-XML REPLACING ALL 'Divisio1' BY 'Division'.       27890000
279000     INSPECT PV-XML REPLACING ALL 'Divisio2' BY 'Division'.       27900000
279100     INSPECT PV-XML REPLACING ALL 'Divisio3' BY 'Division'.       27910000
279200     INSPECT PV-XML REPLACING ALL 'Compan1'  BY 'Company'.        27920000
279300     INSPECT PV-XML REPLACING ALL 'Compan2'  BY 'Company'.        27930000
279400     INSPECT PV-XML REPLACING ALL 'Compan3'  BY 'Company'.        27940000
279500     INSPECT PV-XML REPLACING ALL 'ShipmentNb2'                   27950000
279600                               BY 'ShipmentNbr'.                  27960000
279700     INSPECT PV-XML REPLACING ALL 'ShipmentNb3'                   27970000
279800                               BY 'ShipmentNbr'.                  27980000
279900     INSPECT PV-XML REPLACING ALL 'ShipmentNb4'                   27990000
280000                               BY 'ShipmentNbr'.                  28000000
280100     INSPECT PV-XML REPLACING ALL 'ShipmentNb5'                   28010000
280200                               BY 'ShipmentNbr'.                  28020000
280300     INSPECT PV-XML REPLACING ALL 'ToLocatio3'                    28030000
280400                               BY 'ToLocation'.                   28040000
280500     INSPECT PV-XML REPLACING ALL 'ToLocatio4'                    28050000
280600                               BY 'ToLocation'.                   28060000
280700     INSPECT PV-XML REPLACING ALL 'InboundASNBridg3'              28070000
280800                               BY 'InboundASNBridge'.             28080000
280900     INSPECT PV-XML REPLACING ALL 'AsnTyp3'                       28090000
281000                               BY 'AsnType'.                      28100000
281100     INSPECT PV-XML REPLACING ALL 'BatchCtlNb3'                   28110000
281200                               BY 'BatchCtlNbr'.                  28120000
281300     INSPECT PV-XML REPLACING ALL 'StyleSuffi3'                   28130000
281400                               BY 'StyleSuffix'.                  28140000
281500     INSPECT PV-XML REPLACING ALL 'SkuI3'                         28150000
281600                               BY 'SkuID'.                        28160000
281700     INSPECT PV-XML REPLACING ALL 'SubSKUField3'                  28170000
281800                               BY 'SubSKUFields'.                 28180000
281900     INSPECT PV-XML REPLACING ALL 'InventoryTyp3'                 28190000
282000                               BY 'InventoryType'.                28200000
282100     INSPECT PV-XML REPLACING ALL 'PONb3'                         28210000
282200                               BY 'PONbr'.                        28220000
282300     INSPECT PV-XML REPLACING ALL 'VendorI3'                      28230000
282400                               BY 'VendorID'.                     28240000
282500     INSPECT PV-XML REPLACING ALL 'InboundASNBridg4'              28250000
282600                               BY 'InboundASNBridge'.             28260000
282700     INSPECT PV-XML REPLACING ALL 'InboundAS4'                    28270000
282800                               BY 'InboundASN'.                   28280000
282900     INSPECT PV-XML REPLACING ALL 'AsnTyp4'                       28290000
283000                               BY 'AsnType'.                      28300000
283100     INSPECT PV-XML REPLACING ALL 'BatchCtlNb4'                   28310000
283200                               BY 'BatchCtlNbr'.                  28320000
283300     INSPECT PV-XML REPLACING ALL 'ShipVi4'                       28330000
283400                               BY 'ShipVia'.                      28340000
283500     INSPECT PV-XML REPLACING ALL 'BatchCtlNb4'                   28350000
283600                               BY 'BatchCtlNbr'.                  28360000
283700     INSPECT PV-XML REPLACING ALL 'TrailerNumbe4'                 28370000
283800                               BY 'TrailerNumber'.                28380000
283900     INSPECT PV-XML REPLACING ALL 'TrailerNb5'                    28390000
284000                               BY 'TrailerNbr'.                   28400000
284100     INSPECT PV-XML REPLACING ALL 'ProNb5'                        28410000
284200                               BY 'ProNbr'.                       28420000
284300     INSPECT PV-XML REPLACING ALL 'StatusCod5'                    28430000
284400                               BY 'StatusCode'.                   28440000
284500     INSPECT PV-XML REPLACING ALL 'ShipVi5'                       28450000
284600                               BY 'ShipVia'.                      28460000
284700     INSPECT PV-XML REPLACING ALL 'Warehous5'                     28470000
284800                               BY 'Warehouse'.                    28480000
284900     INSPECT PV-XML REPLACING ALL 'SKUDefinitio3'                 28490000
285000                               BY 'SKUDefinition'.                28500000
285100     INSPECT PV-XML REPLACING ALL 'ProcessImmdNeed3'              28510000
285200                               BY 'ProcessImmdNeeds'.             28520000
285300                                                                  28530000
285400****************************************************************  28540000
285500*   XML SUCCESS                                                *  28550000
285600****************************************************************  28560000
285700 8700-XML-SUCCESS.                                                28570000
285800*    CONTINUE.                                                    28580000
285900                                                                  28590000
286000     IF PS-CICS-SWITCH-YES                                        28600000
286100        INITIALIZE PV-CICS-MSG-AREA                               28610000
286200        STRING   ' ' WS006-SRC-TASK-NUMBER                        28620000
286300                 ' WSKCS302-8700:'                                28630000
286400                 ' ' WS006-OPER-UNT-ID                            28640000
286500                 ' ' WS006-EXT-SHP-ID (1:15)                      28650000
286600                 ' ' WS006-USERID                                 28660000
286700                 ' SQLCODE=' PV-DISP-SQLCODE                      28670000
286800                 ' 8700-XML-SUCCESS        '                      28680000
286900                   DELIMITED BY SIZE                              28690000
287000                      INTO PV-CICS-MSG-AREA                       28700000
287100        PERFORM 9900-WRITE-TO-CICS-LOG                            28710000
287200     END-IF.                                                      28720000
287201                                                                  28720107
287210     IF PS-CICS-SWITCH-YES                                        28721007
287220        MOVE LENGTH OF PV-XML  TO  PV-XML-LENGTH                  28722007
287230        MOVE PV-XML-LENGTH     TO  PV-DISP-XML-LENGTH             28723007
287240        INITIALIZE PV-CICS-MSG-AREA                               28724007
287250        STRING   ' ' WS006-SRC-TASK-NUMBER                        28725007
287260                 ' WSKCS302-8600: SUCCESS '                       28726007
287270                 ' XML LENGTH: ' PV-DISP-XML-LENGTH               28727007
287280                   DELIMITED BY SIZE                              28728007
287290                      INTO PV-CICS-MSG-AREA                       28729007
287291                                                                  28729108
287292        DISPLAY PV-CICS-MSG-AREA                                  28729208
287293        DISPLAY PV-XML                                            28729310
287294                                                                  28729408
287295        PERFORM 9900-WRITE-TO-CICS-LOG                            28729507
287296     END-IF.                                                      28729607
287297                                                                  28729707
287298     IF PS-CICS-SWITCH-YES                                        28729807
287299        INITIALIZE PV-CICS-MSG-AREA                               28729907
287300        STRING   ' ' WS006-SRC-TASK-NUMBER                        28730007
287301                 ' WSKCS302-8600: '                               28730107
287302                   PV-XML                                         28730207
287303                   DELIMITED BY SIZE                              28730307
287304                      INTO PV-CICS-MSG-AREA                       28730407
287305        PERFORM 9900-WRITE-TO-CICS-LOG                            28730507
287306     END-IF.                                                      28730607
287310                                                                  28731000
287400* This code makes the CR-MI field optional.                       28740000
287500* The XML Generator will create a tag even if the field is blank. 28750000
287600* This will strip it out.                                         28760000
287700*    UNSTRING PV-XML(1:XML-LENGTH)                                28770000
287800*      DELIMITED BY '<CR-MI> </CR-MI>'                            28780000
287900*              INTO PV-BEFORE COUNT PV-BEFORE-CNT                 28790000
288000*                   PV-AFTER  COUNT PV-AFTER-CNT.                 28800000
288100*    STRING PV-BEFORE(1:PV-BEFORE-CNT) PV-AFTER                   28810000
288200*      DELIMITED BY SIZE INTO PV-XML.                             28820000
288300*    COMPUTE XML-LENGTH = PV-BEFORE-CNT + PV-AFTER-CNT.           28830000
288400*                                                                 28840000
288500*    DISPLAY 'XML document was successfully generated'.           28850000
288600*    DISPLAY ' '.                                                 28860000
288700*    DISPLAY 'The generated XML is ' XML-LENGTH                   28870000
288800*            ' characters long.'.                                 28880000
288900*    DISPLAY ' '.                                                 28890000
289000*    DISPLAY PV-XML(1:XML-LENGTH).                                28900000
289100*                                                                 28910000
289200*    DISPLAY ' '.                                                 28920000
289300*    DISPLAY 'FORMATTED:'.                                        28930000
289400*    MOVE PV-XML(1:XML-LENGTH) TO XML-UNFORMATTED-MSG             28940000
289500*                                                                 28950000
289600*    PERFORM 9554-DISPLAY-FORMATTED-XML.                          28960000
289700*                                                                 28970000
289800****************************************************************  28980000
289900*   EOJ ROUTINE                                                *  28990000
290000****************************************************************  29000000
290100 8990-EOJ-ROUTINE.                                                29010000
290200                                                                  29020000
290300     IF PS-CICS-SWITCH-YES                                        29030000
290400        INITIALIZE PV-CICS-MSG-AREA                               29040000
290500        STRING   ' ' WS006-SRC-TASK-NUMBER                        29050000
290600                 ' WSKCS302-8990:'                                29060000
290700                 ' ' WS006-OPER-UNT-ID                            29070000
290800                 ' ' WS006-EXT-SHP-ID (1:15)                      29080000
290900                 ' ' WS006-USERID                                 29090000
291000                 ' SQLCODE=' PV-DISP-SQLCODE                      29100000
291100                 ' 8990-EOJ-ROUTINE        '                      29110000
291200                   DELIMITED BY SIZE                              29120000
291300                      INTO PV-CICS-MSG-AREA                       29130000
291400        PERFORM 9900-WRITE-TO-CICS-LOG                            29140000
291500     END-IF.                                                      29150000
291600                                                                  29160000
291700     PERFORM 8300-CLOSE-CURSOR.                                   29170000
291800     PERFORM 1500-MQ-CLOSE-QUEUE.                                 29180000
291900     PERFORM 1800-MQ-DISCONNECT.                                  29190000
292000     PERFORM 7500-UPDATE-CONTROL.                                 29200000
292100     PERFORM 7600-UPDATE-HEADER.                                  29210000
292200                                                                  29220000
292300     IF WST00001-SOR-CDE = 'RC'                                   29230000
292400        PERFORM 7650-UPDATE-DETAIL                                29240000
292500     ELSE                                                         29250000
292600     IF PV-AD-CNT    NOT =  0                                     29260000
292700        PERFORM 7650-UPDATE-DETAIL                                29270000
292800     END-IF.                                                      29280000
292900                                                                  29290000
293000     INITIALIZE PV-CICS-MSG-AREA.                                 29300000
293100     IF WS006-SUCCESS-IND = ' '                                   29310000
293200        STRING   ' ' WS006-SRC-TASK-NUMBER                        29320000
293300                 ' WSKCS302-EOJ :'                                29330000
293400                 ' ' WS006-OPER-UNT-ID                            29340000
293500                 ' ' WS006-EXT-SHP-ID (1:15)                      29350000
293600                 ' ' WS006-USERID                                 29360000
293700                 ' SQLCODE=' PV-DISP-SQLCODE                      29370000
293800                 ' WSKCS302 SUCCESSFUL     '                      29380000
293900                   DELIMITED BY SIZE                              29390000
294000                     INTO PV-CICS-MSG-AREA                        29400000
294100                 PERFORM 9900-WRITE-TO-CICS-LOG                   29410000
294200     ELSE                                                         29420000
294300        PERFORM 8400-BACK-OUT-CICS                                29430000
294400     END-IF.                                                      29440000
294500                                                                  29450000
294600****************************************************************  29460000
294700*    ADDITIONAL PARAGRAPHS                                     *  29470000
294800****************************************************************  29480000
294900                                                                  29490000
295000     COPY ISPD009.                                                29500000
295100     COPY ISPD002.                                                29510000
295200     COPY ISPD007.                                                29520000
295300     COPY ISPD008.                                                29530000
295400     COPY ISPD012.                                                29540000
295500                                                                  29550000
295600 8995-RETURN.                                                     29560000
295700                                                                  29570000
295800     MOVE WS006-TRANS-COMMAREA          TO DFHCOMMAREA.           29580000
295900                                                                  29590000
296000     IF WS006-SUCCESS-IND NOT            = SPACE                  29600000
296100        PERFORM 8400-BACK-OUT-CICS                                29610000
296200     END-IF.                                                      29620000
296300                                                                  29630000
296400* TESTING                                                         29640000
296500     IF PS-CICS-SWITCH-YES                                        29650000
296600        MOVE EIBCALEN TO PV-DISP-NUM                              29660000
296700        INITIALIZE PV-CICS-MSG-AREA                               29670000
296800        STRING   ' ' WS006-SRC-TASK-NUMBER                        29680000
296900                 ' WSKCS302-8995:'                                29690000
297000                 ' ' WS006-OPER-UNT-ID                            29700000
297100                 ' ' WS006-EXT-SHP-ID (1:15)                      29710000
297200                 ' EIBCALEN=' PV-DISP-NUM                         29720000
297300                 ' ' WS006-USERID                                 29730000
297400                 ' SQLCODE=' PV-DISP-SQLCODE                      29740000
297500                 ' 8995-RETURN             '                      29750000
297600                   DELIMITED BY SIZE                              29760000
297700                      INTO PV-CICS-MSG-AREA                       29770000
297800        PERFORM 9900-WRITE-TO-CICS-LOG                            29780000
297900     END-IF.                                                      29790000
298000                                                                  29800000
298100* TESTING                                                         29810000
298200     IF PS-CICS-SWITCH-YES                                        29820000
298300        INITIALIZE PV-CICS-MSG-AREA                               29830000
298400        STRING   ' ' WS006-SRC-TASK-NUMBER                        29840000
298500                 ' DFHCOMMAREA ------->' DFHCOMMAREA              29850000
298600                 ' ' WS006-OPER-UNT-ID                            29860000
298700                 ' ' WS006-EXT-SHP-ID (1:15)                      29870000
298800                 ' ' WS006-USERID                                 29880000
298900                 ' SQLCODE=' PV-DISP-SQLCODE                      29890000
299000                 ' 8990-EOJ-ROUTINE        '                      29900000
299100                   DELIMITED BY SIZE                              29910000
299200                      INTO PV-CICS-MSG-AREA                       29920000
299300        PERFORM 9900-WRITE-TO-CICS-LOG                            29930000
299400     END-IF.                                                      29940000
299500                                                                  29950000
299600     EXEC CICS                                                    29960000
299700         RETURN                                                   29970000
299800     END-EXEC.                                                    29980000
299900                                                                  29990000
300000****************************************************************  30000000
300100*   WRITE TO CICS LOG                                          *  30010000
300200****************************************************************  30020000
300300 9900-WRITE-TO-CICS-LOG.                                          30030000
300400                                                                  30040000
300500     MOVE SQLCODE               TO WS006-SQLCODE.                 30050000
300600     IF SQLCODE              NOT = 0                              30060000
300700        MOVE SQLCA              TO WS006-SQLCA.                   30070000
300800                                                                  30080000
300900     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH.       30090000
301000                                                                  30100000
301100     EXEC CICS                                                    30110000
301200          WRITEQ TD                                               30120000
301300          QUEUE  ('CSSL')                                         30130000
301400          FROM  (PV-CICS-MSG-AREA)                                30140000
301500          LENGTH  (PV-COMMAREA-LENGTH)                            30150000
301600          RESP  (PV-CICS-RESP)                                    30160000
301700     END-EXEC.                                                    30170000
301800                                                                  30180000
301900     MOVE SPACES TO PV-CICS-MSG-AREA.                             30190000
302000                                                                  30200000
302100******************************************************************30210000
302200*   END PGM WSKCS302                                              30220000
302300******************************************************************30230000
