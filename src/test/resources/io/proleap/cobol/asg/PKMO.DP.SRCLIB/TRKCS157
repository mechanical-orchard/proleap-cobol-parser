000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TRKCS157.                                         00040000
000500 AUTHOR.        ABRHAM IVERSON (STRATAGEM).                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  01-15-04.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    Y157 - POL AND POR CODE CRITERIA SPECIFICATIONS             *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00120000
001300*    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00130000
001400*    DETAIL SCREEN.  THE POL POR CODES, IF ENTERED, ARE EDITTED  *00140000
001500*    TO BE A VALID CODE.  ALL OTHER EDITS ARE DONE IN THE        *00150000
001600*    DESTINATION PROGRAMS WHEN THE 'GO-TO' TYPE FUNCTION IS USED *00160000
001700*    (LOCAL-FUNC-01 THRU LOCAL-FUNC-12, WITH DISPOSITION 'G').   *00170000
001800*                                                                *00180000
002100*----------------------------------------------------------------*00210000
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00211027
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00212027
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00213027
CICS  *-----------------------------------------------------------------00214027
002200                                                                  00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400                                                                  00240000
002500 DATA DIVISION.                                                   00250000
002600                                                                  00260000
002700 WORKING-STORAGE SECTION.                                         00270000
002800*                                                                 00280000
002900 01  DK-DB2-CONSTANTS.                                            00290000
003000     05  DK-ORG-CDE                PIC  X(03).                    00300000
003000     05  DK-ORG-TYP                PIC  X(03).                    00301012
003100     05  DK-ENT-ID                 PIC S9(09) COMP.               00310000
003200                                                                  00320000
003300 01  PV-PROGRAM-VARIABLES.                                        00330000
003400     05  PV-ASTRK-CNT              PIC S9(04)  VALUE +0           00340000
003500                                                    COMP SYNC.    00350000
003600     05  PV-ORG-CODE               PIC  X(03)  VALUE SPACE.       00360000
003600     05  PV-ORG-TYPE               PIC  X(03)  VALUE SPACE.       00361014
003700 01  PC-PROGRAM-CONSTANTS.                                        00370000
003800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'TR157A  '. 00380000
003900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'TRKM157 '. 00390000
004000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'TRKCS157'. 00400000
004100     05  PC-ASTRK                  PIC  X(01)  VALUE '*'.         00410000
004200     05  PC-A                      PIC  X(01)  VALUE 'A'.         00420000
004300     05  PC-I                      PIC  X(01)  VALUE 'I'.         00430000
004400     05  PC-PRIMARY                PIC XX    VALUE '01'.          00440000
004500     05  PC-TSYMSG-NUMBERS.                                       00450000
004600         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00460000
004700         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00470000
004800         10  PC-TSYMSG-00095       PIC  9(05)  VALUE  00095.      00480000
004900         10  PC-TSYMSG-00224       PIC  9(05)  VALUE  00224.      00490000
005000         10  PC-TSYMSG-01451       PIC  9(05)  VALUE  01451.      00500000
005100         10  PC-TSYMSG-01644       PIC  9(05)  VALUE  01644.      00510000
005200*                                                                 00520000
005300 01  PS-PROGRAM-SWITCHES.                                         00530000
005400     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00540000
005500         88  PS-ERROR                          VALUE  'Y'.        00550000
005600         88  PS-NO-ERROR                       VALUE  'N'.        00560000
005700                                                                  00570000
005800 01  PM-PROGRAM-MESSAGES.                                         00580000
005900     05  PM-ABEND-INFO-A.                                         00590000
006000         10  FILLER                PIC X(15)   VALUE              00600000
006100                                   'DP020-SRC-AID: '.             00610000
006200         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00620000
006300         10  FILLER                PIC X(19)   VALUE              00630000
006400                                   '. DP020-FK-ACTION: '.         00640000
006500         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00650000
006600         10  FILLER                PIC X(22)   VALUE              00660000
006700                                   '. DP020-FK-DISPN-IND: '.      00670000
006800         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00680000
006900         10  FILLER                PIC X(01)   VALUE '.'.         00690000
007000         10  FILLER                PIC X(19)   VALUE SPACE.       00700000
007100                                                                  00710000
007200                                                                  00720000
007300*----------------------------------------------------------------*00730000
007400*    MAP LAYOUT                                                  *00740000
007500*----------------------------------------------------------------*00750000
007600                                                                  00760000
007700     COPY TRKM157.                                                00770001
007800     EJECT                                                        00780000
007900*----------------------------------------------------------------*00790000
008000*    ATTRIBUTE SETTINGS COPYBOOK.                                *00800000
008100*----------------------------------------------------------------*00810000
008200                                                                  00820000
008300     COPY DPWS015.                                                00830000
008400                                                                  00840000
008500*----------------------------------------------------------------*00850000
008600*    FUNCTION KEYS COPYBOOK                                      *00860000
008700*----------------------------------------------------------------*00870000
008800                                                                  00880000
008900     COPY DPWS016.                                                00890000
009000 EJECT                                                            00900000
009100******************************************************************00910000
009200** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00920000
009300** SUB-ROUTINE (DPKUT100).                                      **00930000
009400******************************************************************00940000
009500     COPY DPWS010I.                                               00950000
009600 EJECT                                                            00960000
009700******************************************************************00970000
009800** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **00980000
009900** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **00990000
010000******************************************************************01000000
010100     COPY DPWS030.                                                01010000
CICS       COPY DPWS930.                                                01011027
010200 EJECT                                                            01020000
010300***************************************************************** 01030000
010400*    STANDARD COMMAREA.                                           01040000
010500***************************************************************** 01050000
010600                                                                  01060000
010700     COPY DPWS020.                                                01070000
010800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01080000
010900                                                                  01090000
011000***************************************************************** 01100000
011100*    INTER-APPLICATION COMMAREA.                                  01110000
011200***************************************************************** 01120000
011300                                                                  01130000
011400         10  INTER-APPL-COMM-AREA PIC X(230).                     01140000
011500     COPY TRWS157.                                                01150006
011600***************************************************************** 01160000
011700*    SPECIFIC COMMMAREA FOR TRKCS157.                             01170000
011800***************************************************************** 01180000
011900         10  ASC-SPECIFIC-COMMAREA.                               01190000
012000             15  ASC-ORG-CODE                   PIC  X(03).       01200000
012000             15  ASC-ORG-TYPE                   PIC  X(03).       01201010
012100             15  ASC-ORG-STD-EDI-CDE            PIC  X(05).       01210007
012200             15  ASC-ORG-CITY-NAME              PIC  X(30).       01220000
012300             15  ASC-ORG-CODE-IND               PIC  X(01).       01230000
012400                 88  ASC-VALID-ORG-CODE        VALUE 'Y'.         01240000
012500                 88  ASC-INVALID-ORG-CODE      VALUE 'N'.         01250000
012300             15  ASC-ORG-TYPE-IND               PIC  X(01).       01260011
012400                 88  ASC-VALID-ORG-TYPE        VALUE 'Y'.         01270011
012500                 88  ASC-INVALID-ORG-TYPE      VALUE 'N'.         01280011
013200             15  ASC-ORG-CNTRY-CDE              PIC  X(03).       01320008
013400             15  ASC-ORG-STAT-CDE               PIC  X(01).       01340000
013500     EJECT                                                        01350000
013600*----------------------------------------------------------------*01360000
013700*    ABEND PROCESSING COPYBOOK.                                  *01370000
013800*----------------------------------------------------------------*01380000
013900                                                                  01390000
014000     COPY DPWS013.                                                01400000
014100                                                                  01410000
014900*---------------------------------------------------------------* 01490000
015000*    DB2 AREA FOR TENTNME                                       * 01500000
015100*---------------------------------------------------------------* 01510000
015200     EXEC SQL                                                     01520000
015300          INCLUDE TENTNME                                         01530000
015400     END-EXEC.                                                    01540000
 15500                                                                  01550000
015600*---------------------------------------------------------------* 01560000
015700*    DB2 AREA FOR TEXTENT                                       * 01570000
015800*---------------------------------------------------------------* 01580000
015900     EXEC SQL                                                     01590000
016000          INCLUDE TEXTENT                                         01600000
016100     END-EXEC.                                                    01610000
016200                                                                  01620000
015600*---------------------------------------------------------------* 01621005
015700*    DB2 AREA FOR TRT_IMPRT_ORGN                                * 01622007
015800*---------------------------------------------------------------* 01623005
015900     EXEC SQL                                                     01624005
016000          INCLUDE TRT00010                                        01625007
016100     END-EXEC.                                                    01626005
015900     EXEC SQL                                                     01626107
016000          INCLUDE TIMFOB                                          01626207
016100     END-EXEC.                                                    01626307
016200                                                                  01627005
016300*---------------------------------------------------------------* 01630000
016400*    DB2 AREA FOR COMMUNICATIONS                                * 01640000
016500*---------------------------------------------------------------* 01650000
016600     EXEC SQL                                                     01660000
016700          INCLUDE SQLCA                                           01670000
016800     END-EXEC.                                                    01680000
016900                                                                  01690000
017000 EJECT                                                            01700000
017100 LINKAGE SECTION.                                                 01710000
017200                                                                  01720000
017300 01  DFHCOMMAREA.                                                 01730000
017400     05  FILLER                         OCCURS  1 TO 4072 TIMES   01740000
017500                                        DEPENDING ON EIBCALEN.    01750000
017600         10  FILLER                     PIC X.                    01760000
017700                                                                  01770000
017800                                                                  01780000
017900 PROCEDURE DIVISION.                                              01790000
018000***************************************************************** 01800000
018100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01810000
018200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01820000
018300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01830000
018400**                                                             ** 01840000
018500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01850000
018600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01860000
018700***************************************************************** 01870000
018800 0000-MAIN-MODULE.                                                01880000
018900     INITIALIZE DP030-CICS-API-FIELDS.                            01890000
019000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01900000
019100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01910000
019200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01920000
019300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01930000
019400     MOVE LENGTH OF TR157AI        TO DP030-MAP-LENGTH (1).       01940001
019500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01950000
019600     PERFORM 0001-CALL-CICS-ARCH-API.                             01960000
019700*                                                                 01970000
019800     PERFORM 1000-CONTROL-PROCESSING                              01980000
019900*                                                                 01990000
020000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02000000
020100     PERFORM 0001-CALL-CICS-ARCH-API.                             02010000
020200                                                                  02020000
020300 0001-CALL-CICS-ARCH-API.                                         02030000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02041027
020500                                    DFHCOMMAREA                   02050027
020600                                    DP030-CICS-API-FIELDS         02060027
020700                                    DP020-STANDARD-COMMAREA       02070027
020800                                    TR157AI.                      02080027
020900*                                                                 02090000
021000     IF  DP030-RC-CALL-SUCCESSFUL                                 02100000
021100         CONTINUE                                                 02110000
021200     ELSE                                                         02120000
021300         SET DP013-NO-ROLLBACK                                    02130000
021400             DP013-XCTL-DISPLAY-RESTART                           02140000
021500             DP013-CICS-ABEND      TO TRUE                        02150000
021600         MOVE 'BEFORE 0000-MAIN-MODULE'                           02160000
021700                                   TO DP013-PARAGRAPH             02170000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02191027
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02192027
022000         MOVE DP030-RETURN-CODE                                   02200000
022100                                   TO DP013-MESSAGE-TEXT (3)      02210000
022200         PERFORM DP013-0000-PROCESS-ABEND                         02220000
022300     END-IF.                                                      02230000
022400 EJECT                                                            02240000
022500*----------------------------------------------------------------*02250000
022600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02260000
022700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02270000
022800*----------------------------------------------------------------*02280000
022900                                                                  02290000
023000 1000-CONTROL-PROCESSING.                                         02300000
023100                                                                  02310000
023200     EVALUATE TRUE                                                02320000
023300         WHEN DP020-NEXT-ACT-INITIAL                              02330000
023400             INITIALIZE ASC-SPECIFIC-COMMAREA                     02340000
023500             PERFORM 4000-BUILD-INITIAL-PANEL                     02350000
023600                                                                  02360000
023700         WHEN DP020-NEXT-ACT-READ-MAP                             02370000
023800             PERFORM 2000-FKEY-PROCESSING                         02380000
023900                                                                  02390000
024000         WHEN DP020-NEXT-ACT-RETURN                               02400000
024100             MOVE SPACES  TO ASC-ORG-STAT-CDE                     02410000
024200                                                                  02420000
024300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02430000
024400             MOVE -1               TO AORGCODL                    02440000
024400             MOVE -1               TO AORGTYPL                    02441011
024500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  02450000
024600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02460000
024700                                                                  02470000
024800         WHEN OTHER                                               02480000
024900             SET DP013-LOGIC-ABEND                                02490000
025000                 DP013-NO-ROLLBACK TO TRUE                        02500000
025100             MOVE '1000-CONTROL-PROCESSING'                       02510000
025200                                   TO  DP013-PARAGRAPH            02520000
025300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02530000
025400                                   TO  DP013-MESSAGE-TEXT(1)      02540000
025500             MOVE DP020-NEXT-APPL-ACTIVITY                        02550000
025600                                   TO DP013-MESSAGE-TEXT(2)       02560000
025700             PERFORM DP013-0000-PROCESS-ABEND                     02570000
025800     END-EVALUATE.                                                02580000
025900                                                                  02590000
026000*----------------------------------------------------------------*02600000
026100* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02610000
026200* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02620000
026300* EDITS.                                                         *02630000
026400*----------------------------------------------------------------*02640000
026500                                                                  02650000
026600 2000-FKEY-PROCESSING.                                            02660000
026700                                                                  02670000
026800     EVALUATE TRUE                                                02680000
026900                                                                  02690000
027000         WHEN DP020-SRC-AID = DP016-CLEAR                         02700000
027100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02710000
027200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02720000
027300                                                                  02730000
027400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02740000
027500             INITIALIZE ASC-SPECIFIC-COMMAREA                     02750000
027600             PERFORM 4000-BUILD-INITIAL-PANEL                     02760000
027700             PERFORM 3200-RESET-ATTRIBUTES                        02770000
027800                                                                  02780000
027900         WHEN OTHER                                               02790000
028000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02800000
028100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02810000
028200             IF PS-NO-ERROR                                       02820007
028500                 SET DP030-CONTINUE-GO TO TRUE                    02850000
028600                 PERFORM 2100-CHECK-FUNCTION-KEY                  02860000
028700             ELSE                                                 02870000
028800                 SET DP030-OVERRIDE-GO TO TRUE                    02880000
028900             END-IF                                               02890000
029000     END-EVALUATE.                                                02900000
029100******************************************************************02910000
029200** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02920000
029300** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02930000
029400** FROM THE CICS ARCHITECTURE API.                              **02940000
029500******************************************************************02950000
029600 2100-CHECK-FUNCTION-KEY.                                         02960000
029700     EVALUATE TRUE                                                02970000
031000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              02971022
031100             MOVE 'I'    TO ASC-ORG-STAT-CDE                      02972022
031300             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02973022
                                                                        02974022
029800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              02980000
029900         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              02990000
                   IF ASC-ORG-CODE = SPACES                             02991013
                   OR ASC-ORG-TYPE = SPACES                             02992013
030300                 SET DP030-OVERRIDE-GO  TO TRUE                   02992113
030500                 MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       02992213
030700                 SET DP020-MSG-FATAL    TO TRUE                   02992313
                   ELSE                                                 02992413
030000                IF ASC-VALID-ORG-CODE                             03000025
031500                   IF ASC-ORG-STAT-CDE = PC-A                     03001025
030100                       PERFORM 2110-PREPARE-INTER-APPL-COMM       03010025
                         ELSE                                           03011025
031600                       SET DP030-OVERRIDE-GO  TO TRUE             03011125
031800                       MOVE PC-TSYMSG-01644   TO DP020-MSG-NUMBER 03011225
032000                       SET DP020-MSG-FATAL    TO TRUE             03011325
                         END-IF                                         03012025
030200                ELSE                                              03020013
030300                    SET DP030-OVERRIDE-GO  TO TRUE                03030013
030500                    MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER    03050013
030700                    SET DP020-MSG-FATAL    TO TRUE                03070013
030900                END-IF                                            03090013
                   END-IF                                               03091013
                                                                        03092022
031400         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              03140000
                   IF  ASC-VALID-ORG-CODE                               03141022
031500             AND ASC-ORG-STAT-CDE = PC-I                          03150022
031600                 SET DP030-OVERRIDE-GO  TO TRUE                   03160022
031800                 MOVE PC-TSYMSG-01644   TO DP020-MSG-NUMBER       03180022
032000                 SET DP020-MSG-FATAL    TO TRUE                   03200022
032200             ELSE                                                 03220000
032300                 MOVE 'A' TO ASC-ORG-STAT-CDE                     03230000
032400                 PERFORM 2110-PREPARE-INTER-APPL-COMM             03240000
032500             END-IF                                               03250000
032600                                                                  03260000
032700         WHEN DP020-SRC-AID = DP016-ENTER                         03270000
032800             CONTINUE                                             03280000
032900                                                                  03290000
033000         WHEN OTHER                                               03300000
033100             SET DP013-NO-ROLLBACK                                03310000
033200                 DP013-XCTL-DISPLAY-RESTART                       03320000
033300                 DP013-CICS-ABEND  TO TRUE                        03330000
033400             MOVE '2100-CHECK-FUNCTION-KEY'                       03340000
033500                                   TO DP013-PARAGRAPH             03350000
033600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03360000
033700                                   TO DP013-MESSAGE-TEXT (1)      03370000
033800             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 03380000
033900                                   TO DP013-MESSAGE-TEXT (2)      03390000
034000             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                03400000
034100             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 03410000
034200                                   TO PM-A-FK-ACTION              03420000
034300             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              03430000
034400                                   TO PM-A-FK-DISPN               03440000
034500             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      03450000
034600             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03460000
034700                                   TO DP013-MESSAGE-TEXT (4)      03470000
034800             PERFORM DP013-0000-PROCESS-ABEND                     03480000
034900     END-EVALUATE.                                                03490000
035000******************************************************************03500000
035100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03510000
035200** INTER-APPLICATION COMMAREA.                                  **03520000
035300******************************************************************03530000
035400 2110-PREPARE-INTER-APPL-COMM.                                    03540000
035500     INITIALIZE TR157-INTER-APPL-COMMAREA.                        03550006
035700                                                                  03570000
           MOVE ASC-ORG-CODE             TO TR157-IMPRT-ORGN-CDE        03580009
                                            PV-ORG-CODE.                03581007
           MOVE ASC-ORG-TYPE             TO TR157-IMPRT-ORGN-TYP-CDE    03582014
                                            PV-ORG-TYPE.                03583014
           MOVE ASC-ORG-CITY-NAME        TO TR157-CTY-NM.               03590009
           MOVE ASC-ORG-STAT-CDE         TO TR157-STAT-CDE.             03600017
                                                                        03690007
           PERFORM 4330-SELECT-EDI-CDE.                                 03691007
                                                                        03692007
           MOVE TRT00010-STD-EDI-CDE     TO ASC-ORG-STD-EDI-CDE         03693007
                                            TR157-STD-EDI-CDE.          03693109
           MOVE TRT00010-CNTRY-CDE       TO ASC-ORG-CNTRY-CDE           03694007
037300                                      TR157-CNTRY-CDE.            03730009
040600 EJECT                                                            04060000
040700*----------------------------------------------------------------*04070000
040800* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04080000
040900* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04090000
041000* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04100000
041100*----------------------------------------------------------------*04110000
041200                                                                  04120000
041300 2200-MOVE-SCREEN-TO-COMMAREA.                                    04130000
041400     IF  AORGCODL > ZERO                                          04140000
041500         MOVE AORGCODI             TO ASC-ORG-CODE                04150000
041600     ELSE                                                         04160000
041700         IF  AORGCODF = DP015-ERASE-EOF                           04170000
041800             MOVE SPACE            TO ASC-ORG-CODE                04180000
041900                                      ASC-ORG-CITY-NAME           04190000
042000         END-IF                                                   04200000
042100     END-IF.                                                      04210000
                                                                        04210112
041400     IF  AORGTYPL > ZERO                                          04211012
041500         MOVE AORGTYPI             TO ASC-ORG-TYPE                04212012
041600     ELSE                                                         04213012
041700         IF  AORGTYPF = DP015-ERASE-EOF                           04214012
041800             MOVE SPACE            TO ASC-ORG-TYPE                04215012
042000         END-IF                                                   04217012
042100     END-IF.                                                      04218012
042200                                                                  04220000
042300*----------------------------------------------------------------*04230000
042400* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *04240000
042500* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *04250000
042600* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*04260000
042700* IN THE DESTINATION PROGRAM, NOT HERE.                          *04270000
042800*----------------------------------------------------------------*04280000
042900                                                                  04290000
043000 3000-EDIT-DATA-IN-COMMAREA.                                      04300000
043100                                                                  04310000
043200     PERFORM 3200-RESET-ATTRIBUTES.                               04320000
043300                                                                  04330000
043400     IF ASC-ORG-CODE > SPACE                                      04340022
043500     OR ASC-ORG-CODE = SPACE                                      04350022
043600         MOVE ASC-ORG-CODE         TO DK-ORG-CDE                  04360000
               MOVE ASC-ORG-TYPE         TO DK-ORG-TYP                  04361012
044400         PERFORM 3100-SELECT-ORG                                  04371022
045900         MOVE TRT00010-CTY-NM      TO ASC-ORG-CITY-NAME           04372022
046000                                      AORGDESO                    04373022
               MOVE TRT00010-STAT-CDE    TO ASC-ORG-STAT-CDE            04374022
047500     END-IF.                                                      04750000
                                                                        04760022
047700     IF  PS-NO-ERROR                                              04770000
047800         MOVE -1                     TO AORGCODL                  04780026
047800         MOVE -1                     TO AORGTYPL                  04781026
047900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      04790026
048100     END-IF.                                                      04810000
048200                                                                  04820000
048300 3100-SELECT-ORG.                                                 04830000
048400                                                                  04840000
048500     EXEC SQL                                                     04850004
               SELECT A.CTY_NM                                          04931007
                     ,A.STAT_CDE                                        04932007
               INTO   :TRT00010-CTY-NM                                  04933007
                     ,:TRT00010-STAT-CDE                                04934007
               FROM   TRT_IMPRT_ORGN A                                  04935007
               WHERE  A.IMPRT_ORGN_CDE     = :DK-ORG-CDE                04936012
                 AND  A.IMPRT_ORGN_TYP_CDE = :DK-ORG-TYP                04936112
                 AND  A.STAT_CDE IN ('A', 'I')                          04937007
               GROUP BY A.CTY_NM                                        04938007
                       ,A.STAT_CDE                                      04939007
049400     END-EXEC                                                     04940004
049500                                                                  04950000
049600         EVALUATE TRUE                                            04960000
049700             WHEN SQLCODE = ZERO                                  04970000
049800                 SET ASC-VALID-ORG-CODE TO TRUE                   04980000
049900             WHEN SQLCODE = +100                                  04990000
050000                 SET ASC-INVALID-ORG-CODE TO TRUE                 05000000
050100                 MOVE SPACES TO TRT00010-CTY-NM                   05010007
050200             WHEN OTHER                                           05020000
050300                 MOVE '3100-SELECT-ORG'                           05030000
050400                                   TO DP013-PARAGRAPH             05040000
050500                 MOVE 'SQL ERROR SELECTING ORG CITY'              05050000
050600                                   TO DP013-MESSAGE-TEXT (1)      05060000
050700                 MOVE SQLCA        TO DP013-SQLCA                 05070000
050800                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (1)    05080005
050900                 SET DP013-DB2-ABEND                              05090000
051000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05100000
051100                 PERFORM DP013-0000-PROCESS-ABEND                 05110000
051200         END-EVALUATE.                                            05120000
051300                                                                  05130000
051400******************************************************************05140000
051500** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **05150000
051600** MAP.                                                         **05160000
051700******************************************************************05170000
051800 3200-RESET-ATTRIBUTES.                                           05180000
051900                                                                  05190000
052000     MOVE DP015-UNP-ALP-NOR-OFF    TO AORGCODA                    05200011
                                            AORGTYPA.                   05201011
052100     MOVE DP015-GREEN              TO AORGCODC                    05210011
                                            AORGTYPC.                   05211011
052200     MOVE DP015-UNDERLINE          TO AORGCODH                    05220011
                                            AORGTYPH.                   05221011
052300                                                                  05230000
052400     MOVE DP015-HL-OFF             TO AORGDESH                    05240000
052500     MOVE DP015-PRO-NOR-OFF        TO AORGDESA                    05250000
052600     MOVE DP015-BLUE               TO AORGDESC.                   05260000
052700*                                                                 05270000
052800*----------------------------------------------------------------*05280000
052900*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *05290000
053000*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *05300000
053100*  IT HERE.                                                      *05310000
053200*----------------------------------------------------------------*05320000
053300 4000-BUILD-INITIAL-PANEL.                                        05330000
053400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        05340000
053500     MOVE -1                       TO AORGCODL                    05350011
                                            AORGTYPL.                   05351011
053600*                                                                 05360011
053700  4330-SELECT-EDI-CDE.                                            05370007
053800                                                                  05380000
053900     EXEC SQL                                                     05390000
054000          SELECT STD_EDI_CDE                                      05400008
054200                ,CNTRY_CDE                                        05420008
054900          INTO  :TRT00010-STD-EDI-CDE                             05490007
055300              , :TRT00010-CNTRY-CDE                               05530007
055700          FROM  TRT_IMPRT_ORGN                                    05570007
055800          WHERE IMPRT_ORGN_CDE     = :PV-ORG-CODE                 05580014
                  AND IMPRT_ORGN_TYP_CDE = :PV-ORG-TYPE                 05581015
055900            AND STAT_CDE = :PC-A                                  05590000
                GROUP BY STD_EDI_CDE                                    05591008
                        ,CNTRY_CDE                                      05592008
056000     END-EXEC.                                                    05600000
056100                                                                  05610000
056200         EVALUATE TRUE                                            05620000
056300             WHEN SQLCODE = ZERO                                  05630000
056400                 CONTINUE                                         05640000
056500             WHEN SQLCODE = +100                                  05650000
056800                 MOVE SPACES TO TRT00010-STD-EDI-CDE              05680007
056900                 MOVE SPACES TO TRT00010-CNTRY-CDE                05690007
057200             WHEN OTHER                                           05720000
057300                 MOVE '4330-SELECT-EDI-CDE'                       05730007
057400                                       TO DP013-PARAGRAPH         05740007
057500                 MOVE 'SQL ERROR SELECTING EDI CDE'               05750007
057600                                       TO DP013-MESSAGE-TEXT (1)  05760007
057700                 MOVE SQLCA            TO DP013-SQLCA             05770007
057800                 MOVE 'TRT_IMPRT_ORGN' TO DP013-DB2-TABLE-NAME (1)05780007
057900                 SET DP013-DB2-ABEND                              05790000
058000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05800000
058100                 PERFORM DP013-0000-PROCESS-ABEND                 05810000
058200         END-EVALUATE.                                            05820000
058300                                                                  05830000
058400                                                                  05840000
058500 4331-SELECT-ENTNME.                                              05850000
058600                                                                  05860000
058700     EXEC SQL                                                     05870000
058800         SELECT A.ENT_NAME_DESC                                   05880000
058900            INTO :ENTNME-ENT-NAME-DESC                            05890000
059000             FROM TENTNME A                                       05900000
059100             WHERE A.ENT_ID    = :DK-ENT-ID                       05910000
059200             AND SEQ_NBR =                                        05920000
059300                 (SELECT MAX(SEQ_NBR)                             05930000
059400                    FROM TENTNME                                  05940000
059500                   WHERE ENT_ID   = :DK-ENT-ID                    05950000
059600                     AND TYPE_CDE = :PC-PRIMARY)                  05960000
059700             AND TYPE_CDE = :PC-PRIMARY                           05970000
059800     END-EXEC                                                     05980000
059900                                                                  05990000
060000         EVALUATE TRUE                                            06000000
060100             WHEN SQLCODE = ZERO                                  06010000
060200                 CONTINUE                                         06020000
060300             WHEN SQLCODE = +100                                  06030000
060400                 MOVE SPACES TO ENTNME-ENT-NAME-DESC              06040000
060500                 CONTINUE                                         06050000
060600             WHEN OTHER                                           06060000
060700                 MOVE '4330-SELECT-EDI-CDE'                       06070007
060800                                   TO DP013-PARAGRAPH             06080000
060900                 MOVE 'SQL ERROR SELECTING ENTNME NAME'           06090000
061000                                   TO DP013-MESSAGE-TEXT (1)      06100000
061100                 MOVE SQLCA        TO DP013-SQLCA                 06110000
061200                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    06120000
061300                 SET DP013-DB2-ABEND                              06130000
061400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06140000
061500                 PERFORM DP013-0000-PROCESS-ABEND                 06150000
061600         END-EVALUATE.                                            06160000
061700                                                                  06170000
061800 4332-SELECT-SCAC.                                                06180000
061900                                                                  06190000
062000     EXEC SQL                                                     06200000
062100         SELECT A.ENT_ID,                                         06210000
062200                B.SCAC_CDE                                        06220000
062300            INTO :ENTNME-ENT-ID,                                  06230000
062400                 :EXTENT-SCAC-CDE                                 06240000
062500             FROM TENTNME A,                                      06250000
062600                  TEXTENT B                                       06260000
062700             WHERE A.ENT_ID = B.ENT_ID                            06270000
062800               AND A.ENT_ID = :DK-ENT-ID                          06280000
062900               AND A.TYPE_CDE = :PC-PRIMARY                       06290000
063000     END-EXEC                                                     06300000
063100                                                                  06310000
063200         EVALUATE TRUE                                            06320000
063300             WHEN SQLCODE = ZERO                                  06330000
063400                 CONTINUE                                         06340000
063500             WHEN SQLCODE = +100                                  06350000
063600                 MOVE SPACES TO EXTENT-SCAC-CDE                   06360000
063700                 CONTINUE                                         06370000
063800             WHEN OTHER                                           06380000
063900                 MOVE '4332-SELECT-SCAC  '                        06390000
064000                                   TO DP013-PARAGRAPH             06400000
064100                 MOVE 'SQL ERROR SELECTING ENTNME NAME'           06410000
064200                                   TO DP013-MESSAGE-TEXT (1)      06420000
064300                 MOVE SQLCA        TO DP013-SQLCA                 06430000
064400                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    06440000
064500                 SET DP013-DB2-ABEND                              06450000
064600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06460000
064700                 PERFORM DP013-0000-PROCESS-ABEND                 06470000
064800         END-EVALUATE.                                            06480000
064900                                                                  06490000
065000*----------------------------------------------------------------*06500000
065100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *06510000
065200*----------------------------------------------------------------*06520000
065300 4400-MOVE-COMMAREA-TO-SCREEN.                                    06530000
065400     MOVE ASC-ORG-CODE             TO AORGCODO.                   06540000
           MOVE ASC-ORG-TYPE             TO AORGTYPO.                   06541012
065500     MOVE ASC-ORG-CITY-NAME        TO AORGDESO.                   06550000
065600 EJECT                                                            06560000
065700*----------------------------------------------------------------*06570000
065800*    ABEND PROCESSOR MODULE                                      *06580000
065900*----------------------------------------------------------------*06590000
066000                                                                  06600000
066100     COPY DPPD013.                                                06610000
