       ID DIVISION.                                                     00010035
                                                                        00020035
       PROGRAM-ID.      MLKUT436.                                       00030035
       AUTHOR.          TESS BESTE.                                     00040035
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050035
       DATE-WRITTEN     06/1999.                                        00060035
       DATE-COMPILED.                                                   00070035
      ******************************************************************00080035
      *                                                                 00090035
      *  MLKUT436 - CREATE MONTHLY DEPARTMENT PLANNING EXTRACT FOR      00100035
      *             COMBINED LEDGER.                                    00110035
      *                                                                 00120057
      *  THIS PROGRAM READS A PLANNING EXTRACT FILE, REFORMATS IT,      00170035
      *  AND CREATES ANOTHER EXTRACT FILE THAT IS USED TO LOAD THE      00180035
      *  MONTHLY DEPARTMENT PLAN TABLE (TMNDPLN), WHICH IS THE SOURCE OF00190035
      *  THE MONTHLY PLAN DATA ON THE COMBINED LEDGER REPORT.           00200035
      *                                                                 00210035
      *  BOTH THE INPUT AND OUTPUT EXTRACT FILES ARE AT A DEPARTMENT    00220035
      *  LEVEL AND CONTAIN MONTHLY DATA FOR A PARTICULAR SEASON.  EACH  00230035
      *  RECORD ON THE INPUT EXTRACT FILE CONTAINS 6 OCCURRENCES (ONE   00240035
      *  FOR EACH MONTH IN THE SEASON) OF ONE PARTICULAR PIECE OF       00250035
      *  INFORMATION (SALES RETAIL AMOUNT, FOR EXAMPLE).  EACH RECORD   00260035
      *  ON THE OUTPUT FILE CONTAINS ALL THE NECESSARY PIECES OF        00270035
      *  INFORMATION FOR ONE MONTH.                                     00280035
      *                                                                 00290035
      *  TO CONVERT A RECORD FROM THE INPUT FORMAT TO THE OUTPUT        00300035
      *  FORMAT, ALL THE INFORMATION FOR A DEPARTMENT IS TABLED BY      00310035
      *  MONTH AS IT IS READ.  WHEN THE DEPARTMENT NUMBER CHANGES,      00320035
      *  6 OUTPUT RECORDS ARE WRITTEN FROM THE TABLED DATA  - ONE       00330035
      *  RECORD FOR EACH MONTH IN THE SEASON.                           00340035
      *                                                                 00350035
      *  THE SEASON BEGIN DATE IS READ FROM A CONTROL CARD THAT IS      00360035
      *  UPDATED BY BPK930.  IT IS USED TO RETRIEVE THE FISCAL MONTH    00370035
      *  END DATE AND FISCAL MONTH NUMBER FROM TDTATTR FOR EACH MONTH   00380035
      *  IN THE SEASON.                                                 00390035
      *                                                                 00400035
      ******************************************************************00410035
      *    WR/PITS#    DATE      DESCRIPTION                            00420035
      *    --------  --------  -----------------------------------------00430035
      *  WR10422   9/9/99    REPLACING RECEIPTS WITH GROSS RECEIPTS     00440057
      *                        AND ADDING RECEIPT ADJUSTMENTS           00450035
      *  WR10422   01/07/00  ADDING BEGINNING INVENTORY                 00470057
      *                        COMP SALES AND CUM MARKUP PERCENT        00480035
99999 *  WR99999   08/17/2000 ROD JANSSEN                               00480257
99999 *    PLANNING/OTB EXTRACT CHANGES DUE TO AIM PROJECT.             00480341
99999 *    (ADJUSTMENTS TO UNSTRING VARIABLES AND NEW ROWS)             00481041
21517 *  WR21517   09/28/00  COMBINED LEDGER PHASE 6                    00482057
31355 *  WR# 31355  11/17/2000   ROD JANSSEN                            00484057
31355 *    E-Commerce Combined Ledger Report Modification.......        00485049
W04031*  WR# 99999  04/03/2001   ROD JANSSEN                            00485157
W04031*    CHANGE ALL RECORD TYPE VERBIAGE TO UPPER CASE.               00485257
11752A*  11752A     08/04/2017   J SELWITSCHKA                          00485376
11752A*    EP UPGRADE. DO NOT ABEND IF INPUT FILE IS EMPTY.             00485476
      ******************************************************************00490035
                                                                        00500035
       ENVIRONMENT DIVISION.                                            00510035
                                                                        00520035
       CONFIGURATION SECTION.                                           00530035
                                                                        00540035
       SOURCE-COMPUTER.        IBM-3090.                                00550035
       OBJECT-COMPUTER.        IBM-3090.                                00560035
                                                                        00570035
       INPUT-OUTPUT SECTION.                                            00580035
                                                                        00590035
       FILE-CONTROL.                                                    00600035
                                                                        00610035
           SELECT  DPT-PLN-FILE                                         00620035
               ASSIGN TO INP01.                                         00630035
                                                                        00640035
           SELECT MNTHLY-PLN-EXTRACT-FILE                               00650035
               ASSIGN TO OUT01.                                         00660035
                                                                        00670035
       DATA DIVISION.                                                   00680035
                                                                        00690035
       FILE SECTION.                                                    00700035
                                                                        00710035
       FD  DPT-PLN-FILE                                                 00720035
           RECORDING MODE F                                             00730035
           LABEL RECORDS ARE STANDARD                                   00740035
           BLOCK CONTAINS  0 RECORDS                                    00750035
           RECORD CONTAINS 400 CHARACTERS                               00760035
           DATA RECORD IS DPT-PLN-REC.                                  00770035
                                                                        00780035
       01  DPT-PLN-REC                 PIC X(400).                      00790035
                                                                        00800035
       FD  MNTHLY-PLN-EXTRACT-FILE                                      00810035
           RECORDING MODE IS F                                          00820035
           LABEL RECORDS ARE STANDARD                                   00830035
           BLOCK CONTAINS 0 RECORDS.                                    00840035
                                                                        00850035
       01  MNTHLY-PLN-EXTRACT-REC      PIC X(130).                      00860035
                                                                        00870035
       WORKING-STORAGE SECTION.                                         00880035
                                                                        00890035
       01  FMD-FSCL-MN-DATA.                                            00900035
           05  FMD-FSCL-MN-END-DTE-1   PIC X(10).                       00910035
           05  FMD-FSCL-MN-NBR-1       PIC X(02).                       00920035
           05  FMD-FSCL-MN-END-DTE-2   PIC X(10).                       00930035
           05  FMD-FSCL-MN-NBR-2       PIC X(02).                       00940035
           05  FMD-FSCL-MN-END-DTE-3   PIC X(10).                       00950035
           05  FMD-FSCL-MN-NBR-3       PIC X(02).                       00960035
           05  FMD-FSCL-MN-END-DTE-4   PIC X(10).                       00970035
           05  FMD-FSCL-MN-NBR-4       PIC X(02).                       00980035
           05  FMD-FSCL-MN-END-DTE-5   PIC X(10).                       00990035
           05  FMD-FSCL-MN-NBR-5       PIC X(02).                       01000035
           05  FMD-FSCL-MN-END-DTE-6   PIC X(10).                       01010035
           05  FMD-FSCL-MN-NBR-6       PIC X(02).                       01020035
                                                                        01030035
       01  FMT-FSCL-MN-TABLE REDEFINES FMD-FSCL-MN-DATA.                01040035
           05  FMT-FSCL-MN-ENTRY       OCCURS 6.                        01050035
               10  FMT-FSCL-MN-END-DTE PIC X(10).                       01060035
               10  FMT-FSCL-MN-NBR     PIC X(02).                       01070035
                                                                        01080035
                                                                        01090035
      *  THIS TABLE IS USED TO HOLD ALL INPUT DATA FOR A DEPARTMENT     01100035
      *  BY MONTH.  WHEN A BREAK OCCURS ON DEPARTMENT NUMBER, THE       01110035
      *  OUTPUT RECORDS ARE BUILT FROM THIS TABLE.                      01120035
       01  PDT-PLAN-DATA-TABLE.                                         01130035
           05  PDT-PLAN-DATA-TABLE-ENTRY                                01140035
                                       OCCURS 6.                        01140135
               10  PDT-SLS-RTL-AMT     PIC S9(09)V99  COMP-3 VALUE +0.  01140201
               10  PDT-MKDN-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01140301
               10  PDT-RCPT-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01140401
               10  PDT-RCPT-NET-COST-AMT                                01140501
                                       PIC S9(09)V99  COMP-3 VALUE +0.  01140601
               10  PDT-SHNK-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01140701
               10  PDT-END-INV-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  01140801
               10  PDT-BEG-INV-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  01140901
W04031         10  PDT-MKUP-PCT      PIC S9(09)V9999  COMP-3 VALUE +0.  01141174
W04031******   10  PDT-MKUP-PCT        PIC S9(09)V99  COMP-3 VALUE +0.  01141274
               10  PDT-SLS-COST-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01141301
               10  PDT-GRO-MRGN-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01141401
               10  PDT-GRO-MRGN-PCT    PIC S9(03)V99  COMP-3 VALUE +0.  01141501
               10  PDT-PADJ-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01141601
               10  PDT-PADJ-NET-COST-AMT                                01141701
                                       PIC S9(09)V99  COMP-3 VALUE +0.  01141835
               10  PDT-CUM-MKUP-PCT    PIC S9(09)V99  COMP-3 VALUE +0.  01141901
               10  PDT-COMP-SLS-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  01142001
21517          10  PDT-CMPR-END-INV-AMT                                 01142147
21517                                  PIC S9(09)V99  COMP-3 VALUE +0.  01142247
                                                                        01142347
       01  PC-PROGRAM-CONSTANTS.                                        01143035
           05  PC-COMMA                     PIC X     VALUE ','.        01144035
           05  PC-UNDERSCORE                PIC X     VALUE '_'.        01145035
                                                                        01146035
       01  PS-PROGRAM-SWITCHES.                                         01148035
           05  PS-END-OF-DPT-PLN-FILE-SW    PIC X     VALUE 'N'.        01149035
               88  PS-END-OF-DPT-PLN-FILE             VALUE 'Y'.        01150035
                                                                        01160035
           05  PS-DATE-FOUND-SW             PIC X     VALUE 'N'.        01170035
               88  PS-DATE-FOUND                      VALUE 'Y'.        01180035
               88  PS-DATE-NOT-FOUND                  VALUE 'N'.        01190035
                                                                        01200035
       01  PV-PROGRAM-VARIABLES.                                        01220035
           05  PV-UNSTR-PTR            PIC S9(04)     COMP SYNC         01230035
                                                      VALUE ZERO.       01240035
W04031     05  PV-UNSTR-PTR-SAVE       PIC S9(04)     COMP SYNC         01241060
W04031                                                VALUE ZERO.       01242060
           05  PV-PARAGRAPH-NAME       PIC X(30)      VALUE SPACE.      01250035
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)      VALUE SPACE.      01260035
           05  PV-PGM-NAME             PIC X(08)      VALUE 'MLKUT436'. 01270035
           05  PV-ABEND-CODE           PIC S9(04)     COMP SYNC         01280035
                                                      VALUE ZERO.       01290035
           05  PV-PREV-DEPT-NBR        PIC X(03).                       01300035
31355      05  PV-PREV-STORE-TYPE      PIC X(07)      VALUE SPACE.      01301054
31355          88 TOTAL-ALL-COMPANY                   VALUE 'TOTALCO'.  01302054
31355          88 E-STORE                             VALUE 'VIRTSTR'.  01303054
31355          88 PHYSICAL-STORE                      VALUE 'PHYSSTR'.  01304054
           05  PV-AMT                  PIC S9(09)V9(06).                01310035
           05  PV-DATA-TYPE            PIC X(02)      VALUE SPACE.      01340035
               88 AP-PLAN-DATA                        VALUE 'AP'.       01350035
           05  PV-RETAIL-OR-COST-DATA  PIC X(03)      VALUE SPACE.      01360035
               88 RETAIL-DATA                         VALUE 'DLR'.      01380156
               88 COST-DATA                           VALUE 'CST'.      01380256
99999          88 MARKUP-DATA                         VALUE 'MU'.       01381041
                                                                        01386049
      ******************************************************************01390035
      *** W A R N I N G   -  LOWER CASE USED IN PROGRAM                 01400035
      *** W A R N I N G   -  LOWER CASE USED IN PROGRAM                 01410035
      ******************************************************************01420035
           05  PV-REC-TYPE             PIC X(09)      VALUE SPACE.      01430035
W04031         88 RECEIPT-REC                         VALUE 'GREC'.     01440057
               88 SALES-REC                           VALUE 'SLS'.      01450035
W04031         88 PURCHASE-ADJ-REC                    VALUE 'RECADJ'.   01460057
99999          88 BOM-INVENTORY-REC                   VALUE 'BOP'.      01470041
99999          88 EOM-INVENTORY-REC                   VALUE 'EOP'.      01480041
               88 MARKDOWN-REC                        VALUE 'TMKD'.     01490035
               88 SHRINK-REC                          VALUE 'SHR'.      01500035
               88 GROSS-MARGIN-REC                    VALUE 'GM'.       01510035
               88 GROSS-MARGIN-PCT-REC                VALUE 'GMP'.      01520035
99999          88 NET-RECEIPT-REC                     VALUE 'REC'.      01530141
               88 COMP-SALES-REC                      VALUE 'C_SLS'.    01540035
               88 CUM-MARKUP-REC                      VALUE 'CMUP'.     01550035
21517          88 COMP-EOM-INV-REC                    VALUE 'C_EOP'.    01550148
99999      05  PV-TOTAL-COMPANY        PIC X(04)      VALUE SPACE.      01550347
99999          88 TOTAL-1                             VALUE 'TOT1'.     01550447
99999      05  PV-STORE-TYPE           PIC X(07)      VALUE SPACE.      01551041
99999          88 TOTAL-COMPANY                       VALUE 'TOTALCO'.  01552041
99999          88 VIRTUAL-STORE                       VALUE 'VIRTSTR'.  01553041
99999          88 RETAIL-STORE                        VALUE 'PHYSSTR'.  01554041
                                                                        01570035
       01  SS-SUBSCRIPTS.                                               01580035
           05  SS-MONTH                PIC S9(04)     COMP SYNC.        01590035
           05  SS-MONTH-MAX            PIC S9(04)     COMP SYNC         01600035
                                                      VALUE +6.         01610035
       01  US-UNSTRING-AREA.                                            01620035
           05  US-DEPT-NBR-6-CHAR.                                      01630035
               10  FILLER              PIC X(03).                       01640035
               10  US-DEPT-NBR         PIC X(03).                       01650035
99999      05  US-TOTAL-COMPANY        PIC X(04)        VALUE SPACES.   01650141
99999      05  US-STORE-TYPE           PIC X(07)        VALUE SPACES.   01651041
           05  US-REC-TYPE             PIC X(07)        VALUE SPACE.    01660035
           05  US-DATA-TYPE            PIC X(02)        VALUE SPACE.    01670035
           05  US-RTL-CST              PIC X(03)        VALUE SPACE.    01680035
           05  US-MONTHLY-AMT          OCCURS 6                         01690035
                                       PIC S9(09)V9(04) VALUE ZERO.     01700035
W04031     05  US-WORK-FIELD.                                           01701060
W04031         10  US-WRKFLD-REC-TYPE  PIC X(05)  VALUE SPACES.         01701159
W04031         10  FILLER              PIC X(01)  VALUE SPACE.          01701259
W04031         10  US-WRKFLD-RTL-CST   PIC X(04)  VALUE SPACES.         01701367
W04031     05  US-TALLY                PIC S9(04) COMP VALUE ZEROS.     01702059
                                                                        01710035
      *************************************************************     01720035
      * INPUT AREA FOR DEPARTMENT PLANNING RECORD                 *     01730035
      *************************************************************     01740035
       01  PV-DPT-PLN-REC              PIC X(400).                      01750035
                                                                        01760035
      *************************************************************     01770035
      * COPYBOOK FOR OUTPUT MONTHLY PLANNING EXTRACT RECORD.      *     01780035
      *************************************************************     01790035
21517      COPY MLRD124.                                                01800047
                                                                        01810035
      *************************************************************     01820035
      * COPYBOOK FOR THE MERCHANISE PLANNING CONTROL CARD         *     01830035
      *************************************************************     01840035
           COPY BPRD045.                                                01850035
                                                                        01860035
      *************************************************************     01870035
      * COPYBOOK FOR CALENDAR ROUTINE                             *     01880035
      *************************************************************     01890035
           COPY DPWS500.                                                01900035
                                                                        01910035
      *************************************************************     01920035
      * COPYBOOK FOR NUMERIC EDIT ROUTINE                         *     01930035
      *************************************************************     01940035
           COPY DPWS010I.                                               01950035
                                                                        01960035
      *************************************************************     01970035
      *  DATE ATTRIBUTE TABLE                                     *     01980035
      *************************************************************     01990035
           EXEC SQL                                                     02000035
               INCLUDE TDTATTR                                          02010035
           END-EXEC.                                                    02020035
                                                                        02030035
      *************************************************************     02040035
      * DB2 ERROR MESSAGE AREA                                    *     02050035
      *************************************************************     02060035
           COPY DPWS004.                                                02070035
                                                                        02080035
      *************************************************************     02090035
      * DB2 COMMUNICATION AREA                                    *     02100035
      *************************************************************     02110035
           EXEC SQL                                                     02120035
               INCLUDE SQLCA                                            02130035
           END-EXEC.                                                    02140035
                                                                        02150035
       EJECT                                                            02160035
                                                                        02170035
       PROCEDURE DIVISION.                                              02180035
                                                                        02190035
                                                                        02200035
       1000-MAINLINE.                                                   02210035
                                                                        02220035
           PERFORM 1100-INITIALIZATION.                                 02230035
                                                                        02240035
           PERFORM 7000-READ-DPT-PLN-FILE.                              02250035
                                                                        02260035
           IF NOT PS-END-OF-DPT-PLN-FILE                                02270035
               PERFORM 2100-UNSTRING-DPT-PLN-REC                        02280035
               MOVE US-DEPT-NBR  TO PV-PREV-DEPT-NBR                    02290035
31355          MOVE US-STORE-TYPE TO PV-PREV-STORE-TYPE                 02291054
               PERFORM 2000-PROCESS-DEPT-DATA                           02300035
                   UNTIL PS-END-OF-DPT-PLN-FILE                         02310035
               PERFORM 2300-BUILD-AND-WRITE-EXTRACT                     02320035
           ELSE                                                         02330076
11752A*        DISPLAY '** ABEND **'                                    02340076
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02350076
               DISPLAY '** PARAGRAPH 1000-MAINLINE  **'                 02360076
               DISPLAY '** THE INPUT DEPARTMENT PLAN FILE WAS EMPTY.'   02370076
11752A*        MOVE +4008 TO PV-ABEND-CODE                              02380076
11752A*        PERFORM 9999-ABEND                                       02390076
           END-IF.                                                      02400035
                                                                        02410035
           CLOSE DPT-PLN-FILE                                           02420035
                 MNTHLY-PLN-EXTRACT-FILE.                               02430035
                                                                        02440035
           STOP RUN.                                                    02450035
                                                                        02460035
                                                                        02470035
       1100-INITIALIZATION.                                             02480035
                                                                        02490035
           ACCEPT BP045-REC.                                            02500035
                                                                        02510035
           DISPLAY PV-PGM-NAME ' CONTROL CARD: ' BP045-REC.             02520066
                                                                        02530035
      *    MAKE SURE THE LAST RUN OF BPK930 WAS IN TY MODE.             02540035
           IF NOT BP045-TY-RUN-MODE                                     02550035
               DISPLAY '** ABEND **'                                    02560066
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02570066
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION  **'           02580066
               DISPLAY '** INVALID RUN MODE ON CONTROL CARD.'           02590066
               DISPLAY '** EXPECTING TY.'                               02600066
               DISPLAY '** CONTROL CARD RUN MODE = ' BP045-RUN-MODE     02610066
               MOVE +4003 TO PV-ABEND-CODE                              02620035
               PERFORM 9999-ABEND                                       02630035
           END-IF.                                                      02640035
                                                                        02650035
      *    CALL THE CALENDAR ROUTINE TO CONVERT THE SEASON BEGIN DATE   02660035
      *    ON THE CONTROL CARD TO DB2 ISO FORMAT.                       02670035
           MOVE BP045-SEASON-START-DATE  TO DPG52-LK-DATE-INPUT.        02680035
           SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       02690035
           SET DPG52-LK-DTE-ISO          TO TRUE                        02700035
                                                                        02710035
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          02720035
                                                   DPG53 DPG54          02730035
                                                   DPG55 DPG56          02740035
           IF DPG54-SEVERE-ERROR                                        02750035
               DISPLAY '** ABEND **'                                    02760066
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02770066
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            02780066
               IF DPG54-DATE-INVALID                                    02790035
                   DISPLAY                                              02800066
                       '** INVALID SEASON START DATE ON CONTROL CARD.'  02810066
                   DISPLAY                                              02820066
                       '** EXPECTING CCYYMMDD DATE FORMAT.'             02830066
                   DISPLAY                                              02840066
                       '** SEASON START DATE ON CONTROL CARD: '         02850066
                           BP045-SEASON-START-DATE                      02860066
                   MOVE +4003 TO PV-ABEND-CODE                          02870035
               ELSE                                                     02880035
                   DISPLAY 'ERROR CALLING CALENDAR ROUTINE: '           02890066
                            DPG54-ERROR-MESSAGE                         02900066
                   MOVE +4019 TO PV-ABEND-CODE                          02910035
               END-IF                                                   02920035
               PERFORM 9999-ABEND                                       02930035
           END-IF.                                                      02940035
                                                                        02950035
      *    MAKE SURE THE SEASON BEGIN DATE ON THE CONTROL CARD IS A     02960035
      *    VALID SEASON BEGIN DATE.                                     02970035
           MOVE  DPG55-DB2-ISO-DATE-FMT TO DTATTR-KY-DTE.               02980035
                                                                        02990035
           PERFORM  8000-GET-DATE-ATTRIBUTES.                           03000035
           IF PS-DATE-NOT-FOUND                                         03010035
               DISPLAY '** ABEND **'                                    03020066
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  03030066
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            03040066
               DISPLAY '** SEASON START DATE ON CONTROL CARD NOT'       03050066
               DISPLAY '** FOUND ON TDTATTR.'                           03060066
               DISPLAY '** SEASON START DATE: ' BP045-SEASON-START-DATE 03070066
               MOVE +4003 TO PV-ABEND-CODE                              03080035
               PERFORM 9999-ABEND                                       03090035
           END-IF.                                                      03100035
                                                                        03110035
           IF DTATTR-KY-DTE NOT = DTATTR-SEA-BEG-DTE                    03120035
               DISPLAY '** ABEND **'                                    03130066
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  03140066
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            03150066
               DISPLAY '** SEASON START DATE ON CONTROL CARD IS '       03160066
               DISPLAY '** NOT AN ACTUAL SEASON BEGIN DATE.'            03170066
               DISPLAY '** SEASON START DATE ON CONTROL CARD: '         03180066
                        BP045-SEASON-START-DATE                         03190066
               MOVE +4003 TO PV-ABEND-CODE                              03200035
               PERFORM 9999-ABEND                                       03210035
           END-IF.                                                      03220035
                                                                        03230035
      *    GET THE FISCAL-MONTH-END-DATE AND FISCAL-MONTH-NUMBER FOR    03240035
      *    EACH MONTH IN THE SEASON.                                    03250035
           PERFORM 8100-GET-MONTHS-IN-SEASON.                           03260035
                                                                        03270035
      *    OPEN THE FILES.                                              03280035
           OPEN INPUT  DPT-PLN-FILE                                     03290035
                OUTPUT MNTHLY-PLN-EXTRACT-FILE.                         03300035
                                                                        03310035
                                                                        03320035
       2000-PROCESS-DEPT-DATA.                                          03330035
                                                                        03340035
31355 **** IF US-DEPT-NBR NOT = PV-PREV-DEPT-NBR                        03341054
31355      IF US-DEPT-NBR NOT = PV-PREV-DEPT-NBR OR                     03350054
31355         US-STORE-TYPE NOT = PV-PREV-STORE-TYPE                    03351054
               PERFORM 2300-BUILD-AND-WRITE-EXTRACT                     03360035
               INITIALIZE PDT-PLAN-DATA-TABLE                           03370035
               MOVE US-DEPT-NBR   TO PV-PREV-DEPT-NBR                   03380035
31355          MOVE US-STORE-TYPE TO PV-PREV-STORE-TYPE                 03381054
           END-IF.                                                      03390035
                                                                        03400035
           PERFORM 2200-LOAD-DATA-INTO-TABLE.                           03410035
                                                                        03420035
           PERFORM 7000-READ-DPT-PLN-FILE.                              03430035
                                                                        03440035
           IF NOT PS-END-OF-DPT-PLN-FILE                                03450035
               PERFORM 2100-UNSTRING-DPT-PLN-REC                        03460035
           END-IF.                                                      03470035
                                                                        03480035
                                                                        03490035
      ******************************************************************03500035
      *  THE INPUT RECORDS ARE NOT IN A FIXED FORMAT.  THE FIELDS ARE   03510035
      *  DELIMITED BY COMMAS AND THE NUMERIC FIELDS ARE IN A CHARACTER  03520035
      *  FORMAT.  THIS PARAGRAPH UNSTRINGS THE DATA AND CONVERTS THE    03530035
      *  COST AND RETAIL AMOUNTS INTO A NUMERIC FORMAT.                 03540035
      ******************************************************************03550035
       2100-UNSTRING-DPT-PLN-REC.                                       03560035
                                                                        03570035
      *     UNSTRING THE DEPARTMENT NUMBER.                             03580035
            MOVE +1       TO PV-UNSTR-PTR                               03590035
            UNSTRING PV-DPT-PLN-REC                                     03600035
                DELIMITED BY PC-COMMA                                   03610035
                INTO         US-DEPT-NBR-6-CHAR                         03620035
                POINTER      PV-UNSTR-PTR                               03630035
            END-UNSTRING.                                               03640035
99999 *     UNSTRING THE TOTALS BY COMPANY.                             03650041
  |         UNSTRING PV-DPT-PLN-REC                                     03660037
  |             DELIMITED BY PC-COMMA                                   03670037
  |             INTO         US-TOTAL-COMPANY                           03680037
  |             POINTER      PV-UNSTR-PTR                               03690037
  |         END-UNSTRING.                                               03700037
  |   *     UNSTRING THE STORE TYPE.                                    03700137
  |         UNSTRING PV-DPT-PLN-REC                                     03700237
  |             DELIMITED BY PC-COMMA                                   03700337
  |             INTO         US-STORE-TYPE                              03700437
  |             POINTER      PV-UNSTR-PTR                               03700537
99999       END-UNSTRING.                                               03700641
                                                                        03701159
W04031*** RECORD TYPE/RETAIL COST UNSTRING LOGIC.                       03701259
  |         UNSTRING PV-DPT-PLN-REC                                     03701759
  |             DELIMITED BY PC-COMMA                                   03701859
  |             INTO         US-WORK-FIELD                              03701959
  |             POINTER      PV-UNSTR-PTR                               03702059
  |         END-UNSTRING.                                               03702159
  |                                                                     03702259
  |         MOVE PV-UNSTR-PTR  TO PV-UNSTR-PTR-SAVE.                    03702361
  |                                                                     03702461
  |         MOVE ZEROS    TO US-TALLY.                                  03702559
  |         INSPECT US-WORK-FIELD TALLYING US-TALLY FOR ALL '_'.        03702659
  |                                                                     03702759
  |         IF US-TALLY IS GREATER THAN 1                               03702860
  |   ***   UNSTRING THE RECORD TYPE.                                   03702959
  |   ***   UNSTRING THE RTL/CST INDICATOR.                             03703059
  |             MOVE US-WRKFLD-REC-TYPE TO US-REC-TYPE                  03703159
  |             MOVE US-WRKFLD-RTL-CST  TO US-RTL-CST                   03704059
  |         ELSE                                                        03704259
  |         MOVE +1                 TO PV-UNSTR-PTR                     03704359
  |   ***   UNSTRING THE RECORD TYPE.                                   03704459
  |             UNSTRING US-WORK-FIELD                                  03704559
  |                 DELIMITED BY PC-UNDERSCORE                          03704659
  |                 INTO         US-REC-TYPE                            03704759
  |                 POINTER      PV-UNSTR-PTR                           03704859
  |             END-UNSTRING                                            03704959
  |   ***   UNSTRING THE RTL/CST INDICATOR.                             03705059
  |             UNSTRING US-WORK-FIELD                                  03705159
  |                 DELIMITED BY PC-COMMA                               03705259
  |                 INTO         US-RTL-CST                             03705359
  |                 POINTER      PV-UNSTR-PTR                           03705459
  |             END-UNSTRING                                            03705559
  |         MOVE PV-UNSTR-PTR-SAVE  TO PV-UNSTR-PTR                     03705659
  |         END-IF.                                                     03705759
W04031                                                                  03705859
      *     UNSTRING THE DATA TYPE.                                     03710035
            UNSTRING PV-DPT-PLN-REC                                     03720035
W04031          DELIMITED BY PC-COMMA                                   03721058
W04031***       DELIMITED BY PC-UNDERSCORE                              03730058
                INTO         US-DATA-TYPE                               03740035
                POINTER      PV-UNSTR-PTR                               03750035
            END-UNSTRING.                                               03760035
W04031***   UNSTRING THE RTL/CST INDICATOR.                             03770058
W04031***   UNSTRING PV-DPT-PLN-REC                                     03780058
W04031***       DELIMITED BY PC-COMMA                                   03790058
W04031***       INTO         US-RTL-CST                                 03800058
W04031***       POINTER      PV-UNSTR-PTR                               03810058
W04031***   END-UNSTRING.                                               03820058
      *     UNSTRING THE MONTHLY AMT FIELDS AND CONVERT THEM TO NUMERIC 03830035
      *     VALUES.                                                     03840035
            PERFORM VARYING SS-MONTH FROM 1 BY 1                        03850035
              UNTIL SS-MONTH > SS-MONTH-MAX                             03860035
                                                                        03870035
               MOVE SPACE TO DP010I-UNEDITED-FIELD                      03880035
               UNSTRING PV-DPT-PLN-REC                                  03890035
                   DELIMITED BY PC-COMMA                                03900035
                             OR PC-UNDERSCORE                           03910035
                   INTO         DP010I-UNEDITED-FIELD                   03920035
                   POINTER      PV-UNSTR-PTR                            03930035
               END-UNSTRING                                             03940035
               MOVE 12          TO DP010I-MAXIMUM-DIGITS                03950035
               MOVE 4           TO DP010I-MAXIMUM-DECIMALS              03960035
               SET DP010I-NEGATIVE-ALLOWED TO TRUE                      03970035
                                                                        03980035
               PERFORM 2150-NUMERIC-CONVERSION                          03990035
                                                                        04000035
               MOVE DP010I-NUMERIC-FIELD TO PV-AMT                      04010035
               COMPUTE US-MONTHLY-AMT (SS-MONTH) = PV-AMT * 100         04020035
           END-PERFORM.                                                 04030035
                                                                        04040035
                                                                        04050035
       2150-NUMERIC-CONVERSION.                                         04060035
                                                                        04070035
           CALL DP010I-NUMERIC-EDIT-ROUTINE USING                       04080035
                                            DP010I-NUMERIC-EDIT-AREA.   04090035
                                                                        04100035
           IF DP010I-NO-ERROR-DETECTED                                  04110035
               NEXT SENTENCE                                            04120035
           ELSE                                                         04130035
               IF DP010I-INVALID-CHARACTER                              04140035
                   MOVE ZEROES TO DP010I-NUMERIC-FIELD                  04150035
               ELSE                                                     04160035
                   DISPLAY '** ABEND **'                                04170066
                   DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'              04180066
                   DISPLAY '** PARAGRAPH 2150-NUMERIC-CONVERSION **'    04190066
                   DISPLAY '** ERROR IN CALLED NUMERIC EDIT ROUTINE.'   04200066
                   DISPLAY '** ERROR INDICATOR = ' DP010I-ERROR-IND     04210066
                   DISPLAY '** INPUT RECORD = ' PV-DPT-PLN-REC          04220066
                   MOVE +4008 TO PV-ABEND-CODE                          04230035
                   PERFORM 9999-ABEND                                   04240035
               END-IF                                                   04250035
           END-IF.                                                      04260035
                                                                        04270035
                                                                        04280035
      ******************************************************************04290035
      *  THIS PARAGRAPH EVALUATES THE 'UNSTRUNG' INPUT DATA TO DETERMINE04300035
      *  WHAT TYPE OF RECORD IS BEING PROCESSED.  IF THE RECORD IS ONE  04310035
      *  OF THE TYPES THAT SHOULD BE EXTRACTED, THE COST/RETAIL AMOUNTS 04320035
      *  ARE LOADED BY MONTH INTO A WORKING STORAGE TABLE.              04330035
      ******************************************************************04340035
       2200-LOAD-DATA-INTO-TABLE.                                       04350035
                                                                        04360035
           MOVE US-DATA-TYPE           TO PV-DATA-TYPE.                 04370035
           MOVE US-RTL-CST             TO PV-RETAIL-OR-COST-DATA.       04380035
           MOVE US-REC-TYPE            TO PV-REC-TYPE.                  04390035
99999      MOVE US-TOTAL-COMPANY       TO PV-TOTAL-COMPANY.             04391041
99999      MOVE US-STORE-TYPE          TO PV-STORE-TYPE.                04392041
                                                                        04400035
99999      EVALUATE TRUE                                                04410041
99999        WHEN TOTAL-1                                               04420041
99999      EVALUATE TRUE                                                04421041
99999        WHEN TOTAL-COMPANY                                         04422049
31355          OR VIRTUAL-STORE                                         04422149
31355          OR RETAIL-STORE                                          04422249
           EVALUATE true                                                04423039
             WHEN AP-PLAN-DATA                                          04424039
               EVALUATE true                                            04430035
                 WHEN COST-DATA                                         04440035
                   EVALUATE true                                        04450035
                     WHEN RECEIPT-REC                                   04460035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04470035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04480035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           04490035
                               TO PDT-RCPT-NET-COST-AMT (SS-MONTH)      04500035
                         END-PERFORM                                    04510035
                     WHEN SALES-REC                                     04520035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04530035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04540035
                             MOVE US-MONTHLY-AMT  (SS-MONTH)            04550035
                               TO PDT-SLS-COST-AMT (SS-MONTH)           04560035
                         END-PERFORM                                    04570035
                     WHEN PURCHASE-ADJ-REC                              04580035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04590035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04600035
                             MOVE US-MONTHLY-AMT  (SS-MONTH)            04610035
                               TO PDT-PADJ-NET-COST-AMT (ss-month)      04620035
                         END-PERFORM                                    04630035
                   END-EVALUATE                                         04640035
                 WHEN RETAIL-DATA                                       04650035
                   EVALUATE true                                        04660035
                     WHEN BOM-INVENTORY-REC                             04670035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04680035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04690035
                             MOVE US-MONTHLY-AMT      (SS-MONTH)        04700035
                               TO PDT-BEG-INV-RTL-AMT (SS-MONTH)        04710035
                         END-PERFORM                                    04720035
                     WHEN EOM-INVENTORY-REC                             04730035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04740035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04750035
                             MOVE US-MONTHLY-AMT      (SS-MONTH)        04760035
                               TO PDT-END-INV-RTL-AMT (SS-MONTH)        04770035
                         END-PERFORM                                    04780035
                     WHEN RECEIPT-REC                                   04790035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04800035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04810035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           04820035
                               TO PDT-RCPT-RTL-AMT (SS-MONTH)           04830035
                         END-PERFORM                                    04840035
                     WHEN PURCHASE-ADJ-REC                              04850035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04860035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04870035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           04880035
                               TO PDT-PADJ-RTL-AMT (SS-MONTH)           04890035
                         END-PERFORM                                    04900035
                     WHEN SALES-REC                                     04910035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04920035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04930035
                             MOVE US-MONTHLY-AMT  (SS-MONTH)            04940035
                               TO PDT-SLS-RTL-AMT (SS-MONTH)            04950035
                         END-PERFORM                                    04960035
                     WHEN MARKDOWN-REC                                  04970035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           04980035
                           UNTIL SS-MONTH > SS-MONTH-MAX                04990035
                             MOVE US-MONTHLY-AMT  (SS-MONTH)            05000035
                               TO PDT-MKDN-RTL-AMT (SS-MONTH)           05010035
                         END-PERFORM                                    05020035
                     WHEN SHRINK-REC                                    05030035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           05040035
                           UNTIL SS-MONTH > SS-MONTH-MAX                05050035
                             MOVE US-MONTHLY-AMT  (SS-MONTH)            05060035
                               TO PDT-SHNK-RTL-AMT (SS-MONTH)           05070035
                         END-PERFORM                                    05080035
                     WHEN GROSS-MARGIN-REC                              05090035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           05100035
                           UNTIL SS-MONTH > SS-MONTH-MAX                05110035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           05120035
                               TO PDT-GRO-MRGN-AMT (SS-MONTH)           05130035
                         END-PERFORM                                    05140035
                     WHEN GROSS-MARGIN-PCT-REC                          05150035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           05160035
                           UNTIL SS-MONTH > SS-MONTH-MAX                05170035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           05180035
                               TO PDT-GRO-MRGN-PCT (SS-MONTH)           05190035
                         END-PERFORM                                    05200035
99999 ************   WHEN MARKUP-PCT-REC                                05210041
99999 ************       PERFORM VARYING SS-MONTH FROM 1 BY 1           05220041
99999 ************         UNTIL SS-MONTH > SS-MONTH-MAX                05230041
99999 ************           MOVE US-MONTHLY-AMT (SS-MONTH)             05240041
99999 ************             TO PDT-MKUP-PCT   (SS-MONTH)             05250041
99999 ************       END-PERFORM                                    05260041
                     WHEN COMP-SALES-REC                                05270035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           05280035
                           UNTIL SS-MONTH > SS-MONTH-MAX                05290035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           05300035
                               TO PDT-COMP-SLS-AMT (SS-MONTH)           05310035
                         END-PERFORM                                    05320035
                     WHEN CUM-MARKUP-REC                                05330035
                         PERFORM VARYING SS-MONTH FROM 1 BY 1           05340035
                           UNTIL SS-MONTH > SS-MONTH-MAX                05350035
                             MOVE US-MONTHLY-AMT   (SS-MONTH)           05360035
                               TO PDT-CUM-MKUP-PCT (SS-MONTH)           05370035
                         END-PERFORM                                    05380035
21517                WHEN COMP-EOM-INV-REC                              05380147
21517                    PERFORM VARYING SS-MONTH FROM 1 BY 1           05380247
21517                      UNTIL SS-MONTH > SS-MONTH-MAX                05380347
21517                        MOVE US-MONTHLY-AMT       (SS-MONTH)       05380447
21517                          TO PDT-CMPR-END-INV-AMT (SS-MONTH)       05380547
21517                    END-PERFORM                                    05380647
99999              END-EVALUATE                                         05380747
99999            WHEN MARKUP-DATA                                       05381041
99999              EVALUATE TRUE                                        05382041
99999                WHEN NET-RECEIPT-REC                               05383041
99999                    PERFORM VARYING SS-MONTH FROM 1 BY 1           05384041
99999                      UNTIL SS-MONTH > SS-MONTH-MAX                05385041
99999                        MOVE US-MONTHLY-AMT      (SS-MONTH)        05386041
99999                          TO PDT-MKUP-PCT        (SS-MONTH)        05387042
99999                    END-PERFORM                                    05388041
                   END-EVALUATE                                         05390035
               END-EVALUATE                                             05400035
           END-EVALUATE                                                 05410039
99999      END-EVALUATE                                                 05411041
99999      END-EVALUATE.                                                05412041
                                                                        05420035
                                                                        05430035
      ******************************************************************05440035
      *  THIS PARAGRAPH USES THE DATA THAT WAS TABLED FOR THE           05450035
      *  DEPARTMENT TO BUILD AND WRITE ONE OUTPUT RECORD FOR EACH MONTH 05460035
      *  IN THE SEASON.                                                 05470035
      ******************************************************************05480035
       2300-BUILD-AND-WRITE-EXTRACT.                                    05490035
31355 *** BUILD THE PHYSICAL STORE RECORD....                           05491049
  |                                                                     05492049
  |        IF PHYSICAL-STORE                                            05493053
  |            MOVE PV-PREV-DEPT-NBR     TO ML124-DEPT-NBR              05494049
  |            MOVE 'P'                  TO ML124-CHNL-CDE              05495049
  |                                                                     05496049
  |            PERFORM VARYING SS-MONTH FROM 1 BY 1                     05498049
  |              UNTIL SS-MONTH > SS-MONTH-MAX                          05499049
  |                MOVE FMT-FSCL-MN-NBR       (SS-MONTH)                05499149
  |                  TO ML124-FSCL-MN-NBR                               05499249
  |                MOVE FMT-FSCL-MN-END-DTE   (SS-MONTH)                05499349
  |                  TO ML124-FSCL-MN-END-DTE                           05499449
  |                MOVE PDT-SLS-RTL-AMT       (SS-MONTH)                05499549
  |                  TO ML124-SLS-RTL-AMT                               05499649
  |                MOVE PDT-MKDN-RTL-AMT      (SS-MONTH)                05499749
  |                  TO ML124-MKDN-RTL-AMT                              05499849
  |                MOVE PDT-RCPT-RTL-AMT      (SS-MONTH)                05499949
  |                  TO ML124-RCPT-RTL-AMT                              05500049
  |                MOVE PDT-RCPT-NET-COST-AMT (SS-MONTH)                05500149
  |                  TO ML124-RCPT-NET-COST-AMT                         05500249
  |                MOVE PDT-SHNK-RTL-AMT      (SS-MONTH)                05500349
  |                  TO ML124-SHNK-RTL-AMT                              05500449
  |                MOVE PDT-END-INV-RTL-AMT   (SS-MONTH)                05500549
31355                TO ML124-END-INV-RTL-AMT                           05500670
W04031             COMPUTE PDT-MKUP-PCT (SS-MONTH)                      05500772
W04031                 = PDT-MKUP-PCT (SS-MONTH) * 100                  05500870
31355              MOVE PDT-MKUP-PCT          (SS-MONTH)                05500972
  |                  TO ML124-MKUP-PCT                                  05501072
  |                MOVE PDT-SLS-COST-AMT      (SS-MONTH)                05501172
  |                  TO ML124-SLS-COST-AMT                              05501249
  |                MOVE PDT-GRO-MRGN-AMT      (SS-MONTH)                05501349
  |                  TO ML124-GRO-MRGN-AMT                              05501449
  |                MOVE PDT-GRO-MRGN-PCT      (SS-MONTH)                05501549
  |                  TO ML124-GRO-MRGN-PCT                              05501649
  |                MOVE PDT-PADJ-RTL-AMT      (SS-MONTH)                05501749
  |                  TO ML124-PADJ-RTL-AMT                              05501849
  |                MOVE PDT-PADJ-NET-COST-AMT (SS-MONTH)                05501949
  |                  TO ML124-PADJ-NET-COST-AMT                         05502049
  |                MOVE PDT-BEG-INV-RTL-AMT   (SS-MONTH)                05502149
  |                  TO ML124-BEG-INV-RTL-AMT                           05502270
  |                MOVE PDT-CUM-MKUP-PCT      (SS-MONTH)                05502470
  |                  TO ML124-CUM-MKUP-PCT                              05502570
  |                MOVE PDT-COMP-SLS-AMT      (SS-MONTH)                05502670
  |                  TO ML124-CMPR-STR-SLS-AMT                          05502749
  |                MOVE PDT-CMPR-END-INV-AMT  (SS-MONTH)                05502849
  |                  TO ML124-CMPR-END-INV-AMT                          05502949
  |                PERFORM 7100-WRITE-MNTHLY-PLN-EXTRACT                05503049
  |            END-PERFORM                                              05503149
  |        END-IF.                                                      05503249
  |                                                                     05503349
  |   *** BUILD THE VIRTUAL STORE RECORD....                            05503449
  |                                                                     05503549
  |        IF E-STORE                                                   05504053
  |            MOVE PV-PREV-DEPT-NBR     TO ML124-DEPT-NBR              05505049
  |            MOVE 'V'                  TO ML124-CHNL-CDE              05506049
  |                                                                     05507049
  |            PERFORM VARYING SS-MONTH FROM 1 BY 1                     05508049
  |              UNTIL SS-MONTH > SS-MONTH-MAX                          05509049
  |                MOVE FMT-FSCL-MN-NBR       (SS-MONTH)                05509149
  |                  TO ML124-FSCL-MN-NBR                               05509249
  |                MOVE FMT-FSCL-MN-END-DTE   (SS-MONTH)                05509349
  |                  TO ML124-FSCL-MN-END-DTE                           05509449
  |                MOVE PDT-SLS-RTL-AMT       (SS-MONTH)                05509549
  |                  TO ML124-SLS-RTL-AMT                               05509649
  |                MOVE PDT-MKDN-RTL-AMT      (SS-MONTH)                05509749
  |                  TO ML124-MKDN-RTL-AMT                              05509849
  |                MOVE PDT-RCPT-RTL-AMT      (SS-MONTH)                05509949
  |                  TO ML124-RCPT-RTL-AMT                              05510049
  |                MOVE PDT-RCPT-NET-COST-AMT (SS-MONTH)                05510149
  |                  TO ML124-RCPT-NET-COST-AMT                         05510249
  |                MOVE PDT-SHNK-RTL-AMT      (SS-MONTH)                05510349
  |                  TO ML124-SHNK-RTL-AMT                              05510449
  |                MOVE PDT-END-INV-RTL-AMT   (SS-MONTH)                05510549
  |                  TO ML124-END-INV-RTL-AMT                           05510649
W04031             COMPUTE PDT-MKUP-PCT (SS-MONTH)                      05510772
W04031                 = PDT-MKUP-PCT (SS-MONTH) * 100                  05510872
31355              MOVE PDT-MKUP-PCT          (SS-MONTH)                05510972
  |                  TO ML124-MKUP-PCT                                  05511072
  |                MOVE PDT-SLS-COST-AMT      (SS-MONTH)                05511549
  |                  TO ML124-SLS-COST-AMT                              05511649
  |                MOVE PDT-GRO-MRGN-AMT      (SS-MONTH)                05511749
  |                  TO ML124-GRO-MRGN-AMT                              05511849
  |                MOVE PDT-GRO-MRGN-PCT      (SS-MONTH)                05511949
  |                  TO ML124-GRO-MRGN-PCT                              05512049
  |                MOVE PDT-PADJ-RTL-AMT      (SS-MONTH)                05512149
  |                  TO ML124-PADJ-RTL-AMT                              05512249
  |                MOVE PDT-PADJ-NET-COST-AMT (SS-MONTH)                05512349
  |                  TO ML124-PADJ-NET-COST-AMT                         05512449
  |                MOVE PDT-BEG-INV-RTL-AMT   (SS-MONTH)                05512549
  |                  TO ML124-BEG-INV-RTL-AMT                           05512649
  |                MOVE PDT-CUM-MKUP-PCT      (SS-MONTH)                05512770
  |                  TO ML124-CUM-MKUP-PCT                              05512870
  |                MOVE PDT-COMP-SLS-AMT      (SS-MONTH)                05512949
  |                  TO ML124-CMPR-STR-SLS-AMT                          05513049
  |                MOVE PDT-CMPR-END-INV-AMT  (SS-MONTH)                05513149
  |                  TO ML124-CMPR-END-INV-AMT                          05513249
  |                PERFORM 7100-WRITE-MNTHLY-PLN-EXTRACT                05513349
  |            END-PERFORM                                              05513449
  |        END-IF.                                                      05513549
  |                                                                     05513649
  |   *** BUILD THE TOTAL COMPANY RECORD....                            05513750
  |                                                                     05513853
  |        IF TOTAL-ALL-COMPANY                                         05513953
  |            MOVE PV-PREV-DEPT-NBR     TO ML124-DEPT-NBR              05514053
  |            MOVE 'A'                  TO ML124-CHNL-CDE              05514153
  |                                                                     05514253
  |            PERFORM VARYING SS-MONTH FROM 1 BY 1                     05514353
  |              UNTIL SS-MONTH > SS-MONTH-MAX                          05514453
  |                MOVE FMT-FSCL-MN-NBR       (SS-MONTH)                05514553
  |                  TO ML124-FSCL-MN-NBR                               05514653
  |                MOVE FMT-FSCL-MN-END-DTE   (SS-MONTH)                05514753
  |                  TO ML124-FSCL-MN-END-DTE                           05514853
  |                MOVE PDT-SLS-RTL-AMT       (SS-MONTH)                05514953
  |                  TO ML124-SLS-RTL-AMT                               05515053
  |                MOVE PDT-MKDN-RTL-AMT      (SS-MONTH)                05515153
  |                  TO ML124-MKDN-RTL-AMT                              05515253
  |                MOVE PDT-RCPT-RTL-AMT      (SS-MONTH)                05515353
  |                  TO ML124-RCPT-RTL-AMT                              05515453
  |                MOVE PDT-RCPT-NET-COST-AMT (SS-MONTH)                05515553
  |                  TO ML124-RCPT-NET-COST-AMT                         05515653
  |                MOVE PDT-SHNK-RTL-AMT      (SS-MONTH)                05515753
  |                  TO ML124-SHNK-RTL-AMT                              05515853
  |                MOVE PDT-END-INV-RTL-AMT   (SS-MONTH)                05515953
  |                  TO ML124-END-INV-RTL-AMT                           05516053
W04031             COMPUTE PDT-MKUP-PCT (SS-MONTH)                      05516172
W04031                 = PDT-MKUP-PCT (SS-MONTH) * 100                  05516272
31355              MOVE PDT-MKUP-PCT          (SS-MONTH)                05516372
  |                  TO ML124-MKUP-PCT                                  05516472
  |                MOVE PDT-SLS-COST-AMT      (SS-MONTH)                05516953
  |                  TO ML124-SLS-COST-AMT                              05517053
  |                MOVE PDT-GRO-MRGN-AMT      (SS-MONTH)                05517153
  |                  TO ML124-GRO-MRGN-AMT                              05517253
  |                MOVE PDT-GRO-MRGN-PCT      (SS-MONTH)                05517353
  |                  TO ML124-GRO-MRGN-PCT                              05517453
  |                MOVE PDT-PADJ-RTL-AMT      (SS-MONTH)                05517553
  |                  TO ML124-PADJ-RTL-AMT                              05517653
  |                MOVE PDT-PADJ-NET-COST-AMT (SS-MONTH)                05517753
  |                  TO ML124-PADJ-NET-COST-AMT                         05517853
  |                MOVE PDT-BEG-INV-RTL-AMT   (SS-MONTH)                05517953
  |                  TO ML124-BEG-INV-RTL-AMT                           05518053
  |                MOVE PDT-CUM-MKUP-PCT      (SS-MONTH)                05518170
  |                  TO ML124-CUM-MKUP-PCT                              05518270
  |                MOVE PDT-COMP-SLS-AMT      (SS-MONTH)                05518353
  |                  TO ML124-CMPR-STR-SLS-AMT                          05518453
  |                MOVE PDT-CMPR-END-INV-AMT  (SS-MONTH)                05518553
  |                  TO ML124-CMPR-END-INV-AMT                          05518653
  |                PERFORM 7100-WRITE-MNTHLY-PLN-EXTRACT                05518753
  |            END-PERFORM                                              05518853
  |        END-IF.                                                      05518953
31355                                                                   05519069
       7000-READ-DPT-PLN-FILE.                                          05930035
                                                                        05940035
           READ DPT-PLN-FILE                                            05950035
               INTO PV-DPT-PLN-REC                                      05960035
                   AT END SET PS-END-OF-DPT-PLN-FILE TO TRUE.           05970035
                                                                        05980035
                                                                        05990035
       7100-WRITE-MNTHLY-PLN-EXTRACT.                                   06000035
                                                                        06010035
           WRITE MNTHLY-PLN-EXTRACT-REC  FROM                           06020035
                 ML124-MNTHLY-PLN-EXTRACT-REC.                          06030035
                                                                        06040035
                                                                        06050035
       8000-GET-DATE-ATTRIBUTES.                                        06060035
                                                                        06070035
           EXEC SQL                                                     06080035
                SELECT                                                  06090035
                    SEA_BEG_DTE                                         06100035
                INTO                                                    06110035
                    :DTATTR-SEA-BEG-DTE                                 06120035
                FROM                                                    06130035
                    TDTATTR                                             06140035
                WHERE                                                   06150035
                    KY_DTE = :DTATTR-KY-DTE                             06160035
           END-EXEC.                                                    06170035
                                                                        06180035
           EVALUATE TRUE                                                06190035
               WHEN SQLCODE = ZERO                                      06200035
                   SET PS-DATE-FOUND     TO TRUE                        06210035
               WHEN SQLCODE = +100                                      06220035
                   SET PS-DATE-NOT-FOUND TO TRUE                        06230035
               WHEN OTHER                                               06240035
                   DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           06250066
                   MOVE    '8000-GET-DATE-ATTRIBUTES'                   06260035
                                                TO PV-PARAGRAPH-NAME    06270035
                   MOVE    'SELECT ROW FROM TDTATTR'                    06280035
                                                TO PV-DB2-OPER-ATTEMPTED06290035
                   PERFORM 9998-SQL-ABEND                               06300035
           END-EVALUATE.                                                06310035
                                                                        06320035
                                                                        06330035
      ******************************************************************06340035
      *  THIS PARAGRAPH RETRIEVES THE FISCAL-MONTH-END-DATE AND FISCAL- 06350035
      *  MONTH-NUMBER FOR ALL 6 MONTHS IN THE SEASON.  THESE VALUES     06360035
      *  WILL BE USED TO BUILD THE OUTPUT RECORDS.                      06370035
      ******************************************************************06380035
       8100-GET-MONTHS-IN-SEASON.                                       06390035
                                                                        06400035
           EXEC SQL                                                     06410035
                SELECT                                                  06420035
                    A.FSCL_MN_END_DTE                                   06430035
                   ,A.FSCL_MN_NBR                                       06440035
                   ,B.FSCL_MN_END_DTE                                   06450035
                   ,B.FSCL_MN_NBR                                       06460035
                   ,C.FSCL_MN_END_DTE                                   06470035
                   ,C.FSCL_MN_NBR                                       06480035
                   ,D.FSCL_MN_END_DTE                                   06490035
                   ,D.FSCL_MN_NBR                                       06500035
                   ,E.FSCL_MN_END_DTE                                   06510035
                   ,E.FSCL_MN_NBR                                       06520035
                   ,F.FSCL_MN_END_DTE                                   06530035
                   ,F.FSCL_MN_NBR                                       06540035
                INTO                                                    06550035
                    :FMD-FSCL-MN-END-DTE-1                              06560035
                   ,:FMD-FSCL-MN-NBR-1                                  06570035
                   ,:FMD-FSCL-MN-END-DTE-2                              06580035
                   ,:FMD-FSCL-MN-NBR-2                                  06590035
                   ,:FMD-FSCL-MN-END-DTE-3                              06600035
                   ,:FMD-FSCL-MN-NBR-3                                  06610035
                   ,:FMD-FSCL-MN-END-DTE-4                              06620035
                   ,:FMD-FSCL-MN-NBR-4                                  06630035
                   ,:FMD-FSCL-MN-END-DTE-5                              06640035
                   ,:FMD-FSCL-MN-NBR-5                                  06650035
                   ,:FMD-FSCL-MN-END-DTE-6                              06660035
                   ,:FMD-FSCL-MN-NBR-6                                  06670035
                FROM                                                    06680035
                    TDTATTR A                                           06690035
                   ,TDTATTR B                                           06700035
                   ,TDTATTR C                                           06710035
                   ,TDTATTR D                                           06720035
                   ,TDTATTR E                                           06730035
                   ,TDTATTR F                                           06740035
                WHERE                                                   06750035
                    A.KY_DTE = :DTATTR-KY-DTE                           06760035
                AND A.NFM_END_DTE = B.KY_DTE                            06770035
                AND B.NFM_END_DTE = C.KY_DTE                            06780035
                AND C.NFM_END_DTE = D.KY_DTE                            06790035
                AND D.NFM_END_DTE = E.KY_DTE                            06800035
                AND E.NFM_END_DTE = F.KY_DTE                            06810035
           END-EXEC.                                                    06820035
                                                                        06830035
           EVALUATE TRUE                                                06840035
               WHEN SQLCODE = ZERO                                      06850035
                   CONTINUE                                             06860035
               WHEN OTHER                                               06870035
                   DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           06880066
                   MOVE    '8100-GET-MONTHS-IN-SEASON'                  06890035
                                                TO PV-PARAGRAPH-NAME    06900035
                   MOVE    'SELECT ROWS FROM TDTATTR'                   06910035
                                                TO PV-DB2-OPER-ATTEMPTED06920035
                   PERFORM 9998-SQL-ABEND                               06930035
           END-EVALUATE.                                                06940035
                                                                        06950035
                                                                        06960035
       9998-SQL-ABEND.                                                  06970035
                                                                        06980035
           MOVE +4013 TO PV-ABEND-CODE.                                 06990035
           DISPLAY ' '.                                                 07000066
           DISPLAY '** ABEND **         ** = SQLERROR'.                 07010066
           DISPLAY '** PROGRAM          ** = ' PV-PGM-NAME.             07020066
           DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       07030066
           DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   07040066
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07050035
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07060035
           COPY DPPD004.                                                07070035
           PERFORM 9999-ABEND.                                          07080035
                                                                        07090035
                                                                        07100035
       9999-ABEND.                                                      07110035
                                                                        07120035
           CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        07130035
