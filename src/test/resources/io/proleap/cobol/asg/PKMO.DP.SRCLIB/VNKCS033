000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS033.                                         00040000
000500 AUTHOR.        JACK KRAMER.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JANUARY 2005.                                     00070000
000800*---------------------------------------------------------------* 00080000
000900*    V033 - VENDOR RELATIONSHIP MAINTENANCE PROGRAM             * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM ALLOWS A RELATIONSHIP TO BE ADDED TO OR       * 00110000
001200*    EXPIRED FOR A VENDOR AND A RELATED ENTITY.                 * 00120000
001300*                                                               * 00130000
001400*---------------------------------------------------------------* 00140000
001500* CHANGES MADE:                                                 * 00150007
001600*  DATE  03/24/2006                                             * 00160007
001700*      CHANGE MADE: VENDOR ALLOWANCE AUTOMATION PROJECT.        * 00170007
001800*      RECOMPILE FROM PRODUCTION TO INCORPORATE CHANGES TO      * 00180007
001900*      COPYBOOK VNWS007.                                        * 00190007
002000*      MADE BY: MIKE BESKE              WR/IR #: WR30028        * 00200007
002100*                                                               * 00210007
002110*  DATE  09/07/2021                                              *00211009
002120*            - CHANGE CALL OF DPKUT100 TO                       * 00212009
002130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00213009
002140*              MAKING THE CALL DYNAMIC VS STATIC                * 00214009
002150*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00215011
002160*                                                               * 00216009
002110*  DATE  01/05/2023                                              *00217012
002120*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00218012
002150*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00219212
002200*---------------------------------------------------------------* 00220007
002300 ENVIRONMENT DIVISION.                                            00230000
002400 DATA DIVISION.                                                   00240000
002500                                                                  00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700                                                                  00270000
002800 01  DK-DB2-KEYS.                                                 00280000
002900     15  DK-ENT-ID                      PIC S9(09)  COMP.         00290000
003000     15  DK-RLTNSHP-CDE                 PIC XX.                   00300000
003100     15  DK-RLTD-ENT-ID                 PIC S9(09)   COMP.        00310000
003200     15  DK-RLTD-VEND-ID                PIC  X(09).               00320000
003300                                                                  00330000
003400 01  PC-PROGRAM-CONSTANTS.                                        00340000
003500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00350000
003600                                                    'VN033A  '.   00360000
003700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00370000
003800                                                    'VNKM033 '.   00380000
003900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00390000
004000                                                    'VNKCS033'.   00400000
004100     05  PC-VNKCS024              PIC  X(08)  VALUE 'VNKCS024'.   00410000
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +01     00420000
004300                                                    COMP SYNC.    00430000
004400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00440000
004500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00450000
004600     05  PC-INTER-APPL-CODES.                                     00460000
004700         10 PC-INTER-APPL-LIST-ADD      PIC  X(01)  VALUE '1'.    00470000
004800         10 PC-INTER-APPL-DETAIL-ADD    PIC  X(01)  VALUE '2'.    00480000
004900         10 PC-INTER-APPL-LIST-UPD      PIC  X(01)  VALUE '3'.    00490000
005000         10 PC-INTER-APPL-DETAIL-UPD    PIC  X(01)  VALUE '4'.    00500000
005100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00510000
005200                                                    COMP SYNC.    00520000
005300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00530000
005400                                                    +1000000      00540000
005500                                                    COMP-3.       00550000
005600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00560000
005700                                                    COMP-3.       00570000
005800                                                                  00580000
005900     05  PC-TSYMSG-NUMBERS.                                       00590000
006000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00600000
006100         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.  00610000
006200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00620000
006300         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00630000
006400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00640000
006500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00650000
006600         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00660000
006700         10  PC-TSYMSG-00159            PIC  9(05)  VALUE 00159.  00670000
006800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00680000
006900         10  PC-TSYMSG-00398            PIC  9(05)  VALUE 00398.  00690000
007000         10  PC-TSYMSG-00308            PIC  9(05)  VALUE 00308.  00700000
007100         10  PC-TSYMSG-01883            PIC  9(05)  VALUE 01883.  00710001
007200         10  PC-TSYMSG-03375            PIC  9(05)  VALUE 03375.  00720002
007300         10  PC-TSYMSG-03377            PIC  9(05)  VALUE 03377.  00730002
007400         10  PC-TSYMSG-03378            PIC  9(05)  VALUE 03378.  00740002
007500         10  PC-TSYMSG-03379            PIC  9(05)  VALUE 03379.  00750002
007600         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00760002
007700     05  PC-MAX-DATE                    PIC  X(10)  VALUE         00770002
007800                                                    '12/31/9999'. 00780002
007900     05  PC-MAX-DATE-ISO                PIC  X(10)  VALUE         00790002
008000                                                    '9999-12-31'. 00800002
008100                                                                  00810002
008200 01  PS-PROGRAM-SWITCHES.                                         00820002
008300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00830002
008400         88  PS-NO-ERROR                            VALUE 'Y'.    00840002
008500         88  PS-ERROR                               VALUE 'N'.    00850002
008600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00860002
008700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00870002
008800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00880002
008900     05  PS-RLTNSHP-SW                  PIC  X(01)  VALUE 'N'.    00890002
009000         88  PS-RLTNSHP-ADD                         VALUE 'A'.    00900002
009100         88  PS-RLTNSHP-DELETE                      VALUE 'D'.    00910002
009200                                                                  00920002
009300 01  PV-PROGRAM-VARIABLES.                                        00930002
009400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00940002
009500                                                    COMP-3.       00950002
009600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00960002
009700                                                    COMP-3.       00970002
009800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00980002
009900                                                    COMP SYNC.    00990002
010000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01000002
010100                                                    COMP SYNC.    01010002
010200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01020002
010300                                                    COMP SYNC.    01030002
010400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01040002
010500                                                    COMP-3.       01050002
010600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01060002
010700                                                    COMP SYNC.    01070002
010800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01080002
010900                                                    COMP SYNC.    01090002
011000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01100002
011100                                                    COMP SYNC.    01110002
011200     05  PV-RLTD-DUN-NBR                PIC  X(09).               01120002
011300     05  PV-WORK-DATE.                                            01130002
011400         10  PV-WORK-MM                 PIC XX      VALUE SPACES. 01140002
011500         10  PV-SLASH1                  PIC X       VALUE '/'.    01150002
011600         10  PV-WORK-DD                 PIC XX      VALUE SPACES. 01160002
011700         10  PV-SLASH2                  PIC X       VALUE '/'.    01170002
011800         10  PV-WORK-YYYY               PIC XXXX    VALUE SPACES. 01180002
011900     05  PV-ENT-ID                      PIC  9(09).               01190002
012000*---------------------------------------------------------------* 01200002
012100*  RECORD LAYOUT FOR THE VENDOR RELATIONSHIP TEMP STORAGE QUEUE * 01210002
012200*---------------------------------------------------------------* 01220002
012300     COPY VNWS021.                                                01230002
012400                                                                  01240002
012500**--------------------------------------------------------------* 01250002
012600** COMMAREA FOR VNKCS024                                        * 01260002
012700**--------------------------------------------------------------* 01270002
012800 01 VN007-COMMAREA.                                               01280002
012900     COPY VNWS007.                                                01290002
013000                                                                  01300002
013100*---------------------------------------------------------------* 01310002
013200*    MAP LAYOUT                                                 * 01320002
013300*---------------------------------------------------------------* 01330002
013400     COPY VNKM033.                                                01340002
013500                                                                  01350002
013600*---------------------------------------------------------------* 01360002
013700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01370002
013800*---------------------------------------------------------------* 01380002
013900     COPY DPWS015.                                                01390002
014000                                                                  01400002
014100*---------------------------------------------------------------* 01410002
014200*    FUNCTION KEYS COPYBOOK.                                    * 01420002
014300*---------------------------------------------------------------* 01430002
014400     COPY DPWS016.                                                01440002
014500                                                                  01450002
014600*---------------------------------------------------------------* 01460002
014700*    NUMERIC EDIT LAYOUT.                                       * 01470002
014800*---------------------------------------------------------------* 01480002
014900     COPY DPWS010I.                                               01490002
015000                                                                  01500002
015100*---------------------------------------------------------------* 01510002
015200*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 01520012
015300*---------------------------------------------------------------* 01530002
015400     COPY DPWS030.                                                01540002
015400     COPY DPWS930.                                                01541012
015500                                                                  01550002
015600*---------------------------------------------------------------* 01560002
015700*    STANDARD COMMAREA.                                         * 01570002
015800*---------------------------------------------------------------* 01580002
015900     COPY DPWS020.                                                01590002
016000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01600002
016100*---------------------------------------------------------------* 01610002
016200* INTER-APPLICATION COMMAREA.                                   * 01620002
016300*   VNWS020 - IS THE INPUT LAYOUT FROM THE LIST PROGRAM AND THE * 01630002
016400*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * 01640002
016500*---------------------------------------------------------------* 01650002
016600         10  INTER-APPL-COMM-AREA       PIC X(200).               01660002
016700     COPY VNWS020.                                                01670002
016800         10  ASC-SPECIFIC-COMMAREA.                               01680002
016900             15  ASC-KEYS.                                        01690002
017000                 20  ASC-KEY-ENT-ID                  PIC S9(09)   01700002
017100                                                     COMP.        01710002
017200                 20  ASC-KEY-RLTNSHP-CDE             PIC  X(03).  01720002
017300                 20  ASC-KEY-RLTNSHP-NAME            PIC  X(30).  01730002
017400                 20  ASC-KEY-VENDOR-NAME             PIC  X(30).  01740002
017500                 20  ASC-KEY-VENDOR-ID               PIC  X(09).  01750002
017600                 20  ASC-KEY-RLTD-ENT-ID             PIC  9(09).  01760002
017700                 20  ASC-KEY-RLTD-ENT-ID-X                        01770002
017800                     REDEFINES ASC-KEY-RLTD-ENT-ID   PIC  X(09).  01780002
017900                 20  ASC-KEY-RLTD-VEND-ID            PIC  9(09).  01790002
018000                 20  ASC-KEY-RLTD-VEND-ID-X                       01800002
018100                     REDEFINES ASC-KEY-RLTD-VEND-ID  PIC  X(09).  01810002
018200                 20  ASC-KEY-RLTD-VEND-NAME          PIC  X(30).  01820002
018300             15  ASC-ADD-RLTD-ENT-ID                 PIC S9(09)   01830002
018400                                                     COMP.        01840002
018500             15  ASC-DTL-EFF-DATE                    PIC  X(10).  01850002
018600             15  ASC-DTL-EXP-DATE                    PIC  X(10).  01860002
018700             15  ASC-DTL-DATE-ADDED                  PIC  X(10).  01870002
018800             15  ASC-DTL-LAST-UPD-ID                 PIC  X(08).  01880002
018900             15  ASC-DTL-LAST-UPD-DATE               PIC  X(10).  01890002
019000             15  ASC-INT-APPL-FORMAT-IND             PIC  X(01).  01900002
019100             15  ASC-CURRENT-DATE                    PIC  X(10).  01910002
019200             15  ASC-CURRENT-DATE-ISO                PIC  X(10).  01920002
019300                                                                  01930002
019400             15  ASC-DISPLAY-ENT-ID                  PIC  9(09).  01940008
019500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01950002
019600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  01960002
019700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   01970002
019800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   01980002
019900                                                                  01990002
020000                 20  ASC-ITEM-ARRAY.                              02000002
020100                     25  ASC-ITEM-ENTRIES OCCURS 1 TIMES.         02010002
020200                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   02020002
020300                                                     COMP-3.      02030002
020400                         30  ASC-RLTD-ENT-ID         PIC  9(09).  02040008
020500                         30  ASC-RLTD-VEND-ID        PIC  9(09).  02050002
020600                         30  ASC-RLTD-VEND-NAME      PIC  X(30).  02060002
020700                         30  ASC-EFF-DATE            PIC  X(10).  02070002
020800                         30  ASC-EXP-DATE            PIC  X(10).  02080002
020900                         30  ASC-DATE-ADDED          PIC  X(10).  02090002
021000                         30  ASC-LAST-UPD-ID         PIC  X(08).  02100002
021100                         30  ASC-LAST-UPD-DATE       PIC  X(10).  02110002
021200                                                                  02120002
021300             15  ASC-BLK-SUB                         PIC S9(04)   02130002
021400                                                          COMP    02140002
021500                                                          SYNC.   02150002
021600             15  ASC-ITEM-SUB                        PIC S9(04)   02160002
021700                                                          COMP    02170002
021800                                                          SYNC.   02180002
021900             15  ASC-SEL-SUB                         PIC S9(04)   02190002
022000                                                          COMP.   02200002
022100             15  ASC-SEL-ITEM                        PIC S9(04)   02210002
022200                                                          COMP.   02220002
022300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02230002
022400                                                          COMP-3. 02240002
022500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02250002
022600                                                          COMP-3. 02260002
022700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02270002
022800                                                          COMP-3. 02280002
022900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02290002
023000                                                          COMP-3. 02300002
023100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02310002
023200                                                          COMP    02320002
023300                                                          SYNC.   02330002
023400             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02340002
023500                                                          COMP-3. 02350002
023600             15  ASC-LIST-QUEUE-NAME.                             02360002
023700                 20  ASC-LIST-TERM-ID                PIC  X(04).  02370002
023800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02380002
023900                                                          COMP-3. 02390002
024000                 20  ASC-LIST-SEQ                    PIC  9(01).  02400002
024100             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  02410002
024200                                                                  02420002
024300             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02430002
024400                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   02440002
024500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02450002
024600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02460002
024700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02470002
024800             15  ASC-ROW-EXISTS-SW                   PIC  X(01).  02480002
024900                 88  ASC-NO-ROW-EXISTS               VALUE 'N'.   02490002
025000                 88  ASC-EFFECTIVE-ROW-EXISTS        VALUE 'Y'.   02500002
025100                 88  ASC-EXPIRED-ROW-EXISTS          VALUE 'X'.   02510002
025200             15  ASC-SCREEN-TYPE-SW                  PIC  X(01).  02520002
025300                 88  ASC-ADD-SCREEN                  VALUE 'A'.   02530002
025400                 88  ASC-UPD-SCREEN                  VALUE 'U'.   02540002
025500             15  ASC-ID-ENTERED-SW                   PIC X(01).   02550002
025600                 88  ASC-ENT-ID-ENTERED              VALUE 'E'.   02560002
025700                 88  ASC-VEND-ID-ENTERED             VALUE 'V'.   02570002
025800                                                                  02580002
025900*---------------------------------------------------------------* 02590002
026000*    ABEND PROCESSING COPYBOOK.                                 * 02600002
026100*---------------------------------------------------------------* 02610002
026200     COPY DPWS013.                                                02620002
026300                                                                  02630002
026400*---------------------------------------------------------------* 02640002
026500*    DB2 AREA FOR EXTERNAL ENTERPRISE                           * 02650002
026600*---------------------------------------------------------------* 02660002
026700     EXEC SQL                                                     02670002
026800          INCLUDE TEXTENT                                         02680002
026900     END-EXEC.                                                    02690002
027000                                                                  02700002
027100*---------------------------------------------------------------* 02710002
027200*    DB2 AREA FOR ENTERPRISE NAME                               * 02720002
027300*---------------------------------------------------------------* 02730002
027400     EXEC SQL                                                     02740002
027500          INCLUDE TENTNME                                         02750002
027600     END-EXEC.                                                    02760002
027700                                                                  02770002
027800*---------------------------------------------------------------* 02780002
027900*    DB2 AREA FOR VNT_VND_RLTNSHP                               * 02790002
028000*---------------------------------------------------------------* 02800002
028100     EXEC SQL                                                     02810002
028200          INCLUDE VNT00000                                        02820002
028300     END-EXEC.                                                    02830002
028400                                                                  02840002
028500*---------------------------------------------------------------* 02850002
028600*    DB2 AREA FOR COMMUNICATIONS                                * 02860002
028700*---------------------------------------------------------------* 02870002
028800     EXEC SQL                                                     02880002
028900          INCLUDE SQLCA                                           02890002
029000     END-EXEC.                                                    02900002
029100                                                                  02910002
029200*---------------------------------------------------------------* 02920002
029300*   CURSOR TO SELECT VENDOR RELATIONSHIPS                       * 02930002
029400*---------------------------------------------------------------* 02940002
029500                                                                  02950002
029600     EXEC SQL                                                     02960002
029700             DECLARE RELATIONSHIP-CSR CURSOR FOR                  02970002
029800          SELECT  V.RLTD_ENT_ID                                   02980002
029900                 ,V.EFF_BEG_DTE                                   02990002
030000                 ,V.EFF_END_DTE                                   03000002
030100                 ,V.CRE_DTE                                       03010002
030200                 ,V.LAST_UPD_TMST                                 03020002
030300                 ,V.LAST_UPD_BY_USR_ID                            03030002
030400                 ,A.ENT_NAME_DESC                                 03040002
030500                 ,B.DUN_NBR                                       03050002
030600          FROM VNT_VND_RLTNSHP V                                  03060002
030700              ,TENTNME A                                          03070002
030800              ,TEXTENT B                                          03080002
030900           WHERE V.ENT_ID        = :DK-ENT-ID                     03090002
031000             AND VND_RLTNSHP_CDE = :DK-RLTNSHP-CDE                03100002
031100             AND V.EFF_END_DTE   = :PC-MAX-DATE-ISO               03110002
031200             AND A.ENT_ID   = V.RLTD_ENT_ID                       03120002
031300             AND A.ENT_ID   = B.ENT_ID                            03130002
031400             AND A.TYPE_CDE = '01'                                03140002
031500             ORDER BY A.ENT_NAME_DESC                             03150002
031600     END-EXEC.                                                    03160002
031700                                                                  03170002
031800 LINKAGE SECTION.                                                 03180002
031900                                                                  03190002
032000 01  DFHCOMMAREA.                                                 03200002
032100     05  FILLER  OCCURS 1 TO 4072 TIMES                           03210002
032200                 DEPENDING ON EIBCALEN.                           03220002
032300         10  FILLER  PIC X.                                       03230002
032400                                                                  03240002
032500 PROCEDURE DIVISION.                                              03250002
032600***************************************************************** 03260002
032700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 03270002
032800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 03280002
032900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 03290002
033000***************************************************************** 03300002
033100 0000-MAIN-MODULE.                                                03310002
033200                                                                  03320002
033300     INITIALIZE DP030-CICS-API-FIELDS.                            03330002
033400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03340002
033500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03350002
033600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03360002
033700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03370002
033800     MOVE LENGTH OF VN033AI        TO DP030-MAP-LENGTH (1).       03380002
033900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03390002
034000     PERFORM 0001-CALL-CICS-ARCH-API.                             03400002
034100                                                                  03410002
034200     PERFORM 1000-CONTROL-PROCESSING                              03420002
034300                                                                  03430002
034400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03440002
034500     PERFORM 0001-CALL-CICS-ARCH-API.                             03450002
034600                                                                  03460002
034700***************************************************************** 03470002
034800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 03480002
034900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 03490002
035000***************************************************************** 03500002
035100 0001-CALL-CICS-ARCH-API.                                         03510002
035200                                                                  03520002
035300*    CALL 'DPKCS030' USING DFHEIBLK                               03530012
035300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03531013
035400                           DFHCOMMAREA                            03540002
035500                           DP030-CICS-API-FIELDS                  03550002
035600                           DP020-STANDARD-COMMAREA                03560002
035700                           VN033AI.                               03570002
035800                                                                  03580002
035900     IF  DP030-RC-CALL-SUCCESSFUL                                 03590002
036000         CONTINUE                                                 03600002
036100     ELSE                                                         03610002
036200         SET DP013-NO-ROLLBACK                                    03620002
036300             DP013-XCTL-DISPLAY-RESTART                           03630002
036400             DP013-CICS-ABEND      TO TRUE                        03640002
036500         MOVE '0001-CALL-CICS-ARCH-API'                           03650002
036600                                   TO DP013-PARAGRAPH             03660002
036700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03670012
036800*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03680012
036700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE 003681012
036800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03682012
036900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03690002
037000         PERFORM DP013-0000-PROCESS-ABEND                         03700002
037100     END-IF.                                                      03710002
037200                                                                  03720002
037300*----------------------------------------------------------------*03730002
037400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03740002
037500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03750002
037600*----------------------------------------------------------------*03760002
037700 1000-CONTROL-PROCESSING.                                         03770002
037800                                                                  03780002
037900     EVALUATE TRUE                                                03790002
038000         WHEN DP020-NEXT-ACT-INITIAL                              03800002
038100             INITIALIZE ASC-SPECIFIC-COMMAREA                     03810002
038200             MOVE DP020-INT-APPL-FORMAT-IND                       03820002
038300                 TO ASC-INT-APPL-FORMAT-IND                       03830002
038400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03840002
038500             IF  PS-COMMAREA-NOT-VALID                            03850002
038600                 SET DP020-MSG-FATAL                              03860002
038700                     DP020-NEXT-ACT-APPL-ERROR                    03870002
038800                                   TO TRUE                        03880002
038900             ELSE                                                 03890002
039000                 PERFORM 4000-BUILD-INITIAL-PANEL                 03900002
039100             END-IF                                               03910002
039200                                                                  03920002
039300         WHEN DP020-NEXT-ACT-READ-MAP                             03930002
039400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        03940002
039500                                   TO PV-TOP-ITEM                 03950002
039600             PERFORM 2000-PROCESS-PANEL                           03960002
039700                                                                  03970002
039800         WHEN DP020-NEXT-ACT-RETURN                               03980002
039900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        03990002
040000                                   TO PV-TOP-ITEM                 04000002
040100             MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID                04010002
040200             MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE           04020002
040300             PERFORM 2050-DELETE-LIST-QUEUE                       04030002
040400             PERFORM 4000-BUILD-INITIAL-PANEL                     04040002
040500             IF ASC-ADD-SCREEN                                    04050002
040600                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               04060002
040700             ELSE                                                 04070002
040800                 PERFORM 3200-RESET-ATTRIBUTES                    04080002
040900             END-IF                                               04090002
041000                                                                  04100002
041100         WHEN OTHER                                               04110002
041200             SET DP013-LOGIC-ABEND TO TRUE                        04120002
041300             SET DP013-NO-ROLLBACK TO TRUE                        04130002
041400             MOVE '1000-CONTROL-PROCESSING'                       04140002
041500                                   TO DP013-PARAGRAPH             04150002
041600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04160002
041700                                   TO DP013-MESSAGE-TEXT(1)       04170002
041800             PERFORM DP013-0000-PROCESS-ABEND                     04180002
041900     END-EVALUATE.                                                04190002
042000                                                                  04200002
042100*----------------------------------------------------------------*04210002
042200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04220002
042300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04230002
042400*----------------------------------------------------------------*04240002
042500 1100-PROCESS-INTER-APPL-COMM.                                    04250002
042600                                                                  04260002
042700     EXEC SQL                                                     04270002
042800         SET :ASC-CURRENT-DATE    = CURRENT DATE                  04280002
042900     END-EXEC.                                                    04290002
043000     MOVE ASC-CURRENT-DATE        TO ASC-CURRENT-DATE-ISO.        04300002
043100     MOVE ASC-CURRENT-DATE(6:2)   TO PV-WORK-MM.                  04310002
043200     MOVE ASC-CURRENT-DATE(9:2)   TO PV-WORK-DD.                  04320002
043300     MOVE ASC-CURRENT-DATE(1:4)   TO PV-WORK-YYYY.                04330002
043400     MOVE PV-WORK-DATE            TO ASC-CURRENT-DATE.            04340002
043500     MOVE VN020-ENT-ID TO ASC-KEY-ENT-ID                          04350002
043600                           ASC-DISPLAY-ENT-ID                     04360002
043700                           DK-ENT-ID                              04370002
043800     MOVE VN020-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME               04380002
043900     MOVE VN020-VENDOR-ID    TO ASC-KEY-VENDOR-ID                 04390002
044000     MOVE VN020-RLTNSHP-CDE  TO ASC-KEY-RLTNSHP-CDE               04400002
044100                                 DK-RLTNSHP-CDE                   04410002
044200     MOVE VN020-RLTNSHP-NAME TO ASC-KEY-RLTNSHP-NAME              04420002
044300     EVALUATE ASC-INT-APPL-FORMAT-IND                             04430002
044400         WHEN PC-INTER-APPL-LIST-UPD                              04440002
044500         WHEN PC-INTER-APPL-LIST-ADD                              04450002
044600              SET PS-COMMAREA-VALID                               04460002
044700                  ASC-USE-SELECTION-QUEUE                         04470002
044800                                   TO TRUE                        04480002
044900              MOVE VN020-NUMBER-OF-TS-ITEMS                       04490002
045000                                   TO ASC-NUMBER-OF-TS-ITEMS      04500002
045100              MOVE VN020-SEL-QUEUE-NAME                           04510002
045200                                   TO ASC-SEL-QUEUE-NAME-IN       04520002
045300              PERFORM 1120-PREPARE-LIST-ENTRY                     04530002
045400                                                                  04540002
045500         WHEN PC-INTER-APPL-DETAIL-ADD                            04550002
045600              SET PS-COMMAREA-VALID   TO TRUE                     04560002
045700                                                                  04570002
045800         WHEN PC-INTER-APPL-DETAIL-UPD                            04580002
045900              MOVE VN020-RLTD-ENT-ID    TO ASC-KEY-RLTD-ENT-ID    04590002
046000              MOVE VN020-RLTD-VENDOR-ID TO ASC-KEY-RLTD-VEND-ID   04600002
046100              MOVE VN020-RLTD-VENDOR-NAME                         04610002
046200                                        TO ASC-KEY-RLTD-VEND-NAME 04620002
046300              SET PS-COMMAREA-VALID   TO TRUE                     04630002
046400                                                                  04640002
046500         WHEN OTHER                                               04650002
046600                 MOVE PC-TSYMSG-00148                             04660002
046700                                   TO DP020-MSG-NUMBER            04670002
046800                 SET PS-COMMAREA-NOT-VALID                        04680002
046900                                   TO TRUE                        04690002
047000     END-EVALUATE.                                                04700002
047100     EVALUATE ASC-INT-APPL-FORMAT-IND                             04710002
047200         WHEN PC-INTER-APPL-LIST-ADD                              04720002
047300         WHEN PC-INTER-APPL-DETAIL-ADD                            04730002
047400             SET ASC-ADD-SCREEN    TO TRUE                        04740002
047500         WHEN PC-INTER-APPL-LIST-UPD                              04750002
047600         WHEN PC-INTER-APPL-DETAIL-UPD                            04760002
047700             SET ASC-UPD-SCREEN    TO TRUE                        04770002
047800     END-EVALUATE.                                                04780002
047900                                                                  04790002
048000*----------------------------------------------------------------*04800002
048100*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *04810002
048200*  QUEUE PASSED FROM THE LIST.                                   *04820002
048300*----------------------------------------------------------------*04830002
048400 1120-PREPARE-LIST-ENTRY.                                         04840002
048500                                                                  04850002
048600      MOVE VN021-MAX-ITEMS TO ASC-SEL-SUB.                        04860002
048700      MOVE ZERO            TO ASC-SEL-ITEM.                       04870002
048800                                                                  04880002
048900      PERFORM 2300-GET-NEXT-MESSAGE.                              04890002
049000      MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID.                      04900002
049100      MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE.                 04910002
049200                                                                  04920002
049300                                                                  04930002
049400*----------------------------------------------------------------*04940002
049500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04950002
049600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04960002
049700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04970002
049800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04980002
049900* FUNCTION KEYS CAN GET THIS FAR.                                *04990002
050000*----------------------------------------------------------------*05000002
050100 2000-PROCESS-PANEL.                                              05010002
050200                                                                  05020002
050300     EVALUATE TRUE                                                05030002
050400         WHEN DP020-SRC-AID = DP016-CLEAR                         05040002
050500             IF ASC-ADD-SCREEN                                    05050002
050600                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05060002
050700             ELSE                                                 05070002
050800                 PERFORM 3200-RESET-ATTRIBUTES                    05080002
050900             END-IF                                               05090002
051000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05100002
051100                                                                  05110002
051200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05120002
051300             IF ASC-USE-SELECTION-QUEUE                           05130002
051400                 MOVE ASC-KEY-ENT-ID  TO DK-ENT-ID                05140002
051500                 MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE       05150002
051600                 MOVE SPACES          TO ASC-KEY-RLTD-VEND-NAME   05160002
051700                 MOVE ZEROES          TO ASC-KEY-RLTD-ENT-ID      05170002
051800                                         ASC-KEY-RLTD-VEND-ID     05180002
051900                 PERFORM 2050-DELETE-LIST-QUEUE                   05190002
052000                 PERFORM 4000-BUILD-INITIAL-PANEL                 05200002
052100             ELSE                                                 05210002
052200                 PERFORM 3200-RESET-ATTRIBUTES                    05220003
052300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05230002
052400             END-IF                                               05240002
052500                                                                  05250002
052600         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               05260002
052700         WHEN DP020-FK-LOCAL-FUNC-10(DP020-SRC-AID)               05270002
052800*    "NEXTRLTN"                                                   05280002
052900             IF ASC-USE-SELECTION-QUEUE                           05290002
053000                 PERFORM 2050-DELETE-LIST-QUEUE                   05300002
053100                 PERFORM 2300-GET-NEXT-MESSAGE                    05310002
053200                 MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID            05320002
053300                 MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE       05330002
053400                 PERFORM 4000-BUILD-INITIAL-PANEL                 05340002
053500             ELSE                                                 05350002
053600*                --- BOTTOM OF LIST ---                           05360002
053700                 MOVE PC-TSYMSG-00070                             05370002
053800                                   TO DP020-MSG-NUMBER            05380002
053900                 SET DP020-MSG-INFORMATIONAL                      05390002
054000                                   TO TRUE                        05400002
054100             END-IF                                               05410002
054200                                                                  05420002
054300         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               05430002
054400         WHEN DP020-FK-LOCAL-FUNC-09(DP020-SRC-AID)               05440002
054500*    "PREVRLTN"                                                   05450002
054600             IF ASC-USE-SELECTION-QUEUE                           05460002
054700                 PERFORM 2050-DELETE-LIST-QUEUE                   05470002
054800                 PERFORM 2310-GET-PREV-MESSAGE                    05480002
054900                 MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID            05490002
055000                 MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE       05500002
055100                 PERFORM 4000-BUILD-INITIAL-PANEL                 05510002
055200             ELSE                                                 05520002
055300*                --- TOP OF LIST ---                              05530002
055400                 MOVE PC-TSYMSG-00069                             05540002
055500                                   TO DP020-MSG-NUMBER            05550002
055600                 SET DP020-MSG-INFORMATIONAL                      05560002
055700                                   TO TRUE                        05570002
055800             END-IF                                               05580002
055900                                                                  05590002
056000         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               05600002
056100         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               05610002
056200*    "INQUIRY"                                                    05620002
056300             INITIALIZE VN020-INTER-APPL-COMMAREA                 05630002
056400             MOVE ASC-KEY-ENT-ID                                  05640002
056500                            TO VN020-ENT-ID                       05650002
056600             MOVE ASC-KEY-VENDOR-NAME  TO VN020-VENDOR-NAME       05660002
056700             MOVE ASC-KEY-VENDOR-ID    TO VN020-VENDOR-ID         05670002
056800             MOVE ASC-KEY-RLTNSHP-CDE  TO VN020-RLTNSHP-CDE       05680002
056900             MOVE ASC-KEY-RLTNSHP-NAME TO VN020-RLTNSHP-NAME      05690002
057000                                                                  05700002
057100         WHEN OTHER                                               05710002
057200             IF ASC-ADD-SCREEN                                    05720002
057300                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             05730002
057400                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05740002
057500             ELSE                                                 05750002
057600                 PERFORM 3200-RESET-ATTRIBUTES                    05760002
057700             END-IF                                               05770002
057800             IF  PS-NO-ERROR                                      05780002
057900                 SET DP030-CONTINUE-GO TO TRUE                    05790002
058000                 PERFORM 2100-CHECK-FUNCTION-KEY                  05800002
058100             ELSE                                                 05810002
058200                 SET DP030-OVERRIDE-GO TO TRUE                    05820002
058300             END-IF                                               05830002
058400     END-EVALUATE.                                                05840002
058500                                                                  05850002
058600*----------------------------------------------------------------*05860002
058700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05870002
058800*----------------------------------------------------------------*05880002
058900 2050-DELETE-LIST-QUEUE.                                          05890002
059000                                                                  05900002
059100     EXEC CICS                                                    05910002
059200         DELETEQ TS                                               05920002
059300             QUEUE (ASC-LIST-QUEUE-NAME)                          05930002
059400             RESP  (PV-CICS-RESP)                                 05940002
059500     END-EXEC.                                                    05950002
059600                                                                  05960002
059700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05970002
059800        (PV-CICS-RESP = DFHRESP(QIDERR))                          05980002
059900         CONTINUE                                                 05990002
060000     ELSE                                                         06000002
060100         SET DP013-CICS-ABEND      TO TRUE                        06010002
060200         SET DP013-NO-ROLLBACK     TO TRUE                        06020002
060300                                                                  06030002
060400         MOVE '2050-DELETE-LIST-QUEUE'                            06040002
060500                                   TO DP013-PARAGRAPH             06050002
060600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06060002
060700                                   TO DP013-MESSAGE-TEXT (1)      06070002
060800         PERFORM DP013-0000-PROCESS-ABEND                         06080002
060900     END-IF.                                                      06090002
061000                                                                  06100002
061100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06110002
061200                                                                  06120002
061300*----------------------------------------------------------------*06130002
061400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06140002
061500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06150002
061600* CICS ARCHITECTURE API.                                         *06160002
061700*----------------------------------------------------------------*06170002
061800 2100-CHECK-FUNCTION-KEY.                                         06180002
061900                                                                  06190002
062000     EVALUATE TRUE                                                06200002
062100         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               06210002
062200*    "ADD" A RELATIONSHIP ROW                                     06220002
062300             PERFORM 6000-GET-EFFECTIVE                           06230002
062400             IF ASC-EFFECTIVE-ROW-EXISTS                          06240002
062500                 SET DP030-OVERRIDE-GO                            06250002
062600                     DP030-SET-CURSOR-TRAILER                     06260002
062700                     DP020-MSG-FATAL  TO TRUE                     06270002
062800                 MOVE PC-TSYMSG-03378 TO DP020-MSG-NUMBER         06280002
062900             ELSE                                                 06290002
063000                 MOVE ASC-KEY-ENT-ID      TO VNT00000-ENT-ID      06300002
063100                                             DK-ENT-ID            06310002
063200                 MOVE ASC-KEY-RLTNSHP-CDE TO                      06320002
063300                                         VNT00000-VND-RLTNSHP-CDE 06330002
063400                                         DK-RLTNSHP-CDE           06340002
063500                 MOVE ASC-ADD-RLTD-ENT-ID TO VNT00000-RLTD-ENT-ID 06350002
063600                                             DK-RLTD-ENT-ID       06360002
063700                 SET PS-RLTNSHP-ADD       TO TRUE                 06370002
063800                 IF ASC-DTL-EFF-DATE = ASC-CURRENT-DATE           06380002
063900                     PERFORM 7100-UPDATE-CURRENT-RELATION         06390002
064000                 ELSE                                             06400002
064100                     PERFORM 7000-ADD-RELATION                    06410002
064200                 END-IF                                           06420002
064300                 PERFORM 8000-CHECK-IN-RMS                        06430002
064400                 IF EXTENT-VND-IN-RMS-IND = 'Y'                   06440002
064500                     PERFORM 8100-LINK-TO-VNKCS024                06450002
064600                 END-IF                                           06460002
064700                 IF ASC-USE-SELECTION-QUEUE                       06470002
064800                     PERFORM 9100-READ-SEL-QUEUE                  06480002
064900                     SET VN021-ADD (ASC-SEL-SUB)                  06490002
065000                                       TO TRUE                    06500002
065100                     PERFORM 9200-REWRITE-LIST-QUEUE              06510002
065200                 END-IF                                           06520002
065300                 SET DP030-CONTINUE-GO                            06530002
065400                     DP030-SET-CURSOR-TRAILER                     06540002
065500                     DP020-MSG-INFORMATIONAL  TO TRUE             06550002
065600                 MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER         06560002
065700                 PERFORM 2050-DELETE-LIST-QUEUE                   06570002
065800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06580002
065900             END-IF                                               06590002
066000                                                                  06600002
066100         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               06610002
066200*    "UPDATE"                                                     06620002
066300             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO AND              06630002
066400                 ASC-USE-SELECTION-QUEUE                          06640002
066500                 SET DP020-MSG-FATAL                              06650002
066600                     DP030-OVERRIDE-GO TO  TRUE                   06660002
066700                 MOVE PC-TSYMSG-03375  TO  DP020-MSG-NUMBER       06670002
066800             ELSE                                                 06680002
066900                 PERFORM 6000-GET-EFFECTIVE                       06690002
067000                 IF ASC-EFFECTIVE-ROW-EXISTS                      06700002
067100                     MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID        06710002
067200                     MOVE ASC-KEY-RLTD-ENT-ID TO DK-RLTD-ENT-ID   06720002
067300                     MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE   06730002
067400                     SET PS-RLTNSHP-DELETE    TO TRUE             06740002
067500                     PERFORM 7200-EXPIRE-CURRENT-RELATION         06750002
067600                     PERFORM 8000-CHECK-IN-RMS                    06760002
067700                     IF EXTENT-VND-IN-RMS-IND = 'Y'               06770002
067800                         PERFORM 8100-LINK-TO-VNKCS024            06780002
067900                     END-IF                                       06790002
068000                     IF ASC-USE-SELECTION-QUEUE                   06800002
068100                         PERFORM 9100-READ-SEL-QUEUE              06810002
068200                         SET VN021-UPD (ASC-SEL-SUB)              06820002
068300                                           TO TRUE                06830002
068400                         PERFORM 9200-REWRITE-LIST-QUEUE          06840002
068500                     END-IF                                       06850002
068600                     SET DP030-CONTINUE-GO                        06860002
068700                         DP030-SET-CURSOR-TRAILER                 06870002
068800                         DP020-MSG-INFORMATIONAL  TO TRUE         06880002
068900                     MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER     06890002
069000                     MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID        06900002
069100                     MOVE ASC-KEY-RLTNSHP-CDE TO DK-RLTNSHP-CDE   06910002
069200*                    PERFORM 2050-DELETE-LIST-QUEUE               06920002
069300*                    PERFORM 4000-BUILD-INITIAL-PANEL             06930002
069400                 ELSE                                             06940002
069500                     SET DP030-OVERRIDE-GO                        06950002
069600                         DP030-SET-CURSOR-TRAILER                 06960002
069700                         DP020-MSG-FATAL  TO TRUE                 06970002
069800                     MOVE PC-TSYMSG-03379 TO DP020-MSG-NUMBER     06980002
069900                 END-IF                                           06990002
070000             END-IF                                               07000002
070100                                                                  07010002
070200         WHEN DP020-FK-LOCAL-FUNC-07(DP020-SRC-AID)               07020002
070300*    "NEXTVEND"                                                   07030002
070400             PERFORM 2110-BROWSE-BACKWARD                         07040002
070500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07050002
070600                                                                  07060002
070700         WHEN DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)               07070002
070800*    "PREVVEND"                                                   07080002
070900             PERFORM 2120-BROWSE-FORWARD                          07090002
071000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07100002
071100                                                                  07110002
071200         WHEN DP020-SRC-AID = DP016-ENTER                         07120002
071300             IF ASC-ADD-SCREEN                                    07130002
071400                 PERFORM 3200-RESET-ATTRIBUTES                    07140002
071500             END-IF                                               07150002
071600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07160002
071700                                                                  07170002
071800         WHEN OTHER                                               07180002
071900             SET DP013-NO-ROLLBACK                                07190002
072000                 DP013-XCTL-DISPLAY-RESTART                       07200002
072100                 DP013-CICS-ABEND  TO TRUE                        07210002
072200             MOVE '2100-CHECK-FUNCTION-KEY'                       07220002
072300                                   TO DP013-PARAGRAPH             07230002
072400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07240002
072500                                   TO DP013-MESSAGE-TEXT (1)      07250002
072600             PERFORM DP013-0000-PROCESS-ABEND                     07260002
072700     END-EVALUATE.                                                07270002
072800                                                                  07280002
072900*----------------------------------------------------------------*07290002
073000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07300002
073100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07310002
073200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07320002
073300*    MESSAGE.                                                    *07330002
073400*----------------------------------------------------------------*07340002
073500 2110-BROWSE-BACKWARD.                                            07350002
073600                                                                  07360002
073700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07370002
073800         GIVING PV-TOP-ITEM.                                      07380002
073900                                                                  07390002
074000     IF  ((PV-TOP-ITEM < +1)                                      07400002
074100       OR (PV-TOP-ITEM = +1))                                     07410002
074200         MOVE +1                   TO PV-TOP-ITEM                 07420002
074300*        -- TOP OF LIST --                                        07430002
074400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07440002
074500         SET DP020-MSG-INFORMATIONAL TO TRUE                      07450002
074600     END-IF.                                                      07460002
074700                                                                  07470002
074800*----------------------------------------------------------------*07480002
074900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07490002
075000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07500002
075100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07510002
075200*----------------------------------------------------------------*07520002
075300 2120-BROWSE-FORWARD.                                             07530002
075400                                                                  07540002
075500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07550002
075600         GIVING PV-TOP-ITEM.                                      07560002
075700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07570002
075800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07580002
075900                                   TO PV-TOP-ITEM                 07590002
076000*        -- BOTTOM OF LIST --                                     07600002
076100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07610002
076200         SET DP020-MSG-INFORMATIONAL                              07620002
076300                                   TO TRUE                        07630002
076400     ELSE                                                         07640002
076500         COMPUTE PV-BOTTOM-ITEM =                                 07650002
076600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07660002
076700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07670002
076800*            -- BOTTOM OF LIST --                                 07680002
076900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07690002
077000             SET DP020-MSG-INFORMATIONAL                          07700002
077100                                   TO TRUE                        07710002
077200         END-IF                                                   07720002
077300     END-IF.                                                      07730002
077400                                                                  07740002
077500*----------------------------------------------------------------*07750002
077600* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*07760002
077700* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *07770002
077800* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *07780002
077900*----------------------------------------------------------------*07790002
078000                                                                  07800002
078100 2200-MOVE-SCREEN-TO-COMMAREA.                                    07810002
078200                                                                  07820002
078300     IF  ARENTIDL > ZERO                                          07830002
078400         MOVE ARENTIDI             TO ASC-KEY-RLTD-ENT-ID         07840002
078500     ELSE                                                         07850002
078600         IF  ARENTIDF = DP015-ERASE-EOF                           07860002
078700             MOVE ZEROES           TO ASC-KEY-RLTD-ENT-ID         07870002
078800             MOVE SPACES           TO ASC-KEY-RLTD-VEND-NAME      07880002
078900         END-IF                                                   07890002
079000     END-IF.                                                      07900002
079100                                                                  07910002
079200     IF  ARVNDIDL > ZERO                                          07920002
079300         MOVE ARVNDIDI             TO ASC-KEY-RLTD-VEND-ID        07930002
079400     ELSE                                                         07940002
079500         IF  ARVNDIDF = DP015-ERASE-EOF                           07950002
079600             MOVE ZEROES           TO ASC-KEY-RLTD-VEND-ID        07960002
079700             MOVE SPACES           TO ASC-KEY-RLTD-VEND-NAME      07970002
079800         END-IF                                                   07980002
079900     END-IF.                                                      07990002
080000                                                                  08000002
080100******************************************************************08010002
080200* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *08020002
080300* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *08030002
080400******************************************************************08040002
080500 2300-GET-NEXT-MESSAGE.                                           08050002
080600                                                                  08060002
080700     ADD +1                        TO ASC-SEL-SUB.                08070002
080800     IF ASC-SEL-SUB > VN021-MAX-ITEMS                             08080002
080900         ADD +1                    TO ASC-SEL-ITEM                08090002
081000         MOVE +1                   TO ASC-SEL-SUB                 08100002
081100     END-IF.                                                      08110002
081200     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 08120002
081300         PERFORM 9100-READ-SEL-QUEUE                              08130002
081400         IF VN021-ITEM (ASC-SEL-SUB) > ZERO                       08140002
081500             MOVE VN021-RLTNSHP-CDE (ASC-SEL-SUB)                 08150002
081600                                   TO ASC-KEY-RLTNSHP-CDE         08160002
081700             MOVE VN021-RLTNSHP-NAME (ASC-SEL-SUB)                08170002
081800                                   TO ASC-KEY-RLTNSHP-NAME        08180002
081900             SET VN021-INQ (ASC-SEL-SUB)                          08190002
082000                                   TO TRUE                        08200002
082100             PERFORM 9200-REWRITE-LIST-QUEUE                      08210002
082200         ELSE                                                     08220002
082300             SUBTRACT +1 FROM ASC-SEL-SUB                         08230002
082400*            --- BOTTOM OF LIST ---                               08240002
082500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08250002
082600             SET DP020-MSG-INFORMATIONAL                          08260002
082700                                   TO TRUE                        08270002
082800         END-IF                                                   08280002
082900     ELSE                                                         08290002
083000         SUBTRACT +1 FROM ASC-SEL-ITEM                            08300002
083100         MOVE VN021-MAX-ITEMS      TO ASC-SEL-SUB                 08310002
083200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08320002
083300         SET DP020-MSG-INFORMATIONAL                              08330002
083400                                   TO TRUE                        08340002
083500     END-IF.                                                      08350002
083600                                                                  08360002
083700******************************************************************08370002
083800* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *08380002
083900* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *08390002
084000******************************************************************08400002
084100 2310-GET-PREV-MESSAGE.                                           08410002
084200                                                                  08420002
084300     SUBTRACT +1 FROM ASC-SEL-SUB.                                08430002
084400     IF ASC-SEL-SUB < +1                                          08440002
084500         SUBTRACT +1 FROM ASC-SEL-ITEM                            08450002
084600         MOVE VN021-MAX-ITEMS      TO ASC-SEL-SUB                 08460002
084700     END-IF.                                                      08470002
084800                                                                  08480002
084900     IF ASC-SEL-ITEM > ZERO                                       08490002
085000         PERFORM 9100-READ-SEL-QUEUE                              08500002
085100         MOVE VN021-RLTNSHP-CDE (ASC-SEL-SUB)                     08510002
085200                                   TO ASC-KEY-RLTNSHP-CDE         08520002
085300         MOVE VN021-RLTNSHP-NAME (ASC-SEL-SUB)                    08530002
085400                                   TO ASC-KEY-RLTNSHP-NAME        08540002
085500     ELSE                                                         08550002
085600         MOVE +1                   TO ASC-SEL-ITEM                08560002
085700                                      ASC-SEL-SUB                 08570002
085800*        --- TOP OF LIST ---                                      08580002
085900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08590002
086000         SET DP020-MSG-INFORMATIONAL                              08600002
086100                                   TO TRUE                        08610002
086200     END-IF.                                                      08620002
086300                                                                  08630002
086400*----------------------------------------------------------------*08640002
086500* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *08650002
086600* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *08660002
086700* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*08670002
086800* IN THE DESTINATION PROGRAM, NOT HERE.                          *08680002
086900*----------------------------------------------------------------*08690002
087000                                                                  08700002
087100 3000-EDIT-DATA-IN-COMMAREA.                                      08710002
087200                                                                  08720002
087300     IF  ASC-KEY-RLTD-ENT-ID > ZEROES AND                         08730002
087400         ASC-KEY-RLTD-VEND-ID > ZEROES                            08740002
087500         SET PS-ERROR                                             08750002
087600             DP020-MSG-FATAL   TO TRUE                            08760002
087700         MOVE PC-TSYMSG-01883  TO DP020-MSG-NUMBER                08770002
087800*    ONLY ONE VALUE SHOULD BE ENTERED -----------------------     08780002
087900         MOVE DP015-UNP-NUM-BRT-OFF                               08790002
088000                               TO ARENTIDA                        08800002
088100                                  ARVNDIDA                        08810002
088200         MOVE DP015-RED        TO ARENTIDC                        08820002
088300                                  ARVNDIDC                        08830002
088400         MOVE DP015-REVERSE    TO ARENTIDH                        08840002
088500                                  ARVNDIDH                        08850002
088600         MOVE -1               TO ARENTIDL                        08860002
088700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08870002
088800     END-IF.                                                      08880002
088900                                                                  08890002
089000     IF  PS-NO-ERROR                                              08900002
089100         IF  ASC-KEY-RLTD-ENT-ID > ZEROES                         08910002
089200             MOVE ASC-KEY-RLTD-ENT-ID  TO DP010I-UNEDITED-FIELD   08920002
089300             MOVE LENGTH OF ASC-KEY-RLTD-ENT-ID                   08930002
089400                                       TO DP010I-MAXIMUM-DIGITS   08940002
089500             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 08950002
089600             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              08960002
089710             CALL DP010I-NUMERIC-EDIT-ROUTINE                     08971009
089720                         USING DP010I-NUMERIC-EDIT-AREA           08972009
089800             IF  DP010I-ERROR-DETECTED                            08980002
089900                 SET PS-ERROR                                     08990002
090000                     DP020-MSG-FATAL   TO TRUE                    09000002
090100                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        09010002
090200                 MOVE DP015-UNP-NUM-BRT-OFF                       09020002
090300                                       TO ARENTIDA                09030002
090400                 MOVE DP015-RED        TO ARENTIDC                09040002
090500                 MOVE DP015-REVERSE    TO ARENTIDH                09050002
090600                 MOVE -1               TO ARENTIDL                09060002
090700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09070002
090800             ELSE                                                 09080002
090900                 MOVE DP010I-NUMERIC-FIELD                        09090002
091000                                       TO ASC-KEY-RLTD-ENT-ID     09100002
091100                 MOVE ASC-KEY-RLTD-ENT-ID TO ARENTIDO             09110002
091200                                             DK-RLTD-ENT-ID       09120002
091300                 IF ASC-KEY-RLTD-ENT-ID = ASC-KEY-ENT-ID          09130002
091400                     SET PS-ERROR                                 09140002
091500                         DP020-MSG-FATAL   TO TRUE                09150002
091600                     MOVE PC-TSYMSG-03377  TO DP020-MSG-NUMBER    09160002
091700                     MOVE DP015-UNP-NUM-BRT-OFF                   09170002
091800                                           TO ARENTIDA            09180002
091900                     MOVE DP015-RED        TO ARENTIDC            09190002
092000                     MOVE DP015-REVERSE    TO ARENTIDH            09200002
092100                     MOVE -1               TO ARENTIDL            09210002
092200                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09220002
092300                     MOVE SPACES       TO ASC-KEY-RLTD-VEND-NAME  09230002
092400                     MOVE ZEROES       TO ASC-ADD-RLTD-ENT-ID     09240002
092500                 ELSE                                             09250002
092600                   PERFORM 6100-GET-RLTD-VENDOR-VIA-ENT           09260002
092700                   IF SQLCODE NOT = ZERO                          09270002
092800                       SET PS-ERROR                               09280002
092900                           DP020-MSG-FATAL   TO TRUE              09290002
093000                       MOVE PC-TSYMSG-00398  TO DP020-MSG-NUMBER  09300002
093100                       MOVE DP015-UNP-NUM-BRT-OFF                 09310002
093200                                             TO ARENTIDA          09320002
093300                       MOVE DP015-RED        TO ARENTIDC          09330002
093400                       MOVE DP015-REVERSE    TO ARENTIDH          09340002
093500                       MOVE -1               TO ARENTIDL          09350002
093600                       SET DP030-SET-CURSOR-APPL-1 TO TRUE        09360002
093700                       MOVE SPACES       TO ASC-KEY-RLTD-VEND-NAME09370002
093800                       MOVE ZEROES       TO ASC-ADD-RLTD-ENT-ID   09380002
093900                   ELSE                                           09390002
094000                       MOVE ASC-KEY-RLTD-ENT-ID TO                09400002
094100                                             ASC-ADD-RLTD-ENT-ID  09410002
094200                   END-IF                                         09420002
094300                 END-IF                                           09430002
094400             END-IF                                               09440002
094500             SET ASC-ENT-ID-ENTERED    TO TRUE                    09450002
094600         END-IF                                                   09460002
094700     END-IF.                                                      09470002
094800                                                                  09480002
094900     IF  PS-NO-ERROR                                              09490002
095000         IF  ASC-KEY-RLTD-VEND-ID > ZEROES                        09500002
095100             MOVE ASC-KEY-RLTD-VEND-ID TO DP010I-UNEDITED-FIELD   09510002
095200             MOVE LENGTH OF ASC-KEY-RLTD-VEND-ID                  09520002
095300                                       TO DP010I-MAXIMUM-DIGITS   09530002
095400             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 09540002
095500             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              09550002
095610             CALL DP010I-NUMERIC-EDIT-ROUTINE                     09561009
095620                         USING DP010I-NUMERIC-EDIT-AREA           09562009
095700             IF  DP010I-ERROR-DETECTED                            09570002
095800                 SET PS-ERROR                                     09580002
095900                     DP020-MSG-FATAL   TO TRUE                    09590002
096000                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        09600002
096100                 MOVE DP015-UNP-NUM-BRT-OFF                       09610002
096200                                       TO ARVNDIDA                09620002
096300                 MOVE DP015-RED        TO ARVNDIDC                09630002
096400                 MOVE DP015-REVERSE    TO ARVNDIDH                09640002
096500                 MOVE -1               TO ARVNDIDL                09650002
096600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09660002
096700             ELSE                                                 09670002
096800                 MOVE DP010I-NUMERIC-FIELD                        09680002
096900                                       TO ASC-KEY-RLTD-VEND-ID    09690002
097000                 MOVE ASC-KEY-RLTD-VEND-ID-X TO ARVNDIDO          09700002
097100                                                DK-RLTD-VEND-ID   09710002
097200                 PERFORM 6200-GET-RLTD-VENDOR-VIA-DUNS            09720002
097300                 IF SQLCODE NOT = ZERO                            09730002
097400                     SET PS-ERROR                                 09740002
097500                         DP020-MSG-FATAL   TO TRUE                09750002
097600                     MOVE PC-TSYMSG-00159  TO DP020-MSG-NUMBER    09760002
097700                     MOVE DP015-UNP-NUM-BRT-OFF                   09770002
097800                                           TO ARVNDIDA            09780002
097900                     MOVE DP015-RED        TO ARVNDIDC            09790002
098000                     MOVE DP015-REVERSE    TO ARVNDIDH            09800002
098100                     MOVE -1               TO ARVNDIDL            09810002
098200                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09820002
098300                     MOVE SPACES       TO ASC-KEY-RLTD-VEND-NAME  09830002
098400                     MOVE ZEROES       TO ASC-ADD-RLTD-ENT-ID     09840002
098500                 ELSE                                             09850002
098600                   IF ASC-ADD-RLTD-ENT-ID = ASC-KEY-ENT-ID        09860002
098700                       SET PS-ERROR                               09870002
098800                           DP020-MSG-FATAL   TO TRUE              09880002
098900                       MOVE PC-TSYMSG-03377  TO DP020-MSG-NUMBER  09890002
099000                       MOVE DP015-UNP-NUM-BRT-OFF                 09900002
099100                                             TO ARVNDIDA          09910002
099200                       MOVE DP015-RED        TO ARVNDIDC          09920002
099300                       MOVE DP015-REVERSE    TO ARVNDIDH          09930002
099400                       MOVE -1               TO ARVNDIDL          09940002
099500                       SET DP030-SET-CURSOR-APPL-1 TO TRUE        09950002
099600                       MOVE SPACES       TO ASC-KEY-RLTD-VEND-NAME09960002
099700                       MOVE ZEROES       TO ASC-ADD-RLTD-ENT-ID   09970002
099800                   END-IF                                         09980002
099900                 END-IF                                           09990002
100000             END-IF                                               10000002
100100             SET ASC-VEND-ID-ENTERED   TO TRUE                    10010002
100200         END-IF                                                   10020002
100300     END-IF.                                                      10030002
100400                                                                  10040002
100500     IF  ASC-KEY-RLTD-ENT-ID = ZEROES AND                         10050002
100600         ASC-KEY-RLTD-VEND-ID = ZEROES                            10060002
100700         MOVE SPACES       TO ASC-KEY-RLTD-VEND-NAME              10070002
100800         MOVE ZEROES       TO ASC-ADD-RLTD-ENT-ID                 10080002
100900         SET PS-ERROR                                             10090002
101000             DP020-MSG-FATAL   TO TRUE                            10100002
101100         MOVE PC-TSYMSG-00308  TO DP020-MSG-NUMBER                10110002
101200*    AT LEAST ONE ENTRY IS REQUIRED -----------------------       10120002
101300         MOVE DP015-UNP-NUM-BRT-OFF                               10130002
101400                               TO ARENTIDA                        10140002
101500                                  ARVNDIDA                        10150002
101600         MOVE DP015-RED        TO ARENTIDC                        10160002
101700                                  ARVNDIDC                        10170002
101800         MOVE DP015-REVERSE    TO ARENTIDH                        10180002
101900                                  ARVNDIDH                        10190002
102000         MOVE -1               TO ARENTIDL                        10200002
102100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      10210002
102200     END-IF.                                                      10220002
102300                                                                  10230002
102400     IF  PS-NO-ERROR                                              10240002
102500         MOVE -1                        TO ARENTIDL               10250002
102600         SET DP030-SET-CURSOR-APPL-1    TO TRUE                   10260002
102700     END-IF.                                                      10270002
102800                                                                  10280002
102900******************************************************************10290002
103000** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **10300002
103100** MAP.                                                         **10310002
103200******************************************************************10320002
103300                                                                  10330002
103400 3200-RESET-ATTRIBUTES.                                           10340002
103500                                                                  10350002
103600     IF ASC-ADD-SCREEN                                            10360002
103700         MOVE DP015-UNP-NUM-NOR-OFF    TO ARVNDIDA                10370002
103800                                          ARENTIDA                10380002
103900         MOVE DP015-GREEN              TO ARVNDIDC                10390002
104000                                          ARENTIDC                10400002
104100         MOVE DP015-UNDERLINE          TO ARVNDIDH                10410002
104200                                          ARENTIDH                10420002
104300     ELSE                                                         10430002
104400         MOVE DP015-PRO-NOR-OFF        TO ARVNDIDA                10440002
104500                                          ARENTIDA                10450002
104600         MOVE DP015-BLUE               TO ARVNDIDC                10460002
104700                                          ARENTIDC                10470002
104800         MOVE DP015-HL-OFF             TO ARVNDIDH                10480002
104900                                          ARENTIDH                10490002
105000     END-IF.                                                      10500002
105100                                                                  10510002
105200*----------------------------------------------------------------*10520002
105300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *10530002
105400*    READ THE DATABASE FOR THE MOST RECENT ACTIVITY TO DISPLAY   *10540002
105500*    DISPLAY THE PANEL TO USER.                                  *10550002
105600*----------------------------------------------------------------*10560002
105700 4000-BUILD-INITIAL-PANEL.                                        10570002
105800                                                                  10580002
105900     IF ASC-USE-SELECTION-QUEUE                                   10590002
106000       IF ASC-UPD-SCREEN                                          10600002
106100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         10610002
106200                    ASC-BLOCK-ENTRIES (2)                         10620002
106300         MOVE +1 TO ASC-BLK-SUB                                   10630002
106400         SET ASC-ITEMS-LEFT-ON-DB TO TRUE                         10640002
106500         MOVE ZERO TO ASC-ITEM-SUB                                10650002
106600                      ASC-NUMBER-OF-ITEMS-READ                    10660002
106700                      ASC-HIGHEST-BLOCK-WRITTEN                   10670002
106800                      ASC-ITEM-AT-TOP-OF-PANEL                    10680002
106900                                                                  10690002
107000         PERFORM 4010-OPEN-CURSOR                                 10700002
107100                                                                  10710002
107200         PERFORM 4300-READ-ITEMS-FROM-DB                          10720002
107300                                                                  10730002
107400         PERFORM 4020-CLOSE-CURSOR                                10740002
107500         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      10750002
107600             SET DP020-MSG-WARNING TO  TRUE                       10760002
107700             MOVE PC-TSYMSG-03375  TO  DP020-MSG-NUMBER           10770002
107800         END-IF                                                   10780002
107900       END-IF                                                     10790002
108000     END-IF.                                                      10800002
108100     MOVE +1 TO PV-TOP-ITEM.                                      10810002
108200     IF ASC-ADD-SCREEN                                            10820002
108300         MOVE -1                       TO ARENTIDL                10830002
108400         SET DP030-SET-CURSOR-APPL-1   TO TRUE                    10840002
108500     ELSE                                                         10850002
108600         SET DP030-SET-CURSOR-TRAILER  TO TRUE                    10860002
108700     END-IF.                                                      10870002
108800     PERFORM 3200-RESET-ATTRIBUTES.                               10880002
108900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10890002
109000                                                                  10900002
109100 4010-OPEN-CURSOR.                                                10910002
109200                                                                  10920002
109300     PERFORM                                                      10930002
109400         WITH TEST AFTER                                          10940002
109500         VARYING PV-RETRY-COUNTER                                 10950002
109600         FROM 1 BY 1                                              10960002
109700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10970002
109800                   OR (SQLCODE = ZERO))                           10980002
109900                                                                  10990002
110000         EXEC SQL                                                 11000002
110100             OPEN RELATIONSHIP-CSR                                11010002
110200         END-EXEC                                                 11020002
110300                                                                  11030002
110400         EVALUATE TRUE                                            11040002
110500             WHEN SQLCODE = ZERO                                  11050002
110600             WHEN SQLCODE = -904                                  11060002
110700             WHEN SQLCODE = -913                                  11070002
110800                 CONTINUE                                         11080002
110900                                                                  11090002
111000             WHEN SQLWARN0 NOT = SPACES                           11100002
111100             WHEN SQLCODE < ZERO                                  11110002
111200             WHEN SQLCODE > ZERO                                  11120002
111300                 MOVE '4010-OPEN-CURSOR'                          11130002
111400                                   TO DP013-PARAGRAPH             11140002
111500                 MOVE 'OPEN VENDOR RELATIONSHIP CURSOR - '        11150002
111600                                   TO DP013-MESSAGE-TEXT (1)      11160002
111700                 MOVE SQLCA        TO DP013-SQLCA                 11170002
111800                 MOVE 'VNT_RLTNSHP_CDE'                           11180002
111900                                   TO DP013-DB2-TABLE-NAME (1)    11190002
112000                 SET DP013-DB2-ABEND                              11200002
112100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11210002
112200                 PERFORM DP013-0000-PROCESS-ABEND                 11220002
112300         END-EVALUATE                                             11230002
112400     END-PERFORM.                                                 11240002
112500                                                                  11250002
112600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11260002
112700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             11270002
112800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   11280002
112900                                   TO DP013-MESSAGE-TEXT (1)      11290002
113000         MOVE SQLCA                TO DP013-SQLCA                 11300002
113100         MOVE 'VNT_RLTNSHP_CDE' TO DP013-DB2-TABLE-NAME (1)       11310002
113200         SET DP013-DB2-ABEND                                      11320002
113300             DP013-XCTL-DISPLAY-RESTART                           11330002
113400                                   TO TRUE                        11340002
113500         PERFORM DP013-0000-PROCESS-ABEND                         11350002
113600     END-IF.                                                      11360002
113700                                                                  11370002
113800 4020-CLOSE-CURSOR.                                               11380002
113900                                                                  11390002
114000     EXEC SQL                                                     11400002
114100         CLOSE RELATIONSHIP-CSR                                   11410002
114200     END-EXEC                                                     11420002
114300                                                                  11430002
114400     EVALUATE TRUE                                                11440002
114500         WHEN SQLCODE = ZERO                                      11450002
114600             CONTINUE                                             11460002
114700                                                                  11470002
114800         WHEN SQLWARN0 NOT = SPACES                               11480002
114900         WHEN SQLCODE < ZERO                                      11490002
115000         WHEN SQLCODE > ZERO                                      11500002
115100             MOVE '4020-CLOSE-CURSOR'                             11510002
115200                               TO DP013-PARAGRAPH                 11520002
115300             MOVE 'CLOSE VENDOR DEPARTMENT CURSOR '               11530002
115400                               TO DP013-MESSAGE-TEXT (1)          11540002
115500             MOVE SQLCA        TO DP013-SQLCA                     11550002
115600             MOVE 'VNT_RLTNSHP_CDE' TO DP013-DB2-TABLE-NAME (1)   11560002
115700             SET DP013-DB2-ABEND                                  11570002
115800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11580002
115900             PERFORM DP013-0000-PROCESS-ABEND                     11590002
116000     END-EVALUATE.                                                11600002
116100                                                                  11610002
116200*---------------------------------------------------------------* 11620002
116300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE   * 11630002
116400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,    * 11640002
116500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND * 11650002
116600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE    * 11660002
116700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                  * 11670002
116800*---------------------------------------------------------------* 11680002
116900                                                                  11690002
117000 4300-READ-ITEMS-FROM-DB.                                         11700002
117100                                                                  11710002
117200     PERFORM                                                      11720002
117300         VARYING PV-READ-COUNT                                    11730002
117400         FROM 1 BY 1                                              11740002
117500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    11750002
117600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         11760002
117700                                                                  11770002
117800         PERFORM 4310-FETCH                                       11780002
117900                                                                  11790002
118000         IF  ASC-ITEMS-LEFT-ON-DB                                 11800002
118100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                11810002
118200                 ADD +1            TO ASC-ITEM-SUB                11820002
118300             ELSE                                                 11830002
118400                 ADD +1            TO ASC-BLK-SUB                 11840002
118500                 MOVE +1           TO ASC-ITEM-SUB                11850002
118600                                                                  11860002
118700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         11870002
118800                     MOVE +1       TO ASC-BLK-SUB                 11880002
118900                     SET ASC-BLOCK-MODIFIED (1)                   11890002
119000                                   TO TRUE                        11900002
119100                     PERFORM 5100-WRITE-TEMP-STORAGE              11910002
119200                     MOVE ASC-BLOCK-ENTRIES                       11920002
119300                               (PC-MAX-BLOCKS-IN-ARRAY)           11930002
119400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 11940002
119500                     ADD +1        TO ASC-BLK-SUB                 11950002
119600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   11960002
119700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      11970002
119800                                   TO TRUE                        11980002
119900                 END-IF                                           11990002
120000             END-IF                                               12000002
120100             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 12010002
120200             MOVE ASC-NUMBER-OF-ITEMS-READ                        12020002
120300                                      TO ASC-LIST-ITEM-NUMBER     12030002
120400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12040002
120500             MOVE ENTNME-ENT-NAME-DESC                            12050002
120600                                      TO ASC-RLTD-VEND-NAME       12060002
120700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12070002
120800             MOVE EXTENT-DUN-NBR      TO ASC-RLTD-VEND-ID         12080002
120900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12090002
121000             MOVE VNT00000-RLTD-ENT-ID                            12100002
121100                                      TO ASC-RLTD-ENT-ID          12110002
121200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12120002
121300             MOVE VNT00000-EFF-BEG-DTE(6:2)                       12130002
121400                                      TO PV-WORK-MM               12140002
121500             MOVE VNT00000-EFF-BEG-DTE(9:2)                       12150002
121600                                      TO PV-WORK-DD               12160002
121700             MOVE VNT00000-EFF-BEG-DTE(1:4)                       12170002
121800                                      TO PV-WORK-YYYY             12180002
121900             MOVE PV-WORK-DATE        TO ASC-EFF-DATE             12190002
122000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12200002
122100             MOVE VNT00000-EFF-END-DTE(6:2)                       12210002
122200                                      TO PV-WORK-MM               12220002
122300             MOVE VNT00000-EFF-END-DTE(9:2)                       12230002
122400                                      TO PV-WORK-DD               12240002
122500             MOVE VNT00000-EFF-END-DTE(1:4)                       12250002
122600                                      TO PV-WORK-YYYY             12260002
122700             MOVE PV-WORK-DATE        TO ASC-EXP-DATE             12270002
122800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12280002
122900             MOVE VNT00000-LAST-UPD-TMST(6:2)                     12290002
123000                                      TO PV-WORK-MM               12300002
123100             MOVE VNT00000-LAST-UPD-TMST(9:2)                     12310002
123200                                      TO PV-WORK-DD               12320002
123300             MOVE VNT00000-LAST-UPD-TMST(1:4)                     12330002
123400                                      TO PV-WORK-YYYY             12340002
123500             MOVE PV-WORK-DATE        TO ASC-LAST-UPD-DATE        12350002
123600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12360002
123700             MOVE VNT00000-LAST-UPD-BY-USR-ID                     12370002
123800                                      TO ASC-LAST-UPD-ID          12380002
123900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12390002
124000             MOVE VNT00000-CRE-DTE(6:2)                           12400002
124100                                      TO PV-WORK-MM               12410002
124200             MOVE VNT00000-CRE-DTE(9:2)                           12420002
124300                                      TO PV-WORK-DD               12430002
124400             MOVE VNT00000-CRE-DTE(1:4)                           12440002
124500                                      TO PV-WORK-YYYY             12450002
124600             MOVE PV-WORK-DATE        TO ASC-DATE-ADDED           12460002
124700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12470002
124800         END-IF                                                   12480002
124900     END-PERFORM.                                                 12490002
125000                                                                  12500002
125100     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           12510002
125200         MOVE +1 TO ASC-BLK-SUB                                   12520002
125300         PERFORM 5100-WRITE-TEMP-STORAGE                          12530002
125400         ADD  +1 TO ASC-BLK-SUB                                   12540002
125500         PERFORM 5100-WRITE-TEMP-STORAGE                          12550002
125600         MOVE 1 TO ASC-BLK-SUB                                    12560002
125700                   PV-BLOCK-NUMBER                                12570002
125800         PERFORM 4410-READ-TEMP-STORAGE                           12580002
125900         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              12590002
126000             MOVE 2 TO ASC-BLK-SUB                                12600002
126100                       PV-BLOCK-NUMBER                            12610002
126200             PERFORM 4410-READ-TEMP-STORAGE                       12620002
126300         END-IF                                                   12630002
126400     END-IF.                                                      12640002
126500                                                                  12650002
126600*----------------------------------------------------------------*12660002
126700*----------------------------------------------------------------*12670002
126800                                                                  12680002
126900 4310-FETCH.                                                      12690002
127000                                                                  12700002
127100     EXEC SQL                                                     12710002
127200             FETCH RELATIONSHIP-CSR                               12720002
127300              INTO :VNT00000-RLTD-ENT-ID                          12730002
127400                  ,:VNT00000-EFF-BEG-DTE                          12740002
127500                  ,:VNT00000-EFF-END-DTE                          12750002
127600                  ,:VNT00000-CRE-DTE                              12760002
127700                  ,:VNT00000-LAST-UPD-TMST                        12770002
127800                  ,:VNT00000-LAST-UPD-BY-USR-ID                   12780002
127900                  ,:ENTNME-ENT-NAME-DESC                          12790002
128000                  ,:EXTENT-DUN-NBR                                12800002
128100     END-EXEC                                                     12810002
128200                                                                  12820002
128300     EVALUATE TRUE                                                12830002
128400         WHEN SQLCODE = ZERO                                      12840002
128500         WHEN SQLCODE = +100                                      12850002
128600              CONTINUE                                            12860002
128700                                                                  12870002
128800         WHEN SQLWARN0 NOT = SPACE                                12880002
128900         WHEN SQLCODE NOT = ZERO                                  12890002
129000              MOVE '4310-FETCH-CURSOR'                            12900002
129100                               TO DP013-PARAGRAPH                 12910002
129200              MOVE 'FETCH VENDOR DEPARTMENT CURSOR'               12920002
129300                               TO DP013-MESSAGE-TEXT (1)          12930002
129400              MOVE SQLCA       TO DP013-SQLCA                     12940002
129500              SET DP013-DB2-ABEND                                 12950002
129600                               TO TRUE                            12960002
129700              PERFORM DP013-0000-PROCESS-ABEND                    12970002
129800     END-EVALUATE.                                                12980002
129900                                                                  12990002
130000     IF SQLCODE = +100                                            13000002
130100         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE.                     13010002
130200                                                                  13020002
130300*----------------------------------------------------------------*13030002
130400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *13040002
130500*----------------------------------------------------------------*13050002
130600 4400-MOVE-COMMAREA-TO-SCREEN.                                    13060002
130700                                                                  13070002
130800     MOVE ASC-KEY-VENDOR-NAME      TO AVENDO.                     13080002
130900     MOVE ASC-KEY-RLTD-VEND-NAME   TO ARVNDNMO.                   13090002
131000     MOVE ASC-KEY-VENDOR-ID        TO AVNDIDO.                    13100002
131100     MOVE ASC-DISPLAY-ENT-ID       TO AENTIDO.                    13110002
131200     MOVE ASC-KEY-RLTNSHP-NAME     TO ARELATNO.                   13120002
131300     IF ASC-UPD-SCREEN                                            13130002
131400       EVALUATE ASC-INT-APPL-FORMAT-IND                           13140002
131500         WHEN PC-INTER-APPL-LIST-UPD                              13150002
131600            IF ASC-NUMBER-OF-ITEMS-READ > ZERO                    13160002
131700               PERFORM 4401-MOVE-COMMAREA-FOR-UPDT                13170002
131800            ELSE                                                  13180002
131900               MOVE ZEROES             TO ARENTIDO                13190002
132000               MOVE SPACES             TO AEFFDTO                 13200002
132100                                          AEXPDTO                 13210002
132200                                          AADDDTO                 13220002
132300                                          AUPDBYO                 13230002
132400                                          AUPDDTO                 13240002
132500                                          ARVNDIDO                13250002
132600            END-IF                                                13260002
132700         WHEN PC-INTER-APPL-DETAIL-UPD                            13270002
132800             PERFORM 6000-GET-EFFECTIVE                           13280002
132900             MOVE ASC-DTL-EFF-DATE         TO AEFFDTO             13290002
133000             MOVE ASC-DTL-EXP-DATE         TO AEXPDTO             13300002
133100             MOVE ASC-DTL-DATE-ADDED       TO AADDDTO             13310002
133200             MOVE ASC-DTL-LAST-UPD-ID      TO AUPDBYO             13320002
133300             MOVE ASC-DTL-LAST-UPD-DATE    TO AUPDDTO             13330002
133400             MOVE ASC-KEY-RLTD-ENT-ID      TO ARENTIDO            13340002
133500             MOVE ASC-KEY-RLTD-VEND-ID     TO ARVNDIDO            13350002
133600       END-EVALUATE                                               13360002
133700     ELSE                                                         13370002
133800         MOVE ASC-CURRENT-DATE   TO AEFFDTO                       13380002
133900         MOVE SPACES             TO AEXPDTO                       13390002
134000                                    AADDDTO                       13400002
134100                                    AUPDBYO                       13410002
134200                                    AUPDDTO                       13420002
134300     END-IF.                                                      13430002
134400                                                                  13440002
134500*----------------------------------------------------------------*13450002
134600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *13460002
134700*----------------------------------------------------------------*13470002
134800 4401-MOVE-COMMAREA-FOR-UPDT.                                     13480002
134900                                                                  13490002
135000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             13500002
135100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          13510002
135200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          13520002
135300             MOVE +1    TO ASC-BLK-SUB                            13530002
135400             PERFORM 5100-WRITE-TEMP-STORAGE                      13540002
135500             ADD +1     TO ASC-BLK-SUB                            13550002
135600             PERFORM 5100-WRITE-TEMP-STORAGE                      13560002
135700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             13570002
135800                 GIVING PV-BLOCK-NUMBER                           13580002
135900                 REMAINDER PV-REMAINDER                           13590002
136000             IF  PV-REMAINDER > ZERO                              13600002
136100                 ADD +1 TO PV-BLOCK-NUMBER                        13610002
136200             END-IF                                               13620002
136300             MOVE +1    TO ASC-BLK-SUB                            13630002
136400             PERFORM 4410-READ-TEMP-STORAGE                       13640002
136500             ADD +1     TO ASC-BLK-SUB                            13650002
136600                           PV-BLOCK-NUMBER                        13660002
136700             PERFORM 4410-READ-TEMP-STORAGE                       13670002
136800     END-IF.                                                      13680002
136900     MOVE +1            TO ASC-BLK-SUB.                           13690002
137000     COMPUTE ASC-ITEM-SUB =                                       13700002
137100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              13710002
137200         + PC-ITEMS-PER-PANEL).                                   13720002
137300                                                                  13730002
137400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13740002
137500         ADD +1         TO ASC-BLK-SUB                            13750002
137600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13760002
137700     END-IF.                                                      13770002
137800                                                                  13780002
137900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           13790002
138000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                13800002
138100                                                                  13810002
138200     COMPUTE ASC-ITEMS-DISPLAYED =                                13820002
138300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          13830002
138400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   13840002
138500     MOVE ASC-EFF-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AEFFDTO.     13850002
138600     MOVE ASC-EXP-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AEXPDTO.     13860002
138700     MOVE ASC-DATE-ADDED (ASC-BLK-SUB ASC-ITEM-SUB) TO AADDDTO.   13870002
138800     MOVE ASC-LAST-UPD-ID (ASC-BLK-SUB ASC-ITEM-SUB) TO AUPDBYO.  13880002
138900     MOVE ASC-LAST-UPD-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AUPDDTO.13890002
139000     MOVE ASC-RLTD-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB) TO ARENTIDO  13900002
139100                                           ASC-KEY-RLTD-ENT-ID.   13910002
139200     MOVE ASC-RLTD-VEND-ID (ASC-BLK-SUB ASC-ITEM-SUB) TO ARVNDIDO 13920002
139300                                           ASC-KEY-RLTD-VEND-ID.  13930002
139400     MOVE ASC-RLTD-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)           13940002
139500                                                     TO ARVNDNMO. 13950002
139600     IF  DP020-MSG-NUMBER-X = SPACE                               13960002
139700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  13970002
139800*            --- MORE ITEMS TO DISPLAY ----                       13980002
139900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            13990002
140000             SET DP020-MSG-INFORMATIONAL TO TRUE                  14000002
140100         END-IF                                                   14010002
140200     END-IF.                                                      14020002
140300                                                                  14030002
140400*----------------------------------------------------------------*14040002
140500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *14050002
140600*----------------------------------------------------------------*14060002
140700 4410-READ-TEMP-STORAGE.                                          14070002
140800                                                                  14080002
140900     EXEC CICS                                                    14090002
141000         READQ TS                                                 14100002
141100             QUEUE (ASC-LIST-QUEUE-NAME)                          14110002
141200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14120002
141300             ITEM  (PV-BLOCK-NUMBER)                              14130002
141400             RESP  (PV-CICS-RESP)                                 14140002
141500     END-EXEC.                                                    14150002
141600                                                                  14160002
141700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       14170002
141800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     14180002
141900         CONTINUE                                                 14190002
142000     ELSE                                                         14200002
142100         SET DP013-CICS-ABEND     TO TRUE                         14210002
142200         SET DP013-NO-ROLLBACK    TO TRUE                         14220002
142300         MOVE '4410-READ-TEMP-STORAGE'                            14230002
142400                                  TO DP013-PARAGRAPH              14240002
142500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      14250002
142600                                  TO DP013-MESSAGE-TEXT(1)        14260002
142700         PERFORM DP013-0000-PROCESS-ABEND                         14270002
142800     END-IF.                                                      14280002
142900                                                                  14290002
143000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             14300002
143100                                                                  14310002
143200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         14320002
143300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               14330002
143400     END-IF.                                                      14340002
143500                                                                  14350002
143600*----------------------------------------------------------------*14360002
143700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *14370002
143800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *14380002
143900*----------------------------------------------------------------*14390002
144000 5100-WRITE-TEMP-STORAGE.                                         14400002
144100                                                                  14410002
144200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     14420002
144300                                   TO PV-LIST-ITEM-NUMBER.        14430002
144400     COMPUTE PV-BLOCK-NUMBER =                                    14440002
144500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14450002
144600                                                                  14460002
144700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             14470002
144800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             14480002
144900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      14490002
145000             PERFORM 5105-REWRITE-ASC-LISTQ                       14500002
145100         END-IF                                                   14510002
145200     ELSE                                                         14520002
145300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       14530002
145400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            14540002
145500         PERFORM 5110-WRITE-ASC-LISTQ                             14550002
145600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   14560002
145700     END-IF.                                                      14570002
145800                                                                  14580002
145900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             14590002
146000                                                                  14600002
146100***************************************************************** 14610002
146200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    * 14620002
146300** SPECIFIC COMMAREA.                                           * 14630002
146400***************************************************************** 14640002
146500 5105-REWRITE-ASC-LISTQ.                                          14650002
146600                                                                  14660002
146700     EXEC CICS                                                    14670002
146800         WRITEQ TS                                                14680002
146900             QUEUE (ASC-LIST-QUEUE-NAME)                          14690002
147000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14700002
147100             ITEM  (PV-BLOCK-NUMBER)                              14710002
147200             REWRITE                                              14720002
147300             RESP  (PV-CICS-RESP)                                 14730002
147400     END-EXEC.                                                    14740002
147500                                                                  14750002
147600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           14760002
147700         CONTINUE                                                 14770002
147800     ELSE                                                         14780002
147900         SET DP013-CICS-ABEND            TO TRUE                  14790002
148000         SET DP013-NO-ROLLBACK           TO TRUE                  14800002
148100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       14810002
148200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     14820002
148300                                         TO DP013-MESSAGE-TEXT(1) 14830002
148400         PERFORM DP013-0000-PROCESS-ABEND                         14840002
148500     END-IF.                                                      14850002
148600                                                                  14860002
148700***************************************************************** 14870002
148800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      * 14880002
148900** SPECIFIC COMMAREA.                                           * 14890002
149000***************************************************************** 14900002
149100 5110-WRITE-ASC-LISTQ.                                            14910002
149200                                                                  14920002
149300     EXEC CICS                                                    14930002
149400         WRITEQ TS                                                14940002
149500             QUEUE (ASC-LIST-QUEUE-NAME)                          14950002
149600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14960002
149700             ITEM  (PV-BLOCK-NUMBER)                              14970002
149800             RESP  (PV-CICS-RESP)                                 14980002
149900     END-EXEC.                                                    14990002
150000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      15000002
150100         SET DP013-CICS-ABEND      TO TRUE                        15010002
150200         SET DP013-NO-ROLLBACK     TO TRUE                        15020002
150300         MOVE '5110-WRITE-ASC-LISTQ'                              15030002
150400                                   TO DP013-PARAGRAPH             15040002
150500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           15050002
150600                                   TO DP013-MESSAGE-TEXT(1)       15060002
150700         PERFORM DP013-0000-PROCESS-ABEND                         15070002
150800     END-IF.                                                      15080002
150900                                                                  15090002
151000*----------------------------------------------------------------*15100002
151100* GET THE EFFECTIVE VENDOR / RELATIONSHIP / RELATED VENDOR        15110002
151200*----------------------------------------------------------------*15120002
151300 6000-GET-EFFECTIVE.                                              15130002
151400     SET ASC-NO-ROW-EXISTS         TO TRUE.                       15140002
151500     MOVE ASC-KEY-ENT-ID           TO DK-ENT-ID.                  15150002
151600     IF ASC-VEND-ID-ENTERED                                       15160002
151700         MOVE ASC-ADD-RLTD-ENT-ID  TO DK-RLTD-ENT-ID              15170002
151800     ELSE                                                         15180002
151900         MOVE ASC-KEY-RLTD-ENT-ID  TO DK-RLTD-ENT-ID              15190002
152000     END-IF.                                                      15200002
152100     MOVE ASC-KEY-RLTNSHP-CDE      TO DK-RLTNSHP-CDE.             15210002
152200     PERFORM                                                      15220002
152300         WITH TEST AFTER                                          15230002
152400         VARYING PV-RETRY-COUNTER                                 15240002
152500         FROM 1 BY 1                                              15250002
152600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15260002
152700                   OR (SQLCODE = ZERO)                            15270002
152800                   OR (SQLCODE = +100))                           15280002
152900                                                                  15290002
153000         EXEC SQL                                                 15300002
153100             SELECT  EFF_BEG_DTE                                  15310002
153200                    ,EFF_END_DTE                                  15320002
153300                    ,CRE_DTE                                      15330002
153400                    ,LAST_UPD_TMST                                15340002
153500                    ,LAST_UPD_BY_USR_ID                           15350002
153600               INTO  :VNT00000-EFF-BEG-DTE                        15360002
153700                    ,:VNT00000-EFF-END-DTE                        15370002
153800                    ,:VNT00000-CRE-DTE                            15380002
153900                    ,:VNT00000-LAST-UPD-TMST                      15390002
154000                    ,:VNT00000-LAST-UPD-BY-USR-ID                 15400002
154100               FROM VNT_VND_RLTNSHP A                             15410002
154200              WHERE A.ENT_ID = :DK-ENT-ID                         15420002
154300                AND A.RLTD_ENT_ID = :DK-RLTD-ENT-ID               15430002
154400                AND A.VND_RLTNSHP_CDE = :DK-RLTNSHP-CDE           15440002
154500                AND A.EFF_END_DTE =                               15450002
154600                    (SELECT MAX(EFF_END_DTE )                     15460002
154700                       FROM VNT_VND_RLTNSHP B                     15470002
154800                      WHERE A.ENT_ID = B.ENT_ID                   15480002
154900                        AND A.RLTD_ENT_ID = B.RLTD_ENT_ID         15490002
155000                        AND A.VND_RLTNSHP_CDE = B.VND_RLTNSHP_CDE)15500002
155100                AND A.EFF_BEG_DTE =                               15510005
155200                    (SELECT MAX(EFF_BEG_DTE )                     15520005
155300                       FROM VNT_VND_RLTNSHP B                     15530005
155400                      WHERE A.ENT_ID = B.ENT_ID                   15540005
155500                        AND A.RLTD_ENT_ID = B.RLTD_ENT_ID         15550005
155600                        AND A.VND_RLTNSHP_CDE = B.VND_RLTNSHP_CDE)15560005
155700         END-EXEC                                                 15570002
155800                                                                  15580002
155900         EVALUATE TRUE                                            15590002
156000             WHEN SQLCODE = ZERO                                  15600002
156100             WHEN SQLCODE = +100                                  15610002
156200             WHEN SQLCODE = -904                                  15620002
156300             WHEN SQLCODE = -913                                  15630002
156400                 CONTINUE                                         15640002
156500             WHEN SQLWARN0 NOT = SPACES                           15650002
156600             WHEN SQLCODE < ZERO                                  15660002
156700             WHEN SQLCODE > ZERO                                  15670002
156800                 MOVE '6000-GET-EFFECTIVE'                        15680002
156900                                   TO DP013-PARAGRAPH             15690002
157000                 MOVE 'SELECT RELATIONSHIP DATA FOR ENT:'         15700002
157100                                   TO DP013-MESSAGE-TEXT (1)      15710002
157200                 MOVE ASC-DISPLAY-ENT-ID                          15720002
157300                                   TO DP013-MESSAGE-TEXT (2)      15730002
157400                 MOVE SQLCA        TO DP013-SQLCA                 15740002
157500                 MOVE 'VNT_VND_RLTNSHP'                           15750002
157600                                   TO DP013-DB2-TABLE-NAME (1)    15760002
157700                 SET DP013-DB2-ABEND                              15770002
157800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15780002
157900                 PERFORM DP013-0000-PROCESS-ABEND                 15790002
158000         END-EVALUATE                                             15800002
158100     END-PERFORM.                                                 15810002
158200                                                                  15820002
158300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15830002
158400         MOVE '6000-GET-EFFECTIVE'   TO DP013-PARAGRAPH           15840002
158500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     15850002
158600                                   TO DP013-MESSAGE-TEXT (1)      15860002
158700         MOVE 'RELATIONSHIP FOR ENT-ID'                           15870002
158800                                   TO DP013-MESSAGE-TEXT (2)      15880002
158900         MOVE ASC-DISPLAY-ENT-ID   TO DP013-MESSAGE-TEXT (3)      15890002
159000         MOVE SQLCA                TO DP013-SQLCA                 15900002
159100         MOVE 'VNT_VND_RLTNSHP'    TO DP013-DB2-TABLE-NAME (1)    15910002
159200         SET DP013-DB2-ABEND                                      15920002
159300             DP013-XCTL-DISPLAY-RESTART                           15930002
159400                                   TO TRUE                        15940002
159500         PERFORM DP013-0000-PROCESS-ABEND                         15950002
159600     END-IF.                                                      15960002
159700                                                                  15970002
159800     IF SQLCODE = ZERO                                            15980002
159900         MOVE VNT00000-EFF-BEG-DTE(6:2)   TO PV-WORK-MM           15990002
160000         MOVE VNT00000-EFF-BEG-DTE(9:2)   TO PV-WORK-DD           16000002
160100         MOVE VNT00000-EFF-BEG-DTE(1:4)   TO PV-WORK-YYYY         16010002
160200         MOVE PV-WORK-DATE                TO ASC-DTL-EFF-DATE     16020002
160300         MOVE VNT00000-EFF-END-DTE(6:2)   TO PV-WORK-MM           16030002
160400         MOVE VNT00000-EFF-END-DTE(9:2)   TO PV-WORK-DD           16040002
160500         MOVE VNT00000-EFF-END-DTE(1:4)   TO PV-WORK-YYYY         16050002
160600         MOVE PV-WORK-DATE                TO ASC-DTL-EXP-DATE     16060002
160700         MOVE VNT00000-LAST-UPD-TMST(6:2) TO PV-WORK-MM           16070002
160800         MOVE VNT00000-LAST-UPD-TMST(9:2) TO PV-WORK-DD           16080002
160900         MOVE VNT00000-LAST-UPD-TMST(1:4) TO PV-WORK-YYYY         16090002
161000         MOVE PV-WORK-DATE                TO ASC-DTL-LAST-UPD-DATE16100002
161100         MOVE VNT00000-LAST-UPD-BY-USR-ID TO ASC-DTL-LAST-UPD-ID  16110002
161200         MOVE VNT00000-CRE-DTE(6:2)       TO PV-WORK-MM           16120002
161300         MOVE VNT00000-CRE-DTE(9:2)       TO PV-WORK-DD           16130002
161400         MOVE VNT00000-CRE-DTE(1:4)       TO PV-WORK-YYYY         16140002
161500         MOVE PV-WORK-DATE                TO ASC-DTL-DATE-ADDED   16150002
161600         IF ASC-DTL-EXP-DATE = PC-MAX-DATE                        16160002
161700             SET ASC-EFFECTIVE-ROW-EXISTS TO TRUE                 16170002
161800         ELSE                                                     16180002
161900             SET ASC-EXPIRED-ROW-EXISTS   TO TRUE                 16190002
162000         END-IF                                                   16200002
162100     ELSE                                                         16210002
162200         MOVE SPACES                      TO ASC-DTL-EFF-DATE     16220002
162300                                             ASC-DTL-EXP-DATE     16230002
162400     END-IF.                                                      16240002
162500                                                                  16250002
162600*----------------------------------------------------------------*16260002
162700* GET RELATED VENDOR NAME VIA ENT-ID                             *16270002
162800*----------------------------------------------------------------*16280002
162900                                                                  16290002
163000 6100-GET-RLTD-VENDOR-VIA-ENT.                                    16300002
163100     PERFORM                                                      16310002
163200         WITH TEST AFTER                                          16320002
163300         VARYING PV-RETRY-COUNTER                                 16330002
163400         FROM 1 BY 1                                              16340002
163500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16350002
163600                   OR (SQLCODE = ZERO)                            16360002
163700                   OR (SQLCODE = +100))                           16370002
163800             EXEC SQL                                             16380002
163900                  SELECT A.ENT_NAME_DESC                          16390002
164000                  INTO  :ASC-KEY-RLTD-VEND-NAME                   16400002
164100                  FROM TENTNME A,                                 16410002
164200                       TEXTENT B                                  16420002
164300                  WHERE B.ENT_ID     = A.ENT_ID                   16430002
164400                    AND A.ENT_ID     = :DK-RLTD-ENT-ID            16440002
164500                    AND A.TYPE_CDE   = '01'                       16450002
164600                    AND B.STATUS_CDE = 'A'                        16460002
164700             END-EXEC                                             16470002
164800         EVALUATE TRUE                                            16480002
164900             WHEN SQLCODE = ZERO                                  16490002
165000             WHEN SQLCODE = +100                                  16500002
165100             WHEN SQLCODE = -904                                  16510002
165200             WHEN SQLCODE = -913                                  16520002
165300                 CONTINUE                                         16530002
165400             WHEN SQLWARN0 NOT = SPACES                           16540002
165500             WHEN SQLCODE < ZERO                                  16550002
165600             WHEN SQLCODE > ZERO                                  16560002
165700                 MOVE '6100-GET-RLTD-VENDOR-VIA-ENT'              16570002
165800                                   TO DP013-PARAGRAPH             16580002
165900                 MOVE 'SELECT ENT-NAME-DESC'                      16590002
166000                                   TO DP013-MESSAGE-TEXT (1)      16600002
166100                 MOVE SQLCA        TO DP013-SQLCA                 16610002
166200                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    16620002
166300                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (2)    16630002
166400                 SET DP013-DB2-ABEND                              16640002
166500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16650002
166600                 PERFORM DP013-0000-PROCESS-ABEND                 16660002
166700         END-EVALUATE                                             16670002
166800     END-PERFORM                                                  16680002
166900                                                                  16690002
167000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16700002
167100         MOVE '6100-GET-RLTD-VENDOR-VIA-ENT'                      16710002
167200                                   TO DP013-PARAGRAPH             16720002
167300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   16730002
167400                                   TO DP013-MESSAGE-TEXT (1)      16740002
167500         MOVE SQLCA                TO DP013-SQLCA                 16750002
167600         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    16760002
167700         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (2)    16770002
167800         SET DP013-DB2-ABEND                                      16780002
167900             DP013-XCTL-DISPLAY-RESTART                           16790002
168000                                   TO TRUE                        16800002
168100         PERFORM DP013-0000-PROCESS-ABEND                         16810002
168200     END-IF.                                                      16820002
168300                                                                  16830002
168400*----------------------------------------------------------------*16840002
168500* GET RELATED VENDOR NAME VIA ENT-ID                             *16850002
168600*----------------------------------------------------------------*16860002
168700                                                                  16870002
168800 6200-GET-RLTD-VENDOR-VIA-DUNS.                                   16880002
168900     PERFORM                                                      16890002
169000         WITH TEST AFTER                                          16900002
169100         VARYING PV-RETRY-COUNTER                                 16910002
169200         FROM 1 BY 1                                              16920002
169300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16930002
169400                   OR (SQLCODE = ZERO)                            16940002
169500                   OR (SQLCODE = +100))                           16950002
169600             EXEC SQL                                             16960002
169700                  SELECT A.ENT_NAME_DESC                          16970002
169800                        ,A.ENT_ID                                 16980002
169900                  INTO  :ASC-KEY-RLTD-VEND-NAME                   16990002
170000                       ,:ASC-ADD-RLTD-ENT-ID                      17000002
170100                  FROM TENTNME A,                                 17010002
170200                       TEXTENT B                                  17020002
170300                  WHERE B.ENT_ID     = A.ENT_ID                   17030002
170400                    AND B.DUN_NBR    = :DK-RLTD-VEND-ID           17040002
170500                    AND A.TYPE_CDE   = '01'                       17050002
170600                    AND B.STATUS_CDE = 'A'                        17060002
170700             END-EXEC                                             17070002
170800         EVALUATE TRUE                                            17080002
170900             WHEN SQLCODE = ZERO                                  17090002
171000             WHEN SQLCODE = +100                                  17100002
171100             WHEN SQLCODE = -904                                  17110002
171200             WHEN SQLCODE = -913                                  17120002
171300                 CONTINUE                                         17130002
171400             WHEN SQLWARN0 NOT = SPACES                           17140002
171500             WHEN SQLCODE < ZERO                                  17150002
171600             WHEN SQLCODE > ZERO                                  17160002
171700                 MOVE '6200-GET-RLTD-VENDOR-VIA-DUNS'             17170002
171800                                   TO DP013-PARAGRAPH             17180002
171900                 MOVE 'SELECT ENT-NAME-DESC'                      17190002
172000                                   TO DP013-MESSAGE-TEXT (1)      17200002
172100                 MOVE SQLCA        TO DP013-SQLCA                 17210002
172200                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    17220002
172300                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (2)    17230002
172400                 SET DP013-DB2-ABEND                              17240002
172500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17250002
172600                 PERFORM DP013-0000-PROCESS-ABEND                 17260002
172700         END-EVALUATE                                             17270002
172800     END-PERFORM                                                  17280002
172900                                                                  17290002
173000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17300002
173100         MOVE '6200-GET-RLTD-VENDOR-VIA-DUNS'                     17310002
173200                                   TO DP013-PARAGRAPH             17320002
173300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   17330002
173400                                   TO DP013-MESSAGE-TEXT (1)      17340002
173500         MOVE SQLCA                TO DP013-SQLCA                 17350002
173600         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    17360002
173700         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (2)    17370002
173800         SET DP013-DB2-ABEND                                      17380002
173900             DP013-XCTL-DISPLAY-RESTART                           17390002
174000                                   TO TRUE                        17400002
174100         PERFORM DP013-0000-PROCESS-ABEND                         17410002
174200     END-IF.                                                      17420002
174300                                                                  17430002
174400*----------------------------------------------------------------*17440002
174500*    INSERT A RELATIONSHIP ROW                                   *17450002
174600*----------------------------------------------------------------*17460002
174700*                                                                 17470002
174800 7000-ADD-RELATION.                                               17480002
174900                                                                  17490002
175000     PERFORM                                                      17500002
175100         WITH TEST AFTER                                          17510002
175200         VARYING PV-RETRY-COUNTER                                 17520002
175300         FROM 1 BY 1                                              17530002
175400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17540002
175500             OR (SQLCODE = +0))                                   17550002
175600                                                                  17560002
175700         EXEC SQL                                                 17570002
175800              INSERT INTO VNT_VND_RLTNSHP                         17580002
175900                     ( ENT_ID                                     17590002
176000                      ,RLTD_ENT_ID                                17600002
176100                      ,VND_RLTNSHP_CDE                            17610002
176200                      ,EFF_BEG_DTE                                17620002
176300                      ,EFF_END_DTE                                17630002
176400                      ,CRE_DTE                                    17640002
176500                      ,LAST_UPD_TMST                              17650002
176600                      ,LAST_UPD_BY_USR_ID)                        17660002
176700              VALUES ( :VNT00000-ENT-ID                           17670002
176800                      ,:VNT00000-RLTD-ENT-ID                      17680002
176900                      ,:VNT00000-VND-RLTNSHP-CDE                  17690002
177000                      ,CURRENT DATE                               17700002
177100                      ,:PC-MAX-DATE-ISO                           17710002
177200                      ,CURRENT DATE                               17720002
177300                      ,CURRENT TIMESTAMP                          17730002
177400                      ,:DP020-USERID)                             17740002
177500         END-EXEC                                                 17750002
177600                                                                  17760002
177700         EVALUATE TRUE                                            17770002
177800             WHEN SQLCODE = +0                                    17780002
177900             WHEN SQLCODE = -904                                  17790002
178000             WHEN SQLCODE = -913                                  17800002
178100                  CONTINUE                                        17810002
178200                                                                  17820002
178300             WHEN SQLWARN0 NOT = SPACES                           17830002
178400             WHEN SQLCODE < +0                                    17840002
178500             WHEN SQLCODE > +0                                    17850002
178600                  MOVE '7000-ADD-RELATION'                        17860002
178700                                  TO DP013-PARAGRAPH              17870002
178800                  MOVE 'UNSUCCESSFUL INSERT FOR VNT_VND_RLTNSHP'  17880002
178900                                  TO DP013-MESSAGE-TEXT (1)       17890002
179000                  MOVE SQLCA      TO DP013-SQLCA                  17900002
179100                  MOVE 'VNT_VND_RLTNSHP'                          17910002
179200                                  TO DP013-DB2-TABLE-NAME (1)     17920002
179300                  SET DP013-DB2-ABEND                             17930002
179400                      DP013-XCTL-DISPLAY-RESTART                  17940002
179500                                  TO TRUE                         17950002
179600                  PERFORM DP013-0000-PROCESS-ABEND                17960002
179700         END-EVALUATE                                             17970002
179800     END-PERFORM.                                                 17980002
179900                                                                  17990002
180000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18000002
180100         MOVE '7000-ADD-RELATION'                                 18010002
180200                                  TO DP013-PARAGRAPH              18020002
180300         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON VNT_VND_RLTNSHP'18030002
180400                                  TO DP013-MESSAGE-TEXT (1)       18040002
180500         MOVE SQLCA               TO DP013-SQLCA                  18050002
180600         MOVE 'VNT_VND_RLTNSHP'   TO DP013-DB2-TABLE-NAME (1)     18060002
180700         SET DP013-DB2-ABEND                                      18070002
180800             DP013-XCTL-DISPLAY-RESTART                           18080002
180900                                  TO TRUE                         18090002
181000         PERFORM DP013-0000-PROCESS-ABEND                         18100002
181100     END-IF.                                                      18110002
181200                                                                  18120002
181300*----------------------------------------------------------------*18130002
181400*   UPDATE THE MOST RECENTLY EXPIRED ROW TO BE EFFECTIVE.        *18140002
181500*   THIS IS DONE ONLY WHEN THE EFFECTIVE BEGIN DATE IS THE       *18150002
181600*   CURRENT DATE, BECAUSE EXPIRING THAT ROW AND INSERTING A NEW  *18160002
181700*   CURRENT EFFECTIVE ROW WITH CURRENT DATE AS THE EFFECTIVE DATE*18170002
181800*   WOULD RESULT IN A DUPLICATE INSERT                           *18180002
181900*----------------------------------------------------------------*18190002
182000 7100-UPDATE-CURRENT-RELATION.                                    18200002
182100                                                                  18210002
182200     PERFORM                                                      18220002
182300         WITH TEST AFTER                                          18230002
182400         VARYING PV-RETRY-COUNTER                                 18240002
182500         FROM 1 BY 1                                              18250002
182600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18260002
182700             OR (SQLCODE = +0))                                   18270002
182800                                                                  18280002
182900         EXEC SQL                                                 18290002
183000              UPDATE VNT_VND_RLTNSHP                              18300002
183100                 SET EFF_END_DTE        = :PC-MAX-DATE-ISO        18310002
183200                    ,CRE_DTE            = CURRENT DATE            18320002
183300                    ,LAST_UPD_TMST      = CURRENT TIMESTAMP       18330002
183400                    ,LAST_UPD_BY_USR_ID = :DP020-USERID           18340002
183500               WHERE ENT_ID           = :DK-ENT-ID                18350002
183600                 AND RLTD_ENT_ID      = :DK-RLTD-ENT-ID           18360002
183700                 AND VND_RLTNSHP_CDE  = :DK-RLTNSHP-CDE           18370002
183800                 AND EFF_BEG_DTE      = CURRENT DATE              18380002
183900         END-EXEC                                                 18390002
184000                                                                  18400002
184100         EVALUATE TRUE                                            18410002
184200             WHEN SQLCODE = +0                                    18420002
184300             WHEN SQLCODE = -904                                  18430002
184400             WHEN SQLCODE = -913                                  18440002
184500                  CONTINUE                                        18450002
184600                                                                  18460002
184700             WHEN SQLWARN0 NOT = SPACES                           18470002
184800             WHEN SQLCODE < +0                                    18480002
184900             WHEN SQLCODE > +0                                    18490002
185000                  MOVE '7100-UPDATE-CURRENT-RELATION'             18500002
185100                                  TO DP013-PARAGRAPH              18510002
185200                  MOVE 'UNSUCCESSFUL UPDATE FOR VNT_VND_RLTNSHP'  18520002
185300                                  TO DP013-MESSAGE-TEXT (1)       18530002
185400                  MOVE SQLCA      TO DP013-SQLCA                  18540002
185500                  MOVE 'VNT_VND_RLTNSHP'                          18550002
185600                                  TO DP013-DB2-TABLE-NAME (1)     18560002
185700                  SET DP013-DB2-ABEND                             18570002
185800                      DP013-XCTL-DISPLAY-RESTART                  18580002
185900                                  TO TRUE                         18590002
186000                  PERFORM DP013-0000-PROCESS-ABEND                18600002
186100         END-EVALUATE                                             18610002
186200     END-PERFORM.                                                 18620002
186300                                                                  18630002
186400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18640002
186500         MOVE '7100-UPDATE-CURRENT-RELATION'                      18650002
186600                                  TO DP013-PARAGRAPH              18660002
186700         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE ON VNT_VND_RLTNSHP'18670002
186800                                  TO DP013-MESSAGE-TEXT (1)       18680002
186900         MOVE SQLCA               TO DP013-SQLCA                  18690002
187000         MOVE 'VNT_VND_RLTNSHP'   TO DP013-DB2-TABLE-NAME (1)     18700002
187100         SET DP013-DB2-ABEND                                      18710002
187200             DP013-XCTL-DISPLAY-RESTART                           18720002
187300                                  TO TRUE                         18730002
187400         PERFORM DP013-0000-PROCESS-ABEND                         18740002
187500     END-IF.                                                      18750002
187600                                                                  18760002
187700*----------------------------------------------------------------*18770002
187800*   EXPIRE THE CURRENTLY EFFECTIVE ROW FOR THIS RELATIONSHIP.    *18780002
187900*----------------------------------------------------------------*18790002
188000 7200-EXPIRE-CURRENT-RELATION.                                    18800002
188100                                                                  18810002
188200     PERFORM                                                      18820002
188300         WITH TEST AFTER                                          18830002
188400         VARYING PV-RETRY-COUNTER                                 18840002
188500         FROM 1 BY 1                                              18850002
188600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18860002
188700             OR (SQLCODE = +0))                                   18870002
188800                                                                  18880002
188900         EXEC SQL                                                 18890002
189000              UPDATE VNT_VND_RLTNSHP                              18900002
189100                 SET EFF_END_DTE        = CURRENT DATE            18910002
189200                    ,LAST_UPD_TMST      = CURRENT TIMESTAMP       18920002
189300                    ,LAST_UPD_BY_USR_ID = :DP020-USERID           18930002
189400               WHERE ENT_ID           = :DK-ENT-ID                18940002
189500                 AND VND_RLTNSHP_CDE  = :DK-RLTNSHP-CDE           18950002
189600                 AND RLTD_ENT_ID      = :DK-RLTD-ENT-ID           18960002
189700                 AND EFF_END_DTE      = :PC-MAX-DATE-ISO          18970002
189800         END-EXEC                                                 18980002
189900                                                                  18990002
190000         EVALUATE TRUE                                            19000002
190100             WHEN SQLCODE = +0                                    19010002
190200             WHEN SQLCODE = -904                                  19020002
190300             WHEN SQLCODE = -913                                  19030002
190400                  CONTINUE                                        19040002
190500                                                                  19050002
190600             WHEN SQLWARN0 NOT = SPACES                           19060002
190700             WHEN SQLCODE < +0                                    19070002
190800             WHEN SQLCODE > +0                                    19080002
190900                  MOVE '7200-EXPIRE-CURRENT-RELATION'             19090002
191000                                  TO DP013-PARAGRAPH              19100002
191100                  MOVE 'UNSUCCESSFUL UPDATE FOR VNT_VND_RLTNSHP'  19110002
191200                                  TO DP013-MESSAGE-TEXT (1)       19120002
191300                  MOVE SQLCA      TO DP013-SQLCA                  19130002
191400                  MOVE 'VNT_VND_RLTNSHP'                          19140002
191500                                  TO DP013-DB2-TABLE-NAME (1)     19150002
191600                  SET DP013-DB2-ABEND                             19160002
191700                      DP013-XCTL-DISPLAY-RESTART                  19170002
191800                                  TO TRUE                         19180002
191900                  PERFORM DP013-0000-PROCESS-ABEND                19190002
192000         END-EVALUATE                                             19200002
192100     END-PERFORM.                                                 19210002
192200                                                                  19220002
192300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19230002
192400         MOVE '7200-EXPIRE-CURRENT-RELATION'                      19240002
192500                                  TO DP013-PARAGRAPH              19250002
192600         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE ON VNT_VND_RLTNSHP'19260002
192700                                  TO DP013-MESSAGE-TEXT (1)       19270002
192800         MOVE SQLCA               TO DP013-SQLCA                  19280002
192900         MOVE 'VNT_VND_RLTNSHP'   TO DP013-DB2-TABLE-NAME (1)     19290002
193000         SET DP013-DB2-ABEND                                      19300002
193100             DP013-XCTL-DISPLAY-RESTART                           19310002
193200                                  TO TRUE                         19320002
193300         PERFORM DP013-0000-PROCESS-ABEND                         19330002
193400     END-IF.                                                      19340002
193500                                                                  19350002
193600 8000-CHECK-IN-RMS.                                               19360002
193700                                                                  19370002
193800     PERFORM                                                      19380002
193900         WITH TEST AFTER                                          19390002
194000         VARYING PV-RETRY-COUNTER                                 19400002
194100         FROM 1 BY 1                                              19410002
194200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19420002
194300            OR (SQLCODE = +0))                                    19430002
194400                                                                  19440002
194500         EXEC SQL                                                 19450002
194600             SELECT VND_IN_RMS_IND                                19460002
194700              INTO  :EXTENT-VND-IN-RMS-IND                        19470002
194800              FROM  TEXTENT                                       19480002
194900              WHERE ENT_ID   = :DK-ENT-ID                         19490002
195000         END-EXEC                                                 19500002
195100                                                                  19510002
195200         EVALUATE TRUE                                            19520002
195300             WHEN SQLCODE = +0                                    19530002
195400             WHEN SQLCODE = -904                                  19540002
195500             WHEN SQLCODE = -913                                  19550002
195600                 CONTINUE                                         19560002
195700             WHEN SQLWARN0 NOT = SPACE                            19570002
195800             WHEN SQLCODE < +0                                    19580002
195900             WHEN SQLCODE > +0                                    19590002
196000                 MOVE '8000-CHECK-IN-RMS'                         19600002
196100                                 TO DP013-PARAGRAPH               19610002
196200                 MOVE 'SELECT ON VENDOR DUNS NUMBER'              19620002
196300                                 TO DP013-MESSAGE-TEXT (1)        19630002
196400                 MOVE SQLCA      TO DP013-SQLCA                   19640002
196500                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)      19650002
196600                     SET DP013-DB2-ABEND                          19660002
196700                         DP013-XCTL-DISPLAY-RESTART               19670002
196800                                 TO TRUE                          19680002
196900                 PERFORM DP013-0000-PROCESS-ABEND                 19690002
197000         END-EVALUATE                                             19700002
197100     END-PERFORM.                                                 19710002
197200                                                                  19720002
197300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19730002
197400         MOVE '8000-CHECK-IN-RMS' TO DP013-PARAGRAPH              19740002
197500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TEXTENT'        19750002
197600                                   TO DP013-MESSAGE-TEXT (1)      19760002
197700         MOVE SQLCA                TO DP013-SQLCA                 19770002
197800         SET DP013-DB2-ABEND       TO TRUE                        19780002
197900         PERFORM DP013-0000-PROCESS-ABEND                         19790002
198000     END-IF.                                                      19800002
198100                                                                  19810002
198200 8100-LINK-TO-VNKCS024.                                           19820002
198300                                                                  19830002
198400     INITIALIZE VN007-INTERFACE-MESSAGE-PARMS.                    19840002
198500                                                                  19850002
198600     MOVE ASC-KEY-VENDOR-ID         TO VN007-VND-NBR.             19860002
198700     MOVE ASC-KEY-ENT-ID            TO VN007-ENT-ID.              19870002
198800     MOVE DK-RLTD-ENT-ID            TO PV-ENT-ID.                 19880002
198900     MOVE PV-ENT-ID                 TO VN007-RLTNSHP-ENT-ID(1).   19890002
199000     MOVE ASC-KEY-RLTNSHP-CDE       TO VN007-RLTNSHP-CDE(1).      19900002
199100     IF PS-RLTNSHP-ADD                                            19910002
199200         SET VN007-RLTNSHP-ADD(1)   TO TRUE                       19920002
199300     ELSE                                                         19930002
199400         SET VN007-RLTNSHP-DELETE(1) TO TRUE                      19940002
199500     END-IF.                                                      19950002
199600     EXEC CICS LINK PROGRAM (PC-VNKCS024)                         19960002
199700                   COMMAREA (VN007-COMMAREA)                      19970002
199800                       RESP (PV-CICS-RESP)                        19980002
199900     END-EXEC.                                                    19990002
200000                                                                  20000002
200100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20010002
200200         CONTINUE                                                 20020002
200300     ELSE                                                         20030002
200400        MOVE VN007-PROGRAM-NAME   TO DP013-PROGRAM                20040002
200500        MOVE VN007-PARAGRAPH-NAME TO DP013-PARAGRAPH              20050002
200600        MOVE VN007-MESSAGE        TO DP013-MESSAGE-TEXT (1)       20060002
200700        MOVE VN007-REASON-CODE    TO DP013-SQLCA                  20070002
200800        SET DP013-DB2-ABEND                                       20080002
200900            DP013-ROLLBACK                                        20090002
201000            DP013-XCTL-DISPLAY-RESTART TO TRUE                    20100002
201100        PERFORM DP013-0000-PROCESS-ABEND                          20110002
201200     END-IF.                                                      20120002
201300                                                                  20130002
201400******************************************************************20140002
201500* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *20150002
201600******************************************************************20160002
201700 9100-READ-SEL-QUEUE.                                             20170002
201800                                                                  20180002
201900     EXEC CICS                                                    20190002
202000         READQ TS                                                 20200002
202100             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        20210002
202200             INTO  (VN021-RELATIONSHIP-REC)                       20220002
202300             ITEM  (ASC-SEL-ITEM)                                 20230002
202400             RESP  (PV-CICS-RESP)                                 20240002
202500     END-EXEC.                                                    20250002
202600                                                                  20260002
202700     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        20270002
202800         CONTINUE                                                 20280002
202900     ELSE                                                         20290002
203000         SET DP013-LOGIC-ABEND                                    20300002
203100             DP013-NO-ROLLBACK     TO TRUE                        20310002
203200         MOVE '9100-READ-SEL-QUEUE'                               20320002
203300                                   TO DP013-PARAGRAPH             20330002
203400         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    20340002
203500                                   TO DP013-MESSAGE-TEXT (1)      20350002
203600         PERFORM DP013-0000-PROCESS-ABEND                         20360002
203700     END-IF.                                                      20370002
203800                                                                  20380002
203900******************************************************************20390002
204000* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *20400002
204100******************************************************************20410002
204200 9200-REWRITE-LIST-QUEUE.                                         20420002
204300                                                                  20430002
204400     EXEC CICS                                                    20440002
204500          WRITEQ TS                                               20450002
204600              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     20460002
204700              FROM    (VN021-RELATIONSHIP-REC)                    20470002
204800              ITEM    (ASC-SEL-ITEM)                              20480002
204900              RESP    (PV-CICS-RESP)                              20490002
205000              REWRITE                                             20500002
205100     END-EXEC.                                                    20510002
205200                                                                  20520002
205300     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    20530002
205400         SET DP013-CICS-ABEND                                     20540002
205500             DP013-NO-ROLLBACK     TO TRUE                        20550002
205600         MOVE '9200-REWRITE-LIST-QUEUE'                           20560002
205700                                   TO DP013-PARAGRAPH             20570002
205800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20580002
205900                                   TO DP013-MESSAGE-TEXT (1)      20590002
206000         PERFORM DP013-0000-PROCESS-ABEND                         20600002
206100     END-IF.                                                      20610002
206200                                                                  20620002
206300*---------------------------------------------------------------- 20630002
206400*    ABEND PROCESSOR MODULE                                       20640002
206500*---------------------------------------------------------------- 20650002
206600     COPY DPPD013.                                                20660002
206700*---------------------------------------------------------------- 20670002
