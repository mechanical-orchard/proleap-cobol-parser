000100*************************                                         00010031
000200 IDENTIFICATION DIVISION.                                         00020001
000300*************************                                         00030001
000400 PROGRAM-ID.    SVKUP006.                                         00040001
000500 AUTHOR.        COGNIZANT.                                        00050001
000600 DATE-WRITTEN.  JUNE 2013.                                        00060001
000700***************************************************************   00070001
000800*                                                                 00080001
000900*    5211 - VIRTUAL GIFT CARDS PROJECT                            00090020
001000*                                                                 00100001
001100*    THIS PROGRAM CREATES THE VIRTUAL GIFT CARD EXTRACT FILES,    00110001
MFTCHG*    MFT DOWNLOAD FILE, AND EMBOSSING REPORT FOR VIRTUAL GIFT     00120031
001300*    CARDS AND UPDATES THE CRD_PROD_STAT_CDE TO 'CM' IN           00130028
001400*    SVT_CRD_PROD TABLE ONCE THE CARD REQUEST EXTRACT IS          00140028
001500*    COMPLETED                                                    00150028
001600*                                                                 00160001
001700*    DB2 TABLES ARE READ (SVT_KOHLS_CRD_ACCT, SVT_CRD_PROD)       00170001
001800*    TO EXTRACT THE CONTROL AND CARD NUMBERS, AND OTHER           00180001
001900*    INFORMATION.                                                 00190001
002000*                                                                 00200001
002100*    EACH REQUEST IS EXTRACTED AND A SPECIFIC NUMBER OF RECORDS   00210001
002200*    ARE WRITTEN TO AN EXTRACT FILE.  THE REQUEST NUMBER WILL     00220001
002300*    BE INCLUDED IN THE MEMBER NAME, AND IF THERE ARE MULTIPLE    00230001
002400*    MEMBERS RELATED TO A REQUEST, A SEQUENCE NUMBER WILL BE      00240001
002500*    INCREMENTED WITHIN THE MEMBER NAME TO INDICATE THIS.         00250001
002600*    FOR EXAMPLE, IF 30,000 VIRTUAL GIFT CARDS ARE REQUESTED BY   00260001
002700*    REQUEST 4, AND THE PARAM CARD INDICATES THERE SHOULD BE      00270001
002800*    20,000 RECORDS PER MEMBER THE MEMBER NAMES WILL LOOK AS      00280001
002900*    FOLLOWS:                                                     00290001
003000*           VS000401                                              00300001
003100*           VS000402                                              00310001
003200*                                                                 00320028
003300*    RERUN PROCESS: (ONLY APPLICABLE IF NEED TO RESEND CARD       00330028
003400*    FILES THAT ARE NOT PRESENT IN CURRENT PDS FILE)              00340028
003410*    ** NOTE ONLY B2B VIRTUAL CARDS SENT THROUGH THIS PROCESS     00341030
003420*                                                                 00342030
003500*    1. FIND THE B2B ORDERS THAT NEED TO RESENT                   00350030
003600*    2. SET THE CRD_PROD_STAT_CDE TO 'PV' IN SVT_CRD_PROD TABLE   00360028
003700*    3. RUN THE JOB SVK056 FROM THE TOP                           00370028
003800*                                                                 00380028
      ******************************************************************00381039
      * CHANGE DATE: 05/17/2016                                         00382039
      * CHANGE MADE: RECOMPILE FOR SVWS004 AND SVRD022                  00383039
      * MADE BY    : ACCENTURE                   CHANGE# CHG0141575     00384040
      ******************************************************************00390041
      * CHANGE DATE: 02/28/2023                                         00391041
      * CHANGE MADE: RECMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE       00392041
      * MADE BY    : JEAN KURK                   CHANGE# CHG0282641     00393041
003900******************************************************************00394041
004000 ENVIRONMENT DIVISION.                                            00400001
004100 CONFIGURATION SECTION.                                           00410001
004200 SOURCE-COMPUTER. IBM-3090.                                       00420001
004300 OBJECT-COMPUTER. IBM-3090.                                       00430001
004400                                                                  00440001
004500***************************************************************   00450001
004600 INPUT-OUTPUT SECTION.                                            00460001
004700***************************************************************   00470001
004800                                                                  00480001
004900 FILE-CONTROL.                                                    00490001
005000     SELECT CONTROL-NUM-OF-RECS-FILE                              00500001
005100         ASSIGN TO INP01.                                         00510001
005200                                                                  00520001
005300*  VIRTUAL GIFT CARD PDS                                          00530001
005400     SELECT VRTL-CONTROL-EXTRACT-FILE                             00540001
005500         ASSIGN TO OUT01.                                         00550001
005600                                                                  00560001
MFTCHG*  MFT DOWNLOAD FILE                                              00570031
MFTCHG     SELECT MFT-DOWNLOAD-PARM-FILE                                00580031
005900         ASSIGN TO OUT02.                                         00590001
006000                                                                  00600001
006100     SELECT EMBOSSING-REPORT-FILE                                 00610001
006200         ASSIGN TO RPT01.                                         00620001
006300                                                                  00630001
006400                                                                  00640001
006500***************************************************************   00650001
006600 DATA DIVISION.                                                   00660001
006700***************************************************************   00670001
006800                                                                  00680001
006900 FILE SECTION.                                                    00690001
007000                                                                  00700001
007100 FD  CONTROL-NUM-OF-RECS-FILE                                     00710001
007200     RECORDING MODE IS F                                          00720001
007300     LABEL RECORDS ARE STANDARD                                   00730001
007400     RECORD CONTAINS 80 CHARACTERS                                00740001
007500     DATA RECORD IS CONTROL-NUM-OF-RECORDS.                       00750001
007600                                                                  00760001
007700 01  CONTROL-NUM-OF-RECORDS      PIC X(80).                       00770001
007800                                                                  00780001
007900                                                                  00790001
008000 FD  VRTL-CONTROL-EXTRACT-FILE                                    00800001
008100     RECORDING MODE IS F                                          00810001
008200     LABEL RECORDS ARE STANDARD                                   00820001
008300     RECORD CONTAINS 182 CHARACTERS                               00830001
008400     DATA RECORD IS VRTL-CONTROL-EXTRACT-RECORD.                  00840001
008500                                                                  00850001
008600 01  VRTL-CONTROL-EXTRACT-RECORD      PIC X(182).                 00860001
008700                                                                  00870001
008800                                                                  00880001
MFTCHG FD  MFT-DOWNLOAD-PARM-FILE                                       00890031
009000     RECORDING MODE IS F                                          00900001
009100     LABEL RECORDS ARE STANDARD                                   00910001
009200     RECORD CONTAINS 80 CHARACTERS                                00920001
MFTCHG     DATA RECORD IS MFT-DOWNLOAD-PARM-FILE.                       00930031
009400                                                                  00940001
MFTCHG 01  MFT-DOWNLOAD-PARM-RECORD         PIC X(80).                  00950031
009600                                                                  00960001
009700                                                                  00970001
009800 FD  EMBOSSING-REPORT-FILE                                        00980001
009900     RECORDING MODE IS F                                          00990001
010000     LABEL RECORDS ARE STANDARD                                   01000001
010100     RECORD CONTAINS 132 CHARACTERS                               01010001
010200     DATA RECORD IS EMBOSSING-REPORT-RECORD.                      01020001
010300                                                                  01030001
010400 01  EMBOSSING-REPORT-RECORD          PIC X(132).                 01040001
010500                                                                  01050001
010600                                                                  01060001
010700***************************************************************   01070001
010800 WORKING-STORAGE SECTION.                                         01080001
010900***************************************************************   01090001
011000 01  ABEND-CODE                        PIC S9(4)  VALUE ZERO      01100001
011100                                                  COMP.           01110001
011200     88  ABEND-4002                               VALUE +4002.    01120001
011300     88  ABEND-4008                               VALUE +4008.    01130001
011400     88  ABEND-4013                               VALUE +4013.    01140001
011500     88  ABEND-4018                               VALUE +4018.    01150001
011600                                                                  01160001
011700 01  PV-PROGRAM-VARIABLES.                                        01170001
011800     05  PV-FETCH-COUNT                PIC S9(8)  VALUE ZERO      01180001
011900                                                  COMP-3.         01190001
012000     05  PV-WRITE-COUNT                PIC S9(8)  VALUE ZERO      01200001
012100                                                  COMP-3.         01210001
012200     05  PV-PARAGRAPH-NAME             PIC X(30)  VALUE SPACE.    01220001
012300     05  PV-DB2-OPER-ATTEMPTED         PIC X(30)  VALUE SPACE.    01230001
012400     05  PV-SQL-SUB                    PIC S9(4)  VALUE ZERO      01240001
012500                                                  COMP.           01250001
012600     05  PV-REQUEST-DATE.                                         01260001
012700         10  FILLER                    PIC  9(2)  VALUE ZEROS.    01270001
012800         10  PV-RD-YEAR                PIC  9(2)  VALUE ZEROS.    01280001
012900         10  FILLER                    PIC  X(1)  VALUE SPACES.   01290001
013000         10  PV-RD-MONTH               PIC  9(2)  VALUE ZEROS.    01300001
013100         10  FILLER                    PIC  X(1)  VALUE SPACES.   01310001
013200         10  PV-RD-DAY                 PIC  9(2)  VALUE ZEROS.    01320001
013300                                                                  01330001
013400     05  PV-RQST-NBR-CONVERT           PIC S9(4)  VALUE ZEROS.    01340001
013500     05  PV-RQST-NBR-DISPLAY           PIC 9999-  VALUE ZEROS.    01350001
013600     05  PV-RQST-QTY-DISPLAY           PIC 999999-                01360001
013700                                                  VALUE ZEROS.    01370001
013800                                                                  01380001
013900     05  PV-CONTROL-NUMBER             PIC S9(14)V                01390001
014000                                                  VALUE ZEROS.    01400001
014100     05  PV-CONTROL-NUMBER-BUILD                                  01410001
014200                           REDEFINES PV-CONTROL-NUMBER.           01420001
014300         10  PV-CN-YEAR                PIC  9(4).                 01430001
014400         10  PV-CN-RQST-NBR            PIC  9(4).                 01440001
014500         10  PV-CN-SEQ-NBR             PIC  9(6).                 01450001
014600                                                                  01460001
014700     05  PV-MEM-NAME-SUFFIX-COUNT      PIC  9(02) VALUE ZEROS.    01470001
014800                                                                  01480001
014900     05  PV-CNTL-MEMBER.                                          01490001
015000         10  PV-CNTL-MEM-CRD-TYP       PIC  X(01) VALUE SPACES.   01500001
015100         10  PV-CNTL-MEM-SPECIAL-REQ   PIC  X(01) VALUE SPACES.   01510001
015200         10  PV-CNTL-MEM-RQST-NBR      PIC  X(04) VALUE SPACES.   01520001
015300         10  PV-CNTL-MEM-SEQ           PIC  X(02) VALUE SPACES.   01530001
015400                                                                  01540001
015500     05  PV-DISPLAY-ERROR              PIC  X(45) VALUE SPACES.   01550001
015600                                                                  01560001
015700     05  PV-CONTROL-NUM-OF-RECS.                                  01570001
015800         10  PV-MAX-CONTROL-RECORDS    PIC  9(06) VALUE ZEROS.    01580001
015900         10  PV-ENVIRONMENT            PIC  X(01) VALUE SPACES.   01590001
016000             88  PV-TEST                          VALUE 'T'.      01600001
016100             88  PV-PROD                          VALUE 'P'.      01610001
016200             88  PV-QA                            VALUE 'Q'.      01620001
016300         10  FILLER                    PIC  X(73) VALUE SPACES.   01630001
016400                                                                  01640001
MFTCHG     05  PV-MFT-DOWNLOAD-RECORD.                                  01650031
MFTCHG         10  FILLER                    PIC  X(11)                 01660031
MFTCHG                                       VALUE ' SET %LF = '.       01660132
MFTCHG         10  PV-MFT-FILE-NAME          PIC  X(31) VALUE SPACES.   01670031
MFTCHG         10  PV-MFT-REQUEST-MEMBER     PIC  X(08) VALUE SPACES.   01680031
MFTCHG         10  FILLER                    PIC  X(03) VALUE ')" '.    01690037
MFTCHG         10  FILLER                    PIC  X(27) VALUE SPACES.   01720031
MFTCHG     05  PV-MFT-DOWNLOAD-RECORD1.                                 01721031
MFTCHG         10  FILLER                    PIC  X(19)                 01722038
MFTCHG                         VALUE ' SET %RF = %DIR2 + '.             01722138
MFTCHG         10  PV-MFT-TRANSFER-MEMBER    PIC  X(08) VALUE SPACES.   01727031
MFTCHG         10  FILLER                    PIC  X(04) VALUE '.TXT'.   01729031
MFTCHG         10  FILLER                    PIC  X(49) VALUE SPACES.   01729138
MFTCHG     05  PV-MFT-DOWNLOAD-RECORD2.                                 01729331
MFTCHG         10  FILLER                    PIC  X(11)                 01729431
MFTCHG                         VALUE ' QUOTE OFF '.                     01729532
MFTCHG         10  FILLER                    PIC  X(69) VALUE SPACES.   01729731
MFTCHG     05  PV-MFT-DOWNLOAD-RECORD3.                                 01729831
MFTCHG         10  FILLER                    PIC  X(15)                 01729931
MFTCHG                         VALUE ' CALL SENDTEXT '.                 01730032
MFTCHG         10  FILLER                    PIC  X(65) VALUE SPACES.   01730131
MFTCHG     05  PV-MFT-DOWNLOAD-RECORD4.                                 01730236
MFTCHG         10  FILLER                    PIC  X(01) VALUE '*'.      01730336
MFTCHG                                                                  01730436
MFTCHG         10  FILLER                    PIC  X(79) VALUE SPACES.   01730536
017300                                                                  01731031
017400     05  PV-NUMBER-REQUESTED-ACCUM     PIC  9(06) VALUE ZEROS.    01740001
017500     05  PV-PAGE-COUNTER               PIC S9(11) VALUE ZEROS     01750001
017600                                                  COMP-3.         01760001
017700     05  PV-LINE-COUNTER               PIC S9(11) VALUE ZEROS     01770001
017800                                                  COMP-3.         01780001
017900     05  PV-CURRENT-DATE.                                         01790001
018000         10  PV-CURRENT-YEAR           PIC  9(02) VALUE ZERO.     01800001
018100         10  PV-CURRENT-MONTH          PIC  9(02) VALUE ZERO.     01810001
018200         10  PV-CURRENT-DAY            PIC  9(02) VALUE ZERO.     01820001
018300     05  PV-CURRENT-TIME.                                         01830001
018400         10  PV-CURRENT-HOUR           PIC  9(02) VALUE ZERO.     01840001
018500         10  PV-CURRENT-MINUTE         PIC  9(02) VALUE ZERO.     01850001
018600         10  FILLER                    PIC  9(04) VALUE ZERO.     01860001
018700                                                                  01870001
018800     05  PV-PRE-DNNTD-CRD-AMT             PIC  9(7)V99.           01880001
018900     05  PV-PRE-DNNTD-CRD-AMT-BUILD                               01890001
019000                              REDEFINES PV-PRE-DNNTD-CRD-AMT.     01900001
019100         10  FILLER                        PIC  9(03).            01910001
019200         10  PV-PRE-DNNTD-DOLLARS          PIC  9(04).            01920001
019300         10  PV-PRE-DNNTD-CENTS            PIC  V99.              01930001
019400     05  PV-PRE-DNNTD-AMT-SAFEWAY-R                               01940001
019500                              REDEFINES PV-PRE-DNNTD-CRD-AMT.     01950001
019600         10  FILLER                        PIC  9(04).            01960001
019700         10  PV-PRE-DNNTD-AMT-SAFEWAY      PIC  9(05).            01970001
019800     05  PV-BIN-NBR.                                              01980001
019900         10  PV-BIN-1-4                    PIC  9(04).            01990001
020000         10  PV-BIN-5-6                    PIC  9(02).            02000001
020100     05  PV-CRD-STK-TYP                    PIC  9(01).            02010001
020200     05  PV-CARD-NBR-DECIMAL               PIC  X(13).            02020001
020300     05  PV-CARD-NBR REDEFINES PV-CARD-NBR-DECIMAL.               02030001
020400         10  PV-CARD-NBR-1-2               PIC  9(02).            02040001
020500         10  PV-CARD-NBR-3-7               PIC  9(05).            02050001
020600         10  PV-CARD-NBR-8-12              PIC  9(05).            02060001
020700         10  FILLER                        PIC  9(01).            02070001
020800     05  PV-CARD-NBR-VENDOR REDEFINES PV-CARD-NBR-DECIMAL.        02080001
020900         10  PV-CARD-NBR-VENDOR-1-12       PIC  9(12).            02090001
021000         10  FILLER                        PIC  9(01).            02100001
021100     05  PV-GIFT-CARD-NBR-SPACED.                                 02110001
021200         10  PV-GIFT-CARD-NBR-1-4          PIC  9(04).            02120001
021300         10  FILLER                        PIC  X(01) VALUE SPACE.02130001
021400         10  PV-GIFT-CARD-NBR-5-9.                                02140001
021500             15  PV-GIFT-CARD-NBR-5-6      PIC  9(02).            02150001
021600             15  PV-GIFT-CARD-NBR-7        PIC  9(01).            02160001
021700             15  PV-GIFT-CARD-NBR-8-9      PIC  9(02).            02170001
021800         10  FILLER                        PIC  X(01) VALUE SPACE.02180001
021900         10  PV-GIFT-CARD-NBR-10-14        PIC  9(05).            02190001
022000         10  FILLER                        PIC  X(01) VALUE SPACE.02200001
022100         10  PV-GIFT-CARD-NBR-15-19        PIC  9(05).            02210001
022200     05  PV-UPC-NBR-DECIMAL                PIC  X(16).            02220001
022300     05  PV-UPC-NBR REDEFINES PV-UPC-NBR-DECIMAL.                 02230001
022400         10  FILLER                        PIC  9(04).            02240001
022500         10  PV-UPC-NBR-11                 PIC  9(11).            02250001
022600         10  FILLER                        PIC  9(01).            02260001
022700     05  PV-CARD-TYPE                      PIC  X(04).            02270001
022800     05  PV-CARD-TYPE-CDE REDEFINES PV-CARD-TYPE.                 02280001
022900         10  PV-CRD-TYP-CDE                PIC  9(01).            02290001
023000         10  FILLER                        PIC  9(03).            02300001
023100                                                                  02310001
023200     05  PV-CRD-STK-TYP-ID                 PIC  X(08).            02320001
023300     05  PV-CRD-STK-TYP-SPLIT REDEFINES PV-CRD-STK-TYP-ID.        02330001
023400         10  PV-CRD-STK-ID-3CHAR           PIC  X(03).            02340001
023500             88 PV-CARD-STOCK-SAFEWAY      VALUE 'SAF', 'SWH'.    02350001
023600         10  FILLER                        PIC  X(05).            02360001
023700                                                                  02370001
023800 01  PROGRAM-CONSTANTS-AREA.                                      02380001
023900     05  PC-PROGRAM-NAME               PIC X(08) VALUE 'SVKUP006'.02390001
MFTCHG     05  PC-MFT-DOWNLOAD-FILE-NAMES.                              02400031
MFTCHG         10  PC-MFT-DL-PROD-GIFT-FILE  PIC  X(31) VALUE           02410031
MFTCHG                              '"PKMO.SV.VGC.GIFT.REQUEST.FILE('.  02420038
MFTCHG         10  PC-MFT-DL-TEST-GIFT-FILE  PIC  X(31) VALUE           02430035
MFTCHG                              '"TKMA.SV.VGC.GIFT.REQUEST.FILE('.  02440037
024500     05  PC-DA-DSNAMES.                                           02450001
024600         10  PC-DA-PROD-GIFT-DSNAME    PIC  X(44) VALUE           02460001
024700         'PKMO.SV.VGC.GIFT.REQUEST.FILE'.                         02470005
024800         10  PC-DA-TEST-GIFT-DSNAME    PIC  X(44) VALUE           02480035
024900         'TKMA.SV.VGC.GIFT.REQUEST.FILE'.                         02490035
025000                                                                  02500001
025100     05  PC-VRTL-CONTROL-DDNAME    PIC X(8)   VALUE 'OUT01'.      02510004
025200     05  PC-NINES                  PIC  9(6)  VALUE 999999.       02520001
025300     05  PC-MAX-RETRIES            PIC S9     VALUE +3            02530001
025400                                              COMP-3.             02540001
025500     05  PC-ONE                    PIC  9(01) VALUE 1.            02550001
025600     05  PC-THREE                  PIC  9(01) VALUE 3.            02560001
025700     05  PC-HEADER-LINE-COUNT      PIC S9(03) VALUE +5            02570001
025800                                              COMP.               02580001
025900     05  PC-MAX-LINES-PER-PAGE     PIC S9(03) VALUE +60           02590001
026000                                              COMP.               02600001
026100                                                                  02610001
026200 01  PROGRAM-SWITCHES.                                            02620001
026300     05  PS-REQUESTS-SW            PIC X      VALUE 'Y'.          02630001
026400         88  PS-MORE-REQUESTS                 VALUE 'Y'.          02640001
026500         88  PS-NO-MORE-REQUESTS              VALUE 'N'.          02650001
026600                                                                  02660001
026700     05  PS-CONTROL-SW             PIC X      VALUE 'Y'.          02670018
026800         88  PS-MORE-CONTROL-ROWS             VALUE 'Y'.          02680001
026900         88  PS-NO-MORE-CONTROL-ROWS          VALUE 'N'.          02690001
027000                                                                  02700001
027100     05  PS-FIRST-TIME-THRU-SW     PIC X      VALUE 'Y'.          02710001
027200         88  PS-FIRST-TIME-THRU               VALUE 'Y'.          02720001
027300         88  PS-NOT-FIRST-TIME-THRU           VALUE 'N'.          02730001
027400                                                                  02740001
027500*                                                                 02750001
027600*  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              02760001
027700*                                                                 02770001
027800     COPY DPWS023.                                                02780001
027900                                                                  02790001
028000*-----------------------------------------------------------      02800001
028100*   STORED VALUE WORKING STORAGE CONSTANTS.                       02810001
028200*-----------------------------------------------------------      02820001
028300     COPY SVWS004.                                                02830006
028400                                                                  02840001
028500*-----------------------------------------------------------      02850001
028600*   GIFT CARD EXTRACT RECORD LAYOUT FOR VENDORS                   02860001
028700*-----------------------------------------------------------      02870001
028800     COPY SVRD050.                                                02880001
028900                                                                  02890001
029500*-----------------------------------------------------------      02950001
029600*   STANDARD-HEADER FOR 132 COLUMN REPORT                         02960001
029700*-----------------------------------------------------------      02970001
029800     COPY DPWS132O.                                               02980001
029900                                                                  02990001
030000 01  REPORT-EMBOSSING-TITLE-LINE.                                 03000001
030100     05  FILLER                      PIC  X(50)   VALUE SPACES.   03010001
030200     05  TL-HEADING                  PIC  X(24)   VALUE           03020001
030300         'EMBOSSING REQUESTS FROM '.                              03030001
030400     05  TL-MM                       PIC  X(02)   VALUE SPACES.   03040001
030500     05  TL-DASH                     PIC  X(01)   VALUE '/'.      03050001
030600     05  TL-DD                       PIC  X(02)   VALUE SPACES.   03060001
030700     05  TL-DASH                     PIC  X(01)   VALUE '/'.      03070001
030800     05  TL-YY                       PIC  X(02)   VALUE SPACES.   03080001
030900     05  FILLER                      PIC  X(50)   VALUE SPACES.   03090001
031000 01  REPORT-EMBOSSING-HEADING-1.                                  03100001
031100     05  FILLER                      PIC  X(06)   VALUE SPACES.   03110001
031200     05  FILLER                      PIC  X(06)   VALUE 'MEMBER'. 03120001
031300     05  FILLER                      PIC  X(08)   VALUE SPACES.   03130001
031400     05  FILLER                      PIC  X(04)   VALUE 'CARD'.   03140001
031500     05  FILLER                      PIC  X(15)   VALUE SPACES.   03150001
031600     05  FILLER                      PIC  X(15)   VALUE           03160001
031700                                     'CONTROL NUMBERS'.           03170001
031800     05  FILLER                      PIC  X(12)   VALUE SPACES.   03180001
031900     05  FILLER                      PIC  X(06)   VALUE 'NUMBER'. 03190001
032000     05  FILLER                      PIC  X(20)   VALUE SPACES.   03200001
032100     05  FILLER                      PIC  X(40)   VALUE SPACES.   03210001
032200 01  REPORT-EMBOSSING-HEADING-2.                                  03220001
032300     05  FILLER                      PIC  X(07)   VALUE SPACES.   03230001
032400     05  FILLER                      PIC  X(04)   VALUE 'NAME'.   03240001
032500     05  FILLER                      PIC  X(09)   VALUE SPACES.   03250001
032600     05  FILLER                      PIC  X(04)   VALUE 'TYPE'.   03260001
032700     05  FILLER                      PIC  X(10)   VALUE SPACES.   03270001
032800     05  FILLER                      PIC  X(08)   VALUE           03280001
032900                                     'STARTING'.                  03290001
033000     05  FILLER                      PIC  X(11)   VALUE SPACES.   03300001
033100     05  FILLER                      PIC  X(06)   VALUE 'ENDING'. 03310001
033200     05  FILLER                      PIC  X(06)   VALUE SPACES.   03320001
033300     05  FILLER                      PIC  X(09)   VALUE           03330001
033400                                                  'REQUESTED'.    03340001
033500     05  FILLER                      PIC  X(01)   VALUE SPACES.   03350001
033600     05  FILLER                      PIC  X(12)   VALUE           03360001
033700                                                  'DENOMINATION'. 03370001
033800     05  FILLER                      PIC  X(02)   VALUE SPACES.   03380001
033900     05  FILLER                      PIC  X(15)   VALUE           03390001
034000                                     'CARD STOCK TYPE'.           03400001
034100     05  FILLER                      PIC  X(17)   VALUE SPACES.   03410001
034200     05  FILLER                      PIC  X(08)   VALUE           03420001
034300                                                  'PRODUCER'.     03430001
034400 01  REPORT-EMBOSSING-DETAIL-LINE.                                03440001
034500     05  FILLER                      PIC  X(03)   VALUE SPACES.   03450001
034600     05  DL-MEMBER-NAME              PIC  X(08)   VALUE SPACES.   03460001
034700     05  FILLER                      PIC  X(04)   VALUE '.TXT'.   03470001
034800     05  FILLER                      PIC  X(03)   VALUE SPACES.   03480001
034900     05  DL-CARD-TYPE                PIC  X(09)   VALUE SPACES.   03490001
035000     05  FILLER                      PIC  X(03)   VALUE SPACES.   03500001
035100     05  DL-STARTING-CONTROL-NBR     PIC  X(14)   VALUE SPACES.   03510001
035200     05  FILLER                      PIC  X(06)   VALUE ' THRU '. 03520001
035300     05  DL-ENDING-CONTROL-NBR       PIC  X(14)   VALUE SPACES.   03530001
035400     05  FILLER                      PIC  X(02)   VALUE SPACES.   03540001
035500     05  DL-NUMBER-REQUESTED         PIC  ZZZ,ZZZ VALUE ZEROS.    03550001
035600     05  FILLER                      PIC  X(04)   VALUE SPACES.   03560001
035700     05  DL-DENOMINATION             PIC  Z,ZZZ.99                03570001
035800                                                  VALUE ZEROS.    03580001
035900     05  FILLER                      PIC  X(02)   VALUE SPACES.   03590001
036000     05  DL-CARD-STOCK-TYPE          PIC  X(08)   VALUE SPACES.   03600001
036100     05  FILLER                      PIC  X(02)   VALUE SPACES.   03610001
036200     05  DL-CARD-STOCK-TYPE-DESC     PIC  X(25)   VALUE SPACES.   03620001
036300     05  FILLER                      PIC  X(02)   VALUE SPACES.   03630001
036400     05  DL-PRODUCER                 PIC  X(06)   VALUE SPACES.   03640001
036500     05  FILLER                      PIC  X(01)   VALUE SPACES.   03650001
036600 01  REPORT-EMBOSSING-SUBTOTAL-LINE.                              03660001
036700     05  FILLER                      PIC  X(66)   VALUE SPACES.   03670001
036800     05  FILLER                      PIC  X(7)    VALUE '-------'.03680001
036900     05  FILLER                      PIC  X(59)   VALUE SPACES.   03690001
037000 01  REPORT-EMBOSSING-TOTAL-LINE.                                 03700001
037100     05  FILLER                      PIC  X(66)   VALUE SPACES.   03710001
037200     05  TL-TOTAL-REQUESTED          PIC  ZZZ,ZZZ VALUE ZEROS.    03720001
037300     05  FILLER                      PIC  X(59)   VALUE SPACES.   03730001
037400 01  REPORT-EMBOSSING-EMPTY-LINE     PIC  X(132)  VALUE SPACES.   03740001
037500 01  REPORT-EMBOSSING-NO-REQ.                                     03750007
037600     05  FILLER                      PIC  X(45)   VALUE SPACES.   03760007
037700     05  TL-NO-DATA                  PIC  X(45)   VALUE           03770007
037800         'NO VIRTUAL GIFT CARD FILE REQUEST TO PROCESS '.         03780007
037900     05  FILLER                      PIC  X(42)   VALUE SPACES.   03790007
038000                                                                  03800001
038100*-----------------------------------------------------------      03810001
038200*    STORED VALUE CARD TABLE                                      03820001
038300*-----------------------------------------------------------      03830001
038400     EXEC SQL                                                     03840001
038500         INCLUDE SVT00001                                         03850001
038600     END-EXEC.                                                    03860001
038700*-----------------------------------------------------------      03870001
038800*    STORED VALUE CONTROL TABLE                                   03880001
038900*-----------------------------------------------------------      03890001
039000     EXEC SQL                                                     03900001
039100         INCLUDE SVT00000                                         03910001
039200     END-EXEC.                                                    03920001
039300*-----------------------------------------------------------      03930001
039400*    STORED VALUE DENOMINATED TABLE                               03940001
039500*-----------------------------------------------------------      03950001
039600     EXEC SQL                                                     03960001
039700         INCLUDE SVT00008                                         03970001
039800     END-EXEC.                                                    03980001
039900*-----------------------------------------------------------      03990001
040000*    SQL COMMUNICATIONS AREA DCLGEN                               04000001
040100*-----------------------------------------------------------      04010001
040200     EXEC SQL                                                     04020001
040300         INCLUDE SQLCA                                            04030001
040400     END-EXEC.                                                    04040001
040500*-----------------------------------------------------------      04050001
040600*    ERROR MESSAGE AREA FOR DB2                                   04060001
040700*-----------------------------------------------------------      04070001
040800     COPY DPWS004.                                                04080001
040900*-----------------------------------------------------------      04090001
041000*    CURSOR DECLARATION FOR STORED VALUE CONTROL TABLE.           04100001
041100*-----------------------------------------------------------      04110001
041200     EXEC SQL                                                     04120001
041300         DECLARE VRTL-CONTROL CURSOR                              04130001
041400             FOR SELECT                                           04140001
041500                       CRD_PROD_YR                                04150001
041600                      ,SHIPT_REQ_NBR                              04160001
041700                      ,CNTL_NBR                                   04170001
041800                      ,CRD_NBR                                    04180001
041900                      ,CRD_SPCTY_TYP_CDE                          04190001
042000         FROM SVT_KOHLS_CRD_ACCT                                  04200001
042100         WHERE   CRD_PROD_YR = :SVT00000-CRD-PROD-YR              04210001
042200           AND   SHIPT_REQ_NBR = :SVT00000-SHIPT-REQ-NBR          04220001
042300          WITH UR                                                 04230001
042400     END-EXEC.                                                    04240001
042500*-----------------------------------------------------------      04250001
042600*    CURSOR DECLARATION FOR STORED VALUE CONTROL TABLE            04260001
042700*-----------------------------------------------------------      04270001
042800     EXEC SQL                                                     04280001
042900         DECLARE VRTL-REQUEST CURSOR                              04290001
043000             FOR SELECT                                           04300001
043100                       CRD_PROD_YR                                04310001
043200                     , SHIPT_REQ_NBR                              04320001
043300                     , CRD_REQ_QTY                                04330001
043400                     , CRD_REQD_DTE                               04340001
043500                     , A.CRD_TYP_CDE                              04350001
043600                     , A.PRE_DNNTD_CRD_AMT                        04360001
043700                     , A.CRD_STK_TYP_ID                           04370001
043800                     , CRD_STK_TYP_DESC                           04380001
043900                     , CRD_PRDR_CDE                               04390001
044000                     , B.UPC_NBR                                  04400001
044100         FROM SVT_CRD_PROD      A                                 04410001
044200            , SVT_CRD_STK_DNMNTN B                                04420001
044300         WHERE A.CRD_TYP_CDE = B.CRD_TYP_CDE                      04430001
044400           AND A.CRD_STK_TYP_ID = B.CRD_STK_TYP_ID                04440001
044500           AND A.PRE_DNNTD_CRD_AMT = B.PRE_DNNTD_CRD_AMT          04450001
044600           AND CRD_PROD_STAT_CDE = 'PV'                           04460001
044700           AND A.CRD_PRDR_CDE = 'V'                               04470001
044800         ORDER BY CRD_PROD_YR                                     04480001
044900                 ,SHIPT_REQ_NBR                                   04490001
045000         WITH UR                                                  04500001
045100     END-EXEC.                                                    04510001
045200 EJECT                                                            04520001
045300***************************************************************   04530001
045400 PROCEDURE DIVISION.                                              04540001
045500***************************************************************   04550001
045600 0000-MAINLINE.                                                   04560001
045700                                                                  04570001
045800     PERFORM 1000-INITIALIZE.                                     04580001
045900                                                                  04590001
046000     PERFORM 2000-FETCH-AND-WRITE                                 04600001
046100         UNTIL PS-NO-MORE-REQUESTS.                               04610001
046200                                                                  04620001
046300     PERFORM 9000-CLOSE-FILE-AND-CURSOR.                          04630001
046400                                                                  04640001
046500     STOP RUN.                                                    04650001
046600                                                                  04660001
046700****************************************************************  04670001
046800*                                                              *  04680001
046900*  OPEN FILE FOR OUTPUT PROCESSING.                            *  04690001
047000*  OPEN REQUEST CURSOR AND READ THE FIRST REQUEST ROW.         *  04700001
047100*                                                              *  04710001
047200****************************************************************  04720001
047300 1000-INITIALIZE.                                                 04730001
047400                                                                  04740001
047500     OPEN INPUT  CONTROL-NUM-OF-RECS-FILE                         04750001
MFTCHG          OUTPUT MFT-DOWNLOAD-PARM-FILE                           04760031
047700                 EMBOSSING-REPORT-FILE.                           04770001
047800                                                                  04780001
047900     PERFORM 1100-READ-CONTROL-REC-FILE.                          04790001
048000     CLOSE  CONTROL-NUM-OF-RECS-FILE.                             04800001
048100                                                                  04810001
048200                                                                  04820001
048300****************************************************************  04830001
048400*             INITIALIZE REQUEST MEMBER NAME SUFFIX COUNT         04840001
048500****************************************************************  04850001
048600     MOVE ZERO             TO  PV-MEM-NAME-SUFFIX-COUNT.          04860001
048700     MOVE ZERO             TO  PV-WRITE-COUNT.                    04870001
048800                                                                  04880001
048900     ACCEPT PV-CURRENT-DATE   FROM DATE                           04890007
049000     MOVE PV-CURRENT-YEAR      TO DP132O-RUN-YEAR                 04900007
049100     MOVE PV-CURRENT-MONTH     TO DP132O-RUN-MONTH                04910007
049200     MOVE PV-CURRENT-DAY       TO DP132O-RUN-DAY                  04920007
049300     ACCEPT PV-CURRENT-TIME   FROM TIME                           04930007
049400     MOVE PV-CURRENT-HOUR      TO DP132O-RUN-HOUR                 04940007
049500     MOVE PV-CURRENT-MINUTE    TO DP132O-RUN-MINUTE               04950007
049600     MOVE PC-PROGRAM-NAME      TO DP132O-PROGRAM-NAME             04960007
049700     MOVE PC-ONE               TO DP132O-REPORT-NUMBER            04970007
049800                                                                  04980007
049900     PERFORM                                                      04990001
050000         WITH TEST AFTER                                          05000001
050100         VARYING PV-SQL-SUB                                       05010001
050200         FROM 1 BY 1                                              05020001
050300         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       05030001
050400                   OR SQLCODE = 0                                 05040001
050500                   OR SQLCODE = +100)                             05050001
050600         EXEC SQL                                                 05060001
050700             OPEN VRTL-REQUEST                                    05070001
050800         END-EXEC                                                 05080001
050900         EVALUATE TRUE                                            05090001
051000             WHEN SQLCODE = -904                                  05100001
051100             WHEN SQLCODE = -911                                  05110001
051200             WHEN SQLCODE = +100                                  05120001
051300             WHEN SQLCODE = 0                                     05130001
051400                 CONTINUE                                         05140001
051500             WHEN SQLWARN NOT = SPACES                            05150001
051600             WHEN SQLCODE NOT = ZERO                              05160001
051700                 MOVE '1000-INITIALIZE'                           05170001
051800                               TO  PV-PARAGRAPH-NAME              05180001
051900                 MOVE 'OPEN THE VRTL REQUEST CURSOR'              05190001
052000                               TO  PV-DB2-OPER-ATTEMPTED          05200001
052100                 PERFORM 9900-SQL-ABEND                           05210001
052200         END-EVALUATE                                             05220001
052300     END-PERFORM.                                                 05230001
052400                                                                  05240001
052500     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        05250001
052600         MOVE '1000-INITIALIZE'                                   05260001
052700                               TO  PV-PARAGRAPH-NAME              05270001
052800         MOVE 'OPEN RETRIES EXCEEDED'                             05280001
052900                               TO  PV-DB2-OPER-ATTEMPTED          05290001
053000         PERFORM 9900-SQL-ABEND                                   05300001
053100     END-IF.                                                      05310001
053200                                                                  05320001
053300     PERFORM 2100-FETCH-REQUEST-ROW.                              05330001
053400                                                                  05340001
053500     IF PS-NO-MORE-REQUESTS                                       05350001
053600        MOVE PV-CURRENT-MONTH     TO  TL-MM                       05360008
053700        MOVE PV-CURRENT-DAY       TO  TL-DD                       05370008
053800        MOVE PV-CURRENT-YEAR      TO  TL-YY                       05380008
053900        PERFORM 5000-PROCESS-PAGE-BREAK                           05390008
054000        PERFORM 5100-WRITE-NO-RQST                                05400012
054100     ELSE                                                         05410001
054200        MOVE SVT00000-CRD-REQD-DTE TO PV-REQUEST-DATE             05420001
054300        MOVE SVT00000-SHIPT-REQ-NBR TO PV-RQST-NBR-CONVERT        05430001
054400                                                                  05440001
054500        MOVE PV-RD-MONTH          TO  TL-MM                       05450001
054600        MOVE PV-RD-DAY            TO  TL-DD                       05460001
054700        MOVE PV-RD-YEAR           TO  TL-YY                       05470001
054800                                                                  05480001
054900        PERFORM 5000-PROCESS-PAGE-BREAK                           05490001
055000                                                                  05500001
055100        PERFORM 3000-ALLOCATE-AND-OPEN-RQST                       05510001
055200     END-IF.                                                      05520001
055300******************************************************************05530001
055400*                                                                *05540001
055500*    THIS CONTROL CARD FILE CONTAINS THE MAXIMUM NUMBER OF       *05550001
055600*    RECORDS THAT ARE TO BE WRITTEN TO EACH VRTL CARD REQUEST    *05560001
055700*    PDS MEMBER.                                                 *05570001
055800*                                                                *05580001
055900******************************************************************05590001
056000 1100-READ-CONTROL-REC-FILE.                                      05600001
056100     READ CONTROL-NUM-OF-RECS-FILE                                05610001
056200             INTO PV-CONTROL-NUM-OF-RECS                          05620001
056300       AT END                                                     05630023
056400        DISPLAY '******************************************'      05640023
056500        DISPLAY '* PROGRAM:  SVKUP006                     *'      05650023
056600        DISPLAY '******************************************'      05660023
056700        DISPLAY '* CONTROL CARD MISSING, FORMAT           *'      05670023
056800        DISPLAY '* SHOULD BE 020000P                      *'      05680023
056900        DISPLAY '******************************************'      05690023
057000        PERFORM 9999-ABEND                                        05700023
057100     END-READ.                                                    05710001
057200     IF PV-MAX-CONTROL-RECORDS = SPACES OR                        05720023
057300        PV-MAX-CONTROL-RECORDS = ZEROES OR                        05730023
057400        PV-ENVIRONMENT = ZERO OR                                  05740023
057500        PV-ENVIRONMENT = SPACE                                    05750023
057600        DISPLAY '******************************************'      05760023
057700        DISPLAY '* PROGRAM:  SVKUP006                     *'      05770023
057800        DISPLAY '******************************************'      05780023
057900        DISPLAY '* CONTROL CARD MISSING OR ZERO, FORMAT   *'      05790023
058000        DISPLAY '* SHOULD BE 020000P                      *'      05800023
058100        DISPLAY '******************************************'      05810023
058200        PERFORM 9999-ABEND                                        05820023
058300     END-IF.                                                      05830023
058400                                                                  05840001
058500****************************************************************  05850001
058600*                                                              *  05860001
058700*    THIS PARAGRAPH TAKES THE REQUEST NUMBER, DATE, AND        *  05870001
058800*    QUANTITY FROM THE REQUEST FETCH AND USES THAT INFORMATION *  05880001
058900*    AS SELECTION CRITERIA WHEN OPENING THE CONTROL CURSOR.    *  05890001
059000*    IF THE CONTROL CURSOR IS SUCCESSFULLY OPENED, EACH ROW    *  05900001
059100*    IS READ AND THE CONTROL AND CARD NUMBERS ARE WRITTEN TO   *  05910001
059200*    A PDS MEMBER.  THE MAXIMUM RECORD COUNT READ FROM THE     *  05920001
059300*    CONTROL-NUM-OF-RECS-FILE SETS HOW MANY CARD RECORDS ARE   *  05930001
059400*    WRITTEN TO EACH PDS.  WHEN THE MAXIMUM IS REACHED THEN    *  05940001
059500*    THAT PDS MEMBER IS CLOSED, AND A NEW PDS MEMBER IS        *  05950001
059600*    ALLOCATED AND OPENED.                                     *  05960001
059700*                                                              *  05970001
059800****************************************************************  05980001
059900 2000-FETCH-AND-WRITE.                                            05990001
060000                                                                  06000001
060100     MOVE SVT00000-CRD-REQ-QTY   TO  PV-RQST-QTY-DISPLAY.         06010001
060200     MOVE SVT00000-SHIPT-REQ-NBR TO  PV-RQST-NBR-DISPLAY.         06020001
060300                                                                  06030001
060400     PERFORM 2200-OPEN-CONTROL-CURSOR.                            06040001
060500     SET PS-FIRST-TIME-THRU     TO TRUE.                          06050001
060600                                                                  06060001
060700     PERFORM                                                      06070001
060800     UNTIL PS-NO-MORE-CONTROL-ROWS                                06080001
060900                                                                  06090001
061000         PERFORM 2300-FETCH-CONTROL-ROW                           06100001
061100         IF  PS-MORE-CONTROL-ROWS                                 06110001
061200             ADD 1                 TO  PV-FETCH-COUNT             06120001
061300             MOVE SVT00001-CRD-PROD-YR   TO PV-CN-YEAR            06130001
061400             MOVE SVT00001-SHIPT-REQ-NBR TO PV-CN-RQST-NBR        06140001
061500             MOVE SVT00001-CNTL-NBR      TO PV-CN-SEQ-NBR         06150001
061600             PERFORM 2400-FORMAT-VENDOR-GIFT-CARD                 06160011
061700         END-IF                                                   06170001
061800     END-PERFORM.                                                 06180001
061900                                                                  06190001
062000     PERFORM 2600-CLOSE-CONTROL-CURSOR.                           06200011
062100     PERFORM 5200-WRITE-DETAIL-LINE.                              06210011
062200     PERFORM 5300-WRITE-TOTAL.                                    06220011
062300                                                                  06230001
062400     IF  PV-FETCH-COUNT NOT EQUAL SVT00000-CRD-REQ-QTY            06240001
062500                                                                  06250001
062600         DISPLAY ' * * * * * * * * * * * * * * * * * * * * *'     06260001
062700         DISPLAY ' *                                       *'     06270001
062800         DISPLAY ' * THE NUMBER OF CONTROL ROWS RETRIEVED  *'     06280001
062900         DISPLAY ' * DID NOT MATCH THE NUMBER REQUESTED.   *'     06290001
063000         DISPLAY ' *                                       *'     06300001
063100         DISPLAY ' *   REQUEST NBR: ' PV-RQST-NBR-DISPLAY         06310001
063200                                        '                  *'     06320001
063300         DISPLAY ' *   REQUEST QTY: ' PV-RQST-QTY-DISPLAY         06330001
063400                                          '                *'     06340001
063500         DISPLAY ' *  SELECT COUNT: ' PV-FETCH-COUNT              06350001
063600                                           '               *'     06360001
063700         DISPLAY ' *                                       *'     06370001
063800         DISPLAY ' * * * * * * * * * * * * * * * * * * * * *'     06380001
063900     END-IF.                                                      06390001
064000                                                                  06400001
064100     MOVE  ZEROS                TO  PV-FETCH-COUNT.               06410001
064200     MOVE  ZEROS                TO  PV-MEM-NAME-SUFFIX-COUNT.     06420001
064300                                                                  06430001
064400     PERFORM 3100-CLOSE-REQUEST-FILE.                             06440001
MFTCHG     PERFORM 3200-WRITE-MFT-PARM-RECORD.                          06450031
064600     PERFORM 3300-UPDATE-STAT-CDE.                                06460038
064700                                                                  06470001
064800     PERFORM 2100-FETCH-REQUEST-ROW.                              06480001
064900                                                                  06490001
065000     IF PS-MORE-REQUESTS                                          06500001
065100         MOVE SVT00000-CRD-REQD-DTE                               06510001
065200                                TO  PV-REQUEST-DATE               06520001
065300         MOVE SVT00000-SHIPT-REQ-NBR                              06530001
065400                                TO  PV-RQST-NBR-CONVERT           06540001
065500         MOVE ZEROS             TO  PV-WRITE-COUNT                06550001
065600         PERFORM 3000-ALLOCATE-AND-OPEN-RQST                      06560001
065700     END-IF.                                                      06570001
065800                                                                  06580001
065900****************************************************************  06590001
066000*                                                              *  06600001
066100*    RETRIEVE A ROW FROM THE REQUEST TABLE.                    *  06610001
066200*    THIS DATA IS USED AS THE SELECTION CRITERIA FOR           *  06620001
066300*    RETRIEVING VRTL CONTROL DATA.                             *  06630001
066400*                                                              *  06640001
066500****************************************************************  06650001
066600 2100-FETCH-REQUEST-ROW.                                          06660001
066700                                                                  06670001
066800*    DISPLAY '2100-FETCH-REQUEST-ROW  TOP'.                       06680001
066900     PERFORM                                                      06690001
067000         WITH TEST AFTER                                          06700001
067100         VARYING PV-SQL-SUB                                       06710001
067200         FROM 1 BY 1                                              06720001
067300         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       06730001
067400                   OR SQLCODE = 0                                 06740001
067500                   OR SQLCODE = +100)                             06750001
067600         EXEC SQL                                                 06760001
067700             FETCH VRTL-REQUEST                                   06770001
067800                 INTO :SVT00000-CRD-PROD-YR                       06780001
067900                    , :SVT00000-SHIPT-REQ-NBR                     06790001
068000                    , :SVT00000-CRD-REQ-QTY                       06800001
068100                    , :SVT00000-CRD-REQD-DTE                      06810001
068200                    , :SVT00000-CRD-TYP-CDE                       06820001
068300                    , :SVT00000-PRE-DNNTD-CRD-AMT                 06830001
068400                    , :SVT00000-CRD-STK-TYP-ID                    06840001
068500                    , :SVT00008-CRD-STK-TYP-DESC                  06850001
068600                    , :SVT00000-CRD-PRDR-CDE                      06860001
068700                    , :SVT00008-UPC-NBR                           06870001
068800         END-EXEC                                                 06880001
068900                                                                  06890001
069000         EVALUATE TRUE                                            06900001
069100             WHEN SQLCODE = -904                                  06910001
069200             WHEN SQLCODE = -911                                  06920001
069300             WHEN SQLCODE = 0                                     06930001
069400                 CONTINUE                                         06940001
069500             WHEN SQLCODE = +100                                  06950001
069600                 SET PS-NO-MORE-REQUESTS  TO  TRUE                06960001
069700             WHEN SQLWARN NOT = SPACES                            06970001
069800             WHEN SQLCODE NOT = ZERO                              06980001
069900                 MOVE '2100-FETCH-REQUEST-ROW'                    06990001
070000                               TO  PV-PARAGRAPH-NAME              07000001
070100                 MOVE 'FETCH REQUEST DATA'                        07010001
070200                               TO  PV-DB2-OPER-ATTEMPTED          07020001
070300                 PERFORM 9900-SQL-ABEND                           07030001
070400         END-EVALUATE                                             07040001
070500     END-PERFORM.                                                 07050001
070600                                                                  07060001
070700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        07070001
070800         MOVE '2100-FETCH-REQUEST-ROW'                            07080001
070900                               TO  PV-PARAGRAPH-NAME              07090001
071000         MOVE 'REQUEST FETCH RETRIES EXCEEDED'                    07100001
071100                               TO  PV-DB2-OPER-ATTEMPTED          07110001
071200         PERFORM 9900-SQL-ABEND                                   07120001
071300     END-IF.                                                      07130001
071400 EJECT                                                            07140001
071500****************************************************************  07150001
071600*                                                              *  07160001
071700*    USES THE DATA FROM THE REQUEST TABLE TO RETRIEVE          *  07170001
071800*    VRTL CONTROL DATA.                                        *  07180001
071900*                                                              *  07190001
072000****************************************************************  07200001
072100 2200-OPEN-CONTROL-CURSOR.                                        07210001
072200                                                                  07220001
072300     PERFORM                                                      07230001
072400         WITH TEST AFTER                                          07240001
072500         VARYING PV-SQL-SUB                                       07250001
072600         FROM 1 BY 1                                              07260001
072700         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       07270001
072800                   OR SQLCODE = 0                                 07280001
072900                   OR SQLCODE = +100)                             07290001
073000         EXEC SQL                                                 07300001
073100             OPEN VRTL-CONTROL                                    07310001
073200         END-EXEC                                                 07320001
073300                                                                  07330001
073400         EVALUATE TRUE                                            07340001
073500             WHEN SQLCODE = -904                                  07350001
073600             WHEN SQLCODE = -911                                  07360001
073700             WHEN SQLCODE = 0                                     07370001
073800             WHEN SQLCODE = +100                                  07380001
073900                 CONTINUE                                         07390018
074000             WHEN SQLWARN NOT = SPACES                            07400001
074100             WHEN SQLCODE NOT = ZERO                              07410001
074200                 MOVE '2200-OPEN-CONTROL-CURSOR'                  07420001
074300                               TO  PV-PARAGRAPH-NAME              07430001
074400                 MOVE 'OPEN CONTROL CURSOR'                       07440001
074500                               TO  PV-DB2-OPER-ATTEMPTED          07450001
074600                 PERFORM 9900-SQL-ABEND                           07460001
074700         END-EVALUATE                                             07470001
074800     END-PERFORM.                                                 07480001
074900                                                                  07490001
075000     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        07500001
075100         MOVE '2200-OPEN-CONTROL-CURSOR'                          07510001
075200                               TO  PV-PARAGRAPH-NAME              07520001
075300         MOVE 'CONTROL OPEN RETRIES EXCEEDED'                     07530001
075400                               TO  PV-DB2-OPER-ATTEMPTED          07540001
075500         PERFORM 9900-SQL-ABEND                                   07550001
075600     END-IF.                                                      07560001
075700     SET  PS-MORE-CONTROL-ROWS  TO  TRUE.                         07570018
075800 EJECT                                                            07580001
075900****************************************************************  07590001
076000*                                                              *  07600001
076100*    USES THE DATA FROM THE REQUEST TABLE TO RETRIEVE          *  07610001
076200*    VRTL CONTROL DATA.                                        *  07620001
076300*                                                              *  07630001
076400****************************************************************  07640001
076500 2300-FETCH-CONTROL-ROW.                                          07650001
076600                                                                  07660001
076700     PERFORM                                                      07670001
076800         WITH TEST AFTER                                          07680001
076900         VARYING PV-SQL-SUB                                       07690001
077000         FROM 1 BY 1                                              07700001
077100         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       07710001
077200                   OR SQLCODE = 0                                 07720001
077300                   OR SQLCODE = +100)                             07730001
077400         EXEC SQL                                                 07740001
077500             FETCH VRTL-CONTROL                                   07750001
077600                 INTO :SVT00001-CRD-PROD-YR                       07760001
077700                     ,:SVT00001-SHIPT-REQ-NBR                     07770001
077800                     ,:SVT00001-CNTL-NBR                          07780001
077900                     ,:SVT00001-CRD-NBR                           07790001
078000                     ,:SVT00001-CRD-SPCTY-TYP-CDE                 07800001
078100         END-EXEC                                                 07810001
078200                                                                  07820001
078300         EVALUATE TRUE                                            07830001
078400             WHEN SQLCODE = -904                                  07840001
078500             WHEN SQLCODE = -911                                  07850001
078600             WHEN SQLCODE = 0                                     07860001
078700                 CONTINUE                                         07870001
078800             WHEN SQLCODE = +100                                  07880001
078900                 SET  PS-NO-MORE-CONTROL-ROWS  TO  TRUE           07890001
079000             WHEN SQLWARN NOT = SPACES                            07900001
079100             WHEN SQLCODE NOT = ZERO                              07910001
079200                 MOVE '2300-FETCH-CONTROL-ROW'                    07920001
079300                               TO  PV-PARAGRAPH-NAME              07930001
079400                 MOVE 'FETCH CONTROL CURSOR'                      07940001
079500                               TO  PV-DB2-OPER-ATTEMPTED          07950001
079600                 PERFORM 9900-SQL-ABEND                           07960001
079700         END-EVALUATE                                             07970001
079800     END-PERFORM.                                                 07980001
079900                                                                  07990001
080000     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        08000001
080100         MOVE '2300-FETCH-CONTROL-ROW'                            08010001
080200                               TO  PV-PARAGRAPH-NAME              08020001
080300         MOVE 'CONTROL FETCH RETRIES EXCEEDED'                    08030001
080400                               TO  PV-DB2-OPER-ATTEMPTED          08040001
080500         PERFORM 9900-SQL-ABEND                                   08050001
080600     END-IF.                                                      08060001
080700 EJECT                                                            08070001
080800****************************************************************  08080012
080900*                                                              *  08090012
081000*    FORMAT THE EXTRACT FILE FOR VIRTUAL GIFT CARDS            *  08100012
081100*                                                              *  08110012
081200****************************************************************  08120012
081300 2400-FORMAT-VENDOR-GIFT-CARD.                                    08130012
081400                                                                  08140012
081500     MOVE SPACES               TO SV050-CONTROL-RECORD.           08150012
081600                                                                  08160012
081700     MOVE PV-CONTROL-NUMBER    TO SV050-DR-CNTL-NBR.              08170012
081800                                                                  08180012
081900     MOVE SVT00000-PRE-DNNTD-CRD-AMT                              08190012
082000                               TO PV-PRE-DNNTD-CRD-AMT.           08200012
082100                                                                  08210012
082200     IF SVT00000-PRE-DNNTD-CRD-AMT = 0                            08220012
082300         MOVE ZERO                 TO SV050-DR-GIFT-DNNTD-AMT     08230012
082400     ELSE                                                         08240012
082500         MOVE PV-PRE-DNNTD-DOLLARS TO SV050-DR-GIFT-DNNTD-AMT     08250012
082600     END-IF.                                                      08260012
082700                                                                  08270012
082800     MOVE ZEROES               TO SV050-DR-CRD-PIN-NBR.           08280012
082900     MOVE SVT00008-UPC-NBR     TO PV-UPC-NBR-DECIMAL.             08290012
083000     MOVE PV-UPC-NBR-11        TO SV050-DR-CRD-UPC-NBR            08300012
083100     MOVE SVT00001-CRD-NBR     TO PV-CARD-NBR-DECIMAL.            08310012
083200     MOVE SV004-KOHLS-IIN      TO PV-BIN-NBR                      08320012
083300                                  SV050-DR-CRD-BIN-NBR.           08330012
083400     MOVE PV-CARD-NBR-VENDOR-1-12                                 08340012
083500                               TO SV050-DR-CARD-NBR.              08350012
083600                                                                  08360012
083700     MOVE SVT00001-CRD-SPCTY-TYP-CDE                              08370012
083800                                    TO PV-CRD-STK-TYP.            08380012
083900     MOVE PV-BIN-1-4                TO PV-GIFT-CARD-NBR-1-4.      08390012
084000     MOVE PV-BIN-5-6                TO PV-GIFT-CARD-NBR-5-6.      08400012
084100     MOVE PV-CRD-STK-TYP            TO SV050-DR-CRD-TYPE          08410012
084200                                       PV-GIFT-CARD-NBR-7.        08420012
084300     MOVE PV-CARD-NBR-1-2           TO PV-GIFT-CARD-NBR-8-9.      08430012
084400     MOVE PV-CARD-NBR-3-7           TO PV-GIFT-CARD-NBR-10-14.    08440012
084500     MOVE PV-CARD-NBR-8-12          TO PV-GIFT-CARD-NBR-15-19.    08450012
084600     MOVE PV-GIFT-CARD-NBR-SPACED   TO SV050-DR-CARD-NBR-PRINT.   08460012
084700                                                                  08470012
084800     MOVE ZEROES                   TO SV050-DR-SAFEWAY-UPC-WO-CD  08480012
084900                                      SV050-DR-SAFEWAY-BIN-NBR    08490012
085000                                      SV050-DR-SAFEWAY-CRD-TYPE   08500012
085100                                      SV050-DR-SAFEWAY-CARD-NBR   08510012
085200                                      SV050-DR-SAFEWAY-AMT.       08520012
085300                                                                  08530012
085400     MOVE SPACES                   TO SV050-DR-SAFEWAY-DIG-12     08540012
085500                                      SV050-DR-SAFEWAY-DIG-18     08550012
085600                                      SV050-DR-EXPIRATION-DTE.    08560012
085700                                                                  08570012
085800     IF PS-FIRST-TIME-THRU                                        08580012
085900         MOVE PV-CONTROL-NUMBER     TO DL-STARTING-CONTROL-NBR    08590012
086000         SET PS-NOT-FIRST-TIME-THRU TO TRUE                       08600012
086100     END-IF.                                                      08610012
086200                                                                  08620012
086300     IF PV-WRITE-COUNT = PV-MAX-CONTROL-RECORDS                   08630012
086400         PERFORM 5200-WRITE-DETAIL-LINE                           08640012
086500         PERFORM 3100-CLOSE-REQUEST-FILE                          08650012
MFTCHG         PERFORM 3200-WRITE-MFT-PARM-RECORD                       08660031
086700         MOVE ZEROS       TO  PV-WRITE-COUNT                      08670012
086800         PERFORM 3000-ALLOCATE-AND-OPEN-RQST                      08680012
086900         MOVE PV-CONTROL-NUMBER                                   08690012
087000                      TO DL-STARTING-CONTROL-NBR                  08700012
087100     END-IF.                                                      08710012
087200                                                                  08720012
087300     MOVE PV-CONTROL-NUMBER TO DL-ENDING-CONTROL-NBR.             08730012
087400     PERFORM 2500-WRITE-CONTROL-RECORD.                           08740012
087500                                                                  08750012
087600****************************************************************  08760001
087700*                                                              *  08770001
087800*    THIS ROUTINE MOVES AND WRITES THE DETAIL CONTROL EXTRACT  *  08780001
087900*    FILE RECORDS.                                                08790001
088000*                                                              *  08800001
088100****************************************************************  08810001
088200 2500-WRITE-CONTROL-RECORD.                                       08820001
088300                                                                  08830001
088400     MOVE SV050-DETAIL-RECORD                                     08840001
088500                          TO VRTL-CONTROL-EXTRACT-RECORD          08850001
088600     WRITE VRTL-CONTROL-EXTRACT-RECORD                            08860001
088700                                                                  08870001
088800     ADD +1  TO  PV-WRITE-COUNT.                                  08880001
088900                                                                  08890001
089000****************************************************************  08900012
089100*                                                              *  08910012
089200*    CLOSE THE VRTL CONTROL CURSOR.                            *  08920012
089300*                                                              *  08930012
089400****************************************************************  08940012
089500 2600-CLOSE-CONTROL-CURSOR.                                       08950012
089600                                                                  08960012
089700     EXEC SQL                                                     08970012
089800         CLOSE VRTL-CONTROL                                       08980012
089900     END-EXEC.                                                    08990012
090000                                                                  09000012
090100****************************************************************  09010001
090200*                                                              *  09020001
090300*    ALLOCATE THE REQUEST PDS MEMBER, AND OPEN THE MEMBER      *  09030001
090400*    FOR WRITTING.                                             *  09040001
090500*                                                              *  09050001
090600****************************************************************  09060001
090700 3000-ALLOCATE-AND-OPEN-RQST.                                     09070001
090800                                                                  09080001
090900     ADD  +1                   TO   PV-MEM-NAME-SUFFIX-COUNT.     09090001
091000                                                                  09100001
091100     INITIALIZE DP023-DYNALC-PARMS.                               09110001
091200                                                                  09120001
091300     MOVE 'V'              TO   PV-CNTL-MEM-CRD-TYP               09130002
091400     IF SVT00000-PRE-DNNTD-CRD-AMT = 0                            09140001
091500         MOVE 'N'          TO   PV-CNTL-MEM-SPECIAL-REQ           09150001
091600     ELSE                                                         09160001
091700         MOVE 'P'          TO   PV-CNTL-MEM-SPECIAL-REQ           09170001
091800         MOVE SVT00000-PRE-DNNTD-CRD-AMT                          09180001
091900                           TO   PV-PRE-DNNTD-CRD-AMT              09190001
092000     END-IF                                                       09200001
092100     IF SVT00000-CRD-STK-TYP-ID = SV004-STK-DESC-SHRT-GIFT-CRD    09210001
092200         CONTINUE                                                 09220001
092300     ELSE                                                         09230001
092400         MOVE 'S'          TO   PV-CNTL-MEM-SPECIAL-REQ           09240001
092500     END-IF                                                       09250001
092600     IF PV-ENVIRONMENT = 'P'                                      09260001
092700         MOVE PC-DA-PROD-GIFT-DSNAME                              09270001
092800                           TO DP023-DSNAME                        09280001
092900     ELSE                                                         09290001
093000         MOVE PC-DA-TEST-GIFT-DSNAME                              09300001
093100                           TO DP023-DSNAME                        09310001
093200     END-IF                                                       09320001
093300     MOVE PC-VRTL-CONTROL-DDNAME                                  09330004
093400                           TO DP023-DDNAME                        09340001
093500     MOVE LENGTH OF VRTL-CONTROL-EXTRACT-RECORD                   09350001
093600                           TO DP023-RECSZ                         09360001
093700     MOVE SV004-GIFT-CRD-DESC                                     09370001
093800                           TO DL-CARD-TYPE                        09380001
093900     SET DP023-DISP-SHARE TO TRUE.                                09390001
094000     SET DP023-FREE-CLOSE-YES TO TRUE.                            09400001
094100     SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         09410001
094200     MOVE PV-RQST-NBR-CONVERT  TO PV-CNTL-MEM-RQST-NBR.           09420001
094300     MOVE PV-MEM-NAME-SUFFIX-COUNT                                09430001
094400                               TO PV-CNTL-MEM-SEQ.                09440001
094500     MOVE PV-CNTL-MEMBER       TO DP023-MEMBER-NAME.              09450001
094600     SET DP023-MEMDISP-NEW     TO TRUE.                           09460001
094700                                                                  09470001
094800     PERFORM DP023-0000-DYNALC.                                   09480001
094900                                                                  09490001
095000     OPEN OUTPUT VRTL-CONTROL-EXTRACT-FILE                        09500001
095100                                                                  09510001
MFTCHG     MOVE PV-CNTL-MEMBER  TO  PV-MFT-REQUEST-MEMBER               09520031
MFTCHG                              PV-MFT-TRANSFER-MEMBER              09530031
095400                              DL-MEMBER-NAME.                     09540001
095500                                                                  09550001
095600     MOVE SVT00000-PRE-DNNTD-CRD-AMT                              09560001
095700                          TO  DL-DENOMINATION.                    09570001
095800     MOVE SVT00000-CRD-STK-TYP-ID                                 09580001
095900                          TO  DL-CARD-STOCK-TYPE.                 09590001
096000     MOVE SVT00008-CRD-STK-TYP-DESC                               09600001
096100                          TO  DL-CARD-STOCK-TYPE-DESC.            09610001
096200                                                                  09620001
096300     SET SV004-CARD-PRDR-IDX TO 1.                                09630001
096400     SEARCH SV004-CARD-PRDR                                       09640001
096500         AT END                                                   09650001
096600           DISPLAY '**      SVKUP006 ABEND      **'               09660001
096700           DISPLAY '** INVALID PRODUCER CODE    **'               09670001
096800           DISPLAY '** 3000-ALLOCATE-AND-OPEN-RQST'               09680001
096900           DISPLAY '** ' SVT00000-PRE-DNNTD-CRD-AMT ' DENOM **'   09690001
097000           MOVE '3000-ALLOCATE-AND-OPEN-RQST' TO PV-PARAGRAPH-NAME09700001
097100           SET ABEND-4008        TO  TRUE                         09710001
097200           PERFORM 9999-ABEND                                     09720001
097300         WHEN SVT00000-CRD-PRDR-CDE =                             09730001
097400              SV004-CARD-PRDR-CDE (SV004-CARD-PRDR-IDX)           09740001
097500             MOVE SV004-CARD-PRDR-LIT (SV004-CARD-PRDR-IDX)       09750001
097600                          TO  DL-PRODUCER                         09760001
097700     END-SEARCH.                                                  09770001
097800                                                                  09780001
097900****************************************************************  09790001
098000*                                                              *  09800001
098100*    CLOSE THE REQUEST PDS MEMBER.                             *  09810001
098200*                                                              *  09820001
098300****************************************************************  09830001
098400 3100-CLOSE-REQUEST-FILE.                                         09840001
098500                                                                  09850001
098600     CLOSE VRTL-CONTROL-EXTRACT-FILE.                             09860016
098700                                                                  09870001
098800****************************************************************  09880001
098900*                                                              *  09890001
099000*    THIS ROUTINE MOVES AND WRITES THE FILE RECORD.            *  09900001
099100*                                                              *  09910001
099200****************************************************************  09920001
MFTCHG 3200-WRITE-MFT-PARM-RECORD.                                      09930031
MFTCHG                                                                  09940031
MFTCHG     IF PV-ENVIRONMENT = 'P'                                      09950031
MFTCHG         MOVE PC-MFT-DL-PROD-GIFT-FILE                            09960031
MFTCHG                           TO PV-MFT-FILE-NAME                    09970031
MFTCHG     ELSE                                                         09980031
MFTCHG         MOVE PC-MFT-DL-TEST-GIFT-FILE                            09990031
MFTCHG                           TO PV-MFT-FILE-NAME                    10000031
MFTCHG     END-IF                                                       10010031
MFTCHG                                                                  10020031
MFTCHG     MOVE PV-MFT-DOWNLOAD-RECORD                                  10030031
MFTCHG                          TO  MFT-DOWNLOAD-PARM-RECORD            10040031
MFTCHG     WRITE MFT-DOWNLOAD-PARM-RECORD                               10050031
MFTCHG     MOVE PV-MFT-DOWNLOAD-RECORD1                                 10051031
MFTCHG                          TO  MFT-DOWNLOAD-PARM-RECORD            10052031
MFTCHG     WRITE MFT-DOWNLOAD-PARM-RECORD                               10053031
MFTCHG     MOVE PV-MFT-DOWNLOAD-RECORD2                                 10054031
MFTCHG                          TO  MFT-DOWNLOAD-PARM-RECORD            10055031
MFTCHG     WRITE MFT-DOWNLOAD-PARM-RECORD                               10056031
MFTCHG     MOVE PV-MFT-DOWNLOAD-RECORD3                                 10057031
MFTCHG                          TO  MFT-DOWNLOAD-PARM-RECORD            10058031
MFTCHG     WRITE MFT-DOWNLOAD-PARM-RECORD.                              10059031
MFTCHG     MOVE PV-MFT-DOWNLOAD-RECORD4                                 10059136
MFTCHG                          TO  MFT-DOWNLOAD-PARM-RECORD            10059236
MFTCHG     WRITE MFT-DOWNLOAD-PARM-RECORD.                              10059336
100600                                                                  10060001
100700****************************************************************  10070013
100800*                                                              *  10080013
100900*    THIS ROUTINE UPDATES CRD_PROD_STAT_CDE OF SVT_CRD_PROD    *  10090013
101000*    TO 'CM' FROM 'PV' ONCE THE REQUEST IS PROCESSED           *  10100013
101100*                                                              *  10110013
101200****************************************************************  10120013
101300 3300-UPDATE-STAT-CDE.                                            10130038
101400                                                                  10140038
101500     EXEC SQL                                                     10150038
101600         UPDATE SVT_CRD_PROD                                      10160038
101700           SET CRD_PROD_STAT_CDE = 'CM'                           10170038
101800         WHERE CRD_TYP_CDE = :SVT00000-CRD-TYP-CDE                10180038
101900           AND CRD_STK_TYP_ID = :SVT00000-CRD-STK-TYP-ID          10190038
102000           AND PRE_DNNTD_CRD_AMT = :SVT00000-PRE-DNNTD-CRD-AMT    10200038
102100           AND CRD_PROD_STAT_CDE = 'PV'                           10210038
102200           AND CRD_PRDR_CDE = 'V'                                 10220038
102300     END-EXEC.                                                    10230038
102400                                                                  10240038
102500     EVALUATE TRUE                                                10250038
102600         WHEN SQLCODE = 0                                         10260038
102700             CONTINUE                                             10270038
102800         WHEN OTHER                                               10280038
102900             MOVE '3300-UPDATE-STAT-CDE'                          10290038
103000                           TO  PV-PARAGRAPH-NAME                  10300038
103100             MOVE 'UPDATE SVT_CRD_PROD ERROR'                     10310038
103200                           TO  PV-DB2-OPER-ATTEMPTED              10320038
103300             PERFORM 9900-SQL-ABEND                               10330038
103400     END-EVALUATE.                                                10340038
103500                                                                  10350013
103600****************************************************************  10360012
103700*                                                              *  10370012
103800*    THIS ROUTINE PROCESSES A PAGE BREAK BY INCREMENTING THE   *  10380012
103900*    PAGE COUNTER AND WRITING THE TITLE AND HEADING LINES.     *  10390012
104000*                                                              *  10400012
104100****************************************************************  10410012
104200 5000-PROCESS-PAGE-BREAK.                                         10420012
104300     ADD PC-ONE                    TO PV-PAGE-COUNTER.            10430012
104400     MOVE PV-PAGE-COUNTER          TO DP132O-PAGE-NUMBER.         10440012
104500     WRITE EMBOSSING-REPORT-RECORD                                10450012
104600         FROM DP132O-STANDRD-HEADER-132-COLS                      10460012
104700         AFTER ADVANCING PAGE.                                    10470012
104800     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR                    10480012
104900     WRITE EMBOSSING-REPORT-RECORD                                10490012
105000         FROM REPORT-EMBOSSING-TITLE-LINE                         10500012
105100         AFTER ADVANCING 1 LINE.                                  10510012
105200     WRITE EMBOSSING-REPORT-RECORD                                10520012
105300         FROM REPORT-EMBOSSING-HEADING-1                          10530012
105400         AFTER ADVANCING 2 LINE.                                  10540012
105500     WRITE EMBOSSING-REPORT-RECORD                                10550012
105600         FROM REPORT-EMBOSSING-HEADING-2                          10560012
105700         AFTER ADVANCING 1 LINE.                                  10570012
105800     WRITE EMBOSSING-REPORT-RECORD                                10580012
105900         FROM REPORT-EMBOSSING-EMPTY-LINE                         10590012
106000         AFTER ADVANCING 1 LINE.                                  10600012
106100     MOVE PC-HEADER-LINE-COUNT     TO PV-LINE-COUNTER.            10610012
106200                                                                  10620001
106300****************************************************************  10630001
106400*                                                              *  10640001
106500*    THIS ROUTINE WRITES THE EMPTY REPORT IF NO CARD REQUEST   *  10650012
106600*    TO PROCESS.                                               *  10660012
106700*                                                              *  10670001
106800****************************************************************  10680001
106900 5100-WRITE-NO-RQST.                                              10690012
107000                                                                  10700012
107100     WRITE EMBOSSING-REPORT-RECORD                                10710012
107200         FROM REPORT-EMBOSSING-EMPTY-LINE                         10720012
107300         AFTER ADVANCING 1 LINE.                                  10730012
107400     WRITE EMBOSSING-REPORT-RECORD                                10740012
107500         FROM REPORT-EMBOSSING-NO-REQ                             10750012
107600         AFTER ADVANCING 1 LINE.                                  10760012
107700     WRITE EMBOSSING-REPORT-RECORD                                10770019
107800         FROM REPORT-EMBOSSING-EMPTY-LINE                         10780019
107900         AFTER ADVANCING 1 LINE.                                  10790019
108000     MOVE PC-THREE                 TO PV-LINE-COUNTER.            10800019
108100                                                                  10810012
108200****************************************************************  10820012
108300*                                                              *  10830012
108400*    THIS ROUTINE WRITES THE DETAIL LINE AND ACCUMULATES A     *  10840012
108500*    RUNNING TOTAL NUMBER OF CARDS PER REQUEST.                *  10850012
108600*                                                              *  10860012
108700****************************************************************  10870012
108800 5200-WRITE-DETAIL-LINE.                                          10880012
108900     IF PV-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                   10890001
109000         PERFORM 5000-PROCESS-PAGE-BREAK                          10900001
109100     END-IF.                                                      10910001
109200     MOVE PV-WRITE-COUNT           TO DL-NUMBER-REQUESTED.        10920001
109300     COMPUTE PV-NUMBER-REQUESTED-ACCUM =                          10930001
109400             PV-NUMBER-REQUESTED-ACCUM + PV-WRITE-COUNT.          10940001
109500     WRITE EMBOSSING-REPORT-RECORD                                10950001
109600         FROM REPORT-EMBOSSING-DETAIL-LINE                        10960001
109700         AFTER ADVANCING 1 LINE.                                  10970001
109800     ADD PC-ONE                    TO PV-LINE-COUNTER.            10980001
109900****************************************************************  10990001
110000*                                                              *  11000001
110100*    THIS ROUTINE WRITES THE TOTAL NUMBER OF CARDS PER REQUEST.*  11010001
110200*    IT ALSO CLEARS OUT THE ACCUMULATOR TO PREPARE FOR THE     *  11020001
110300*    NEXT REQUEST.                                             *  11030001
110400*                                                              *  11040001
110500****************************************************************  11050001
110600 5300-WRITE-TOTAL.                                                11060011
110700     WRITE EMBOSSING-REPORT-RECORD                                11070001
110800         FROM REPORT-EMBOSSING-SUBTOTAL-LINE                      11080001
110900         AFTER ADVANCING 1 LINE.                                  11090001
111000     MOVE PV-NUMBER-REQUESTED-ACCUM                               11100001
111100                                   TO TL-TOTAL-REQUESTED.         11110001
111200     WRITE EMBOSSING-REPORT-RECORD                                11120001
111300         FROM REPORT-EMBOSSING-TOTAL-LINE                         11130001
111400         AFTER ADVANCING 1 LINE.                                  11140001
111500     WRITE EMBOSSING-REPORT-RECORD                                11150001
111600         FROM REPORT-EMBOSSING-EMPTY-LINE                         11160001
111700         AFTER ADVANCING 1 LINE.                                  11170001
111800     MOVE ZEROS                    TO PV-NUMBER-REQUESTED-ACCUM.  11180001
111900     ADD PC-THREE                  TO PV-LINE-COUNTER.            11190001
112000****************************************************************  11200001
112100*                                                              *  11210001
112200*    CLOSE REPORT FILE AND THE REQUEST CURSOR                  *  11220002
112300*                                                              *  11230001
112400****************************************************************  11240001
112500 9000-CLOSE-FILE-AND-CURSOR.                                      11250001
112600                                                                  11260001
MFTCHG     CLOSE MFT-DOWNLOAD-PARM-FILE                                 11270031
112800           EMBOSSING-REPORT-FILE.                                 11280002
112900                                                                  11290001
113000     EXEC SQL                                                     11300001
113100         CLOSE VRTL-REQUEST                                       11310001
113200     END-EXEC.                                                    11320001
113300                                                                  11330001
113400****************************************************************  11340001
113500*                                                              *  11350001
113600*    THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.        *  11360001
113700*                                                              *  11370001
113800****************************************************************  11380001
113900 9900-SQL-ABEND.                                                  11390001
114000                                                                  11400001
114100     SET ABEND-4013             TO TRUE.                          11410001
114200     DISPLAY '**  ABEND     **'.                                  11420001
114300     DISPLAY '**  PROGRAM   **  =  SVKUP006'.                     11430001
114400     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            11440001
114500     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        11450001
114600****************************************************************  11460001
114700*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         11470001
114800*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        11480001
114900****************************************************************  11490001
115000     COPY DPPD004.                                                11500001
115100                                                                  11510001
115200     CALL 'ILBOABN0'  USING ABEND-CODE.                           11520001
115300                                                                  11530001
115400*                                                                 11540001
115500*  DYNAMIC ALLOCATION ROUTINE                                     11550001
115600*                                                                 11560001
115700     COPY DPPD023.                                                11570001
115800******************************************************************11580001
115900* 9999-ABEND                                                      11590001
116000*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  11600001
116100******************************************************************11610001
116200 9999-ABEND.                                                      11620001
116300     DISPLAY '** ABEND           **'.                             11630001
116400     DISPLAY '** PROGRAM         ** =  SVKUP006'.                 11640001
116500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        11650001
116600     CALL 'ILBOABN0' USING ABEND-CODE.                            11660001
