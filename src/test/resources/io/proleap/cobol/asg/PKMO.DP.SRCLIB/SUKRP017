000100***************************************************************** 00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300***************************************************************** 00030004
000400                                                                  00040004
000500 PROGRAM-ID.             SUKRP017.                                00050004
000600 AUTHOR.                 VIRGENE LENNEMAN.                        00060004
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070004
000800 DATE-WRITTEN            SEPTEMBER 1997.                          00080004
000900 DATE-COMPILED.                                                   00090004
001000***************************************************************** 00100004
001100***************************************************************** 00110004
001200*  THIS PROGRAM WILL CREATE THE VENDOR ACCURACY CARTON AUDIT -- * 00120004
001300*  SUMMARY OF AUDITS CLOSED FOR MM/DD/CCYY  REPORT              * 00130004
001400***************************************************************** 00140004
001500*  CHANGES                                                      * 00150004
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                     *         
      *    DATE:    11/04/2013                                        *         
      *                                                               *         
      *    NEW VALUE OF 'RFID' WILL BE THERE UNDER THE AUDIT TYPE     *         
      *    FIELD WHEN THE AUDIT IS OF THE TYPE RFID.                  *         
      *    CHANGES CAN BE FOUND WITH *SB 11/04/13                     *         
001700*                                                               * 00170004
001500*  CHANGES                                                      * 00150004
      *    MADE BY: CHERI PARMLEY        CHG#0098147                  *         
      *    DATE:    10/13/2014                                        *         
      *                                                               *         
      *    EXPAND PO# FROM 7 TO 8 DIGITS                              *         
001800***************************************************************** 00180004
001900***************************************************************** 00190004
002000 ENVIRONMENT DIVISION.                                            00200004
002100***************************************************************** 00210004
002200                                                                  00220004
002300 CONFIGURATION SECTION.                                           00230004
002400                                                                  00240004
002500 SOURCE-COMPUTER.        IBM-3090.                                00250004
002600 OBJECT-COMPUTER.        IBM-3090.                                00260004
002700                                                                  00270004
002800 INPUT-OUTPUT SECTION.                                            00280004
002900                                                                  00290004
003000 FILE-CONTROL.                                                    00300004
003100                                                                  00310004
003200     SELECT SU-CARTON-AUDIT-RPT-FILE                              00320004
003300         ASSIGN TO RPT01.                                         00330004
003400                                                                  00340004
003500***************************************************************** 00350004
003600 DATA DIVISION.                                                   00360004
003700***************************************************************** 00370004
003800                                                                  00380004
003900 FILE SECTION.                                                    00390004
004000                                                                  00400004
004100 FD  SU-CARTON-AUDIT-RPT-FILE                                     00410004
004200     RECORDING MODE IS F                                          00420004
004300     BLOCK CONTAINS 0  RECORDS.                                   00430004
004400 01  SU-CARTON-AUDIT-RPT-RECORD      PIC  X(132).                 00440004
004500                                                                  00450004
004600 WORKING-STORAGE SECTION.                                         00460004
004700                                                                  00470004
004800 01  PROGRAM-SWITCHES.                                            00480004
004900     05  PS-END-OF-SUA-CURSOR-SW     PIC  X(01)    VALUE 'N'.     00490004
005000         88  PS-END-OF-SUA-CURSOR                  VALUE 'Y'.     00500004
005100         88  PS-NOT-END-OF-SUA-CURSOR              VALUE 'N'.     00510004
005200     05  PS-END-OF-PO-RECEIVERS-SW   PIC  X(01)    VALUE 'Y'.     00520004
005300         88  PS-MORE-PO-RECEIVERS                  VALUE 'Y'.     00530004
005400         88  PS-NO-MORE-PO-RECEIVERS               VALUE 'N'.     00540004
005500     05  PS-RECEIVER-FOUND-SW        PIC  X(01)    VALUE 'Y'.     00550004
005600         88  PS-RECEIVER-FOUND                     VALUE 'Y'.     00560004
005700         88  PS-RECEIVER-NOT-FOUND                 VALUE 'N'.     00570004
005800     05  PS-FIRST-TIME-SW            PIC  X(01)    VALUE 'Y'.     00580004
005900         88  PS-FIRST-TIME                         VALUE 'Y'.     00590004
006000         88  PS-NOT-FIRST-TIME                     VALUE 'N'.     00600004
006100                                                                  00610004
006200 01  PC-CONSTANTS.                                                00620004
006300     05  PC-10                       PIC S9(03)    VALUE +10      00630004
006400                                                   COMP-3.        00640004
006500     05  PC-SLASH                    PIC  X(01)    VALUE '/'.     00650004
006600     05  PC-COLON                    PIC  X(01)    VALUE ':'.     00660004
006700     05  PC-SUKRP017                 PIC  X(08)    VALUE          00670004
006800         'SUKRP017'.                                              00680004
006900     05  PC-100-PCT-CHECK            PIC  X(10)    VALUE          00690004
007000         '100% CHECK'.                                            00700004
007100     05  PC-SPOT-CHECK               PIC  X(10)    VALUE          00710004
007200         'SPOT CHECK'.                                            00720004
007300     05  PC-REWORK                   PIC  X(10)    VALUE          00730004
007400         'REWORK    '.                                            00740004
007500     05  PC-UNKNOWN                  PIC  X(10)    VALUE          00750004
007600         'UNKNOWN   '.                                            00760004
      *SB 11/04/13 - BEGIN PR#5148D                                             
007500     05  PC-RFID                     PIC  X(10)    VALUE          00750004
007600         'RFID      '.                                            00760004
      *SB 11/04/13 - END PR#5148D                                               
007700     05  PC-BLANK-LINE               PIC  X(132)   VALUE SPACES.  00770004
007800     05  PC-REPORT-NBR               PIC  9(01)    VALUE 1.       00780004
007900     05  PC-MAX-RPT-LINES            PIC S9(04)    VALUE +60      00790004
008000                                                   COMP SYNC.     00800004
008100     05  PC-PROCESS-DATE.                                         00810004
008200         10  PC-PROC-CC              PIC  9(02)    VALUE ZEROS.   00820004
008300         10  PC-PROC-YY              PIC  9(02)    VALUE ZEROS.   00830004
008400         10  FILLER                  PIC  X(01)    VALUE SPACES.  00840004
008500         10  PC-PROC-MM              PIC  9(02)    VALUE ZEROS.   00850004
008600         10  FILLER                  PIC  X(01)    VALUE SPACES.  00860004
008700         10  PC-PROC-DD              PIC  9(02)    VALUE ZEROS.   00870004
008800                                                                  00880004
008900 01  PV-MISC-FIELDS.                                              00890004
009000     05  PV-LINE-CNT                 PIC S9(03)    VALUE ZERO     00900004
009100                                                   COMP-3.        00910004
009200     05  PV-PAGE-CNT                 PIC S9(04)    VALUE ZERO     00920004
009300                                                   COMP-3.        00930004
009400     05  PV-DETAIL-LINE-CNT          PIC S9(04)    VALUE ZERO     00940004
009500                                                   COMP-3.        00950004
009600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00960004
009700                                                   COMP SYNC.     00970004
009800     05  PV-AUDIT-CART-COUNT         PIC S9(09)    VALUE ZERO     00980004
009900                                                   COMP SYNC.     00990004
010000     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01000004
010100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01010004
010200     05  PV-PO-RECEIVER.                                          01020004
      *CLP 10/13/14                                                             
010300         10  PV-PO                   PIC  ZZZZZZZ9 VALUE ZERO.    01030004
010400         10  FILLER                  PIC  X(01)    VALUE '-'.     01040004
010500         10  PV-RECEIVER             PIC  9(04)    VALUE ZERO.    01050004
010600     05  PV-CURR-AUD-CNTL-NBR        PIC  9(09)    VALUE ZERO.    01060004
010700     05  PV-HOLD-AUD-CNTL-NBR        PIC  9(09)    VALUE ZERO.    01070004
010800     05  PV-CURR-FACILITY            PIC S9(04)    VALUE ZERO.    01080004
010900     05  PV-HOLD-FACILITY            PIC S9(04)    VALUE ZERO.    01090004
011000     05  PV-TODAYS-DATE.                                          01100004
011100         10  PV-TODAYS-DATE-YY       PIC  9(02)    VALUE ZERO.    01110004
011200         10  PV-TODAYS-DATE-MM       PIC  9(02)    VALUE ZERO.    01120004
011300         10  PV-TODAYS-DATE-DD       PIC  9(02)    VALUE ZERO.    01130004
011400     05  PV-TODAYS-TIME.                                          01140004
011500         10  PV-TODAYS-TIME-HH       PIC  9(02)    VALUE ZERO.    01150004
011600         10  PV-TODAYS-TIME-MM       PIC  9(02)    VALUE ZERO.    01160004
011700         10  PV-TODAYS-TIME-SS       PIC  9(02)    VALUE ZERO.    01170004
011800         10  FILLER                  PIC  9(02)    VALUE ZERO.    01180004
011900     05  PV-RECEIPT-DATE.                                         01190004
012000         10  PV-REC-DATE-CC          PIC  9(02)    VALUE ZERO.    01200004
012100         10  PV-REC-DATE-YY          PIC  9(02)    VALUE ZERO.    01210004
012200         10  FILLER                  PIC  X(01)    VALUE SPACES.  01220004
012300         10  PV-REC-DATE-MM          PIC  9(02)    VALUE ZERO.    01230004
012400         10  FILLER                  PIC  X(01)    VALUE SPACES.  01240004
012500         10  PV-REC-DATE-DD          PIC  9(02)    VALUE ZERO.    01250004
012600     05  PV-DB2-DATE                 PIC  X(10)    VALUE SPACES.  01260004
012700     05  PV-DB2-COMPARE-DATE         PIC  X(10)    VALUE SPACES.  01261005
012800     05  PV-DB2-TMST.                                             01270004
012900         10 PV-DB2-TMST-CCYY          PIC  9(04).                 01280004
013000         10 FILLER                    PIC  X(01).                 01290004
013100         10 PV-DB2-TMST-MM            PIC  9(02).                 01300004
013200         10 FILLER                    PIC  X(01).                 01310004
013300         10 PV-DB2-TMST-DD            PIC  9(02).                 01320004
013400         10 FILLER                    PIC  X(01).                 01330004
013500         10 PV-DB2-TMST-HH            PIC  9(02).                 01340004
013600         10 FILLER                    PIC  X(01).                 01350004
013700         10 PV-DB2-TMST-MN            PIC  9(02).                 01360004
013800         10 FILLER                    PIC  X(01).                 01370004
013900         10 PV-DB2-TMST-SS            PIC  9(02).                 01380004
014000         10 FILLER                    PIC  X(07).                 01390004
014100     05  PV-FORMAT-DATE.                                          01400004
014200         10 PV-FORMAT-DATE-MM         PIC  9(02).                 01410004
014300         10 FILLER                    PIC  X(01) VALUE '/'.       01420004
014400         10 PV-FORMAT-DATE-DD         PIC  9(02).                 01430004
014500         10 FILLER                    PIC  X(01) VALUE '/'.       01440004
014600         10 PV-FORMAT-DATE-CCYY       PIC  9(04).                 01450004
014700     05  PV-FORMAT-TIME.                                          01460004
014800         10 PV-FORMAT-TIME-HH         PIC  9(02).                 01470004
014900         10 FILLER                    PIC  X(01) VALUE ':'.       01480004
015000         10 PV-FORMAT-TIME-MN         PIC  9(02).                 01490004
015100                                                                  01500004
015200******************************************************************01510004
015300*  WORK FIELDS FOR SQL ERROR ROUTINE 'DSNTIAR'.                   01520004
015400******************************************************************01530004
015500     COPY DPWS004.                                                01540004
015600                                                                  01550004
015700******************************************************************01560004
015800*  WORK FIELDS FOR PRINTING A 132 CHARACTER REPORT.               01570004
015900******************************************************************01580004
016000     COPY DPWS132O.                                               01590004
016100                                                                  01600004
016200 01  HEADING-LINES.                                               01610004
016300     05  HEADING-LINE-0.                                          01620004
016400         10  FILLER                  PIC  X(52)    VALUE SPACES.  01630004
016500         10  FILLER                  PIC  X(28)    VALUE          01640004
016600             'VENDOR ACCURACY CARTON AUDIT'.                      01650004
016700         10  FILLER                  PIC  X(52)    VALUE SPACES.  01660004
016800                                                                  01670004
016900     05  HEADING-LINE-1.                                          01680004
017000         10  FILLER                  PIC  X(46)    VALUE SPACES.  01690004
017100         10  FILLER                  PIC  X(29)    VALUE          01700004
017200             'SUMMARY OF AUDITS CLOSED FOR '.                     01710004
017300         10  HL1-PROCESS-DT.                                      01720004
017400             15  HL1-PROC-MM         PIC  9(02).                  01730004
017500             15  FILLER              PIC  X(01)    VALUE '/'.     01740004
017600             15  HL1-PROC-DD         PIC  9(02).                  01750004
017700             15  FILLER              PIC  X(01)    VALUE '/'.     01760004
017800             15  HL1-PROC-CC         PIC  9(02).                  01770004
017900             15  HL1-PROC-YY         PIC  9(02).                  01780004
018000         10  FILLER                  PIC  X(47)    VALUE SPACES.  01790004
018100                                                                  01800004
018200     05  HEADING-LINE-2.                                          01810004
018300         10  FILLER                  PIC  X(12)    VALUE          01820004
018400             'FACILITY -  '.                                      01830004
018500         10  HL2-FACILITY-NBR        PIC  9(03)    VALUE ZEROS.   01840004
018600         10  FILLER                  PIC  X(03)    VALUE          01850004
018700             ' - '.                                               01860004
018800         10  HL2-FACILITY-DESC       PIC  X(40)    VALUE SPACES.  01870004
018900         10  FILLER                  PIC  X(74)    VALUE SPACES.  01880004
019000                                                                  01890004
019100     05  HEADING-LINE-3.                                          01900004
019200         10  FILLER                  PIC  X(03)    VALUE SPACE.   01910004
019300         10  FILLER                  PIC  X(05)    VALUE          01920004
019400             'AUDIT'.                                             01930004
019500         10  FILLER                  PIC  X(15)    VALUE SPACES.  01940004
019600         10  FILLER                  PIC  X(03)    VALUE          01950004
019700             'AUD'.                                               01960004
019800         10  FILLER                  PIC  X(65)    VALUE SPACES.  01970004
019900         10  FILLER                  PIC  X(07)    VALUE          01980004
020000             'RECEIPT'.                                           01990004
020100         10  FILLER                  PIC  X(04)    VALUE SPACES.  02000004
020200         10  FILLER                  PIC  X(04)    VALUE          02010004
020300             'CART'.                                              02020004
020400         10  FILLER                  PIC  X(04)    VALUE SPACES.  02030004
020500         10  FILLER                  PIC  X(03)    VALUE          02040004
020600             'ADJ'.                                               02050004
020700         10  FILLER                  PIC  X(05)    VALUE SPACES.  02060004
020800         10  FILLER                  PIC  X(05)    VALUE          02070004
020900             'AUDIT'.                                             02080004
021000         10  FILLER                  PIC  X(14)    VALUE SPACES.  02090004
021100                                                                  02100004
021200     05  HEADING-LINE-4.                                          02110004
021300         10  FILLER                  PIC  X(11)    VALUE          02120004
021400             'CONTROL NBR'.                                       02130004
021500         10  FILLER                  PIC  X(01)    VALUE SPACE.   02140004
021600         10  FILLER                  PIC  X(10)    VALUE          02150004
021700             'AUDIT TYPE'.                                        02160004
021800         10  FILLER                  PIC  X(01)    VALUE SPACE.   02170004
021900         10  FILLER                  PIC  X(04)    VALUE          02180004
022000             'AREA'.                                              02190004
022100         10  FILLER                  PIC  X(01)    VALUE SPACE.   02200004
022200         10  FILLER                  PIC  X(11)    VALUE          02210004
022300             'AUDIT START'.                                       02220004
022400         10  FILLER                  PIC  X(06)    VALUE SPACE.   02230004
022500         10  FILLER                  PIC  X(10)    VALUE          02240004
022600             'AUDIT STOP'.                                        02250004
022700         10  FILLER                  PIC  X(07)    VALUE SPACE.   02260004
      *CLP 10/13/14                                                             
022800         10  FILLER                  PIC  X(12)    VALUE          02270004
022900             'PO/RECEIVER '.                                      02280004
023000         10  FILLER                  PIC  X(02)    VALUE SPACE.   02290004
023100         10  FILLER                  PIC  X(11)    VALUE          02300004
023200             'VENDOR NAME'.                                       02310004
      *CLP 10/13/14                                                             
023300         10  FILLER                  PIC  X(04)    VALUE SPACE.   02320004
023400         10  FILLER                  PIC  X(04)    VALUE          02330004
023500             'DATE'.                                              02340004
023600         10  FILLER                  PIC  X(07)    VALUE SPACE.   02350004
023700         10  FILLER                  PIC  X(05)    VALUE          02360004
023800             'COUNT'.                                             02370004
023900         10  FILLER                  PIC  X(03)    VALUE SPACE.   02380004
024000         10  FILLER                  PIC  X(06)    VALUE          02390004
024100             'CARTON'.                                            02400004
024200         10  FILLER                  PIC  X(02)    VALUE SPACE.   02410004
024300         10  FILLER                  PIC  X(06)    VALUE          02420004
024400             'CARTON'.                                            02430004
024500         10  FILLER                  PIC  X(08)    VALUE SPACE.   02440004
024600                                                                  02450004
024700 01  MISCELLANEOUS-LINES.                                         02460004
024800     05  END-OF-REPORT-LINE.                                      02470004
024900         10  FILLER                  PIC  X(44)    VALUE SPACES.  02480004
025000         10  FILLER                  PIC  X(45)    VALUE          02490004
025100             '*******   E N D   O F   R E P O R T   *******'.     02500004
025200         10  FILLER                  PIC  X(43)    VALUE SPACES.  02510004
025300                                                                  02520004
025400     05  NO-AUDITS-LINE.                                          02530004
025500         10  FILLER                  PIC  X(10)    VALUE SPACES.  02540004
025600         10  FILLER                  PIC  X(35)    VALUE          02550004
025700             '*******    NO AUDITS TO REPORT FOR '.               02560004
025800         10  NAL-DATE                PIC  X(10)    VALUE SPACES.  02570004
025900         10  FILLER                  PIC  X(11)    VALUE          02580004
026000             '    *******'.                                       02590004
026100         10  FILLER                  PIC  X(66)    VALUE SPACES.  02600004
026200                                                                  02610004
026300 01  DETAIL-LINES.                                                02620004
026400     05  DETAIL-LINE1.                                            02630004
026500         10  DL1-AUD-CNTL-NBR        PIC  X(11)    VALUE SPACES.  02640004
026600         10  FILLER                  PIC  X(01)    VALUE SPACES.  02650004
026700         10  DL1-AUD-TYP             PIC  X(10)    VALUE SPACES.  02660004
026800         10  FILLER                  PIC  X(01)    VALUE SPACES.  02670004
026900         10  DL1-AUD-AREA            PIC  X(04)    VALUE SPACES.  02680004
027000         10  FILLER                  PIC  X(01)    VALUE SPACES.  02690004
027100         10  DL1-AUDIT-START-DT-TIME.                             02700004
027200             15  DL1-AUD-START-MM    PIC  X(02)    VALUE SPACES.  02710004
027300             15  DL1-AUD-START-SLSH1 PIC  X(01)    VALUE SPACES.  02720004
027400             15  DL1-AUD-START-DD    PIC  X(02)    VALUE SPACES.  02730004
027500             15  DL1-AUD-START-SLSH2 PIC  X(01)    VALUE SPACES.  02740004
027600             15  DL1-AUD-START-CCYY  PIC  X(04)    VALUE SPACES.  02750004
027700             15  FILLER              PIC  X(01)    VALUE SPACES.  02760004
027800             15  DL1-AUD-START-HR    PIC  X(02)    VALUE SPACES.  02770004
027900             15  DL1-AUD-START-COLON PIC  X(01)    VALUE SPACES.  02780004
028000             15  DL1-AUD-START-MIN   PIC  X(02)    VALUE SPACES.  02790004
028100         10  FILLER                  PIC  X(01)    VALUE SPACES.  02800004
028200         10  DL1-AUDIT-STOP-DT-TIME.                              02810004
028300             15  DL1-AUD-STOP-MM     PIC  X(02)    VALUE SPACES.  02820004
028400             15  DL1-AUD-STOP-SLSH1  PIC  X(01)    VALUE SPACES.  02830004
028500             15  DL1-AUD-STOP-DD     PIC  X(02)    VALUE SPACES.  02840004
028600             15  DL1-AUD-STOP-SLSH2  PIC  X(01)    VALUE SPACES.  02850004
028700             15  DL1-AUD-STOP-CCYY   PIC  X(04)    VALUE SPACES.  02860004
028800             15  FILLER              PIC  X(01)    VALUE SPACES.  02870004
028900             15  DL1-AUD-STOP-HR     PIC  X(02)    VALUE SPACES.  02880004
029000             15  DL1-AUD-STOP-COLON  PIC  X(01)    VALUE SPACES.  02890004
029100             15  DL1-AUD-STOP-MIN    PIC  X(02)    VALUE SPACES.  02900004
029200         10  FILLER                  PIC  X(01)    VALUE SPACES.  02910004
029300         10  DL1-PO-RECEIVER.                                     02920004
      *CLP 10/13/14 START                                                       
029400             15  DL1-PO              PIC  X(08)    VALUE SPACES.  02930004
029500             15  FILLER              PIC  X(01)    VALUE '-'.     02940004
029600             15  DL1-RECEIVER        PIC  X(04)    VALUE SPACES.  02950004
029700         10  FILLER                  PIC  X(01)    VALUE SPACES.  02960004
029800         10  DL1-VENDOR-NAME         PIC  X(14)    VALUE SPACES.  02970004
      *CLP 10/13/14 END                                                         
029900         10  FILLER                  PIC  X(01)    VALUE SPACES.  02980004
030000         10  DL1-RECEIPT-DATE.                                    02990004
030100             15  DL1-RECEIPT-MM      PIC  X(02)    VALUE SPACES.  03000004
030200             15  DL1-RECEIPT-SLASH1  PIC  X(01)    VALUE SPACES.  03010004
030300             15  DL1-RECEIPT-DD      PIC  X(02)    VALUE SPACES.  03020004
030400             15  DL1-RECEIPT-SLASH2  PIC  X(01)    VALUE SPACES.  03030004
030500             15  DL1-RECEIPT-CCYY    PIC  X(04)    VALUE SPACES.  03040004
030600         10  FILLER                  PIC  X(01)    VALUE SPACES.  03050004
030700         10  DL1-CART-COUNT          PIC  ZZZZZZ9  VALUE ZEROES.  03060004
030800         10  FILLER                  PIC  X(01)    VALUE SPACES.  03070004
030900         10  DL1-ADJ-CARTON          PIC  ZZZZZZ9  VALUE ZEROES.  03080004
031000         10  FILLER                  PIC  X(01)    VALUE SPACES.  03090004
031100         10  DL1-AUDIT-CARTON        PIC  ZZZZZZ9  VALUE ZEROES.  03100004
031200         10  FILLER                  PIC  X(07)    VALUE SPACES.  03110004
031300                                                                  03120004
031400*    LOCATION MODULE                                              03120110
031500     COPY XLWS071.                                                03121010
031600*                                                                 03130004
031700*  COPY BOOK FOR THE SHIPPING UNIT AUDIT TABLE (TSUNAUD)          03140004
031800*                                                                 03150004
031900     EXEC SQL                                                     03160004
032000          INCLUDE TSUNAUD                                         03170004
032100     END-EXEC.                                                    03180004
032200*                                                                 03190004
032300*  COPY BOOK FOR SHIPPING UNIT AUDIT TRANSACTIONS TABLE           03200004
032400*  (TSUATRN)                                                      03210004
032500*                                                                 03220004
032600     EXEC SQL                                                     03230004
032700          INCLUDE TSUATRN                                         03240004
032800     END-EXEC.                                                    03250004
032900*                                                                 03260004
033000*  COPY BOOK FOR THE COMPANY CONTROL TABLE                        03270004
033100*  (TCOCNTL)                                                      03280004
033200*                                                                 03290004
033300     EXEC SQL                                                     03300004
033400          INCLUDE TCOCNTL                                         03310004
033500     END-EXEC.                                                    03320004
033600*                                                                 03330004
033700*  COPY BOOK FOR THE EXTERNAL ENTITY TABLE (TEXTENT)              03340004
033800*                                                                 03350004
033900     EXEC SQL                                                     03360004
034000          INCLUDE TEXTENT                                         03370004
034100     END-EXEC.                                                    03380004
034200*                                                                 03390004
034300*  COPY BOOK FOR RECEIVER TABLE (TRECEIV)                         03400004
034400*                                                                 03410004
034500     EXEC SQL                                                     03420004
034600          INCLUDE TRECEIV                                         03430004
034700     END-EXEC.                                                    03440004
034800*                                                                 03450004
034900*  COPY BOOK FOR THE PURCHASE ORDER TABLE (TPURCHS)               03460004
035000*                                                                 03470004
035100     EXEC SQL                                                     03480004
035200          INCLUDE TPURCHS                                         03490004
035300     END-EXEC.                                                    03500004
035400*                                                                 03570004
035500*  COPY BOOK FOR THE ENTITY NAME TABLE (TENTNME)                  03580004
035600*                                                                 03590004
035700     EXEC SQL                                                     03600004
035800          INCLUDE TENTNME                                         03610004
035900     END-EXEC.                                                    03620004
036000 EJECT                                                            03630004
036100*  DB2 COMMUNICATION AREA                                         03640004
036200*                                                                 03650004
036300     EXEC SQL                                                     03660004
036400         INCLUDE SQLCA                                            03670004
036500     END-EXEC.                                                    03680004
036600 EJECT                                                            03690004
036700*  DB2 COMMUNICATION AREA2                                        03700004
036800*                                                                 03710004
036900     COPY SQLCA2.                                                 03720004
037000 EJECT                                                            03730004
037100******************************************************************03740004
037200**  DECLARE SUAUD CURSOR - THIS WILL RETRIEVE ALL THE             03750004
037300**  AUDIT RECORDS THAT WERE CLOSED ON THE PROCESS DATE            03760004
037400******************************************************************03770004
037500     EXEC SQL                                                     03780004
037600         DECLARE SUAUD_CURSOR CURSOR FOR                          03790004
037700             SELECT AUD_CNTL_NBR                                  03800004
037800                   ,AUD_TYP_CDE                                   03810004
037900                   ,OPER_UNT_ID                                   03820004
038000                   ,FCLTY_ID                                      03830004
038100                   ,PRC_FCLTY_AREA_ID                             03840004
038200                   ,AUD_STRT_TMST                                 03850004
038300                   ,AUD_STP_TMST                                  03860004
      *SB 11/04/13 - BEGIN PR#5148D                                             
                         ,AUD_CAT_CDE                                           
      *SB 11/04/13 - END PR#5148D                                               
038400             FROM   TSUNAUD                                       03870004
038500             WHERE  AUD_STAT_CDE = 'CM'                           03880004
038600               AND  DATE(AUD_STP_TMST) = :PV-DB2-COMPARE-DATE     03890006
038700          ORDER BY  OPER_UNT_ID,  AUD_STP_TMST                    03900004
038800     END-EXEC.                                                    03910004
038900 EJECT                                                            03920004
039000                                                                  03930004
039100******************************************************************03940004
039200**  DECLARE POREC CURSOR - THIS WILL RETRIEVE ALL THE             03950004
039300**  PO/RECEIVERS ATTACHED TO THE AUDIT CONTROL NBR                03960004
039400******************************************************************03970004
039500     EXEC SQL                                                     03980004
039600         DECLARE POREC_CURSOR CURSOR FOR                          03990004
039700             SELECT  DISTINCT(TRN_NBR)                            04000004
039800                   , REC_SEQ_NBR                                  04010004
039900                   , COUNT(*)                                     04020004
040000               FROM  TSUATRN                                      04030004
040100              WHERE  AUD_CNTL_NBR = :SUNAUD-AUD-CNTL-NBR          04040004
040200           GROUP BY  TRN_NBR, REC_SEQ_NBR                         04050004
040300     END-EXEC.                                                    04060004
040400 EJECT                                                            04070004
040500                                                                  04080004
040600 PROCEDURE DIVISION.                                              04090004
040700                                                                  04100004
040800******************************************************************04110004
040900**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      04120004
041000******************************************************************04130004
041100 0000-MAINLINE-PROCESSING.                                        04140004
041200                                                                  04150004
041300     PERFORM 0100-INITIALIZATION.                                 04160004
041400                                                                  04170004
041500     PERFORM 0200-PROCESS                                         04180004
041600         UNTIL PS-END-OF-SUA-CURSOR.                              04190004
041700                                                                  04200004
041800     PERFORM 9000-EOJ.                                            04210004
041900     STOP RUN.                                                    04220004
042000                                                                  04230004
042100                                                                  04240004
042200******************************************************************04250004
042300**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               04260004
042400******************************************************************04270004
042500 0100-INITIALIZATION.                                             04280004
042600     OPEN OUTPUT SU-CARTON-AUDIT-RPT-FILE.                        04290004
042700     ACCEPT PV-TODAYS-DATE                                        04300004
042800       FROM DATE.                                                 04310004
042900                                                                  04320004
043000     ACCEPT PV-TODAYS-TIME                                        04330004
043100       FROM TIME.                                                 04340004
043200                                                                  04350004
043300******* SET UP HEADERS **********                                 04360004
043400     MOVE PC-REPORT-NBR      TO DP132O-REPORT-NUMBER.             04370004
043500     MOVE PV-TODAYS-DATE-MM  TO DP132O-RUN-MONTH.                 04380004
043600     MOVE PV-TODAYS-DATE-DD  TO DP132O-RUN-DAY.                   04390004
043700     MOVE PV-TODAYS-DATE-YY  TO DP132O-RUN-YEAR.                  04400004
043800                                                                  04410004
043900     MOVE PV-TODAYS-TIME-HH  TO DP132O-RUN-HOUR.                  04420004
044000     MOVE PV-TODAYS-TIME-MM  TO DP132O-RUN-MINUTE.                04430004
044100     MOVE PC-SUKRP017        TO DP132O-PROGRAM-NAME.              04440004
044200                                                                  04450004
044300     PERFORM 1000-SELECT-PROCESS-DT.                              04460004
044400     MOVE PC-PROC-CC         TO HL1-PROC-CC.                      04470004
044500     MOVE PC-PROC-YY         TO HL1-PROC-YY.                      04480004
044600     MOVE PC-PROC-MM         TO HL1-PROC-MM.                      04490004
044700     MOVE PC-PROC-DD         TO HL1-PROC-DD.                      04500004
044800                                                                  04510004
044900     PERFORM 7000-OPEN-SUAUD-CURSOR.                              04520004
045000     PERFORM 1100-FETCH-TSUNAUD.                                  04530004
045100     MOVE SUNAUD-OPER-UNT-ID TO PV-HOLD-FACILITY                  04540004
045200                                PV-CURR-FACILITY                  04550004
045300                                HL2-FACILITY-NBR.                 04560004
045400     PERFORM 1300-SELECT-FACILITY-NME.                            04570004
045500     MOVE XL071-LOC-NM       TO HL2-FACILITY-DESC.                04580004
045600     PERFORM 8000-WRITE-REPORT-HEADERS.                           04590004
045700                                                                  04600004
045800 0200-PROCESS.                                                    04610004
045900     MOVE SUNAUD-OPER-UNT-ID     TO PV-CURR-FACILITY.             04620004
046000     IF PV-CURR-FACILITY     =   PV-HOLD-FACILITY                 04630004
046100         CONTINUE                                                 04640004
046200     ELSE                                                         04650004
046300         PERFORM 1300-SELECT-FACILITY-NME                         04660004
046400         MOVE XL071-LOC-NM       TO HL2-FACILITY-DESC             04670004
046500         MOVE SUNAUD-OPER-UNT-ID TO HL2-FACILITY-NBR              04680004
046600         PERFORM 8000-WRITE-REPORT-HEADERS                        04690004
046700         MOVE PV-CURR-FACILITY   TO PV-HOLD-FACILITY              04700004
046800     END-IF.                                                      04710004
046900                                                                  04720004
047000     MOVE SUNAUD-AUD-CNTL-NBR  TO PV-CURR-AUD-CNTL-NBR.           04730004
047100     IF PV-CURR-AUD-CNTL-NBR  =  PV-HOLD-AUD-CNTL-NBR             04740004
047200         CONTINUE                                                 04750004
047300     ELSE                                                         04760004
047400         PERFORM 8500-WRITE-BLANK-LINE                            04770004
047500         MOVE SUNAUD-AUD-CNTL-NBR    TO DL1-AUD-CNTL-NBR          04780004
047600                                    PV-HOLD-AUD-CNTL-NBR          04790004
      *SB 11/04/13 - BEGIN PR#5148D                                             
      * ADDED LOGIC TO HAVE 'RFID' AUDIT TYPE IF AUDIT CATEGORY IS 'R'          
               IF SUNAUD-AUD-CAT-CDE = 'R'                                      
                  MOVE PC-RFID                  TO DL1-AUD-TYP                  
               ELSE                                                             
047700            EVALUATE SUNAUD-AUD-TYP-CDE                           04800004
047800                WHEN '01'                                         04810004
047900                    MOVE PC-100-PCT-CHECK TO DL1-AUD-TYP          04820004
048000                WHEN '02'                                         04830004
048100                    MOVE PC-SPOT-CHECK    TO DL1-AUD-TYP          04840004
048200                WHEN '03'                                         04850004
048300                    MOVE PC-REWORK        TO DL1-AUD-TYP          04860004
048400                WHEN OTHER                                        04870004
048500                    MOVE PC-UNKNOWN       TO DL1-AUD-TYP          04880004
048600            END-EVALUATE                                          04890004
               END-IF                                                           
      *SB 11/04/13 - END PR#5148D                                               
048700                                                                  04900004
048800         MOVE SUNAUD-PRC-FCLTY-AREA-ID TO DL1-AUD-AREA            04910004
048900                                                                  04920004
049000         MOVE SUNAUD-AUD-STRT-TMST TO PV-DB2-TMST                 04930004
049100         MOVE PV-DB2-TMST-MM       TO DL1-AUD-START-MM            04940004
049200         MOVE PV-DB2-TMST-DD       TO DL1-AUD-START-DD            04950004
049300         MOVE PV-DB2-TMST-CCYY     TO DL1-AUD-START-CCYY          04960004
049400         MOVE PV-DB2-TMST-HH       TO DL1-AUD-START-HR            04970004
049500         MOVE PV-DB2-TMST-MN       TO DL1-AUD-START-MIN           04980004
049600         MOVE PC-SLASH             TO DL1-AUD-START-SLSH1         04990004
049700                                      DL1-AUD-START-SLSH2         05000004
049800         MOVE PC-COLON             TO DL1-AUD-START-COLON         05010004
049900                                                                  05020004
050000         MOVE SUNAUD-AUD-STP-TMST  TO PV-DB2-TMST                 05030004
050100         MOVE PV-DB2-TMST-MM       TO DL1-AUD-STOP-MM             05040004
050200         MOVE PV-DB2-TMST-DD       TO DL1-AUD-STOP-DD             05050004
050300         MOVE PV-DB2-TMST-CCYY     TO DL1-AUD-STOP-CCYY           05060004
050400         MOVE PV-DB2-TMST-HH       TO DL1-AUD-STOP-HR             05070004
050500         MOVE PV-DB2-TMST-MN       TO DL1-AUD-STOP-MIN            05080004
050600         MOVE PC-SLASH             TO DL1-AUD-STOP-SLSH1          05090004
050700                                      DL1-AUD-STOP-SLSH2          05100004
050800         MOVE PC-COLON             TO DL1-AUD-STOP-COLON          05110004
050900     END-IF.                                                      05120004
051000                                                                  05130004
051100     PERFORM 7200-OPEN-POREC-CURSOR.                              05140004
051200     SET PS-FIRST-TIME             TO TRUE.                       05150004
051300     PERFORM 1200-FETCH-PO-RECEIVERS.                             05160004
051400     PERFORM 2000-GET-INFO                                        05170004
051500         UNTIL PS-NO-MORE-PO-RECEIVERS.                           05180004
051600     PERFORM 7300-CLOSE-POREC-CURSOR.                             05190004
051700                                                                  05200004
051800     PERFORM 1100-FETCH-TSUNAUD.                                  05210004
051900                                                                  05220004
052000******************************************************************05230004
052100**  SELECT INFORMATION FROM TCOCNTL TO OBTAIN PROCESSING DATE     05240004
052200******************************************************************05250004
052300 1000-SELECT-PROCESS-DT.                                          05260004
052400     INITIALIZE DCLTCOCNTL.                                       05270004
052500                                                                  05280004
052600     MOVE '1000-SELECT-PROCESS-DT'                                05290004
052700                                 TO PV-ABEND-PARAGRAPH.           05300004
052800     EXEC SQL                                                     05310004
052900       SELECT  CURRENT DATE - 1 DAY                               05320004
053000         INTO  :PV-DB2-DATE                                       05330004
053100         FROM  TCOCNTL                                            05340004
053200        WHERE  OPER_UNT_ID = 085                                  05350004
053300     END-EXEC.                                                    05360004
053400                                                                  05370004
053500     EVALUATE TRUE                                                05380004
053600       WHEN SQLCODE = ZEROS                                       05390004
053700         MOVE PV-DB2-DATE TO PC-PROCESS-DATE                      05400004
053800                             PV-DB2-COMPARE-DATE                  05401008
053900       WHEN OTHER                                                 05410004
054000         DISPLAY PV-ABEND-PARAGRAPH                               05420004
054100         PERFORM 9999-SQL-ERROR                                   05430004
054200     END-EVALUATE.                                                05440004
054300                                                                  05450004
054400                                                                  05460004
054500******************************************************************05470004
054600**  FETCH  INFORMATION FROM THE SHIPPING UNIT AUDIT TABLE FOR THE 05480004
054700**  HEADER PORTION OF THE REPORT.                                 05490004
054800******************************************************************05500004
054900 1100-FETCH-TSUNAUD.                                              05510004
055000     INITIALIZE DCLTSUNAUD.                                       05520004
055200     MOVE '1100-FETCH-TSUNAUD '                                   05540004
055300                                 TO PV-ABEND-PARAGRAPH.           05550004
055400     EXEC SQL                                                     05560004
055500         FETCH SUAUD_CURSOR                                       05570004
055600         INTO  :SUNAUD-AUD-CNTL-NBR                               05580004
055700              ,:SUNAUD-AUD-TYP-CDE                                05590004
055800              ,:SUNAUD-OPER-UNT-ID                                05600004
055900              ,:SUNAUD-FCLTY-ID                                   05610004
056000              ,:SUNAUD-PRC-FCLTY-AREA-ID                          05620004
056100              ,:SUNAUD-AUD-STRT-TMST                              05630004
056200              ,:SUNAUD-AUD-STP-TMST                               05640004
      *SB 11/04/13 - BEGIN PR#5148D                                             
                    ,:SUNAUD-AUD-CAT-CDE                                05640004
      *SB 11/04/13 - END PR#5148D                                               
056300     END-EXEC.                                                    05650004
056400                                                                  05660004
056500     EVALUATE TRUE                                                05670004
056600       WHEN SQLCODE = ZEROS                                       05680004
056700         CONTINUE                                                 05690004
056800       WHEN SQLCODE = +100                                        05700004
056900           SET PS-END-OF-SUA-CURSOR TO TRUE                       05710004
057000       WHEN OTHER                                                 05720004
057100         DISPLAY PV-ABEND-PARAGRAPH                               05730004
057200         MOVE 'SELECT HEADER INFO '                               05740004
057300                           TO    PV-DB2-OPERATION-ATTEMPTED       05750004
057400         PERFORM 9999-SQL-ERROR                                   05760004
057500     END-EVALUATE.                                                05770004
057600                                                                  05780004
057700                                                                  05790004
057800******************************************************************05800004
057900**  FETCH  INFORMATION FROM TSUATRN TO OBTAIN PO/RECEIVERS FOR    05810004
058000**  EACH AUDIT CONTROL NUMBER                                     05820004
058100******************************************************************05830004
058200 1200-FETCH-PO-RECEIVERS.                                         05840004
058300     INITIALIZE DCLTSUATRN.                                       05850004
058400                                                                  05860004
058500     MOVE '1200-FETCH-PO-RECEIVERS'                               05870004
058600                                 TO PV-ABEND-PARAGRAPH.           05880004
058700     EXEC SQL                                                     05890004
058800       FETCH POREC_CURSOR                                         05900004
058900        INTO :SUATRN-TRN-NBR                                      05910004
059000           , :SUATRN-REC-SEQ-NBR                                  05920004
059100           , :PV-AUDIT-CART-COUNT                                 05930004
059200     END-EXEC.                                                    05940004
059300                                                                  05950004
059400     EVALUATE TRUE                                                05960004
059500       WHEN SQLCODE = ZEROS                                       05970004
059600         CONTINUE                                                 05980004
059700       WHEN SQLCODE = +100                                        05990004
059800         CONTINUE                                                 06000004
059900       WHEN OTHER                                                 06010004
060000         DISPLAY PV-ABEND-PARAGRAPH                               06020004
060100         DISPLAY SUNAUD-AUD-CNTL-NBR                              06030004
060200         MOVE 'SELECT PO/RECEIVERS'                               06040004
060300                           TO    PV-DB2-OPERATION-ATTEMPTED       06050004
060400         PERFORM 9999-SQL-ERROR                                   06060004
060500     END-EVALUATE.                                                06070004
060600                                                                  06080004
060700******************************************************************06090004
060800**  SELECT THE FACILITY NAME TO DISPLAY IN THE HEADING OF THE     06100004
060900**  REPORT                                                        06110004
061000******************************************************************06120004
061100 1300-SELECT-FACILITY-NME.                                        06130004
061200                                                                          
061300     MOVE '1300-SELECT-FACILITY-NME' TO PV-ABEND-PARAGRAPH.       06160004
061400                                                                          
061500     INITIALIZE XL071-COMMAREA-REC.                               00050001
061600     MOVE SUNAUD-OPER-UNT-ID    TO XL071-LOCATION-NUMBER          00060001
061700                                                                  00070001
061800     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.         00080001
061900                                                                  00090001
062000     EVALUATE TRUE                                                00100001
062100     WHEN XL071-NO-ERRORS                                         00110001
062200         CONTINUE                                                 00140001
062300     WHEN XL071-LOC-NOT-FOUND                                     00120001
062400     WHEN XL071-DC-ASGMT-NOT-FND                                  00130001
062500         MOVE 'UNKNOWN FACILITY' TO XL071-LOC-NM                  06320004
062600     WHEN XL071-BAD-DB2-RETURN                                    00150001
062700         DISPLAY '1300-SELECT-FACILITY-NME'                       00160001
062800         DISPLAY 'CALL LOCATION MOD '                             00170001
062900         DISPLAY 'XLT00010'                                       00180001
063000         DISPLAY PV-ABEND-PARAGRAPH                               06340004
063100         DISPLAY 'OPER UNT ID  ' SUNAUD-OPER-UNT-ID               06350004
063200         DISPLAY 'FCLTY ID     ' SUNAUD-FCLTY-ID                  06360004
063300         MOVE 'SELECT FACILITY NAME'                              06370004
063400                           TO    PV-DB2-OPERATION-ATTEMPTED       06380004
063500         MOVE XL071-SQLCA             TO SQLCA                    00190001
063600         PERFORM 9999-SQL-ERROR                                   00200001
063700     END-EVALUATE.                                                00210001
063800/                                                                 06170004
063900******************************************************************06420004
064000**  SELECT THE RECEIPT DATE AND CARTON COUNTS IF REC_SEQ_NBR      06430004
064100**  GREATER THAN ZERO                                             06440004
064200******************************************************************06450004
064300 1400-SELECT-RECEIVER-INFO.                                       06460004
064400     INITIALIZE DCLTRECEIV.                                       06470004
064500                                                                  06480004
064600     MOVE '1400-SELECT-RECEIVER-INFO' TO PV-ABEND-PARAGRAPH.      06490004
064700                                                                  06500004
064800     EXEC SQL                                                     06510004
064900       SELECT  DATE(REC_TMST)                                     06520004
065000             , EXPTED_CART_CNT                                    06530004
065100             , ACTL_CART_CNT                                      06540004
065200         INTO  :PV-DB2-DATE                                       06550004
065300             , :RECEIV-EXPTED-CART-CNT                            06560004
065400             , :RECEIV-ACTL-CART-CNT                              06570004
065500         FROM  TRECEIV                                            06580004
065600        WHERE  ORD_NBR     = :SUATRN-TRN-NBR                      06590004
065700          AND  REC_SEQ_NBR = :SUATRN-REC-SEQ-NBR                  06600004
065800     END-EXEC.                                                    06610004
065900                                                                  06620004
066000     EVALUATE TRUE                                                06630004
066100       WHEN SQLCODE = ZEROS                                       06640004
066200         MOVE PV-DB2-DATE TO PV-RECEIPT-DATE                      06650004
066300       WHEN SQLCODE = +100                                        06660004
066400         MOVE SPACES             TO DL1-RECEIPT-DATE              06670004
066500         MOVE ZEROS              TO DL1-CART-COUNT                06680004
066600                                    DL1-ADJ-CARTON                06690004
066700       WHEN OTHER                                                 06700004
066800         DISPLAY PV-ABEND-PARAGRAPH                               06710004
066900         DISPLAY 'AUD-CNTL-NBR '  SUNAUD-AUD-CNTL-NBR             06720004
067000         DISPLAY 'TRN-NBR '  SUATRN-TRN-NBR                       06730004
067100         DISPLAY 'REC-SEQ-NBR ' SUATRN-REC-SEQ-NBR                06740004
067200         MOVE 'SELECT RECEIVER INFO'                              06750004
067300                           TO    PV-DB2-OPERATION-ATTEMPTED       06760004
067400         PERFORM 9999-SQL-ERROR                                   06770004
067500     END-EVALUATE.                                                06780004
067600                                                                  06790004
067700******************************************************************06800004
067800**  SELECT THE VENDOR NAME                                        06810004
067900******************************************************************06820004
068000 1500-SELECT-VENDOR-NAME.                                         06830004
068100     INITIALIZE DCLTENTNME                                        06840004
068200                DCLTEXTENT                                        06850004
068300                DCLTPURCHS.                                       06860004
068400                                                                  06870004
068500     MOVE '1500-SELECT-VENDOR-NAME' TO PV-ABEND-PARAGRAPH.        06880004
068600                                                                  06890004
068700     EXEC SQL                                                     06900004
068800       SELECT  ENT_NAME_DESC                                      06910004
068900         INTO  :ENTNME-ENT-NAME-DESC                              06920004
069000         FROM  TENTNME A                                          06930004
069100             , TEXTENT B                                          06940004
069200             , TPURCHS C                                          06950004
069300        WHERE  C.PO_NBR    = :SUATRN-TRN-NBR                      06960004
069400          AND  C.VER_STATUS_CDE = 'A'                             06970004
069500          AND  A.SEQ_NBR =                                        06980004
069600                   (SELECT MAX(SEQ_NBR)                           06990004
069700                    FROM TENTNME                                  07000004
069800                    WHERE ENT_ID = C.ENT_ID                       07010004
069900                      AND TYPE_CDE = '01')                        07020004
070000          AND  A.ENT_ID = B.ENT_ID                                07030004
070100          AND  B.ENT_ID = C.ENT_ID                                07040004
070200     END-EXEC.                                                    07050004
070300                                                                  07060004
070400     EVALUATE TRUE                                                07070004
070500       WHEN SQLCODE = ZEROS                                       07080004
070600         CONTINUE                                                 07090004
070700       WHEN SQLCODE = +100                                        07100004
070800         MOVE 'UNKNOWN VENDOR' TO ENTNME-ENT-NAME-DESC            07110004
070900       WHEN OTHER                                                 07120004
071000         DISPLAY PV-ABEND-PARAGRAPH                               07130004
071100         DISPLAY 'AUD-CNTL-NBR ' SUNAUD-AUD-CNTL-NBR              07140004
071200         DISPLAY 'TRN-NBR ' SUATRN-TRN-NBR                        07150004
071300         MOVE 'SELECT VENDOR NAME'                                07160004
071400                           TO    PV-DB2-OPERATION-ATTEMPTED       07170004
071500         PERFORM 9999-SQL-ERROR                                   07180004
071600     END-EVALUATE.                                                07190004
071700                                                                  07200004
071800 2000-GET-INFO.                                                   07210004
071900     IF SQLCODE = +100                                            07220004
072000         SET PS-NO-MORE-PO-RECEIVERS  TO TRUE                     07230004
072100         MOVE ZEROS                  TO DL1-AUDIT-CARTON          07240004
072200                                        PV-PO                     07250004
072300                                        PV-RECEIVER               07260004
072400     ELSE                                                         07270004
072500         MOVE PV-AUDIT-CART-COUNT    TO DL1-AUDIT-CARTON          07280004
072600         MOVE SUATRN-TRN-NBR         TO PV-PO                     07290004
072700         MOVE SUATRN-REC-SEQ-NBR     TO PV-RECEIVER               07300004
072800     END-IF.                                                      07310004
072900     MOVE PV-PO-RECEIVER         TO DL1-PO-RECEIVER.              07320004
073000                                                                  07330004
073100     IF SUATRN-REC-SEQ-NBR = ZEROS                                07340004
073200         MOVE SPACES             TO DL1-RECEIPT-DATE              07350004
073300         MOVE ZEROS              TO DL1-CART-COUNT                07360004
073400                                    DL1-ADJ-CARTON                07370004
073500     ELSE                                                         07380004
073600         SET PS-RECEIVER-FOUND   TO TRUE                          07390004
073700         PERFORM 1400-SELECT-RECEIVER-INFO                        07400004
073800         IF PS-RECEIVER-FOUND                                     07410004
073900             MOVE PV-DB2-DATE        TO PV-DB2-TMST               07420004
074000             MOVE PV-DB2-TMST-MM     TO DL1-RECEIPT-MM            07430004
074100             MOVE PV-DB2-TMST-DD     TO DL1-RECEIPT-DD            07440004
074200             MOVE PV-DB2-TMST-CCYY   TO DL1-RECEIPT-CCYY          07441004
074300             MOVE PC-SLASH           TO DL1-RECEIPT-SLASH1        07442004
074400                                        DL1-RECEIPT-SLASH2        07443004
074500             MOVE RECEIV-EXPTED-CART-CNT TO DL1-CART-COUNT        07444004
074600             MOVE RECEIV-ACTL-CART-CNT   TO DL1-ADJ-CARTON        07445004
074700         ELSE                                                     07446004
074800             MOVE SPACES             TO DL1-RECEIPT-DATE          07447004
074900             MOVE ZEROS              TO DL1-CART-COUNT            07448004
075000                                        DL1-ADJ-CARTON            07449004
075100         END-IF                                                   07449104
075200     END-IF.                                                      07449204
075300                                                                  07449304
075400     PERFORM 1500-SELECT-VENDOR-NAME.                             07449404
075500     MOVE ENTNME-ENT-NAME-DESC   TO DL1-VENDOR-NAME               07449504
075600                                                                  07449604
075700     IF (PS-FIRST-TIME   AND  PS-NO-MORE-PO-RECEIVERS) OR         07449704
075800          PS-MORE-PO-RECEIVERS                                    07449804
075900         PERFORM 8400-WRITE-DETAIL-LINES                          07449904
076000         INITIALIZE DETAIL-LINES                                  07450004
076100     END-IF.                                                      07451004
076200     SET PS-NOT-FIRST-TIME  TO TRUE.                              07451104
076300     PERFORM 1200-FETCH-PO-RECEIVERS.                             07451204
076400                                                                  07451304
076500******************************************************************07451404
076600*  OPEN CURSOR FOR TSUNAUD TABLE                                 *07451504
076700******************************************************************07451604
076800 7000-OPEN-SUAUD-CURSOR.                                          07451704
076900                                                                  07451804
077000     EXEC SQL                                                     07451904
077100         OPEN SUAUD_CURSOR                                        07452004
077200     END-EXEC.                                                    07453004
077300                                                                  07454004
077400     EVALUATE TRUE                                                07455004
077500         WHEN SQLCODE = ZERO                                      07456004
077600             SET PS-NOT-END-OF-SUA-CURSOR   TO TRUE               07457004
077700         WHEN SQLWARN0 NOT EQUAL SPACE                            07458004
077800         WHEN SQLCODE  NOT EQUAL ZERO                             07459004
077900             MOVE '7000-OPEN-SUAUD-CURSOR'                        07460004
078000                           TO    PV-ABEND-PARAGRAPH               07470004
078100             MOVE 'OPEN  SUAUD_CURSOR'                            07480004
078200                           TO    PV-DB2-OPERATION-ATTEMPTED       07490004
078300             PERFORM 9999-SQL-ERROR                               07500004
078400     END-EVALUATE.                                                07510004
078500                                                                  07520004
078600******************************************************************07530004
078700*  CLOSE CURSOR FOR TSUNAUD TABLE                                *07540004
078800******************************************************************07550004
078900 7100-CLOSE-SUAUD-CURSOR.                                         07560004
079000                                                                  07570004
079100     EXEC SQL                                                     07580004
079200         CLOSE SUAUD_CURSOR                                       07590004
079300     END-EXEC.                                                    07600004
079400                                                                  07610004
079500     EVALUATE TRUE                                                07620004
079600         WHEN SQLWARN0 NOT EQUAL SPACE                            07630004
079700         WHEN SQLCODE  NOT EQUAL ZERO                             07640004
079800             MOVE '7100-CLOSE-SUAUD-CURSOR'                       07650004
079900                           TO    PV-ABEND-PARAGRAPH               07660004
080000             MOVE 'CLOSE SUAUD_CURSOR'                            07670004
080100                           TO    PV-DB2-OPERATION-ATTEMPTED       07680004
080200             PERFORM 9999-SQL-ERROR                               07690004
080300     END-EVALUATE.                                                07700004
080400                                                                  07710004
080500******************************************************************07720004
080600*  OPEN CURSOR FOR TSUATRN TABLE                                 *07730004
080700******************************************************************07740004
080800 7200-OPEN-POREC-CURSOR.                                          07750004
080900                                                                  07760004
081000     EXEC SQL                                                     07770004
081100         OPEN POREC_CURSOR                                        07780004
081200     END-EXEC.                                                    07790004
081300                                                                  07800004
081400     EVALUATE TRUE                                                07810004
081500         WHEN SQLCODE = ZERO                                      07820004
081600             SET PS-MORE-PO-RECEIVERS        TO TRUE              07830004
081700         WHEN SQLWARN0 NOT EQUAL SPACE                            07840004
081800         WHEN SQLCODE  NOT EQUAL ZERO                             07850004
081900             MOVE '7200-OPEN-POREC-CURSOR'                        07860004
082000                           TO    PV-ABEND-PARAGRAPH               07870004
082100             MOVE 'OPEN  POREC_CURSOR'                            07880004
082200                           TO    PV-DB2-OPERATION-ATTEMPTED       07890004
082300             PERFORM 9999-SQL-ERROR                               07900004
082400     END-EVALUATE.                                                07910004
082500                                                                  07920004
082600******************************************************************07930004
082700*  CLOSE CURSOR FOR TSUATRN TABLE                                *07940004
082800******************************************************************07950004
082900 7300-CLOSE-POREC-CURSOR.                                         07960004
083000                                                                  07970004
083100     EXEC SQL                                                     07980004
083200         CLOSE POREC_CURSOR                                       07990004
083300     END-EXEC.                                                    08000004
083400                                                                  08010004
083500     EVALUATE TRUE                                                08020004
083600         WHEN SQLWARN0 NOT EQUAL SPACE                            08030004
083700         WHEN SQLCODE  NOT EQUAL ZERO                             08040004
083800             MOVE '7300-CLOSE-POREC-CURSOR'                       08050004
083900                           TO    PV-ABEND-PARAGRAPH               08060004
084000             MOVE 'CLOSE POREC_CURSOR'                            08070004
084100                           TO    PV-DB2-OPERATION-ATTEMPTED       08080004
084200             PERFORM 9999-SQL-ERROR                               08090004
084300     END-EVALUATE.                                                08100004
084400                                                                  08110004
084500******************************************************************08120004
084600*  PRINT THE HEADING FOR THE REPORT.                             *08130004
084700******************************************************************08140004
084800 8000-WRITE-REPORT-HEADERS.                                       08150004
084900     PERFORM 8200-WRITE-TOP-LINE.                                 08160004
085000                                                                  08170004
085100     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08180004
085200       FROM HEADING-LINE-0                                        08190004
085300         AFTER ADVANCING 2 LINE.                                  08200004
085400                                                                  08210004
085500     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08220004
085600       FROM HEADING-LINE-1                                        08230004
085700         AFTER ADVANCING 1 LINE.                                  08240004
085800                                                                  08250004
085900     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08260004
086000       FROM HEADING-LINE-2                                        08270004
086100         AFTER ADVANCING 3 LINES.                                 08280004
086200                                                                  08290004
086300     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08300004
086400       FROM HEADING-LINE-3                                        08310004
086500         AFTER ADVANCING 2 LINES.                                 08320004
086600                                                                  08330004
086700     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08340004
086800       FROM HEADING-LINE-4                                        08350004
086900         AFTER ADVANCING 1 LINES.                                 08360004
087000                                                                  08370004
087100     MOVE PC-10                   TO PV-LINE-CNT.                 08380004
087200                                                                  08390004
087300******************************************************************08400004
087400*     WRITES STANDARD HEADING LINE WHEN MORE THAN 1  PAGE IS     *08410004
087500*     NEEDED                                                     *08420004
087600******************************************************************08430004
087700 8200-WRITE-TOP-LINE.                                             08440004
087800     ADD 1                        TO PV-PAGE-CNT.                 08450004
087900                                                                  08460004
088000     MOVE PV-PAGE-CNT             TO DP132O-PAGE-NUMBER.          08470004
088100                                                                  08480004
088200     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08490004
088300       FROM DP132O-STANDRD-HEADER-132-COLS                        08500004
088400         AFTER ADVANCING PAGE.                                    08510004
088500                                                                  08520004
088600******************************************************************08530004
088700*     WRITES THE DETAIL LINE INFORMATION.                        *08540004
088800******************************************************************08550004
088900 8400-WRITE-DETAIL-LINES.                                         08560004
089000     IF PV-LINE-CNT >= PC-MAX-RPT-LINES                           08570004
089100         PERFORM 8000-WRITE-REPORT-HEADERS                        08580004
089200     ELSE                                                         08590004
089300         WRITE SU-CARTON-AUDIT-RPT-RECORD                         08600004
089400           FROM DETAIL-LINE1                                      08610004
089500           AFTER ADVANCING 1 LINE.                                08620004
089600                                                                  08630004
089700     ADD +1                          TO PV-LINE-CNT.              08640004
089800     ADD +1                          TO PV-DETAIL-LINE-CNT.       08650004
089900                                                                  08660004
090000******************************************************************08670004
090100*     WRITES BLANK LINE                                          *08680004
090200******************************************************************08690004
090300 8500-WRITE-BLANK-LINE.                                           08700004
090400     IF PV-LINE-CNT >= PC-MAX-RPT-LINES                           08710004
090500         PERFORM 8000-WRITE-REPORT-HEADERS                        08720004
090600     ELSE                                                         08730004
090700         WRITE SU-CARTON-AUDIT-RPT-RECORD                         08740004
090800           FROM PC-BLANK-LINE                                     08750004
090900           AFTER ADVANCING 1 LINE.                                08760004
091000                                                                  08770004
091100     ADD +1                          TO PV-LINE-CNT.              08780004
091200                                                                  08790004
091300******************************************************************08800004
091400*    END OF JOB PROCESSING                                       *08810004
091500******************************************************************08820004
091600 9000-EOJ.                                                        08830004
091700     IF PV-DETAIL-LINE-CNT = ZERO                                 08840004
091800         MOVE HL1-PROCESS-DT TO NAL-DATE                          08850004
091900         WRITE SU-CARTON-AUDIT-RPT-RECORD                         08860004
092000            FROM NO-AUDITS-LINE                                   08870004
092100            AFTER ADVANCING 3 LINES.                              08880004
092200                                                                  08890004
092300                                                                  08900004
092400     WRITE SU-CARTON-AUDIT-RPT-RECORD                             08910004
092500       FROM END-OF-REPORT-LINE                                    08911004
092600         AFTER ADVANCING 2 LINES.                                 08912004
092700                                                                  08913004
092800     CLOSE SU-CARTON-AUDIT-RPT-FILE.                              08914004
092900     PERFORM 7100-CLOSE-SUAUD-CURSOR.                             08915004
093000                                                                  08916004
093100******************************************************************08917004
093200*     SQL WARNING OR ERROR PROCESSING                            *08918004
093300******************************************************************08919004
093400 9999-SQL-ERROR.                                                  08920004
093500                                                                  08930004
093600     DISPLAY '** ABEND **       ** = SQLERROR'.                   08940004
093700     DISPLAY '** PROGRAM        ** = SUKRP017'.                   08950004
093800     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        08960004
093900     DISPLAY '** OPERATION      ** = ' PV-DB2-OPERATION-ATTEMPTED 08970004
094000                                                                  08980004
094100******************************************************************08990004
094200*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-  *09000004
094300*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE       *09010004
094400*  'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE   *09020004
094500*  FORMAT.                                                       *09030004
094600******************************************************************09040004
094700*    COPY DPPD004.                                                09050004
094800     COPY DPPD004.                                                09060004
094900                                                                  09070004
095000     MOVE +4013 TO PV-ABEND-CODE.                                 09080004
095100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09090004
