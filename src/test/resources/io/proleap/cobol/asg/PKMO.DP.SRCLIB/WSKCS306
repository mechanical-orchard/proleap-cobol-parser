000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'SHIPPING CONTROL MODULE'.                                 00020000
000810*                                                                 00030000
000820 PROGRAM-ID.   WSKCS306.                                          00040000
000830 AUTHOR.        JEAN KURKOWSKI.                                   00050000
000840 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000850 DATE-WRITTEN.  FEBRUARY 2007.                                    00070000
000860 DATE-COMPILED.                                                   00080000
000870 ENVIRONMENT DIVISION.                                            00090000
000880 CONFIGURATION SECTION.                                           00100000
000890 SOURCE-COMPUTER. IBM-3090.                                       00110000
000900 OBJECT-COMPUTER. IBM-3090.                                       00120000
001000                                                                  00130000
001100 DATA DIVISION.                                                   00140000
001200 WORKING-STORAGE SECTION.                                         00150000
001300 01  PV-VARIABLES.                                                00160029
002200     05  PV-CURRENT-TIMESTAMP         PIC X(26) VALUE SPACES.     00170015
002300     05  PV-SQL-RETURN-CD             PIC S9(04) VALUE +0.        00180029
002400     05  PV-SHIPMNT-NBR               PIC X(20)  VALUE SPACES.    00190029
002410     05  PV-SHIPMNT-NBR-R REDEFINES PV-SHIPMNT-NBR.               00200029
002450         10  PV-K                     PIC X(1).                   00210006
002460         10  PV-RANDOM-NBR            PIC 9(09).                  00220033
002461         10  PV-D                     PIC X(1).                   00230006
002462         10  PV-DUMMY-NBR             PIC 9(04).                  00240006
002463         10  PV-UNUSED                PIC X(05).                  00250012
002464     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     00260029
002465                                                     COMP SYNC.   00270029
002466     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00280029
002467     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00290029
002468                                                     COMP SYNC.   00300029
002470                                                                  00310006
002480                                                                  00320006
003300 01  WS-FIELDS.                                                   00330000
003400     05  WS-EXT-SHP-ID                PIC X(20).                  00340012
003410     05  WS-TRIP-ID                   PIC S9(09) COMP.            00350003
003501     05  WS-RCPT-TMST                 PIC X(26).                  00360003
003520     05  WS-DISPLAY-OPER              PIC 9(04).                  00380029
003530     05  WS-DISPLAY-TRIP              PIC 9(09).                  00390029
003540     05  WS-DISPLAY-SHIPMT            PIC X(15).                  00400029
003550     05  WS-DISPLAY-1                 PIC -Z(08)9.                00410029
003560     05  WS-DISPLAY-2                 PIC -Z(03)9.                00420029
003600                                                                  00430000
003700 01  DK-KEYS.                                                     00440000
003800     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE +0.   00450028
003900                                                                  00460000
004200 01  PC-CONSTANTS.                                                00470000
004500     05  PC-DEFAULT-NINES            PIC X(26)  VALUE             00500003
004600                              '9999-09-09-09.09.09.999999'.       00510003
004700     05  PC-RANDOM-NBR-GENERATOR     PIC X(08)  VALUE             00520003
004710                                                 'DPKUT902'.      00530003
004715     05  PC-SHIP-ASN-MOD-TRAN        PIC X(04)  VALUE 'W304'.     00580029
004716                                                                  00590000
004717 01  PC-SWITCHES.                                                 00600000
004718     05  PS-CICS-SWITCH-IND          PIC X(01) VALUE 'N'.         00610029
004719         88 PS-CICS-SWITCH-NO                  VALUE 'N'.         00620029
004720         88 PS-CICS-SWITCH-YES                 VALUE 'Y'.         00630029
004790/                                                                 00640000
004791* * *  RANDOM NUMBER AREA.                                        00650019
004793     COPY DPWS902.                                                00660003
004794* * *  DOWNLOAD MODULE AREA                                       00670019
004795     COPY WSWS003.                                                00680004
040000* * * LAYOUT FOR THE ABEND COMMUNICATIONS AREA                    00690035
040200     COPY DPWS013.                                                00700035
004798                                                                  00710029
004799* * * COMMUNICATIONS AREA FOR DB2                                 00720029
004801     EXEC SQL                                                     00730029
004802          INCLUDE SQLCA                                           00740029
004803     END-EXEC.                                                    00750029
004804* * * WST_SHPMT_XREF_HDR VIEW - WMS SHIPMENT XREF HEADER          00760050
004810     EXEC SQL                                                     00770000
004820         INCLUDE WST00001                                         00780000
004830     END-EXEC.                                                    00790000
004840* * * WST_INTGRTN_TYP VIEW                                        00800029
004850     EXEC SQL                                                     00810029
004860         INCLUDE WST00008                                         00820029
004870     END-EXEC.                                                    00830029
004880* * * WST_ATTR_DEFN VIEW                                          00840029
004890     EXEC SQL                                                     00850029
004900         INCLUDE WST00009                                         00860029
005000     END-EXEC.                                                    00870029
005100* * * WST_ATTR_ELEM VIEW                                          00880029
005200     EXEC SQL                                                     00890029
005300         INCLUDE WST00010                                         00900029
005301     END-EXEC.                                                    00910029
005302* * *  WMS ASN DOWNLOAD CONTROL AREA                              00920019
005303     COPY WSWS004.                                                00930004
007430                                                                  00940000
007440                                                                  00950029
007725 LINKAGE SECTION.                                                 00960001
007726 01  DFHCOMMAREA.                                                 00970029
007727     05  FILLER                         OCCURS  1 TO 4072 TIMES   00980029
007728                                      DEPENDING ON EIBCALEN.      00990029
007729         10  FILLER                   PIC X.                      01000029
007730/                                                                 01010001
007731                                                                  01020001
007733 PROCEDURE DIVISION.                                              01030001
007734                                                                  01040001
007734* THIS PROGRAM IS CALLED FROM SUKCS559 WITH A FUNCTION_IND OF     01041048
007734* MANUAL_DOWNLOAD.  IT IS ALSO CALLED FROM SUKCS597 WITH A        01042048
007734* FUNCTION_IND OF SHIP_TRAILER.  IT CALLS WSKCS304.               01042148
007734                                                                  01044048
007734                                                                  01045048
007737     INITIALIZE                        WS004-FIELDS.              01050031
007738     MOVE DFHCOMMAREA              TO  WS004-FIELDS.              01060031
007740                                                                  01070031
007741     SET WS004-SUCCESSFUL        TO TRUE.                         01080031
007750     INITIALIZE DCLWST00001.                                      01090031
008731     INITIALIZE PV-VARIABLES.                                     01100029
008740                                                                  01110015
008810     PERFORM 8000-GET-CURRENT-TIMESTAMP.                          01120015
008811     PERFORM 0510-CICS-LOGGING.                                   01130029
008820                                                                  01140015
008820     INITIALIZE PV-CICS-MSG-AREA.                                 01150044
012500     STRING   ' ' WS004-SRC-TASK-NUMBER                           01160044
012600              ' WSKCS306 CALLED FROM '                            01170044
012700              WS004-CALLING-PROGRAM-NAME                          01180044
012800              DELIMITED BY SIZE                                   01190044
012900                                   INTO PV-CICS-MSG-AREA.         01200044
013000     PERFORM 7000-WRITE-TO-CICS-LOG.                              01210044
008820                                                                  01220044
045230     IF PS-CICS-SWITCH-YES                                        01230038
045234         INITIALIZE  PV-CICS-MSG-AREA                             01240038
045234         MOVE WS004-OTBND-TRIP-ID    TO WS-DISPLAY-TRIP           01250038
045235         STRING   ' ' WS004-SRC-TASK-NUMBER                       01260038
045236                    ' WSKCS306-MAIN:'                             01270038
045237                  ' WS004-FUNCTION-IND=' WS004-FUNCTION-IND       01280038
045237                  ' WS004-SHIPMENT-SOURCE=' WS004-SHIPMENT-SOURCE 01290038
045240                  DELIMITED BY SIZE                               01300038
045241                                   INTO PV-CICS-MSG-AREA          01310043
045242         PERFORM 7000-WRITE-TO-CICS-LOG                           01320040
045234         INITIALIZE  PV-CICS-MSG-AREA                             01330040
045235         STRING   ' ' WS004-SRC-TASK-NUMBER                       01340039
045236                    ' WSKCS306-MAIN:'                             01350039
045238                  ' SHPMT=' WS004-WMS-SHPT-ID                     01360039
045239                  ' TRIP=' WS-DISPLAY-TRIP                        01370039
045240                  DELIMITED BY SIZE                               01380039
045241                                   INTO PV-CICS-MSG-AREA          01390043
045242         PERFORM 7000-WRITE-TO-CICS-LOG                           01400040
045243      END-IF.                                                     01410038
008880                                                                  01420029
008900     EVALUATE TRUE                                                01430000
009000         WHEN WS004-SHIP-TRAILER                                  01440000
009100             PERFORM 1000-INSERT-HEADER-REC                       01450000
009200         WHEN WS004-MANUAL-DOWNLOAD                               01460000
009430             PERFORM 2000-MANUAL-DOWNLOAD                         01470000
009440         WHEN OTHER                                               01480000
009450             SET WS004-INVALID-FUNC-IND  TO TRUE                  01490021
009451             MOVE 'MAIN PROC'            TO WS004-PARAGRAPH-NAME  01500029
009451                                            DP013-PARAGRAPH       01510035
009452             MOVE 'UNKNOWN FUNCTION IND' TO WS004-CRA-RET-MSG     01520035
009452                                            DP013-MESSAGE-TEXT(1) 01530035
077300             SET DP013-DB2-ABEND  TO TRUE                         01540035
077400             PERFORM 9999-ABEND                                   01550035
009460     END-EVALUATE.                                                01560000
009600                                                                  01570000
009810     IF WS004-SUCCESSFUL                                          01580029
009811         PERFORM 3000-SHIP-ASN-DOWNLOAD                           01590029
009816     END-IF.                                                      01600010
009817                                                                  01610029
008820     INITIALIZE PV-CICS-MSG-AREA.                                 01620044
012500     STRING   ' ' WS004-SRC-TASK-NUMBER                           01630043
012600              ' EXITING WSKCS306'                                 01640043
012800              DELIMITED BY SIZE                                   01650043
012900                                   INTO PV-CICS-MSG-AREA.         01660043
013000     PERFORM 7000-WRITE-TO-CICS-LOG.                              01670043
008820                                                                  01680043
479500     EXEC CICS                                                    01690035
479600         RETURN                                                   01700035
479500     END-EXEC.                                                    01710035
009900                                                                  01720000
010000/                                                                 01730029
010100 0510-CICS-LOGGING.                                               01740029
010200* READ PARM TO DETERMINE CICS LOGGING                             01750029
010300                                                                  01760029
010400     EXEC SQL                                                     01770029
010500         SELECT  D.ATTR_ELEM_TXT                                  01780029
010600         INTO  :PS-CICS-SWITCH-IND                                01790029
010700         FROM   WST_INTGRTN_TYP A                                 01800029
010800              , WST_ATTR_DEFN   B                                 01810029
010900              , WST_ATTR_ELEM   C                                 01820029
011000              , WST_ATTR_ELEM   D                                 01830029
011100         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   01840029
011200           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           01850029
011300           AND  B.ATTR_DEFN_SEQ_NBR = 1                           01860029
011400           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           01870029
011500           AND  C.ATTR_DEFN_SEQ_NBR = 1                           01880029
011600           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           01890029
011700           AND  D.ATTR_DEFN_SEQ_NBR = 2                           01900029
011800           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         01910029
011900           AND  C.ATTR_ELEM_TXT     = 'WSKCS306'                  01920029
012000     END-EXEC.                                                    01930029
012100                                                                  01940029
012200     EVALUATE TRUE                                                01950032
012300         WHEN SQLCODE = ZERO                                      01960029
012400             IF PS-CICS-SWITCH-YES                                01970029
008820                 INITIALIZE PV-CICS-MSG-AREA                      01980044
013100                 MOVE  WS004-OPER-UNT-ID  TO  WS-DISPLAY-OPER     01990029
013200                 STRING   ' ' WS004-SRC-TASK-NUMBER               02000029
013300                          ' WSKCS306-0510:'                       02010029
013400                          ' ' WS-DISPLAY-OPER                     02020029
013500                          ' ' WS004-USER-ID                       02030029
013600                          ' CICS LOGGING TURNED ON'               02040029
013700                          DELIMITED BY SIZE                       02050029
013800                                      INTO PV-CICS-MSG-AREA       02060037
013900                 PERFORM 7000-WRITE-TO-CICS-LOG                   02070029
014000             END-IF                                               02080029
043600         WHEN SQLCODE = -904                                      02090005
043700         WHEN SQLCODE = -911                                      02100029
043800         WHEN SQLCODE = -803                                      02110029
043900             CONTINUE                                             02120029
044000         WHEN SQLWARN0 NOT = SPACES                               02130029
044100         WHEN SQLCODE NOT = ZERO                                  02140029
044200             SET WS004-INVALID-SQL   TO TRUE                      02150029
044300             MOVE SQLCODE            TO PV-SQL-RETURN-CD          02160029
044400             MOVE '0510-CICS-LOGGING'                             02170029
044500                                     TO WS004-PARAGRAPH-NAME      02180035
056239                                        DP013-PARAGRAPH           02190035
044600             STRING 'SQL='                                        02200029
044700                  PV-SQL-RETURN-CD                                02210029
044800                  DELIMITED BY SIZE                               02220029
044900                                    INTO WS004-CRA-RET-MSG        02230029
077100             MOVE 'WST_INTGRTN_TYP'    TO                         02240035
077100                                       DP013-DB2-TABLE-NAME (1)   02250035
077100             MOVE 'WST_ATTR_DEFN'      TO                         02260035
077100                                       DP013-DB2-TABLE-NAME (2)   02270035
077100             MOVE 'WST_ATTR_ELEM'      TO                         02280035
077100                                       DP013-DB2-TABLE-NAME (3)   02290035
077200             MOVE SQLCA                TO DP013-SQLCA             02300035
056125             MOVE 'SELECT ATTR_ELEM_TXT'                          02310035
056125                                       TO DP013-MESSAGE-TEXT (1)  02320035
077300             SET DP013-DB2-ABEND  TO TRUE                         02330035
077400             PERFORM 9999-ABEND                                   02340035
045100     END-EVALUATE.                                                02350029
045200                                                                  02360029
045201/                                                                 02370029
045202 1000-INSERT-HEADER-REC.                                          02380000
045203                                                                  02390030
045203* INSERT A RECORD ON THE WST_SHPMT_XREF_HDR TABLE.  THIS WILL     02391048
045203* BE A NEW HEADER.  WE DO NOT NEED TO WORRY ABOUT DUMMY           02392048
045203* SHIPMENTS WHEN COMING FROM THE SHIPPING SYSTEM.                 02393048
045203                                                                  02394048
045204     IF PS-CICS-SWITCH-YES                                        02400030
045205         MOVE WS004-OPER-UNT-ID    TO  WS-DISPLAY-OPER            02410033
045206         MOVE WS004-OTBND-TRIP-ID  TO  WS-DISPLAY-TRIP            02420033
045207         MOVE WS004-WMS-SHPT-ID    TO  WS-DISPLAY-SHIPMT          02430033
045208         INITIALIZE  PV-CICS-MSG-AREA                             02440030
045212         STRING   ' ' WS004-SRC-TASK-NUMBER                       02450030
045213                    ' WSKCS306-1000:'                             02460030
045214                  ' ' WS-DISPLAY-OPER                             02470033
045215                  ' ' WS-DISPLAY-TRIP                             02480033
045216                  ' ' WS-DISPLAY-SHIPMT                           02490033
045217                   DELIMITED BY SIZE                              02500037
045218                                   INTO PV-CICS-MSG-AREA          02510037
045219             PERFORM 7000-WRITE-TO-CICS-LOG                       02520030
045220      END-IF.                                                     02530030
045221                                                                  02540029
045222     PERFORM 6000-CREATE-RANDOM-NBR.                              02550015
045223                                                                  02560003
045224     INITIALIZE PV-SHIPMNT-NBR.                                   02570014
045225     MOVE DP902-RANDOM-NUMBER  TO PV-RANDOM-NBR.                  02580018
045226     MOVE 'K'                  TO PV-K.                           02590018
045227     MOVE PV-SHIPMNT-NBR       TO WST00001-EXT-SHP-ID             02600018
045228                                  WS-EXT-SHP-ID.                  02610018
045229                                                                  02620010
045230     IF PS-CICS-SWITCH-YES                                        02630033
045233         MOVE WS004-WMS-SHPT-ID    TO  WS-DISPLAY-SHIPMT          02640033
045234         INITIALIZE  PV-CICS-MSG-AREA                             02650033
045235         STRING   ' ' WS004-SRC-TASK-NUMBER                       02660033
045236                    ' WSKCS306-1000:'                             02670033
045237                  ' ' WS-DISPLAY-OPER                             02680033
045238                  '  RANDOM NBR=' PV-RANDOM-NBR                   02690033
045239                  ' ' WS-DISPLAY-SHIPMT                           02700033
045240                  DELIMITED BY SIZE                               02710037
045241                             INTO PV-CICS-MSG-AREA                02720037
045242             PERFORM 7000-WRITE-TO-CICS-LOG                       02730033
045243      END-IF.                                                     02740033
045244     MOVE WS004-OTBND-TRIP-ID  TO WST00001-INTR-TRIP-ID.          02750010
045245     MOVE 'SH'                 TO WST00001-SOR-CDE.               02760010
045246     MOVE 0                    TO WST00001-DMY-SEQ-NBR.           02770018
045247     MOVE WS004-OPER-UNT-ID    TO WST00001-DEST-LOC-NBR.          02780010
045248     MOVE 'N'                  TO WST00001-DWNLD-CDE.             02790010
045249     MOVE PC-DEFAULT-NINES     TO WST00001-RCPT-TMST.             02800010
045250     MOVE WS004-USER-ID        TO WST00001-CRE-USR-ID.            02810010
045251     MOVE PV-CURRENT-TIMESTAMP TO WST00001-CRE-TMST.              02820015
045252     MOVE PC-DEFAULT-NINES     TO WST00001-DWNLD-TMST.            02830010
045253     MOVE PV-CURRENT-TIMESTAMP TO WST00001-LAST-PRCG-TMST.        02840015
045254     MOVE 'N'                  TO WST00001-PRC-CDE.               02850010
045255     MOVE 0                    TO WST00001-VER-NBR.               02860010
045255     MOVE WS004-CALLING-PROGRAM-NAME                              02861051
045255                               TO WST00001-CRE-PGM-CDE.           02862051
045256                                                                  02870010
045257     EXEC SQL                                                     02880005
045258         INSERT INTO WST_SHPMT_XREF_HDR                           02890005
045259               (EXT_SHP_ID                                        02900005
045260              , INTR_TRIP_ID                                      02910005
045261              , SOR_CDE                                           02920005
045262              , DMY_SEQ_NBR                                       02930005
045263              , DEST_LOC_NBR                                      02940005
045264              , DWNLD_CDE                                         02950005
045265              , RCPT_TMST                                         02960005
045266              , CRE_USR_ID                                        02970005
045267              , CRE_TMST                                          02980005
045268              , DWNLD_TMST                                        02990005
045269              , LAST_PRCG_TMST                                    03000005
045270              , PRC_CDE                                           03010005
045271              , VER_NBR                                           03020051
045271              , CRE_PGM_CDE )                                     03021051
045272         VALUES                                                   03030005
045273              (:WST00001-EXT-SHP-ID                               03040005
045274             , :WST00001-INTR-TRIP-ID                             03050005
045275             , :WST00001-SOR-CDE                                  03060005
045276             , :WST00001-DMY-SEQ-NBR                              03070005
045277             , :WST00001-DEST-LOC-NBR                             03080005
045278             , :WST00001-DWNLD-CDE                                03090005
045279             , :WST00001-RCPT-TMST                                03100005
045280             , :WST00001-CRE-USR-ID                               03110005
045281             , :WST00001-CRE-TMST                                 03120005
045282             , :WST00001-DWNLD-TMST                               03130005
045283             , :WST00001-LAST-PRCG-TMST                           03140005
045284             , :WST00001-PRC-CDE                                  03150005
045285             , :WST00001-VER-NBR                                  03160051
045285             , :WST00001-CRE-PGM-CDE)                             03161051
045286     END-EXEC.                                                    03170005
045287                                                                  03180000
045288     EVALUATE TRUE                                                03190005
045289         WHEN SQLCODE = ZERO                                      03200005
045290             IF PS-CICS-SWITCH-YES                                03210029
008820                 INITIALIZE PV-CICS-MSG-AREA                      03220044
045291                 MOVE  WST00001-EXT-SHP-ID                        03230029
045292                                    TO  WS-DISPLAY-SHIPMT         03240029
045293                 MOVE  WST00001-INTR-TRIP-ID                      03250029
045294                                    TO  WS-DISPLAY-TRIP           03260029
045295                 STRING   ' ' WS004-SRC-TASK-NUMBER               03270029
045300                          ' WSKCS306-1000:'                       03280029
045400                          ' INSERT WST_SHPMT_XREF_HDR'            03290029
045500                          ' SRC='   WST00001-SOR-CDE              03300029
045600                          ' TRIP='  WS-DISPLAY-TRIP               03310029
045700                          ' SHPMT=' WS-DISPLAY-SHIPMT             03320029
045800                          DELIMITED BY SIZE                       03330029
045900                                       INTO PV-CICS-MSG-AREA      03340037
046000                 PERFORM 7000-WRITE-TO-CICS-LOG                   03350029
046001             END-IF                                               03360029
046002         WHEN SQLCODE = -904                                      03370005
046003         WHEN SQLCODE = -913                                      03380005
046004         WHEN SQLCODE = -911                                      03390005
046005             CONTINUE                                             03400005
046006         WHEN SQLWARN0 NOT = SPACES                               03410005
046007         WHEN SQLCODE NOT = ZERO                                  03420005
044300             MOVE SQLCODE            TO PV-SQL-RETURN-CD          03430045
008820             INITIALIZE PV-CICS-MSG-AREA                          03440044
045295             STRING   ' ' WS004-SRC-TASK-NUMBER                   03450035
046070                      ' WSKCS306-1000 ERROR:'                     03460035
046080                      ' SQL='                                     03470035
046090                      PV-SQL-RETURN-CD                            03480035
046100                      DELIMITED BY SIZE                           03490035
046200                                   INTO PV-CICS-MSG-AREA          03500037
046300             PERFORM 7000-WRITE-TO-CICS-LOG                       03510035
044200             SET WS004-INVALID-SQL   TO TRUE                      03520035
046010             MOVE '1000-INSERT-HEADER-REC'                        03530035
044500                                     TO WS004-PARAGRAPH-NAME      03540035
056239                                        DP013-PARAGRAPH           03550035
044600             STRING 'SQL='                                        03560035
044700                  PV-SQL-RETURN-CD                                03570035
044800                  DELIMITED BY SIZE                               03580035
044900                                     INTO WS004-CRA-RET-MSG       03590037
077100             MOVE 'WST_SHPMT_XREF_HDR' TO                         03600035
077100                                       DP013-DB2-TABLE-NAME (1)   03610035
077200             MOVE SQLCA                TO DP013-SQLCA             03620035
056125             MOVE 'UNABLE TO INSERT HDR'                          03630035
056125                                       TO DP013-MESSAGE-TEXT (1)  03640035
077300             SET DP013-DB2-ABEND  TO TRUE                         03650035
077400             PERFORM 9999-ABEND                                   03660035
046302     END-EVALUATE.                                                03670005
046303                                                                  03680000
046304/                                                                 03690001
046305 2000-MANUAL-DOWNLOAD.                                            03700001
046306                                                                  03710030
046306* CHECK TO SEE IF THE WST_SHPMT_XREF_HDR ROW EXISTS.  IF NOT,     03711048
046306* THEN INSERT IT.  IF IS DOES EXIST, CHECK TO SEE IF RECEIVING    03712048
046306* HAS BEGUN.  IF IT HAS, WE CANNOT SEND CHANGES TO WMS.           03713048
046306                                                                  03714048
046307     IF PS-CICS-SWITCH-YES                                        03720030
046308         INITIALIZE  PV-CICS-MSG-AREA                             03730030
046309         STRING   ' ' WS004-SRC-TASK-NUMBER                       03740030
046310                  ' WSKCS306-2000:MANUAL DOWNLOAD'                03750038
046311                  DELIMITED BY SIZE                               03760037
046312                                    INTO PV-CICS-MSG-AREA         03770037
046313             PERFORM 7000-WRITE-TO-CICS-LOG                       03780030
046314      END-IF.                                                     03790030
046315                                                                  03800000
046316     MOVE WS004-OTBND-TRIP-ID         TO DK-TRIP-ID               03810029
046317                                         WS-TRIP-ID.              03820029
046318                                                                  03830001
046319     EXEC SQL                                                     03840001
046320          SELECT RCPT_TMST                                        03850001
046321               , VER_NBR                                          03860001
046322               , EXT_SHP_ID                                       03870001
046323          INTO   :WST00001-RCPT-TMST                              03880029
046324               , :WST00001-VER-NBR                                03890029
046325               , :WST00001-EXT-SHP-ID                             03900029
046326          FROM   WST_SHPMT_XREF_HDR                               03910001
046327          WHERE  INTR_TRIP_ID   = :DK-TRIP-ID                     03920001
046328          AND    SOR_CDE        = 'SH'                            03930001
046329     END-EXEC.                                                    03940001
046330                                                                  03950001
046331     EVALUATE TRUE                                                03960001
046332         WHEN SQLCODE = ZERO                                      03970001
046333              MOVE WST00001-RCPT-TMST  TO WS-RCPT-TMST            03980029
046334              MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID           03990029
046335              MOVE WST00001-EXT-SHP-ID TO WS-DISPLAY-SHIPMT       04000029
046336              IF WS-RCPT-TMST NOT = PC-DEFAULT-NINES              04010029
046337                  SET WS004-ERROR TO TRUE                         04020029
046338                  MOVE '2000-MANUAL-DOWNLOAD' TO                  04030029
046339                                          WS004-PARAGRAPH-NAME    04040029
056239                                          DP013-PARAGRAPH         04050035
046340                  MOVE 'RECEIVING HAS BEGUN' TO                   04060029
046350                                          WS004-CRA-RET-MSG       04070029
056125                                          DP013-MESSAGE-TEXT (1)  04080035
008820                  INITIALIZE PV-CICS-MSG-AREA                     04090044
046370                  STRING   ' ' WS004-SRC-TASK-NUMBER              04100035
046380                           ' WSKCS306-2000:'                      04110035
046390                           ' RCPT TMST='  WS-RCPT-TMST            04120035
046400                           ' SHPMT=' WS-DISPLAY-SHIPMT            04130035
046500                           ' RECEIVING HAS BEGUN'                 04140035
046600                           DELIMITED BY SIZE                      04150037
046700                                     INTO PV-CICS-MSG-AREA        04160037
046800                  PERFORM 7000-WRITE-TO-CICS-LOG                  04170035
077300                  SET DP013-DB2-ABEND  TO TRUE                    04180035
077400                  PERFORM 9999-ABEND                              04190035
047100              END-IF                                              04200029
047302         WHEN SQLCODE = -811                                      04240001
047303*  THERE SHOULD NOT BE MULTIPLE ROWS FOUNDS                       04250001
047306             MOVE WS-TRIP-ID         TO WS-DISPLAY-1              04260035
008820             INITIALIZE PV-CICS-MSG-AREA                          04270044
047307             STRING   ' ' WS004-SRC-TASK-NUMBER                   04280035
047308                      ' WSKCS306-2000:'                           04290035
047309                      ' MULTIPLE HEADERS FOR '                    04300035
047310                      'TRIP ID='                                  04310035
047320                      WS-DISPLAY-1                                04320035
047330                      DELIMITED BY SIZE                           04330035
047340                                       INTO PV-CICS-MSG-AREA      04340037
047350             PERFORM 7000-WRITE-TO-CICS-LOG                       04350035
046337             SET WS004-ERROR TO TRUE                              04360035
046338             MOVE '2000-MANUAL-DOWNLOAD' TO                       04370035
046339                                          WS004-PARAGRAPH-NAME    04380035
056239                                          DP013-PARAGRAPH         04390035
046340             MOVE 'MULTIPLE HEADERS FOUND' TO                     04400035
046350                                          WS004-CRA-RET-MSG       04410035
056125                                          DP013-MESSAGE-TEXT (1)  04420035
077100             MOVE 'WST_SHPMT_XREF_HDR' TO                         04430035
077100                                       DP013-DB2-TABLE-NAME (1)   04440035
077200             MOVE SQLCA                TO DP013-SQLCA             04450035
077300             SET DP013-DB2-ABEND  TO TRUE                         04460035
077400             PERFORM 9999-ABEND                                   04470035
047362         WHEN SQLCODE = -904                                      04480001
047363         WHEN SQLCODE = -913                                      04490001
047364         WHEN SQLCODE = -911                                      04500001
047365              CONTINUE                                            04510001
047366         WHEN SQLCODE = +100                                      04520001
047367              PERFORM 1000-INSERT-HEADER-REC                      04530001
047368         WHEN SQLWARN0 NOT = SPACES                               04540001
047369         WHEN SQLCODE NOT = ZERO                                  04550001
047370             SET WS004-INVALID-SQL      TO TRUE                   04560019
047380             MOVE SQLCODE               TO PV-SQL-RETURN-CD       04570029
047390             MOVE '2000-MANUAL-DOWNLOAD'                          04580029
047400                                        TO WS004-PARAGRAPH-NAME   04590029
056239                                           DP013-PARAGRAPH        04600035
047500             STRING 'SQL='                                        04610029
047600                    PV-SQL-RETURN-CD                              04620029
047700                    DELIMITED BY SIZE                             04630029
047800                                      INTO WS004-CRA-RET-MSG      04640029
056125             MOVE WS004-CRA-RET-MSG     TO DP013-MESSAGE-TEXT (1) 04650036
008820             INITIALIZE PV-CICS-MSG-AREA                          04660044
012500             STRING   ' ' WS004-SRC-TASK-NUMBER                   04670035
047900                      ' WSKCS306-2000 ERROR:'                     04680035
048000                      ' SQL='                                     04690029
048100                      PV-SQL-RETURN-CD                            04700029
048200                      DELIMITED BY SIZE                           04710029
048300                                      INTO PV-CICS-MSG-AREA       04720036
048400             PERFORM 7000-WRITE-TO-CICS-LOG                       04730029
077100             MOVE 'WST_SHPMT_XREF_HDR' TO                         04740035
077100                                       DP013-DB2-TABLE-NAME (1)   04750035
077200             MOVE SQLCA                TO DP013-SQLCA             04760035
077300             SET DP013-DB2-ABEND  TO TRUE                         04770035
077400             PERFORM 9999-ABEND                                   04780035
048402     END-EVALUATE.                                                04790001
048403                                                                  04800001
048404/                                                                 04810001
079570 3000-SHIP-ASN-DOWNLOAD.                                          05490005
079600                                                                  05500000
079610     MOVE WS-EXT-SHP-ID          TO WS004-WMS-SHPT-ID.            05510005
079620     MOVE 'WSKCS306'             TO WS004-CALLING-PROGRAM-NAME.   05520029
079630                                                                  05530029
079631     IF PS-CICS-SWITCH-YES                                        05540033
079632         INITIALIZE  PV-CICS-MSG-AREA                             05550033
079633         STRING   ' ' WS004-SRC-TASK-NUMBER                       05560033
079634                  ' WSKCS306-3000: STARTING TRAN W304 FOR'        05570040
079635                  ' SHPMT=' WS004-WMS-SHPT-ID                     05580040
079636                  DELIMITED BY SIZE                               05590037
079637                                     INTO PV-CICS-MSG-AREA        05600037
079638             PERFORM 7000-WRITE-TO-CICS-LOG                       05610033
079639      END-IF.                                                     05620033
079640                                                                  05630033
079641* THIS IS A STARTED TASK - IT WILL NOT RETURN BACK TO HERE        05640029
079650* TRANID IS W304 - IT EXECUTES WSKCS304                           05650029
079660                                                                  05660029
079670     EXEC CICS                                                    05670029
079680          START TRANSID (PC-SHIP-ASN-MOD-TRAN)                    05680029
079690                FROM (WS004-FIELDS)                               05690029
079700     END-EXEC.                                                    05700029
079800                                                                  05710029
081800                                                                  05720029
086200/                                                                 05730000
095530 6000-CREATE-RANDOM-NBR.                                          05740003
095600                                                                  05750003
095601     IF PS-CICS-SWITCH-YES                                        05760033
095602         MOVE WS004-OPER-UNT-ID    TO  WS-DISPLAY-OPER            05770033
095603         MOVE WS004-OTBND-TRIP-ID  TO  WS-DISPLAY-TRIP            05780033
095604         MOVE WS004-WMS-SHPT-ID    TO  WS-DISPLAY-SHIPMT          05790033
095605         INITIALIZE  PV-CICS-MSG-AREA                             05800033
095606         STRING   ' ' WS004-SRC-TASK-NUMBER                       05810033
095607                    ' WSKCS306-6000:'                             05820033
095608                  ' ' WS-DISPLAY-OPER                             05830033
095609                  ' ' WS-DISPLAY-TRIP                             05840033
095610                  ' ' WS-DISPLAY-SHIPMT                           05850033
095611                   DELIMITED BY SIZE                              05860037
095612                                   INTO PV-CICS-MSG-AREA          05870037
095613             PERFORM 7000-WRITE-TO-CICS-LOG                       05880033
095614      END-IF.                                                     05890033
095690                                                                  05900030
095700     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     05910003
095800     CALL PC-RANDOM-NBR-GENERATOR USING DFHEIBLK                  05920029
095900                            DFHCOMMAREA                           05930029
096000                            DP902-RANDNBR-ROUTINE-FIELDS.         05940029
096100                                                                  05950029
096200     IF DP902-SUCCESSFUL                                          05960029
096300         CONTINUE                                                 05970029
096400     ELSE                                                         05980029
097920         SET WS004-ERROR              TO TRUE                     05990018
097930         MOVE '6000-CREATE-RANDOM-NBR'                            06000029
097940                                      TO WS004-PARAGRAPH-NAME     06010029
056239                                         DP013-PARAGRAPH          06020035
097950         STRING 'DP902-RETURN-CODE'                               06030029
097960                  DP902-RETURN-CODE                               06040029
097970                  DELIMITED BY SIZE                               06050029
097980                                    INTO WS004-CRA-RET-MSG        06060029
056125         MOVE WS004-CRA-RET-MSG       TO DP013-MESSAGE-TEXT (1)   06070037
008820         INITIALIZE PV-CICS-MSG-AREA                              06080044
079633         STRING   ' ' WS004-SRC-TASK-NUMBER                       06090035
049000                  ' WSKCS306-6000 ERROR:'                         06100035
049100                  ' RETURN CDE='                                  06110035
049200                  DP902-RETURN-CODE                               06120035
049300                  DELIMITED BY SIZE                               06130035
049400                                    INTO PV-CICS-MSG-AREA         06140037
049500         PERFORM 7000-WRITE-TO-CICS-LOG                           06150035
077300         SET DP013-DB2-ABEND  TO TRUE                             06160035
077400         PERFORM 9999-ABEND                                       06170035
098000     END-IF.                                                      06180003
098001                                                                  06190029
098010/                                                                 06200015
098020 7000-WRITE-TO-CICS-LOG.                                          06210029
098030                                                                  06220029
098040     MOVE LENGTH PV-CICS-MSG-AREA TO                              06230029
098041                                     PV-COMMAREA-LENGTH.          06240000
098042     EXEC CICS                                                    06250029
098043          WRITEQ TD                                               06260029
098044          QUEUE  ('CSSL')                                         06270029
098045          FROM  (PV-CICS-MSG-AREA)                                06280029
098046          LENGTH  (PV-COMMAREA-LENGTH)                            06290029
098047          RESP  (PV-CICS-RESP)                                    06300029
098048     END-EXEC.                                                    06310029
098049                                                                  06320029
098050     MOVE SPACES TO PV-CICS-MSG-AREA.                             06330029
098051                                                                  06340029
098052/                                                                 06350015
098100 8000-GET-CURRENT-TIMESTAMP.                                      06360015
098200                                                                  06370015
098210     IF PS-CICS-SWITCH-YES                                        06380030
098220         INITIALIZE  PV-CICS-MSG-AREA                             06390030
098230         STRING   ' ' WS004-SRC-TASK-NUMBER                       06400030
098240                  ' WSKCS306-8000:'                               06410037
098250                  DELIMITED BY SIZE                               06420037
098260                                    INTO PV-CICS-MSG-AREA         06430037
098270             PERFORM 7000-WRITE-TO-CICS-LOG                       06440030
098280      END-IF.                                                     06450030
098290                                                                  06460030
098300     EXEC SQL                                                     06470015
098400         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            06480015
098500     END-EXEC.                                                    06490017
098600                                                                  06500015
098700                                                                  06510015
477400***************************************************************   06520035
477500*   STANDARD ABEND ROUTINE                                        06530035
477600* ==> PROCESSES:                                                  06540035
477700*   - ISSUES THE ABEND.                                           06550035
477800***************************************************************   06560035
477900 9999-ABEND.                                                      06570035
007738     MOVE WS004-FIELDS                TO DFHCOMMAREA.             06571049
478000     MOVE 'WSKCS304'                  TO DP013-PROGRAM.           06580035
478100     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          06590035
478200     INITIALIZE DP013-SRC-TASK-NUMBER                             06600035
478300                DP013-STACK.                                      06610035
478400     SET DP013-LINK-RETURN TO TRUE.                               06620035
478500     SET DP013-ROLLBACK    TO TRUE.                               06630035
478600                                                                  06640035
478700     EXEC CICS                                                    06650035
478800         LINK                                                     06660035
478900             PROGRAM  (DP013-NAME)                                06670035
479000             COMMAREA (DP013-PARAMETERS)                          06680035
479100             LENGTH   (DP013-LENGTH)                              06690035
479200     END-EXEC.                                                    06700035
479300                                                                  06710035
479400                                                                  06720035
479500     EXEC CICS                                                    06730035
479600         RETURN                                                   06740035
479700     END-EXEC.                                                    06750035
