000100 IDENTIFICATION DIVISION.                                                 
000200                                                                          
000300 PROGRAM-ID.    TRKCS323.                                                 
000400 AUTHOR.        TR TEAM.                                                  
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  07/2004.                                                  
000700 DATE-COMPILED.                                                           
000800******************************************************************        
000900*    Y323 - DECONSOLIDATOR CONTROL PANEL MAINTENANCE SCREEN      *        
001000*                                                                *        
001100*    THIS PROGRAM ALLOWS THE USER TO UPDATE THE DECONSOLIDATOR   *        
001200*    SCAC CODE FOR A VESSEL/VOYAGE OR A CONTAINER/ETA FOR A      *        
001300*    SPECIFIC POE CODE AND DATE RANGE.  THE DECONSOLIDATOR SCAC  *        
001400*    CODE CAN BE CHANGED AT ONLY ONE LEVEL.                      *        
001500******************************************************************        
CICS  * CHANGED  1/17/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001600                                                                          
001700 ENVIRONMENT DIVISION.                                                    
001800                                                                          
001900 DATA DIVISION.                                                           
002000                                                                          
002100 WORKING-STORAGE SECTION.                                                 
002200                                                                          
002300 01  DK-DB2-KEYS.                                                         
002400     05  DK-POE-CDE                     PIC  X(03)  VALUE SPACE.          
002500     05  DK-SCAC-CDE                    PIC  X(04)  VALUE SPACE.          
002600     05  DK-ENT-NAME                    PIC  X(04)  VALUE SPACE.          
002700     05  DK-ENT-ID                      PIC  S9(9)  COMP.                 
002800     05  DK-STAT-CDE                    PIC  X(01)  VALUE SPACE.          
002900     05  DK-POE-STAT-CDE                PIC  X(01)  VALUE SPACE.          
003000     05  DK-FUNC-CDE                    PIC  X(01)  VALUE SPACE.          
003100     05  DK-POE-STD-EDI-CDE             PIC  X(04)  VALUE SPACE.          
003200                                                                          
003300 01  PC-PROGRAM-CONSTANTS.                                                
003400     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR323A  '.          
003500     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM323 '.          
003600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS323'.          
003700     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3                   
003800                                              COMP.                       
003900     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3                   
004000                                              COMP.                       
004100     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1                    
004200                                              COMP.                       
004300     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.                  
004400     05  PC-PRIMARY               PIC XX      VALUE '01'.                 
004500     05  PC-A                     PIC  X(01)  VALUE 'A'.                  
004600     05  PC-I                     PIC  X(01)  VALUE 'I'.                  
004700     05  PC-M                     PIC  X(01)  VALUE 'M'.                  
004800     05  PC-N                     PIC  X(01)  VALUE 'N'.                  
004900     05  PC-O                     PIC  X(01)  VALUE 'O'.                  
005000     05  PC-Y                     PIC  X(01)  VALUE 'Y'.                  
005100     05  PC-ADJ                   PIC  X(03)  VALUE 'ADJ'.                
005200     05  PC-DEF                   PIC  X(03)  VALUE 'DEF'.                
005300     05  PC-WKG                   PIC  X(03)  VALUE 'WKG'.                
005400     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.               
005500                                                                          
005600     05  PC-TSYMSG-NUMBERS.                                               
005700         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.               
005800*             -  PRESS F2 TO CONFIRM REQUEST                              
005900         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.               
006000*             -  ADD SUCCESSFUL                                           
006100         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.               
006200*             -  NO LIST ITEMS WERE FOUND FOR                             
006300*                THE CRITERIA SPECIFIED                                   
006400         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.               
006500*             -  A LIST ITEM MUST BE SELECTED                             
006600*                FOR THIS FUNCTION                                        
006700         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.               
006800*             -  UPDATE(S) SUCCESSFUL                                     
006900         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.               
007000*             -  TOP OF LIST                                              
007100         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.               
007200*             -  BOTTOM OF LIST                                           
007300         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.               
007400*             -  DELETE SUCCESSFUL                                        
007500         10  PC-TSYMSG-00116      PIC  9(05)  VALUE  00116.               
007600*             -  CANNOT DELETE - RECORD DOES NOT EXIST                    
007700         10  PC-TSYMSG-00223      PIC  9(05)  VALUE  00223.               
007800*             -  PREVIOUS OBJECT HAS BEEN ADDED                           
007900         10  PC-TSYMSG-01450      PIC  9(05)  VALUE  01450.               
008000*             -  CODE IS INVALID                                          
008100         10  PC-TSYMSG-01452      PIC  9(05)  VALUE  01452.               
008200*             -  THE PORT CODE IS INVALID                                 
008300         10  PC-TSYMSG-01644      PIC  9(05)  VALUE  01644.               
008400*             -  CODE IS INACTIVE                                         
008500         10  PC-TSYMSG-01646      PIC  9(05)  VALUE  01646.               
008600*             -  SELECTED CODE IS ALREADY ACTIVE                          
008700         10  PC-TSYMSG-01882      PIC  9(05)  VALUE  01882.               
008800*             -  ONE VALUE MUST BE ENTERED                                
008900         10  PC-TSYMSG-01883      PIC  9(05)  VALUE  01883.               
009000*             -  ONLY ONE VALUE SHOULD BE ENTERED                         
009100         10  PC-TSYMSG-02609      PIC  9(05)  VALUE  02609.               
009200*             -  INVALID SCAC CODE                                        
009300         10  PC-TSYMSG-03316      PIC  9(05)  VALUE  03316.               
009400*             -  WORKING RULE ALREADY EXISTS WITH SAME SCAC               
009500         10  PC-TSYMSG-03307      PIC  9(05)  VALUE  03307.               
009600*             -  SAME DCON SCAC ENTERED AS ON 'ADJ' RULE                  
009700         10  PC-TSYMSG-03308      PIC  9(05)  VALUE  03308.               
009800*             -  SAME DCON SCAC ENTERED AS ON 'DEF' RULE                  
009900         10  PC-TSYMSG-03309      PIC  9(05)  VALUE  03309.               
010000*             -  PO(S) ASSIGNED TO MULTIPLE DECONSOLIDATORS               
010010* PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN - MJF          
010020*               ADDING NEW MESSAGE 03730                                  
010030*            -  ADJUSTMENTS CAN NOT BE ENTERED MORE THAN X DAYS           
010040*               IN THE PAST.                                              
010100         10  PC-TSYMSG-03730            PIC  9(05)  VALUE 03730.          
010500         10  PC-TSYMSG-03327            PIC  9(05)  VALUE 03327.          
010600*            -  EXISTING CONTAINER RULE                                   
010700                                                                          
010800     05  PC-CONTNR-PO-LIST-FORMAT       PIC  X(01)  VALUE '1'.            
010900                                                                          
011000 01  PS-PROGRAM-SWITCHES.                                                 
011100     05  PS-ERROR-SW              PIC  X(01)  VALUE 'N'.                  
011200         88  PS-ERROR                         VALUE 'Y'.                  
011300         88  PS-NO-ERROR                      VALUE 'N'.                  
011400     05  PS-COMMAREA-SW           PIC X(01)   VALUE 'N'.                  
011500         88  PS-COMMAREA-VALID                VALUE 'Y'.                  
011600         88  PS-COMMAREA-NOT-VALID            VALUE 'N'.                  
011700     05  PS-LIST-END-SW           PIC X(01)   VALUE 'N'.                  
011800         88  PS-LIST-END                      VALUE 'Y'.                  
011900         88  PS-NO-LIST-END                   VALUE 'N'.                  
012000     05  PS-RULE-EXISTS-SW        PIC X(01)   VALUE 'N'.                  
012100         88  PS-RULE-EXISTS                   VALUE 'Y'.                  
012200         88  PS-RULE-EXISTS-NO                VALUE 'N'.                  
012300     05  PS-DEF-RULE-EXISTS-SW    PIC X(01)   VALUE 'N'.                  
012400         88  PS-DEF-RULE-EXISTS               VALUE 'Y'.                  
012500         88  PS-DEF-RULE-EXISTS-NO            VALUE 'N'.                  
012600     05  PS-EOC-CNSTR-CUR-SW      PIC X(01)   VALUE 'N'.                  
012700         88  PS-EOC-CNSTR-CUR                 VALUE 'Y'.                  
012800         88  PS-EOC-CNSTR-CUR-NO              VALUE 'N'.                  
012900     05  PS-EOC-CNSTR-CUR-ADD-SW  PIC X(01)   VALUE 'N'.                  
013000         88  PS-EOC-CNSTR-CUR-ADD             VALUE 'Y'.                  
013100         88  PS-EOC-CNSTR-CUR-ADD-NO          VALUE 'N'.                  
013200     05  PS-EOC-TSHPTPO-CUR-SW    PIC X(01)   VALUE 'N'.                  
013300         88  PS-EOC-TSHPTPO-CUR               VALUE 'Y'.                  
013400         88  PS-EOC-TSHPTPO-CUR-NO            VALUE 'N'.                  
013500     05  PS-EOC-CON-CUR-SW        PIC X(01)   VALUE 'N'.                  
013600         88  PS-EOC-CON-CUR                   VALUE 'Y'.                  
013700         88  PS-EOC-CON-CUR-NO                VALUE 'N'.                  
013800     05  PS-EOC-CMN-CUR-SW        PIC X(01)   VALUE 'N'.                  
013900         88  PS-EOC-CMN-CUR                   VALUE 'Y'.                  
014000         88  PS-EOC-CMN-CUR-NO                VALUE 'N'.                  
014100     05  PS-EOC-VSL-CONT-CUR-SW   PIC X(01)   VALUE 'N'.                  
014200         88  PS-EOC-VSL-CONT-CUR              VALUE 'Y'.                  
014300         88  PS-EOC-VSL-CONT-CUR-NO           VALUE 'N'.                  
014400     05  PS-EOC-PO-CUR-SW         PIC X(01)   VALUE 'N'.                  
014500         88  PS-EOC-PO-CUR                    VALUE 'Y'.                  
014600         88  PS-EOC-PO-CUR-NO                 VALUE 'N'.                  
014700     05  PS-TSHIPMT-FOUND-SW      PIC X(01)   VALUE 'N'.                  
014800         88  PS-TSHIPMT-FOUND                 VALUE 'Y'.                  
014900         88  PS-TSHIPMT-FOUND-NO              VALUE 'N'.                  
015000     05  PS-MORE-CONTNRS-CON-SW   PIC X(01)   VALUE 'N'.                  
015100         88  PS-MORE-CONTNRS-CON              VALUE 'Y'.                  
015200         88  PS-MORE-CONTNRS-CON-NO           VALUE 'N'.                  
015300     05  PS-COMPARE-SCAC-SW       PIC X(01)   VALUE 'N'.                  
015400         88  PS-COMPARE-SCAC                  VALUE 'Y'.                  
015500         88  PS-COMPARE-SCAC-NO               VALUE 'N'.                  
015600     05 PS-MULTI-SCACS-SW         PIC X(01)   VALUE 'N'.                  
015700         88  PS-MULTI-SCACS                   VALUE 'Y'.                  
015800         88  PS-MULTI-SCACS-NO                VALUE 'N'.                  
015900     05 PS-SCACS-MATCH-SW         PIC X(01)   VALUE 'N'.                  
016000         88  PS-SCACS-MATCH                   VALUE 'Y'.                  
016100         88  PS-SCACS-MATCH-NO                VALUE 'N'.                  
016200                                                                          
016300 01  PV-PROGRAM-VARIABLES.                                                
016400     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0                    
016500                                              COMP SYNC.                  
016600     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0                    
016700                                              COMP SYNC.                  
016800     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0                    
016900                                              COMP SYNC.                  
017000     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0                    
017100                                              COMP SYNC.                  
017200     05  PV-DISPLAY-TASK          PIC  9(05).                             
017300     05  PV-CURRENT-RUL-ID        PIC S9(09)  COMP.                       
017400     05  PV-NEXT-RUL-CNSTR-CDE    PIC S9(04)  VALUE +0                    
017500                                              COMP.                       
017600     05  PV-CURRENT-TMST          PIC X(26)   VALUE SPACES.               
017602* PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN - MJF          
017610     05  PV-DATE-LIMIT            PIC X(10)   VALUE SPACES.               
017700     05  PV-CNTNR-SEQ-NBR         PIC 9(06)   VALUE ZERO.                 
017800     05  PV-CNTNR-SEQ-NBR-X REDEFINES PV-CNTNR-SEQ-NBR                    
017900                                  PIC X(06).                              
018000     05  PV-PO-NBR                PIC S9(09)  VALUE +0                    
018100                                              COMP.                       
018200     05  PV-PRO-NBR               PIC X(22)   VALUE SPACES.               
018300     05  PV-DECON-SCAC            PIC X(30)   VALUE SPACES.               
018400     05  PV-CURRENT-SCAC          PIC X(30)   VALUE SPACES.               
018500     05  PV-CHANGE-SCAC           PIC X(30)   VALUE SPACES.               
018600     05  PV-RUL-CNSTR-VAL-TXT     PIC X(30)   VALUE SPACES.               
018700     05  PV-NEW-WKG-RULE-ID       PIC S9(9)   COMP VALUE +0.              
018800     05  PV-AUDIT-RUL-ID          PIC S9(9)   COMP VALUE +0.              
018900     05  PV-EXISTING-CONT-RUL     PIC S9(9)   COMP VALUE +0.              
019000     05  PV-AUDIT-RUL-CDE         PIC X(04)   VALUE SPACES.               
019100                                                                          
019200     05  PV-WEEK-FROM-DTE.                                                
019300         10  PV-WEEK-FROM-DTE-MM  PIC X(02)   VALUE SPACES.               
019400         10  FILLER               PIC X(01)   VALUE '/'.                  
019500         10  PV-WEEK-FROM-DTE-DD  PIC X(02)   VALUE SPACES.               
019600         10  FILLER               PIC X(01)   VALUE '/'.                  
019700         10  PV-WEEK-FROM-DTE-CC  PIC X(02)   VALUE SPACES.               
019800         10  PV-WEEK-FROM-DTE-YY  PIC X(02)   VALUE SPACES.               
019900                                                                          
020000     05  PV-WEEK-TO-DTE.                                                  
020100         10  PV-WEEK-TO-DTE-MM    PIC X(02)   VALUE SPACES.               
020200         10  FILLER               PIC X(01)   VALUE '/'.                  
020300         10  PV-WEEK-TO-DTE-DD    PIC X(02)   VALUE SPACES.               
020400         10  FILLER               PIC X(01)   VALUE '/'.                  
020500         10  PV-WEEK-TO-DTE-CC    PIC X(02)   VALUE SPACES.               
020600         10  PV-WEEK-TO-DTE-YY    PIC X(02)   VALUE SPACES.               
020700                                                                          
020800     05  PV-ETA-DTE.                                                      
020900         10  PV-ETA-DTE-MM        PIC X(02)   VALUE SPACES.               
021000         10  FILLER               PIC X(01)   VALUE '/'.                  
021100         10  PV-ETA-DTE-DD        PIC X(02)   VALUE SPACES.               
021200         10  FILLER               PIC X(01)   VALUE '/'.                  
021300         10  PV-ETA-DTE-CC        PIC X(02)   VALUE SPACES.               
021400         10  PV-ETA-DTE-YY        PIC X(02)   VALUE SPACES.               
021500                                                                          
021600     05  PV-PO-CUR-FIELDS.                                                
021700         10 PV-PO-CUR-RUL-ID            PIC  S9(9) COMP VALUE 0.          
021800         10 PV-PO-CUR-PO-NBR            PIC  S9(9) COMP VALUE 0.          
021900         10 PV-PO-CUR-SPLIT-TYP         PIC  X(1) VALUE SPACES.           
022000                                                                          
022100     05  PV-CNTNR-CUR-RESULTS.                                            
022200         10 PV-CNTNR-CUR-CONTNR-ID      PIC X(30)   VALUE SPACES.         
022300         10 PV-CNTNR-CUR-VES            PIC X(30)   VALUE SPACES.         
022400         10 PV-CNTNR-CUR-ETA            PIC X(26)   VALUE SPACES.         
022500         10 PV-CNTNR-CUR-TRIP-ID        PIC X(10)   VALUE SPACES.         
022610         10 PV-CNTNR-CUR-SEQ-NBR        PIC S9(4)   COMP VALUE 0.         
022700                                                                          
022800     05  PV-VSL-CUR-RESULTS.                                              
022900         10 PV-VSL-CUR-RUL-ID           PIC S9(9)   COMP VALUE 0.         
023000         10 PV-VSL-CUR-CONTNR-ID        PIC X(30)   VALUE SPACES.         
023100         10 PV-VSL-CUR-SEQ-NBR-X        PIC X(30)   VALUE SPACES.         
023120         10 PV-VSL-CUR-SEQ-NBR          PIC 9(6)    VALUE 0.              
023200                                                                          
023300     05  PV-PO-MULTI-SCAC-FLDS.                                           
023400         10 PV-COMPARE-RUL-TYP          PIC X(03)   VALUE SPACES.         
023500         10 PV-COMPARE-RUL-CDE          PIC X(04)   VALUE SPACES.         
023600         10 PV-COMPARE-DECON-SCAC       PIC X(04)   VALUE SPACES.         
023610         10 PV-DECON-SCAC-ENTERED       PIC X(04)   VALUE SPACES.         
023700                                                                          
023710     05  PV-EDIT-FUNC-QTY            PIC ZZZ9.                            
023720                                                                          
023800*****************************************************************         
023900*  RECORD LAYOUT FOR THE POE CODE SELECTION TEMP STORAGE QUEUE. *         
024000*****************************************************************         
024100                                                                          
024200     COPY TRWS023.                                                        
024300                                                                          
024400 EJECT                                                                    
024500******************************************************************        
024600*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *        
024700******************************************************************        
024800                                                                          
024900     COPY DPWS044.                                                        
025000 EJECT                                                                    
025100******************************************************************        
025200*    MAP LAYOUT                                                  *        
025300******************************************************************        
025400                                                                          
025500     COPY TRKM323.                                                        
025600                                                                          
025700                                                                          
025800     EJECT                                                                
025900******************************************************************        
026000*    ATTRIBUTE SETTINGS COPYBOOK.                                *        
026100******************************************************************        
026200                                                                          
026300     COPY DPWS015.                                                        
026400                                                                          
026500******************************************************************        
026600*    FUNCTION KEYS COPYBOOK                                      *        
026700******************************************************************        
026800                                                                          
026900     COPY DPWS016.                                                        
027000 EJECT                                                                    
027100*****************************************************************         
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
027300*****************************************************************         
027400     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
027500 EJECT                                                                    
027600*****************************************************************         
027700*    STANDARD COMMAREA.                                         *         
027800*****************************************************************         
027900                                                                          
028000     COPY DPWS020.                                                        
028100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
028200                                                                          
028300*****************************************************************         
028400*    INTER-APPLICATION COMMAREA.                                *         
028500*****************************************************************         
028600                                                                          
028700         10  INTER-APPL-COMM-AREA PIC X(200).                             
028800     COPY TRWS320.                                                        
028900*****************************************************************         
029000*    SPECIFIC COMMMAREA FOR TRKCS323.                           *         
029100*****************************************************************         
029200         10  ASC-SPECIFIC-COMMAREA.                                       
029300             15  ASC-UPD-COMPLETE-SW            PIC  X(01).               
029400                 88  ASC-UPD-COMPLETE                   VALUE 'Y'.        
029500                 88  ASC-UPD-PENDING                    VALUE 'N'.        
029600             15  ASC-FORMAT-IND                 PIC  X(01).               
029700                 88  ASC-CONTR-LIST-FORMAT              VALUE '1'.        
029800             15  ASC-VIEW                       PIC  X(08).               
029900             15  ASC-POE-CDE                    PIC  X(03).               
030000             15  ASC-WEEK-FROM-DTE              PIC  X(10).               
030100             15  ASC-WEEK-TO-DTE                PIC  X(10).               
030200             15  ASC-CONTNR-ID                  PIC  X(12).               
030300             15  ASC-CONTNR-SEQ-NBR             PIC  9(06).               
030400             15  ASC-ETA-DATE                   PIC  X(10).               
030500             15  ASC-VESSEL                     PIC  X(25).               
030600             15  ASC-VOYAGE                     PIC  X(10).               
030700             15  ASC-FOB-CDE                    PIC  X(03).               
030800             15  ASC-DECON-SCAC-CUR             PIC  X(04).               
030900             15  ASC-WEEK-ENTERED-DTE           PIC  X(10).               
031000             15  ASC-POE-NM                     PIC  X(30).               
031100             15  ASC-RUL-ID-DEFLT               PIC  S9(9) COMP.          
031200             15  ASC-RUL-ID-USED                PIC  S9(9) COMP.          
031300             15  ASC-RUL-CDE-USED               PIC  X(04).               
031400             15  ASC-RUL-TYP-CDE-USED           PIC  X(03).               
031500             15  ASC-DECON-SCAC-VESSEL          PIC  X(04).               
031600             15  ASC-DECON-SCAC-CONTNR          PIC  X(04).               
031700             15  ASC-DECON-SCAC-EDIT            PIC  X(04).               
031800                                                                          
031900*MAM                                                                      
032000             15  ASC-POE-CODE-IND               PIC  X(01).               
032100                 88  ASC-VALID-POE-CODE        VALUE 'Y'.                 
032200                 88  ASC-INACTIVE-POE-CODE     VALUE 'I'.                 
032300                 88  ASC-INVALID-POE-CODE      VALUE 'N'.                 
032400             15  ASC-SCAC-CDE-IND               PIC  X(01).               
032500                 88  ASC-VALID-SCAC-CDE        VALUE 'Y'.                 
032600                 88  ASC-INVALID-SCAC-CDE      VALUE 'N'.                 
032700             15  ASC-USE-SELECTION-QUEUE-IND PIC  X(01).                  
032800                 88  ASC-USE-SEL-QUEUE         VALUE 'Y'.                 
032900             15  ASC-LIST-QUEUE-NAME.                                     
033000                 20  ASC-LIST-TERM-ID                PIC  X(04).          
033100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
033200                                                          COMP-3.         
033300                 20  ASC-LIST-SEQ                    PIC  9(01).          
033400             15  ASC-NUMBER-OF-SELECTED-ITEMS                             
033500                                            PIC S9(09) COMP-3.            
033600             15  ASC-NUMBER-OF-TS-ITEMS     PIC S9(05) COMP-3.            
033700             15  ASC-SEL-QUEUE-NAME.                                      
033800                 20  ASC-SEL-TERM-ID        PIC X(04).                    
033900                 20  ASC-SEL-TASK           PIC S9(05) COMP-3.            
034000                 20  ASC-SEL-SEQ            PIC 9(01).                    
034100             15  ASC-SEL-SUB                PIC S9(04) COMP.              
034200             15  ASC-SEL-ITEM               PIC S9(04) COMP.              
034300     EJECT                                                                
034400******************************************************************        
034500*    ABEND PROCESSING COPYBOOK.                                  *        
034600******************************************************************        
034700                                                                          
034800     COPY DPWS013.                                                        
034900                                                                          
035000******************************************************************        
035100*    DB2 AREA FOR TEXTENT TABLE                                  *        
035200******************************************************************        
035300     EXEC SQL                                                             
035400          INCLUDE TEXTENT                                                 
035500     END-EXEC.                                                            
035600                                                                          
035700******************************************************************        
035800*    DB2 AREA FOR ENTERPRISE TABLE                               *        
035900******************************************************************        
036000     EXEC SQL                                                             
036100          INCLUDE TENTNME                                                 
036200     END-EXEC.                                                            
036300                                                                          
036400******************************************************************        
036500*    DB2 AREA FOR TRANSPORATION PORT OF ENTRY (POE) TABLE        *        
036600******************************************************************        
036700     EXEC SQL                                                             
036800          INCLUDE TIMPOE                                                  
036900     END-EXEC.                                                            
037000                                                                          
037100******************************************************************        
037200*    DB2 AREA FOR AUDIT POE TABLE                                *        
037300******************************************************************        
037400     EXEC SQL                                                             
037500          INCLUDE TAUPOE                                                  
037600     END-EXEC.                                                            
037700                                                                          
037800******************************************************************        
037900*    DB2 AREA FOR TRANSPORATION IMPORTS CONTROL TABLE            *        
038000******************************************************************        
038100     EXEC SQL                                                             
038200          INCLUDE TIMCNTL                                                 
038300     END-EXEC.                                                            
038400                                                                          
038500******************************************************************        
038600*    DB2 AREA FOR IMPORTS CONTAINER TRACKING TABLE               *        
038700******************************************************************        
038800     EXEC SQL                                                             
038900          INCLUDE TIMCNTK                                                 
039000     END-EXEC.                                                            
039100                                                                          
039200******************************************************************        
039300*    DB2 AREA FOR IMPORTS CONTAINER PO TABLE                     *        
039400******************************************************************        
039500     EXEC SQL                                                             
039600          INCLUDE TIMCNPO                                                 
039700     END-EXEC.                                                            
039800                                                                          
039900******************************************************************        
040000*    DB2 AREA FOR SHIPMENT TABLE                                 *        
040100******************************************************************        
040200     EXEC SQL                                                             
040300          INCLUDE TSHIPMT                                                 
040400     END-EXEC.                                                            
040500                                                                          
040600******************************************************************        
040700*    DB2 AREA FOR SHIPMENT PURCHASE ORDER TABLE                  *        
040800******************************************************************        
040900     EXEC SQL                                                             
041000          INCLUDE TSHPTPO                                                 
041100     END-EXEC.                                                            
041200                                                                          
041300******************************************************************        
041400     EXEC SQL                                                             
041500          INCLUDE TPURCHS                                                 
041600     END-EXEC.                                                            
041700                                                                          
041800******************************************************************        
041900*    DB2 AREA FOR TVEHICL TABLE (TRAILERS AND VESEL NAMES)       *        
042000******************************************************************        
042100     EXEC SQL                                                             
042200          INCLUDE TVEHICL                                                 
042300     END-EXEC.                                                            
042400                                                                          
042500******************************************************************        
042600*    DB2 AREA FOR TVHTRIP TABLE                                  *        
042700******************************************************************        
042800     EXEC SQL                                                             
042900          INCLUDE TVHTRIP                                                 
043000     END-EXEC.                                                            
043100                                                                          
043200******************************************************************        
043300* DECON CONTROL PANEL RULE TABLE - TRT_RUL                                
043400******************************************************************        
043500     EXEC SQL                                                             
043600         INCLUDE TRT00014                                                 
043700     END-EXEC.                                                            
043800*                                                                         
043900******************************************************************        
044000* DECON CONTROL PANEL RULE CONSTRAINT TABLE - TRT_RUL_CNSTR               
044100******************************************************************        
044200     EXEC SQL                                                             
044300         INCLUDE TRT00015                                                 
044400     END-EXEC.                                                            
044500*                                                                         
044600******************************************************************        
044700* DECON CONTROL PANEL AUDIT RULE TABLE - TRT_AUD_RUL                      
044800******************************************************************        
044900     EXEC SQL                                                             
045000         INCLUDE TRT00017                                                 
045100     END-EXEC.                                                            
045200*                                                                         
045300******************************************************************        
045400* DECON CONTROL PANEL RULE AUDIT CONSTRAINT TABLE -                       
045500*                                           TRT_AUD_RUL_CNSTR             
045600******************************************************************        
045700     EXEC SQL                                                             
045800         INCLUDE TRT00018                                                 
045900     END-EXEC.                                                            
046000*                                                                         
046010*---------------------------------------------------------------*         
046020*    PARM TABLE                                                           
046030*---------------------------------------------------------------*         
046031* PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN - MJF          
046032*                ADD PARM TABLE                                           
046040     EXEC SQL                                                             
046050          INCLUDE TKRPRPM                                                 
046060     END-EXEC.                                                            
046070                                                                          
046100******************************************************************        
046200*    DB2 AREA FOR COMMUNICATIONS                                 *        
046300******************************************************************        
046400     EXEC SQL                                                             
046500          INCLUDE SQLCA                                                   
046600     END-EXEC.                                                            
046700                                                                          
046800*                                                                         
046900*  VESSEL CONTAINER CURSOR FOR PO W/ DIF DECON EDIT                       
047000*                                                                         
047100     EXEC SQL                                                             
047200          DECLARE VSL_CONT_CUR CURSOR FOR                                 
047300             SELECT RT.RUL_ID                                             
047400                   ,CNT.RUL_CNSTR_VAL_TXT                                 
047500                   ,SEQ.RUL_CNSTR_VAL_TXT                                 
047700               FROM TRT_RUL RT                                            
047800                   ,TRT_RUL_CNSTR CNT                                     
047900                   ,TRT_RUL_CNSTR SEQ                                     
048000                   ,TRT_RUL_CNSTR VSL                                     
048200              WHERE RT.RUL_CDE = 'CONT'                                   
048300                AND RT.RUL_TYP_CDE = 'DEF'                                
048400                AND VSL.RUL_CNSTR_VAL_TXT  = :TR320-VESSEL                
048500                AND VSL.RUL_CNSTR_TYP_CDE  = 'VSL'                        
048600                AND VSL.RUL_ID             = RT.RUL_ID                    
049100                AND CNT.RUL_CNSTR_TYP_CDE  = 'CONT'                       
049200                AND CNT.RUL_ID             = RT.RUL_ID                    
049300                AND SEQ.RUL_CNSTR_TYP_CDE  = 'SEQ'                        
049400                AND SEQ.RUL_ID             = RT.RUL_ID                    
049500                AND SEQ.RUL_CNSTR_CDE      = CNT.RUL_CNSTR_CDE            
049600     END-EXEC.                                                            
049700                                                                          
049800*                                                                         
049900*  CURSOR DECLARATION TO OBTAIN ALL RULE CONSTRAINTS                      
050000*                                                                         
050100     EXEC SQL                                                             
050200          DECLARE CNSTR_CUR CURSOR FOR                                    
050300           SELECT  RUL_ID                                                 
050400                  ,RUL_CNSTR_CDE                                          
050500                  ,RUL_CNSTR_TYP_CDE                                      
050600                  ,RUL_CNSTR_VAL_TXT                                      
050700                  ,CRE_TMST                                               
050800                  ,CRE_BY_USR_ID                                          
050900             FROM TRT_RUL_CNSTR                                           
051000             WHERE RUL_ID = :PV-CURRENT-RUL-ID                            
051100     END-EXEC.                                                            
051200                                                                          
051300*                                                                         
051400*  CURSOR DECLARATION TO OBTAIN ALL AUDIT RULE CONSTRAINTS                
051500*                                                                         
051600     EXEC SQL                                                             
051700          DECLARE CNSTR_CUR_ADD CURSOR FOR                                
051800           SELECT  RUL_CNSTR_CDE                                          
051900                  ,RUL_CNSTR_TYP_CDE                                      
052000                  ,RUL_CNSTR_VAL_TXT                                      
052100                  ,CRE_TMST                                               
052200                  ,CRE_BY_USR_ID                                          
052300                  ,AUD_CRE_USR_ID                                         
052400                  ,AUD_FUNC_CDE                                           
052500                  ,AUD_CRE_TMST                                           
052600             FROM TRT_AUD_RUL_CNSTR                                       
052700             WHERE RUL_ID = :PV-CURRENT-RUL-ID                            
052800               AND RUL_CNSTR_VAL_TXT  ^= 'DECN'                           
052900     END-EXEC.                                                            
053000                                                                          
053100*---------------------------------------------------------------*         
053200*    CURSOR TO PULL PURCHASE ORDERS FOR EACH CONTAINER.         *         
053300*---------------------------------------------------------------*         
053400                                                                          
053500     EXEC SQL                                                             
053600        DECLARE PO_CUR CURSOR                                             
053700          FOR                                                             
053800***                                                                       
053900***   CON POS                                                             
054000***                                                                       
054100           SELECT PO.PO_NBR                                               
054200                 ,'P'                                                     
054300            FROM TRT_RUL_CNSTR CT                                         
054400                ,TPURCHS PO                                               
054500           WHERE CT.RUL_ID = :PV-PO-CUR-RUL-ID                            
054600             AND CT.RUL_CNSTR_TYP_CDE = 'CONPO'                           
054700             AND INTEGER(SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,9))                
054800                                   = PO.PO_NBR                            
181356**           AND PO.PO_TYP_CDE    IN ('IM','IE','IF','LD')                
181356             AND PO.PO_TYP_CDE    IN ('IM','IE','IF','LD','LE')           
055000             AND PO.VER_STATUS_CDE = 'A'                                  
055100             AND PO.STATUS_CDE    IN ('AC','AP','CA','CM')                
055200    UNION ALL                                                             
055300*--                                                                       
055400*--  CMNS                                                                 
055500*--                                                                       
055600           SELECT CNPO.PO_NBR                                             
055700                 ,'C'                                                     
055800             FROM TIMCNPO CNPO                                            
055900                 ,TPURCHS PO                                              
056000            WHERE CNPO.CONTNR_ID      = :IMCNPO-CONTNR-ID                 
056100              AND CNPO.CONTNR_SEQ_NBR = :IMCNPO-CONTNR-SEQ-NBR            
056200              AND CNPO.PO_NBR         = PO.PO_NBR                         
181356**            AND PO.PO_TYP_CDE      IN ('IM','IE','IF','LD')             
181356              AND PO.PO_TYP_CDE      IN ('IM','IE','IF','LD','LE')        
056400              AND PO.VER_STATUS_CDE   = 'A'                               
056500              AND PO.STATUS_CDE      IN ('AC','AP','CA','CM')             
056600**          ELIMINATE PO OVERIDES                                         
056700              AND NOT EXISTS                                              
056800                (SELECT *                                                 
056900                   FROM TRT_RUL_CNSTR CT                                  
057000                  WHERE CT.RUL_ID = :PV-PO-CUR-RUL-ID                     
057100                    AND CT.RUL_CNSTR_TYP_CDE = 'CONPO')                   
057200     END-EXEC.                                                            
057300                                                                          
057400*---------------------------------------------------------------*         
057500*  CURSOR DECLARATION FOR OTHER CON CONTAINERS WITH OUR PO.               
057600*---------------------------------------------------------------*         
057700     EXEC SQL                                                             
057800          DECLARE CON_CUR CURSOR FOR                                      
057900             SELECT A.PRO_NBR                                             
058000                   ,V.VEH_NBR                                             
058100                   ,DATE(T.EST_AR_TMST)                                   
058200               FROM TSHIPMT A                                             
058300                   ,TSHPTPO B                                             
058400                   ,TVHTRIP T                                             
058500                   ,TVEHICL V                                             
058600              WHERE B.PO_NBR    = :PV-PO-CUR-PO-NBR                       
058700                AND A.SHIPT_ID  = B.SHIPT_ID                              
058800                AND A.PRO_NBR  ^= :IMCNPO-CONTNR-ID                       
058900                AND T.TRIP_ID   = A.TRIP_ID                               
059000                AND V.VEH_NBR   = T.VEH_NBR                               
059100     END-EXEC.                                                            
059200                                                                          
059300*---------------------------------------------------------------*         
059400*  CURSOR DECLARATION FOR OTHER CMN CONTAINERS WITH OUR PO.               
059500*---------------------------------------------------------------*         
059600                                                                          
059700     EXEC SQL                                                             
059800          DECLARE CMN_CUR CURSOR FOR                                      
059900             SELECT A.CONTNR_ID                                           
060000                   ,A.CONTNR_SEQ_NBR                                      
060100                   ,A.MOM_IMPRT_VEH_NM                                    
060200                   ,A.MOM_IMPRT_TRIP_ID                                   
060210                   ,DATE(A.MOM_POE_DELY_TMST)                             
060300               FROM TIMCNTK A                                             
060400                   ,TIMCNPO B                                             
060500              WHERE B.PO_NBR      = :PV-PO-CUR-PO-NBR                     
060600                AND B.CONTNR_ID  ^= :IMCNPO-CONTNR-ID                     
060700                AND A.CONTNR_ID   = B.CONTNR_ID                           
060800     END-EXEC.                                                            
060900                                                                          
061000*---------------------------------------------------------------*         
061100*                                                                         
061200 EJECT                                                                    
061300 LINKAGE SECTION.                                                         
061400                                                                          
061500 01  DFHCOMMAREA.                                                         
061600     05  FILLER                         OCCURS  1 TO 4072 TIMES           
061700                                        DEPENDING ON EIBCALEN.            
061800         10  FILLER                     PIC  X(01).                       
061900                                                                          
062000                                                                          
062100 PROCEDURE DIVISION.                                                      
062200*****************************************************************         
062300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. **         
062400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  **         
062500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            **         
062600**                                                             **         
062700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  **         
062800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       **         
062900*****************************************************************         
063000 0000-MAIN-MODULE.                                                        
063100     INITIALIZE DP030-CICS-API-FIELDS.                                    
063200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
063300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
063400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
063500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
063600     MOVE LENGTH OF TR323AI        TO DP030-MAP-LENGTH (1).               
063700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
063800     PERFORM 0001-CALL-CICS-ARCH-API.                                     
063900                                                                          
064000     PERFORM 1000-CONTROL-PROCESSING.                                     
064100                                                                          
064200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
064300     PERFORM 0001-CALL-CICS-ARCH-API.                                     
064400                                                                          
064500 0001-CALL-CICS-ARCH-API.                                                 
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
064700                                    DFHCOMMAREA                           
064800                                    DP030-CICS-API-FIELDS                 
064900                                    DP020-STANDARD-COMMAREA               
065000                                    TR323AI.                              
065100                                                                          
065200     IF  DP030-RC-CALL-SUCCESSFUL                                         
065300         CONTINUE                                                         
065400     ELSE                                                                 
065500         SET DP013-NO-ROLLBACK                                            
065600             DP013-XCTL-DISPLAY-RESTART                                   
065700             DP013-CICS-ABEND      TO TRUE                                
065800         MOVE 'BEFORE 0000-MAIN-MODULE'                                   
065900                                   TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
066200         MOVE DP030-RETURN-CODE                                           
066300                                   TO DP013-MESSAGE-TEXT (3)              
066400         PERFORM DP013-0000-PROCESS-ABEND                                 
066500     END-IF.                                                              
066600 EJECT                                                                    
066700******************************************************************        
066800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
066900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
067000******************************************************************        
067100                                                                          
067200 1000-CONTROL-PROCESSING.                                                 
067300                                                                          
067400     EVALUATE TRUE                                                        
067500         WHEN DP020-NEXT-ACT-INITIAL                                      
067600             INITIALIZE ASC-SPECIFIC-COMMAREA                             
067700*MAM         PERFORM 7500-MOVE-TR022-TO-ASC                               
067800*MAM         MOVE DP020-INT-APPL-FORMAT-IND TO ASC-FORMAT-IND             
067900             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
068000             PERFORM 4000-BUILD-INITIAL-PANEL                             
068100*******      PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
068200                                                                          
068300         WHEN DP020-NEXT-ACT-READ-MAP                                     
068400             PERFORM 2000-PROCESS-PANEL                                   
068500             PERFORM 7580-MOVE-COMMAREA-TO-SCREEN                         
068600                                                                          
068700         WHEN DP020-NEXT-ACT-RETURN                                       
068800             PERFORM 7580-MOVE-COMMAREA-TO-SCREEN                         
068900                                                                          
069000         WHEN OTHER                                                       
069100             SET DP013-LOGIC-ABEND                                        
069200                 DP013-NO-ROLLBACK TO TRUE                                
069300             MOVE '1000-CONTROL-PROCESSING'                               
069400                                   TO DP013-PARAGRAPH                     
069500             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
069600                                   TO DP013-MESSAGE-TEXT(1)               
069700             MOVE DP020-NEXT-APPL-ACTIVITY                                
069800                                   TO DP013-MESSAGE-TEXT(2)               
069900             PERFORM DP013-0000-PROCESS-ABEND                             
070000     END-EVALUATE.                                                        
070100                                                                          
070200******************************************************************        
070300*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *        
070400*    INTER-APPLICATION FORMAT CODE.                              *        
070500*                                                                *        
070600*    PERFORM SPECIFIC VALIDATIONS FOR EACH "MODE" AND BASED      *        
070700*    ON WHERE THE PROGRAM WAS INITIATED FROM.                    *        
070800******************************************************************        
070900 1100-PROCESS-INTER-APPL-COMM.                                            
071000                                                                          
071100     SET PS-COMMAREA-VALID         TO TRUE.                               
071200                                                                          
071300     IF  DP020-INT-APPL-FORMAT-IND = PC-CONTNR-PO-LIST-FORMAT             
071400          MOVE TR320-VIEW             TO ASC-VIEW                         
071500*MAM????                           DK-VIEW                                
071600          MOVE TR320-POE-CDE          TO ASC-POE-CDE                      
071700          MOVE TR320-WEEK-FROM-DTE    TO ASC-WEEK-FROM-DTE                
071800          MOVE TR320-WEEK-TO-DTE      TO ASC-WEEK-TO-DTE                  
071900          MOVE TR320-CONTNR-ID        TO ASC-CONTNR-ID                    
072000          MOVE TR320-CONTNR-SEQ-NBR   TO ASC-CONTNR-SEQ-NBR               
072100          MOVE TR320-ETA-DATE         TO ASC-ETA-DATE                     
072200          MOVE TR320-VESSEL           TO ASC-VESSEL                       
072300          MOVE TR320-VOYAGE           TO ASC-VOYAGE                       
072400          MOVE TR320-FOB-CDE          TO ASC-FOB-CDE                      
072500          MOVE TR320-DECON-SCAC-CUR   TO ASC-DECON-SCAC-CUR               
072600          MOVE TR320-WEEK-ENTERED-DTE TO ASC-WEEK-ENTERED-DTE             
072700          MOVE TR320-RUL-ID-DEFLT     TO ASC-RUL-ID-DEFLT                 
072800          MOVE TR320-RUL-ID-USED      TO ASC-RUL-ID-USED                  
072900          MOVE TR320-RUL-CDE-USED     TO ASC-RUL-CDE-USED                 
073000          MOVE TR320-RUL-TYP-CDE-USED TO ASC-RUL-TYP-CDE-USED             
073100     END-IF.                                                              
073200                                                                          
073300**************************************                                    
073400*MAM         IF  PS-NO-ERROR                                              
073500*                 MOVE DP015-HL-OFF         TO APOECODH                   
073600*                                              AEDICODH                   
073700*                                              ADCNSLCH                   
073800*                 MOVE DP015-PRO-NOR-OFF    TO APOECODA                   
073900*                                              AEDICODA                   
074000*                                              ADCNSLCA                   
074100*                 MOVE DP015-BLUE           TO APOECODC                   
074200*                                              AEDICODC                   
074300*                                              ADCNSLCC                   
074400*                                                                         
074500*              IF ASC-UPD-FROM-LIST                                       
074600*                  MOVE -1               TO AIATACDL                      
074700*                  SET ASC-UPD-PENDING   TO TRUE                          
074800*              ELSE                                                       
074900** PRESS F2 TO CONFIRM ***                                                
075000*                  MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER              
075100*                  SET ASC-DEL-PENDING                                    
075200*                      DP020-MSG-INFORMATIONAL TO TRUE                    
075300*              END-IF                                                     
075400*            END-IF                                                       
075500*EJECT                                                                    
075600                                                                          
075700******************************************************************        
075800* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*        
075900* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*        
076000* EDITS.                                                         *        
076100******************************************************************        
076200 2000-PROCESS-PANEL.                                                      
076300                                                                          
076400     EVALUATE TRUE                                                        
076500                                                                          
076600         WHEN DP020-SRC-AID = DP016-CLEAR                                 
076700             PERFORM 7580-MOVE-COMMAREA-TO-SCREEN                         
076800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
076900                                                                          
077000         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                            
077100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
077200             IF  PS-NO-ERROR                                              
077300             AND ASC-UPD-PENDING                                          
077400                                                                          
077500*               AUDIT EXISTING WORKING RULE                               
077600                IF ASC-RUL-TYP-CDE-USED EQUAL PC-WKG                      
077700                   MOVE ASC-RUL-ID-USED  TO PV-AUDIT-RUL-ID               
077800                   IF ASC-DECON-SCAC-CONTNR > SPACES                      
077900                      IF ASC-RUL-CDE-USED = 'CONT'                        
078000                         MOVE 'CONT'     TO PV-AUDIT-RUL-CDE              
078100                      ELSE                                                
078200                         MOVE SPACES     TO PV-AUDIT-RUL-CDE              
078300                      END-IF                                              
078400                   ELSE                                                   
078500                      MOVE 'VSL '        TO PV-AUDIT-RUL-CDE              
078600                   END-IF                                                 
078700                                                                          
078800                   IF  ASC-DECON-SCAC-VESSEL > SPACES                     
078900                   AND ASC-RUL-CDE-USED      = 'CONT'                     
079000                      PERFORM 6000-SELECT-WKG-VESSEL-RULE                 
079100                   END-IF                                                 
079200                                                                          
079300                   IF  PV-AUDIT-RUL-ID GREATER THAN ZEROES                
079400                   AND PV-AUDIT-RUL-CDE GREATER THAN SPACES               
079500                      PERFORM 6100-AUDIT-WORKING-RULE                     
079600                      PERFORM 6200-AUDIT-WORKING-CNSTR                    
079700                      PERFORM 6300-DELETE-WORKING-RULE                    
079800                   END-IF                                                 
079900                END-IF                                                    
080000                                                                          
080100                PERFORM 6400-SELECT-DEFALUT-RULE                          
080200                PERFORM 6500-ADD-WORKING-RULE                             
080300                PERFORM 6600-ADD-WORKING-CNSTR                            
080400                PERFORM 6700-UPDATE-DECON-SCAC                            
080500                MOVE PC-TSYMSG-00034        TO DP020-MSG-NUMBER           
080600                SET DP020-MSG-INFORMATIONAL TO TRUE                       
080700             END-IF                                                       
080800             SET ASC-UPD-COMPLETE          TO TRUE                        
080900                                                                          
081000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
081100             PERFORM 3200-RESET-ATTRIBUTES                                
081200             MOVE -1                     TO ASCAC1L                       
081300             MOVE SPACES                 TO ASC-DECON-SCAC-VESSEL         
081400                                            ASC-DECON-SCAC-CONTNR         
081500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
081600             MOVE ZEROES                 TO DP020-MSG-NUMBER              
081700             MOVE DP020-INT-APPL-FORMAT-IND TO ASC-FORMAT-IND             
081800             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
081900             PERFORM 4000-BUILD-INITIAL-PANEL                             
082000                                                                          
085800         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                      
085900            INITIALIZE TR320-INTER-APPL-COMMAREA                          
086000            MOVE ASC-POE-CDE       TO TR320-POE-CDE                       
086100            MOVE ASC-WEEK-FROM-DTE TO TR320-WEEK-FROM-DTE                 
086200            MOVE ASC-WEEK-TO-DTE   TO TR320-WEEK-TO-DTE                   
086201                                                                          
086202         WHEN OTHER                                                       
086203             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
086204             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
086205             SET ASC-UPD-COMPLETE TO TRUE                                 
086206             IF  PS-NO-ERROR                                              
086207                 PERFORM 2100-CHECK-FUNCTION-KEY                          
086208                 SET DP030-CONTINUE-GO TO TRUE                            
086209             ELSE                                                         
086210                 SET DP030-OVERRIDE-GO TO TRUE                            
086211             END-IF                                                       
086212     END-EVALUATE.                                                        
086213                                                                          
086214 EJECT                                                                    
086215******************************************************************        
086216** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **        
086217** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **        
086218** FROM THE CICS ARCHITECTURE API.                              **        
086219******************************************************************        
086220 2100-CHECK-FUNCTION-KEY.                                                 
086221                                                                          
086222     EVALUATE TRUE                                                        
086223                                                                          
086224*DON'T ACTUALLY INSERT OR DELETE/INSERT YET -- WAIT FOR F2-CONFIRM        
086225                                                                          
086226         WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)                      
086227             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
086228             IF PS-NO-ERROR                                               
086229*               *** DISPLAY 'PRESS F2 TO CONFIRM' MESSAGE                 
086230                MOVE PC-TSYMSG-00004        TO DP020-MSG-NUMBER           
086231                SET ASC-UPD-PENDING                                       
086232                    DP020-MSG-INFORMATIONAL TO TRUE                       
086233                PERFORM 2110-PREPARE-INTER-APPL-COMM                      
086234             END-IF                                                       
086235                                                                          
086236                                                                          
086237*************************************************************             
086238*                                                                         
088100                                                                          
088200         WHEN DP020-SRC-AID = DP016-ENTER                                 
088300             CONTINUE                                                     
088400                                                                          
088500         WHEN OTHER                                                       
088600             SET DP013-NO-ROLLBACK                                        
088700                 DP013-XCTL-DISPLAY-RESTART                               
088800                 DP013-CICS-ABEND  TO TRUE                                
088900             MOVE '2100-CHECK-FUNCTION-KEY'                               
089000                                   TO DP013-PARAGRAPH                     
089100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
089200                                   TO DP013-MESSAGE-TEXT (1)              
089300             PERFORM DP013-0000-PROCESS-ABEND                             
089400     END-EVALUATE.                                                        
089500 EJECT                                                                    
089600                                                                          
089700******************************************************************        
089800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **        
089900** INTER-APPLICATION COMMAREA.                                  **        
090000******************************************************************        
090100 2110-PREPARE-INTER-APPL-COMM.                                            
090200                                                                          
090300      MOVE ASC-VIEW               TO TR320-VIEW.                          
090400      MOVE ASC-POE-CDE            TO TR320-POE-CDE.                       
090500      MOVE ASC-WEEK-FROM-DTE      TO TR320-WEEK-FROM-DTE.                 
090600      MOVE ASC-WEEK-TO-DTE        TO TR320-WEEK-TO-DTE.                   
090700      MOVE ASC-CONTNR-ID          TO TR320-CONTNR-ID.                     
090800      MOVE ASC-CONTNR-SEQ-NBR     TO TR320-CONTNR-SEQ-NBR.                
090900      MOVE ASC-ETA-DATE           TO TR320-ETA-DATE.                      
091000      MOVE ASC-VESSEL             TO TR320-VESSEL.                        
091100      MOVE ASC-VOYAGE             TO TR320-VOYAGE.                        
091200      MOVE ASC-FOB-CDE            TO TR320-FOB-CDE.                       
091300      MOVE ASC-DECON-SCAC-CUR     TO TR320-DECON-SCAC-CUR.                
091400      MOVE ASC-WEEK-ENTERED-DTE   TO TR320-WEEK-ENTERED-DTE.              
091500      MOVE ASC-RUL-ID-DEFLT       TO TR320-RUL-ID-DEFLT.                  
091600      MOVE ASC-RUL-ID-USED        TO TR320-RUL-ID-USED.                   
091700      MOVE ASC-RUL-CDE-USED       TO TR320-RUL-CDE-USED.                  
091800      MOVE ASC-RUL-TYP-CDE-USED   TO TR320-RUL-TYP-CDE-USED.              
091900                                                                          
092000******************************************************************        
092100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*        
092200* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *        
092300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *        
092400******************************************************************        
092500 2200-MOVE-SCREEN-TO-COMMAREA.                                            
092600                                                                          
092700     IF  ASCAC1L > ZERO                                                   
092800         MOVE ASCAC1I              TO ASC-DECON-SCAC-VESSEL               
092900     ELSE                                                                 
093000         IF  ASCAC1F = DP015-ERASE-EOF                                    
093100             MOVE SPACE            TO ASC-DECON-SCAC-VESSEL               
093200         END-IF                                                           
093300     END-IF.                                                              
093400                                                                          
093500     IF  ASCAC2L > ZERO                                                   
093600         MOVE ASCAC2I              TO ASC-DECON-SCAC-CONTNR               
093700     ELSE                                                                 
093800         IF  ASCAC2F = DP015-ERASE-EOF                                    
093900             MOVE SPACE            TO ASC-DECON-SCAC-CONTNR               
094000         END-IF                                                           
094100     END-IF.                                                              
094200                                                                          
094300******************************************************************        
094400* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *        
094500* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *        
094600* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *        
094700******************************************************************        
094800 3000-EDIT-DATA-IN-COMMAREA.                                              
094900                                                                          
095000     PERFORM 3200-RESET-ATTRIBUTES.                                       
095001     MOVE 90          TO KRPRPM-LOC-ID.                                   
095002     MOVE 'CPDAYS'    TO KRPRPM-SYS-PRC-FUNC-CDE.                         
095003     MOVE 'IMP'       TO KRPRPM-INTFC-SYS-CDE.                            
095004     MOVE 'AC'        TO KRPRPM-FUNC-PRC-STAT-CDE.                        
095005***  PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN             
095006***       MJF                                                             
095010     PERFORM 7630-SELECT-PARM-NUM-DAYS.                                   
095100     PERFORM 3010-RETRIEVE-CURRENT-TMST.                                  
095200     SET PS-NO-ERROR TO TRUE.                                             
095300                                                                          
095400     EVALUATE TRUE                                                        
095500                                                                          
095600      WHEN ASC-DECON-SCAC-VESSEL > SPACES                                 
095700       AND ASC-DECON-SCAC-CONTNR > SPACES                                 
095800*     --- TSYMSG-01883-ONLY ONE VALUE SHOULD BE ENTERED                   
095900               SET PS-ERROR                                               
096000                   DP020-MSG-FATAL         TO TRUE                        
096100               MOVE PC-TSYMSG-01883        TO DP020-MSG-NUMBER            
096200               MOVE DP015-UNP-ALP-BRT-OFF  TO ASCAC1A                     
096300                                              ASCAC2A                     
096400               MOVE DP015-RED              TO ASCAC1C                     
096500                                              ASCAC2C                     
096600               MOVE DP015-REVERSE          TO ASCAC1H                     
096700                                              ASCAC2H                     
096800               MOVE -1                     TO ASCAC1L                     
096900                                              ASCAC2L                     
097000               SET DP030-SET-CURSOR-APPL-1 TO TRUE                        
097100                                                                          
097200*     --- TSYMSG-01882-AT LEAST ONE VALUE MUST BE ENTERED                 
097300      WHEN ASC-DECON-SCAC-VESSEL = SPACES                                 
097400       AND ASC-DECON-SCAC-CONTNR = SPACES                                 
097500               SET PS-ERROR                                               
097600                   DP020-MSG-FATAL         TO TRUE                        
097700               MOVE PC-TSYMSG-01882        TO DP020-MSG-NUMBER            
097800               MOVE DP015-UNP-ALP-BRT-OFF  TO ASCAC1A                     
097900                                              ASCAC2A                     
098000               MOVE DP015-RED              TO ASCAC1C                     
098100                                              ASCAC2C                     
098200               MOVE DP015-REVERSE          TO ASCAC1H                     
098300                                              ASCAC2H                     
098400               MOVE -1                     TO ASCAC1L                     
098500                                              ASCAC2L                     
098600               SET DP030-SET-CURSOR-APPL-1 TO TRUE                        
098700                                                                          
098800      WHEN OTHER                                                          
098900        PERFORM 4100-VALIDATE-SCAC-CDE-PREP                               
099000        PERFORM 4105-VALIDATE-SCAC-CDE                                    
099100*       ---TSYMSG-02609 -- SCAC CODE MUST BE VALID ****                   
099200        IF ASC-INVALID-SCAC-CDE                                           
099300           SET PS-ERROR                                                   
099400               DP020-MSG-FATAL   TO TRUE                                  
099500           MOVE PC-TSYMSG-02609  TO DP020-MSG-NUMBER                      
099600                                                                          
099700           IF ASC-DECON-SCAC-CONTNR > SPACES                              
099800              MOVE DP015-UNP-ALP-BRT-OFF  TO ASCAC2A                      
099900              MOVE DP015-RED              TO ASCAC2C                      
100000              MOVE DP015-REVERSE          TO ASCAC2H                      
100100              MOVE -1                     TO ASCAC2L                      
100200           ELSE                                                           
100300              IF ASC-DECON-SCAC-VESSEL > SPACES                           
100400                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASCAC1A                   
100500                 MOVE DP015-RED              TO ASCAC1C                   
100600                 MOVE DP015-REVERSE          TO ASCAC1H                   
100700                 MOVE -1                     TO ASCAC1L                   
100800              END-IF                                                      
100900           END-IF                                                         
101000                                                                          
101100           SET DP030-SET-CURSOR-APPL-1 TO TRUE                            
101200        ELSE                                                              
101300           PERFORM 4110-CHECK-IF-SCAC-CHANGED                             
101400        END-IF                                                            
101500                                                                          
101600     END-EVALUATE.                                                        
101700                                                                          
102200     IF PS-NO-ERROR                                                       
102240*    **********************************************                       
102250*    * ADJUSTMENTS CAN BE MADE FOR X WEEKS IN     *                       
102251*    * PAST THRU THE FUTURE.  NO ADJUSTMENTS ARE  *                       
102260*    * ALLOWED FOR WEEKS PRIOR TO THAT.           *                       
102270*    **********************************************                       
102290* PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN - MJF          
102300       IF PV-DATE-LIMIT < ASC-WEEK-FROM-DTE                               
102310         CONTINUE                                                         
102320       ELSE                                                               
102400         SET PS-ERROR                                                     
102500             DP020-MSG-FATAL   TO TRUE                                    
102600***      MOVE PC-TSYMSG-03359  TO DP020-MSG-NUMBER                        
102610         MOVE PC-TSYMSG-03730  TO DP020-MSG-NUMBER                        
102620         MOVE KRPRPM-FUNC-QTY  TO PV-EDIT-FUNC-QTY                        
102621         MOVE PV-EDIT-FUNC-QTY TO DP020-MSG-TEXT                          
102630* PRB0040274 - 03/20/2012 - END                                           
102700         SET DP030-OVERRIDE-GO TO TRUE                                    
102710       END-IF                                                             
102720     END-IF.                                                              
103310                                                                          
103311     IF PS-NO-ERROR                                                       
103312       SET PS-MULTI-SCACS-NO  TO TRUE                                     
103313       IF ASC-DECON-SCAC-VESSEL > SPACES                                  
103314*        ********************************************                     
103315*        * CHECK IF VSL RULE RESULTS IN MULTI SCACS *                     
103316*        ********************************************                     
103317         MOVE ASC-DECON-SCAC-VESSEL  TO PV-DECON-SCAC-ENTERED             
103318         PERFORM 4600-OPEN-VSL-CUR                                        
103330         PERFORM 4200-MULTI-DECON-EDIT-VSL                                
103340           UNTIL PS-EOC-VSL-CONT-CUR                                      
103350              OR PS-MULTI-SCACS                                           
103360         PERFORM 4630-CLOSE-VSL-CUR                                       
103361       ELSE                                                               
103362*        *********************************************                    
103363*        * CHECK IF CONT RULE RESULTS IN MULTI SCACS *                    
103364*        *********************************************                    
103365         MOVE ASC-DECON-SCAC-CONTNR  TO PV-DECON-SCAC-ENTERED             
103366         MOVE TR320-CONTNR-ID        TO IMCNPO-CONTNR-ID                  
103367         MOVE TR320-CONTNR-SEQ-NBR   TO IMCNPO-CONTNR-SEQ-NBR             
103368         MOVE TR320-RUL-ID-USED      TO PV-PO-CUR-RUL-ID                  
103379         PERFORM 4330-OPEN-PO-CURSOR                                      
103380         PERFORM 4300-MULTI-DECON-EDIT-CONTNR                             
103381            UNTIL PS-EOC-PO-CUR                                           
103382               OR PS-MULTI-SCACS                                          
103383         PERFORM 4340-CLOSE-PO-CURSOR                                     
103384       END-IF                                                             
103385       IF PS-MULTI-SCACS                                                  
103386          SET DP020-MSG-INFORMATIONAL TO TRUE                             
103390          MOVE PC-TSYMSG-03309  TO DP020-MSG-NUMBER                       
103400       END-IF                                                             
103410     END-IF.                                                              
103420                                                                          
104310                                                                          
104500     IF PS-NO-ERROR                                                       
104600         MOVE -1                     TO ASCAC1L                           
104700                                        ASCAC2L                           
104800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
104900     END-IF.                                                              
105000                                                                          
105100*    IF DP020-MSG-NUMBER > SPACES                                         
105200*       CONTINUE                                                          
105300*    ELSE                                                                 
105400*      SET DP030-SET-CURSOR-APPL-1   TO TRUE                              
105500*      IF ASC-UPD-POE                                                     
105600*          MOVE -1                   TO AIATACDL                          
105700*      ELSE                                                               
105800*          MOVE -1                   TO APOECODL                          
105900*      END-IF                                                             
106000*    END-IF.                                                              
106100******************************************************************        
106200 3010-RETRIEVE-CURRENT-TMST.                                              
106300                                                                          
106400     EXEC SQL                                                             
106500        SET :PV-CURRENT-TMST       = CURRENT TIMESTAMP                    
106600     END-EXEC                                                             
106601                                                                          
106603* PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN - MJF          
106610     EXEC SQL                                                             
106630        SET :PV-DATE-LIMIT = (CURRENT_DATE -                              
106631                                     (:KRPRPM-FUNC-QTY) DAYS)             
106640     END-EXEC                                                             
106700                                                                          
106800*                                                                         
106900     EVALUATE TRUE                                                        
107000         WHEN SQLCODE = ZERO                                              
107100             CONTINUE                                                     
107200         WHEN SQLWARN0 NOT = SPACES                                       
107300         WHEN SQLCODE < ZERO                                              
107400         WHEN SQLCODE > ZERO                                              
107500             MOVE '3010-RETRIEVE-CURRENT-TMST'                            
107600                               TO DP013-PARAGRAPH                         
107700             MOVE 'RETRIEVE CURRENT TMST'                                 
107800                               TO DP013-MESSAGE-TEXT (1)                  
107900             MOVE SQLCA        TO DP013-SQLCA                             
108000             SET DP013-DB2-ABEND                                          
108100                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
108200             PERFORM DP013-0000-PROCESS-ABEND                             
108300     END-EVALUATE.                                                        
108400                                                                          
108500******************************************************************        
108600 3200-RESET-ATTRIBUTES.                                                   
108700                                                                          
108800     MOVE DP015-UNP-ALP-NOR-OFF            TO ASCAC1A                     
108900                                              ASCAC2A.                    
109000     MOVE DP015-GREEN                      TO ASCAC1C                     
109100                                              ASCAC2C.                    
109200     MOVE DP015-UNDERLINE                  TO ASCAC1H                     
109300                                              ASCAC2H.                    
109400     MOVE -1                               TO ASCAC1L                     
109500                                              ASCAC2L.                    
109600                                                                          
109700******************************************************************        
109800*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *        
109900*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *        
110000*  IT HERE.                                                      *        
110100******************************************************************        
110200 4000-BUILD-INITIAL-PANEL.                                                
110300                                                                          
110400     PERFORM 7580-MOVE-COMMAREA-TO-SCREEN.                                
110500                                                                          
110600     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                               
110710     MOVE -1                     TO ASCAC1L                               
110720                                    ASCAC2L.                              
110800                                                                          
110900 EJECT                                                                    
111000                                                                          
111100******************************************************************        
111200 4100-VALIDATE-SCAC-CDE-PREP.                                             
111300                                                                          
111400     SET ASC-VALID-SCAC-CDE TO TRUE.                                      
111500     MOVE ASC-POE-CDE TO DK-POE-CDE.                                      
111600                                                                          
111700     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
111800       MOVE ASC-DECON-SCAC-CONTNR TO DK-SCAC-CDE                          
111900     ELSE                                                                 
112000       IF ASC-DECON-SCAC-VESSEL > SPACES                                  
112100         MOVE ASC-DECON-SCAC-VESSEL TO DK-SCAC-CDE                        
112200       END-IF                                                             
112300     END-IF.                                                              
112400                                                                          
112500******************************************************************        
112600 4105-VALIDATE-SCAC-CDE.                                                  
112700                                                                          
112800     EXEC SQL                                                             
112900         SELECT A.SCAC_CDE                                                
113000         INTO  :EXTENT-SCAC-CDE                                           
113100         FROM   TEXTENT A                                                 
113200               ,TENTNME B                                                 
113300         WHERE A.SCAC_CDE = :DK-SCAC-CDE                                  
113400           AND A.ENT_ID   = B.ENT_ID                                      
113500           AND B.TYPE_CDE = '01'                                          
113600     END-EXEC                                                             
113700                                                                          
113800         EVALUATE TRUE                                                    
113900             WHEN SQLCODE = ZERO                                          
114000             WHEN SQLCODE = -811                                          
114100                 SET ASC-VALID-SCAC-CDE     TO TRUE                       
114200             WHEN SQLCODE = +100                                          
114300                 SET ASC-INVALID-SCAC-CDE   TO TRUE                       
114400             WHEN OTHER                                                   
114500                 MOVE '4105-VALIDATE-SCAC-CDE'                            
114600                                   TO DP013-PARAGRAPH                     
114700                 MOVE 'SQL ERROR SELECTING POE CODE    '                  
114800                                   TO DP013-MESSAGE-TEXT (1)              
114900                 MOVE SQLCA        TO DP013-SQLCA                         
115000                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)            
115100                 SET DP013-DB2-ABEND                                      
115200                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
115300                 PERFORM DP013-0000-PROCESS-ABEND                         
115400      END-EVALUATE.                                                       
115500                                                                          
115600 EJECT                                                                    
115700                                                                          
115800******************************************************************        
115900 4110-CHECK-IF-SCAC-CHANGED.                                              
116000                                                                          
116100      IF ASC-RUL-CDE-USED = 'VSL'                                         
116200         IF ASC-DECON-SCAC-CONTNR > SPACES                                
116300            MOVE SPACES                TO PV-CURRENT-SCAC                 
116400            MOVE ASC-DECON-SCAC-CONTNR TO PV-CHANGE-SCAC                  
116500         ELSE                                                             
116600            MOVE ASC-DECON-SCAC-CUR    TO PV-CURRENT-SCAC                 
116700            MOVE ASC-DECON-SCAC-VESSEL TO PV-CHANGE-SCAC                  
116800         END-IF                                                           
116900      ELSE                                                                
117000         IF ASC-RUL-CDE-USED = 'CONT'                                     
117100            IF ASC-DECON-SCAC-CONTNR > SPACES                             
117200               MOVE ASC-DECON-SCAC-CUR    TO PV-CURRENT-SCAC              
117300               MOVE ASC-DECON-SCAC-CONTNR TO PV-CHANGE-SCAC               
117400            ELSE                                                          
117500               PERFORM 4111-SELECT-CURRENT-VSL-SCAC                       
117600               MOVE ASC-DECON-SCAC-VESSEL TO PV-CHANGE-SCAC               
117700            END-IF                                                        
117800         END-IF                                                           
117900      END-IF                                                              
118000                                                                          
118100      IF PV-CHANGE-SCAC = PV-CURRENT-SCAC                                 
118200         EVALUATE TRUE                                                    
118300*           **** SAME DCON SCAC ENTERED AS ON 'DEF' RULE ****             
118400            WHEN ASC-RUL-TYP-CDE-USED = PC-DEF                            
118500               MOVE PC-TSYMSG-03308        TO DP020-MSG-NUMBER            
118600*           **** SAME DCON SCAC ENTERED AS ON 'ADJ' RULE ****             
118700            WHEN ASC-RUL-TYP-CDE-USED = PC-ADJ                            
118800               MOVE PC-TSYMSG-03307        TO DP020-MSG-NUMBER            
118900*           **** SAME DCON SCAC ENTERED AS ON 'WKG' RULE ****             
119000            WHEN ASC-RUL-TYP-CDE-USED = PC-WKG                            
119100               MOVE PC-TSYMSG-03316        TO DP020-MSG-NUMBER            
119200         END-EVALUATE                                                     
119300                                                                          
119400         IF ASC-DECON-SCAC-CONTNR > SPACES                                
119500            MOVE DP015-UNP-ALP-BRT-OFF  TO ASCAC2A                        
119600            MOVE DP015-RED              TO ASCAC2C                        
119700            MOVE DP015-REVERSE          TO ASCAC2H                        
119800            MOVE -1                     TO ASCAC2L                        
119900         ELSE                                                             
120000            IF ASC-DECON-SCAC-VESSEL > SPACES                             
120100               MOVE DP015-UNP-ALP-BRT-OFF  TO ASCAC1A                     
120200               MOVE DP015-RED              TO ASCAC1C                     
120300               MOVE DP015-REVERSE          TO ASCAC1H                     
120400               MOVE -1                     TO ASCAC1L                     
120500            END-IF                                                        
120600         END-IF                                                           
120700                                                                          
120800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
120900         SET PS-ERROR                                                     
121000             DP020-MSG-FATAL         TO TRUE                              
121100      ELSE                                                                
121200*     CHECK FOR EXISTING CONT RUL THAT WILL OVERRIDE NEW VSL RUL          
121300         IF ASC-DECON-SCAC-VESSEL > SPACES                                
121400            PERFORM 4112-CHECK-FOR-CONT-RUL-ON-VSL                        
121500         END-IF                                                           
121600      END-IF.                                                             
121700                                                                          
121800*----------------------------------------------------------------*        
121900* SELECT WORKING VESSEL RULE                                              
122000*----------------------------------------------------------------*        
122100 4111-SELECT-CURRENT-VSL-SCAC.                                            
122200                                                                          
122300     EXEC SQL                                                             
122400        SELECT DISTINCT                                                   
122500               DCN.RUL_CNSTR_VAL_TXT                                      
122600        INTO   :PV-CURRENT-SCAC                                           
122700        FROM   TRT_RUL_CNSTR DCN                                          
122800              ,TRT_RUL_CNSTR VSL                                          
123000              ,TRT_RUL_CNSTR POE                                          
123100              ,TRT_RUL       TR                                           
123300        WHERE  VSL.RUL_ID            = DCN.RUL_ID                         
123400          AND  VSL.RUL_ID            = POE.RUL_ID                         
123500          AND  VSL.RUL_ID            = TR.RUL_ID                          
123600          AND  DCN.RUL_CNSTR_TYP_CDE = 'DECN'                             
123700          AND  VSL.RUL_CNSTR_TYP_CDE = 'VSL'                              
123800          AND  VSL.RUL_CNSTR_VAL_TXT = :ASC-VESSEL                        
124100          AND  POE.RUL_CNSTR_TYP_CDE = 'POE'                              
124200          AND  POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                       
124300          AND  TR.RUL_CDE            = 'VSL'                              
124400          AND  TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                 
124500          AND  TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                   
124600     END-EXEC.                                                            
124700                                                                          
124800     EVALUATE TRUE                                                        
124900         WHEN SQLCODE = ZERO                                              
125000         WHEN SQLCODE = -811                                              
125100              CONTINUE                                                    
125200         WHEN SQLCODE = +100                                              
125300              MOVE SPACES TO PV-CURRENT-SCAC                              
125400         WHEN SQLWARN0 NOT = SPACE                                        
125500         WHEN SQLCODE NOT = ZERO                                          
125600              MOVE '4111-SELECT-CURRENT-VSL-SCAC'                         
125700                               TO DP013-PARAGRAPH                         
125800              MOVE 'SQL ERROR SELECT WKG VESSEL RULE'                     
125900                               TO DP013-MESSAGE-TEXT (1)                  
126000              MOVE SQLCA       TO DP013-SQLCA                             
126100              SET DP013-DB2-ABEND                                         
126200                               TO TRUE                                    
126300              PERFORM DP013-0000-PROCESS-ABEND                            
126400     END-EVALUATE.                                                        
126500                                                                          
126600 EJECT                                                                    
126700*----------------------------------------------------------------*        
126800* SELECT WORKING VESSEL RULE                                              
126900*----------------------------------------------------------------*        
127000 4112-CHECK-FOR-CONT-RUL-ON-VSL.                                          
127100                                                                          
127200     EXEC SQL                                                             
127300        SELECT VSL.RUL_ID                                                 
127400        INTO   :PV-EXISTING-CONT-RUL                                      
127500        FROM   TRT_RUL_CNSTR VSL                                          
127600              ,TRT_RUL_CNSTR POE                                          
127700              ,TRT_RUL       TR                                           
127800        WHERE  VSL.RUL_ID            = POE.RUL_ID                         
127900          AND  VSL.RUL_ID            = TR.RUL_ID                          
128000          AND  VSL.RUL_CNSTR_TYP_CDE = 'VSL'                              
128100          AND  VSL.RUL_CNSTR_VAL_TXT = :ASC-VESSEL                        
128200          AND  POE.RUL_CNSTR_TYP_CDE = 'POE'                              
128300          AND  POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                       
128400          AND  TR.RUL_TYP_CDE       IN('WKG','ADJ')                       
128500          AND  TR.RUL_CDE            = 'CONT'                             
128600          AND  TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                 
128700          AND  TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                   
128800     END-EXEC.                                                            
128900                                                                          
129000     EVALUATE TRUE                                                        
129100         WHEN SQLCODE = ZERO                                              
129200         WHEN SQLCODE = -811                                              
129300            MOVE PC-TSYMSG-03327        TO DP020-MSG-NUMBER               
129400            SET DP020-MSG-INFORMATIONAL TO TRUE                           
129500         WHEN SQLCODE = +100                                              
129600              CONTINUE                                                    
129700         WHEN SQLWARN0 NOT = SPACE                                        
129800         WHEN SQLCODE NOT = ZERO                                          
129900              MOVE '4112-CHECK-FOR-CONT-RUL-ON-VSL'                       
130000                               TO DP013-PARAGRAPH                         
130100              MOVE 'SQL ERROR SELECT WKG VESSEL RULE'                     
130200                               TO DP013-MESSAGE-TEXT (1)                  
130300              MOVE SQLCA       TO DP013-SQLCA                             
130400              SET DP013-DB2-ABEND                                         
130500                               TO TRUE                                    
130600              PERFORM DP013-0000-PROCESS-ABEND                            
130700     END-EVALUATE.                                                        
130800                                                                          
130900 EJECT                                                                    
131000******************************************************************        
131100 4200-MULTI-DECON-EDIT-VSL.                                               
131200                                                                          
131300     PERFORM 4610-FETCH-VSL-CUR.                                          
131400     IF PS-EOC-VSL-CONT-CUR                                               
131500       CONTINUE                                                           
131600     ELSE                                                                 
131700*      ******************************************************             
131800*      * DO THESE MOVES SO PO CURSOR WORKS WITH VSL AND CON *             
131900*      ******************************************************             
132000       MOVE PV-VSL-CUR-CONTNR-ID   TO IMCNPO-CONTNR-ID                    
132010       MOVE PV-VSL-CUR-RUL-ID      TO PV-PO-CUR-RUL-ID                    
132200       MOVE PV-VSL-CUR-SEQ-NBR     TO IMCNPO-CONTNR-SEQ-NBR               
132300*      ******************************************************             
132400       PERFORM 4330-OPEN-PO-CURSOR                                        
132500       PERFORM 4300-MULTI-DECON-EDIT-CONTNR                               
132600          UNTIL PS-EOC-PO-CUR                                             
132700             OR PS-MULTI-SCACS                                            
132800       PERFORM 4340-CLOSE-PO-CURSOR                                       
132900     END-IF.                                                              
133000                                                                          
133100******************************************************************        
133200 4300-MULTI-DECON-EDIT-CONTNR.                                            
133300                                                                          
133400     PERFORM 4350-FETCH-PO-CURSOR.                                        
133500     IF PS-EOC-PO-CUR                                                     
133600       CONTINUE                                                           
133700     ELSE                                                                 
133800       IF PV-PO-CUR-SPLIT-TYP = 'P'                                       
133900          PERFORM 4400-OPEN-CON-CURSOR                                    
134000          PERFORM 4410-PROCESS-CON-CURSOR                                 
134100            UNTIL PS-EOC-CON-CUR                                          
134200          PERFORM 4420-CLOSE-CON-CURSOR                                   
134300       ELSE                                                               
134400          PERFORM 4440-OPEN-CMN-CURSOR                                    
134500          PERFORM 4450-PROCESS-CMN-CURSOR                                 
134600            UNTIL PS-EOC-CMN-CUR                                          
134700          PERFORM 4460-CLOSE-CMN-CURSOR                                   
134800       END-IF                                                             
134900     END-IF.                                                              
135000                                                                          
135100*----------------------------------------------------------------*        
135200*   OPEN PO CURSOR                                               *        
135300*----------------------------------------------------------------*        
135400 4330-OPEN-PO-CURSOR.                                                     
135500                                                                          
135600     PERFORM                                                              
135700         WITH TEST AFTER                                                  
135800         VARYING PV-RETRY-COUNTER                                         
135900         FROM 1 BY 1                                                      
136000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
136100             OR (SQLCODE = ZERO))                                         
136200                                                                          
136300            EXEC SQL                                                      
136400               OPEN PO_CUR                                                
136500            END-EXEC                                                      
136600                                                                          
136700*                                                                         
136800         EVALUATE TRUE                                                    
136900             WHEN SQLCODE = ZERO                                          
137000             WHEN SQLCODE = -904                                          
137100             WHEN SQLCODE = -913                                          
137200                 CONTINUE                                                 
137300             WHEN SQLWARN0 NOT = SPACES                                   
137400             WHEN SQLCODE < ZERO                                          
137500             WHEN SQLCODE > ZERO                                          
137600                 MOVE '4330-OPEN-PO-CURSOR'                               
137700                                   TO DP013-PARAGRAPH                     
137800                 MOVE 'OPEN PO CURSOR - '                                 
137900                                   TO DP013-MESSAGE-TEXT (1)              
138000                 MOVE SQLCA        TO DP013-SQLCA                         
138100                 MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)            
138200                 SET DP013-DB2-ABEND                                      
138300                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
138400                 PERFORM DP013-0000-PROCESS-ABEND                         
138500         END-EVALUATE                                                     
138600     END-PERFORM.                                                         
138700*                                                                         
138800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
138900         MOVE '4030-OPEN-PO-CURSOR' TO DP013-PARAGRAPH                    
139000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
139100                                   TO DP013-MESSAGE-TEXT (1)              
139200         MOVE SQLCA                TO DP013-SQLCA                         
139300         MOVE 'TRT_RUL_CNSTR'      TO DP013-DB2-TABLE-NAME (1)            
139400         SET DP013-DB2-ABEND                                              
139500             DP013-XCTL-DISPLAY-RESTART                                   
139600                                   TO TRUE                                
139700         PERFORM DP013-0000-PROCESS-ABEND                                 
139800     END-IF.                                                              
139900                                                                          
140000     IF SQLCODE = ZERO                                                    
140100        SET PS-EOC-PO-CUR-NO TO TRUE                                      
140200     END-IF.                                                              
140300                                                                          
140400 EJECT                                                                    
140500*----------------------------------------------------------------*        
140600*   CLOSE PO CURSOR.                                             *        
140700*----------------------------------------------------------------*        
140800 4340-CLOSE-PO-CURSOR.                                                    
140900                                                                          
141000     EXEC SQL                                                             
141100        CLOSE PO_CUR                                                      
141200     END-EXEC                                                             
141300                                                                          
141400*                                                                         
141500     EVALUATE TRUE                                                        
141600         WHEN SQLCODE = ZERO                                              
141700             CONTINUE                                                     
141800         WHEN SQLWARN0 NOT = SPACES                                       
141900         WHEN SQLCODE < ZERO                                              
142000         WHEN SQLCODE > ZERO                                              
142100             MOVE '4340-CLOSE-PO-CURSOR'                                  
142200                               TO DP013-PARAGRAPH                         
142300             MOVE 'CLOSE CONTNR CURSOR '                                  
142400                               TO DP013-MESSAGE-TEXT (1)                  
142500             MOVE SQLCA        TO DP013-SQLCA                             
142600             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)                
142700             SET DP013-DB2-ABEND                                          
142800                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
142900             PERFORM DP013-0000-PROCESS-ABEND                             
143000     END-EVALUATE.                                                        
143100                                                                          
143200*----------------------------------------------------------------*        
143300 4350-FETCH-PO-CURSOR.                                                    
143400                                                                          
143500     EXEC SQL                                                             
143600         FETCH PO_CUR                                                     
143700         INTO  :PV-PO-CUR-PO-NBR                                          
143800             , :PV-PO-CUR-SPLIT-TYP                                       
143900     END-EXEC.                                                            
144000                                                                          
144100*                                                                         
144200     EVALUATE TRUE                                                        
144300         WHEN SQLCODE = ZERO                                              
144400         WHEN SQLCODE = +100                                              
144500              CONTINUE                                                    
144600         WHEN SQLWARN0 NOT = SPACE                                        
144700         WHEN SQLCODE NOT = ZERO                                          
144800              MOVE '4350-FETCH-PO-CURSOR'                                 
144900                               TO DP013-PARAGRAPH                         
145000              MOVE 'FETCH PO CURSOR'                                      
145100                               TO DP013-MESSAGE-TEXT (1)                  
145200              MOVE SQLCA       TO DP013-SQLCA                             
145300              SET DP013-DB2-ABEND                                         
145400                               TO TRUE                                    
145500              PERFORM DP013-0000-PROCESS-ABEND                            
145600     END-EVALUATE.                                                        
145700*                                                                         
145800     IF  SQLCODE EQUAL +100                                               
145900         SET PS-EOC-PO-CUR         TO TRUE                                
146000     END-IF.                                                              
146100                                                                          
146200******************************************************************        
146300 4400-OPEN-CON-CURSOR.                                                    
146400                                                                          
146500     PERFORM                                                              
146600         WITH TEST AFTER                                                  
146700         VARYING PV-RETRY-COUNTER                                         
146800         FROM 1 BY 1                                                      
146900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
147000             OR (SQLCODE = ZERO))                                         
147100                                                                          
147200            EXEC SQL                                                      
147300               OPEN CON_CUR                                               
147400            END-EXEC                                                      
147500                                                                          
147600*                                                                         
147700         EVALUATE TRUE                                                    
147800             WHEN SQLCODE = ZERO                                          
147900             WHEN SQLCODE = -904                                          
148000             WHEN SQLCODE = -913                                          
148100                 CONTINUE                                                 
148200             WHEN SQLWARN0 NOT = SPACES                                   
148300             WHEN SQLCODE < ZERO                                          
148400             WHEN SQLCODE > ZERO                                          
148500                 MOVE '4330-OPEN-PO-CURSOR'                               
148600                                   TO DP013-PARAGRAPH                     
148700                 MOVE 'OPEN CON CURSOR - '                                
148800                                   TO DP013-MESSAGE-TEXT (1)              
148900                 MOVE SQLCA        TO DP013-SQLCA                         
149000                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)            
149100                 SET DP013-DB2-ABEND                                      
149200                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
149300                 PERFORM DP013-0000-PROCESS-ABEND                         
149400         END-EVALUATE                                                     
149500     END-PERFORM.                                                         
149600*                                                                         
149700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
149800         MOVE '4400-OPEN-CON-CURSOR' TO DP013-PARAGRAPH                   
149900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
150000                                   TO DP013-MESSAGE-TEXT (1)              
150100         MOVE SQLCA                TO DP013-SQLCA                         
150200         MOVE 'SHPTPO'             TO DP013-DB2-TABLE-NAME (1)            
150300         SET DP013-DB2-ABEND                                              
150400             DP013-XCTL-DISPLAY-RESTART                                   
150500                                   TO TRUE                                
150600         PERFORM DP013-0000-PROCESS-ABEND                                 
150700     END-IF.                                                              
150800                                                                          
150900     IF SQLCODE = ZERO                                                    
151000        SET PS-EOC-CON-CUR-NO TO TRUE                                     
151100     END-IF.                                                              
151200                                                                          
151300******************************************************************        
151400 4410-PROCESS-CON-CURSOR.                                                 
151500                                                                          
151600     PERFORM 4430-FETCH-CON-CURSOR.                                       
151700     IF PS-EOC-CON-CUR                                                    
151800        CONTINUE                                                          
151900     ELSE                                                                 
152000        MOVE 'CONT' TO PV-COMPARE-RUL-CDE                                 
152100        PERFORM 4500-CYCLE-WKG-ADJ-DEF                                    
152200        IF PS-MULTI-SCACS                                                 
152300         OR PS-SCACS-MATCH                                                
152400          CONTINUE                                                        
152500        ELSE                                                              
152600*          *****************************************                      
152700*          * DON'T CHECK CONTAINERS ON SAME VESSEL *                      
152800*          * IF VESSEL RULE IS WHATS BEING CREATED *                      
152900*          *****************************************                      
153000           IF ASC-DECON-SCAC-VESSEL > SPACES                              
153100            AND PV-CNTNR-CUR-VES = TR320-VESSEL                           
153200             CONTINUE                                                     
153300           ELSE                                                           
153400             MOVE 'VSL' TO PV-COMPARE-RUL-CDE                             
153500             PERFORM 4500-CYCLE-WKG-ADJ-DEF                               
153600           END-IF                                                         
153700        END-IF                                                            
153800     END-IF.                                                              
153900                                                                          
154000                                                                          
154100******************************************************************        
154200 4420-CLOSE-CON-CURSOR.                                                   
154300                                                                          
154400     EXEC SQL                                                             
154500        CLOSE CON_CUR                                                     
154600     END-EXEC                                                             
154700                                                                          
154800*                                                                         
154900     EVALUATE TRUE                                                        
155000         WHEN SQLCODE = ZERO                                              
155100             CONTINUE                                                     
155200         WHEN SQLWARN0 NOT = SPACES                                       
155300         WHEN SQLCODE < ZERO                                              
155400         WHEN SQLCODE > ZERO                                              
155500             MOVE '4420-CLOSE-CON-CURSOR'                                 
155600                               TO DP013-PARAGRAPH                         
155700             MOVE 'CLOSE CONTNR CURSOR '                                  
155800                               TO DP013-MESSAGE-TEXT (1)                  
155900             MOVE SQLCA        TO DP013-SQLCA                             
156000             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)                
156100             SET DP013-DB2-ABEND                                          
156200                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
156300             PERFORM DP013-0000-PROCESS-ABEND                             
156400     END-EVALUATE.                                                        
156500                                                                          
156600******************************************************************        
156700 4430-FETCH-CON-CURSOR.                                                   
156800                                                                          
156810     INITIALIZE PV-CNTNR-CUR-CONTNR-ID                                    
156811                PV-CNTNR-CUR-VES                                          
156820                PV-CNTNR-CUR-ETA.                                         
156900     EXEC SQL                                                             
157000         FETCH CON_CUR                                                    
157100         INTO  :PV-CNTNR-CUR-CONTNR-ID                                    
157200              ,:PV-CNTNR-CUR-VES                                          
157300              ,:PV-CNTNR-CUR-ETA                                          
157400     END-EXEC.                                                            
157500                                                                          
157600*                                                                         
157700     EVALUATE TRUE                                                        
157800         WHEN SQLCODE = ZERO                                              
157900         WHEN SQLCODE = +100                                              
158000              CONTINUE                                                    
158100         WHEN SQLWARN0 NOT = SPACE                                        
158200         WHEN SQLCODE NOT = ZERO                                          
158300              MOVE '4430-FETCH-CON-CURSOR'                                
158400                               TO DP013-PARAGRAPH                         
158500              MOVE 'FETCH PO CURSOR'                                      
158600                               TO DP013-MESSAGE-TEXT (1)                  
158700              MOVE SQLCA       TO DP013-SQLCA                             
158800              SET DP013-DB2-ABEND                                         
158900                               TO TRUE                                    
159000              PERFORM DP013-0000-PROCESS-ABEND                            
159100     END-EVALUATE.                                                        
159200*                                                                         
159300     IF  SQLCODE EQUAL +100                                               
159400         SET PS-EOC-CON-CUR         TO TRUE                               
159500     END-IF.                                                              
159600                                                                          
159700******************************************************************        
159800 4440-OPEN-CMN-CURSOR.                                                    
159900                                                                          
160000     PERFORM                                                              
160100         WITH TEST AFTER                                                  
160200         VARYING PV-RETRY-COUNTER                                         
160300         FROM 1 BY 1                                                      
160400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
160500             OR (SQLCODE = ZERO))                                         
160600                                                                          
160700            EXEC SQL                                                      
160800               OPEN CMN_CUR                                               
160900            END-EXEC                                                      
161000                                                                          
161100*                                                                         
161200         EVALUATE TRUE                                                    
161300             WHEN SQLCODE = ZERO                                          
161400             WHEN SQLCODE = -904                                          
161500             WHEN SQLCODE = -913                                          
161600                 CONTINUE                                                 
161700             WHEN SQLWARN0 NOT = SPACES                                   
161800             WHEN SQLCODE < ZERO                                          
161900             WHEN SQLCODE > ZERO                                          
162000                 MOVE '4330-OPEN-PO-CURSOR'                               
162100                                   TO DP013-PARAGRAPH                     
162200                 MOVE 'OPEN CON CURSOR - '                                
162300                                   TO DP013-MESSAGE-TEXT (1)              
162400                 MOVE SQLCA        TO DP013-SQLCA                         
162500                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)            
162600                 SET DP013-DB2-ABEND                                      
162700                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
162800                 PERFORM DP013-0000-PROCESS-ABEND                         
162900         END-EVALUATE                                                     
163000     END-PERFORM.                                                         
163100*                                                                         
163200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
163300         MOVE '4440-OPEN-CMN-CURSOR' TO DP013-PARAGRAPH                   
163400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
163500                                   TO DP013-MESSAGE-TEXT (1)              
163600         MOVE SQLCA                TO DP013-SQLCA                         
163700         MOVE 'TIMCNTK'            TO DP013-DB2-TABLE-NAME (1)            
163800         SET DP013-DB2-ABEND                                              
163900             DP013-XCTL-DISPLAY-RESTART                                   
164000                                   TO TRUE                                
164100         PERFORM DP013-0000-PROCESS-ABEND                                 
164200     END-IF.                                                              
164300                                                                          
164400     IF SQLCODE = ZERO                                                    
164500        SET PS-EOC-CMN-CUR-NO TO TRUE                                     
164600     END-IF.                                                              
164700                                                                          
164800******************************************************************        
164900 4450-PROCESS-CMN-CURSOR.                                                 
165000                                                                          
165100     PERFORM 4470-FETCH-CMN-CURSOR.                                       
165200     IF PS-EOC-CMN-CUR                                                    
165300        CONTINUE                                                          
165400     ELSE                                                                 
165500        MOVE 'CONT' TO PV-COMPARE-RUL-CDE                                 
165600        PERFORM 4500-CYCLE-WKG-ADJ-DEF                                    
165700        IF PS-MULTI-SCACS                                                 
165800         OR PS-SCACS-MATCH                                                
165900          CONTINUE                                                        
166000        ELSE                                                              
166100*          *****************************************                      
166200*          * DON'T CHECK CONTAINERS ON SAME VESSEL *                      
166300*          * IF VESSEL RULE IS WHATS BEING CREATED *                      
166400*          *****************************************                      
166500           IF ASC-DECON-SCAC-VESSEL > SPACES                              
166600            AND PV-CNTNR-CUR-VES = TR320-VESSEL                           
166700             CONTINUE                                                     
166800           ELSE                                                           
166900             MOVE 'VSL' TO PV-COMPARE-RUL-CDE                             
167000             PERFORM 4500-CYCLE-WKG-ADJ-DEF                               
167100           END-IF                                                         
167200        END-IF                                                            
167300     END-IF.                                                              
167400                                                                          
167500******************************************************************        
167600 4460-CLOSE-CMN-CURSOR.                                                   
167700                                                                          
167800     EXEC SQL                                                             
167900        CLOSE CMN_CUR                                                     
168000     END-EXEC                                                             
168100                                                                          
168200*                                                                         
168300     EVALUATE TRUE                                                        
168400         WHEN SQLCODE = ZERO                                              
168500             CONTINUE                                                     
168600         WHEN SQLWARN0 NOT = SPACES                                       
168700         WHEN SQLCODE < ZERO                                              
168800         WHEN SQLCODE > ZERO                                              
168900             MOVE '4460-CLOSE-CMN-CURSOR'                                 
169000                               TO DP013-PARAGRAPH                         
169100             MOVE 'CLOSE CONTNR CURSOR '                                  
169200                               TO DP013-MESSAGE-TEXT (1)                  
169300             MOVE SQLCA        TO DP013-SQLCA                             
169400             MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)                
169500             SET DP013-DB2-ABEND                                          
169600                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
169700             PERFORM DP013-0000-PROCESS-ABEND                             
169800     END-EVALUATE.                                                        
169900                                                                          
170000******************************************************************        
170100 4470-FETCH-CMN-CURSOR.                                                   
170200                                                                          
170300     EXEC SQL                                                             
170400         FETCH CMN_CUR                                                    
170500         INTO  :PV-CNTNR-CUR-CONTNR-ID                                    
170600              ,:PV-CNTNR-CUR-SEQ-NBR                                      
170700              ,:PV-CNTNR-CUR-VES                                          
170800              ,:PV-CNTNR-CUR-TRIP-ID                                      
170810              ,:PV-CNTNR-CUR-ETA                                          
170900     END-EXEC.                                                            
171000                                                                          
171100*                                                                         
171200     EVALUATE TRUE                                                        
171300         WHEN SQLCODE = ZERO                                              
171400         WHEN SQLCODE = +100                                              
171500              CONTINUE                                                    
171600         WHEN SQLWARN0 NOT = SPACE                                        
171700         WHEN SQLCODE NOT = ZERO                                          
171800              MOVE '4470-FETCH-CMN-CURSOR'                                
171900                               TO DP013-PARAGRAPH                         
172000              MOVE 'FETCH CMN CURSOR'                                     
172100                               TO DP013-MESSAGE-TEXT (1)                  
172200              MOVE SQLCA       TO DP013-SQLCA                             
172300              SET DP013-DB2-ABEND                                         
172400                               TO TRUE                                    
172500              PERFORM DP013-0000-PROCESS-ABEND                            
172600     END-EVALUATE.                                                        
172700*                                                                         
172800     IF  SQLCODE EQUAL +100                                               
172900         SET PS-EOC-CMN-CUR         TO TRUE                               
173000     END-IF.                                                              
173100                                                                          
173200******************************************************************        
173300 4500-CYCLE-WKG-ADJ-DEF.                                                  
173400                                                                          
173500     MOVE 'WKG' TO PV-COMPARE-RUL-TYP.                                    
173600     PERFORM 4510-COMPARE-SCACS.                                          
173700     IF PS-MULTI-SCACS                                                    
173800      OR PS-SCACS-MATCH                                                   
173900       CONTINUE                                                           
174000     ELSE                                                                 
174100       MOVE 'ADJ' TO PV-COMPARE-RUL-TYP                                   
174200       PERFORM 4510-COMPARE-SCACS                                         
174300       IF PS-MULTI-SCACS                                                  
174400        OR PS-SCACS-MATCH                                                 
174500         CONTINUE                                                         
174600       ELSE                                                               
174700*        ***************************************************              
174800*        * THERE ARE NO DEFAULT VESSEL RULES, ONLY DO CONT *              
174900*        ***************************************************              
175000         IF PV-COMPARE-RUL-CDE = 'CONT'                                   
175100*          *****************************************                      
175200*          * DON'T CHECK CONTAINERS ON SAME VESSEL *                      
175300*          * IF VESSEL RULE IS WHATS BEING CREATED *                      
175400*          *****************************************                      
175500           IF ASC-DECON-SCAC-VESSEL > SPACES                              
175600            AND PV-CNTNR-CUR-VES = TR320-VESSEL                           
175700             CONTINUE                                                     
175800           ELSE                                                           
175900             MOVE 'DEF' TO PV-COMPARE-RUL-TYP                             
176000             PERFORM 4510-COMPARE-SCACS                                   
176100           END-IF                                                         
176200       END-IF                                                             
176300     END-IF.                                                              
176400                                                                          
176500******************************************************************        
176600 4510-COMPARE-SCACS.                                                      
176700                                                                          
176800     IF PV-COMPARE-RUL-CDE = 'CONT'                                       
176900        IF PV-PO-CUR-SPLIT-TYP = 'P'                                      
177000           PERFORM 4525-SELECT-SCAC-CONPO-CONT                            
177100        ELSE                                                              
177210           PERFORM 4520-SELECT-SCAC-CMN-CONT                              
177300     END-IF.                                                              
177400                                                                          
177500     IF PV-COMPARE-RUL-CDE = 'VSL'                                        
177600        IF PV-PO-CUR-SPLIT-TYP = 'P'                                      
177700           PERFORM 4530-SELECT-SCAC-CONPO-VSL                             
177800        ELSE                                                              
177900           PERFORM 4535-SELECT-SCAC-CMN-VSL                               
178000     END-IF.                                                              
178100                                                                          
178200     IF PV-COMPARE-DECON-SCAC  =  SPACES                                  
178300        CONTINUE                                                          
178400     ELSE                                                                 
178500        IF PV-COMPARE-DECON-SCAC = PV-DECON-SCAC-ENTERED                  
178600          SET PS-SCACS-MATCH   TO TRUE                                    
178700        ELSE                                                              
178800          SET PS-MULTI-SCACS   TO TRUE                                    
178900     END-IF.                                                              
179000                                                                          
179100******************************************************************        
179120* PRB0040270 - 03/20/2013  PREVENT ABEND DUE TO RULE NOT FOUND            
179130*        MJF - REPLACED = WITH 'IN' ON SUBSELECTS                         
179140******************************************************************        
179200 4520-SELECT-SCAC-CMN-CONT.                                               
179300                                                                          
179400     INITIALIZE PV-COMPARE-DECON-SCAC.                                    
179500                                                                          
179600     PERFORM                                                              
179700         WITH TEST AFTER                                                  
179800         VARYING PV-RETRY-COUNTER                                         
179900         FROM 1 BY 1                                                      
180000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
180100            OR  (SQLCODE = ZERO)                                          
180200            OR  (SQLCODE = +100)                                          
      *CHG0114422 - START                                                       
                  OR  (SQLCODE = -811))                                         
      *CHG0114422 - END                                                         
180300                                                                          
180400         EXEC SQL                                                         
180500          SELECT DISTINCT                                                 
180600                SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,4)                          
180700          INTO :PV-COMPARE-DECON-SCAC                                     
180800          FROM TRT_RUL_CNSTR CT                                           
180900              ,TRT_RUL RT                                                 
P40277              ,TRT_RUL_CNSTR X                                            
P40277              ,TRT_RUL_CNSTR Y                                            
181000         WHERE CT.RUL_CNSTR_TYP_CDE = 'DECN'                              
181100           AND RT.RUL_ID            = CT.RUL_ID                           
P40277           AND RT.RUL_ID            = X.RUL_ID                            
P40277           AND RT.RUL_ID            = Y.RUL_ID                            
181200           AND RT.RUL_TYP_CDE       = :PV-COMPARE-RUL-TYP                 
181300           AND RT.RUL_CDE           = :PV-COMPARE-RUL-CDE                 
P40277           AND X.RUL_CNSTR_VAL_TXT  = :PV-CNTNR-CUR-CONTNR-ID             
P40277           AND X.RUL_CNSTR_TYP_CDE  = 'CONT'                              
P40277           AND INTEGER(SUBSTR(Y.RUL_CNSTR_VAL_TXT,1,6)) =                 
P40277               :PV-CNTNR-CUR-SEQ-NBR                                      
P40277           AND Y.RUL_CNSTR_TYP_CDE  = 'SEQ'                               
182400                                                                          
182500         END-EXEC                                                         
182600*                                                                         
182700         EVALUATE TRUE                                                    
182800             WHEN SQLCODE = ZERO                                          
182900             WHEN SQLCODE = +100                                          
183010             WHEN SQLCODE = -904                                          
183100             WHEN SQLCODE = -913                                          
183200                 CONTINUE                                                 
      *CHG0114422 - START                                                       
                   WHEN SQLCODE = -811                                          
                       PERFORM 4522-SELECT-SCAC-CMN-CONT-CURR                   
      *CHG0114422 - END                                                         
183300             WHEN SQLWARN0 NOT = SPACES                                   
183400             WHEN SQLCODE < ZERO                                          
183500             WHEN SQLCODE > ZERO                                          
183600                 MOVE '4520-SELECT-SCAC-CMN-CONT'                         
183700                                   TO DP013-PARAGRAPH                     
183800                 MOVE TRT00014-RUL-TYP-CDE                                
183900                                   TO DP013-MESSAGE-TEXT (1)              
      *CHG0114422 - START                                                       
                       MOVE PV-CNTNR-CUR-CONTNR-ID                              
                                         TO DP013-MESSAGE-TEXT (2)              
                       MOVE PV-CNTNR-CUR-SEQ-NBR                                
                                         TO DP013-MESSAGE-TEXT (3)              
      *CHG0114422 - END                                                         
184000                 MOVE SQLCA        TO DP013-SQLCA                         
184100                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
184200                 SET DP013-DB2-ABEND                                      
184300                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
184400                 PERFORM DP013-0000-PROCESS-ABEND                         
184500         END-EVALUATE                                                     
184600     END-PERFORM.                                                         
184700*                                                                         
184800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
184900         MOVE '4520-SELECT-SCAC-CMN-CONT'                                 
185000                                     TO DP013-PARAGRAPH                   
185100         MOVE PV-CNTNR-CUR-CONTNR-ID                                      
185200                                   TO DP013-MESSAGE-TEXT (1)              
185300         MOVE SQLCA                TO DP013-SQLCA                         
185400         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)                 
185500         SET DP013-DB2-ABEND                                              
185600             DP013-XCTL-DISPLAY-RESTART                                   
185700                                   TO TRUE                                
185800         PERFORM DP013-0000-PROCESS-ABEND                                 
185900     END-IF.                                                              
186000                                                                          
      *CHG0114422 - START                                                       
      ******************************************************************        
      * SELECT THE LATEST CONTAINER TO PREVENT -811 ABEND                       
      *                                                                         
      ******************************************************************        
       4522-SELECT-SCAC-CMN-CONT-CURR.                                          
                                                                                
           INITIALIZE PV-COMPARE-DECON-SCAC.                                    
                                                                                
               EXEC SQL                                                         
                SELECT DISTINCT                                                 
                      SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,4)                          
                INTO :PV-COMPARE-DECON-SCAC                                     
                FROM TRT_RUL_CNSTR CT                                           
                    ,TRT_RUL RT                                                 
                    ,TRT_RUL_CNSTR X                                            
                    ,TRT_RUL_CNSTR Y                                            
               WHERE CT.RUL_CNSTR_TYP_CDE = 'DECN'                              
                 AND RT.RUL_ID            = CT.RUL_ID                           
                 AND RT.RUL_ID            = X.RUL_ID                            
                 AND RT.RUL_ID            = Y.RUL_ID                            
                 AND RT.RUL_TYP_CDE       = :PV-COMPARE-RUL-TYP                 
                 AND RT.RUL_CDE           = :PV-COMPARE-RUL-CDE                 
                 AND X.RUL_CNSTR_VAL_TXT  = :PV-CNTNR-CUR-CONTNR-ID             
                 AND X.RUL_CNSTR_TYP_CDE  = 'CONT'                              
                 AND INTEGER(SUBSTR(Y.RUL_CNSTR_VAL_TXT,1,6)) =                 
                     :PV-CNTNR-CUR-SEQ-NBR                                      
                 AND Y.RUL_CNSTR_TYP_CDE  = 'SEQ'                               
                 AND Y.CRE_TMST IN                                              
                    (SELECT MAX(Z.CRE_TMST) FROM                                
                        TRT_RUL_CNSTR ST                                        
                       ,TRT_RUL MT                                              
                       ,TRT_RUL_CNSTR R                                         
                       ,TRT_RUL_CNSTR Z                                         
                        WHERE  ST.RUL_CNSTR_TYP_CDE = 'DECN'                    
                        AND MT.RUL_ID            = ST.RUL_ID                    
                        AND MT.RUL_ID            = R.RUL_ID                     
                        AND MT.RUL_ID            = Z.RUL_ID                     
                        AND MT.RUL_TYP_CDE       = :PV-COMPARE-RUL-TYP          
                        AND MT.RUL_CDE           = :PV-COMPARE-RUL-CDE          
                        AND R.RUL_CNSTR_VAL_TXT  =                              
                            :PV-CNTNR-CUR-CONTNR-ID                             
                        AND R.RUL_CNSTR_TYP_CDE  = 'CONT'                       
                        AND INTEGER(SUBSTR(Z.RUL_CNSTR_VAL_TXT,1,6)) =          
                            :PV-CNTNR-CUR-SEQ-NBR                               
                        AND Z.RUL_CNSTR_TYP_CDE  = 'SEQ'                        
                        )                                                       
                 WITH UR                                                        
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < ZERO                                          
                   WHEN SQLCODE > ZERO                                          
                       MOVE '4522-SELECT-SCAC-CMN-CONT-CURR'                    
                                         TO DP013-PARAGRAPH                     
                       MOVE TRT00014-RUL-TYP-CDE                                
                                         TO DP013-MESSAGE-TEXT (1)              
                       MOVE PV-CNTNR-CUR-CONTNR-ID                              
                                         TO DP013-MESSAGE-TEXT (2)              
                       MOVE PV-CNTNR-CUR-SEQ-NBR                                
                                         TO DP013-MESSAGE-TEXT (3)              
                       MOVE SQLCA        TO DP013-SQLCA                         
                       MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
                       SET DP013-DB2-ABEND                                      
                           DP013-XCTL-DISPLAY-RESTART TO TRUE                   
                       PERFORM DP013-0000-PROCESS-ABEND                         
               END-EVALUATE.                                                    
      *CHG0114422 - END                                                         
186100******************************************************************        
186200 4525-SELECT-SCAC-CONPO-CONT.                                             
186300                                                                          
186400     INITIALIZE PV-COMPARE-DECON-SCAC.                                    
186500                                                                          
186600     PERFORM                                                              
186700         WITH TEST AFTER                                                  
186800         VARYING PV-RETRY-COUNTER                                         
186900         FROM 1 BY 1                                                      
187000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
187100            OR  (SQLCODE = ZERO)                                          
187200            OR  (SQLCODE = +100))                                         
187300                                                                          
187400         EXEC SQL                                                         
187500          SELECT DISTINCT                                                 
187600                SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,4)                          
187700          INTO :PV-COMPARE-DECON-SCAC                                     
187800          FROM TRT_RUL_CNSTR CT                                           
187900              ,TRT_RUL RT                                                 
P40277              ,TRT_RUL_CNSTR X                                            
P40277              ,TRT_RUL_CNSTR Y                                            
188000         WHERE CT.RUL_CNSTR_TYP_CDE = 'DECN'                              
188100           AND RT.RUL_ID            = CT.RUL_ID                           
P40277           AND RT.RUL_ID            = X.RUL_ID                            
P40277           AND RT.RUL_ID            = Y.RUL_ID                            
188200           AND RT.RUL_TYP_CDE       = :PV-COMPARE-RUL-TYP                 
188300           AND RT.RUL_CDE           = :PV-COMPARE-RUL-CDE                 
P40277           AND X.RUL_CNSTR_VAL_TXT  = :PV-CNTNR-CUR-CONTNR-ID             
P40277           AND X.RUL_CNSTR_TYP_CDE  = :PV-COMPARE-RUL-CDE                 
P40277           AND SUBSTR(Y.RUL_CNSTR_VAL_TXT,1,10) =                         
P40277               :PV-CNTNR-CUR-ETA                                          
P40277           AND Y.RUL_CNSTR_TYP_CDE = 'ETA'                                
189400                                                                          
189500         END-EXEC                                                         
189600*                                                                         
189700         EVALUATE TRUE                                                    
189800             WHEN SQLCODE = ZERO                                          
189900             WHEN SQLCODE = +100                                          
190000             WHEN SQLCODE = -904                                          
190100             WHEN SQLCODE = -913                                          
190200                 CONTINUE                                                 
190300             WHEN SQLWARN0 NOT = SPACES                                   
190400             WHEN SQLCODE < ZERO                                          
190500             WHEN SQLCODE > ZERO                                          
190600                 MOVE '4525-SELECT-SCAC-CONPO-CONT'                       
190700                                   TO DP013-PARAGRAPH                     
190800                 MOVE TRT00014-RUL-TYP-CDE                                
190900                                   TO DP013-MESSAGE-TEXT (1)              
191000                 MOVE SQLCA        TO DP013-SQLCA                         
191100                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
191200                 SET DP013-DB2-ABEND                                      
191300                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
191400                 PERFORM DP013-0000-PROCESS-ABEND                         
191500         END-EVALUATE                                                     
191600     END-PERFORM.                                                         
191700*                                                                         
191800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
191900         MOVE '4525-SELECT-SCAC-CONPO-CONT'                               
192000                                     TO DP013-PARAGRAPH                   
192100         MOVE PV-CNTNR-CUR-CONTNR-ID                                      
192200                                   TO DP013-MESSAGE-TEXT (1)              
192300         MOVE SQLCA                TO DP013-SQLCA                         
192400         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)                 
192500         SET DP013-DB2-ABEND                                              
192600             DP013-XCTL-DISPLAY-RESTART                                   
192700                                   TO TRUE                                
192800         PERFORM DP013-0000-PROCESS-ABEND                                 
192900     END-IF.                                                              
193000                                                                          
193100******************************************************************        
193200 4530-SELECT-SCAC-CONPO-VSL.                                              
193300                                                                          
193400     INITIALIZE PV-COMPARE-DECON-SCAC.                                    
193500                                                                          
193600     PERFORM                                                              
193700         WITH TEST AFTER                                                  
193800         VARYING PV-RETRY-COUNTER                                         
193900         FROM 1 BY 1                                                      
194000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
194100            OR  (SQLCODE = ZERO)                                          
194200            OR  (SQLCODE = +100))                                         
194300                                                                          
194400         EXEC SQL                                                         
194500          SELECT DISTINCT                                                 
194600                SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,4)                          
194700          INTO :PV-COMPARE-DECON-SCAC                                     
194800          FROM TRT_RUL_CNSTR CT                                           
194900              ,TRT_RUL RT                                                 
P40277              ,TRT_RUL_CNSTR X                                            
P40277              ,TRT_RUL_CNSTR Y                                            
195000         WHERE CT.RUL_CNSTR_TYP_CDE = 'DECN'                              
195100           AND RT.RUL_ID            = CT.RUL_ID                           
P40277           AND RT.RUL_ID            = X.RUL_ID                            
P40277           AND RT.RUL_ID            = Y.RUL_ID                            
195200           AND RT.RUL_TYP_CDE       = :PV-COMPARE-RUL-TYP                 
195300           AND RT.RUL_CDE           = :PV-COMPARE-RUL-CDE                 
P40277           AND X.RUL_CNSTR_VAL_TXT  = :PV-CNTNR-CUR-VES                   
P40277           AND X.RUL_CNSTR_TYP_CDE  = 'VSL'                               
195900         END-EXEC                                                         
196000*                                                                         
196100         EVALUATE TRUE                                                    
196200             WHEN SQLCODE = ZERO                                          
196300             WHEN SQLCODE = +100                                          
196400             WHEN SQLCODE = -904                                          
196500             WHEN SQLCODE = -913                                          
196600                 CONTINUE                                                 
196700             WHEN SQLWARN0 NOT = SPACES                                   
196800             WHEN SQLCODE < ZERO                                          
196900             WHEN SQLCODE > ZERO                                          
197000                 MOVE '4530-SELECT-SCAC-CONPO-VSL'                        
197100                                   TO DP013-PARAGRAPH                     
197200                 MOVE TRT00014-RUL-TYP-CDE                                
197300                                   TO DP013-MESSAGE-TEXT (1)              
197400                 MOVE SQLCA        TO DP013-SQLCA                         
197500                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
197600                 SET DP013-DB2-ABEND                                      
197700                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
197800                 PERFORM DP013-0000-PROCESS-ABEND                         
197900         END-EVALUATE                                                     
198000     END-PERFORM.                                                         
198100*                                                                         
198200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
198300         MOVE '4530-SELECT-SCAC-CONPO-VSL'                                
198400                                     TO DP013-PARAGRAPH                   
198500         MOVE PV-CNTNR-CUR-CONTNR-ID                                      
198600                                   TO DP013-MESSAGE-TEXT (1)              
198700         MOVE SQLCA                TO DP013-SQLCA                         
198800         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)                 
198900         SET DP013-DB2-ABEND                                              
199000             DP013-XCTL-DISPLAY-RESTART                                   
199100                                   TO TRUE                                
199200         PERFORM DP013-0000-PROCESS-ABEND                                 
199300     END-IF.                                                              
199400                                                                          
199500******************************************************************        
199600 4535-SELECT-SCAC-CMN-VSL.                                                
199700                                                                          
199800     INITIALIZE PV-COMPARE-DECON-SCAC.                                    
199900                                                                          
200000     PERFORM                                                              
200100         WITH TEST AFTER                                                  
200200         VARYING PV-RETRY-COUNTER                                         
200300         FROM 1 BY 1                                                      
200400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
200500            OR  (SQLCODE = ZERO)                                          
200600            OR  (SQLCODE = +100))                                         
200700                                                                          
200800         EXEC SQL                                                         
200900          SELECT DISTINCT                                                 
201000                SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,4)                          
201100          INTO :PV-COMPARE-DECON-SCAC                                     
201200          FROM TRT_RUL_CNSTR CT                                           
201300              ,TRT_RUL RT                                                 
P40277              ,TRT_RUL_CNSTR X                                            
P40277              ,TRT_RUL_CNSTR Y                                            
201400         WHERE CT.RUL_CNSTR_TYP_CDE = 'DECN'                              
201500           AND RT.RUL_ID            = CT.RUL_ID                           
P40277           AND RT.RUL_ID            = X.RUL_ID                            
P40277           AND RT.RUL_ID            = Y.RUL_ID                            
201600           AND RT.RUL_TYP_CDE       = :PV-COMPARE-RUL-TYP                 
201700           AND RT.RUL_CDE           = :PV-COMPARE-RUL-CDE                 
P40277           AND X.RUL_CNSTR_VAL_TXT  = :PV-CNTNR-CUR-VES                   
P40277           AND X.RUL_CNSTR_TYP_CDE  = :PV-COMPARE-RUL-CDE                 
P40277           AND Y.RUL_CNSTR_VAL_TXT  = :PV-CNTNR-CUR-TRIP-ID               
P40277           AND Y.RUL_CNSTR_TYP_CDE  = 'VOY'                               
202800                                                                          
202900         END-EXEC                                                         
203000*                                                                         
203100         EVALUATE TRUE                                                    
203200             WHEN SQLCODE = ZERO                                          
203300             WHEN SQLCODE = +100                                          
203400             WHEN SQLCODE = -904                                          
203500             WHEN SQLCODE = -913                                          
203600                 CONTINUE                                                 
203700             WHEN SQLWARN0 NOT = SPACES                                   
203800             WHEN SQLCODE < ZERO                                          
203900             WHEN SQLCODE > ZERO                                          
204000                 MOVE '4535-SELECT-SCAC-CMN-VSL'                          
204100                                   TO DP013-PARAGRAPH                     
204200                 MOVE TRT00014-RUL-TYP-CDE                                
204300                                   TO DP013-MESSAGE-TEXT (1)              
204400                 MOVE SQLCA        TO DP013-SQLCA                         
204500                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
204600                 SET DP013-DB2-ABEND                                      
204700                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
204800                 PERFORM DP013-0000-PROCESS-ABEND                         
204900         END-EVALUATE                                                     
205000     END-PERFORM.                                                         
205100*                                                                         
205200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
205300         MOVE '4535-SELECT-SCAC-CMN-VSL'                                  
205400                                     TO DP013-PARAGRAPH                   
205500         MOVE PV-CNTNR-CUR-CONTNR-ID                                      
205600                                   TO DP013-MESSAGE-TEXT (1)              
205700         MOVE SQLCA                TO DP013-SQLCA                         
205800         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)                 
205900         SET DP013-DB2-ABEND                                              
206000             DP013-XCTL-DISPLAY-RESTART                                   
206100                                   TO TRUE                                
206200         PERFORM DP013-0000-PROCESS-ABEND                                 
206300     END-IF.                                                              
206400                                                                          
206500******************************************************************        
206600 4600-OPEN-VSL-CUR.                                                       
206700                                                                          
206800     PERFORM                                                              
206900         WITH TEST AFTER                                                  
207000         VARYING PV-RETRY-COUNTER                                         
207100         FROM 1 BY 1                                                      
207200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
207300             OR (SQLCODE = ZERO))                                         
207400                                                                          
207500            EXEC SQL                                                      
207600               OPEN VSL_CONT_CUR                                          
207700            END-EXEC                                                      
207800                                                                          
207900*                                                                         
208000         EVALUATE TRUE                                                    
208100             WHEN SQLCODE = ZERO                                          
208200             WHEN SQLCODE = -904                                          
208300             WHEN SQLCODE = -913                                          
208400                 CONTINUE                                                 
208500             WHEN SQLWARN0 NOT = SPACES                                   
208600             WHEN SQLCODE < ZERO                                          
208700             WHEN SQLCODE > ZERO                                          
208800                 MOVE '4600-OPEN-VSL-CUR'                                 
208900                                   TO DP013-PARAGRAPH                     
209000                 MOVE 'OPEN CON CURSOR - '                                
209100                                   TO DP013-MESSAGE-TEXT (1)              
209200                 MOVE SQLCA        TO DP013-SQLCA                         
209300                 MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)            
209400                 SET DP013-DB2-ABEND                                      
209500                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
209600                 PERFORM DP013-0000-PROCESS-ABEND                         
209700         END-EVALUATE                                                     
209800     END-PERFORM.                                                         
209900*                                                                         
210000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
210100         MOVE '4600-OPEN-VSL-CUR' TO DP013-PARAGRAPH                      
210200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
210300                                   TO DP013-MESSAGE-TEXT (1)              
210400         MOVE SQLCA                TO DP013-SQLCA                         
210500         MOVE 'TIMCNTK'            TO DP013-DB2-TABLE-NAME (1)            
210600         SET DP013-DB2-ABEND                                              
210700             DP013-XCTL-DISPLAY-RESTART                                   
210800                                   TO TRUE                                
210900         PERFORM DP013-0000-PROCESS-ABEND                                 
211000     END-IF.                                                              
211100                                                                          
211200     IF SQLCODE = ZERO                                                    
211300        SET PS-EOC-VSL-CONT-CUR-NO TO TRUE                                
211400     END-IF.                                                              
211500                                                                          
211600******************************************************************        
211700 4610-FETCH-VSL-CUR.                                                      
211800                                                                          
211810     INITIALIZE PV-VSL-CUR-RUL-ID                                         
211820                PV-VSL-CUR-CONTNR-ID                                      
211830                PV-VSL-CUR-SEQ-NBR-X                                      
211831                PV-VSL-CUR-SEQ-NBR.                                       
211840                                                                          
211900     EXEC SQL                                                             
212000         FETCH VSL_CONT_CUR                                               
212100         INTO  :PV-VSL-CUR-RUL-ID                                         
212200              ,:PV-VSL-CUR-CONTNR-ID                                      
212300              ,:PV-VSL-CUR-SEQ-NBR-X                                      
212400     END-EXEC.                                                            
212500                                                                          
212600*                                                                         
212700     EVALUATE TRUE                                                        
212800         WHEN SQLCODE = ZERO                                              
212900         WHEN SQLCODE = +100                                              
213000              CONTINUE                                                    
213100         WHEN SQLWARN0 NOT = SPACE                                        
213200         WHEN SQLCODE NOT = ZERO                                          
213300              MOVE '4610-FETCH-VSL-CUR'                                   
213400                               TO DP013-PARAGRAPH                         
213500              MOVE 'FETCH CMN CURSOR'                                     
213600                               TO DP013-MESSAGE-TEXT (1)                  
213700              MOVE SQLCA       TO DP013-SQLCA                             
213800              SET DP013-DB2-ABEND                                         
213900                               TO TRUE                                    
214000              PERFORM DP013-0000-PROCESS-ABEND                            
214100     END-EVALUATE.                                                        
214200*                                                                         
214300     IF  SQLCODE EQUAL +100                                               
214400         SET PS-EOC-VSL-CONT-CUR    TO TRUE                               
214500     END-IF.                                                              
214501                                                                          
214510     IF  SQLCODE EQUAL 0                                                  
214511       IF PV-VSL-CUR-SEQ-NBR-X (1:6) NUMERIC                              
214520         MOVE PV-VSL-CUR-SEQ-NBR-X (1:6) TO PV-VSL-CUR-SEQ-NBR            
214530       END-IF                                                             
214540     END-IF.                                                              
214600                                                                          
214700******************************************************************        
214800 4630-CLOSE-VSL-CUR.                                                      
214900                                                                          
215000     EXEC SQL                                                             
215100        CLOSE VSL_CONT_CUR                                                
215200     END-EXEC                                                             
215300                                                                          
215400*                                                                         
215500     EVALUATE TRUE                                                        
215600         WHEN SQLCODE = ZERO                                              
215700             CONTINUE                                                     
215800         WHEN SQLWARN0 NOT = SPACES                                       
215900         WHEN SQLCODE < ZERO                                              
216000         WHEN SQLCODE > ZERO                                              
216100             MOVE '4630-CLOSE-VSL-CUR'                                    
216200                               TO DP013-PARAGRAPH                         
216300             MOVE 'CLOSE VESSEL CONTNR CURSOR '                           
216400                               TO DP013-MESSAGE-TEXT (1)                  
216500             MOVE SQLCA        TO DP013-SQLCA                             
216600             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)                
216700             SET DP013-DB2-ABEND                                          
216800                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
216900             PERFORM DP013-0000-PROCESS-ABEND                             
217000     END-EVALUATE.                                                        
217100                                                                          
217200******************************************************************        
217300* PROCESS TO CREATE A NEW RULE                                   *        
217400******************************************************************        
217500 5000-CREATE-NEW-RULE.                                                    
217600                                                                          
217700** CONTNR-LEVEL                                                           
217800     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
217900         SET PS-RULE-EXISTS-NO TO TRUE                                    
218000         PERFORM 5005-CHECK-FOR-WKG-RULE                                  
218100         IF PS-RULE-EXISTS                                                
218200             SET PS-DEF-RULE-EXISTS-NO TO TRUE                            
218300             PERFORM 5030-SELECT-DEF-RULE-SCAC                            
218400             IF PS-DEF-RULE-EXISTS AND                                    
218500                (ASC-DECON-SCAC-CONTNR =                                  
218600                 TRT00015-RUL-CNSTR-VAL-TXT)                              
218700                  CONTINUE                                                
218800             ELSE                                                         
218900                 PERFORM 5015-INSERT-RULE-AUD                             
219000                 PERFORM 7520-OPEN-CNSTR-CUR                              
219100                 PERFORM 5020-PROCESS-CNSTR-CUR                           
219200                     UNTIL PS-EOC-CNSTR-CUR                               
219300                 PERFORM 7540-CLOSE-CNSTR-CUR                             
219400                 PERFORM 5025-DELETE-RULE                                 
219500                 PERFORM 5033-MOVE-TO-TRTRUL-DCLGEN                       
219600                 PERFORM 5035-INSERT-TRTRUL                               
219700                 PERFORM 5045-SELECT-TRTRUL                               
219800                 PERFORM 7555-OPEN-CNSTR-CUR-ADD                          
219900                 PERFORM 5040-PROCESS-CNSTR-CUR-ADD                       
220000                     UNTIL PS-EOC-CNSTR-CUR-ADD                           
220100                 PERFORM 7565-CLOSE-CNSTR-CUR-ADD                         
220200                 PERFORM 5050-INSERT-NEW-DECN-CNSTR                       
220300             END-IF                                                       
220400         ELSE                                                             
220500             PERFORM 5055-POPULATE-TRTRUL-FIELDS                          
220600             PERFORM 5035-INSERT-TRTRUL                                   
220700             PERFORM 5045-SELECT-TRTRUL                                   
220800             PERFORM 5060-ADD-RULE-CONSTRAINTS-CONT                       
220900         END-IF                                                           
221000     END-IF.                                                              
221100                                                                          
221200                                                                          
221300** VESSEL-LEVEL                                                           
221400     IF ASC-DECON-SCAC-VESSEL > SPACES                                    
221500         SET PS-RULE-EXISTS-NO TO TRUE                                    
221600         PERFORM 5005-CHECK-FOR-WKG-RULE                                  
221700         IF PS-RULE-EXISTS                                                
221800             PERFORM 5015-INSERT-RULE-AUD                                 
221900             PERFORM 7520-OPEN-CNSTR-CUR                                  
222000             PERFORM 5020-PROCESS-CNSTR-CUR                               
222100                 UNTIL PS-EOC-CNSTR-CUR                                   
222200             PERFORM 7540-CLOSE-CNSTR-CUR                                 
222300             PERFORM 5025-DELETE-RULE                                     
222400             PERFORM 5033-MOVE-TO-TRTRUL-DCLGEN                           
222500             PERFORM 5035-INSERT-TRTRUL                                   
222600             PERFORM 5045-SELECT-TRTRUL                                   
222700             PERFORM 7555-OPEN-CNSTR-CUR-ADD                              
222800             PERFORM 5040-PROCESS-CNSTR-CUR-ADD                           
222900                 UNTIL PS-EOC-CNSTR-CUR-ADD                               
223000             PERFORM 7565-CLOSE-CNSTR-CUR-ADD                             
223100             MOVE ASC-DECON-SCAC-VESSEL TO                                
223200                  TRT00015-RUL-CNSTR-VAL-TXT                              
223300             PERFORM 5050-INSERT-NEW-DECN-CNSTR                           
223400         ELSE                                                             
223500             PERFORM 5055-POPULATE-TRTRUL-FIELDS                          
223600             PERFORM 5035-INSERT-TRTRUL                                   
223700             PERFORM 5045-SELECT-TRTRUL                                   
223800             PERFORM 5063-ADD-RULE-CONSTRAINTS-VSL                        
223900         END-IF                                                           
224000     END-IF.                                                              
224100                                                                          
224200*MAM -- START HERE 7/28 ****                                              
224300****************                                                          
224400*                PERFORM XXXX-INSERT-NEW-RULE                             
224500*                PERFORM XXXX-MOVE-OLD-CONSTRAINTS-TO-NEW-CONSTRTS        
224600*                PERFORM XXXX-INSERT-CONSTRAINTS (EXCEPT SCAC)            
224700*                PERFORM XXXX-INSERT-NEWLY-ENTERED-SCAC-CONSTRAINT        
224800*                END-IF                                                   
224900*               END-IF                                                    
225000*            ELSE                                                         
225100*                PERFORM XXXX-INSERT-NEW-RULE                             
225200*                PERFORM XXXX-INSERT-NEW-CONSTRAINTS                      
225300*            END-IF                                                       
225400*         ELSE                                                            
225500*             SET DP030-OVERRIDE-GO TO TRUE                               
225600*         END-IF.                                                         
225700                                                                          
225800*MAM                                                                      
225900******************************************************************        
226000**           PERFORM XXXX-CHECK-TO-SEE-IF-WKG-RULE-EXISTS                 
226100**           IF WKG-RULE-EXISTS                                           
226200**               PERFORM XXXX-AUDIT-EXISTING-RULE                         
226300**               PERFORM XXXX-DELETE-EXISTING-RULE                        
226400**               IF CONTNR-LEVEL                                          
226500**                   PERFORM XXXX-CHECK-ENTERED-SCAC                      
226600**                   IF ENTERED-SCAC = DEFAULT-RULE-SCAC                  
226700**                       YOU ARE DONE WITH THE RULE PROCESSING            
226800**                   ELSE                                                 
226900**                   PERFORM XXXX-INSERT-NEW-RULE                         
227000**                   PERFORM XXXX-MOVE-OLD-CONSTRAINTS-TO-NEW-CONS        
227100**                   PERFORM XXXX-INSERT-CONSTRAINTS (EXCEPT SCAC)        
227200**                   PERFORM XXXX-INSERT-NEWLY-ENTERED-SCAC-CONSTR        
227300**                   END-IF                                               
227400**               ELSE                                                     
227500**               IF VESSEL-LEVEL                                          
227600**               PERFORM XXXX-INSERT-NEW-RULE                             
227700**               PERFORM XXXX-MOVE-OLD-CONSTRAINTS-TO-NEW-CONSTRTS        
227800**               PERFORM XXXX-INSERT-CONSTRAINTS (EXCEPT SCAC)            
227900**               PERFORM XXXX-INSERT-NEWLY-ENTERED-SCAC-CONSTRAINT        
228000**               END-IF                                                   
228100**              END-IF                                                    
228200**           ELSE                                                         
228300**               PERFORM XXXX-INSERT-NEW-RULE                             
228400**               PERFORM XXXX-INSERT-NEW-CONSTRAINTS                      
228500**           END-IF                                                       
228600**        ELSE                                                            
228700**            SET DP030-OVERRIDE-GO TO TRUE                               
228800**        END-IF.                                                         
228900******************************************************************        
229000*MAM***************                                                       
229100******************************************************************        
229200* CHECK TO SEE IF A WKG RULE EXISTS                              *        
229300******************************************************************        
229400 5005-CHECK-FOR-WKG-RULE.                                                 
229500                                                                          
229600     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
229700         MOVE 'WKG'  TO TRT00014-RUL-TYP-CDE                              
229800         MOVE 'CONT' TO TRT00014-RUL-CDE                                  
229900         PERFORM 5010-SELECT-RULE-DECN                                    
230000     ELSE                                                                 
230100        IF ASC-DECON-SCAC-VESSEL > SPACES                                 
230200            MOVE 'WKG'   TO TRT00014-RUL-TYP-CDE                          
230300            MOVE 'VSL '  TO TRT00014-RUL-CDE                              
230400            PERFORM 5010-SELECT-RULE-DECN                                 
230500        END-IF                                                            
230600     END-IF.                                                              
230700                                                                          
230800*----------------------------------------------------------------*        
230900 5010-SELECT-RULE-DECN.                                                   
231000                                                                          
231100     INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT.                               
231200                                                                          
231300     PERFORM                                                              
231400         WITH TEST AFTER                                                  
231500         VARYING PV-RETRY-COUNTER                                         
231600         FROM 1 BY 1                                                      
231700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
231800            OR  (SQLCODE = ZERO)                                          
231900            OR  (SQLCODE = +100))                                         
232000                                                                          
232100         EXEC SQL                                                         
232200          SELECT DISTINCT                                                 
232300                RT.RUL_ID                                                 
232400               ,RT.RUL_CDE                                                
232500               ,RT.RUL_TYP_CDE                                            
232600               ,RT.RUL_BEG_DTE                                            
232700               ,RT.RUL_END_DTE                                            
232800               ,RT.CRE_TMST                                               
232900               ,RT.CRE_BY_USR_ID                                          
233000               ,CT.RUL_CNSTR_VAL_TXT                                      
233100*MAM      INTO :TRT00014-RUL-ID                                           
233200          INTO :PV-CURRENT-RUL-ID                                         
233300              ,:TRT00014-RUL-CDE                                          
233400              ,:TRT00014-RUL-TYP-CDE                                      
233500              ,:TRT00014-RUL-BEG-DTE                                      
233600              ,:TRT00014-RUL-END-DTE                                      
233700              ,:TRT00014-CRE-TMST                                         
233800              ,:TRT00014-CRE-BY-USR-ID                                    
233900              ,:TRT00015-RUL-CNSTR-VAL-TXT                                
234000          FROM TRT_RUL_CNSTR CT                                           
234100              ,TRT_RUL RT                                                 
234200         WHERE CT.RUL_CNSTR_TYP_CDE = 'DECN'                              
234300           AND RT.RUL_ID            = CT.RUL_ID                           
234400           AND RT.RUL_CDE           = :TRT00014-RUL-TYP-CDE               
234500           AND RT.RUL_TYP_CDE       = :TRT00014-RUL-CDE                   
234600           AND RT.RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE                  
234700           AND RT.RUL_END_DTE       = :ASC-WEEK-TO-DTE                    
234800*MAM       AND RT.RUL_BEG_DTE       = :PV-WEEK-FROM-DTE                   
234900*MAM       AND RT.RUL_END_DTE       = :PV-WEEK-TO-DTE                     
235000         END-EXEC                                                         
235100*                                                                         
235200         EVALUATE TRUE                                                    
235300             WHEN SQLCODE = ZERO                                          
235400                 SET PS-RULE-EXISTS TO TRUE                               
235500                                                                          
235600                 EVALUATE TRUE                                            
235700                   WHEN TRT00014-RUL-TYP-CDE = PC-WKG                     
235800                       SET PS-DEF-RULE-EXISTS-NO TO TRUE                  
235900                   WHEN TRT00014-RUL-TYP-CDE = PC-DEF                     
236000                       SET PS-DEF-RULE-EXISTS TO TRUE                     
236100                 END-EVALUATE                                             
236200                                                                          
236300             WHEN SQLCODE = +100                                          
236400                 SET PS-RULE-EXISTS-NO TO TRUE                            
236500                                                                          
236600             WHEN SQLCODE = -904                                          
236700             WHEN SQLCODE = -913                                          
236800                 CONTINUE                                                 
236900             WHEN SQLWARN0 NOT = SPACES                                   
237000             WHEN SQLCODE < ZERO                                          
237100             WHEN SQLCODE > ZERO                                          
237200                 MOVE '5010-SELECT-RULE-DECN'                             
237300                                   TO DP013-PARAGRAPH                     
237400                 MOVE TRT00014-RUL-TYP-CDE                                
237500                                   TO DP013-MESSAGE-TEXT (1)              
237600                 MOVE SQLCA        TO DP013-SQLCA                         
237700                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
237800                 SET DP013-DB2-ABEND                                      
237900                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
238000                 PERFORM DP013-0000-PROCESS-ABEND                         
238100         END-EVALUATE                                                     
238200     END-PERFORM.                                                         
238300*                                                                         
238400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
238500         MOVE '5010-SELECT-RULE-DECN'                                     
238600                                     TO DP013-PARAGRAPH                   
238700         MOVE PV-CNTNR-CUR-CONTNR-ID                                      
238800                                   TO DP013-MESSAGE-TEXT (1)              
238900         MOVE SQLCA                TO DP013-SQLCA                         
239000         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)                 
239100         SET DP013-DB2-ABEND                                              
239200             DP013-XCTL-DISPLAY-RESTART                                   
239300                                   TO TRUE                                
239400         PERFORM DP013-0000-PROCESS-ABEND                                 
239500     END-IF.                                                              
239600*                                                                         
239700******************************************************************        
239800 5015-INSERT-RULE-AUD.                                                    
239900                                                                          
240000     EXEC SQL                                                             
240100                                                                          
240200         INSERT INTO TRT_AUD_RUL                                          
240300            (RUL_ID                                                       
240400            ,RUL_CDE                                                      
240500            ,RUL_TYP_CDE                                                  
240600            ,RUL_BEG_DTE                                                  
240700            ,RUL_END_DTE                                                  
240800            ,CRE_TMST                                                     
240900            ,CRE_BY_USR_ID                                                
241000            ,AUD_CRE_USR_ID                                               
241100            ,AUD_FUNC_CDE                                                 
241200            ,AUD_CRE_TMST)                                                
241300          VALUES                                                          
241400           (:PV-CURRENT-RUL-ID                                            
241500           ,:TRT00014-RUL-CDE                                             
241600           ,:TRT00014-RUL-TYP-CDE                                         
241700           ,:TRT00014-RUL-BEG-DTE                                         
241800           ,:TRT00014-RUL-END-DTE                                         
241900           ,:TRT00014-CRE-TMST                                            
242000           ,:TRT00014-CRE-BY-USR-ID                                       
242100           ,:PC-CURRENT-PROGRAM-NAME                                      
242200           ,'DEL'                                                         
242300           ,CURRENT_TIMESTAMP)                                            
242400                                                                          
242500     END-EXEC                                                             
242600                                                                          
242700     EVALUATE TRUE                                                        
242800         WHEN SQLCODE = ZERO                                              
242900             CONTINUE                                                     
243000                                                                          
243100         WHEN SQLWARN0 NOT EQUAL SPACE                                    
243200         WHEN SQLCODE NOT EQUAL ZERO                                      
243300              MOVE '5015-INSERT-RULE-AUD'                                 
243400                               TO DP013-PARAGRAPH                         
243500              MOVE 'TRYING TO INSERT RULE AUDIT'                          
243600                               TO DP013-MESSAGE-TEXT (1)                  
243700              MOVE SQLCA       TO DP013-SQLCA                             
243800              SET DP013-DB2-ABEND                                         
243900                               TO TRUE                                    
244000              PERFORM DP013-0000-PROCESS-ABEND                            
244100     END-EVALUATE.                                                        
244200                                                                          
244300******************************************************************        
244400*  AUDIT CONSTRAINT ROWS                                                  
244500******************************************************************        
244600 5020-PROCESS-CNSTR-CUR.                                                  
244700                                                                          
244800     PERFORM 7530-FETCH-CNSTR-CUR.                                        
244900     IF PS-EOC-CNSTR-CUR                                                  
245000        CONTINUE                                                          
245100     ELSE                                                                 
245200       PERFORM 7550-INSERT-CNSTR-AUD                                      
245300     END-IF.                                                              
245400                                                                          
245500******************************************************************        
245600 5025-DELETE-RULE.                                                        
245700                                                                          
245800     EXEC SQL                                                             
245900        DELETE FROM TRT_RUL                                               
246000         WHERE RUL_ID = :PV-CURRENT-RUL-ID                                
246100     END-EXEC.                                                            
246200                                                                          
246300     EVALUATE TRUE                                                        
246400         WHEN SQLCODE = ZERO                                              
246500            CONTINUE                                                      
246600                                                                          
246700         WHEN SQLWARN0 NOT EQUAL SPACE                                    
246800         WHEN SQLCODE NOT EQUAL ZERO                                      
246900              MOVE '5025-DELETE-RULE'                                     
247000                               TO DP013-PARAGRAPH                         
247100              MOVE 'TRYING TO DELETE RULE'                                
247200                               TO DP013-MESSAGE-TEXT (1)                  
247300              MOVE SQLCA       TO DP013-SQLCA                             
247400              MOVE 'TRT_RUL'   TO DP013-DB2-TABLE-NAME (1)                
247500              SET DP013-DB2-ABEND                                         
247600                               TO TRUE                                    
247700              PERFORM DP013-0000-PROCESS-ABEND                            
247800     END-EVALUATE.                                                        
247900                                                                          
248000******************************************************************        
248100 5030-SELECT-DEF-RULE-SCAC.                                               
248200                                                                          
248300     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
248400         MOVE 'DEF'  TO TRT00014-RUL-TYP-CDE                              
248500         MOVE 'CONT' TO TRT00014-RUL-CDE                                  
248600         PERFORM 5010-SELECT-RULE-DECN                                    
248700     ELSE                                                                 
248800        IF ASC-DECON-SCAC-VESSEL > SPACES                                 
248900            MOVE 'DEF'   TO TRT00014-RUL-TYP-CDE                          
249000            MOVE 'VSL '  TO TRT00014-RUL-CDE                              
249100            PERFORM 5010-SELECT-RULE-DECN                                 
249200        END-IF                                                            
249300     END-IF.                                                              
249400                                                                          
249500******************************************************************        
249600 5033-MOVE-TO-TRTRUL-DCLGEN.                                              
249700                                                                          
249800     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
249900         MOVE 'CONT' TO TRT00014-RUL-CDE                                  
250000     ELSE                                                                 
250100        IF ASC-DECON-SCAC-VESSEL > SPACES                                 
250200            MOVE 'VSL '  TO TRT00014-RUL-CDE                              
250300        END-IF                                                            
250400     END-IF.                                                              
250500                                                                          
250600     MOVE 'WKG'                  TO TRT00014-RUL-TYP-CDE.                 
250700     MOVE ASC-WEEK-FROM-DTE      TO TRT00014-RUL-BEG-DTE.                 
250800     MOVE ASC-WEEK-TO-DTE        TO TRT00014-RUL-END-DTE.                 
250900                                                                          
251000******************************************************************        
251100 5035-INSERT-TRTRUL.                                                      
251200                                                                          
251300     EXEC SQL                                                             
251400                                                                          
251500         INSERT INTO TRT_RUL                                              
251600            (RUL_CDE                                                      
251700            ,RUL_TYP_CDE                                                  
251800            ,RUL_BEG_DTE                                                  
251900            ,RUL_END_DTE                                                  
252000            ,CRE_TMST                                                     
252100            ,CRE_BY_USR_ID)                                               
252200          VALUES                                                          
252300           (:TRT00014-RUL-CDE                                             
252400           ,:TRT00014-RUL-TYP-CDE                                         
252500           ,:TRT00014-RUL-BEG-DTE                                         
252600           ,:TRT00014-RUL-END-DTE                                         
252700           , CURRENT_TIMESTAMP                                            
252800           ,:PC-CURRENT-PROGRAM-NAME)                                     
252900                                                                          
253000     END-EXEC                                                             
253100                                                                          
253200     EVALUATE TRUE                                                        
253300         WHEN SQLCODE = ZERO                                              
253400             CONTINUE                                                     
253500                                                                          
253600         WHEN SQLWARN0 NOT EQUAL SPACE                                    
253700         WHEN SQLCODE NOT EQUAL ZERO                                      
253800              MOVE '5035-INSERT-TRTRUL'                                   
253900                               TO DP013-PARAGRAPH                         
254000              MOVE 'TRYING TO INSERT RULE'                                
254100                               TO DP013-MESSAGE-TEXT (1)                  
254200              MOVE SQLCA       TO DP013-SQLCA                             
254300              MOVE 'TRT_RUL'   TO DP013-DB2-TABLE-NAME (1)                
254400              SET DP013-DB2-ABEND                                         
254500                               TO TRUE                                    
254600              PERFORM DP013-0000-PROCESS-ABEND                            
254700     END-EVALUATE.                                                        
254800                                                                          
254900******************************************************************        
255000*  INSERT CONSTRAINT ROWS                                                 
255100******************************************************************        
255200* INSERT OLD RULE CONSTRAINTS EXCEPT FOR 'DECN'                           
255300******************************************************************        
255400 5040-PROCESS-CNSTR-CUR-ADD.                                              
255500                                                                          
255600     PERFORM 7560-FETCH-CNSTR-CUR-ADD.                                    
255700     IF PS-EOC-CNSTR-CUR-ADD                                              
255800        CONTINUE                                                          
255900     ELSE                                                                 
256000       PERFORM 7570-INSERT-CNSTR-ADD                                      
256100     END-IF.                                                              
256200                                                                          
256300*----------------------------------------------------------------*        
256400 5045-SELECT-TRTRUL.                                                      
256500                                                                          
256600     PERFORM                                                              
256700         WITH TEST AFTER                                                  
256800         VARYING PV-RETRY-COUNTER                                         
256900         FROM 1 BY 1                                                      
257000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
257100            OR  (SQLCODE = ZERO)                                          
257200            OR  (SQLCODE = +100))                                         
257300                                                                          
257400         EXEC SQL                                                         
257500          SELECT DISTINCT                                                 
257600                RT.RUL_ID                                                 
257700*MAM      INTO :TRT00014-RUL-ID                                           
257800          INTO :PV-CURRENT-RUL-ID                                         
257900          FROM TRT_RUL RT                                                 
258000         WHERE RT.RUL_CDE           = :TRT00014-RUL-TYP-CDE               
258100           AND RT.RUL_TYP_CDE       = :TRT00014-RUL-CDE                   
258200           AND RT.RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE                  
258300           AND RT.RUL_END_DTE       = :ASC-WEEK-TO-DTE                    
258400*          AND RT.RUL_BEG_DTE       = :PV-WEEK-FROM-DTE                   
258500*          AND RT.RUL_END_DTE       = :PV-WEEK-TO-DTE                     
258600         END-EXEC                                                         
258700*                                                                         
258800         EVALUATE TRUE                                                    
258900             WHEN SQLCODE = ZERO                                          
259000             WHEN SQLCODE = +100                                          
259100             WHEN SQLCODE = -904                                          
259200             WHEN SQLCODE = -913                                          
259300                 CONTINUE                                                 
259400             WHEN SQLWARN0 NOT = SPACES                                   
259500             WHEN SQLCODE < ZERO                                          
259600             WHEN SQLCODE > ZERO                                          
259700                 MOVE '5045-SELECT-TRTRUL'                                
259800                                   TO DP013-PARAGRAPH                     
259900                 MOVE TRT00014-RUL-TYP-CDE                                
260000                                   TO DP013-MESSAGE-TEXT (1)              
260100                 MOVE SQLCA        TO DP013-SQLCA                         
260200                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)            
260300                 SET DP013-DB2-ABEND                                      
260400                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
260500                 PERFORM DP013-0000-PROCESS-ABEND                         
260600         END-EVALUATE                                                     
260700     END-PERFORM.                                                         
260800*                                                                         
260900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
261000         MOVE 'TRT00014-RUL-TYP-CDE MAX RETRIES'                          
261100                                     TO DP013-PARAGRAPH                   
261200         MOVE TRT00014-RUL-TYP-CDE                                        
261300                                   TO DP013-MESSAGE-TEXT (1)              
261400         MOVE SQLCA                TO DP013-SQLCA                         
261500         MOVE 'TRT_RUL' TO DP013-DB2-TABLE-NAME (1)                       
261600         SET DP013-DB2-ABEND                                              
261700             DP013-XCTL-DISPLAY-RESTART                                   
261800                                   TO TRUE                                
261900         PERFORM DP013-0000-PROCESS-ABEND                                 
262000     END-IF.                                                              
262100*                                                                         
262200******************************************************************        
262300 5050-INSERT-NEW-DECN-CNSTR.                                              
262400                                                                          
262500     INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT.                               
262600     INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE.                               
262700     MOVE 'DECN' TO TRT00015-RUL-CNSTR-TYP-CDE.                           
262800                                                                          
262900     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
263000         MOVE ASC-DECON-SCAC-CONTNR TO                                    
263100               TRT00015-RUL-CNSTR-VAL-TXT                                 
263200     ELSE                                                                 
263300         IF ASC-DECON-SCAC-VESSEL > SPACES                                
263400             MOVE ASC-DECON-SCAC-VESSEL TO                                
263500                   TRT00015-RUL-CNSTR-VAL-TXT                             
263600     END-IF.                                                              
263700                                                                          
263800     PERFORM 5065-ADD-CONT-CONSTR.                                        
263900                                                                          
264000******************************************************************        
264100 5055-POPULATE-TRTRUL-FIELDS.                                             
264200                                                                          
264300     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
264400         MOVE 'WKG'  TO TRT00014-RUL-TYP-CDE                              
264500         MOVE 'CONT' TO TRT00014-RUL-CDE                                  
264600         MOVE TR320-WEEK-FROM-DTE TO TRT00014-RUL-BEG-DTE                 
264700         MOVE TR320-WEEK-TO-DTE   TO TRT00014-RUL-END-DTE                 
264800     ELSE                                                                 
264900        IF ASC-DECON-SCAC-VESSEL > SPACES                                 
265000            MOVE 'WKG'   TO TRT00014-RUL-TYP-CDE                          
265100            MOVE 'VSL '  TO TRT00014-RUL-CDE                              
265200            MOVE TR320-WEEK-FROM-DTE TO TRT00014-RUL-BEG-DTE              
265300            MOVE TR320-WEEK-TO-DTE   TO TRT00014-RUL-END-DTE              
265400     END-IF.                                                              
265500                                                                          
265600******************************************************************        
265700 5060-ADD-RULE-CONSTRAINTS-CONT.                                          
265800                                                                          
265900     IF ASC-DECON-SCAC-CONTNR > SPACES                                    
266000* CONTNR **                                                               
266100         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
266200         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
266300         MOVE TR320-CONTNR-ID TO TRT00015-RUL-CNSTR-VAL-TXT               
266400         MOVE 'CONT'          TO TRT00015-RUL-CNSTR-TYP-CDE               
266500         PERFORM 5065-ADD-CONT-CONSTR                                     
266600                                                                          
266700* CONTNR SEQ ** SAME CONSTRAINT CODE AS CONTAINER                         
266800         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
266900         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
267000         MOVE TR320-CONTNR-SEQ-NBR TO PV-CNTNR-SEQ-NBR                    
267100         MOVE PV-CNTNR-SEQ-NBR-X   TO TRT00015-RUL-CNSTR-VAL-TXT          
267200         MOVE 'SEQ'                TO TRT00015-RUL-CNSTR-TYP-CDE          
267300         MOVE PV-CURRENT-RUL-ID    TO TRT00015-RUL-ID                     
267400         MOVE IMCNTL-RUL-CNSTR-CDE TO TRT00015-RUL-CNSTR-CDE              
267500         PERFORM 7620-INSERT-CONSTRAINT                                   
267600                                                                          
267700*ETA **** SAME CONSTRAINT CODE AS CONTAINER                               
267800         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
267900         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
268000         MOVE TR320-ETA-DATE TO TRT00015-RUL-CNSTR-VAL-TXT                
268100         MOVE 'ETA'               TO TRT00015-RUL-CNSTR-TYP-CDE           
268200         MOVE PV-CURRENT-RUL-ID  TO TRT00015-RUL-ID                       
268300         MOVE IMCNTL-RUL-CNSTR-CDE TO TRT00015-RUL-CNSTR-CDE              
268400         PERFORM 7620-INSERT-CONSTRAINT                                   
268500                                                                          
268600*VESSEL *****                                                             
268700         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
268800         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
268900         MOVE TR320-VESSEL TO TRT00015-RUL-CNSTR-VAL-TXT                  
269000         MOVE 'VSL'        TO TRT00015-RUL-CNSTR-TYP-CDE                  
269100         PERFORM 5065-ADD-CONT-CONSTR                                     
269200                                                                          
269300*VOYAGE** -- SAME CONSTRAINT CODE AS VESSEL **                            
269400         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
269500         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
269600         MOVE TR320-VOYAGE TO TRT00015-RUL-CNSTR-VAL-TXT                  
269700         MOVE 'VOY'        TO TRT00015-RUL-CNSTR-TYP-CDE                  
269800         MOVE PV-CURRENT-RUL-ID  TO TRT00015-RUL-ID                       
269900         MOVE IMCNTL-RUL-CNSTR-CDE TO TRT00015-RUL-CNSTR-CDE              
270000         PERFORM 7620-INSERT-CONSTRAINT                                   
270100                                                                          
270200*FOB  *******                                                             
270300         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
270400         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
270500         MOVE TR320-FOB-CDE TO TRT00015-RUL-CNSTR-VAL-TXT                 
270600         MOVE 'FOB'         TO TRT00015-RUL-CNSTR-TYP-CDE                 
270700         PERFORM 5065-ADD-CONT-CONSTR                                     
270800                                                                          
270900*POE  *******                                                             
271000         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
271100         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
271200         MOVE TR320-POE-CDE TO TRT00015-RUL-CNSTR-VAL-TXT                 
271300         MOVE 'POE'         TO TRT00015-RUL-CNSTR-TYP-CDE                 
271400         PERFORM 5065-ADD-CONT-CONSTR                                     
271500                                                                          
271600*DECN *******                                                             
271700         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
271800         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
271900         MOVE ASC-DECON-SCAC-CONTNR                                       
272000                            TO TRT00015-RUL-CNSTR-VAL-TXT                 
272100         MOVE 'DECN'        TO TRT00015-RUL-CNSTR-TYP-CDE                 
272200         PERFORM 5065-ADD-CONT-CONSTR                                     
272300                                                                          
272400     END-IF.                                                              
273500                                                                          
273600******************************************************************        
273700 5063-ADD-RULE-CONSTRAINTS-VSL.                                           
273800                                                                          
273900     IF ASC-DECON-SCAC-VESSEL > SPACES                                    
274000*VESSEL *****                                                             
274100         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
274200         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
274300         MOVE TR320-VESSEL TO TRT00015-RUL-CNSTR-VAL-TXT                  
274400         MOVE 'VSL'        TO TRT00015-RUL-CNSTR-TYP-CDE                  
274500         PERFORM 5065-ADD-CONT-CONSTR                                     
274600                                                                          
274700*VOYAGE** -- SAME CONSTRAINT CODE AS VESSEL **                            
274800         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
274900         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
275000         MOVE TR320-VOYAGE TO TRT00015-RUL-CNSTR-VAL-TXT                  
275100         MOVE 'VOY'        TO TRT00015-RUL-CNSTR-TYP-CDE                  
275200         MOVE PV-CURRENT-RUL-ID  TO TRT00015-RUL-ID                       
275300         MOVE IMCNTL-RUL-CNSTR-CDE TO TRT00015-RUL-CNSTR-CDE              
275400         PERFORM 7620-INSERT-CONSTRAINT                                   
275500                                                                          
275600*POE  *******                                                             
275700         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
275800         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
275900         MOVE TR320-POE-CDE TO TRT00015-RUL-CNSTR-VAL-TXT                 
276000         MOVE 'POE'         TO TRT00015-RUL-CNSTR-TYP-CDE                 
276100         PERFORM 5065-ADD-CONT-CONSTR                                     
276200                                                                          
276300*DECN *******                                                             
276400         INITIALIZE TRT00015-RUL-CNSTR-VAL-TXT                            
276500         INITIALIZE TRT00015-RUL-CNSTR-TYP-CDE                            
276600         MOVE ASC-DECON-SCAC-VESSEL                                       
276700                            TO TRT00015-RUL-CNSTR-VAL-TXT                 
276800         MOVE 'DECN'        TO TRT00015-RUL-CNSTR-TYP-CDE                 
276900         PERFORM 5065-ADD-CONT-CONSTR                                     
277000                                                                          
277100     END-IF.                                                              
277200                                                                          
277300***************************************************************           
277400 5065-ADD-CONT-CONSTR.                                                    
277500                                                                          
277600     MOVE PV-CURRENT-RUL-ID  TO TRT00015-RUL-ID.                          
277700     PERFORM 7600-SELECT-TIMCNTL.                                         
277800     MOVE IMCNTL-RUL-CNSTR-CDE TO TRT00015-RUL-CNSTR-CDE.                 
277900     PERFORM 7620-INSERT-CONSTRAINT.                                      
278000     PERFORM 7610-UPDATE-TIMCNTL.                                         
278100                                                                          
278200*----------------------------------------------------------------*        
278300* SELECT WORKING VESSEL RULE                                              
278400*----------------------------------------------------------------*        
278500 6000-SELECT-WKG-VESSEL-RULE.                                             
278600                                                                          
278700     EXEC SQL                                                             
278800        SELECT DISTINCT VSL.RUL_ID                                        
278900        INTO   :PV-AUDIT-RUL-ID                                           
279000        FROM   TRT_RUL_CNSTR VSL                                          
279200              ,TRT_RUL_CNSTR POE                                          
279300              ,TRT_RUL       TR                                           
279510        WHERE  VSL.RUL_ID            = POE.RUL_ID                         
279600          AND  VSL.RUL_ID            = TR.RUL_ID                          
279700          AND  VSL.RUL_CNSTR_TYP_CDE = 'VSL'                              
279800          AND  VSL.RUL_CNSTR_VAL_TXT = :ASC-VESSEL                        
280100          AND  POE.RUL_CNSTR_TYP_CDE = 'POE'                              
280200          AND  POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                       
280300          AND  TR.RUL_CDE            = 'VSL'                              
280400          AND  TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                 
280500          AND  TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                   
280600     END-EXEC.                                                            
280700                                                                          
280800     EVALUATE TRUE                                                        
280900         WHEN SQLCODE = ZERO                                              
281000         WHEN SQLCODE = -811                                              
281100              CONTINUE                                                    
281200         WHEN SQLCODE = +100                                              
281300              MOVE ZEROES TO PV-AUDIT-RUL-ID                              
281400         WHEN SQLWARN0 NOT = SPACE                                        
281500         WHEN SQLCODE NOT = ZERO                                          
281600              MOVE '6000-SELECT-WKG-VESSEL-RULE'                          
281700                               TO DP013-PARAGRAPH                         
281800              MOVE 'SQL ERROR SELECT WKG VESSEL RULE'                     
281900                               TO DP013-MESSAGE-TEXT (1)                  
282000              MOVE SQLCA       TO DP013-SQLCA                             
282100              SET DP013-DB2-ABEND                                         
282200                               TO TRUE                                    
282300              PERFORM DP013-0000-PROCESS-ABEND                            
282400     END-EVALUATE.                                                        
282500                                                                          
282600 EJECT                                                                    
282700*----------------------------------------------------------------*        
282800* INSERT AUDIT ROW FOR ALL WORKING RULES                                  
282900*----------------------------------------------------------------*        
283000 6100-AUDIT-WORKING-RULE.                                                 
283100                                                                          
283200     EXEC SQL                                                             
283300        INSERT INTO TRT_AUD_RUL                                           
283400        SELECT TR.RUL_ID                                                  
283500              ,TR.RUL_CDE                                                 
283600              ,TR.RUL_TYP_CDE                                             
283700              ,TR.RUL_BEG_DTE                                             
283800              ,TR.RUL_END_DTE                                             
283900              ,TR.CRE_TMST                                                
284000              ,TR.CRE_BY_USR_ID                                           
284100              ,:DP020-USERID                                              
284200              ,:TRT00017-AUD-FUNC-CDE                                     
284300              ,CURRENT TIMESTAMP                                          
284400        FROM TRT_RUL TR                                                   
284500        WHERE TR.RUL_ID  = :PV-AUDIT-RUL-ID                               
284600          AND TR.RUL_CDE = :PV-AUDIT-RUL-CDE                              
284700     END-EXEC.                                                            
284800                                                                          
284900     EVALUATE TRUE                                                        
285000         WHEN SQLCODE = ZERO                                              
285100         WHEN SQLCODE = -811                                              
285200         WHEN SQLCODE = +100                                              
285300              CONTINUE                                                    
285400         WHEN SQLWARN0 NOT = SPACE                                        
285500         WHEN SQLCODE NOT = ZERO                                          
285600              MOVE '6100-AUDIT-WORKING-RULE'                              
285700                               TO DP013-PARAGRAPH                         
285800              MOVE 'SQL ERROR INSERTING AUDIT RULE'                       
285900                               TO DP013-MESSAGE-TEXT (1)                  
286000              MOVE SQLCA       TO DP013-SQLCA                             
286100              SET DP013-DB2-ABEND                                         
286200                               TO TRUE                                    
286300              PERFORM DP013-0000-PROCESS-ABEND                            
286400     END-EVALUATE.                                                        
286500                                                                          
286600 EJECT                                                                    
286700*----------------------------------------------------------------*        
286800* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                            
286900*----------------------------------------------------------------*        
287000 6200-AUDIT-WORKING-CNSTR.                                                
287100                                                                          
287200     EXEC SQL                                                             
287300        INSERT INTO TRT_AUD_RUL_CNSTR                                     
287400        SELECT TRC.RUL_ID                                                 
287500              ,TRC.RUL_CNSTR_CDE                                          
287600              ,TRC.RUL_CNSTR_TYP_CDE                                      
287700              ,TRC.RUL_CNSTR_VAL_TXT                                      
287800              ,TRC.CRE_TMST                                               
287900              ,TRC.CRE_BY_USR_ID                                          
288000              ,:DP020-USERID                                              
288100              ,:TRT00017-AUD-FUNC-CDE                                     
288200              ,CURRENT TIMESTAMP                                          
288300        FROM   TRT_RUL_CNSTR TRC                                          
288400              ,TRT_RUL       TR                                           
288500        WHERE  TRC.RUL_ID = TR.RUL_ID                                     
288600          AND  TR.RUL_ID  = :PV-AUDIT-RUL-ID                              
288700          AND  TR.RUL_CDE = :PV-AUDIT-RUL-CDE                             
288800     END-EXEC.                                                            
288900                                                                          
289000     EVALUATE TRUE                                                        
289100         WHEN SQLCODE = ZERO                                              
289200         WHEN SQLCODE = -811                                              
289300         WHEN SQLCODE = +100                                              
289400              CONTINUE                                                    
289500         WHEN SQLWARN0 NOT = SPACE                                        
289600         WHEN SQLCODE NOT = ZERO                                          
289700              MOVE '6200-AUDIT-WORKING-CNSTR'                             
289800                               TO DP013-PARAGRAPH                         
289900              MOVE 'SQL ERROR INSERTING AUDIT CNSTR'                      
290000                               TO DP013-MESSAGE-TEXT (1)                  
290100              MOVE SQLCA       TO DP013-SQLCA                             
290200              SET DP013-DB2-ABEND                                         
290300                               TO TRUE                                    
290400              PERFORM DP013-0000-PROCESS-ABEND                            
290500     END-EVALUATE.                                                        
290600 EJECT                                                                    
290700*----------------------------------------------------------------*        
290800* DELETE AUDITED WORKING RULE.  CONSTRAINT WILL CASCADE DELETE.           
290900*----------------------------------------------------------------*        
291000 6300-DELETE-WORKING-RULE.                                                
291100                                                                          
291200     EXEC SQL                                                             
291300        DELETE FROM TRT_RUL                                               
291400        WHERE RUL_ID  = :PV-AUDIT-RUL-ID                                  
291500          AND RUL_CDE = :PV-AUDIT-RUL-CDE                                 
291600     END-EXEC.                                                            
291700                                                                          
291800     EVALUATE TRUE                                                        
291900         WHEN SQLCODE = ZERO                                              
292000         WHEN SQLCODE = -811                                              
292100         WHEN SQLCODE = +100                                              
292200              CONTINUE                                                    
292300         WHEN SQLWARN0 NOT = SPACE                                        
292400         WHEN SQLCODE NOT = ZERO                                          
292500              MOVE '6300-DELETE-WORKING-RULE'                             
292600                               TO DP013-PARAGRAPH                         
292700              MOVE 'SQL ERROR DELETING WKG RULE'                          
292800                               TO DP013-MESSAGE-TEXT (1)                  
292900              MOVE SQLCA       TO DP013-SQLCA                             
293000              SET DP013-DB2-ABEND                                         
293100                               TO TRUE                                    
293200              PERFORM DP013-0000-PROCESS-ABEND                            
293300     END-EVALUATE.                                                        
293400 EJECT                                                                    
293500*----------------------------------------------------------------*        
293600* DELETE WORKING CONSTRAINT                                               
293700*----------------------------------------------------------------*        
293800 6400-SELECT-DEFALUT-RULE.                                                
293900                                                                          
294000     EXEC SQL                                                             
294100        SELECT DISTINCT                                                   
294200               RUL_ID                                                     
294300              ,RUL_CDE                                                    
294400              ,RUL_TYP_CDE                                                
294500              ,RUL_BEG_DTE                                                
294600              ,RUL_END_DTE                                                
294700              ,CRE_TMST                                                   
294800              ,CRE_BY_USR_ID                                              
294900        INTO   :TRT00014-RUL-ID                                           
295000              ,:TRT00014-RUL-CDE                                          
295100              ,:TRT00014-RUL-TYP-CDE                                      
295200              ,:TRT00014-RUL-BEG-DTE                                      
295300              ,:TRT00014-RUL-END-DTE                                      
295400              ,:TRT00014-CRE-TMST                                         
295500              ,:TRT00014-CRE-BY-USR-ID                                    
295600        FROM TRT_RUL                                                      
295700        WHERE RUL_ID = :ASC-RUL-ID-DEFLT                                  
295800     END-EXEC.                                                            
295900                                                                          
296000     EVALUATE TRUE                                                        
296100         WHEN SQLCODE = ZERO                                              
296200         WHEN SQLCODE = -811                                              
296300         WHEN SQLCODE = +100                                              
296400              IF ASC-DECON-SCAC-VESSEL > SPACES                           
296500                 MOVE 'VSL ' TO TRT00014-RUL-CDE                          
296600              END-IF                                                      
296700         WHEN SQLWARN0 NOT = SPACE                                        
296800         WHEN SQLCODE NOT = ZERO                                          
296900              MOVE '6400-SELECT-DEFALUT-RULE'                             
297000                               TO DP013-PARAGRAPH                         
297100              MOVE 'SQL ERROR SELECTING DEFAULT RULE'                     
297200                               TO DP013-MESSAGE-TEXT (1)                  
297300              MOVE SQLCA       TO DP013-SQLCA                             
297400              SET DP013-DB2-ABEND                                         
297500                               TO TRUE                                    
297600              PERFORM DP013-0000-PROCESS-ABEND                            
297700     END-EVALUATE.                                                        
297800 EJECT                                                                    
297900*----------------------------------------------------------------*        
298000* INSERT NEW WORKING RULE                                                 
298100*----------------------------------------------------------------*        
298200 6500-ADD-WORKING-RULE.                                                   
298300                                                                          
298400     EXEC SQL                                                             
298500        INSERT INTO TRT_RUL                                               
298600              (RUL_CDE                                                    
298700              ,RUL_TYP_CDE                                                
298800              ,RUL_BEG_DTE                                                
298900              ,RUL_END_DTE                                                
299000              ,CRE_TMST                                                   
299100              ,CRE_BY_USR_ID)                                             
299200       VALUES (:TRT00014-RUL-CDE                                          
299300              ,'WKG'                                                      
299400              ,:TRT00014-RUL-BEG-DTE                                      
299500              ,:TRT00014-RUL-END-DTE                                      
299600              ,CURRENT TIMESTAMP                                          
299700              ,:DP020-USERID)                                             
299800     END-EXEC.                                                            
299900                                                                          
300000     EVALUATE TRUE                                                        
300100         WHEN SQLCODE = ZERO                                              
300200         WHEN SQLCODE = -811                                              
300300         WHEN SQLCODE = +100                                              
300400              PERFORM 6510-RETRIEVE-INSERTED-RULE-ID                      
300500         WHEN SQLWARN0 NOT = SPACE                                        
300600         WHEN SQLCODE NOT = ZERO                                          
300700              MOVE '6130-ADD-ADJUSTED-RULE'                               
300800                               TO DP013-PARAGRAPH                         
300900              MOVE 'SQL ERROR INSERTING WORKING RULE'                     
301000                               TO DP013-MESSAGE-TEXT (1)                  
301100              MOVE SQLCA       TO DP013-SQLCA                             
301200              SET DP013-DB2-ABEND                                         
301300                               TO TRUE                                    
301400              PERFORM DP013-0000-PROCESS-ABEND                            
301500     END-EVALUATE.                                                        
301600 EJECT                                                                    
301700*----------------------------------------------------------------*        
301800* INSERT AUDIT ROW FOR ALL WORKING RULES                                  
301900*----------------------------------------------------------------*        
302000 6510-RETRIEVE-INSERTED-RULE-ID.                                          
302100                                                                          
302200     EXEC SQL                                                             
302300        SET :PV-NEW-WKG-RULE-ID = IDENTITY_VAL_LOCAL ()                   
302400     END-EXEC.                                                            
302500                                                                          
302600     EVALUATE TRUE                                                        
302700         WHEN SQLCODE = ZERO                                              
302800              CONTINUE                                                    
302900         WHEN SQLWARN0 NOT = SPACE                                        
303000         WHEN SQLCODE NOT = ZERO                                          
303100              MOVE '6510-RETRIEVE-INSERTED-RULE-ID'                       
303200                               TO DP013-PARAGRAPH                         
303300              MOVE 'SQL ERROR SELECT NEW RULE ID'                         
303400                               TO DP013-MESSAGE-TEXT (1)                  
303500              MOVE SQLCA       TO DP013-SQLCA                             
303600              SET DP013-DB2-ABEND                                         
303700                               TO TRUE                                    
303800              PERFORM DP013-0000-PROCESS-ABEND                            
303900     END-EVALUATE.                                                        
304000 EJECT                                                                    
304100*----------------------------------------------------------------*        
304200* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                            
304300*----------------------------------------------------------------*        
304400 6600-ADD-WORKING-CNSTR.                                                  
304500                                                                          
304600     EXEC SQL                                                             
304700        INSERT INTO TRT_RUL_CNSTR                                         
304800        SELECT :PV-NEW-WKG-RULE-ID                                        
304900              ,RUL_CNSTR_CDE                                              
305000              ,RUL_CNSTR_TYP_CDE                                          
305100              ,RUL_CNSTR_VAL_TXT                                          
305200              ,CURRENT TIMESTAMP                                          
305300              ,:DP020-USERID                                              
305400        FROM   TRT_RUL_CNSTR TRC                                          
305500              ,TRT_RUL       TR                                           
305600        WHERE  TRC.RUL_ID = :ASC-RUL-ID-DEFLT                             
305700          AND  TRC.RUL_ID = TR.RUL_ID                                     
305800          AND (                                                           
305900                (:ASC-DECON-SCAC-VESSEL > '    '                          
306000                 AND TRC.RUL_CNSTR_TYP_CDE                                
306100                            IN ('VSL','VOY','POE','DECN','ETA'))          
306200              OR                                                          
306300                (:ASC-DECON-SCAC-CONTNR > '    ')                         
306400              )                                                           
306500     END-EXEC.                                                            
306600                                                                          
306700     EVALUATE TRUE                                                        
306800         WHEN SQLCODE = ZERO                                              
306900         WHEN SQLCODE = -811                                              
307000         WHEN SQLCODE = +100                                              
307100              CONTINUE                                                    
307200         WHEN SQLWARN0 NOT = SPACE                                        
307300         WHEN SQLCODE NOT = ZERO                                          
307400              MOVE '6600-ADD-WORKING-CNSTR'                               
307500                               TO DP013-PARAGRAPH                         
307600              MOVE 'SQL ERROR INSERTING WORKING CNSTR'                    
307700                               TO DP013-MESSAGE-TEXT (1)                  
307800              MOVE SQLCA       TO DP013-SQLCA                             
307900              SET DP013-DB2-ABEND                                         
308000                               TO TRUE                                    
308100              PERFORM DP013-0000-PROCESS-ABEND                            
308200     END-EVALUATE.                                                        
308300 EJECT                                                                    
308400*----------------------------------------------------------------*        
308500* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                            
308600*----------------------------------------------------------------*        
308700 6700-UPDATE-DECON-SCAC.                                                  
308800                                                                          
308900     EXEC SQL                                                             
309000        UPDATE TRT_RUL_CNSTR                                              
309100        SET    RUL_CNSTR_VAL_TXT = :DK-SCAC-CDE                           
309200        WHERE  RUL_ID            = :PV-NEW-WKG-RULE-ID                    
309300          AND  RUL_CNSTR_TYP_CDE = 'DECN'                                 
309400     END-EXEC.                                                            
309500                                                                          
309600     EVALUATE TRUE                                                        
309700         WHEN SQLCODE = ZERO                                              
309800         WHEN SQLCODE = -811                                              
309900         WHEN SQLCODE = +100                                              
310000              CONTINUE                                                    
310100         WHEN SQLWARN0 NOT = SPACE                                        
310200         WHEN SQLCODE NOT = ZERO                                          
310300              MOVE '6700-UPDATE-DECON-SCAC'                               
310400                               TO DP013-PARAGRAPH                         
310500              MOVE 'SQL ERROR UPDATING DECON SCAC'                        
310600                               TO DP013-MESSAGE-TEXT (1)                  
310700              MOVE SQLCA       TO DP013-SQLCA                             
310800              SET DP013-DB2-ABEND                                         
310900                               TO TRUE                                    
311000              PERFORM DP013-0000-PROCESS-ABEND                            
311100     END-EVALUATE.                                                        
311200 EJECT                                                                    
311300                                                                          
311400******************************************************************        
311500 7520-OPEN-CNSTR-CUR.                                                     
311600                                                                          
311700     EXEC SQL                                                             
311800          OPEN CNSTR_CUR                                                  
311900     END-EXEC.                                                            
312000                                                                          
312100     EVALUATE TRUE                                                        
312200         WHEN SQLCODE = ZERO                                              
312300             CONTINUE                                                     
312400         WHEN SQLWARN0 NOT = SPACES                                       
312500         WHEN SQLCODE < ZERO                                              
312600         WHEN SQLCODE > ZERO                                              
312700             MOVE '7520-OPEN-CNSTR-CUR'                                   
312800                               TO DP013-PARAGRAPH                         
312900             MOVE 'OPEN CNSTR CURSOR'                                     
313000                               TO DP013-MESSAGE-TEXT (1)                  
313100             MOVE 'CURSOR: CNSTR_CUR' TO DP013-MESSAGE-TEXT (2)           
313200             MOVE SQLCA        TO DP013-SQLCA                             
313300             MOVE 'TRT_RUL_CNSTR'   TO DP013-DB2-TABLE-NAME (1)           
313400             SET DP013-DB2-ABEND                                          
313500                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
313600             PERFORM DP013-0000-PROCESS-ABEND                             
313700     END-EVALUATE.                                                        
313800                                                                          
313900******************************************************************        
314000 7530-FETCH-CNSTR-CUR.                                                    
314100                                                                          
314200     EXEC SQL                                                             
314300          FETCH CNSTR_CUR                                                 
314400           INTO :TRT00015-RUL-ID                                          
314500               ,:TRT00015-RUL-CNSTR-CDE                                   
314600               ,:TRT00015-RUL-CNSTR-TYP-CDE                               
314700               ,:TRT00015-RUL-CNSTR-VAL-TXT                               
314800               ,:TRT00015-CRE-TMST                                        
314900               ,:TRT00015-CRE-BY-USR-ID                                   
315000     END-EXEC.                                                            
315100                                                                          
315200     EVALUATE TRUE                                                        
315300                                                                          
315400         WHEN SQLCODE = ZERO                                              
315500            CONTINUE                                                      
315600                                                                          
315700         WHEN SQLCODE = +100                                              
315800            SET PS-EOC-CNSTR-CUR   TO  TRUE                               
315900                                                                          
316000         WHEN SQLWARN0 NOT = SPACES                                       
316100         WHEN SQLCODE < ZERO                                              
316200         WHEN SQLCODE > ZERO                                              
316300             MOVE '7530-FETCH-CNSTR-CUR'                                  
316400                               TO DP013-PARAGRAPH                         
316500             MOVE 'FETCH CNSTR CURSOR'                                    
316600                               TO DP013-MESSAGE-TEXT (1)                  
316700             MOVE 'CURSOR: CNSTR_CUR' TO DP013-MESSAGE-TEXT (2)           
316800             MOVE SQLCA        TO DP013-SQLCA                             
316900             MOVE 'TRT_RUL_CNSTR'   TO DP013-DB2-TABLE-NAME (1)           
317000             SET DP013-DB2-ABEND                                          
317100                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
317200             PERFORM DP013-0000-PROCESS-ABEND                             
317300     END-EVALUATE.                                                        
317400                                                                          
317500******************************************************************        
317600 7540-CLOSE-CNSTR-CUR.                                                    
317700                                                                          
317800     EXEC SQL                                                             
317900         CLOSE CNSTR_CUR                                                  
318000     END-EXEC.                                                            
318100                                                                          
318200     EVALUATE TRUE                                                        
318300         WHEN SQLWARN0 NOT = SPACES                                       
318400         WHEN SQLCODE < ZERO                                              
318500         WHEN SQLCODE > ZERO                                              
318600             MOVE '7540-CLOSE-CNSTR-CUR'                                  
318700                               TO DP013-PARAGRAPH                         
318800             MOVE 'CLOSE CNSTR CURSOR'                                    
318900                               TO DP013-MESSAGE-TEXT (1)                  
319000             MOVE 'CURSOR: CNSTR_CUR' TO DP013-MESSAGE-TEXT (2)           
319100             MOVE SQLCA        TO DP013-SQLCA                             
319200             MOVE 'TRT_RUL_CNSTR'   TO DP013-DB2-TABLE-NAME (1)           
319300             SET DP013-DB2-ABEND                                          
319400                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
319500             PERFORM DP013-0000-PROCESS-ABEND                             
319600     END-EVALUATE.                                                        
319700                                                                          
319800******************************************************************        
319900 7550-INSERT-CNSTR-AUD.                                                   
320000                                                                          
320100     EXEC SQL                                                             
320200                                                                          
320300         INSERT INTO TRT_AUD_RUL_CNSTR                                    
320400            (RUL_ID                                                       
320500            ,RUL_CNSTR_CDE                                                
320600            ,RUL_CNSTR_TYP_CDE                                            
320700            ,RUL_CNSTR_VAL_TXT                                            
320800            ,CRE_TMST                                                     
320900            ,CRE_BY_USR_ID                                                
321000            ,AUD_CRE_USR_ID                                               
321100            ,AUD_FUNC_CDE                                                 
321200            ,AUD_CRE_TMST)                                                
321300          VALUES                                                          
321400           (:TRT00015-RUL-ID                                              
321500           ,:TRT00015-RUL-CNSTR-CDE                                       
321600           ,:TRT00015-RUL-CNSTR-TYP-CDE                                   
321700           ,:TRT00015-RUL-CNSTR-VAL-TXT                                   
321800           ,:TRT00015-CRE-TMST                                            
321900           ,:TRT00015-CRE-BY-USR-ID                                       
322000           ,:PC-CURRENT-PROGRAM-NAME                                      
322100           ,'DEL'                                                         
322200           ,CURRENT_TIMESTAMP)                                            
322300                                                                          
322400     END-EXEC                                                             
322500                                                                          
322600     EVALUATE TRUE                                                        
322700         WHEN SQLCODE = ZERO                                              
322800             CONTINUE                                                     
322900                                                                          
323000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
323100         WHEN SQLCODE NOT EQUAL ZERO                                      
323200              MOVE '7550-INESRT-CONSTR-AUDIT'                             
323300                               TO DP013-PARAGRAPH                         
323400              MOVE 'TRYING TO INSERT'                                     
323500                               TO DP013-MESSAGE-TEXT (1)                  
323600              MOVE SQLCA       TO DP013-SQLCA                             
323700              SET DP013-DB2-ABEND                                         
323800                               TO TRUE                                    
323900              PERFORM DP013-0000-PROCESS-ABEND                            
324000     END-EVALUATE.                                                        
324100                                                                          
324200******************************************************************        
324300 7555-OPEN-CNSTR-CUR-ADD.                                                 
324400                                                                          
324500     EXEC SQL                                                             
324600          OPEN CNSTR_CUR_ADD                                              
324700     END-EXEC.                                                            
324800                                                                          
324900     EVALUATE TRUE                                                        
325000         WHEN SQLCODE = ZERO                                              
325100             CONTINUE                                                     
325200         WHEN SQLWARN0 NOT = SPACES                                       
325300         WHEN SQLCODE < ZERO                                              
325400         WHEN SQLCODE > ZERO                                              
325500             MOVE '7555-OPEN-CNSTR-CUR-ADD'                               
325600                               TO DP013-PARAGRAPH                         
325700             MOVE 'OPEN CNSTR CURSOR'                                     
325800                               TO DP013-MESSAGE-TEXT (1)                  
325900           MOVE 'CURSOR: CNSTR_CUR_ADD' TO DP013-MESSAGE-TEXT (2)         
326000             MOVE SQLCA        TO DP013-SQLCA                             
326100             MOVE 'TRT_RUL_CNSTR'   TO DP013-DB2-TABLE-NAME (1)           
326200             SET DP013-DB2-ABEND                                          
326300                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
326400             PERFORM DP013-0000-PROCESS-ABEND                             
326500     END-EVALUATE.                                                        
326600                                                                          
326700******************************************************************        
326800 7560-FETCH-CNSTR-CUR-ADD.                                                
326900                                                                          
327000     EXEC SQL                                                             
327100          FETCH CNSTR_CUR_ADD                                             
327200*MAM       INTO :TRT00018-RUL-ID                                          
327300           INTO :TRT00018-RUL-CNSTR-CDE                                   
327400               ,:TRT00018-RUL-CNSTR-TYP-CDE                               
327500               ,:TRT00018-RUL-CNSTR-VAL-TXT                               
327600               ,:TRT00018-CRE-TMST                                        
327700               ,:TRT00018-CRE-BY-USR-ID                                   
327800               ,:TRT00018-AUD-CRE-USR-ID                                  
327900               ,:TRT00018-AUD-FUNC-CDE                                    
328000               ,:TRT00018-AUD-CRE-TMST                                    
328100     END-EXEC.                                                            
328200                                                                          
328300     EVALUATE TRUE                                                        
328400                                                                          
328500         WHEN SQLCODE = ZERO                                              
328600            CONTINUE                                                      
328700                                                                          
328800         WHEN SQLCODE = +100                                              
328900            SET PS-EOC-CNSTR-CUR-ADD TO TRUE                              
329000                                                                          
329100         WHEN SQLWARN0 NOT = SPACES                                       
329200         WHEN SQLCODE < ZERO                                              
329300         WHEN SQLCODE > ZERO                                              
329400             MOVE '7560-FETCH-CNSTR-CUR-ADD'                              
329500                               TO DP013-PARAGRAPH                         
329600             MOVE 'FETCH CNSTR CURSOR'                                    
329700                               TO DP013-MESSAGE-TEXT (1)                  
329800           MOVE 'CURSOR: CNSTR_CUR_ADD' TO DP013-MESSAGE-TEXT (2)         
329900             MOVE SQLCA        TO DP013-SQLCA                             
330000             MOVE 'TRT_RUL_CNSTR'   TO DP013-DB2-TABLE-NAME (1)           
330100             SET DP013-DB2-ABEND                                          
330200                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
330300             PERFORM DP013-0000-PROCESS-ABEND                             
330400     END-EVALUATE.                                                        
330500                                                                          
330600******************************************************************        
330700 7565-CLOSE-CNSTR-CUR-ADD.                                                
330800                                                                          
330900     EXEC SQL                                                             
331000         CLOSE CNSTR_CUR_ADD                                              
331100     END-EXEC.                                                            
331200                                                                          
331300     EVALUATE TRUE                                                        
331400         WHEN SQLWARN0 NOT = SPACES                                       
331500         WHEN SQLCODE < ZERO                                              
331600         WHEN SQLCODE > ZERO                                              
331700             MOVE '7565-CLOSE-CNSTR-CUR-ADD'                              
331800                               TO DP013-PARAGRAPH                         
331900             MOVE 'CLOSE CNSTR CURSOR ADD'                                
332000                               TO DP013-MESSAGE-TEXT (1)                  
332100             MOVE 'CURSOR: CNSTR_CUR' TO DP013-MESSAGE-TEXT (2)           
332200             MOVE SQLCA        TO DP013-SQLCA                             
332300             MOVE 'TRT_RUL_CNSTR'   TO DP013-DB2-TABLE-NAME (1)           
332400             SET DP013-DB2-ABEND                                          
332500                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
332600             PERFORM DP013-0000-PROCESS-ABEND                             
332700     END-EVALUATE.                                                        
332800                                                                          
332900******************************************************************        
333000 7570-INSERT-CNSTR-ADD.                                                   
333100                                                                          
333200     EXEC SQL                                                             
333300                                                                          
333400         INSERT INTO TRT_RUL_CNSTR                                        
333500            (RUL_ID                                                       
333600            ,RUL_CNSTR_CDE                                                
333700            ,RUL_CNSTR_TYP_CDE                                            
333800            ,RUL_CNSTR_VAL_TXT                                            
333900            ,CRE_TMST                                                     
334000            ,CRE_BY_USR_ID)                                               
334100          VALUES                                                          
334200           (:PV-CURRENT-RUL-ID                                            
334300           ,:TRT00018-RUL-CNSTR-CDE                                       
334400           ,:TRT00018-RUL-CNSTR-TYP-CDE                                   
334500           ,:TRT00018-RUL-CNSTR-VAL-TXT                                   
334600           ,CURRENT_TIMESTAMP                                             
334700           ,:PC-CURRENT-PROGRAM-NAME)                                     
334800                                                                          
334900     END-EXEC                                                             
335000                                                                          
335100     EVALUATE TRUE                                                        
335200         WHEN SQLCODE = ZERO                                              
335300             CONTINUE                                                     
335400                                                                          
335500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
335600         WHEN SQLCODE NOT EQUAL ZERO                                      
335700              MOVE '7570-INSERT-CONSTR'                                   
335800                               TO DP013-PARAGRAPH                         
335900              MOVE 'TRYING TO INSERT'                                     
336000                               TO DP013-MESSAGE-TEXT (1)                  
336100              MOVE SQLCA       TO DP013-SQLCA                             
336200              SET DP013-DB2-ABEND                                         
336300                               TO TRUE                                    
336400              PERFORM DP013-0000-PROCESS-ABEND                            
336500     END-EVALUATE.                                                        
336600******************************************************************        
336700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
336800******************************************************************        
336900 7580-MOVE-COMMAREA-TO-SCREEN.                                            
337000*MAM                                                                      
337100                                                                          
337200     MOVE ASC-POE-CDE              TO APOECODO.                           
337300                                                                          
337400     MOVE ASC-WEEK-FROM-DTE (6:2)  TO PV-WEEK-FROM-DTE-MM.                
337500     MOVE ASC-WEEK-FROM-DTE (9:2)  TO PV-WEEK-FROM-DTE-DD.                
337600     MOVE ASC-WEEK-FROM-DTE (1:2)  TO PV-WEEK-FROM-DTE-CC.                
337700     MOVE ASC-WEEK-FROM-DTE (3:2)  TO PV-WEEK-FROM-DTE-YY.                
337800     MOVE PV-WEEK-FROM-DTE         TO AFRMDTEO.                           
337900                                                                          
338000     MOVE ASC-WEEK-TO-DTE (6:2)  TO PV-WEEK-TO-DTE-MM.                    
338100     MOVE ASC-WEEK-TO-DTE (9:2)  TO PV-WEEK-TO-DTE-DD.                    
338200     MOVE ASC-WEEK-TO-DTE (1:2)  TO PV-WEEK-TO-DTE-CC.                    
338300     MOVE ASC-WEEK-TO-DTE (3:2)  TO PV-WEEK-TO-DTE-YY.                    
338400     MOVE PV-WEEK-TO-DTE         TO ATODTEO.                              
338500                                                                          
338600     MOVE ASC-CONTNR-ID          TO ACONTRO.                              
338700                                                                          
338800     MOVE ASC-ETA-DATE (6:2)  TO PV-ETA-DTE-MM.                           
338900     MOVE ASC-ETA-DATE (9:2)  TO PV-ETA-DTE-DD.                           
339000     MOVE ASC-ETA-DATE (1:2)  TO PV-ETA-DTE-CC.                           
339100     MOVE ASC-ETA-DATE (3:2)  TO PV-ETA-DTE-YY.                           
339200     MOVE PV-ETA-DTE          TO AETAO.                                   
339300                                                                          
339400     MOVE ASC-VESSEL               TO AVESSELO.                           
339500     MOVE ASC-VOYAGE               TO AVOYAGEO.                           
339600     MOVE ASC-DECON-SCAC-VESSEL    TO ASCAC1O.                            
339700     MOVE ASC-DECON-SCAC-CONTNR    TO ASCAC2O.                            
339800                                                                          
339900                                                                          
340000     IF ASC-VESSEL = SPACES AND                                           
340100        ASC-VOYAGE = SPACES                                               
340200         MOVE DP015-PRO-NOR-OFF      TO ASCAC1A                           
340300         MOVE DP015-HL-OFF           TO ASCAC1H                           
340400         MOVE -1                     TO ASCAC2L                           
340500     END-IF.                                                              
340600                                                                          
340700     IF ASC-CONTNR-ID = SPACES AND                                        
340800        ASC-ETA-DATE = SPACES                                             
340900         MOVE DP015-PRO-NOR-OFF      TO ASCAC2A                           
341000         MOVE DP015-HL-OFF           TO ASCAC2H                           
341100         MOVE -1                     TO ASCAC1L                           
341200     END-IF.                                                              
341300                                                                          
341400******************************************************************        
341500 7600-SELECT-TIMCNTL.                                                     
341600                                                                          
341700     EXEC SQL                                                             
341800                                                                          
341900         SELECT RUL_CNSTR_CDE                                             
342000           INTO :IMCNTL-RUL-CNSTR-CDE                                     
342100           FROM TIMCNTL                                                   
342200                                                                          
342300     END-EXEC                                                             
342400                                                                          
342500     EVALUATE TRUE                                                        
342600         WHEN SQLCODE = ZERO                                              
342700             CONTINUE                                                     
342800                                                                          
342900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
343000         WHEN SQLCODE NOT EQUAL ZERO                                      
343100              MOVE '7600-SELECT-TIMCNTL'                                  
343200                               TO DP013-PARAGRAPH                         
343300              MOVE 'TRYING TO SELECT'                                     
343400                               TO DP013-MESSAGE-TEXT (1)                  
343500              MOVE SQLCA       TO DP013-SQLCA                             
343600              SET DP013-DB2-ABEND                                         
343700                               TO TRUE                                    
343800              PERFORM DP013-0000-PROCESS-ABEND                            
343900     END-EVALUATE.                                                        
344000                                                                          
344100******************************************************************        
344200 7610-UPDATE-TIMCNTL.                                                     
344300                                                                          
344400     COMPUTE PV-NEXT-RUL-CNSTR-CDE =                                      
344500               IMCNTL-RUL-CNSTR-CDE + 1.                                  
344600                                                                          
344700     EXEC SQL                                                             
344800                                                                          
344900         UPDATE TIMCNTL                                                   
345000            SET RUL_CNSTR_CDE = :PV-NEXT-RUL-CNSTR-CDE                    
345100          WHERE RUL_CNSTR_CDE = :IMCNTL-RUL-CNSTR-CDE                     
345200                                                                          
345300     END-EXEC                                                             
345400                                                                          
345500     EVALUATE TRUE                                                        
345600         WHEN SQLCODE = ZERO                                              
345700             CONTINUE                                                     
345800                                                                          
345900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
346000         WHEN SQLCODE NOT EQUAL ZERO                                      
346100              MOVE '7610-UPDATE-TIMCNTL'                                  
346200                               TO DP013-PARAGRAPH                         
346300              MOVE 'TRYING TO UPDATE'                                     
346400                               TO DP013-MESSAGE-TEXT (1)                  
346500              MOVE SQLCA       TO DP013-SQLCA                             
346600              SET DP013-DB2-ABEND                                         
346700                               TO TRUE                                    
346800              PERFORM DP013-0000-PROCESS-ABEND                            
346900     END-EVALUATE.                                                        
347000                                                                          
347100******************************************************************        
347200 7620-INSERT-CONSTRAINT.                                                  
347300                                                                          
347400     EXEC SQL                                                             
347500                                                                          
347600         INSERT INTO TRT_RUL_CNSTR                                        
347700             (RUL_ID                                                      
347800             ,RUL_CNSTR_CDE                                               
347900             ,RUL_CNSTR_TYP_CDE                                           
348000             ,RUL_CNSTR_VAL_TXT                                           
348100             ,CRE_TMST                                                    
348200             ,CRE_BY_USR_ID)                                              
348300          VALUES                                                          
348400           (:TRT00015-RUL-ID                                              
348500           ,:TRT00015-RUL-CNSTR-CDE                                       
348600           ,:TRT00015-RUL-CNSTR-TYP-CDE                                   
348700           ,:TRT00015-RUL-CNSTR-VAL-TXT                                   
348800           ,CURRENT_TIMESTAMP                                             
348900           ,:PC-CURRENT-PROGRAM-NAME)                                     
349000                                                                          
349100     END-EXEC                                                             
349200                                                                          
349300     EVALUATE TRUE                                                        
349400         WHEN SQLCODE = ZERO                                              
349500             CONTINUE                                                     
349600                                                                          
349700         WHEN SQLWARN0 NOT EQUAL SPACE                                    
349800         WHEN SQLCODE NOT EQUAL ZERO                                      
349900              MOVE '7620-INSERT-CONSTRAINT'                               
350000                               TO DP013-PARAGRAPH                         
350100              MOVE 'TRYING TO INSERT'                                     
350200                               TO DP013-MESSAGE-TEXT (1)                  
350300              MOVE SQLCA       TO DP013-SQLCA                             
350400              SET DP013-DB2-ABEND                                         
350500                               TO TRUE                                    
350600              PERFORM DP013-0000-PROCESS-ABEND                            
350700     END-EVALUATE.                                                        
350800                                                                          
350810******************************************************************        
350811* PRB0040274 - 03/20/2012 MAKE ADJUSTMENT DAYS PARM DRIVEN - MJF *        
350820*  SELECT PARM - NUMBER OF DAYS TO BE USED IN DATE RANGE CALC    *        
350830******************************************************************        
350840 7630-SELECT-PARM-NUM-DAYS.                                               
350850                                                                          
350860        EXEC SQL                                                          
350870            SELECT FUNC_QTY                                               
350880              INTO :KRPRPM-FUNC-QTY                                       
350890              FROM  TKRPRPM                                               
350895             WHERE  LOC_ID            = :KRPRPM-LOC-ID                    
350896               AND  SYS_PRC_FUNC_CDE  = :KRPRPM-SYS-PRC-FUNC-CDE          
350897               AND  INTFC_SYS_CDE     = :KRPRPM-INTFC-SYS-CDE             
350898               AND  FUNC_PRC_STAT_CDE = :KRPRPM-FUNC-PRC-STAT-CDE         
350907             WITH UR                                                      
350908        END-EXEC.                                                         
350909                                                                          
350910        EVALUATE TRUE                                                     
350911            WHEN SQLCODE = +0                                             
350912                CONTINUE                                                  
350913                                                                          
350914            WHEN SQLWARN0 NOT = SPACES                                    
350915            WHEN SQLCODE < +0                                             
350916            WHEN SQLCODE > +0                                             
350917                MOVE '7630-SELECT-PARM-NUM-DAYS'                          
350918                                       TO DP013-PARAGRAPH                 
350919                MOVE 'TKRPRPM'         TO DP013-DB2-TABLE-NAME (1)        
350920                SET DP013-DB2-ABEND                                       
350921                    DP013-XCTL-DISPLAY-RESTART TO TRUE                    
350922                PERFORM DP013-0000-PROCESS-ABEND                          
350923        END-EVALUATE.                                                     
350924                                                                          
350930******************************************************************        
351000*    ABEND PROCESSOR MODULE                                      *        
351100******************************************************************        
351200                                                                          
351300     COPY DPPD013.                                                        
351400                                                                          
351500******************************************************************        
351600*    LINK TO CICS OBJECT LOCKING MODULE                          *        
351700******************************************************************        
351800                                                                          
351900     COPY DPPD044.                                                        
