000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.      CEKSP001.                                       00020001
000300 AUTHOR.          CHRISTINE TWIEHAUS.                             00030001
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040001
000500 DATE-WRITTEN.    JULY  2010.                                     00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800* SEND NEXT AVAILABLE PULL NUMBER                                 00080010
000900******************************************************************00090001
001000* SPECIAL COMPILE/STAGING NOTE!                                   00100001
      * USE 5.P                                                         00101062
001100* -----------------------------                                   00110001
001200*                                                                 00120001
001300******************************************************************00130001
001400* 07/19/10 - CHRISTINE TWIEHAUS                                  *00140010
001500*            INITIAL IMPLEMENTATION                              *00150001
001600*                                                                *00160001
001700******************************************************************00170001
001800 ENVIRONMENT DIVISION.                                            00180001
001900 CONFIGURATION SECTION.                                           00190001
002000 SOURCE-COMPUTER. IBM-3090.                                       00200001
002100 OBJECT-COMPUTER. IBM-3090.                                       00210001
002200                                                                  00220001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400******************************************************************00240001
002500 DATA DIVISION.                                                   00250001
002600******************************************************************00260001
002700                                                                  00270001
002800 FILE SECTION.                                                    00280001
002900                                                                  00290001
003000 WORKING-STORAGE SECTION.                                         00300001
003100******************************************************************00310001
003200* PROGRAM CONSTANTS                                               00320001
003300******************************************************************00330001
003400 01  PC-PROGRAM-CONSTANTS.                                        00340001
003500     05  PC-PROGRAM-NAME             PIC  X(08)  VALUE 'CEKSP001'.00350001
003600     05  PC-NBR-OF-TIERS             PIC S9(04)  VALUE +10        00360001
003700                                                 COMP SYNC.       00370001
003800     05  PC-1-DAY                    PIC S9(03)  VALUE +1         00380001
003900                                                 COMP-3.          00390001
004000     05  PC-90                     PIC  9(04)  VALUE  0090.       00400010
004100     05  PC-FCLTY-ID-0001          PIC  9(04)  VALUE  0001.       00410011
004110                                                                  00411023
004200                                                                  00420001
004300*-----------------------------------------------------------------00430011
004301*  DB2 KEYS                                                       00430111
004302*-----------------------------------------------------------------00430211
004303 01  DK-DB2-KEYS.                                                 00430311
004304                                                                  00430411
004305     05  DK-CURR-OPER-UNT-ID            PIC S9(04)  COMP VALUE +0.00430511
004306     05  DK-CURR-FCLTY-ID               PIC S9(04)  COMP VALUE +0.00430611
004307                                                                  00430711
004310******************************************************************00431011
004400* PROGRAM VARIBLES                                                00440001
004500******************************************************************00450001
004600 01  PV-PROGRAM-VARIBLES.                                         00460001
004700     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00470001
004800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00480001
004810     05  PV-DB2-TIMESTAMP            PIC  X(26)  VALUE SPACES.    00481049
004900     05  PV-OPERATION-MSG-1          PIC  X(40)  VALUE SPACES.    00490001
005000     05  PV-COUNT                    PIC S9(05)  VALUE ZEROES     00500001
005001                                                 COMP.            00500150
005002     05  PV-INFO-LINE                PIC X(30) VALUE SPACES.      00500250
005200     05  PV-HOLD-SQLCODE             PIC S9(09)  VALUE ZEROES     00520001
005300                                                 COMP.            00530001
005400     05  PV-STR-NBR                  PIC S9(04)  COMP.            00540001
005500     05  PV-INDEX                    PIC  9(04)  VALUE ZEROES.    00550001
005600     05  PV-INDEX-1                  PIC S9(02)  VALUE ZEROES     00560001
005700                                                 COMP-3.          00570001
005800     05  PV-HOLD-SLASH1              PIC S9(02)  VALUE ZEROES     00580001
005900                                                 COMP-3.          00590001
006000     05  PV-HOLD-SLASH2              PIC S9(02)  VALUE ZEROES     00600001
006100                                                 COMP-3.          00610001
006200     05  PV-SQLCODE-OUT              PIC 9(09) VALUE ZEROES.      00620050
020800 01  PV-NULL-INDICATORS.                                          02080001
022100     05  PV-QTY-NULL-IND              PIC S9(04) VALUE +0         02210001
022200                                                 COMP SYNC.       02220001
022300                                                                  02230001
025000******************************************************************02500001
025100* PROGRAM SWITCHES                                                02510001
025200******************************************************************02520001
025300 01  PS-PROGRAM-SWITCHES.                                         02530001
025400     05  PS-DISPLAY-SW               PIC  X(01)  VALUE 'Y'.       02540001
025500         88  PS-DISPLAY-YES                      VALUE 'Y'.       02550001
025600         88  PS-DISPLAY-NO                       VALUE 'N'.       02560001
025700     05  PS-FIRST-TIME-SW            PIC  X(01)  VALUE 'Y'.       02570001
025800         88  PS-FIRST-TIME                       VALUE 'Y'.       02580001
025900         88  PS-NOT-FIRST-TIME                   VALUE 'N'.       02590001
026100     05  PS-ABEND-SW                 PIC  X(01)  VALUE 'N'.       02610001
026200         88  PS-ABEND                            VALUE 'Y'.       02620001
026300         88  PS-NO-ABEND                         VALUE 'N'.       02630001
026400                                                                  02640001
027300 01  ABEND-CODE                      PIC S9(04)  COMP VALUE +0.   02730001
027400     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     02740001
027500                                                                  02750001
029100******************************************************************02910001
029200* COPYBOOKS                                                       02920001
029300******************************************************************02930001
029700***VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        02970001
029800     COPY DPWS004.                                                02980001
029900                                                                  02990001
030000***DB2 MESSAGE AREA                                               03000001
030100     COPY SQLCA2.                                                 03010001
030200                                                                  03020001
030300******************************************************************03030001
030400* TABLE INCLUSIONS                                                03040001
030500******************************************************************03050001
030600     EXEC SQL INCLUDE SQLCA    END-EXEC.                          03060001
030700                                                                  03070001
030710*** RC-COMPANY CONTROL TABLE                                      03071010
030720*    EXEC SQL                                                     03072067
030730*        INCLUDE TCOCNTL                                          03073067
030740*    END-EXEC.                                                    03074067
030750                                                                  03075050
039700*-----------------------------------------------------------------03075151
039800*  CENTRAL STOCK - CENTRAL STOCK PULL CONTROL (CET_CSNTK_PL_CNTL) 03075251
039900*-----------------------------------------------------------------03075351
040000     EXEC SQL                                                     03075451
040100         INCLUDE CET00000                                         03075551
040200     END-EXEC.                                                    03075651
040300                                                                  03075751
030751*** PAR TABLE FOR DISPLAY                                         03075849
030760     EXEC SQL                                                     03076049
030770        INCLUDE TKRPRPM                                           03077049
030780     END-EXEC.                                                    03078049
030790                                                                  03079049
032850                                                                  03285012
032900******************************************************************03290001
033000 LINKAGE SECTION.                                                 03300001
033100******************************************************************03310001
033200 01  LS-PULL-IN                           PIC  X(04).             03320017
033210 01  LS-PULL-NUMBER-OUT                   PIC S9(09) COMP.        03321021
033220 01  LS-MESSAGE-CODE                      PIC S9(04) COMP.        03322024
033500                                                                  03350001
033600 PROCEDURE DIVISION USING   LS-PULL-IN                            03360018
033610                          , LS-PULL-NUMBER-OUT                    03361021
033620                          , LS-MESSAGE-CODE.                      03362021
033900                                                                  03390001
034000******************************************************************03400001
034100 0000-MAINLINE.                                                   03410001
034121     EXEC SQL                                                     03412147
034122         SELECT FUNC_TXT                                          03412248
034123           INTO :PS-DISPLAY-SW                                    03412348
034124          FROM TKRPRPM                                            03412448
034125         WHERE SYS_PRC_FUNC_CDE = 'CECSSL'                        03412548
034133     END-EXEC.                                                    03413349
034140                                                                  03414032
034201     IF PS-DISPLAY-YES                                            03420132
034210         MOVE '0000-MAINLINE START' TO PV-PARAGRAPH-NAME          03421032
034220         MOVE '***STARTING PROGRAM***' TO PV-INFO-LINE            03422036
034300         PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           03430032
034400     END-IF.                                                      03440032
034601                                                                  03460144
034602*    EXEC SQL                                                     03460267
034603*        LOCK TABLE TCOCNTL IN EXCLUSIVE MODE                     03460367
034604*    END-EXEC.                                                    03460467
034602     EXEC SQL                                                     03460563
034603         LOCK TABLE CET_CNSTK_PL_CNTL IN EXCLUSIVE MODE           03460663
034604     END-EXEC.                                                    03460763
034607                                                                  03460844
034608     PERFORM 5000-GET-PULL.                                       03461053
034608*    PERFORM 7000-GET-PULL.                                       03461167
034609                                                                  03461253
034610     IF LS-MESSAGE-CODE = 0                                       03461353
034620         PERFORM 5001-UPDATE-PULL.                                03462067
034620*        PERFORM 7001-UPDATE-PULL.                                03463067
034700                                                                  03470001
034710     IF PS-DISPLAY-YES                                            03471032
034800         MOVE '0000-MAINLINE GOBACK' TO PV-PARAGRAPH-NAME         03480032
034810         MOVE '***ENDING PROGRAM***' TO PV-INFO-LINE              03481036
034900         PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           03490032
035000     END-IF.                                                      03500032
036400     GOBACK.                                                      03640001
036500                                                                  03650001
036600******************************************************************03651053
036700* SELECT THE NEXT AVAILABLE PULL NUMBER                           03652053
036710* AND ADD +1 TO IT                                                03653053
036800******************************************************************03654053
036900 5000-GET-PULL.                                                   03655053
037000                                                                  03656053
037400     EXEC SQL                                                     03659153
037500         SELECT  CNSTK_PL_NBR                                     03659253
037600           INTO  :CET00000-CNSTK-PL-NBR                           03659354
038200           FROM  CET_CNSTK_PL_CNTL                                03659454
038500     END-EXEC.                                                    03659753
038600                                                                  03659853
038700     EVALUATE TRUE                                                03659953
038800         WHEN SQLCODE = +0                                        03660053
038801              ADD 1                TO CET00000-CNSTK-PL-NBR       03660155
038810              MOVE SQLCODE TO LS-MESSAGE-CODE                     03660253
038820         WHEN SQLCODE = +100                                      03660353
038840         WHEN SQLCODE = -911                                      03660453
038850              MOVE SQLCODE TO LS-MESSAGE-CODE                     03660553
038860              PERFORM 9999-SQL-ABEND                              03660653
039100         WHEN OTHER                                               03660753
039110              MOVE SQLCODE TO LS-MESSAGE-CODE                     03660853
039300              PERFORM 9999-SQL-ABEND                              03660953
039400     END-EVALUATE.                                                03661053
039401     IF PS-DISPLAY-YES                                            03661153
039402         MOVE SQLCODE         TO PV-SQLCODE-OUT                   03661253
039403         STRING 'SQL CODE : '                  DELIMITED BY SIZE, 03661353
039404                PV-SQLCODE-OUT                 DELIMITED BY SIZE  03661453
039405                                      INTO PV-INFO-LINE           03661553
039408         MOVE '5000-GET-PULL    ' TO PV-PARAGRAPH-NAME            03661653
039410         PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           03661753
039420     END-IF.                                                      03661853
039500                                                                  03661953
543800******************************************************************03662057
543801* UPDATE WITH NEXT PULL NUMBER ON CET_CNSTK_PL_CNTL               03662167
543803******************************************************************03662257
543804 5001-UPDATE-PULL.                                                03662357
543805                                                                  03662457
543806     EXEC SQL                                                     03662557
543807         UPDATE  CET_CNSTK_PL_CNTL                                03662658
543808            SET  CNSTK_PL_NBR     = :CET00000-CNSTK-PL-NBR        03662758
543809          WHERE  CNSTK_PL_NBR + 1 = :CET00000-CNSTK-PL-NBR        03662858
543811     END-EXEC.                                                    03663057
543813                                                                  03663157
543814     EVALUATE TRUE                                                03663257
543815         WHEN SQLCODE = +0                                        03663357
543816              MOVE CET00000-CNSTK-PL-NBR TO LS-PULL-NUMBER-OUT    03663459
543819              EXEC SQL                                            03663557
543820                COMMIT                                            03663657
543821              END-EXEC                                            03663757
543826              MOVE SQLCODE TO LS-MESSAGE-CODE                     03663857
543827         WHEN SQLCODE = +100                                      03663957
543828         WHEN SQLCODE = -911                                      03664057
543829         WHEN SQLCODE = -551                                      03664157
543830              MOVE SQLCODE TO LS-MESSAGE-CODE                     03664257
543831              PERFORM 9999-SQL-ABEND                              03664357
543832         WHEN OTHER                                               03664457
543833              MOVE SQLCODE TO LS-MESSAGE-CODE                     03664557
543834              PERFORM 9999-SQL-ABEND                              03664657
543836     END-EVALUATE.                                                03664757
543837     IF PS-DISPLAY-YES                                            03664857
039402         MOVE SQLCODE         TO PV-SQLCODE-OUT                   03664966
543838         STRING 'SQL CODE : '                  DELIMITED BY SIZE, 03665057
543839                PV-SQLCODE-OUT                 DELIMITED BY SIZE  03665157
543840                                      INTO PV-INFO-LINE           03665257
543841         MOVE '5001-UPDATE-PULL ' TO PV-PARAGRAPH-NAME            03665359
543842         PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           03665457
543843     END-IF.                                                      03665557
543844                                                                  03665657
036600******************************************************************03666001
036700* SELECT THE NEXT AVAILABLE PULL NUMBER                           03670010
036710* AND ADD +1 TO IT                                                03671011
036800******************************************************************03680001
036900*7000-GET-PULL.                                                   03690067
037000                                                                  03700001
037100*    MOVE PC-90             TO  DK-CURR-OPER-UNT-ID.              03710067
037200*    MOVE PC-FCLTY-ID-0001  TO  DK-CURR-FCLTY-ID.                 03720067
037300                                                                  03730010
037400*    EXEC SQL                                                     03740067
037500*        SELECT  CNSTK_PL_NBR                                     03750067
037600*          INTO  :COCNTL-CNSTK-PL-NBR                             03760067
038200*          FROM  TCOCNTL                                          03820067
038300*         WHERE  OPER_UNT_ID = :DK-CURR-OPER-UNT-ID               03830067
038400*           AND  FCLTY_ID    = :DK-CURR-FCLTY-ID                  03840067
038500*    END-EXEC.                                                    03850067
038600                                                                  03860010
038700*    EVALUATE TRUE                                                03870067
038800*        WHEN SQLCODE = +0                                        03880067
038801*             ADD 1                TO COCNTL-CNSTK-PL-NBR         03880167
038810*             MOVE SQLCODE TO LS-MESSAGE-CODE                     03881067
038820*        WHEN SQLCODE = +100                                      03882067
038840*        WHEN SQLCODE = -911                                      03884067
038850*             MOVE SQLCODE TO LS-MESSAGE-CODE                     03885067
038860*             PERFORM 9999-SQL-ABEND                              03886067
039100*        WHEN OTHER                                               03910067
039110*             MOVE SQLCODE TO LS-MESSAGE-CODE                     03911067
039300*             PERFORM 9999-SQL-ABEND                              03930067
039400*    END-EVALUATE.                                                03940067
039401*    IF PS-DISPLAY-YES                                            03940167
039402*        MOVE SQLCODE         TO PV-SQLCODE-OUT                   03940267
039403*        STRING 'SQL CODE : '                  DELIMITED BY SIZE, 03940367
039404*               PV-SQLCODE-OUT                 DELIMITED BY SIZE  03940467
039405*                                     INTO PV-INFO-LINE           03940567
039408*        MOVE '7000-GET-PULL    ' TO PV-PARAGRAPH-NAME            03940867
039410*        PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           03941067
039420*    END-IF.                                                      03942067
039500                                                                  03950010
543800******************************************************************54380001
543801* UPDATE WITH NEXT PULL NUMBER ON TCOCNTL TABLE                   54380111
543803******************************************************************54380311
543804*7001-UPDATE-PULL.                                                54380467
543805                                                                  54380511
543806*    EXEC SQL                                                     54380667
543807*        UPDATE  TCOCNTL                                          54380767
543808*           SET  CNSTK_PL_NBR  = :COCNTL-CNSTK-PL-NBR             54380867
543809*         WHERE  OPER_UNT_ID   = :DK-CURR-OPER-UNT-ID             54380967
543810*           AND  FCLTY_ID      = :DK-CURR-FCLTY-ID                54381067
543811*    END-EXEC.                                                    54381167
543813                                                                  54381311
543814*    EVALUATE TRUE                                                54381467
543815*        WHEN SQLCODE = +0                                        54381567
543816*             MOVE COCNTL-CNSTK-PL-NBR TO LS-PULL-NUMBER-OUT      54381664
543819*             EXEC SQL                                            54381965
543820*               COMMIT                                            54382065
543821*             END-EXEC                                            54382165
543826*             MOVE SQLCODE TO LS-MESSAGE-CODE                     54382667
543827*        WHEN SQLCODE = +100                                      54382767
543828*        WHEN SQLCODE = -911                                      54382867
543829*        WHEN SQLCODE = -551                                      54382967
543830*             MOVE SQLCODE TO LS-MESSAGE-CODE                     54383067
543831*             PERFORM 9999-SQL-ABEND                              54383167
543832*        WHEN OTHER                                               54383267
543833*             MOVE SQLCODE TO LS-MESSAGE-CODE                     54383367
543834*             PERFORM 9999-SQL-ABEND                              54383467
543836*    END-EVALUATE.                                                54383667
543837*    IF PS-DISPLAY-YES                                            54383767
039402*        MOVE SQLCODE         TO PV-SQLCODE-OUT                   54383867
543838*        STRING 'SQL CODE : '                  DELIMITED BY SIZE, 54383967
543839*               PV-SQLCODE-OUT                 DELIMITED BY SIZE  54384067
543840*                                     INTO PV-INFO-LINE           54384167
543841*        MOVE '7001-UPDATE-PULL ' TO PV-PARAGRAPH-NAME            54384267
543842*        PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           54384367
543843*    END-IF.                                                      54384467
543844                                                                  54384530
543850 9900-DISPLAY-PARAMETERS.                                         54385027
543851                                                                  54385130
543852     EXEC SQL                                                     54385230
543853         SET :PV-DB2-TIMESTAMP      = CURRENT TIMESTAMP           54385330
543854     END-EXEC.                                                    54385430
543860                                                                  54386027
543861     DISPLAY ' '.                                                 54386133
543862     DISPLAY '** ' PC-PROGRAM-NAME ' INPUT PARAMETERS **'.        54386233
543863     DISPLAY '  PARAGRAPH      :  ' PV-PARAGRAPH-NAME.            54386333
543864     DISPLAY '  INFO LINE      :  ' PV-INFO-LINE.                 54386433
543865     DISPLAY '  TIMESTAMP      :  ' PV-DB2-TIMESTAMP.             54386533
543870     DISPLAY ' '.                                                 54387027
543890     DISPLAY '  PULL-IN        :  ' LS-PULL-IN.                   54389029
543900     DISPLAY '  PULL-NUMBER-OUT:  ' LS-PULL-NUMBER-OUT            54390029
544100     DISPLAY ' '.                                                 54410027
544410                                                                  54441027
544500 9900-EXIT.                                                       54450027
544600     EXIT.                                                        54460027
545000                                                                  54500027
545100******************************************************************54510001
545200* DISPLAYS THE SQL ERROR AND SETS SWITCH TO INDICATE ERROR        54520001
545300******************************************************************54530001
545400 9999-SQL-ABEND.                                                  54540001
545401     IF PS-DISPLAY-YES                                            54540132
545410         MOVE '9999-SQL-ABEND   ' TO PV-PARAGRAPH-NAME            54541032
545420         PERFORM 9900-DISPLAY-PARAMETERS THRU 9900-EXIT           54542032
545430     END-IF.                                                      54543032
545500                                                                  54550001
545600     DISPLAY 'CEKSP001 ABEND'                                     54560014
545800                                                                  54580001
546100     SET PS-ABEND                   TO TRUE.                      54610001
546200                                                                  54620001
547100******************************************************************54710001
547200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    54720001
547300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         54730001
547400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     54740001
547500* FORMAT.                                                         54750001
547600******************************************************************54760001
547700     COPY DPPD004.                                                54770001
547800                                                                  54780001
