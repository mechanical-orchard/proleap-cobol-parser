000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         SVKUT100.                                    00020000
000300 AUTHOR.             JOE GARDETTO.                                00030002
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       OCTOBER 2013.                                00050004
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900* THIS PROGRAM WILL PULL INFORMATION FROM THE stored value tables*00090000
001000* SVT_KOHLS_CRD_ACCT AND SVT_KOHLS_CRD_TXN BETWEEN THE           *00100000
001000* REQUEST DATE RANGE. IF THE CARD DOES NOT HAVE ACTIVITY WITHIN  *00101000
001200* THE DATE RANGE, THE CARD NUMBER WILL NOT BE WRITTEN TO THE     *00120000
001300* OUTPUT FILE.                                                   *00130000
001400******************************************************************00140000
001500******************************************************************00150000
001600* HISTORY LOG:                                                   *00160000
P42709* 08/26/13  PRB: 42709                                            00521000
P42709*           CRQ:                                                  00522000
P42709*           Program cloned from SVKUT026. Replaced input          00523000
P42709*           sequential files for tables SVT_KOHLS_CRD_TXN         00523100
P42709*           and SVT_KOHLS_CRD_ACCT with an SQL cursor to          00523200
P42709*           reduce processing time.                               00523300
003700******************************************************************00530000
003800                                                                  00540000
003900 ENVIRONMENT DIVISION.                                            00550000
004000                                                                  00560000
004100 CONFIGURATION SECTION.                                           00570000
004200                                                                  00580000
004300 SOURCE-COMPUTER.    IBM-3090.                                    00590000
004400 OBJECT-COMPUTER.    IBM-3090.                                    00600000
004500                                                                  00610000
004600 INPUT-OUTPUT SECTION.                                            00620000
004700                                                                  00630000
004800 FILE-CONTROL.                                                    00640000
004900                                                                  00650000
005000     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00660000
005300     SELECT UPDATED-CARD-FILE         ASSIGN TO OUT01.            00690000
005400                                                                  00700000
005500 DATA DIVISION.                                                   00710000
005600                                                                  00720000
005700 FILE SECTION.                                                    00730000
005800                                                                  00740000
005900 FD  CONTROL-DATE-FILE                                            00750000
006000     RECORDING MODE IS F                                          00760000
006100     BLOCK CONTAINS 0 RECORDS                                     00770000
006200     LABEL RECORDS ARE OMITTED.                                   00780000
006300 01  CONTROL-DATE-RECORD              PIC X(80).                  00790000
006400                                                                  00800000
007700 FD  UPDATED-CARD-FILE                                            00930000
007800     RECORDING MODE IS F                                          00940000
007900     BLOCK CONTAINS 0 RECORDS                                     00950000
008000     LABEL RECORDS ARE OMITTED.                                   00960000
008100 01  UPDATED-CARD-FILE-RECORD         PIC X(53).                  00970000
008200                                                                  00980000
008300 WORKING-STORAGE SECTION.                                         00990000
008400                                                                  01000000
008500 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.01010000
008600     88  ABEND-CONTROL-ERROR-4003                   VALUE +4003.  01020000
008700     88  ABEND-DATA-ERROR-4008                      VALUE +4008.  01030000
008800     88  ABEND-CALENDAR-ERROR-4019                  VALUE +4019.  01040000
008900                                                                  01050000
009000******************************************************************01060000
009100*    CR-CONTROL RECORD     FORMAT: CCYY-MM-DDCCYY-MM-DD         * 01070000
009200*    CCYY-MM-DD = STARTING DATE OF THE DATE RANGE                *01080000
009300*    CCYY-MM-DD = ENDING DATE OF THE DATE RANGE                  *01090000
009400******************************************************************01100000
009500 01  CR-CONTROL-RECORD.                                           01291000
009600     05  FILLER                       PIC X.                      01292000
009700     05  CR-CONTROL-BEG-DATE          PIC X(10).                  01293000
009700     05  CR-CONTROL-BEG-DATE-UNFMT REDEFINES CR-CONTROL-BEG-DATE. 01294000
009800         10  CR-BEG-CC                PIC  X(02).                 01295000
009900         10  CR-BEG-YY                PIC  X(02).                 01296000
010000         10  FILLER                   PIC  X(01).                 01297000
010100         10  CR-BEG-MM                PIC  X(02).                 01298000
010200         10  FILLER                   PIC  X(01).                 01299000
010300         10  CR-BEG-DD                PIC  X(02).                 01299100
010400     05  CR-CONTROL-END-DATE          PIC X(10).                  01299200
010400     05  CR-CONTROL-END-DATE-UNFMT REDEFINES CR-CONTROL-END-DATE. 01299300
010500         10  CR-END-CC                PIC  X(02).                 01299400
010600         10  CR-END-YY                PIC  X(02).                 01299500
010700         10  FILLER                   PIC  X(01).                 01299600
010800         10  CR-END-MM                PIC  X(02).                 01299700
010900         10  FILLER                   PIC  X(01).                 01299800
011000         10  CR-END-DD                PIC  X(02).                 01299900
011100     05  FILLER                       PIC  X(59).                 01300000
011200                                                                  01301000
011300******************************************************************01310000
011400*    PC-PROGRAM CONSTANTS                                        *01320000
011500******************************************************************01330000
011600 01  PC-PROGRAM-CONSTANTS.                                        01340000
011700     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        01350000
011800                                                    'SVKUT100'.   01360000
011900     05  PC-ONE                       PIC  S9(2)     VALUE +1     01370000
011900                                                     COMP.        01380000
011900                                                                  01390000
012000******************************************************************01400000
012100*       PROGRAM VARIABLES                                        *01410000
012200******************************************************************01420000
012300 01  PV-PROGRAM-VARIABLES.                                        01430000
012400     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01440000
012500     05  PV-OPERATION-MSG-1           PIC  X(40)     VALUE SPACE. 01450000
012600     05  PV-OPERATION-MSG-2           PIC  X(40)     VALUE SPACE. 01460000
012600     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01470000
                                                                        01471000
012700     05  PV-START-RANGE-TIMESTAMP-DET.                            01631000
012800         10  PV-START-RANGE-DATE      PIC  X(10).                 01632000
012900         10  FILLER                   PIC  X(01)     VALUE '-'.   01633000
013000         10  PV-START-RANGE-HH        PIC  X(02)     VALUE '03'.  01634000
013100         10  FILLER                   PIC  X(01)     VALUE '.'.   01635000
013200         10  PV-START-RANGE-MN        PIC  X(02)     VALUE '00'.  01636000
013300         10  FILLER                   PIC  X(01)     VALUE '.'.   01637000
013400         10  PV-START-RANGE-SS        PIC  X(02)     VALUE '00'.  01638000
013500         10  FILLER                   PIC  X(01)     VALUE '.'.   01639000
013600         10  PV-START-RANGE-TTTTTT    PIC  X(06)     VALUE        01639100
013700                                                     '000000'.    01639200
013800                                                                  01639300
013900     05  PV-START-RANGE-TIMESTAMP REDEFINES                       01639400
014000           PV-START-RANGE-TIMESTAMP-DET                           01639500
014100                                      PIC  X(26).                 01639600
014200                                                                  01639700
014300     05  PV-END-RANGE-TIMESTAMP-DET.                              01640000
014400         10  PV-END-RANGE-DATE        PIC  X(10).                 01650000
014500         10  FILLER                   PIC  X(01)     VALUE '-'.   01660000
014600         10  PV-END-RANGE-HH          PIC  X(02)     VALUE '02'.  01670000
014700         10  FILLER                   PIC  X(01)     VALUE '.'.   01680000
014800         10  PV-END-RANGE-MN          PIC  X(02)     VALUE '59'.  01690000
014900         10  FILLER                   PIC  X(01)     VALUE '.'.   01700000
015000         10  PV-END-RANGE-SS          PIC  X(02)     VALUE '59'.  01710000
015100         10  FILLER                   PIC  X(01)     VALUE '.'.   01720000
015200         10  PV-END-RANGE-TTTTTT      PIC  X(06)     VALUE        01730000
015300                                                     '999999'.    01740000
015500     05  PV-END-RANGE-TIMESTAMP     REDEFINES                     01740100
015600           PV-END-RANGE-TIMESTAMP-DET                             01740200
015700                                      PIC  X(26).                 01740300
016100     05  PV-TRN-PSTD-TMST.                                        01790000
016200         10  PV-TRN-PSTD-DATE         PIC  X(10).                 01800000
016300         10  FILLER                   PIC  X(16).                 01810000
016100                                                                  01820000
016200     05  PV-SAVE-CRD-NBR              PIC  9(12)      VALUE 0.    01830000
016300     05  PV-ISSUE-COUNT               PIC S9(03)      VALUE +0.   01840000
016300     05  PV-ADDON-COUNT               PIC S9(03)      VALUE +0.   01841000
           05  PV-APP-AUTH-AMT              PIC  S9(07)V9(02) COMP-3    01850000
                                                        VALUE ZEROES.   01860000
016300     05  PV-STORE-SUB                 PIC  9(04)  VALUE 0 COMP.   01870000
016300     05  PV-NUM-OF-STORES             PIC  9(04)  VALUE ZEROES.   01880000
           05  PV-ADDON-STR-NBR             PIC  S9(4) COMP.            01881100
           05  PV-ADDON-TRN-RVRSL-CDE       PIC  S9(1)V COMP-3.         01882000
           05  PV-ADDON-APP-AUTH-AMT        PIC  S9(7)V9(2) COMP-3.     01883000
           05  PV-ADDON-CRD-NBR             PIC  S9(12)V COMP-3.        01885000
           05  PV-ADDON-CRD-NBR-CSR         PIC  S9(12)V COMP-3.        01886000
           05  PV-ADDON-TRN-AUTH-TMST       PIC   X(26).                01888000
           05  PV-ADDON-TRN-PSTD-TMST       PIC   X(26).                01889000
016400                                                                  01890000
016500******************************************************************01900000
016600*    PS-PROGRAM SWITCHES                                         *01910000
016700******************************************************************01920000
016800 01  PS-PROGRAM-SWITCHES.                                         01930000
016900     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01)     VALUE 'N'.   01940000
017000         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   01950000
P42709     05  PS-END-OF-EXTRACT-CSR-SW     PIC  X(01)     VALUE 'N'.   01960000
P42709         88  PS-END-OF-EXTRACT-CSR                   VALUE 'Y'.   01970000
P42709     05  PS-END-OF-ADDON-CSR-SW       PIC  X(01)     VALUE 'N'.   01980000
P42709         88  PS-END-OF-ADDON-CSR                     VALUE 'Y'.   01990000
P42709         88  PS-NOT-END-OF-ADDON-CSR                 VALUE 'N'.   02000000
017800     05  PS-END-OF-STORE-CSR-SW       PIC  X(01)     VALUE 'N'.   02030000
017800         88  PS-END-OF-STORE-CSR                     VALUE 'Y'.   02040000
017800                                                                  02050000
017900******************************************************************02060000
018000*    PA-PROGRAM ACCUMULATORS                                     *02070000
018100******************************************************************02080000
018200 01  PA-PROGRAM-ACCUMULATORS.                                     02090000
018300     05  PA-NUM-OF-RECORDS-WRITTEN    PIC 9(9).                   02100000
018400     05  PA-STORE-TABLE.                                          02110000
018400         10  PA-STORE-ENTRY              OCCURS 9999 TIMES.       02120000
018400             15  PA-STORE-NUM     PIC S9(04)     COMP.            02130000
018400             15  PA-STORE-NAME    PIC  X(10).                     02140000
018400             15  PA-E-BUS-IND     PIC  X(01).                     02150000
018400                                                                  02160000
018400******************************************************************02170000
018400*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *02180000
018400******************************************************************02190000
018400     EXEC SQL                                                     02200000
018400         INCLUDE SQLCA                                            02210000
018400     END-EXEC.                                                    02220000
018400                                                                  02230000
018400     COPY SQLCA2.                                                 02240000
018400                                                                  02250000
018400******************************************************************02260000
018400*      KOHL'S DOMAIN LOCATION TABLE                             * 02270000
018400******************************************************************02280000
018400     EXEC SQL                                                     02290000
018400         INCLUDE XST00001                                         02300000
018400     END-EXEC.                                                    02310000
018400                                                                  02310100
P42709***************************************************************** 02311000
P42709*  DB2 TABLE SVT_CRD_PROD - STORED VALUE SYSTEM CARD              02312000
P42709***************************************************************** 02313000
P42709     EXEC SQL                                                     02314000
P42709          INCLUDE SVT00000                                        02315000
P42709     END-EXEC.                                                    02316000
P42709                                                                  02317000
P42709***************************************************************** 02318000
P42709*  DB2 TABLE SVT_KOHLS_CRD_ACCT - STORED VALUE SYSTEM CONTROL TBL 02319000
P42709***************************************************************** 02319100
P42709     EXEC SQL                                                     02319200
P42709          INCLUDE SVT00001                                        02319300
P42709     END-EXEC.                                                    02319400
P42709                                                                  02319500
P42709***************************************************************** 02319700
P42709*  DB2 TABLE DB2PDBA.SVT_KOHLS_CRD_TXN                            02319800
P42709*                  - KOHLS MERCHANDISE CARD ACTIVITY TABLE        02319900
P42709***************************************************************** 02320000
P42709     EXEC SQL                                                     02320200
P42709          INCLUDE SVT00002                                        02321000
P42709     END-EXEC.                                                    02322000
P42709                                                                  02322100
P42709***************************************************************** 02324100
P42709*  DB2 TABLE DB2PDBA.SVT_CRD_STK_DNMNTN                           02325000
P42709*                  - KOHLS CARD STOCK DENOMINATION                02326000
P42709***************************************************************** 02327100
P42709     EXEC SQL                                                     02328000
P42709          INCLUDE SVT00008                                        02329000
P42709     END-EXEC.                                                    02329100
028200*                                                                 02330000
019500******************************************************************02440000
019600*    OUTPUT RECORD                                               *02450000
019700******************************************************************02460000
019800     COPY SVRD010.                                                02470000
019900                                                                  02480000
020000******************************************************************02490000
020100*    STORED VALUE CARD CONSTANTS                                 *02500000
020200******************************************************************02510000
020300     COPY SVWS004.                                                02520000
020400                                                                  02530000
020500******************************************************************02540000
020600*    DATE ROUTINE COPY MEMBERS                                   *02550000
020700******************************************************************02560000
020800     COPY DPWS500.                                                02570000
020900                                                                  02580000
020900******************************************************************02590000
020900*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *02600000
020900******************************************************************02610000
020900     COPY DPWS004.                                                02620000
020900                                                                  02630000
020900******************************************************************02640000
020900*    CURSOR TO ACCESS STORES                                     *02650000
020900******************************************************************02660000
020900     EXEC SQL                                                     02670000
020900       DECLARE XST00001-CSR CURSOR FOR                            02680000
020900           SELECT LOC_NBR,                                        02690000
020900                  COALESCE(E_BUS_IND, 'N')                        02700000
020900             FROM XST_LOC                                         02710000
020900            WHERE LOC_TYP_CDE IN ('DS','SV','HQ')                 02720000
020900              AND CLO_DTE >= :CR-CONTROL-BEG-DATE                 02730000
020900              AND OPN_DTE <= :CR-CONTROL-END-DATE                 02740000
020900           ORDER BY LOC_NBR                                       02750000
020900           WITH UR                                                02760000
020900     END-EXEC.                                                    02770000
P42709******************************************************************02771100
P42709*  CURSOR USED TO RETRIEVE THE EXTRACT DATA.                      02772000
P42709******************************************************************02774000
P42709     EXEC SQL                                                     02775000
P42709       DECLARE EXTRACT-CSR CURSOR FOR                             02776000
P42709         SELECT A.CRD_TYP_CDE                                     02776300
P42709               ,E.CRD_NBR                                         02776400
P42709               ,E.STR_NBR                                         02776500
P42709               ,E.ACTVY_TYP_CDE                                   02776600
P42709               ,E.TRN_RVRSL_CDE                                   02776700
P42709               ,E.APP_AUTH_AMT                                    02776800
P42709               ,B.CRD_STK_TYP_ID                                  02777000
P42709               ,C.CRD_STK_TYP_DESC                                02777100
P42709               ,E.ACTVY_STAT_CDE                                  02777200
P42709               ,E.TRN_AUTH_TMST                                   02777300
P42709               ,E.TRN_PSTD_TMST                                   02777400
P42709          FROM  SVT_KOHLS_CRD_ACCT A                              02777500
P42709               ,SVT_CRD_PROD B                                    02777600
P42709               ,SVT_CRD_STK_DNMNTN C                              02777700
P42709               ,SVT_KOHLS_CRD_TXN E                               02777900
P42709         WHERE A.CRD_NBR = E.CRD_NBR                              02778500
P42709           AND A.CRD_PROD_YR = B.CRD_PROD_YR                      02778600
P42709           AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                  02778700
P42709           AND B.CRD_TYP_CDE = C.CRD_TYP_CDE                      02778800
P42709           AND B.CRD_STK_TYP_ID = C.CRD_STK_TYP_ID                02778900
P42709           AND B.PRE_DNNTD_CRD_AMT = C.PRE_DNNTD_CRD_AMT          02779000
P42709           AND NOT E.ACTVY_TYP_CDE = 4                            02779100
P42709           AND E.TRN_AUTH_TMST BETWEEN :PV-START-RANGE-TIMESTAMP  02779500
P42709                                    AND :PV-END-RANGE-TIMESTAMP   02779600
P42709         UNION                                                    02780400
P42709         SELECT A.CRD_TYP_CDE                                     02780500
P42709               ,E.CRD_NBR                                         02780600
P42709               ,E.STR_NBR                                         02780700
P42709               ,E.ACTVY_TYP_CDE                                   02780800
P42709               ,E.TRN_RVRSL_CDE                                   02780900
P42709               ,E.APP_AUTH_AMT                                    02781000
P42709               ,B.CRD_STK_TYP_ID                                  02781100
P42709               ,C.CRD_STK_TYP_DESC                                02781200
P42709               ,E.ACTVY_STAT_CDE                                  02781300
P42709               ,E.TRN_AUTH_TMST                                   02781400
P42709               ,E.TRN_PSTD_TMST                                   02781500
P42709         FROM  SVT_KOHLS_CRD_ACCT A                               02781600
P42709              ,SVT_CRD_PROD B                                     02781700
P42709              ,SVT_CRD_STK_DNMNTN C                               02781800
P42709              ,XST_LOC D                                          02781900
P42709              ,SVT_KOHLS_CRD_TXN E                                02782000
P42709         WHERE A.CRD_NBR = E.CRD_NBR                              02782600
P42709           AND A.CRD_PROD_YR = B.CRD_PROD_YR                      02782700
P42709           AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                  02782800
P42709           AND B.CRD_TYP_CDE = C.CRD_TYP_CDE                      02782900
P42709           AND B.CRD_STK_TYP_ID = C.CRD_STK_TYP_ID                02783000
P42709           AND B.PRE_DNNTD_CRD_AMT = C.PRE_DNNTD_CRD_AMT          02783100
P42709           AND NOT E.ACTVY_TYP_CDE = 4                            02783200
P42709           AND (DATE(E.TRN_PSTD_TMST)                             02784400
P42709                                BETWEEN :PV-START-RANGE-DATE      02784500
P42709                                    AND :PV-END-RANGE-DATE        02784600
P42709             OR DATE(E.TRN_PSTD_TMST) = '9999-09-09')             02784700
P42709           AND D.LOC_TYP_CDE IN ('DS','SV','HQ')                  02784800
P42709           AND D.OPN_DTE <= :PV-START-RANGE-DATE                  02784900
P42709           AND D.CLO_DTE >= :PV-END-RANGE-DATE                    02785000
P42709           AND E_BUS_IND = 'Y'                                    02785100
P42709           AND D.LOC_NBR = E.STR_NBR                              02785200
P42709         ORDER BY 2                                               02785300
P42709                 ,4                                               02785400
P42709                 ,10                                              02785500
P42709         WITH UR                                                  02785600
P42709     END-EXEC.                                                    02785700
P42709                                                                  02792100
P42709******************************************************************02812000
P42709*  CURSOR USED TO RETRIEVE CARD HISTORY FOR ADDONS                02812100
P42709******************************************************************02812200
P42709     EXEC SQL                                                     02812300
P42709       DECLARE ADDON-CT-CSR CURSOR FOR                            02812400
P42709         SELECT E.CRD_NBR                                         02812500
P42709               ,E.STR_NBR                                         02812600
P42709               ,E.TRN_RVRSL_CDE                                   02812800
P42709               ,E.APP_AUTH_AMT                                    02812900
P42709               ,E.TRN_AUTH_TMST                                   02813000
P42709               ,E.TRN_PSTD_TMST                                   02813100
P42709          FROM SVT_KOHLS_CRD_TXN E                                02813200
P42709         WHERE E.TRN_AUTH_TMST < :PV-START-RANGE-TIMESTAMP        02813400
P42709           AND DATE(E.TRN_PSTD_TMST) <> :PV-END-RANGE-DATE        02813500
P42709           AND E.ACTVY_TYP_CDE IN (1,2)                           02813600
P42709            AND E.CRD_NBR = :PV-ADDON-CRD-NBR-CSR                 02814200
P42709         ORDER BY E.CRD_NBR                                       02814300
P42709                 ,E.ACTVY_TYP_CDE                                 02814400
P42709                 ,E.TRN_AUTH_TMST                                 02815000
P42709         WITH UR                                                  02821900
P42709     END-EXEC.                                                    02822000
P42709                                                                  02826500
P42709                                                                  02830600
021000 PROCEDURE DIVISION.                                              02830700
021100                                                                  02830800
021200 0000-MAINLINE.                                                   02830900
021300                                                                  02831000
021400     PERFORM 1000-INITIALIZE.                                     02832000
021500                                                                  02840000
021600     PERFORM 2000-PROCESS-EXTRACT-RECORD                          02850000
P42709         UNTIL PS-END-OF-EXTRACT-CSR.                             02860000
021800                                                                  02870000
021900     PERFORM 9000-EOJ-ROUTINE.                                    02880000
022000                                                                  02890000
022100     GOBACK.                                                      02900000
022200                                                                  02910000
022300*0000-EXIT.                                                       02920000
022400                                                                  02930000
022500******************************************************************02940000
022600*     1000-INITIALIZE                                            *02950000
022700* ==> PROCESSES:                                                 *02960000
022800* ==> PERFORMED FROM:  0000-MAINLINE                             *02970000
022900******************************************************************02980000
023000 1000-INITIALIZE.                                                 02990000
023100                                                                  03000000
023200     OPEN INPUT  CONTROL-DATE-FILE                                03010000
023500          OUTPUT UPDATED-CARD-FILE.                               03040000
023600                                                                  03050000
023700     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                03060000
023800       AT END                                                     03070000
023900         SET PS-END-OF-CONTROL-FILE TO TRUE.                      03080000
024000                                                                  03090000
024100     IF PS-END-OF-CONTROL-FILE                                    03100000
024200       DISPLAY ' '                                                03110000
024300       DISPLAY '** ABEND     **'                                  03120000
024400       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              03130000
024500       DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '         03140000
024600       DISPLAY '** CONTROL DATE FILE IS EMPTY  '                  03150000
024700       SET ABEND-CONTROL-ERROR-4003 TO TRUE                       03160000
024800       PERFORM 9999-ABEND                                         03170000
024900     ELSE                                                         03180000
               MOVE CR-CONTROL-BEG-DATE TO PV-START-RANGE-DATE          03180100
               MOVE CR-CONTROL-END-DATE TO PV-END-RANGE-DATE            03180200
               DISPLAY ' '                                              03180300
               DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '               03180400
                       CR-CONTROL-BEG-DATE ' TO '                       03180500
                       CR-CONTROL-END-DATE                              03180600
025700     END-IF.                                                      03250000
025700                                                                  03260000
025800** VERIFY THE BEGINNING AND ENDING CONTROL DATES ARE VALID **     03270000
025900     INITIALIZE DPG51 DPG52 DPG53                                 03280000
026000                DPG54 DPG55 DPG56.                                03290000
026100                                                                  03300000
026200     SET DPG51-ACTUAL-CALENDAR-ONLY                               03310000
026300                                   TO TRUE.                       03320000
026400     MOVE CR-CONTROL-BEG-DATE      TO DPG52-LK-DATE-INPUT.        03330000
026500     MOVE CR-CONTROL-END-DATE      TO DPG53-LK-CMPR-DATE-INPUT.   03340000
026600     SET DPG52-LK-DTE-ISO-FMT      TO TRUE                        03350000
026700     SET DPG53-LK-CMPR-DTE-ISO-FMT TO TRUE                        03360000
026800                                                                  03370000
026900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03380000
027000                                             DPG54 DPG55 DPG56.   03390000
027100     EVALUATE TRUE                                                03400000
027200       WHEN DPG54-SEVERE-ERROR                                    03410000
027300       WHEN DPG54-DATE-INVALID                                    03420000
027400         DISPLAY ' '                                              03430000
027500         DISPLAY '** ABEND     **'                                03440000
027600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            03450000
027700         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             03460000
027800         DISPLAY '** BAD CALL TO CALENDAR MODULE '                03470000
027900         DISPLAY '** DETERMINE VALID DATES **'                    03480000
028000         DISPLAY DPG54-ERROR-MESSAGE                              03490000
028100         SET ABEND-CALENDAR-ERROR-4019 TO TRUE                    03500000
028200         PERFORM 9999-ABEND                                       03510000
028300     END-EVALUATE.                                                03520000
028400                                                                  03530000
028500** VERIFY THE BEGINNING DATE IS LESS THAN THE ENDING DATE **      03540000
028600     IF DPG55-DAYS-DIFFERENCE > 0                                 03550000
028700       DISPLAY ' '                                                03560000
028800       DISPLAY '** ABEND     **'                                  03570000
028900       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              03580000
029000       DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'               03590000
029100       DISPLAY '** THE BEGINNING DATE CAN NOT BE '                03600000
029200               'GREATER THAN THE ENDING DATE **'                  03610000
029300       SET ABEND-CONTROL-ERROR-4003 TO TRUE                       03620000
029400       PERFORM 9999-ABEND                                         03630000
029500     END-IF.                                                      03640000
025700                                                                  03641000
029600                                                                  03653000
029600*LOAD STORE TABLE                                                 03660000
029600     EXEC SQL                                                     03670000
029600       OPEN XST00001-CSR                                          03680000
029600     END-EXEC.                                                    03690000
029600     EVALUATE TRUE                                                03700000
029600       WHEN SQLCODE NOT = 0                                       03710000
029600         DISPLAY ' '                                              03720000
029600         DISPLAY '** ABEND     **'                                03730000
029600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            03740000
029600         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             03750000
029600         DISPLAY '** OPEN CURSOR TO XST00001 TABLE'               03760000
029600         PERFORM Z900-SQL-ABEND                                   03770000
029600     END-EVALUATE.                                                03780000
029600                                                                  03790000
029600     INITIALIZE PA-STORE-TABLE.                                   03800000
029600                                                                  03810000
029600     PERFORM 1100-FETCH-XST00001-CSR.                             03820000
029600                                                                  03830000
029600     PERFORM 1200-LOAD-STORE-TABLE                                03840000
029600       UNTIL PS-END-OF-STORE-CSR.                                 03850000
029600                                                                  03860000
029600     EXEC SQL                                                     03870000
029600       CLOSE XST00001-CSR                                         03880000
029600     END-EXEC.                                                    03890000
029600     EVALUATE TRUE                                                03900000
029600        WHEN SQLCODE NOT = 0                                      03910000
029600         DISPLAY ' '                                              03920000
029600         DISPLAY '** ABEND     **'                                03930000
029600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            03940000
029600         DISPLAY '** PARAGRAPH **  = 1000-initialize '            03950000
029600         DISPLAY '** CLOSE CURSOR TO XST00001 TABLE'              03960000
029600         PERFORM Z900-SQL-ABEND                                   03970000
029900     END-EVALUATE.                                                03980000
                                                                        03980100
P42709*    OPEN EXTRACT CURSOR FOR DAILY/WEEKLY RUN                     03982000
P42709     EXEC SQL                                                     03982100
P42709       OPEN EXTRACT-CSR                                           03983000
P42709     END-EXEC                                                     03984000
P42709     EVALUATE TRUE                                                03985000
P42709       WHEN SQLCODE NOT = 0                                       03986000
P42709         DISPLAY ' '                                              03987000
P42709         DISPLAY '** ABEND     **'                                03988000
P42709         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            03989000
P42709         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             03989100
P42709         DISPLAY '** OPEN CURSOR EXTRACT-CSR'                     03989200
P42709         PERFORM Z900-SQL-ABEND                                   03989300
P42709     END-EVALUATE.                                                03989400
P42709                                                                  03992000
P42709     PERFORM 4000-FETCH-EXTRACT-CSR.                              04000000
029900                                                                  04020000
030000*1000-EXIT.                                                       04030000
                                                                        04030100
030100******************************************************************04054000
030100* ==> PROCESSES:  FETCH THE STORE NUMBERS AND DESCRIPTION.       *04060000
030100******************************************************************04070000
030100 1100-FETCH-XST00001-CSR.                                         04080000
030100                                                                  04090000
030100     EXEC SQL                                                     04100000
030100       FETCH XST00001-CSR                                         04110000
030100         INTO  :XST00001-LOC-NBR,                                 04120000
030100               :XST00001-E-BUS-IND                                04130000
030100     END-EXEC.                                                    04140000
030100                                                                  04150000
030100     EVALUATE TRUE                                                04160000
030100        WHEN SQLCODE = +0                                         04170000
030100            CONTINUE                                              04180000
030100        WHEN SQLCODE = +100                                       04190000
030100           SET PS-END-OF-STORE-CSR TO TRUE                        04200000
030100        WHEN OTHER                                                04210000
030100         DISPLAY ' '                                              04220000
030100         DISPLAY '** ABEND     **'                                04230000
030100         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04240000
030100         DISPLAY '** PARAGRAPH **  = 1100-FETCH-XST000010-CSR'    04250000
030100         DISPLAY '** FETCHING STORE INFORMATION'                  04260000
030100         PERFORM Z900-SQL-ABEND                                   04270000
030100     END-EVALUATE.                                                04280000
030100                                                                  04290000
029900******************************************************************04300000
029900*     PROCESSES:  LOADS THE STORE NUMBERS AND DESCRIPTION.       *04310000
029900******************************************************************04320000
029900 1200-LOAD-STORE-TABLE.                                           04330000
029900                                                                  04340000
029900     MOVE XST00001-LOC-NBR    TO PV-STORE-SUB.                    04350000
029900     MOVE XST00001-LOC-NBR    TO PA-STORE-NUM(PV-STORE-SUB).      04360000
029900     MOVE XST00001-E-BUS-IND  TO PA-E-BUS-IND(PV-STORE-SUB).      04370000
030100                                                                  04380000
030100     ADD PC-ONE TO PV-NUM-OF-STORES.                              04390000
030100                                                                  04400000
030100     PERFORM 1100-FETCH-XST00001-CSR.                             04410000
030100                                                                  04420000
030200******************************************************************04430000
030300*     2000-PROCESS-EXTRACT-RECORD                                *04440000
030400* ==> PROCESSES:                                                 *04450000
030500* ==> PERFORMED FROM:  0000-MAINLINE                             *04460000
030600******************************************************************04470000
030700 2000-PROCESS-EXTRACT-RECORD.                                     04480000
030800                                                                  04491000
030900     PERFORM 6000-CONVERT-TRN-PSTD-TMST.                          04500000
                                                                        04510000
P42709     IF ((SVT00002-TRN-AUTH-TMST >= PV-START-RANGE-TIMESTAMP      04520000
P42709        AND SVT00002-TRN-AUTH-TMST <= PV-END-RANGE-TIMESTAMP)     04530000
P42709         OR (PA-E-BUS-IND(SVT00002-STR-NBR) = 'Y' AND             04540000
031300            (PV-TRN-PSTD-DATE >= PV-START-RANGE-DATE AND          04580000
031400             PV-TRN-PSTD-DATE < PV-END-RANGE-DATE)))              04590000
P42709        AND SVT00002-ACTVY-TYP-CDE NOT = SV004-SRV-FEE-ACT-TYP-N  04600000
031700         MOVE SVT00000-CRD-TYP-CDE      TO SV010-CRD-TYP-CDE      04600200
031800         MOVE SVT00000-CRD-STK-TYP-ID   TO SV010-CRD-STK-TYP-ID   04600300
032000         MOVE SVT00008-CRD-STK-TYP-DESC TO SV010-CRD-STK-TYP-DESC 04600400
P42709         MOVE SVT00002-CRD-NBR          TO SV010-CRD-NBR          04850000
034000                                           PV-SAVE-CRD-NBR        04860000
033900         MOVE SVT00002-APP-AUTH-AMT     TO PV-APP-AUTH-AMT        04870000
034100         MOVE SVT00002-STR-NBR          TO SV010-STR-NBR          04880000
P42709         MOVE SVT00002-ACTVY-TYP-CDE    TO SV010-ACTVY-TYP-CDE    04890000
P42709         IF SVT00002-ACTVY-TYP-CDE = 1 OR 2                       04900000
034400             MOVE PV-ISSUE-COUNT TO SV010-ADDON-COUNTER           04910000
034500         ELSE                                                     04920000
034600             MOVE ZERO TO SV010-ADDON-COUNTER                     04930000
034700         END-IF                                                   04940000
034800         MOVE SVT00002-TRN-RVRSL-CDE  TO SV010-TRN-RVRSL-CDE      04950000
034900         MOVE SVT00002-APP-AUTH-AMT   TO SV010-APP-AUTH-AMT       04960000
035000         MOVE SVT00002-ACTVY-STAT-CDE TO SV010-ACTVY-STAT-CDE     04970000
035100         WRITE UPDATED-CARD-FILE-RECORD FROM                      04980000
035200                                  SV010-RECORD                    04990000
035300         ADD 1                  TO PA-NUM-OF-RECORDS-WRITTEN      05000000
035400     END-IF.                                                      05010000
035500                                                                  05020000
P42709     MOVE SVT00002-CRD-NBR            TO PV-SAVE-CRD-NBR.         05030000
033900     MOVE SVT00002-APP-AUTH-AMT       TO PV-APP-AUTH-AMT.         05040000
                                                                        05051000
P42709     PERFORM 4000-FETCH-EXTRACT-CSR.                              05060000
035800                                                                  05070000
035900*2000-EXIT.                                                       05080000
                                                                        05080100
036000******************************************************************05090000
P42709*     4000-FETCH-EXTRACT-CSR                                     *05100000
036200* ==> PROCESSES:                                                 *05110000
036300*     - READS EXTRACT                                            *05120000
036400* ==> PERFORMED FROM:  2000-PROCESS-EXTRACT-RECORD               *05130000
036500******************************************************************05140000
P42709 4000-FETCH-EXTRACT-CSR.                                          05150000
P42709     EXEC SQL                                                     05181000
P42709       FETCH EXTRACT-CSR                                          05182000
P42709         INTO  :SVT00000-CRD-TYP-CDE,                             05184000
P42709               :SVT00002-CRD-NBR,                                 05184100
P42709               :SVT00002-STR-NBR,                                 05184200
P42709               :SVT00002-ACTVY-TYP-CDE,                           05184300
P42709               :SVT00002-TRN-RVRSL-CDE,                           05184400
P42709               :SVT00002-APP-AUTH-AMT,                            05184500
P42709               :SVT00000-CRD-STK-TYP-ID,                          05184800
P42709               :SVT00008-CRD-STK-TYP-DESC,                        05185000
P42709               :SVT00002-ACTVY-STAT-CDE,                          05185200
P42709               :SVT00002-TRN-AUTH-TMST,                           05185300
P42709               :SVT00002-TRN-PSTD-TMST                            05185400
P42709     END-EXEC.                                                    05186700
P42709     EVALUATE TRUE                                                05188000
P42709        WHEN SQLCODE = +0                                         05188100
P42709            CONTINUE                                              05189000
P42709        WHEN SQLCODE = +100                                       05189100
P42709           SET PS-END-OF-EXTRACT-CSR TO TRUE                      05189200
P42709        WHEN OTHER                                                05189400
P42709         DISPLAY ' '                                              05189500
P42709         DISPLAY '** ABEND     **'                                05189600
P42709         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05189700
P42709         DISPLAY '** PARAGRAPH **  = 4000-FETCH-EXTRACT-CSR'      05189800
P42709         DISPLAY '** FETCHING STORE INFORMATION'                  05189900
P42709         PERFORM Z900-SQL-ABEND                                   05190000
P42709     END-EVALUATE.                                                05190100
P42709                                                                  05195000
P42709     IF SVT00002-CRD-NBR NOT EQUAL PV-SAVE-CRD-NBR                05200000
037200        MOVE +0               TO PV-ISSUE-COUNT                   05210000
P42709        MOVE SVT00002-CRD-NBR TO PV-ADDON-CRD-NBR-CSR             05210100
              PERFORM 4100-CHECK-PREV-ACTIVIATIONS                      05212000
037300     END-IF.                                                      05221000
037400                                                                  05230000
P42709     IF SVT00002-CRD-NBR = PV-SAVE-CRD-NBR                        05240000
P42709        IF (SVT00002-ACTVY-TYP-CDE = 1 OR 2)                      05250000
P42709           IF (SVT00002-STR-NBR = SV004-INCOMM-LOCATION)          05260000
P42709              IF ((SVT00002-TRN-RVRSL-CDE = 0) AND                05270000
P42709                  (SVT00002-APP-AUTH-AMT  > 0) AND                05280000
                        (PV-APP-AUTH-AMT > 0))                          05290000
037700                 ADD +1 TO PV-ISSUE-COUNT                         05300000
                    END-IF                                              05310000
                 ELSE                                                   05320000
037700              ADD +1 TO PV-ISSUE-COUNT                            05330000
                 END-IF                                                 05340000
037800        END-IF                                                    05350000
037900     END-IF.                                                      05360000
038000                                                                  05370000
038100*4000-EXIT.                                                       05380000
                                                                        05381000
P42709******************************************************************05390000
P42709*     4100-CHECK-PREV-ACTIVIATIONS                               *05400000
P42709* ==> PROCESSES:                                                 *05410000
P42709*     - READS EXTRACT                                            *05420000
P42709* ==> PERFORMED FROM:  4000-FETCH-EXTRACT-CSR                    *05430000
P42709* THIS ROUTINE WILL CHECK FOR PREVIOUS ACTIVATIONS OF A CARD     *05440000
P42709* WHERE MONEY HAS BEEN ADDED ONTO THE CARD.                      *05450000
P42709******************************************************************05460000
P42709 4100-CHECK-PREV-ACTIVIATIONS.                                    05470000
P42709     SET PS-NOT-END-OF-ADDON-CSR TO TRUE.                         05480000
P42709     PERFORM 8000-OPEN-ADDON-CT-CSR.                              05490000
P42709     PERFORM 8010-FETCH-ADDON-CT-CSR.                             05500000
P42709     MOVE 0 TO PV-APP-AUTH-AMT.                                   05510000
P42709     MOVE 0 TO PV-SAVE-CRD-NBR.                                   05511000
P42709     PERFORM                                                      05520000
P42709         UNTIL PS-END-OF-ADDON-CSR                                05530000
P42709         IF PV-ADDON-TRN-AUTH-TMST >= SVT00002-TRN-AUTH-TMST      05530400
P42709            CONTINUE                                              05530500
P42709* ***  Do not count any activations equal to or greater than      05530600
P42709* ***  the current record being processed.  These will get        05530700
P42709* ***  counted in 4000-FETCH-EXTRACT-CSR if applicable.           05530800
P42709         ELSE                                                     05530900
P42709             IF PV-ADDON-CRD-NBR = PV-SAVE-CRD-NBR                05531000
P42709                 IF (PV-ADDON-STR-NBR = SV004-INCOMM-LOCATION)    05531100
P42709                    IF ((PV-ADDON-TRN-RVRSL-CDE = 0) AND          05531200
P42709                        (PV-ADDON-APP-AUTH-AMT  > 0) AND          05531300
P42709                        (PV-APP-AUTH-AMT > 0))                    05531400
P42709                       ADD +1 TO PV-ISSUE-COUNT                   05531500
P42709                    END-IF                                        05531600
P42709                 ELSE                                             05531700
P42709                    ADD +1 TO PV-ISSUE-COUNT                      05531800
P42709                 END-IF                                           05531900
P42709             END-IF                                               05532000
P42709             MOVE PV-ADDON-APP-AUTH-AMT TO PV-APP-AUTH-AMT        05532100
P42709             MOVE PV-ADDON-CRD-NBR      TO PV-SAVE-CRD-NBR        05532200
P42709         END-IF                                                   05533000
P42709         PERFORM 8010-FETCH-ADDON-CT-CSR                          05539900
P42709     END-PERFORM.                                                 05540000
P42709     PERFORM 8020-CLOSE-ADDON-CT-CSR.                             05540100
P42709*4100-EXIT.                                                       05540200
039700                                                                  05545000
039800******************************************************************05550000
039900* 6000-CONVERT-TRN-PSTD-TMST                                     *05560000
040000* ==> PROCESSES:                                                 *05570000
040100*     - SUBSTRACT 1 FROM TRN-PSTD-TMST                           *05580000
040200* ==> PERFORMED FROM:  2000-PROCESS-EXTRACT-RECORD               *05590000
040300******************************************************************05600000
040400 6000-CONVERT-TRN-PSTD-TMST.                                      05610000
040500                                                                  05620000
P42709     MOVE SVT00002-TRN-PSTD-TMST TO PV-TRN-PSTD-TMST.             05630000
040700     IF PV-TRN-PSTD-TMST = SV004-DEFAULT-TIMESTAMP                05640000
040800         CONTINUE                                                 05650000
040900     ELSE                                                         05660000
041000         INITIALIZE DPG51 DPG52 DPG53                             05670000
041100                    DPG54 DPG55 DPG56                             05680000
041200         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   05690000
041300         SET DPG51-DECREMENT-DATE    TO TRUE                      05700000
041400         MOVE 1      TO DPG51-INCR-DECR-DAYS-9                    05710000
041500         MOVE PV-TRN-PSTD-DATE       TO DPG52-LK-DATE-INPUT       05720000
041600         SET DPG52-LK-DTE-ISO-FMT    TO TRUE                      05730000
041700         CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG5305740000
041800                                                 DPG54 DPG55 DPG5605750000
041900         EVALUATE TRUE                                            05760000
042000         WHEN DPG54-SEVERE-ERROR                                  05770000
042100         WHEN DPG54-DATE-INVALID                                  05780000
042200             DISPLAY ' '                                          05790000
042300             DISPLAY '** ABEND     **'                            05800000
042400             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        05810000
042500             DISPLAY '** PARAGRAPH **  = B125-DATE-CONVERSION'    05820000
042600             DISPLAY '** BAD CALL TO CALENDAR MODULE '            05830000
042700             DISPLAY '** DETERMINE VALID ENDING DATE **'          05840000
042800             DISPLAY DPG54-ERROR-MESSAGE                          05850000
042900             SET ABEND-CALENDAR-ERROR-4019 TO TRUE                05860000
043000             PERFORM 9999-ABEND                                   05870000
043100         END-EVALUATE                                             05880000
043200                                                                  05890000
043300         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-TRN-PSTD-DATE          05900000
043400     END-IF.                                                      05910000
                                                                        05911000
      ******************************************************************05911100
      * 8000-OPEN-ADDON-CT-CSR                                         *05911200
      * ==> PROCESSES:                                                 *05911300
      *     - OPEN ADDON-CT-CSR                                        *05911400
      * ==> PERFORMED FROM:  4100-CHECK-PREV-ACTIVIATIONS              *05911500
      ******************************************************************05911600
       8000-OPEN-ADDON-CT-CSR.                                          05911700
           EXEC SQL                                                     05911800
             OPEN ADDON-CT-CSR                                          05911900
           END-EXEC.                                                    05912000
           EVALUATE TRUE                                                05912100
             WHEN SQLCODE NOT = 0                                       05912200
               DISPLAY ' '                                              05912300
               DISPLAY '** ABEND     **'                                05912400
               DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05912500
               DISPLAY '** PARAGRAPH **  = 8000-OPEN-ADDON-CT-CSR'      05912600
               DISPLAY '** OPEN CURSOR TO SVT_KOHLS_CRD_TXN TABLE'      05912700
               PERFORM Z900-SQL-ABEND                                   05912800
           END-EVALUATE.                                                05912900
                                                                        05913000
      ******************************************************************05913100
      * 8010-FETCH-ADDON-CT-CSR                                        *05913200
      * ==> PROCESSES:                                                 *05913300
      *     - FETCH ADDON-CT-CSR                                       *05913400
      * ==> PERFORMED FROM:  4100-CHECK-PREV-ACTIVIATIONS              *05913500
      ******************************************************************05913600
       8010-FETCH-ADDON-CT-CSR.                                         05914100
P42709     EXEC SQL                                                     05914200
P42709       FETCH ADDON-CT-CSR                                         05914300
P42709         INTO  :PV-ADDON-CRD-NBR,                                 05914400
P42709               :PV-ADDON-STR-NBR,                                 05914500
P42709               :PV-ADDON-TRN-RVRSL-CDE,                           05914700
P42709               :PV-ADDON-APP-AUTH-AMT,                            05914800
P42709               :PV-ADDON-TRN-AUTH-TMST,                           05914900
P42709               :PV-ADDON-TRN-PSTD-TMST                            05915000
P42709     END-EXEC.                                                    05915900
P42709     EVALUATE TRUE                                                05916000
P42709        WHEN SQLCODE = +0                                         05916100
P42709            CONTINUE                                              05916200
P42709        WHEN SQLCODE = +100                                       05916300
P42709           SET PS-END-OF-ADDON-CSR TO TRUE                        05916400
P42709        WHEN OTHER                                                05916500
P42709         DISPLAY ' '                                              05916600
P42709         DISPLAY '** ABEND     **'                                05916700
P42709         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05916800
P42709         DISPLAY '** PARAGRAPH **  = 8010-FETCH-ADDON-CT-CSR'     05916900
P42709         DISPLAY '** FETCHING ADDON INFORATMION'                  05917000
P42709         PERFORM Z900-SQL-ABEND                                   05917100
P42709     END-EVALUATE.                                                05917200
                                                                        05917400
      ******************************************************************05917500
      * 8020-CLOSE-ADDON-CT-CSR                                        *05917600
      * ==> PROCESSES:                                                 *05917700
      *     - CLOSE ADDON-CT-CSR                                       *05917800
      * ==> PERFORMED FROM:  4100-CHECK-PREV-ACTIVIATIONS              *05917900
      ******************************************************************05918000
       8020-CLOSE-ADDON-CT-CSR.                                         05918100
029600     EXEC SQL                                                     05918200
029600       CLOSE ADDON-CT-CSR                                         05918300
029600     END-EXEC.                                                    05918400
029600     EVALUATE TRUE                                                05918500
029600        WHEN SQLCODE NOT = 0                                      05918600
029600         DISPLAY ' '                                              05918700
029600         DISPLAY '** ABEND     **'                                05918800
029600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05918900
029600         DISPLAY '** PARAGRAPH **  = 8020-CLOSE-ADDON-CT-CSR'     05919000
029600         DISPLAY '** CLOSE CURSOR TO SVT_KOHLS_CRD_TXN TABLE'     05919100
029600         PERFORM Z900-SQL-ABEND                                   05919200
029900     END-EVALUATE.                                                05919300
                                                                        05919400
                                                                        05927400
043500******************************************************************05928000
043600*     9000-EOJ-ROUTINE                                           *05930000
043700* ==> PROCESSES:                                                 *05940000
043800*     - CLOSES THE CONTROL FILE, AND THE REPORT FILES            *05950000
043900* ==> PERFORMED FROM:  0000-MAINLINE                             *05960000
044000******************************************************************05970000
044100 9000-EOJ-ROUTINE.                                                05980000
044200                                                                  05990000
044300     CLOSE CONTROL-DATE-FILE                                      06000000
044600           UPDATED-CARD-FILE.                                     06030000
                                                                        06030100
P42709     EXEC SQL                                                     06041000
P42709       CLOSE EXTRACT-CSR                                          06042000
P42709     END-EXEC                                                     06043000
P42709     EVALUATE TRUE                                                06044000
P42709        WHEN SQLCODE NOT = 0                                      06045000
P42709         DISPLAY ' '                                              06046000
P42709         DISPLAY '** ABEND     **'                                06047000
P42709         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06048000
P42709         DISPLAY '** PARAGRAPH **  = 1000-initialize '            06049000
P42709         DISPLAY '** CLOSE EXTRACT-CSR TABLE'                     06049100
P42709         PERFORM Z900-SQL-ABEND                                   06049200
P42709     END-EVALUATE.                                                06049300
                                                                        06049500
044800     DISPLAY ' '.                                                 06050000
044900     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME              06060000
045000     DISPLAY 'NUMBER OF UPDATED RECORDS WRITTEN:   '              06070000
045100         PA-NUM-OF-RECORDS-WRITTEN.                               06080000
045200                                                                  06090000
045300*9000-EXIT.                                                       06100000
045400******************************************************************06110000
045500* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           06120000
045600******************************************************************06130000
045700 9999-ABEND.                                                      06140000
045800     DISPLAY '** ABEND           **'.                             06150000
045900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          06160000
046000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        06170000
046100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       06180000
046200     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       06190000
046300     CALL 'ILBOABN0' USING ABEND-CODE.                            06200000
045200******************************************************************06210000
045200*     Z900-SQL-ABEND                                             *06220000
045200* ==> PROCESSES:                                                 *06230000
045200*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *06240000
045200* ==> PERFORMED FROM:                                            *06250000
045200*                      E200-WRITE-DETAIL-LINE-KMRC               *06260000
045200*                      E500-WRITE-DETAIL-LINE-GIFT               *06270000
045200******************************************************************06280000
045200 Z900-SQL-ABEND.                                                  06290000
045200                                                                  06300000
045200     DISPLAY ' '.                                                 06310000
045200     DISPLAY 'Z900-SQL-ABEND'.                                    06320000
045200     DISPLAY '**  ABEND     **'.                                  06330000
045200     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               06340000
045200     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             06350000
045200     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    06360000
045200                                                                  06370000
045200******************************************************************06380000
045200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *06390000
045200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *06400000
045200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *06410000
045200* FORMAT.                                                        *06420000
045200******************************************************************06430000
045200     COPY DPPD004.                                                06440000
045200                                                                  06450000
045200     MOVE +4013 TO ABEND-CODE.                                    06460000
045200     CALL 'ILBOABN0' USING ABEND-CODE.                            06470000
045200                                                                  06480000
