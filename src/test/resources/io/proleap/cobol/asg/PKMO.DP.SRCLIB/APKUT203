000100 IDENTIFICATION DIVISION.                                         00010008
000200 PROGRAM-ID.     APKUT203.                                        00020008
000300 AUTHOR.         M WILKINSON.                                     00030008
000400*DATE-WRITTEN.   AUG  4, 1994.                                    00040008
000500*DATE-COMPILED.                                                   00050008
000600***************************************************************** 00060008
000700*    COBOL 2                                                    * 00070008
000800*                                                               * 00080008
000900*    PROD EDI AFP FORMAT REPORT PROGRAM.                        * 00090008
001000*                                                               * 00100008
001100*                                                               * 00110008
001200* INPUT:                                                        * 00120008
001300* 1.  AFP PRINT FORMAT FILE                                     * 00130008
001400*                                                               * 00140008
001500* OUTPUT:                                                       * 00150008
001600* 1.  AFP FINAL 'PAGE' PRINT FORMAT FILE                        * 00160008
001700*                                                               * 00170008
001800***************************************************************** 00180008
001900* CHANGE LOG:                                                   * 00190008
002000*                                                               * 00200008
002100* 08/04/94    INITIAL VERSION.                                  * 00210008
002200*                                                               * 00220008
002300* 09/06/94    BY MARILYN WILKINSON                              * 00230008
002400*             CHANGED LRECL OF INTERNAL STORAGE AREA FOR THE    * 00240008
002500*             07 RECORDS TO ACCOMODATE THE LARGER LRECL.        * 00250008
002600*                                                               * 00260008
002700* 09/17/97    BY MIKE BESKE            WR#3807                  * 00270008
002800*             ADDED CODE TO W210-TYPE-A-OR-E TO INDICATE IF     * 00280008
002900*             THE AFP HEADER RECORD IS A 'ONE PAGE INVOICE'     * 00290008
003000*             OR A 'NO DATA DESCRIPTION INVOICE'.               * 00300008
003100*                                                               * 00310008
003200* DATE  03/25/2003                                              * 00320008
003300*     CHANGE MADE: INCREASED SIZE OF WS-AFP-TABLE INTERNAL      * 00330009
003400*     TABLE TO ALLOW FOR PRODUCTION-LIKE INVOICE SIZES.         * 00340009
003500*     MADE BY: KEVIN CATLIN            WR/IR #: PM00535579      * 00350009
003600*                                                               * 00360008
003700*  DATE  05/05/2003                                             * 00370011
003800*      CHANGE MADE: CHANGE NEEDED FOR ARK PO NI-SKU.            * 00380012
003900*      REMOVED ALL REFERENCES FOR SKU.  REMOVED UNUSED WORKING  * 00390012
004000*      STORAGE FIELDS.                                          * 00400012
004100*      MADE BY: ROLLIN KRING            WR/IR #: WR22557        * 00410012
004200*                                                               * 00420012
004300* DATE  06/09/2004                                              * 00430012
004400*     CHANGED MADE: STORE CONSTRAINTS PROJECT                   * 00440012
004500*     RECOMPILED THIS PROGRAM TO PICK UP THE APRD055            * 00450012
004600*     COPYBOOK MODIFICATIONS.                                   * 00460012
004700*     MADE BY: MIKE BESKE              WR/IR #: WR25805         * 00470012
004800*                                                               * 00480012
004801* DATE  11/14/2014                                              * 00481013
004802*      RECOMPILED THE PROGRAM. CHANGES WERE MADE TO APRD055     * 00482013
004803*      COPYBOOK.                                                * 00483013
004804*      MADE BY: COGNIZANT              WR/IR: CHG0094517        * 00484013
004900***************************************************************** 00490008
005000                                                                  00500008
005100 ENVIRONMENT DIVISION.                                            00510008
005200                                                                  00520008
005300 INPUT-OUTPUT SECTION.                                            00530008
005400                                                                  00540008
005500 FILE-CONTROL.                                                    00550008
005600                                                                  00560008
005700     SELECT AFPIN-AP055-FILE                                      00570008
005800         ASSIGN         TO UT-S-INP01.                            00580008
005900     SELECT AFPOUT-AP055-FILE                                     00590008
006000         ASSIGN         TO UT-S-OUT01.                            00600008
006100                                                                  00610008
006200 DATA DIVISION.                                                   00620008
006300                                                                  00630008
006400 FILE SECTION.                                                    00640008
006500                                                                  00650008
006600 FD  AFPIN-AP055-FILE                                             00660008
006700         LABEL RECORDS  ARE STANDARD                              00670008
006800         RECORDING MODE IS  F                                     00680008
006900         DATA RECORD    IS  AFPIN-AP055-RECORD.                   00690008
007000                                                                  00700008
007100 01  AFPIN-AP055-RECORD            PIC X(800).                    00710008
007200                                                                  00720008
007300 FD  AFPOUT-AP055-FILE                                            00730008
007400         LABEL RECORDS  ARE STANDARD                              00740008
007500         RECORDING MODE IS  F                                     00750008
007600         DATA RECORD    IS  AFPOUT-AP055-RECORD.                  00760008
007700                                                                  00770008
007800 01  AFPOUT-AP055-RECORD           PIC X(800).                    00780008
007900                                                                  00790008
008000/                                                                 00800008
008100 WORKING-STORAGE SECTION.                                         00810008
008200                                                                  00820008
008300 01  FILLER                        PIC X(25) VALUE                00830008
008400                             'WS FOR APKUT203 BEGINS==>'.         00840008
008500 01  WS-DISPLAY-COUNTER            PIC 9(07) VALUE ZEROS.         00850008
008600                                                                  00860008
008700 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00870008
008800                                             VALUE ZEROS.         00880008
008900     88 AP-TABLE-FULL              VALUE +4004.                   00890008
009000     88 AP-EMPTY-FILE              VALUE +4005.                   00900008
009100                                                                  00910008
009200 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     00920008
009300 01  WS-ABEND-FILEDS.                                             00930008
009400     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT203'. 00940008
009500     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00950008
009600     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00960008
009700     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00970008
009800     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00980008
009900     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     00990008
010000     05  WS-ABEND-SSA-1               PIC X(50) VALUE SPACES.     01000008
010100     05  WS-ABEND-SSA-2               PIC X(50) VALUE SPACES.     01010008
010200     05  WS-ABEND-SSA-3               PIC X(50) VALUE SPACES.     01020008
010300     05  WS-ABEND-SSA-4               PIC X(50) VALUE SPACES.     01030008
010400                                                                  01040008
010500 01  ALLW-INDX                     PIC S9(4) COMP VALUE ZERO.     01050008
010600                                                                  01060008
010700 01  WS-WORK-AREA.                                                01070008
010800     05  WS-EDITTED-PAGE-NO      PIC ZZZZ9.                       01080008
010900                                                                  01090008
011000     05  WS-ITEM-SEQ             PIC 9(03)  VALUE ZEROS.          01100008
011100     05  WS-PAGE-NO              PIC 9(05)  VALUE ZEROS.          01110008
011200                                                                  01120008
011300     05  WS-SAVE-INVOICE-NBR     PIC X(22)  VALUE SPACES.         01130008
011400     05  WS-SAVE-INVOICE-NBR-X   REDEFINES WS-SAVE-INVOICE-NBR.   01140008
011500         10  WS-1-BYTE-AREA      OCCURS 22 TIMES                  01150008
011600                                 INDEXED BY 1-INDX.               01160008
011700             15  WS-1-BYTE       PIC X(01).                       01170008
011800                                                                  01180008
011900*                                                                 01190008
012000 01  WS-PROGRAM-COUNTERS.                                         01200008
012100     05  WS-AFPIN-REC-CNT        PIC 9(9)  VALUE ZEROS.           01210008
012200     05  WS-AFPOUT-REC-CNT       PIC 9(9)  VALUE ZEROS.           01220008
012300                                                                  01230008
012400 01  WS-SWITCHES.                                                 01240008
012500     05  END-OF-EDIIN-SW         PIC X(01) VALUE 'N'.             01250008
012600         88  END-OF-EDIIN                  VALUE 'Y'.             01260008
012700                                                                  01270008
012800 01  WS-TABLE-AREA.                                               01280008
012900     05  WS-AFP-TABLE            OCCURS 11000 TIMES               01290010
013000                                 INDEXED BY AFP-INDX.             01300008
013100         10  WS-AFP-REC.                                          01310008
013200             15  WS-AP055-PAGE-TYPE      PIC X(01).               01320008
013300             15  WS-AP055-REC-TYPE       PIC X(01).               01330008
013400             15  WS-AP055-IND-CODE       PIC X(03).               01340008
013500             15  WS-DATA-AREA            PIC X(795).              01350008
013600                                                                  01360008
013700 01  RUN-TIME.                                                    01370008
013800     05  R-HR                    PIC 99.                          01380008
013900     05  R-MIN                   PIC 99.                          01390008
014000     05  R-SEC                   PIC 99.                          01400008
014100     05  R-TH                    PIC 99.                          01410008
014200*                                                                 01420008
014300 01  DATE-IN.                                                     01430008
014400     05 DATE-IN-YY               PIC XX.                          01440008
014500     05 DATE-IN-MM               PIC XX.                          01450008
014600     05 DATE-IN-DD               PIC XX.                          01460008
014700                                                                  01470008
014800 01  WS-JULIAN-DATE              PIC 9(05)  VALUE ZEROS.          01480008
014900/                                                                 01490008
015000*                                                                 01500008
015100******************************************************************01510008
015200 01  FILLER                      PIC X(35)  VALUE                 01520008
015300     'BEGINNING OF AP055 INPUT FILE    **'.                       01530008
015400 01  AP055-AFP-IN-FILE.                                           01540008
015500     COPY APRD055.                                                01550008
015600/                                                                 01560008
015700*                                                                 01570008
015800******************************************************************01580008
015900 01  FILLER                      PIC X(35)  VALUE                 01590008
016000     'BEGINNING OF AP055 OUTPUT FILE   **'.                       01600008
016100 01  WS-WORK-REC.                                                 01610008
016200     COPY APRD055.                                                01620008
016300                                                                  01630008
016400 01  WS-SAVE-AFP-HEADER.                                          01640008
016500     COPY APRD055.                                                01650008
016600                                                                  01660008
016700******************************************************************01670008
016800 01  FILLER                        PIC X(25) VALUE                01680008
016900          '<====WS FOR APKUT203 ENDS'.                            01690008
017000******************************************************************01700008
017100*                                                                 01710008
017200*                                                                 01720008
017300******************************************************************01730008
017400*LINKAGE SECTION.                                                 01740008
017500******************************************************************01750008
017600*                                                                 01760008
017700 PROCEDURE DIVISION.                                              01770008
017800                                                                  01780008
017900 A100-MAINLINE.                                                   01790008
018000                                                                  01800008
018100     PERFORM H100-HOUSEKEEPING.                                   01810008
018200     PERFORM R100-READ-AP055.                                     01820008
018300     IF   END-OF-EDIIN                                            01830008
018400          DISPLAY '**********************************'            01840008
018500          DISPLAY '*   EMPTY EDI INVOICE FILE       *'            01850008
018600          DISPLAY '*   PROGRAM ** = APKUT203        *'            01860008
018700          DISPLAY '**********************************'            01870008
018800     ELSE                                                         01880008
018900        MOVE AP055-SORT-INVOICE-NBR   OF AP055-AFP-IN-FILE        01890008
019000                                      TO WS-SAVE-INVOICE-NBR      01900008
019100        PERFORM B100-PROCESSING                                   01910008
019200                     UNTIL END-OF-EDIIN                           01920008
019300        MOVE 0 TO WS-ITEM-SEQ                                     01930008
019400        MOVE 0 TO ALLW-INDX                                       01940008
019500        PERFORM W200-WRITE-AFP.                                   01950008
019600                                                                  01960008
019700     PERFORM Z900-END-OF-JOB.                                     01970008
019800                                                                  01980008
019900     GOBACK.                                                      01990008
020000        EJECT                                                     02000008
020100                                                                  02010008
020200 B100-PROCESSING.                                                 02020008
020300*                                                                 02030008
020400***************************************************************** 02040008
020500*     PROCESS EDI VALID TRANSMISSIONS AND FORMAT INTO THE AFP     02050008
020600*     OUTPUT RECORD FORMAT.                                       02060008
020700***************************************************************** 02070008
020800*                                                                 02080008
020900     IF AP055-SORT-INVOICE-NBR   OF AP055-AFP-IN-FILE NOT =       02090008
021000                                       WS-SAVE-INVOICE-NBR        02100008
021100        MOVE 0 TO WS-ITEM-SEQ                                     02110008
021200        MOVE 0 TO ALLW-INDX                                       02120008
021300        PERFORM W200-WRITE-AFP                                    02130008
021400        MOVE AP055-SORT-INVOICE-NBR   OF AP055-AFP-IN-FILE        02140008
021500                              TO WS-SAVE-INVOICE-NBR              02150008
021600        PERFORM H200-INITIALIZE.                                  02160008
021700                                                                  02170008
021800***************                                                   02180008
021900*   LOOK FOR MAXIMUM NUMBER OF INVOICES.  THE TABLE WILL ONLY     02190008
022000*   HOLD 998 - EVEN THOUGH IT IS SET UP AT 1000 BECAUSE ONE       02200008
022100*   OCCURANCE HAS TO BE HELD INCASE AN ALLOWANCE RECORD HAS TO    02210008
022200*   BE GENERATED WITH DATA FROM THE TPURCHS/TPOAGMT TABLES AND    02220008
022300*   ANOTHER OCCURANCE IS SET ASIDE FOR REPORTING ON ERRORS THAT   02230008
022400*   ARE FOR THE INVOICE AS A WHOLE                                02240008
022500***************                                                   02250008
022600                                                                  02260008
022700     IF AFP-INDX >= 10998                                         02270010
022800        DISPLAY '************** ABEND *************'              02280008
022900        DISPLAY '*  INVOICE TABLE IS FULL -       *'              02290010
023000        DISPLAY '*  10999 RECORDS HAVE BEEN FOUND *'              02300010
023100        DISPLAY '*  FOR ONE INVOICE NUMBER        *'              02310010
023200        DISPLAY '*' WS-SAVE-INVOICE-NBR        '  *'              02320010
023300        DISPLAY '*  PROGRAM ** = APKUT203         *'              02330010
023400        DISPLAY '*  PARAGRAPH  = B100-PROCESSING  *'              02340010
023500        DISPLAY '**********************************'              02350008
023600        SET AP-TABLE-FULL TO TRUE                                 02360008
023700        CALL 'ILBOABN0' USING ABEND-CODE                          02370008
023800     ELSE                                                         02380008
023900        EVALUATE AP055-REC-TYPE OF AP055-AFP-IN-FILE              02390008
024000           WHEN '1'                                               02400008
024100              MOVE AP055-AFP-IN-FILE TO WS-SAVE-AFP-HEADER        02410008
024200           WHEN '2'                                               02420008
024300              SET AFP-INDX UP BY 1                                02430008
024400              MOVE AP055-AFP-IN-FILE TO WS-AFP-REC(AFP-INDX)      02440008
024500        END-EVALUATE.                                             02450008
024600                                                                  02460008
024700     PERFORM R100-READ-AP055.                                     02470008
024800                                                                  02480008
024900 H100-HOUSEKEEPING.                                               02490008
025000*                                                                 02500008
025100***************************************************************** 02510008
025200*    GET DATE, TIME, OPEN FILES, SET UP CONTROLS, ETC             02520008
025300***************************************************************** 02530008
025400*                                                                 02540008
025500     ACCEPT RUN-TIME FROM TIME.                                   02550008
025600     ACCEPT DATE-IN  FROM DATE.                                   02560008
025700     ACCEPT WS-JULIAN-DATE FROM DAY.                              02570008
025800                                                                  02580008
025900     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    02590008
026000                                                                  02600008
026100     OPEN  INPUT   AFPIN-AP055-FILE                               02610008
026200           OUTPUT  AFPOUT-AP055-FILE.                             02620008
026300                                                                  02630008
026400     PERFORM H200-INITIALIZE.                                     02640008
026500                                                                  02650008
026600 H200-INITIALIZE.                                                 02660008
026700*                                                                 02670008
026800***************************************************************** 02680008
026900*     INITIALIZE THE TABLE THAT WILL HOLD THE ENTIRE INVOICE      02690008
027000***************************************************************** 02700008
027100*                                                                 02710008
027200     PERFORM VARYING AFP-INDX FROM 1 BY 1                         02720008
027300        UNTIL AFP-INDX > 11000                                    02730010
027400        INITIALIZE WS-AFP-REC(AFP-INDX)                           02740008
027500        MOVE HIGH-VALUES TO WS-AP055-PAGE-TYPE(AFP-INDX)          02750008
027600                            WS-AP055-REC-TYPE(AFP-INDX)           02760008
027700                            WS-AP055-IND-CODE(AFP-INDX)           02770008
027800     END-PERFORM.                                                 02780008
027900                                                                  02790008
028000     SET AFP-INDX TO 1.                                           02800008
028100     SET AFP-INDX DOWN BY 1.                                      02810008
028200                                                                  02820008
028300 R100-READ-AP055.                                                 02830008
028400*                                                                 02840008
028500***************************************************************** 02850008
028600*     READ THE AFP FILE INTO WORKING STORAGE COPYBOOK             02860008
028700***************************************************************** 02870008
028800*                                                                 02880008
028900     READ AFPIN-AP055-FILE INTO AP055-AFP-IN-FILE                 02890008
029000          AT END      SET END-OF-EDIIN TO TRUE.                   02900008
029100                                                                  02910008
029200                                                                  02920008
029300     IF NOT END-OF-EDIIN                                          02930008
029400        ADD 1 TO WS-AFPIN-REC-CNT.                                02940008
029500                                                                  02950008
029600 W200-WRITE-AFP.                                                  02960008
029700*                                                                 02970008
029800***************************************************************** 02980008
029900*     WRITE OUT RECORDS TO PRODUCE A FORMATTED INVOICE            02990008
030000*     FOR 'PAPER' COPY                                            03000008
030100***************************************************************** 03010008
030200*                                                                 03020008
030300     MOVE SPACES TO WS-WORK-REC.                                  03030008
030400                                                                  03040008
030500     MOVE 1 TO WS-PAGE-NO.                                        03050008
030600     IF AP055-REC-07-CNT OF WS-SAVE-AFP-HEADER <= 8               03060008
030700        PERFORM W210-TYPE-A-OR-E                                  03070008
030800        PERFORM VARYING AFP-INDX FROM 1 BY 1                      03080008
030900          UNTIL AFP-INDX > 11000 OR                               03090010
031000             WS-AP055-REC-TYPE(AFP-INDX) = HIGH-VALUES            03100008
031100             PERFORM W290-MOVE-AFP-DETAIL                         03110008
031200        END-PERFORM                                               03120008
031300     ELSE                                                         03130008
031400        SET AFP-INDX TO 1                                         03140008
031500        IF AP055-REC-07-CNT OF WS-SAVE-AFP-HEADER <= 19           03150008
031600           PERFORM W220-TYPE-B                                    03160008
031700           ADD 1 TO WS-PAGE-NO                                    03170008
031800           PERFORM W240-TYPE-D                                    03180008
031900        ELSE                                                      03190008
032000           PERFORM W220-TYPE-B                                    03200008
032100           PERFORM UNTIL                                          03210008
032200              (AP055-REC-07-CNT OF WS-SAVE-AFP-HEADER             03220008
032300                                     - WS-ITEM-SEQ  < 12)   OR    03230008
032400                                                                  03240008
032500              WS-AP055-REC-TYPE(AFP-INDX) = HIGH-VALUES           03250008
032600              PERFORM W230-TYPE-C                                 03260008
032700           END-PERFORM                                            03270008
032800           ADD 1 TO WS-PAGE-NO                                    03280008
032900           PERFORM W240-TYPE-D                                    03290008
033000        END-IF                                                    03300008
033100     END-IF.                                                      03310008
033200                                                                  03320008
033300 W210-TYPE-A-OR-E.                                                03330008
033400                                                                  03340008
033500     IF AP055-IND-CODE OF WS-SAVE-AFP-HEADER = 'NDD'              03350008
033600        MOVE 'E' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER         03360008
033700     ELSE                                                         03370008
033800        MOVE 'A' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER         03380008
033900     END-IF.                                                      03390008
034000                                                                  03400008
034100     MOVE  WS-PAGE-NO TO WS-EDITTED-PAGE-NO.                      03410008
034200                                                                  03420008
034300     MOVE  WS-EDITTED-PAGE-NO TO                                  03430008
034400                      AP055-PAGE-NO      OF WS-SAVE-AFP-HEADER    03440008
034500                      AP055-SORT-PAGE-NO OF WS-SAVE-AFP-HEADER.   03450008
034600                                                                  03460008
034700     WRITE AFPOUT-AP055-RECORD FROM WS-SAVE-AFP-HEADER            03470008
034800           AFTER ADVANCING PAGE.                                  03480008
034900     ADD 1 TO WS-AFPOUT-REC-CNT.                                  03490008
035000                                                                  03500008
035100 W220-TYPE-B.                                                     03510008
035200                                                                  03520008
035300     MOVE 'B' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER.           03530008
035400                                                                  03540008
035500     MOVE  WS-PAGE-NO TO WS-EDITTED-PAGE-NO.                      03550008
035600                                                                  03560008
035700     MOVE  WS-EDITTED-PAGE-NO TO                                  03570008
035800                   AP055-PAGE-NO        OF WS-SAVE-AFP-HEADER     03580008
035900                   AP055-SORT-PAGE-NO   OF WS-SAVE-AFP-HEADER.    03590008
036000                                                                  03600008
036100     WRITE AFPOUT-AP055-RECORD FROM WS-SAVE-AFP-HEADER            03610008
036200           AFTER ADVANCING PAGE.                                  03620008
036300     ADD 1 TO WS-AFPOUT-REC-CNT.                                  03630008
036400                                                                  03640008
036500     PERFORM UNTIL WS-ITEM-SEQ = 8  OR                            03650008
036600          WS-AP055-REC-TYPE(AFP-INDX) = HIGH-VALUES               03660008
036700        PERFORM W290-MOVE-AFP-DETAIL                              03670008
036800        SET AFP-INDX UP BY 1                                      03680008
036900     END-PERFORM.                                                 03690008
037000                                                                  03700008
037100 W230-TYPE-C.                                                     03710008
037200                                                                  03720008
037300     ADD 1 TO WS-PAGE-NO.                                         03730008
037400     MOVE 'C' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER.           03740008
037500                                                                  03750008
037600     MOVE  WS-PAGE-NO TO WS-EDITTED-PAGE-NO.                      03760008
037700     MOVE  WS-EDITTED-PAGE-NO TO                                  03770008
037800                   AP055-PAGE-NO        OF WS-SAVE-AFP-HEADER     03780008
037900                   AP055-SORT-PAGE-NO   OF WS-SAVE-AFP-HEADER.    03790008
038000                                                                  03800008
038100     WRITE AFPOUT-AP055-RECORD FROM WS-SAVE-AFP-HEADER            03810008
038200           AFTER ADVANCING PAGE.                                  03820008
038300     ADD 1 TO WS-AFPOUT-REC-CNT.                                  03830008
038400                                                                  03840008
038500     PERFORM 11 TIMES                                             03850008
038600        PERFORM W290-MOVE-AFP-DETAIL                              03860008
038700        SET AFP-INDX UP BY 1                                      03870008
038800     END-PERFORM.                                                 03880008
038900                                                                  03890008
039000 W240-TYPE-D.                                                     03900008
039100                                                                  03910008
039200     MOVE 'D' TO AP055-PAGE-TYPE OF WS-SAVE-AFP-HEADER.           03920008
039300     MOVE  WS-PAGE-NO TO WS-EDITTED-PAGE-NO.                      03930008
039400     MOVE  WS-EDITTED-PAGE-NO TO                                  03940008
039500                   AP055-PAGE-NO        OF WS-SAVE-AFP-HEADER     03950008
039600                   AP055-SORT-PAGE-NO   OF WS-SAVE-AFP-HEADER.    03960008
039700                                                                  03970008
039800     WRITE AFPOUT-AP055-RECORD FROM WS-SAVE-AFP-HEADER            03980008
039900           AFTER ADVANCING PAGE.                                  03990008
040000     ADD 1 TO WS-AFPOUT-REC-CNT.                                  04000008
040100                                                                  04010008
040200     PERFORM UNTIL                                                04020008
040300        WS-AP055-REC-TYPE(AFP-INDX) = HIGH-VALUES                 04030008
040400        PERFORM W290-MOVE-AFP-DETAIL                              04040008
040500        SET AFP-INDX UP BY 1                                      04050008
040600     END-PERFORM.                                                 04060008
040700                                                                  04070008
040800 W290-MOVE-AFP-DETAIL.                                            04080008
040900                                                                  04090008
041000     MOVE WS-AFP-REC(AFP-INDX) TO WS-WORK-REC.                    04100008
041100                                                                  04110008
041200     ADD 1 TO WS-ITEM-SEQ.                                        04120008
041300     MOVE WS-ITEM-SEQ TO AP055-ITEM-SEQ OF WS-WORK-REC            04130008
041400                         AP055-SORT-ITEM-SEQ OF WS-WORK-REC.      04140008
041500     MOVE  WS-PAGE-NO TO WS-EDITTED-PAGE-NO.                      04150008
041600     MOVE  WS-EDITTED-PAGE-NO TO                                  04160008
041700              AP055-SORT-PAGE-NO OF WS-WORK-REC.                  04170008
041800                                                                  04180008
041900     WRITE AFPOUT-AP055-RECORD FROM WS-WORK-REC                   04190008
042000             AFTER ADVANCING 1 LINE.                              04200008
042100     ADD 1 TO WS-AFPOUT-REC-CNT.                                  04210008
042200                                                                  04220008
042300                                                                  04230008
042400 Z900-END-OF-JOB.                                                 04240008
042500*                                                                 04250008
042600***************************************************************** 04260008
042700*     FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS,       04270008
042800*     AND CLOSE ALL FILES                                         04280008
042900***************************************************************** 04290008
043000*                                                                 04300008
043100     CLOSE AFPIN-AP055-FILE                                       04310008
043200           AFPOUT-AP055-FILE.                                     04320008
043300                                                                  04330008
043400     DISPLAY '************************************************'.  04340008
043500     DISPLAY 'TOTAL INVOICES RECORDS READ    = '                  04350008
043600              WS-AFPIN-REC-CNT                                    04360008
043700     DISPLAY 'TOTAL AFP RECORDS WRITTEN      = '                  04370008
043800              WS-AFPOUT-REC-CNT.                                  04380008
043900     DISPLAY '************************************************'.  04390008
044000                                                                  04400008
044100     IF   END-OF-EDIIN                                            04410008
044200          DISPLAY ' PROGRAM APKUT203 ENDS NORMALLY '              04420008
044300     ELSE                                                         04430008
044400          DISPLAY ' PROGRAM APKUT203 ENDS ABNORMALLY '            04440008
044500     END-IF.                                                      04450008
044600                                                                  04460008
044700     ACCEPT RUN-TIME FROM TIME.                                   04470008
044800     ACCEPT DATE-IN  FROM DATE.                                   04480008
044900                                                                  04490008
045000     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    04500008
045100     DISPLAY '************************************************'.  04510008
045200                                                                  04520008
