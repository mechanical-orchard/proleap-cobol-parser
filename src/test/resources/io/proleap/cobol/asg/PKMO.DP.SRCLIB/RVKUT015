000100 IDENTIFICATION DIVISION.                                         00010010
000200                                                                  00020010
000300 PROGRAM-ID.             RVKUT015.                                00030010
000400 AUTHOR.                 PAUL OMAN/VIRGNE LENNEMAN.               00040010
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050010
000600 DATE-WRITTEN.           NOVEMBER 2003.                           00060010
000700 DATE-COMPILED.                                                   00070010
000800                                                                  00080010
000900****************************************************************  00090010
001000*  PROGRAM NARRATIVE:                                             00100010
001100*       PROGRAM WILL CREATE AN EXTRACT FILE FOR THE RTV-AP        00110010
001200*  INTERFACE.  TWO AP TRANSACTION TYPE RECORDS CAN BE PUT OUT     00120010
001300*  FROM THIS PROGRAM DEPENDING ON THE DFCT-ORD-ID-CDE: R = RTV    00130010
001400*  AND D = D & D.                                                 00140010
001500*                                                                 00150010
001600*  SEVERAL IMPORTANT POINTS ABOUT ROWS ON THE TDFMEIT TABLE.      00160010
001700*       RTV AND D & D LISTINGS CAN HAVE MULTIPLE ROWS.            00170010
001800*                                                                 00180010
001900*           THEY CAN ONLY HAVE ONE DEPARTMENT THOUGH.             00190010
002000*           THEY CAN HAVE MULTIPLE SUBCLASSES UNDER THAT DEPT.    00200010
002100*           THIS PROGRAM SUMS THE INFORMATION FROM THOSE          00210010
002200*                SUBCLASSES INTO A MAJOR CLASS TOTAL.             00220010
002300*                                                                 00230010
002400*       FOR EXAMPLE, THE FOLLOWING RECORDS ARE IN DB2             00240010
002500*           ORDER_ID  DUNS-NBR      DEPT   CLS                    00250010
002600*            13382    000032029      057    52                    00260010
002700*            13382    000032029      057    53                    00270010
002800*            13382    000032029      057    57                    00280010
002900*                                                                 00290010
003000*            15311    000032029      057    57                    00300010
003100*                                                                 00310010
003200*            16840    000052027      063    11                    00320010
003300*            16840    000052027      063    13                    00330010
003400*            16840    000052027      063    99                    00340010
003500*                                                                 00350010
003600*                                                                 00360010
003700*  FOLLOWING IS WHAT OUTPUT RECORDS WILL BE CREATED.              00370010
003800*            13382    000032029      057    50                    00380010
003900*            15311    000032029      057    50                    00390010
004000*            16840    000052027      063    10                    00400010
004100*            16840    000052027      063    90                    00410010
004200*                                                                 00420010
004300*                                                                 00430010
004400*  THE FOLLOWING DB2 TABLES ARE READ:                             00440010
004500*    TDFCTOR     TDFMEIT    TAPCNTL    TTRNCDE    XLT_LOC         00450010
004600*    TEXTENT     TENTNME    RVT_DFCT_SHIPT XLT_DC_LOC_ASGNT       00460010
004700*                                                                 00470010
004800*  THE FOLLOWING DB2 TABLES ARE UPDATED:                          00480010
004900*    TDFCTOR                                                      00490010
005000*    RVT_SHIPT_STAT  (RVT00001)                                   00500010
005100*    RVT_DFCT_STAT   (RVT00000)                                   00510010
005200*                                                                 00520010
005300*  COPYBOOKS:                                                     00530010
005400*    RVRD005 DPWS004 RVRD006                                      00540010
005500****************************************************************  00550010
005600                                                                  00560010
005700******************************************************************00570010
005800*  CHANGE LOG.                                                    00580010
005900*  DATE         CHANGED BY      DESC                              00590010
006000*  -----------  --------------  ----------------------------------00600010
006100*  10/30/2011   C. STRODTHOFF - GENCO / RTV UPGRADE. CHANGE SQL   00610010
006200*                               CALL TO USE RTV LOC - PARA 5300   00620010
006300*                               PRJ ID 3219 - WR40134.            00630010
006400******************************************************************00640010
006500******************************************************************00650010
006600 ENVIRONMENT DIVISION.                                            00660010
006700                                                                  00670010
006800 CONFIGURATION SECTION.                                           00680010
006900                                                                  00690010
007000 SOURCE-COMPUTER.                        IBM-3090.                00700010
007100 OBJECT-COMPUTER.                        IBM-3090.                00710010
007200                                                                  00720010
007300 INPUT-OUTPUT SECTION.                                            00730010
007400                                                                  00740010
007500 FILE-CONTROL.                                                    00750010
007600                                                                  00760010
007700     SELECT  RV-EXTRACT-FILE                                      00770010
007800         ASSIGN TO OUT01.                                         00780010
007900                                                                  00790010
008000     SELECT  RV-FREIGHT-FILE                                      00800010
008100         ASSIGN TO OUT02.                                         00810010
008200                                                                  00820010
008300****************************************************************  00830010
008400 DATA DIVISION.                                                   00840010
008500****************************************************************  00850010
008600                                                                  00860010
008700 FILE SECTION.                                                    00870010
008800                                                                  00880010
008900 FD  RV-EXTRACT-FILE                                              00890010
009000     RECORDING MODE IS F                                          00900010
009100     LABEL RECORDS ARE STANDARD                                   00910010
009200     BLOCK CONTAINS 0 RECORDS.                                    00920010
009300 01  RV-EXT-RECORD                    PIC  X(500).                00930010
009400                                                                  00940010
009500 FD  RV-FREIGHT-FILE                                              00950010
009600     RECORDING MODE IS F                                          00960010
009700     LABEL RECORDS ARE STANDARD                                   00970010
009800     BLOCK CONTAINS 0 RECORDS.                                    00980010
009900 01  RV-FRGT-RECORD                   PIC  X(200).                00990010
010000                                                                  01000010
010100 WORKING-STORAGE SECTION.                                         01010010
010200***************************************************************** 01020010
010300*    PROGRAM CONSTANTS                                            01030010
010400***************************************************************** 01040010
010500 01  PC-CONSTANTS.                                                01050010
010600     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       01060010
010700*    05  PC-OPER-UNT-ID-FINDLAY   PIC  9(04) VALUE 0810.          01070010
010800     05  PC-OPER-UNT-ID-FINDLAY   PIC  9(04) VALUE 0811.          01080010
010900     05  PC-OPER-UNT-ID-TEST-CORP PIC  9(04) VALUE 0090.          01090010
011000     05  PC-ASTERISK-LINE         PIC  X(40) VALUE ALL '*'.       01100010
011100     05  PC-FIVE-BLANKS           PIC  X(05) VALUE SPACES.        01110010
011200     05  PC-TEN-BLANKS            PIC  X(05) VALUE SPACES.        01120010
011300     05  PC-SPACE                 PIC  X(01) VALUE SPACE.         01130010
011400                                                                  01140010
011500***************************************************************** 01150010
011600*    PROGRAM SWITCHES                                             01160010
011700***************************************************************** 01170010
011800 01  PS-SWITCHES.                                                 01180010
011900     05  PS-END-OF-CURSOR-SW      PIC  X(01) VALUE 'N'.           01190010
012000         88  PS-END-OF-CURSOR                VALUE 'Y'.           01200010
012100         88  PS-NOT-END-OF-CURSOR            VALUE 'N'.           01210010
012200     05  PS-FIRST-TIME-SW         PIC  X(01) VALUE 'N'.           01220010
012300         88  PS-FIRST-TIME                   VALUE 'Y'.           01230010
012400         88  PS-NOT-FIRST-TIME               VALUE 'N'.           01240010
012500     05  PS-FIRST-TIMEDOC-SW      PIC  X(01) VALUE 'N'.           01250010
012600         88  PS-FIRST-TIME-DOC               VALUE 'Y'.           01260010
012700         88  PS-NOT-FIRST-TIME-DOC           VALUE 'N'.           01270010
012800     05  PS-DFCT-ORD-ID-CDE       PIC  X(01) VALUE SPACE.         01280010
012900         88  PS-DFCT-ORD-ID-CDE-RTV          VALUE 'R'.           01290010
013000         88  PS-DFCT-ORD-ID-CDE-DND          VALUE 'D'.           01300010
013100     05  PS-DFCT-ORD-STAT-CDE     PIC  X(01) VALUE SPACE.         01310010
013200         88  PS-DFCT-SHIPPED                 VALUE 'S'.           01320010
013300         88  PS-DFCT-DISPOSED                VALUE 'D'.           01330010
013400     05  PS-NEW-SHIPT-ID-SW       PIC  X(01) VALUE 'Y'.           01340010
013500         88  PS-NEW-SHIPT-ID                 VALUE 'Y'.           01350010
013600         88  PS-NOT-NEW-SHIPT-ID             VALUE 'N'.           01360010
013700     05  PS-UPDATE-OK-SW          PIC  X(01) VALUE 'Y'.           01370010
013800         88  PS-UPDATE-OK                    VALUE 'Y'.           01380010
013900         88  PS-UPDATE-NOT-OK                VALUE 'N'.           01390010
014000     05  PS-BYPASS-SW             PIC  X(01) VALUE 'N'.           01400010
014100         88  PS-DONT-BYPASS                  VALUE 'N'.           01410010
014200         88  PS-BYPASS                       VALUE 'Y'.           01420010
014300     05  PS-SHIPDT-SW             PIC  X(01) VALUE 'N'.           01430010
014400         88  PS-FUTURE-DATE                  VALUE 'Y'.           01440010
014500         88  PS-NOT-FUTURE-DATE              VALUE 'N'.           01450010
014510     05  PS-DOC-APPEND-CREATED    PIC  X(01) VALUE 'Y'.           01451010
014520         88  PS-DOC-APPEND-YES               VALUE 'Y'.           01452010
014530         88  PS-DOC-APPEND-NO                VALUE 'N'.           01453010
014600                                                                  01460010
014700***************************************************************** 01470010
014800*    PROGRAM VARIABLES                                            01480010
014900***************************************************************** 01490010
015000 01  PV-VARIABLES-CHAR.                                           01500010
015100     05  PV-PARAGRAPH             PIC  X(30) VALUE SPACES.        01510010
015200     05  PV-DB2-FUNCTION          PIC  X(30) VALUE SPACES.        01520010
015300     05  PV-ABEND-STRUCTURE-1     PIC  X(20) VALUE SPACES.        01530010
015400     05  PV-ABEND-STRUCTURE-2     PIC  X(20) VALUE SPACES.        01540010
015500     05  PV-ABEND-STRUCTURE-3     PIC  X(20) VALUE SPACES.        01550010
015600     05  PV-ERROR-MSG             PIC  X(60) VALUE SPACES.        01560010
015700     05  PV-DEFAULT-TIMESTAMP     PIC  X(26) VALUE SPACES.        01570010
015800     05  PV-DEFAULT-TIMESTAMP-R   REDEFINES                       01580010
015900         PV-DEFAULT-TIMESTAMP.                                    01590010
016000         10  PV-DEFAULT-DATE      PIC  X(10).                     01600010
016100         10  PV-DEFAULT-TIME      PIC  X(16).                     01610010
016200                                                                  01620010
016300     05  PV-RTV-REASON-LINE.                                      01630010
016400         10  FILLER               PIC X(21) VALUE                 01640010
016500             'MDSE RETURNED  AUTH# '.                             01650010
016600         10  PV-RTV-AUTH-ID       PIC X(10) VALUE SPACES.         01660010
016700     05  PV-DND-REASON-LINE.                                      01670010
016800         10  FILLER               PIC X(20) VALUE                 01680010
016900             'MDSE DAMAGED  AUTH# '.                              01690010
017000         10  PV-DND-AUTH-ID       PIC X(10) VALUE SPACES.         01700010
017100     05  PV-DFCT-ORD-ID-CDE       PIC  X(01) VALUE SPACE.         01710010
017200     05  PV-CURRENT-TIMESTAMP     PIC  X(26) VALUE SPACES.        01720010
017300     05  PV-CURRENT-DATE          PIC  X(10) VALUE SPACES.        01730010
017400     05  PV-ACTL-SHIPT-DTE        PIC  X(10) VALUE SPACES.        01740010
017500     05  PV-VENDOR-DUNS-NBR       PIC  X(09) VALUE SPACES.        01750010
017600     05  PV-STATUS-CHG-DTE        PIC  X(10) VALUE SPACES.        01760010
017700     05  PV-VND-AUTH-ID           PIC  X(10) VALUE SPACES.        01770010
017800     05  PV-ENT-NAME-DESC         PIC  X(30) VALUE SPACES.        01780010
017900     05  PV-CARRIER               PIC  X(04) VALUE SPACES.        01790010
018000     05  PV-TRACKING-NBR          PIC  X(25) VALUE SPACES.        01800010
018100     05  PV-TRAILER-NBR           PIC  X(12) VALUE SPACES.        01810010
018200     05  PV-PREV-DOC-NBR          PIC  X(16) VALUE SPACES.        01820010
018300     05  PV-PREV-DEPT-NBR         PIC  9(04) VALUE ZEROES.        01830010
018400     05  PV-COUNT                 PIC  9(02) VALUE ZEROES.        01840010
018500     05  PV-START-POS             PIC  9(02) VALUE ZEROES.        01850010
018600     05  PV-DOC-NBR               PIC  X(16) VALUE SPACES.        01860010
018700     05  PV-FINAL-DOC-NBR         PIC  X(16) VALUE SPACES.        01870010
018800     05  PV-FINAL-DOC-NBR-TEMP    PIC  X(16) VALUE SPACES.        01880010
018900     05  PV-FINAL-DOC-NBR-NEW     PIC  X(16) VALUE SPACES.        01890010
018910     05  PV-FINAL-DOC-NBR-HOLD    PIC  X(16) VALUE SPACES.        01891012
019000     05  PV-APPEND-CHAR           PIC  9(02) VALUE ZEROES.        01900010
019100                                                                  01910010
019200     05  PV-WORK-DATE.                                            01920010
019300         10  PV-WORK-MM           PIC  X(02) VALUE SPACES.        01930010
019400         10  FILLER               PIC  X(01) VALUE '/'.           01940010
019500         10  PV-WORK-DD           PIC  X(02) VALUE SPACES.        01950010
019600         10  FILLER               PIC  X(01) VALUE '/'.           01960010
019700         10  PV-WORK-CCYY         PIC  X(04) VALUE SPACES.        01970010
019800                                                                  01980010
019900     05  PV-DOC-NBR-SUFFIX.                                       01990010
020000         10  PV-RTV-SUFFIX        PIC  X(03) VALUE '_RL'.         02000016
020100**       10  PV-DOC-DTE-YY        PIC  X(02) VALUE SPACES.        02010010
020200**       10  PV-DOC-DTE-MM        PIC  X(02) VALUE SPACES.        02020010
020300**       10  PV-DOC-DTE-DD        PIC  X(02) VALUE SPACES.        02030010
020400                                                                  02040010
020500 01  PV-VARIABLES-COMP.                                           02050010
020600     05  PV-DFCT-SHIPT-ID-IND      PIC S9(4) COMP VALUE 0.        02060010
020700         88  PV-DFCT-SHIPT-ID-NULL                VALUE -1.       02070010
020800         88  PV-DFCT-SHIPT-ID-NOT-NULL            VALUE 0.        02080010
020900     05  PV-VND-AUTH-ID-IND        PIC S9(4) COMP VALUE 0.        02090010
021000         88  PV-VND-AUTH-ID-NULL                  VALUE -1.       02100010
021100     05  PV-VND-AUTH-DTE-IND       PIC S9(4) COMP VALUE 0.        02110010
021200         88  PV-VND-AUTH-DTE-NULL                 VALUE -1.       02120010
021300     05  PV-INBD-RET-FRGT-AMT-IND  PIC S9(4) COMP VALUE 0.        02130010
021400         88  PV-INBD-RET-FRGT-AMT-NULL            VALUE -1.       02140010
021500     05  PV-OTBND-RET-FRGT-AMT-IND PIC S9(4) COMP VALUE 0.        02150010
021600         88  PV-OTBND-RET-FRGT-AMT-NULL           VALUE -1.       02160010
021700     05  PV-DED-CHRG-AMT-IND       PIC S9(4) COMP VALUE 0.        02170010
021800         88  PV-DED-CHRG-AMT-NULL                 VALUE -1.       02180010
021900     05  PV-DISC-PCT-IND           PIC S9(4) COMP VALUE 0.        02190010
022000         88  PV-DISC-PCT-NULL                     VALUE -1.       02200010
022100     05  PV-DISC-AMT-IND           PIC S9(4) COMP VALUE 0.        02210010
022200         88  PV-DISC-AMT-NULL                     VALUE -1.       02220010
022300     05  PV-PAYT-TYP-CDE-IND       PIC S9(4) COMP VALUE 0.        02230010
022400         88  PV-PAYT-TYP-CDE-NULL                 VALUE -1.       02240010
022500     05  PV-CART-QTY-IND           PIC S9(4) COMP VALUE 0.        02250010
022600         88  PV-CART-QTY-NULL                     VALUE -1.       02260010
022700     05  PV-CARR-TRKG-ID-IND       PIC S9(4) COMP VALUE 0.        02270010
022800         88  PV-CARR-TRKG-ID-NULL                 VALUE -1.       02280010
022900                                                                  02290010
023000     05  PV-RETRY-COUNT           PIC S9(04) VALUE +0 COMP.       02300010
023100     05  PV-DFCT-SHIPT-ID         PIC S9(09) VALUE +0 COMP.       02310010
023200     05  PV-PREV-SHIPT-ID         PIC S9(09) VALUE +0 COMP.       02320010
023300     05  PV-WORK-DFCT-SHIPT-ID    PIC S9(11) VALUE +0.            02330010
023400     05  PV-WORK-OPER-UNT-ID-COMP PIC S9(04) VALUE +0 COMP.       02340010
023500                                                                  02350010
023600 01  PV-VARIABLES-COMP-3.                                         02360010
023700     05  PV-CURSOR-COUNT          PIC S9(07) VALUE +0 COMP-3.     02370010
023800     05  PV-TDFCTOR-UPDATES       PIC S9(07) VALUE +0 COMP-3.     02380010
023900     05  PV-RVT00001-INSERTS      PIC S9(07) VALUE +0 COMP-3.     02390010
024000     05  PV-RVT00003-INSERTS      PIC S9(07) VALUE +0 COMP-3.     02400010
024100     05  PV-RVRD005-COUNT         PIC S9(07) VALUE +0 COMP-3.     02410010
024200     05  PV-RVRD006-COUNT         PIC S9(07) VALUE +0 COMP-3.     02420010
024300     05  PV-RVRD006-BYPASS-CNT   PIC S9(07) VALUE +0 COMP-3.      02430010
024400     05  PV-RTV-RECORDS           PIC S9(07) VALUE +0 COMP-3.     02440010
024500     05  PV-DND-RECORDS           PIC S9(07) VALUE +0 COMP-3.     02450010
024600     05  PV-COMMIT-CNT            PIC S9(07) VALUE +0 COMP-3.     02460010
024700     05  PV-ROLLBACK-CNT          PIC S9(07) VALUE +0 COMP-3.     02470010
024800                                                                  02480010
024900     05  PV-COMMIT-COUNT          PIC S9(07) VALUE +0 COMP-3.     02490010
025000     05  PV-COMMIT-MAX            PIC S9(07) VALUE +100 COMP-3.   02500010
025100                                                                  02510010
025200     05  PV-TOTAL-PRORATED-AMT   PIC S9(9)V99   COMP-3 VALUE 0.   02520010
025300     05  PV-TOTAL-PRORATED-PCT   PIC S9(9)V9(4) COMP-3 VALUE 0.   02530010
025400     05  PV-TOTAL-PRORATED-INBD  PIC S9(9)V99   COMP-3 VALUE 0.   02540010
025500     05  PV-TOTAL-PRORATED-OTBND PIC S9(9)V99   COMP-3 VALUE 0.   02550010
025600     05  PV-TOTAL-PRORATED-DED   PIC S9(9)V99   COMP-3 VALUE 0.   02560010
025700     05  PV-TOTAL-CHARGES        PIC S9(9)V99   COMP-3 VALUE 0.   02570010
025800     05  PV-TOTAL-CREDITS        PIC S9(9)V99   COMP-3 VALUE 0.   02580010
025900     05  PV-NET-AMT              PIC S9(9)V99   COMP-3 VALUE 0.   02590010
026000     05  PV-WORK-PERCENT         PIC S9(5)V9(4) COMP-3 VALUE 0.   02600010
026100     05  PV-TOTAL-WRITTEN        PIC S9(7)      COMP-3 VALUE 0.   02610010
026200     05  PV-PREV-DFCT-ORD-ID     PIC S9(12)     COMP-3 VALUE 0.   02620010
026300     05  PV-ENT-ID               PIC S9(09)     COMP-3 VALUE 0.   02630010
026400                                                                  02640010
026500 01  PV-VARIABLES-PIC9.                                           02650010
026600     05  PV-WORK-OPER-UNT-ID     PIC  9(04) VALUE 0.              02660010
026700     05  PV-PREV-DEPT            PIC  9(03) VALUE 0.              02670010
026800     05  PV-PREV-CLASS           PIC  9(04) VALUE 0.              02680010
026900     05  PV-WORK-CLASS           PIC  9(04) VALUE 0.              02690010
027000     05  PV-WORK-DEPT            PIC  9(04) VALUE 0.              02700010
027100     05  PV-NBR-MAJ-CLASS        PIC  9(04) VALUE 0.              02710010
027200     05  PV-CARTON-QTY           PIC  9(09) VALUE 0.              02720010
027300     05  PV-ABEND-CODE           PIC S9(04) VALUE 0.              02730010
027400     05  PV-DFCT-ORD-ID          PIC S9(12) VALUE 0.              02740010
027500     05  PV-WORK-ORD-ID          PIC 9(12)  VALUE 0.              02750010
027600     05  PV-WORK-ORD-ID-CHAR REDEFINES PV-WORK-ORD-ID             02760010
027700                                 PIC X(12).                       02770010
027800                                                                  02780010
027900 01  PV-SAVE-TTRNCDE-TABLE.                                       02790010
028000     05  PV-SUB                   PIC S9(4) COMP.                 02800010
028100     05  FILLER OCCURS 2 TIMES.                                   02810010
028200         10 PV-PSTG-TYP-CDE       PIC X(02).                      02820010
028300         10 PV-TRN-TYP-CDE        PIC X(03).                      02830010
028400         10 PV-GL-ACCT-NBR        PIC X(06).                      02840010
028500         10 PV-BTCH-SRC-CDE       PIC X(03).                      02850010
028600                                                                  02860010
028700****************************************************************  02870010
028800* TABLE HOLDS VALUES FOR EACH DEBIT, WHEN MULTIPLE CLASSES     *  02880010
028900* WITHIN A DEPT. THE FRGT CHARGES, DEDUCTION, DISC. AMT/PCT    *  02890010
029000* ARE PRORATED BASED THE NUMBER OF UNITS IN EACH CLASS         *  02900010
029100****************************************************************  02910010
029200 01  PV-AP-TABLE.                                                 02920010
029300     05  PV-AP-DISP-INDEX          PIC  9(4) VALUE ZEROES.        02930010
029400     05  PV-AP-INDEX               PIC  S9(4) COMP.               02940010
029500     05  PV-AP-INDEX-USED          PIC  S9(4) COMP.               02950010
029600     05  PV-AP-INDEX-MAX           PIC  S9(4) COMP.               02960010
029700     05  PV-TBL-INBD-RET-FRGT-AMT  PIC  S9(09)V99   COMP-3.       02970010
029800     05  PV-TBL-OTBND-RET-FRGT-AMT PIC  S9(09)V99   COMP-3.       02980010
029900     05  PV-TBL-DEDUCTION-AMT      PIC  S9(09)V99   COMP-3.       02990010
030000     05  PV-TBL-DISC-AMT           PIC  S9(09)V99   COMP-3.       03000010
030100     05  PV-TBL-DISC-PCT           PIC  S9(03)V9(4) COMP-3.       03010010
030200     05  PV-TBL-TOTAL-ITEM-COUNT   PIC  S9(07)      COMP-3.       03020010
030300     05  PV-TBL-AP-ROW      OCCURS 100 TIMES.                     03030010
030400         10  PV-TBL-AP-DEPT            PIC  9(4).                 03040010
030500         10  PV-TBL-AP-MAJOR-CLASS     PIC  9(4).                 03050010
030600         10  PV-TBL-AP-UNIT-COST       PIC  S9(09)V99 COMP-3.     03060010
030700         10  PV-TBL-AP-RETAIL-COST     PIC  S9(09)V99 COMP-3.     03070010
030800         10  PV-TBL-AP-ITEM-COUNT      PIC  S9(07)    COMP-3.     03080010
030900         10  PV-TBL-AP-PRORATED-PCT    PIC  S9(03)V99 COMP-3.     03090010
031000         10  PV-TBL-AP-PRORATED-AMT    PIC  S9(09)V99 COMP-3.     03100010
031100         10  PV-TBL-AP-PRORATED-INBD   PIC  S9(09)V99 COMP-3.     03110010
031200         10  PV-TBL-AP-PRORATED-OTBND  PIC  S9(09)V99 COMP-3.     03120010
031300         10  PV-TBL-AP-PRORATED-DED    PIC  S9(09)V99 COMP-3.     03130010
031400                                                                  03140010
031500***  EXTRACT RECORD LAYOUT                                        03150010
031600     COPY RVRD005.                                                03160010
031700                                                                  03170010
031800***  FREIGHT RECORD LAYOUT                                        03180010
031900     COPY RVRD006.                                                03190010
032000                                                                  03200010
032100***  DB2 ABEND COPYBOOK                                           03210010
032200     COPY DPWS004.                                                03220010
032300                                                                  03230010
032400     EXEC SQL                                                     03240010
032500         INCLUDE SQLCA                                            03250010
032600     END-EXEC.                                                    03260010
032700                                                                  03270010
032800     COPY SQLCA2.                                                 03280010
032900                                                                  03290010
033000***  AP CONTROL TABLE                                             03300010
033100     EXEC SQL                                                     03310010
033200         INCLUDE TAPCNTL                                          03320010
033300     END-EXEC.                                                    03330010
033400                                                                  03340010
033500***  AP TRANSACTION CODE TABLE                                    03350010
033600     EXEC SQL                                                     03360010
033700         INCLUDE TTRNCDE                                          03370010
033800     END-EXEC.                                                    03380010
033900                                                                  03390010
034000***  DEFECT HEADER TABLE                                          03400010
034100     EXEC SQL                                                     03410010
034200         INCLUDE TDFCTOR                                          03420010
034300     END-EXEC.                                                    03430010
034400                                                                  03440010
034500***  DEFECT ITEM TABLE                                            03450010
034600     EXEC SQL                                                     03460010
034700         INCLUDE TDFMEIT                                          03470010
034800     END-EXEC.                                                    03480010
034900                                                                  03490010
035000***  EXTERNAL ENTITY TABLE                                        03500010
035100     EXEC SQL                                                     03510010
035200         INCLUDE TEXTENT                                          03520010
035300     END-EXEC.                                                    03530010
035400                                                                  03540010
035500***  EXTERNAL ENTITY NAME TABLE                                   03550010
035600     EXEC SQL                                                     03560010
035700         INCLUDE TENTNME                                          03570010
035800     END-EXEC.                                                    03580010
035900                                                                  03590010
036000***  LOGISTICS LOCATION TABLE (XLT_LOC)                           03600010
036100     EXEC SQL                                                     03610010
036200         INCLUDE XLT00010                                         03620010
036300     END-EXEC.                                                    03630010
036400                                                                  03640010
036500***  LOGISTICS LOCATION ASSIGNMENT TABLE (XLT_DC_LOC_ASGMT)       03650010
036600     EXEC SQL                                                     03660010
036700         INCLUDE XLT00014                                         03670010
036800     END-EXEC.                                                    03680010
036900                                                                  03690010
037000***  RVT_SHIPT_STAT TABLE                                         03700010
037100     EXEC SQL                                                     03710010
037200         INCLUDE RVT00001                                         03720010
037300     END-EXEC.                                                    03730010
037400                                                                  03740010
037500***  RVT_DFCT_STAT TABLE                                          03750010
037600     EXEC SQL                                                     03760010
037700         INCLUDE RVT00003                                         03770010
037800     END-EXEC.                                                    03780010
037900                                                                  03790010
038000***  RVT_DFCT_SHIPT TABLE                                         03800010
038100     EXEC SQL                                                     03810010
038200         INCLUDE RVT00000                                         03820010
038300     END-EXEC.                                                    03830010
038400                                                                  03840010
038500                                                                  03850010
038600*--------------------------------------------------------------*  03860010
038700*   CURSOR USED TO SELECT THOSE RTV (DFCT_ORD_ID_CDE = "R")    *  03870010
038800*   AND D & D (DFCT_ORD_ID_CDE = 'D') LISTINGS THAT HAVE A     *  03880010
038900*   STATUS CODE OF SHIPPED (DFCT_ORD_STAT_CDE = 'S') OR        *  03890010
039000*   DISPOSE ('D')                                              *  03900010
039100*                                                              *  03910010
039200*   THE AUTH_ID, AUTH_DTE ARE  REQUIRED.  IF THE STATUS ID     *  03920010
039300*   THE AUTH_ID, AUTH_DTE ARE  REQUIRED.  IF THE STATUS CODE   *  03930010
039400*   IS SHIPPED, A SHIPT_ID IS ALSO REQUIRED.                   *  03940010
039500*   RVT_DFCT_STAT IS CHECKED FOR THE MAX TIMESTAMP FOR A LISTING  03950010
039600*   A LISTING MAY CHANGE STATUSES MULTIPLE TIMES BEFORE IT IS  *  03960010
039700*   PROCESSED FOR AP                                           *  03970010
039800*--------------------------------------------------------------*  03980010
039900                                                                  03990010
040000     EXEC SQL                                                     04000010
040100         DECLARE  EXTRACT_CURSOR CURSOR  WITH HOLD FOR            04010010
040200                                                                  04020010
040300         SELECT DFCTOR.DFCT_ORD_ID                                04030010
040400              , DFCTOR.VENDOR_DUNS_NBR                            04040010
040500              , DFCTOR.VEND_NAME                                  04050010
040600              , DFCTOR.OPER_UNT_ID                                04060010
040700              , DFCTOR.DFCT_ORD_ID_CDE                            04070010
040800              , DFCTOR.STATUS_CHG_DTE                             04080010
040900              , DFCTOR.DFCT_ORD_STAT_CDE                          04090010
041000              , DFCTOR.DFCT_SHIPT_ID                              04100010
041100              , DFCTOR.VND_AUTH_ID                                04110010
041200              , DFCTOR.VND_AUTH_DTE                               04120010
041300              , DFCTOR.INBD_RET_FRGT_AMT                          04130010
041400              , DFCTOR.OTBND_RET_FRGT_AMT                         04140010
041500              , DFCTOR.DED_CHRG_AMT                               04150010
041600              , DFCTOR.DISC_PCT                                   04160010
041700              , DFCTOR.DISC_AMT                                   04170010
041800              , DFCTOR.CARR_TRKG_ID                               04180010
041900              , DFCTOR.CART_QTY                                   04190010
042000              , DFCTOR.PAYT_TYP_CDE                               04200010
042100                                                                  04210010
042200              , DFMEIT.RTL_COST_AMT                               04220010
042300              , DFMEIT.UNIT_COST_AMT                              04230010
042400              , DFMEIT.MDSE_DEPT_NBR                              04240010
042500              , DFMEIT.MDSE_CLASS_NBR                             04250010
042600              , DFMEIT.SEQ_NBR                                    04260010
042700                                                                  04270010
042800         FROM  TDFCTOR DFCTOR                                     04280010
042900             , TDFMEIT DFMEIT                                     04290010
043000             , RVT_DFCT_STAT DSTAT                                04300010
043100                                                                  04310010
043200         WHERE DFCTOR.DFCT_ORD_ID = DFMEIT.DFCT_ORD_ID            04320010
043300           AND DFCTOR.DFCT_ORD_ID_CDE   IN ('D', 'R')             04330010
043400           AND DFCTOR.DFCT_ORD_STAT_CDE IN ('D', 'S')             04340010
043500           AND DFCTOR.DFCT_ORD_ID = DSTAT.DFCT_ORD_ID             04350010
043600           AND DSTAT.CHGD_TMST =                                  04360010
043700                   (SELECT MAX(CHGD_TMST)                         04370010
043800                      FROM RVT_DFCT_STAT Z                        04380010
043900                     WHERE Z.DFCT_ORD_ID = DFCTOR.DFCT_ORD_ID     04390010
044000                       AND Z.DFCT_ORD_STAT_CDE IN ('D', 'S'))     04400010
044100           AND NOT (DFCTOR.VND_AUTH_ID   IS NULL)                 04410010
044200           AND NOT (DFCTOR.VND_AUTH_DTE  IS NULL)                 04420010
044300                                                                  04430010
044400      ORDER BY  DFCTOR.OPER_UNT_ID                                04440010
044500              , DFCTOR.VEND_NAME                                  04450010
044600              , DFCTOR.DFCT_ORD_ID                                04460010
044700              , DFMEIT.MDSE_DEPT_NBR                              04470010
044800              , DFMEIT.MDSE_CLASS_NBR                             04480010
044900    END-EXEC.                                                     04490010
045000                                                                  04500010
045100 LINKAGE SECTION.                                                 04510010
045200                                                                  04520010
045300 PROCEDURE DIVISION.                                              04530010
045400***************************************************************** 04540010
045500*  MAINLINE LOGIC FOR PROGRAM                                     04550010
045600***************************************************************** 04560010
045700 0000-MAINLINE.                                                   04570010
045800     PERFORM 1000-INITIALIZE.                                     04580010
045900                                                                  04590010
046000     PERFORM 2000-PROCESS-LISTINGS                                04600010
046100         UNTIL PS-END-OF-CURSOR.                                  04610010
046200                                                                  04620010
046300     PERFORM 9000-EOJ.                                            04630010
046400                                                                  04640010
046500     GOBACK.                                                      04650010
046600                                                                  04660010
046700***************************************************************** 04670010
046800*  INITIALIZATION PARAGRAPH                                       04680010
046900***************************************************************** 04690010
047000 1000-INITIALIZE.                                                 04700010
047100     EXEC SQL                                                     04710010
047200          SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           04720010
047300     END-EXEC.                                                    04730010
047400                                                                  04740010
047500     EVALUATE TRUE                                                04750010
047600         WHEN SQLCODE = +0                                        04760010
047700             MOVE PV-CURRENT-TIMESTAMP   TO PV-DEFAULT-TIMESTAMP  04770010
047800             MOVE PV-CURRENT-TIMESTAMP (1:10)                     04780010
047900                                         TO PV-CURRENT-DATE       04790010
048000         WHEN OTHER                                               04800010
048100              MOVE '1000-INITIALIZE    ' TO PV-PARAGRAPH          04810010
048200              MOVE 'SELECT       '       TO PV-DB2-FUNCTION       04820010
048300              MOVE 'TIMESTAMP'           TO PV-ABEND-STRUCTURE-1  04830010
048400              MOVE SPACES                TO PV-ABEND-STRUCTURE-2  04840010
048500                                            PV-ABEND-STRUCTURE-3  04850010
048600              PERFORM 9200-SQL-ERROR                              04860010
048700     END-EVALUATE.                                                04870010
048800                                                                  04880010
048900     OPEN OUTPUT RV-EXTRACT-FILE.                                 04890010
049000     OPEN OUTPUT RV-FREIGHT-FILE.                                 04900010
049100     INITIALIZE PV-AP-TABLE.                                      04910010
049200     MOVE 100 TO PV-AP-INDEX-MAX.                                 04920010
049300                                                                  04930010
049400     PERFORM VARYING PV-AP-INDEX FROM 1 BY 1                      04940010
049500               UNTIL PV-AP-INDEX > PV-AP-INDEX-MAX                04950010
049600                                                                  04960010
049700         MOVE 0 TO PV-TBL-AP-DEPT (PV-AP-INDEX)                   04970010
049800                   PV-TBL-AP-MAJOR-CLASS (PV-AP-INDEX)            04980010
049900                   PV-TBL-AP-UNIT-COST (PV-AP-INDEX)              04990010
050000                   PV-TBL-AP-RETAIL-COST (PV-AP-INDEX)            05000010
050100                   PV-TBL-AP-ITEM-COUNT  (PV-AP-INDEX)            05010010
050200                   PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX)           05020010
050300                   PV-TBL-AP-PRORATED-PCT (PV-AP-INDEX)           05030010
050400                   PV-TBL-AP-PRORATED-INBD  (PV-AP-INDEX)         05040010
050500                   PV-TBL-AP-PRORATED-OTBND (PV-AP-INDEX)         05050010
050600                   PV-TBL-AP-PRORATED-DED   (PV-AP-INDEX)         05060010
050700                                                                  05070010
050800     END-PERFORM.                                                 05080010
050900                                                                  05090010
051000     MOVE 1 TO PV-AP-INDEX                                        05100010
051100               PV-AP-INDEX-USED.                                  05110010
051200     MOVE 1 TO PV-NBR-MAJ-CLASS.                                  05120010
051300                                                                  05130010
051400     PERFORM 5000-SELECT-TAPCNTL.                                 05140010
051500                                                                  05150010
051600****************************************************************  05160010
051700* GET TRAN CODE INFORMATION FOR '54' (D & D)                   *  05170010
051800****************************************************************  05180010
051900     INITIALIZE DCLTTRNCDE.                                       05190010
052000     MOVE '54'  TO TRNCDE-AP-TRN-CDE.                             05200010
052100     MOVE 1     TO PV-SUB.                                        05210010
052200                                                                  05220010
052300     PERFORM 5100-SELECT-TTRNCDE.                                 05230010
052400                                                                  05240010
052500****************************************************************  05250010
052600* GET TRAN CODE INFORMATION FOR '55' (RTV)                     *  05260010
052700****************************************************************  05270010
052800     INITIALIZE DCLTTRNCDE.                                       05280010
052900     MOVE '55' TO TRNCDE-AP-TRN-CDE.                              05290010
053000     MOVE 2    TO PV-SUB.                                         05300010
053100                                                                  05310010
053200     PERFORM 5100-SELECT-TTRNCDE.                                 05320010
053300                                                                  05330010
053400     SET PS-NOT-END-OF-CURSOR TO TRUE.                            05340010
053500     SET PS-FIRST-TIME TO TRUE.                                   05350010
053600     SET PS-FIRST-TIME-DOC TO TRUE.                               05360010
053700                                                                  05370010
053800     PERFORM 6000-OPEN-TDFCTOR-CSR.                               05380010
053900     PERFORM 6200-FETCH-TDFCTOR.                                  05390010
054000                                                                  05400010
054100     IF PS-END-OF-CURSOR                                          05410010
054200         DISPLAY ' '                                              05420010
054300         DISPLAY PC-ASTERISK-LINE                                 05430010
054400         DISPLAY '   NO UPDATES TO PERFORM'                       05440010
054500         DISPLAY '   NO RECORDS FOUND TO UPDATE'                  05450010
054600         DISPLAY PC-ASTERISK-LINE                                 05460010
054700         DISPLAY ' '                                              05470010
054800     END-IF.                                                      05480010
054900                                                                  05490010
055000***************************************************************** 05500010
055100*  PROCESS THE LISTING -- CREATE EXTRACT FILE                     05510010
055200*  WHEN THERE ARE MULTIPLE MAJOR CLASSES FOR A DEPT., AN          05520010
055300*    EXTRACT RECORD NEEDS TO BE CREATED FOR EACH MAJOR CLASS.     05530010
055400*    FREIGHT AND OTHER CHARGES NEED TO BE PRO-RATED AMONG EACH    05540010
055500*    MAJOR CLASS (THE MAJOR CLASS WITH THE GREATEST NUMBER OF     05550010
055600*    UNITS GETS A GREATER PROPORTION OF THE CHARGES. THE TOTAL    05560010
055700*    FOR ALL MAJOR CLASSES MUST MATCH THE TOTAL.  THE PERCENTAGE  05570010
055800*    OF ALL MAJOR CLASSES MUST EQUAL 100%.                        05580010
055900***************************************************************** 05590010
056000 2000-PROCESS-LISTINGS.                                           05600010
056100     IF PS-FIRST-TIME                                             05610010
056200        SET PS-NOT-FIRST-TIME TO TRUE                             05620010
056300        PERFORM 6300-GET-OTHER-INFO                               05630010
056400        IF PS-DONT-BYPASS                                         05640010
056500            PERFORM 2800-SAVE-FIELDS                              05650010
056600        ELSE                                                      05660010
056700            MOVE DFCTOR-DFCT-ORD-ID    TO PV-PREV-DFCT-ORD-ID     05670010
056800            MOVE DFMEIT-MDSE-DEPT-NBR  TO PV-PREV-DEPT            05680010
056900            MOVE DFCTOR-DFCT-SHIPT-ID  TO PV-PREV-SHIPT-ID        05690010
057000        END-IF                                                    05700010
057100     END-IF.                                                      05710010
057200                                                                  05720010
057300     IF PS-DONT-BYPASS                                            05730010
057400         IF DFCTOR-DFCT-ORD-ID = PV-PREV-DFCT-ORD-ID              05740010
057500           IF DFMEIT-MDSE-DEPT-NBR  = PV-PREV-DEPT                05750010
057600             IF DFMEIT-MDSE-CLASS-NBR (1:2) = PV-PREV-CLASS (3:2) 05760018
057700                 CONTINUE                                         05770010
057800             ELSE                                                 05780010
057900                 ADD 1 TO PV-NBR-MAJ-CLASS                        05790010
058000                 ADD 1 TO PV-AP-INDEX                             05800010
058100                          PV-AP-INDEX-USED                        05810010
058200                 PERFORM 2800-SAVE-FIELDS                         05820010
058300             END-IF                                               05830010
058400             PERFORM 2400-ADD-TO-TOTALS                           05840010
058500           ELSE                                                   05850010
058600             ADD 1 TO PV-AP-INDEX                                 05860010
058700                      PV-AP-INDEX-USED                            05870010
058800             PERFORM 2800-SAVE-FIELDS                             05880010
058900             PERFORM 2400-ADD-TO-TOTALS                           05890010
059000           END-IF                                                 05900010
059100         ELSE                                                     05910010
059200             PERFORM 2100-UPDATE-ROWS                             05920010
059300             INITIALIZE PV-AP-TABLE                               05930010
059400             MOVE 1 TO PV-AP-INDEX                                05940010
059500                       PV-AP-INDEX-USED                           05950010
059600             MOVE 100 TO PV-AP-INDEX-MAX                          05960010
059700             PERFORM 6300-GET-OTHER-INFO                          05970010
059800             IF PS-DONT-BYPASS                                    05980010
059900                 PERFORM 2800-SAVE-FIELDS                         05990010
060000                 PERFORM 2400-ADD-TO-TOTALS                       06000010
060100             ELSE                                                 06010010
060200                SET PS-DONT-BYPASS TO TRUE                        06020010
060300                MOVE DFCTOR-DFCT-ORD-ID    TO PV-PREV-DFCT-ORD-ID 06030010
060400                MOVE DFCTOR-DFCT-SHIPT-ID  TO PV-PREV-SHIPT-ID    06040010
060500             END-IF                                               06050010
060600         END-IF                                                   06060010
060700     ELSE                                                         06070010
060800         SET PS-DONT-BYPASS TO TRUE                               06080010
060900         MOVE DFCTOR-DFCT-ORD-ID    TO PV-PREV-DFCT-ORD-ID        06090010
061000         MOVE DFCTOR-DFCT-SHIPT-ID  TO PV-PREV-SHIPT-ID           06100010
061100     END-IF.                                                      06110010
061200                                                                  06120010
061300     PERFORM 6200-FETCH-TDFCTOR.                                  06130010
061400                                                                  06140010
061500***************************************************************** 06150010
061600*       ONLY DO ONE UPDATE TO TDFCTOR                             06160010
061700*               ONE INSERT TO RVT-DFCT-STAT                       06170010
061800*               ONE INSERT TO RVT-SHIPT-STAT                      06180010
061900*            FOR EACH ORDER NUMBER (LISTING).                     06190010
062000***************************************************************** 06200010
062100 2100-UPDATE-ROWS.                                                06210010
062200     MOVE 0 TO PV-TOTAL-PRORATED-AMT                              06220010
062300               PV-TOTAL-PRORATED-PCT                              06230010
062400               PV-TOTAL-PRORATED-INBD                             06240010
062500               PV-TOTAL-PRORATED-OTBND                            06250010
062600               PV-TOTAL-PRORATED-DED.                             06260010
062700                                                                  06270010
062800***************************************************************** 06280010
062900*    FOLLOWING LOGIC PRORATES THE FREIGHT AND DISCOUNT AMOUNTS  * 06290010
063000*        AMONG ALL OF THE MAJOR CLASSES (IF THERE ARE MORE THAN * 06300010
063100*        ONE) FOR ONE LISTING.  THE PRORATION IS DONE ACCORDING * 06310010
063200*        TO THE TOTAL NUMBER OF ITEMS IN EACH MAJOR CLASS.      * 06320010
063300*                                                               * 06330010
063400*    FOR EXAMPLE: IF A LISTING HAS $60 IN FREIGHT AND $300 IN   * 06340010
063500*        DISCOUNT AMOUNT AND IT HAS THREE MAJOR CLASSES, ONE    * 06350010
063600*        WITH 10 ITEMS, ONE WITH 30 ITEMS, AND ONE WITH 60      * 06360010
063700*        ITEMS, THE FOLLOWING WILL HAPPEN. FIRST CLASS WILL     * 06370010
063800*        GET 10% OR $36 OF THE TOTAL FREIGHT AND DISCOUNT,      * 06380010
063900*        SECOND CLASS WILL GET 30% OR $108, AND THE THIRD CLASS * 06390010
064000*        WILL GET 60% OR $216.                                  * 06400010
064100*                                                               * 06410010
064200***************************************************************** 06420010
064300     PERFORM VARYING PV-AP-INDEX FROM 1 BY 1                      06430010
064400               UNTIL PV-AP-INDEX > PV-AP-INDEX-MAX                06440010
064500                  OR PV-TBL-AP-DEPT (PV-AP-INDEX) = 0             06450010
064600                                                                  06460010
064700         MOVE PV-AP-INDEX TO PV-AP-DISP-INDEX                     06470010
064800         MOVE PV-AP-INDEX-USED TO PV-AP-DISP-INDEX                06480010
064900         IF PV-AP-INDEX = PV-AP-INDEX-USED                        06490010
065000            COMPUTE PV-TBL-AP-PRORATED-PCT (PV-AP-INDEX) =        06500010
065100                           PV-TBL-DISC-PCT -                      06510010
065200                           PV-TOTAL-PRORATED-PCT                  06520010
065300            COMPUTE PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX) =        06530010
065400                           PV-TBL-DISC-AMT -                      06540010
065500                           PV-TOTAL-PRORATED-AMT                  06550010
065600            COMPUTE PV-TBL-AP-PRORATED-INBD (PV-AP-INDEX) =       06560010
065700                           PV-TBL-INBD-RET-FRGT-AMT -             06570010
065800                           PV-TOTAL-PRORATED-INBD                 06580010
065900            COMPUTE PV-TBL-AP-PRORATED-OTBND (PV-AP-INDEX) =      06590010
066000                           PV-TBL-OTBND-RET-FRGT-AMT -            06600010
066100                           PV-TOTAL-PRORATED-OTBND                06610010
066200            COMPUTE PV-TBL-AP-PRORATED-DED (PV-AP-INDEX) =        06620010
066300                           PV-TBL-DEDUCTION-AMT  -                06630010
066400                           PV-TOTAL-PRORATED-DED                  06640010
066500         ELSE                                                     06650010
066600***************************************************************** 06660010
066700*          FIRST, DETERMINE THE PERCENT THAT EACH SUB CLASS IS  * 06670010
066800*          OF THE MAJOR CLASS BY DIVIDING THE NUMBER OF ITEMS   * 06680010
066900*          FOR THAT SUB CLASS BY THE TOTAL NUMBER OF ITEMS FOR  * 06690010
067000*          THE MAJOR CLASS.                                     * 06700010
067100***************************************************************** 06710010
067200                                                                  06720010
067300           COMPUTE PV-WORK-PERCENT ROUNDED =                      06730010
067400                          (PV-TBL-AP-ITEM-COUNT (PV-AP-INDEX) /   06740010
067500                           PV-TBL-TOTAL-ITEM-COUNT)               06750010
067600                                                                  06760010
067700***************************************************************** 06770010
067800           COMPUTE PV-TBL-AP-PRORATED-PCT (PV-AP-INDEX) ROUNDED = 06780010
067900                           PV-TBL-DISC-PCT *                      06790010
068000                           PV-WORK-PERCENT                        06800010
068100            COMPUTE PV-TOTAL-PRORATED-PCT =                       06810010
068200                            PV-TOTAL-PRORATED-PCT +               06820010
068300                            PV-TBL-AP-PRORATED-PCT (PV-AP-INDEX)  06830010
068400                                                                  06840010
068500***************************************************************** 06850010
068600           COMPUTE PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX) ROUNDED = 06860010
068700                           PV-TBL-DISC-AMT *                      06870010
068800                           PV-WORK-PERCENT                        06880010
068900            COMPUTE PV-TOTAL-PRORATED-AMT =                       06890010
069000                            PV-TOTAL-PRORATED-AMT +               06900010
069100                            PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX)  06910010
069200                                                                  06920010
069300***************************************************************** 06930010
069400            COMPUTE PV-TBL-AP-PRORATED-INBD (PV-AP-INDEX)         06940010
069500                                                   ROUNDED =      06950010
069600                          PV-TBL-INBD-RET-FRGT-AMT *              06960010
069700                          PV-WORK-PERCENT                         06970010
069800            COMPUTE PV-TOTAL-PRORATED-INBD =                      06980010
069900                            PV-TOTAL-PRORATED-INBD +              06990010
070000                            PV-TBL-AP-PRORATED-INBD (PV-AP-INDEX) 07000010
070100                                                                  07010010
070200***************************************************************** 07020010
070300            COMPUTE PV-TBL-AP-PRORATED-OTBND (PV-AP-INDEX)        07030010
070400                                                   ROUNDED =      07040010
070500                          PV-TBL-OTBND-RET-FRGT-AMT *             07050010
070600                          PV-WORK-PERCENT                         07060010
070700            COMPUTE PV-TOTAL-PRORATED-OTBND =                     07070010
070800                            PV-TOTAL-PRORATED-OTBND +             07080010
070900                           PV-TBL-AP-PRORATED-OTBND (PV-AP-INDEX) 07090010
071000                                                                  07100010
071100***************************************************************** 07110010
071200            COMPUTE PV-TBL-AP-PRORATED-DED (PV-AP-INDEX)          07120010
071300                                                   ROUNDED =      07130010
071400                          PV-TBL-DEDUCTION-AMT      *             07140010
071500                          PV-WORK-PERCENT                         07150010
071600            COMPUTE PV-TOTAL-PRORATED-DED   =                     07160010
071700                            PV-TOTAL-PRORATED-DED   +             07170010
071800                           PV-TBL-AP-PRORATED-DED   (PV-AP-INDEX) 07180010
071900         END-IF                                                   07190010
072000     END-PERFORM.                                                 07200010
072100                                                                  07210010
072200***************************************************************** 07220010
072300*  EACH INSERT OR UPDATE WILL BE CHECKED IF IT WAS OK             07230010
072400*    IF ALL UPDATES WERE SUCCESSFUL THE COMMIT WILL BE DONE       07240010
072500*    IF ANY UPDATES FAILED, ALL CHANGES WILL BE ROLL-BACKED       07250010
072600*       AND THE RECORD WILL NOT BE PASSED TO AP                   07260010
072700*    WHEN MULTIPLE LISTING ON A SHIPMENT, ONLY UPDATE THE         07270010
072800*       SHIPT STATUS TABLE THE FIRST TIME                         07280010
072900*    IF THE SHIPT DATE IS FOR A FUTURE DATE, BYPASS THE RECORD AND07290010
073000*       DO NOT UPDATE THE TABLES                                  07300010
073100***************************************************************** 07310010
073200     IF PS-NOT-FUTURE-DATE                                        07320010
073300         SET PS-UPDATE-OK TO TRUE                                 07330010
073400         PERFORM 7000-UPDATE-TDFCTOR-STATUS                       07340010
073500                                                                  07350010
073600         IF PS-UPDATE-OK                                          07360010
073700             PERFORM 7200-INSERT-RVT-DFCT-STAT                    07370010
073800         END-IF                                                   07380010
073900                                                                  07390010
074000         IF PS-UPDATE-OK                                          07400010
074100             IF PS-DFCT-SHIPPED AND PV-PREV-SHIPT-ID > +0         07410010
074200                 IF PS-NEW-SHIPT-ID                               07420010
074300                     SET PS-NOT-NEW-SHIPT-ID TO TRUE              07430010
074400                     PERFORM 7400-INSERT-RVT-SHIPT-STAT           07440010
074500                 ELSE                                             07450010
074600                     IF PV-PREV-SHIPT-ID = DFCTOR-DFCT-SHIPT-ID   07460010
074700                         CONTINUE                                 07470010
074800                     ELSE                                         07480010
074900                         PERFORM 7400-INSERT-RVT-SHIPT-STAT       07490010
075000                     END-IF                                       07500010
075100                 END-IF                                           07510010
075200             END-IF                                               07520010
075300         END-IF                                                   07530010
075400                                                                  07540010
075500         IF PS-UPDATE-OK                                          07550010
075600             PERFORM 7800-COMMIT                                  07560010
075700         ELSE                                                     07570010
075800             PERFORM 7900-ROLLBACK                                07580010
075900         END-IF                                                   07590010
076000                                                                  07600010
076100         IF PS-UPDATE-OK                                          07610010
076200             PERFORM VARYING PV-AP-INDEX FROM 1 BY 1              07620010
076300                 UNTIL PV-AP-INDEX > PV-AP-INDEX-MAX              07630010
076400                    OR PV-TBL-AP-DEPT (PV-AP-INDEX) = 0           07640010
076500                 PERFORM 8400-FORMAT-RV005-RECORD                 07650010
076600             END-PERFORM                                          07660010
076700         END-IF                                                   07670010
076800     END-IF.                                                      07680010
076900                                                                  07690010
077000     PERFORM VARYING PV-AP-INDEX FROM 1 BY 1                      07700010
077100               UNTIL PV-AP-INDEX > PV-AP-INDEX-MAX                07710010
077200         MOVE 0 TO PV-TBL-AP-DEPT (PV-AP-INDEX)                   07720010
077300                   PV-TBL-AP-MAJOR-CLASS (PV-AP-INDEX)            07730010
077400                   PV-TBL-AP-UNIT-COST (PV-AP-INDEX)              07740010
077500                   PV-TBL-AP-RETAIL-COST (PV-AP-INDEX)            07750010
077600                   PV-TBL-AP-ITEM-COUNT  (PV-AP-INDEX)            07760010
077700                   PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX)           07770010
077800                   PV-TBL-AP-PRORATED-PCT (PV-AP-INDEX)           07780010
077900     END-PERFORM.                                                 07790010
078000                                                                  07800010
078100***************************************************************** 07810010
078200*  ACCUMULATE TOTALS                                              07820010
078300***************************************************************** 07830010
078400 2400-ADD-TO-TOTALS.                                              07840010
078500     ADD DFMEIT-UNIT-COST-AMT TO                                  07850010
078600                        PV-TBL-AP-UNIT-COST (PV-AP-INDEX).        07860010
078700     ADD DFMEIT-RTL-COST-AMT  TO                                  07870010
078800                        PV-TBL-AP-RETAIL-COST (PV-AP-INDEX).      07880010
078900     ADD 1 TO PV-TBL-AP-ITEM-COUNT  (PV-AP-INDEX)                 07890010
079000              PV-TBL-TOTAL-ITEM-COUNT.                            07900010
079100                                                                  07910010
079200     IF PV-INBD-RET-FRGT-AMT-NULL                                 07920010
079300        MOVE 0 TO PV-TBL-INBD-RET-FRGT-AMT                        07930010
079400     ELSE                                                         07940010
079500        MOVE DFCTOR-INBD-RET-FRGT-AMT TO PV-TBL-INBD-RET-FRGT-AMT 07950010
079600     END-IF.                                                      07960010
079700     IF PV-OTBND-RET-FRGT-AMT-NULL                                07970010
079800        MOVE 0 TO PV-TBL-OTBND-RET-FRGT-AMT                       07980010
079900     ELSE                                                         07990010
080000        MOVE DFCTOR-OTBND-RET-FRGT-AMT TO                         08000010
080100                          PV-TBL-OTBND-RET-FRGT-AMT               08010010
080200     END-IF.                                                      08020010
080300     IF PV-DED-CHRG-AMT-NULL                                      08030010
080400        MOVE 0 TO PV-TBL-DEDUCTION-AMT                            08040010
080500     ELSE                                                         08050010
080600        MOVE DFCTOR-DED-CHRG-AMT TO PV-TBL-DEDUCTION-AMT          08060010
080700     END-IF.                                                      08070010
080800     IF PV-DISC-AMT-NULL                                          08080010
080900        MOVE 0 TO PV-TBL-DISC-AMT                                 08090010
081000     ELSE                                                         08100010
081100        MOVE DFCTOR-DISC-AMT  TO PV-TBL-DISC-AMT                  08110010
081200     END-IF.                                                      08120010
081300     IF PV-DISC-PCT-NULL                                          08130010
081400        MOVE 0 TO PV-TBL-DISC-PCT                                 08140010
081500     ELSE                                                         08150010
081600        MOVE DFCTOR-DISC-PCT TO PV-TBL-DISC-PCT                   08160010
081700     END-IF.                                                      08170010
081800                                                                  08180010
081900     MOVE DFCTOR-CART-QTY    TO PV-CARTON-QTY.                    08190010
082000                                                                  08200010
082100***************************************************************** 08210010
082200* SAVE FIELDS FOR LATER USE                                       08220010
082300***************************************************************** 08230010
082400 2800-SAVE-FIELDS.                                                08240010
082500     MOVE DFCTOR-DFCT-ORD-ID    TO PV-PREV-DFCT-ORD-ID.           08250010
082600     MOVE DFCTOR-DFCT-SHIPT-ID  TO PV-PREV-SHIPT-ID.              08260010
082700     MOVE DFMEIT-MDSE-DEPT-NBR  TO PV-PREV-DEPT                   08270010
082800                            PV-TBL-AP-DEPT (PV-AP-INDEX).         08280010
082900                                                                  08290010
083000     STRING '00'                                                  08300010
083100             DFMEIT-MDSE-CLASS-NBR (1:2)                          08310018
083300             DELIMITED BY SIZE                                    08330010
083400             INTO PV-PREV-CLASS.                                  08340010
083500     MOVE PV-PREV-CLASS TO PV-TBL-AP-MAJOR-CLASS (PV-AP-INDEX).   08350010
083600     MOVE DFCTOR-DFCT-ORD-ID-CDE   TO PV-DFCT-ORD-ID-CDE.         08360010
083700     MOVE DFCTOR-CARR-TRKG-ID      TO PV-TRACKING-NBR.            08370010
083800     MOVE RVT00000-TRLR-ID         TO PV-TRAILER-NBR.             08380010
083900     MOVE RVT00000-SCAC-CDE        TO PV-CARRIER.                 08390010
084000                                                                  08400010
084100     MOVE DFCTOR-VENDOR-DUNS-NBR   TO PV-VENDOR-DUNS-NBR.         08410010
084200     MOVE DFCTOR-STATUS-CHG-DTE    TO PV-STATUS-CHG-DTE.          08420010
084300                                                                  08430010
084400     MOVE DFCTOR-VND-AUTH-ID       TO PV-VND-AUTH-ID.             08440010
084500     MOVE EXTENT-ENT-ID            TO PV-ENT-ID.                  08450010
084600     MOVE ENTNME-ENT-NAME-DESC     TO PV-ENT-NAME-DESC.           08460010
084700                                                                  08470010
084800***************************************************************** 08480010
084900*   SELECT THE AP BATCH PROCESS DATE FROM TAPCNTL, 1 ROW TABLE    08490010
085000*   ADD 1 DAY TO PROCESS DATE BECAUSE THESE TRANSACTIONS WILL BE  08500010
085100*      CREATED AFTER AP RUNS FOR THE CURRENT DAY                  08510010
085200***************************************************************** 08520010
085300 5000-SELECT-TAPCNTL.                                             08530010
085400     INITIALIZE APCNTL-BTCH-PRC-DTE.                              08540010
085500                                                                  08550010
085600     PERFORM                                                      08560010
085700         WITH TEST AFTER                                          08570010
085800         VARYING PV-RETRY-COUNT                                   08580010
085900         FROM 1 BY 1                                              08590010
086000         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    08600010
086100            OR SQLCODE = 0                                        08610010
086200                                                                  08620010
086300         EXEC SQL                                                 08630010
086400             SELECT BTCH_PRC_DTE + 1 DAY                          08640010
086500             INTO :APCNTL-BTCH-PRC-DTE                            08650010
086600             FROM TAPCNTL                                         08660010
086700         END-EXEC                                                 08670010
086800                                                                  08680010
086900         EVALUATE TRUE                                            08690010
087000             WHEN SQLCODE = +0                                    08700010
087100             WHEN SQLCODE = -904                                  08710010
087200             WHEN SQLCODE = -913                                  08720010
087300                 CONTINUE                                         08730010
087400             WHEN OTHER                                           08740010
087500                 MOVE '5000-SELECT-TAPCNTL' TO PV-PARAGRAPH       08750010
087600                 MOVE 'SELECT       ' TO PV-DB2-FUNCTION          08760010
087700                 MOVE 'TAPCNTL'       TO PV-ABEND-STRUCTURE-1     08770010
087800                 MOVE SPACES          TO PV-ABEND-STRUCTURE-2     08780010
087900                                         PV-ABEND-STRUCTURE-3     08790010
088000                 PERFORM 9200-SQL-ERROR                           08800010
088100         END-EVALUATE                                             08810010
088200     END-PERFORM.                                                 08820010
088300                                                                  08830010
088400     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           08840010
088500         MOVE '5000-SELECT-TAPCNTL   ' TO PV-PARAGRAPH            08850010
088600         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         08860010
088700         MOVE 'TAPCNTL'                TO PV-ABEND-STRUCTURE-1    08870010
088800         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    08880010
088900                                          PV-ABEND-STRUCTURE-3    08890010
089000         PERFORM 9200-SQL-ERROR                                   08900010
089100     END-IF.                                                      08910010
089200                                                                  08920010
089300***************************************************************** 08930010
089400*   SELECT INFORMATION FROM TTRNCDE, BASED ON TYPE OF TRANSACTION 08940010
089500***************************************************************** 08950010
089600 5100-SELECT-TTRNCDE.                                             08960010
089700     PERFORM                                                      08970010
089800         WITH TEST AFTER                                          08980010
089900         VARYING PV-RETRY-COUNT                                   08990010
090000         FROM 1 BY 1                                              09000010
090100         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    09010010
090200            OR SQLCODE = 0                                        09020010
090300                                                                  09030010
090400         EXEC SQL                                                 09040010
090500             SELECT PSTG_TYP_CDE                                  09050010
090600                  , TRN_TYP_CDE                                   09060010
090700                  , GL_ACCT_NBR                                   09070010
090800                  , BTCH_SRC_CDE                                  09080010
090900               INTO :TRNCDE-PSTG-TYP-CDE                          09090010
091000                  , :TRNCDE-TRN-TYP-CDE                           09100010
091100                  , :TRNCDE-GL-ACCT-NBR                           09110010
091200                  , :TRNCDE-BTCH-SRC-CDE                          09120010
091300               FROM TTRNCDE                                       09130010
091400              WHERE AP_TRN_CDE = :TRNCDE-AP-TRN-CDE               09140010
091500                AND EFF_STRT_DTE <= :APCNTL-BTCH-PRC-DTE          09150010
091600                AND EFF_END_DTE >= :APCNTL-BTCH-PRC-DTE           09160010
091700         END-EXEC                                                 09170010
091800                                                                  09180010
091900         EVALUATE TRUE                                            09190010
092000             WHEN SQLCODE = ZERO                                  09200010
092100                  MOVE TRNCDE-PSTG-TYP-CDE TO                     09210010
092200                                       PV-PSTG-TYP-CDE (PV-SUB)   09220010
092300                  MOVE TRNCDE-TRN-TYP-CDE TO                      09230010
092400                                       PV-TRN-TYP-CDE (PV-SUB)    09240010
092500                  MOVE TRNCDE-GL-ACCT-NBR TO                      09250010
092600                                       PV-GL-ACCT-NBR (PV-SUB)    09260010
092700                  MOVE TRNCDE-BTCH-SRC-CDE TO                     09270010
092800                                       PV-BTCH-SRC-CDE (PV-SUB)   09280010
092900             WHEN SQLCODE = -904                                  09290010
093000             WHEN SQLCODE = -913                                  09300010
093100                 CONTINUE                                         09310010
093200             WHEN OTHER                                           09320010
093300                 MOVE '5100-SELECT-TTRNCDE' TO PV-PARAGRAPH       09330010
093400                 MOVE 'SELECT'          TO PV-DB2-FUNCTION        09340010
093500                 MOVE 'TTRNCDE'         TO PV-ABEND-STRUCTURE-1   09350010
093600                 MOVE SPACES            TO PV-ABEND-STRUCTURE-2   09360010
093700                                           PV-ABEND-STRUCTURE-3   09370010
093800                 PERFORM 9200-SQL-ERROR                           09380010
093900         END-EVALUATE                                             09390010
094000     END-PERFORM.                                                 09400010
094100                                                                  09410010
094200     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           09420010
094300         MOVE '5100-SELECT-TTRNCDE   ' TO PV-PARAGRAPH            09430010
094400         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         09440010
094500         MOVE 'TTRNCDE'                TO PV-ABEND-STRUCTURE-1    09450010
094600         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    09460010
094700                                          PV-ABEND-STRUCTURE-3    09470010
094800         PERFORM 9200-SQL-ERROR                                   09480010
094900     END-IF.                                                      09490010
095000                                                                  09500010
095100***************************************************************** 09510010
095200*   SELECT ENT-ID FROM TEXTENT BASED ON VENDOR DUNS NUMBER AND    09520010
095300*   SELECT ENT-NAME-DESC FROM TENTNME                             09530010
095400***************************************************************** 09540010
095500 5200-SELECT-TEXTENT.                                             09550010
095600     INITIALIZE DCLTEXTENT.                                       09560010
095700     INITIALIZE DCLTENTNME.                                       09570010
095800     PERFORM                                                      09580010
095900         WITH TEST AFTER                                          09590010
096000         VARYING PV-RETRY-COUNT                                   09600010
096100         FROM 1 BY 1                                              09610010
096200         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    09620010
096300            OR SQLCODE = 0                                        09630010
096400                                                                  09640010
096500         EXEC SQL                                                 09650010
096600             SELECT EXTENT.ENT_ID                                 09660010
096700                  , ENTNME.ENT_NAME_DESC                          09670010
096800               INTO :EXTENT-ENT-ID                                09680010
096900                  , :ENTNME-ENT-NAME-DESC                         09690010
097000               FROM TEXTENT EXTENT                                09700010
097100                  , TENTNME ENTNME                                09710010
097200              WHERE EXTENT.DUN_NBR = :DFCTOR-VENDOR-DUNS-NBR      09720010
097300                AND EXTENT.ENT_ID  = ENTNME.ENT_ID                09730010
097400                AND ENTNME.TYPE_CDE = '01'                        09740010
097500         END-EXEC                                                 09750010
097600                                                                  09760010
097700         EVALUATE TRUE                                            09770010
097800             WHEN SQLCODE = ZERO                                  09780010
097900                 CONTINUE                                         09790010
098000             WHEN SQLCODE = -904                                  09800010
098100             WHEN SQLCODE = -913                                  09810010
098200                 CONTINUE                                         09820010
098300             WHEN OTHER                                           09830010
098400                  MOVE '5200-SELECT-TEXTENT' TO PV-PARAGRAPH      09840010
098500                  MOVE 'SELECT ON TEXTENT'   TO PV-DB2-FUNCTION   09850010
098600                  STRING 'DUNS NBR: '                             09860010
098700                          DFCTOR-VENDOR-DUNS-NBR                  09870010
098800                          DELIMITED BY SIZE                       09880010
098900                          INTO PV-ERROR-MSG                       09890010
099000                  MOVE 'TEXTENT'         TO PV-ABEND-STRUCTURE-1  09900010
099100                  MOVE SPACES            TO PV-ABEND-STRUCTURE-2  09910010
099200                                            PV-ABEND-STRUCTURE-3  09920010
099300                  PERFORM 9200-SQL-ERROR                          09930010
099400         END-EVALUATE                                             09940010
099500     END-PERFORM.                                                 09950010
099600                                                                  09960010
099700     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           09970010
099800        MOVE '5200-SELECT-TEXTENT   ' TO PV-PARAGRAPH             09980010
099900        MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION          09990010
100000        MOVE 'TEXTENT'                TO PV-ABEND-STRUCTURE-1     10000010
100100        MOVE SPACES                   TO PV-ABEND-STRUCTURE-2     10010010
100200                                         PV-ABEND-STRUCTURE-3     10020010
100300        PERFORM 9200-SQL-ERROR                                    10030010
100400     END-IF.                                                      10040010
100500                                                                  10050010
100600***************************************************************** 10060010
100700*   CHANGED TO SELECT THE RTV LOC LOCATION NBR INSTEAD OF DC_NBR  10070010
100800***************************************************************** 10080010
100900 5300-GET-RTV-DC-ID.                                              10090010
101000     IF DFCTOR-OPER-UNT-ID = PC-OPER-UNT-ID-TEST-CORP             10100010
101100         MOVE PC-OPER-UNT-ID-FINDLAY TO PV-WORK-OPER-UNT-ID       10110010
101200                                        PV-WORK-OPER-UNT-ID-COMP  10120010
101300     ELSE                                                         10130010
101400         MOVE DFCTOR-OPER-UNT-ID    TO PV-WORK-OPER-UNT-ID        10140010
101500                                        PV-WORK-OPER-UNT-ID-COMP  10150010
101600     END-IF.                                                      10160010
101700                                                                  10170010
101800     INITIALIZE DCLXLT00010                                       10180010
101900                DCLXLT00014.                                      10190010
102000                                                                  10200010
102100     PERFORM                                                      10210010
102200         WITH TEST AFTER                                          10220010
102300         VARYING PV-RETRY-COUNT                                   10230010
102400         FROM 1 BY 1                                              10240010
102500         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    10250010
102600            OR SQLCODE = 0                                        10260010
102700                                                                  10270010
102800         EXEC SQL                                                 10280010
102900             SELECT B.LOC_NBR                                     10290010
103000                  , B.LOC_NM                                      10300010
103100               INTO :XLT00010-LOC-NBR                             10310010
103200                  , :XLT00010-LOC-NM                              10320010
103300               FROM XLT_DC_LOC_ASGMT A                            10330010
103400                  , XLT_LOC          B                            10340010
103500              WHERE A.LOC_NBR = :PV-WORK-OPER-UNT-ID-COMP         10350010
103600                AND A.LOC_NBR = B.LOC_NBR                         10360010
103700                AND B.LOC_TYP_CDE = 'RV'                          10370010
103800                AND (CHAR(CURRENT_DATE, ISO)                      10380010
103900                      BETWEEN                                     10390010
104000                      CHAR(B.OPN_DTE,ISO)                         10400010
104100                          AND                                     10410010
104200                      CHAR(B.CLO_DTE,ISO))                        10420010
104300         END-EXEC                                                 10430010
104400                                                                  10440010
104500         EVALUATE TRUE                                            10450010
104600             WHEN SQLCODE = ZERO                                  10460010
104700             WHEN SQLCODE = -904                                  10470010
104800             WHEN SQLCODE = -913                                  10480010
104900                 CONTINUE                                         10490010
105000             WHEN OTHER                                           10500010
105100                 MOVE '5300-GET-RTV-DC-ID' TO PV-PARAGRAPH        10510010
105200                 MOVE 'SELECT ON XLT_LOC'  TO PV-DB2-FUNCTION     10520010
105300                 STRING 'RTV LOC ==> '                            10530010
105400                         PV-WORK-OPER-UNT-ID                      10540010
105500                         DELIMITED BY SIZE                        10550010
105600                         INTO PV-ERROR-MSG                        10560010
105700                 MOVE 'XLT_LOC'          TO PV-ABEND-STRUCTURE-1  10570010
105800                 MOVE 'XLT_DC_LOC_ASGMT' TO PV-ABEND-STRUCTURE-2  10580010
105900                 MOVE SPACES             TO PV-ABEND-STRUCTURE-3  10590010
106000                 PERFORM 9200-SQL-ERROR                           10600010
106100         END-EVALUATE                                             10610010
106200     END-PERFORM.                                                 10620010
106300                                                                  10630010
106400     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           10640010
106500         MOVE '5300-GET-RTV-DC-ID    ' TO PV-PARAGRAPH            10650010
106600         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         10660010
106700         MOVE 'XLT_LOC'                TO PV-ABEND-STRUCTURE-1    10670010
106800         MOVE 'XLT_DC_LOC_ASGMT'       TO PV-ABEND-STRUCTURE-2    10680010
106900         MOVE SPACES                   TO PV-ABEND-STRUCTURE-3    10690010
107000         PERFORM 9200-SQL-ERROR                                   10700010
107100     END-IF.                                                      10710010
107200                                                                  10720010
107300***************************************************************** 10730010
107400*  OPEN CURSOR                                                    10740010
107500***************************************************************** 10750010
107600 6000-OPEN-TDFCTOR-CSR.                                           10760010
107700     PERFORM                                                      10770010
107800         WITH TEST AFTER                                          10780010
107900         VARYING PV-RETRY-COUNT                                   10790010
108000         FROM 1 BY 1                                              10800010
108100         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    10810010
108200            OR SQLCODE = 0                                        10820010
108300            OR SQLCODE = +100                                     10830010
108400                                                                  10840010
108500         EXEC SQL                                                 10850010
108600              OPEN  EXTRACT_CURSOR                                10860010
108700         END-EXEC                                                 10870010
108800                                                                  10880010
108900         EVALUATE TRUE                                            10890010
109000             WHEN SQLCODE = ZERO                                  10900010
109100             WHEN SQLCODE = -904                                  10910010
109200             WHEN SQLCODE = -913                                  10920010
109300                 CONTINUE                                         10930010
109400             WHEN OTHER                                           10940010
109500                 MOVE '6000-OPEN-TDFCTOR-CSR' TO PV-PARAGRAPH     10950010
109600                 MOVE 'OPEN TDFCTOR CURSOR' TO PV-DB2-FUNCTION    10960010
109700                 STRING 'RTV LOC ==> '                            10970010
109800                         PV-WORK-OPER-UNT-ID                      10980010
109900                         DELIMITED BY SIZE                        10990010
110000                         INTO PV-ERROR-MSG                        11000010
110100                 MOVE 'OPEN OF TDFCTOR' TO PV-ERROR-MSG           11010010
110200                 MOVE 'TDFCTOR'         TO PV-ABEND-STRUCTURE-1   11020010
110300                 MOVE SPACES            TO PV-ABEND-STRUCTURE-2   11030010
110400                                           PV-ABEND-STRUCTURE-3   11040010
110500                 PERFORM 9200-SQL-ERROR                           11050010
110600         END-EVALUATE                                             11060010
110700     END-PERFORM.                                                 11070010
110800                                                                  11080010
110900     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           11090010
111000         MOVE '6000-OPEN-TDFCTOR-CSR' TO PV-PARAGRAPH             11100010
111100         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         11110010
111200         MOVE 'TDFCTOR'                TO PV-ABEND-STRUCTURE-1    11120010
111300         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    11130010
111400                                          PV-ABEND-STRUCTURE-3    11140010
111500         PERFORM 9200-SQL-ERROR                                   11150010
111600     END-IF.                                                      11160010
111700                                                                  11170010
111800***************************************************************** 11180010
111900* FETCH CURSOR                                                    11190010
112000***************************************************************** 11200010
112100 6200-FETCH-TDFCTOR.                                              11210010
112200     INITIALIZE DCLTDFCTOR.                                       11220010
112300     PERFORM                                                      11230010
112400         WITH TEST AFTER                                          11240010
112500         VARYING PV-RETRY-COUNT                                   11250010
112600         FROM 1 BY 1                                              11260010
112700         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    11270010
112800            OR SQLCODE = 0                                        11280010
112900            OR SQLCODE = +100                                     11290010
113000                                                                  11300010
113100         EXEC SQL                                                 11310010
113200             FETCH  EXTRACT_CURSOR                                11320010
113300              INTO :DFCTOR-DFCT-ORD-ID                            11330010
113400                  ,:DFCTOR-VENDOR-DUNS-NBR                        11340010
113500                  ,:DFCTOR-VEND-NAME                              11350010
113600                  ,:DFCTOR-OPER-UNT-ID                            11360010
113700                  ,:DFCTOR-DFCT-ORD-ID-CDE                        11370010
113800                  ,:DFCTOR-STATUS-CHG-DTE                         11380010
113900                  ,:DFCTOR-DFCT-ORD-STAT-CDE                      11390010
114000                  ,:DFCTOR-DFCT-SHIPT-ID                          11400010
114100                                 :PV-DFCT-SHIPT-ID-IND            11410010
114200                  ,:DFCTOR-VND-AUTH-ID                            11420010
114300                                 :PV-VND-AUTH-ID-IND              11430010
114400                  ,:DFCTOR-VND-AUTH-DTE                           11440010
114500                                 :PV-VND-AUTH-DTE-IND             11450010
114600                  ,:DFCTOR-INBD-RET-FRGT-AMT                      11460010
114700                                 :PV-INBD-RET-FRGT-AMT-IND        11470010
114800                  ,:DFCTOR-OTBND-RET-FRGT-AMT                     11480010
114900                                 :PV-OTBND-RET-FRGT-AMT-IND       11490010
115000                  ,:DFCTOR-DED-CHRG-AMT                           11500010
115100                                 :PV-DED-CHRG-AMT-IND             11510010
115200                  ,:DFCTOR-DISC-PCT                               11520010
115300                                 :PV-DISC-PCT-IND                 11530010
115400                  ,:DFCTOR-DISC-AMT                               11540010
115500                                 :PV-DISC-AMT-IND                 11550010
115600                  ,:DFCTOR-CARR-TRKG-ID                           11560010
115700                                 :PV-CARR-TRKG-ID-IND             11570010
115800                  ,:DFCTOR-CART-QTY                               11580010
115900                                 :PV-CART-QTY-IND                 11590010
116000                  ,:DFCTOR-PAYT-TYP-CDE                           11600010
116100                                 :PV-PAYT-TYP-CDE-IND             11610010
116200                  ,:DFMEIT-RTL-COST-AMT                           11620010
116300                  ,:DFMEIT-UNIT-COST-AMT                          11630010
116400                  ,:DFMEIT-MDSE-DEPT-NBR                          11640010
116500                  ,:DFMEIT-MDSE-CLASS-NBR                         11650010
116600                  ,:DFMEIT-SEQ-NBR                                11660010
116700         END-EXEC                                                 11670010
116800                                                                  11680010
116900         EVALUATE TRUE                                            11690010
117000             WHEN SQLCODE = ZERO                                  11700010
117100                  STRING '0' DFMEIT-MDSE-DEPT-NBR                 11710010
117200                          DELIMITED BY SIZE                       11720010
117300                          INTO PV-WORK-DEPT                       11730010
117400                  STRING '00' DFMEIT-MDSE-CLASS-NBR               11740010
117500                          DELIMITED BY SIZE                       11750010
117600                          INTO PV-WORK-CLASS                      11760010
117700                  ADD 1 TO PV-CURSOR-COUNT                        11770010
117800             WHEN SQLCODE = +100                                  11780010
117900                  SET PS-END-OF-CURSOR TO TRUE                    11790010
118000             WHEN SQLCODE = -904                                  11800010
118100             WHEN SQLCODE = -913                                  11810010
118200                 CONTINUE                                         11820010
118300             WHEN OTHER                                           11830010
118400                 MOVE '6200-FETCH-TDFCTOR' TO PV-PARAGRAPH        11840010
118500                 MOVE 'SELECT ON TDFCTOR'  TO PV-DB2-FUNCTION     11850010
118600                 STRING 'RTV LOC ==> '                            11860010
118700                         PV-WORK-OPER-UNT-ID                      11870010
118800                         DELIMITED BY SIZE                        11880010
118900                         INTO PV-ERROR-MSG                        11890010
119000                 MOVE 'SELECT ON TDFCTOR'  TO PV-ERROR-MSG        11900010
119100                 MOVE 'TDFCTOR'            TO PV-ABEND-STRUCTURE-111910010
119200                 MOVE SPACES               TO PV-ABEND-STRUCTURE-211920010
119300                                              PV-ABEND-STRUCTURE-311930010
119400                 PERFORM 9200-SQL-ERROR                           11940010
119500         END-EVALUATE                                             11950010
119600     END-PERFORM.                                                 11960010
119700                                                                  11970010
119800     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           11980010
119900         MOVE '6200-FETCH-TDFCTOR    ' TO PV-PARAGRAPH            11990010
120000         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         12000010
120100         MOVE 'TDFCTOR'                TO PV-ABEND-STRUCTURE-1    12010010
120200         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    12020010
120300                                          PV-ABEND-STRUCTURE-3    12030010
120400         PERFORM 9200-SQL-ERROR                                   12040010
120500     END-IF.                                                      12050010
120600                                                                  12060010
120700***************************************************************** 12070010
120800* GET INFO FROM OTHER TABLES ONLY ONE TIME PER VENDOR/LISTING     12080010
120900* WHEN THE ACTL-SHIPT-DATE IS OBTAINED, IF THE SHIPT DATE IS      12090010
121000*   GREATER THAN THE CURRENT DATE, THIS RECORD SHOULD SKIPPED, THE12100010
121100*   ENTRY WAS CREATED FOR A DEBIT THAT WILL ONLY BE SHIPPED THE   12110010
121200*   NEXT DAY                                                      12120010
121300***************************************************************** 12130010
121400 6300-GET-OTHER-INFO.                                             12140010
121500     IF DFCTOR-DFCT-ORD-ID NOT = PV-PREV-DFCT-ORD-ID OR           12150010
121600         PS-END-OF-CURSOR OR                                      12160010
121700         PS-FIRST-TIME                                            12170010
121800         PERFORM 5200-SELECT-TEXTENT                              12180010
121900         PERFORM 5300-GET-RTV-DC-ID                               12190010
122000                                                                  12200010
122100         IF PV-DFCT-SHIPT-ID-NOT-NULL                             12210010
122200             MOVE DFCTOR-DFCT-SHIPT-ID TO PV-DFCT-SHIPT-ID        12220010
122300             PERFORM 6500-GET-ACTL-SHIPT-DTE                      12230010
122400         ELSE                                                     12240010
122500************ THIS IS A LISTING THAT IS GOING TO BE DISPOSED       12250010
122600             SET PS-NOT-FUTURE-DATE TO TRUE                       12260010
122700         END-IF                                                   12270010
122800     END-IF.                                                      12280010
122900                                                                  12290010
123000     IF PS-DONT-BYPASS                                            12300010
123100         MOVE DFCTOR-DFCT-ORD-ID-CDE TO PS-DFCT-ORD-ID-CDE        12310010
123200         MOVE DFCTOR-DFCT-ORD-STAT-CDE TO PS-DFCT-ORD-STAT-CDE    12320010
123300                                                                  12330010
123400         IF PS-NEW-SHIPT-ID                                       12340010
123500             SET PS-NOT-NEW-SHIPT-ID TO TRUE                      12350010
123600         ELSE                                                     12360010
123700             IF PV-PREV-SHIPT-ID = DFCTOR-DFCT-SHIPT-ID           12370010
123800                 SET PS-NOT-NEW-SHIPT-ID TO TRUE                  12380010
123900             ELSE                                                 12390010
124000                 SET PS-NEW-SHIPT-ID TO TRUE                      12400010
124100             END-IF                                               12410010
124200         END-IF                                                   12420010
124300     END-IF.                                                      12430010
124400                                                                  12440010
124500***************************************************************** 12450010
124600* CLOSE CURSOR                                                    12460010
124700***************************************************************** 12470010
124800 6400-CLOSE-TDFCTOR-CSR.                                          12480010
124900     PERFORM                                                      12490010
125000         WITH TEST AFTER                                          12500010
125100         VARYING PV-RETRY-COUNT                                   12510010
125200         FROM 1 BY 1                                              12520010
125300         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    12530010
125400            OR SQLCODE = 0                                        12540010
125500                                                                  12550010
125600         EXEC SQL                                                 12560010
125700              CLOSE EXTRACT_CURSOR                                12570010
125800         END-EXEC                                                 12580010
125900                                                                  12590010
126000         EVALUATE TRUE                                            12600010
126100             WHEN SQLCODE = ZERO                                  12610010
126200             WHEN SQLCODE = -904                                  12620010
126300             WHEN SQLCODE = -913                                  12630010
126400                 CONTINUE                                         12640010
126500             WHEN OTHER                                           12650010
126600                 MOVE '6400-CLOSE-TDFCTOR-CSR' TO PV-PARAGRAPH    12660010
126700                 MOVE 'CLOSE TDFCTOR CURSOR' TO PV-DB2-FUNCTION   12670010
126800                 STRING 'RTV LOC ==> '                            12680010
126900                         PV-WORK-OPER-UNT-ID                      12690010
127000                         DELIMITED BY SIZE                        12700010
127100                         INTO PV-ERROR-MSG                        12710010
127200                 MOVE 'CLOSE OF TDFCTOR' TO PV-ERROR-MSG          12720010
127300                 MOVE 'TDFCTOR'       TO PV-ABEND-STRUCTURE-1     12730010
127400                 MOVE SPACES          TO PV-ABEND-STRUCTURE-2     12740010
127500                                             PV-ABEND-STRUCTURE-3 12750010
127600                 PERFORM 9200-SQL-ERROR                           12760010
127700         END-EVALUATE                                             12770010
127800     END-PERFORM.                                                 12780010
127900                                                                  12790010
128000     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           12800010
128100         MOVE '6400-CLOSE-TDFCTOR-CSR' TO PV-PARAGRAPH            12810010
128200         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         12820010
128300         MOVE 'TDFCTOR'                TO PV-ABEND-STRUCTURE-1    12830010
128400         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    12840010
128500                                          PV-ABEND-STRUCTURE-3    12850010
128600         PERFORM 9200-SQL-ERROR                                   12860010
128700     END-IF.                                                      12870010
128800                                                                  12880010
128900***************************************************************** 12890010
129000*   SELECT ACTUAL SHIPT DATE WHEN LISTING HAS BEEN SHIPPED        12900010
129100*   ACTUAL SHIP DATE WILL BE USED AS INVENTORY CUTOFF DATE        12910010
129200***************************************************************** 12920010
129300 6500-GET-ACTL-SHIPT-DTE.                                         12930010
129400     INITIALIZE DCLRVT00000.                                      12940010
129500     MOVE DFCTOR-DFCT-SHIPT-ID TO RVT00000-DFCT-SHIPT-ID.         12950010
129600     SET PS-DONT-BYPASS TO TRUE.                                  12960010
129700     SET PS-NOT-FUTURE-DATE TO TRUE.                              12970010
129800                                                                  12980010
129900     PERFORM                                                      12990010
130000         WITH TEST AFTER                                          13000010
130100         VARYING PV-RETRY-COUNT                                   13010010
130200         FROM 1 BY 1                                              13020010
130300         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    13030010
130400            OR SQLCODE = 0                                        13040010
130500                                                                  13050010
130600         EXEC SQL                                                 13060010
130700             SELECT ACTL_SHIPT_DTE                                13070010
130800                  , TRLR_ID                                       13080010
130900                  , SCAC_CDE                                      13090010
131000               INTO :RVT00000-ACTL-SHIPT-DTE                      13100010
131100                  , :RVT00000-TRLR-ID                             13110010
131200                  , :RVT00000-SCAC-CDE                            13120010
131300               FROM RVT_DFCT_SHIPT                                13130010
131400              WHERE DFCT_SHIPT_ID  = :RVT00000-DFCT-SHIPT-ID      13140010
131500         END-EXEC                                                 13150010
131600                                                                  13160010
131700         EVALUATE TRUE                                            13170010
131800             WHEN SQLCODE = ZERO                                  13180010
131900                 IF RVT00000-ACTL-SHIPT-DTE > PV-CURRENT-DATE     13190010
132000                     SET PS-BYPASS TO TRUE                        13200010
132100                     SET PS-FUTURE-DATE TO TRUE                   13210010
132200                 ELSE                                             13220010
132300                     MOVE RVT00000-ACTL-SHIPT-DTE                 13230010
132400                                            TO PV-ACTL-SHIPT-DTE  13240010
132500                     SET PS-DONT-BYPASS TO TRUE                   13250010
132600                     SET PS-NOT-FUTURE-DATE TO TRUE               13260010
132700                 END-IF                                           13270010
132800             WHEN SQLCODE = -904                                  13280010
132900             WHEN SQLCODE = -913                                  13290010
133000                 CONTINUE                                         13300010
133100             WHEN OTHER                                           13310010
133200                  MOVE '6500-GET-ACTL-SHIPT-DTE' TO PV-PARAGRAPH  13320010
133300                  MOVE 'SELECT SHIPT ID '   TO PV-DB2-FUNCTION    13330010
133400                  MOVE DFCTOR-DFCT-SHIPT-ID                       13340010
133500                                         TO PV-WORK-DFCT-SHIPT-ID 13350010
133600                  MOVE 'RVT_DFCT_SHIPT'  TO PV-ABEND-STRUCTURE-1  13360010
133700                  MOVE 'DFCT-SHIPT-ID :' TO PV-ABEND-STRUCTURE-2  13370010
133800                  MOVE PV-WORK-DFCT-SHIPT-ID                      13380010
133900                                         TO PV-ABEND-STRUCTURE-3  13390010
134000                  PERFORM 9200-SQL-ERROR                          13400010
134100         END-EVALUATE                                             13410010
134200     END-PERFORM.                                                 13420010
134300                                                                  13430010
134400     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           13440010
134500        MOVE '6500-GET-ACTL-SHIPT-DTE' TO PV-PARAGRAPH            13450010
134600        MOVE 'MAX RETRIES EXCEEDED  '  TO PV-DB2-FUNCTION         13460010
134700        MOVE 'RVT_DFCT_SHIPT'          TO PV-ABEND-STRUCTURE-1    13470010
134800        MOVE SPACES                    TO PV-ABEND-STRUCTURE-2    13480010
134900        MOVE PV-WORK-DFCT-SHIPT-ID     TO PV-ABEND-STRUCTURE-3    13490010
135000        PERFORM 9200-SQL-ERROR                                    13500010
135100     END-IF.                                                      13510010
135200                                                                  13520010
135300***************************************************************** 13530010
135400*  UPDATE STATUS AND STATUS CHANGE DATE ON TDFCTOR                13540010
135500***************************************************************** 13550010
135600 7000-UPDATE-TDFCTOR-STATUS.                                      13560010
135700     PERFORM                                                      13570010
135800         WITH TEST AFTER                                          13580010
135900         VARYING PV-RETRY-COUNT                                   13590010
136000         FROM 1 BY 1                                              13600010
136100         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    13610010
136200            OR SQLCODE = 0                                        13620010
136300                                                                  13630010
136400         EXEC SQL                                                 13640010
136500              UPDATE  TDFCTOR                                     13650010
136600                 SET  STATUS_CHG_DTE    = :PV-CURRENT-DATE        13660010
136700                     ,DFCT_ORD_STAT_CDE = 'A'                     13670010
136800              WHERE DFCT_ORD_ID = :PV-PREV-DFCT-ORD-ID            13680010
136900         END-EXEC                                                 13690010
137000                                                                  13700010
137100         EVALUATE TRUE                                            13710010
137200             WHEN SQLCODE = ZERO                                  13720010
137300                 ADD 1 TO PV-TDFCTOR-UPDATES                      13730010
137400                 SET PS-UPDATE-OK TO TRUE                         13740010
137500             WHEN SQLCODE = -904                                  13750010
137600             WHEN SQLCODE = -913                                  13760010
137700                 CONTINUE                                         13770010
137800             WHEN OTHER                                           13780010
137900                 SET PS-UPDATE-NOT-OK TO TRUE                     13790010
138000                 MOVE '7000-UPDATE-TDFCTOR-STATUS' TO             13800010
138100                                           PV-PARAGRAPH           13810010
138200                 MOVE 'UPDATE TDFCTOR' TO PV-DB2-FUNCTION         13820010
138300                 MOVE DFCTOR-DFCT-ORD-ID TO PV-DFCT-ORD-ID        13830010
138400                 STRING 'ORDER ID -------> '                      13840010
138500                         PV-DFCT-ORD-ID                           13850010
138600                         DELIMITED BY SIZE                        13860010
138700                         INTO PV-ERROR-MSG                        13870010
138800                 MOVE 'TDFCTOR'       TO PV-ABEND-STRUCTURE-1     13880010
138900                 MOVE SPACES          TO PV-ABEND-STRUCTURE-2     13890010
139000                                         PV-ABEND-STRUCTURE-3     13900010
139100                 PERFORM 9200-SQL-ERROR                           13910010
139200         END-EVALUATE                                             13920010
139300     END-PERFORM.                                                 13930010
139400                                                                  13940010
139500     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           13950010
139600         SET PS-UPDATE-NOT-OK TO TRUE                             13960010
139700         MOVE '7000-UPDATE-TDFCTOR-STATUS' TO PV-PARAGRAPH        13970010
139800         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         13980010
139900         MOVE 'TDFCTOR'                TO PV-ABEND-STRUCTURE-1    13990010
140000         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    14000010
140100                                          PV-ABEND-STRUCTURE-3    14010010
140200         PERFORM 9200-SQL-ERROR                                   14020010
140300     END-IF.                                                      14030010
140400                                                                  14040010
140500***************************************************************** 14050010
140600*  INSERT ROW ON DEFECT STATUS TABLE                              14060010
140700***************************************************************** 14070010
140800 7200-INSERT-RVT-DFCT-STAT.                                       14080010
140900     PERFORM                                                      14090010
141000         WITH TEST AFTER                                          14100010
141100         VARYING PV-RETRY-COUNT                                   14110010
141200         FROM 1 BY 1                                              14120010
141300         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    14130010
141400            OR SQLCODE = 0                                        14140010
141500                                                                  14150010
141600         EXEC SQL                                                 14160010
141700              INSERT  INTO RVT_DFCT_STAT                          14170010
141800                     ( DFCT_ORD_ID                                14180010
141900                     , CHGD_TMST                                  14190010
142000                     , DFCT_ORD_STAT_CDE                          14200010
142100                     , USR_ID )                                   14210010
142200              VALUES (:PV-PREV-DFCT-ORD-ID                        14220010
142300                     ,:PV-DEFAULT-TIMESTAMP                       14230010
142400                     , 'A'                                        14240010
142500                     , 'RVKUT015')                                14250010
142600         END-EXEC                                                 14260010
142700                                                                  14270010
142800         EVALUATE TRUE                                            14280010
142900             WHEN SQLCODE = ZERO                                  14290010
143000                 SET PS-UPDATE-OK TO TRUE                         14300010
143100                 ADD 1 TO PV-RVT00003-INSERTS                     14310010
143200             WHEN SQLCODE = -904                                  14320010
143300             WHEN SQLCODE = -913                                  14330010
143400                 CONTINUE                                         14340010
143500             WHEN OTHER                                           14350010
143600                 SET PS-UPDATE-NOT-OK TO TRUE                     14360010
143700                 MOVE '7200-INSERT-RVT-DFCT-STAT ' TO             14370010
143800                                     PV-PARAGRAPH                 14380010
143900                 MOVE 'INSERT RVT-DFCT-STAT' TO PV-DB2-FUNCTION   14390010
144000                 MOVE PV-PREV-DFCT-ORD-ID TO PV-DFCT-ORD-ID       14400010
144100                 STRING 'ORDER ID -------> '                      14410010
144200                         PV-DFCT-ORD-ID                           14420010
144300                        ' - '                                     14430010
144400                         PV-DEFAULT-TIMESTAMP                     14440010
144500                         DELIMITED BY SIZE                        14450010
144600                         INTO PV-ERROR-MSG                        14460010
144700                 MOVE 'RVT-DFCT-STAT' TO PV-ABEND-STRUCTURE-1     14470010
144800                 MOVE SPACES          TO PV-ABEND-STRUCTURE-2     14480010
144900                                         PV-ABEND-STRUCTURE-3     14490010
145000                 PERFORM 9200-SQL-ERROR                           14500010
145100         END-EVALUATE                                             14510010
145200     END-PERFORM.                                                 14520010
145300                                                                  14530010
145400     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           14540010
145500         SET PS-UPDATE-NOT-OK TO TRUE                             14550010
145600         MOVE '7200-INSERT-RVT-DFCT-STAT ' TO PV-PARAGRAPH        14560010
145700         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         14570010
145800         MOVE 'RVT-DFCT-STAT'          TO PV-ABEND-STRUCTURE-1    14580010
145900         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    14590010
146000                                          PV-ABEND-STRUCTURE-3    14600010
146100         PERFORM 9200-SQL-ERROR                                   14610010
146200     END-IF.                                                      14620010
146300                                                                  14630010
146400***************************************************************** 14640010
146500*  INSERT ROW ON SHIP STATUS TABLE                                14650010
146600*  WHEN MULTIPLE LISTING ON A SHIPMENT ONLY UPDATE STATUS ONCE    14660010
146700***************************************************************** 14670010
146800 7400-INSERT-RVT-SHIPT-STAT.                                      14680010
146900     PERFORM                                                      14690010
147000         WITH TEST AFTER                                          14700010
147100         VARYING PV-RETRY-COUNT                                   14710010
147200         FROM 1 BY 1                                              14720010
147300         UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    14730010
147400            OR SQLCODE = 0                                        14740010
147500            OR SQLCODE = -803                                     14750010
147600                                                                  14760010
147700         EXEC SQL                                                 14770010
147800              INSERT  INTO RVT_SHIPT_STAT                         14780010
147900                     ( DFCT_SHIPT_ID                              14790010
148000                     , CRE_TMST                                   14800010
148100                     , SHIPT_STAT_CDE                             14810010
148200                     , USR_ID )                                   14820010
148300              VALUES (:PV-DFCT-SHIPT-ID                           14830010
148400                     ,:PV-DEFAULT-TIMESTAMP                       14840010
148500                     , 'A'                                        14850010
148600                     , 'RVKUT015')                                14860010
148700         END-EXEC                                                 14870010
148800                                                                  14880010
148900         EVALUATE TRUE                                            14890010
149000             WHEN SQLCODE = ZERO                                  14900010
149100                 SET PS-UPDATE-OK TO TRUE                         14910010
149200                 ADD 1 TO PV-RVT00001-INSERTS                     14920010
149300             WHEN SQLCODE = -803                                  14930010
149400                 SET PS-UPDATE-OK TO TRUE                         14940010
149500*************** THIS HAPPENS IF MORE THAN ONE LISTING WAS         14950010
149600*************** INCLUDED ON A SHIPMENT. IT IS OK TO CONTINUE.     14960010
149700             WHEN SQLCODE = -904                                  14970010
149800             WHEN SQLCODE = -913                                  14980010
149900                 CONTINUE                                         14990010
150000             WHEN OTHER                                           15000010
150100                 SET PS-UPDATE-NOT-OK TO TRUE                     15010010
150200                 MOVE '7400-INSERT-RVT-SHIPT-STAT ' TO            15020010
150300                                     PV-PARAGRAPH                 15030010
150400                 MOVE 'INSERT RVT-SHIPT-STAT' TO PV-DB2-FUNCTION  15040010
150500                 MOVE PV-DFCT-SHIPT-ID TO PV-WORK-DFCT-SHIPT-ID   15050010
150600                 STRING 'ORDER ID -------> '                      15060010
150700                         PV-WORK-DFCT-SHIPT-ID                    15070010
150800                         DELIMITED BY SIZE                        15080010
150900                         INTO PV-ERROR-MSG                        15090010
151000                 MOVE 'RVT-SHIPT-STAT' TO PV-ABEND-STRUCTURE-1    15100010
151100                 MOVE SPACES          TO PV-ABEND-STRUCTURE-2     15110010
151200                                         PV-ABEND-STRUCTURE-3     15120010
151300                 PERFORM 9200-SQL-ERROR                           15130010
151400         END-EVALUATE                                             15140010
151500     END-PERFORM.                                                 15150010
151600                                                                  15160010
151700     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           15170010
151800         SET PS-UPDATE-NOT-OK TO TRUE                             15180010
151900         MOVE '7400-INSERT-RVT-SHIPT-STAT ' TO PV-PARAGRAPH       15190010
152000         MOVE 'MAX RETRIES EXCEEDED  ' TO PV-DB2-FUNCTION         15200010
152100         MOVE 'RVT-SHIPT-STAT'         TO PV-ABEND-STRUCTURE-1    15210010
152200         MOVE SPACES                   TO PV-ABEND-STRUCTURE-2    15220010
152300                                          PV-ABEND-STRUCTURE-3    15230010
152400         PERFORM 9200-SQL-ERROR                                   15240010
152500     END-IF.                                                      15250010
152600                                                                  15260010
152700******************************************************************15270010
152800* COMMIT UPDATES                                                 *15280010
152900******************************************************************15290010
153000 7800-COMMIT.                                                     15300010
153100     EXEC SQL                                                     15310010
153200          COMMIT                                                  15320010
153300     END-EXEC                                                     15330010
153400                                                                  15340010
153500     EVALUATE SQLCODE                                             15350010
153600         WHEN +0                                                  15360010
153700             ADD 1 TO PV-COMMIT-CNT                               15370010
153800         WHEN OTHER                                               15380010
153900              DISPLAY '** ABEND **'                               15390010
154000              DISPLAY '** PROGRAM = RVKUT015 **'                  15400010
154100              DISPLAY '** PARAGRAPH = 7800-COMMIT  **'            15410010
154200              PERFORM 9200-SQL-ERROR                              15420010
154300     END-EVALUATE.                                                15430010
154400                                                                  15440010
154500******************************************************************15450010
154600* ROLLBACK WHEN ANY UPDATES UNSUCCESSFUL                         *15460010
154700******************************************************************15470010
154800 7900-ROLLBACK.                                                   15480010
154900     EXEC SQL                                                     15490010
155000         ROLLBACK                                                 15500010
155100     END-EXEC                                                     15510010
155200                                                                  15520010
155300     EVALUATE SQLCODE                                             15530010
155400         WHEN +0                                                  15540010
155500             ADD 1 TO PV-ROLLBACK-CNT                             15550010
155600              DISPLAY PC-FIVE-BLANKS                              15560010
155700                      'ROLLBACK TAKEN'                            15570010
155800                      '  ORDER ID ----> '                         15580010
155900                       DFCTOR-DFCT-ORD-ID                         15590010
156000                      ' ORDER STATUS CODE ----> '                 15600010
156100                       DFCTOR-DFCT-ORD-STAT-CDE                   15610010
156200              DISPLAY PC-ASTERISK-LINE                            15620010
156300         WHEN OTHER                                               15630010
156400              DISPLAY '** ABEND **'                               15640010
156500              DISPLAY '** PROGRAM = RVKUT015 **'                  15650010
156600              DISPLAY '** PARAGRAPH = 7900-ROLLBACK  **'          15660010
156700              PERFORM 9200-SQL-ERROR                              15670010
156800     END-EVALUATE.                                                15680010
156900                                                                  15690010
157000***************************************************************** 15700010
157100*     FORMAT THE OUTPUT RECORD.  THE MAJORITY OF THE FIELDS     * 15710010
157200*     ARE FORMATTED IN THE SAME SEQUENCE IN WHICH THEY APPEAR   * 15720010
157300*     IN THE COPYBOOK.                                          * 15730010
157400***************************************************************** 15740010
157500 8400-FORMAT-RV005-RECORD.                                        15750010
157600     INITIALIZE RV005-RECORD.                                     15760010
157700     MOVE PV-VENDOR-DUNS-NBR   TO RV005-VENDOR-DUNS-NBR.          15770010
157800     MOVE PV-PREV-DFCT-ORD-ID  TO PV-WORK-ORD-ID.                 15780010
157900     MOVE PV-WORK-ORD-ID-CHAR  TO RV005-DOC-NBR.                  15790010
158000                                                                  15800010
158100*********** 09/17/2007 THIS CODE WAS VALID WHEN USING THE         15810010
158200***********    KOHL'S RTV SYSTEM.  IT'S NOT WITH GENCO.           15820010
158300****** IF RTV OR D & D AND STATUS OF SHIPPED MOVE ACTUAL SHIPPED  15830010
158400******    DATE TO INVENTORY CUTOFF DTE.  IF D & D AND STATUS OF   15840010
158500******    'D' THEN USE THE STATUS CHANGE DTE WHEN IT WAS DISPOSED 15850010
158600***  IF PS-DFCT-SHIPPED AND PV-PREV-SHIPT-ID > +0                 15860010
158700***      MOVE PV-ACTL-SHIPT-DTE       TO RV005-INV-CUTOFF-DTE     15870010
158800***                                      RV005-DOC-DTE            15880010
158900***  ELSE                                                         15890010
159000***      MOVE PV-STATUS-CHG-DTE       TO RV005-INV-CUTOFF-DTE     15900010
159100***                                      RV005-DOC-DTE            15910010
159200***  END-IF.                                                      15920010
159300*********** 09/17/2007 THIS CODE WAS VALID WHEN USING THE         15930010
159400***********    KOHL'S RTV SYSTEM.  IT'S NOT WITH GENCO.           15940010
159500****************************************************************  15950010
159600*********** 09/17/2007 USING GENCO WE NEED TO ALWAYS MOVE THE     15960010
159700***********    STATUS CHANGE DTE REGARDLESS IF IT IS RTV OR D & D 15970010
159800***********    AND NOT THE ACTUAL SHIP DATE.                      15980010
159900     MOVE PV-STATUS-CHG-DTE       TO RV005-INV-CUTOFF-DTE         15990010
160000                                     RV005-DOC-DTE                16000010
160100*********** 09/17/2007 USING GENCO WE NEED TO ALWAYS MOVE THE     16010010
160200***********    STATUS CHANGE DTE REGARDLESS IF IT IS RTV OR D & D 16020010
160300***********    AND NOT THE ACTUAL SHIP DATE.                      16030010
160400                                                                  16040010
160500     MOVE PV-VND-AUTH-ID              TO RV005-VND-AUTH-ID.       16050010
160600                                                                  16060010
160700     EVALUATE TRUE                                                16070010
160800         WHEN PS-DFCT-ORD-ID-CDE-RTV                              16080010
160900              MOVE '55'                TO RV005-AP-TRN-CDE        16090010
161000              ADD 1                    TO PV-RTV-RECORDS          16100010
161100              MOVE PV-VND-AUTH-ID      TO PV-RTV-AUTH-ID          16110010
161200              MOVE PV-RTV-REASON-LINE  TO RV005-REASON-LINE-1     16120010
161300              MOVE PV-PSTG-TYP-CDE (2) TO RV005-AP-PSTG-TYPE-CDE  16130010
161400              MOVE PV-TRN-TYP-CDE (2)  TO RV005-AP-TRN-TYPE-CDE   16140010
161500              MOVE PV-BTCH-SRC-CDE (2) TO RV005-PS-BTCH-SRC-CDE   16150010
161600         WHEN PS-DFCT-ORD-ID-CDE-DND                              16160010
161700              MOVE '54'                TO RV005-AP-TRN-CDE        16170010
161800              ADD 1                    TO PV-DND-RECORDS          16180010
161900              MOVE PV-VND-AUTH-ID      TO PV-DND-AUTH-ID          16190010
162000              MOVE PV-DND-REASON-LINE  TO RV005-REASON-LINE-1     16200010
162100              MOVE PV-PSTG-TYP-CDE (1) TO RV005-AP-PSTG-TYPE-CDE  16210010
162200              MOVE PV-TRN-TYP-CDE (1)  TO RV005-AP-TRN-TYPE-CDE   16220010
162300              MOVE PV-BTCH-SRC-CDE (1) TO RV005-PS-BTCH-SRC-CDE   16230010
162400     END-EVALUATE.                                                16240010
162500                                                                  16250010
162600     MOVE '2'                          TO RV005-AP-RECD-TYP-CDE.  16260010
162700     MOVE PV-TBL-AP-DEPT (PV-AP-INDEX) TO RV005-DEPT-NBR.         16270010
162800     STRING APCNTL-BTCH-PRC-DTE                                   16280010
162900            PV-DEFAULT-TIME                                       16290010
163000            DELIMITED BY SIZE INTO RV005-AP-ENTR-TMST.            16300010
163100     MOVE 'RVKUT015'                  TO RV005-ENTR-ID.           16310010
163200     MOVE 'A'                         TO RV005-AP-ORGN-CDE.       16320010
163300     MOVE APCNTL-BTCH-PRC-DTE         TO RV005-PS-BTCH-DTE.       16330010
163400     MOVE '00'                        TO RV005-PS-BTCH-SEQ-NBR.   16340010
163500     MOVE EXTENT-ENT-ID               TO RV005-ENT-ID.            16350010
163600     MOVE ENTNME-ENT-NAME-DESC        TO RV005-ENT-NME-DESC.      16360010
163700     MOVE XLT00010-LOC-NBR            TO RV005-STR-NBR.           16370010
163800     MOVE XLT00010-LOC-NM             TO RV005-STR-NAME.          16380010
163900     MOVE PV-TBL-AP-MAJOR-CLASS (PV-AP-INDEX) TO RV005-CL-NBR.    16390010
164000     COMPUTE  RV005-GRO-COST-AMT =                                16400010
164100              PV-TBL-AP-UNIT-COST (PV-AP-INDEX) * -1.             16410010
164200     COMPUTE  RV005-INB-FRGT-AMT  =                               16420010
164300              PV-TBL-AP-PRORATED-INBD (PV-AP-INDEX) * -1.         16430010
164400     COMPUTE  RV005-OUTB-FRGT-AMT =                               16440010
164500              PV-TBL-AP-PRORATED-OTBND (PV-AP-INDEX) * -1.        16450010
164600     COMPUTE  RV005-DEDUCTION      =                              16460010
164700              PV-TBL-AP-PRORATED-DED (PV-AP-INDEX) * -1.          16470010
164800     COMPUTE RV005-NET-COST-AMT =                                 16480010
164900                 ((PV-TBL-AP-UNIT-COST (PV-AP-INDEX)       +      16490010
165000                   PV-TBL-AP-PRORATED-INBD (PV-AP-INDEX)   +      16500010
165100                   PV-TBL-AP-PRORATED-OTBND (PV-AP-INDEX)) -      16510010
165200                   PV-TBL-AP-PRORATED-DED (PV-AP-INDEX)    -      16520010
165300                   PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX)) * -1.    16530010
165400     COMPUTE  RV005-RETAIL-AMT  =                                 16540010
165500              PV-TBL-AP-RETAIL-COST (PV-AP-INDEX) * -1.           16550010
165600     COMPUTE  RV005-DISC-AMT  =                                   16560010
165700              PV-TBL-AP-PRORATED-AMT (PV-AP-INDEX) * -1.          16570010
165800     MOVE PV-TBL-AP-PRORATED-PCT (PV-AP-INDEX)                    16580010
165900                                 TO RV005-DISC-DED-PCT.           16590010
166000     MOVE RV005-DOC-NBR          TO PV-DOC-NBR                    16600010
166010     SET PS-DOC-APPEND-YES TO TRUE                                16601010
166100     IF PS-FIRST-TIME-DOC                                         16610010
166200        SET PS-NOT-FIRST-TIME-DOC TO TRUE                         16620010
166300     ELSE                                                         16630010
166400        IF PV-DOC-NBR EQUAL PV-PREV-DOC-NBR                       16640010
166500           IF RV005-DEPT-NBR NOT EQUAL PV-PREV-DEPT-NBR           16650010
166600              INSPECT PV-DOC-NBR TALLYING PV-COUNT                16660010
166700                      FOR LEADING ZEROES                          16670010
166800              COMPUTE PV-START-POS = 12 - PV-COUNT                16680010
166900              ADD 1 TO PV-COUNT                                   16690010
166910                       PV-APPEND-CHAR                             16691010
167000              STRING RV005-DOC-NBR(PV-COUNT:PV-START-POS)         16700010
167010                     DELIMITED BY SIZE                            16701010
167100                     PV-APPEND-CHAR                               16710010
167200                     DELIMITED BY SIZE                            16720010
167210                     '_RL'                                        16721017
167220                     DELIMITED BY SIZE                            16722010
167300                     INTO PV-FINAL-DOC-NBR                        16730010
167400              END-STRING                                          16740010
167500              MOVE PV-FINAL-DOC-NBR TO RV005-DOC-NBR              16750010
167510                                       PV-FINAL-DOC-NBR-HOLD      16751012
167600              SET PS-DOC-APPEND-NO  TO TRUE                       16760010
167700           ELSE                                                   16770011
167710              IF PV-APPEND-CHAR  > 0                              16771013
167800                 MOVE PV-FINAL-DOC-NBR-HOLD TO RV005-DOC-NBR      16780015
167810                 SET PS-DOC-APPEND-NO TO TRUE                     16781014
167900              END-IF                                              16790013
168600           END-IF                                                 16860010
168610        ELSE                                                      16861010
168700           INITIALIZE  PV-APPEND-CHAR                             16870010
168800                       PV-FINAL-DOC-NBR                           16880010
168900        END-IF                                                    16890010
169000     END-IF                                                       16900010
169110     IF PS-DOC-APPEND-YES                                         16911010
169200        PERFORM 8800-SUFFIX-DOC-DATE                              16920010
169210        SET PS-DOC-APPEND-NO  TO TRUE                             16921010
169220     END-IF                                                       16922010
169400     PERFORM 8500-WRITE-RV005-RECORD.                             16940010
169500                                                                  16950010
169600***************************************************************** 16960010
169700* WHEN TDFCTOR.PAYT_TYP_CDE = 'P' (PREPAID) OR THE END OF THE     16970010
169800*     CURSOR HAS BEEN REACHED WRITE FREIGHT RECORD                16980010
169900***************************************************************** 16990010
170000     IF DFCTOR-PAYT-TYP-CDE = 'P' OR                              17000010
170100             PS-END-OF-CURSOR                                     17010010
170200         PERFORM 8600-FORMAT-RV006-RECORD                         17020010
170300     END-IF.                                                      17030010
170400     INITIALIZE PV-COUNT                                          17040010
170500                PV-FINAL-DOC-NBR-NEW                              17050010
170600                PV-FINAL-DOC-NBR-TEMP                             17060010
170700***             PV-DOC-NBR-SUFFIX                                 17070010
170800                PV-START-POS.                                     17080010
170900                                                                  17090010
171000***************************************************************** 17100010
171100*  WRITE THE EXTRACT RECORD                                       17110010
171200***************************************************************** 17120010
171300 8500-WRITE-RV005-RECORD.                                         17130010
171400     MOVE  RV005-DEPT-NBR TO PV-PREV-DEPT-NBR.                    17140010
171500     MOVE  PV-DOC-NBR     TO PV-PREV-DOC-NBR.                     17150010
171600     WRITE RV-EXT-RECORD FROM RV005-RECORD.                       17160010
171700     ADD 1 TO PV-RVRD005-COUNT.                                   17170010
171800                                                                  17180010
171900***************************************************************** 17190010
172000*  FORAMT THE FREIGHT RECORD                                      17200010
172100***************************************************************** 17210010
172200 8600-FORMAT-RV006-RECORD.                                        17220010
172300     INITIALIZE RV006-RECORD.                                     17230010
172400     MOVE PV-CARRIER              TO RV006-CARRIER.               17240010
172500*** MOVE '** NO TRACKING NUMBER **' WHEN TRACKING NBR IS BLANK    17250010
172600     IF PV-TRACKING-NBR  = SPACES                                 17260010
172700         MOVE '** NO TRACKING NUMBER **' TO RV006-TRACKING-NBR    17270010
172800     ELSE                                                         17280010
172900         MOVE PV-TRACKING-NBR     TO RV006-TRACKING-NBR           17290010
173000     END-IF.                                                      17300010
173100     MOVE PV-TRAILER-NBR          TO RV006-TRAILER-NBR            17310010
173200*    MOVE PV-WORK-ORD-ID-CHAR     TO RV006-DEBIT-NBR.             17320010
173300     MOVE PV-WORK-ORD-ID-CHAR     TO PV-FINAL-DOC-NBR-TEMP.       17330010
173400*    PERFORM 8800-SUFFIX-DOC-DATE.                                17340010
173500*    MOVE PV-FINAL-DOC-NBR-NEW    TO RV006-DEBIT-NBR.             17350010
173510     MOVE PV-FINAL-DOC-NBR        TO RV006-DEBIT-NBR.             17351010
173600     MOVE RV005-DEPT-NBR          TO RV006-DEPT-NBR               17360010
173700     MOVE RV005-CL-NBR            TO RV006-MAJ-CLASS.             17370010
173800     MOVE PV-CARTON-QTY           TO RV006-CARTONS.               17380010
173900     MOVE RV005-INB-FRGT-AMT      TO RV006-INB-FRGT-AMT.          17390010
174000     MOVE RV005-OUTB-FRGT-AMT     TO RV006-OUTB-FRGT-AMT.         17400010
174100                                                                  17410010
174200     IF (PS-DFCT-ORD-ID-CDE-DND OR                                17420010
174300        (RV006-INB-FRGT-AMT = 0 AND                               17430010
174400         RV006-OUTB-FRGT-AMT = 0))                                17440010
174500         ADD 1 TO PV-RVRD006-BYPASS-CNT                           17450010
174600     ELSE                                                         17460010
174700         PERFORM 8700-WRITE-RV006-RECORD                          17470010
174800     END-IF.                                                      17480010
174900                                                                  17490010
175000***************************************************************** 17500010
175100*  WRITE THE FREIGHT RECORD                                       17510010
175200***************************************************************** 17520010
175300 8700-WRITE-RV006-RECORD.                                         17530010
175400     WRITE RV-FRGT-RECORD   FROM RV006-RECORD.                    17540010
175500     ADD 1 TO PV-RVRD006-COUNT.                                   17550010
175600                                                                  17560010
175700***************************************************************** 17570010
175800*  SUFFIX DOC DATE TO THE DOC NUMBER TO MAKE DOC NUMBER AS        17580010
175900*  NNNNNN_YYMMDD OR NNNNNNNN_YYMMDD                               17590010
176000***************************************************************** 17600010
176100 8800-SUFFIX-DOC-DATE.                                            17610010
176200                                                                  17620010
176300     INITIALIZE PV-COUNT                                          17630010
176400                PV-FINAL-DOC-NBR-NEW                              17640010
176410                PV-FINAL-DOC-NBR                                  17641010
176500****            PV-DOC-NBR-SUFFIX                                 17650010
176600                PV-START-POS.                                     17660010
176700                                                                  17670010
177900      INSPECT PV-DOC-NBR TALLYING PV-COUNT                        17790010
177910              FOR LEADING ZEROES                                  17791010
177920      COMPUTE PV-START-POS = 12 - PV-COUNT                        17792010
177930      ADD +1 TO     PV-COUNT                                      17793010
177960      STRING RV005-DOC-NBR(PV-COUNT:PV-START-POS)                 17796010
177970             DELIMITED BY SIZE                                    17797010
177980             '_RL'                                                17798017
177990             DELIMITED BY SIZE                                    17799010
177991             INTO PV-FINAL-DOC-NBR                                17799110
177992      END-STRING                                                  17799210
177994      MOVE PV-FINAL-DOC-NBR TO RV005-DOC-NBR.                     17799420
178000***************************************************************** 17800010
178100*  END OF JOB PROCESSING                                          17810010
178200***************************************************************** 17820010
178300 9000-EOJ.                                                        17830010
178400     IF PV-CURSOR-COUNT > 0                                       17840010
178500        PERFORM 2100-UPDATE-ROWS                                  17850010
178600     END-IF.                                                      17860010
178700                                                                  17870010
178800     PERFORM 6400-CLOSE-TDFCTOR-CSR.                              17880010
178900     CLOSE RV-EXTRACT-FILE                                        17890010
179000           RV-FREIGHT-FILE.                                       17900010
179100                                                                  17910010
179200     DISPLAY SPACES.                                              17920010
179300     DISPLAY PC-ASTERISK-LINE.                                    17930010
179400     DISPLAY '     FINAL TOTALS FOR RUN'.                         17940010
179500     DISPLAY PC-ASTERISK-LINE.                                    17950010
179600     DISPLAY ' '.                                                 17960010
179700     DISPLAY '   TDFCTOR CURSOR FETCHES ----------> '             17970010
179800              PV-CURSOR-COUNT.                                    17980010
179900     DISPLAY SPACES.                                              17990010
180000     DISPLAY '   TDFCTOR UPDATES -----------------> '             18000010
180100              PV-TDFCTOR-UPDATES.                                 18010010
180200     DISPLAY ' SHIPT STAT INSERTS ----------------> '             18020010
180300              PV-RVT00001-INSERTS.                                18030010
180400     DISPLAY '  DFCT STAT INSERTS ----------------> '             18040010
180500              PV-RVT00003-INSERTS.                                18050010
180600     DISPLAY SPACES.                                              18060010
180700     DISPLAY '   RVRD005 RECORDS WRITTEN ---------> '             18070010
180800              PV-RVRD005-COUNT.                                   18080010
180900     DISPLAY SPACES.                                              18090010
181000     DISPLAY '   RVRD006 RECORDS WRITTEN ---------> '             18100010
181100              PV-RVRD006-COUNT.                                   18110010
181200     DISPLAY SPACES.                                              18120010
181300     DISPLAY 'RVRD006 RECS BYPASS - D&D/NO FRGT CHRG---> '        18130010
181400              PV-RVRD006-BYPASS-CNT.                              18140010
181500     DISPLAY SPACES.                                              18150010
181600     DISPLAY '         RECORDS COMMITTED ---------> '             18160010
181700              PV-COMMIT-CNT.                                      18170010
181800     DISPLAY SPACES.                                              18180010
181900                                                                  18190010
182000     DISPLAY SPACES.                                              18200010
182100     DISPLAY '      RECORDS ROLLED BACK  ---------> '             18210010
182200              PV-ROLLBACK-CNT.                                    18220010
182300     DISPLAY SPACES.                                              18230010
182400                                                                  18240010
182500***************************************************************** 18250010
182600*  PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED             18260010
182700***************************************************************** 18270010
182800 9200-SQL-ERROR.                                                  18280010
182900     CLOSE RV-EXTRACT-FILE                                        18290010
183000           RV-FREIGHT-FILE                                        18300010
183100                                                                  18310010
183200     MOVE SQLCODE                     TO SQLCODE2.                18320010
183300     MOVE SQLERRD(3)                  TO SQLERRD3.                18330010
183400                                                                  18340010
183500     DISPLAY ' '.                                                 18350010
183600     DISPLAY '** ABEND **         ** = SQLERROR'.                 18360010
183700     DISPLAY '** PROGRAM   ** =   RVKUT015 '.                     18370010
183800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   18380010
183900     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                18390010
184000     DISPLAY '**           ** = ' PV-ERROR-MSG                    18400010
184100                                                                  18410010
184200     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                18420010
184300     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                18430010
184400     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 18440010
184500     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                18450010
184600                                                                  18460010
184700     COPY DPPD004.                                                18470010
184800                                                                  18480010
184900     MOVE +4013                       TO PV-ABEND-CODE.           18490010
185000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         18500010
185100                                                                  18510010
185200*************  END OF RVKUT015  ********************************  18520010
