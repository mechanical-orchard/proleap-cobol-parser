000100*****************************************************************         
000200 IDENTIFICATION DIVISION.                                                 
000300*****************************************************************         
000400 PROGRAM-ID.    XLKUT036.                                                 
000500 AUTHOR.        DEANNA BRANTNER.                                          
000600 INSTALLATION.  KOHLS.                                                    
000700 DATE-WRITTEN   APRIL, 2003.                                              
000800 DATE-COMPILED.                                                           
000900*****************************************************************         
001000*  THIS PROGRAM WILL REFORMAT THE LEGACY TABLES:  TPURCHS,      *         
001100*  TIMPORL, TPLNSHP, TPOAGMT TO PO DOMAIN TEMPLATES:  XXT_PO              
      * ****************************************************************        
      * CHANGE DESCRIPTION                                                      
      * ****************************************************************        
      * DATE  05/12/2010                                                        
      *  CHANGE MADE: ADDED A NEW IR INDICATOR(WHSE_RPLNT_IND) IN               
      *  TPURCHS TABLE UNDER IMPORT REPLENISHMENT PROJECT. CHANGES MADE         
      *  ACCORDINGLY FOR THE SAME.                                              
      * MADE BY: MONIKA SACHDEVA         TKID: TKMAW78                          
      * CHANGES TAGGED AS MS 05/12/2010                                         
      * ****************************************************************        
      * DATE  05/29/2014                                                        
      *  CHANGE MADE: IN 4100- POPULATE XL015-NOT-AFT-DTE BASED ON THE          
      *  PLNSHP-EXT-CAN-DTE.                                                    
      * MADE BY: CHERI PARMLEY           TKID: TKMAF76                          
      * CHANGES TAGGED AS  CLP 05/29/14                                         
001200*****************************************************************         
001300 ENVIRONMENT DIVISION.                                                    
001400 INPUT-OUTPUT SECTION.                                                    
001500                                                                          
001600 FILE-CONTROL.                                                            
001700                                                                          
001800     SELECT TPURCHS-FILE                                                  
001900         ASSIGN TO INP01.                                                 
002000                                                                          
002100     SELECT TIMPORL-FILE                                                  
002200         ASSIGN TO INP02.                                                 
002300                                                                          
002400     SELECT TPLNSHP-FILE                                                  
002500         ASSIGN TO INP03.                                                 
002600                                                                          
002700     SELECT TPOAGMT-FILE                                                  
002800         ASSIGN TO INP04.                                                 
002900                                                                          
003000     SELECT OUTPUT-FILE                                                   
003100         ASSIGN TO OUT01.                                                 
003200                                                                          
003300*****************************************************************         
003400 DATA DIVISION.                                                           
003500*****************************************************************         
003600 FILE SECTION.                                                            
003700                                                                          
003800 FD  TPURCHS-FILE                                                         
003900     RECORDING MODE IS F                                                  
004000     BLOCK CONTAINS 0 RECORDS                                             
004100     LABEL RECORDS ARE STANDARD.                                          
004200                                                                          
004300*01  TPURCHS-RECORD               PIC X(479).                             
      ** CHANGE THE RECORD LENGTH TO ACCOMODATE THE NEW INDICATOR               
      ** MS 05/12/2010 BEG                                                      
004400*01  TPURCHS-RECORD               PIC X(481).                             
       01  TPURCHS-RECORD               PIC X(482).                             
      ** MS 05/12/2010 END                                                      
004500                                                                          
004600 FD  TIMPORL-FILE                                                         
004700     RECORDING MODE IS F                                                  
004800     BLOCK CONTAINS 0 RECORDS                                             
004900     LABEL RECORDS ARE STANDARD.                                          
005000                                                                          
005100 01  TIMPORL-RECORD               PIC X(159).                             
005200                                                                          
005300 FD  TPLNSHP-FILE                                                         
005400     RECORDING MODE IS F                                                  
005500     BLOCK CONTAINS 0 RECORDS                                             
005600     LABEL RECORDS ARE STANDARD.                                          
005700                                                                          
005800 01  TPLNSHP-RECORD               PIC X(184).                             
005900                                                                          
006000 FD  TPOAGMT-FILE                                                         
006100     RECORDING MODE IS F                                                  
006200     BLOCK CONTAINS 0 RECORDS                                             
006300     LABEL RECORDS ARE STANDARD.                                          
006400                                                                          
006500 01  TPOAGMT-RECORD               PIC X(099).                             
006600                                                                          
006700 FD  OUTPUT-FILE                                                          
006800     RECORDING MODE IS F                                                  
006900     BLOCK CONTAINS 0 RECORDS                                             
007000     LABEL RECORDS ARE STANDARD.                                          
007100                                                                          
      ** CHANGE THE RECORD LENGTH TO ACCOMODATE NEW INDICATOR **                
      ** MS 05/12/2010 BEG                                                      
007200*01  OUTPUT-RECORD                PIC X(372).                             
       01  OUTPUT-RECORD                PIC X(373).                             
      ** MS 05/12/2010 END                                                      
007300                                                                          
007400*****************************************************************         
007500 WORKING-STORAGE SECTION.                                                 
007600                                                                          
007700 01  PS-PROGRAM-SWITCHES.                                                 
007800     05  PS-EOF-TPURCHS-SW            PIC X(01)  VALUE 'N'.               
007900         88  PS-EOF-TPURCHS-YES                  VALUE 'Y'.               
008000         88  PS-EOF-TPURCHS-NO                   VALUE 'N'.               
008100     05  PS-EOF-TIMPORL-SW            PIC X(01)  VALUE 'N'.               
008200         88  PS-EOF-TIMPORL-YES                  VALUE 'Y'.               
008300         88  PS-EOF-TIMPORL-NO                   VALUE 'N'.               
008400     05  PS-EOF-TPLNSHP-SW            PIC X(01)  VALUE 'N'.               
008500         88  PS-EOF-TPLNSHP-YES                  VALUE 'Y'.               
008600         88  PS-EOF-TPLNSHP-NO                   VALUE 'N'.               
008700     05  PS-EOF-TPOAGMT-SW            PIC X(01)  VALUE 'N'.               
008800         88  PS-EOF-TPOAGMT-YES                  VALUE 'Y'.               
008900         88  PS-EOF-TPOAGMT-NO                   VALUE 'N'.               
009000     05  PS-TIMPORL-FOUND-SW          PIC X(01)  VALUE 'N'.               
009100         88  PS-TIMPORL-FOUND                    VALUE 'Y'.               
009200         88  PS-TIMPORL-NOT-FOUND                VALUE 'N'.               
009300     05  PS-TPLNSHP-FOUND-SW          PIC X(01)  VALUE 'N'.               
009400         88  PS-TPLNSHP-FOUND                    VALUE 'Y'.               
009500         88  PS-TPLNSHP-NOT-FOUND                VALUE 'N'.               
009600     05  PS-TPOAGMT-FOUND-SW          PIC X(01)  VALUE 'N'.               
009700         88  PS-TPOAGMT-FOUND                    VALUE 'Y'.               
009800         88  PS-TPOAGMT-NOT-FOUND                VALUE 'N'.               
009900                                                                          
010000 01  PC-PROGRAM-CONSTANTS.                                                
010100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT036'.        
010200                                                                          
010300 01  PV-PROGRAM-VARIABLES.                                                
010400     05  PV-RECS-READ-TPURCHS         PIC  9(09) VALUE  0.                
010500     05  PV-RECS-READ-TIMPORL         PIC  9(09) VALUE  0.                
010600     05  PV-RECS-READ-TPLNSHP         PIC  9(09) VALUE  0.                
010700     05  PV-RECS-READ-TPOAGMT         PIC  9(09) VALUE  0.                
010800     05  PV-RECORDS-WRITTEN           PIC  9(09) VALUE  0.                
010900                                                                          
011000 01  PV-ABEND-FIELDS.                                                     
011100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT036'.        
011200     05  FILLER                       PIC  X(01) VALUE SPACES.            
011300     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.            
011400     05  FILLER                       PIC  X(01) VALUE SPACES.            
011500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.            
011600     05  FILLER                       PIC  X(01) VALUE SPACES.            
011700     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.            
011800                                                                          
011900 01  RF-REFORMAT-DATE.                                                    
012000     05  RF-YEAR                      PIC  X(04) VALUE SPACES.            
012100     05  RF-MONTH                     PIC  X(02) VALUE SPACES.            
012200     05  RF-DAY                       PIC  X(02) VALUE SPACES.            
012300                                                                          
012400 01  OR-ORIGINAL-DATE.                                                    
012500     05  OR-YEAR                      PIC  X(04) VALUE SPACES.            
012600     05  FILLER                       PIC  X(01) VALUE SPACES.            
012700     05  OR-MONTH                     PIC  X(02) VALUE SPACES.            
012800     05  FILLER                       PIC  X(01) VALUE SPACES.            
012900     05  OR-DAY                       PIC  X(02) VALUE SPACES.            
013000                                                                          
013100 01  PS-CALC-DATE                     PIC  X(10) VALUE SPACES.            
013200                                                                          
013300***********************************************************               
013400*  COPYBOOK USED FOR THE TPURCHS INPUT FILE               *               
013500*  REPLACED BY XLRD063                                                    
013600***********************************************************               
013700*    EXEC SQL                                                             
013800*        INCLUDE TPURCHS                                                  
013900*    END-EXEC.                                                            
014000                                                                          
014100***********************************************************               
014200*  COPYBOOK USED FOR THE TIMPORL INPUT FILE               *               
014300***********************************************************               
014400     EXEC SQL                                                             
014500         INCLUDE TIMPORL                                                  
014600     END-EXEC.                                                            
014700                                                                          
014800***********************************************************               
014900*  COPYBOOK USED FOR THE TPLNSHP INPUT FILE               *               
015000***********************************************************               
015100     EXEC SQL                                                             
015200         INCLUDE TPLNSHP                                                  
015300     END-EXEC.                                                            
015400                                                                          
015500***********************************************************               
015600*  COPYBOOK USED FOR THE TPOAGMT INPUT FILE               *               
015700***********************************************************               
015800     EXEC SQL                                                             
015900         INCLUDE TPOAGMT                                                  
016000     END-EXEC.                                                            
016100                                                                          
016200***********************************************************               
016300*  COPYBOOK USED FOR THE TPOLDTM INPUT FILE               *               
016400***********************************************************               
016500     EXEC SQL                                                             
016600         INCLUDE TPOLDTM                                                  
016700     END-EXEC.                                                            
016800                                                                          
016900***********************************************************               
017000*  COPYBOOK USED FOR THE TDTATTR INPUT FILE               *               
017100***********************************************************               
017200     EXEC SQL                                                             
017300         INCLUDE TDTATTR                                                  
017400     END-EXEC.                                                            
017500                                                                          
017600*-----------------------------------------------------------------        
017700*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                        
017800*-----------------------------------------------------------------        
017900     EXEC SQL                                                             
018000          INCLUDE SQLCA                                                   
018100     END-EXEC.                                                            
018200                                                                          
018300*    TPURCHS FORMAT WITH NULL INDICATOR                                   
018400     COPY XLRD063.                                                        
018500***********************************************************               
018600*  COPYBOOK USED FOR THE LOGISTIC SKU OUTPUT FILE         *               
018700***********************************************************               
018800 01  PC-OUTPUT-RECORD.                                                    
018900     COPY XLRD015.                                                        
019000                                                                          
019100*****************************************************************         
019200 PROCEDURE DIVISION.                                                      
019300*****************************************************************         
019400     DISPLAY '**** BEGINNING XLKUT036 ****'.                              
019500     DISPLAY ' '.                                                         
019600                                                                          
019700     OPEN INPUT  TPURCHS-FILE                                             
019800                 TIMPORL-FILE                                             
019900                 TPLNSHP-FILE                                             
020000                 TPOAGMT-FILE                                             
020100          OUTPUT OUTPUT-FILE.                                             
020200                                                                          
020300     PERFORM 1000-PROCESS-INPUT-FILE                                      
020400       UNTIL PS-EOF-TPURCHS-YES.                                          
020500                                                                          
020600     CLOSE TPURCHS-FILE                                                   
020700           TIMPORL-FILE                                                   
020800           TPLNSHP-FILE                                                   
020900           TPOAGMT-FILE                                                   
021000           OUTPUT-FILE.                                                   
021100                                                                          
021200     DISPLAY '   INPUT TPURCHS RECS    = ' PV-RECS-READ-TPURCHS.          
021300     DISPLAY '   INPUT TIMPORL RECS    = ' PV-RECS-READ-TIMPORL.          
021400     DISPLAY '   INPUT TPLNSHP RECS    = ' PV-RECS-READ-TPLNSHP.          
021500     DISPLAY '   INPUT TPOAGMT RECS    = ' PV-RECS-READ-TPOAGMT.          
021600     DISPLAY '  OUTPUT XLRD015 RECS    = ' PV-RECORDS-WRITTEN.            
021700     DISPLAY ' '.                                                         
021800     DISPLAY '****  END OF  XLKUT036  ****'.                              
021900                                                                          
022000     GOBACK.                                                              
022100                                                                          
022200*****************************************************************         
022300*  PROCESS INPUT FILE                                           *         
022400*****************************************************************         
022500 1000-PROCESS-INPUT-FILE.                                                 
022600                                                                          
022700     MOVE '1000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.               
022800                                                                          
022900     PERFORM 2000-READ-TPURCHS-INPUT-FILE.                                
023000                                                                          
023100     IF PS-EOF-TPURCHS-YES                                                
023200         CONTINUE                                                         
023300     ELSE                                                                 
023400         PERFORM 2100-MOVE-TPURCHS-INFO                                   
023500     END-IF.                                                              
023600                                                                          
023700*****************************************************************         
023800*  READ A TPURCHS RECORD                                                  
023900*****************************************************************         
024000 2000-READ-TPURCHS-INPUT-FILE.                                            
024100                                                                          
024200     MOVE '2000-READ-TPURCHS-INPUT-FILE' TO PV-ABEND-PARAGRAPH.           
024300                                                                          
024400     INITIALIZE XL015-DATA-AREA                                           
024500                XL063-DCLTPURCHS                                          
024600                                                                          
024700     READ TPURCHS-FILE                                                    
024800          INTO XL063-DCLTPURCHS                                           
024900            AT END                                                        
025000               SET PS-EOF-TPURCHS-YES TO TRUE                             
025100     END-READ.                                                            
025200                                                                          
025300     IF PS-EOF-TPURCHS-YES                                                
025400        CONTINUE                                                          
025500     ELSE                                                                 
025600        ADD +1 TO PV-RECS-READ-TPURCHS                                    
025700     END-IF.                                                              
025800                                                                          
025900*****************************************************************         
026000*  MOVE TPURCHS INFO TO EXTRACT FILE                            *         
026100*****************************************************************         
026200 2100-MOVE-TPURCHS-INFO.                                                  
026300                                                                          
026400     MOVE '2100-MOVE-TPURCHS-INFO  ' TO PV-ABEND-PARAGRAPH.               
026500                                                                          
026600     INITIALIZE XL015-RECORD                                              
026700                                                                          
026800     MOVE XL063-PO-NBR              TO XL015-PO-NBR.                      
026900     MOVE XL063-DEPT-NBR            TO XL015-DEPT-NBR.                    
027000     MOVE XL063-ENT-ID              TO XL015-ENT-ID.                      
      ** INCLUDE THE NEW WAREHOUSE INDICATOR **                                 
      ** MS 05/12/2010 BEG                                                      
           MOVE XL063-WHSE-RPLNT-IND     TO XL015-WHSE-RPLNT-IND.               
      ** MS 05/12/2010 END                                                      
027100     EVALUATE XL063-STATUS-CDE                                            
027200         WHEN 'AC'                                                        
027300             MOVE 'A'               TO XL015-STAT-CDE                     
027400         WHEN 'AP'                                                        
027500             MOVE 'A'               TO XL015-STAT-CDE                     
027600         WHEN 'CA'                                                        
027700             MOVE 'C'               TO XL015-STAT-CDE                     
027800         WHEN 'CM'                                                        
027900             MOVE 'P'               TO XL015-STAT-CDE                     
028000         WHEN 'PA'                                                        
028100             MOVE 'S'               TO XL015-STAT-CDE                     
028200         WHEN 'WK'                                                        
028300             MOVE 'W'               TO XL015-STAT-CDE                     
028400     END-EVALUATE.                                                        
028500     MOVE XL063-EDI-REXMIT-IND      TO XL015-EDI-SNT-IND.                 
028600     MOVE XL063-EDI-IND             TO XL015-EDI-PO-IND.                  
028700     MOVE XL063-IMPRT-PO-IND        TO XL015-IMPRT-PO-IND.                
028800     MOVE XL063-IMPRT-FCTRY-NAME    TO XL015-FCTRY-NM.                    
028900     MOVE XL063-PO-TYP-CDE          TO XL015-PO-TYP-CDE.                  
029000     IF XL063-PO-TYP-CDE NOT = 'IE' AND 'IM' AND 'IF'                     
029100         MOVE 'D'                    TO XL015-CONSLR-RLSE-CDE             
029200         MOVE 'D'                    TO XL015-TKT-MKR-RLSE-CDE            
029300     END-IF.                                                              
029400     IF XL063-RLSE-DTE   =  '0001-01-01'                                  
029500         MOVE SPACES                TO XL015-RLSE-DTE                     
029600     ELSE                                                                 
029700         MOVE XL063-RLSE-DTE        TO OR-ORIGINAL-DATE                   
029800         MOVE OR-YEAR               TO RF-YEAR                            
029900         MOVE OR-MONTH              TO RF-MONTH                           
030000         MOVE OR-DAY                TO RF-DAY                             
030100         MOVE RF-REFORMAT-DATE      TO XL015-RLSE-DTE                     
030200     END-IF.                                                              
030300     MOVE XL063-DIR-STR-IND         TO XL015-DIR-STR-IND.                 
030400     MOVE XL063-NEW-STR-PO-IND      TO XL015-NW-STR-ORD-IND.              
030500     MOVE XL063-PKGNG-CDE           TO XL015-PKGNG-CDE.                   
030600     MOVE XL063-SEASET-SHRT-NM      TO XL015-SEASET-SHRT-DESC.            
030700     MOVE XL063-SEASET-YR           TO XL015-SEASET-YR.                   
030800     MOVE XL063-PROD-CNTRY-CDE      TO XL015-C-O-PROD-CDE.                
030900     MOVE XL063-PLCMNT-CNTRY-CDE    TO XL015-AGNT-OFC-CNTRY-CDE.          
031000     MOVE XL063-IMPRT-VEND-NAME     TO XL015-IMPRT-VND-NM.                
031100     MOVE XL063-IMPRT-FCTRY-NAME    TO XL015-IMPRT-FCTRY-NM.              
031200     MOVE XL063-UNT-PER-CBMT-QTY    TO XL015-UNT-PER-CBMT-QTY.            
031300     MOVE XL063-QTA-CTG-CDE         TO XL015-QTA-CTG-CDE.                 
031400     MOVE XL063-IMPRT-VND-ID        TO XL015-IMPRT-VND-ID.                
031500     MOVE XL063-IMPRT-FCTRY-ID      TO XL015-IMPRT-FCTRY-ID.              
031600     MOVE XL063-DERVD-LBL-TYP-CDE   TO XL015-DERVD-LBL-TYP-CDE.           
031700                                                                          
031800     IF XL063-DELY-ID-NULL = -1                                           
031900         MOVE SPACES                TO XL015-DELY-ID                      
032000     ELSE                                                                 
032100         MOVE XL063-DELY-ID         TO XL015-DELY-ID                      
032200     END-IF                                                               
032300                                                                          
032400     MOVE XL063-PO-SHRT-CYC-IND     TO XL015-PO-SHRT-CYC-IND              
032500                                                                          
032600     IF XL063-PO-NBR > IMPORL-PO-NBR                                      
032700         PERFORM 3000-READ-TIMPORL-INPUT-FILE                             
032800                   UNTIL PS-TIMPORL-FOUND                                 
032900     ELSE                                                                 
033000         IF XL063-PO-NBR = IMPORL-PO-NBR                                  
033100             PERFORM 3100-MOVE-TIMPORL-INFO                               
033200         END-IF                                                           
033300     END-IF.                                                              
033400                                                                          
033500     IF XL063-PO-NBR > PLNSHP-PO-NBR                                      
033600         PERFORM 4000-READ-TPLNSHP-INPUT-FILE                             
033700                   UNTIL PS-TPLNSHP-FOUND                                 
033800     ELSE                                                                 
033900         IF XL063-PO-NBR = PLNSHP-PO-NBR                                  
034000             PERFORM 4100-MOVE-TPLNSHP-INFO                               
034100         END-IF                                                           
034200     END-IF.                                                              
034300                                                                          
034400     IF XL063-PO-NBR > POAGMT-PO-NBR                                      
034500         PERFORM 5000-READ-TPOAGMT-INPUT-FILE                             
034600                   UNTIL PS-TPOAGMT-FOUND                                 
034700     ELSE                                                                 
034800         IF XL063-PO-NBR = POAGMT-PO-NBR                                  
034900             PERFORM 5100-MOVE-TPOAGMT-INFO                               
035000             PERFORM 5000-READ-TPOAGMT-INPUT-FILE                         
035100                   UNTIL PS-TPOAGMT-FOUND                                 
035200         END-IF                                                           
035300     END-IF.                                                              
035400                                                                          
035500     PERFORM 6000-WRITE-OUTPUT.                                           
035600     MOVE 'N'  TO PS-TIMPORL-FOUND-SW                                     
035700                  PS-TPLNSHP-FOUND-SW                                     
035800                  PS-TPOAGMT-FOUND-SW.                                    
035900                                                                          
036000*****************************************************************         
036100*  READ A TIMPORL RECORD                                                  
036200*****************************************************************         
036300 3000-READ-TIMPORL-INPUT-FILE.                                            
036400                                                                          
036500     MOVE '3000-READ-TIMPORL-INPUT-FILE' TO PV-ABEND-PARAGRAPH.           
036600                                                                          
036700     IF PS-EOF-TIMPORL-YES                                                
036800         SET PS-TIMPORL-FOUND TO TRUE                                     
036900     ELSE                                                                 
037000         INITIALIZE DCLTIMPORL                                            
037100         READ TIMPORL-FILE                                                
037200              INTO DCLTIMPORL                                             
037300                AT END                                                    
037400                   SET PS-EOF-TIMPORL-YES TO TRUE                         
037500         END-READ                                                         
037600         ADD +1 TO PV-RECS-READ-TIMPORL                                   
037700         IF XL063-PO-NBR   =  IMPORL-PO-NBR                               
037800             PERFORM 3100-MOVE-TIMPORL-INFO                               
037900             SET PS-TIMPORL-FOUND TO TRUE                                 
038000         ELSE                                                             
038100             IF XL063-PO-NBR   <  IMPORL-PO-NBR                           
038200                 SET PS-TIMPORL-FOUND TO TRUE                             
038300             END-IF                                                       
038400         END-IF                                                           
038500     END-IF.                                                              
038600                                                                          
038700*****************************************************************         
038800*  MOVE TIMPORL INFO TO EXTRACT FILE                            *         
038900*****************************************************************         
039000 3100-MOVE-TIMPORL-INFO.                                                  
039100                                                                          
039200     MOVE '3100-MOVE-TIMPORL-INFO ' TO PV-ABEND-PARAGRAPH.                
039300                                                                          
039400     IF IMPORL-CONSLR-ACTL-DTE = '9999-09-09'                             
039500         MOVE SPACES                 TO XL015-CONSLR-ACTL-DTE             
039600     ELSE                                                                 
039700         MOVE IMPORL-CONSLR-ACTL-DTE TO OR-ORIGINAL-DATE                  
039800         MOVE OR-YEAR                TO RF-YEAR                           
039900         MOVE OR-MONTH               TO RF-MONTH                          
040000         MOVE OR-DAY                 TO RF-DAY                            
040100         MOVE RF-REFORMAT-DATE       TO XL015-CONSLR-ACTL-DTE             
040200     END-IF.                                                              
040300     IF IMPORL-CONSLR-REQR-DTE = '9999-09-09'                             
040400         MOVE SPACES                 TO XL015-CONSLR-REQR-DTE             
040500     ELSE                                                                 
040600         MOVE IMPORL-CONSLR-REQR-DTE TO OR-ORIGINAL-DATE                  
040700         MOVE OR-YEAR                TO RF-YEAR                           
040800         MOVE OR-MONTH               TO RF-MONTH                          
040900         MOVE OR-DAY                 TO RF-DAY                            
041000         MOVE RF-REFORMAT-DATE       TO XL015-CONSLR-REQR-DTE             
041100     END-IF.                                                              
041200**?? IF IMPORL-CONSLR-RLSE-CDE = 'N'                                      
041300**??     MOVE 'D'                    TO XL015-CONSLR-RLSE-CDE             
041400**?? ELSE                                                                 
041500         MOVE IMPORL-CONSLR-RLSE-CDE TO XL015-CONSLR-RLSE-CDE.            
041600**?? END-IF.                                                              
041700     IF IMPORL-TKT-PRTR-ACTL-DTE = '9999-09-09'                           
041800         MOVE SPACES                   TO XL015-TKT-MKR-ACTL-DTE          
041900     ELSE                                                                 
042000         MOVE IMPORL-TKT-PRTR-ACTL-DTE TO OR-ORIGINAL-DATE                
042100         MOVE OR-YEAR                  TO RF-YEAR                         
042200         MOVE OR-MONTH                 TO RF-MONTH                        
042300         MOVE OR-DAY                   TO RF-DAY                          
042400         MOVE RF-REFORMAT-DATE         TO XL015-TKT-MKR-ACTL-DTE          
042500     END-IF.                                                              
042600     IF IMPORL-TKT-PRTR-REQR-DTE = '9999-09-09'                           
042700         MOVE SPACES                   TO XL015-TKT-MKR-REQR-DTE          
042800     ELSE                                                                 
042900         MOVE IMPORL-TKT-PRTR-REQR-DTE TO OR-ORIGINAL-DATE                
043000         MOVE OR-YEAR                  TO RF-YEAR                         
043100         MOVE OR-MONTH                 TO RF-MONTH                        
043200         MOVE OR-DAY                   TO RF-DAY                          
043300         MOVE RF-REFORMAT-DATE         TO XL015-TKT-MKR-REQR-DTE          
043400     END-IF.                                                              
043500**?? IF IMPORL-TKT-PRTR-RLSE-CDE = 'N'                                    
043600**??     MOVE 'D'                      TO XL015-TKT-MKR-RLSE-CDE          
043700**?? ELSE                                                                 
043800         MOVE IMPORL-TKT-PRTR-RLSE-CDE TO XL015-TKT-MKR-RLSE-CDE.         
043900**?? END-IF.                                                              
044000                                                                          
044100*****************************************************************         
044200*  READ A TPLNSHP RECORD                                                  
044300*****************************************************************         
044400 4000-READ-TPLNSHP-INPUT-FILE.                                            
044500                                                                          
044600     MOVE '4000-READ-TPLNSHP-INPUT-FILE' TO PV-ABEND-PARAGRAPH.           
044700                                                                          
044800     IF PS-EOF-TPLNSHP-YES                                                
044900         SET PS-TPLNSHP-FOUND TO TRUE                                     
045000     ELSE                                                                 
045100         INITIALIZE DCLTPLNSHP                                            
045200         READ TPLNSHP-FILE                                                
045300              INTO DCLTPLNSHP                                             
045400                AT END                                                    
045500                   SET PS-EOF-TPLNSHP-YES TO TRUE                         
045600         END-READ                                                         
045700         ADD +1 TO PV-RECS-READ-TPLNSHP                                   
045800         IF XL063-PO-NBR   =  PLNSHP-PO-NBR                               
045900             PERFORM 4100-MOVE-TPLNSHP-INFO                               
046000             SET PS-TPLNSHP-FOUND TO TRUE                                 
046100         ELSE                                                             
046200             IF XL063-PO-NBR   <  PLNSHP-PO-NBR                           
046300                 SET PS-TPLNSHP-FOUND TO TRUE                             
046400             END-IF                                                       
046500         END-IF                                                           
046600     END-IF.                                                              
046700                                                                          
046800*****************************************************************         
046900*  MOVE TPLNSHP INFO TO EXTRACT FILE                            *         
047000*****************************************************************         
047100 4100-MOVE-TPLNSHP-INFO.                                                  
047200                                                                          
047300     MOVE '4100-MOVE-TPLNSHP-INFO ' TO PV-ABEND-PARAGRAPH.                
047400                                                                          
047500     IF PLNSHP-DONT-SHIP-BEF-DTE = '0001-01-01'                           
047600         MOVE SPACES                   TO XL015-NOT-BEF-DTE               
047700     ELSE                                                                 
047800         MOVE PLNSHP-DONT-SHIP-BEF-DTE TO OR-ORIGINAL-DATE                
047900         MOVE OR-YEAR                  TO RF-YEAR                         
048000         MOVE OR-MONTH                 TO RF-MONTH                        
048100         MOVE OR-DAY                   TO RF-DAY                          
048200         MOVE RF-REFORMAT-DATE         TO XL015-NOT-BEF-DTE               
      *        DISPLAY 'PO NUMBER         ' XL063-PO-NBR                        
      *        DISPLAY 'XL015-NOT-BEF-DTE ' XL015-NOT-BEF-DTE                   
048300         EXEC SQL                                                         
048400             SELECT SHIPT_WND_DAY_QTY                                     
048500             INTO :POLDTM-SHIPT-WND-DAY-QTY                               
048600             FROM  TPOLDTM                                                
048700         END-EXEC                                                         
048800         EVALUATE TRUE                                                    
048900             WHEN SQLCODE = ZERO                                          
049000                 CONTINUE                                                 
049100             WHEN OTHER                                                   
049200                 MOVE ZERO TO POLDTM-SHIPT-WND-DAY-QTY                    
049300         END-EVALUATE                                                     
      *        DISPLAY 'POLDTM-SHIPT-WND-DAY' POLDTM-SHIPT-WND-DAY-QTY          
049400         EXEC SQL                                                         
049500             SET :PS-CALC-DATE  = DATE(:PLNSHP-DONT-SHIP-BEF-DTE)         
049600                               + :POLDTM-SHIPT-WND-DAY-QTY DAYS           
049700         END-EXEC                                                         
049800         EVALUATE TRUE                                                    
049900             WHEN SQLCODE = ZERO                                          
050000                 CONTINUE                                                 
050100             WHEN OTHER                                                   
050200                 MOVE '0001-01-01'  TO PS-CALC-DATE                       
050300         END-EVALUATE                                                     
      *        DISPLAY 'PLN-DONT-SHIP-BEF-DTE' PLNSHP-DONT-SHIP-BEF-DTE         
      *        DISPLAY 'PS-CALC-DATE  '  PS-CALC-DATE                           
050400         EXEC SQL                                                         
050500             SELECT FSCL_WK_END_DTE                                       
050600              INTO :DTATTR-FSCL-WK-END-DTE                                
050700              FROM  TDTATTR                                               
050800              WHERE  KY_DTE    = :PS-CALC-DATE                            
050900         END-EXEC                                                         
051000         EVALUATE TRUE                                                    
051100             WHEN SQLCODE = ZERO                                          
051200                 CONTINUE                                                 
051300             WHEN SQLCODE = +100                                          
051400                 PERFORM 7000-SELECT-LAST-OTB                             
051500*  DRS 12/26/07  MOVE PLNSHP-DONT-SHIP-BEF-DTE                            
051600*                                       TO DTATTR-FSCL-WK-END-DTE         
051700             WHEN OTHER                                                   
051800                 MOVE SPACES            TO DTATTR-FSCL-WK-END-DTE         
051900         END-EVALUATE                                                     
052000         MOVE DTATTR-FSCL-WK-END-DTE    TO OR-ORIGINAL-DATE               
052100         MOVE OR-YEAR                   TO RF-YEAR                        
052200         MOVE OR-MONTH                  TO RF-MONTH                       
052300         MOVE OR-DAY                    TO RF-DAY                         
052400         MOVE RF-REFORMAT-DATE          TO XL015-OTB-EOW-DTE              
      *        DISPLAY 'XL015-OTB-EOW-DTE ' XL015-OTB-EOW-DTE                   
      *        DISPLAY 'DTATTR-FSCL-WK-END-DTE' DTATTR-FSCL-WK-END-DTE          
052500     END-IF.                                                              
      *CLP 05/29/14 - START                                                     
055300     IF PLNSHP-EXT-CAN-DTE = '0001-01-01'                                 
055600         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO OR-ORIGINAL-DATE               
055700         MOVE OR-YEAR                   TO RF-YEAR                        
055800         MOVE OR-MONTH                  TO RF-MONTH                       
055900         MOVE OR-DAY                    TO RF-DAY                         
056000         MOVE RF-REFORMAT-DATE          TO XL015-NOT-AFT-DTE              
055500     ELSE                                                                 
055600         MOVE PLNSHP-EXT-CAN-DTE        TO OR-ORIGINAL-DATE               
055700         MOVE OR-YEAR                   TO RF-YEAR                        
055800         MOVE OR-MONTH                  TO RF-MONTH                       
055900         MOVE OR-DAY                    TO RF-DAY                         
056000         MOVE RF-REFORMAT-DATE          TO XL015-NOT-AFT-DTE              
056100     END-IF.                                                              
      *CLP 05/29/14 - END                                                       
053500     IF PLNSHP-STRT-FCTRY-DTE = '0001-01-01'                              
053600         MOVE SPACES                 TO XL015-FRST-FCTRY-DTE              
053700     ELSE                                                                 
053800         MOVE PLNSHP-STRT-FCTRY-DTE     TO OR-ORIGINAL-DATE               
053900         MOVE OR-YEAR                   TO RF-YEAR                        
054000         MOVE OR-MONTH                  TO RF-MONTH                       
054100         MOVE OR-DAY                    TO RF-DAY                         
054200         MOVE RF-REFORMAT-DATE          TO XL015-FRST-FCTRY-DTE           
054300     END-IF.                                                              
054400     IF PLNSHP-LAST-FCTRY-DTE = '0001-01-01'                              
054500         MOVE SPACES                    TO XL015-LAST-FCTRY-DTE           
054600     ELSE                                                                 
054700         MOVE PLNSHP-LAST-FCTRY-DTE     TO OR-ORIGINAL-DATE               
054800         MOVE OR-YEAR                   TO RF-YEAR                        
054900         MOVE OR-MONTH                  TO RF-MONTH                       
055000         MOVE OR-DAY                    TO RF-DAY                         
055100         MOVE RF-REFORMAT-DATE          TO XL015-LAST-FCTRY-DTE           
055200     END-IF.                                                              
055300     IF PLNSHP-EXT-CAN-DTE = '0001-01-01'                                 
055400         MOVE SPACES                    TO XL015-EXTD-NOT-AFT-DTE         
055500     ELSE                                                                 
055600         MOVE PLNSHP-EXT-CAN-DTE        TO OR-ORIGINAL-DATE               
055700         MOVE OR-YEAR                   TO RF-YEAR                        
055800         MOVE OR-MONTH                  TO RF-MONTH                       
055900         MOVE OR-DAY                    TO RF-DAY                         
056000         MOVE RF-REFORMAT-DATE          TO XL015-EXTD-NOT-AFT-DTE         
056100     END-IF.                                                              
056200     MOVE PLNSHP-POE-CDE  TO XL015-POE-CDE.                               
056300     MOVE PLNSHP-FOB-CDE  TO XL015-FOB-CDE.                               
056400                                                                          
056500*****************************************************************         
056600*  READ A TPOAGMT RECORD                                                  
056700*****************************************************************         
056800 5000-READ-TPOAGMT-INPUT-FILE.                                            
056900                                                                          
057000     MOVE '5000-READ-TPOAGMT-INPUT-FILE' TO PV-ABEND-PARAGRAPH.           
057100                                                                          
057200     IF PS-EOF-TPOAGMT-YES                                                
057300         SET PS-TPOAGMT-FOUND TO TRUE                                     
057400     ELSE                                                                 
057500         INITIALIZE DCLTPOAGMT                                            
057600         READ TPOAGMT-FILE                                                
057700              INTO DCLTPOAGMT                                             
057800                AT END                                                    
057900                   SET PS-EOF-TPOAGMT-YES TO TRUE                         
058000         END-READ                                                         
058100         ADD +1 TO PV-RECS-READ-TPOAGMT                                   
058200         IF XL063-PO-NBR   =  POAGMT-PO-NBR                               
058300             PERFORM 5100-MOVE-TPOAGMT-INFO                               
058400         ELSE                                                             
058500             IF XL063-PO-NBR   <  POAGMT-PO-NBR                           
058600                 SET PS-TPOAGMT-FOUND TO TRUE                             
058700             END-IF                                                       
058800         END-IF                                                           
058900     END-IF.                                                              
059000                                                                          
059100*****************************************************************         
059200*  MOVE TPOAGMT INFO TO EXTRACT FILE                            *         
059300*****************************************************************         
059400 5100-MOVE-TPOAGMT-INFO.                                                  
059500                                                                          
059600     MOVE '5100-MOVE-TPOAGMT-INFO ' TO PV-ABEND-PARAGRAPH.                
059700                                                                          
059800     IF POAGMT-AGRMT-TYP-ID = '2' AND POAGMT-TYP-CDE = 0                  
059900         MOVE POAGMT-PAYT-TERM-ID   TO  XL015-PAYT-TERM-ID                
060000     END-IF.                                                              
060100     IF POAGMT-AGRMT-TYP-ID = '4' AND POAGMT-TYP-CDE = 4                  
060200         MOVE 'Y'              TO XL015-PK-BY-STR-IND                     
060300     END-IF.                                                              
060400     IF POAGMT-AGRMT-TYP-ID = '4' AND POAGMT-TYP-CDE = 2                  
060500         MOVE 'Y'              TO XL015-HNG-IND                           
060600     END-IF.                                                              
060700     IF POAGMT-AGRMT-TYP-ID = '4' AND POAGMT-TYP-CDE = 1                  
060800         MOVE 'Y'                      TO XL015-PTKT-IND                  
060900         MOVE POAGMT-LEADTIME-DAYS-QTY TO XL015-PTKT-LDTM-DAYS-QTY        
061000     END-IF.                                                              
061100                                                                          
061200*****************************************************************         
061300*  WRITE A RECORDS TO THE LOGISTICS SKU OUTPUT FILE             *         
061400*****************************************************************         
061500 6000-WRITE-OUTPUT.                                                       
061600                                                                          
061700     WRITE OUTPUT-RECORD FROM                                             
061800         XL015-RECORD                                                     
061900     END-WRITE.                                                           
062000     ADD +1                 TO PV-RECORDS-WRITTEN.                        
062100                                                                          
062200                                                                          
062300 7000-SELECT-LAST-OTB.                                                    
062400                                                                          
062500     EXEC SQL                                                             
062600         SELECT MAX(B.KY_DTE)                                             
062700             INTO                                                         
062800             :DTATTR-FSCL-WK-END-DTE                                      
062900             FROM TDTATTR B                                               
063000         WITH UR                                                          
063100     END-EXEC                                                             
063200                                                                          
063300     EVALUATE TRUE                                                        
063400       WHEN SQLCODE = ZERO                                                
063500          CONTINUE                                                        
063600*          MOVE DK-YEAR               TO PV-YEAR-N                        
063700*          MOVE DK-MONTH              TO PV-MONTH-N                       
063800*          MOVE PV-YEAR-X             TO POWS055-OTB-YEAR                 
063900*          MOVE PV-MONTH-X (3:2)      TO POWS055-OTB-MONTH                
064000       WHEN OTHER                                                         
064100           CONTINUE                                                       
064200     END-EVALUATE.                                                        
064300                                                                          
