000100 IDENTIFICATION DIVISION.                                         00010000
000200*                                                                 00020000
000300 PROGRAM-ID.    TXKUT021.                                         00030000
000400*                                                                 00040000
000500 AUTHOR.        BARB SCHULTZ.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  09/2020.                                          00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*                                                                *00100000
001100*  THIS PROGRAM GETS THE STATE CODE FROM THE TABLE TADZIP FOR    *00110000
001200*  MARKETPLACE TRANSACTIONS.  AN EXCEPTION REPORT IS WRITTEN OUT *00120000
001300*  FOR ANY INVALID ZIP CODES OR ANY ZIP CODES WHICH MAY EXIST IN *00130000
001400*  MORE THAN ONE STATE.                                          *00140000
001500*                                                                *00150000
001600******************************************************************00160000
001700* DATE  XX/XX/XXXX                                               *00220000
001800*     CHANGE MADE:                                               *00230000
001900*     MADE BY:                         WR/IR #: CHG              *00280000
002000******************************************************************00281000
002400 ENVIRONMENT DIVISION.                                            00330000
002500*                                                                 00340000
002600*                                                                 00350000
002700 CONFIGURATION SECTION.                                           00360000
002800 SOURCE-COMPUTER. IBM-3090.                                       00370000
002900 OBJECT-COMPUTER. IBM-3090.                                       00380000
003000*                                                                 00390000
003100*                                                                 00400000
003200 INPUT-OUTPUT SECTION.                                            00410000
003300 FILE-CONTROL.                                                    00420000
003400                                                                  00430000
003500                                                                  00440000
003600     SELECT TAX-IN-FILE                                           00450000
003700         ASSIGN                       TO INP01.                   00460000
003800                                                                  00470000
003900     SELECT TAX-OUT-FILE                                          00480000
004000         ASSIGN                       TO OUT01.                   00490000
004100                                                                  00500000
004200     SELECT TAX-ERROR-FILE                                        00510000
004300         ASSIGN                       TO OUT02.                   00520000
004400                                                                  00530000
004500     SELECT TAX-ERROR-REPORT                                      00540000
004600         ASSIGN                       TO RPT01.                   00550000
004700                                                                  00560000
CHG205     SELECT ORACLE-LOGON-FILE                                     00570000
CHG205         ASSIGN                       TO ORALOGON.                00580000
004700                                                                  00590000
004900*                                                                 00610000
005000***************************************************************** 00620000
005100 DATA DIVISION.                                                   00630000
005200***************************************************************** 00640000
005300*                                                                 00650000
005400 FILE SECTION.                                                    00660000
005500*                                                                 00670000
005600 FD  TAX-IN-FILE                                                  00680000
005700     RECORDING MODE IS F                                          00690000
005800     LABEL RECORDS ARE STANDARD                                   00700000
005900     BLOCK CONTAINS 0 RECORDS                                     00710000
006000     RECORD CONTAINS 155 CHARACTERS                               00720000
006100     DATA RECORD IS TX-TAX-IN-FILE.                               00730000
006200                                                                  00740000
006300 01  TX-TAX-IN-FILE             PIC X(155).                       00750000
006400                                                                  00760000
006500*                                                                 00770000
006600 FD  TAX-OUT-FILE                                                 00780000
006700     RECORDING MODE IS F                                          00790000
006800     LABEL RECORDS ARE STANDARD                                   00800000
006900     BLOCK CONTAINS 0 RECORDS                                     00810000
007000     RECORD CONTAINS 155 CHARACTERS                               00820000
007100     DATA RECORD IS TX-TAX-OUT-FILE.                              00830000
007200                                                                  00840000
007300 01  TX-TAX-OUT-FILE             PIC X(155).                      00850000
007400                                                                  00860000
007500*                                                                 00870000
007600 FD  TAX-ERROR-FILE                                               00880000
007700     RECORDING MODE IS F                                          00890000
007800     LABEL RECORDS ARE STANDARD                                   00900000
007900     BLOCK CONTAINS 0 RECORDS                                     00910000
008000     RECORD CONTAINS 155 CHARACTERS                               00920000
008100     DATA RECORD IS TX-TAX-ERROR-FILE.                            00930000
008200                                                                  00940000
008300 01  TX-TAX-ERROR-FILE           PIC X(155).                      00950000
008400                                                                  00960000
008500*                                                                 00970000
008600 FD  TAX-ERROR-REPORT                                             00980000
008700     RECORDING MODE IS F                                          00990000
008800     LABEL RECORDS ARE STANDARD                                   01000000
008900     BLOCK CONTAINS 0 RECORDS                                     01010000
009000     RECORD CONTAINS 132 CHARACTERS                               01020002
009100     DATA RECORD IS TX-TAX-ERROR-REPORT.                          01030000
009200                                                                  01040000
009300 01  TX-TAX-ERROR-REPORT         PIC X(132).                      01050002
009400                                                                  01060000
009400*                                                                 01070000
CHG205 FD  ORACLE-LOGON-FILE                                            01080000
CHG205     RECORDING MODE IS F                                          01090000
CHG205     LABEL RECORDS ARE STANDARD                                   01100000
CHG205     BLOCK CONTAINS 0 RECORDS                                     01110000
CHG205     RECORD CONTAINS 80 CHARACTERS                                01120000
CHG205     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      01130000
CHG205                                                                  01140000
CHG205 01  OL-ORACLE-LOGON-RECORD      PIC X(80).                       01150000
009500*                                                                 01170000
009700*                                                                 01190000
009800 WORKING-STORAGE SECTION.                                         01200000
009900*                                                                 01210000
010000***************************************************************** 01220000
010100*  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 01230000
010200***************************************************************** 01240000
010300     COPY DPWS132O.                                               01250000
010400*                                                                 01260000
010500****************************************************************  01270000
010600* RECORD LAYOUT FOR TAX ADJUSTMENT RECORD                         01280000
010700****************************************************************  01290000
010800     COPY TXRD020.                                                01300000
010900*                                                                 01310000
011000 01  TAX-ERROR-RECORD.                                            01320000
011100     05  TX-ERROR-STR-NBR                   PIC   9(04).          01330000
011200     05  TX-ERROR-ZIP-CDE                   PIC   X(05).          01340000
011300     05  TX-ERROR-PROCESS-DTE               PIC   X(10).          01350000
011400     05  TX-ERROR-RGST-ID                   PIC  S9(4)  COMP.     01360000
011500     05  TX-ERROR-TRN-NBR                   PIC  S9(4)  COMP.     01370000
011600     05  TX-ERROR-START-TIME                PIC   X(08).          01380000
011700     05  TX-ERROR-SLS-CORR-SEQ-NBR          PIC  S9(04) COMP.     01390000
011800     05  FILLER                             PIC   X(36).          01400000
011900                                                                  01410000
012000 01  WS-ERROR-FIELDS.                                             01420000
012100     05 WS-MSG-TEXT                  PIC X(512).                  01430000
012200     05 WS-MAX-SIZE                  PIC S9(09) COMP              01440000
012300                                                 VALUE +512.      01450000
012400     05 WS-MSG-LENGTH                PIC S9(09) COMP.             01460000
012500     05 WS-ABEND-CODE                PIC S9(04) COMP SYNC         01470000
012600                                                VALUE ZEROS.      01480000
012700                                                                  01490000
012800 01 PV-PROGRAM-VARIABLES.                                         01500000
012900                                                                  01510000
CHG205    05  PV-ORACLE-USERID-LEN   PIC S9(04) VALUE ZEROS             01520000
CHG205                                          COMP SYNC.              01530000
CHG205    05  PV-ORACLE-PASSWORD-LEN PIC S9(04) VALUE ZEROS             01540000
CHG205                                          COMP SYNC.              01550000
013000    05  PV-PRINT-RECORD        PIC X(200) VALUE SPACE.            01560000
013100    05  PVP-ABEND-PARAGRAPH    PIC X(40)  VALUE SPACES.           01570000
013200    05  PVP-ABEND-CODE         PIC S9(04) COMP SYNC VALUE +0000.  01580000
C70860    05  PV-STR-NBR-SFS-ECOMM   PIC 9(04) VALUE 0873.              01590000
013300    05  PV-PAGE-CNT            PIC 9(03)  VALUE ZEROES.           01600000
013400    05  PV-LINES               PIC S9(4)  COMP.                   01610000
013500    05  PV-LINE-SPACING        PIC 9(03)  VALUE ZEROES.           01620000
013600    05  PV-READ-CNT            PIC 9(07)  COMP-3 VALUE ZEROES.    01630000
013710    05  PV-OUT-CNT             PIC 9(07)  COMP-3 VALUE ZEROES.    01640000
013711    05  PV-ERROR-CNT           PIC 9(07)  COMP-3 VALUE ZEROES.    01650000
013712    05  PV-DISPLAY-CNT         PIC Z,ZZZ,ZZ9.                     01660000
013900    05  PV-SAVE-ZIP-CDE        PIC X(05)  VALUE SPACES.           01670000
014000    05  PV-CURR-DATE-CCYYMMDD.                                    01680000
014100        10  PV-CURR-DATE-CCYY       PIC  9(04).                   01690000
014200        10  PV-CURR-DATE-MM         PIC  9(02).                   01700000
014300        10  PV-CURR-DATE-DD         PIC  9(02).                   01710000
014400    05  PV-CURR-TIME.                                             01720000
014500        10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.     01730000
014600        10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.     01740000
014700        10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.     01750000
014800    05  PV-HEADER-DATE.                                           01760000
014900        10  PV-HEADER-MM            PIC XX.                       01770000
015000        10  PV-HEADER-SLASH-1       PIC X.                        01780000
015100        10  PV-HEADER-DD            PIC XX.                       01790000
015200        10  PV-HEADER-SLASH-2       PIC X.                        01800000
015300        10  PV-HEADER-CCYY          PIC X(04).                    01810000
015400                                                                  01820000
015500 01 PS-PROGRAM-SWITCHES.                                          01830000
                                                                        01840000
CHG205     05  PS-END-OF-LOGON-FILE-SW    PIC X(1)   VALUE 'N'.         01850000
CHG205         88  PS-END-OF-LOGON-FILE              VALUE 'Y'.         01860000
CHG205     05  PS-ORA-SRC-CTL-DONE-SW     PIC X(1)   VALUE 'N'.         01870000
CHG205         88  PS-ORA-SRC-EMPTY                  VALUE 'Y'.         01880000
015700     05  PS-END-OF-TAX-FILE-SW    PIC X(1)     VALUE 'N'.         01890000
015800         88  PS-END-OF-TAX-FILE                VALUE 'Y'.         01900000
015900         88  PS-NOT-END-OF-TAX-FILE            VALUE 'N'.         01910000
015910     05  PS-ZIP-CODE-ERROR-SW    PIC X(1)      VALUE 'N'.         01920000
015920         88  PS-ZIP-CODE-ERROR                 VALUE 'Y'.         01930000
015930         88  PS-ZIP-CODE-ERROR-NO              VALUE 'N'.         01940000
016000                                                                  01950000
CHG205 01  CC-ORACLE-CONNECTION.                                        01960000
CHG205     05  CC-ORACLE-USERID           PIC X(40).                    01970000
CHG205         88 CC-AUTO-LOGON                       VALUE '/'.        01980000
CHG205     05  CC-ORACLE-PASSWORD         PIC X(40).                    01990000
016000                                                                  02000000
016100 01  PC-PROGRAM-CONSTANTS.                                        02010000
CHG205     05  PC-AUTO-LOGON              PIC  X(01) VALUE '/'.         02020000
016200     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)     VALUE         02030000
016300                                                   'TXKUT021'.    02040000
016400     05  PC-LINE-LIMIT               PIC S9(04)  VALUE +60.       02050000
016500     05  PC-MAX-LINES                PIC S9(03)  VALUE +78        02060000
016600                                                 COMP-3.          02070000
016700                                                                  02080000
016800 01  RH-HEADER1.                                                  02090000
016900     05  FILLER                    PIC X(43)  VALUE SPACES.       02100000
017000     05  FILLER                    PIC X(46)  VALUE               02110000
017100        'INVALID ZIP CODES PASSED FROM ECOMMERCE STORE.'.         02120000
017200     05  FILLER                    PIC X(43)  VALUE SPACES.       02130000
017300                                                                  02140000
017400 01  RH-HEADER2.                                                  02150000
017500     05  FILLER                  PIC X(05)  VALUE SPACES.         02160000
017600     05  FILLER                  PIC X(11)  VALUE 'STORE'.        02170000
017700     05  FILLER                  PIC X(45)  VALUE '            '. 02180000
017800     05  FILLER                  PIC X(10)  VALUE 'TRANS'.        02190000
017900     05  FILLER                  PIC X(12)  VALUE 'PROCESS'.      02200000
018000     05  FILLER                  PIC X(13)  VALUE 'REGISTER'.     02210000
018100     05  FILLER                  PIC X(10)  VALUE 'START'.        02220000
018200     05  FILLER                  PIC X(19)  VALUE 'S/S CORR'.     02230000
018300     05  FILLER                  PIC X(04)  VALUE 'ZIP'.          02240000
018400     05  FILLER                  PIC X(03)  VALUE SPACES.         02250000
018500                                                                  02260000
018600 01  RH-HEADER3.                                                  02270000
018700     05  FILLER                  PIC X(05)  VALUE SPACES.         02280000
018800     05  FILLER                  PIC X(11)  VALUE 'NUMBER'.       02290000
018900     05  FILLER                  PIC X(45)  VALUE 'ORDER NUMBER'. 02300000
019000     05  FILLER                  PIC X(10)  VALUE 'NUMBER'.       02310000
019100     05  FILLER                  PIC X(12)  VALUE 'DATE'.         02320000
019200     05  FILLER                  PIC X(13)  VALUE 'ID NUMBER'.    02330000
019300     05  FILLER                  PIC X(10)  VALUE 'TIME'.         02340000
019400     05  FILLER                  PIC X(19)  VALUE 'SEQ NUMBER'.   02350000
019500     05  FILLER                  PIC X(04)  VALUE 'CODE'.         02360000
019600     05  FILLER                  PIC X(03)  VALUE SPACES.         02370000
019700                                                                  02380000
019800 01  RD1-DETAIL-LINE.                                             02390000
019900     05  FILLER                  PIC X(05)    VALUE SPACES.       02400000
020000     05  RD1-STORE-NBR           PIC 9(04)    VALUE ZERO.         02410000
020100     05  FILLER                  PIC X(07)    VALUE SPACES.       02420000
020200     05  RD1-ECOMMERCE-ORD-NBR   PIC X(40)    VALUE SPACES.       02430000
020300     05  FILLER                  PIC X(05)    VALUE SPACES.       02440000
020400     05  RD1-TRANSACTION-NBR     PIC X(04)    VALUE SPACES.       02450000
020500     05  FILLER                  PIC X(06)    VALUE SPACES.       02460000
020600     05  RD1-PROCESS-DATE        PIC X(10)    VALUE SPACES.       02470000
020700     05  FILLER                  PIC X(02)    VALUE SPACES.       02480000
020800     05  RD1-RGST-ID             PIC 9(04)    VALUE ZERO.         02490000
020900     05  FILLER                  PIC X(09)    VALUE SPACES.       02500000
021000     05  RD1-START-TIME          PIC X(08)    VALUE SPACES.       02510000
021100     05  FILLER                  PIC X(06)    VALUE SPACES.       02520000
021200     05  RD1-SLS-CORR-SEQ-NBR    PIC 9(04)    VALUE ZERO.         02530000
021300     05  FILLER                  PIC X(09)    VALUE SPACES.       02540000
021400     05  RD1-ZIP-CODE            PIC X(09)    VALUE SPACES.       02550000
021500                                                                  02560000
021700*---------------------------------------------------------------* 02580000
021800*    ORACLE DECLARE SECTION                                       02590000
021900*---------------------------------------------------------------* 02600000
022000     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02610000
022100                                                                  02620000
022200 01  USERNAME                        PIC X(10)      VARYING.      02630000
022300 01  PASSWD                          PIC X(10)      VARYING.      02640000
022400 01  PC-ENT01-TYPE-CDE               PIC X(02)      VALUE '01'.   02650000
022500 01  PV-ORACLE-ID                    PIC X(01)      VALUE '/'.    02660000
022600 01  WS-HOST-VARIABLES.                                           02670000
022700     05  WS-STATE-CODE               PIC   X(02).                 02680000
022800     05  WS-ZIP-CODE                 PIC   X(05).                 02690000
022900                                                                  02700000
023000     EXEC SQL END DECLARE SECTION END-EXEC.                       02710000
023100                                                                  02720000
023200     EXEC SQL INCLUDE SQLCACOB      END-EXEC.                     02730000
023300                                                                  02740000
023800****************************************************************  02790000
023900 PROCEDURE DIVISION.                                              02800000
024000****************************************************************  02810000
024100                                                                  02820000
024200****************************************************************  02830000
024300* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  02840000
024400* PROGRAM.                                                     *  02850000
024500****************************************************************  02860000
024600                                                                  02870000
024700 0000-PROGRAM-MAINLINE.                                           02880000
024800                                                                  02890000
024900     PERFORM 1000-INITIALIZATION.                                 02900000
025000                                                                  02910000
025001     PERFORM 2000-PROCESS-TAX-FILE                                02920000
025010        UNTIL PS-END-OF-TAX-FILE.                                 02930000
025020                                                                  02940000
025030     PERFORM 3000-END-ROUTINE.                                    02950000
025040                                                                  02960000
025100     GOBACK.                                                      02970000
025200                                                                  02980000
025400*                                                                 03000000
025500****************************************************************  03010000
025600* 1000-INITIALIZATION OPENS ALL FILES, CONNECTS TO ORACLE      *  03020000
025700*      FORMATS THE PERIOD BEGIN AND END DATES                  *  03030000
025800*      OPENS THE CURSOR AND PERFORMS FIRST CURSOR FETCH        *  03040000
025900****************************************************************  03050000
026000 1000-INITIALIZATION.                                             03060000
026100                                                                  03070000
026200     PERFORM 8000-ORACLE-SETUP.                                   03080000
026300                                                                  03090000
026400     OPEN   INPUT  TAX-IN-FILE.                                   03100000
026500     OPEN   OUTPUT TAX-OUT-FILE.                                  03110000
026600     OPEN   OUTPUT TAX-ERROR-FILE.                                03120000
026700     OPEN   OUTPUT TAX-ERROR-REPORT.                              03130000
026800                                                                  03140000
026900     PERFORM 9000-FORMAT-HEADINGS.                                03150000
027000     PERFORM 9100-HEADER-ROUTINE-1.                               03160000
027100                                                                  03170000
027200     PERFORM 2200-READ-TAX-FILE.                                  03180000
027400                                                                  03190000
027500****************************************************************  03200000
027600* 2000-PROCESS-TAX-FILE                                        *  03210000
027700****************************************************************  03220000
027800 2000-PROCESS-TAX-FILE.                                           03230000
028000                                                                  03240000
028100     IF TX020-ZIP-CDE NOT = PV-SAVE-ZIP-CDE                       03250000
028110         SET PS-ZIP-CODE-ERROR-NO TO TRUE                         03260000
028200         IF TX020-ST-CDE = SPACES                                 03270000
                   DISPLAY 'GO TO 2100-READ '                           03271008
028300             PERFORM 2100-READ-TADZIP-CURSOR                      03280000
028310         ELSE                                                     03290000
028320             MOVE TX020-ST-CDE TO WS-STATE-CODE                   03300000
028400         END-IF                                                   03310000
028500         MOVE TX020-ZIP-CDE TO PV-SAVE-ZIP-CDE                    03320000
               DISPLAY 'PV-SAVE-ZIP-CDE E ' PV-SAVE-ZIP-CDE             03321007
               DISPLAY 'TX020-ZIP-CDE E ' TX020-ZIP-CDE                 03322006
028700     END-IF.                                                      03330000
029200                                                                  03370000
029201     IF TX020-ZIP-CDE = SPACES                                    03380000
029202        SET PS-ZIP-CODE-ERROR    TO TRUE                          03390000
029203     END-IF.                                                      03400000
029204                                                                  03410000
029205     IF PS-ZIP-CODE-ERROR-NO                                      03420000
029206         MOVE WS-STATE-CODE TO TX020-ST-CDE                       03430000
               DISPLAY 'TX020-ST-CDE 1 ' TX020-ST-CDE                   03431004
029207         PERFORM 5000-WRITE-RECORD                                03440000
029208     ELSE                                                         03450000
029210         PERFORM 6000-PROCESS-ERROR                               03460000
029220     END-IF.                                                      03470000
029230                                                                  03480000
029700     PERFORM 2200-READ-TAX-FILE.                                  03490000
029800                                                                  03500000
029900******************************************************************03510000
030000* 2100-READ THE TADZIP CURSOR...                                  03520000
030100******************************************************************03530000
030200 2100-READ-TADZIP-CURSOR.                                         03540000
031800                                                                  03550000
031900     MOVE '2100-READ-TADZIP-CURSOR' TO PVP-ABEND-PARAGRAPH.       03560000
032000     MOVE TX020-ZIP-CDE TO WS-ZIP-CODE.                           03570005
           DISPLAY 'TX020-ZIP-CDE ' TX020-ZIP-CDE.                      03571004
           DISPLAY 'WS-ZIP-CODE ' WS-ZIP-CODE.                          03572004
032100                                                                  03580000
032200     EXEC SQL                                                     03590000
032300       SELECT                                                     03600000
032400         TADZIP.ST_CDE                                            03610000
032500       INTO                                                       03620000
032600         :WS-STATE-CODE                                           03630000
032700       FROM                                                       03640000
032800        TADZIP                                                    03650000
032900       WHERE                                                      03660000
033000         TADZIP.ZIP_CDE = :WS-ZIP-CODE                            03670000
033100     END-EXEC.                                                    03680000
033200                                                                  03690000
033300     EVALUATE TRUE                                                03700000
033400         WHEN SQLCODE = ZERO                                      03710000
033600             CONTINUE                                             03720000
                   DISPLAY 'WS-STATE-CODE ' WS-STATE-CODE               03721004
033800         WHEN SQLCODE = -1405                                     03730000
033900         WHEN SQLCODE = +1403                                     03740000
034000         WHEN SQLCODE = -1403                                     03750000
034100             DISPLAY 'ZIP CODE NOT FOUND: ' WS-ZIP-CODE           03760000
034110             SET PS-ZIP-CODE-ERROR TO TRUE                        03770000
034300         WHEN OTHER                                               03780000
034400             PERFORM Z999-SQL-ERROR                               03790000
034500     END-EVALUATE.                                                03800000
034501                                                                  03810000
034502******************************************************************03820000
034503* 2200-READ-TAX-FILE                                              03830000
034504******************************************************************03840000
034510 2200-READ-TAX-FILE.                                              03850000
034511                                                                  03860000
034520     MOVE SPACES TO TX020-MARKETPLACE-RECORD.                     03870003
034530                                                                  03880000
034540     READ TAX-IN-FILE                                             03890000
034550         INTO TX020-MARKETPLACE-RECORD                            03900003
034560         AT END                                                   03910000
034570             SET PS-END-OF-TAX-FILE TO TRUE                       03920000
034580     END-READ.                                                    03930000
034590                                                                  03940000
034591     IF NOT PS-END-OF-TAX-FILE                                    03950000
034592         ADD  1    TO  PV-READ-CNT                                03960000
CHG859     END-IF.                                                      03970000
034590                                                                  03971002
034600***************************************************************** 03980000
034700* 3000-END-ROUTINE                                              * 03990000
034800* CLOSE FILES                                                   * 04000000
034900***************************************************************** 04010000
035000                                                                  04020000
035100 3000-END-ROUTINE.                                                04030000
035200                                                                  04040000
035300     CLOSE TAX-IN-FILE.                                           04050000
035400     CLOSE TAX-OUT-FILE.                                          04060000
035500     CLOSE TAX-ERROR-FILE.                                        04070000
035600     CLOSE TAX-ERROR-REPORT.                                      04080000
035700                                                                  04090000
035710     MOVE PV-READ-CNT TO PV-DISPLAY-CNT.                          04100000
035800     DISPLAY 'RECORDS READ:          ' PV-DISPLAY-CNT.            04110000
035810     MOVE PV-OUT-CNT TO PV-DISPLAY-CNT.                           04120000
035900     DISPLAY 'RECORDS WRITTEN:       ' PV-DISPLAY-CNT.            04130000
035901     MOVE PV-ERROR-CNT TO PV-DISPLAY-CNT.                         04140000
035902     DISPLAY 'ERROR RECORDS WRITTEN: ' PV-DISPLAY-CNT.            04150000
036000                                                                  04160000
036200****************************************************************  04170000
036300* 5000-WRITE-RECORD                                               04180000
036400****************************************************************  04190000
036500 5000-WRITE-RECORD.                                               04200000
036600                                                                  04210000
036700     WRITE TX-TAX-OUT-FILE FROM TX020-MARKETPLACE-RECORD.         04220004
036800     ADD  1    TO  PV-OUT-CNT.                                    04230000
036900                                                                  04240000
037000****************************************************************  04250000
037100* 6000-PROCESS-ERROR                                              04260000
037200****************************************************************  04270000
037300 6000-PROCESS-ERROR.                                              04280000
037400                                                                  04290000
037500     WRITE TX-TAX-ERROR-FILE FROM TX020-MARKETPLACE-RECORD.       04300003
037600     PERFORM 7000-WRITE-ERROR-REPORT.                             04310000
037700     ADD  1    TO  PV-ERROR-CNT.                                  04320000
037800                                                                  04330000
037900****************************************************************  04340000
038000* 7000-WRITE-ERROR-REPORT                                         04350000
038100****************************************************************  04360000
038200 7000-WRITE-ERROR-REPORT.                                         04370000
038300                                                                  04380000
038400     IF  PV-LINES       GREATER PC-MAX-LINES                      04390000
038500         PERFORM 9100-HEADER-ROUTINE-1                            04400000
038600     END-IF.                                                      04410000
038700                                                                  04420000
038800     MOVE TX020-ZIP-CDE                TO RD1-ZIP-CODE.           04430000
038900     MOVE TX020-STR-NBR                TO RD1-STORE-NBR.          04440000
039000     MOVE TX020-ORDER-NUMBER           TO RD1-ECOMMERCE-ORD-NBR.  04450002
039100     MOVE TX020-TRN-NBR                TO RD1-TRANSACTION-NBR.    04460000
039200     MOVE TX020-ORDER-DTE              TO RD1-PROCESS-DATE.       04470002
039300     MOVE TX020-RGST-ID                TO RD1-RGST-ID.            04480000
039400     MOVE TX020-START-TIME             TO RD1-START-TIME.         04490000
039500     MOVE TX020-SLS-CORR-SEQ-NBR       TO RD1-SLS-CORR-SEQ-NBR.   04500000
039600                                                                  04510000
039700     WRITE TX-TAX-ERROR-REPORT FROM RD1-DETAIL-LINE               04520000
039800         AFTER ADVANCING 2 LINES.                                 04530000
039900     ADD  2                        TO  PV-LINES.                  04540000
040000                                                                  04550000
040100****************************************************************  04560000
040200* LOGON TO ORACLE                                                 04570000
040300****************************************************************  04580000
040400 8000-ORACLE-SETUP.                                               04590000
                                                                        04600000
CHG205     OPEN INPUT ORACLE-LOGON-FILE.                                04610000
CHG205                                                                  04620000
CHG205     PERFORM 8000-READ-ORACLE-LOGON.                              04630000
CHG205                                                                  04640000
CHG205     CLOSE ORACLE-LOGON-FILE.                                     04650000
CHG205                                                                  04660000
CHG205     IF ((PS-END-OF-LOGON-FILE)                                   04670000
CHG205             OR (CC-ORACLE-CONNECTION = SPACES))                  04680000
CHG205         DISPLAY '** ABEND **'                                    04690000
CHG205         DISPLAY PC-CURRENT-PROGRAM-NAME                          04700000
CHG205                   ' - ORACLE LOGON CONTROL CARD '                04710000
CHG205                   'NOT PROVIDED'                                 04720000
CHG205         SET PS-ORA-SRC-EMPTY TO TRUE                             04730000
CHG205         CALL 'ILBOABN0' USING WS-ABEND-CODE                      04740000
CHG205     END-IF.                                                      04750000
CHG205                                                                  04760000
CHG205     IF CC-AUTO-LOGON                                             04770000
CHG205         DISPLAY PC-CURRENT-PROGRAM-NAME                          04780000
CHG205                   ' - AUTO LOGON TO ORACLE'                      04790000
CHG205         EXEC SQL                                                 04800000
CHG205              CONNECT :USERNAME                                   04810000
CHG205         END-EXEC                                                 04820000
CHG205     ELSE                                                         04830000
CHG205         INITIALIZE PV-ORACLE-USERID-LEN                          04840000
CHG205                    PV-ORACLE-PASSWORD-LEN                        04850000
CHG205         INSPECT CC-ORACLE-USERID                                 04860000
CHG205             TALLYING PV-ORACLE-USERID-LEN                        04870000
CHG205          FOR CHARACTERS BEFORE INITIAL SPACE                     04880000
CHG205      INSPECT CC-ORACLE-PASSWORD                                  04890000
CHG205          TALLYING PV-ORACLE-PASSWORD-LEN                         04900000
CHG205          FOR CHARACTERS BEFORE INITIAL SPACE                     04910000
CHG205      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           04920000
CHG205                USERNAME-ARR                                      04930000
CHG205      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   04940000
CHG205      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       04950000
CHG205                PASSWD-ARR                                        04960000
CHG205      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   04970000
CHG205      DISPLAY PC-CURRENT-PROGRAM-NAME                             04980000
CHG205               ' - LOGON TO ORACLE AS USER '                      04990000
CHG205               USERNAME-ARR                                       05000000
CHG205      EXEC SQL                                                    05010000
CHG205        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   05020000
CHG205      END-EXEC                                                    05030000
CHG205      INITIALIZE CC-ORACLE-PASSWORD                               05040000
CHG205                 PASSWD                                           05050000
CHG205      END-IF.                                                     05060000
CHG205                                                                  05070000
CHG205     IF (SQLCODE NOT = 0)                                         05080000
CHG205         DISPLAY  PVP-ABEND-PARAGRAPH                             05090000
CHG205         DISPLAY PC-CURRENT-PROGRAM-NAME                          05100000
CHG205                  ' - ERROR LOGGING ON TO ORACLE'                 05110000
CHG205         PERFORM Z999-SQL-ERROR                                   05120000
CHG205     END-IF.                                                      05130000
                                                                        05140000
                                                                        05150000
      ***************************************************************** 05160000
      *  B120-READ-ORACLE-LOGON.                                      * 05170000
      * ==> PROCESSES:                                                * 05180000
      *   - READ ORCALE CONTROL CARD                                  * 05190000
      * ==> PERFORMED FROM:  B110-ORACLE-SETUP                        * 05200000
      ***************************************************************** 05210000
       8000-READ-ORACLE-LOGON.                                          05220000
                                                                        05230000
CHG205     READ ORACLE-LOGON-FILE                                       05240000
CHG205         INTO CC-ORACLE-CONNECTION                                05250000
CHG205         AT END                                                   05260000
CHG205             SET PS-END-OF-LOGON-FILE TO TRUE                     05270000
CHG205     END-READ.                                                    05280000
                                                                        05290000
041999****************************************************************  05300000
042100*Z999-SQL-ERROR.                                                 *05310000
042200******************************************************************05320000
042300 Z999-SQL-ERROR.                                                  05330000
042400                                                                  05340000
042500     DISPLAY '** ABEND **       ** = SQLERROR'.                   05350000
042600     DISPLAY '** PROGRAM        ** = TXKUT021'.                   05360000
042700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05370000
042800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05380000
042900     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05390000
043000                                                                  05400000
043100                                                                  05410000
043200     MOVE SPACES TO WS-MSG-TEXT.                                  05420000
043300                                                                  05430000
043400     CALL 'SQLGLM' USING WS-MSG-TEXT,                             05440000
043500                         WS-MAX-SIZE,                             05450000
043600                         WS-MSG-LENGTH.                           05460000
043700     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               05470000
043800                                                                  05480000
043900     MOVE +4013 TO WS-ABEND-CODE.                                 05490000
044000     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         05500000
044100                                                                  05510000
044200******************************************************************05520000
044300* 9000-FORMAT-HEADINGS                                            05530000
044400*     GET CURRENT DATE AND TIME FROM SYSTEM.                      05540000
044500*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          05550000
044600******************************************************************05560000
044700 9000-FORMAT-HEADINGS.                                            05570000
044800                                                                  05580000
044900     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   05590000
045000     ACCEPT PV-CURR-TIME FROM TIME.                               05600000
045100                                                                  05610000
045200     MOVE PV-CURR-DATE-MM             TO DP132O-RUN-MONTH.        05620000
045300     MOVE PV-CURR-DATE-DD             TO DP132O-RUN-DAY.          05630000
045400     MOVE PV-CURR-DATE-CCYY           TO DP132O-RUN-YEAR.         05640000
045500                                                                  05650000
045600     MOVE PV-CURR-TIME-HH             TO DP132O-RUN-HOUR.         05660000
045700     MOVE PV-CURR-TIME-MM             TO DP132O-RUN-MINUTE.       05670000
045800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.     05680000
045900     MOVE '1'                         TO DP132O-REPORT-NUMBER.    05690000
046000                                                                  05700000
046100******************************************************************05710000
046200* 9100-HEADER-ROUTINE-1                                           05720000
046300*     PRINT THE HEADINGS FOR THE SUMMARY REPORT.                  05730000
046400******************************************************************05740000
046500                                                                  05750000
046600 9100-HEADER-ROUTINE-1.                                           05760000
046700                                                                  05770000
046800     ADD +1                      TO PV-PAGE-CNT.                  05780000
046900     MOVE PV-PAGE-CNT            TO DP132O-PAGE-NUMBER.           05790000
047000     MOVE DP132O-STANDRD-HEADER-132-COLS                          05800000
047100                                 TO PV-PRINT-RECORD.              05810000
047200     PERFORM 9500-WRITE-RPT-TOP-OF-PAGE.                          05820000
047300                                                                  05830000
047400     ADD +1                      TO PV-LINE-SPACING.              05840000
047500     WRITE TX-TAX-ERROR-REPORT     FROM RH-HEADER1                05850000
047600        AFTER ADVANCING 1 LINES.                                  05860000
047700     ADD +1                      TO PV-LINE-SPACING.              05870000
047800     WRITE TX-TAX-ERROR-REPORT     FROM RH-HEADER2                05880000
047900        AFTER ADVANCING 1 LINES.                                  05890000
048000                                                                  05900000
048100     ADD +1                      TO PV-LINE-SPACING.              05910000
048200     WRITE TX-TAX-ERROR-REPORT     FROM RH-HEADER3                05920000
048300        AFTER ADVANCING 1 LINES.                                  05930000
C76279                                                                  05940000
C76279     MOVE 7                      TO PV-LINES.                     05950000
048400                                                                  05960000
048600******************************************************************05980000
048700* 9500-WRITE-RPT-TOP-OF-PAGE                                      05990000
048800*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   06000000
048900******************************************************************06010000
049000 9500-WRITE-RPT-TOP-OF-PAGE.                                      06020000
049100                                                                  06030000
049200     WRITE TX-TAX-ERROR-REPORT                                    06040000
049300       FROM PV-PRINT-RECORD                                       06050000
049400         AFTER ADVANCING PAGE                                     06060000
049500     MOVE +1 TO PV-LINE-SPACING.                                  06070000
049600                                                                  06080002
049700*                                                                 06090000
049800******************************************************************06100000
049900***                    END  OF  PROGRAM                        ***06110000
050000******************************************************************06120000
