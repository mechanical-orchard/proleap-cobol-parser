000100****************************************************************  00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300****************************************************************  00030011
000400 PROGRAM-ID.    PCKUT010.                                         00040011
000500 AUTHOR.        ROBIN CHMIEL.                                     00050011
000600 DATE-WRITTEN.  APRIL 1999.                                       00060011
000700                                                                  00070011
000800****************************************************************  00080011
000900*   THIS PROGRAM READS THE CURRENT ON HAND AND RECEIVERS          00090011
001000*   COMPLETE BUT NOT VERIFIED FILE CREATED FROM PROGRAM           00100011
001100*   PCKUT001 TO DETERMINE IF FULLCASE OR PACK TO LIGHT            00110011
001200*   PROCESSING HAVE BEEN COMPLETED FOR A LINE AND THEN BACKS      00120011
001300*   OUT THE CORRESPONDING COMPLETED UNITS FROM THE QUANTITY       00130011
001400*   FOUND ON THE INPUT FILE - PCRD002.                            00140011
001500****************************************************************  00150011
001600                                                                  00160011
001700****************************************************************  00170011
001800 ENVIRONMENT DIVISION.                                            00180011
001900****************************************************************  00190011
002000                                                                  00200011
002100****************************************************************  00210011
002200 INPUT-OUTPUT SECTION.                                            00220011
002300****************************************************************  00230011
002400                                                                  00240011
002500****************************************************************  00250011
002600 FILE-CONTROL.                                                    00260011
002700****************************************************************  00270011
002800     SELECT IP-EXTRACT-FILE                                       00280011
002900         ASSIGN TO INP01.                                         00290011
003000                                                                  00300011
003100     SELECT POR-EXTRACT-FILE                                      00310011
003200         ASSIGN TO OUT01.                                         00320011
003300                                                                  00330011
003400****************************************************************  00340011
003500 DATA DIVISION.                                                   00350011
003600****************************************************************  00360011
003700                                                                  00370011
003800****************************************************************  00380011
003900 FILE SECTION.                                                    00390011
004000****************************************************************  00400011
004100                                                                  00410011
004110*** PRB0064829 START                                              00411016
004200 FD  IP-EXTRACT-FILE                                              00420011
004300     RECORDING MODE IS F                                          00430011
004400     LABEL RECORDS ARE STANDARD                                   00440011
004500*    RECORD CONTAINS 150                                          00450016
004510     RECORD CONTAINS 200                                          00451016
004600     BLOCK CONTAINS 0 RECORDS                                     00460011
004700     DATA RECORD IS IP-EXTRACT-RECORD.                            00470011
004800*01  IP-EXTRACT-RECORD                   PIC  X(150).             00480015
004810 01  IP-EXTRACT-RECORD                   PIC  X(200).             00481015
004900                                                                  00490011
005000 FD  POR-EXTRACT-FILE                                             00500011
005100     RECORDING MODE IS F                                          00510011
005200     LABEL RECORDS ARE STANDARD                                   00520011
005300*    RECORD CONTAINS 150                                          00530016
005310     RECORD CONTAINS 200                                          00531016
005400     BLOCK CONTAINS 0 RECORDS                                     00540011
005500     DATA RECORD IS POR-EXTRACT-RECORD.                           00550011
005600*01  POR-EXTRACT-RECORD                  PIC  X(150).             00560015
005610 01  POR-EXTRACT-RECORD                  PIC  X(200).             00561015
005620*** PRB0064829 END                                                00562015
005700                                                                  00570011
005800/                                                                 00580011
005900 WORKING-STORAGE SECTION.                                         00590011
006000                                                                  00600011
006100 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00610011
006200                                                     COMP SYNC.   00620011
006210*** PRB0064829 START                                              00621017
006300 01  SAVE-RECEIVER-EXT-RECORD.                                    00630011
006400     05  SAVE-STATUS-CDE                 PIC  X(02)  VALUE SPACE. 00640011
006500     05  SAVE-PROCESS-AREA               PIC  X(06)  VALUE SPACE. 00650011
006600     05  SAVE-PO-NBR                     PIC  9(08)  VALUE ZEROS. 00660011
006700*    05  SAVE-REC-SEQ-NBR                PIC  9(03)  VALUE ZEROS. 00670015
006701     05  SAVE-REC-SEQ-NBR                PIC  9(04)  VALUE ZEROS. 00670115
006800     05  SAVE-REC-DATE                   PIC  X(10)  VALUE SPACE. 00680011
006900     05  SAVE-CART-CNT                   PIC  9(07)  VALUE ZEROS. 00690011
007000     05  SAVE-VNDR-NME                   PIC  X(25)  VALUE SPACE. 00700011
007100     05  SAVE-DEPT-NBR                   PIC  X(03)  VALUE SPACE. 00710011
007200     05  SAVE-PKSL-ITM-QTY               PIC  9(07)  VALUE ZEROS. 00720011
007300     05  SAVE-LOGICAL-OPER               PIC  9(04)  VALUE ZEROS. 00730011
007400     05  SAVE-LOGICAL-FCLTY              PIC  9(04)  VALUE ZEROS. 00740011
007500     05  SAVE-CURRENT-OPER               PIC  9(04)  VALUE ZEROS. 00750011
007600     05  SAVE-CURRENT-FCLTY              PIC  9(04)  VALUE ZEROS. 00760011
007700     05  SAVE-NEW-STR-IND                PIC  X(01)  VALUE SPACES.00770011
007800     05  SAVE-AD-PICTURE-IND             PIC  X(01)  VALUE SPACES.00780011
007900     05  SAVE-UNRESOLVED-TROUBLE         PIC  X(01)  VALUE SPACES.00790011
008000     05  SAVE-LATEST-TROUBLE             PIC  X(10)  VALUE SPACES.00800011
008100     05  SAVE-MULTI-TROUBLE              PIC  X(01)  VALUE SPACES.00810011
008200     05  SAVE-LNE-LOC-CDE                PIC  X(05)  VALUE SPACES.00820011
008300     05  SAVE-PRE-RECEIVED-IND           PIC  X(01)  VALUE SPACES.00830011
008400     05  SAVE-PACKSLIP-IND               PIC  X(01)  VALUE SPACES.00840011
008500     05  SAVE-RECORD-TYPE-IND            PIC  X(01)  VALUE SPACES.00850011
008600     05  SAVE-PO-LINE-NBR                PIC  9(04)  VALUE ZEROS. 00860011
008700     05  SAVE-PROCESS-IND                PIC  X(01)  VALUE SPACES.00870011
008800     05  SAVE-TRAILER-TOTAL-CDE          PIC  X(01)  VALUE SPACES.00880011
008900*    05  SAVE-SORT-FIELD                 PIC  X(25)  VALUE SPACES.00890017
008901     05  SAVE-SORT-FIELD                 PIC  X(26)  VALUE SPACES.00890117
009000     05  SAVE-SEASET-NM                  PIC  X(05)  VALUE SPACES.00900011
009100     05  SAVE-OPEN-TO-BUY-PERIOD         PIC  X(05)  VALUE SPACES.00910014
009110     05  SAVE-OPEN-TO-BUY-WEEK-NBR       PIC  9(01)  VALUE ZEROS. 00911014
009120     05  FILLER                          PIC  X(47)  VALUE SPACES.00912017
009130*** PRB0064829 END                                                00913015
009200                                                                  00920011
009300 01  PV-PROGRAM-VARIABLES.                                        00930011
009400     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 00940011
009500     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00950011
009600                                                                  00960011
009700 01  PC-PROGRAM-CONSTANTS.                                        00970011
009800     05  PC-DEFAULT-TMST                 PIC  X(26)  VALUE        00980011
009900         '9999-09-09-09.09.09.999999'.                            00990011
010000     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01000011
010100         'PCKUT010'.                                              01010011
010200                                                                  01020011
010300 01  PS-PROGRAM-SWITCHES.                                         01030011
010400     05  PS-EOF-IP-EXTRACT-SW            PIC  X(01)  VALUE 'N'.   01040011
010500         88  PS-EOF-IP-EXTRACT                       VALUE 'Y'.   01050011
010600         88  PS-NOT-EOF-IP-EXTRACT                   VALUE 'N'.   01060011
010700     05  PS-FIRST-RECORD-SW              PIC  X(01)  VALUE 'N'.   01070011
010800         88  PS-FIRST-RECORD                         VALUE 'Y'.   01080011
010900         88  PS-NOT-FIRST-RECORD                     VALUE 'N'.   01090011
011000     05  PS-FULLCASE-SW                  PIC  X(01)  VALUE 'N'.   01100011
011100         88  PS-FULLCASE                             VALUE 'Y'.   01110011
011200         88  PS-NOT-FULLCASE                         VALUE 'N'.   01120011
011300     05  PS-PACK-TO-LIGHT-SW             PIC  X(01)  VALUE 'N'.   01130011
011400         88  PS-PACK-TO-LIGHT                        VALUE 'Y'.   01140011
011500         88  PS-NOT-PACK-TO-LIGHT                    VALUE 'N'.   01150011
011600     05  PS-FULLCASE-P2L-SW              PIC  X(01)  VALUE 'N'.   01160011
011700         88  PS-FULLCASE-P2L                         VALUE 'Y'.   01170011
011800         88  PS-NOT-FULLCASE-P2L                     VALUE 'N'.   01180011
011900                                                                  01190011
012000*                                                                 01200011
012100     EXEC SQL                                                     01210011
012200          INCLUDE TDISTHD                                         01220011
012300     END-EXEC.                                                    01230011
012400                                                                  01240011
012500*                                                                 01250011
012600     EXEC SQL                                                     01260011
012700          INCLUDE TDISTDT                                         01270011
012800     END-EXEC.                                                    01280011
012900                                                                  01290011
013000*                                                                 01300011
013100*  COPY BOOK FOR CURRENT ON HAND AND RECEIVERS COMPLETE           01310011
013200*  BUT NOT VERIFIED RECORDS                                       01320011
013300*                                                                 01330011
013400     COPY PCRD002.                                                01340011
013500                                                                  01350011
013600*                                                                 01360011
013700*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       01370011
013800*                                                                 01380011
013900     COPY DPWS004.                                                01390011
014000                                                                  01400011
014100*                                                                 01410011
014200*                                                                 01420011
014300*  COMMUNICATION AREAS FOR DB2                                    01430011
014400*                                                                 01440011
014500     EXEC SQL                                                     01450011
014600         INCLUDE SQLCA                                            01460011
014700     END-EXEC.                                                    01470011
014800                                                                  01480011
014900******************************************************************01490011
015000 PROCEDURE DIVISION.                                              01500011
015100******************************************************************01510011
015200 0000-MAINLINE.                                                   01520011
015300                                                                  01530011
015400     PERFORM 1000-INITIALIZE.                                     01540011
015500                                                                  01550011
015600     PERFORM 2000-READ-IP-EXTRACT                                 01560011
015700       UNTIL PS-EOF-IP-EXTRACT.                                   01570011
015800                                                                  01580011
015801* DMH 1/21/03 - BEG                                               01580113
015810     WRITE POR-EXTRACT-RECORD                                     01581013
015820      FROM PC002-RECEIVER-EXT-RECORD.                             01582013
015830* DMH 1/21/03 - END                                               01583013
015840                                                                  01584013
015900     CLOSE IP-EXTRACT-FILE                                        01590011
016000           POR-EXTRACT-FILE.                                      01600011
016100                                                                  01610011
016200     GOBACK.                                                      01620011
016300******************************************************************01630011
016400*  PERFORM INITIALIZATIONS.                                       01640011
016500******************************************************************01650011
016600 1000-INITIALIZE.                                                 01660011
016700                                                                  01670011
016800     OPEN INPUT  IP-EXTRACT-FILE                                  01680011
016900          OUTPUT POR-EXTRACT-FILE.                                01690011
017000                                                                  01700011
017100     SET PS-NOT-EOF-IP-EXTRACT TO TRUE.                           01710011
017200     SET PS-FIRST-RECORD       TO TRUE.                           01720011
017300                                                                  01730011
017400     INITIALIZE SAVE-RECEIVER-EXT-RECORD.                         01740011
017500                                                                  01750011
017600******************************************************************01760011
017700*  READ THE IP EXTRACT FILE.                                      01770011
017800******************************************************************01780011
017900 2000-READ-IP-EXTRACT.                                            01790011
018000                                                                  01800011
018100     READ IP-EXTRACT-FILE                                         01810011
018200         INTO PC002-RECEIVER-EXT-RECORD                           01820011
018300             AT END SET PS-EOF-IP-EXTRACT TO TRUE.                01830011
018400                                                                  01840011
018500     IF PC002-HEADER-RECORD                                       01850011
018600         WRITE POR-EXTRACT-RECORD                                 01860011
018700              FROM PC002-RECEIVER-EXT-RECORD                      01870011
018800     ELSE                                                         01880011
018900         PERFORM 3000-PROCESS-IP-EXTRACT-REC                      01890011
019000     END-IF.                                                      01900011
019100                                                                  01910011
019200******************************************************************01920011
019300*  PROCESS THE IP EXTRACT RECORD.                                 01930011
019400******************************************************************01940011
019500 3000-PROCESS-IP-EXTRACT-REC.                                     01950011
019600                                                                  01960011
019700     IF  PC002-PO-NBR      = SAVE-PO-NBR                          01970011
019800     AND PC002-REC-SEQ-NBR = SAVE-REC-SEQ-NBR                     01980011
019900         CONTINUE                                                 01990011
020000     ELSE                                                         02000011
020100         IF PS-FIRST-RECORD                                       02010011
020200             SET PS-NOT-FIRST-RECORD TO TRUE                      02020011
020300         ELSE                                                     02030011
020400             PERFORM 6000-WRITE-POR-EXTRACT-REC                   02040011
020500         END-IF                                                   02050011
020600         MOVE PC002-RECEIVER-EXT-RECORD                           02060011
020700             TO SAVE-RECEIVER-EXT-RECORD                          02070011
020800         INITIALIZE SAVE-PKSL-ITM-QTY                             02080011
020900                    SAVE-PO-LINE-NBR                              02090011
021000         MOVE 'N'                 TO SAVE-PROCESS-IND             02100011
021100         SET PS-NOT-FULLCASE      TO TRUE                         02110011
021200         SET PS-NOT-PACK-TO-LIGHT TO TRUE                         02120011
021300         SET PS-NOT-FULLCASE-P2L  TO TRUE                         02130011
021400     END-IF.                                                      02140011
021500                                                                  02150011
021600     IF PC002-PACK-BY-STORE                                       02160011
021700         ADD PC002-PKSL-ITM-QTY TO SAVE-PKSL-ITM-QTY              02170011
021800         MOVE 'A' TO SAVE-PROCESS-IND                             02180011
021900     ELSE                                                         02190011
022000         PERFORM 7000-SELECT-TDISTHD                              02200011
022100     END-IF.                                                      02210011
022200                                                                  02220011
022300******************************************************************02230011
022400*  WRITE THE POR-EXTRACT-FILE.                                    02240011
022500******************************************************************02250011
022600 6000-WRITE-POR-EXTRACT-REC.                                      02260011
022700                                                                  02270011
022800*    IF PC002-PACK-BY-STORE                                       02280011
022900     IF SAVE-PROCESS-IND = 'A'                                    02290011
023000         MOVE 'A' TO SAVE-PROCESS-IND                             02300011
023100     ELSE                                                         02310011
023200         IF  PS-NOT-FULLCASE                                      02320011
023300         AND PS-NOT-PACK-TO-LIGHT                                 02330011
023400         AND PS-NOT-FULLCASE-P2L                                  02340011
023500             MOVE 'N' TO SAVE-PROCESS-IND                         02350011
023600         ELSE                                                     02360011
023700             IF PS-FULLCASE-P2L                                   02370011
023800             OR (PS-PACK-TO-LIGHT AND                             02380011
023900                 PS-FULLCASE)                                     02390011
024000                 MOVE 'D' TO SAVE-PROCESS-IND                     02400011
024100             ELSE                                                 02410011
024200                 IF  PS-NOT-FULLCASE                              02420011
024300                 AND PS-PACK-TO-LIGHT                             02430011
024400                     MOVE 'C' TO SAVE-PROCESS-IND                 02440011
024500                 ELSE                                             02450011
024600                     IF  PS-FULLCASE                              02460011
024700                     AND PS-NOT-PACK-TO-LIGHT                     02470011
024800                         MOVE 'B' TO SAVE-PROCESS-IND             02480011
024900                     END-IF                                       02490011
025000                 END-IF                                           02500011
025100             END-IF                                               02510011
025200         END-IF                                                   02520011
025300     END-IF.                                                      02530011
025400                                                                  02540011
025500     WRITE POR-EXTRACT-RECORD                                     02550011
025600          FROM SAVE-RECEIVER-EXT-RECORD.                          02560011
025700                                                                  02570011
025800******************************************************************02580011
025900*  SELECT THE TDISTHD TABLE.                                      02590011
026000******************************************************************02600011
026100 7000-SELECT-TDISTHD.                                             02610011
026200                                                                  02620011
026300     INITIALIZE DCLTDISTHD.                                       02630011
026400                                                                  02640011
026500     MOVE PC002-PO-NBR      TO DISTHD-ORD-NBR.                    02650011
026600     MOVE PC002-REC-SEQ-NBR TO DISTHD-RCVR-SEQ-NBR.               02660011
026700     MOVE PC002-PO-LINE-NBR TO DISTHD-ORD-LNE-NBR.                02670011
026800                                                                  02680011
026900     EXEC SQL                                                     02690011
027000         SELECT  RSLTS_RCVD_TMST,                                 02700011
027100                 FCSE_CART_CNT,                                   02710011
027200                 P2L_CART_CNT,                                    02720011
027300                 INPK_CART_CNT,                                   02730011
027400                 FCSE_CNFRMN_TMST                                 02740011
027500           INTO :DISTHD-RSLTS-RCVD-TMST,                          02750011
027600                :DISTHD-FCSE-CART-CNT,                            02760011
027700                :DISTHD-P2L-CART-CNT,                             02770011
027800                :DISTHD-INPK-CART-CNT,                            02780011
027900                :DISTHD-FCSE-CNFRMN-TMST                          02790011
028000           FROM TDISTHD                                           02800011
028100          WHERE ORD_NBR      =  :DISTHD-ORD-NBR                   02810011
028200            AND RCVR_SEQ_NBR =  :DISTHD-RCVR-SEQ-NBR              02820011
028300            AND ORD_LNE_NBR  =  :DISTHD-ORD-LNE-NBR               02830011
028400            AND TOT_CART_CNT >  0                                 02840011
028410          WITH UR                                                 02841012
028500     END-EXEC.                                                    02850011
028600                                                                  02860011
028700     EVALUATE TRUE                                                02870011
028800         WHEN SQLCODE = ZERO                                      02880011
028900             PERFORM 8000-PROCESS-TDISTHD-REC                     02890011
029000         WHEN SQLCODE = +100                                      02900011
029100             ADD PC002-PKSL-ITM-QTY TO SAVE-PKSL-ITM-QTY          02910011
029200         WHEN SQLWARN0 NOT = SPACE                                02920011
029300         WHEN SQLCODE < ZERO                                      02930011
029400         WHEN SQLCODE > ZERO                                      02940011
029500             MOVE '7000-SELECT-TDISTHD' TO PV-ABEND-PARAGRAPH     02950011
029600             MOVE 'SELECT TDISTHD' TO PV-DB2-OPERATION-ATTEMPTED  02960011
029700             PERFORM 9100-SQL-ABEND                               02970011
029800     END-EVALUATE.                                                02980011
029900                                                                  02990011
030000******************************************************************03000011
030100*  SELECT THE TDISTDT TABLE.                                      03010011
030200******************************************************************03020011
030300 7100-SELECT-TDISTDT.                                             03030011
030400                                                                  03040011
030500     INITIALIZE DCLTDISTDT.                                       03050011
030600                                                                  03060011
030700     MOVE PC002-PO-NBR      TO DISTDT-ORD-NBR.                    03070011
030800     MOVE PC002-REC-SEQ-NBR TO DISTDT-RCVR-SEQ-NBR.               03080011
030900     MOVE PC002-PO-LINE-NBR TO DISTDT-ORD-LNE-NBR.                03090011
031000                                                                  03100011
031100     EXEC SQL                                                     03110011
031200         SELECT  SUM(P2L_SPLT_UNT_QTY),                           03120011
031300                 SUM(FCSE_SPLT_UNT_QTY),                          03130011
031400                 SUM(INPK_SPLT_UNT_QTY)                           03140011
031500           INTO :DISTDT-P2L-SPLT-UNT-QTY,                         03150011
031600                :DISTDT-FCSE-SPLT-UNT-QTY,                        03160011
031700                :DISTDT-INPK-SPLT-UNT-QTY                         03170011
031800           FROM TDISTDT                                           03180011
031900          WHERE ORD_NBR      =  :DISTDT-ORD-NBR                   03190011
032000            AND RCVR_SEQ_NBR =  :DISTDT-RCVR-SEQ-NBR              03200011
032100            AND ORD_LNE_NBR  =  :DISTDT-ORD-LNE-NBR               03210011
032110          WITH UR                                                 03211012
032200     END-EXEC.                                                    03220011
032300                                                                  03230011
032400     EVALUATE TRUE                                                03240011
032500         WHEN SQLCODE = ZERO                                      03250011
032600             PERFORM 8100-PROCESS-TDISTDT-REC                     03260011
032700         WHEN SQLCODE = +100                                      03270011
032800         WHEN SQLCODE = -305                                      03280011
032900             ADD PC002-PKSL-ITM-QTY TO SAVE-PKSL-ITM-QTY          03290011
033000         WHEN SQLWARN0 NOT = SPACE                                03300011
033100         WHEN SQLCODE < ZERO                                      03310011
033200         WHEN SQLCODE > ZERO                                      03320011
033300             MOVE '7100-SELECT-TDISTDT' TO PV-ABEND-PARAGRAPH     03330011
033400             MOVE 'SELECT TDISTDT' TO PV-DB2-OPERATION-ATTEMPTED  03340011
033500             DISPLAY 'ORD NBR ' DISTDT-ORD-NBR                    03350011
033600             DISPLAY 'RCVR NBR ' DISTDT-RCVR-SEQ-NBR              03360011
033700             DISPLAY 'LNE NBR ' DISTDT-ORD-LNE-NBR                03370011
033800             PERFORM 9100-SQL-ABEND                               03380011
033900     END-EVALUATE.                                                03390011
034000                                                                  03400011
034100******************************************************************03410011
034200*  PROCESS TDISTHD RECORD.                                        03420011
034300******************************************************************03430011
034400 8000-PROCESS-TDISTHD-REC.                                        03440011
034500                                                                  03450011
034600     IF  DISTHD-RSLTS-RCVD-TMST   =  PC-DEFAULT-TMST              03460011
034700     AND DISTHD-FCSE-CNFRMN-TMST  =  PC-DEFAULT-TMST              03470011
034800         ADD PC002-PKSL-ITM-QTY   TO SAVE-PKSL-ITM-QTY            03480011
034900         ADD DISTHD-INPK-CART-CNT TO DISTHD-FCSE-CART-CNT         03490011
035000         EVALUATE TRUE                                            03500011
035100         WHEN DISTHD-FCSE-CART-CNT > 0                            03510011
035200          AND DISTHD-P2L-CART-CNT  > 0                            03520011
035300             MOVE 'D' TO PC002-PROCESS-IND                        03530011
035400             SET PS-FULLCASE-P2L TO TRUE                          03540011
035500         WHEN DISTHD-FCSE-CART-CNT = 0                            03550011
035600          AND DISTHD-P2L-CART-CNT  > 0                            03560011
035700             MOVE 'C' TO PC002-PROCESS-IND                        03570011
035800             SET PS-PACK-TO-LIGHT TO TRUE                         03580011
035900         WHEN DISTHD-FCSE-CART-CNT > 0                            03590011
036000          AND DISTHD-P2L-CART-CNT  = 0                            03600011
036100             MOVE 'B' TO PC002-PROCESS-IND                        03610011
036200             SET PS-FULLCASE TO TRUE                              03620011
036300         WHEN DISTHD-FCSE-CART-CNT = 0                            03630011
036400          AND DISTHD-P2L-CART-CNT  = 0                            03640011
036500             MOVE 'N' TO PC002-PROCESS-IND                        03650011
036600         WHEN OTHER                                               03660011
036700             CONTINUE                                             03670011
036800         END-EVALUATE                                             03680011
036900     ELSE                                                         03690011
037000         IF  DISTHD-RSLTS-RCVD-TMST   NOT =  PC-DEFAULT-TMST      03700011
037100         AND DISTHD-FCSE-CNFRMN-TMST  NOT =  PC-DEFAULT-TMST      03710011
037200             IF PC002-UNRESOLVED-TROUBLE  = 'Y'                   03720011
037300                 MOVE 'D' TO PC002-PROCESS-IND                    03730011
037400                 SET PS-FULLCASE-P2L TO TRUE                      03740011
037500             END-IF                                               03750011
037600         ELSE                                                     03760011
037700             PERFORM 7100-SELECT-TDISTDT                          03770011
037800         END-IF                                                   03780011
037900     END-IF.                                                      03790011
038000                                                                  03800011
038100                                                                  03810011
038200******************************************************************03820011
038300*  PROCESS TDISTDT RECORD.                                        03830011
038400******************************************************************03840011
038500 8100-PROCESS-TDISTDT-REC.                                        03850011
038600                                                                  03860011
038700     IF DISTHD-FCSE-CNFRMN-TMST  NOT =  PC-DEFAULT-TMST           03870011
038800         ADD DISTDT-P2L-SPLT-UNT-QTY TO SAVE-PKSL-ITM-QTY         03880011
038900         IF DISTDT-P2L-SPLT-UNT-QTY > 0                           03890011
039000             MOVE 'C' TO PC002-PROCESS-IND                        03900011
039100             SET PS-PACK-TO-LIGHT TO TRUE                         03910011
039200         ELSE                                                     03920011
039300             MOVE 'N' TO PC002-PROCESS-IND                        03930011
039400         END-IF                                                   03940011
039500     ELSE                                                         03950011
039600         ADD DISTDT-FCSE-SPLT-UNT-QTY TO SAVE-PKSL-ITM-QTY        03960011
039700         ADD DISTDT-INPK-SPLT-UNT-QTY TO SAVE-PKSL-ITM-QTY        03970011
039800         IF DISTDT-FCSE-SPLT-UNT-QTY > 0                          03980011
039900         OR DISTDT-INPK-SPLT-UNT-QTY > 0                          03990011
040000             MOVE 'B' TO PC002-PROCESS-IND                        04000011
040100             SET PS-FULLCASE TO TRUE                              04010011
040200         ELSE                                                     04020011
040300             MOVE 'N' TO PC002-PROCESS-IND                        04030011
040400         END-IF                                                   04040011
040500     END-IF.                                                      04050011
040600                                                                  04060011
040700******************************************************************04070011
040800*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04080011
040900*  ERROR OR WARNING CODE OCCURS.                                  04090011
041000******************************************************************04100011
041100 9100-SQL-ABEND.                                                  04110011
041200     DISPLAY '9100-SQL-ABEND'.                                    04120011
041300     DISPLAY '** ABEND     **'.                                   04130011
041400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04140011
041500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04150011
041600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04160011
041700                                                                  04170011
041800******************************************************************04180011
041900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04190011
042000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04200011
042100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04210011
042200* FORMAT.                                                         04220011
042300******************************************************************04230011
042400     COPY DPPD004.                                                04240011
042500                                                                  04250011
042600     MOVE +4013                  TO ABEND-CODE.                   04260011
042700     CALL 'ILBOABN0' USING ABEND-CODE.                            04270011
042800*9100-EXIT.                                                       04280011
