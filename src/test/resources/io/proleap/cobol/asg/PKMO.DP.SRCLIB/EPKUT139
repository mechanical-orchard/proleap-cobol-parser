000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      EPKUT139.                                       00020000
000300 AUTHOR.          COGNIZANT.                                      00030053
000400 DATE-WRITTEN.    JANUARY 2017.                                   00040053
000500*--------------------------------------------------------------*  00050018
000600*  INPUTS:                                                     *  00060018
000700*      FUTURE PRICE CHANGE CURSOR                              *  00070083
000800*                                                              *  00080018
000900* OUTPUTS: EPRD135 COPYBOOK                                    *  00090070
001000*                                                              *  00100018
001100*      FILE OF FUTURE PERM CHANGES IN THIS CASE                *  00110070
001200*      RELATED TO PERM EVENT OR DETAIL CHANGES.                *  00120070
001300*                                                              *  00130018
001400* DESCRIPTION:                                                 *  00140018
001500*   THE SKU WILL BE USED TO RETRIEVE THE INTERNAL UPC (AND     *  00150018
001600*   VALIDATE THAT IT EXISTS) FROM THE XS SKU TABLE.             * 00160085
001700*       OUTPUT RECORDS WILL ZERO FILL OTHER DATA ELEMENTS.     *  00170018
001800*--------------------------------------------------------------*  00180018
001900* HISTORY LOG:                                                    00190018
002000* DATE:        NOV. 05, 2004                                      00200018
002100* WR/IR#:      WR27634                                            00210018
002200* PROGRAMMER:  NANCY MARTIN                                       00220018
002300* DESCRIPTION: CHANGE TO USE "NEW PERM" PRICE CHANGE DATA.        00230018
002400*                                                                 00240018
002500* DATE:        SEPTEMBER 2, 2009                                  00250018
002600* WR/IR#: WR37103                                                 00260018
002700* PROGRAMMER:  DEANNA BRANTNER                                    00270018
002800* DESCRIPTION: MOVED THE CURSOR TO A DSNTIAUL MEMBER WHICH RUNS   00280018
002900*              IN THE FIRST STEP OF THE JOB AND CREATES AN EXTRACT00290018
003000*              WHICH IS USED BY THIS PROGRAM TO RETRIEVE UPC.     00300018
003100*                                                                 00310018
003200* DATE:        DECEMBER 10,  2009                                 00320018
003300* WR/IR#:      INC00000XXXXXXX                                    00330018
003400* PROGRAMMER:  COGNIZANT                                          00340018
003500* DESCRIPTION: ADDED THE NULL LOGIC CHECK TO SKIP RECORDS WHICH   00350018
003600*              HAVING NULL VALUE IN SKU NUMBER.                   00360018
003700*                                                                 00370012
003800* DATE:        MARCH 27,  2017                                    00380088
003900* WR/IR#:      CHG0165343                                         00390086
004000* PROGRAMMER:  COGNIZANT                                          00400086
004100* DESCRIPTION: REMOVED DB2PIAUL FROM PROC AND ADDED THE EXTRACT   00410087
004200*              PROCESS IN THE PROGRAM ITSELF. THIS WILL INCREASE  00420087
      *              THE EFFICIENCY OF EPK354 AND REDUCE CPU USAGE.     00421088
004300*--------------------------------------------------------------*  00430000
004400 ENVIRONMENT DIVISION.                                            00440000
004500 CONFIGURATION SECTION.                                           00450000
004600 SOURCE-COMPUTER.        IBM-3090.                                00460000
004700 OBJECT-COMPUTER.        IBM-3090.                                00470000
004800                                                                  00480000
004900 INPUT-OUTPUT SECTION.                                            00490000
005000 FILE-CONTROL.                                                    00500000
005100     SELECT CONTROL-CARD-INP                                      00510016
005200            ASSIGN TO INP01.                                      00520018
005300     SELECT FPLU-CHG-FILE                                         00530000
005400            ASSIGN TO OUT01.                                      00540000
005500                                                                  00550000
005600 DATA DIVISION.                                                   00560000
005700 FILE SECTION.                                                    00570000
005800 FD  CONTROL-CARD-INP                                             00580016
005900     RECORDING MODE IS F                                          00590016
006000     LABEL RECORDS ARE STANDARD                                   00600016
006100     BLOCK CONTAINS 0 CHARACTERS.                                 00610016
006200 01  CONTROL-CARD-RECORD            PIC X(80).                    00620016
006300                                                                  00630000
006400 FD  FPLU-CHG-FILE                                                00640000
006500     RECORDING MODE F                                             00650000
006600     BLOCK CONTAINS 0 RECORDS                                     00660000
006700     LABEL RECORDS ARE OMITTED                                    00670000
006800     DATA RECORD IS FPLU-CHG-RECORD.                              00680000
006900 01  FPLU-CHG-RECORD              PIC  X(60).                     00690000
007000                                                                  00700000
007100 WORKING-STORAGE SECTION.                                         00710000
007200******************************************************************00720000
007300* PS - PROGRAM SWITCHES                                           00730000
007400******************************************************************00740018
007500 01  PS-PROGRAM-SWITCHES.                                         00750000
007600     05  PS-END-OF-FUTURE-PERM-CSR-SW  PIC  X(001).               00760018
007700         88  PS-END-OF-FUTURE-PERM-CSR             VALUE 'Y'.     00770000
007800         88  PS-NOT-END-OF-FUTURE-PERM-CSR         VALUE 'N'.     00780000
007900                                                                  00790000
008000     05  PS-END-OF-CONTROL-CARD-SW     PIC  X(001).               00800018
008100         88  PS-END-OF-CONTROL-CARD                VALUE 'Y'.     00810018
008200         88  PS-NOT-END-OF-CONTROL-CARD            VALUE 'N'.     00820018
008300                                                                  00830000
008400     05  PS-END-OF-FUTURE-PRCHG-SW     PIC  X(001).               00840018
008500         88  PS-END-OF-FUTURE-PRCHG                VALUE 'Y'.     00850018
008600         88  PS-NOT-END-OF-FUTURE-PRCHG            VALUE 'N'.     00860018
008700******************************************************************00870018
008800* PROGRAM CONSTANTS                                               00880000
008900******************************************************************00890018
009000 01  PC-PROGRAM-CONSTANTS.                                        00900000
009100     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'EPKUT139'.     00910000
009200     05  PC-MAX-RETRIES           PIC S9(4) VALUE +5 COMP.        00920000
009400******************************************************************00930000
009500* PROGRAM VARIABLES                                               00940000
009600******************************************************************00950018
009700 01  PV-PROGRAM-VARAIBLES.                                        00960000
009800     05  PV-CURR-TIMESTAMP        PIC X(26)  VALUE SPACES.        00970016
009900     05  PV-INTR-UPC-ID           PIC S9(11)  VALUE +0 COMP.      00980000
010000     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       00990000
010100     05  PV-SQL-SUB               PIC S9(04)  VALUE 0  COMP.      01000000
010200     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      01010000
010305                                                                  01020016
011400******************************************************************01030016
011401* DB2 VARIABLES.                                                  01040018
011402******************************************************************01050016
011403 01  PV-DB2-VARIABLES.                                            01060053
011404     05  PV-DB2-SKU-NBR           PIC S9(8)V COMP-3 VALUE 0.      01070000
011405     05  PV-DB2-INTR-UPC-ID       PIC S9(11) COMP-3 VALUE 0.      01080000
011406                                                                  01090000
011407 01  PV-DB2-NULL-VARIABLES.                                       01100000
011408     05  PC-NULL              PIC X(1)   VALUE '?'.               01110004
011409     05  PV-DEPT-NULL         PIC S9(4)  VALUE +0 COMP SYNC.      01120018
011410     05  PV-MAJ-CL-NULL       PIC S9(4)  VALUE +0 COMP SYNC.      01130018
011420     05  PV-SUB-CL-NULL       PIC S9(4)  VALUE +0 COMP SYNC.      01140018
011430     05  PV-STYL-NULL         PIC S9(4)  VALUE +0 COMP SYNC.      01150018
011431     05  PV-SKU-NULL          PIC S9(4)  VALUE +0 COMP SYNC.      01160018
010305                                                                  01170016
012100******************************************************************01180018
012900* EPRD135 PERM RECORD LAYOUT                                      01190000
013000******************************************************************01200018
013100     COPY EPRD135.                                                01210000
013100                                                                  01220000
012100******************************************************************01230018
012900* EPCC009 CONTROL CARD LAYOUT                                     01240000
013000******************************************************************01250018
013100     COPY EPWS001.                                                01260000
013100                                                                  01270000
013200******************************************************************01280018
013400* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01290000
013500******************************************************************01300018
013600     COPY DPWS004.                                                01310000
013100                                                                  01320000
013700******************************************************************01330018
013900* DB2 ABEND COPYBOOK                                              01340000
014000******************************************************************01350018
014100     COPY DPWS900.                                                01360000
013100                                                                  01370000
014200******************************************************************01380018
014400* DB2 MESSAGE AREA                                                01390000
014500******************************************************************01400018
014600     COPY SQLCA2.                                                 01410000
013100                                                                  01420000
014700******************************************************************01430018
014900* PROGRAM COUNTERS                                                01440000
015000******************************************************************01450018
015100 01  PV-PROGRAM-COUNTERS         COMP-3.                          01460000
014000     05  PV-FUTURE-PERM-FETCHES    PIC 9(9) VALUE 0.              01470029
015200     05  PV-FUTURE-PERM-COUNT      PIC 9(9) VALUE 0.              01480000
015300     05  PV-MISSING-SKU-COUNT      PIC 9(9) VALUE 0.              01490000
015600     05  PV-CNT-OUTPUT-RECORDS     PIC 9(9) VALUE 0.              01500000
015400     05  PV-FOUND-SKU-COUNT        PIC 9(9) VALUE 0.              01510000
013100                                                                  01520000
015700******************************************************************01530018
015900* ERROR HANDLING                                                  01540000
016000******************************************************************01550018
016100 01  PV-MISC-ABEND-FIELDS.                                        01560000
016200     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          01570000
016300     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          01580000
016400     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          01590000
016500                                                                  01600000
016600 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    01610000
016700     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           01620000
016800     88  ABEND-4013-DB2-ERROR              VALUE +4013.           01630000
016900     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01640000
017000     88  ABEND-4020-MQ-ERROR               VALUE +4020.           01650000
017100     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           01660000
017200     88  ABEND-4008-PGM-LOGIC-ERROR        VALUE +4008.           01670000
017300                                                                  01680000
018700******************************************************************01690015
018701* DB2 COMMUNICATIONS AREA                                         01700018
018702******************************************************************01710015
018703     EXEC SQL                                                     01720000
018704       INCLUDE SQLCA                                              01730000
018705     END-EXEC.                                                    01740000
018706                                                                  01750000
018707******************************************************************01760015
018708* DB2 TABLE XST00010 (XST_SKU)                                    01770000
018709******************************************************************01780015
018710     EXEC SQL                                                     01790000
018711       INCLUDE XST00010                                           01800000
018712     END-EXEC.                                                    01810000
018706                                                                  01820000
018707******************************************************************01830015
018708* DB2 TABLE XST00065 (XST_PRCHG_MDSE)                             01840000
018709******************************************************************01850015
018710     EXEC SQL                                                     01860000
018711       INCLUDE XST00065                                           01870000
018712     END-EXEC.                                                    01880000
018706                                                                  01890000
018713******************************************************************01900015
018800* FUTURE PRICE CHANGE DATA CURSOR                                 01910015
019000******************************************************************01920015
019100     EXEC SQL                                                     01930015
019200     DECLARE FUTURE-PRCHG-CSR CURSOR FOR                          01940068
019300     SELECT  M.MDSE_HIER_CDE                                      01950018
019400            ,COALESCE(M.DEPT_NBR,0)                               01960018
019500            ,COALESCE(M.MAJ_CL_NBR,0)                             01970018
019600            ,COALESCE(M.SUB_CL_NBR,0)                             01980018
019700            ,COALESCE(M.STYL_ID,0)                                01990018
019800            ,COALESCE(M.SKU_NBR,0)                                02000018
019900            ,COALESCE(U.INTR_UPC_ID,0)                            02010077
020000                                                                  02020018
020100     FROM    XST_PRCHG P                                          02030018
020200            ,XST_STR_GP_PRCHG S                                   02040018
020300            ,XST_PRCHG_MDSE M                                     02050018
020400                                                                  02060018
020500     LEFT OUTER JOIN XST_SKU U                                    02070077
020600           ON   (U.SKU_NBR          = M.SKU_NBR)                  02080077
020700           WHERE S.PRCHG_ID         = P.PRCHG_ID                  02090018
020800           AND   M.PRCHG_ID         = P.PRCHG_ID                  02100018
020900           AND   M.STR_GP_TYP_CDE   = S.STR_GP_TYP_CDE            02110018
021000           AND   M.STR_GP_ID        = S.STR_GP_ID                 02120018
021100           AND   NOT P.EVNT_CTG_CDE = 'CON'                       02130018
021200           AND ((P.LAST_UPD_TMST > :CC-EPCC009-PREV-TIMESTAMP)    02140077
021400                                                                  02140263
021300            OR  (S.LAST_UPD_TMST > :CC-EPCC009-PREV-TIMESTAMP)    02150077
021400                                                                  02150263
021400            OR  (M.LAST_UPD_TMST > :CC-EPCC009-PREV-TIMESTAMP))   02160077
021400                                                                  02160263
021500           FOR FETCH ONLY                                         02170015
021600           WITH UR                                                02180015
021600         END-EXEC                                                 02190015
021800 PROCEDURE DIVISION.                                              02200000
022000 0000-MAINLINE.                                                   02210000
022100                                                                  02220000
022200     DISPLAY '*********************************************'.     02230000
022300     DISPLAY 'PROGRAM NAME: '    PC-PROGRAM-NAME            .     02240055
022400     DISPLAY '*********************************************'.     02250000
022900                                                                  02270029
022600     PERFORM 1000-INITIALIZATION.                                 02280000
022700                                                                  02290000
022800     PERFORM 3000-CREATE-FUTURE-PERM-LIST.                        02300000
022900                                                                  02310000
023000     PERFORM 9999-WRAPUP.                                         02320000
023100                                                                  02330000
023200     GOBACK.                                                      02340000
023300                                                                  02350000
023400*--------------------------------------------------------------*  02360000
023500* 1000-INITIALIZATION.                                            02370000
023600*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02380000
023700*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02390000
023800*     PARAMETERS IT MAY NEED.                                     02400000
023900*--------------------------------------------------------------*  02410000
024000 1000-INITIALIZATION.                                             02420000
024500                                                                  02430000
024501     OPEN INPUT  CONTROL-CARD-INP.                                02440018
024502     OPEN OUTPUT FPLU-CHG-FILE.                                   02450000
024503       INITIALIZE PV-DB2-NULL-VARIABLES.                          02460071
024600******************************************************************02470015
024700* 1100-OPEN-FUTURE-PRCHG-CSR.                                     02480015
024800*      OPEN THE FUTURE-PRCHG-CSR                                  02490015
024900******************************************************************02500015
025000 1100-OPEN-FUTURE-PRCHG-CSR.                                      02510015
025100                                                                  02520015
025200     EXEC SQL                                                     02530015
025300          OPEN FUTURE-PRCHG-CSR                                   02540015
025400     END-EXEC.                                                    02550015
025500                                                                  02560015
025600     EVALUATE TRUE                                                02570015
025700         WHEN SQLCODE = ZERO                                      02580015
025800             CONTINUE                                             02600015
025900         WHEN SQLWARN0 NOT EQUAL SPACE                            02630015
026000         WHEN SQLCODE  NOT EQUAL ZERO                             02640015
026100             MOVE '1100-OPEN-FUTURE-PRCHG-CSR'                    02650015
026200                                   TO PV-PARAGRAPH-NAME           02660015
026300             MOVE 'ERROR ON OPEN OF FUTURE-PRCHG-CSR'             02670015
026400                                   TO PV-DB2-OPERATION            02680015
026500             PERFORM 9900-SQL-ABEND-ROUTINE                       02710015
026600     END-EVALUATE.                                                02720015
026700******************************************************************02730015
026800* 1200-FETCH-FUTURE-PRCHG-CSR                                     02740015
027000******************************************************************02750015
027100 1200-FETCH-FUTURE-PRCHG-CSR.                                     02760018
027200                                                                  02770015
027300     EXEC SQL                                                     02780015
027400          FETCH FUTURE-PRCHG-CSR                                  02790015
027500           INTO  :XST00065-MDSE-HIER-CDE                          02800015
027500                ,:XST00065-DEPT-NBR                               02810015
027600                ,:XST00065-MAJ-CL-NBR                             02820015
027700                ,:XST00065-SUB-CL-NBR                             02830015
027800                ,:XST00065-STYL-ID                                02840015
027900                ,:XST00065-SKU-NBR                                02850015
028000                ,:PV-DB2-INTR-UPC-ID                              02860081
028100     END-EXEC.                                                    02870015
028200                                                                  02880015
028300     EVALUATE TRUE                                                02890015
028400         WHEN SQLCODE = ZERO                                      02900015
028500              ADD +1 TO PV-FUTURE-PERM-FETCHES                    02910015
028504                        PV-FUTURE-PERM-COUNT                      02920015
028504              CONTINUE                                            02930055
028600         WHEN SQLCODE = +100                                      02940015
028700              SET PS-END-OF-FUTURE-PRCHG TO TRUE                  02950015
028800              CONTINUE                                            02960055
028900         WHEN SQLWARN0 NOT EQUAL SPACE                            02970015
029000         WHEN SQLCODE  NOT EQUAL ZERO                             02980015
029100              MOVE '1200-FETCH-FUTURE-PRCHG-CSR'                  02990018
029200                                         TO PV-PARAGRAPH-NAME     03000015
029300              MOVE 'ERROR ON FETCH FUTURE-PRCHG-CSR'              03010015
029400                                         TO PV-DB2-OPERATION      03020015
029500             PERFORM 9900-SQL-ABEND-ROUTINE                       03030015
029600     END-EVALUATE.                                                03040015
024600******************************************************************03050015
024700* 1300-CLOSE-FUTURE-PRCHG-CSR.                                    03060015
024800*      CLOSE THE FUTURE-PRCHG-CSR                                 03070015
024900******************************************************************03080015
030900 1300-CLOSE-FUTURE-PRCHG-CSR.                                     03090078
025100                                                                  03100015
025200     EXEC SQL                                                     03110015
025300          CLOSE FUTURE-PRCHG-CSR                                  03120015
025400     END-EXEC.                                                    03130015
025500                                                                  03140015
025600     EVALUATE TRUE                                                03150015
025700         WHEN SQLCODE = ZERO                                      03160015
025800             CONTINUE                                             03170015
025810                                                                  03180018
025900         WHEN SQLWARN0 NOT EQUAL SPACE                            03190015
026000         WHEN SQLCODE  NOT EQUAL ZERO                             03200015
026100             MOVE '1300-CLOSE-FUTURE-PRCHG-CSR'                   03210015
026200                                   TO PV-PARAGRAPH-NAME           03220015
026300             MOVE 'ERROR ON CLOSE OF FUTURE-PRCHG-CSR'            03230015
026400                                   TO PV-DB2-OPERATION            03240015
026500             PERFORM 9900-SQL-ABEND-ROUTINE                       03250015
026600     END-EVALUATE.                                                03260015
029700******************************************************************03270000
029800*     READ CONTROL CARD EPCC009. THIS CONTROL CARD CONTAINS       03280018
029900*     THE PREVIOUS RUNS TIMESTAMP                                 03290000
030000******************************************************************03300018
033100 2000-READ-CONTROL-CARD.                                          03310078
030200                                                                  03320018
030300     READ CONTROL-CARD-INP INTO CC-EPCC009-CONTROL-CARD           03330018
030400       AT END                                                     03340018
030500          SET PS-END-OF-CONTROL-CARD TO TRUE.                     03350018
030600                                                                  03360018
030700******************************************************************03370018
030800*  THIS PROCESS EXTRACTS CHANGES THAT HAVE OCCURRED AT         *  03380004
030900*  THE FUTURE PERM EVENT OR EVENT DETAIL LEVEL. OUTPUT FPLU    *  03390004
031000*  RECORDS ARE CREATED FOR EACH OF THE EXTRACTED SKUS.         *  03400004
031100******************************************************************03410018
034200 3000-CREATE-FUTURE-PERM-LIST.                                    03420078
031302                                                                  03430000
031300     PERFORM 2000-READ-CONTROL-CARD.                              03440000
031302                                                                  03450000
031301     PERFORM 1100-OPEN-FUTURE-PRCHG-CSR.                          03460018
031302                                                                  03470000
031400     SET PS-NOT-END-OF-FUTURE-PRCHG TO TRUE.                      03480000
031401                                                                  03490018
031402     PERFORM 1200-FETCH-FUTURE-PRCHG-CSR.                         03500015
031403                                                                  03510000
031700     PERFORM UNTIL PS-END-OF-FUTURE-PRCHG                         03520000
031900         PERFORM 4000-SETUP-AND-WRITE                             03530007
032000         PERFORM 1200-FETCH-FUTURE-PRCHG-CSR                      03540018
032100     END-PERFORM.                                                 03550000
032200                                                                  03560000
032300*--------------------------------------------------------------*  03570000
032400* FORMAT AND WRITE OUTPUT                                         03580004
032500*--------------------------------------------------------------*  03590000
032600 4000-SETUP-AND-WRITE.                                            03600004
032700                                                                  03610000
032800     IF XST00065-MDSE-HIER-CDE = 'SKU' AND (PV-SKU-NULL = 0)      03621073
032900        MOVE XST00065-SKU-NBR  TO  PV-DB2-SKU-NBR                 03630018
033200     END-IF.                                                      03650004
033300                                                                  03660000
033400     PERFORM 7000-FORMAT-OUTPUT.                                  03670000
033600                                                                  03680000
033500     PERFORM 8000-WRITE-FPLU-HIER-RECORD.                         03690000
033600                                                                  03700000
038100*--------------------------------------------------------------*  04180000
038200*    INITIALIZE OUTPUT RECORD, FILL IN DATA AND WRITE RECORD   *  04190000
038300*--------------------------------------------------------------*  04200000
038400 7000-FORMAT-OUTPUT.                                              04210000
038500                                                                  04220000
038600     INITIALIZE EP135-FPLU-HIER-RECORD.                           04230000
038700                                                                  04240000
038800     MOVE XST00065-MDSE-HIER-CDE TO EP135-MDSE-HIER-CDE.          04250003
038800                                                                  04260003
038900     IF PV-DEPT-NULL < 0                                          04270004
039000        MOVE ZEROES     TO EP135-DEPT-NBR                         04280000
039100     ELSE                                                         04290000
039200        MOVE XST00065-DEPT-NBR   TO EP135-DEPT-NBR                04300003
039300     END-IF.                                                      04310000
038800                                                                  04320003
039400     IF PV-MAJ-CL-NULL < 0                                        04330004
039500        MOVE ZEROES     TO EP135-MAJ-CLASS                        04340000
039600     ELSE                                                         04350000
039700        MOVE XST00065-MAJ-CL-NBR TO EP135-MAJ-CLASS               04360003
039800     END-IF.                                                      04370000
038800                                                                  04380003
039900     IF PV-SUB-CL-NULL < 0                                        04390004
040000        MOVE ZEROES     TO EP135-SUB-CLASS                        04400000
040100     ELSE                                                         04410000
040200        MOVE XST00065-SUB-CL-NBR TO EP135-SUB-CLASS               04420003
040300     END-IF.                                                      04430000
038800                                                                  04440003
040400     IF PV-STYL-NULL < 0                                          04450004
040500        MOVE ZEROES     TO EP135-VENDOR-STYLE                     04460000
040600     ELSE                                                         04470000
040700        MOVE XST00065-STYL-ID    TO EP135-VENDOR-STYLE            04480003
040800     END-IF.                                                      04490000
038800                                                                  04500003
040900     IF PV-SKU-NULL < 0                                           04510004
041000        MOVE ZEROES     TO EP135-INTR-UPC-ID                      04520000
041100                           EP135-SKU-NBR                          04530000
041200     ELSE                                                         04540000
041300        MOVE PV-DB2-INTR-UPC-ID   TO PV-INTR-UPC-ID               04550000
041400        MOVE PV-INTR-UPC-ID       TO EP135-INTR-UPC-ID            04560000
041500        MOVE XST00065-SKU-NBR     TO EP135-SKU-NBR                04570003
041600     END-IF.                                                      04580000
041700                                                                  04590000
041800*--------------------------------------------------------------*  04600000
041900* WRITE FPLU HIER RECORD                                          04610004
042000*--------------------------------------------------------------*  04620000
042100 8000-WRITE-FPLU-HIER-RECORD.                                     04630000
042200                                                                  04640000
042300     MOVE '8000-WRITE-FPLU-HIER-RECORD' TO PV-PARAGRAPH-NAME.     04650000
042400                                                                  04660000
042500     WRITE FPLU-CHG-RECORD FROM EP135-FPLU-HIER-RECORD.           04670000
042600     ADD   1                 TO PV-CNT-OUTPUT-RECORDS.            04680000
042700                                                                  04690000
042800*--------------------------------------------------------------*  04700000
042900*     SQL ABEND ROUTINE.                                          04710000
043000*--------------------------------------------------------------*  04720000
043100 9900-SQL-ABEND-ROUTINE.                                          04730000
043200     DISPLAY '** ABEND     **'.                                   04740000
043300     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04750000
043400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04760000
043500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04770000
043600                                                                  04780000
043700     COPY DPPD004.                                                04790000
043800     SET ABEND-4013-DB2-ERROR TO TRUE.                            04800000
043900     CALL 'ILBOABN0' USING ABEND-CODE.                            04810000
044000                                                                  04820000
044100*--------------------------------------------------------------*  04830000
044200*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      04840000
044300*     ANY DATA FROM THE PROGRAM.                                  04850000
044400*--------------------------------------------------------------*  04860000
044500 9999-WRAPUP.                                                     04870000
044600     PERFORM 1300-CLOSE-FUTURE-PRCHG-CSR.                         04880015
044700     CLOSE FPLU-CHG-FILE.                                         04890000
044900                                                                  04900000
045000     DISPLAY '*************************************************'. 04910000
045100     DISPLAY ' '.                                                 04920000
044900                                                                  04930000
055600     DISPLAY 'NUMBER OF FUTURE PERM CHANGES: '                    04940029
055700              PV-FUTURE-PERM-FETCHES.                             04950029
045100     DISPLAY ' '.                                                 04960000
044900                                                                  04970000
045400     DISPLAY 'NUMBER OF MISSING SKU ENCOUNTERED: '                04980004
045500              PV-MISSING-SKU-COUNT.                               04990000
045100     DISPLAY ' '.                                                 05000000
044900                                                                  05010000
045600     COMPUTE PV-FOUND-SKU-COUNT =                                 05020000
045700             PV-FUTURE-PERM-COUNT - PV-MISSING-SKU-COUNT.         05030004
044900                                                                  05040000
045800     DISPLAY 'NUMBER OF XS SKU RECS FOUND: ' PV-FOUND-SKU-COUNT.  05050029
046000     DISPLAY ' '.                                                 05060000
046100                                                                  05070000
046100     DISPLAY 'NUMBER OF OUTPUT EP135 RECORDS WRITTEN: '           05080000
046200              PV-CNT-OUTPUT-RECORDS.                              05090003
046300     DISPLAY ' '.                                                 05100000
046100                                                                  05110000
046400     DISPLAY '*********************************************'.     05120000
046500     DISPLAY '   PROGRAM NAME: ' PC-PROGRAM-NAME, ' END'.         05130000
046600     DISPLAY '*********************************************'.     05140000
