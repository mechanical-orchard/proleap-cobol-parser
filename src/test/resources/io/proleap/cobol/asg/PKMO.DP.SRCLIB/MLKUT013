       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.              MLKUT013.                                       
       AUTHOR.                  COLLEEN CUMMINGS.                               
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            11/04/04.                                       
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *   TO-DO:  SPRING REPRICING NOT INCLUDED.                       *        
      *   MERCHANDISE LEDGER - FIND PREVIOUS PRICE FOR MARKDOWNS.      *        
      *   CONTROL DATE PASSED INTO PROGRAM = EFFECTIVE DATE OF PRICE   *        
      *   CHANGES (RUN DATE - 1 DAY).                                  *        
      *   BASED ON INPUT FILE OF SKU, STORE, NEW PRICE, ON-HAND-QTY.   *        
      *   CALCULATES THE PREVIOUS PRICE AND GATHERS PERM DATA FOR      *        
      *   FORMATTING INTO THE MLRD017 FILE LAYOUT.                     *        
      *   MLKUT014 THEN READS IN THIS FILE AND POPULATES THE           *        
      *   TOT-DOC-QTY TO COMPLETE THE MLRD017 FILE.                    *        
      *                                                                *        
      *   (SEE THE "FLOW" SECTION FOR MORE DETAILS ON HOW THIS MODULE  *        
      *    WORKS)                                                      *        
      *                                                                *        
      *CHANGE HISTORY:                                                          
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES                   
      * ------- ---------- ----------- --------------------------------         
27813 * 27813   03-14-2005 ROD JANSSEN NEW PERM PRICING ISSUES.                 
27813M* 27813M  03-24-2005 RONNA M.    IF BATCH NUMBER IS NOT FOUND             
27813M*                                THEN ERROR THE RECORD.                   
27813M*                                WHEN OLD PRICE CANNOT BE FOUND,          
27813M*                                SET THE OLD PRICE TO ZERO.               
X27813* X27813  03-28-2005 ROD JANSSEN EFFICIENCIES IN CORP PRICE LOAD.         
R27813* R27813  04-12-2005 RONNA M.    CORRECT MAP OF ML017-PC-CDE              
M27813* M27813  04-13-2005 RONNA M.    CORRECT GROUP PRICING                    
J27813* J27813  04-27-2005 ROD JANSSEN CORRECT CTA OLD PRICE LOOK UP            
W29145* W29145  09-20-2005 S. JACKSON  SAS MKDN OPTIMIZATION. UPDATE            
W29145*                                ML017 MKDN-CDE & ORIG-CLEAR-DATE         
W29145*                                INPUT FILE  LRECL 122 (FROM 109)         
S29145* S29145  11-20-2005 S. JACKSON  ADD ML017-ORIG-RTL FIELD FOR             
S29145*                                GRP PRICE  REQUIRED BY DATA WHSE         
32094 * 32094   05-25-2007 ROD JANSSEN * BUILD IN SPEED WITH THE PROCESS        
32094A*                                * STORE SPECIFIC PERM ATTRIB(S)          
32094A*                                  ARE NOT FOUND, TEST TO SEE IF          
32094A*                                  OTHER STORES WITH THE SAME UPC         
32094A*                                  HAD A PRICE CHANGE OCCUR ON THE        
32094A*                                  SAME DAY TO USE THEIR ATTRIB(S)        
I41762* INC000000041762                                                         
I41762*         08-28-2007 ROD JANSSEN CORP PRICE LOOKUP ISSUE WHEN             
I41762*                                PROCESSING A STORE SPECIFIC PRC          
I41762*                                CHANGE.                                  
X41762* INC000000041762                                                         
X41762*         09-01-2007 ROD JANSSEN CORP PRICE LOOKUP ISSUE WHEN             
X41762*                                PROCESSING A STORE SPECIFIC PRC          
X41762*                                CHANGE. FORCE LOGIC IS OKAY!!!!          
W35378*  WR35378                                                                
W35378*         06-03-2009 TAISA KONTAROVICH -  BMC TO IBM UNLOAD      *        
W35378*                    CONVERSION. THE RECORD LAYOUT OF THE INPUT  *        
W35378*                    FILE (COPYBOOK IMRD056) IS CHANGED.         *        
W35378*                    IF DATABASE FIELD HAS NULL VALUE, IBM       *        
W35378*                    UNLOAD REPLACE NULL WITH SPACES IN THE      *        
W35378*                    THE OUTPUT FIELD. ALSO NULL INDICATOR       *        
W35378*                    IS PLACED AT THE FRONT OF THE OUTPUT FIELD. *        
PK3009*  PKE3009                                                                
PK3009*         07-26-2010 SANTHOSH RAMADEV  -  QUANTITY WHICH ARE     *        
PK3009*                    GREATER THAN 4 DIGITS IS BEEN TRUNCATED.    *        
PK3009*                    IN THIS CHANGE THE LOGIC FOR QUANTITIES     *        
PK3009*                    GREATER THAN 4 DIGITS IS IMPLEMENTED.       *        
PK3009*                    THIS LOGIC IS TAKEN FROM MLKUP018.          *        
PK3009*                    FOR EACH SKU WHICH HAS QUANTITY GREATER     *        
PK3009*                    THAN 4 BYTES THE RECORD IS SPLIT INTO TWO   *        
PK3009*                    RECORDS WITH ONE RECORD HAVING QUANTITY     *        
PK3009*                    OF 9999 AND REST IN THE SECOND RECORD.      *        
P5207F*  P5207F                                                                 
P5207F*         11-08-2013 PRITHIVIRAJ S - INCORPORATED THE LOGIC FOR  *        
P5207F*                    WRITING THE MUC RECORD TO THE OUTPUT FILE.  *        
P5207F*                    ALL THE CHANGES ARE TAGGED WITH P5207F.     *        
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT PRICE-CHANGE-FILE                                             
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT TUPCPLS-UNLOAD-FILE                                           
               ASSIGN TO INP02.                                                 
                                                                                
           SELECT CC-DATE-FILE                                                  
               ASSIGN TO INP03.                                                 
                                                                                
           SELECT ML-OUTFILE                                                    
               ASSIGN TO OUT01.                                                 
                                                                                
32094      SELECT INPUT-PERM-PRCHG-ATTRIB                                       
32094          ASSIGN TO INP04.                                                 
32094                                                                           
27813      SELECT ML-ERROR-FILE-OUT                                             
27813          ASSIGN TO OUT02.                                                 
27813                                                                           
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  PRICE-CHANGE-FILE                                                    
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           RECORD CONTAINS 150 CHARACTERS                                       
           BLOCK CONTAINS 0 RECORDS.                                            
       01  PRICE-CHG-CNT-REC               PIC  X(150).                         
                                                                                
       FD  TUPCPLS-UNLOAD-FILE                                                  
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
W29145     RECORD CONTAINS 122 CHARACTERS                                       
           BLOCK CONTAINS 0 RECORDS.                                            
W29145*01  TUPCPLS-UNLD-REC                PIC  X(109).                         
W29145 01  TUPCPLS-UNLD-REC                PIC  X(122).                         
                                                                                
       FD  CC-DATE-FILE                                                         
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           RECORD CONTAINS 80 CHARACTERS                                        
           BLOCK CONTAINS 0 RECORDS.                                            
       01  CC-DATE-REC                     PIC  X(80).                          
                                                                                
32094  FD  INPUT-PERM-PRCHG-ATTRIB                                              
32094      RECORDING MODE IS F                                                  
32094      LABEL RECORDS ARE STANDARD                                           
32094      RECORD CONTAINS 080 CHARACTERS                                       
32094      BLOCK CONTAINS 0 RECORDS.                                            
32094  01  PERM-PRCHG-ATTRIB-REC           PIC  X(080).                         
32094                                                                           
       FD  ML-OUTFILE                                                           
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 200 CHARACTERS                                       
           DATA RECORD IS ML-OUT-REC.                                           
      *01  ML-OUT-REC                      PIC X(120).                          
S29145 01  ML-OUT-REC                      PIC X(200).                          
                                                                                
27813  FD  ML-ERROR-FILE-OUT                                                    
27813      RECORDING MODE IS F                                                  
27813      LABEL RECORDS ARE OMITTED                                            
S29145     RECORD CONTAINS 200 CHARACTERS                                       
27813      DATA RECORD IS ML-OUT-REC.                                           
S29145 01  ML-ERROR-FILE-RECORD            PIC X(200).                          
27813                                                                           
      /*****************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
                                                                                
27813  01  PC-PROGRAM-CONSTANTS.                                                
27813      05  PC-MAX-PRICE-ROWS    PIC S9(09) COMP-3 VALUE 99999.              
PK3009     05  PC-MAX-QTY           PIC  9(04) VALUE 9999.                      
27813                                                                           
       01  PV-PROGRAM-VARIABLES.                                                
27813      05  PV-PRC-NDX           PIC S9(09) COMP-3 VALUE ZEROS.              
32094      05  PV-PRCHG-NDX         PIC S9(09) COMP-3 VALUE ZEROS.              
32094      05  PV-DISPLAY-FIELD     PIC 9(15)         VALUE ZEROS.              
           05  PV-LOC-NBR           PIC 9(05) VALUE ZEROS.                      
           05  PV-PROGRAM-NAME             PIC X(8)    VALUE 'MLKUT013'.        
           05  PV-PARAGRAPH-NAME           PIC X(25)       VALUE SPACES.        
           05  PV-ABEND-MESSAGE            PIC X(50)       VALUE SPACES.        
           05  PV-OPER-ATTEMPTED           PIC X(30)       VALUE SPACES.        
           05  PV-UPCPLS-READ-CNT          PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
32094      05  PV-PERM-ATTRIB-CNT          PIC 9(11)       VALUE ZEROES         
32094                          COMP-3.                                          
           05  PV-PRICE-CHG-CNT-READ-CNT   PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-SKU-ATTR-LOOKUP-CNT      PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PERM-LOOKUP-CNT          PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PERM-LOOKUP-FAIL         PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
32094A     05  PV-PERM-LOOKUP-FORCE        PIC 9(11)       VALUE ZEROES         
32094A                         COMP-3.                                          
           05  PV-PPCPRC-LOOKUP-CNT        PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PPCPRC-LOOKUP-FAIL       PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-GRP-PRICE-LOOKUP-CNT     PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-GRP-PRICE-LOOKUP-FAIL    PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-RECS-WRITTEN-CNT         PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
           05  PV-OUTPUT-CNT               PIC 9(11)       VALUE ZEROES         
                               COMP-3.                                          
27813      05  PV-ERR-OUTPUT-CNT           PIC 9(11)       VALUE ZEROES         
27813                          COMP-3.                                          
           05  PV-INCR-DECR-DAYS           PIC 9(03)       VALUE ZEROES.        
           05  PV-PROCESS-EFF-DATE         PIC X(10)       VALUE SPACES.        
27813      05  PV-PREV-PROCESS-DATE        PIC X(10)       VALUE SPACES.        
27813      05  PV-TPPCPRC-TIMSTAMP         PIC X(26)       VALUE SPACES.        
PK3009     05  PV-TOT-SPLIT-RECS           PIC S9(07)      VALUE ZEROES         
PK3009                         COMP-3.                                          
PK3009     05  PV-TOT-SPLIT-ERR-RECS       PIC S9(07)      VALUE ZEROES         
PK3009                         COMP-3.                                          
PK3009     05  ML017-TEMP-PC-RECORD        PIC X(200)      VALUE SPACES.        
PK3009     05  ML017-TEMP-ERR-PC-RECORD    PIC X(200)      VALUE SPACES.        
                                                                                
       01  PV-OUTPUT-VARIABLES.                                                 
           05  PV-SKU                      PIC S9(8)V                           
                               COMP-3.                                          
           05  PV-DEPT                     PIC S9(4)V                           
                               COMP-3.                                          
RONNA      05  PV-SUBCLASS                 PIC S9(4)V                           
RONNA                          COMP-3.                                          
RONNA      05  PV-CLASS                    PIC S9(4)V                           
RONNA                          COMP-3.                                          
           05  PV-MD-LOC-NBR               PIC S9(04)                           
                               COMP.                                            
           05  PV-MD-EVENT-LOC             PIC S9(04)                           
                               COMP.                                            
           05  PV-MEITGP-NBR               PIC S9(09) COMP VALUE ZEROS.         
           05  PV-WRK-MEITGP-NBR           PIC S9(09) COMP VALUE ZEROS.         
           05  PV-TPPCPRC-LOC-NBR          PIC S9(04)                           
                               COMP.                                            
           05  PV-PRCHG-TYP-CDE            PIC X(03)       VALUE SPACES.        
           05  PV-OLD-PR-AMT               PIC  9(08)V99   VALUE ZEROES.        
S29145     05  PV-OLD-PR-AMT-NONGRP        PIC  9(08)V99   VALUE ZEROES.        
RONNA      05  PV-OLD-GP-PR-AMT            PIC  9(08)V99   VALUE ZEROES.        
           05  PV-DOC-NBR                  PIC  9(10)      VALUE ZEROES.        
           05  PV-DOC-NBR-REDEF REDEFINES PV-DOC-NBR.                           
               10  PV-DOC-NBR-FIRST-3      PIC 9(03).                           
               10  PV-DOC-NBR-7            PIC 9(07).                           
           05  PV-EFF-BEG-TMST.                                                 
               10  PV-EFF-BEG-DTE          PIC X(10)       VALUE SPACES.        
               10  FILLER                  PIC X(16)       VALUE SPACES.        
27813      05  PV-EFF-END-TMST.                                                 
27813          10  PV-EFF-END-DTE          PIC X(10)       VALUE SPACES.        
27813          10  FILLER                  PIC X(16)       VALUE SPACES.        
S29145     05  PV-FISCAL-MONTH             PIC X(02)       VALUE SPACES.        
27813                                                                           
27813  01  PT-CORP-PRICE-TABLE.                                                 
27813      05  PT-CORP-TABLE-ELEMENTS  OCCURS 99999 TIMES.                      
27813          10  PT-INTR-UPC-ID      PIC S9(09) COMP VALUE ZEROS.             
27813          10  PT-EFF-END-TMST.                                             
27813              15  PT-EFF-END-DTE  PIC X(10) VALUE SPACES.                  
X27813             15  PT-EFF-END-TIME PIC X(16) VALUE SPACES.                  
27813          10  PT-EFF-BEG-TMST.                                             
27813              15  PT-EFF-BEG-DTE  PIC X(10) VALUE SPACES.                  
X27813             15  PT-EFF-BEG-TIME PIC X(16) VALUE SPACES.                  
27813          10  PT-MEITGP-NBR       PIC S9(09) COMP VALUE ZEROS.             
27813          10  PT-UNT-RTL-AMT      PIC S9(7)V99 COMP-3 VALUE ZEROS.         
27813                                                                           
32094  01  PT-PERM-PRCHG-TABLE.                                                 
32094      05  PT-PERM-PRCHG-TBL-ELE   OCCURS 99999 TIMES.                      
32094          10 PT-PC-INTR-UPC-ID    PIC S9(09) COMP   VALUE ZEROS.           
32094          10 PT-PC-SKU-NBR        PIC S9(8)V COMP-3 VALUE ZEROS.           
32094          10 PT-PC-LOC-NBR        PIC S9(04) COMP   VALUE ZEROS.           
32094          10 PT-PC-PRCHG-EFF-DTE  PIC X(10)         VALUE SPACES.          
32094          10 PT-PC-PRCHG-ID       PIC S9(09) COMP   VALUE ZEROS.           
32094          10 PT-PC-EVNT-CTG-CDE   PIC X(3)          VALUE SPACES.          
32094          10 PT-PC-PRCHG-TYP-CDE  PIC X(3)          VALUE SPACES.          
32094                                                                           
       01  PS-SWITCHES.                                                         
           05  PS-END-OF-TPPCPRC-CSR-SW    PIC X           VALUE 'N'.           
               88  PS-END-OF-TPPCPRC-CSR                   VALUE 'Y'.           
           05  PS-PRIOR-PRICE-FOUND-SW     PIC X           VALUE 'N'.           
               88  PRIOR-PRICE-FOUND                       VALUE 'Y'.           
               88  PRIOR-PRICE-NOT-FOUND                   VALUE 'N'.           
           05  PS-PRICE-CHG-CNT-EOF-SW     PIC X           VALUE 'N'.           
               88  PS-PRICE-CHG-CNT-EOF                    VALUE 'Y'.           
           05  PS-TUPCPLS-UNLD-EOF-SW      PIC X           VALUE 'N'.           
               88  PS-TUPCPLS-UNLD-EOF                     VALUE 'Y'.           
           05  PS-END-OF-CONTROL-FILE-SW   PIC X           VALUE 'N'.           
               88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.           
               88  PS-NOT-END-OF-CONTROL-FILE              VALUE 'N'.           
27813      05  PS-CORP-PRICE-SW            PIC X           VALUE 'N'.           
27813          88  PS-CORP-PRICE-FOUND                     VALUE 'Y'.           
27813      05  PS-CORP-PRICE-LOADED-SW     PIC X           VALUE 'N'.           
27813          88  PS-INTUPCID-CORP-PRICE-LOADED           VALUE 'Y'.           
27813M     05  PS-PRICE-CHANGE-ID-SW       PIC X           VALUE 'N'.           
27813M         88  PS-PRICE-CHANGE-ID-FOUND                VALUE 'Y'.           
27813M         88  PS-PRICE-CHANGE-ID-NOT-FOUND            VALUE 'N'.           
W29145     05  PS-MKDN-INDICATOR           PIC X           VALUE 'Y'.           
W29145         88  PS-MKDN-IND-NOT-NULL                    VALUE 'N'.           
W29145         88  PS-MKDN-IND-NULL                        VALUE 'Y'.           
32094      05  PS-PERM-PRCHG-ATTRIB-EOF-SW PIC X           VALUE 'N'.           
32094          88  PS-PRCHG-ATTRIB-EOF                     VALUE 'Y'.           
32094      05  PS-PRCHG-ATTRIB-LOAD-SW     PIC X           VALUE 'N'.           
32094          88  PS-PRCHG-ATTRIBS-LOADED                 VALUE 'Y'.           
                                                                                
      ******************************************************************        
      * AC ABEND CODES                                                 *        
      ******************************************************************        
       01  ABEND-CODE                     PIC S9(04) COMP VALUE ZEROS.          
           88  ABEND-4001-WRITE-ERROR                      VALUE +4001.         
           88  ABEND-4002-READ-ERROR                       VALUE +4002.         
           88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003.         
           88  ABEND-4004-TABLE-ERROR                      VALUE +4004.         
           88  ABEND-4005-OPEN-ERROR                       VALUE +4005.         
           88  ABEND-4006-CLOSE-ERROR                      VALUE +4006.         
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007.         
           88  ABEND-4008-DATA-ERROR                       VALUE +4008.         
           88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009.         
           88  ABEND-4013-DB2-ERROR                        VALUE +4013.         
           88  ABEND-4019-DATE-ROUTINE-ERROR               VALUE +4019.         
           88  ABEND-4444-FORCED-ABEND                     VALUE +4444.         
                                                                                
      ******************************************************************        
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004              
      ******************************************************************        
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
      *    DATE ROUTINE COPY MEMBER                                             
      *****************************************************************         
           COPY DPWS500.                                                        
                                                                                
      ******************************************************************        
      *    TABLE INCLUDES                                                       
      ******************************************************************        
32094 *    XMT_LOC:                             *                               
32094 *    EXEC SQL INCLUDE XMT00001 END-EXEC.                                  
32094 *    XMT_STR_GP_MBSHP:                    *                               
32094 *    EXEC SQL INCLUDE XMT00003 END-EXEC.                                  
32094 *    XMT_PRCHG:                           *                               
32094 *    EXEC SQL INCLUDE XMT00009 END-EXEC.                                  
32094 *    XMT_STR_GP_PRCHG:                    *                               
32094 *    EXEC SQL INCLUDE XMT00010 END-EXEC.                                  
32094 *    XMT_PRCHG_MDSE:                      *                               
32094 *    EXEC SQL INCLUDE XMT00011 END-EXEC.                                  
           EXEC SQL INCLUDE TSKXREF  END-EXEC.                                  
           EXEC SQL INCLUDE TUPC     END-EXEC.                                  
32094 *    EXEC SQL INCLUDE TMDARVS  END-EXEC.                                  
           EXEC SQL INCLUDE TVNDSTL  END-EXEC.                                  
           EXEC SQL INCLUDE TPPCPRC  END-EXEC.                                  
           EXEC SQL INCLUDE TMITGPL  END-EXEC.                                  
                                                                                
      ******************************************************************        
      *    SQL COMMUNICATIONS AREA DCLGEN                                       
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *    EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING        *        
      *    SQL CODES FOR DISPLAY                                       *        
      ******************************************************************        
           COPY SQLCA2.                                                         
                                                                                
      ******************************************************************        
      * CC- CONTROL CARD                                                        
      ******************************************************************        
       01  CC-CONTROL-REC.                                                      
           05  CC-COMMENT-IND               PIC X(01)      VALUE SPACES.        
               88  CC-COMMENT-RECORD                       VALUE '*'.           
           05  CC-CONTROL-DATE.                                                 
               10  CC-DATE-CC               PIC X(02)      VALUE SPACES.        
               10  CC-DATE-YY               PIC X(02)      VALUE SPACES.        
               10  CC-DATE-DASH-1           PIC X(01)      VALUE SPACES.        
                   88  CC-VALID-DATE-DASH-1                VALUE '-'.           
               10  CC-DATE-MM               PIC X(02)      VALUE SPACES.        
                   88  CC-VALID-DATE-MM                    VALUES ARE           
                       '01' THRU '12'.                                          
               10  CC-DATE-DASH-2           PIC X(01)      VALUE SPACES.        
                   88  CC-VALID-DATE-DASH-2                VALUE '-'.           
               10  CC-DATE-DD               PIC X(02)      VALUE SPACES.        
                   88  CC-VALID-DATE-DD                    VALUES ARE           
                       '01' THRU '31'.                                          
           05  FILLER                       PIC X(69)      VALUE SPACES.        
                                                                                
      ******************************************************************        
      *  COPY MEMBER FOR THE ITEM/LOC UNLOAD FILE                               
      ******************************************************************        
           COPY IMRD056.                                                        
                                                                                
      ******************************************************************        
      *  COPY MEMBER FOR INPUT MARKDOWN FILE                                    
      ******************************************************************        
           COPY MLRD012.                                                        
                                                                                
      ******************************************************************        
      *  COPY MEMBER FOR ML MARKDOWN FILE                                       
      ******************************************************************        
           COPY MLRD017.                                                        
                                                                                
32094 ******************************************************************        
32094 *  MLRD002 - NEW PERM PRICE CHANGE ATTRIBUTES RECORD LAYOUT.              
32094 ******************************************************************        
32094      COPY MLRD002.                                                        
32094                                                                           
      *****************************************************************         
      *    TPPCPRC CURSOR                                                       
      *****************************************************************         
           EXEC SQL                                                             
                DECLARE TPPCPRC-CSR CURSOR FOR                                  
                   SELECT RTL_AMT                                               
                         ,MEITGP_NBR                                            
                         ,STATUS_CDE                                            
                   FROM TPPCPRC                                                 
                   WHERE TSK_ITM_NBR = :SKXREF-ITM-NBR                          
                     AND STR_NBR = :PV-TPPCPRC-LOC-NBR                          
X27813*************  AND END_TMST <> '9999-09-09-23.59.00.000000'               
27813                AND (:PV-TPPCPRC-TIMSTAMP >= STRT_TMST AND                 
27813                     :PV-TPPCPRC-TIMSTAMP <= END_TMST)                     
27813              ORDER BY END_TMST DESC                                       
                   FOR FETCH ONLY                                               
27813              WITH UR                                                      
           END-EXEC.                                                            
                                                                                
27813 /*****************************************************************        
27813 *FLOW:      THE MODULE READS IN THE PROCESS DATE CONTROL CARD. ONE        
27813 *         DAY IS SUBTRACTED FROM THE PROCESS DATE TO REFLECT THE          
27813 *         ACTUAL PRICE CHANGE DATE. (PREV-PROCESS-DATE) PREV              
27813 *         PROCESS DATE IS USED TO DETERMINE THE VALID PRICE AT THE        
27813 *         TIME THE PRICE CHANGE WAS CREATED. THE PREV PROCESS DATE        
27813 *         IS USED TO BUILD THE TPPCPRC PROCESS TIMESTAMP AS WELL.         
27813 *                                                                         
27813 *           READ THE PRICE CHANGE UNLOAD FILE SEQUENTIALLY. AT AN         
27813 *         INTR_UPC_ID BREAK LOAD CORP TUPCPLS UNLOAD PRICE INFO TO        
27813 *         THE WORKING STORAGE PRICE TABLE FOR THE PRICE CHANGE            
27813 *         TO BE PROCESSED. THE CORPORATE PRICE CAN BE USED WHEN           
27813 *         STORE SPECIFIC PRICE INFO CANNOT BE DETERMINED.                 
27813 *                                                                         
32094 *           READ THE PERM PRICE CHANGE ATTRIBUTE FILE. AT AN              
32094 *         INTR_UPC_ID BREAK LOAD PERM PRICE CHANGE ATTRIBUTE INFO         
32094 *         TO THE PERM PRCHG ATTRIB TABLE FOR THE PRICE CHANGE             
32094 *         TO BE PROCESSED. THE ATTRIBUTES ARE USED TO DETERMINE IF        
32094 *         A VALID PRICE CHANGE OCCURRED; AS WELL AS, TO AQUIRE            
32094 *         DOCUMENT ELEMENTS FOR LEDGER PROCESSING.                        
32094 *                                                                         
27813 *           SEQUENTIALLY READ THE TUPCPLS UNLOAD PRICE RECORDS AT         
27813 *         A INTR_UPC_ID, STORE, EFF END DATE, EFF BEG DATE LEVEL.         
27813 *         FIND MATCHES FOR THE INTR_UPC_ID/STORE BEING PROCESSED.         
27813 *                                                                         
27813 *           A STORE SPECIFIC MATCH IS NOT FOUND. CHECK THE CORP           
27813 *         PRICE TABLE AT A INTR_UPC_ID, EFF END DATE, EFF BEG DATE        
27813 *         LEVEL. MATCH USE THE CORPORATE PRICE. NO MATCH CHECK            
27813 *         PERM PRICING HISTORY FOR A VALID PRICE.                         
27813 *                                                                         
27813 *           WHEN NO MATCH AT A STORE LEVEL OR CORPORATE LEVEL IS          
27813 *         FOUND, TEST PERM TPPCPRC FOR A VALID PRICE. FIRST, THE          
27813 *         STORE SPECIFIC LEVEL IS TESTED. MATCH, USE THE PERM             
27813 *         PRICE. NO MATCH, TEST AT A CORPORATE LEVEL. MATCH USE           
27813 *         THE PERM PRICE. NO MATCH, WE CREATE AN ERROR PRICE              
27813 *         CHANGE RECORD.                                                  
27813 *                                                                         
27813 *         IN ALL PRICE SCENARIOS, THE FOLLOWING HOLDS TRUE.               
27813 *                                                                         
27813 *         PRICING RULES (THE LEVEL FOR PRICE DETERMINATION)               
27813 *           1.  STORE SPECIFIC - VALID SKU, STORE, EFF BEG/END            
27813 *               DATE RANGE.                                               
27813 *           2.  CORPORATE - VALID SKU, EFF BEG/END DATE RANGE.            
27813 *           3.  TPPCPRC - VALID SKU, LOCATION.                            
27813 *                                                                         
27813 *         CREATE A VALID PRICE CHANGE.                                    
27813 *           1.  STORE SPECIFIC -                                          
27813 *               A.  FOUND VALID SKU, STORE, EFF BEG/END DATE RANGE        
27813 *               B.  OLD/NEW PRICE DIFFER.                                 
27813 *               C.  CALC'D DIFFERENCE IS NOT ZEROS.                       
27813 *           2.  CORPRATE - VALID SKU, EFF BEG/END DATE RANGE.             
27813 *               A.  FOUND VALID SKU, EFF BEG/END DATE RANGE               
27813 *               B.  OLD/NEW PRICE DIFFER.                                 
27813 *               C.  CALC'D DIFFERENCE IS NOT ZEROS.                       
27813 *           3.  TPPCPRC - VALID SKU, LOCATION.                            
27813 *               A.  FOUND VALID SKU, STORE                                
27813 *               B.  OLD/NEW PRICE DIFFER.                                 
27813 *               C.  CALC'D DIFFERENCE IS NOT ZEROS.                       
27813 *                                                                         
27813 *         CREATE AN ERROR PRICE CHANGE.                                   
27813 *           1.  UNABLE TO DETERMINE THE SKUS PRICE AT THE OUTLINED        
27813 *               LEVELS.                                                   
27813 *               A.  STORE SPECIFIC.                                       
27813 *               B.  CORPORATE.                                            
27813 *               C.  TPPCPRC.                                              
27813 *           2.  OLD/NEW PRICE ARE THE SAME.                               
27813 *           3.  CALC'D DIFFERENCE IS ZEROS.                               
27813 *                                                                         
27813 *         TABLES USED:                                                    
27813 *           TSKXREF                                                       
27813 *           TUPC                                                          
27813 *           TVNDSTL                                                       
27813 *           TPPCPRC                                                       
27813 *           TMITGPL                                                       
27813                                                                           
27813 ******************************************************************        
       PROCEDURE DIVISION.                                                      
27813 ******************************************************************        
      ******************************************************************        
      *  MAIN PROCESSING.                                                       
      ******************************************************************        
       0000-MAIN-MODULE.                                                        
                                                                                
27813 ** INITIALIZATION....                                                     
           PERFORM 1000-HOUSEKEEPING.                                           
                                                                                
27813 ** READ THE PRICE CHANGE FILE...                                          
           PERFORM 2100-READ-PRICE-CHANGE-FILE.                                 
                                                                                
27813 ** LOAD THE CORPORATE LEVEL PRICING INFORMATION TO THE PRICE TABLE        
27813 ** FOR THE PRICE CHANGE UPC_ID TO BE PROCESSED...                         
27813      INITIALIZE PT-CORP-PRICE-TABLE.                                      
27813      MOVE 'N' TO PS-CORP-PRICE-LOADED-SW.                                 
27813      MOVE 1 TO PV-PRC-NDX.                                                
27813      PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE.                               
X27813     PERFORM 3500-LOAD-CORP-PRICE                                         
X27813        UNTIL PS-INTUPCID-CORP-PRICE-LOADED OR                            
X27813              PS-TUPCPLS-UNLD-EOF.                                        
27813                                                                           
27813 ** MAIN PROCESS LOOP FOR PERM PRICE CHANGE PRICING...                     
           IF PS-PRICE-CHG-CNT-EOF                                              
               DISPLAY '*******************************************'            
               DISPLAY '*** NO SKUS FOUND ON AUTO CNT MD RECORD ***'            
               DISPLAY '*******************************************'            
           ELSE                                                                 
               IF PS-TUPCPLS-UNLD-EOF AND                                       
27813             PV-UPCPLS-READ-CNT EQUAL ZEROS                                
                   DISPLAY '*******************************************'        
                   DISPLAY '*** NO SKUS FOUND ON PREVIOUS RECORD    ***'        
                   DISPLAY '*******************************************'        
               ELSE                                                             
32094 ** LOAD THE NEW PERM PRICE CHANGE ATTRIBUTE INFORMATION FOR THE           
32094 ** THE PRICE CHANGE UPC_ID TO BE PROCESSED...                             
32094              INITIALIZE PT-PERM-PRCHG-TABLE                               
32094              MOVE 'N'            TO PS-PRCHG-ATTRIB-LOAD-SW               
32094              MOVE 1              TO PV-PERM-ATTRIB-CNT                    
32094              MOVE 1              TO PV-PRCHG-NDX                          
32094              PERFORM 8200-READ-PRCHG-ATTRIB                               
32094              PERFORM 6000-LOAD-PRCHG-ATTRIB                               
32094                 UNTIL PS-PRCHG-ATTRIBS-LOADED OR                          
32094                       PS-PRCHG-ATTRIB-EOF                                 
32094                                                                           
                   PERFORM 2300-PROCESS-PRICE-CHANGE-SKUS                       
                       UNTIL PS-PRICE-CHG-CNT-EOF                               
               END-IF                                                           
           END-IF.                                                              
                                                                                
27813 ** END OF FILE TASKS....                                                  
           PERFORM 1900-EOJ.                                                    
PK3009     IF PV-TOT-SPLIT-RECS > ZEROES                                        
PK3009         DISPLAY ' *** THERE WERE TRANSACTIONS WITH QTY'                  
PK3009                 ' EXCEEDING ' PC-MAX-QTY                                 
PK3009         DISPLAY ' *** SPLIT TRANSACTIONS CREATED!!!'                     
PK3009     END-IF.                                                              
                                                                                
27813  9999-EXIT-PROGRAM.                                                       
           STOP RUN.                                                            
                                                                                
      /*****************************************************************        
      * 1000-HOUSEKEEPING.                                                      
      ******************************************************************        
       1000-HOUSEKEEPING.                                                       
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '* START OF MLKUT013               '.                        
           DISPLAY '**********************************'.                        
                                                                                
           OPEN INPUT  PRICE-CHANGE-FILE                                        
                       TUPCPLS-UNLOAD-FILE                                      
                       CC-DATE-FILE                                             
32094                  INPUT-PERM-PRCHG-ATTRIB                                  
                OUTPUT ML-OUTFILE                                               
27813                  ML-ERROR-FILE-OUT.                                       
                                                                                
           INITIALIZE IM056-ITEM-SKU-LOC-UNLD-REC.                              
                                                                                
           PERFORM 2200-READ-CC-DATE-FILE.                                      
           PERFORM                                                              
               UNTIL PS-END-OF-CONTROL-FILE                                     
                   OR NOT CC-COMMENT-RECORD                                     
               DISPLAY ' ' CC-CONTROL-REC                                       
               PERFORM 2200-READ-CC-DATE-FILE                                   
           END-PERFORM.                                                         
                                                                                
           IF PS-END-OF-CONTROL-FILE                                            
               DISPLAY ' '                                                      
               DISPLAY '*** NO VALID CONTROL CARD TO PROCESS ***'               
               DISPLAY ' '                                                      
               SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                           
               PERFORM 9999-ABEND                                               
           ELSE                                                                 
               DISPLAY ' ' CC-CONTROL-REC                                       
               IF CC-DATE-CC IS NUMERIC                                         
                   AND CC-DATE-YY IS NUMERIC                                    
                   AND CC-VALID-DATE-MM                                         
                   AND CC-VALID-DATE-DD                                         
                   AND CC-VALID-DATE-DASH-1                                     
                   AND CC-VALID-DATE-DASH-2                                     
                   MOVE CC-CONTROL-DATE TO PV-PROCESS-EFF-DATE                  
27813              DISPLAY ' '                                                  
                   DISPLAY 'PV-PROCESS-EFF-DATE: ' PV-PROCESS-EFF-DATE          
27813              EXEC SQL                                                     
27813                SELECT DATE(:PV-PROCESS-EFF-DATE) - 1 DAY                  
27813                INTO :PV-PREV-PROCESS-DATE                                 
27813                FROM SYSIBM.SYSDUMMY1                                      
27813              END-EXEC                                                     
27813              DISPLAY ' '                                                  
27813              DISPLAY 'PREVIOUS DATE: ' PV-PREV-PROCESS-DATE               
27813              STRING PV-PREV-PROCESS-DATE DELIMITED BY SIZE                
27813                     '-00.00.00.000000' DELIMITED BY SIZE                  
27813                                       INTO PV-TPPCPRC-TIMSTAMP            
27813              DISPLAY ' '                                                  
27813              DISPLAY 'TPPCPRC DATE: ' PV-TPPCPRC-TIMSTAMP                 
      *                                                                         
S29145*    MOVED THIS CODE FROM PARA 7000- TO EXECUTE ONLY ONCE PER RUN         
  |                MOVE PV-PROCESS-EFF-DATE TO DPG52-LK-DATE-INPUT              
  |                MOVE 0                   TO  PV-INCR-DECR-DAYS               
  |                SET DPG51-FISCAL-454-CALENDAR                                
  |                    DPG51-DO-NOT-INCR-DECR-DATE                              
  |                    DPG52-LK-DTE-ISO-FMT TO TRUE                             
  |                                                                             
  |                PERFORM Z930-CALL-DATE-CALC-MODULE                           
  |                                                                             
S29145             MOVE DPG56-FISCAL-PERIOD-NBR  TO PV-FISCAL-MONTH             
               ELSE                                                             
27813              DISPLAY ' '                                                  
                   DISPLAY '   *** INVALID CONTROL CARD ***'                    
                   SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                       
                   PERFORM 9999-ABEND                                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    CLOSE THE FILES.                                                     
      ******************************************************************        
       1900-EOJ.                                                                
                                                                                
           CLOSE PRICE-CHANGE-FILE                                              
                 TUPCPLS-UNLOAD-FILE                                            
                 CC-DATE-FILE                                                   
32094            INPUT-PERM-PRCHG-ATTRIB                                        
                 ML-OUTFILE                                                     
27813            ML-ERROR-FILE-OUT.                                             
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '* MLKUT013 PROGRAM STATISTICS:    '.                        
           DISPLAY '**********************************'.                        
           DISPLAY '* TOTAL TUPCPLS UNLOAD READ:  '                             
                   PV-UPCPLS-READ-CNT.                                          
           DISPLAY '* TOTAL PRICE-CHG-COUNT READ: '                             
                   PV-PRICE-CHG-CNT-READ-CNT.                                   
           DISPLAY '    SKU ATTRIBUTE LOOKUP:       '                           
                   PV-SKU-ATTR-LOOKUP-CNT.                                      
           DISPLAY '    PERM DOC LOOKUP:            '                           
                   PV-PERM-LOOKUP-CNT.                                          
           DISPLAY '    PERM DOC LOOKUP FAIL:       '                           
                   PV-PERM-LOOKUP-FAIL.                                         
32094A     DISPLAY '    PERM DOC LOOKUP FORCE:      '                           
32094A             PV-PERM-LOOKUP-FORCE.                                        
           DISPLAY '    PPCPRC LOOKUP:              '                           
                   PV-PPCPRC-LOOKUP-CNT.                                        
           DISPLAY '    PPCPRC LOOKUP FAIL:         '                           
                   PV-PPCPRC-LOOKUP-FAIL.                                       
           DISPLAY '    GROUP PRICE LOOKUP:         '                           
                   PV-GRP-PRICE-LOOKUP-CNT.                                     
           DISPLAY '    GROUP PRICE LOOKUP FAIL:    '                           
                   PV-GRP-PRICE-LOOKUP-FAIL.                                    
           DISPLAY '* WRITE - GOOD PRICE CHG RECS:  '                           
                   PV-RECS-WRITTEN-CNT.                                         
           DISPLAY '*       - ERROR PRICE CHG RECS: '                           
                   PV-ERR-OUTPUT-CNT.                                           
PK3009     DISPLAY '* TOTAL SPLIT RECS CREATED:     '                           
PK3009             PV-TOT-SPLIT-RECS.                                           
PK3009     DISPLAY '* TOTAL SPLIT ERROR RECS CREATED:'                          
PK3009             PV-TOT-SPLIT-ERR-RECS.                                       
           DISPLAY '**********************************'.                        
           DISPLAY '* END OF MLKUT013                 '.                        
           DISPLAY '**********************************'.                        
                                                                                
      ******************************************************************        
      * READ THE NEXT RECORD ON THE TUPCPLS-UNLOAD-FILE.                        
      ******************************************************************        
       2100-READ-PRICE-CHANGE-FILE.                                             
                                                                                
           READ PRICE-CHANGE-FILE                                               
               INTO ML012-AUTO-COUNT-RECORD                                     
               AT END                                                           
                   MOVE ZERO TO ML012-INTR-UPC-ID                               
                   SET PS-PRICE-CHG-CNT-EOF TO TRUE                             
               NOT AT END                                                       
                   ADD +1 TO PV-PRICE-CHG-CNT-READ-CNT                          
                   MOVE ML012-LOC-NBR TO PV-MD-LOC-NBR                          
                   MOVE ML012-MD-EVENT-LOC TO PV-MD-EVENT-LOC.                  
                                                                                
      ******************************************************************        
      * READ THE NEXT RECORD ON THE PREV TUPCPLS-UNLOAD-FILE.                   
      ******************************************************************        
       2150-READ-TUPCPLS-UNLOAD-FILE.                                           
                                                                                
           READ TUPCPLS-UNLOAD-FILE                                             
               INTO IM056-ITEM-SKU-LOC-UNLD-REC                                 
               AT END                                                           
                   MOVE ZEROS TO IM056-INTR-UPC-ID                              
                   SET PS-TUPCPLS-UNLD-EOF TO TRUE                              
               NOT AT END                                                       
                   ADD +1 TO PV-UPCPLS-READ-CNT.                                
                                                                                
      ******************************************************************        
      * READ THE DATE CONTROL CARD                                              
      ******************************************************************        
       2200-READ-CC-DATE-FILE.                                                  
                                                                                
           READ CC-DATE-FILE                                                    
               INTO CC-CONTROL-REC                                              
               AT END                                                           
                   SET PS-END-OF-CONTROL-FILE TO TRUE.                          
                                                                                
      ******************************************************************        
      * PROCESS RECORD FROM TUPCPLS-UNLOAD-FILE.                                
      ******************************************************************        
       2300-PROCESS-PRICE-CHANGE-SKUS.                                          
                                                                                
      **I. "PRICE CHANGE" UPC_ID MATCHES THE TUPCPLS "UNLOAD" UPC_ID..          
           IF ML012-INTR-UPC-ID = IM056-INTR-UPC-ID                             
               MOVE IM056-EFF-BEG-TMST TO PV-EFF-BEG-TMST                       
27813          MOVE IM056-EFF-END-TMST TO PV-EFF-END-TMST                       
27813          MOVE IM056-STR-NBR      TO PV-LOC-NBR                            
27813 *A.   CHECK FOR PROCESS DATE WITHIN THE TUPCPLS EFF BEG/END               
27813 *     DATE RANGE...                                                       
J27813***      IF (PV-PREV-PROCESS-DATE >= PV-EFF-BEG-TMST AND                  
J27813***          PV-EFF-END-TMST = LOW-VALUES)                                
J27813         IF (PV-PREV-PROCESS-DATE >= PV-EFF-BEG-DTE AND                   
J27813             PV-EFF-END-DTE = LOW-VALUES)                                 
X27813*B.  STORE SPECIFIC - PRICE FOUND...                                      
X27813             IF ML012-LOC-NBR = PV-LOC-NBR                                
X27813                 MOVE IM056-UNT-RTL-AMT  TO PV-OLD-PR-AMT                 
X27813                 MOVE IM056-MEITGP-NBR   TO PV-WRK-MEITGP-NBR             
X27813                 PERFORM 4100-STORE-SPECIFIC-PRICING                      
X27813             ELSE                                                         
X27813*C.  STORE SPECIFIC - CHECK FOR THE NEXT TUPCPLS STORE PRICE              
X27813             IF ML012-LOC-NBR > PV-LOC-NBR                                
X27813                 PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                    
X27813             ELSE                                                         
X27813*D.  STORE SPECIFIC - STORE PRICE NOT FOUND, CHK THE CORP PRICE.          
X27813                 PERFORM 4300-CORPORATE-PRICING                           
X27813             END-IF                                                       
X27813         ELSE                                                             
J27813***      IF (PV-PREV-PROCESS-DATE >= PV-EFF-BEG-TMST AND                  
J27813***          PV-PREV-PROCESS-DATE <= PV-EFF-END-TMST)                     
J27813         IF (PV-PREV-PROCESS-DATE >= PV-EFF-BEG-DTE AND                   
J27813             PV-PREV-PROCESS-DATE <= PV-EFF-END-DTE)                      
27813 *E.   STORE SPECIFIC - PRICE FOUND...                                     
27813              IF ML012-LOC-NBR = PV-LOC-NBR                                
27813                  MOVE IM056-UNT-RTL-AMT  TO PV-OLD-PR-AMT                 
27813                  MOVE IM056-MEITGP-NBR   TO PV-WRK-MEITGP-NBR             
27813                  PERFORM 4100-STORE-SPECIFIC-PRICING                      
27813              ELSE                                                         
27813 *F.   STORE SPECIFIC - CHECK FOR THE NEXT TUPCPLS STORE PRICE             
27813              IF ML012-LOC-NBR > PV-LOC-NBR                                
27813                  PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                    
27813              ELSE                                                         
27813 *G.   STORE SPECIFIC - STORE PRICE NOT FOUND, CHK THE CORP PRICE.         
27813                  PERFORM 4300-CORPORATE-PRICING                           
27813              END-IF                                                       
27813          ELSE                                                             
27813            PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                          
27813          END-IF                                                           
27813 *II. "PRICE CHANGE" UPC_ID GREATER THAN TUPCPLS "UNLOAD" UPC_ID..         
27813      ELSE                                                                 
27813      IF ML012-INTR-UPC-ID > IM056-INTR-UPC-ID                             
27813 *A.   THE TUPCPLS UNLOAD IS AT END OF FILE, CHECK CORP PRICE. (IF         
27813 *     AVAILABLE)                                                          
27813        IF PS-TUPCPLS-UNLD-EOF                                             
27813          MOVE ZEROS TO PV-PRC-NDX                                         
27813          MOVE 'N'   TO PS-CORP-PRICE-SW                                   
27813          PERFORM 3600-CHECK-CORP-PRICE-TBL                                
27813              VARYING PV-PRC-NDX FROM 1 BY 1                               
27813              UNTIL PV-PRC-NDX GREATER PC-MAX-PRICE-ROWS                   
27813                 OR PS-CORP-PRICE-FOUND                                    
27813          IF PS-CORP-PRICE-FOUND                                           
27813            IF ML012-NEW-UNT-RTL-AMT NOT EQUAL PV-OLD-PR-AMT               
27813              IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                
27813                PERFORM 3000-GET-SKU-ATTR                                  
27813              END-IF                                                       
27813              PERFORM 4000-CREATE-PCHG-RECORD                              
27813            ELSE                                                           
27813              IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                
27813                PERFORM 3000-GET-SKU-ATTR                                  
27813              END-IF                                                       
27813              PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                          
27813              IF PRIOR-PRICE-FOUND                                         
27813                PERFORM 4000-CREATE-PCHG-RECORD                            
27813              ELSE                                                         
27813                PERFORM 4400-WRITE-PCHG-ERROR-RECORD                       
27813              END-IF                                                       
27813            END-IF                                                         
27813          ELSE                                                             
27813            IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                  
27813              PERFORM 3000-GET-SKU-ATTR                                    
27813            END-IF                                                         
27813            PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                            
27813            IF PRIOR-PRICE-FOUND                                           
27813              PERFORM 4000-CREATE-PCHG-RECORD                              
27813            ELSE                                                           
27813              PERFORM 4400-WRITE-PCHG-ERROR-RECORD                         
27813            END-IF                                                         
27813          END-IF                                                           
27813          PERFORM 2100-READ-PRICE-CHANGE-FILE                              
27813 *B.  LOAD THE CORPORATE LEVEL PRICING INFORMATION TO THE PRICE            
27813 *    TABLE FOR THE PRICE CHANGE UPC_ID TO BE PROCESSED...                 
27813        ELSE                                                               
27813          INITIALIZE PT-CORP-PRICE-TABLE                                   
27813          MOVE 'N' TO PS-CORP-PRICE-LOADED-SW                              
27813          MOVE 1 TO PV-PRC-NDX                                             
X27813         PERFORM 3500-LOAD-CORP-PRICE                                     
X27813           UNTIL PS-INTUPCID-CORP-PRICE-LOADED OR                         
X27813                 PS-TUPCPLS-UNLD-EOF                                      
32094                                                                           
32094          PERFORM 6100-PRCHG-ATTRIB                                        
32094                                                                           
27813        END-IF                                                             
27813 *III. "PRICE CHANGE" UPC_ID LESS THAN TUPCPLS "UNLOAD" UPC_ID..           
27813      ELSE                                                                 
27813      IF ML012-INTR-UPC-ID < IM056-INTR-UPC-ID                             
27813          MOVE ZEROS TO PV-PRC-NDX                                         
27813          MOVE 'N'   TO PS-CORP-PRICE-SW                                   
27813          PERFORM 3600-CHECK-CORP-PRICE-TBL                                
27813              VARYING PV-PRC-NDX FROM 1 BY 1                               
27813              UNTIL PV-PRC-NDX GREATER PC-MAX-PRICE-ROWS                   
27813                 OR PS-CORP-PRICE-FOUND                                    
27813          IF PS-CORP-PRICE-FOUND                                           
27813            IF ML012-NEW-UNT-RTL-AMT NOT EQUAL PV-OLD-PR-AMT               
27813              IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                
27813                PERFORM 3000-GET-SKU-ATTR                                  
27813              END-IF                                                       
27813              PERFORM 4000-CREATE-PCHG-RECORD                              
27813            ELSE                                                           
27813              IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                
27813                PERFORM 3000-GET-SKU-ATTR                                  
27813              END-IF                                                       
27813              PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                          
27813              IF PRIOR-PRICE-FOUND                                         
27813                PERFORM 4000-CREATE-PCHG-RECORD                            
27813              ELSE                                                         
27813                PERFORM 4400-WRITE-PCHG-ERROR-RECORD                       
27813              END-IF                                                       
27813            END-IF                                                         
27813          ELSE                                                             
27813            IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                  
27813              PERFORM 3000-GET-SKU-ATTR                                    
27813            END-IF                                                         
27813            PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                            
27813            IF PRIOR-PRICE-FOUND                                           
27813              PERFORM 4000-CREATE-PCHG-RECORD                              
27813            ELSE                                                           
27813              PERFORM 4400-WRITE-PCHG-ERROR-RECORD                         
27813            END-IF                                                         
27813          END-IF                                                           
27813          PERFORM 2100-READ-PRICE-CHANGE-FILE                              
32094                                                                           
32094          PERFORM 6100-PRCHG-ATTRIB                                        
32094                                                                           
27813      END-IF.                                                              
27813                                                                           
27813 *** ORIGINAL LOGIC......                                                  
27813 *      IF ML012-INTR-UPC-ID  = IM056-INTR-UPC-ID                          
27813 *         MOVE IM056-EFF-BEG-TMST    TO PV-EFF-BEG-TMST                   
27813 *         IF PV-EFF-BEG-DTE < PV-PROCESS-EFF-DATE                         
27813 *             AND (ML012-LOC-NBR  = PV-LOC-NBR OR                         
27813 *                  PV-LOC-NBR     = ZEROES)                               
27813 *             IF IM056-MEITGP-NBR = 0                                     
27813 *                 MOVE IM056-UNT-RTL-AMT TO PV-OLD-PR-AMT                 
27813 *             ELSE                                                        
27813 *                 IF IM056-MEITGP-NBR NOT EQUAL PV-MEITGP-NBR             
27813 *                     MOVE IM056-MEITGP-NBR TO PV-MEITGP-NBR              
27813 *                     PERFORM 5600-SELECT-QTY-AMT                         
27813 *                 END-IF                                                  
27813 *                 MOVE PV-OLD-GP-PR-AMT TO PV-OLD-PR-AMT                  
27813 *             END-IF                                                      
27813 *             IF ML012-NEW-UNT-RTL-AMT NOT EQUAL                          
27813 *                 PV-OLD-PR-AMT                                           
27813 *                 IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID           
27813 *                     PERFORM 3000-GET-SKU-ATTR                           
27813 *                 END-IF                                                  
27813 *                 PERFORM 4000-CREATE-PCHG-RECORD                         
27813 *                 PERFORM 2100-READ-PRICE-CHANGE-FILE                     
27813 *             ELSE                                                        
27813 *                 PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                   
27813 *             END-IF                                                      
27813 *         ELSE                                                            
27813 *             PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                       
27813 *         END-IF                                                          
27813 *     ELSE                                                                
27813 *         IF ML012-INTR-UPC-ID > IM056-INTR-UPC-ID                        
27813 *             PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                       
27813 *               UNTIL IM056-INTR-UPC-ID >= ML012-INTR-UPC-ID              
27813 *         ELSE                                                            
27813 *             IF ML012-INTR-UPC-ID < IM056-INTR-UPC-ID                    
27813 *                 IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID           
27813 *                     PERFORM 3000-GET-SKU-ATTR                           
27813 *                 END-IF                                                  
27813 *                 PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                     
27813 *                 PERFORM 4000-CREATE-PCHG-RECORD                         
27813 *                 PERFORM 2100-READ-PRICE-CHANGE-FILE                     
27813 *             END-IF                                                      
27813 *         END-IF                                                          
27813 *     END-IF.                                                             
27813 *                                                                         
      ******************************************************************        
      *    GET SKU FROM TSKXREF                                                 
      ******************************************************************        
       3000-GET-SKU-ATTR.                                                       
                                                                                
           ADD +1    TO PV-SKU-ATTR-LOOKUP-CNT.                                 
           MOVE ML012-INTR-UPC-ID  TO SKXREF-INTR-UPC-ID.                       
                                                                                
           EXEC SQL                                                             
               SELECT                                                           
                      A.SKU                                                     
                     ,A.ITM_NBR                                                 
                     ,A.DEPT                                                    
                     ,CLASS                                                     
                     ,SUBCLASS                                                  
                     ,B.SUB_CL_MDSEAR_ID                                        
                     ,B.VS_ID                                                   
                     ,B.INTR_UPC_ID                                             
                     ,C.ENT_ID                                                  
                 INTO                                                           
                      :SKXREF-SKU                                               
                     ,:SKXREF-ITM-NBR                                           
                     ,:SKXREF-DEPT                                              
                     ,:SKXREF-CLASS                                             
                     ,:SKXREF-SUBCLASS                                          
                     ,:UPC-SUB-CL-MDSEAR-ID                                     
                     ,:UPC-VS-ID                                                
                     ,:UPC-INTR-UPC-ID                                          
                     ,:VNDSTL-ENT-ID                                            
                 FROM                                                           
                      TSKXREF    A                                              
                     ,TUPC       B                                              
                     ,TVNDSTL    C                                              
                WHERE                                                           
                      A.INTR_UPC_ID = :SKXREF-INTR-UPC-ID                       
                  AND A.SKU_STAT_CDE NOT IN ('98', '00')                        
                  AND A.INTR_UPC_ID     = B.INTR_UPC_ID                         
                  AND B.INTR_UPC_ID     = B.UPC_ID                              
                  AND B.VS_ID           = C.VS_ID                               
                  AND :PV-PROCESS-EFF-DATE BETWEEN B.EFF_BEG_DTE                
                          AND COALESCE(B.EFF_END_DTE, '9999-12-31')             
                WITH UR                                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                  MOVE SKXREF-SKU       TO PV-SKU                               
                  MOVE SKXREF-DEPT      TO PV-DEPT                              
RONNA             MOVE SKXREF-SUBCLASS  TO PV-SUBCLASS                          
RONNA             MOVE SKXREF-CLASS     TO PV-CLASS                             
               WHEN SQLCODE = +100                                              
                   MOVE 0               TO PV-SKU                               
                                           PV-DEPT                              
                                           PV-SUBCLASS                          
                                           PV-CLASS                             
32094              MOVE ML012-INTR-UPC-ID  TO PV-DISPLAY-FIELD                  
                   DISPLAY 'SKU/VENDOR CANNOT BE FOUND FOR:'                    
32094                      ' ML012-INTR-UPC-ID = '  PV-DISPLAY-FIELD            
                           ' SKXREF-INTR-UPC-ID = ' SKXREF-INTR-UPC-ID          
               WHEN OTHER                                                       
32094              MOVE ML012-INTR-UPC-ID  TO PV-DISPLAY-FIELD                  
32094              DISPLAY 'ML012-INTR-UPC-ID = ' PV-DISPLAY-FIELD              
                           ' SKXREF-INTR-UPC-ID = ' SKXREF-INTR-UPC-ID          
                           ' SQLCODE: ' SQLCODE                                 
                   MOVE '3000-GET-SKU-ATTR'   TO PV-PARAGRAPH-NAME              
                   MOVE 'ERROR ON SELECT '    TO PV-OPER-ATTEMPTED              
                   PERFORM 9990-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    GET PREV PRICE FROM TPPCPRC.                                         
      ******************************************************************        
       3100-PREV-PRICE-LOOKUP-CNTL.                                             
                                                                                
      *** STORE SPECIFIC - PERM PRICE TABLE PRICE LOOKUP....                    
27813      MOVE 'N' TO PS-PRIOR-PRICE-FOUND-SW.                                 
27813      MOVE 'N' TO PS-END-OF-TPPCPRC-CSR-SW.                                
           MOVE PV-MD-LOC-NBR TO PV-TPPCPRC-LOC-NBR.                            
27813                                                                           
           PERFORM 3200-OPEN-TPPCPRC-CSR.                                       
           PERFORM 3300-FETCH-TPPCPRC-CSR                                       
             UNTIL PRIOR-PRICE-FOUND                                            
                OR PS-END-OF-TPPCPRC-CSR.                                       
           PERFORM 3400-CLOSE-TPPCPRC-CSR.                                      
                                                                                
      *** CORPORATE - PERM PRICE TABLE PRICE LOOKUP....                         
           IF PRIOR-PRICE-NOT-FOUND                                             
27813          MOVE 'N' TO PS-PRIOR-PRICE-FOUND-SW                              
27813          MOVE 'N' TO PS-END-OF-TPPCPRC-CSR-SW                             
               MOVE ZEROES TO PV-TPPCPRC-LOC-NBR                                
               PERFORM 3200-OPEN-TPPCPRC-CSR                                    
               PERFORM 3300-FETCH-TPPCPRC-CSR                                   
                 UNTIL PRIOR-PRICE-FOUND                                        
                    OR PS-END-OF-TPPCPRC-CSR                                    
               PERFORM 3400-CLOSE-TPPCPRC-CSR                                   
           END-IF.                                                              
                                                                                
27813 *** PRICE NOT FOUND....                                                   
27813      IF PRIOR-PRICE-NOT-FOUND                                             
27813          ADD +1          TO PV-PPCPRC-LOOKUP-FAIL                         
27813      END-IF.                                                              
27813                                                                           
      ******************************************************************        
      * 3200-OPEN-TPPCPRC-CSR.                                         *        
      ******************************************************************        
       3200-OPEN-TPPCPRC-CSR.                                                   
                                                                                
           EXEC SQL                                                             
                OPEN TPPCPRC-CSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +0                                                
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE '3200-OPEN-TPPCPRC-CSR         '                        
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON TPPCPRC-SR    '                          
                                     TO PV-OPER-ATTEMPTED                       
                   PERFORM 9990-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * 3300-FETCH-TPPCPRC-CSR.                                                 
      ******************************************************************        
       3300-FETCH-TPPCPRC-CSR.                                                  
                                                                                
           ADD +1     TO PV-PPCPRC-LOOKUP-CNT.                                  
                                                                                
           EXEC SQL                                                             
               FETCH TPPCPRC-CSR                                                
               INTO :PPCPRC-RTL-AMT                                             
                   ,:PPCPRC-MEITGP-NBR                                          
                   ,:PPCPRC-STATUS-CDE                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +0                                                
27813              MOVE PPCPRC-RTL-AMT    TO PV-OLD-PR-AMT                      
27813              MOVE PPCPRC-MEITGP-NBR TO PV-WRK-MEITGP-NBR                  
27813              PERFORM 4200-GROUP-PRICING-LOGIC                             
27813 *            IF PPCPRC-MEITGP-NBR = 0                                     
27813 *                MOVE PPCPRC-RTL-AMT TO PV-OLD-PR-AMT                     
27813 *            ELSE                                                         
27813 *                IF PPCPRC-MEITGP-NBR NOT EQUAL PV-MEITGP-NBR             
27813 *                    MOVE PPCPRC-MEITGP-NBR TO PV-MEITGP-NBR              
27813 *                    PERFORM 5600-SELECT-QTY-AMT                          
27813 *                END-IF                                                   
27813 *                MOVE PV-OLD-GP-PR-AMT TO PV-OLD-PR-AMT                   
27813 *            END-IF                                                       
M27813*            IF ML012-NEW-UNT-RTL-AMT NOT = PV-OLD-PR-AMT                 
M27813***************                                                           
M27813*            IN GROUP PRICING THERE MAY HAVE BEEN A PRICE                 
M27813*            CHANGE AT THE NON GROUP PRICE AND THE GROUP                  
M27813*            PRICE STAYS THE SAME.  THIS IS A LIGITIMATE                  
M27813*            PRICE CHANGE FROM PERM, HOWEVER THERE IS NO                  
M27813*            REAL PRICE CHANGE TO TAKE PLACE BECAUSE THE                  
M27813*            ML PRICES ARE RECOGNIZED AT THE GROUP PRICE                  
M27813*            LEVEL                                                        
M27813*            SO THE OLD PRICE IS FOUND                                    
M27813***************                                                           
                       SET PRIOR-PRICE-FOUND TO TRUE                            
M27813*            END-IF                                                       
               WHEN SQLCODE = +100                                              
27813 *            ADD +1     TO PV-PPCPRC-LOOKUP-FAIL                          
27813M             MOVE 0     TO PV-OLD-PR-AMT                                  
                   SET PS-END-OF-TPPCPRC-CSR TO TRUE                            
               WHEN OTHER                                                       
27813M              MOVE 0     TO PV-OLD-PR-AMT                                 
                    MOVE '3300-FETCH-TPPCPRC-CSR         '                      
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON TPPCPRC-CSR   '                         
                                      TO PV-OPER-ATTEMPTED                      
                    PERFORM 9990-SQL-ABEND                                      
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * 3400-CLOSE-TPPCPRC-CSR.                                                 
      ******************************************************************        
       3400-CLOSE-TPPCPRC-CSR.                                                  
                                                                                
           EXEC SQL                                                             
               CLOSE TPPCPRC-CSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +0                                                
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE '3400-CLOSE-TPPCPRC-CSR       '                         
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'CLOSE ERROR ON TPPCPRC CSR  '                          
                                     TO PV-OPER-ATTEMPTED                       
                   PERFORM 9990-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
27813 ******************************************************************        
27813 * 3500-LOAD-CORP-PRICE.                                                   
27813 *    LOAD THE TUPCPLS UNLOAD CORPORATE PRICE, STORE 00000, TO THE         
27813 * WORKING STORAGE TABLE. THE INFORMATION IS USED TO DETERMINE             
27813 * THE PRICE WHEN STORE SPECIFIC PRICING DOES NOT EXIST.                   
27813 *                                                                         
27813 *    THE CORPORATE PRICE IS LOADED FOR THE PRICE CHANGE                   
27813 * INTR_UPC_ID BEING PROCESSED ONLY.                                       
27813 ******************************************************************        
27813  3500-LOAD-CORP-PRICE.                                                    
27813                                                                           
27813      IF PV-PRC-NDX IS GREATER THAN PC-MAX-PRICE-ROWS                      
27813          DISPLAY '** ABEND ******************'                            
27813          DISPLAY '*  3500-LOAD-CORP-PRICE'                                
27813          DISPLAY '*  STORE 000 ROWS EXCEEDED ', PC-MAX-PRICE-ROWS         
27813          DISPLAY '***************************'                            
27813          PERFORM 9999-ABEND                                               
27813      END-IF.                                                              
27813                                                                           
27813      IF IM056-INTR-UPC-ID = ML012-INTR-UPC-ID                             
27813        IF IM056-STR-NBR = ZEROS                                           
27813          IF PT-INTR-UPC-ID (PV-PRC-NDX) EQUAL ZEROS   AND                 
27813             PT-EFF-BEG-TMST (PV-PRC-NDX) EQUAL SPACES AND                 
27813             PT-EFF-END-TMST (PV-PRC-NDX) EQUAL SPACES AND                 
27813             PT-MEITGP-NBR (PV-PRC-NDX) EQUAL ZEROS    AND                 
27813             PT-UNT-RTL-AMT (PV-PRC-NDX) EQUAL ZEROS                       
27813            MOVE IM056-INTR-UPC-ID  TO PT-INTR-UPC-ID (PV-PRC-NDX)         
27813            MOVE IM056-EFF-BEG-TMST TO PT-EFF-BEG-TMST (PV-PRC-NDX)        
27813            MOVE IM056-EFF-END-TMST TO PT-EFF-END-TMST (PV-PRC-NDX)        
27813            MOVE IM056-MEITGP-NBR   TO PT-MEITGP-NBR (PV-PRC-NDX)          
27813            MOVE IM056-UNT-RTL-AMT  TO PT-UNT-RTL-AMT (PV-PRC-NDX)         
X27813           PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                          
27813          ELSE                                                             
27813            ADD 1                   TO PV-PRC-NDX                          
27813            GO TO 3500-LOAD-CORP-PRICE                                     
27813          END-IF                                                           
27813        ELSE                                                               
27813          MOVE 'Y'                  TO PS-CORP-PRICE-LOADED-SW             
27813        END-IF                                                             
27813      ELSE                                                                 
27813      IF IM056-INTR-UPC-ID > ML012-INTR-UPC-ID                             
27813          MOVE 'Y'                  TO PS-CORP-PRICE-LOADED-SW             
X27813     ELSE                                                                 
X27813         PERFORM 2150-READ-TUPCPLS-UNLOAD-FILE                            
27813      END-IF.                                                              
27813                                                                           
27813 ******************************************************************        
27813 * 3600-CHECK-CORP-PRICE-TBL.                                              
27813 *    USING THE PRICE CHANGE INTR_UPC_ID, FIND THE CORPORATE PRICE         
27813 * INFORMATION FOR THE PROCESSING DATE PERIOD.                             
27813 *                                                                         
27813 *    CORPORATE PRICE INFORMATION IS LOADED FOR THE PRICE CHANGE           
27813 * INTR_UPC_ID BEING PROCESSED AND BEGINS AT ROW ONE. THE FIRST            
27813 * OCCURRECE OF AN EMPTY ROW TELLS THE COBOL TO EXIT THE LOOP.             
27813 ******************************************************************        
27813  3600-CHECK-CORP-PRICE-TBL.                                               
27813                                                                           
27813      IF PT-INTR-UPC-ID (PV-PRC-NDX) EQUAL ZEROS   AND                     
27813         PT-EFF-BEG-TMST (PV-PRC-NDX) EQUAL SPACES AND                     
27813         PT-EFF-END-TMST (PV-PRC-NDX) EQUAL SPACES AND                     
27813         PT-MEITGP-NBR (PV-PRC-NDX) EQUAL ZEROS    AND                     
27813         PT-UNT-RTL-AMT (PV-PRC-NDX) EQUAL ZEROS                           
27813          MOVE 9999999         TO PV-PRC-NDX                               
27813      ELSE                                                                 
27813      IF (PT-INTR-UPC-ID (PV-PRC-NDX) = ML012-INTR-UPC-ID)    AND          
27813         (PV-PREV-PROCESS-DATE >= PT-EFF-BEG-DTE (PV-PRC-NDX)AND           
27813          PV-PREV-PROCESS-DATE <= PT-EFF-END-DTE (PV-PRC-NDX))             
27813          MOVE PT-UNT-RTL-AMT (PV-PRC-NDX) TO PV-OLD-PR-AMT                
27813          MOVE PT-MEITGP-NBR (PV-PRC-NDX)  TO PV-WRK-MEITGP-NBR            
27813          PERFORM 4200-GROUP-PRICING-LOGIC                                 
27813          MOVE 'Y'                         TO PS-CORP-PRICE-SW             
27813      END-IF.                                                              
27813                                                                           
      ******************************************************************        
      *    CONTROLS CALLS TO CREATE A MARKDOWN RECORD.                          
      ******************************************************************        
       4000-CREATE-PCHG-RECORD.                                                 
                                                                                
           PERFORM 5000-SELECT-PERM-SKU-LVL.                                    
                                                                                
           PERFORM 7000-MOVE-OUTPUT-FIELDS.                                     
                                                                                
27813M*    IF THERE IS NO PRICE DIFFERENCE OR PRICE CHANGE                      
27813M*    ID IS NOT FOUND FROM A PERM TRANSACTION (FROM MLKUT012)              
27813M*    THEN WRITE RECORD OUT TO THE ERROR FILE.                             
RONNA      IF ML017-PC-DIFFER-AMT EQUAL ZEROS                                   
27813M        OR  (ML012-RF-CONTROL-NBR = ZEROES AND                            
27813M             PS-PRICE-CHANGE-ID-NOT-FOUND)                                
27813          PERFORM 8100-WRITE-ERROR-OUTPUT                                  
RONNA      ELSE                                                                 
               PERFORM 8000-WRITE-OUTPUT-REC                                    
RONNA      END-IF.                                                              
                                                                                
27813 ******************************************************************        
27813 * 4100-STORE-SPECIFIC-PRICING.                                            
27813 ******************************************************************        
27813  4100-STORE-SPECIFIC-PRICING.                                             
27813                                                                           
27813 *** GROUP PRICING. (IF APPLICABLE)                                        
27813      PERFORM 4200-GROUP-PRICING-LOGIC.                                    
27813                                                                           
27813 *** CORP PRICING. (DETERMINE IF WE NEED TO USE THE CORP PRICE)            
I41762*    IF ML012-NEW-UNT-RTL-AMT EQUAL PV-OLD-PR-AMT                         
I41762*      MOVE ZEROS TO PV-PRC-NDX                                           
I41762*      MOVE 'N'   TO PS-CORP-PRICE-SW                                     
I41762*      PERFORM 3600-CHECK-CORP-PRICE-TBL                                  
I41762*        VARYING PV-PRC-NDX FROM 1 BY 1                                   
I41762*        UNTIL PV-PRC-NDX GREATER PC-MAX-PRICE-ROWS                       
I41762*           OR PS-CORP-PRICE-FOUND                                        
I41762*    END-IF.                                                              
I41762*                                                                         
27813 *** CREATE A MARKDOWN WHEN OLD & NEW PRICE ARE DIFFERENT..                
27813      IF ML012-NEW-UNT-RTL-AMT NOT EQUAL PV-OLD-PR-AMT                     
27813        IF ML012-INTR-UPC-ID NOT EQUAL SKXREF-INTR-UPC-ID                  
27813          PERFORM 3000-GET-SKU-ATTR                                        
27813        END-IF                                                             
27813        PERFORM 4000-CREATE-PCHG-RECORD                                    
27813      ELSE                                                                 
27813        IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                      
27813          PERFORM 3000-GET-SKU-ATTR                                        
27813        END-IF                                                             
I41762*      PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                                
I41762*      IF PRIOR-PRICE-FOUND                                               
I41762*        PERFORM 4000-CREATE-PCHG-RECORD                                  
I41762*      ELSE                                                               
27813          PERFORM 4400-WRITE-PCHG-ERROR-RECORD                             
I41762*      END-IF                                                             
27813      END-IF.                                                              
27813                                                                           
27813      PERFORM 2100-READ-PRICE-CHANGE-FILE.                                 
27813                                                                           
27813 ******************************************************************        
27813 * 4200-GROUP-PRICING-LOGIC.                                               
27813 ******************************************************************        
27813  4200-GROUP-PRICING-LOGIC.                                                
27813                                                                           
27813 *** GROUP PRICING. (DETERMINE IF WE NEED TO USE THE CORP PRICE)           
27813 *    A.  NO GROUP PRICING, USE THE UPCPLS UNLOAD RETAIL AMOUNT.           
27813      IF PV-WRK-MEITGP-NBR EQUAL ZEROS                                     
27813 *        NEXT SENTENCE                                                    
S29145         MOVE PV-OLD-PR-AMT         TO PV-OLD-PR-AMT-NONGRP               
27813      ELSE                                                                 
27813 *    B.  GROUP PRICING LOGIC...                                           
27813          IF PV-WRK-MEITGP-NBR NOT EQUAL PV-MEITGP-NBR                     
27813              MOVE PV-WRK-MEITGP-NBR TO PV-MEITGP-NBR                      
27813              PERFORM 5600-SELECT-QTY-AMT                                  
27813          END-IF                                                           
S29145         MOVE PV-OLD-PR-AMT         TO PV-OLD-PR-AMT-NONGRP               
27813          MOVE PV-OLD-GP-PR-AMT      TO PV-OLD-PR-AMT                      
27813      END-IF.                                                              
27813                                                                           
27813 ******************************************************************        
27813 * 4300-CORPORATE-PRICING.                                                 
27813 ******************************************************************        
27813  4300-CORPORATE-PRICING.                                                  
27813                                                                           
27813 *** CORP PRICING.                                                         
27813      MOVE ZEROS TO PV-PRC-NDX.                                            
27813      MOVE 'N'   TO PS-CORP-PRICE-SW.                                      
27813      PERFORM 3600-CHECK-CORP-PRICE-TBL                                    
27813          VARYING PV-PRC-NDX FROM 1 BY 1                                   
27813          UNTIL PV-PRC-NDX GREATER PC-MAX-PRICE-ROWS                       
27813             OR PS-CORP-PRICE-FOUND.                                       
27813                                                                           
27813 *** CREATE A MARKDOWN WHEN OLD & NEW PRICE ARE DIFFERENT..                
27813      IF PS-CORP-PRICE-FOUND                                               
27813        IF ML012-NEW-UNT-RTL-AMT NOT EQUAL PV-OLD-PR-AMT                   
27813          IF ML012-INTR-UPC-ID NOT EQUAL SKXREF-INTR-UPC-ID                
27813              PERFORM 3000-GET-SKU-ATTR                                    
27813          END-IF                                                           
27813          PERFORM 4000-CREATE-PCHG-RECORD                                  
27813        ELSE                                                               
27813          IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                    
27813            PERFORM 3000-GET-SKU-ATTR                                      
27813          END-IF                                                           
27813          PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                              
27813          IF PRIOR-PRICE-FOUND                                             
27813            PERFORM 4000-CREATE-PCHG-RECORD                                
27813          ELSE                                                             
27813            PERFORM 4400-WRITE-PCHG-ERROR-RECORD                           
27813        END-IF                                                             
27813      ELSE                                                                 
27813        IF ML012-INTR-UPC-ID NOT = SKXREF-INTR-UPC-ID                      
27813          PERFORM 3000-GET-SKU-ATTR                                        
27813        END-IF                                                             
27813        PERFORM 3100-PREV-PRICE-LOOKUP-CNTL                                
27813        IF PRIOR-PRICE-FOUND                                               
27813          PERFORM 4000-CREATE-PCHG-RECORD                                  
27813        ELSE                                                               
27813          PERFORM 4400-WRITE-PCHG-ERROR-RECORD                             
27813        END-IF                                                             
27813      END-IF.                                                              
27813                                                                           
27813      PERFORM 2100-READ-PRICE-CHANGE-FILE.                                 
27813                                                                           
27813 ******************************************************************        
27813 * 4400-WRITE-PCHG-ERROR-RECORD.                                           
27813 ******************************************************************        
27813  4400-WRITE-PCHG-ERROR-RECORD.                                            
27813                                                                           
27813      PERFORM 5000-SELECT-PERM-SKU-LVL.                                    
27813                                                                           
27813      PERFORM 7000-MOVE-OUTPUT-FIELDS.                                     
27813                                                                           
27813      PERFORM 8100-WRITE-ERROR-OUTPUT.                                     
27813                                                                           
      ******************************************************************        
      *    GET SKU LEVEL PERM PRICING FROM PERM DOMAIN.                         
      ******************************************************************        
       5000-SELECT-PERM-SKU-LVL.                                                
                                                                                
27813      MOVE 'N'            TO PS-PRICE-CHANGE-ID-SW.                        
           ADD +1              TO PV-PERM-LOOKUP-CNT.                           
32094      MOVE ZEROS          TO PV-PRCHG-NDX.                                 
32094                                                                           
32094      PERFORM 6200-GET-PRCHG-ATTRIBS                                       
32094          VARYING PV-PRCHG-NDX FROM 1 BY 1                                 
32094          UNTIL PV-PRCHG-NDX GREATER PC-MAX-PRICE-ROWS                     
32094             OR PV-PRCHG-NDX GREATER PV-PERM-ATTRIB-CNT                    
32094             OR PS-PRICE-CHANGE-ID-FOUND.                                  
32094                                                                           
32094      IF PS-PRICE-CHANGE-ID-NOT-FOUND                                      
32094A* IF THE SKU/STORE COMBO NOT FOUND, TEST TO SEE IF WE HAVE BUILT          
32094A* A PRICE CHANGE FOR OTHER STORES FOR THE PROCESSED SKU. FORCE THE        
32094A* NEW PERM ATTRIBUTES TO REFLECT OTHER SKU/STORE COMBINATIONS...          
X41762       IF PT-PC-INTR-UPC-ID (1) = ML012-INTR-UPC-ID AND                   
X41762          PT-PC-SKU-NBR (1) = SKXREF-SKU            AND                   
X41762          PT-PC-PRCHG-EFF-DTE (1) = PV-PROCESS-EFF-DATE                   
X41762         MOVE PT-PC-PRCHG-ID (1)      TO PV-DOC-NBR                       
X41762         MOVE PT-PC-PRCHG-TYP-CDE (1) TO PV-PRCHG-TYP-CDE                 
X41762         ADD +1                  TO PV-PERM-LOOKUP-FORCE                  
X41762         MOVE 'Y'                TO PS-PRICE-CHANGE-ID-SW                 
X41762       ELSE                                                               
32094 * THE SKU/STORE COMBO IS NOT FOUND...                                     
32094          ADD +1                  TO PV-PERM-LOOKUP-FAIL                   
32094          MOVE ZEROES             TO PV-DOC-NBR                            
32094          MOVE ZEROES             TO PV-PRCHG-TYP-CDE                      
I41762*        MOVE ML012-INTR-UPC-ID  TO PV-DISPLAY-FIELD                      
I41762*        DISPLAY 'PRICE CHANGE CANNOT BE FOUND FOR:'                      
I41762*                ' INTR-UPC-ID = ' PV-DISPLAY-FIELD                       
I41762*                ' SKU = ' SKXREF-SKU                                     
I41762*                ' MD-LOC-NBR = ' PV-MD-LOC-NBR                           
I41762*                ' MD-EVENT-LOC = ' PV-MD-EVENT-LOC                       
X41762       END-IF                                                             
32094      END-IF.                                                              
32094                                                                           
32094 *    EXEC SQL                                                             
32094 *     SELECT                                                              
32094 *           A.PRCHG_ID                                                    
32094 *          ,A.EVNT_CTG_CDE                                                
32094 *          ,A.PRCHG_TYP_CDE                                               
32094 *          ,B.PRCHG_EFF_DTE                                               
32094 *      INTO :XMT00009-PRCHG-ID                                            
32094 *          ,:XMT00009-EVNT-CTG-CDE                                        
32094 *          ,:XMT00009-PRCHG-TYP-CDE                                       
32094 *          ,:XMT00010-PRCHG-EFF-DTE                                       
32094 *      FROM XMT_PRCHG        A                                            
32094 *          ,XMT_STR_GP_PRCHG B                                            
32094 *          ,XMT_PRCHG_MDSE   C                                            
32094 *          ,XMT_STR_GP_MBSHP D                                            
32094 *     WHERE A.PRCHG_ID       = B.PRCHG_ID                                 
32094 *       AND B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE                           
32094 *       AND B.STR_GP_ID      = C.STR_GP_ID                                
32094 *       AND B.PRCHG_ID       = C.PRCHG_ID                                 
32094 *       AND B.STR_GP_TYP_CDE = D.STR_GP_TYP_CDE                           
32094 *       AND B.STR_GP_ID      = D.STR_GP_ID                                
32094 *       AND D.EFF_BEG_DTE   <= B.PRCHG_EFF_DTE                            
32094 *       AND (D.EFF_END_DTE  >= B.PRCHG_EFF_DTE                            
32094 *        OR  D.EFF_END_DTE   IS NULL)                                     
32094 *       AND A.PRCHG_ST_CDE   = 'APR'                                      
32094 *       AND C.MDSE_HIER_CDE  = 'SKU'                                      
32094 *       AND C.SKU_NBR        = :SKXREF-SKU                                
32094 *       AND D.LOC_NBR        = :PV-MD-LOC-NBR                             
32094 *       AND B.PRCHG_EFF_DTE  = :PV-PROCESS-EFF-DATE                       
32094 *     WITH UR                                                             
32094 *    END-EXEC.                                                            
32094 *                                                                         
32094 *    EVALUATE TRUE                                                        
32094 *        WHEN SQLCODE = 0                                                 
32094 *            MOVE XMT00009-PRCHG-ID      TO PV-DOC-NBR                    
32094 *            MOVE XMT00009-PRCHG-TYP-CDE TO PV-PRCHG-TYP-CDE              
32094 *            SET PS-PRICE-CHANGE-ID-FOUND TO TRUE                         
32094 *        WHEN SQLCODE = +100                                              
32094 *            PERFORM 5100-SELECT-PERM-NON-SKU-LVL                         
32094 *        WHEN SQLCODE = -811                                              
32094 *            MOVE XMT00009-PRCHG-ID      TO PV-DOC-NBR                    
32094 *            MOVE XMT00009-PRCHG-TYP-CDE TO PV-PRCHG-TYP-CDE              
32094 *            DISPLAY 'DUPLICATE PRICE CHANGE FOUND IN 5000:'              
32094 *                    ' INTR-UPC-ID = ' ML012-INTR-UPC-ID                  
32094 *                    ' SKU = ' SKXREF-SKU                                 
32094 *                    ' MD-LOC-NBR = ' PV-MD-LOC-NBR                       
32094 *                    ' MD-EVENT-LOC = ' PV-MD-EVENT-LOC                   
32094 *            SET PS-PRICE-CHANGE-ID-FOUND TO TRUE                         
32094 *        WHEN OTHER                                                       
32094 *            DISPLAY 'INTR-UPC-ID = ' ML012-INTR-UPC-ID                   
32094 *                    ' SKU = ' SKXREF-SKU                                 
32094 *                    ' MD-LOC-NBR = ' PV-MD-LOC-NBR                       
32094 *                    ' MD-EVENT-LOC = ' PV-MD-EVENT-LOC                   
32094 *                    ' SQLCODE: ' SQLCODE                                 
32094 *            MOVE '5000-SELECT-PERM-SKU-LVL' TO PV-PARAGRAPH-NAME         
32094 *            MOVE 'ERROR ON SELECT '         TO PV-OPER-ATTEMPTED         
32094 *            PERFORM 9990-SQL-ABEND                                       
32094 *    END-EVALUATE.                                                        
32094 *                                                                         
32094 ******************************************************************        
32094 *    GET NON-SKU LEVEL PERM PRICING FROM PERM DOMAIN                      
32094 ******************************************************************        
32094 *5100-SELECT-PERM-NON-SKU-LVL.                                            
32094 *                                                                         
32094 *    ADD +1    TO PV-PERM-LOOKUP-CNT.                                     
32094 *                                                                         
32094 *    EXEC SQL                                                             
32094 *     SELECT                                                              
32094 *           A.PRCHG_ID                                                    
32094 *          ,A.EVNT_CTG_CDE                                                
32094 *          ,A.PRCHG_TYP_CDE                                               
32094 *          ,B.PRCHG_EFF_DTE                                               
32094 *      INTO :XMT00009-PRCHG-ID                                            
32094 *          ,:XMT00009-EVNT-CTG-CDE                                        
32094 *          ,:XMT00009-PRCHG-TYP-CDE                                       
32094 *          ,:XMT00010-PRCHG-EFF-DTE                                       
32094 *      FROM XMT_PRCHG        A                                            
32094 *          ,XMT_STR_GP_PRCHG B                                            
32094 *          ,XMT_PRCHG_MDSE   C                                            
32094 *          ,XMT_STR_GP_MBSHP D                                            
32094 *          ,TSKXREF          E                                            
32094 *          ,TUPC             F                                            
32094 *          ,TMDARVS          G                                            
32094 *     WHERE A.PRCHG_ID       = B.PRCHG_ID                                 
32094 *       AND B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE                           
32094 *       AND B.STR_GP_ID      = C.STR_GP_ID                                
32094 *       AND B.PRCHG_ID       = C.PRCHG_ID                                 
32094 *       AND B.STR_GP_TYP_CDE = D.STR_GP_TYP_CDE                           
32094 *       AND B.STR_GP_ID      = D.STR_GP_ID                                
32094 *       AND D.EFF_BEG_DTE   <= B.PRCHG_EFF_DTE                            
32094 *       AND (D.EFF_END_DTE  >= B.PRCHG_EFF_DTE                            
32094 *        OR  D.EFF_END_DTE   IS NULL)                                     
32094 *       AND E.INTR_UPC_ID    = F.INTR_UPC_ID                              
32094 *       AND F.UPC_TYP_CDE    = 'I'                                        
32094 *       AND F.SUB_CL_MDSEAR_ID = G.SUB_CL_MDSEAR_ID                       
32094 *       AND F.VS_ID            = G.VS_ID                                  
32094 *       AND ((C.MDSE_HIER_CDE  = 'STY'                                    
32094 *             AND C.STYL_ID    = G.RMS_STYL_ID)                           
32094 *        OR  (C.MDSE_HIER_CDE  = 'SCL'                                    
32094 *             AND C.SUB_CL_NBR = G.SUB_CL_NBR                             
32094 *             AND C.MAJ_CL_NBR = G.MAJ_CL_NBR                             
32094 *             AND C.DEPT_NBR   = G.DEPT_NBR)                              
32094 *        OR  (C.MDSE_HIER_CDE  = 'MCL'                                    
32094 *             AND C.MAJ_CL_NBR = G.MAJ_CL_NBR                             
32094 *             AND C.DEPT_NBR   = G.DEPT_NBR)                              
32094 *        OR  (C.MDSE_HIER_CDE  = 'DPT'                                    
32094 *             AND C.DEPT_NBR   = G.DEPT_NBR))                             
32094 *       AND A.PRCHG_ST_CDE   = 'APR'                                      
32094 *       AND E.SKU            = :SKXREF-SKU                                
32094 *       AND D.LOC_NBR        = :PV-MD-LOC-NBR                             
32094 *       AND DATE(B.PRCHG_EFF_DTE) = DATE(:PV-PROCESS-EFF-DATE)            
32094 *     WITH UR                                                             
32094 *    END-EXEC.                                                            
32094 *                                                                         
32094 *    EVALUATE TRUE                                                        
32094 *        WHEN SQLCODE = 0                                                 
32094 *            MOVE XMT00009-PRCHG-ID      TO PV-DOC-NBR                    
32094 *            MOVE XMT00009-PRCHG-TYP-CDE TO PV-PRCHG-TYP-CDE              
32094 *            SET PS-PRICE-CHANGE-ID-FOUND TO TRUE                         
32094 *        WHEN SQLCODE = +100                                              
32094 *            ADD +1    TO PV-PERM-LOOKUP-FAIL                             
32094 *            MOVE ZEROES                TO PV-DOC-NBR                     
32094 *                                          PV-PRCHG-TYP-CDE               
32094 *            DISPLAY 'PRICE CHANGE CANNOT BE FOUND FOR:'                  
32094 *                    ' INTR-UPC-ID = ' ML012-INTR-UPC-ID                  
32094 *                    ' SKU = ' SKXREF-SKU                                 
32094 *                    ' MD-LOC-NBR = ' PV-MD-LOC-NBR                       
32094 *                    ' MD-EVENT-LOC = ' PV-MD-EVENT-LOC                   
32094 *        WHEN SQLCODE = -811                                              
32094 *            MOVE XMT00009-PRCHG-ID      TO PV-DOC-NBR                    
32094 *            MOVE XMT00009-PRCHG-TYP-CDE TO PV-PRCHG-TYP-CDE              
32094 *            DISPLAY 'DUPLICATE PRICE CHANGE FOUND IN 5100:'              
32094 *                    ' INTR-UPC-ID = ' ML012-INTR-UPC-ID                  
32094 *                    ' SKU = ' SKXREF-SKU                                 
32094 *                    ' MD-LOC-NBR = ' PV-MD-LOC-NBR                       
32094 *                    ' MD-EVENT-LOC = ' PV-MD-EVENT-LOC                   
32094 *            SET PS-PRICE-CHANGE-ID-FOUND TO TRUE                         
32094 *        WHEN OTHER                                                       
32094 *            DISPLAY 'INTR-UPC-ID = ' ML012-INTR-UPC-ID                   
32094 *                    ' SKU = ' SKXREF-SKU                                 
32094 *                    ' MD-LOC-NBR = ' PV-MD-LOC-NBR                       
32094 *                    ' MD-EVENT-LOC = ' PV-MD-EVENT-LOC                   
32094 *                    ' SQLCODE = ' SQLCODE                                
32094 *            MOVE '5100-SELECT-PERM-NON-SKU-LVL' TO                       
32094 *                                          PV-PARAGRAPH-NAME              
32094 *            MOVE 'ERROR ON SELECT '    TO PV-OPER-ATTEMPTED              
32094 *            PERFORM 9990-SQL-ABEND                                       
32094 *    END-EVALUATE.                                                        
32094 *                                                                         
      ******************************************************************        
      *    SELECT QTY AND AMT                                                   
      ******************************************************************        
       5600-SELECT-QTY-AMT.                                                     
                                                                                
           ADD +1    TO PV-GRP-PRICE-LOOKUP-CNT.                                
                                                                                
           EXEC SQL                                                             
               SELECT                                                           
                       MITGPL_QTY                                               
                      ,GP_AMT                                                   
                 INTO                                                           
                       :MITGPL-MITGPL-QTY                                       
                      ,:MITGPL-GP-AMT                                           
                 FROM                                                           
                       TMITGPL                                                  
                 WHERE                                                          
                       MEITGP_NBR = :PV-MEITGP-NBR                              
                 WITH UR                                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                   IF MITGPL-MITGPL-QTY NOT EQUAL 0                             
RONNA                  COMPUTE PV-OLD-GP-PR-AMT ROUNDED =                       
                           MITGPL-GP-AMT / MITGPL-MITGPL-QTY                    
                   ELSE                                                         
                       ADD +1   TO PV-GRP-PRICE-LOOKUP-FAIL                     
RONNA                  MOVE 0   TO PV-OLD-GP-PR-AMT                             
                   END-IF                                                       
               WHEN SQLCODE = +100                                              
                   ADD +1   TO PV-GRP-PRICE-LOOKUP-FAIL                         
RONNA              MOVE 0   TO PV-OLD-GP-PR-AMT                                 
               WHEN OTHER                                                       
                   MOVE '5600-SELECT-QTY-AMT' TO PV-PARAGRAPH-NAME              
                   MOVE 'ERROR ON SELECT '    TO PV-OPER-ATTEMPTED              
                   PERFORM 9990-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
32094 /*****************************************************************        
32094 * 6000-LOAD-PRCHG-ATTRIB                                                  
32094 ******************************************************************        
32094  6000-LOAD-PRCHG-ATTRIB.                                                  
32094                                                                           
32094      IF PV-PRCHG-NDX IS GREATER THAN PC-MAX-PRICE-ROWS                    
32094          DISPLAY '** ABEND ******************'                            
32094          DISPLAY '*  6000-LOAD-PRCHG-ATTRIB  '                            
32094          DISPLAY '*  ROWS EXCEEDED MAX OF    ', PC-MAX-PRICE-ROWS         
32094          DISPLAY '***************************'                            
32094          PERFORM 9999-ABEND                                               
32094      END-IF.                                                              
32094                                                                           
32094      IF ML002-INTR-UPC-ID = ML012-INTR-UPC-ID                             
32094        IF PT-PC-SKU-NBR (PV-PRCHG-NDX) EQUAL ZEROS        AND             
32094           PT-PC-INTR-UPC-ID (PV-PRCHG-NDX) EQUAL ZEROS    AND             
32094           PT-PC-LOC-NBR (PV-PRCHG-NDX) EQUAL ZEROS        AND             
32094           PT-PC-PRCHG-ID (PV-PRCHG-NDX) EQUAL ZEROS       AND             
32094           PT-PC-EVNT-CTG-CDE (PV-PRCHG-NDX) EQUAL SPACES  AND             
32094           PT-PC-PRCHG-TYP-CDE (PV-PRCHG-NDX) EQUAL SPACES AND             
32094           PT-PC-PRCHG-EFF-DTE (PV-PRCHG-NDX) EQUAL SPACES                 
32094          MOVE ML002-SKU-NBR  TO PT-PC-SKU-NBR (PV-PRCHG-NDX)              
32094          MOVE ML002-INTR-UPC-ID                                           
32094                          TO PT-PC-INTR-UPC-ID (PV-PRCHG-NDX)              
32094          MOVE ML002-LOC-NBR  TO PT-PC-LOC-NBR (PV-PRCHG-NDX)              
32094          MOVE ML002-PRCHG-ID TO PT-PC-PRCHG-ID (PV-PRCHG-NDX)             
32094          MOVE ML002-EVNT-CTG-CDE                                          
32094                          TO PT-PC-EVNT-CTG-CDE (PV-PRCHG-NDX)             
32094          MOVE ML002-PRCHG-TYP-CDE                                         
32094                          TO PT-PC-PRCHG-TYP-CDE (PV-PRCHG-NDX)            
32094          MOVE ML002-PRCHG-EFF-DTE                                         
32094                          TO PT-PC-PRCHG-EFF-DTE (PV-PRCHG-NDX)            
32094          PERFORM 8200-READ-PRCHG-ATTRIB                                   
32094          ADD 1           TO PV-PERM-ATTRIB-CNT                            
32094        ELSE                                                               
32094          ADD 1           TO PV-PRCHG-NDX                                  
32094          GO TO 6000-LOAD-PRCHG-ATTRIB                                     
32094        END-IF                                                             
32094      ELSE                                                                 
32094      IF ML002-INTR-UPC-ID > ML012-INTR-UPC-ID                             
32094          MOVE 'Y'        TO PS-PRCHG-ATTRIB-LOAD-SW                       
32094          ADD 1           TO PV-PERM-ATTRIB-CNT                            
32094      ELSE                                                                 
32094          PERFORM 8200-READ-PRCHG-ATTRIB                                   
32094      END-IF.                                                              
32094                                                                           
32094 ******************************************************************        
32094 * 6100-PRCHG-ATTRIB.                                                      
32094 ******************************************************************        
32094  6100-PRCHG-ATTRIB.                                                       
32094                                                                           
32094      IF PS-PRCHG-ATTRIB-EOF                                               
32094          NEXT SENTENCE                                                    
32094      ELSE                                                                 
32094      IF ML012-INTR-UPC-ID > ML002-INTR-UPC-ID OR                          
32094         ML012-INTR-UPC-ID = ML002-INTR-UPC-ID                             
32094          INITIALIZE PT-PERM-PRCHG-TABLE                                   
32094          MOVE 'N'        TO PS-PRCHG-ATTRIB-LOAD-SW                       
32094          MOVE 1          TO PV-PERM-ATTRIB-CNT                            
32094          MOVE 1          TO PV-PRCHG-NDX                                  
32094          PERFORM 6000-LOAD-PRCHG-ATTRIB                                   
32094             UNTIL PS-PRCHG-ATTRIBS-LOADED OR                              
32094                   PS-PRCHG-ATTRIB-EOF                                     
32094      END-IF.                                                              
32094                                                                           
32094 ******************************************************************        
32094 * 6200-GET-PRCHG-ATTRIBS.                                                 
32094 ******************************************************************        
32094  6200-GET-PRCHG-ATTRIBS.                                                  
32094                                                                           
32094      IF PT-PC-SKU-NBR (PV-PRCHG-NDX) EQUAL ZEROS        AND               
32094         PT-PC-INTR-UPC-ID (PV-PRCHG-NDX) EQUAL ZEROS    AND               
32094         PT-PC-LOC-NBR (PV-PRCHG-NDX) EQUAL ZEROS        AND               
32094         PT-PC-PRCHG-ID (PV-PRCHG-NDX) EQUAL ZEROS       AND               
32094         PT-PC-EVNT-CTG-CDE (PV-PRCHG-NDX) EQUAL SPACES  AND               
32094         PT-PC-PRCHG-TYP-CDE (PV-PRCHG-NDX) EQUAL SPACES AND               
32094         PT-PC-PRCHG-EFF-DTE (PV-PRCHG-NDX) EQUAL SPACES                   
32094          MOVE 'N'        TO PS-PRICE-CHANGE-ID-SW                         
32094          MOVE 9999999    TO PV-PRCHG-NDX                                  
32094      ELSE                                                                 
32094      IF PT-PC-INTR-UPC-ID (PV-PRCHG-NDX) = ML012-INTR-UPC-ID AND          
32094         PT-PC-LOC-NBR (PV-PRCHG-NDX) = PV-MD-LOC-NBR         AND          
32094         PT-PC-PRCHG-EFF-DTE (PV-PRCHG-NDX) = PV-PROCESS-EFF-DATE          
32094          MOVE PT-PC-PRCHG-ID (PV-PRCHG-NDX) TO PV-DOC-NBR                 
32094          MOVE PT-PC-PRCHG-TYP-CDE (PV-PRCHG-NDX)                          
32094                          TO PV-PRCHG-TYP-CDE                              
32094          MOVE 'Y'        TO PS-PRICE-CHANGE-ID-SW                         
32094      END-IF.                                                              
32094                                                                           
      ******************************************************************        
      *    MOVE OTHER FIELDS TO OUTPUT FILE                                     
      ******************************************************************        
       7000-MOVE-OUTPUT-FIELDS.                                                 
                                                                                
R27813*    IF PV-OLD-PR-AMT > ML012-NEW-UNT-RTL-AMT                             
R27813**       "MARKDOWN"                                                       
R27813*        MOVE '4' TO ML017-PC-CDE                                         
R27813*    ELSE                                                                 
R27813**       "MARKUP"                                                         
R27813*        MOVE '5' TO ML017-PC-CDE                                         
R27813*    END-IF.                                                              
           MOVE SPACES             TO  ML017-SLS-CORR-CDE.                      
           MOVE PV-DEPT            TO  ML017-PC-DOC-5-DEPT                      
RONNA                                  ML017-PC-DEPT-NBR.                       
RONNA      MOVE PV-SUBCLASS        TO  ML017-PC-CLASS-NBR.                      
RONNA      MOVE PV-CLASS           TO  ML017-PC-MAJ-CLASS.                      
           MOVE CC-DATE-MM         TO  ML017-PC-DOC-5-DAY.                      
           MOVE ML012-EFF-BEG-MM   TO  ML017-PC-DTE-MM.                         
           MOVE ML012-EFF-BEG-DD   TO  ML017-PC-DTE-DD.                         
                                                                                
S29145*MOVE THIS CALL 1000-INITIALIZATION TO BE EXECUTED ONLY ONCE              
  |   *    MOVE PV-PROCESS-EFF-DATE TO DPG52-LK-DATE-INPUT.                     
  |   *    MOVE 0                  TO  PV-INCR-DECR-DAYS.                       
  |   *    SET DPG51-FISCAL-454-CALENDAR                                        
  |   *        DPG51-DO-NOT-INCR-DECR-DATE                                      
  |   *        DPG52-LK-DTE-ISO-FMT TO TRUE.                                    
  |   *                                                                         
  |   *    PERFORM Z930-CALL-DATE-CALC-MODULE.                                  
  |   *                                                                         
  |   *    MOVE DPG56-FISCAL-PERIOD-NBR                                         
  |   *                            TO ML017-PC-KOHLS-MM.                        
S29145     MOVE PV-FISCAL-MONTH    TO ML017-PC-KOHLS-MM.                        
                                                                                
           MOVE PV-SKU             TO  ML017-PC-SKU.                            
                                                                                
           EVALUATE PV-PRCHG-TYP-CDE                                            
               WHEN 'MUA'                                                       
R27813             MOVE '5'   TO ML017-PC-CDE                                   
                   MOVE '3'   TO ML017-PC-TYP-CDE                               
                   MOVE '3'   TO ML017-PC-RSN-CDE                               
                   MOVE '050' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
               WHEN 'MDA'                                                       
R27813             MOVE '4'   TO ML017-PC-CDE                                   
                   MOVE '1'   TO ML017-PC-TYP-CDE                               
                   MOVE '1'   TO ML017-PC-RSN-CDE                               
                   MOVE '050' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
               WHEN 'CLR'                                                       
R27813             MOVE '4'   TO ML017-PC-CDE                                   
                   MOVE '1'   TO ML017-PC-TYP-CDE                               
                   MOVE '1'   TO ML017-PC-RSN-CDE                               
                   MOVE '021' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
               WHEN 'RCP'                                                       
R27813             MOVE '4'   TO ML017-PC-CDE                                   
                   MOVE '1'   TO ML017-PC-TYP-CDE                               
                   MOVE '1'   TO ML017-PC-RSN-CDE                               
                   MOVE '024' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
               WHEN 'CTA'                                                       
R27813             MOVE '4'   TO ML017-PC-CDE                                   
                   MOVE '2'   TO ML017-PC-TYP-CDE                               
                   MOVE '2'   TO ML017-PC-RSN-CDE                               
                   MOVE '051' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
               WHEN 'CON'                                                       
R27813             MOVE '4'   TO ML017-PC-CDE                                   
                   MOVE '1'   TO ML017-PC-TYP-CDE                               
                   MOVE '1'   TO ML017-PC-RSN-CDE                               
                   MOVE '112' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
W29145         WHEN 'MK2'                                                       
W29145             MOVE '4'   TO ML017-PC-CDE                                   
W29145             MOVE '1'   TO ML017-PC-TYP-CDE                               
W29145             MOVE '1'   TO ML017-PC-RSN-CDE                               
W29145             MOVE '025' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
W29145         WHEN 'FNL'                                                       
W29145             MOVE '4'   TO ML017-PC-CDE                                   
W29145             MOVE '1'   TO ML017-PC-TYP-CDE                               
W29145             MOVE '1'   TO ML017-PC-RSN-CDE                               
W29145             MOVE '026' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
P5207F         WHEN 'MUC'                                                       
P5207F             MOVE '5'   TO ML017-PC-CDE                                   
P5207F             MOVE '4'   TO ML017-PC-TYP-CDE                               
P5207F             MOVE '1'   TO ML017-PC-RSN-CDE                               
P5207F             MOVE '060' TO ML017-PC-MKDN-MKUP-RSN-CDE                     
           END-EVALUATE.                                                        
                                                                                
W29145     MOVE ML012-ORIG-CLR-DTE    TO  ML017-ORIG-CLR-DTE.                   
W29145     MOVE ML012-MKDN-CDE        TO  ML017-MKDN-CDE.                       
           MOVE PV-OLD-PR-AMT         TO  ML017-PC-OLD-PR-AMT.                  
S29145     MOVE PV-OLD-PR-AMT-NONGRP  TO  ML017-ORIG-CLR-NONGRP-RTL.            
           MOVE ML012-NEW-UNT-RTL-AMT TO  ML017-PC-NEW-PR-AMT.                  
PK3009*    MOVE ML012-ON-HAND-QTY     TO  ML017-PC-QTY.                         
           MOVE '999'                 TO  ML017-PC-BATCH-NBR                    
           COMPUTE ML017-PC-DIFFER-AMT =                                        
               (ML017-PC-OLD-PR-AMT - ML017-PC-NEW-PR-AMT)                      
           END-COMPUTE.                                                         
           MOVE ML012-LOC-NBR      TO  ML017-PC-STORE-NBR.                      
           MOVE '4'                TO  ML017-PC-CATEG-CDE.                      
           IF ML012-RF-CONTROL-NBR = ZEROES                                     
               MOVE PV-DOC-NBR-7         TO  ML017-PC-DOC-7-NBR-PIC9            
           ELSE                                                                 
               MOVE ML012-RF-CONTROL-NBR TO  ML017-PC-DOC-7-NBR-PIC9            
           END-IF.                                                              
           MOVE VNDSTL-ENT-ID      TO ML017-PC-ENT-ID.                          
                                                                                
      ******************************************************************        
      *    WRITE SUMMARY RECORDS - ONE RECORD FOR ALL STORES                    
      ******************************************************************        
       8000-WRITE-OUTPUT-REC.                                                   
                                                                                
PK3009     INITIALIZE ML017-TEMP-PC-RECORD                                      
PK3009     PERFORM                                                              
PK3009         UNTIL ML012-ON-HAND-QTY <= PC-MAX-QTY                            
PK3009         ADD +1                     TO PV-TOT-SPLIT-RECS                  
PK3009                                                                          
PK3009         MOVE ML017-PRICE-CHANGE-RECORD                                   
PK3009                                    TO ML017-TEMP-PC-RECORD               
PK3009         COMPUTE ML012-ON-HAND-QTY                                        
PK3009                     = ML012-ON-HAND-QTY                                  
PK3009                     - PC-MAX-QTY                                         
PK3009         MOVE PC-MAX-QTY            TO  ML017-PC-QTY                      
PK3009         WRITE ML-OUT-REC           FROM                                  
PK3009                                        ML017-PRICE-CHANGE-RECORD         
PK3009         ADD +1 TO PV-OUTPUT-CNT                                          
PK3009                   PV-RECS-WRITTEN-CNT                                    
PK3009         MOVE ML017-TEMP-PC-RECORD                                        
PK3009                                TO ML017-PRICE-CHANGE-RECORD              
PK3009     END-PERFORM.                                                         
PK3009                                                                          
PK3009     MOVE ML012-ON-HAND-QTY     TO  ML017-PC-QTY.                         
                                                                                
           WRITE ML-OUT-REC FROM ML017-PRICE-CHANGE-RECORD                      
           ADD +1 TO PV-OUTPUT-CNT                                              
                     PV-RECS-WRITTEN-CNT.                                       
                                                                                
27813 ******************************************************************        
27813 * 8100-WRITE-ERROR-OUTPUT.                                                
27813 ******************************************************************        
27813  8100-WRITE-ERROR-OUTPUT.                                                 
27813                                                                           
PK3009     INITIALIZE ML017-TEMP-ERR-PC-RECORD                                  
PK3009     PERFORM                                                              
PK3009         UNTIL ML012-ON-HAND-QTY <= PC-MAX-QTY                            
PK3009         ADD +1                     TO PV-TOT-SPLIT-ERR-RECS              
PK3009                                                                          
PK3009         MOVE ML017-PRICE-CHANGE-RECORD                                   
PK3009                                    TO ML017-TEMP-ERR-PC-RECORD           
PK3009         COMPUTE ML012-ON-HAND-QTY                                        
PK3009                     = ML012-ON-HAND-QTY                                  
PK3009                     - PC-MAX-QTY                                         
PK3009         MOVE PC-MAX-QTY            TO  ML017-PC-QTY                      
PK3009         WRITE ML-ERROR-FILE-RECORD FROM                                  
PK3009                                        ML017-PRICE-CHANGE-RECORD         
PK3009         ADD +1 TO PV-ERR-OUTPUT-CNT                                      
PK3009         MOVE ML017-TEMP-ERR-PC-RECORD                                    
PK3009                                TO ML017-PRICE-CHANGE-RECORD              
PK3009     END-PERFORM.                                                         
PK3009                                                                          
PK3009     MOVE ML012-ON-HAND-QTY     TO  ML017-PC-QTY.                         
27813                                                                           
27813      WRITE ML-ERROR-FILE-RECORD FROM ML017-PRICE-CHANGE-RECORD            
27813      ADD +1 TO PV-ERR-OUTPUT-CNT.                                         
27813                                                                           
32094 ******************************************************************        
32094 * 8200-READ-PRCHG-ATTRIB.                                                 
32094 ******************************************************************        
32094  8200-READ-PRCHG-ATTRIB.                                                  
32094                                                                           
32094      READ INPUT-PERM-PRCHG-ATTRIB                                         
32094          INTO ML002-PERM-PRCHG-ATTRIB-RECS                                
32094          AT END  MOVE 'Y' TO PS-PERM-PRCHG-ATTRIB-EOF-SW                  
32094      END-READ.                                                            
32094                                                                           
      ******************************************************************        
      *Z930-CALL-DATE-CALC-MODULE                                      *        
      *  ==> PROCESSES:                                                *        
      *    - PERFORMS THE CALL TO THE DATE CALCULATION MODULE TO  DPKUT1        
      ******************************************************************        
       Z930-CALL-DATE-CALC-MODULE.                                              
                                                                                
           MOVE PV-INCR-DECR-DAYS      TO DPG51-INCR-DECR-DAYS-9.               
                                                                                
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
                                                   DPG53 DPG54                  
                                                   DPG55 DPG56.                 
                                                                                
           EVALUATE TRUE                                                        
               WHEN DPG54-NO-ERROR                                              
                    CONTINUE                                                    
               WHEN DPG54-WARNING-ERROR                                         
               WHEN DPG54-SEVERE-ERROR                                          
                    DISPLAY '** ABEND - PROGRAM MLKUT013 **'                    
                    DISPLAY 'BAD CALL TO THE CALENDAR MODULE DPKUT500'          
                    DISPLAY PV-PARAGRAPH-NAME                                   
                    DISPLAY DPG54-ERROR-MESSAGE                                 
                    MOVE +4008 TO ABEND-CODE                                    
                    PERFORM 9999-ABEND                                          
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 RELATED PROBLEM.             
      ******************************************************************        
       9990-SQL-ABEND.                                                          
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  = ' PV-PROGRAM-NAME.                      
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-OPER-ATTEMPTED.                    
           DISPLAY '**********************************'.                        
                                                                                
      ******************************************************************        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *        
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *        
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *        
      * FORMAT.                                                        *        
      ******************************************************************        
           COPY DPPD004.                                                        
                                                                                
           PERFORM 9999-ABEND.                                                  
                                                                                
      ******************************************************************        
      *  THIS ROUTINE FORCES AN ABEND                                           
      ******************************************************************        
       9999-ABEND.                                                              
                                                                                
           SET ABEND-4013-DB2-ERROR TO TRUE.                                    
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
