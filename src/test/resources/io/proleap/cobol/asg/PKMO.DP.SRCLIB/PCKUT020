000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000500 PROGRAM-ID.    PCKUT020.                                         00050000
000600 AUTHOR.        DEANNA BRANTNER                                   00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   FEBRUARY, 2002.                                   00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL CREATE AN EXTRACT FILE WHICH WILL BE USED TO 00120000
001300*  PURGE THE PCT_RCVR_LNE_DTL TABLE WEEKLY IN JOB PCK110.         00130000
001401*                                                                 00140100
001500******************************************************************00140500
001700******************************************************************00140700
001800 ENVIRONMENT DIVISION.                                            00140800
002100 CONFIGURATION SECTION.                                           00142000
002200                                                                  00143000
002300 SOURCE-COMPUTER.        IBM-3090.                                00144000
002400 OBJECT-COMPUTER.        IBM-3090.                                00145000
002500                                                                  00146000
002600 INPUT-OUTPUT SECTION.                                            00147000
002700                                                                  00148000
002800 FILE-CONTROL.                                                    00149000
002900                                                                  00150000
003400     SELECT EXTRACT-FILE                                          00160000
003200         ASSIGN TO OUT01.                                         00180000
003300                                                                  00190000
003700******************************************************************00230000
003800 DATA DIVISION.                                                   00240000
003900******************************************************************00250000
004100 FILE SECTION.                                                    00270000
004300                                                                  00290000
005100 FD  EXTRACT-FILE                                                 00370000
005200     RECORDING MODE IS F                                          00380000
005300     LABEL RECORDS ARE STANDARD                                   00390000
005400     BLOCK CONTAINS 0 RECORDS.                                    00400000
005500                                                                  00410000
005600 01  EXTRACT-RECORD              PIC  X(025).                     00420000
005700                                                                  00430000
006000******************************************************************00460000
006100 WORKING-STORAGE SECTION.                                         00470000
006200******************************************************************00480000
007100*                                                                 00570000
007200******************************************************************00580000
007300*  RECORD LAYOUT FOR THE EXTRACT FILE.                            00590000
007400******************************************************************00600000
007500     COPY PCRD021.                                                00610000
007700                                                                  00630000
007800******************************************************************00640000
007900*  DB2 FORMATTED MESSAGE AREA                                     00650000
008000******************************************************************00660000
008100     COPY DPWS004.                                                00670000
008300                                                                  00690000
008400******************************************************************00700000
008500*  COMMUNICATIONS AREA FOR DB2                                    00710000
008600******************************************************************00720000
008700     EXEC SQL                                                     00730000
008800          INCLUDE SQLCA                                           00740000
008900     END-EXEC.                                                    00750000
009000                                                                  00760000
009100******************************************************************00770000
009200*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE RECEIVER/LINE      00780000
009300*  DETAIL TABLE                                                   00790000
009400******************************************************************00800000
009500     EXEC SQL                                                     00810000
009600          INCLUDE PCT00007                                        00820000
009700     END-EXEC.                                                    00830000
009800******************************************************************00840000
009900*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PARM TABLE         00850000
010100******************************************************************00870000
010200     EXEC SQL                                                     00880000
010300          INCLUDE TKRPRPM                                         00890000
010400     END-EXEC.                                                    00900000
010500******************************************************************00910000
010600*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE RECEIVING TABLE    00920000
010800******************************************************************00940000
010900     EXEC SQL                                                     00950000
011000          INCLUDE TRECEIV                                         00960000
011100     END-EXEC.                                                    00970000
P41579******************************************************************00978016
P41579*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE CENTRAL STOCK      00979016
P41579*  PULL STATUS TABLE                                              00979116
P41579******************************************************************00979216
P41579     EXEC SQL                                                     00979316
P41579          INCLUDE TCEPLST                                         00979416
P41579     END-EXEC.                                                    00979516
011200*                                                                 00980000
011300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00990000
011400                                                   COMP SYNC.     01000000
011500                                                                  01010000
011600 01  PS-PROGRAM-SWITCHES.                                         01020000
011700     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     01030000
011800         88  PS-END-OF-CURSOR                      VALUE 'Y'.     01040000
011900         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     01050000
012000                                                                  01060000
012100                                                                  01070000
012200 01  PC-PROGRAM-CONSTANTS.                                        01080000
012300     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01090000
012400                                                   COMP SYNC.     01100000
012500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01110000
012600         'PCKUT020'.                                              01120000
012700     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 020.     01130000
012900     05  PC-RECEIVE-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01150009
013000     05  PC-RECEIVE-TIMESTAMP-RDF  REDEFINES PC-RECEIVE-TIMESTAMP.01160009
013100         10  PC-RECEIVE-DATE         PIC X(10).                   01170009
013200         10  PC-RECEIVE-TIME         PIC X(16).                   01180009
013300     05  PC-EXTRACT-DATE             PIC X(10).                   01190000
013300     05  PC-PURGE-DATE               PIC X(10).                   01191000
P41579     05  PC-CREATE-TIMESTAMP         PIC X(26)    VALUE SPACES.   01192023
P41579     05  PC-CREATE-TIMESTAMP-RDF   REDEFINES PC-CREATE-TIMESTAMP. 01193024
P41579         10  PC-CREATE-DATE          PIC X(10).                   01194023
P41579         10  PC-CREATE-TIME          PIC X(16).                   01195023
013400                                                                  01200000
013500 01  PV-PROGRAM-VARIABLES.                                        01210000
013600     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    01220000
013700     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01230000
013800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01240000
013900     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01250000
014000                                                   COMP SYNC.     01260000
014100     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01270000
014200                                                   COMP SYNC.     01280000
014300     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01290000
014400                                                   COMP SYNC.     01300000
014500     05  PV-FETCH-COUNT              PIC S9(09)    VALUE ZERO     01310000
014600                                                   COMP SYNC.     01320000
014700     05  PV-WRITE-COUNT              PIC S9(09)    VALUE ZERO     01330000
014800                                                   COMP SYNC.     01340000
P41579     05  PV-TRECEIV-COUNT            PIC S9(09)    VALUE ZERO     01341025
P41579                                                   COMP SYNC.     01342025
P41579     05  PV-CENT-STCK-COUNT          PIC S9(09)    VALUE ZERO     01343025
P41579                                                   COMP SYNC.     01344025
P41579     05  PV-NOT-IN-RCV-AND-CE-COUNT  PIC S9(09)    VALUE ZERO     01345027
P41579                                                   COMP SYNC.     01346027
014900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01350000
015000     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       01360000
015100                                                   COMP SYNC.     01370000
015200     05  PV-COMMIT-COUNTER           PIC 9(03)     VALUE ZERO.    01380000
015300                                                                  01390000
015400     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01400000
015500                                                   COMP-3.        01410000
016400     EXEC SQL                                                     01500000
016500          DECLARE PO-DATE-CSR CURSOR FOR                          01510000
                    SELECT  A.WRKD_UNT_TMST                             01520000
                           ,A.PO_NBR                                    01530000
                           ,A.RCVR_SEQ_NBR                              01531000
                      FROM  PCT_RCVR_LNE_DTL A                          01540000
                     WHERE A.BUS_DTE      <= :PC-PURGE-DATE             01550000
                     AND   A.WRKD_UNT_TMST =                            01560000
                   (SELECT MAX(B.WRKD_UNT_TMST)                         01570000
                      FROM  PCT_RCVR_LNE_DTL B                          01580000
                     WHERE A.PO_NBR = B.PO_NBR                          01590015
                       AND A.RCVR_SEQ_NBR = B.RCVR_SEQ_NBR)             01591015
                     ORDER BY A.PO_NBR, A.RCVR_SEQ_NBR                  01600000
017700     END-EXEC.                                                    01650000
017800                                                                  01660000
018000******************************************************************01680000
018100 PROCEDURE DIVISION.                                              01690000
018200******************************************************************01700000
018400 0000-PROGRAM-MAINLINE.                                           01720000
018500******************************************************************01730000
018600* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01740000
018700*      PROGRAM.                                                   01750000
018800******************************************************************01760000
018900                                                                  01770000
019000     PERFORM 1000-INITIALIZE.                                     01780000
019100     IF PS-NOT-END-OF-CURSOR                                      01790000
019200         PERFORM 2000-FIND-PO-RCVR                                01800000
019300            UNTIL PS-END-OF-CURSOR                                01810000
019400     END-IF.                                                      01820000
019500     PERFORM 9000-EOJ-ROUTINE.                                    01830000
019600                                                                  01840000
019700     STOP RUN.                                                    01850000
019800                                                                  01860000
020000******************************************************************01880000
020100*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01890000
020200*    -- OPEN INPUT FILE                                           01900000
020300*    -- READ FILE                                                 01910000
020400******************************************************************01920000
019900 1000-INITIALIZE.                                                 01921000
020500                                                                  01930000
020600     OPEN OUTPUT EXTRACT-FILE.                                    01940000
020800     PERFORM 1500-DETERMINE-EXTRACT-DATE.                         01960007
020900     PERFORM 4000-OPEN-CURSOR.                                    01970000
021000     PERFORM 4100-FETCH-CURSOR.                                   01980000
021100                                                                  01990000
021300******************************************************************02010000
021400*  DETERMINE EXTRACT DATE.                                        02020006
021500******************************************************************02030000
021200 1500-DETERMINE-EXTRACT-DATE.                                     02031006
021600                                                                  02040000
021700     EXEC SQL                                                     02050000
021800          SELECT DISTINCT                                         02060000
022100                 DATE(CURRENT TIMESTAMP - 7 DAYS)                 02090000
022200            INTO :PC-EXTRACT-DATE                                 02100000
                 FROM  TKRPRPM                                          02110004
022800     END-EXEC.                                                    02160000
022900                                                                  02170000
023000     EVALUATE TRUE                                                02170105
023100         WHEN SQLCODE = ZERO                                      02170205
023200             DISPLAY ' EXTRACT DATE IS ' PC-EXTRACT-DATE          02170305
023200             PERFORM 1600-DETERMINE-PURGE-DATE                    02170406
023300         WHEN SQLWARN0 NOT = SPACES                               02170506
023400         WHEN SQLCODE < ZERO                                      02170606
023500         WHEN SQLCODE > ZERO                                      02170706
023600             MOVE '1500-DETERMINE-EXTRACT-DATE'                   02170806
023700                                 TO PV-PARAGRAPH-NAME             02170906
024100             PERFORM 9100-SQL-ABEND                               02171006
024200     END-EVALUATE.                                                02171106
025000                                                                  02171206
021300******************************************************************02171306
021400*  DETERMINE PURGE DATE.                                          02171406
021500******************************************************************02171506
021200 1600-DETERMINE-PURGE-DATE.                                       02171606
021600                                                                  02171706
           EXEC SQL                                                     02171806
               SELECT DATE(:PC-EXTRACT-DATE) - FUNC_QTY DAYS            02172008
                 INTO   :PC-PURGE-DATE                                  02173000
                 FROM  TKRPRPM                                          02174000
                WHERE SYS_PRC_FUNC_CDE = 'POHIST'                       02175000
                  AND LOC_ID           = 90                             02176000
            END-EXEC.                                                   02177000
022900                                                                  02178000
023000     EVALUATE TRUE                                                02180000
023100         WHEN SQLCODE = ZERO                                      02190000
023200             DISPLAY ' PURGE DATE IS ' PC-PURGE-DATE              02200000
023300         WHEN SQLWARN0 NOT = SPACES                               02210000
023400         WHEN SQLCODE < ZERO                                      02220000
023500         WHEN SQLCODE > ZERO                                      02230000
023600             MOVE '1600-DETERMINE-PURGE-DATE'                     02240006
023700                                 TO PV-PARAGRAPH-NAME             02250000
024100             PERFORM 9100-SQL-ABEND                               02290000
024200     END-EVALUATE.                                                02300000
025000                                                                  02380000
025200******************************************************************02400000
025300*  PROCESS THE PO RCVR RECORDS                                    02410000
025400******************************************************************02420000
025100 2000-FIND-PO-RCVR.                                               02421000
025500                                                                  02430000
025800     PERFORM 4100-FETCH-CURSOR.                                   02460000
025900                                                                  02470000
026200******************************************************************02500000
026300*  CHECK TRECEIV TO SEE IF THE PO WAS VERIFIED BEFORE THE PURGE   02510000
026300*  DATE                                                           02511000
026400******************************************************************02520000
026100 5000-CHECK-TRECEIV.                                              02521000
026500                                                                  02530000
026600      EXEC SQL                                                    02540000
026700           SELECT VERFYD_TMST                                     02550004
                       ,STATUS_CDE                                      02550110
                   INTO :RECEIV-VERFYD-TMST                             02551002
                       ,:RECEIV-STATUS-CDE                              02551110
                   FROM TRECEIV                                         02552004
                 WHERE ORD_NBR     = :PCT00007-PO-NBR                   02553000
                   AND REC_SEQ_NBR = :PCT00007-RCVR-SEQ-NBR             02554000
P41579*            AND (STATUS_CDE  = 'VE'                              02555016
P41579*             OR  STATUS_CDE  = 'DE')                             02556016
026800      END-EXEC.                                                   02560000
026900                                                                  02570000
027000      EVALUATE TRUE                                               02580000
028200          WHEN SQLCODE = ZERO                                     02590000
028300              IF RECEIV-STATUS-CDE = 'DE'                         02591010
P41579                  ADD +1 TO PV-TRECEIV-COUNT                      02591125
028300                  PERFORM 8000-WRITE-OUTPUT-RECS                  02592010
028300              ELSE                                                02593020
P41579                  IF RECEIV-STATUS-CDE = 'VE'                     02594020
028300                      MOVE RECEIV-VERFYD-TMST                     02600020
028300                                      TO PC-RECEIVE-TIMESTAMP     02600120
028300                      IF PC-RECEIVE-DATE <= PC-PURGE-DATE         02601020
P41579                          ADD +1 TO PV-TRECEIV-COUNT              02602025
028300                          PERFORM 8000-WRITE-OUTPUT-RECS          02610020
028300                      END-IF                                      02611020
P41579                  END-IF                                          02611121
028300              END-IF                                              02611219
028200          WHEN SQLCODE = +100                                     02612000
P41579*             CONTINUE                                            02613016
P41579              PERFORM 5100-CHECK-CENT-STCK-TABLES                 02614016
027400          WHEN SQLWARN0 NOT = SPACES                              02620000
027500          WHEN SQLCODE < ZERO                                     02630000
027600          WHEN SQLCODE > ZERO                                     02640000
027700              MOVE '5000-CHECK-TRECEIV '                          02650000
027800                              TO PV-PARAGRAPH-NAME                02660000
027900              MOVE 'SELECT TRECEIV  '                             02670004
028000                              TO PV-DB2-OPERATION-ATTEMPTED       02680000
028100              PERFORM 9100-SQL-ABEND                              02690000
028400      END-EVALUATE.                                               02720000
028500                                                                  02730000
P41579******************************************************************02731016
P41579* CHECK CENTRAL STOCK TABLES TO DETERMINE THE DATA IS ELIGIBLE    02732016
P41579* FOR PURGE OR NOT                                                02733016
P41579******************************************************************02734016
P41579 5100-CHECK-CENT-STCK-TABLES.                                     02735016
P41579                                                                  02736016
P41579      EXEC SQL                                                    02737016
P41579           SELECT A.STAT_CDE,                                     02738031
P41579                  A.CRE_TMST                                      02739031
P41579             INTO :CEPLST-STAT-CDE,                               02740034
P41579                  :CEPLST-CRE-TMST                                02740131
P41579             FROM TCEPLST A                                       02740231
P41579            WHERE A.CNSTK_REQ_PL_NBR = :PCT00007-PO-NBR           02740331
P41579              AND A.PL_LNE_NBR       =  0                         02740431
P41579              AND A.CRE_TMST         =                            02740531
P41579                  (SELECT MAX(B.CRE_TMST)                         02740635
P41579                     FROM TCEPLST B                               02740734
P41579                    WHERE B.CNSTK_REQ_PL_NBR = :PCT00007-PO-NBR   02740834
P41579                      AND B.PL_LNE_NBR       =  0 )               02740934
P41579      END-EXEC.                                                   02741016
P41579                                                                  02741116
P41579      EVALUATE TRUE                                               02741436
P41579          WHEN SQLCODE = ZERO                                     02741536
P41579              IF CEPLST-STAT-CDE = 'CA'                           02741636
P41579                  ADD +1 TO PV-CENT-STCK-COUNT                    02741736
P41579                  PERFORM 8000-WRITE-OUTPUT-RECS                  02741836
P41579              ELSE                                                02741936
P41579                  IF CEPLST-STAT-CDE = 'PD'                       02742036
P41579                      MOVE CEPLST-CRE-TMST                        02742136
P41579                                       TO PC-CREATE-TIMESTAMP     02742236
P41579                      IF PC-CREATE-DATE <= PC-PURGE-DATE          02742336
P41579                          ADD +1 TO PV-CENT-STCK-COUNT            02742436
P41579                          PERFORM 8000-WRITE-OUTPUT-RECS          02742536
P41579                      END-IF                                      02742636
P41579                  END-IF                                          02742736
P41579              END-IF                                              02742836
P41579          WHEN SQLCODE = +100                                     02742936
P41579              ADD +1 TO PV-NOT-IN-RCV-AND-CE-COUNT                02743036
P41579              PERFORM 8000-WRITE-OUTPUT-RECS                      02743136
P41579          WHEN SQLWARN0 NOT = SPACES                              02743236
P41579          WHEN SQLCODE < ZERO                                     02743336
P41579          WHEN SQLCODE > ZERO                                     02743436
P41579              MOVE '5100-CHECK-CENT-STCK-TABLES '                 02743536
P41579                              TO PV-PARAGRAPH-NAME                02743636
P41579              MOVE 'SELECT TCEPLST'                               02743736
P41579                              TO PV-DB2-OPERATION-ATTEMPTED       02743836
P41579              PERFORM 9100-SQL-ABEND                              02743936
P41579      END-EVALUATE.                                               02744036
P41579                                                                  02744136
026200******************************************************************02744236
026300*  OPEN THE CURSOR.                                               02744336
026400******************************************************************02744436
026100 4000-OPEN-CURSOR.                                                02744536
026500                                                                  02744636
026600      EXEC SQL                                                    02745000
026700           OPEN PO-DATE-CSR                                       02746000
026800      END-EXEC.                                                   02747000
026900                                                                  02748000
027000      EVALUATE TRUE                                               02749000
028200          WHEN SQLCODE = ZERO                                     02749109
027100          WHEN SQLCODE = -904                                     02749300
027200          WHEN SQLCODE = -911                                     02749400
027300              CONTINUE                                            02749500
027400          WHEN SQLWARN0 NOT = SPACES                              02749600
027500          WHEN SQLCODE < ZERO                                     02749700
027600          WHEN SQLCODE > ZERO                                     02749800
027700              MOVE '4000-OPEN-CURSOR    '                         02749900
027800                              TO PV-PARAGRAPH-NAME                02750000
027900              MOVE 'OPEN THE PO-DATE-CSR '                        02750100
028000                              TO PV-DB2-OPERATION-ATTEMPTED       02750200
028100              PERFORM 9100-SQL-ABEND                              02750300
028400      END-EVALUATE.                                               02750500
028500                                                                  02750600
028700******************************************************************02751000
028800*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         02760000
028900******************************************************************02770000
028600 4100-FETCH-CURSOR.                                               02771000
029000                                                                  02780000
029100     EXEC SQL                                                     02790000
029200          FETCH PO-DATE-CSR                                       02800000
029300           INTO :PCT00007-WRKD-UNT-TMST                           02810000
029400               ,:PCT00007-PO-NBR                                  02820003
029500               ,:PCT00007-RCVR-SEQ-NBR                            02830003
029600     END-EXEC.                                                    02840000
029700                                                                  02850000
029800     EVALUATE TRUE                                                02860000
029900         WHEN SQLCODE = ZERO                                      02870000
030000             ADD +1 TO PV-FETCH-COUNT                             02880002
030000             PERFORM 5000-CHECK-TRECEIV                           02881000
030100         WHEN SQLCODE = +100                                      02890000
030200             SET  PS-END-OF-CURSOR  TO TRUE                       02900009
030400         WHEN SQLWARN0 NOT = SPACES                               02920000
030500         WHEN SQLCODE < ZERO                                      02930000
030600         WHEN SQLCODE > ZERO                                      02940000
030700             MOVE '4100-FETCH-CURSOR  '                           02950000
030800                                 TO PV-PARAGRAPH-NAME             02960000
030900             MOVE 'FETCH THE PO-DATE-CSR '                        02970000
031000                                 TO PV-DB2-OPERATION-ATTEMPTED    02980000
031100             PERFORM 9100-SQL-ABEND                               02990000
031200     END-EVALUATE.                                                03000000
031300                                                                  03010000
031500******************************************************************03030000
031600*  CLOSE THE CURSOR.                                              03040000
031700******************************************************************03050000
031400 4200-CLOSE-CURSOR.                                               03051000
031800      EXEC SQL                                                    03060000
031900          CLOSE PO-DATE-CSR                                       03070000
032000      END-EXEC.                                                   03080000
032100                                                                  03090000
032200      EVALUATE TRUE                                               03100000
033400          WHEN SQLCODE = ZERO                                     03101009
032300          WHEN SQLCODE = -904                                     03110000
032400          WHEN SQLCODE = -911                                     03120000
032500              CONTINUE                                            03130000
032600          WHEN SQLWARN0 NOT = SPACES                              03140000
032700          WHEN SQLCODE < ZERO                                     03150000
032800          WHEN SQLCODE > ZERO                                     03160000
032900              MOVE '4200-CLOSE-CURSOR '                           03170000
033000                              TO PV-PARAGRAPH-NAME                03180000
033100              MOVE 'CLOSE THE PO-DATE-CSR   '                     03190000
033200                              TO PV-DB2-OPERATION-ATTEMPTED       03200000
033300              PERFORM 9100-SQL-ABEND                              03210000
033600      END-EVALUATE.                                               03240000
033700                                                                  03250000
033900******************************************************************03270000
034000*  WRITE THE OUTPUT RECORD                                        03280000
034100******************************************************************03290000
033800 8000-WRITE-OUTPUT-RECS.                                          03291000
034200                                                                  03300000
034300     INITIALIZE  PC021-EXTRACT-RECORD.                            03310000
034400                                                                  03320000
034500     MOVE PCT00007-PO-NBR        TO PC021-PO-NBR.                 03330000
034600     MOVE PCT00007-RCVR-SEQ-NBR  TO PC021-RCVR-NBR.               03340000
035200                                                                  03400000
035300     WRITE EXTRACT-RECORD FROM PC021-EXTRACT-RECORD.              03410000
035500                                                                  03430000
035600     ADD +1 TO PV-WRITE-COUNT.                                    03440002
035700                                                                  03450000
036600******************************************************************03540000
036700*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          03550000
036800******************************************************************03560000
036500 9000-EOJ-ROUTINE.                                                03561000
036900     CLOSE EXTRACT-FILE.                                          03570000
037000     PERFORM 4200-CLOSE-CURSOR.                                   03580000
037100                                                                  03590000
037200     MOVE PV-FETCH-COUNT   TO PV-DISPLAY-COUNT.                   03600002
037300     DISPLAY 'TOTAL RECORDS EXTRACTED ' PV-DISPLAY-COUNT.         03610000
P41579     MOVE PV-TRECEIV-COUNT   TO PV-DISPLAY-COUNT.                 03614025
P41579     DISPLAY 'TRECEIV RECORDS WRITTEN' PV-DISPLAY-COUNT.          03615025
P41579     MOVE PV-CENT-STCK-COUNT TO PV-DISPLAY-COUNT.                 03616025
P41579     DISPLAY 'CENTRAL STOCK RECORDS WRITTEN' PV-DISPLAY-COUNT.    03617025
P41579     MOVE PV-NOT-IN-RCV-AND-CE-COUNT TO PV-DISPLAY-COUNT.         03618027
P41579     DISPLAY 'RECS WRITTEN - NOT IN TRECEIV AND CE DATABASE'      03619027
P41579               PV-DISPLAY-COUNT.                                  03619128
037400     MOVE PV-WRITE-COUNT  TO PV-DISPLAY-COUNT.                    03620002
037500     DISPLAY 'TOTAL RECORDS WRITTEN' PV-DISPLAY-COUNT.            03630000
037600                                                                  03640000
037700                                                                  03650000
037900******************************************************************03670000
038000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03680000
038100*  ERROR OR WARNING CODE OCCURS.                                  03690000
038200******************************************************************03700000
037800 9100-SQL-ABEND.                                                  03701000
038300     DISPLAY '9100-SQL-ABEND'.                                    03710000
038400     DISPLAY '** ABEND     **'.                                   03720000
038500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03730000
038600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03740000
038700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     03750000
038800                                                                  03760000
038900******************************************************************03770000
039000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    03780000
039100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         03790000
039200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     03800000
039300* FORMAT.                                                         03810000
039400******************************************************************03820000
039500     COPY DPPD004.                                                03830000
039600                                                                  03840000
039700     MOVE +4013                  TO ABEND-CODE.                   03850000
039800     CALL 'ILBOABN0' USING ABEND-CODE.                            03860000
