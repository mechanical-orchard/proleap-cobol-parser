000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT119.                                         00050001
000600 AUTHOR.        PATRICK BURKE.                                    00060001
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   JUNE 2006.                                        00080001
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001010*** BEGIN - AHP 01/24/08                                          00101018
001100******************************************************************00110000
001310*                                                                 00131011
001320*  THIS PROGRAM WILL TAKE DATA FROM THE SUT_PRC_MSG_CNTL TABLE    00132011
001330*  AND CREATE OUTPUT DRIVER FILE FOR SUKUP023 (PURGE PROGRAM).    00133011
001340*                                                                 00134011
001400******************************************************************00140000
001410*** END   - AHP 01/24/08                                          00141018
001600******************************************************************00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900                                                                  00190000
002000 CONFIGURATION SECTION.                                           00200000
002100                                                                  00210000
002200 SOURCE-COMPUTER.        IBM-3090.                                00220000
002300 OBJECT-COMPUTER.        IBM-3090.                                00230000
002400                                                                  00240000
002500 INPUT-OUTPUT SECTION.                                            00250000
002600                                                                  00260000
002700 FILE-CONTROL.                                                    00270000
002900                                                                  00290000
003000     SELECT INPUT-FILE                                            00300004
003100         ASSIGN TO INP01.                                         00310004
003200                                                                  00320000
003210     SELECT EXTRACT-FILE                                          00321004
003220         ASSIGN TO OUT01.                                         00322004
003230                                                                  00323004
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003700 FILE SECTION.                                                    00370000
003800                                                                  00380000
003900 FD  INPUT-FILE                                                   00390004
004000     RECORDING MODE IS F                                          00400000
004100     LABEL RECORDS ARE STANDARD                                   00410000
004200     BLOCK CONTAINS 0 RECORDS.                                    00420000
004400 01  INPUT-REC                  PIC  X(50).                       00440007
004500                                                                  00450000
004510 FD  EXTRACT-FILE                                                 00451004
004520     RECORDING MODE IS F                                          00452004
004530     LABEL RECORDS ARE STANDARD                                   00453004
004540     BLOCK CONTAINS 0 RECORDS.                                    00454004
004550 01  EXTRACT-REC                 PIC X(50).                       00455004
004560                                                                  00456004
004600*                                                                 00460000
004700******************************************************************00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900******************************************************************00490000
005000*                                                                 00500000
005300******************************************************************00530000
005400*  DB2 FORMATTED MESSAGE AREA                                     00540000
005500******************************************************************00550000
005600     COPY DPWS004.                                                00560000
005700*                                                                 00570000
005710******************************************************************00571006
005720*  COPYBOOK                                                       00572006
005730******************************************************************00573006
005740     COPY SURD073.                                                00574006
005750*                                                                 00575006
005800******************************************************************00580000
005900*  COMMUNICATIONS AREA FOR DB2                                    00590000
006000******************************************************************00600000
006100     EXEC SQL                                                     00610000
006200          INCLUDE SQLCA                                           00620000
006300     END-EXEC.                                                    00630000
007200*                                                                 00720000
007210******************************************************************00721004
007220*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE RECEIVER TABLE     00722004
007240******************************************************************00724004
007250     EXEC SQL                                                     00725004
007260          INCLUDE TRECEIV                                         00726004
007270     END-EXEC.                                                    00727004
007280*                                                                 00728004
007281******************************************************************00728105
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PARM TABLE         00728205
007283******************************************************************00728305
007284     EXEC SQL                                                     00728405
007285          INCLUDE TKRPRPM                                         00728505
007286     END-EXEC.                                                    00728605
007287*                                                                 00728705
007290******************************************************************00729004
007300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00730000
007400                                                   COMP SYNC.     00740000
007500                                                                  00750000
007600 01  PS-PROGRAM-SWITCHES.                                         00760000
008000     05  PS-END-OF-INPUT-FILE-SW      PIC X(01) VALUE 'N'.        00800003
008100         88  PS-END-OF-INPUT                    VALUE 'Y'.        00810003
008200         88  PS-NOT-END-OF-INPUT                VALUE 'N'.        00820003
008210     05  PS-PO-FOUND-SW               PIC X(01) VALUE 'N'.        00821009
008220         88  PS-PO-NOT-FOUND                    VALUE 'Y'.        00822009
008230         88  PS-PO-FOUND                        VALUE 'N'.        00823009
008300                                                                  00830000
008400 01  PC-PROGRAM-CONSTANTS.                                        00840000
008700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00870000
008800         'SUKUT119'.                                              00880001
008900                                                                  00890000
009000 01  PV-PROGRAM-VARIABLES.                                        00900000
009030                                                                  00903013
009100     05  PV-READ-COUNT               PIC S9(04)    VALUE ZERO     00910005
009200                                                   COMP SYNC.     00920000
009300     05  PV-RECEIV-STAT-CDE-DE       PIC S9(04)    VALUE ZERO     00930005
009400                                                   COMP SYNC.     00940000
009410     05  PV-RECEIV-STAT-CDE-VE       PIC S9(04)    VALUE ZERO     00941005
009420                                                   COMP SYNC.     00942005
009500     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     00950000
009600                                                   COMP SYNC.     00960000
009700     05  PV-NOT-PURGE                PIC S9(09)    VALUE ZERO     00970010
009800                                                   COMP SYNC.     00980010
009900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00990000
010000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01000000
010100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01010000
010200                                                                  01020000
010300     05  PV-FUNC-TIMESTAMP           PIC  X(26)    VALUE SPACES.  01030005
010310     05  PV-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01031005
010400     05  PV-PO-NBR                   PIC S9(09)    COMP.          01040005
010500     05  PV-RCVR-SEQ-NBR             PIC S9(09)    COMP.          01050005
013600                                                                  01360005
013700                                                                  01370000
013800 PROCEDURE DIVISION.                                              01380000
013900******************************************************************01390000
014000 0000-PROGRAM-MAINLINE.                                           01400000
014100******************************************************************01410000
014200*                                                                 01420000
014400     PERFORM 1000-INITIALIZE.                                     01440000
014500                                                                  01450000
015210     PERFORM 2000-PROCESS                                         01521003
015220         UNTIL PS-END-OF-INPUT.                                   01522003
015300                                                                  01530000
015400     PERFORM 9000-EOJ-ROUTINE.                                    01540000
015401                                                                  01540107
015410      GOBACK.                                                     01541007
015500/                                                                 01550000
015600******************************************************************01560000
015700 1000-INITIALIZE.                                                 01570000
015800******************************************************************01580000
015801                                                                  01580102
015820     OPEN INPUT  INPUT-FILE.                                      01582004
015900     OPEN OUTPUT EXTRACT-FILE.                                    01590004
016200                                                                  01620000
016201*** BEGIN - AHP 01/24/08                                          01620118
016202     PERFORM 2300-SELECT-TKRPRPM                                  01620211
016203*** END   - AHP 01/24/08                                          01620318
016204                                                                  01620411
016210     PERFORM 2100-READ-EXTRACT.                                   01621002
016300/                                                                 01630000
016400******************************************************************01640000
016500 2000-PROCESS.                                                    01650002
016600******************************************************************01660000
017200                                                                  01720000
017400     PERFORM 3000-SELECT-TRECEIV.                                 01740005
017410     IF PS-PO-NOT-FOUND                                           01741009
017421        PERFORM 7000-WRITE-EXTRACT                                01742109
017430     ELSE                                                         01743009
017500        PERFORM 2200-CHECK-STATUS-CDE                             01750009
017600     END-IF.                                                      01760009
018800                                                                  01880000
019200     PERFORM 2100-READ-EXTRACT.                                   01920002
019300/                                                                 01930000
019310******************************************************************01931002
019320*  READ NEXT INPUT FILE RECORD.                                   01932002
019330******************************************************************01933002
019340 2100-READ-EXTRACT.                                               01934002
019350                                                                  01935002
019360     READ INPUT-FILE INTO SU073-EXTRACT-RECORD                    01936006
019370        AT END                                                    01937002
019380           SET PS-END-OF-INPUT TO TRUE                            01938002
019390        NOT AT END                                                01939002
019391           MOVE SU073-PO-NBR       TO PV-PO-NBR                   01939106
019392           MOVE SU073-REC-SEQ-NBR  TO PV-RCVR-SEQ-NBR             01939206
019393           ADD +1                  TO PV-READ-COUNT               01939306
019394     END-READ.                                                    01939405
019395*                                                                 01939505
019396******************************************************************01939605
019397 2200-CHECK-STATUS-CDE.                                           01939705
019398******************************************************************01939805
019399                                                                  01939905
019400     EVALUATE TRUE                                                01940005
019401         WHEN RECEIV-STATUS-CDE   =  'DE'                         01940105
019402             PERFORM 7000-WRITE-EXTRACT                           01940205
019403             ADD +1           TO PV-RECEIV-STAT-CDE-DE            01940305
019404                                                                  01940405
019405         WHEN RECEIV-STATUS-CDE   =  'VE'                         01940505
019406*** BEGIN - AHP 01/24/08                                          01940618
019407             IF RECEIV-VERFYD-TMST < PV-FUNC-TIMESTAMP            01940711
019408*** END   - AHP 01/24/08                                          01940818
019409                 PERFORM 7000-WRITE-EXTRACT                       01940905
019410                 ADD +1       TO PV-RECEIV-STAT-CDE-VE            01941005
019411             ELSE                                                 01941110
019412                 ADD +1       TO PV-NOT-PURGE                     01941210
019413             END-IF                                               01941305
019414                                                                  01941410
019415         WHEN OTHER                                               01941510
019416                 ADD +1       TO PV-NOT-PURGE                     01941610
019417                                                                  01941705
019418     END-EVALUATE.                                                01941805
019419*                                                                 01941905
019420******************************************************************01942005
019421 2300-SELECT-TKRPRPM.                                             01942105
019422                                                                  01942205
019423     EXEC SQL                                                     01942305
019424         SELECT CURRENT TIMESTAMP - FUNC_QTY DAYS                 01942419
019427               ,CURRENT TIMESTAMP                                 01942712
019428           INTO   :PV-FUNC-TIMESTAMP                              01942812
019429                 ,:PV-CURRENT-TIMESTAMP                           01942912
019430           FROM  TKRPRPM                                          01943012
019431          WHERE LOC_ID            =  90                           01943112
019432            AND INTFC_SYS_CDE     = 'KHL'                         01943212
019433            AND SYS_PRC_FUNC_CDE  = 'PMSGPG'                      01943312
019434            AND FUNC_PRC_STAT_CDE = 'AC'                          01943412
019435      END-EXEC.                                                   01943512
019436                                                                  01943612
019437       EVALUATE TRUE                                              01943712
019438         WHEN SQLCODE = +0                                        01943812
019439              CONTINUE                                            01943912
019440         WHEN SQLCODE = +100                                      01944012
019441         WHEN SQLWARN0 NOT = SPACE                                01944112
019442         WHEN SQLCODE < ZERO                                      01944212
019443         WHEN SQLCODE > ZERO                                      01944312
019444             MOVE '1200-SELECT-TKRPRPM '                          01944412
019445                                 TO PV-PARAGRAPH-NAME             01944512
019446             MOVE 'SELECT PARM VALUE FOR DELETES  '               01944612
019447                                 TO PV-DB2-OPERATION-ATTEMPTED    01944712
019448             PERFORM 9100-SQL-ABEND                               01944812
019449      END-EVALUATE.                                               01944912
019450                                                                  01945012
019451*----------------------------------------------------------------*01945112
019452*  CHECK STATUS CODE.                                            *01945212
019453*----------------------------------------------------------------*01945312
019454 3000-SELECT-TRECEIV.                                             01945412
019455                                                                  01945505
019456      EXEC SQL                                                    01945605
019457          SELECT STATUS_CDE                                       01945705
019458*** BEGIN - AHP 01/24/08                                          01945818
019459                ,VERFYD_TMST                                      01945911
019460            INTO  :RECEIV-STATUS-CDE                              01946005
019461                 ,:RECEIV-VERFYD-TMST                             01946111
019462*** END   - AHP 01/24/08                                          01946218
019463            FROM    TRECEIV                                       01946305
019464           WHERE   ORD_NBR        = :PV-PO-NBR                    01946405
019465             AND   REC_SEQ_NBR    = :PV-RCVR-SEQ-NBR              01946505
019466      END-EXEC                                                    01946605
019467                                                                  01946705
019468      EVALUATE TRUE                                               01946805
019469         WHEN SQLCODE = ZERO                                      01946905
019470             SET PS-PO-FOUND          TO TRUE                     01947009
019471         WHEN SQLCODE = +100                                      01947105
019472             SET PS-PO-NOT-FOUND      TO TRUE                     01947209
019473         WHEN SQLWARN0 NOT = SPACE                                01947305
019474         WHEN SQLCODE < ZERO                                      01947405
019475         WHEN SQLCODE > ZERO                                      01947505
019476             MOVE '3000-CHECK-STATUS-CDE'                         01947605
019477                                 TO PV-PARAGRAPH-NAME             01947705
019478             MOVE 'SELECT TRECEIV STATUS CODE  '                  01947805
019479                                 TO PV-DB2-OPERATION-ATTEMPTED    01947905
019480             PERFORM 9100-SQL-ABEND                               01948005
019490      END-EVALUATE.                                               01949005
019492*                                                                 01949205
019493******************************************************************01949300
019500 7000-WRITE-EXTRACT.                                              01950004
019600******************************************************************01960000
019700                                                                  01970000
019900      WRITE EXTRACT-REC                                           01990004
020000          FROM SU073-EXTRACT-RECORD                               02000006
020100      ADD +1 TO PV-WRITE-COUNTER.                                 02010000
020300/                                                                 02030000
036500******************************************************************03650000
036600 9000-EOJ-ROUTINE.                                                03660000
036700******************************************************************03670000
036800                                                                  03680000
036900     DISPLAY ' EXTRACTS WRITTEN FOR PURGE = ' PV-WRITE-COUNTER    03690010
036910     DISPLAY ' EXTRACTS NOT WRITTEN FOR PURGE = ' PV-NOT-PURGE.   03691010
037000                                                                  03700000
037100     CLOSE INPUT-FILE.                                            03710007
037200     CLOSE EXTRACT-FILE.                                          03720007
037400/                                                                 03740000
037500******************************************************************03750000
037600 9100-SQL-ABEND.                                                  03760000
037700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03770000
037800*  ERROR OR WARNING CODE OCCURS.                                  03780000
037900******************************************************************03790000
038000     DISPLAY '9100-SQL-ABEND'.                                    03800000
038100     DISPLAY '** ABEND     **'.                                   03810000
038200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03820000
038300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03830000
038400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     03840000
038500                                                                  03850000
038600*    ABEND COPYBOOK                                               03860000
038700     COPY DPPD004.                                                03870000
038800                                                                  03880000
038900     MOVE +4013                  TO ABEND-CODE.                   03890000
039000     CALL 'ILBOABN0' USING ABEND-CODE.                            03900000
039100/                                                                 03910000
