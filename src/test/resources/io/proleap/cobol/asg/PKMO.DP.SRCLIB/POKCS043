000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    POKCS043.                                         00040001
000500 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  08/93.                                            00070001
000800 DATE-COMPILED.                                                   00080001
000900*----------------------------------------------------------------*00090001
001000*    W043 - PO PRINT REQUEST                                     *00100001
001100*                                                                *00110001
001200*    THIS PROGRAM ALLOWS THE USER TO REQUEST A PO PRINT.         *00120001
001201*                                                                *00120105
001210*CHANGE HISTORY:                                                  00121002
001220* WR/PROJ  DATE        DESCRIPTION OF CHANGES                     00122002
001230* -------  ----------  ----------------------------------------   00123002
001240* CR7896   08-01-2011  CHANGED TO FIX UNWANTED ' IN THE BUYER NAME00124004
001250*                      FIELD. WHEN BUYER NAME CONTAINS ' IN IT,   00125002
001260*                      THE JCL CREATED DYNAMICALLY WILL FAIL WITH 00126002
001270*                      JCL ERROR. HERE ' WILL BE REPLACED WITH _  00127002
001280*                      CHANGED PARA 7200-GET-BUYER-NAME           00128003
001281*                                                                 00128102
001282*                      EXAMPLE:                                   00128202
001290*                      --------                                   00129002
001291*                      NAME='STEVE O'BRIEN            ',          00129102
001292*                         WILL BE REPLACED WITH                   00129202
001293*                      NAME='STEVE O_BRIEN            ',          00129302
001294*                                                                 00129402
001295*                      - COGNIZANT (KARTHIK KRISHNA K)            00129502
001296*                                                           *     00129605
001310*-----------------------------------------------------------*     00129707
001297* DATE  20/14/2014                                          *     00129805
001298*      RECOMPILED THE PROGRAM. CHANGES WERE MADE TO         *     00129905
001299*      MAP POKM043 TO CHANGE PO NUMBER FROM 7 TO 8 DIGITS.  *     00130005
001300*      MADE BY: COGNIZANT              WR/IR: CHG0098147    *     00130106
001296*                                                           *     00130207
001310*-----------------------------------------------------------*     00130307
001297* CHANGED 11/11/2022    BY BARB SCHULTZ    WR: CHG0278485   *     00130408
001298*                                                           *     00130507
001299* ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL*     00130607
001299* DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API. *     00130707
001310*-----------------------------------------------------------*     00131007
001400                                                                  00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600                                                                  00160001
001700 DATA DIVISION.                                                   00170001
001800                                                                  00180001
001900 WORKING-STORAGE SECTION.                                         00190001
002000                                                                  00200001
002100 01  PC-PROGRAM-CONSTANTS.                                        00210001
002200     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'POKCS043'.  00220001
002300     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PO043A  '.  00230001
002400     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'POKM043 '.  00240001
002500     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00250001
002600                                              COMP.               00260001
002700     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00270001
002800                                              COMP.               00280001
002900     05  PC-TSYMSG-NUMBERS.                                       00290001
003000         10  PC-TSYMSG-00083      PIC  9(05)  VALUE  00083.       00300001
003100         10  PC-TSYMSG-00271      PIC  9(05)  VALUE  00271.       00310001
003200         10  PC-TSYMSG-00330      PIC  9(05)  VALUE  00330.       00320001
003300         10  PC-TSYMSG-00368      PIC  9(05)  VALUE  00368.       00330001
003400         10  PC-TSYMSG-00458      PIC  9(05)  VALUE  00458.       00340001
003500         10  PC-TSYMSG-00582      PIC  9(05)  VALUE  00582.       00350001
003600         10  PC-TSYMSG-00753      PIC  9(05)  VALUE  00753.       00360001
003700         10  PC-TSYMSG-00754      PIC  9(05)  VALUE  00754.       00370001
003800         10  PC-TSYMSG-00984      PIC  9(05)  VALUE  00984.       00380001
003810         10  PC-TSYMSG-02774      PIC  9(05)  VALUE  02774.       00381001
003820     05  PC-PROD-JOB-POK901       PIC  X(08)  VALUE  'POK901  '.  00382001
003830     05  PC-PROD-JOB-POK902       PIC  X(08)  VALUE  'POK902  '.  00383001
003840     05  PC-PROD-CLASS.                                           00384001
003850         10  FILLER               PIC  X(36)  VALUE               00385001
003860         '//      CLASS=Q,MSGCLASS=P,REGION=3M'.                  00386001
003870         10  FILLER               PIC  X(44)  VALUE  SPACES.      00387001
003880     05  PC-PROD-LIBSRCH.                                         00388001
003890         10  FILLLER              PIC  X(40)  VALUE               00389001
003900         '//*                                     '.              00390001
004000     05  PC-PROD-JOB-PARM.                                        00400001
004100         10  FILLER               PIC  X(03)  VALUE  '//*'.       00410001
004200         10  FILLER               PIC  X(77)  VALUE  SPACES.      00420001
004300     05  PC-PROD-JOBLIB.                                          00430001
004400         10  FILLER               PIC  X(39)  VALUE               00440001
004500         '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.               00450001
004600         10  FILLER               PIC  X(41)  VALUE  SPACES.      00460001
004700     05  PC-PROD-JOBOUT1A.                                        00470001
004800         10  FILLER               PIC  X(48)  VALUE               00480001
004900         '//JOBOUT02 OUTPUT FORMDEF=L1D1PO,PAGEDEF=L1D1PO,'.      00490001
005000         10  FILLER               PIC  X(32)  VALUE  SPACES.      00500001
005100     05  PC-PROD-JOBOUT1B.                                        00510001
005200         10  FILLER               PIC  X(48)  VALUE               00520001
005300         '//JOBOUT02 OUTPUT FORMDEF=L1S4PO,PAGEDEF=L1S4PO,'.      00530001
005400         10  FILLER               PIC  X(32)  VALUE  SPACES.      00540001
005500     05  PC-PROD-JOBOUT2.                                         00550001
005600         10  FILLER               PIC  X(41)  VALUE               00560001
005700         '//         USERLIB=(SYS2.AFPTEST.FDEFLIB,'.             00570001
005800         10  FILLER               PIC  X(39)  VALUE               00580001
005900         'SYS2.AFPTEST.PDEFLIB),                 '.               00590001
006000     05  PC-PROD-JOBOUT3.                                         00600001
006100         10  FILLER               PIC  X(16)  VALUE               00610001
006200         '//         NAME='.                                      00620001
006300         10  FILLER               PIC  X(01)  VALUE  QUOTE.       00630001
006400         10  PV-PROD-BYR-NAME     PIC  X(25).                     00640001
006500         10  FILLER               PIC  X(01)  VALUE  QUOTE.       00650001
006600         10  FILLER               PIC  X(01)  VALUE  ','.         00660001
006700         10  FILLER               PIC  X(36)  VALUE  SPACES.      00670001
006800     05  PC-PROD-JOBOUT4.                                         00680001
006900         10  FILLER               PIC  X(19)  VALUE               00690001
007000         '//         ADDRESS='.                                   00700001
007100         10  FILLER               PIC  X(01)  VALUE  QUOTE.       00710001
007200         10  PV-PROD-BYR-NAME-NO  PIC  X(32).                     00720001
007300         10  FILLER               PIC  X(01)  VALUE  QUOTE.       00730001
007400         10  FILLER               PIC  X(27)  VALUE  SPACES.      00740001
007500     05  PC-PROD-PROC-PO.                                         00750001
007600         10  FILLER               PIC  X(30)  VALUE               00760001
007700         '//PS010    EXEC POK9011,SOPT=0'.                        00770001
007800         10  FILLER               PIC  X(50)  VALUE  SPACES.      00780001
007900     05  PC-PROD-PROC-PO-PK.                                      00790001
008000         10  FILLER               PIC  X(30)  VALUE               00800001
008100         '//PS010    EXEC POK9011,SOPT=1'.                        00810001
008200         10  FILLER               PIC  X(50)  VALUE  SPACES.      00820001
008300     05  PC-PROD-PROC-SI.                                         00830001
008400         10  FILLER               PIC  X(30)  VALUE               00840001
008500         '//PS010    EXEC POK9021,SOPT=0'.                        00850001
008600         10  FILLER               PIC  X(50)  VALUE  SPACES.      00860001
008700     05  PC-PROD-PROC-SI-PK.                                      00870001
008800         10  FILLER               PIC  X(30)  VALUE               00880001
008900         '//PS010    EXEC POK9021,SOPT=1'.                        00890001
009000         10  FILLER               PIC  X(50)  VALUE  SPACES.      00900001
009100***********************************************************       00910001
009200*       JCL FOR CICST1 SUBMITS                                    00920001
009300***********************************************************       00930001
009400     05  PC-TEST-CLASS.                                           00940001
009500         10  FILLER               PIC  X(44)  VALUE               00950001
009600         '//      CLASS=A,MSGCLASS=X,REGION=3M,NOTIFY='.          00960001
009700         10  PC-TEST-NOTIFY-ID    PIC  X(07).                     00970001
009800         10  FILLER               PIC  X(29)  VALUE SPACES.       00980001
009900*        ',TYPRUN=HOLD                 '.                         00990001
010000     05  PC-TEST-LIBSRCH.                                         01000001
010100         10  FILLER               PIC  X(40)  VALUE               01010001
010200         '//LIBSRCH  JCLLIB ORDER=TKMA.PROCLIB    '.              01020001
010300         10  FILLER               PIC  X(40)  VALUE  SPACES.      01030001
010400     05  PC-TEST-JOB-PARM.                                        01040001
010500         10  FILLER               PIC  X(18)  VALUE               01050001
010600         '/*JOBPARM P=PROC01'.                                    01060001
010700         10  FILLER               PIC  X(62)  VALUE  SPACES.      01070001
010800     05  PC-TEST-JOBLIB.                                          01080001
010900         10  FILLER               PIC  X(39)  VALUE               01090001
011000         '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.               01100001
011100         10  FILLER               PIC  X(41)  VALUE  SPACES.      01110001
011200     05  PC-TEST-JOBOUT1.                                         01120001
011300         10  FILLER               PIC  X(45)  VALUE               01130001
011400         '//JOBOUT02 OUTPUT CLASS=L,FORMS=8050,COPIES=1'.         01140001
011500         10  FILLER               PIC  X(35)  VALUE  SPACES.      01150001
011600     05  PC-TEST-JOBOUT2A.                                        01160001
011700         10  FILLER               PIC  X(48)  VALUE               01170001
011800         '//JOBOUT02 OUTPUT FORMDEF=L1D1PO,PAGEDEF=L1D1PO,'.      01180001
011900         10  FILLER               PIC  X(32)  VALUE  SPACES.      01190001
012000     05  PC-TEST-JOBOUT2AA.                                       01200001
012100         10  FILLER               PIC  X(48)  VALUE               01210001
012200         '//JOBOUT02 OUTPUT FORMDEF=L1S009,PAGEDEF=L1S009,'.      01220001
012300         10  FILLER               PIC  X(32)  VALUE  SPACES.      01230001
012400     05  PC-TEST-JOBOUT2B.                                        01240001
012500         10  FILLER               PIC  X(41)  VALUE               01250001
012600         '//         USERLIB=(SYS2.AFPTEST.FDEFLIB,'.             01260001
012700         10  FILLER               PIC  X(39)  VALUE               01270001
012800         'SYS2.AFPTEST.PDEFLIB)                  '.               01280001
012900     05  PC-TEST-JOBOUT2C.                                        01290001
013000         10  FILLER               PIC  X(39)  VALUE               01300001
013100         '//         CLASS=A,FORMS=STD,DEST=U4001'.               01310001
013200         10  FILLER               PIC  X(32)  VALUE  SPACES.      01320001
013300     05  PC-TEST-JOBOUT3.                                         01330001
013400         10  FILLER               PIC  X(03)  VALUE  '//*'.       01340001
013500         10  FILLER               PIC  X(77)  VALUE  SPACES.      01350001
013600     05  PC-TEST-PROC-PO.                                         01360001
013700         10  FILLER               PIC  X(30)  VALUE               01370001
013800         '//PS010   EXEC POK9011T,SOPT=0'.                        01380001
013900         10  FILLER               PIC  X(50)  VALUE  SPACES.      01390001
014000     05  PC-TEST-PROC-PO-PK.                                      01400001
014100         10  FILLER               PIC  X(30)  VALUE               01410001
014200         '//PS010   EXEC POK9011T,SOPT=1'.                        01420001
014300         10  FILLER               PIC  X(50)  VALUE  SPACES.      01430001
014400     05  PC-TEST-PROC-SI.                                         01440001
014500         10  FILLER               PIC  X(30)  VALUE               01450001
014600         '//PS010   EXEC POK9021T,SOPT=0'.                        01460001
014700         10  FILLER               PIC  X(50)  VALUE  SPACES.      01470001
014800     05  PC-TEST-PROC-SI-PK.                                      01480001
014900         10  FILLER               PIC  X(30)  VALUE               01490001
015000         '//PS010   EXEC POK9021T,SOPT=1'.                        01500001
015100         10  FILLER               PIC  X(50)  VALUE  SPACES.      01510001
015200*                                                                 01520001
015300 01  PS-PROGRAM-SWITCHES.                                         01530001
015400     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01540001
015500         88  PS-ERROR                         VALUE  'Y'.         01550001
015600         88  PS-NO-ERROR                      VALUE  'N'.         01560001
015700*                                                                 01570001
015800 01  PV-PROGRAM-VARIABLES.                                        01580001
015900     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01590001
016000                                              COMP SYNC.          01600001
016100     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01610001
016200                                              COMP SYNC.          01620001
016300     05  PV-DB2-COUNT1            PIC S9(04)  VALUE +0            01630001
016400                                              COMP SYNC.          01640001
016500     05  PV-DB2-COUNT2            PIC S9(04)  VALUE +0            01650001
016600                                              COMP SYNC.          01660001
016700     05  PV-RV-COUNT              PIC S9(04)  VALUE +0            01670001
016800                                              COMP.               01680001
016900     05  PV-SYSTEM-ID             PIC  X(04)  VALUE SPACES.       01690001
017000         88  PV-CIT1-CICS                     VALUE 'CIT1'.       01700001
017100         88  PV-CIQA-CICS                     VALUE 'CIQA'.       01710001
017200     05  PV-USER-ID               PIC  X(08)  VALUE SPACES.       01720001
017300     05  PV-TEST-JOB.                                             01730001
017400         10  PV-TEST-JOB-USER-ID  PIC  X(07).                     01740001
017500         10  FILLER               PIC  X(01)  VALUE 'T'.          01750001
017600                                                                  01760001
017700     05  PV-BUYER-NAME            PIC  X(25).                     01770001
017800     05  PV-BUYER-NUMBER          PIC  X(03).                     01780001
017900     05  PV-BUYER.                                                01790001
018000         10  FILLER               PIC  X(01)  VALUE 'B'.          01800001
018100         10  PV-BYR-NBR           PIC  X(03).                     01810001
018200         10  FILLER               PIC  X(03)  VALUE '   '.        01820001
018300         10  PV-BYR-NAME          PIC  X(25).                     01830001
018400                                                                  01840001
018500 01  TD-TRANSIENT-DATE-AREA.                                      01850001
018600     05  TD-QUEUE-NAME            PIC  X(04)  VALUE 'IRTD'.       01860001
018700     05  TD-JCL-LINE              PIC  X(80)  VALUE SPACES.       01870001
018800     05  TD-JCL-LINE-LENGTH       PIC S9(04)  VALUE +80           01880001
018900                                              COMP SYNC.          01890001
019000     05  TD-Q-NAME-LENGTH         PIC S9(04)  VALUE +4            01900001
019100                                              COMP SYNC.          01910001
019200                                                                  01920001
019300 01  JL-JCL-LINE-AREA.                                            01930001
019400     05  JL-JCL-LINE-1.                                           01940001
019500         10  FILLER               PIC  X(02)  VALUE '//'.         01950001
019600         10  JL-JOB-NAME          PIC  X(08).                     01960001
019700         10  FILLER               PIC  X(11)  VALUE               01970001
019800         ' JOB KOHLS,'.                                           01980001
019900         10  FILLER               PIC  X(01)  VALUE QUOTE.        01990001
020000         10  FILLER               PIC  X(08)  VALUE               02000001
020100         'PO PRINT'.                                              02010001
020200         10  FILLER               PIC  X(01)  VALUE QUOTE.        02020001
020300         10  FILLER               PIC  X(01)  VALUE ','.          02030001
020400         10  FILLER               PIC  X(48)  VALUE SPACES.       02040001
020500     05  JL-JCL-LINE-2.                                           02050001
020600         10  JL-JCL-CLASS         PIC  X(80).                     02060001
020700********************************************************          02070001
020800*   LINE-2T IS USED WHEN TESTING A PROC IN TKMA.PROCLIB           02080001
020900********************************************************          02090001
021000     05  JL-JCL-LINE-2T.                                          02100001
021100         10  JL-JCL-LIBSRCH       PIC  X(80).                     02110001
021200     05  JL-JCL-LINE-3.                                           02120001
021300         10  JL-JCL-JOB-PARM      PIC  X(80).                     02130001
021400     05  JL-JCL-LINE-4.                                           02140001
021500         10  FILLER               PIC  X(40)  VALUE               02150001
021600         '//**************************************'.              02160001
021700         10  FILLER               PIC  X(40)  VALUE               02170001
021800         '****************************************'.              02180001
021900     05  JL-JCL-LINE-5.                                           02190001
022000         10  FILLER               PIC  X(40)  VALUE               02200001
022100         '//**   JOB WILL PRODUCE HARDCOPY PURCHAS'.              02210001
022200         10  FILLER               PIC  X(40)  VALUE               02220001
022300         'E ORDER FROM THE PO SYSTEM              '.              02230001
022400     05  JL-JCL-LINE-6.                                           02240001
022500         10  FILLER               PIC  X(40)  VALUE               02250001
022600         '//**************************************'.              02260001
022700         10  FILLER               PIC  X(40)  VALUE               02270001
022800         '****************************************'.              02280001
022900     05  JL-JCL-LINE-7.                                           02290001
023000         10  JL-JCL-JOBLIB        PIC  X(80).                     02300001
023100     05  JL-JCL-LINE-8.                                           02310001
023200         10  JL-JCL-OUTPUT1       PIC  X(80).                     02320001
023300     05  JL-JCL-LINE-9.                                           02330001
023400         10  JL-JCL-OUTPUT2       PIC  X(80).                     02340001
023500     05  JL-JCL-LINE-10.                                          02350001
023600         10  JL-JCL-OUTPUT3       PIC  X(80).                     02360001
023700     05  JL-JCL-LINE-11.                                          02370001
023800         10  JL-JCL-OUTPUT4       PIC  X(80).                     02380001
023900     05  JL-JCL-LINE-12.                                          02390001
024000         10  JL-JCL-PROC          PIC  X(80).                     02400001
024100     05  JL-JCL-LINE-13.                                          02410001
024200         10  FILLER               PIC  X(21)  VALUE               02420001
024300         '//S010.SYSUT1   DD * '.                                 02430001
024400         10  FILLER               PIC  X(59)  VALUE SPACES.       02440001
024500     05  JL-JCL-LINE-14.                                          02450001
024600         10  JL-PO-NBR            PIC S9(09)  COMP.               02460001
024700         10  JL-PRINT-TYPE-BY     PIC  X(02).                     02470001
024800         10  JL-PRINT-TYPE-VN     PIC  X(02).                     02480001
024900         10  JL-PRINT-TYPE-DC     PIC  X(02).                     02490001
025000         10  JL-PRINT-TYPE-AN     PIC  X(02).                     02500001
025100         10  FILLER               PIC  X(68)  VALUE SPACES.       02510001
025200     05  JL-JCL-LINE-15.                                          02520001
025300         10  FILLER               PIC  X(02)  VALUE '/*'.         02530001
025400         10  FILLER               PIC  X(78)  VALUE SPACES.       02540001
025500     05  JL-JCL-LINE-16.                                          02550001
025600         10  FILLER               PIC  X(03)  VALUE '//*'.        02560001
025700         10  FILLER               PIC  X(77)  VALUE SPACES.       02570001
025800     05  JL-JCL-LINE-EOF.                                         02580001
025900         10  FILLER               PIC  X(05)  VALUE '/*EOF'.      02590001
026000         10  FILLER               PIC  X(75)  VALUE SPACES.       02600001
026100 01  JL-JCL-LINE-TABLE            REDEFINES JL-JCL-LINE-AREA.     02610001
026200     05  JL-JCL-LINE              OCCURS 18 TIMES                 02620001
026300                                  INDEXED BY JL-LINE-INDEX        02630001
026400                                  PIC X(80).                      02640001
026500     EJECT                                                        02650001
026600*----------------------------------------------------------------*02660001
026700*    MAP LAYOUT                                                  *02670001
026800*----------------------------------------------------------------*02680001
026900                                                                  02690001
027000     COPY POKM043.                                                02700001
027100                                                                  02710001
027200 EJECT                                                            02720001
027300*----------------------------------------------------------------*02730001
027400*    ATTRIBUTE SETTINGS COPYBOOK.                                *02740001
027500*----------------------------------------------------------------*02750001
027600                                                                  02760001
027700     COPY DPWS015.                                                02770001
027800                                                                  02780001
027900*----------------------------------------------------------------*02790001
028000*    FUNCTION KEYS COPYBOOK                                      *02800001
028100*----------------------------------------------------------------*02810001
028200                                                                  02820001
028300     COPY DPWS016.                                                02830001
028400                                                                  02840001
028500**--------------------------------------------------------------**02850001
CICS  ** PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            **02860009
028700**--------------------------------------------------------------**02870001
028800                                                                  02880001
028900     COPY DPWS030.                                                02890001
CICS       COPY DPWS930.                                                02891007
029000                                                                  02900001
029100 EJECT                                                            02910001
029200**--------------------------------------------------------------**02920001
029300*    STANDARD COMMAREA.                                           02930001
029400**--------------------------------------------------------------**02940001
029500                                                                  02950001
029600     COPY DPWS020.                                                02960001
029700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02970001
029800                                                                  02980001
029900***************************************************************** 02990001
030000*    INTER-APPLICATION COMMAREA.                                  03000001
030100***************************************************************** 03010001
030200                                                                  03020001
030300         10  INTER-APPL-COMM-AREA PIC X(200).                     03030001
030400     COPY POWS011.                                                03040001
030500***************************************************************** 03050001
030600*    SPECIFIC COMMMAREA FOR POKCS043.                             03060001
030700***************************************************************** 03070001
030800         10  ASC-SPECIFIC-COMMAREA.                               03080001
030900             15  ASC-PO-NBR                PIC S9(09)  COMP.      03090001
031000             15  ASC-DPT-NBR               PIC  X(03).            03100001
031100             15  ASC-ENT-NAME-DESC         PIC  X(30).            03110001
031200             15  ASC-TOT-SKUS-QTY          PIC S9(04)  COMP.      03120001
031300             15  ASC-STATUS-CDE            PIC  X(02).            03130001
031400             15  ASC-RLSE-IND              PIC  X(01).            03140001
031500             15  ASC-BUY-IND               PIC  X(01).            03150001
031600             15  ASC-DC-IND                PIC  X(01).            03160001
031700             15  ASC-VEND-IND              PIC  X(01).            03170001
031800             15  ASC-SUP-RETAIL            PIC  X(01).            03180001
031900         15  ASC-UNCONFIRMED-PACKS-SWITCH  PIC  X(01).            03190001
032000             88  ASC-UNCONFIRMED-PACKS          VALUE  'Y'.       03200001
032100             88  ASC-NO-UNCONFIRMED-PACKS       VALUE  'N'.       03210001
032200     EJECT                                                        03220001
032300*----------------------------------------------------------------*03230001
032400*    ABEND PROCESSING COPYBOOK.                                  *03240001
032500*----------------------------------------------------------------*03250001
032600                                                                  03260001
032700     COPY DPWS013.                                                03270001
032800                                                                  03280001
032900 EJECT                                                            03290001
033000*----------------------------------------------------------------*03300001
033100*    DB2 AREA FOR PURCHASE ORDER                                 *03310001
033200*----------------------------------------------------------------*03320001
033300     EXEC SQL                                                     03330001
033400          INCLUDE TPURCHS                                         03340001
033500     END-EXEC.                                                    03350001
033600*----------------------------------------------------------------*03360001
033700*    DB2 AREA FOR ENTERPRISE NAME                                *03370001
033800*----------------------------------------------------------------*03380001
033900     EXEC SQL                                                     03390001
034000          INCLUDE TENTNME                                         03400001
034100     END-EXEC.                                                    03410001
034200*----------------------------------------------------------------*03420001
034300*    DB2 AREA FOR PO LINE ITEM                                   *03430001
034400*----------------------------------------------------------------*03440001
034500     EXEC SQL                                                     03450001
034600          INCLUDE TPURITM                                         03460001
034700     END-EXEC.                                                    03470001
034800*----------------------------------------------------------------*03480001
034900*    DB2 AREA FOR PO ALLOCATION PLAN                             *03490001
035000*----------------------------------------------------------------*03500001
035100     EXEC SQL                                                     03510001
035200          INCLUDE TALLPLN                                         03520001
035300     END-EXEC.                                                    03530001
035400*----------------------------------------------------------------*03540001
035500*    DB2 DCLGEN FOR TMDSEAR TABLE                                *03550001
035600*----------------------------------------------------------------*03560001
035700     EXEC SQL                                                     03570001
035800          INCLUDE TMDSEAR                                         03580001
035900     END-EXEC.                                                    03590001
036000                                                                  03600001
036100*----------------------------------------------------------------*03610001
036200*    DB2 DCLGEN FOR TRSPBAR TABLE                                *03620001
036300*----------------------------------------------------------------*03630001
036400     EXEC SQL                                                     03640001
036500          INCLUDE TRSPBAR                                         03650001
036600     END-EXEC.                                                    03660001
036700                                                                  03670001
036800*----------------------------------------------------------------*03680001
036900*    DB2 AREA FOR COMMUNICATIONS                                 *03690001
037000*----------------------------------------------------------------*03700001
037100     EXEC SQL                                                     03710001
037200          INCLUDE SQLCA                                           03720001
037300     END-EXEC.                                                    03730001
037400                                                                  03740001
037500 EJECT                                                            03750001
037600 LINKAGE SECTION.                                                 03760001
037700                                                                  03770001
037800 01  DFHCOMMAREA.                                                 03780001
037900     05  FILLER                         OCCURS  1 TO 4072 TIMES   03790001
038000                                        DEPENDING ON EIBCALEN.    03800001
038100         10  FILLER                     PIC X.                    03810001
038200                                                                  03820001
038300                                                                  03830001
038400 PROCEDURE DIVISION.                                              03840001
038500***************************************************************** 03850001
038600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03860001
038700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03870001
038800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03880001
038900**                                                             ** 03890001
039000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03900001
039100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03910001
039200***************************************************************** 03920001
039300 0000-MAIN-MODULE.                                                03930001
039400                                                                  03940001
039500     INITIALIZE DP030-CICS-API-FIELDS.                            03950001
039600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03960001
039700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03970001
039800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03980001
039900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03990001
040000     MOVE LENGTH OF PO043AI        TO DP030-MAP-LENGTH (1).       04000001
040100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04010001
040200     PERFORM 0001-CALL-CICS-ARCH-API.                             04020001
040300*                                                                 04030001
040400     PERFORM 1000-CONTROL-PROCESSING                              04040001
040500*                                                                 04050001
040600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04060001
040700     PERFORM 0001-CALL-CICS-ARCH-API.                             04070001
040800                                                                  04080001
040900 0001-CALL-CICS-ARCH-API.                                         04090001
041000                                                                  04100001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04110007
041200                                    DFHCOMMAREA                   04120007
041300                                    DP030-CICS-API-FIELDS         04130007
041400                                    DP020-STANDARD-COMMAREA       04140007
041500                                    PO043AI.                      04150007
041600*                                                                 04160001
041700     IF  DP030-RC-CALL-SUCCESSFUL                                 04170001
041800         CONTINUE                                                 04180001
041900     ELSE                                                         04190001
042000         SET DP013-NO-ROLLBACK                                    04200001
042100             DP013-XCTL-DISPLAY-RESTART                           04210001
042200             DP013-CICS-ABEND      TO TRUE                        04220001
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           04230007
042400                                   TO DP013-PARAGRAPH             04240001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04250007
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04260007
042700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04270001
042800         PERFORM DP013-0000-PROCESS-ABEND                         04280001
042900     END-IF.                                                      04290001
043000                                                                  04300001
043100 EJECT                                                            04310001
043200                                                                  04320001
043300*----------------------------------------------------------------*04330001
043400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04340001
043500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04350001
043600*----------------------------------------------------------------*04360001
043700 1000-CONTROL-PROCESSING.                                         04370001
043800                                                                  04380001
043900     EVALUATE TRUE                                                04390001
044000         WHEN DP020-NEXT-ACT-INITIAL                              04400001
044100             PERFORM 1100-FIND-OBJECT-KEYS                        04410001
044200             PERFORM 1200-CHECK-UNCONFIRMED-PACKS                 04420001
044300             IF  PS-ERROR                                         04430001
044400                 CONTINUE                                         04440001
044500             ELSE                                                 04450001
044600                 PERFORM 4000-BUILD-INITIAL-PANEL                 04460001
044700                 PERFORM 3200-RESET-ATTRIBUTES                    04470001
044800             END-IF                                               04480001
044900                                                                  04490001
045000         WHEN DP020-NEXT-ACT-READ-MAP                             04500001
045100             IF ASC-UNCONFIRMED-PACKS                             04510001
045200                 PERFORM 4000-BUILD-INITIAL-PANEL                 04520001
045210                 PERFORM 3200-RESET-ATTRIBUTES                    04521001
045220* -- PURCHASE ORDER CANNOT BE PRINTED UNTIL PACKS ARE CONFIRMED --04522001
045230                 MOVE PC-TSYMSG-02774 TO DP020-MSG-NUMBER         04523001
045240                 SET DP020-MSG-FATAL TO TRUE                      04524001
045250             ELSE                                                 04525001
045260                 PERFORM 2000-PROCESS-PANEL                       04526001
045270             END-IF                                               04527001
045280                                                                  04528001
045290         WHEN DP020-NEXT-ACT-RETURN                               04529001
045300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04530001
045400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04540001
045410             IF ASC-UNCONFIRMED-PACKS                             04541001
045420* -- PURCHASE ORDER CANNOT BE PRINTED UNTIL PACKS ARE CONFIRMED --04542001
045430                MOVE PC-TSYMSG-02774 TO DP020-MSG-NUMBER          04543001
045440                SET DP020-MSG-FATAL TO TRUE                       04544001
045450             END-IF                                               04545001
045460                                                                  04546001
045470         WHEN OTHER                                               04547001
045480             SET DP013-LOGIC-ABEND TO TRUE                        04548001
045490             SET DP013-NO-ROLLBACK TO TRUE                        04549001
045500             MOVE '1000-CONTROL-PROCESSING'                       04550001
045600                                   TO DP013-PARAGRAPH             04560001
045700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04570001
045800                                   TO DP013-MESSAGE-TEXT(1)       04580001
045900             MOVE DP020-NEXT-APPL-ACTIVITY                        04590001
046000                                   TO DP013-MESSAGE-TEXT(2)       04600001
046100             PERFORM DP013-0000-PROCESS-ABEND                     04610001
046200     END-EVALUATE.                                                04620001
046300                                                                  04630001
046400******************************************************************04640001
046500** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **04650001
046600** INTER-APPLICATION FORMAT CODE.                               **04660001
046700******************************************************************04670001
046800 1100-FIND-OBJECT-KEYS.                                           04680001
046900                                                                  04690001
047000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04700001
047100     IF  DP020-NAV-KEY-DATA > SPACE                               04710001
047200         MOVE DP020-NAV-KEY-DATA   TO ASC-PO-NBR                  04720001
047300     ELSE                                                         04730001
047400         MOVE PO011-PO-NBR         TO ASC-PO-NBR.                 04740001
047500                                                                  04750001
047600 EJECT                                                            04760001
047700                                                                  04770001
047800******************************************************************04780001
047900**                                                              **04790001
047910**                                                              **04791001
047911******************************************************************04791101
047912 1200-CHECK-UNCONFIRMED-PACKS.                                    04791201
047913                                                                  04791301
047914     PERFORM                                                      04791401
047915         WITH TEST AFTER                                          04791501
047916         VARYING PV-RETRY-COUNTER                                 04791601
047917         FROM 1 BY 1                                              04791701
047918         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04791801
047919            OR (SQLCODE = +0))                                    04791901
047920                                                                  04792001
047930     EXEC SQL                                                     04793001
047940          SELECT COUNT(*)                                         04794001
047950          INTO    :PV-RV-COUNT                                    04795001
047960          FROM    TPURITM                                         04796001
047970          WHERE   PO_NBR = :ASC-PO-NBR                            04797001
047980            AND   STATUS_CDE = 'RV'                               04798001
047990            AND   VER_STATUS_CDE = 'A'                            04799001
047991     END-EXEC                                                     04799101
047992                                                                  04799201
047993      EVALUATE TRUE                                               04799301
047994          WHEN SQLCODE = 0                                        04799401
047995              IF PV-RV-COUNT > 0                                  04799501
047996* -- PURCHASE ORDER CANNOT BE PRINTED UNTIL PACKS ARE CONFIRMED --04799601
047997                 MOVE PC-TSYMSG-02774 TO DP020-MSG-NUMBER         04799701
047998                 SET DP020-MSG-FATAL TO TRUE                      04799801
047999                 SET ASC-UNCONFIRMED-PACKS TO TRUE                04799901
048000              END-IF                                              04800001
048001          WHEN SQLCODE = -904                                     04800101
048002          WHEN SQLCODE = -913                                     04800201
048003               CONTINUE                                           04800301
048004          WHEN SQLWARN0 NOT = SPACES                              04800401
048005          WHEN SQLCODE < +0                                       04800501
048006          WHEN SQLCODE > +0                                       04800601
048007               MOVE '1200-CHECK-UNCONFIRMED-PACKS'                04800701
048008                                 TO DP013-PARAGRAPH               04800801
048009               MOVE 'MAXIMUM RETRIES EXCEEDED FOR RV STATUS COUNT'04800901
048010                                 TO DP013-MESSAGE-TEXT (1)        04801001
048011               MOVE SQLCA        TO DP013-SQLCA                   04801101
048012               MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)      04801201
048013               SET DP013-DB2-ABEND                                04801301
048014                   DP013-XCTL-DISPLAY-RESTART                     04801401
048015                                 TO TRUE                          04801501
048016               PERFORM DP013-0000-PROCESS-ABEND                   04801601
048017      END-EVALUATE                                                04801701
048018     END-PERFORM.                                                 04801801
048019                                                                  04801901
048020     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        04802001
048021         MOVE '1200-CHECK-UNCONFIRMED-PACKS'                      04802101
048022                                   TO DP013-PARAGRAPH             04802201
048023         MOVE 'UNSUCCESSFUL COUNT OF RV STATUS CODES'             04802301
048024                                   TO DP013-MESSAGE-TEXT (1)      04802401
048025         MOVE SQLCA                TO DP013-SQLCA                 04802501
048026         MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (1)     04802601
048027         SET DP013-DB2-ABEND                                      04802701
048028             DP013-XCTL-DISPLAY-RESTART                           04802801
048029                                   TO TRUE                        04802901
048030         PERFORM DP013-0000-PROCESS-ABEND                         04803001
048031     END-IF.                                                      04803101
048032                                                                  04803201
048033                                                                  04803301
048034*----------------------------------------------------------------*04803401
048035* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04803501
048036* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04803601
048037* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04803701
048038* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04803801
048039* FUNCTION KEYS CAN GET THIS FAR.                                *04803901
048040*----------------------------------------------------------------*04804001
048050 2000-PROCESS-PANEL.                                              04805001
048060                                                                  04806001
048070     EVALUATE TRUE                                                04807001
048080                                                                  04808001
048090         WHEN DP020-SRC-AID = DP016-CLEAR                         04809001
048100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04810001
048200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04820001
048300                                                                  04830001
048400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04840001
048500             SET DP030-DONT-ERASE                                 04850001
048600                 DP030-SEND-DATAONLY (PC-APPL-MAP)                04860001
048700                                   TO TRUE                        04870001
048800             PERFORM 4000-BUILD-INITIAL-PANEL                     04880001
048900             PERFORM 3200-RESET-ATTRIBUTES                        04890001
049000                                                                  04900001
049100         WHEN OTHER                                               04910001
049200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04920001
049300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04930001
049400             IF  PS-NO-ERROR                                      04940001
049500                 SET DP030-CONTINUE-GO                            04950001
049600                                   TO TRUE                        04960001
049700                 PERFORM 2100-CHECK-FUNCTION-KEY                  04970001
049800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04980001
049900             ELSE                                                 04990001
050000                 SET DP030-OVERRIDE-GO                            05000001
050100                                   TO TRUE                        05010001
050200             END-IF                                               05020001
050300     END-EVALUATE.                                                05030001
050400                                                                  05040001
050500*----------------------------------------------------------------*05050001
050600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05060001
050700* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05070001
050800* FROM THE CICS ARCHITECTURE API.                                *05080001
050900*----------------------------------------------------------------*05090001
051000 2100-CHECK-FUNCTION-KEY.                                         05100001
051100                                                                  05110001
051200     EVALUATE TRUE                                                05120001
051300         WHEN DP020-SRC-AID = DP016-ENTER                         05130001
051400             CONTINUE                                             05140001
051500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05150001
051600             SET DP030-CONTINUE-GO TO TRUE                        05160001
051700             PERFORM 5000-SUBMIT-REPORT                           05170001
051800*            --- REPORT SUCCESSFUL SUBMITTED---                   05180001
051900             MOVE PC-TSYMSG-00458  TO DP020-MSG-NUMBER            05190001
052000             SET DP020-MSG-INFORMATIONAL                          05200001
052100                                   TO TRUE                        05210001
052200         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05220001
052300             SET DP030-CONTINUE-GO TO TRUE                        05230001
052400             PERFORM 6000-SHIP-INST-EDITS                         05240001
052500             IF PS-NO-ERROR                                       05250001
052600                 PERFORM 6500-SUBMIT-SI-REPORT                    05260001
052700*                --- REPORT SUCCESSFUL SUBMITTED---               05270001
052800                 MOVE PC-TSYMSG-00458  TO DP020-MSG-NUMBER        05280001
052900                 SET DP020-MSG-INFORMATIONAL                      05290001
053000                                   TO TRUE                        05300001
053100             ELSE                                                 05310001
053200                 SET DP030-OVERRIDE-GO                            05320001
053300                                   TO TRUE                        05330001
053400             END-IF                                               05340001
053500         WHEN OTHER                                               05350001
053600             SET DP013-NO-ROLLBACK                                05360001
053700                 DP013-XCTL-DISPLAY-RESTART                       05370001
053800                 DP013-CICS-ABEND  TO TRUE                        05380001
053900             MOVE '2100-CHECK-FUNCTION-KEY'                       05390001
054000                                   TO DP013-PARAGRAPH             05400001
054100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05410001
054200                                   TO DP013-MESSAGE-TEXT (1)      05420001
054300             PERFORM DP013-0000-PROCESS-ABEND                     05430001
054400     END-EVALUATE.                                                05440001
054500                                                                  05450001
054600*----------------------------------------------------------------*05460001
054700* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *05470001
054800* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *05480001
054900* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *05490001
055000*----------------------------------------------------------------*05500001
055100 2200-MOVE-SCREEN-TO-COMMAREA.                                    05510001
055200                                                                  05520001
055300     IF AVENCOPL > ZERO                                           05530001
055400         MOVE AVENCOPI             TO ASC-VEND-IND                05540001
055500     ELSE                                                         05550001
055600         IF AVENCOPF = DP015-ERASE-EOF                            05560001
055700             MOVE SPACE            TO ASC-VEND-IND                05570001
055800         END-IF                                                   05580001
055900     END-IF.                                                      05590001
056000                                                                  05600001
056100     IF ASUPRSL > ZERO                                            05610001
056200         MOVE ASUPRSI              TO ASC-SUP-RETAIL              05620001
056300     ELSE                                                         05630001
056400         IF ASUPRSF = DP015-ERASE-EOF                             05640001
056500             MOVE SPACE            TO ASC-SUP-RETAIL              05650001
056600         END-IF                                                   05660001
056700     END-IF.                                                      05670001
056800                                                                  05680001
056900     IF ABUYCOPL > ZERO                                           05690001
057000         MOVE ABUYCOPI             TO ASC-BUY-IND                 05700001
057100     ELSE                                                         05710001
057200         IF ABUYCOPF = DP015-ERASE-EOF                            05720001
057300             MOVE SPACE            TO ASC-BUY-IND                 05730001
057400         END-IF                                                   05740001
057500     END-IF.                                                      05750001
057600                                                                  05760001
057700     IF ADCCOPL > ZERO                                            05770001
057800         MOVE ADCCOPI              TO ASC-DC-IND                  05780001
057900     ELSE                                                         05790001
058000         IF ADCCOPF = DP015-ERASE-EOF                             05800001
058100             MOVE SPACE            TO ASC-DC-IND                  05810001
058200         END-IF                                                   05820001
058300     END-IF.                                                      05830001
058400                                                                  05840001
058500 EJECT                                                            05850001
058600                                                                  05860001
058700*----------------------------------------------------------------*05870001
058800* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *05880001
058900* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *05890001
059000* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *05900001
059100*----------------------------------------------------------------*05910001
059200 3000-EDIT-DATA-IN-COMMAREA.                                      05920001
059300                                                                  05930001
059400     PERFORM 3200-RESET-ATTRIBUTES.                               05940001
059500                                                                  05950001
059600     IF ASC-SUP-RETAIL > SPACES                                   05960001
059700         IF ASC-SUP-RETAIL = 'Y' OR 'N'                           05970001
059800             CONTINUE                                             05980001
059900         ELSE                                                     05990001
060000             SET PS-ERROR          TO TRUE                        06000001
060100             SET DP020-MSG-FATAL   TO TRUE                        06010001
060200*            --- CODE MUST BE 'Y' OR 'N' ---                      06020001
060300             MOVE PC-TSYMSG-00368  TO DP020-MSG-NUMBER            06030001
060400             MOVE DP015-UNP-ALP-BRT-OFF                           06040001
060500                                   TO ASUPRSA                     06050001
060600             MOVE DP015-RED        TO ASUPRSC                     06060001
060700             MOVE DP015-REVERSE    TO ASUPRSH                     06070001
060800             MOVE -1               TO ASUPRSL                     06080001
060900             SET DP030-SET-CURSOR-APPL-1                          06090001
061000                                   TO TRUE                        06100001
061100         END-IF                                                   06110001
061200     ELSE                                                         06120001
061300         MOVE 'N' TO ASC-SUP-RETAIL                               06130001
061400     END-IF.                                                      06140001
061500                                                                  06150001
061600     IF ASC-VEND-IND > SPACES                                     06160001
061700         IF ASC-VEND-IND = 'Y' OR 'N'                             06170001
061800             CONTINUE                                             06180001
061900         ELSE                                                     06190001
062000             SET PS-ERROR          TO TRUE                        06200001
062100             SET DP020-MSG-FATAL   TO TRUE                        06210001
062200*            --- CODE MUST BE 'Y' OR 'N' ---                      06220001
062300             MOVE PC-TSYMSG-00368  TO DP020-MSG-NUMBER            06230001
062400             MOVE DP015-UNP-ALP-BRT-OFF                           06240001
062500                                   TO AVENCOPA                    06250001
062600             MOVE DP015-RED        TO AVENCOPC                    06260001
062700             MOVE DP015-REVERSE    TO AVENCOPH                    06270001
062800             MOVE -1               TO AVENCOPL                    06280001
062900             SET DP030-SET-CURSOR-APPL-1                          06290001
063000                                   TO TRUE                        06300001
063100         END-IF                                                   06310001
063200     ELSE                                                         06320001
063300         MOVE 'N' TO ASC-VEND-IND                                 06330001
063400     END-IF.                                                      06340001
063500                                                                  06350001
063600     IF ASC-VEND-IND = 'Y'                                        06360001
063700         IF ASC-STATUS-CDE = 'AP' OR 'AC'                         06370001
063800             CONTINUE                                             06380001
063900         ELSE                                                     06390001
064000             SET PS-ERROR          TO TRUE                        06400001
064100             SET DP020-MSG-FATAL   TO TRUE                        06410001
064200*            --- PO MUST BE APPROVED     ---                      06420001
064300             MOVE PC-TSYMSG-00582  TO DP020-MSG-NUMBER            06430001
064400             MOVE DP015-UNP-ALP-BRT-OFF                           06440001
064500                                   TO AVENCOPA                    06450001
064600             MOVE DP015-RED        TO AVENCOPC                    06460001
064700             MOVE DP015-REVERSE    TO AVENCOPH                    06470001
064800             MOVE -1               TO AVENCOPL                    06480001
064900             SET DP030-SET-CURSOR-APPL-1                          06490001
065000                                   TO TRUE                        06500001
065100         END-IF                                                   06510001
065200     END-IF.                                                      06520001
065300                                                                  06530001
065400     IF ASC-DC-IND > SPACES                                       06540001
065500         IF ASC-DC-IND = 'Y' OR 'N'                               06550001
065600             CONTINUE                                             06560001
065700         ELSE                                                     06570001
065800             SET PS-ERROR          TO TRUE                        06580001
065900             SET DP020-MSG-FATAL   TO TRUE                        06590001
066000*            --- CODE MUST BE 'Y' OR 'N' ---                      06600001
066100             MOVE PC-TSYMSG-00368  TO DP020-MSG-NUMBER            06610001
066200             MOVE DP015-UNP-ALP-BRT-OFF                           06620001
066300                                   TO ADCCOPA                     06630001
066400             MOVE DP015-RED        TO ADCCOPC                     06640001
066500             MOVE DP015-REVERSE    TO ADCCOPH                     06650001
066600             MOVE -1               TO ADCCOPL                     06660001
066700             SET DP030-SET-CURSOR-APPL-1                          06670001
066800                                   TO TRUE                        06680001
066900         END-IF                                                   06690001
067000     ELSE                                                         06700001
067100         MOVE 'N' TO ASC-DC-IND                                   06710001
067200     END-IF.                                                      06720001
067300                                                                  06730001
067400     IF ASC-BUY-IND > SPACES                                      06740001
067500         IF ASC-BUY-IND = 'Y' OR 'N'                              06750001
067600             CONTINUE                                             06760001
067700         ELSE                                                     06770001
067800             SET PS-ERROR          TO TRUE                        06780001
067900             SET DP020-MSG-FATAL   TO TRUE                        06790001
068000*            --- CODE MUST BE 'Y' OR 'N' ---                      06800001
068100             MOVE PC-TSYMSG-00368  TO DP020-MSG-NUMBER            06810001
068200             MOVE DP015-UNP-ALP-BRT-OFF                           06820001
068300                                   TO ABUYCOPA                    06830001
068400             MOVE DP015-RED        TO ABUYCOPC                    06840001
068500             MOVE DP015-REVERSE    TO ABUYCOPH                    06850001
068600             MOVE -1               TO ABUYCOPL                    06860001
068700             SET DP030-SET-CURSOR-APPL-1                          06870001
068800                                   TO TRUE                        06880001
068900         END-IF                                                   06890001
069000     ELSE                                                         06900001
069100         MOVE 'N' TO ASC-BUY-IND                                  06910001
069200     END-IF.                                                      06920001
069300                                                                  06930001
069400     IF ASC-DC-IND = 'N' AND                                      06940001
069500        ASC-BUY-IND = 'N' AND                                     06950001
069600        ASC-VEND-IND = 'N'                                        06960001
069700         SET PS-ERROR              TO TRUE                        06970001
069800         SET DP020-MSG-FATAL       TO TRUE                        06980001
069900*        --- MUST SELECT ONE         ---                          06990001
070000         MOVE PC-TSYMSG-00330      TO DP020-MSG-NUMBER            07000001
070100         MOVE DP015-UNP-ALP-BRT-OFF                               07010001
070200                                   TO ABUYCOPA                    07020001
070300         MOVE DP015-RED            TO ABUYCOPC                    07030001
070400         MOVE DP015-REVERSE        TO ABUYCOPH                    07040001
070500         MOVE -1                   TO ABUYCOPL                    07050001
070600         SET DP030-SET-CURSOR-APPL-1                              07060001
070700                                   TO TRUE                        07070001
070800     END-IF.                                                      07080001
070900                                                                  07090001
071000*----------------------------------------------------------------*07100001
071100* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *07110001
071200* MAP.                                                           *07120001
071300*----------------------------------------------------------------*07130001
071400 3200-RESET-ATTRIBUTES.                                           07140001
071500                                                                  07150001
071600     MOVE DP015-UNP-ALP-NOR-OFF    TO AVENCOPA                    07160001
071700                                      ASUPRSA                     07170001
071800                                      ABUYCOPA                    07180001
071900                                      ADCCOPA.                    07190001
072000     MOVE DP015-GREEN              TO AVENCOPC                    07200001
072100                                      ASUPRSC                     07210001
072200                                      ABUYCOPC                    07220001
072300                                      ADCCOPC.                    07230001
072400     MOVE DP015-UNDERLINE          TO AVENCOPH                    07240001
072500                                      ASUPRSH                     07250001
072600                                      ABUYCOPH                    07260001
072700                                      ADCCOPH.                    07270001
072800 EJECT                                                            07280001
072900                                                                  07290001
073000*----------------------------------------------------------------*07300001
073100*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *07310001
073200*    ENTRY.                                                      *07320001
073300*----------------------------------------------------------------*07330001
073400 4000-BUILD-INITIAL-PANEL.                                        07340001
073500                                                                  07350001
073600     PERFORM 4100-GET-OTHER-SCREEN-FIELDS.                        07360001
073700     IF SQLCODE = +100                                            07370001
073800         SET DP020-NEXT-ACT-APPL-ERROR                            07380001
073900                                   TO TRUE                        07390001
074000         MOVE PC-TSYMSG-00083      TO DP020-MSG-NUMBER            07400001
074100         SET DP020-MSG-INFORMATIONAL                              07410001
074200                                   TO TRUE                        07420001
074300     ELSE                                                         07430001
074400         MOVE PURCHS-DEPT-NBR      TO ASC-DPT-NBR                 07440001
074500         MOVE PURCHS-TOT-SKUS-QTY  TO ASC-TOT-SKUS-QTY            07450001
074600         MOVE PURCHS-STATUS-CDE    TO ASC-STATUS-CDE              07460001
074700         MOVE PURCHS-RLSE-IND      TO ASC-RLSE-IND                07470001
074800         MOVE ENTNME-ENT-NAME-DESC TO ASC-ENT-NAME-DESC           07480001
074900         MOVE 'N'                  TO ASC-VEND-IND                07490001
075000                                      ASC-SUP-RETAIL              07500001
075100                                      ASC-BUY-IND                 07510001
075200                                      ASC-DC-IND                  07520001
075300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     07530001
075400         SET DP030-SET-CURSOR-APPL-1                              07540001
075500                                   TO TRUE                        07550001
075600         MOVE -1                   TO ABUYCOPL                    07560001
075700     END-IF.                                                      07570001
075800                                                                  07580001
075900*----------------------------------------------------------------*07590001
076000* GET PURCHASE ORDER HEADER FIELDS                               *07600001
076100*----------------------------------------------------------------*07610001
076200 4100-GET-OTHER-SCREEN-FIELDS.                                    07620001
076300                                                                  07630001
076400     PERFORM                                                      07640001
076500         WITH TEST AFTER                                          07650001
076600         VARYING PV-RETRY-COUNTER                                 07660001
076700         FROM 1 BY 1                                              07670001
076800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07680001
076900             OR (SQLCODE = ZERO)                                  07690001
077000             OR (SQLCODE = +100))                                 07700001
077100             EXEC SQL                                             07710001
077200                 SELECT A.DEPT_NBR,                               07720001
077300                        A.TOT_SKUS_QTY,                           07730001
077400                        A.STATUS_CDE,                             07740001
077500                        A.RLSE_IND,                               07750001
077600                        B.ENT_NAME_DESC                           07760001
077700                 INTO :PURCHS-DEPT-NBR,                           07770001
077800                      :PURCHS-TOT-SKUS-QTY,                       07780001
077900                      :PURCHS-STATUS-CDE,                         07790001
078000                      :PURCHS-RLSE-IND,                           07800001
078100                      :ENTNME-ENT-NAME-DESC                       07810001
078200                 FROM TPURCHS A,                                  07820001
078300                      TENTNME B                                   07830001
078400                 WHERE A.PO_NBR = :ASC-PO-NBR                     07840001
078500                   AND A.VER_STATUS_CDE = 'A'                     07850001
078600                   AND B.ENT_ID = A.ENT_ID                        07860001
078700                   AND B.TYPE_CDE = '01'                          07870001
078800             END-EXEC                                             07880001
078900         EVALUATE TRUE                                            07890001
079000             WHEN SQLCODE = ZERO                                  07900001
079100             WHEN SQLCODE = +100                                  07910001
079200             WHEN SQLCODE = -904                                  07920001
079300             WHEN SQLCODE = -913                                  07930001
079400                 CONTINUE                                         07940001
079500             WHEN SQLWARN0 NOT = SPACES                           07950001
079600             WHEN SQLCODE < ZERO                                  07960001
079700             WHEN SQLCODE > ZERO                                  07970001
079800                 MOVE '4100-GET-OTHER-SCREEN-FIELDS'              07980001
079900                                   TO DP013-PARAGRAPH             07990001
080000                 MOVE 'SQL ERROR SELECTING PO'                    08000001
080100                                   TO DP013-MESSAGE-TEXT (1)      08010001
080200                 MOVE SQLCA        TO DP013-SQLCA                 08020001
080300                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    08030001
080400                 SET DP013-DB2-ABEND                              08040001
080500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08050001
080600                 PERFORM DP013-0000-PROCESS-ABEND                 08060001
080700         END-EVALUATE                                             08070001
080800     END-PERFORM.                                                 08080001
080900*                                                                 08090001
081000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08100001
081100         MOVE '4100-GET-OTHER-SCREEN-FIELDS'                      08110001
081200                                   TO DP013-PARAGRAPH             08120001
081300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08130001
081400                                   TO DP013-MESSAGE-TEXT (1)      08140001
081500         MOVE SQLCA                TO DP013-SQLCA                 08150001
081600         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    08160001
081700         SET DP013-DB2-ABEND                                      08170001
081800             DP013-XCTL-DISPLAY-RESTART                           08180001
081900                                   TO TRUE                        08190001
082000         PERFORM DP013-0000-PROCESS-ABEND                         08200001
082100     END-IF.                                                      08210001
082200                                                                  08220001
082300*                                                                 08230001
082400*----------------------------------------------------------------*08240001
082500*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *08250001
082600*----------------------------------------------------------------*08260001
082700 4400-MOVE-COMMAREA-TO-SCREEN.                                    08270001
082800                                                                  08280001
082900     MOVE ASC-PO-NBR               TO APONUMO.                    08290001
083000     MOVE ASC-DPT-NBR              TO ADEPTO.                     08300001
083100     MOVE ASC-ENT-NAME-DESC        TO AVNAMEO.                    08310001
083200     MOVE ASC-TOT-SKUS-QTY         TO ATOTSKUO.                   08320001
083300     MOVE ASC-VEND-IND             TO AVENCOPO.                   08330001
083400     MOVE ASC-SUP-RETAIL           TO ASUPRSO.                    08340001
083500     MOVE ASC-BUY-IND              TO ABUYCOPO.                   08350001
083600     MOVE ASC-DC-IND               TO ADCCOPO.                    08360001
083700                                                                  08370001
083800 EJECT                                                            08380001
083900                                                                  08390001
084000*----------------------------------------------------------------*08400001
084100*  CONTROLS PROCESSING FOR SUBMITTING PO REQUEST                 *08410001
084200*----------------------------------------------------------------*08420001
084300 5000-SUBMIT-REPORT.                                              08430001
084400                                                                  08440001
084500     PERFORM 5100-GET-USER-SYSTEM.                                08450001
084600     PERFORM 5150-GET-PACKAGE-CODE.                               08460001
084700     IF PV-CIT1-CICS                                              08470001
084800         MOVE PV-USER-ID           TO PV-TEST-JOB-USER-ID         08480001
084900                                      PC-TEST-NOTIFY-ID           08490001
085000         MOVE PV-TEST-JOB          TO JL-JOB-NAME                 08500001
085100         MOVE PC-TEST-CLASS        TO JL-JCL-CLASS                08510001
085200         MOVE PC-TEST-LIBSRCH      TO JL-JCL-LIBSRCH              08520001
085300         MOVE PC-TEST-JOB-PARM     TO JL-JCL-JOB-PARM             08530001
085400         MOVE PC-TEST-JOBLIB       TO JL-JCL-JOBLIB               08540001
085500         MOVE PC-TEST-JOBOUT2AA    TO JL-JCL-OUTPUT1              08550001
085600         MOVE PC-TEST-JOBOUT2C     TO JL-JCL-OUTPUT2              08560001
085700         MOVE PC-TEST-JOBOUT3      TO JL-JCL-OUTPUT3              08570001
085800         MOVE PC-TEST-JOBOUT3      TO JL-JCL-OUTPUT4              08580001
085900           IF PURCHS-PKGNG-CDE = 'M' OR 'I'                       08590001
086000               MOVE PC-TEST-PROC-PO-PK                            08600001
086100                                   TO JL-JCL-PROC                 08610001
086200           ELSE                                                   08620001
086300               MOVE PC-TEST-PROC-PO                               08630001
086400                                   TO JL-JCL-PROC                 08640001
086500           END-IF                                                 08650001
086600     ELSE                                                         08660001
086700       IF PV-CIQA-CICS                                            08670001
086800         CONTINUE                                                 08680001
086900       ELSE                                                       08690001
087000         PERFORM 7000-BUYER-INFORMATION                           08700001
087100         MOVE PC-PROD-JOB-POK901   TO JL-JOB-NAME                 08710001
087200         MOVE PC-PROD-CLASS        TO JL-JCL-CLASS                08720001
087300         MOVE PC-PROD-LIBSRCH      TO JL-JCL-LIBSRCH              08730001
087400         MOVE PC-PROD-JOB-PARM     TO JL-JCL-JOB-PARM             08740001
087500         MOVE PC-PROD-JOBLIB       TO JL-JCL-JOBLIB               08750001
087600         MOVE PC-PROD-JOBOUT1A     TO JL-JCL-OUTPUT1              08760001
087700         MOVE PC-PROD-JOBOUT2      TO JL-JCL-OUTPUT2              08770001
087800         MOVE PC-PROD-JOBOUT3      TO JL-JCL-OUTPUT3              08780001
087900         MOVE PC-PROD-JOBOUT4      TO JL-JCL-OUTPUT4              08790001
088000           IF PURCHS-PKGNG-CDE = 'M' OR 'I'                       08800001
088100               MOVE PC-PROD-PROC-PO-PK                            08810001
088200                                   TO JL-JCL-PROC                 08820001
088300           ELSE                                                   08830001
088400               MOVE PC-PROD-PROC-PO                               08840001
088500                                   TO JL-JCL-PROC                 08850001
088600           END-IF                                                 08860001
088700       END-IF                                                     08870001
088800     END-IF.                                                      08880001
088900                                                                  08890001
089000     MOVE ASC-PO-NBR               TO JL-PO-NBR.                  08900001
089100     MOVE SPACES                   TO JL-PRINT-TYPE-BY            08910001
089200                                      JL-PRINT-TYPE-VN            08920001
089300                                      JL-PRINT-TYPE-AN            08930001
089400                                      JL-PRINT-TYPE-DC.           08940001
089500     IF ASC-VEND-IND = 'Y'                                        08950001
089600         IF ASC-SUP-RETAIL = 'Y'                                  08960001
089700             MOVE 'VS'             TO JL-PRINT-TYPE-VN            08970001
089800         ELSE                                                     08980001
089900             MOVE 'VN'             TO JL-PRINT-TYPE-VN            08990001
090000         END-IF                                                   09000001
090100     END-IF.                                                      09010001
090200                                                                  09020001
090300     IF ASC-BUY-IND = 'Y'                                         09030001
090400         MOVE 'BY'                 TO JL-PRINT-TYPE-BY            09040001
090500     END-IF.                                                      09050001
090600                                                                  09060001
090700     IF ASC-DC-IND = 'Y'                                          09070001
090800         MOVE 'DC'                 TO JL-PRINT-TYPE-DC            09080001
090900     END-IF.                                                      09090001
091000                                                                  09100001
091100     PERFORM 5200-TD-QUEUE-ENQ.                                   09110001
091200     PERFORM                                                      09120001
091300         VARYING JL-LINE-INDEX                                    09130001
091400         FROM 1 BY 1                                              09140001
091500         UNTIL JL-LINE-INDEX > 18                                 09150001
091600             MOVE JL-JCL-LINE (JL-LINE-INDEX)                     09160001
091700                                   TO TD-JCL-LINE                 09170001
091800             PERFORM 5300-WRITE-TRANS-DATA-LINE                   09180001
091900     END-PERFORM.                                                 09190001
092000     PERFORM 5400-TD-QUEUE-DEQ.                                   09200001
092100                                                                  09210001
092200*----------------------------------------------------------------*09220001
092300*  GET CURRENT SYSTEM AND USER ID                                *09230001
092400*----------------------------------------------------------------*09240001
092500 5100-GET-USER-SYSTEM.                                            09250001
092600                                                                  09260001
092700     EXEC CICS ASSIGN                                             09270001
092800          SYSID    (PV-SYSTEM-ID)                                 09280001
092900          USERID   (PV-USER-ID)                                   09290001
093000          RESP     (PV-CICS-RESPONSE)                             09300001
093100     END-EXEC.                                                    09310001
093200                                                                  09320001
093300     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09330001
093400         SET DP013-LOGIC-ABEND     TO TRUE                        09340001
093500         SET DP013-NO-ROLLBACK     TO TRUE                        09350001
093600         MOVE '5100-GET-USER-ID'   TO DP013-PARAGRAPH             09360001
093700         MOVE PV-CICS-RESPONSE     TO DP013-MESSAGE-TEXT (1)      09370001
093800         MOVE 'ERROR GETTING USER ID'                             09380001
093900                                   TO DP013-MESSAGE-TEXT (2)      09390001
094000         PERFORM DP013-0000-PROCESS-ABEND                         09400001
094100     END-IF.                                                      09410001
094200                                                                  09420001
094300                                                                  09430001
094400 5150-GET-PACKAGE-CODE.                                           09440001
094500                                                                  09450001
094600     EXEC SQL                                                     09460001
094700         SELECT PKGNG_CDE                                         09470001
094800         INTO :PURCHS-PKGNG-CDE                                   09480001
094900         FROM TPURCHS                                             09490001
095000         WHERE PO_NBR = :ASC-PO-NBR                               09500001
095100         AND VER_STATUS_CDE = 'A'                                 09510001
095200     END-EXEC.                                                    09520001
095300     EVALUATE TRUE                                                09530001
095400       WHEN SQLCODE = ZEROS                                       09540001
095500         CONTINUE                                                 09550001
095600       WHEN SQLCODE = -904                                        09560001
095700       WHEN SQLCODE = -911                                        09570001
095800       WHEN SQLCODE = -913                                        09580001
095900            MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER         09590001
096000            SET PS-ERROR                                          09600001
096100                DP020-NEXT-ACT-APPL-ERROR                         09610001
096200                DP020-MSG-FATAL                                   09620001
096300                TO TRUE                                           09630001
096400            MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1)   09640001
096500            PERFORM 0001-CALL-CICS-ARCH-API                       09650001
096600       WHEN OTHER                                                 09660001
096700            MOVE '5150-GET-PAGKAGE-CODE' TO DP013-PARAGRAPH       09670001
096800            MOVE 'UNSUCCESSFUL SELECT PKG CODE' TO                09680001
096900                                            DP013-MESSAGE-TEXT (1)09690001
097000            MOVE SQLCA TO DP013-SQLCA                             09700001
097100            MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)           09710001
097200            SET DP013-DB2-ABEND                                   09720001
097300                DP013-XCTL-DISPLAY-RESTART TO TRUE                09730001
097400                                                                  09740001
097500            PERFORM DP013-0000-PROCESS-ABEND                      09750001
097600     END-EVALUATE.                                                09760001
097700*----------------------------------------------------------------*09770001
097800*  ENQUE THE TRANSIENT DATA QUEUE                                *09780001
097900*----------------------------------------------------------------*09790001
098000 5200-TD-QUEUE-ENQ.                                               09800001
098100                                                                  09810001
098200     EXEC CICS ENQ                                                09820001
098300          RESOURCE (TD-QUEUE-NAME)                                09830001
098400          LENGTH   (TD-Q-NAME-LENGTH)                             09840001
098500          RESP     (PV-CICS-RESPONSE)                             09850001
098600     END-EXEC.                                                    09860001
098700                                                                  09870001
098800     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09880001
098900         SET DP013-LOGIC-ABEND     TO TRUE                        09890001
099000         SET DP013-NO-ROLLBACK     TO TRUE                        09900001
099100         MOVE '5200-TD-QUEUE-ENQ'  TO DP013-PARAGRAPH             09910001
099200         MOVE PV-CICS-RESPONSE     TO DP013-MESSAGE-TEXT (1)      09920001
099300         MOVE 'ERROR ENQUEING TD'                                 09930001
099400                                   TO DP013-MESSAGE-TEXT (2)      09940001
099500         PERFORM DP013-0000-PROCESS-ABEND                         09950001
099600     END-IF.                                                      09960001
099700                                                                  09970001
099800*----------------------------------------------------------------*09980001
099900*  WRITE A JCL LINE TO THE TRANSIENT DATE QUEUE                  *09990001
100000*----------------------------------------------------------------*10000001
100100 5300-WRITE-TRANS-DATA-LINE.                                      10010001
100200                                                                  10020001
100300     EXEC CICS WRITEQ TD                                          10030001
100400          QUEUE    (TD-QUEUE-NAME)                                10040001
100500          FROM     (TD-JCL-LINE)                                  10050001
100600          LENGTH   (TD-JCL-LINE-LENGTH)                           10060001
100700          RESP     (PV-CICS-RESPONSE)                             10070001
100800     END-EXEC.                                                    10080001
100900                                                                  10090001
101000     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    10100001
101100         SET DP013-LOGIC-ABEND     TO TRUE                        10110001
101200         SET DP013-NO-ROLLBACK     TO TRUE                        10120001
101300         MOVE '5300-WRITE-TRANS-DATA-LINE'                        10130001
101400                                   TO DP013-PARAGRAPH             10140001
101500         MOVE PV-CICS-RESPONSE     TO DP013-MESSAGE-TEXT (1)      10150001
101600         MOVE 'ERROR WRITEING TRANS DATA LINE'                    10160001
101700                                   TO DP013-MESSAGE-TEXT (2)      10170001
101800         PERFORM DP013-0000-PROCESS-ABEND                         10180001
101900     END-IF.                                                      10190001
102000                                                                  10200001
102100*----------------------------------------------------------------*10210001
102200*  DENQUE THE TRANSIENT DATA QUEUE                               *10220001
102300*----------------------------------------------------------------*10230001
102400 5400-TD-QUEUE-DEQ.                                               10240001
102500                                                                  10250001
102600     EXEC CICS DEQ                                                10260001
102700          RESOURCE (TD-QUEUE-NAME)                                10270001
102800          LENGTH   (TD-Q-NAME-LENGTH)                             10280001
102900          RESP     (PV-CICS-RESPONSE)                             10290001
103000     END-EXEC.                                                    10300001
103100                                                                  10310001
103200     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    10320001
103300         SET DP013-LOGIC-ABEND     TO TRUE                        10330001
103400         SET DP013-NO-ROLLBACK     TO TRUE                        10340001
103500         MOVE '5400-TD-QUEUE-DEQ'  TO DP013-PARAGRAPH             10350001
103600         MOVE PV-CICS-RESPONSE     TO DP013-MESSAGE-TEXT (1)      10360001
103700         MOVE 'ERROR DENQUEING TD'                                10370001
103800                                   TO DP013-MESSAGE-TEXT (2)      10380001
103900         PERFORM DP013-0000-PROCESS-ABEND                         10390001
104000     END-IF.                                                      10400001
104100                                                                  10410001
104200*----------------------------------------------------------------*10420001
104300* PERFORM EDITS RELATED TO REQUESTING A SHIP INSTRUCTION PRINT   *10430001
104400*----------------------------------------------------------------*10440001
104500 6000-SHIP-INST-EDITS.                                            10450001
104600                                                                  10460001
104700     IF ASC-DC-IND = 'Y'                                          10470001
104800         SET PS-ERROR              TO TRUE                        10480001
104900         SET DP020-MSG-FATAL       TO TRUE                        10490001
105000*        --- INVALID LOCATION ---                                 10500001
105100         MOVE PC-TSYMSG-00271      TO DP020-MSG-NUMBER            10510001
105200         MOVE DP015-UNP-ALP-BRT-OFF                               10520001
105300                                   TO ADCCOPA                     10530001
105400         MOVE DP015-RED            TO ADCCOPC                     10540001
105500         MOVE DP015-REVERSE        TO ADCCOPH                     10550001
105600         MOVE -1                   TO ADCCOPL                     10560001
105700         SET DP030-SET-CURSOR-APPL-1                              10570001
105800                                   TO TRUE                        10580001
105900     END-IF.                                                      10590001
106000                                                                  10600001
106100     IF ASC-RLSE-IND = 'Y'                                        10610001
106200         CONTINUE                                                 10620001
106300     ELSE                                                         10630001
106400         SET PS-ERROR              TO TRUE                        10640001
106500         SET DP020-MSG-FATAL       TO TRUE                        10650001
106600*        --- ORDER NOT RELEASED ---                               10660001
106700         MOVE PC-TSYMSG-00753      TO DP020-MSG-NUMBER            10670001
106800     END-IF.                                                      10680001
106900                                                                  10690001
107000     MOVE +0                       TO PV-DB2-COUNT1               10700001
107100                                      PV-DB2-COUNT2.              10710001
107200     PERFORM                                                      10720001
107300         WITH TEST AFTER                                          10730001
107400         VARYING PV-RETRY-COUNTER                                 10740001
107500         FROM 1 BY 1                                              10750001
107600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10760001
107700                   OR (SQLCODE = ZERO))                           10770001
107800         EXEC SQL                                                 10780001
107900             SELECT  COUNT (*)                                    10790001
108000                INTO :PV-DB2-COUNT1                               10800001
108100                FROM  TPURITM A                                   10810001
108200               WHERE A.PO_NBR = :ASC-PO-NBR                       10820001
108300                 AND A.VER_STATUS_CDE = 'A'                       10830001
108400                 AND A.STATUS_CDE NOT IN ('CA', 'CB')             10840001
108500                 AND UNT_QTY <>                                   10850001
108600                    (SELECT SUM(CURR_SPLIT_QTY)                   10860001
108700                       FROM TALLPLN B                             10870001
108800                      WHERE A.PO_NBR     = B.PO_NBR               10880001
108900                        AND A.PO_LNE_NBR = B.PO_LNE_NBR)          10890001
109000         END-EXEC                                                 10900001
109100                                                                  10910001
109200         EVALUATE TRUE                                            10920001
109300                 WHEN SQLCODE = +0                                10930001
109400                     CONTINUE                                     10940001
109500                 WHEN SQLCODE = +100                              10950001
109600                 WHEN SQLCODE = -305                              10960001
109700                     CONTINUE                                     10970001
109800                 WHEN SQLCODE = -904                              10980001
109900                 WHEN SQLCODE = -913                              10990001
110000                     CONTINUE                                     11000001
110100                 WHEN SQLWARN0 NOT = SPACES                       11010001
110200                 WHEN SQLCODE < ZERO                              11020001
110300                 WHEN SQLCODE > ZERO                              11030001
110400                     MOVE '6000-SHIP-INST-EDITS'                  11040001
110500                                   TO DP013-PARAGRAPH             11050001
110600                     MOVE '              '                        11060001
110700                                   TO DP013-MESSAGE-TEXT (1)      11070001
110800                     MOVE SQLCA    TO DP013-SQLCA                 11080001
110900                     MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)  11090001
111000                     SET DP013-DB2-ABEND                          11100001
111100                         DP013-XCTL-DISPLAY-RESTART TO TRUE       11110001
111200                     PERFORM DP013-0000-PROCESS-ABEND             11120001
111300             END-EVALUATE                                         11130001
111400     END-PERFORM.                                                 11140001
111500*                                                                 11150001
111600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11160001
111700         MOVE '6000-SHIP-INST-EDITS' TO DP013-PARAGRAPH           11170001
111800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO GET TPURITM'11180001
111900                                   TO DP013-MESSAGE-TEXT (1)      11190001
112000         MOVE SQLCA                TO DP013-SQLCA                 11200001
112100         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    11210001
112200         SET DP013-DB2-ABEND                                      11220001
112300             DP013-XCTL-DISPLAY-RESTART                           11230001
112400                                   TO TRUE                        11240001
112500         PERFORM DP013-0000-PROCESS-ABEND                         11250001
112600     END-IF.                                                      11260001
112700                                                                  11270001
112800     PERFORM                                                      11280001
112900         WITH TEST AFTER                                          11290001
113000         VARYING PV-RETRY-COUNTER                                 11300001
113100         FROM 1 BY 1                                              11310001
113200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11320001
113300                   OR (SQLCODE = ZERO))                           11330001
113400         EXEC SQL                                                 11340001
113500             SELECT  COUNT (*)                                    11350001
113600                INTO :PV-DB2-COUNT2                               11360001
113700                FROM  TPURITM A                                   11370001
113800               WHERE A.PO_NBR         = :ASC-PO-NBR               11380001
113900                 AND A.VER_STATUS_CDE = 'A'                       11390001
114000                 AND A.STATUS_CDE NOT IN ('CA', 'CB')             11400001
114100                 AND NOT EXISTS                                   11410001
114200                    (SELECT *                                     11420001
114300                       FROM TALLPLN B                             11430001
114400                      WHERE A.PO_NBR     = B.PO_NBR               11440001
114500                        AND A.PO_LNE_NBR = B.PO_LNE_NBR)          11450001
114600         END-EXEC                                                 11460001
114700                                                                  11470001
114800         EVALUATE TRUE                                            11480001
114900                 WHEN SQLCODE = +0                                11490001
115000                     CONTINUE                                     11500001
115100                 WHEN SQLCODE = +100                              11510001
115200                 WHEN SQLCODE = -305                              11520001
115300                     CONTINUE                                     11530001
115400                 WHEN SQLCODE = -904                              11540001
115500                 WHEN SQLCODE = -913                              11550001
115600                     CONTINUE                                     11560001
115700                 WHEN SQLWARN0 NOT = SPACES                       11570001
115800                 WHEN SQLCODE < ZERO                              11580001
115900                 WHEN SQLCODE > ZERO                              11590001
116000                     MOVE '6000-SHIP-INST-EDITS'                  11600001
116100                                   TO DP013-PARAGRAPH             11610001
116200                     MOVE 'CHECK NOT EXISTS'                      11620001
116300                                   TO DP013-MESSAGE-TEXT (1)      11630001
116400                     MOVE SQLCA    TO DP013-SQLCA                 11640001
116500                     MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)  11650001
116600                     SET DP013-DB2-ABEND                          11660001
116700                         DP013-XCTL-DISPLAY-RESTART TO TRUE       11670001
116800                     PERFORM DP013-0000-PROCESS-ABEND             11680001
116900             END-EVALUATE                                         11690001
117000     END-PERFORM.                                                 11700001
117100*                                                                 11710001
117200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11720001
117300         MOVE '6000-SHIP-INST-EDITS'  TO DP013-PARAGRAPH          11730001
117400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO GET TPURITM'11740001
117500                                   TO DP013-MESSAGE-TEXT (1)      11750001
117600         MOVE SQLCA                TO DP013-SQLCA                 11760001
117700         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    11770001
117800         SET DP013-DB2-ABEND                                      11780001
117900             DP013-XCTL-DISPLAY-RESTART                           11790001
118000                                   TO TRUE                        11800001
118100         PERFORM DP013-0000-PROCESS-ABEND                         11810001
118200     END-IF.                                                      11820001
118300     IF PV-DB2-COUNT1 > 0 OR                                      11830001
118400        PV-DB2-COUNT2 > 0                                         11840001
118500         SET PS-ERROR              TO TRUE                        11850001
118600         SET DP020-MSG-FATAL       TO TRUE                        11860001
118700*        --- ORDER NOT ALLOCATED ---                              11870001
118800         MOVE PC-TSYMSG-00754      TO DP020-MSG-NUMBER            11880001
118900     END-IF.                                                      11890001
119000                                                                  11900001
119100                                                                  11910001
119200*----------------------------------------------------------------*11920001
119300*  CONTROLS PROCESSING FOR SUBMITTING SHIPPING INSTRUCTION REPORT*11930001
119400*----------------------------------------------------------------*11940001
119500 6500-SUBMIT-SI-REPORT.                                           11950001
119600                                                                  11960001
119700     PERFORM 5100-GET-USER-SYSTEM.                                11970001
119800     PERFORM 5150-GET-PACKAGE-CODE.                               11980001
119900     IF PV-CIT1-CICS                                              11990001
120000         MOVE PV-USER-ID           TO PV-TEST-JOB-USER-ID         12000001
120100                                      PC-TEST-NOTIFY-ID           12010001
120200         MOVE PV-TEST-JOB          TO JL-JOB-NAME                 12020001
120300         MOVE PC-TEST-CLASS        TO JL-JCL-CLASS                12030001
120400         MOVE PC-TEST-LIBSRCH      TO JL-JCL-LIBSRCH              12040001
120500         MOVE PC-TEST-JOB-PARM     TO JL-JCL-JOB-PARM             12050001
120600         MOVE PC-TEST-JOBLIB       TO JL-JCL-JOBLIB               12060001
120700         MOVE PC-TEST-JOBOUT2AA    TO JL-JCL-OUTPUT1              12070001
120800         MOVE PC-TEST-JOBOUT2C     TO JL-JCL-OUTPUT2              12080001
120900         MOVE PC-TEST-JOBOUT3      TO JL-JCL-OUTPUT3              12090001
121000         MOVE PC-TEST-JOBOUT3      TO JL-JCL-OUTPUT4              12100001
121100           IF PURCHS-PKGNG-CDE = 'M' OR 'I'                       12110001
121200               MOVE PC-TEST-PROC-SI-PK                            12120001
121300                                   TO JL-JCL-PROC                 12130001
121400           ELSE                                                   12140001
121500               MOVE PC-TEST-PROC-SI                               12150001
121600                                   TO JL-JCL-PROC                 12160001
121700           END-IF                                                 12170001
121800     ELSE                                                         12180001
121900       IF PV-CIQA-CICS                                            12190001
122000         CONTINUE                                                 12200001
122100       ELSE                                                       12210001
122200         PERFORM 7000-BUYER-INFORMATION                           12220001
122300         MOVE PC-PROD-JOB-POK902   TO JL-JOB-NAME                 12230001
122400         MOVE PC-PROD-CLASS        TO JL-JCL-CLASS                12240001
122500         MOVE PC-PROD-LIBSRCH      TO JL-JCL-LIBSRCH              12250001
122600         MOVE PC-PROD-JOB-PARM     TO JL-JCL-JOB-PARM             12260001
122700         MOVE PC-PROD-JOBLIB       TO JL-JCL-JOBLIB               12270001
122800         MOVE PC-PROD-JOBOUT1B     TO JL-JCL-OUTPUT1              12280001
122900         MOVE PC-PROD-JOBOUT2      TO JL-JCL-OUTPUT2              12290001
123000         MOVE PC-PROD-JOBOUT3      TO JL-JCL-OUTPUT3              12300001
123100         MOVE PC-PROD-JOBOUT4      TO JL-JCL-OUTPUT4              12310001
123200           IF PURCHS-PKGNG-CDE = 'M' OR 'I'                       12320001
123300               MOVE PC-PROD-PROC-SI-PK                            12330001
123400                                   TO JL-JCL-PROC                 12340001
123500           ELSE                                                   12350001
123600               MOVE PC-PROD-PROC-SI                               12360001
123700                                   TO JL-JCL-PROC                 12370001
123800           END-IF                                                 12380001
123900       END-IF                                                     12390001
124000     END-IF.                                                      12400001
124100                                                                  12410001
124200     MOVE ASC-PO-NBR               TO JL-PO-NBR.                  12420001
124300     MOVE SPACES                   TO JL-PRINT-TYPE-BY            12430001
124400                                      JL-PRINT-TYPE-VN            12440001
124500                                      JL-PRINT-TYPE-AN            12450001
124600                                      JL-PRINT-TYPE-DC.           12460001
124700     IF ASC-VEND-IND = 'Y'                                        12470001
124800         IF ASC-SUP-RETAIL = 'Y'                                  12480001
124900             MOVE 'VS'             TO JL-PRINT-TYPE-VN            12490001
125000         ELSE                                                     12500001
125100             MOVE 'VN'             TO JL-PRINT-TYPE-VN            12510001
125200         END-IF                                                   12520001
125300     END-IF.                                                      12530001
125400                                                                  12540001
125500     IF ASC-BUY-IND = 'Y'                                         12550001
125600         MOVE 'BY'                 TO JL-PRINT-TYPE-BY            12560001
125700     END-IF.                                                      12570001
125800                                                                  12580001
125900     IF ASC-DC-IND = 'Y'                                          12590001
126000         MOVE 'DC'                 TO JL-PRINT-TYPE-DC            12600001
126100     END-IF.                                                      12610001
126200                                                                  12620001
126300     PERFORM 5200-TD-QUEUE-ENQ.                                   12630001
126400     PERFORM                                                      12640001
126500         VARYING JL-LINE-INDEX                                    12650001
126600         FROM 1 BY 1                                              12660001
126700         UNTIL JL-LINE-INDEX > 18                                 12670001
126800             MOVE JL-JCL-LINE (JL-LINE-INDEX)                     12680001
126900                                   TO TD-JCL-LINE                 12690001
127000             PERFORM 5300-WRITE-TRANS-DATA-LINE                   12700001
127100     END-PERFORM.                                                 12710001
127200     PERFORM 5400-TD-QUEUE-DEQ.                                   12720001
127300                                                                  12730001
127400*----------------------------------------------------------------*12740001
127500* RETRIEVE BUYER INFORMATION TO DISPLAY ON BANNER PAGE           *12750001
127600*----------------------------------------------------------------*12760001
127700                                                                  12770001
127800 7000-BUYER-INFORMATION.                                          12780001
127900                                                                  12790001
128000     PERFORM 7100-GET-BUYER-NUMBER.                               12800001
128100     PERFORM 7200-GET-BUYER-NAME.                                 12810001
128200     MOVE PV-BUYER-NAME TO PV-BYR-NAME                            12820001
128300                           PV-PROD-BYR-NAME.                      12830001
128400     MOVE PV-BUYER-NUMBER TO PV-BYR-NBR.                          12840001
128500     MOVE PV-BUYER TO PV-PROD-BYR-NAME-NO.                        12850001
128600                                                                  12860001
128700*----------------------------------------------------------------*12870001
128800* GET BUYER NUMBER FROM TMDSEAR                                  *12880001
128900*----------------------------------------------------------------*12890001
129000                                                                  12900001
129100 7100-GET-BUYER-NUMBER.                                           12910001
129200                                                                  12920001
129300     EXEC SQL                                                     12930001
129400         SELECT BYR_NBR,                                          12940001
129500                MDSEAR_DKEY                                       12950001
129600           INTO :MDSEAR-BYR-NBR,                                  12960001
129700                :MDSEAR-DKEY                                      12970001
129800           FROM TMDSEAR                                           12980001
129900          WHERE OPERCO_NBR = '03'                                 12990001
130000            AND MDSELV_CDE = 'DPT'                                13000001
130100            AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE         13010001
130200            AND DEPT_NBR = :ASC-DPT-NBR                           13020001
130300     END-EXEC.                                                    13030001
130400                                                                  13040001
130500     EVALUATE TRUE                                                13050001
130600         WHEN SQLCODE = ZERO                                      13060001
130700             MOVE MDSEAR-BYR-NBR  TO PV-BUYER-NUMBER              13070001
130800         WHEN SQLCODE = +100                                      13080001
130900             MOVE SPACES          TO PV-BUYER-NUMBER              13090001
131000             MOVE ZEROES          TO MDSEAR-DKEY                  13100001
131100         WHEN SQLCODE = -904                                      13110001
131200         WHEN SQLCODE = -911                                      13120001
131300         WHEN SQLCODE = -913                                      13130001
131400              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       13140001
131500              SET PS-ERROR                                        13150001
131600                  DP020-NEXT-ACT-APPL-ERROR                       13160001
131700                  DP020-MSG-FATAL                                 13170001
131800                      TO TRUE                                     13180001
131900              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 13190001
132000              PERFORM 0001-CALL-CICS-ARCH-API                     13200001
132100         WHEN SQLWARN0 NOT = SPACES                               13210001
132200         WHEN SQLCODE  NOT = ZERO                                 13220001
132300              MOVE '7100-GET-BUYER-NUMBER' TO DP013-PARAGRAPH     13230001
132400              MOVE 'UNSUCCESSFUL SELECT BUYER NUMBER' TO          13240001
132500                                            DP013-MESSAGE-TEXT (1)13250001
132600              MOVE SQLCA TO DP013-SQLCA                           13260001
132700              MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)         13270001
132800              SET DP013-DB2-ABEND                                 13280001
132900                  DP013-XCTL-DISPLAY-RESTART TO TRUE              13290001
133000                                                                  13300001
133100              PERFORM DP013-0000-PROCESS-ABEND                    13310001
133200     END-EVALUATE.                                                13320001
133300                                                                  13330001
133400*----------------------------------------------------------------*13340001
133500* GET BUYER NAME FROM TRSPBAR                                    *13350001
133600*----------------------------------------------------------------*13360001
133700                                                                  13370001
133800 7200-GET-BUYER-NAME.                                             13380001
133900                                                                  13390001
134000     MOVE SPACES         TO PV-BUYER-NAME.                        13400001
134100                                                                  13410001
134200     EXEC SQL                                                     13420001
134300          SELECT DISTINCT(WORKER_LAST_NAME), WORKER_FIR_NAME      13430001
134400            INTO :RSPBAR-WORKER-LAST-NAME,                        13440001
134500                 :RSPBAR-WORKER-FIR-NAME                          13450001
134600          FROM TRSPBAR                                            13460001
134700          WHERE MDSEAR_DKEY = :MDSEAR-DKEY                        13470001
134800            AND RSPLVL_CDE  = 'BYR'                               13480001
134900            AND CURRENT DATE BETWEEN WORKER_STRT_DTE AND          13490001
135000                                     WORKER_END_DTE               13500001
135100     END-EXEC.                                                    13510001
135200                                                                  13520001
135300     EVALUATE TRUE                                                13530001
135400       WHEN SQLCODE = ZEROS                                       13540001
135410         INSPECT RSPBAR-WORKER-FIR-NAME  REPLACING ALL            13541002
135420                 '''' BY '_'                                      13542002
135430         INSPECT RSPBAR-WORKER-LAST-NAME REPLACING ALL            13543002
135440                 '''' BY '_'                                      13544002
135500         STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' '          13550001
135600                ' '                     DELIMITED BY SIZE         13560001
135700                RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE         13570001
135800                                     INTO PV-BUYER-NAME           13580001
135900       WHEN SQLCODE = +100                                        13590001
136000           MOVE SPACES TO PV-BUYER-NAME                           13600001
136100       WHEN SQLCODE = -904                                        13610001
136200       WHEN SQLCODE = -911                                        13620001
136300       WHEN SQLCODE = -913                                        13630001
136400            MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER         13640001
136500            SET PS-ERROR                                          13650001
136600                DP020-NEXT-ACT-APPL-ERROR                         13660001
136700                DP020-MSG-FATAL                                   13670001
136800                    TO TRUE                                       13680001
136900            MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1)   13690001
137000            PERFORM 0001-CALL-CICS-ARCH-API                       13700001
137100       WHEN OTHER                                                 13710001
137200            MOVE '7200-GET-BUYER-NAME  ' TO DP013-PARAGRAPH       13720001
137300            MOVE 'UNSUCCESSFUL SELECT BUYER NAME' TO              13730001
137400                                            DP013-MESSAGE-TEXT (1)13740001
137500            MOVE SQLCA TO DP013-SQLCA                             13750001
137600            MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)           13760001
137700            SET DP013-DB2-ABEND                                   13770001
137800                DP013-XCTL-DISPLAY-RESTART TO TRUE                13780001
137900                                                                  13790001
138000            PERFORM DP013-0000-PROCESS-ABEND                      13800001
138100     END-EVALUATE.                                                13810001
138200*----------------------------------------------------------------*13820001
138300*    ABEND PROCESSOR MODULE                                      *13830001
138400*----------------------------------------------------------------*13840001
138500                                                                  13850001
138600     COPY DPPD013.                                                13860001
