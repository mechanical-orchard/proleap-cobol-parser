000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             SVKRP042.                                00030005
000400 AUTHOR.                 MADHURA PETHE.                           00040017
000500 INSTALLATION.           KOHLS.                                   00050000
000600 DATE-WRITTEN            JULY 2012.                               00060017
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*  INCOMM/STORED VALUE SETTLEMENT AND AUDIT REPORTING           * 00100022
001100******************************************************************00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 CONFIGURATION SECTION.                                           00130000
001400                                                                  00140000
001500 SOURCE-COMPUTER.        IBM-3090.                                00150000
001600 OBJECT-COMPUTER.        IBM-3090.                                00160000
001700                                                                  00170000
001800 INPUT-OUTPUT SECTION.                                            00180000
001900                                                                  00190000
002000 FILE-CONTROL.                                                    00200000
002100     SELECT DATE-CARD-FILE                                        00210000
002200         ASSIGN TO INP01.                                         00220000
002300                                                                  00230000
002400     SELECT REPORT-FILE-IN                                        00240000
002500         ASSIGN TO INP02.                                         00250000
002600                                                                  00260000
002700     SELECT SETTLED-REPORT                                        00270000
002800         ASSIGN TO RPT01.                                         00280000
002900                                                                  00290000
003000     SELECT UNSETTLED-REPORT                                      00300000
003100         ASSIGN TO RPT02.                                         00310000
003200                                                                  00320017
003300     SELECT SETTLED-CSV-FILE                                      00330000
003400         ASSIGN TO CSV01.                                         00340000
003500                                                                  00350000
003600******************************************************************00360000
003700 DATA DIVISION.                                                   00370000
003800 FILE SECTION.                                                    00380000
003900                                                                  00390000
004000 FD  DATE-CARD-FILE                                               00400000
004100     RECORDING MODE IS F                                          00410000
004200     BLOCK CONTAINS 0 RECORDS                                     00420000
004300     LABEL RECORDS ARE STANDARD.                                  00430000
004400                                                                  00440000
004500 01  DATE-CARD-RECORD                       PIC X(80).            00450000
004600                                                                  00460000
004700 FD  REPORT-FILE-IN                                               00470000
004800     RECORDING MODE IS F                                          00480000
004900     BLOCK CONTAINS 0 RECORDS                                     00490000
005000     LABEL RECORDS ARE STANDARD.                                  00500000
005100                                                                  00510000
005200 01  REPORT-RECORD                          PIC X(250).           00520007
005300                                                                  00530000
005400 FD  SETTLED-REPORT                                               00540000
005500     RECORDING MODE IS F                                          00550000
005600     BLOCK CONTAINS 0 RECORDS                                     00560000
005700     LABEL RECORDS ARE STANDARD.                                  00570000
005800                                                                  00580000
005900 01  SETTLED-RECORD                         PIC X(255).           00590011
006000                                                                  00600000
006100 FD  UNSETTLED-REPORT                                             00610000
006200     RECORDING MODE IS F                                          00620000
006300     LABEL RECORDS ARE STANDARD                                   00630000
006400     BLOCK CONTAINS 0 RECORDS.                                    00640000
006500                                                                  00650000
006600 01  UNSETTLED-RECORD                       PIC X(255).           00660011
006700                                                                  00670000
006800 FD  SETTLED-CSV-FILE                                             00680000
006900     RECORDING MODE IS F                                          00690000
007000     BLOCK CONTAINS 0 RECORDS                                     00700000
007100     LABEL RECORDS ARE STANDARD.                                  00710000
007200                                                                  00720000
007300 01  SETTLED-CSV-RECORD                     PIC X(255).           00730011
007400                                                                  00740000
007500******************************************************************00750000
007600 WORKING-STORAGE SECTION.                                         00760000
007700******************************************************************00770000
007800                                                                  00780000
007900******************************************************************00790000
008000*  INCOMM  REPORT  RECORD LAYOUT                                 *00800001
008100******************************************************************00810000
008200     COPY SVRD072.                                                00820001
008300                                                                  00830000
008400******************************************************************00840000
008500*  KOHL'S STANDARD REPORT HEADING                                *00850000
008600******************************************************************00860000
008700     COPY DPWS132.                                                00870000
008800                                                                  00880000
008810*******************                                               00881004
008820* SETTLEMENT REPORT VARIABLES                                     00882004
008830*******************                                               00883004
008840                                                                  00884004
008900 01  RP1-HEADING-LINE-2.                                          00890000
009000     05  FILLER                       PIC  X(46)  VALUE SPACES.   00900000
009100     05  RP1-SUBTITLE.                                            00910000
009200         10  FILLER                   PIC  X(05)  VALUE SPACES.   00920000
009300         10  RP1-SUBNAME              PIC  X(24)  VALUE SPACES.   00930000
009400     05  FILLER                       PIC  X(01)  VALUE SPACES.   00940000
009500     05  RP1-DATE.                                                00950000
009600         10  RP1-DATE-MM              PIC  X(02).                 00960000
009700         10  FILLER                   PIC  X(01)  VALUE '/'.      00970000
009800         10  RP1-DATE-DD              PIC  X(02).                 00980000
009900         10  FILLER                   PIC  X(01)  VALUE '/'.      00990000
010000         10  RP1-DATE-CC              PIC  X(02).                 01000000
010100         10  RP1-DATE-YY              PIC  X(02).                 01010000
010200     05  FILLER                       PIC  X(46)  VALUE SPACES.   01020000
010300                                                                  01030000
010400 01  RP1-HEADING-LINE-3.                                          01040000
010500     05  FILLER                       PIC  X(42)  VALUE SPACES.   01050000
010600     05  FILLER                       PIC  X(53)  VALUE           01060000
010700        '--------------- VERIFIED TRANSACTIONS ---------------'.  01070011
010800     05  FILLER                       PIC  X(37)  VALUE SPACES.   01080000
010900                                                                  01090000
011000 01  RP1-HEADING-LINE-4.                                          01100000
011100     05  FILLER                       PIC  X(01)  VALUE SPACE.    01110000
011200     05  FILLER                       PIC  X(10)  VALUE           01120000
011300                                          'TRANS DATE'.           01130000
011400     05  FILLER                       PIC  X(04)  VALUE SPACES.   01140011
011500     05  FILLER                       PIC  X(07)  VALUE 'CARD ID'.01150000
011600     05  FILLER                       PIC  X(07)  VALUE SPACES.   01160000
011700     05  FILLER                       PIC  X(04)  VALUE 'TYPE'.   01170000
011800     05  FILLER                       PIC  X(10)  VALUE SPACES.   01180011
011900     05  FILLER                       PIC  X(09)  VALUE           01190000
012000                                          'TRANS AMT'.            01200000
012100     05  FILLER                       PIC  X(08)  VALUE SPACES.   01210011
012200     05  FILLER                       PIC  X(03)  VALUE 'UPC'.    01220011
012300     05  FILLER                       PIC  X(08)  VALUE SPACES.   01230011
012400     05  FILLER                       PIC  X(11)  VALUE           01240011
012500                                          'INCOMM REF#'.          01250011
012600     05  FILLER                       PIC  X(03)  VALUE SPACES.   01260016
012700     05  FILLER                       PIC  X(08)  VALUE           01270021
012800                                          'MERCHANT'.             01280004
012900     05  FILLER                       PIC  X(09)  VALUE SPACES.   01290021
013200     05  FILLER                       PIC  X(08)  VALUE           01320000
013300                                          'LOCATION'.             01330004
013400     05  FILLER                       PIC  X(03)  VALUE SPACES.   01340000
013600                                                                  01360000
013700 01  RP1-DETAIL-LINE.                                             01370000
013800     05  FILLER                       PIC  X(01)  VALUE SPACE.    01380000
013900     05  RP1-TRANS-DATE               PIC  X(10)  VALUE SPACES.   01390000
014000     05  FILLER                       PIC  X(02)  VALUE SPACES.   01400011
014100     05  RP1-CARD-ID                  PIC  ZZZZZZZZZZZZ.          01410011
014200     05  FILLER                       PIC  X(02)  VALUE SPACES.   01420000
014300     05  RP1-CARD-TYPE                PIC  X(10)  VALUE SPACES.   01430011
014400     05  FILLER                       PIC  X(02)  VALUE SPACES.   01440000
014500     05  RP1-TRANS-AMT                PIC  ----,-99.99.           01450011
014600     05  FILLER                       PIC  X(02)  VALUE SPACES.   01460000
014700     05  RP1-UPC-NBR                  PIC  ZZZZZZZZZZZZZ99.       01470016
014800     05  FILLER                       PIC  X(02)  VALUE SPACES.   01480011
014900     05  RP1-INCOMM-REF-NO            PIC  ZZZZZZZZZZ99.          01490016
015000     05  FILLER                       PIC  X(02)  VALUE SPACES.   01500016
015100     05  RP1-MERCHANT                 PIC  X(15)  VALUE SPACES.   01510021
015200     05  FILLER                       PIC  X(04)  VALUE SPACES.   01520016
015300     05  RP1-LOCATION                 PIC  X(40)  VALUE SPACES.   01530011
015400     05  FILLER                       PIC  X(02)  VALUE SPACES.   01540011
015700                                                                  01570000
010400 01  RP1-EMPTY-LINE.                                              01570123
010500     05  FILLER                       PIC  X(42)  VALUE SPACES.   01570223
010600     05  FILLER                       PIC  X(53)  VALUE           01570323
010700        '--------------- NO DATA TO REPORT -------------------'.  01570423
010800     05  FILLER                       PIC  X(37)  VALUE SPACES.   01570523
010900                                                                  01570623
015710*****************                                                 01571017
015720* CSV FILE VARIABLES                                              01572017
015730*****************                                                 01573017
015800 01  CSV-HEADER.                                                  01580000
015900     05  CSH-TRANS-DATE               PIC  X(09)  VALUE           01590016
016000         'TRANSDATE'.                                             01600000
016100     05  FILLER                       PIC  X(01)  VALUE ','.      01610000
016200     05  CSH-CARD-ID                  PIC  X(10)  VALUE           01620016
016300         'CARDNUMBER'.                                            01630000
016400     05  FILLER                       PIC  X(01)  VALUE ','.      01640000
016500     05  CSH-CARD-TYPE                PIC  X(08)  VALUE           01650000
016600         'CARDTYPE'.                                              01660000
016700     05  FILLER                       PIC  X(01)  VALUE ','.      01670000
016800     05  CSH-TRANS-AMT                PIC  X(08)  VALUE           01680016
016900         'TRANSAMT'.                                              01690000
017000     05  FILLER                       PIC  X(01)  VALUE ','.      01700000
017100     05  CSH-UPC                      PIC  X(03)  VALUE 'UPC'.    01710007
017200     05  FILLER                       PIC  X(01)  VALUE ','.      01720000
017201     05  CSH-INCOMM-REF-NO            PIC  X(10)  VALUE           01720116
017202                                                  'INCOMMREF#'.   01720216
017400     05  FILLER                       PIC  X(01)  VALUE ','.      01740000
017500     05  CSH-MERCHANT                 PIC  X(08)  VALUE           01750007
017510                                                  'MERCHANT'.     01751007
017600     05  FILLER                       PIC  X(01)  VALUE ','.      01760000
017610     05  CSH-LOCATION                 PIC  X(08)  VALUE           01761007
017620                                                  'LOCATION'.     01762007
017700                                                                  01770000
017800 01  CSV-DETAIL.                                                  01780000
017900     05  CSV-TRANS-DATE               PIC  X(10)  VALUE SPACES.   01790000
018000     05  FILLER                       PIC  X(01)  VALUE ','.      01800016
018100     05  CSV-CARD-ID                  PIC  ZZZZZZZZZZZZ.          01810016
018200     05  FILLER                       PIC  X(01)  VALUE ','.      01820000
018300     05  CSV-CARD-TYPE                PIC  X(10)  VALUE SPACES.   01830011
018400     05  FILLER                       PIC  X(01)  VALUE ','.      01840000
018500     05  CSV-TRANS-AMT                PIC  ----,---,-99.99.       01850016
018600     05  FILLER                       PIC  X(01)  VALUE ','.      01860000
018610     05  CSV-UPC-NBR                  PIC  ZZZZZZZZZZZZZ99.       01861016
018620     05  FILLER                       PIC  X(01)  VALUE ','.      01862007
018630     05  CSV-INCOMM-REF-NO            PIC  ZZZZZZZZZZ99.          01863016
018640     05  FILLER                       PIC  X(01)  VALUE ','.      01864007
019100     05  CSV-MERCHANT                 PIC  X(15)  VALUE SPACES.   01910021
019200     05  FILLER                       PIC  X(01)  VALUE ','.      01920000
019210     05  CSV-LOCATION                 PIC  X(40)  VALUE SPACES.   01921014
019300                                                                  01930000
019310*****************                                                 01931017
019320* TOTAL REPORT VARIABLES                                          01932017
019330*****************                                                 01933017
019400 01  RPT-TOTAL-LINE-HEADER-1.                                     01940012
019401     05  FILLER                       PIC  X(40)  VALUE SPACE.    01940112
019402     05  FILLER                       PIC  X(60)  VALUE           01940212
019403           ' ---------- MISSING KOHLS TRANSACTIONS -----'.        01940312
019404     05  FILLER                       PIC  X(01)  VALUE SPACE.    01940412
019405                                                                  01940512
019406 01  RPT-TOTAL-LINE-HEADER-2.                                     01940612
019407     05  FILLER                       PIC  X(40)  VALUE SPACE.    01940712
019408     05  FILLER                       PIC  X(60)  VALUE           01940812
019409           ' ---------- MISSING INCOMM TRANSACTIONS ----'.        01940912
019410     05  FILLER                       PIC  X(01)  VALUE SPACE.    01941012
019411                                                                  01941112
019420 01  RPT-TOTAL-LINE-1.                                            01942004
019500     05  FILLER                       PIC  X(01)  VALUE SPACE.    01950000
019600     05  FILLER                       PIC  X(06)  VALUE 'TOTALS'. 01960000
019700     05  FILLER                       PIC  X(14)  VALUE SPACES.   01970000
019800     05  FILLER                       PIC  X(11)  VALUE           01980004
019900                                          'ACTIVATIONS'.          01990004
020000     05  FILLER                       PIC  X(18)  VALUE SPACES.   02000000
020100     05  FILLER                       PIC  X(13)  VALUE           02010000
020200                                          'DEACTIVATIONS'.        02020004
020300     05  FILLER                       PIC  X(13)  VALUE SPACES.   02030000
020400     05  FILLER                       PIC  X(22)  VALUE           02040004
020500                                      'REVERSALS (ACTIVATION)'.   02050004
020600     05  FILLER                       PIC  X(12)  VALUE SPACES.   02060000
020700     05  FILLER                       PIC  X(24)  VALUE           02070004
020800                                      'REVERSALS (DEACTIVATION)'. 02080004
020900     05  FILLER                       PIC  X(20)  VALUE SPACES.   02090000
021000                                                                  02100000
021100 01  RPT-TOTAL-LINE-2.                                            02110000
021200     05  FILLER                       PIC  X(14)  VALUE SPACE.    02120000
021300     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 02130000
021400     05  FILLER                       PIC  X(11)  VALUE SPACES.   02140018
021500     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 02150000
021600     05  FILLER                       PIC  X(06)  VALUE SPACES.   02160000
021700     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 02170000
021800     05  FILLER                       PIC  X(12)  VALUE SPACES.   02180018
021900     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 02190000
022000     05  FILLER                       PIC  X(06)  VALUE SPACES.   02200000
022100     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 02210000
022200     05  FILLER                       PIC  X(12)  VALUE SPACES.   02220018
022300     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 02230000
022400     05  FILLER                       PIC  X(07)  VALUE SPACES.   02240000
022500     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 02250000
022600     05  FILLER                       PIC  X(11)  VALUE SPACES.   02260018
022700     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 02270000
022800     05  FILLER                       PIC  X(20)  VALUE SPACES.   02280018
022900                                                                  02290000
023000 01  RPT-TOTAL-DETAIL-LINE.                                       02300000
023100     05  FILLER                       PIC  X(01)  VALUE SPACE.    02310000
023200     05  TOTAL-DATE                   PIC  X(10)  VALUE SPACES.   02320000
023300     05  FILLER                       PIC  X(02)  VALUE SPACES.   02330000
023400     05  TOTAL-ACT-NBR                PIC  ZZZ,ZZ9.               02340004
023500     05  FILLER                       PIC  X(03)  VALUE SPACES.   02350000
023600     05  TOTAL-ACT-AMT                PIC  ---,---,-99.99.        02360012
023700     05  FILLER                       PIC  X(05)  VALUE SPACES.   02370000
023800     05  TOTAL-DEACT-NBR              PIC  ZZZ,ZZ9.               02380004
023900     05  FILLER                       PIC  X(04)  VALUE SPACES.   02390000
024000     05  TOTAL-DEACT-AMT              PIC  ---,---,-99.99.        02400012
024100     05  FILLER                       PIC  X(05)  VALUE SPACES.   02410000
024200     05  TOTAL-REV-ACT-NBR            PIC  ZZZ,ZZ9.               02420004
024300     05  FILLER                       PIC  X(04)  VALUE SPACES.   02430000
024400     05  TOTAL-REV-ACT-AMT            PIC  ---,---,-99.99.        02440012
024500     05  FILLER                       PIC  X(06)  VALUE SPACES.   02450000
024600     05  TOTAL-REV-DEACT-NBR          PIC  ZZZ,ZZ9.               02460004
024700     05  FILLER                       PIC  X(03)  VALUE SPACES.   02470000
024800     05  TOTAL-REV-DEACT-AMT          PIC  ---,---,-99.99.        02480012
024900     05  FILLER                       PIC  X(10)  VALUE SPACES.   02490000
025000                                                                  02500000
025100 01  END-OF-REPORT-LINE.                                          02510000
025200     05  FILLER                       PIC  X(51)  VALUE SPACE.    02520000
025300     05  FILLER                       PIC  X(29)  VALUE           02530000
025400         '*****   END OF REPORT   *****'.                         02540000
025500     05  FILLER                       PIC  X(52)  VALUE SPACE.    02550000
025600                                                                  02560000
025601**********************                                            02560104
025602*  AUDIT REPORT VARIABLES                                         02560204
025603**********************                                            02560304
025610 01  RP2-HEADING-LINE-2.                                          02561004
025620     05  FILLER                       PIC  X(46)  VALUE SPACES.   02562004
025630     05  RP2-SUBTITLE.                                            02563004
025640         10  FILLER                   PIC  X(05)  VALUE SPACES.   02564004
025650         10  RP2-SUBNAME              PIC  X(24)  VALUE SPACES.   02565004
025660     05  FILLER                       PIC  X(01)  VALUE SPACES.   02566004
025670     05  RP2-DATE.                                                02567004
025680         10  RP2-DATE-MM              PIC  X(02).                 02568004
025690         10  FILLER                   PIC  X(01)  VALUE '/'.      02569004
025691         10  RP2-DATE-DD              PIC  X(02).                 02569104
025692         10  FILLER                   PIC  X(01)  VALUE '/'.      02569204
025693         10  RP2-DATE-CC              PIC  X(02).                 02569304
025694         10  RP2-DATE-YY              PIC  X(02).                 02569404
025695     05  FILLER                       PIC  X(46)  VALUE SPACES.   02569504
025696                                                                  02569604
025697 01  RP2-HEADING-LINE-3.                                          02569704
025698     05  FILLER                       PIC  X(42)  VALUE SPACES.   02569804
025699     05  FILLER                       PIC  X(53)  VALUE           02569904
025700        '---------------- MISSING TRANSACTIONS ---------------'.  02570011
025701     05  FILLER                       PIC  X(37)  VALUE SPACES.   02570104
025702                                                                  02570204
025703 01  RP2-HEADING-LINE-4.                                          02570304
025704     05  FILLER                       PIC  X(01)  VALUE SPACE.    02570404
025705     05  FILLER                       PIC  X(10)  VALUE           02570504
025706                                          'TRANS DATE'.           02570604
025707     05  FILLER                       PIC  X(04)  VALUE SPACES.   02570711
025708     05  FILLER                       PIC  X(07)  VALUE 'CARD ID'.02570804
025709     05  FILLER                       PIC  X(07)  VALUE SPACES.   02570904
025710     05  FILLER                       PIC  X(04)  VALUE 'TYPE'.   02571004
025711     05  FILLER                       PIC  X(10)  VALUE SPACES.   02571111
025712     05  FILLER                       PIC  X(09)  VALUE           02571204
025713                                          'TRANS AMT'.            02571304
025714     05  FILLER                       PIC  X(08)  VALUE SPACES.   02571411
025715     05  FILLER                       PIC  X(03)  VALUE 'UPC'.    02571511
025716     05  FILLER                       PIC  X(08)  VALUE SPACES.   02571611
025717     05  FILLER                       PIC  X(11)  VALUE           02571708
025718                                          'INCOMM REF#'.          02571804
025719     05  FILLER                       PIC  X(08)  VALUE SPACES.   02571911
025720     05  FILLER                       PIC  X(12)  VALUE           02572011
025721                                          'INCOMM-VAN16'.         02572104
025722     05  FILLER                       PIC  X(05)  VALUE SPACES.   02572211
025723     05  FILLER                       PIC  X(16)  VALUE           02572314
025724                                          'STORE/MERCH NAME'.     02572414
025725     05  FILLER                       PIC  X(10)  VALUE SPACES.   02572515
025729     05  FILLER                       PIC  X(08)  VALUE           02572904
025730                                          'MERCHANT'.             02573004
025731     05  FILLER                       PIC  X(09)  VALUE SPACES.   02573121
025732     05  FILLER                       PIC  X(08)  VALUE           02573204
025733                                          'LOCATION'.             02573304
025734     05  FILLER                       PIC  X(40)  VALUE SPACES.   02573411
025735     05  FILLER                       PIC  X(13)  VALUE           02573511
025736                                          'ERROR MESSAGE'.        02573611
025737                                                                  02573704
025738 01  RP2-DETAIL-LINE.                                             02573804
025739     05  FILLER                       PIC  X(01)  VALUE SPACE.    02573904
025740     05  RP2-TRANS-DATE               PIC  X(10)  VALUE SPACES.   02574004
025741     05  FILLER                       PIC  X(02)  VALUE SPACES.   02574111
025742     05  RP2-CARD-ID                  PIC  ZZZZZZZZZZZZ.          02574211
025743     05  FILLER                       PIC  X(02)  VALUE SPACES.   02574304
025744     05  RP2-CARD-TYPE                PIC  X(10)  VALUE SPACES.   02574411
025745     05  FILLER                       PIC  X(02)  VALUE SPACES.   02574504
025746     05  RP2-TRANS-AMT                PIC  ----,-99.99.           02574611
025747     05  FILLER                       PIC  X(02)  VALUE SPACES.   02574704
025748     05  RP2-UPC-NBR                  PIC  ZZZZZZZZZZZZZ99.       02574816
025749     05  FILLER                       PIC  X(02)  VALUE SPACES.   02574911
025750     05  RP2-INCOMM-REF-NO            PIC  ZZZZZZZZZZ99.          02575016
025751     05  FILLER                       PIC  X(06)  VALUE SPACES.   02575111
025752     05  RP2-VAN16                    PIC  X(16)  VALUE SPACES.   02575211
025753     05  FILLER                       PIC  X(04)  VALUE SPACES.   02575311
025754     05  RP2-SELR-NM                  PIC  X(23)  VALUE SPACES.   02575414
025755     05  FILLER                       PIC  X(03)  VALUE SPACES.   02575520
025758     05  RP2-MERCHANT                 PIC  X(15)  VALUE SPACES.   02575821
025759     05  FILLER                       PIC  X(02)  VALUE SPACES.   02575911
025760     05  RP2-LOCATION                 PIC  X(40)  VALUE SPACES.   02576011
025761     05  FILLER                       PIC  X(02)  VALUE SPACES.   02576111
025762     05  RP2-ERROR-MESSAGE            PIC  X(30)  VALUE SPACES.   02576211
025763                                                                  02576304
025764**************                                                    02576422
025765* PROGRAM VARIABLES                                               02576522
025766**************                                                    02576622
025767                                                                  02576722
025873 01  PC-PROGRAM-CONSTANTS.                                        02587303
025880     05  PC-PROGRAM-NAME              PIC  X(08)  VALUE           02588003
025900                                                    'SVKRP042'.   02590001
026000     05  PC-LINES-PER-PAGE            PIC S9(04)  VALUE +60       02600000
026100                                                     COMP SYNC.   02610000
026200                                                                  02620000
026300 01  PS-PROGRAM-SWITCHES.                                         02630000
026400     05  PS-END-OF-REPORT-FILE-SW     PIC X(01)   VALUE 'N'.      02640000
026500         88  PS-END-OF-REPORT-FILE                VALUE 'Y'.      02650000
026600     05  PS-END-OF-CARD-FILE-SW       PIC X(01)   VALUE 'N'.      02660000
026700         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      02670000
026800     05  PS-DETAIL-RECORDS-YES-SW     PIC X(01)   VALUE 'N'.      02680000
026900         88  PS-DETAIL-RECORDS-YES                VALUE 'Y'.      02690000
027000                                                                  02700000
027100 01  PV-PROGRAM-VARIABLES.                                        02710000
027200     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACE.    02720000
027300     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACE.    02730000
027400     05  PV-DB2-OPERATION             PIC  X(30)  VALUE SPACE.    02740000
027500     05  PV-SUB1                      PIC S9(04)  COMP.           02750005
027510     05  PV-SUB2                      PIC S9(04)  COMP.           02751011
027520     05  PV-SUBV                      PIC S9(04)  COMP.           02752011
027530     05  PV-SUBK                      PIC S9(04)  COMP.           02753011
027540     05  PV-SUBI                      PIC S9(04)  COMP.           02754011
027600     05  PV-MAX-ARRAY                 PIC S9(04)  COMP.           02760000
027700     05  PV-MAX-SUB                   PIC S9(04) VALUE +1500 COMP.02770000
027800     05  PV-PAGE-COUNT                PIC S9(04)  VALUE +0 COMP.  02780000
027900     05  PV-PAGE-COUNT1               PIC S9(04)  VALUE +0 COMP.  02790000
028000     05  PV-LINE-COUNT                PIC S9(04)  VALUE +0 COMP.  02800000
028100     05  PV-LINE-COUNT1               PIC S9(04)  VALUE +0 COMP.  02810000
028200     05  PV-PREV-CARD-NBR             PIC S9(12)  VALUE +0 COMP-3.02820000
028300                                                                  02830000
028400 01  PV-REFORMAT-DATE.                                            02840000
028500     05  PV-REFORMAT-YEAR             PIC  9(04) VALUE ZEROES.    02850010
028600     05  FILLER                       PIC  X(01) VALUE '/'.       02860000
028700     05  PV-REFORMAT-MONTH            PIC  9(02) VALUE ZEROES.    02870010
028800     05  FILLER                       PIC  X(01) VALUE '/'.       02880000
028900     05  PV-REFORMAT-DAY              PIC  9(02) VALUE ZEROES.    02890010
029000                                                                  02900000
029100 01  PV-TRANS-DATE1.                                              02910011
029200     05  PV-YEAR1                     PIC  9(04) VALUE ZEROES.    02920011
029210     05  FILLER                       PIC  X(01) VALUE '/'.       02921009
029300     05  PV-MONTH1                    PIC  9(02) VALUE ZEROES.    02930011
029310     05  FILLER                       PIC  X(01) VALUE '/'.       02931009
029400     05  PV-DAY1                      PIC  9(02) VALUE ZEROES.    02940011
029500                                                                  02950000
029510 01  PV-TRANS-DATE2.                                              02951011
029520     05  PV-YEAR2                     PIC  9(04) VALUE ZEROES.    02952011
029530     05  FILLER                       PIC  X(01) VALUE '/'.       02953011
029540     05  PV-MONTH2                    PIC  9(02) VALUE ZEROES.    02954011
029550     05  FILLER                       PIC  X(01) VALUE '/'.       02955011
029560     05  PV-DAY2                      PIC  9(02) VALUE ZEROES.    02956011
029570                                                                  02957011
029600 01  PV-PROGRAM-ACCUMULATORS.                                     02960000
029610     03  PV-MATCH-TYPE-ENTRY OCCURS 3 TIMES.                      02961007
029700         05  PV-TOTAL-ENTRY OCCURS 1500 TIMES.                    02970005
029800             10  PV-DATE              PIC X(10)     VALUE SPACES. 02980011
029900             10  PV-ACT-NBR           PIC S9(09)    VALUE ZEROES. 02990005
030000             10  PV-ACT-AMT           PIC S9(09)V99 VALUE ZEROES. 03000005
030100             10  PV-DEACT-NBR         PIC S9(07)    VALUE ZEROES. 03010005
030200             10  PV-DEACT-AMT         PIC S9(09)V99 VALUE ZEROES. 03020005
030300             10  PV-REVERS-ACT-NBR    PIC S9(07)    VALUE ZEROES. 03030005
030400             10  PV-REVERS-ACT-AMT    PIC S9(09)V99 VALUE ZEROES. 03040005
030500             10  PV-REVERS-DEACT-NBR  PIC S9(07)    VALUE ZEROES. 03050005
030600             10  PV-REVERS-DEACT-AMT  PIC S9(09)V99 VALUE ZEROES. 03060005
030700                                                                  03070000
030800******************************************************************03080000
030900* RECORD LAYOUT FOR INPUT DATE CARD                               03090000
031000******************************************************************03100000
031100 01  CC-CONTROL-CARD.                                             03110000
031200     05  CC-DATE-CCYY-MM-DD.                                      03120000
031300         10  CC-CONTROL-DATE-CC       PIC  X(02)   VALUE SPACES.  03130000
031400         10  CC-CONTROL-DATE-YY       PIC  X(02)   VALUE SPACES.  03140000
031500         10  FILLER                   PIC  X(01)   VALUE SPACES.  03150000
031600         10  CC-CONTROL-DATE-MM       PIC  X(02)   VALUE SPACES.  03160000
031700         10  FILLER                   PIC  X(01)   VALUE SPACES.  03170000
031800         10  CC-CONTROL-DATE-DD       PIC  X(02)   VALUE SPACES.  03180000
031900      05  FILLER                      PIC  X(70)   VALUE SPACES.  03190000
032000                                                                  03200000
032100 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       03210000
032200                                                 COMP SYNC.       03220000
032300     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     03230000
032400     88  AC-TABLE-OVERFLOW                       VALUE +4004.     03240000
032500     88  AC-SQL-ERROR                            VALUE +4013.     03250000
032600     88  AC-DATE-ERROR                           VALUE +4019.     03260000
032700                                                                  03270000
032800 01  SD-SYSTEM-DATE.                                              03280000
032900     05  SD-SYSTEM-YEAR               PIC  9(04)  VALUE ZEROS.    03290007
033000     05  SD-SYSTEM-MONTH              PIC  9(02)  VALUE ZEROS.    03300000
033100     05  SD-SYSTEM-DAY                PIC  9(02)  VALUE ZEROS.    03310000
033200                                                                  03320000
033300 01  ST-SYSTEM-TIME.                                              03330000
033400     05  ST-SYSTEM-HOUR               PIC  9(02)  VALUE ZEROS.    03340000
033500     05  ST-SYSTEM-MINUTE             PIC  9(02)  VALUE ZEROS.    03350000
033600     05  FILLER                       PIC  9(04)  VALUE ZEROS.    03360000
033700                                                                  03370000
033800******************************************************************03380000
033900* DATE ROUTINE COPY MEMBERS                                       03390000
034000******************************************************************03400000
034100     COPY DPWS500.                                                03410000
034200                                                                  03420000
034300******************************************************************03430000
034400*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03440000
034500******************************************************************03450000
034600     COPY DPWS004.                                                03460000
034700                                                                  03470000
037000******************************************************************03700000
037100 PROCEDURE DIVISION.                                              03710000
037200******************************************************************03720000
037300 0000-PROGRAM-MAINLINE.                                           03730000
037400                                                                  03740000
037500     PERFORM 1000-INITIALIZE.                                     03750000
037600                                                                  03760000
037700     PERFORM 2000-PROCESS-REPORT-FILE                             03770000
037800       UNTIL PS-END-OF-REPORT-FILE.                               03780000
037900                                                                  03790000
038000     IF PV-SUBV > 0                                               03800011
038100        PERFORM 8000-WRITE-TOTAL-RP1                              03810011
038200     END-IF.                                                      03820011
038300                                                                  03830000
038310     IF PV-SUBK > 0 OR PV-SUBI > 0                                03831011
038320        PERFORM 8400-WRITE-TOTAL-RP2                              03832011
038330     END-IF.                                                      03833011
038340                                                                  03834011
038400     PERFORM 9000-EOJ-ROUTINE.                                    03840000
038500                                                                  03850000
038600     STOP RUN.                                                    03860000
038700                                                                  03870000
038800******************************************************************03880000
038900*  1000-INITIALIZE                                                03890000
039000******************************************************************03900000
039100 1000-INITIALIZE.                                                 03910000
039200                                                                  03920000
039300     OPEN INPUT  DATE-CARD-FILE                                   03930000
039400                 REPORT-FILE-IN                                   03940000
039500          OUTPUT SETTLED-REPORT                                   03950000
039600                 SETTLED-CSV-FILE                                 03960000
039700                 UNSETTLED-REPORT.                                03970000
039800     WRITE SETTLED-CSV-RECORD FROM CSV-HEADER                     03980000
039900                                                                  03990000
040000     MOVE ZEROS  TO  PV-PAGE-COUNT                                04000000
040100                     PV-PAGE-COUNT1                               04010000
040200                     PV-SUB1                                      04020007
040210                     PV-SUB2                                      04021011
040220                     PV-SUBV                                      04022011
040230                     PV-SUBK                                      04023011
040240                     PV-SUBI.                                     04024011
040300                                                                  04030000
040400     ACCEPT SD-SYSTEM-DATE  FROM DATE YYYYMMDD.                   04040007
040500     ACCEPT ST-SYSTEM-TIME  FROM TIME.                            04050000
040600                                                                  04060000
040700     MOVE SD-SYSTEM-MONTH          TO  DP132-RUN-MONTH.           04070007
040800     MOVE SD-SYSTEM-DAY            TO  DP132-RUN-DAY.             04080007
040900     MOVE SD-SYSTEM-YEAR           TO  DP132-RUN-YEAR.            04090007
040901                                                                  04090102
041000     MOVE ST-SYSTEM-HOUR           TO  DP132-RUN-HOUR.            04100000
041100     MOVE ST-SYSTEM-MINUTE         TO  DP132-RUN-MINUTE.          04110000
041200                                                                  04120000
041300     MOVE PC-PROGRAM-NAME          TO  DP132-PROGRAM-NAME.        04130022
041400                                                                  04140000
041410***  READ DATE CARD                                               04141017
041500     PERFORM 1400-PROCESS-CONTROL-CARD.                           04150000
041600                                                                  04160000
041610***  WRITE HEADER RECORD FOR SETTLED REPORT                       04161017
041700     PERFORM 5000-SETTLED-REPORT-HEADER3.                         04170022
041710     WRITE SETTLED-RECORD FROM RP1-HEADING-LINE-4 AFTER           04171011
041720            ADVANCING 1 LINE                                      04172011
041730     ADD +1 TO PV-LINE-COUNT.                                     04173011
041740                                                                  04174011
041750***  WRITE HEADER RECORD FOR UNSETTLED REPORT                     04175017
041800     PERFORM 6000-UNSETTLED-REPORT-HEADER2.                       04180022
041801     WRITE UNSETTLED-RECORD FROM RP2-HEADING-LINE-3               04180112
041802           AFTER ADVANCING 2 LINES.                               04180212
041810     WRITE UNSETTLED-RECORD FROM RP2-HEADING-LINE-4               04181022
041830          AFTER ADVANCING 1 LINE.                                 04183011
041840     ADD +3 TO PV-LINE-COUNT1.                                    04184012
041900                                                                  04190000
041910**** READ REPORT FILE IN.                                         04191022
042000     PERFORM 7000-READ-REPORT-FILE.                               04200000
042100                                                                  04210000
042200     IF PS-END-OF-REPORT-FILE                                     04220000
041710        WRITE SETTLED-RECORD FROM RP1-EMPTY-LINE AFTER            04221023
041720            ADVANCING 2 LINE                                      04222023
041730        ADD +2 TO PV-LINE-COUNT                                   04223023
                                                                        04223123
041810        WRITE UNSETTLED-RECORD FROM RP1-EMPTY-LINE                04224023
041830           AFTER ADVANCING 2 LINE                                 04225023
041840        ADD +2 TO PV-LINE-COUNT1                                  04226023
042400     ELSE                                                         04240000
042500         SET PS-DETAIL-RECORDS-YES TO TRUE                        04250000
042600     END-IF.                                                      04260000
042700                                                                  04270000
042800***************************************************************** 04280000
042900* 1400-PROCESS-CONTROL-CARD                                       04290000
043000* READ DATE CONTROL CARD FOR FISCAL MONTH-END DATE.               04300000
043100* CALL DATE ROUTINE TO GET MAX FISCAL PERIOD.                     04310000
043200***************************************************************** 04320000
043300 1400-PROCESS-CONTROL-CARD.                                       04330000
043400                                                                  04340000
043500     PERFORM 1410-READ-DATE-CARD-FILE.                            04350000
043600                                                                  04360000
043700     IF PS-END-OF-CARD-FILE                                       04370000
043800         MOVE '1400-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   04380000
043900         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  04390000
044000         SET AC-CONTROL-CARD-ERROR TO TRUE                        04400000
044100         PERFORM 9999-ABEND                                       04410000
044200     END-IF.                                                      04420000
044300                                                                  04430000
044400     PERFORM 9975-DATE-ROUTINE.                                   04440000
044500                                                                  04450000
044600     MOVE CC-CONTROL-DATE-CC       TO RP1-DATE-CC                 04460012
044610                                      RP2-DATE-CC.                04461012
044700     MOVE CC-CONTROL-DATE-YY       TO RP1-DATE-YY                 04470012
044710                                      RP2-DATE-YY.                04471012
044800     MOVE CC-CONTROL-DATE-MM       TO RP1-DATE-MM                 04480012
044810                                      RP2-DATE-MM.                04481012
044900     MOVE CC-CONTROL-DATE-DD       TO RP1-DATE-DD                 04490012
044910                                      RP2-DATE-DD.                04491012
045000                                                                  04500000
045100     DISPLAY 'SVKRP042 CONTROL CARD DATE: '                       04510001
045200                          CC-CONTROL-CARD.                        04520000
045300                                                                  04530000
045400******************************************************************04540000
045500* 1410-READ-DATE-CARD-FILE                                        04550000
045600******************************************************************04560000
045700 1410-READ-DATE-CARD-FILE.                                        04570000
045800                                                                  04580000
045900     READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     04590000
046000       AT END                                                     04600000
046100           SET PS-END-OF-CARD-FILE TO TRUE.                       04610000
046200                                                                  04620000
046300******************************************************************04630000
046400* 2000-PROCESS-REPORT-FILE                                       *04640000
046500******************************************************************04650000
046600 2000-PROCESS-REPORT-FILE.                                        04660000
046700                                                                  04670000
046710     INITIALIZE RP1-DETAIL-LINE                                   04671012
046720                RP2-DETAIL-LINE.                                  04672012
046730                                                                  04673012
046800     EVALUATE TRUE                                                04680011
046900         WHEN SV072-RF-VERIFIED                                   04690011
046901              MOVE 1                TO PV-SUB1                    04690111
046910              PERFORM 2200-PROCESS-VERIFIED-DATA                  04691011
046920         WHEN SV072-RF-MISSING-KOHLS                              04692011
046930              MOVE 2              TO PV-SUB1                      04693011
046931              MOVE 'MISSING KOHLS TRANSACTION'                    04693111
046932                                  TO RP2-ERROR-MESSAGE            04693211
046933              PERFORM 2300-PROCESS-MISSING-DATA                   04693311
046940         WHEN SV072-RF-MISSING-INCOMM                             04694011
046941              MOVE 3              TO PV-SUB1                      04694111
046942              MOVE 'MISSING INCOMM TRANSACTION'                   04694211
046943                                  TO RP2-ERROR-MESSAGE            04694311
046950              PERFORM 2300-PROCESS-MISSING-DATA                   04695011
046990     END-EVALUATE.                                                04699011
049800                                                                  04980000
049900     PERFORM 7000-READ-REPORT-FILE.                               04990000
050000                                                                  05000000
050100******************************************************************05010000
050200* 2200-PROCESS-VERIFIED-DATA                                     *05020000
050300******************************************************************05030000
050400 2200-PROCESS-VERIFIED-DATA.                                      05040000
050500                                                                  05050000
050721     PERFORM 4000-MOVE-REPORT-DATA.                               05072111
050722     PERFORM 4400-SET-TRAN-TYPE.                                  05072211
050730     PERFORM 4600-CALC-TOTALS.                                    05073022
050750                                                                  05075011
051300     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         05130000
051400         PERFORM 5000-SETTLED-REPORT-HEADER3                      05140022
051410         WRITE SETTLED-RECORD FROM RP1-HEADING-LINE-4             05141013
051420            AFTER ADVANCING 1 LINE                                05142013
051430         ADD +1 TO PV-LINE-COUNT                                  05143013
051500     END-IF.                                                      05150000
051600                                                                  05160000
051910     WRITE SETTLED-RECORD FROM RP1-DETAIL-LINE AFTER              05191011
051920            ADVANCING 1 LINE                                      05192011
051930     ADD +1 TO PV-LINE-COUNT.                                     05193011
052000     WRITE SETTLED-CSV-RECORD FROM CSV-DETAIL.                    05200000
052100                                                                  05210000
052101******************************************************************05210111
052102* 2300-PROCESS-MISSING                                           *05210211
052103******************************************************************05210311
052104 2300-PROCESS-MISSING-DATA.                                       05210411
052105                                                                  05210511
052710     PERFORM 4200-MOVE-AUDIT-REPORT-DATA.                         05271007
052720     PERFORM 4400-SET-TRAN-TYPE.                                  05272011
053040     PERFORM 4600-CALC-TOTALS.                                    05304022
053060                                                                  05306011
053500     IF PV-LINE-COUNT1 > PC-LINES-PER-PAGE                        05350000
053600        PERFORM 6000-UNSETTLED-REPORT-HEADER2                     05360022
053601        WRITE UNSETTLED-RECORD FROM RP2-HEADING-LINE-3            05360112
053602              AFTER ADVANCING 2 LINES                             05360212
053610        WRITE UNSETTLED-RECORD FROM RP2-HEADING-LINE-4            05361022
053630              AFTER ADVANCING 1 LINE                              05363011
053640        ADD +3 TO PV-LINE-COUNT1                                  05364012
053700     END-IF.                                                      05370000
053800                                                                  05380000
053900     WRITE UNSETTLED-RECORD FROM RP2-DETAIL-LINE AFTER            05390011
054000            ADVANCING 1 LINE                                      05400000
054100     ADD +1 TO PV-LINE-COUNT1.                                    05410000
054200                                                                  05420000
060100******************************************************************06010000
060200* 4000-MOVE-REPORT-DATA                                          *06020000
060300******************************************************************06030000
060400 4000-MOVE-REPORT-DATA.                                           06040000
060500                                                                  06050000
060600     MOVE SV072-TRANS-DATE        TO RP1-TRANS-DATE               06060011
060700                                     CSV-TRANS-DATE.              06070000
060800     MOVE SV072-CARD-NBR          TO RP1-CARD-ID                  06080005
060900                                     CSV-CARD-ID.                 06090000
062274     MOVE SV072-TRANS-AMOUNT      TO RP1-TRANS-AMT                06227411
062275                                     CSV-TRANS-AMT.               06227511
062286     MOVE SV072-UPC               TO RP1-UPC-NBR                  06228605
062290                                     CSV-UPC-NBR.                 06229005
062291     MOVE SV072-INCOMM-REF-NO     TO RP1-INCOMM-REF-NO            06229105
062292                                     CSV-INCOMM-REF-NO.           06229205
062293     MOVE SV072-MERCHANT          TO RP1-MERCHANT                 06229305
062294                                     CSV-MERCHANT.                06229405
062295     MOVE SV072-LOCATION          TO RP1-LOCATION                 06229505
062296                                     CSV-LOCATION.                06229605
062297******************************************************************06229707
062298* 4200-MOVE-AUDIT-REPORT-DATA                                    *06229807
062299******************************************************************06229907
062300 4200-MOVE-AUDIT-REPORT-DATA.                                     06230007
062301                                                                  06230107
062306     MOVE SV072-TRANS-DATE        TO RP2-TRANS-DATE.              06230614
062308     MOVE SV072-CARD-NBR          TO RP2-CARD-ID.                 06230814
062331     MOVE SV072-TRANS-AMOUNT      TO RP2-TRANS-AMT.               06233114
062333     MOVE SV072-UPC               TO RP2-UPC-NBR.                 06233314
062335     MOVE SV072-INCOMM-REF-NO     TO RP2-INCOMM-REF-NO.           06233514
062337     MOVE SV072-VAN16             TO RP2-VAN16.                   06233714
062339     MOVE SV072-SELR-NM           TO RP2-SELR-NM.                 06233914
062343     MOVE SV072-MERCHANT          TO RP2-MERCHANT.                06234314
062345     MOVE SV072-LOCATION          TO RP2-LOCATION.                06234514
062414******************************************************************06241411
062415* 4400-SET-TRAN-TYPE.                                            *06241511
062416******************************************************************06241611
062417 4400-SET-TRAN-TYPE.                                              06241711
062418                                                                  06241811
062419     EVALUATE TRUE                                                06241911
062420         WHEN SV072-ACTIVATE                                      06242022
062423               MOVE 'ACTIVATE'          TO RP1-CARD-TYPE          06242311
062424                                           CSV-CARD-TYPE          06242411
062426                                           RP2-CARD-TYPE          06242622
062428         WHEN SV072-DEACTIVATE                                    06242822
062431              MOVE 'DEACTIVATE'         TO RP1-CARD-TYPE          06243111
062432                                           CSV-CARD-TYPE          06243211
062434                                           RP2-CARD-TYPE          06243422
062436         WHEN SV072-REVERSAL-ACTIVATE                             06243622
062439              MOVE 'REVERSAL A'         TO RP1-CARD-TYPE          06243911
062440                                           CSV-CARD-TYPE          06244011
062442                                           RP2-CARD-TYPE          06244222
062444         WHEN SV072-REVERSAL-DEACTIVATE                           06244422
062447              MOVE 'REVERSAL D'         TO RP1-CARD-TYPE          06244711
062448                                           CSV-CARD-TYPE          06244811
062450                                           RP2-CARD-TYPE          06245022
062452     END-EVALUATE.                                                06245211
062453                                                                  06245311
062457******************************************************************06245711
062458* 4600-CALC-TOTALS                                               *06245822
062459******************************************************************06245911
062460 4600-CALC-TOTALS.                                                06246022
062461                                                                  06246111
062462     EVALUATE TRUE                                                06246211
062463         WHEN SV072-RF-VERIFIED                                   06246311
062464              MOVE PV-SUBV TO PV-SUB2                             06246411
062466         WHEN SV072-RF-MISSING-INCOMM                             06246611
062467              MOVE PV-SUBI TO PV-SUB2                             06246711
062469         WHEN SV072-RF-MISSING-KOHLS                              06246911
062470              MOVE PV-SUBK TO PV-SUB2                             06247011
062472     END-EVALUATE.                                                06247211
062473                                                                  06247311
062478     IF SV072-TRANS-DATE = PV-DATE(PV-SUB1 PV-SUB2)               06247811
062479        CONTINUE                                                  06247911
062480     ELSE                                                         06248011
062481        ADD +1                TO PV-SUB2                          06248112
062482        MOVE SV072-TRANS-DATE TO PV-DATE(PV-SUB1 PV-SUB2)         06248211
062484        IF PV-SUB2 > PV-MAX-SUB                                   06248411
062485             MOVE '4600-CALC-TOTALS'   TO PV-PARAGRAPH-NAME       06248522
062486                                                                  06248611
062487             MOVE 'DATE TABLE OVER LIMIT' TO PV-OPERATION-MSG-1   06248711
062488             SET AC-TABLE-OVERFLOW TO TRUE                        06248811
062489             PERFORM 9999-ABEND                                   06248911
062490         END-IF                                                   06249011
062491     END-IF.                                                      06249111
062492                                                                  06249211
062493     EVALUATE TRUE                                                06249311
062494         WHEN SV072-ACTIVATE                                      06249422
062497              ADD SV072-TRANS-AMOUNT    TO PV-ACT-AMT             06249711
062498                                          (PV-SUB1  PV-SUB2)      06249811
062499              ADD +1                    TO PV-ACT-NBR             06249911
062500                                          (PV-SUB1  PV-SUB2)      06250011
062501         WHEN SV072-DEACTIVATE                                    06250122
062509              ADD SV072-TRANS-AMOUNT    TO PV-DEACT-AMT           06250911
062510                                          (PV-SUB1  PV-SUB2)      06251011
062511              ADD +1                    TO PV-DEACT-NBR           06251111
062512                                          (PV-SUB1  PV-SUB2)      06251211
062513         WHEN SV072-REVERSAL-ACTIVATE                             06251322
062524              ADD SV072-TRANS-AMOUNT    TO PV-REVERS-ACT-AMT      06252411
062525                                          (PV-SUB1  PV-SUB2)      06252511
062526              ADD +1                    TO PV-REVERS-ACT-NBR      06252611
062527                                          (PV-SUB1  PV-SUB2)      06252711
062528         WHEN SV072-REVERSAL-DEACTIVATE                           06252822
062539              ADD SV072-TRANS-AMOUNT    TO PV-REVERS-DEACT-AMT    06253911
062540                                          (PV-SUB1  PV-SUB2)      06254011
062541              ADD +1                    TO PV-REVERS-DEACT-NBR    06254111
062542                                          (PV-SUB1  PV-SUB2)      06254211
062543     END-EVALUATE.                                                06254311
062544                                                                  06254411
062545     EVALUATE TRUE                                                06254511
062546         WHEN SV072-RF-VERIFIED                                   06254611
062547              MOVE PV-SUB2 TO PV-SUBV                             06254711
062548         WHEN SV072-RF-MISSING-INCOMM                             06254811
062549              MOVE PV-SUB2 TO PV-SUBI                             06254911
062550         WHEN SV072-RF-MISSING-KOHLS                              06255011
062551              MOVE PV-SUB2 TO PV-SUBK                             06255111
062552     END-EVALUATE.                                                06255211
062553                                                                  06255311
062554******************************************************************06255411
062555* 5000-SETTLED-REPORT-HEADER3                                    *06255522
062560******************************************************************06256000
062600 5000-SETTLED-REPORT-HEADER3.                                     06260022
062700                                                                  06270000
062800     MOVE 4             TO PV-LINE-COUNT.                         06280011
062900     ADD  1             TO PV-PAGE-COUNT.                         06290000
063000     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     06300000
063100     MOVE 1             TO DP132-REPORT-NUMBER.                   06310000
063300     MOVE 'INCOMM SETTLEMENT REPORT FOR' TO RP1-SUBTITLE.         06330011
063400                                                                  06340000
063500     WRITE SETTLED-RECORD                                         06350000
063600       FROM DP132-STANDRD-HEADER-132-COLS                         06360000
063700         AFTER ADVANCING PAGE.                                    06370000
063800                                                                  06380000
063900     WRITE SETTLED-RECORD                                         06390000
064000         FROM RP1-HEADING-LINE-2                                  06400000
064100         AFTER ADVANCING 1 LINE.                                  06410011
064200                                                                  06420000
064300     WRITE SETTLED-RECORD                                         06430000
064400         FROM RP1-HEADING-LINE-3                                  06440000
064500         AFTER ADVANCING 2 LINES.                                 06450011
064600                                                                  06460000
065100******************************************************************06510000
065200* 6000-WRITE-UNSETTLED-REPORT-HEADER                             *06520000
065300******************************************************************06530000
065400 6000-UNSETTLED-REPORT-HEADER2.                                   06540022
065500                                                                  06550000
065600     MOVE 2               TO PV-LINE-COUNT1.                      06560012
065700     ADD  1               TO PV-PAGE-COUNT1.                      06570000
065800     MOVE PV-PAGE-COUNT1  TO DP132-PAGE-NUMBER.                   06580000
065900     MOVE 2               TO DP132-REPORT-NUMBER.                 06590000
066100     MOVE SPACES          TO RP2-SUBTITLE.                        06610011
066200     MOVE 'INCOMM AUDIT REPORT FOR' TO RP2-SUBNAME.               06620011
066300                                                                  06630000
066400     WRITE UNSETTLED-RECORD                                       06640000
066500       FROM DP132-STANDRD-HEADER-132-COLS                         06650000
066600         AFTER ADVANCING PAGE.                                    06660000
066700                                                                  06670000
066800     WRITE UNSETTLED-RECORD                                       06680000
066900         FROM RP2-HEADING-LINE-2                                  06690011
067000         AFTER ADVANCING 1 LINE.                                  06700000
067100                                                                  06710000
068000******************************************************************06800000
068100* 7000-READ-REPORT-FILE                                          *06810000
068200*    READ THE INPUT FILE AND SET THE END OF FILE SWITCH WHEN     *06820000
068300*    THERE IS NO MORE RECORDS TO READ.                           *06830000
068400******************************************************************06840000
068500 7000-READ-REPORT-FILE.                                           06850000
068600                                                                  06860000
068700     INITIALIZE SV072-DETAIL-TRANS.                               06870007
068800                                                                  06880000
068900     READ REPORT-FILE-IN INTO SV072-DETAIL-TRANS                  06890007
069000         AT END                                                   06900000
069100             SET PS-END-OF-REPORT-FILE TO TRUE.                   06910000
069200                                                                  06920000
069300******************************************************************06930000
069400* 8000-WRITE-TOTAL-RP1                                           *06940011
069500******************************************************************06950000
069600 8000-WRITE-TOTAL-RP1.                                            06960011
070100                                                                  07010000
070300     PERFORM 5000-SETTLED-REPORT-HEADER3                          07030022
070500                                                                  07050000
070900     WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-1                   07090011
071000           AFTER ADVANCING 1 LINE                                 07100000
071010     WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-2                   07101011
071020           AFTER ADVANCING 1 LINE                                 07102011
071030     ADD +2 TO PV-LINE-COUNT                                      07103011
071100                                                                  07110000
071200     MOVE PV-SUBV TO PV-MAX-ARRAY.                                07120012
071300     MOVE 1       TO PV-SUB1.                                     07130012
071400                                                                  07140012
072410     PERFORM 8100-UNLOAD-TOTAL-RP1                                07241011
072430        VARYING PV-SUB2 FROM 1 BY 1                               07243012
072440               UNTIL PV-SUB2 > PV-MAX-ARRAY.                      07244012
072500                                                                  07250000
072600     WRITE SETTLED-RECORD FROM END-OF-REPORT-LINE                 07260000
072700           AFTER ADVANCING 2 LINES.                               07270000
073100                                                                  07310000
073200******************************************************************07320000
073300* 8100-UNLOAD-TOTAL-RP1                                          *07330011
073400******************************************************************07340000
073500 8100-UNLOAD-TOTAL-RP1.                                           07350011
073600                                                                  07360000
073700     MOVE PV-DATE(PV-SUB1  PV-SUB2)    TO TOTAL-DATE.             07370012
074200     MOVE PV-ACT-NBR(PV-SUB1  PV-SUB2) TO TOTAL-ACT-NBR.          07420012
074300     MOVE PV-ACT-AMT(PV-SUB1  PV-SUB2) TO TOTAL-ACT-AMT.          07430012
074400     MOVE PV-DEACT-NBR(PV-SUB1  PV-SUB2) TO TOTAL-DEACT-NBR.      07440012
074500     MOVE PV-DEACT-AMT(PV-SUB1  PV-SUB2) TO TOTAL-DEACT-AMT.      07450012
074600     MOVE PV-REVERS-ACT-NBR(PV-SUB1  PV-SUB2)                     07460012
074610                                    TO TOTAL-REV-ACT-NBR.         07461007
074700     MOVE PV-REVERS-ACT-AMT(PV-SUB1  PV-SUB2)                     07470012
074800                                    TO TOTAL-REV-ACT-AMT.         07480007
074900     MOVE PV-REVERS-DEACT-NBR(PV-SUB1  PV-SUB2)                   07490012
074910                                    TO TOTAL-REV-DEACT-NBR.       07491007
074920     MOVE PV-REVERS-DEACT-AMT(PV-SUB1  PV-SUB2)                   07492012
074930                                    TO TOTAL-REV-DEACT-AMT.       07493007
075000                                                                  07500000
075100     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         07510000
075200         PERFORM 5000-SETTLED-REPORT-HEADER3                      07520022
075600         WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-1               07560011
075700           AFTER ADVANCING 1 LINE                                 07570000
075710         WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-2               07571011
075720           AFTER ADVANCING 1 LINE                                 07572011
075730         ADD +2 TO PV-LINE-COUNT                                  07573011
075800     END-IF.                                                      07580000
075900                                                                  07590000
076000     WRITE SETTLED-RECORD FROM RPT-TOTAL-DETAIL-LINE              07600000
076100           AFTER ADVANCING 1 LINE.                                07610000
076200     ADD +1 TO PV-LINE-COUNT.                                     07620000
076300                                                                  07630000
077710******************************************************************07771011
077720* 8400-WRITE-TOTAL-RP2                                           *07772011
077730******************************************************************07773011
077740 8400-WRITE-TOTAL-RP2.                                            07774011
077790                                                                  07779011
077792     PERFORM 6000-UNSETTLED-REPORT-HEADER2                        07779222
077794                                                                  07779411
077795**** WRITE TOTALS FOR MISSING INCOMM RECORD                       07779517
077796     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-HEADER-1          07779612
077797         AFTER ADVANCING 2 LINES.                                 07779712
077798     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-1                 07779811
077799           AFTER ADVANCING 1 LINE.                                07779911
077800     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-2                 07780011
077801           AFTER ADVANCING 1 LINE.                                07780111
077802     ADD +4 TO PV-LINE-COUNT1.                                    07780212
077803                                                                  07780311
077804     MOVE PV-SUBK TO PV-MAX-ARRAY.                                07780411
077811     MOVE 2       TO PV-SUB1.                                     07781112
077812                                                                  07781212
077813     PERFORM 8500-UNLOAD-TOTAL-RP2                                07781311
077815        VARYING PV-SUB2 FROM 1 BY 1                               07781512
077816              UNTIL PV-SUB2 > PV-MAX-ARRAY.                       07781612
077817                                                                  07781711
077818**** WRITE TOTALS FOR MISSING KOHLS RECORD                        07781817
077819     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-HEADER-2          07781912
077820         AFTER ADVANCING 2 LINES.                                 07782012
077821     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-1                 07782111
077822           AFTER ADVANCING 1 LINE.                                07782211
077823     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-2                 07782311
077824           AFTER ADVANCING 1 LINE.                                07782411
077825     ADD +4 TO PV-LINE-COUNT1.                                    07782512
077826                                                                  07782611
077827     MOVE PV-SUBI TO PV-MAX-ARRAY.                                07782711
077828     MOVE 3       TO PV-SUB1.                                     07782812
077829                                                                  07782912
077830     PERFORM 8500-UNLOAD-TOTAL-RP2                                07783011
077831        VARYING PV-SUB2 FROM 1 BY 1                               07783112
077832              UNTIL PV-SUB2 > PV-MAX-ARRAY.                       07783212
077833                                                                  07783311
077834     WRITE UNSETTLED-RECORD FROM END-OF-REPORT-LINE               07783411
077835           AFTER ADVANCING 2 LINES.                               07783511
077836                                                                  07783611
077837******************************************************************07783711
077838* 8500-UNLOAD-TOTAL-DATA                                         *07783811
077839******************************************************************07783911
077840 8500-UNLOAD-TOTAL-RP2.                                           07784011
077841                                                                  07784111
077842     MOVE PV-DATE(PV-SUB1  PV-SUB2)      TO TOTAL-DATE.           07784211
077843     MOVE PV-ACT-NBR(PV-SUB1  PV-SUB2) TO TOTAL-ACT-NBR.          07784311
077844     MOVE PV-ACT-AMT(PV-SUB1  PV-SUB2) TO TOTAL-ACT-AMT.          07784411
077845     MOVE PV-DEACT-NBR(PV-SUB1  PV-SUB2) TO TOTAL-DEACT-NBR.      07784511
077846     MOVE PV-DEACT-AMT(PV-SUB1  PV-SUB2) TO TOTAL-DEACT-AMT.      07784611
077847     MOVE PV-REVERS-ACT-NBR(PV-SUB1  PV-SUB2)                     07784711
077848                                    TO TOTAL-REV-ACT-NBR.         07784811
077849     MOVE PV-REVERS-ACT-AMT(PV-SUB1  PV-SUB2)                     07784911
077850                                    TO TOTAL-REV-ACT-AMT.         07785011
077851     MOVE PV-REVERS-DEACT-NBR(PV-SUB1  PV-SUB2)                   07785111
077852                                    TO TOTAL-REV-DEACT-NBR.       07785211
077853     MOVE PV-REVERS-DEACT-AMT(PV-SUB1  PV-SUB2)                   07785311
077854                                    TO TOTAL-REV-DEACT-AMT.       07785411
077855                                                                  07785511
077860     IF PV-LINE-COUNT1 > PC-LINES-PER-PAGE                        07786011
077861         PERFORM 6000-UNSETTLED-REPORT-HEADER2                    07786122
077862         WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-1             07786211
077863           AFTER ADVANCING 2 LINES                                07786311
077864         WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-2             07786411
077865           AFTER ADVANCING 2 LINES                                07786511
077866         ADD +2 TO PV-LINE-COUNT1                                 07786611
077867     END-IF.                                                      07786711
077868                                                                  07786811
077869     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-DETAIL-LINE            07786911
077870           AFTER ADVANCING 1 LINE.                                07787011
077871                                                                  07787111
077872     ADD +1 TO PV-LINE-COUNT1.                                    07787211
077873                                                                  07787311
077880******************************************************************07788011
077900* 9000-EOJ-ROUTINE.                                              *07790000
078000******************************************************************07800000
078100 9000-EOJ-ROUTINE.                                                07810000
078200                                                                  07820000
078300     CLOSE DATE-CARD-FILE                                         07830000
078400           REPORT-FILE-IN                                         07840000
078500           SETTLED-REPORT                                         07850000
078600           SETTLED-CSV-FILE                                       07860000
078700           UNSETTLED-REPORT.                                      07870000
078800                                                                  07880000
078900******************************************************************07890000
079000*     9975-DATE-ROUTINE.                                         *07900000
079100* ==> PROCESSES:                                                 *07910000
079200*     -VALIDATES THE DATE INPUT ON THE CONTROL FILE              *07920000
079300* ==> PERFORMED FROM: B100-INITIALIZE                            *07930000
079400******************************************************************07940000
079500 9975-DATE-ROUTINE.                                               07950000
079600                                                                  07960000
079700     INITIALIZE DPG51 DPG52 DPG53                                 07970000
079800                DPG54 DPG55 DPG56.                                07980000
079900                                                                  07990000
080000     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     08000000
080100                                                                  08010000
080200     MOVE CC-DATE-CCYY-MM-DD        TO DPG52-LK-DATE-INPUT.       08020000
080300     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      08030000
080400                                                                  08040000
080500     CALL DP500-KOHLS-CALENDAR-ROUTINE                            08050000
080600       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 08060000
080700                                                                  08070000
080800     EVALUATE TRUE                                                08080000
080900         WHEN DPG54-SEVERE-ERROR                                  08090000
081000         WHEN DPG54-DATE-INVALID                                  08100000
081100             SET AC-DATE-ERROR TO TRUE                            08110000
081200             PERFORM 9999-ABEND                                   08120000
081300     END-EVALUATE.                                                08130000
081400******************************************************************08140000
081500* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           08150000
081600******************************************************************08160000
081700 9999-ABEND.                                                      08170000
081800     DISPLAY '** ABEND           **'.                             08180000
081900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          08190000
082000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08200000
082100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08210000
082200     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08220000
