       IDENTIFICATION DIVISION.                                         INKUT015
00005  PROGRAM-ID.             INKUT015.                                INKUT015
00006  AUTHOR.                 TROY BIRK                                INKUT015
00007  INSTALLATION.           KOHLS.                                   INKUT015
00008  DATE-WRITTEN            APRIL, 1992.                             INKUT015
00009  DATE-COMPILED.                                                   INKUT015
00010                                                                   INKUT015
      ******************************************************************INKUT015
      *  CREATES A CROSS REFERENCE FILE OF ALL UPC NUMBERS ASSOCIATED   INKUT015
      *  WITH A SKU, WHICH WILL BE USED DURING PHYSICAL INVENTORY BY    INKUT015
      *  STORES THAT WILL BE SCANNING.                                  INKUT015
      *                                                                 INKUT015
      *  THE PROGRAM SELECTS ALL SKUS FROM THE DB2 SKU TABLE. FOR       INKUT015
      *  EVERY SKU SELECTED, GET ALL UPC FROM TUPC (DB2 TABLE).         INKUT015
      *  IN ADDITION, GENERATE DUMMY SKU (SKU ENDING IN 000) FOR ALL    INKUT015
      *  VALID DEPT/SUB-CLASS COMBINATION.                              INKUT015
      *                                                                 INKUT015
      *  THE OUTPUT WILL BE DIVIDED INTO TWO FILES.  ONE THAT CONTAINS  INKUT015
      *  NEW UPC BASE ON OPTIONAL NUMBER OF MONTHS PARAMETER, WHICH     INKUT015
      *  BY DEFAULT WILL BE 12 MONTHS, BUT CAN BE UP TO 99 MONTHS.      INKUT015
      *  THE SECOND FILE WILL CONTAIN OLDER UPC.  THIS SECOND FILE      INKUT015
      *  COULD BE FURTHER USED TO CHECK, IF IT HAS BEEN INVENTORIED     INKUT015
      *  RECENTLY (WITHIN THE YEAR AS AN EXAMPLE).  OLDER UPC/SKU               
      *  WILL ALSO CHECK LAST RECEIVED DATE FROM FASHION SALES.                 
      *                                                                 INKUT015
      *  DUMMY AND RENUMBERED SKUS WILL BE A PART OF THE NEWER          INKUT015
      *  UPC EXTRACT/FILE.                                              INKUT015
      *                                                                 INKUT015
      *  THE PROGRAM HAVE THE OPTION OF USING A RULE SIMILAR TO WHAT    INKUT015
      *  POS HAS BEEN USING, WHICH IS TO DROP OFF UPC THAT              INKUT015
      *  HAVE BEEN ON CLEARANCE FOR MORE THAN 7 MONTHS,                 INKUT015
      *  HAVE NO SALES WITHIN THE LAST 3 MONTHS AND NO ON-HANDS.        INKUT015
      *  THE 7 AND 3 MONTHS PARAMETERS ARE DEFAULT, BUT CAN BE          INKUT015
      *  SPECIFIED UP TO 99 MONTHS.                                     INKUT015
      *  IF THE EXECUTION UTILIZE POS-LIKE RULES, THE REJECTED RECORDS  INKUT015
      *  WILL BE WRITTEN ONTO A THIRD FILE.                             INKUT015
      *                                                                 INKUT015
      *  THE LAYOUT OF THE OPTIONAL CONTROL CARD IS:                    INKUT015
      *    POS    DESCRIPTION                                           INKUT015
      *    -----  -------------------------------------------------     INKUT015
      *    01-01  COMMENT INDICATOR                                     INKUT015
      *    02-03  NUMBER OF MONTHS BEFORE CURRENT DATE FOR UPC EFF      INKUT015
      *           CUTOFF DATE.                                          INKUT015
      *    05-05  USE POS-LIKE RULES OR NOT {Y|N}, DEFAULT IS 'N'       INKUT015
      *    07-08  NUMBER OF MONTHS BEFORE CURRENT DATE FOR ORIGINAL     INKUT015
      *           CLEARANCE CUTOFF DATE.                                INKUT015
      *    10-11  NUMBER OF MONTHS BEFORE CURRENT DATE FOR LAST SALES   INKUT015
      *           CUTOFF DATE.                                          INKUT015
      *                                                                 INKUT015
      *CHANGE HISTORY:                                                          
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                             
      * -------  ----------  ----------------------------------------           
      * WR 2042  10/15/92    - TROY BIRK  WR# 2042                              
00022 *     CHANGED PROGRAM TO CREATE TWO RECORDS FOR EVERY DEPT/CLASS  INKUT015
00023 *  ON MBS. FOR EACH DEPT/CLASS, ONE RECORD WILL BE WRITTEN        INKUT015
00024 *  WITH ZERO AS THE SEQUENCE NUMBER AND THE OTHER WILL            INKUT015
00025 *  BE WRITTEN WITH '999'. FOR THESE RECORDS, THE UPC WILL BE      INKUT015
00026 *  IN-HOUSE GENERATED AND THE RETAIL PRICE WILL BE ZERO.          INKUT015
      *                                                                         
00031 *          09/13/93    - MARC BLAZICH                             INKUT015
00031 *     REMOVED REFERENCE TO UNIT-RTL-AMT.                          INKUT015
00032 *  IT'S NO LONGER NEEDED ON THE OUTPUT UPC XREF FILE.             INKUT015
      *                                                                         
W21732* W21732   12/20/02    - SUDHARSHAN/IGSI                          INKUT015
W21732*     ADDED LOGIC TO LOOK THE DEPARTMENT AND CLASS TO THE EXTRACT.INKUT015
W21732*     ADD ISWS006                                                 INKUT015
C21732* C21732   03/03/03    - MAINTAIN 30 BYTE RECORD                  INKUT015
R21732* R21732   03/05/03    - ROD JANSSEN                              INKUT015
R21732*                      A. REMOVAL OF SEQUENCE 999.                INKUT015
R21732*                      B. CALL FOR CHECK DIGIT LOGIC.             INKUT015
W27710* W27710   10/20/04    - RONNA MCDONALD - ADD SKU DESC            INKUT015
W30272* W30272 03-01-2006    - V. LEE YANG - CHECK SKU CLEARANCE STATUS INKUT015
W30272*                        TO SEE HOW LONG THE UPC HAS BEEN ON      INKUT015
W30272*                        CLEARANCE, LAST SALES AND ON-HAND.       INKUT015
L30272* W30272 03-21-2006    - V. LEE YANG - IMPROVEMENT IN EXECUTION   INKUT015
L30272*                        CPU TIME AND ADD LOGIC TO CHECK LAST     INKUT015
L30272*                        RECEIVED DATE IN FASHION SALES FOR       INKUT015
L30272*                        OLDER UPC/SKU.                           INKUT015
1122RM*        11-01-2022    - BOB MCASEY - ADDED SUBCLASS TO EXTRACT           
1122RM*                        CHG0280879                                       
00033**        02-14-2023    - JEAN KURK - CHANGE CALL TO UPC CHECK             
00033**                        DIGIT ROUTINE FROM STATIC TO DYNAMIC             
00033**                        CHG0281369                                       
W21732******************************************************************INKUT015
00034                                                                   INKUT015
00035 ******************************************************************INKUT015
00036  ENVIRONMENT DIVISION.                                            INKUT015
00037 ******************************************************************INKUT015
00038                                                                   INKUT015
00039  CONFIGURATION SECTION.                                           INKUT015
00040                                                                   INKUT015
00041  SOURCE-COMPUTER.        IBM-3090.                                INKUT015
00042  OBJECT-COMPUTER.        IBM-3090.                                INKUT015
00043                                                                   INKUT015
00044  INPUT-OUTPUT SECTION.                                            INKUT015
00045                                                                   INKUT015
00046  FILE-CONTROL.                                                    INKUT015
00047                                                                   INKUT015
W30272     SELECT OPTIONAL REQUEST-CONTROL-FILE                         INKUT015
W30272         ASSIGN TO INP01.                                         INKUT015
                                                                        INKUT015
W30272     SELECT NEWER-UPC-FILE                                        INKUT015
00049          ASSIGN TO OUT01.                                         INKUT015
00050                                                                   INKUT015
W30272     SELECT OLDER-UPC-FILE                                        INKUT015
W30272         ASSIGN TO OUT02.                                         INKUT015
                                                                        INKUT015
W30272     SELECT POS-RULE-REJECTED-FILE                                INKUT015
W30272         ASSIGN TO OUT03.                                         INKUT015
                                                                        INKUT015
00051 ******************************************************************INKUT015
00052  DATA DIVISION.                                                   INKUT015
00053 ******************************************************************INKUT015
00054                                                                   INKUT015
00055  FILE SECTION.                                                    INKUT015
00056                                                                   INKUT015
W30272 FD  REQUEST-CONTROL-FILE                                         INKUT015
W30272     RECORDING MODE IS F                                          INKUT015
W30272     LABEL RECORDS ARE STANDARD                                   INKUT015
W30272     BLOCK CONTAINS 0 RECORDS.                                    INKUT015
W30272                                                                  INKUT015
W30272 01  REQUEST-CONTROL-RECORD      PIC X(80).                          CL**3
                                                                        INKUT015
00057  FD  NEWER-UPC-FILE                                               INKUT015
00058      RECORDING MODE IS F                                          INKUT015
00059      LABEL RECORDS ARE STANDARD                                   INKUT015
00060      BLOCK CONTAINS 0 RECORDS.                                    INKUT015
00061                                                                   INKUT015
W30272*01  NEWER-UPC-RECORD            PIC X(64).                          CL**3
1122RM 01  NEWER-UPC-RECORD            PIC X(67).                          CL**3
                                                                        INKUT015
W30272 FD  OLDER-UPC-FILE                                               INKUT015
W30272     RECORDING MODE IS F                                          INKUT015
W30272     LABEL RECORDS ARE STANDARD                                   INKUT015
W30272     BLOCK CONTAINS 0 RECORDS.                                    INKUT015
                                                                        INKUT015
W30272*01  OLDER-UPC-RECORD            PIC X(64).                          CL**3
1122RM 01  OLDER-UPC-RECORD            PIC X(67).                          CL**3
                                                                        INKUT015
W30272 FD  POS-RULE-REJECTED-FILE                                       INKUT015
W30272     RECORDING MODE IS F                                          INKUT015
W30272     LABEL RECORDS ARE STANDARD                                   INKUT015
W30272     BLOCK CONTAINS 0 RECORDS.                                    INKUT015
                                                                        INKUT015
W30272*01  POS-RULE-REJECTED-REC       PIC X(64).                          CL**3
1122RM 01  POS-RULE-REJECTED-REC       PIC X(67).                          CL**3
                                                                        INKUT015
00064  WORKING-STORAGE SECTION.                                         INKUT015
00065                                                                   INKUT015
00066  01  ABEND-CODE                  PIC S9(04)   VALUE +0            INKUT015
00067                                               COMP SYNC.          INKUT015
00068      88  ABEND-4013                           VALUE +4013.        INKUT015
00069                                                                   INKUT015
00070 ******************************************************************INKUT015
00071 *  UPC MASTER FILE LAYOUT                                         INKUT015
00072 ******************************************************************INKUT015
00073      COPY INWS001O.                                                  CL**5
00074 *                                                                 INKUT015
00075 ******************************************************************INKUT015
00076 *  UPC CHECK DIGIT FIELDS                                         INKUT015
00077 ******************************************************************INKUT015
00078      COPY DPWS040I.                                               INKUT015
00079 *                                                                 INKUT015
W30272******************************************************************INKUT015
W30272*  KOHL'S CALENDAR ROUTINE, DPKUT500                              INKUT015
W30272******************************************************************INKUT015
W30272*01  DP500-KOHLS-CALENDAR-ROUTINE                                         
W30272*01  DPG51                                                                
W30272*01  DPG52                                                                
W30272*01  DPG53                                                                
W30272*01  DPG54                                                                
W30272*01  DPG55                                                                
W30272*01  DPG56                                                                
W30272     COPY DPWS500.                                                INKUT015
                                                                        INKUT015
W21732******************************************************************INKUT015
W21732*  COPY BOOK FOR NI-SKU VARIABLES.                                INKUT015
W21732******************************************************************INKUT015
W21732     COPY ISWS006.                                                INKUT015
W21732*                                                                 INKUT015
00080 ******************************************************************INKUT015
00081 *  DB2 ERROR MESSAGE FIELDS                                       INKUT015
00082 ******************************************************************INKUT015
00083      COPY DPWS004.                                                INKUT015
00084 *                                                                 INKUT015
00085      EJECT                                                        INKUT015
00086  01  PV-PROGRAM-VARIABLES.                                        INKUT015
W30272     05  PV-OLD-SALES-DTE-X          PIC X(06)       VALUE ZEROES.INKUT015
W30272     05  PV-OLD-SALES-DTE-9 REDEFINES PV-OLD-SALES-DTE-X                  
W30272                                     PIC 9(06).                           
W30272     05  FILLER REDEFINES PV-OLD-SALES-DTE-X.                             
W30272         10  PV-OLD-SALES-DTE-YY     PIC X(02).                           
W30272         10  PV-OLD-SALES-DTE-MM     PIC X(02).                           
W30272         10  PV-OLD-SALES-DTE-DD     PIC X(02).                           
W30272     05  PV-OLD-SALES-DATE           PIC S9(07)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
L30272     05  PV-CURR-FASHION-DTE-X       PIC X(06)       VALUE ZEROES.INKUT015
L30272     05  PV-CURR-FASHION-DTE-9 REDEFINES PV-CURR-FASHION-DTE-X            
L30272                                     PIC 9(06).                           
L30272     05  FILLER REDEFINES PV-CURR-FASHION-DTE-X.                          
L30272         10  PV-CURR-FASHION-DTE-YY  PIC X(02).                           
L30272         10  PV-CURR-FASHION-DTE-MM  PIC X(02).                           
L30272         10  PV-CURR-FASHION-DTE-DD  PIC X(02).                           
L30272     05  PV-CURR-FS-DATE             PIC S9(07)      VALUE ZEROES INKUT015
L30272                         COMP-3.                                          
L30272     05  PV-LAST-RCVD-DTE-X          PIC X(06)       VALUE ZEROES.INKUT015
L30272     05  PV-LAST-RCVD-DTE-9 REDEFINES PV-LAST-RCVD-DTE-X                  
L30272                                     PIC 9(06).                           
L30272     05  FILLER REDEFINES PV-LAST-RCVD-DTE-X.                             
L30272         10  PV-LAST-RCVD-DTE-YY     PIC X(02).                           
L30272         10  PV-LAST-RCVD-DTE-MM     PIC X(02).                           
L30272         10  PV-LAST-RCVD-DTE-DD     PIC X(02).                           
L30272     05  PV-LAST-RCVD-DATE           PIC S9(07)      VALUE ZEROES INKUT015
L30272                         COMP-3.                                          
W30272     05  PV-SKU-ROWS                 PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-UPC-ROWS                 PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-RENUMBERED-SKUS          PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-DUMMY-SKU-ROWS           PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-ACCEPTED-UPC-ROWS        PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-NO-SALES-ROWS            PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-CLR-UPC-CHECK            PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
L30272     05  PV-FS-CHECK                 PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-TOO-OLD-UPC-ROWS         PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
L30272     05  PV-OLDER-UPC-CHG            PIC S9(09)      VALUE ZEROES INKUT015
L30272                         COMP-3.                                          
W30272     05  PV-ROWS-WRITTEN             PIC S9(09)      VALUE ZEROES INKUT015
W30272                         COMP-3.                                          
W30272     05  PV-CURRENT-DTE              PIC X(10)       VALUE SPACES.INKUT015
W30272     05  PV-UPC-CTOFF-DTE            PIC X(10)       VALUE SPACES.INKUT015
W30272     05  FILLER REDEFINES PV-UPC-CTOFF-DTE.                               
W30272         10  PV-UPC-CTOFF-DTE-CCYY   PIC 9(04).                           
W30272         10  FILLER                  PIC X(01).                           
W30272         10  PV-UPC-CTOFF-DTE-MM     PIC 9(02).                           
W30272         10  FILLER                  PIC X(01).                           
W30272         10  PV-UPC-CTOFF-DTE-DD     PIC 9(02).                           
W30272     05  PV-CLR-CTOFF-DTE            PIC X(10)       VALUE SPACES.INKUT015
W30272     05  FILLER REDEFINES PV-CLR-CTOFF-DTE.                               
W30272         10  PV-CLR-CTOFF-DTE-CCYY   PIC 9(04).                           
W30272         10  FILLER                  PIC X(01).                           
W30272         10  PV-CLR-CTOFF-DTE-MM     PIC 9(02).                           
W30272         10  FILLER                  PIC X(01).                           
W30272         10  PV-CLR-CTOFF-DTE-DD     PIC 9(02).                           
W30272     05  PV-SLS-CTOFF-DTE            PIC X(10)       VALUE SPACES.INKUT015
W30272     05  FILLER REDEFINES PV-SLS-CTOFF-DTE.                               
W30272         10  PV-SLS-CTOFF-DTE-CCYY   PIC 9(04).                           
W30272         10  FILLER                  PIC X(01).                           
W30272         10  PV-SLS-CTOFF-DTE-MM     PIC 9(02).                           
W30272         10  FILLER                  PIC X(01).                           
W30272         10  PV-SLS-CTOFF-DTE-DD     PIC 9(02).                           
00087      05  PV-UPC-NBR-UNPACKED         PIC 9(15)       VALUE ZEROES.INKUT015
00088      05  PV-UPC-NBR-UNPACKED-RED REDEFINES PV-UPC-NBR-UNPACKED.   INKUT015
00089          10 FILLER                   PIC 9(2).                    INKUT015
00090          10  PV-UPC-NBR-UNP-LAST     PIC 9(13).                   INKUT015
00091      05  PV-PARAGRAPH-NAME           PIC X(30)       VALUE SPACES.INKUT015
00092      05  PV-DB2-OPER-ATTEMPTED       PIC X(30)       VALUE SPACES.INKUT015
00093      05  PV-SQL-SUB                  PIC S9(4)       VALUE ZEROES INKUT015
00094                          COMP.                                    INKUT015
00095      05  PV-SKU-NBR.                                                 CL**7
00096          10  PV-DEPT-NBR             PIC X(03)       VALUE SPACES.INKUT015
00097          10  PV-CL-NBR               PIC X(02)       VALUE SPACES.INKUT015
00098          10  PV-SEQ-NBR              PIC X(03)       VALUE '000'. INKUT015
00099      05  PV-TEMP-MAJ-CL.                                          INKUT015
00100          10  PV-TEMP-MAJ-CL-BYTE1    PIC X(01)       VALUE SPACE. INKUT015
00101          10  FILLER                  PIC X(01)       VALUE SPACE. INKUT015
00102      05  PV-TEMP-SUB-CL.                                          INKUT015
00103          10  FILLER                  PIC X(02)       VALUE SPACES.INKUT015
00104          10  PV-TEMP-SUB-CL-BYTE3    PIC X(01)       VALUE SPACE. INKUT015
00105      05  PV-TEMP-CL.                                              INKUT015
00106          10  PV-TEMP-CL-BYTE1        PIC X(01)       VALUE SPACE. INKUT015
00107          10  PV-TEMP-CL-BYTE2        PIC X(01)       VALUE SPACE. INKUT015
1122RM     05  PV-IN015O-SUBCL-NBR-9       PIC 9(04)       VALUE 0.             
1122RM     05  PV-IN015O-SUBCL-NBR-X-RDF REDEFINES                              
1122RM         PV-IN015O-SUBCL-NBR-9.                                           
1122RM         10 PV-IN015O-SUBCL-NBR.                                          
1122RM             15 PV-IN015O-SUBCL-NBR1   PIC X(01).                         
1122RM             15 PV-IN015O-SUBCL-NBR2-4 PIC X(03).                         
1122RM             15 PV-IN015O-SUBCL-NBR2-4-RDF REDEFINES                      
1122RM                 PV-IN015O-SUBCL-NBR2-4.                                  
1122RM                 20 FILLER             PIC X(01).                         
1122RM                 20 PV-IN015O-SUBCL-NBR-3-4                               
1122RM                                       PIC X(02).                         
00108      05  PV-TEMP-UPC.                                             INKUT015
00109          10  FILLER                  PIC X(02)       VALUE SPACES.INKUT015
00110          10  PV-TEMP-UPC-LAST        PIC X(13)       VALUE SPACES.INKUT015
00111      05  PV-ERROR-MESSAGE.                                        INKUT015
00112          10  FILLER                  PIC X(38)       VALUE        INKUT015
00113              'ERROR GENERATING UPC FOR SKU NUMBER : '.            INKUT015
00114          10  PV-ERR-SKU              PIC X(08)       VALUE SPACES.INKUT015
                                                                                
00116  01  PC-PROGRAM-CONSTANTS.                                        INKUT015
00117      05  PC-ALL-ZERO-SEQ-NO          PIC X(03)       VALUE '000'. INKUT015
R21732**** 05  PC-ALL-NINE-SEQ-NO          PIC X(03)       VALUE '999'. INKUT015
W21732     05  PC-RENUMBERED-SKU           PIC X(02)       VALUE '98'.  INKUT015
00120      05  PC-MAX-RETRIES              PIC S9(3)       VALUE +3.    INKUT015
00121      05  PC-NO                       PIC X(01)       VALUE 'N'.   INKUT015
00122      05  PC-SUB-CLASS                PIC X(03)       VALUE 'SCL'. INKUT015
00123                                                                   INKUT015
00124  01  PS-PROGRAM-SWITCHES.                                         INKUT015
W30272     05  PS-RECENT-SALES-SW          PIC X(01)       VALUE 'Y'.   INKUT015
W30272         88  PS-RECENT-SALES                         VALUE 'Y'.   INKUT015
W30272         88  PS-NO-RECENT-SALES                      VALUE 'N'.   INKUT015
W30272     05  PS-REQUEST-CNTL-SW          PIC X(01)       VALUE 'N'.   INKUT015
W30272         88  PS-END-OF-REQUEST-CNTL                  VALUE 'Y'.   INKUT015
W30272         88  PS-NOT-END-OF-REQUEST-CNTL              VALUE 'N'.   INKUT015
00125      05  PS-MORE-ROWS-SW             PIC X(01)       VALUE 'Y'.   INKUT015
00126          88  PS-MORE-ROWS                            VALUE 'Y'.   INKUT015
00127          88  PS-NO-MORE-ROWS                         VALUE 'N'.   INKUT015
                                                                                
W30272 01  RQ-REQUEST-CONTROL.                                                  
W30272     05  RQ-COMMENT-IND              PIC X(01)       VALUE SPACES.        
W30272         88  RQ-COMMENTED-RECORD                     VALUE '*'.           
W30272     05  RQ-UPC-MONTH-LIMIT-X        PIC X(02)       VALUE SPACES.        
W30272     05  RQ-UPC-MONTH-LIMIT-9 REDEFINES RQ-UPC-MONTH-LIMIT-X              
W30272                                     PIC 9(02).                           
W30272     05  FILLER                      PIC X(01)       VALUE SPACE.         
W30272     05  RQ-USE-POS-RULES-IND        PIC X(01)       VALUE SPACES.        
W30272         88  RQ-USE-POS-RULES                        VALUE 'Y'.           
W30272     05  FILLER                      PIC X(01)       VALUE SPACE.         
W30272     05  RQ-CLR-MONTH-LIMIT-X        PIC X(02)       VALUE SPACES.        
W30272     05  RQ-CLR-MONTH-LIMIT-9 REDEFINES RQ-CLR-MONTH-LIMIT-X              
W30272                                     PIC 9(02).                           
W30272     05  FILLER                      PIC X(01)       VALUE SPACE.         
W30272     05  RQ-SLS-MONTH-LIMIT-X        PIC X(02)       VALUE SPACES.        
W30272     05  RQ-SLS-MONTH-LIMIT-9 REDEFINES RQ-SLS-MONTH-LIMIT-X              
W30272                                     PIC 9(02).                           
W30272     05  FILLER                      PIC X(71)       VALUE SPACES.        
                                                                                
W21732******************************************************************INKUT015
W21732*  DB2 TSKXREF TABLE                                              INKUT015
W21732******************************************************************INKUT015
W21732     EXEC SQL                                                     INKUT015
W21732        INCLUDE TSKXREF                                           INKUT015
W21732     END-EXEC.                                                    INKUT015
W21732*                                                                 INKUT015
00139 ******************************************************************INKUT015
00140 *  DB2 UPC / SKU CROSS REFERENCE TABLE                            INKUT015
00141 ******************************************************************INKUT015
00142      EXEC SQL                                                     INKUT015
00143         INCLUDE TUPCSKU                                           INKUT015
00144      END-EXEC.                                                    INKUT015
00145 *                                                                 INKUT015
W27710******************************************************************INKUT015
W27710* DB2 UPC                                                         INKUT015
W27710******************************************************************INKUT015
W27710     EXEC SQL                                                     INKUT015
W27710        INCLUDE TUPC                                              INKUT015
W27710     END-EXEC.                                                    INKUT015
W27710*                                                                 INKUT015
W30272******************************************************************INKUT015
W30272* DB2 UPCPLS PRICE LOOKUP                                         INKUT015
W30272******************************************************************INKUT015
W30272     EXEC SQL                                                     INKUT015
W30272        INCLUDE TUPCPLS                                           INKUT015
W30272     END-EXEC.                                                    INKUT015
W30272                                                                  INKUT015
W30272******************************************************************INKUT015
W30272* DB2 SKU STORE                                                   INKUT015
W30272******************************************************************INKUT015
W30272     EXEC SQL                                                     INKUT015
W30272        INCLUDE TSKST                                             INKUT015
W30272     END-EXEC.                                                    INKUT015
W30272                                                                  INKUT015
      ******************************************************************INKUT015
00147 *  DB2 MERCHANDISE AREA TABLE                                     INKUT015
00148 ******************************************************************INKUT015
00149      EXEC SQL                                                     INKUT015
00150         INCLUDE TMDSEAR                                           INKUT015
00151      END-EXEC.                                                    INKUT015
00152 *                                                                 INKUT015
00153 ******************************************************************INKUT015
00154 *  DB2 COMMUNICATION AREA                                         INKUT015
00155 ******************************************************************INKUT015
00156      EXEC SQL                                                     INKUT015
00157         INCLUDE SQLCA                                             INKUT015
00158      END-EXEC.                                                    INKUT015
00159 *                                                                 INKUT015
00160 ******************************************************************INKUT015
00161 *  DB2 COMMUNICATION AREA 2                                       INKUT015
00162 ******************************************************************INKUT015
00163      COPY SQLCA2.                                                 INKUT015
00164 *                                                                 INKUT015
00165 ******************************************************************INKUT015
00166 *  DB2 SKU CURSOR - SELECTS ALL SKUS FROM THE SKU TABLE           INKUT015
00167 ******************************************************************INKUT015
00168 *                                                                 INKUT015
00169      EXEC SQL                                                     INKUT015
00170         DECLARE SKU_CURSOR CURSOR FOR                             INKUT015
W27710          SELECT                                                  INKUT015
W27710                 A.SKU                                            INKUT015
W21732                ,A.SKU_STAT_CDE                                   INKUT015
W30272                ,A.ITM_NBR                                        INKUT015
W21732                ,A.DEPT                                           INKUT015
W21732                ,A.SUBCLASS                                       INKUT015
W27710                ,A.INTR_UPC_ID                                            
W30272                ,B.UPC_NBR                                        INKUT015
W30272                ,B.INTR_UPC_DESC                                          
W30272                ,B.EFF_BEG_DTE                                            
W21732            FROM                                                  INKUT015
W21732                 TSKXREF   A                                      INKUT015
W30272                ,TUPC      B                                      INKUT015
R21732            WHERE                                                         
R21732                  A.SKU_STAT_CDE <> '00'                                  
W30272              AND A.SKU_STAT_CDE <> '98'                                  
W30272              AND A.INTR_UPC_ID = B.INTR_UPC_ID                           
W30272              AND B.EFF_BEG_DTE <= CURRENT DATE                           
W30272              AND VALUE(B.EFF_END_DTE,'9999-12-31') > CURRENT DATE        
W30272          UNION ALL                                                       
W30272          SELECT                                                  INKUT015
W30272                 A.SKU                                            INKUT015
W30272                ,A.SKU_STAT_CDE                                   INKUT015
W30272                ,A.ITM_NBR                                        INKUT015
W30272                ,A.DEPT                                           INKUT015
W30272                ,A.SUBCLASS                                       INKUT015
W30272                ,A.INTR_UPC_ID                                            
W30272                ,0                                                INKUT015
W30272                ,B.INTR_UPC_DESC                                          
W30272                ,B.EFF_BEG_DTE                                            
W30272            FROM                                                  INKUT015
W30272                 TSKXREF   A                                      INKUT015
W30272                ,TUPC      B                                      INKUT015
W30272            WHERE                                                         
W30272                  A.SKU_STAT_CDE =  '98'                                  
W30272              AND A.INTR_UPC_ID = B.UPC_ID                                
W30272              AND B.EFF_BEG_DTE <= CURRENT DATE                           
W30272              AND VALUE(B.EFF_END_DTE,'9999-12-31') > CURRENT DATE        
W30272            ORDER BY 4,                                           INKUT015
W30272                     5,                                           INKUT015
W30272                     1                                            INKUT015
W30272          WITH UR                                                         
00178      END-EXEC.                                                    INKUT015
00179                                                                   INKUT015
00180 *                                                                 INKUT015
                                                                        INKUT015
00194 ******************************************************************INKUT015
00195 *  DB2 MDSEAR CURSOR - SELECTS ALL SUB CLASS ROWS FROM TMDSEAR    INKUT015
00196 ******************************************************************INKUT015
00197 *                                                                 INKUT015
00198      EXEC SQL                                                     INKUT015
00199         DECLARE MDSEAR_CURSOR CURSOR FOR                          INKUT015
00200           SELECT                                                  INKUT015
W30272                 DEPT_NBR                                         INKUT015
00201                 ,MAJ_CL_NBR                                       INKUT015
00202                 ,SUB_CL_NBR                                       INKUT015
W30272                ,MDSEAR_DESC                                      INKUT015
00203             FROM TMDSEAR                                          INKUT015
00204             WHERE (MDSELV_CDE = :PC-SUB-CLASS)           AND      INKUT015
00205                   (DATE (CURRENT TIMESTAMP) >= STRT_DTE) AND      INKUT015
00206                   (DATE (CURRENT TIMESTAMP) <= END_DTE)           INKUT015
W30272          WITH UR                                                         
00207      END-EXEC.                                                    INKUT015
00208                                                                   INKUT015
W27710                                                                          
00209  LINKAGE SECTION.                                                 INKUT015
00210                                                                   INKUT015
00211 ******************************************************************INKUT015
00212  PROCEDURE DIVISION.                                              INKUT015
00213 ******************************************************************INKUT015
00214                                                                   INKUT015
00215 ******************************************************************INKUT015
00216 *  A100-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    INKUT015
00217 ******************************************************************INKUT015
00218  A100-MAINLINE.                                                   INKUT015
00219      PERFORM B100-INITIALIZE.                                     INKUT015
                                                                                
00220      PERFORM Z100-OPEN-SKU-CURSOR.                                INKUT015
00221      PERFORM Z200-FETCH-SKU-ROW.                                  INKUT015
00222      PERFORM B200-PROCESS-SKU-ROWS                                INKUT015
00223          UNTIL PS-NO-MORE-ROWS.                                   INKUT015
                                                                                
00224      PERFORM Z300-CLOSE-SKU-CURSOR.                               INKUT015
00226      PERFORM Z600-OPEN-MDSEAR-CURSOR.                             INKUT015
00227      PERFORM Z650-FETCH-MDSEAR-ROW.                               INKUT015
00228      PERFORM B300-PROCESS-MDSEAR-ROWS                             INKUT015
00229          UNTIL PS-NO-MORE-ROWS.                                   INKUT015
00230      PERFORM Z675-CLOSE-MDSEAR-CURSOR.                            INKUT015
                                                                                
00231      PERFORM Z800-CLOSE-FILES.                                    INKUT015
                                                                                
W30272     DISPLAY ' '.                                                         
W30272     DISPLAY ' UPC/SKU FETCH COUNT:        ' PV-SKU-ROWS.                 
W30272     DISPLAY '    RENUMBERED SKUS:         ' PV-RENUMBERED-SKUS.          
W30272     DISPLAY ' UPC/SKU W/O RENUMBERED:     ' PV-UPC-ROWS.                 
W30272     DISPLAY '    UPC/SKU ACCEPTED:        ' PV-ACCEPTED-UPC-ROWS.        
W30272     DISPLAY '    OLD UPC, POTENTIAL DROP: ' PV-TOO-OLD-UPC-ROWS.         
W30272     DISPLAY '    NO SALES DROPPED:        ' PV-NO-SALES-ROWS.            
W30272     DISPLAY '      CLEARANCE CHECK:       ' PV-CLR-UPC-CHECK.            
L30272     DISPLAY '      FASHION SALES CHECK:   ' PV-FS-CHECK.                 
L30272     DISPLAY '      OLDER UPC CHANGED:     ' PV-OLDER-UPC-CHG.            
W30272     DISPLAY ' DUMMY SKUS GENERATED:       ' PV-DUMMY-SKU-ROWS.           
W30272     DISPLAY ' ROWS WRITTEN:               ' PV-ROWS-WRITTEN.             
                                                                                
00232      STOP RUN.                                                    INKUT015
00233 *A100-EXIT.                                                       INKUT015
00234                                                                   INKUT015
00235 ******************************************************************INKUT015
00236 *  B100-INITIALIZE - OPEN THE OUTPUT FILE                         INKUT015
00237 ******************************************************************INKUT015
00238  B100-INITIALIZE.                                                 INKUT015
00239                                                                   INKUT015
W30272     OPEN INPUT  REQUEST-CONTROL-FILE                             INKUT015
W30272          OUTPUT NEWER-UPC-FILE                                   INKUT015
W30272                 OLDER-UPC-FILE                                   INKUT015
W30272                 POS-RULE-REJECTED-FILE.                          INKUT015
                                                                        INKUT015
1122RM     DISPLAY '*****************************'.                             
1122RM     DISPLAY ' BEGIN INKUT015 PROCESSING   '.                             
1122RM     DISPLAY '*****************************'.                             
                                                                                
W30272     SET PS-NOT-END-OF-REQUEST-CNTL  TO TRUE.                             
W30272     PERFORM Z400-READ-REQUEST.                                           
W30272     PERFORM                                                              
W30272         UNTIL PS-END-OF-REQUEST-CNTL                                     
W30272             OR NOT RQ-COMMENTED-RECORD                                   
W30272         PERFORM Z400-READ-REQUEST                                        
W30272     END-PERFORM.                                                         
                                                                                
W30272     IF RQ-UPC-MONTH-LIMIT-X NUMERIC                                      
W30272         DISPLAY ' REQUESTED UPC AGE LIMIT TO '                           
W30272*                RQ-UPC-MONTH-LIMIT-9 ' AGO.'                             
1122RM                 RQ-UPC-MONTH-LIMIT-9 ' MONTHS AGO.'                      
W30272     ELSE                                                                 
W30272         DISPLAY ' *** INVALID UPC AGE LIMIT IN MONTHS, '                 
W30272                 ' DEFAULT TO: 12 MONTHS AGO'                             
W30272         MOVE 12                     TO RQ-UPC-MONTH-LIMIT-9              
W30272     END-IF.                                                              
W30272     IF RQ-CLR-MONTH-LIMIT-X NUMERIC                                      
W30272         DISPLAY ' REQUESTED CLEARANCE AGE LIMIT TO '                     
W30272*                RQ-CLR-MONTH-LIMIT-9 ' AGO.'                             
1122RM                 RQ-CLR-MONTH-LIMIT-9 ' MONTHS AGO.'                      
W30272     ELSE                                                                 
W30272         DISPLAY ' *** INVALID CLEARANCE AGE LIMIT IN MONTHS, '           
W30272                 ' DEFAULT TO: 07 MONTHS AGO'                             
W30272         MOVE 7                      TO RQ-CLR-MONTH-LIMIT-9              
W30272     END-IF.                                                              
W30272     IF RQ-SLS-MONTH-LIMIT-X NUMERIC                                      
W30272         DISPLAY ' REQUESTED LAST SALES AGE LIMIT TO '                    
W30272*                RQ-SLS-MONTH-LIMIT-9 ' AGO.'                             
1122RM                 RQ-SLS-MONTH-LIMIT-9 ' MONTHS AGO.'                      
W30272     ELSE                                                                 
W30272         DISPLAY ' *** INVALID LAST SALES AGE LIMIT IN MONTHS, '          
W30272                 ' DEFAULT TO: 03 MONTHS AGO'                             
W30272         MOVE 3                      TO RQ-SLS-MONTH-LIMIT-9              
W30272     END-IF.                                                              
W30272     IF RQ-USE-POS-RULES                                                  
W30272         DISPLAY ' USE POS-LIKE RULES.'                                   
W30272     ELSE                                                                 
W30272         DISPLAY ' DO NOT USE POS-LIKE RULES.'                            
W30272     END-IF.                                                              
                                                                                
W30272     EXEC SQL                                                     INKUT015
W30272         SELECT                                                   INKUT015
W30272                CURRENT DATE                                      INKUT015
W30272               ,CURRENT DATE - 12 MONTHS                          INKUT015
W30272               ,CURRENT DATE - 07 MONTHS                          INKUT015
W30272               ,CURRENT DATE - 03 MONTHS                          INKUT015
W30272           INTO                                                   INKUT015
W30272               :PV-CURRENT-DTE                                    INKUT015
W30272              ,:PV-UPC-CTOFF-DTE                                  INKUT015
W30272              ,:PV-CLR-CTOFF-DTE                                  INKUT015
W30272              ,:PV-SLS-CTOFF-DTE                                  INKUT015
W30272           FROM                                                           
W30272                SYSIBM.SYSDUMMY1                                          
W30272     END-EXEC.                                                    INKUT015
W30272                                                                  INKUT015
W30272     IF SQLCODE = 0                                               INKUT015
W30272* CALCULATE UPC CUTOFF DATE                                               
W30272         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                           
W30272         SET DPG52-LK-DTE-ISO-FMT       TO TRUE                           
W30272         SET DPG51-DECREMENT-DATE       TO TRUE                           
W30272         MOVE PV-CURRENT-DTE            TO DPG52-DB2-ISO-DATE-FMT         
W30272         COMPUTE DPG51-INCR-DECR-DAYS-9 =                                 
W30272                 RQ-UPC-MONTH-LIMIT-9 * 30                                
W30272         CALL DP500-KOHLS-CALENDAR-ROUTINE                                
W30272             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                    
W30272         IF (DPG54-SEVERE-ERROR OR                                        
W30272             DPG54-WARNING-ERROR)                                         
W30272             DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT               
W30272             DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9            
W30272             DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND           
W30272             DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND              
W30272             DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND         
W30272             DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND               
W30272             DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND                   
W30272             DISPLAY                    DPG54-ERROR-MESSAGE               
W30272             DISPLAY ' ** USE DEFAULT DATE FOR UPC CUTOFF'                
W30272         ELSE                                                             
W30272             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-UPC-CTOFF-DTE              
W30272         END-IF                                                           
W30272                                                                          
W30272* CALCULATE CLEARANCE CUTOFF DATE                                         
W30272         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                           
W30272         SET DPG52-LK-DTE-ISO-FMT       TO TRUE                           
W30272         SET DPG51-DECREMENT-DATE       TO TRUE                           
W30272         MOVE PV-CURRENT-DTE            TO DPG52-DB2-ISO-DATE-FMT         
W30272         COMPUTE DPG51-INCR-DECR-DAYS-9 =                                 
W30272                 RQ-CLR-MONTH-LIMIT-9 * 30                                
W30272         CALL DP500-KOHLS-CALENDAR-ROUTINE                                
W30272             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                    
W30272         IF (DPG54-SEVERE-ERROR OR                                        
W30272             DPG54-WARNING-ERROR)                                         
W30272             DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT               
W30272             DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9            
W30272             DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND           
W30272             DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND              
W30272             DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND         
W30272             DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND               
W30272             DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND                   
W30272             DISPLAY                    DPG54-ERROR-MESSAGE               
W30272             DISPLAY ' ** USE DEFAULT DATE FOR CLEARANCE CUTOFF'          
W30272         ELSE                                                             
W30272             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-CLR-CTOFF-DTE              
W30272         END-IF                                                           
W30272                                                                          
W30272* CALCULATE CLEARANCE CUTOFF DATE                                         
W30272         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                           
W30272         SET DPG52-LK-DTE-ISO-FMT       TO TRUE                           
W30272         SET DPG51-DECREMENT-DATE       TO TRUE                           
W30272         MOVE PV-CURRENT-DTE            TO DPG52-DB2-ISO-DATE-FMT         
W30272         COMPUTE DPG51-INCR-DECR-DAYS-9 =                                 
W30272                 RQ-SLS-MONTH-LIMIT-9 * 30                                
W30272         CALL DP500-KOHLS-CALENDAR-ROUTINE                                
W30272             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                    
W30272         IF (DPG54-SEVERE-ERROR OR                                        
W30272             DPG54-WARNING-ERROR)                                         
W30272             DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT               
W30272             DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9            
W30272             DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND           
W30272             DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND              
W30272             DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND         
W30272             DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND               
W30272             DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND                   
W30272             DISPLAY                    DPG54-ERROR-MESSAGE               
W30272             DISPLAY ' ** USE DEFAULT DATE FOR LAST SALES CUTOFF'         
W30272         ELSE                                                             
W30272             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-SLS-CTOFF-DTE              
W30272         END-IF                                                           
W30272                                                                          
L30272* REFORMAT THE SALES CUTOFF AND CURRENT DATE TO FASHION SALES             
L30272* DATE OF DECIMAL (7, 0)                                                  
L30272         MOVE PV-SLS-CTOFF-DTE(3:2) TO PV-OLD-SALES-DTE-YY                
L30272         MOVE PV-SLS-CTOFF-DTE(6:2) TO PV-OLD-SALES-DTE-MM                
L30272         MOVE PV-SLS-CTOFF-DTE(9:2) TO PV-OLD-SALES-DTE-DD                
L30272         MOVE PV-OLD-SALES-DTE-9    TO PV-OLD-SALES-DATE                  
                                                                                
L30272         MOVE PV-CURRENT-DTE(3:2) TO PV-CURR-FASHION-DTE-YY               
L30272         MOVE PV-CURRENT-DTE(6:2) TO PV-CURR-FASHION-DTE-MM               
L30272         MOVE PV-CURRENT-DTE(9:2) TO PV-CURR-FASHION-DTE-DD               
L30272         MOVE PV-CURR-FASHION-DTE-9 TO PV-CURR-FS-DATE                    
                                                                                
L30272         MOVE PV-UPC-CTOFF-DTE(3:2) TO PV-LAST-RCVD-DTE-YY                
L30272         MOVE PV-UPC-CTOFF-DTE(6:2) TO PV-LAST-RCVD-DTE-MM                
L30272         MOVE PV-UPC-CTOFF-DTE(9:2) TO PV-LAST-RCVD-DTE-DD                
L30272         MOVE PV-LAST-RCVD-DTE-9    TO PV-LAST-RCVD-DATE                  
                                                                                
W30272         DISPLAY ' '                                                      
W30272         DISPLAY ' CURRENT DATE:             ' PV-CURRENT-DTE             
L30272         DISPLAY '   FS CURRENT:             ' PV-CURR-FS-DATE            
L30272         DISPLAY ' UPC CUTOFF/LAST RECEIVED: ' PV-UPC-CTOFF-DTE           
L30272         DISPLAY '   FS LAST RECEIVED:       ' PV-LAST-RCVD-DATE          
W30272         DISPLAY ' CLEARANCE CUTOFF:         ' PV-CLR-CTOFF-DTE           
W30272         DISPLAY ' LAST SALES CUTOFF:        ' PV-SLS-CTOFF-DTE           
L30272         DISPLAY '   FS LAST SALES:          ' PV-OLD-SALES-DATE          
W30272         DISPLAY ' '                                                      
W30272     ELSE                                                                 
W30272         MOVE 'B100-INITIALIZE   ' TO PV-PARAGRAPH-NAME           INKUT015
W30272         MOVE 'GETTING LAST YEAR"S DATE   '                       INKUT015
W30272             TO PV-DB2-OPER-ATTEMPTED                             INKUT015
W30272         PERFORM Z900-SQL-ERROR                                   INKUT015
W30272     END-IF.                                                      INKUT015
                                                                                
W30272     MOVE ZEROES               TO UPCPLS-UPC-ID                           
W30272                                  TSKST-ITEM-NMBR.                        
00242                                                                   INKUT015
00243 *B100-EXIT.                                                       INKUT015
00244                                                                   INKUT015
00245 ******************************************************************INKUT015
00246 *  B200-PROCESS-SKU-ROWS - PROCESS EACH ROW FETCHED FROM THE SKU  INKUT015
00247 *  CURSOR.                                                        INKUT015
00248 ******************************************************************INKUT015
00249  B200-PROCESS-SKU-ROWS.                                           INKUT015
00250                                                                   INKUT015
W30272     ADD +1                        TO PV-SKU-ROWS.                        
W30272     IF SKXREF-DEPT = NI-DEPT-9                                           
W30272         CONTINUE                                                         
W30272     ELSE                                                                 
W30272         DISPLAY ' PROCESSING DEPT: ' SKXREF-DEPT                         
W30272                 ' ... ' FUNCTION CURRENT-DATE                            
W30272     END-IF.                                                              
W21732     MOVE SKXREF-DEPT         TO NI-DEPT-9.                          CL**8
W21732     MOVE NI-DEPT             TO IN015O-DEPT-NBR.                    CL**8
W21732     MOVE SKXREF-SUBCLASS     TO NI-SUB-CLASS-9.                     CL**8
1122RM     MOVE SKXREF-SUBCLASS     TO PV-IN015O-SUBCL-NBR-9.              CL**8
1122RM     MOVE PV-IN015O-SUBCL-NBR-3-4 TO IN015O-SUBCL-NBR.               CL**8
                                                                                
W21732     MOVE SKXREF-SKU          TO NI-SKU-9.                           CL**8
W21732     MOVE NI-SKU              TO IN015O-SKU-NBR.                     CL**8
W30272     MOVE UPC-INTR-UPC-DESC   TO IN015O-INTR-UPC-DESC.                    
W27710                                                                          
W27710*   GET THE DESCRIPTION FOR RENUMBERED SKU                                
W21732     IF SKXREF-SKU-STAT-CDE = PC-RENUMBERED-SKU                   INKUT015
00254          MOVE ZEROES          TO IN015O-UPC-NBR                   INKUT015
W30272         ADD +1               TO PV-RENUMBERED-SKUS                       
00255          PERFORM Z500-WRITE-RECORD                                INKUT015
00256      ELSE                                                         INKUT015
W30272         IF RQ-USE-POS-RULES                                              
L30272             AND SKXREF-ITM-NBR NOT = TSKST-ITEM-NMBR                     
W30272             PERFORM D100-CLEARANCE-SALES                                 
W30272         END-IF                                                           
00260          PERFORM C100-PROCESS-SKU                                 INKUT015
00263      END-IF.                                                      INKUT015
00264      PERFORM Z200-FETCH-SKU-ROW.                                  INKUT015
00265                                                                   INKUT015
W27710*B200-EXIT.                                                       INKUT015
                                                                                
00266 ******************************************************************INKUT015
00267 *  B300-PROCESS-MDSEAR-ROWS - PROCESS EACH ROW FETCHED FROM THE   INKUT015
00268 *  MDSEAR CURSOR.  WRITE A RECORD TO THE OUTPUT FILE FOR THE      INKUT015
00269 *  DEPT/CLASS WITH ZEROS AS THE SEQ NO, THEN WITH NINES.          INKUT015
00270 *  ADDED FOR WR# 2042                                             INKUT015
00271 ******************************************************************INKUT015
00272  B300-PROCESS-MDSEAR-ROWS.                                        INKUT015
00273                                                                   INKUT015
W21732     MOVE MDSEAR-DEPT-NBR      TO PV-DEPT-NBR                     INKUT015
W21732                                  NI-DEPT-9.                              
W21732     MOVE NI-DEPT              TO IN015O-DEPT-NBR.                        
00275      MOVE MDSEAR-MAJ-CL-NBR    TO PV-TEMP-MAJ-CL.                 INKUT015
W21732     MOVE MDSEAR-SUB-CL-NBR    TO PV-TEMP-SUB-CL                  INKUT015
W21732                                  NI-SUB-CLASS-9.                 INKUT015
1122RM     MOVE 0                    TO PV-IN015O-SUBCL-NBR1.              CL**8
1122RM     MOVE MDSEAR-SUB-CL-NBR    TO PV-IN015O-SUBCL-NBR2-4.            CL**8
1122RM*    MOVE PV-IN015O-SUBCL-NBR  TO IN015O-SUBCL-NBR.                  CL**8
1122RM     MOVE PV-IN015O-SUBCL-NBR-3-4 TO IN015O-SUBCL-NBR.               CL**8
00277      MOVE PV-TEMP-MAJ-CL-BYTE1 TO PV-TEMP-CL-BYTE1.               INKUT015
00278      MOVE PV-TEMP-SUB-CL-BYTE3 TO PV-TEMP-CL-BYTE2.               INKUT015
00279      MOVE PV-TEMP-CL           TO PV-CL-NBR.                      INKUT015
00280      MOVE PC-ALL-ZERO-SEQ-NO   TO PV-SEQ-NBR.                     INKUT015
00281      MOVE PV-SKU-NBR           TO IN015O-SKU-NBR.                    CL**7
W30272     MOVE MDSEAR-DESC          TO IN015O-INTR-UPC-DESC.              CL**7
00282                                                                   INKUT015
00283      PERFORM C200-GENERATE-UPC.                                   INKUT015
00284                                                                   INKUT015
00285      IF  DP040I-NO-ERROR-DETECTED                                 INKUT015
00286          MOVE DP040I-UPC-CODE  TO PV-TEMP-UPC                     INKUT015
00287          MOVE PV-TEMP-UPC-LAST TO IN015O-UPC-NBR                  INKUT015
W30272         ADD +1                TO PV-DUMMY-SKU-ROWS                       
W30272         MOVE PV-CURRENT-DTE   TO UPC-EFF-BEG-DTE                         
00288          PERFORM Z500-WRITE-RECORD                                INKUT015
00289      ELSE                                                         INKUT015
00290          MOVE PV-SKU-NBR       TO PV-ERR-SKU                         CL**7
00291          DISPLAY PV-ERROR-MESSAGE                                 INKUT015
00292      END-IF.                                                      INKUT015
00293                                                                   INKUT015
00308      PERFORM Z650-FETCH-MDSEAR-ROW.                               INKUT015
00309                                                                   INKUT015
00310 *B300-EXIT.                                                       INKUT015
00311                                                                   INKUT015
00312 ******************************************************************INKUT015
00313 *  C100-PROCESS-SKU - PROCESS UPC INFO FOR A GIVEN INTR-UPC       INKUT015
00315 ******************************************************************INKUT015
00316  C100-PROCESS-SKU.                                                INKUT015
TEMP  *    DISPLAY '   PROCESSING UPC: ' UPC-UPC-NBR                            
TEMP  *            ' ' FUNCTION CURRENT-DATE.                                   
W30272     ADD +1                        TO PV-UPC-ROWS.                        
W30272     IF PS-RECENT-SALES                                                   
W30272         PERFORM D200-CHECK-PLU-DWNLD                                     
                                                                                
L30272* CHECK LAST RECEIVED ON FASHION SALES, IF UPC IS OLDER                   
L30272         IF UPC-EFF-BEG-DTE < PV-UPC-CTOFF-DTE                            
L30272* GET FASHION SALES INFORMATION, IF NOT USING POS-LIKE RULE               
L30272* OR ITEM NUMBER IS NOT THE SAME AS PREVIOUSLY RETRIEVED.                 
L30272* OTHERWISE, THE INFORMATION IS ALREADY AVAILABLE.                        
L30272             IF RQ-USE-POS-RULES                                          
L30272                 AND SKXREF-ITM-NBR = TSKST-ITEM-NMBR                     
L30272                 CONTINUE                                                 
L30272             ELSE                                                         
L30272                 PERFORM D175-GET-FASHION-SALES                           
L30272             END-IF                                                       
TEMP  *            DISPLAY ' UPC: ' UPC-UPC-NBR                                 
TEMP  *                    ' 12 MONTHS AGO: ' PV-LAST-RCVD-DATE                 
TEMP  *                    ' CURRENT: ' PV-CURR-FS-DATE                         
TEMP  *                    ' LAST RECEIVED: ' TSKST-LAST-RCVD-DATE              
                                                                                
L30272* CHECK TO SEE IF CORP LAST RECEIVED DATE ON FASHION SALES (FS)           
L30272* IS BEFORE THE LAST RECEIVED CUTOFF (SAME AS INV/UPC CUTOFF DATE)        
L30272* ALSO, CHECK TO SEE IF CORP LAST RECEIVED DATE ON FS IS AFTER            
L30272* CURRENT DATE, BECAUSE FS LAST RECEIVED DATE IS A 7 DIGIT DECIMAL        
L30272* NUMBER WHICH CAN RESULT IN 1999 (OR 99) BEING GREATER THAN              
L30272* THE YEAR 2006 (OR 06).                                                  
L30272* IF ALL CONDITIONS ARE MET, LEAVE THE UPC BEGINNING EFFECTIVE            
L30272* DATE ALONE, WHICH WILL PUT THE RECORD IN THE OLDER EXTRACT              
L30272* OTHERWISE CHANGE THE UPC BEG EFFECTIVE DATE TO CURRENT WHICH            
L30272* WILL PUT THE RECORD IN THE NEWER EXTRACT                                
L30272* LASTLY, VERIFY THAT THERE ARE NO ON-HANDS.                              
L30272             IF TSKST-LAST-RCVD-DATE NOT = ZEROES                         
L30272                 AND (TSKST-LAST-RCVD-DATE < PV-LAST-RCVD-DATE OR         
L30272                    TSKST-LAST-RCVD-DATE > PV-CURR-FS-DATE)               
L30272                 AND TSKST-ONHAND-QTY = ZEROES                            
L30272                 CONTINUE                                                 
L30272             ELSE                                                         
L30272                 ADD +1                    TO PV-OLDER-UPC-CHG            
L30272                 MOVE PV-CURRENT-DTE       TO UPC-EFF-BEG-DTE             
L30272             END-IF                                                       
L30272         END-IF                                                           
W30272         ADD +1                        TO PV-ACCEPTED-UPC-ROWS            
W30272         PERFORM Z500-WRITE-RECORD                                INKUT015
W30272     ELSE                                                                 
TEMP  *        DISPLAY '   SKU: ' SKXREF-SKU                                    
TEMP  *                ' UPC: ' UPC-UPC-NBR                                     
TEMP  *                ' W/O RECENT SALES. ' FUNCTION CURRENT-DATE              
W30272         ADD +1                        TO PV-NO-SALES-ROWS                
W30272         MOVE ZEROES              TO IN015O-SOURCE-IND                    
W30272         WRITE POS-RULE-REJECTED-REC FROM IN015O-SKU-INFO             INKU
W30272     END-IF.                                                              
                                                                                
00327 *C100-EXIT.                                                       INKUT015
00328                                                                   INKUT015
00329 ****************************************************************  INKUT015
W21732*  C200-GENERATE-UPC. REPLACE CALL TO DPKUT040 FOR GENERATING     INKUT015
W21732*  INERNAL UPC WITH C300-GEN-INTERNAL-UPC PARAGRAPH.              INKUT015
00332 ****************************************************************  INKUT015
00333  C200-GENERATE-UPC.                                               INKUT015
                                                                        INKUT015
00335      SET DP040I-GEN-INTERNAL-UPC-OPTION TO TRUE.                  INKUT015
00336      MOVE PV-SKU-NBR TO DP040I-SKU-NUMBER.                           CL**7
00337                                                                   INKUT015
R21732     CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                                  
R21732                     USING DP040I-UPC-CHECK-DIGIT-PARMS.                  
00339                                                                           
00340 *C200-EXIT.                                                       INKUT015
00341                                                                   INKUT015
W30272****************************************************************          
W30272*  D100-CLEARANCE-SALES. CHECK CLEARANCE DURATION THEN CHECK SALES        
W30272****************************************************************          
W30272 D100-CLEARANCE-SALES.                                                    
W30272                                                                          
W30272     PERFORM D150-CHECK-CLR-DATES.                                        
W30272     IF UPCPLS-ORIG-CLR-DTE < PV-CLR-CTOFF-DTE                            
L30272         PERFORM D175-GET-FASHION-SALES                                   
                                                                                
L30272* CHECK TO SEE IF CORP LAST SALES DATE ON FASHION SALES (FS)              
L30272* IS BEFORE THE SALES CUTOFF DATE.                                        
L30272* ALSO, CHECK TO SEE IF CORP LAST SALES DATE ON FS IS AFTER               
L30272* CURRENT DATE, BECAUSE FS LAST SALES DATE IS A 7 DIGIT DECIMAL           
L30272* NUMBER WHICH CAN RESULT IN 1999 (OR 99) BEING GREATER THAN              
L30272* THE YEAR 2006 (OR 06).                                                  
L30272* LASTLY, VERIFY THAT THERE ARE NO ON-HANDS.                              
L30272         IF TSKST-LAST-SALE-DATE NOT = ZEROES                             
L30272             AND (TSKST-LAST-SALE-DATE < PV-OLD-SALES-DATE OR             
L30272                TSKST-LAST-SALE-DATE > PV-CURR-FS-DATE)                   
L30272             AND TSKST-ONHAND-QTY = ZEROES                                
L30272             SET PS-NO-RECENT-SALES    TO TRUE                            
L30272         END-IF                                                           
W30272     END-IF.                                                              
                                                                                
W30272****************************************************************          
W30272*  D150-CHECK-CLR-DATES. CHECK CLEARANCE DURATION                         
W30272****************************************************************          
W30272 D150-CHECK-CLR-DATES.                                                    
W30272                                                                          
W30272     SET PS-RECENT-SALES       TO TRUE.                                   
W30272     IF SKXREF-SKU-STAT-CDE = '30'                                        
W30272         ADD +1                   TO PV-CLR-UPC-CHECK                     
W30272         MOVE SKXREF-INTR-UPC-ID  TO UPCPLS-UPC-ID                        
W30272                                                                          
W30272         EXEC SQL                                                         
W30272             SELECT                                                       
W30272                     ORIG_CLR_DTE                                         
W30272               INTO                                                       
W30272                    :UPCPLS-ORIG-CLR-DTE                                  
W30272               FROM                                                       
W30272                    TUPCPLS                                               
W30272               WHERE                                                      
W30272                     UPC_ID = :UPCPLS-UPC-ID                              
W30272                 AND STR_NBR = SMALLINT(0)                                
W30272                 AND CURRENT TIMESTAMP >= EFF_BEG_TMST                    
W30272                 AND CURRENT TIMESTAMP <= VALUE(EFF_END_TMST,             
W30272                                      '9999-12-31-23.59.59.9999')         
W30272             WITH UR                                                      
W30272         END-EXEC                                                         
W30272                                                                          
W30272         IF SQLCODE = 0                                                   
W30272             CONTINUE                                                     
W30272         ELSE                                                             
W30272             MOVE PV-CURRENT-DTE    TO UPCPLS-ORIG-CLR-DTE                
W30272             DISPLAY ' *** UNABLE TO GET NUMBER OF CLEARANCE'             
W30272                     ' DAYS FOR UPC-ID ' UPCPLS-UPC-ID                    
W30272         END-IF                                                           
W30272     ELSE                                                                 
W30272         MOVE PV-CURRENT-DTE    TO UPCPLS-ORIG-CLR-DTE                    
W30272     END-IF.                                                              
                                                                                
W30272****************************************************************          
L30272*  D175-GET-FASHION-SALES. CHECK LAST SALES DURATION                      
W30272****************************************************************          
L30272 D175-GET-FASHION-SALES.                                                  
W30272                                                                          
L30272     MOVE SKXREF-ITM-NBR      TO TSKST-ITEM-NMBR.                         
L30272     ADD +1                   TO PV-FS-CHECK.                             
W30272     EXEC SQL                                                             
W30272         SELECT                                                           
W30272                 LAST_SALE_DATE                                           
L30272                ,LAST_RCVD_DATE                                           
W30272                ,ONHAND_QTY                                               
W30272           INTO                                                           
W30272                :TSKST-LAST-SALE-DATE                                     
L30272               ,:TSKST-LAST-RCVD-DATE                                     
W30272               ,:TSKST-ONHAND-QTY                                         
W30272           FROM                                                           
W30272                TSKST                                                     
W30272           WHERE                                                          
W30272                 ITEM_NMBR = :TSKST-ITEM-NMBR                             
W30272             AND LOC_NBR = SMALLINT(0)                                    
W30272         WITH UR                                                          
W30272     END-EXEC.                                                            
W30272                                                                          
W30272     IF SQLCODE = 0                                                       
L30272         CONTINUE                                                         
L30272     ELSE                                                                 
L30272         MOVE ZEROES               TO TSKST-LAST-SALE-DATE                
L30272                                      TSKST-LAST-RCVD-DATE                
L30272         MOVE +1                   TO TSKST-ONHAND-QTY                    
W30272     END-IF.                                                              
                                                                                
W30272****************************************************************          
W30272*  D200-CHECK-PLU-DWNLD.  GET/CHECK PLU DOWNLOAD INDICATOR                
W30272****************************************************************          
W30272 D200-CHECK-PLU-DWNLD.                                                    
W30272                                                                          
W30272     MOVE UPC-UPC-NBR TO PV-UPC-NBR-UNPACKED                      INKUT015
W30272                         TUPCSKU-UPC-NBR.                                 
                                                                                
W30272     EXEC SQL                                                     INKU    
W30272         SELECT                                                   INKU    
W30272                 PLU_DWNLD_IND                                    INKU    
W30272           INTO                                                           
W30272                :TUPCSKU-PLU-DWNLD-IND                                    
W30272           FROM                                                   INKU    
W30272                TUPCSKU                                           INKU    
W30272           WHERE                                                  INKU    
W30272                 UPC_NBR = :TUPCSKU-UPC-NBR                       INKU    
W30272         WITH UR                                                          
W30272     END-EXEC.                                                    INKU    
W30272                                                                  INKU    
W30272     IF SQLCODE NOT = 0                                           INKU    
W30272         DISPLAY ' *** COULD NOT DETERMINE PLU DOWNLOAD IND'              
W30272                 ' FOR ' TUPCSKU-UPC-NBR                                  
W30272         MOVE SPACES               TO TUPCSKU-PLU-DWNLD-IND       INKU    
W30272     END-IF.                                                      INKU    
                                                                                
      * ZERO OUT THE OUTPUT UPC NUMBER FOR PLU DOWNLOAD OF 'NO'                 
           IF TUPCSKU-PLU-DWNLD-IND = PC-NO                             INKU    
               MOVE ZEROES               TO IN015O-UPC-NBR              INKU    
00320      ELSE                                                         INKU    
00322          MOVE PV-UPC-NBR-UNP-LAST TO IN015O-UPC-NBR               INKU    
00323      END-IF.                                                      INKU    
                                                                                
      ******************************************************************INKUT015
W21732*  Z100-OPEN-CURSOR - OPENS THE CURSOR FOR THE TSKXREF TABLE.     INKUT015
00344 ******************************************************************INKUT015
00345  Z100-OPEN-SKU-CURSOR.                                            INKUT015
00346                                                                   INKUT015
W30272     SET PS-MORE-ROWS TO TRUE.                                    INKUT015
00348                                                                   INKUT015
00349      PERFORM                                                      INKUT015
00350          WITH TEST AFTER                                          INKUT015
00351          VARYING PV-SQL-SUB                                       INKUT015
00352          FROM 1 BY 1                                              INKUT015
00353          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       INKUT015
00354                    OR SQLCODE = 0                                 INKUT015
00355                    OR SQLCODE = +100)                             INKUT015
00356                                                                   INKUT015
00357      EXEC SQL                                                     INKUT015
00358          OPEN SKU_CURSOR                                          INKUT015
00359      END-EXEC                                                     INKUT015
00360                                                                   INKUT015
00361          EVALUATE TRUE                                            INKUT015
00362              WHEN SQLCODE = -904                                  INKUT015
00363              WHEN SQLCODE = -911                                  INKUT015
00364              WHEN SQLCODE = +100                                  INKUT015
00365              WHEN SQLCODE = 0                                     INKUT015
00366                  CONTINUE                                         INKUT015
00367              WHEN SQLWARN NOT = SPACES                            INKUT015
00368              WHEN SQLCODE NOT = ZERO                              INKUT015
00369                  MOVE 'Z100-OPEN-SKU-CURSOR'                      INKUT015
00370                                TO  PV-PARAGRAPH-NAME              INKUT015
00371                  MOVE 'OPEN ON SKU CURSOR'                        INKUT015
00372                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00373                  PERFORM Z900-SQL-ERROR                           INKUT015
00374          END-EVALUATE                                             INKUT015
00375      END-PERFORM.                                                 INKUT015
                                                                        INKUT015
00377      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        INKUT015
00378          MOVE 'Z100-OPEN-SKU-CURSOR'                              INKUT015
00379                                TO  PV-PARAGRAPH-NAME              INKUT015
00380          MOVE 'OPEN RETRIES EXCEEDED'                             INKUT015
00381                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00382          PERFORM Z900-SQL-ERROR                                   INKUT015
00383      END-IF.                                                      INKUT015
00384 *Z100-EXIT.                                                       INKUT015
00385                                                                   INKUT015
00430 ******************************************************************INKUT015
W21732*  Z200-FETCH-SKU-ROW - FETCHS THE DB2 TSKXREF INFO INTO THE      INKUT015
00432 *  DCLGEN                                                         INKUT015
00433 ******************************************************************INKUT015
00434  Z200-FETCH-SKU-ROW.                                              INKUT015
00435      EXEC SQL                                                     INKUT015
00436          FETCH SKU_CURSOR                                         INKUT015
W21732         INTO  :SKXREF-SKU                                        INKUT015
W21732              ,:SKXREF-SKU-STAT-CDE                               INKUT015
W30272              ,:SKXREF-ITM-NBR                                    INKUT015
W21732              ,:SKXREF-DEPT                                       INKUT015
W21732              ,:SKXREF-SUBCLASS                                   INKUT015
W27710              ,:SKXREF-INTR-UPC-ID                                        
W30272              ,:UPC-UPC-NBR                                       INKUT015
W30272              ,:UPC-INTR-UPC-DESC                                 INKUT015
W30272              ,:UPC-EFF-BEG-DTE                                   INKUT015
00442      END-EXEC.                                                    INKUT015
00443                                                                   INKUT015
00444      IF SQLCODE NOT = 0                                           INKUT015
00445          IF SQLCODE = +100                                        INKUT015
00446              SET PS-NO-MORE-ROWS TO TRUE                          INKUT015
00447          ELSE                                                     INKUT015
00448              MOVE 'Z200-FETCH-SKU-ROW'                            INKUT015
00449                                    TO PV-PARAGRAPH-NAME           INKUT015
00450              MOVE 'FETCHING ROW FROM SKU TABLE'                   INKUT015
00451                                    TO PV-DB2-OPER-ATTEMPTED       INKUT015
00452              PERFORM Z900-SQL-ERROR                               INKUT015
00453      END-IF.                                                      INKUT015
00454                                                                   INKUT015
00455 *Z200-EXIT.                                                       INKUT015
00456                                                                   INKUT015
00482 ******************************************************************INKUT015
W21732*  Z300-CLOSE-SKU-CURSOR - CLOSES THE CURSOR FOR THE TSKXREF      INKUT015
00485 ******************************************************************INKUT015
00486  Z300-CLOSE-SKU-CURSOR.                                           INKUT015
00487                                                                   INKUT015
00488      PERFORM                                                      INKUT015
00489          WITH TEST AFTER                                          INKUT015
00490          VARYING PV-SQL-SUB                                       INKUT015
00491          FROM 1 BY 1                                              INKUT015
00492          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       INKUT015
00493                    OR SQLCODE = 0                                 INKUT015
00494                    OR SQLCODE = +100)                             INKUT015
00495                                                                   INKUT015
00496          EXEC SQL                                                 INKUT015
00497              CLOSE SKU_CURSOR                                     INKUT015
00498          END-EXEC                                                 INKUT015
00499                                                                   INKUT015
00500          EVALUATE TRUE                                            INKUT015
00501              WHEN SQLCODE = -904                                  INKUT015
00502              WHEN SQLCODE = -911                                  INKUT015
00503              WHEN SQLCODE = +100                                  INKUT015
00504              WHEN SQLCODE = 0                                     INKUT015
00505                  CONTINUE                                         INKUT015
00506              WHEN SQLWARN NOT = SPACES                            INKUT015
00507              WHEN SQLCODE NOT = ZERO                              INKUT015
00508                  MOVE 'Z300-CLOSE-SKU-CURSOR'                     INKUT015
00509                                TO  PV-PARAGRAPH-NAME              INKUT015
00510                  MOVE 'CLOSE ON SKU CURSOR'                       INKUT015
00511                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00512                  PERFORM Z900-SQL-ERROR                           INKUT015
00513          END-EVALUATE                                             INKUT015
00514      END-PERFORM.                                                 INKUT015
                                                                        INKUT015
00516      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        INKUT015
00517          MOVE 'Z300-CLOSE-SKU-CURSOR'                             INKUT015
00518                                TO  PV-PARAGRAPH-NAME              INKUT015
00519          MOVE 'CLOSE RETRIES EXCEEDED'                            INKUT015
00520                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00521          PERFORM Z900-SQL-ERROR                                   INKUT015
00522      END-IF.                                                      INKUT015
00523                                                                   INKUT015
00524 *Z300-EXIT.                                                       INKUT015
00525                                                                   INKUT015
W30272******************************************************************INKUT015
W30272* Z400-READ-REQUEST -  WRITE OUTPUT RECORD.                       INKUT015
W30272******************************************************************INKUT015
W30272 Z400-READ-REQUEST.                                               INKUT015
W30272                                                                  INKUT015
W30272     READ REQUEST-CONTROL-FILE INTO RQ-REQUEST-CONTROL                    
W30272         AT END SET PS-END-OF-REQUEST-CNTL TO TRUE.                       
                                                                                
      ******************************************************************INKUT015
00591 * Z500-WRITE-RECORD -  WRITE OUTPUT RECORD.                       INKUT015
00592 ******************************************************************INKUT015
00593  Z500-WRITE-RECORD.                                               INKUT015
00594                                                                   INKUT015
W30272     ADD +1                        TO PV-ROWS-WRITTEN.                    
W30272     IF UPC-EFF-BEG-DTE < PV-UPC-CTOFF-DTE                                
W30272         MOVE +1               TO IN015O-SOURCE-IND                       
W30272         ADD +1                TO PV-TOO-OLD-UPC-ROWS                     
W30272         WRITE OLDER-UPC-RECORD   FROM IN015O-SKU-INFO                INKU
W30272     ELSE                                                                 
W30272         MOVE ZEROES           TO IN015O-SOURCE-IND                       
W30272         WRITE NEWER-UPC-RECORD   FROM IN015O-SKU-INFO                INKU
W30272     END-IF.                                                              
00597 *Z500-EXIT.                                                       INKUT015
00598                                                                   INKUT015
00599 ******************************************************************INKUT015
W21732*  Z600-OPEN-CURSOR - OPENS THE CURSOR FOR THE TMDSEAR TABLE.     INKUT015
00601 *  ADDED FOR WR# 2042                                             INKUT015
00602 ******************************************************************INKUT015
00603  Z600-OPEN-MDSEAR-CURSOR.                                         INKUT015
00604                                                                   INKUT015
W30272     SET PS-MORE-ROWS TO TRUE.                                    INKUT015
00606                                                                   INKUT015
00607      PERFORM                                                      INKUT015
00608          WITH TEST AFTER                                          INKUT015
00609          VARYING PV-SQL-SUB                                       INKUT015
00610          FROM 1 BY 1                                              INKUT015
00611          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       INKUT015
00612                    OR SQLCODE = 0                                 INKUT015
00613                    OR SQLCODE = +100)                             INKUT015
00614                                                                   INKUT015
00615      EXEC SQL                                                     INKUT015
00616          OPEN MDSEAR_CURSOR                                       INKUT015
00617      END-EXEC                                                     INKUT015
00618                                                                   INKUT015
00619          EVALUATE TRUE                                            INKUT015
00620              WHEN SQLCODE = -904                                  INKUT015
00621              WHEN SQLCODE = -911                                  INKUT015
00622              WHEN SQLCODE = +100                                  INKUT015
00623              WHEN SQLCODE = 0                                     INKUT015
00624                  CONTINUE                                         INKUT015
00625              WHEN SQLWARN NOT = SPACES                            INKUT015
00626              WHEN SQLCODE NOT = ZERO                              INKUT015
00627                  MOVE 'Z600-OPEN-MDSEAR-CURSOR'                   INKUT015
00628                                TO  PV-PARAGRAPH-NAME              INKUT015
00629                  MOVE 'OPEN ON MDSEAR CURSOR'                     INKUT015
00630                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00631                  PERFORM Z900-SQL-ERROR                           INKUT015
00632          END-EVALUATE                                             INKUT015
00633      END-PERFORM.                                                 INKUT015
                                                                        INKUT015
00635      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        INKUT015
00636          MOVE 'Z600-OPEN-MDSEAR-CURSOR'                           INKUT015
00637                                TO  PV-PARAGRAPH-NAME              INKUT015
00638          MOVE 'OPEN RETRIES EXCEEDED'                             INKUT015
00639                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00640          PERFORM Z900-SQL-ERROR                                   INKUT015
00641      END-IF.                                                      INKUT015
00642 *Z600-EXIT.                                                       INKUT015
00643                                                                   INKUT015
00644 ******************************************************************INKUT015
00645 *  Z650-FETCH-MDSEAR-ROW - FETCHS THE DB2 MDSEAR INFO INTO THE    INKUT015
00646 *  DCLGEN                                                         INKUT015
00647 *  ADDED FOR WR# 2042                                             INKUT015
00648 ******************************************************************INKUT015
00649  Z650-FETCH-MDSEAR-ROW.                                           INKUT015
00650      EXEC SQL                                                     INKUT015
00651          FETCH MDSEAR_CURSOR                                      INKUT015
00652          INTO                                                     INKUT015
W30272               :MDSEAR-DEPT-NBR                                   INKUT015
W30272              ,:MDSEAR-MAJ-CL-NBR                                 INKUT015
W30272              ,:MDSEAR-SUB-CL-NBR                                 INKUT015
W30272              ,:MDSEAR-DESC                                       INKUT015
00655      END-EXEC.                                                    INKUT015
00656                                                                   INKUT015
00657      IF SQLCODE NOT = 0                                           INKUT015
00658          IF SQLCODE = +100                                        INKUT015
00659              SET PS-NO-MORE-ROWS TO TRUE                          INKUT015
00660          ELSE                                                     INKUT015
00661              MOVE 'Z650-FETCH-MDSEAR-ROW'                         INKUT015
00662                                    TO PV-PARAGRAPH-NAME           INKUT015
00663              MOVE 'FETCHING ROW FROM MDSEAR TABLE'                INKUT015
00664                                    TO PV-DB2-OPER-ATTEMPTED       INKUT015
00665              PERFORM Z900-SQL-ERROR                               INKUT015
00666      END-IF.                                                      INKUT015
00667                                                                   INKUT015
00668 *Z650-EXIT.                                                       INKUT015
00669                                                                   INKUT015
00670 ******************************************************************INKUT015
00671 *  Z675-CLOSE-CURSOR - CLOSES THE CURSOR FOR THE MDSEAR TABLE.    INKUT015
00672 *  ADDED FOR WR# 2042                                             INKUT015
00673 ******************************************************************INKUT015
00674  Z675-CLOSE-MDSEAR-CURSOR.                                        INKUT015
00675                                                                   INKUT015
00676      PERFORM                                                      INKUT015
00677          WITH TEST AFTER                                          INKUT015
00678          VARYING PV-SQL-SUB                                       INKUT015
00679          FROM 1 BY 1                                              INKUT015
00680          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       INKUT015
00681                    OR SQLCODE = 0                                 INKUT015
00682                    OR SQLCODE = +100)                             INKUT015
00683                                                                   INKUT015
00684      EXEC SQL                                                     INKUT015
00685          CLOSE MDSEAR_CURSOR                                      INKUT015
00686      END-EXEC                                                     INKUT015
00687                                                                   INKUT015
00688          EVALUATE TRUE                                            INKUT015
00689              WHEN SQLCODE = -904                                  INKUT015
00690              WHEN SQLCODE = -911                                  INKUT015
00691              WHEN SQLCODE = +100                                  INKUT015
00692              WHEN SQLCODE = 0                                     INKUT015
00693                  CONTINUE                                         INKUT015
00694              WHEN SQLWARN NOT = SPACES                            INKUT015
00695              WHEN SQLCODE NOT = ZERO                              INKUT015
00696                  MOVE 'Z675-CLOSE-MDSEAR-CURSOR'                  INKUT015
00697                                TO  PV-PARAGRAPH-NAME              INKUT015
00698                  MOVE 'CLOSE ON MDSEAR CURSOR'                    INKUT015
00699                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00700                  PERFORM Z900-SQL-ERROR                           INKUT015
00701          END-EVALUATE                                             INKUT015
00702      END-PERFORM.                                                 INKUT015
                                                                        INKUT015
00704      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        INKUT015
00705          MOVE 'Z675-CLOSE-MDSEAR-CURSOR'                          INKUT015
00706                                TO  PV-PARAGRAPH-NAME              INKUT015
00707          MOVE 'CLOSE RETRIES EXCEEDED'                            INKUT015
00708                                TO  PV-DB2-OPER-ATTEMPTED          INKUT015
00709          PERFORM Z900-SQL-ERROR                                   INKUT015
00710      END-IF.                                                      INKUT015
00711                                                                   INKUT015
00712 *Z675-EXIT.                                                       INKUT015
00713                                                                   INKUT015
W27710                                                                          
00714 ******************************************************************INKUT015
00715 * Z800-CLOSE-FILES  -  CLOSES ALL FILES AND DB2 CURSORS           INKUT015
00716 ******************************************************************INKUT015
00717  Z800-CLOSE-FILES.                                                INKUT015
W30272     CLOSE REQUEST-CONTROL-FILE                                   INKUT015
W30272           NEWER-UPC-FILE                                         INKUT015
W30272           OLDER-UPC-FILE                                         INKUT015
W30272           POS-RULE-REJECTED-FILE.                                INKUT015
00719 *Z800-EXIT.                                                       INKUT015
00720                                                                   INKUT015
00570 ******************************************************************INKUT015
00571 * Z900-SQL-ERROR  -  PROCESSES AN SQL ERROR                       INKUT015
00572 ******************************************************************INKUT015
00573  Z900-SQL-ERROR.                                                  INKUT015
00574 *                                                                 INKUT015
00575      SET ABEND-4013             TO TRUE.                          INKUT015
00576      DISPLAY '**  ABEND     **'.                                  INKUT015
00577      DISPLAY '**  PROGRAM   **  =  INKUT015'.                     INKUT015
00578      DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            INKUT015
00579      DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        INKUT015
00580 *                                                                 INKUT015
00581 *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         INKUT015
00582 *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        INKUT015
00583 *                                                                 INKUT015
00584      COPY DPPD004.                                                INKUT015
                                                                        INKUT015
00586      CALL 'ILBOABN0'  USING ABEND-CODE.                           INKUT015
00587 *                                                                 INKUT015
00588 *Z900-EXIT.                                                       INKUT015
00589                                                                   INKUT015
