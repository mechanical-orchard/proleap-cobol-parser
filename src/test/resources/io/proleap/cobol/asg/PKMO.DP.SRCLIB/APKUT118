000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT118.                                        00020000
000300 AUTHOR.         NANCY EILBES.                                    00030000
000400 DATE-WRITTEN.   NOVEMBER 2003.                                   00040000
000500 DATE-COMPILED.                                                   00050000
000600*---------------------------------------------------------------* 00060000
000700* COBOL 2 WITH SQL                                              * 00070000
000800*                                                               * 00080000
000900* EXTRACT PURCHASE INFO FOR VENDOR ALLOWANCE AGREEMENTS REPORT  * 00090000
001000*---------------------------------------------------------------* 00100000
001100* THE PURPOSE OF THIS PROGRAM IS TO EXTRACT ALL OF THE PURCHASE * 00110000
001200* INFORMATION FOR A SPECIFIED TIME PERIOD.  PURCHASE INFO, FOR  * 00120000
001300* THE PURPOSE OF THESE REPORTS INCLUDES THE VERIFYED RECEIPTS   * 00130000
001400* FROM THE VENDOR ANALYSIS DATABASE AND RETURNS, OFF-INVOICE    * 00140000
001500* DISCOUNTS AND MARKDOWN ALLOWANCES FROM THE ADJUSTMENT JOURNAL * 00150000
001600* DATABASE. ALL OF THESE AMOUNTS WILL BE SUMMED TO THE VENDOR/  * 00160000
001700* DEPARTMENT LEVEL.                                             * 00170000
001800*                                                               * 00180000
001900* ALSO EXTRACTED WILL BE THE VENDOR ALLOWANCE AGREEMENTS THAT   * 00190000
002000* EXIST.  THE PURCHASING DATA WILL BE INCLUDED IN THE EXTRACT   * 00200000
002100* WHETHER OR NOT AN AGREEMENT IS FOUND FOR THE VENDOR/DEPT.     * 00210000
002200*                                                               * 00220000
002300* ADDITIONAL DATA NEEDED FOR PRODUCING THE REPORTS INCLUDES     * 00230000
002400* VENDOR NAME, AND DM NUMBER FOR THE DEPARTMENT.                * 00240000
002500*                                                               * 00250000
002600* A CONTROL CARD WILL INDICATE FREQUENCY OF THE RUN: WEEKLY,    * 00260000
002700* MONTHLY OR QUARTERLY, AND CALCULATE THE START AND END DATES   * 00270000
002800* TO BE USED IN THE SQL ACCORDINGLY.                            * 00280000
002900*---------------------------------------------------------------* 00290000
003000*                                                               * 00300000
003100* DB2/PS TABLES:                              DCLGENS:          * 00310000
003200*  1. VENDOR ANALYSIS DEPARTMENT TABLE        TVADPT            * 00320000
003300*  2. ADJUSTMENT JOURNAL HEADER TABLE         TADJRNL           * 00330000
003400*  3. VENDOR AGREEMENT TABLE                  TVNDAGR           * 00340000
003500*  4. VENDOR DEPARTMENT TABLE                 TVNDDPT           * 00350000
003600*  5. EXTERNAL ENTITY TABLE                   TEXTENT           * 00360000
003700*  6. ENTITY NAME TABLE                       TENTNME           * 00370000
003800*  7. MERCHANDISE AREA TABLE                  TMDSEAR           * 00380000
003900*  8. AP CONTROL TABLE                        TAPCNTL           * 00390000
004000*  9. DATE ATTRIBUTE TABLE                    TDTATTR           * 00400000
004100* 10. INVOICE HEADER TABLE                    TINVOIC           * 00410000
004200* 11. AP ALLOWANCE/CHARGE TABLE               TALCHRG           * 00420000
004300*                                                               * 00430000
004400* OUTPUT:                                                       * 00440000
004500*                                                               * 00450000
004600*  1. AGREEMENT ACTIVITY EXTRACT FILE         APRD081           * 00460000
004700*  2. DATES USED CONTROL CARD                                   * 00470000
004800*                                                               * 00480000
004900*---------------------------------------------------------------* 00490000
005000* CHANGE LOG:                                                   * 00500000
005100* DATE  11/05/2003                                              * 00510004
005200*     CHANGE MADE: INITIAL VERSION.                             * 00520004
005300*     MADE BY: NANCY EILBES            WR/IR #: WR25421         * 00530004
006500*                                                               * 00650000
006600* DATE  04/12/2004                                              * 00660004
006700*     CHANGE MADE: ADDED EFFECTIVE DATING TO PARAGRAPH          * 00670004
006800*     S500-SELECT-TMDSEAR                                       * 00680004
006900*     MADE BY: MIKE BESKE              WR/IR #: P000647746      * 00690004
006910*                                                               * 00691005
006920* DATE  04/28/2004                                              * 00692005
006930*     CHANGE MADE: BROADCAST AUTOMATION MODIFICATIONS.          * 00693005
006940*     ADDED LOGIC TO RETURN ACCRUAL ACTIVITY AND VENDOR         * 00694005
006950*     DEDUCTION ACTIVITY FOR BOTH BROADCAST AND BRIDAL, PLUS    * 00695005
006960*     BUYER CREDIT ACTIVITY FOR BROADCAST ONLY.  EXPANDED       * 00696005
006970*     AGREEMENT DATA BEING SELECTED TO PASS ALONG ON THE OUT    * 00697005
006980*     FILE TO FACILITATE PROCESSING ACCRUALS.                   * 00698005
006990*     ALSO ADDED TRANCODES 54 AND 55 TO ADJUSTMENT CURSOR AS    * 00699005
006991*     RETURNS - THESE ARE THE NEW AUTOMATED RTV TRANCODES.      * 00699105
006992*     MADE BY: NANCY EILBES            WR/IR #: WR26677         * 00699205
007000*                                                               * 00700000
007010* DATE  05/13/2004                                              * 00701004
007020*     CHANGE MADE: REMOVED ACCOUNT ENTRY CURSOR AND LOGIC TO    * 00702004
007030*     PROCESS THESE ENTRIES AS PART OF THE ACTIVITY EXTRACT -   * 00703004
007031*     THIS LOGIC WAS MOVED TO A SEPARATE PROGRAM, APKUT129,     * 00703104
007032*     SO THAT IT COULD BE CREATED FOR EVERY VENDOR/DEPT         * 00703204
007033*     AGREEMENT, INSTEAD OF JUST THOSE THAT HAD ACTIVITY        * 00703304
007034*     DURING THE TIME PERIOD.  ADD 0A TO ADJUSTMENT CURSOR.     * 00703405
007040*     MADE BY: NANCY EILBES            WR/IR #: WR26677         * 00704004
007050*                                                               * 00705004
007060* DATE  03/17/2006                                              * 00706012
007070*     CHANGE MADE: ADDED UNION TO AGREEMENT CURSOR FOR THE      * 00707007
007080*     INCLUSION OF BROADCAST OFF-INVOICE AGREEMENTS.            * 00708007
007094*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR29954         * 00709407
007095*                                                               * 00709518
007096* DATE  03/23/2006                                              * 00709621
007097*     CHANGE MADE: MODIFY ADJUSTMENT CURSOR TO INCORPORATE      * 00709713
007098*     NEW TRANCODES TO ACCUMULATE LIKE 28. THIS IS FOR VENDOR   * 00709813
007099*     ALLOWANCE NOW BEING KEPT AS SEPARATE OCCURANCES           * 00709913
007100*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR30028         * 00710020
007101*                                                               * 00710113
007102* DATE  05/26/2006                                              * 00710223
007103*     CHANGE MADE: MODIFY ADJUSTMENT CURSOR TO ADD TRANCODE 28  * 00710323
007104*     BACK INTO THE CURSOR.  ADDED BACK ORIGINAL MOS SELECT AND * 00710423
007105*     ADDED LOGIC TO COMBINE THE AMOUNT RETURNED FROM THE NEW   * 00710523
007106*     SQL AND THE OLD (PARAGRAPH S400).                         * 00710623
007107*     MADE BY: NANCY EILBES            WR/IR #: WR30028         * 00710723
007108*                                                               * 00710823
007109* DATE  02/05/2008                                              * 00710928
007110*     CHANGE MADE: MODIFY ADJUSTMENT CURSOR TO ADD TRANCODES 4A * 00711028
007111*     AND 4F FOR THE PRIVATE LABEL LOAD.  LOGIC WAS ADDED TO    * 00711128
007112*     ACCUMULATE THE LOAD SEPARATELY FROM OTHER AMOUNTS AND TO  * 00711228
007113*     SUBTRACT THE LOAD AMOUNT FROM THE GROSS AMOUNT THAT WAS   * 00711328
007114*     RETREIVED FROM THE ACTIVITY CURSOR.  THE GROSS AMOUNT ON  * 00711428
007115*     THE TVADPT TABLE INCLUDES THE LOAD AND IT NEEDS TO BE     * 00711528
007116*     BACKED OUT BEFORE CALCULATING THE EARNED BROADCAST AMOUNT.* 00711628
007117*     MADE BY: NANCY EILBES            WR/IR #: WR32664         * 00711728
007118*                                                               * 00711828
007120*---------------------------------------------------------------* 00712028
007200                                                                  00720000
007300 ENVIRONMENT DIVISION.                                            00730000
007400 CONFIGURATION SECTION.                                           00740000
007500 SOURCE-COMPUTER.    IBM-3090.                                    00750000
007600 OBJECT-COMPUTER.    IBM-3090.                                    00760000
007700                                                                  00770000
007800 INPUT-OUTPUT SECTION.                                            00780000
007900 FILE-CONTROL.                                                    00790000
008000                                                                  00800000
008100     SELECT EXTRACT-FILE           ASSIGN TO OUT01.               00810000
008200     SELECT DATES-USED-FILE        ASSIGN TO OUT02.               00820000
008300                                                                  00830000
008400 DATA DIVISION.                                                   00840000
008500 FILE SECTION.                                                    00850000
008600                                                                  00860000
008700 FD  EXTRACT-FILE                                                 00870000
008800     RECORDING MODE IS F                                          00880000
008900     LABEL RECORDS ARE STANDARD                                   00890000
009000     BLOCK CONTAINS 0 RECORDS                                     00900000
009100     DATA RECORD IS EXTRACT-RECORD.                               00910000
009200 01  EXTRACT-RECORD                PIC X(250).                    00920000
009300                                                                  00930000
009400 FD  DATES-USED-FILE                                              00940000
009500     RECORDING MODE IS F                                          00950000
009600     LABEL RECORDS ARE STANDARD                                   00960000
009700     BLOCK CONTAINS 0 RECORDS                                     00970000
009800     DATA RECORD IS EXTRACT-RECORD.                               00980000
009900 01  DATES-USED-RECORD             PIC X(80).                     00990000
010000                                                                  01000000
010100 EJECT                                                            01010000
010200                                                                  01020000
010300 WORKING-STORAGE SECTION.                                         01030000
010400                                                                  01040000
010500 01  PROGRAM-CONSTANTS.                                           01050000
010600     05  PC-PROGRAM-NAME           PIC  X(08)  VALUE 'APKUT118'.  01060000
010700     05  PC-INVALID-CC-MSG         PIC  X(29)  VALUE              01070000
010800        'INVALID CONTROL CARD SUPPLIED'.                          01080000
010900     05  PC-NO-RQST-DATES-MSG      PIC  X(42)  VALUE              01090000
011000        'NO DATES SUPPLIED FOR SPECIAL REQUEST RUN.'.             01100000
011100     05  PC-INVALID-FYR-MSG        PIC X(55)   VALUE              01110000
011200        'RQST BEGIN DATE & RQST END DATE NOT IN SAME FISCAL YEAR'.01120000
011300     05  PC-INVALID-ENDDTE-MSG     PIC X(55)   VALUE              01130000
011400        'RQST END DATE IS NOT A VALID FSCL_MN_END_DTE ON TDTATTR'.01140000
011500     05  PC-INVALID-BEGDTE-MSG     PIC X(55)   VALUE              01150000
011600        'RQST BEG DATE IS NOT A VALID FSCL_MN_BEG_DTE ON TDTATTR'.01160000
011700     05  PC-WEEKLY-RPT-MSG         PIC X(55)   VALUE              01170000
011800        'ONLY MTD AND QTR ARE VALID REPORTS FOR WEEKLY RUN'.      01180000
011810     05  PC-MOEND-RPT-MSG          PIC X(48)   VALUE              01181000
011820        'ONLY QTR, SA AND ANL ARE VALID FOR MONTH END RUN'.       01182000
011830     05  PC-CAL-RPT-MSG            PIC X(47)   VALUE              01183000
011840        'ONLY QTR, SA AND ANL ARE VALID FOR CALENDAR RUN'.        01184000
011850                                                                  01185000
011860 01  PV-PROCESS-COUNTERS.                                         01186000
011870     05  PV-ACT-CSR-COUNT          PIC  9(08)  VALUE ZEROS.       01187000
011880     05  PV-ADJ-CSR-COUNT          PIC  9(08)  VALUE ZEROS.       01188000
011890     05  PV-ACCTG-CSR-COUNT        PIC  9(08)  VALUE ZEROS.       01189000
011900     05  PV-AGR-CSR-COUNT          PIC  9(08)  VALUE ZEROS.       01190000
012000     05  PV-EXTRACT-COUNT          PIC  9(08)  VALUE ZEROS.       01200000
012100                                                                  01210000
012200 01  PROGRAM-SWITCHES.                                            01220000
012300     05  PS-END-OF-ACT-CSR-SW      PIC X   VALUE 'N'.             01230000
012400         88  NOT-END-OF-ACT-CSR            VALUE 'N'.             01240000
012500         88  END-OF-ACT-CSR                VALUE 'Y'.             01250000
012600     05  PS-END-OF-AGR-CSR-SW      PIC X   VALUE 'N'.             01260000
012700         88  NOT-END-OF-AGR-CSR            VALUE 'N'.             01270000
012800         88  END-OF-AGR-CSR                VALUE 'Y'.             01280000
012900     05  PS-END-OF-ADJ-CSR-SW      PIC X   VALUE 'N'.             01290000
013000         88  NOT-END-OF-ADJ-CSR            VALUE 'N'.             01300000
013100         88  END-OF-ADJ-CSR                VALUE 'Y'.             01310000
013200     05  PS-END-OF-ACCTG-CSR-SW    PIC X   VALUE 'N'.             01320000
013300         88  NOT-END-OF-ACCTG-CSR          VALUE 'N'.             01330000
013400         88  END-OF-ACCTG-CSR              VALUE 'Y'.             01340000
013500     05  PS-ADJ-FOUND-SW           PIC X   VALUE 'N'.             01350000
013600         88  NO-ADJUSTMENT-FOUND           VALUE 'N'.             01360000
013700         88  ADJUSTMENT-FOUND              VALUE 'Y'.             01370000
013800     05  PS-ACCTG-FOUND-SW         PIC X   VALUE 'N'.             01380000
013810         88  NO-ACCTG-ENTRY-FOUND          VALUE 'N'.             01381000
013820         88  ACCTG-ENTRY-FOUND             VALUE 'Y'.             01382000
013830     05  PS-AGR-FOUND-SW           PIC X   VALUE 'N'.             01383000
013840         88  NO-AGREEMENTS-FOUND           VALUE 'N'.             01384000
013850         88  AGREEMENTS-FOUND              VALUE 'Y'.             01385000
013860                                                                  01386000
013870 01  PROGRAM-VARIABLES.                                           01387000
013880     05  HOLD-ENT-ID               PIC S9(9) COMP VALUE ZEROES.   01388000
013890     05  DISPLAY-ENT-ID            PIC 9(9).                      01389000
013900     05  HOLD-DEPT-NBR             PIC X(3)       VALUE SPACES.   01390000
014000     05  HOLD-VND-NBR              PIC X(9)       VALUE SPACES.   01400000
014100     05  PV-MIN-MOEND-DTE          PIC X(10).                     01410000
014200     05  PV-MAX-MOEND-DTE          PIC X(10).                     01420000
014300     05  PV-MIN-PSTG-FMN-NBR       PIC XX.                        01430000
014400     05  PV-MAX-PSTG-FMN-NBR       PIC XX.                        01440000
014500     05  PV-MIN-CAL-MN-NBR         PIC XX.                        01450000
014600     05  PV-MAX-CAL-MN-NBR         PIC XX.                        01460000
014610     05  PV-PREVYR-FMN-NBR         PIC XX.                        01461000
014620     05  PV-MIN-FSCL-QTR-NBR       PIC X.                         01462000
014630     05  PV-MAX-FSCL-QTR-NBR       PIC X.                         01463000
014640     05  PV-MIN-CAL-QTR-NBR        PIC X.                         01464000
014650     05  PV-MAX-CAL-QTR-NBR        PIC X.                         01465000
014660     05  PV-CURR-PSTG-FYR-NBR      PIC X(4).                      01466000
014670     05  PV-PREV-PSTG-FYR-NBR      PIC X(4).                      01467000
014680     05  PV-CAL-QTR-NBR            PIC X.                         01468000
014690     05  PV-CAL-YR-NBR             PIC X(4).                      01469000
014691     05  PV-PSTG-FYR-NBR           PIC X(4).                      01469100
014692     05  PV-FYR-NBR-NUM            PIC 9(4).                      01469200
014693     05  PV-END-FSCL-YR-NBR        PIC X(4).                      01469300
014694     05  PV-FSCL-MN-NBR            PIC X(2).                      01469400
014695     05  PV-FSCL-YR-NBR            PIC X(4).                      01469500
014696     05  PV-FSCL-QTR-NBR           PIC X(1).                      01469600
014697     05  PV-CAL-MN-NBR             PIC X(2).                      01469700
014698     05  PV-FSCL-MN-BEG-DTE        PIC X(10).                     01469800
014699     05  PV-FSCL-MN-END-DTE        PIC X(10).                     01469900
014700     05  PV-ACTIVITY-TYP-CDE       PIC X.                         01470000
014800     05  PV-ADJUSTMENT-CDE         PIC XX.                        01480000
014900     05  PV-ADJUSTMENT-AMT         PIC S9(11)V99   COMP-3.        01490000
015000     05  PV-ACTIVITY-AMT           PIC S9(11)V99   COMP-3.        01500000
015100     05  PV-MOS-ACTVTY-AMT         PIC S9(11)V99   COMP-3.        01510000
015200     05  PV-MOS-ACTVTY-AMT-2       PIC S9(11)V99   COMP-3.        01520022
015300     05  PV-LOAD-ACTVTY-AMT        PIC S9(11)V99   COMP-3.        01530024
016400                                                                  01640000
016500 EJECT                                                            01650000
016600                                                                  01660000
016700 01  CONTROL-CARD.                                                01670000
016800     05  CC-RUN-FRQ-CDE            PIC XX.                        01680000
016900         88  CC-WEEKLY-RUN             VALUE 'WK'.                01690000
017000         88  CC-MOEND-RUN              VALUE 'ME'.                01700000
017100         88  CC-CALENDAR-RUN           VALUE 'CA'.                01710000
017200         88  CC-SPECIAL-REQUEST        VALUE 'SP'.                01720000
017300         88  CC-RUN-FRQ-VALID          VALUE 'SP', 'WK',          01730000
017400                                             'ME', 'CA'.          01740000
017500     05  FILLER                    PIC X.                         01750000
017600     05  CC-REPORT-TYP-CDE         PIC X(3).                      01760000
017700         88  CC-MONTH-TO-DATE          VALUE 'MTD'.               01770000
017800         88  CC-QUARTERLY              VALUE 'QTR'.               01780000
017900         88  CC-SEMI-ANNUAL            VALUE 'SA '.               01790000
018000         88  CC-YEAR-TO-DATE           VALUE 'YTD'.               01800000
018100         88  CC-REQUESTED-DATES        VALUE 'REQ'.               01810000
018200         88  CC-RPT-TYP-VALID          VALUE 'REQ', 'MTD', 'QTR', 01820000
018300                                             'SA ', 'YTD'.        01830000
018400         88  CC-VALID-MOEND-RPT        VALUE 'MTD', 'QTR', 'SA ', 01840000
018500                                             'YTD'.               01850000
018600         88  CC-VALID-CAL-RPT          VALUE 'QTR', 'SA ', 'YTD'. 01860000
018700         88  CC-VALID-WKLY-RPT         VALUE 'MTD', 'QTR'.        01870000
018800                                                                  01880000
018900     05  FILLER                    PIC X.                         01890000
019000     05  CC-RQST-BEGIN-DTE         PIC X(10).                     01900000
019100     05  FILLER                    PIC X.                         01910000
019200     05  CC-RQST-END-DTE           PIC X(10).                     01920000
019300     05  FILLER                    PIC X(52).                     01930000
019400                                                                  01940000
019500 01  EXTRACT-DATES-RECORD.                                        01950000
019600     05  EXTRACT-BEGIN-DTE         PIC X(10).                     01960000
019700     05  FILLER                    PIC X.                         01970000
019800     05  EXTRACT-END-DTE           PIC X(10).                     01980000
019900     05  FILLER                    PIC X(79).                     01990000
020000                                                                  02000000
020100 EJECT                                                            02010000
020200                                                                  02020000
020300                                                                  02030000
020400*----------------------------------------------------------------*02040000
020500*  OUTPUT RECORD AREA                                             02050000
020600*----------------------------------------------------------------*02060000
020700                                                                  02070000
020800     COPY APRD081.                                                02080000
020900                                                                  02090000
021000*----------------------------------------------------------------*02100000
021100*    SQL COMMUNICATIONS AREA DCLGEN                               02110000
021200*----------------------------------------------------------------*02120000
021300     EXEC SQL                                                     02130000
021400         INCLUDE SQLCA                                            02140000
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700*----------------------------------------------------------------*02170000
021800* VENDOR ANALYSIS TABLE                                           02180000
021900*----------------------------------------------------------------*02190000
022000     EXEC SQL                                                     02200000
022100         INCLUDE TVADPT                                           02210000
022200     END-EXEC.                                                    02220000
022300                                                                  02230000
022400*----------------------------------------------------------------*02240000
022500* ADJUSTMENT JOURNAL HEADER TABLE                                 02250000
022600*----------------------------------------------------------------*02260000
022700     EXEC SQL                                                     02270000
022800         INCLUDE TADJRNL                                          02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100*----------------------------------------------------------------*02310000
023200* VENDOR AGREEMENT TABLE                                          02320000
023300*----------------------------------------------------------------*02330000
023400     EXEC SQL                                                     02340000
023500         INCLUDE TVNDAGR                                          02350000
023600     END-EXEC.                                                    02360000
023700                                                                  02370000
023800*----------------------------------------------------------------*02380000
023900* VENDOR DEPARTMENT TABLE                                         02390000
024000*----------------------------------------------------------------*02400000
024100     EXEC SQL                                                     02410000
024200         INCLUDE TVNDDPT                                          02420000
024300     END-EXEC.                                                    02430000
024400                                                                  02440000
024500*----------------------------------------------------------------*02450000
024600* EXTERNAL ENTITY TABLE                                           02460000
024700*----------------------------------------------------------------*02470000
024800     EXEC SQL                                                     02480000
024900         INCLUDE TEXTENT                                          02490000
025000     END-EXEC.                                                    02500000
025100                                                                  02510000
025200*----------------------------------------------------------------*02520000
025300* ENTITY NAME TABLE                                               02530000
025400*----------------------------------------------------------------*02540000
025500     EXEC SQL                                                     02550000
025600         INCLUDE TENTNME                                          02560000
025700     END-EXEC.                                                    02570000
025800                                                                  02580000
025900*----------------------------------------------------------------*02590000
026000* MERCHANDISE AREA TABLE                                          02600000
026100*----------------------------------------------------------------*02610000
026200     EXEC SQL                                                     02620000
026300         INCLUDE TMDSEAR                                          02630000
026400     END-EXEC.                                                    02640000
026500                                                                  02650000
026600*----------------------------------------------------------------*02660000
026700* AP CONTROL TABLE                                                02670000
026800*----------------------------------------------------------------*02680000
026900     EXEC SQL                                                     02690000
027000         INCLUDE TAPCNTL                                          02700000
027100     END-EXEC.                                                    02710000
027200                                                                  02720000
027300*----------------------------------------------------------------*02730000
027400* DATE ATTRIBUTE TABLE                                            02740000
027500*----------------------------------------------------------------*02750000
027600     EXEC SQL                                                     02760000
027700         INCLUDE TDTATTR                                          02770000
027800     END-EXEC.                                                    02780000
027900                                                                  02790000
028000*----------------------------------------------------------------*02800000
028100* AP INVOICE HEADER TABLE                                         02810000
028200*----------------------------------------------------------------*02820000
028300     EXEC SQL                                                     02830000
028400         INCLUDE TINVOIC                                          02840000
028500     END-EXEC.                                                    02850000
028600                                                                  02860000
028700*----------------------------------------------------------------*02870000
028800* AP ALLOWNACE/CHARGE TABLE                                       02880000
028900*----------------------------------------------------------------*02890000
029000     EXEC SQL                                                     02900000
029100         INCLUDE TALCHRG                                          02910000
029200     END-EXEC.                                                    02920000
029300                                                                  02930000
029400*----------------------------------------------------------------*02940000
029500*  ACTIVITY CURSOR RETRIEVES THE VERIFIED RECEIPT TOTAL COST      02950000
029600*  BY VENDOR/DEPT FROM THE VENDOR ANALYSIS TABLE AND THE TOTAL    02960000
029700*  MARKDOWN ALLOWANCES TAKEN/REPAID BY VENDOR/DEPT FROM THE       02970000
029800*  ADJUSTMENT JOURNAL TABLE.  ALSO RETRIEVES THE VENDOR NAME      02980000
029900*  AND VENDOR NUMBER.                                             02990000
030000*----------------------------------------------------------------*03000000
030100     EXEC SQL                                                     03010000
030200        DECLARE ACTIVITY_CSR CURSOR FOR                           03020000
030300          SELECT VA.ENT_ID                                        03030000
030400               , VA.DEPT_NBR                                      03040000
030500               , EX.DUN_NBR                                       03050000
030600               , EN.ENT_NAME_DESC                                 03060000
030700               , SUM(VA.RCPT_GRO_COST_AMT)                        03070000
030800               , 'P'                                              03080000
030900            FROM TVADPT VA                                        03090000
031000               , TEXTENT EX                                       03100000
031100               , TENTNME EN                                       03110000
031200           WHERE VA.ENT_ID = EX.ENT_ID                            03120000
031300             AND EN.ENT_ID = EX.ENT_ID                            03130000
031400             AND VA.ENT_ID ^= 10593                               03140000
031500             AND EN.TYPE_CDE = '01'                               03150000
031600*****        AND VA.FSCL_MN_NBR     BETWEEN :PV-MIN-PSTG-FMN-NBR  03160000
031700*****                                   AND :PV-MAX-PSTG-FMN-NBR  03170000
031800             AND VA.FSCL_MN_END_DTE BETWEEN :PV-MIN-MOEND-DTE     03180000
031900                                        AND :PV-MAX-MOEND-DTE     03190000
032000        GROUP BY VA.ENT_ID                                        03200000
032100               , VA.DEPT_NBR                                      03210000
032200               , EX.DUN_NBR                                       03220000
032300               , EN.ENT_NAME_DESC                                 03230000
032400          HAVING SUM(VA.RCPT_GRO_COST_AMT) > 0                    03240000
032500      UNION ALL                                                   03250010
032600          SELECT AJ.ENT_ID                                        03260000
032700               , AJ.DEPT_NBR                                      03270000
032800               , EX.DUN_NBR                                       03280000
032900               , EN.ENT_NAME_DESC                                 03290000
033000               , SUM(AJ.NET_COST_AMT)                             03300000
033100               , 'A'                                              03310000
033200            FROM TADJRNL AJ                                       03320000
033300               , TEXTENT EX                                       03330000
033400               , TENTNME EN                                       03340000
033500           WHERE AJ.AP_TRN_CDE     IN ('07','24')                 03350000
033600             AND ((AJ.PSTG_FMN_NBR   BETWEEN :PV-MIN-PSTG-FMN-NBR 03360000
033700                                         AND :PV-MAX-PSTG-FMN-NBR 03370000
033800                   AND AJ.PSTG_FYR_NBR   = :PV-CURR-PSTG-FYR-NBR) 03380000
033810               OR (AJ.PSTG_FMN_NBR       = :PV-PREVYR-FMN-NBR     03381000
033820                   AND AJ.PSTG_FYR_NBR   = :PV-PREV-PSTG-FYR-NBR))03382000
033830             AND AJ.ENT_ID = EX.ENT_ID                            03383000
033840             AND EN.ENT_ID = EX.ENT_ID                            03384000
033850             AND AJ.ENT_ID ^= 10593                               03385000
033860             AND EN.TYPE_CDE = '01'                               03386000
033870        GROUP BY AJ.ENT_ID                                        03387000
033880               , AJ.DEPT_NBR                                      03388000
033890               , EX.DUN_NBR                                       03389000
033900               , EN.ENT_NAME_DESC                                 03390000
034000          HAVING SUM(AJ.NET_COST_AMT) ^= 0                        03400000
034100      ORDER BY 1,2 ASC, 5 DESC                                    03410000
034200      WITH UR                                                     03420000
034300     END-EXEC.                                                    03430000
034400                                                                  03440000
034500*----------------------------------------------------------------*03450000
034600*  ADJUSTMENT CURSOR RETRIEVES THE RETURNS AND INVOICE DISCOUNTS  03460000
034700*  FROM THE ADJUSTMENT JOURNAL DATABASE FOR THE VENDOR/DEPT       03470000
034800*  BEING PROCESSED.  IT WILL BE OPENED AND CLOSED BASED ON THE    03480000
034900*  ROWS FETCHED FROM THE ACTIVITY CURSOR.                         03490000
035000*----------------------------------------------------------------*03500000
035100     EXEC SQL                                                     03510000
035200        DECLARE ADJUSTMENT_CSR CURSOR FOR                         03520000
035300         SELECT VT.AP_TRN_CDE                                     03530000
035400              , SUM(VT.NET_COST_AMT)                              03540000
035500           FROM                                                   03550000
035600        (SELECT AJ.NET_COST_AMT AS NET_COST_AMT                   03560000
035700              , (CASE AJ.AP_TRN_CDE                               03570000
035810                 WHEN '2A' THEN 'DS'                              03581013
035820                 WHEN '2B' THEN 'DS'                              03582013
035830                 WHEN '2C' THEN 'DS'                              03583013
035840                 WHEN '2D' THEN 'DS'                              03584013
035850                 WHEN '2E' THEN 'DS'                              03585013
035860                 WHEN '28' THEN 'DS'                              03586022
035900                 WHEN '20' THEN 'RV'                              03590000
036000                 WHEN '21' THEN 'RV'                              03600000
036100                 WHEN '22' THEN 'RV'                              03610000
036200                 WHEN '23' THEN 'RV'                              03620000
036300                 WHEN '54' THEN 'RV'                              03630000
036400                 WHEN '55' THEN 'RV'                              03640000
036410                 WHEN '0A' THEN 'RV'                              03641005
036420                 WHEN '4A' THEN 'LD'                              03642024
036430                 WHEN '4F' THEN 'LD'                              03643024
036500                 ELSE AJ.AP_TRN_CDE                               03650000
036600                 END) AS AP_TRN_CDE                               03660000
036700            FROM TADJRNL AJ                                       03670000
036800           WHERE AJ.AP_TRN_CDE   IN                               03680000
036900                         ('20','21','22','23','54','55','0A',     03690014
036910                          '2A','2B','2C','2D','2E','28','4A','4F')03691026
037000             AND ((AJ.PSTG_FMN_NBR   BETWEEN :PV-MIN-PSTG-FMN-NBR 03700000
037100                                         AND :PV-MAX-PSTG-FMN-NBR 03710000
037200                   AND AJ.PSTG_FYR_NBR   = :PV-CURR-PSTG-FYR-NBR) 03720000
037300               OR (AJ.PSTG_FMN_NBR       = :PV-PREVYR-FMN-NBR     03730000
037400                   AND AJ.PSTG_FYR_NBR   = :PV-PREV-PSTG-FYR-NBR))03740000
037500             AND AJ.VND_NBR      = :HOLD-VND-NBR                  03750000
037600             AND AJ.DEPT_NBR     = :HOLD-DEPT-NBR                 03760000
037700            ) AS VT                                               03770000
037800          GROUP BY VT.AP_TRN_CDE                                  03780000
037900          WITH UR                                                 03790000
038000     END-EXEC.                                                    03800000
038100                                                                  03810000
038817*----------------------------------------------------------------*03881700
038818*  AGREEMENT CURSOR RETRIEVES THE VENDOR ALLOWANCE AGREEMENTS     03881800
038819*  FROM THE VENDOR AGREEMENT DATABASE FOR THE VENDOR/DEPT         03881900
038820*  BEING PROCESSED.  IT WILL BE OPENED AND CLOSED BASED ON THE    03882000
038830*  ROWS FETCHED FROM THE ACTIVITY CURSOR.                         03883000
038840*----------------------------------------------------------------*03884000
038850     EXEC SQL                                                     03885000
038860        DECLARE AGREEMENT_CSR CURSOR FOR                          03886000
038870         SELECT AG.AP_TRN_CDE                                     03887000
038880              , COALESCE(AG.DISCOUNT_PCT,0)                       03888000
038890              , AG.PSTG_FRQ_CDE                                   03889000
038900              , AG.DED_DISC_IND                                   03890000
039000              , AG.DED_RTV_IND                                    03900000
039100           FROM TVNDAGR AG                                        03910000
039200              , TVNDDPT VD                                        03920000
039300          WHERE AG.AGRMT_TYP_ID      = '6'                        03930000
039400            AND AG.TYP_CDE           = 6                          03940000
039500            AND AG.ENT_ID            = :HOLD-ENT-ID               03950000
039600            AND AG.DEPT_NBR          = :HOLD-DEPT-NBR             03960000
039700            AND AG.ENT_ID            = VD.ENT_ID                  03970000
039800            AND AG.DEPT_NBR          = VD.DEPT_NBR                03980000
039900            AND VD.VND_DEPT_STAT_CD  = 'A'                        03990000
040000            AND :EXTRACT-BEGIN-DTE   BETWEEN AG.EFFECTIVE_DATE    04000001
040100                                         AND AG.EXPIRATION_DATE   04010000
040101            AND :EXTRACT-END-DTE     BETWEEN AG.EFFECTIVE_DATE    04010101
040102                                         AND AG.EXPIRATION_DATE   04010201
040110****        AND :APCNTL-BTCH-PRC-DTE BETWEEN AG.EFFECTIVE_DATE    04011001
040120****                                     AND AG.EXPIRATION_DATE   04012001
040200      UNION ALL                                                   04020010
040300         SELECT 'MO'                                              04030000
040400              , COALESCE(AG.DISCOUNT_PCT,0)                       04040000
040500              , 'IV'                                              04050000
040600              , 'N'                                               04060000
040700              , 'N'                                               04070000
040800           FROM TVNDAGR AG                                        04080000
040900              , TVNDDPT VD                                        04090000
041000          WHERE AG.AGRMT_TYP_ID      = '5'                        04100000
041100            AND AG.TYP_CDE           = 7                          04110000
041200            AND AG.ENT_ID            = :HOLD-ENT-ID               04120000
041300            AND AG.DEPT_NBR          = :HOLD-DEPT-NBR             04130000
041400            AND AG.ENT_ID            = VD.ENT_ID                  04140000
041500            AND AG.DEPT_NBR          = VD.DEPT_NBR                04150000
041600            AND VD.VND_DEPT_STAT_CD  = 'A'                        04160000
041700            AND :APCNTL-BTCH-PRC-DTE BETWEEN AG.EFFECTIVE_DATE    04170000
041800                                         AND AG.EXPIRATION_DATE   04180000
041810      UNION ALL                                                   04181010
041820         SELECT '5A'                                              04182008
041830              , COALESCE(AG.DISCOUNT_PCT,0)                       04183008
041840              , 'IV'                                              04184008
041850              , 'N'                                               04185008
041860              , 'N'                                               04186008
041870           FROM TVNDAGR AG                                        04187008
041880              , TVNDDPT VD                                        04188008
041890          WHERE AG.AGRMT_TYP_ID      = '5'                        04189008
041891            AND AG.TYP_CDE           = 9                          04189108
041892            AND AG.ENT_ID            = :HOLD-ENT-ID               04189209
041893            AND AG.DEPT_NBR          = :HOLD-DEPT-NBR             04189309
041894            AND AG.ENT_ID            = VD.ENT_ID                  04189409
041895            AND AG.DEPT_NBR          = VD.DEPT_NBR                04189509
041896            AND VD.VND_DEPT_STAT_CD  = 'A'                        04189608
041897            AND :APCNTL-BTCH-PRC-DTE BETWEEN AG.EFFECTIVE_DATE    04189708
041898                                         AND AG.EXPIRATION_DATE   04189808
041900          WITH UR                                                 04190000
042000     END-EXEC.                                                    04200000
042100                                                                  04210000
042200*----------------------------------------------------------------*04220000
042300*    ABEND DATA AREAS                                             04230000
042400*----------------------------------------------------------------*04240000
042500 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      04250000
042600                                   COMP         SYNC.             04260000
042700                                                                  04270000
042800     88  AC-ANY-ERROR                           VALUE  +4001      04280000
042900                                                THRU   +4019.     04290000
043000     88  AC-OPEN-ERROR                          VALUE  +4005.     04300000
043100     88  AC-CLOSE-ERROR                         VALUE  +4006.     04310000
043200     88  AC-INVALID-CONTROL-CARD                VALUE  +4007.     04320000
043300     88  AC-INVALID-DATA                        VALUE  +4008.     04330000
043400     88  AC-DB2-ERROR                           VALUE  +4013.     04340000
043500                                                                  04350000
043600 01  ABEND-AREAS.                                                 04360000
043700     05  AA-ABEND-LIT              PIC  X(40)   VALUE             04370000
043800             '*****       ABEND'.                                 04380000
043900     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             04390000
044000             '*****   PROGRAM: APKUT118'.                         04400000
044100     05  AA-PARAGRAPH-LIT.                                        04410000
044200         10  FILLER                PIC  X(17)   VALUE             04420000
044300             '***** PARAGRAPH: '.                                 04430000
044400         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     04440000
044500     05  AA-MESSAGE-LINE-1.                                       04450000
044600         10  FILLER                PIC  X(06)   VALUE '*****'.    04460000
044700         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     04470000
044800     05  AA-MESSAGE-LINE-2.                                       04480000
044900         10  FILLER                PIC  X(06)   VALUE '*****'.    04490000
045000         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     04500000
045100     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             04510000
045200             '*****    DB2 ERROR'.                                04520000
045300     05  AA-DB2-OPERATION-LIT.                                    04530000
045400         10  FILLER                PIC  X(17)   VALUE             04540000
045500             '***** OPERATION: '.                                 04550000
045600         10  AA-DB2-OPERATION.                                    04560000
045700             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     04570000
045800             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     04580000
045900     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     04590000
046000     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     04600000
046100     05  AA-DB2-TABLE-3            PIC  X(08)   VALUE SPACES.     04610000
046200     05  AA-DB2-TABLE-4            PIC  X(08)   VALUE SPACES.     04620000
046300     05  AA-DB2-TABLE-5            PIC  X(08)   VALUE SPACES.     04630000
046400     05  AA-DB2-TABLE-6            PIC  X(08)   VALUE SPACES.     04640000
046500                                                                  04650000
046600*----------------------------------------------------------------*04660000
046700*    SQLCA FORMATTED MESSAGE AREA                                 04670000
046800*----------------------------------------------------------------*04680000
046900     COPY DPWS004.                                                04690000
047000                                                                  04700000
047100 01  FILLER                        PIC  X(25)   VALUE             04710000
047200     '** END OF APKUT118 W/S **'.                                 04720000
047300                                                                  04730000
047400*-------------------*                                             04740000
047500 PROCEDURE DIVISION.                                              04750000
047600*-------------------*                                             04760000
047700 A100-MAINLINE.                                                   04770000
047800                                                                  04780000
047900     PERFORM B100-INITIALIZE.                                     04790000
048000                                                                  04800000
048100     PERFORM B200-CREATE-EXTRACT                                  04810000
048200         UNTIL END-OF-ACT-CSR.                                    04820000
048300                                                                  04830000
048400     PERFORM B300-END-OF-PROGRAM.                                 04840000
048500                                                                  04850000
048600     GOBACK.                                                      04860000
048700                                                                  04870000
048800                                                                  04880000
048900*----------------------------------------------------------------*04890000
049000*    INITIALIZATION PROCESSING                                   *04900000
049100*                                                                *04910000
049200*    - OPEN FILE.                                                *04920000
049300*    - INTIALIZE LAYOUTS.                                        *04930000
049400*    - FORMAT PAGE HEADINGS.                                     *04940000
049500*    - OPEN THE ACTIVITY CURSOR AND FETCH FIRST ROW.             *04950000
049600*----------------------------------------------------------------*04960000
049700 B100-INITIALIZE.                                                 04970000
049800                                                                  04980000
049900     DISPLAY '**------ BEGINNING PROGRAM APKUT118 ------**'.      04990000
050000                                                                  05000000
050100     OPEN OUTPUT EXTRACT-FILE                                     05010000
050200                 DATES-USED-FILE.                                 05020000
050300                                                                  05030000
050400     INITIALIZE  DCLTVADPT                                        05040000
050500                 DCLTEXTENT                                       05050000
050600                 DCLTENTNME                                       05060000
050700                 DCLTVNDAGR                                       05070000
050800                 DCLTAPCNTL                                       05080000
050900                 DCLTDTATTR                                       05090000
051000                 DCLTADJRNL                                       05100000
051100                 DCLTMDSEAR                                       05110000
051200                 AP081-VNDAGR-EXTRACT.                            05120000
051300                                                                  05130000
051400     ACCEPT CONTROL-CARD.                                         05140000
051500     DISPLAY '*** CONTROL CARD FOR THIS RUN ***'                  05150000
051600     DISPLAY CONTROL-CARD.                                        05160000
051700     DISPLAY '*** END OF CONTROL CARD ***'                        05170000
051800                                                                  05180000
051900     PERFORM D100-VALIDATE-CONTROL-CARD.                          05190000
052000     DISPLAY '*** DATE CONTROLS SELECTED FOR THIS RUN ***'        05200000
052100     DISPLAY 'BATCH PROCESS DATE  = ' APCNTL-BTCH-PRC-DTE.        05210000
052200     DISPLAY 'PV-MIN-MOEND-DTE    = ' PV-MIN-MOEND-DTE.           05220000
052300     DISPLAY 'PV-MAX-MOEND-DTE    = ' PV-MAX-MOEND-DTE.           05230000
052400     DISPLAY 'PV-MIN-PSTG-FMN-NBR = ' PV-MIN-PSTG-FMN-NBR.        05240000
052500     DISPLAY 'PV-MAX-PSTG-FMN-NBR = ' PV-MAX-PSTG-FMN-NBR.        05250000
052600     DISPLAY 'PV-MIN-CAL-MN-NBR   = ' PV-MIN-CAL-MN-NBR.          05260000
052700     DISPLAY 'PV-MAX-CAL-MN-NBR   = ' PV-MAX-CAL-MN-NBR.          05270000
052800     DISPLAY 'PV-CAL-QTR-NBR      = ' PV-CAL-QTR-NBR.             05280000
052900     DISPLAY 'PV-MIN-FSCL-QTR-NBR = ' PV-MIN-FSCL-QTR-NBR.        05290000
053000     DISPLAY 'PV-MAX-FSCL-QTR-NBR = ' PV-MAX-FSCL-QTR-NBR.        05300000
053100     DISPLAY 'PV-CURR-PSTG-FYR-NBR = ' PV-CURR-PSTG-FYR-NBR.      05310000
053200     DISPLAY 'PV-PREV-PSTG-FYR-NBR = ' PV-PREV-PSTG-FYR-NBR.      05320000
053300     DISPLAY 'PV-PREVYR-FMN-NBR   = ' PV-PREVYR-FMN-NBR.          05330000
053400     DISPLAY '****** END OF DATE CONTROLS DISPLAY *******'.       05340000
053500                                                                  05350000
053600     MOVE PV-MAX-MOEND-DTE TO EXTRACT-END-DTE.                    05360000
053700     PERFORM W200-WRITE-DATES-RECORD.                             05370000
053800                                                                  05380000
053900     PERFORM X100-OPEN-ACTIVITY-CSR.                              05390000
054000                                                                  05400000
054100     PERFORM S100-FETCH-ACTIVITY-CSR.                             05410000
054200                                                                  05420000
054300     IF  END-OF-ACT-CSR                                           05430000
054400         DISPLAY 'NO ROWS RETURNED FOR ACTIVITY CURSOR!!!'        05440000
054500     ELSE                                                         05450000
054600         PERFORM S500-SELECT-TMDSEAR                              05460000
054700         MOVE VADPT-ENT-ID   TO HOLD-ENT-ID                       05470000
054800                                DISPLAY-ENT-ID                    05480000
054900         MOVE VADPT-DEPT-NBR TO HOLD-DEPT-NBR                     05490000
055000         MOVE EXTENT-DUN-NBR TO HOLD-VND-NBR                      05500000
055100     END-IF.                                                      05510000
055200                                                                  05520000
055300                                                                  05530000
055400*----------------------------------------------------------------*05540000
055500*    PROCESS ACTIVITY CURSOR                                     *05550000
055600*                                                                *05560000
055700* 1. DETERMINE IF ROW FETCHED IS PURCHASE OR ADJUSTMENT ACTIVITY *05570000
055800*    AND MOVE FIELDS ACCORDINGLY.                                *05580000
055900* 2. WHEN NEW VENDOR/DEPT FETCHED, OPEN AND PROCESS ADJUSTMENT   *05590000
056000*    ACCOUNTING ENTRY AND AGREEMENT CURSORS.                     *05600000
056100* 3. NOTE THAT THE STATEMENTS COMPUTING NET AMOUNTS ARE ADDING   *05610000
056200*    NOT SUBTRACTING TO ARRIVE AT A NET COST BECAUSE THE RETURN  *05620000
056210*    AND DISCOUNT ADJUSTMENTS HAVE NEGATIVE AMOUNTS (CREDITS).   *05621000
056220* 4. NOTE THAT ONE RECORD IS WRITTEN WITH NO AGREEMENT INFO.     *05622000
056230*    THIS IS TO FACILITATE REPORTING OF ACTIVITY FOR VENDOR/     *05623000
056240*    DEPTS EVEN WHEN THERE ARE NO AGREEMENTS.  IF AGREEMENTS ARE *05624000
056250*    FOUND, THE RECORD WILL BE ELIMINATED BY MEANS OF A SORT     *05625000
056260*    SUM BEFORE THE VARIOUS REPORTS ARE PRODUCED.                 05626000
056270*----------------------------------------------------------------*05627000
056280 B200-CREATE-EXTRACT.                                             05628000
056290                                                                  05629000
056300     IF  VADPT-ENT-ID = HOLD-ENT-ID                               05630000
056400     AND VADPT-DEPT-NBR = HOLD-DEPT-NBR                           05640000
056500         CONTINUE                                                 05650000
056600     ELSE                                                         05660000
056700         PERFORM C100-GET-ADJUSTMENTS                             05670000
056800                                                                  05680000
056900         COMPUTE AP081-GROSS-PURCHS-AMT =                         05690024
056910            AP081-GROSS-PURCHS-AMT - PV-LOAD-ACTVTY-AMT           05691024
056911                                                                  05691124
056912         COMPUTE AP081-PRCH-NET-RTV-AMT =                         05691224
056913            AP081-GROSS-PURCHS-AMT + AP081-RETURNS-AMT            05691324
056920                                                                  05692000
056930         COMPUTE AP081-PRCH-NET-DSC-AMT =                         05693000
056940            AP081-GROSS-PURCHS-AMT + AP081-DISCOUNT-AMT           05694000
056950                                                                  05695000
056960         COMPUTE AP081-PRCH-NET-ALL-AMT =                         05696000
056970            AP081-GROSS-PURCHS-AMT + AP081-RETURNS-AMT            05697000
056980            + AP081-DISCOUNT-AMT                                  05698000
056990                                                                  05699000
057000         MOVE SPACES              TO AP081-AGR-AP-TRN-CDE         05700000
057100         MOVE ZEROES              TO AP081-AGR-DISC-PCT           05710000
057200         MOVE SPACES              TO AP081-AGR-RTV-IND            05720000
057300         MOVE SPACES              TO AP081-AGR-DSC-IND            05730000
057400         PERFORM W100-WRITE-EXTRACT-RECORD                        05740000
057500                                                                  05750000
057800         PERFORM C200-GET-AGREEMENTS                              05780000
057900                                                                  05790000
058000         INITIALIZE AP081-VNDAGR-EXTRACT                          05800000
058900                                                                  05890000
059000         IF VADPT-DEPT-NBR NOT EQUAL HOLD-DEPT-NBR                05900000
059100         PERFORM S500-SELECT-TMDSEAR                              05910000
059200         END-IF                                                   05920000
059300                                                                  05930000
059400         MOVE VADPT-ENT-ID   TO HOLD-ENT-ID                       05940000
059500                                DISPLAY-ENT-ID                    05950000
059600         MOVE VADPT-DEPT-NBR TO HOLD-DEPT-NBR                     05960000
059700         MOVE EXTENT-DUN-NBR TO HOLD-VND-NBR                      05970000
059800     END-IF.                                                      05980000
059900                                                                  05990000
060000     MOVE MDSEAR-DMA-NBR       TO AP081-DMA-NBR.                  06000000
060010     MOVE MDSEAR-GMA-NBR       TO AP081-GMA-NBR.                  06001006
060100     MOVE EXTENT-DUN-NBR       TO AP081-VENDOR-NBR.               06010000
060200     MOVE ENTNME-ENT-NAME-DESC TO AP081-VENDOR-NAME.              06020000
060300     MOVE VADPT-ENT-ID         TO AP081-ENT-ID.                   06030000
060400     MOVE VADPT-DEPT-NBR       TO AP081-DEPT-NBR.                 06040000
060500     MOVE PV-FSCL-MN-NBR       TO AP081-FSCL-MN-NBR.              06050000
060600     MOVE PV-FSCL-YR-NBR       TO AP081-FSCL-YR-NBR.              06060000
060700     MOVE PV-FSCL-QTR-NBR      TO AP081-FSCL-QTR-NBR.             06070000
060800     MOVE PV-CAL-MN-NBR        TO AP081-CAL-MN-NBR.               06080000
060900     MOVE PV-CAL-YR-NBR        TO AP081-CAL-YR-NBR.               06090000
061000     MOVE PV-CAL-QTR-NBR       TO AP081-CAL-QTR-NBR.              06100000
061100     MOVE PV-FSCL-MN-BEG-DTE   TO AP081-FSCL-MN-BEG-DTE.          06110000
061200     MOVE PV-FSCL-MN-END-DTE   TO AP081-FSCL-MN-END-DTE.          06120000
061300                                                                  06130000
061400     IF  PV-ACTIVITY-TYP-CDE = 'P'                                06140000
061500         MOVE PV-ACTIVITY-AMT  TO AP081-GROSS-PURCHS-AMT          06150000
061600     ELSE                                                         06160000
061700         MOVE PV-ACTIVITY-AMT  TO AP081-OTHER-ACTVTY-AMT          06170000
061800     END-IF.                                                      06180000
061900                                                                  06190000
062000     PERFORM S100-FETCH-ACTIVITY-CSR.                             06200000
062100                                                                  06210000
062200                                                                  06220000
062300*----------------------------------------------------------------*06230000
062400*    END OF PROGRAM                                              *06240000
062500*    - PROCESS THE LAST ENTRY FETCHED FROM THE CURSOR.           *06250000
062600*    - CLOSE THE CURSOR AND FILE                                 *06260000
062700*    - DISPLAY PROGRAM COUNTS.                                   *06270000
062800*----------------------------------------------------------------*06280000
062900 B300-END-OF-PROGRAM.                                             06290000
063000                                                                  06300000
063100     PERFORM C100-GET-ADJUSTMENTS.                                06310000
063110                                                                  06311027
063120     COMPUTE AP081-GROSS-PURCHS-AMT =                             06312027
063130        AP081-GROSS-PURCHS-AMT - PV-LOAD-ACTVTY-AMT.              06313027
063200                                                                  06320000
063300     COMPUTE AP081-PRCH-NET-RTV-AMT =                             06330000
063400        AP081-GROSS-PURCHS-AMT + AP081-RETURNS-AMT.               06340000
063500                                                                  06350000
063600     COMPUTE AP081-PRCH-NET-DSC-AMT =                             06360000
063700        AP081-GROSS-PURCHS-AMT + AP081-DISCOUNT-AMT.              06370000
063800                                                                  06380000
063900     COMPUTE AP081-PRCH-NET-ALL-AMT =                             06390000
064000        AP081-GROSS-PURCHS-AMT + AP081-RETURNS-AMT                06400000
064100        + AP081-DISCOUNT-AMT.                                     06410000
064200                                                                  06420000
064300     MOVE SPACES TO AP081-AGR-AP-TRN-CDE.                         06430000
064400     MOVE ZEROES TO AP081-AGR-DISC-PCT.                           06440000
064500     MOVE SPACES TO AP081-AGR-RTV-IND.                            06450000
064600     MOVE SPACES TO AP081-AGR-DSC-IND.                            06460000
064700     PERFORM W100-WRITE-EXTRACT-RECORD.                           06470000
064900     PERFORM C200-GET-AGREEMENTS.                                 06490000
065000                                                                  06500000
065100     PERFORM X200-CLOSE-ACTIVITY-CSR.                             06510000
065200                                                                  06520000
065300     CLOSE EXTRACT-FILE                                           06530000
065400           DATES-USED-FILE.                                       06540000
065500                                                                  06550000
065600     DISPLAY '*************************************************'. 06560000
065700     DISPLAY '** TOTAL ACTIVITY ROWS  = ' PV-ACT-CSR-COUNT.       06570000
065800     DISPLAY '** TOTAL ADJUSTMENT ROWS = ' PV-ADJ-CSR-COUNT.      06580000
065900     DISPLAY '** TOTAL AGREEMENT ROWS = ' PV-AGR-CSR-COUNT.       06590000
066000     DISPLAY '** TOTAL ACCTG ENTRY ROWS = ' PV-ACCTG-CSR-COUNT.   06600000
066100     DISPLAY '** TOTAL EXTRACT RECORDS = ' PV-EXTRACT-COUNT.      06610000
066200     DISPLAY '*************************************************'. 06620000
066300     DISPLAY '**         END OF APKUT118 PROCESSING          **'. 06630000
066400     DISPLAY '*************************************************'. 06640000
066500                                                                  06650000
066600 EJECT                                                            06660000
066700*----------------------------------------------------------------*06670000
066800*    OPENS THE ADJUSTMENT CURSOR AND PROCESSES UNTIL END,         06680000
066900*    MOVING THE ADJUSTMENT AMOUNT TO THE CORRESPONDING FIELD ON   06690000
067000*    THE OUTPUT RECORD BASED ON TRANCODE.                         06700000
067100*----------------------------------------------------------------*06710000
067200 C100-GET-ADJUSTMENTS.                                            06720000
067300                                                                  06730000
067800     SET NOT-END-OF-ADJ-CSR                                       06780000
067900         NO-ADJUSTMENT-FOUND TO TRUE.                             06790000
067901                                                                  06790125
067910     MOVE ZEROES TO AP081-RETURNS-AMT                             06791025
067920                    AP081-DISCOUNT-AMT                            06792025
067930                    PV-MOS-ACTVTY-AMT                             06793025
067940                    PV-LOAD-ACTVTY-AMT.                           06794025
068000                                                                  06800000
068100     PERFORM X300-OPEN-ADJUSTMENT-CSR.                            06810000
068200     PERFORM S200-FETCH-ADJUSTMENT-CSR.                           06820000
068300                                                                  06830000
068400     IF NO-ADJUSTMENT-FOUND                                       06840000
068410        CONTINUE                                                  06841025
068500*       MOVE ZEROES            TO AP081-RETURNS-AMT               06850025
068600*                                 AP081-DISCOUNT-AMT              06860025
068700*                                 PV-MOS-ACTVTY-AMT               06870025
068710*                                 PV-LOAD-ACTVTY-AMT              06871025
068800     ELSE                                                         06880000
068900         PERFORM UNTIL END-OF-ADJ-CSR                             06890000
069000           EVALUATE TRUE                                          06900000
069100           WHEN PV-ADJUSTMENT-CDE = 'RV'                          06910000
069200              MOVE PV-ADJUSTMENT-AMT TO AP081-RETURNS-AMT         06920000
069300           WHEN PV-ADJUSTMENT-CDE = 'DS'                          06930000
069400              MOVE PV-ADJUSTMENT-AMT TO AP081-DISCOUNT-AMT        06940000
069500              MOVE ZERO TO PV-MOS-ACTVTY-AMT                      06950000
069600              PERFORM S400-SELECT-MOS-ACTIVITY                    06960000
069700           WHEN PV-ADJUSTMENT-CDE = 'LD'                          06970024
069800              MOVE PV-ADJUSTMENT-AMT TO PV-LOAD-ACTVTY-AMT        06980024
070600           END-EVALUATE                                           07060000
070700           PERFORM S200-FETCH-ADJUSTMENT-CSR                      07070000
070800        END-PERFORM                                               07080000
070900     END-IF.                                                      07090000
071000                                                                  07100000
071100     PERFORM X400-CLOSE-ADJUSTMENT-CSR.                           07110000
071200                                                                  07120000
071700 EJECT                                                            07170000
071710*----------------------------------------------------------------*07171000
071720*    OPENS THE AGREEMENT CURSOR AND PROCESSES UNTIL END,          07172000
071721*    MOVING THE ADJUSTMENT AMOUNT TO THE CORRESPONDING FIELD ON   07172100
071722*    THE OUTPUT RECORD BASED ON TRANCODE.                         07172200
071723*----------------------------------------------------------------*07172300
071724 C200-GET-AGREEMENTS.                                             07172400
071725                                                                  07172500
071726     SET NOT-END-OF-AGR-CSR                                       07172600
071727         NO-AGREEMENTS-FOUND TO TRUE.                             07172700
071728                                                                  07172800
071729     PERFORM X500-OPEN-AGREEMENT-CSR.                             07172900
071730                                                                  07173000
071731     PERFORM S300-FETCH-AGREEMENT-CSR.                            07173100
071732                                                                  07173200
071733     PERFORM UNTIL END-OF-AGR-CSR                                 07173300
071734        MOVE VNDAGR-AP-TRN-CDE          TO AP081-AGR-AP-TRN-CDE   07173400
071735        MOVE VNDAGR-DISCOUNT-PCT        TO AP081-AGR-DISC-PCT     07173500
071736        MOVE VNDAGR-DED-DISC-IND        TO AP081-AGR-RTV-IND      07173600
071737        MOVE VNDAGR-DED-RTV-IND         TO AP081-AGR-DSC-IND      07173700
071738        MOVE VNDAGR-PSTG-FRQ-CDE        TO AP081-AGR-PSTG-FRQ-CDE 07173800
071739        IF AP081-AGR-RTV-IND = 'Y'                                07173900
071740           IF AP081-AGR-DSC-IND = 'Y'                             07174000
071741              COMPUTE AP081-EST-EARNED-AMT =                      07174100
071742                      AP081-PRCH-NET-ALL-AMT * AP081-AGR-DISC-PCT 07174200
071743           ELSE                                                   07174300
071744              COMPUTE AP081-EST-EARNED-AMT =                      07174400
071745                      AP081-PRCH-NET-RTV-AMT * AP081-AGR-DISC-PCT 07174500
071746           END-IF                                                 07174600
071747        ELSE                                                      07174700
071748           IF AP081-AGR-DSC-IND = 'Y'                             07174800
071749              COMPUTE AP081-EST-EARNED-AMT =                      07174900
071750                      AP081-PRCH-NET-DSC-AMT * AP081-AGR-DISC-PCT 07175000
071751           ELSE                                                   07175100
071752              COMPUTE AP081-EST-EARNED-AMT =                      07175200
071753                      AP081-GROSS-PURCHS-AMT * AP081-AGR-DISC-PCT 07175300
071754           END-IF                                                 07175400
071755        END-IF                                                    07175500
071756        IF  AP081-EST-EARNED-AMT < 0                              07175602
071757            MOVE ZERO TO AP081-EST-EARNED-AMT                     07175702
071758        END-IF                                                    07175802
071760        IF VNDAGR-AP-TRN-CDE = 'MO'                               07176003
071761           MOVE PV-MOS-ACTVTY-AMT   TO AP081-OTHER-ACTVTY-AMT     07176103
071764        END-IF                                                    07176403
071786        PERFORM W100-WRITE-EXTRACT-RECORD                         07178600
071787        PERFORM S300-FETCH-AGREEMENT-CSR                          07178700
071788     END-PERFORM.                                                 07178800
071789                                                                  07178900
071790     PERFORM X600-CLOSE-AGREEMENT-CSR.                            07179000
071791                                                                  07179100
071792 EJECT                                                            07179200
071856*----------------------------------------------------------------*07185600
071857*    VALIDATE THE FIELDS ON THE CONTROL CARD AND SET UP THE       07185700
071858*    VARIABLES TO SELECT THE CONTROL DATES FROM THE AP CONTROL    07185800
071859*    TABLE AND THE DATE ATTRIBUTE TABLE.                          07185900
071860*----------------------------------------------------------------*07186000
071861 D100-VALIDATE-CONTROL-CARD.                                      07186100
071862                                                                  07186200
071863     MOVE 'D100-VALIDATE-CONTROL-CARD' TO AA-PARAGRAPH-NAME.      07186300
071870                                                                  07187000
071880     IF  CC-RPT-TYP-VALID                                         07188000
071890         IF  CC-SPECIAL-REQUEST                                   07189000
071900             IF  CC-RQST-BEGIN-DTE = SPACES                       07190000
072000             OR  CC-RQST-END-DTE = SPACES                         07200000
072100                 SET AC-INVALID-CONTROL-CARD TO TRUE              07210000
072200                 MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1           07220000
072300                 MOVE PC-NO-RQST-DATES-MSG TO AA-MESSAGE-2        07230000
072400                 PERFORM Z998-GENERAL-ABEND                       07240000
072500             ELSE                                                 07250000
072600                 PERFORM S800-GET-REQUESTED-CONTROLS              07260000
072700             END-IF                                               07270000
072800         ELSE                                                     07280000
072900             IF  CC-WEEKLY-RUN                                    07290000
073000                 IF  CC-VALID-WKLY-RPT                            07300000
073100                     PERFORM S600-GET-WEEKLY-CONTROLS             07310000
073200                 ELSE                                             07320000
073300                     SET AC-INVALID-CONTROL-CARD TO TRUE          07330000
073400                     MOVE PC-WEEKLY-RPT-MSG TO AA-MESSAGE-1       07340000
073500                     MOVE SPACES            TO AA-MESSAGE-2       07350000
073600                     PERFORM Z998-GENERAL-ABEND                   07360000
073700                 END-IF                                           07370000
073800             ELSE                                                 07380000
073900                 IF  CC-MOEND-RUN                                 07390000
074000                     IF  CC-VALID-MOEND-RPT                       07400000
074100                         PERFORM S700-GET-MONTH-END-CONTROLS      07410000
074200                     ELSE                                         07420000
074300                         SET AC-INVALID-CONTROL-CARD TO TRUE      07430000
074400                         MOVE PC-MOEND-RPT-MSG TO AA-MESSAGE-1    07440000
074500                         MOVE SPACES            TO AA-MESSAGE-2   07450000
074600                         PERFORM Z998-GENERAL-ABEND               07460000
074700                     END-IF                                       07470000
074800                 ELSE                                             07480000
074900                     IF  CC-CALENDAR-RUN                          07490000
075000                         IF  CC-VALID-CAL-RPT                     07500000
075100                            PERFORM S900-GET-CALENDAR-CONTROLS    07510000
075200                         ELSE                                     07520000
075300                            SET AC-INVALID-CONTROL-CARD TO TRUE   07530000
075400                            MOVE PC-CAL-RPT-MSG TO AA-MESSAGE-1   07540000
075500                            MOVE SPACES         TO AA-MESSAGE-2   07550000
075600                            PERFORM Z998-GENERAL-ABEND            07560000
075700                         END-IF                                   07570000
075800                     ELSE                                         07580000
075900                         SET AC-INVALID-CONTROL-CARD TO TRUE      07590000
076000                         MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1   07600000
076100                         MOVE SPACES            TO AA-MESSAGE-2   07610000
076200                         DISPLAY 'INVALID RUN FREQUENCY CODE = '  07620000
076300                         CC-RUN-FRQ-CDE                           07630000
076400                         PERFORM Z998-GENERAL-ABEND               07640000
076500                     END-IF                                       07650000
076600                 END-IF                                           07660000
076700             END-IF                                               07670000
076800         END-IF                                                   07680000
076900     ELSE                                                         07690000
077000         SET AC-INVALID-CONTROL-CARD TO TRUE                      07700000
077100         MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1                   07710000
077200         MOVE SPACES            TO AA-MESSAGE-2                   07720000
077300         DISPLAY 'INVALID REPORT TYPE CODE = ' CC-REPORT-TYP-CDE  07730000
077400         PERFORM Z998-GENERAL-ABEND                               07740000
077500     END-IF.                                                      07750000
077600                                                                  07760000
077700 EJECT                                                            07770000
077800*---------------------------------------------------------------- 07780000
077900*    FETCH THE ACTIVITY_CSR CURSOR.                               07790000
078000*---------------------------------------------------------------- 07800000
078100 S100-FETCH-ACTIVITY-CSR.                                         07810000
078200                                                                  07820000
078300     EXEC SQL                                                     07830000
078400         FETCH  ACTIVITY_CSR                                      07840000
078500          INTO  :VADPT-ENT-ID                                     07850000
078600               ,:VADPT-DEPT-NBR                                   07860000
078700               ,:EXTENT-DUN-NBR                                   07870000
078800               ,:ENTNME-ENT-NAME-DESC                             07880000
078900               ,:PV-ACTIVITY-AMT                                  07890000
079000               ,:PV-ACTIVITY-TYP-CDE                              07900000
079100     END-EXEC.                                                    07910000
079200                                                                  07920000
079300     EVALUATE TRUE                                                07930000
079400         WHEN SQLCODE = ZERO                                      07940000
079500             ADD 1 TO PV-ACT-CSR-COUNT                            07950000
079600                                                                  07960000
079700         WHEN SQLCODE = +100                                      07970000
079800             SET END-OF-ACT-CSR TO TRUE                           07980000
079900                                                                  07990000
080000         WHEN SQLWARN0 NOT = SPACES                               08000000
080100         WHEN SQLCODE  NOT = ZERO                                 08010000
080200             MOVE 'S100-FETCH-ACTIVITY-CSR'                       08020000
080300                                 TO AA-PARAGRAPH-NAME             08030000
080400             MOVE 'UNSUCCESSFUL FETCH FROM ACTIVITY_CSR'          08040000
080500                                 TO AA-DB2-OPERATION              08050000
080600             MOVE 'TVADPT '      TO AA-DB2-TABLE-1                08060000
080700             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                08070000
080800             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                08080000
080900             MOVE 'TADJRNL'      TO AA-DB2-TABLE-4                08090000
081000             MOVE '       '      TO AA-DB2-TABLE-5                08100000
081100             PERFORM Z999-DB2-ABEND                               08110000
081200     END-EVALUATE.                                                08120000
081300                                                                  08130000
081400*---------------------------------------------------------------- 08140000
081500*    FETCH FROM THE ADJUSTMENT_CSR CURSOR.                        08150000
081600*---------------------------------------------------------------- 08160000
081700 S200-FETCH-ADJUSTMENT-CSR.                                       08170000
081800                                                                  08180000
081900     EXEC SQL                                                     08190000
082000         FETCH  ADJUSTMENT_CSR                                    08200000
082100          INTO  :PV-ADJUSTMENT-CDE                                08210000
082200              , :PV-ADJUSTMENT-AMT                                08220000
082300     END-EXEC.                                                    08230000
082400                                                                  08240000
082500     EVALUATE TRUE                                                08250000
082600         WHEN SQLCODE = ZERO                                      08260000
082700             ADD 1 TO PV-ADJ-CSR-COUNT                            08270000
082800             SET ADJUSTMENT-FOUND TO TRUE                         08280000
082900         WHEN SQLCODE = +100                                      08290000
083000             SET END-OF-ADJ-CSR TO TRUE                           08300000
083100                                                                  08310000
083200         WHEN SQLWARN0 NOT = SPACES                               08320000
083300         WHEN SQLCODE  NOT = ZERO                                 08330000
083400             MOVE 'S100-FETCH-ADJUSTMENT-CSR'                     08340000
083500                                 TO AA-PARAGRAPH-NAME             08350000
083600             MOVE 'UNSUCCESSFUL FETCH FROM ADJUSTMENT_CSR'        08360000
083700                                 TO AA-DB2-OPERATION              08370000
083800             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                08380000
083900                     ' HOLD DEPT = '  HOLD-DEPT-NBR               08390000
084000             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                08400000
084100             MOVE '       '      TO AA-DB2-TABLE-2                08410000
084200             MOVE '       '      TO AA-DB2-TABLE-3                08420000
084300             MOVE '       '      TO AA-DB2-TABLE-4                08430000
084400             MOVE '       '      TO AA-DB2-TABLE-5                08440000
084500             PERFORM Z999-DB2-ABEND                               08450000
084600     END-EVALUATE.                                                08460000
084700                                                                  08470000
085813                                                                  08581300
085814*---------------------------------------------------------------- 08581400
085815*    FETCH FROM THE AGREEMENT_CSR CURSOR.                         08581500
085816*---------------------------------------------------------------- 08581600
085817 S300-FETCH-AGREEMENT-CSR.                                        08581700
085818                                                                  08581800
085819     EXEC SQL                                                     08581900
085820         FETCH  AGREEMENT_CSR                                     08582000
085830          INTO  :VNDAGR-AP-TRN-CDE                                08583000
085840              , :VNDAGR-DISCOUNT-PCT                              08584000
085850              , :VNDAGR-PSTG-FRQ-CDE                              08585000
085860              , :VNDAGR-DED-DISC-IND                              08586000
085870              , :VNDAGR-DED-RTV-IND                               08587000
085880     END-EXEC.                                                    08588000
085890                                                                  08589000
085900     EVALUATE TRUE                                                08590000
086000         WHEN SQLCODE = ZERO                                      08600000
086100             ADD 1 TO PV-AGR-CSR-COUNT                            08610000
086200             SET AGREEMENTS-FOUND TO TRUE                         08620000
086300         WHEN SQLCODE = +100                                      08630000
086400             SET END-OF-AGR-CSR TO TRUE                           08640000
086500                                                                  08650000
086600         WHEN SQLWARN0 NOT = SPACES                               08660000
086700         WHEN SQLCODE  NOT = ZERO                                 08670000
086800             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                08680000
086900                     ' HOLD DEPT = '  HOLD-DEPT-NBR               08690000
087000             MOVE 'S300-FETCH-AGREEMENT-CSR'                      08700000
087100                                 TO AA-PARAGRAPH-NAME             08710000
087200             MOVE 'UNSUCCESSFUL FETCH FROM AGREEMENT_CSR'         08720000
087300                                 TO AA-DB2-OPERATION              08730000
087400             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                08740000
087500             MOVE '       '      TO AA-DB2-TABLE-2                08750000
087600             MOVE '       '      TO AA-DB2-TABLE-3                08760000
087700             MOVE '       '      TO AA-DB2-TABLE-4                08770000
087800             MOVE '       '      TO AA-DB2-TABLE-5                08780000
087900             PERFORM Z999-DB2-ABEND                               08790000
088000     END-EVALUATE.                                                08800000
088100                                                                  08810000
088200*---------------------------------------------------------------- 08820000
088300*    SELECT THE TOTAL MOS DISCOUNT AMOUNT FOR THE VENDOR/DEPT     08830000
088400*    BEING PROCESSED.  THIS IS PERFORMED ONLY WHEN THERE WERE     08840000
088500*    TRANCODE '28' TRANSACTIONS FOUND IN THE ADJUSTMENT CURSOR.   08850000
088600*    THE COALESCE RETURNS ZERO INSTEAD OF NULL WHEN NO ROWS ARE   08860000
088700*    FOUND.                                                       08870000
088800*---------------------------------------------------------------- 08880000
088900 S400-SELECT-MOS-ACTIVITY.                                        08890000
089000                                                                  08900000
089100     EXEC SQL                                                     08910000
089200          SELECT COALESCE(SUM(AJ.NET_COST_AMT),0)                 08920018
089400            INTO :PV-MOS-ACTVTY-AMT                               08940000
090600                    FROM TADJRNL AJ                               09060000
090700                   WHERE AJ.AP_TRN_CDE = '2B'                     09070014
090800                     AND AJ.PSTG_FMN_NBR BETWEEN                  09080000
090900                                             :PV-MIN-PSTG-FMN-NBR 09090000
091000                                         AND :PV-MAX-PSTG-FMN-NBR 09100000
091100                     AND AJ.PSTG_FYR_NBR = :PV-PSTG-FYR-NBR       09110000
091200                     AND AJ.VND_NBR      = :HOLD-VND-NBR          09120000
091300                     AND AJ.DEPT_NBR     = :HOLD-DEPT-NBR         09130017
091400         WITH UR                                                  09140000
091500     END-EXEC.                                                    09150000
091600                                                                  09160000
091710     EVALUATE TRUE                                                09171000
091800         WHEN SQLCODE = ZERO                                      09180000
091900             CONTINUE                                             09190000
092000         WHEN SQLCODE = +100                                      09200000
092100             MOVE ZERO TO PV-MOS-ACTVTY-AMT                       09210000
092200                                                                  09220000
092300         WHEN SQLWARN0 NOT = SPACES                               09230000
092400         WHEN SQLCODE  NOT = ZERO                                 09240000
092500             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                09250000
092600                     ' HOLD DEPT = '  HOLD-DEPT-NBR               09260000
092700             MOVE 'S400-SELECT-MOS-ACTIVITY'                      09270000
092800                                 TO AA-PARAGRAPH-NAME             09280000
092900             MOVE 'UNSUCCESSFUL SELECT OF MOS DISCOUNT'           09290000
093000                                 TO AA-DB2-OPERATION              09300000
093100             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                09310000
093200             MOVE 'TINVOIC'      TO AA-DB2-TABLE-2                09320000
093300             MOVE 'TADJRNL'      TO AA-DB2-TABLE-3                09330000
093400             MOVE '       '      TO AA-DB2-TABLE-4                09340000
093500             MOVE '       '      TO AA-DB2-TABLE-5                09350000
093600             PERFORM Z999-DB2-ABEND                               09360000
093700     END-EVALUATE.                                                09370000
093800                                                                  09380000
093810     EXEC SQL                                                     09381022
093820          SELECT COALESCE(SUM((IV.GRO_COST_AMT * AL.ALW_CHRG_PCT) 09382022
093830                      + AL.ALW_CHRG_AMT),0)                       09383022
093840            INTO :PV-MOS-ACTVTY-AMT-2                             09384022
093850            FROM TINVOIC IV                                       09385022
093860               , TALCHRG AL                                       09386022
093870           WHERE IV.PO_NBR = AL.PO_NBR                            09387022
093880             AND IV.INVC_ID = AL.INVC_ID                          09388022
093890             AND IV.STATUS_CDE IN ('OP','PD')                     09389022
093891             AND AL.ALW_CHRG_TYP_CDE = 'A'                        09389122
093892             AND AL.ALW_CHRG_CDE = 'MOS'                          09389222
093893             AND IV.AP_PRC_DTE BETWEEN :EXTRACT-BEGIN-DTE         09389322
093894                                   AND :EXTRACT-END-DTE           09389422
093895             AND IV.PO_NBR IN                                     09389522
093896                 (SELECT DISTINCT AJ.PO_NBR                       09389622
093897                    FROM TADJRNL AJ                               09389722
093898                   WHERE AJ.AP_TRN_CDE = '28'                     09389822
093899                     AND AJ.PSTG_FMN_NBR BETWEEN                  09389922
093900                                             :PV-MIN-PSTG-FMN-NBR 09390022
093901                                         AND :PV-MAX-PSTG-FMN-NBR 09390122
093902                     AND AJ.PSTG_FYR_NBR = :PV-PSTG-FYR-NBR       09390222
093903                     AND AJ.VND_NBR      = :HOLD-VND-NBR          09390322
093904                     AND AJ.DEPT_NBR     = :HOLD-DEPT-NBR)        09390422
093905         WITH UR                                                  09390522
093906     END-EXEC.                                                    09390622
093907                                                                  09390722
093908     EVALUATE TRUE                                                09390822
093909         WHEN SQLCODE = ZERO                                      09390922
093910             ADD PV-MOS-ACTVTY-AMT-2 TO PV-MOS-ACTVTY-AMT         09391022
093911         WHEN SQLCODE = +100                                      09391122
093912             MOVE ZERO TO PV-MOS-ACTVTY-AMT-2                     09391222
093913                                                                  09391322
093914         WHEN SQLWARN0 NOT = SPACES                               09391422
093915         WHEN SQLCODE  NOT = ZERO                                 09391522
093916             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                09391622
093917                     ' HOLD DEPT = '  HOLD-DEPT-NBR               09391722
093918             MOVE 'S400-SELECT-MOS-ACTIVITY'                      09391822
093919                                 TO AA-PARAGRAPH-NAME             09391922
093920             MOVE 'UNSUCCESSFUL SELECT OF MOS DISCOUNT'           09392022
093921                                 TO AA-DB2-OPERATION              09392122
093922             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                09392222
093923             MOVE 'TINVOIC'      TO AA-DB2-TABLE-2                09392322
093924             MOVE 'TADJRNL'      TO AA-DB2-TABLE-3                09392422
093925             MOVE '       '      TO AA-DB2-TABLE-4                09392522
093926             MOVE '       '      TO AA-DB2-TABLE-5                09392622
093927             PERFORM Z999-DB2-ABEND                               09392722
093928     END-EVALUATE.                                                09392822
093929                                                                  09392922
093930*---------------------------------------------------------------- 09393000
094000*    SELECT DMM NUMBER FROM TMDSEAR FOR DEPT BEING PROCESSED.     09400000
094100*---------------------------------------------------------------- 09410000
094200 S500-SELECT-TMDSEAR.                                             09420000
094300                                                                  09430000
094400     EXEC SQL                                                     09440000
094500         SELECT DMA_NBR                                           09450000
094510              , GMA_NBR                                           09451006
094600           INTO :MDSEAR-DMA-NBR                                   09460000
094610              , :MDSEAR-GMA-NBR                                   09461006
094700           FROM TMDSEAR                                           09470000
094800          WHERE MDSELV_CDE = 'DPT'                                09480000
094900            AND DEPT_NBR   = :VADPT-DEPT-NBR                      09490000
095000            AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE         09500000
095100     END-EXEC.                                                    09510000
095200                                                                  09520000
095300     EVALUATE TRUE                                                09530000
095400         WHEN SQLCODE = ZERO                                      09540000
095500             CONTINUE                                             09550000
095600         WHEN SQLCODE = +100                                      09560000
095700             MOVE ZERO TO MDSEAR-DMA-NBR                          09570000
095800                          MDSEAR-GMA-NBR                          09580006
095900         WHEN SQLWARN0 NOT = SPACES                               09590000
096000         WHEN SQLCODE  NOT = ZERO                                 09600000
096100             DISPLAY 'VADPT-DEPT-NBR = ' VADPT-DEPT-NBR           09610000
096200             MOVE 'S500-SELECT-TMDSEAR   '                        09620000
096300                                 TO AA-PARAGRAPH-NAME             09630000
096400             MOVE 'UNSUCCESSFUL SELECT FROM TMDSEAR   '           09640000
096500                                 TO AA-DB2-OPERATION              09650000
096600             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                09660000
096700             MOVE '       '      TO AA-DB2-TABLE-2                09670000
096800             MOVE '       '      TO AA-DB2-TABLE-3                09680000
096900             MOVE '       '      TO AA-DB2-TABLE-4                09690000
097000             MOVE '       '      TO AA-DB2-TABLE-5                09700000
097100             PERFORM Z999-DB2-ABEND                               09710000
097200     END-EVALUATE.                                                09720000
097300                                                                  09730000
097400*----------------------------------------------------------------*09740000
097500*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE       09750000
097600*    AP CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR WEEKLY         09760000
097700*    EXTRACTS.                                                    09770000
097800*----------------------------------------------------------------*09780000
097900 S600-GET-WEEKLY-CONTROLS.                                        09790000
098000                                                                  09800000
098100     EXEC SQL                                                     09810000
098200         SELECT A.BTCH_PRC_DTE                                    09820000
098300              , B.FSCL_YR_NBR                                     09830000
098400              , B.FSCL_QTR_NBR                                    09840000
098500              , B.FSCL_MN_NBR                                     09850000
098600              , B.FSCL_MN_END_DTE                                 09860000
098700              , B.FSCL_MN_BEG_DTE                                 09870000
098800           INTO :APCNTL-BTCH-PRC-DTE                              09880000
098900              , :DTATTR-FSCL-YR-NBR                               09890000
099000              , :DTATTR-FSCL-QTR-NBR                              09900000
099100              , :DTATTR-FSCL-MN-NBR                               09910000
099200              , :DTATTR-FSCL-MN-END-DTE                           09920000
099300              , :EXTRACT-BEGIN-DTE                                09930000
099400           FROM TAPCNTL  A                                        09940000
099500              , TDTATTR  B                                        09950000
099600          WHERE A.BTCH_PRC_DTE    = B.KY_DTE                      09960000
099700     END-EXEC.                                                    09970000
099800                                                                  09980000
099900     EVALUATE TRUE                                                09990000
100000         WHEN SQLCODE = ZERO                                      10000000
100100             MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE      10010000
100200                                            PV-MAX-MOEND-DTE      10020000
100300             MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR   10030000
100400                                            PV-MAX-PSTG-FMN-NBR   10040000
100500                                            PV-PREVYR-FMN-NBR     10050000
100600             MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR       10060000
100700                                            PV-CURR-PSTG-FYR-NBR  10070000
100800                                            PV-PREV-PSTG-FYR-NBR  10080000
100900                                                                  10090000
101000         WHEN SQLWARN0 NOT = SPACES                               10100000
101100         WHEN SQLCODE  NOT = ZERO                                 10110000
101200             MOVE 'S600-GET-WEEKLY-CONTROLS'                      10120000
101300                                 TO AA-PARAGRAPH-NAME             10130000
101400             MOVE 'UNSUCCESSFUL SELECT '                          10140000
101500                                 TO AA-DB2-OPERATION              10150000
101600             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                10160000
101700             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-2                10170000
101800             MOVE '       '      TO AA-DB2-TABLE-3                10180000
101900             MOVE '       '      TO AA-DB2-TABLE-4                10190000
102000             MOVE '       '      TO AA-DB2-TABLE-5                10200000
102100             PERFORM Z999-DB2-ABEND                               10210000
102200     END-EVALUATE.                                                10220000
102300                                                                  10230000
102400     IF  CC-QUARTERLY                                             10240000
102500         EXEC SQL                                                 10250000
102600             SELECT MIN(C.FSCL_MN_NBR)                            10260000
102700                  , MAX(C.FSCL_MN_NBR)                            10270000
102800                  , MIN(C.FSCL_MN_END_DTE)                        10280000
102900                  , MAX(C.FSCL_MN_END_DTE)                        10290000
103000                  , MIN(C.FSCL_MN_BEG_DTE)                        10300000
103100               INTO :PV-MIN-PSTG-FMN-NBR                          10310000
103200                  , :PV-MAX-PSTG-FMN-NBR                          10320000
103300                  , :PV-MIN-MOEND-DTE                             10330000
103400                  , :PV-MAX-MOEND-DTE                             10340000
103500                  , :EXTRACT-BEGIN-DTE                            10350000
103600               FROM TDTATTR  C                                    10360000
103700              WHERE C.FSCL_QTR_NBR    = :DTATTR-FSCL-QTR-NBR      10370000
103800                AND C.FSCL_YR_NBR     = :DTATTR-FSCL-YR-NBR       10380000
103900                AND C.FSCL_MN_END_DTE <= :APCNTL-BTCH-PRC-DTE     10390000
104000         END-EXEC                                                 10400000
104100         EVALUATE TRUE                                            10410000
104200             WHEN SQLCODE = ZERO                                  10420000
104300                  CONTINUE                                        10430000
104400             WHEN SQLWARN0 NOT = SPACES                           10440000
104500             WHEN SQLCODE  NOT = ZERO                             10450000
104600                 MOVE 'S600-GET-WEEKLY-CONTROLS'                  10460000
104700                                     TO AA-PARAGRAPH-NAME         10470000
104800                 MOVE 'UNSUCCESSFUL SELECT NUMBER TWO'            10480000
104900                                     TO AA-DB2-OPERATION          10490000
105000                 MOVE 'TDTATTR'      TO AA-DB2-TABLE-1            10500000
105100                 MOVE '       '      TO AA-DB2-TABLE-2            10510000
105200                 MOVE '       '      TO AA-DB2-TABLE-3            10520000
105300                 MOVE '       '      TO AA-DB2-TABLE-4            10530000
105400                 MOVE '       '      TO AA-DB2-TABLE-5            10540000
105500                 PERFORM Z999-DB2-ABEND                           10550000
105600         END-EVALUATE                                             10560000
105700     END-IF.                                                      10570000
105800                                                                  10580000
105900 EJECT                                                            10590000
106000*----------------------------------------------------------------*10600000
106100*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE       10610000
106200*    AP CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR MONTH-END      10620000
106300*    EXTRACTS.                                                    10630000
106400*----------------------------------------------------------------*10640000
106500 S700-GET-MONTH-END-CONTROLS.                                     10650000
106600                                                                  10660000
106700     EXEC SQL                                                     10670000
106800         SELECT A.BTCH_PRC_DTE                                    10680000
106900              , A.PREV_WK_END_DTE                                 10690000
107000              , B.FSCL_YR_NBR                                     10700000
107100              , B.FSCL_QTR_NBR                                    10710000
107200              , B.FSCL_MN_NBR                                     10720000
107300              , B.FSCL_MN_END_DTE                                 10730000
107400              , B.FSCL_MN_BEG_DTE                                 10740000
107500              , B.CAL_MN_NBR                                      10750000
107600              , (CASE B.CAL_MN_NBR                                10760000
107700                 WHEN '01' THEN '1'                               10770000
107800                 WHEN '02' THEN '1'                               10780000
107900                 WHEN '03' THEN '1'                               10790000
108000                 WHEN '04' THEN '2'                               10800000
108100                 WHEN '05' THEN '2'                               10810000
108200                 WHEN '06' THEN '2'                               10820000
108300                 WHEN '07' THEN '3'                               10830000
108400                 WHEN '08' THEN '3'                               10840000
108500                 WHEN '09' THEN '3'                               10850000
108600                 WHEN '10' THEN '4'                               10860000
108700                 WHEN '11' THEN '4'                               10870000
108710                 WHEN '12' THEN '4'                               10871000
108720                 END)                                             10872000
108730              , (CASE B.CAL_MN_NBR                                10873000
108740                 WHEN '01' THEN CHAR(INTEGER(B.FSCL_YR_NBR)+ 1)   10874000
108750                 ELSE B.FSCL_YR_NBR                               10875000
108760                 END)                                             10876000
108770           INTO :APCNTL-BTCH-PRC-DTE                              10877000
108780              , :APCNTL-PREV-WK-END-DTE                           10878000
108790              , :DTATTR-FSCL-YR-NBR                               10879000
108800              , :DTATTR-FSCL-QTR-NBR                              10880000
108900              , :DTATTR-FSCL-MN-NBR                               10890000
109000              , :DTATTR-FSCL-MN-END-DTE                           10900000
109100              , :EXTRACT-BEGIN-DTE                                10910000
109200              , :DTATTR-CAL-MN-NBR                                10920000
109300              , :PV-CAL-QTR-NBR                                   10930000
109400              , :PV-CAL-YR-NBR                                    10940000
109500           FROM TAPCNTL  A                                        10950000
109600              , TDTATTR  B                                        10960000
109700          WHERE A.PREV_WK_END_DTE   = B.KY_DTE                    10970000
109800            AND A.MULT_PSTG_PER_IND = 'Y'                         10980000
109900     END-EXEC.                                                    10990000
110000                                                                  11000000
110100     EVALUATE TRUE                                                11010000
110200         WHEN SQLCODE = ZERO                                      11020000
110300             MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE      11030000
110400                                            PV-MAX-MOEND-DTE      11040000
110410                                            PV-FSCL-MN-END-DTE    11041000
110420             MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR   11042000
110430                                            PV-MAX-PSTG-FMN-NBR   11043000
110440                                            PV-PREVYR-FMN-NBR     11044000
110450                                            PV-FSCL-MN-NBR        11045000
110460             MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR       11046000
110470                                            PV-PREV-PSTG-FYR-NBR  11047000
110480                                            PV-CURR-PSTG-FYR-NBR  11048000
110490                                            PV-FSCL-YR-NBR        11049000
110500             MOVE DTATTR-FSCL-QTR-NBR    TO PV-FSCL-QTR-NBR       11050000
110600             MOVE DTATTR-CAL-MN-NBR      TO PV-CAL-MN-NBR         11060000
110700             MOVE EXTRACT-BEGIN-DTE      TO PV-FSCL-MN-BEG-DTE    11070000
110800                                                                  11080000
110900         WHEN SQLWARN0 NOT = SPACES                               11090000
111000         WHEN SQLCODE  NOT = ZERO                                 11100000
111100             MOVE 'S700-GET-MONTH-END-CONTROLS'                   11110000
111200                                 TO AA-PARAGRAPH-NAME             11120000
111300             MOVE 'UNSUCCESSFUL SELECT '                          11130000
111400                                 TO AA-DB2-OPERATION              11140000
111500             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                11150000
111600             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-2                11160000
111700             MOVE '       '      TO AA-DB2-TABLE-3                11170000
111800             MOVE '       '      TO AA-DB2-TABLE-4                11180000
111900             MOVE '       '      TO AA-DB2-TABLE-5                11190000
112000             PERFORM Z999-DB2-ABEND                               11200000
112100     END-EVALUATE.                                                11210000
112200                                                                  11220000
112300     IF  CC-QUARTERLY                                             11230000
112400         MOVE DTATTR-FSCL-QTR-NBR TO PV-MIN-FSCL-QTR-NBR          11240000
112500                                     PV-MAX-FSCL-QTR-NBR          11250000
112600     ELSE                                                         11260000
112700         IF CC-SEMI-ANNUAL                                        11270000
112800            IF DTATTR-FSCL-QTR-NBR = 1 OR 2                       11280000
112900               MOVE 1 TO PV-MIN-FSCL-QTR-NBR                      11290000
113000               MOVE 2 TO PV-MAX-FSCL-QTR-NBR                      11300000
113100            ELSE                                                  11310000
113200               MOVE 3 TO PV-MIN-FSCL-QTR-NBR                      11320000
113300               MOVE 4 TO PV-MAX-FSCL-QTR-NBR                      11330000
113400            END-IF                                                11340000
113500         ELSE                                                     11350000
113600            MOVE 1 TO PV-MIN-FSCL-QTR-NBR                         11360000
113700            MOVE DTATTR-FSCL-QTR-NBR TO PV-MAX-FSCL-QTR-NBR       11370000
113800         END-IF                                                   11380000
113900     END-IF.                                                      11390000
114000                                                                  11400000
114100     IF  CC-QUARTERLY                                             11410000
114200     OR  CC-SEMI-ANNUAL                                           11420000
114300     OR  CC-YEAR-TO-DATE                                          11430000
114400         EXEC SQL                                                 11440000
114500             SELECT MIN(C.FSCL_MN_NBR)                            11450000
114600                  , MAX(C.FSCL_MN_NBR)                            11460000
114700                  , MIN(C.FSCL_MN_END_DTE)                        11470000
114800                  , MAX(C.FSCL_MN_END_DTE)                        11480000
114900                  , MIN(C.FSCL_MN_BEG_DTE)                        11490000
115000               INTO :PV-MIN-PSTG-FMN-NBR                          11500000
115100                  , :PV-MAX-PSTG-FMN-NBR                          11510000
115200                  , :PV-MIN-MOEND-DTE                             11520000
115300                  , :PV-MAX-MOEND-DTE                             11530000
115400                  , :EXTRACT-BEGIN-DTE                            11540000
115500               FROM TDTATTR  C                                    11550000
115600              WHERE C.FSCL_QTR_NBR    BETWEEN :PV-MIN-FSCL-QTR-NBR11560000
115700                                          AND :PV-MAX-FSCL-QTR-NBR11570000
115800                AND C.FSCL_YR_NBR     = :DTATTR-FSCL-YR-NBR       11580000
115900                AND C.FSCL_MN_END_DTE <= :APCNTL-PREV-WK-END-DTE  11590000
116000         END-EXEC                                                 11600000
116100         EVALUATE TRUE                                            11610000
116200             WHEN SQLCODE = ZERO                                  11620000
116300                  CONTINUE                                        11630000
116400             WHEN SQLWARN0 NOT = SPACES                           11640000
116500             WHEN SQLCODE  NOT = ZERO                             11650000
116600                 MOVE 'S700-GET-MONTH-END-CONTROLS'               11660000
116700                                     TO AA-PARAGRAPH-NAME         11670000
116800                 MOVE 'UNSUCCESSFUL SELECT NUMBER TWO'            11680000
116900                                     TO AA-DB2-OPERATION          11690000
117000                 MOVE 'TDTATTR'      TO AA-DB2-TABLE-1            11700000
117100                 MOVE '       '      TO AA-DB2-TABLE-2            11710000
117200                 MOVE '       '      TO AA-DB2-TABLE-3            11720000
117300                 MOVE '       '      TO AA-DB2-TABLE-4            11730000
117400                 MOVE '       '      TO AA-DB2-TABLE-5            11740000
117500                 PERFORM Z999-DB2-ABEND                           11750000
117600         END-EVALUATE                                             11760000
117700     END-IF.                                                      11770000
117800*----------------------------------------------------------------*11780000
117900*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE AP    11790000
118000*    CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR REQUESTED DATES.  11800000
118100*----------------------------------------------------------------*11810000
118200 S800-GET-REQUESTED-CONTROLS.                                     11820000
118300                                                                  11830000
118400** GET CURRENT BATCH PROCESS DATE                                 11840000
118500                                                                  11850000
118600     EXEC SQL                                                     11860000
118700         SELECT A.BTCH_PRC_DTE                                    11870000
118800           INTO :APCNTL-BTCH-PRC-DTE                              11880000
118900           FROM TAPCNTL  A                                        11890000
119000     END-EXEC.                                                    11900000
119100                                                                  11910000
119200     EVALUATE TRUE                                                11920000
119300         WHEN SQLCODE = ZERO                                      11930000
119400              CONTINUE                                            11940000
119500         WHEN SQLWARN0 NOT = SPACES                               11950000
119600         WHEN SQLCODE  NOT = ZERO                                 11960000
119700             MOVE 'S600-GET-WEEKLY-CONTROLS'                      11970000
119800                                 TO AA-PARAGRAPH-NAME             11980000
119900             MOVE 'UNSUCCESSFUL SELECT '                          11990000
120000                                 TO AA-DB2-OPERATION              12000000
120100             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                12010000
120200             MOVE '       '      TO AA-DB2-TABLE-2                12020000
120300             MOVE '       '      TO AA-DB2-TABLE-3                12030000
120400             MOVE '       '      TO AA-DB2-TABLE-4                12040000
120500             MOVE '       '      TO AA-DB2-TABLE-5                12050000
120600             PERFORM Z999-DB2-ABEND                               12060000
120700     END-EVALUATE.                                                12070000
120800                                                                  12080000
120900** VALIDATE REQUESTED BEGIN DATE                                  12090000
121000                                                                  12100000
121100     EXEC SQL                                                     12110000
121200         SELECT FSCL_MN_NBR                                       12120000
121300              , FSCL_YR_NBR                                       12130000
121400              , FSCL_MN_END_DTE                                   12140000
121500           INTO :DTATTR-FSCL-MN-NBR                               12150000
121600              , :DTATTR-FSCL-YR-NBR                               12160000
121700              , :DTATTR-FSCL-MN-END-DTE                           12170000
121800           FROM TDTATTR                                           12180000
121900          WHERE KY_DTE          = :CC-RQST-BEGIN-DTE              12190000
122000            AND FSCL_MN_BEG_DTE = :CC-RQST-BEGIN-DTE              12200000
122100     END-EXEC.                                                    12210000
122200                                                                  12220000
122300     EVALUATE TRUE                                                12230000
122400         WHEN SQLCODE = ZERO                                      12240000
122500              MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR  12250000
122600                                             PV-PREVYR-FMN-NBR    12260000
122700              MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR      12270000
122800                                             PV-PREV-PSTG-FYR-NBR 12280000
122900              MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE     12290000
123000              MOVE CC-RQST-BEGIN-DTE      TO EXTRACT-BEGIN-DTE    12300000
123100         WHEN SQLCODE = +100                                      12310000
123200             MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1               12320000
123300             MOVE PC-INVALID-BEGDTE-MSG TO AA-MESSAGE-2           12330000
123400             DISPLAY 'REQUEST BEGIN DATE = ' CC-RQST-BEGIN-DTE    12340000
123500             PERFORM Z998-GENERAL-ABEND                           12350000
123600         WHEN SQLWARN0 NOT = SPACES                               12360000
123700         WHEN SQLCODE  NOT = ZERO                                 12370000
123800             MOVE 'S800-GET-REQUESTED-CONTROLS'                   12380000
123900                                 TO AA-PARAGRAPH-NAME             12390000
124000             MOVE 'UNSUCCESSFUL SELECT '                          12400000
124100                                 TO AA-DB2-OPERATION              12410000
124200             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                12420000
124300             MOVE '       '      TO AA-DB2-TABLE-2                12430000
124400             MOVE '       '      TO AA-DB2-TABLE-3                12440000
124500             MOVE '       '      TO AA-DB2-TABLE-4                12450000
124600             MOVE '       '      TO AA-DB2-TABLE-5                12460000
124700             PERFORM Z999-DB2-ABEND                               12470000
124800     END-EVALUATE.                                                12480000
124900                                                                  12490000
125000** VALIDATE REQUESTED END DATE                                    12500000
125100                                                                  12510000
125200     EXEC SQL                                                     12520000
125300         SELECT FSCL_MN_NBR                                       12530000
125400              , FSCL_YR_NBR                                       12540000
125500              , FSCL_QTR_NBR                                      12550000
125600              , FSCL_MN_BEG_DTE                                   12560000
125700              , FSCL_MN_END_DTE                                   12570000
125800              , CAL_MN_NBR                                        12580000
125810              , (CASE CAL_MN_NBR                                  12581000
125820                 WHEN '01' THEN '1'                               12582000
125830                 WHEN '02' THEN '1'                               12583000
125840                 WHEN '03' THEN '1'                               12584000
125850                 WHEN '04' THEN '2'                               12585000
125860                 WHEN '05' THEN '2'                               12586000
125870                 WHEN '06' THEN '2'                               12587000
125880                 WHEN '07' THEN '3'                               12588000
125890                 WHEN '08' THEN '3'                               12589000
125891                 WHEN '09' THEN '3'                               12589100
125892                 WHEN '10' THEN '4'                               12589200
125893                 WHEN '11' THEN '4'                               12589300
125894                 WHEN '12' THEN '4'                               12589400
125895                 END)                                             12589500
125896              , (CASE CAL_MN_NBR                                  12589600
125897                 WHEN '01' THEN CHAR(INTEGER(FSCL_YR_NBR)+ 1)     12589700
125898                 ELSE FSCL_YR_NBR                                 12589800
125899                 END)                                             12589900
125900           INTO :DTATTR-FSCL-MN-NBR                               12590000
126000              , :DTATTR-FSCL-YR-NBR                               12600000
126100              , :PV-FSCL-QTR-NBR                                  12610000
126110              , :PV-FSCL-MN-BEG-DTE                               12611000
126120              , :DTATTR-FSCL-MN-END-DTE                           12612000
126130              , :PV-CAL-MN-NBR                                    12613000
126140              , :PV-CAL-QTR-NBR                                   12614000
126150              , :PV-CAL-YR-NBR                                    12615000
126160           FROM TDTATTR                                           12616000
126170          WHERE KY_DTE          = :CC-RQST-END-DTE                12617000
126180            AND FSCL_MN_END_DTE = :CC-RQST-END-DTE                12618000
126190     END-EXEC.                                                    12619000
126200                                                                  12620000
126300     EVALUATE TRUE                                                12630000
126400         WHEN SQLCODE = ZERO                                      12640000
126500           MOVE DTATTR-FSCL-MN-NBR     TO PV-MAX-PSTG-FMN-NBR     12650000
126600                                          PV-FSCL-MN-NBR          12660000
126700           MOVE DTATTR-FSCL-YR-NBR     TO PV-END-FSCL-YR-NBR      12670000
126800                                          PV-CURR-PSTG-FYR-NBR    12680000
126900                                          PV-FSCL-YR-NBR          12690000
127000           MOVE DTATTR-FSCL-MN-END-DTE TO PV-MAX-MOEND-DTE        12700000
127100                                          PV-FSCL-MN-END-DTE      12710000
127200           IF PV-END-FSCL-YR-NBR = PV-PSTG-FYR-NBR                12720000
127300              CONTINUE                                            12730000
127400           ELSE                                                   12740000
127500              MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1              12750000
127600              MOVE PC-INVALID-FYR-MSG TO AA-MESSAGE-2             12760000
127700              DISPLAY 'REQUEST BEGIN DATE = ' CC-RQST-BEGIN-DTE   12770000
127800                      'FISCAL YEAR = ' PV-PSTG-FYR-NBR            12780000
127900              DISPLAY 'REQUEST END DATE = ' CC-RQST-END-DTE       12790000
128000                      'FISCAL YEAR = ' PV-END-FSCL-YR-NBR         12800000
128100              PERFORM Z998-GENERAL-ABEND                          12810000
128200           END-IF                                                 12820000
128300         WHEN SQLCODE = +100                                      12830000
128400             MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1               12840000
128500             MOVE PC-INVALID-ENDDTE-MSG TO AA-MESSAGE-2           12850000
128600             DISPLAY 'REQUEST END DATE = ' CC-RQST-END-DTE        12860000
128700             PERFORM Z998-GENERAL-ABEND                           12870000
128800         WHEN SQLWARN0 NOT = SPACES                               12880000
128900         WHEN SQLCODE  NOT = ZERO                                 12890000
129000             MOVE 'S800-GET-REQUESTED-CONTROLS'                   12900000
129100                                 TO AA-PARAGRAPH-NAME             12910000
129200             MOVE 'UNSUCCESSFUL SECOND SELECT '                   12920000
129300                                 TO AA-DB2-OPERATION              12930000
129310             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                12931000
129320             MOVE '       '      TO AA-DB2-TABLE-2                12932000
129330             MOVE '       '      TO AA-DB2-TABLE-3                12933000
129340             MOVE '       '      TO AA-DB2-TABLE-4                12934000
129350             MOVE '       '      TO AA-DB2-TABLE-5                12935000
129360             PERFORM Z999-DB2-ABEND                               12936000
129370     END-EVALUATE.                                                12937000
129380 EJECT                                                            12938000
129381*----------------------------------------------------------------*12938100
129382*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE       12938200
129383*    AP CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR CALENDAR       12938300
129384*    EXTRACTS.                                                    12938400
129385*----------------------------------------------------------------*12938500
129386 S900-GET-CALENDAR-CONTROLS.                                      12938600
129387                                                                  12938700
129388     EXEC SQL                                                     12938800
129389         SELECT A.BTCH_PRC_DTE                                    12938900
129390              , A.PREV_WK_END_DTE                                 12939000
129391              , B.FSCL_YR_NBR                                     12939100
129392              , B.FSCL_QTR_NBR                                    12939200
129393              , B.CAL_MN_NBR                                      12939300
129394              , B.FSCL_MN_NBR                                     12939400
129395              , B.FSCL_MN_END_DTE                                 12939500
129396              , B.FSCL_MN_BEG_DTE                                 12939600
129397              , (CASE B.CAL_MN_NBR                                12939700
129398                 WHEN '01' THEN '1'                               12939800
129399                 WHEN '02' THEN '1'                               12939900
129400                 WHEN '03' THEN '1'                               12940000
129401                 WHEN '04' THEN '2'                               12940100
129402                 WHEN '05' THEN '2'                               12940200
129403                 WHEN '06' THEN '2'                               12940300
129404                 WHEN '07' THEN '3'                               12940400
129405                 WHEN '08' THEN '3'                               12940500
129406                 WHEN '09' THEN '3'                               12940600
129407                 WHEN '10' THEN '4'                               12940700
129408                 WHEN '11' THEN '4'                               12940800
129409                 WHEN '12' THEN '4'                               12940900
129410                 END)                                             12941000
129411              , (CASE B.CAL_MN_NBR                                12941100
129412                 WHEN '01' THEN CHAR(INTEGER(B.FSCL_YR_NBR)+ 1)   12941200
129413                 ELSE B.FSCL_YR_NBR                               12941300
129414                 END)                                             12941400
129415           INTO :APCNTL-BTCH-PRC-DTE                              12941500
129416              , :APCNTL-PREV-WK-END-DTE                           12941600
129417              , :DTATTR-FSCL-YR-NBR                               12941700
129418              , :DTATTR-FSCL-QTR-NBR                              12941800
129419              , :DTATTR-CAL-MN-NBR                                12941900
129420              , :DTATTR-FSCL-MN-NBR                               12942000
129421              , :DTATTR-FSCL-MN-END-DTE                           12942100
129422              , :EXTRACT-BEGIN-DTE                                12942200
129423              , :PV-CAL-QTR-NBR                                   12942300
129424              , :PV-CAL-YR-NBR                                    12942400
129425           FROM TAPCNTL  A                                        12942500
129426              , TDTATTR  B                                        12942600
129427          WHERE A.PREV_WK_END_DTE   = B.KY_DTE                    12942700
129428            AND A.MULT_PSTG_PER_IND = 'Y'                         12942800
129429     END-EXEC.                                                    12942900
129430                                                                  12943000
129431     EVALUATE TRUE                                                12943100
129432         WHEN SQLCODE = ZERO                                      12943200
129433             MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE      12943300
129434                                            PV-MAX-MOEND-DTE      12943400
129435                                            PV-FSCL-MN-END-DTE    12943500
129436             MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR   12943600
129437                                            PV-MAX-PSTG-FMN-NBR   12943700
129438                                            PV-FSCL-MN-NBR        12943800
129439             MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR       12943900
129440                                            PV-FYR-NBR-NUM        12944000
129441                                            PV-FSCL-YR-NBR        12944100
129442             COMPUTE PV-FYR-NBR-NUM      =  PV-FYR-NBR-NUM - 1    12944200
129443             MOVE DTATTR-FSCL-QTR-NBR    TO PV-FSCL-QTR-NBR       12944300
129444             MOVE DTATTR-CAL-MN-NBR      TO PV-CAL-MN-NBR         12944400
129445             MOVE EXTRACT-BEGIN-DTE      TO PV-FSCL-MN-BEG-DTE    12944500
129446                                                                  12944600
129447         WHEN SQLWARN0 NOT = SPACES                               12944700
129448         WHEN SQLCODE  NOT = ZERO                                 12944800
129449             MOVE 'S900-GET-CALENDAR-CONTROLS '                   12944900
129450                                 TO AA-PARAGRAPH-NAME             12945000
129451             MOVE 'UNSUCCESSFUL SELECT '                          12945100
129452                                 TO AA-DB2-OPERATION              12945200
129453             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                12945300
129454             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-2                12945400
129455             MOVE '       '      TO AA-DB2-TABLE-3                12945500
129456             MOVE '       '      TO AA-DB2-TABLE-4                12945600
129457             MOVE '       '      TO AA-DB2-TABLE-5                12945700
129458             PERFORM Z999-DB2-ABEND                               12945800
129459     END-EVALUATE.                                                12945900
129460                                                                  12946000
129461     IF  CC-QUARTERLY                                             12946100
129462         EVALUATE TRUE                                            12946200
129463         WHEN PV-CAL-QTR-NBR = '1'                                12946300
129464             MOVE '01'                TO PV-MIN-CAL-MN-NBR        12946400
129465             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12946500
129466             MOVE '12'                TO PV-PREVYR-FMN-NBR        12946600
129467             MOVE DTATTR-FSCL-YR-NBR  TO PV-CURR-PSTG-FYR-NBR     12946700
129468             MOVE PV-FYR-NBR-NUM      TO PV-PREV-PSTG-FYR-NBR     12946800
129469         WHEN PV-CAL-QTR-NBR = '2'                                12946900
129470             MOVE '04'                TO PV-MIN-CAL-MN-NBR        12947000
129480             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12948000
129490             MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR        12949000
129500             MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR     12950000
129501                                         PV-CURR-PSTG-FYR-NBR     12950100
129502         WHEN PV-CAL-QTR-NBR = '3'                                12950200
129503             MOVE '07'                TO PV-MIN-CAL-MN-NBR        12950300
129504             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12950400
129505             MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR        12950500
129506             MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR     12950600
129507                                         PV-CURR-PSTG-FYR-NBR     12950700
129508         WHEN PV-CAL-QTR-NBR = '4'                                12950800
129509             MOVE '10'                TO PV-MIN-CAL-MN-NBR        12950900
129510             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12951000
129511             MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR        12951100
129512             MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR     12951200
129513                                         PV-CURR-PSTG-FYR-NBR     12951300
129514         END-EVALUATE                                             12951400
129515     ELSE                                                         12951500
129516         IF CC-SEMI-ANNUAL                                        12951600
129517             EVALUATE TRUE                                        12951700
129518             WHEN PV-CAL-QTR-NBR = '1'                            12951800
129519               OR PV-CAL-QTR-NBR = '2'                            12951900
129520                 MOVE '01'                TO PV-MIN-CAL-MN-NBR    12952000
129521                 MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR    12952100
129522                 MOVE '12'                TO PV-PREVYR-FMN-NBR    12952200
129523                 MOVE DTATTR-FSCL-YR-NBR  TO PV-CURR-PSTG-FYR-NBR 12952300
129524                 MOVE PV-FYR-NBR-NUM      TO PV-PREV-PSTG-FYR-NBR 12952400
129525             WHEN PV-CAL-QTR-NBR = '3'                            12952500
129526               OR PV-CAL-QTR-NBR = '4'                            12952600
129527                 MOVE '07'                TO PV-MIN-CAL-MN-NBR    12952700
129528                 MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR    12952800
129529                 MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR    12952900
129530                 MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR 12953000
129531                                             PV-CURR-PSTG-FYR-NBR 12953100
129532             END-EVALUATE                                         12953200
129533         ELSE                                                     12953300
129534             MOVE '01'                    TO PV-MIN-CAL-MN-NBR    12953400
129535             MOVE DTATTR-CAL-MN-NBR       TO PV-MAX-CAL-MN-NBR    12953500
129536             MOVE '12'                    TO PV-PREVYR-FMN-NBR    12953600
129537             MOVE DTATTR-FSCL-YR-NBR      TO PV-CURR-PSTG-FYR-NBR 12953700
129538             MOVE PV-FYR-NBR-NUM          TO PV-PREV-PSTG-FYR-NBR 12953800
129539         END-IF                                                   12953900
129540     END-IF.                                                      12954000
129541                                                                  12954100
129542     IF  DTATTR-CAL-MN-NBR = '01'                                 12954200
129543         CONTINUE                                                 12954300
129544     ELSE                                                         12954400
129545         EXEC SQL                                                 12954500
129546             SELECT MIN(C.FSCL_MN_NBR)                            12954600
129547                  , MIN(C.FSCL_MN_END_DTE)                        12954700
129548                  , MAX(C.FSCL_MN_END_DTE)                        12954800
129549                  , MIN(C.FSCL_MN_BEG_DTE)                        12954900
129550               INTO :PV-MIN-PSTG-FMN-NBR                          12955000
129551                  , :PV-MIN-MOEND-DTE                             12955100
129552                  , :PV-MAX-MOEND-DTE                             12955200
129553                  , :EXTRACT-BEGIN-DTE                            12955300
129554               FROM TDTATTR  C                                    12955400
129555              WHERE C.CAL_MN_NBR      BETWEEN :PV-MIN-CAL-MN-NBR  12955500
129556                                          AND :PV-MAX-CAL-MN-NBR  12955600
129557                AND CHAR(YEAR(KY_DTE)) = :DTATTR-FSCL-YR-NBR      12955700
129558                AND C.FSCL_MN_END_DTE <= :APCNTL-PREV-WK-END-DTE  12955800
129559         END-EXEC                                                 12955900
129560         EVALUATE TRUE                                            12956000
129561             WHEN SQLCODE = ZERO                                  12956100
129562                  CONTINUE                                        12956200
129563             WHEN SQLWARN0 NOT = SPACES                           12956300
129564             WHEN SQLCODE  NOT = ZERO                             12956400
129565                 MOVE 'S900-GET-CALENDAR-CONTROLS '               12956500
129566                                     TO AA-PARAGRAPH-NAME         12956600
129567                 MOVE 'UNSUCCESSFUL SELECT NUMBER TWO'            12956700
129568                                     TO AA-DB2-OPERATION          12956800
129569                 MOVE 'TDTATTR'      TO AA-DB2-TABLE-1            12956900
129570                 MOVE '       '      TO AA-DB2-TABLE-2            12957000
129571                 MOVE '       '      TO AA-DB2-TABLE-3            12957100
129572                 MOVE '       '      TO AA-DB2-TABLE-4            12957200
129573                 MOVE '       '      TO AA-DB2-TABLE-5            12957300
129574                 PERFORM Z999-DB2-ABEND                           12957400
129575         END-EVALUATE                                             12957500
129576     END-IF.                                                      12957600
129577                                                                  12957700
129578                                                                  12957800
129579*----------------------------------------------------------------*12957900
129580*    WRITES RECORDS TO THE EXTRACT FILE.                         *12958000
129590*----------------------------------------------------------------*12959000
129600 W100-WRITE-EXTRACT-RECORD.                                       12960000
129700                                                                  12970000
129800     WRITE EXTRACT-RECORD FROM AP081-VNDAGR-EXTRACT.              12980000
129900     ADD 1 TO PV-EXTRACT-COUNT.                                   12990000
130000                                                                  13000000
130100                                                                  13010000
130200*----------------------------------------------------------------*13020000
130300*    WRITES RECORD TO THE EXTRACT DATES CONTROL FILE.            *13030000
130400*----------------------------------------------------------------*13040000
130500 W200-WRITE-DATES-RECORD.                                         13050000
130600                                                                  13060000
130700     WRITE DATES-USED-RECORD FROM EXTRACT-DATES-RECORD.           13070000
130800                                                                  13080000
130900                                                                  13090000
131000*---------------------------------------------------------------- 13100000
131100*    OPEN ACTIVITY_CSR CURSOR                                     13110000
131200*---------------------------------------------------------------- 13120000
131300 X100-OPEN-ACTIVITY-CSR.                                          13130000
131400                                                                  13140000
131500     EXEC SQL                                                     13150000
131600         OPEN ACTIVITY_CSR                                        13160000
131700     END-EXEC.                                                    13170000
131800                                                                  13180000
131900     EVALUATE TRUE                                                13190000
132000         WHEN SQLCODE = ZERO                                      13200000
132100             CONTINUE                                             13210000
132200         WHEN SQLWARN0 NOT = SPACES                               13220000
132300         WHEN SQLCODE  NOT = ZERO                                 13230000
132400             MOVE 'X100-OPEN-ACTIVITY-CSR'                        13240000
132500                                 TO AA-PARAGRAPH-NAME             13250000
132600             MOVE 'UNSUCCESSFUL OPEN ON ACTIVITY_CSR'             13260000
132700                                 TO AA-DB2-OPERATION              13270000
132800             MOVE 'TVADPT '      TO AA-DB2-TABLE-1                13280000
132900             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                13290000
133000             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                13300000
133100             MOVE 'TADJRNL'      TO AA-DB2-TABLE-4                13310000
133200             MOVE '       '      TO AA-DB2-TABLE-5                13320000
133300             PERFORM Z999-DB2-ABEND                               13330000
133400     END-EVALUATE.                                                13340000
133500                                                                  13350000
133600                                                                  13360000
133700*---------------------------------------------------------------- 13370000
133800*    CLOSE THE ACTIVITY_CSR CURSOR                                13380000
133900*---------------------------------------------------------------- 13390000
134000 X200-CLOSE-ACTIVITY-CSR.                                         13400000
134100                                                                  13410000
134200     EXEC SQL                                                     13420000
134300         CLOSE ACTIVITY_CSR                                       13430000
134400     END-EXEC.                                                    13440000
134500                                                                  13450000
134600     EVALUATE TRUE                                                13460000
134700         WHEN SQLCODE = ZERO                                      13470000
134800             CONTINUE                                             13480000
134900                                                                  13490000
135000         WHEN SQLWARN0 NOT = SPACES                               13500000
135100         WHEN SQLCODE  NOT = ZERO                                 13510000
135200             MOVE 'X200-CLOSE-ACTIVITY-CSR'                       13520000
135300                                 TO AA-PARAGRAPH-NAME             13530000
135400             MOVE 'UNSUCCESSFUL CLOSE ON ACTIVITY_CSR'            13540000
135500                                 TO AA-DB2-OPERATION              13550000
135600             MOVE 'TVADPT '      TO AA-DB2-TABLE-1                13560000
135700             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                13570000
135800             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                13580000
135900             MOVE 'TADJRNL'      TO AA-DB2-TABLE-4                13590000
136000             MOVE '       '      TO AA-DB2-TABLE-5                13600000
136100             PERFORM Z999-DB2-ABEND                               13610000
136200       END-EVALUATE.                                              13620000
136300                                                                  13630000
136400                                                                  13640000
136500*---------------------------------------------------------------- 13650000
136600*    OPEN ADJUSTMENT_CSR CURSOR                                   13660000
136700*---------------------------------------------------------------- 13670000
136800 X300-OPEN-ADJUSTMENT-CSR.                                        13680000
136900                                                                  13690000
137000     EXEC SQL                                                     13700000
137100         OPEN ADJUSTMENT_CSR                                      13710000
137200     END-EXEC.                                                    13720000
137300                                                                  13730000
137400     EVALUATE TRUE                                                13740000
137500         WHEN SQLCODE = ZERO                                      13750000
137600             CONTINUE                                             13760000
137700         WHEN SQLWARN0 NOT = SPACES                               13770000
137800         WHEN SQLCODE  NOT = ZERO                                 13780000
137900             MOVE 'X300-OPEN-ADJUSTMENT-CSR'                      13790000
138000                                 TO AA-PARAGRAPH-NAME             13800000
138100             MOVE 'UNSUCCESSFUL OPEN ON ADJUSTMENT_CSR'           13810000
138200                                 TO AA-DB2-OPERATION              13820000
138300             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                13830000
138400                     ' HOLD DEPT = '  HOLD-DEPT-NBR               13840000
138500             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                13850000
138600             MOVE '       '      TO AA-DB2-TABLE-2                13860000
138700             MOVE '       '      TO AA-DB2-TABLE-3                13870000
138800             MOVE '       '      TO AA-DB2-TABLE-4                13880000
138900             MOVE '       '      TO AA-DB2-TABLE-5                13890000
139000             PERFORM Z999-DB2-ABEND                               13900000
139100     END-EVALUATE.                                                13910000
139200                                                                  13920000
139300                                                                  13930000
139400*---------------------------------------------------------------- 13940000
139500*    CLOSE THE ADJUSTMENT_CSR CURSOR                              13950000
139600*---------------------------------------------------------------- 13960000
139700 X400-CLOSE-ADJUSTMENT-CSR.                                       13970000
139800                                                                  13980000
139900     EXEC SQL                                                     13990000
140000         CLOSE ADJUSTMENT_CSR                                     14000000
140100     END-EXEC.                                                    14010000
140200                                                                  14020000
140300     EVALUATE TRUE                                                14030000
140400         WHEN SQLCODE = ZERO                                      14040000
140500             CONTINUE                                             14050000
140600                                                                  14060000
140700         WHEN SQLWARN0 NOT = SPACES                               14070000
140800         WHEN SQLCODE  NOT = ZERO                                 14080000
140900             MOVE 'X400-CLOSE-ADJUSTMENT-CSR'                     14090000
141000                                 TO AA-PARAGRAPH-NAME             14100000
141100             MOVE 'UNSUCCESSFUL CLOSE ON ADJUSTMENT_CSR'          14110000
141200                                 TO AA-DB2-OPERATION              14120000
141300             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                14130000
141400             MOVE '       '      TO AA-DB2-TABLE-2                14140000
141500             MOVE '       '      TO AA-DB2-TABLE-3                14150000
141600             MOVE '       '      TO AA-DB2-TABLE-4                14160000
141700             MOVE '       '      TO AA-DB2-TABLE-5                14170000
141800             PERFORM Z999-DB2-ABEND                               14180000
141900       END-EVALUATE.                                              14190000
142000                                                                  14200000
142100*---------------------------------------------------------------- 14210000
142200*    OPEN AGREEMENT_CSR CURSOR                                    14220000
142300*---------------------------------------------------------------- 14230000
142400 X500-OPEN-AGREEMENT-CSR.                                         14240000
142500                                                                  14250000
142600     EXEC SQL                                                     14260000
142700         OPEN AGREEMENT_CSR                                       14270000
142800     END-EXEC.                                                    14280000
142900                                                                  14290000
143000     EVALUATE TRUE                                                14300000
143100         WHEN SQLCODE = ZERO                                      14310000
143200             CONTINUE                                             14320000
143300         WHEN SQLWARN0 NOT = SPACES                               14330000
143400         WHEN SQLCODE  NOT = ZERO                                 14340000
143500             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                14350000
143600                     ' HOLD DEPT = '  HOLD-DEPT-NBR               14360000
143700             MOVE 'X500-OPEN-AGREEMENT-CSR'                       14370000
143800                                 TO AA-PARAGRAPH-NAME             14380000
143900             MOVE 'UNSUCCESSFUL OPEN ON AGREEMENT_CSR'            14390000
144000                                 TO AA-DB2-OPERATION              14400000
144100             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                14410000
144200             MOVE '       '      TO AA-DB2-TABLE-2                14420000
144300             MOVE '       '      TO AA-DB2-TABLE-3                14430000
144400             MOVE '       '      TO AA-DB2-TABLE-4                14440000
144500             MOVE '       '      TO AA-DB2-TABLE-5                14450000
144600             PERFORM Z999-DB2-ABEND                               14460000
144700     END-EVALUATE.                                                14470000
144800                                                                  14480000
144900                                                                  14490000
145000*---------------------------------------------------------------- 14500000
145100*    CLOSE THE AGREEMENT_CSR CURSOR                               14510000
145200*---------------------------------------------------------------- 14520000
145300 X600-CLOSE-AGREEMENT-CSR.                                        14530000
145400                                                                  14540000
145500     EXEC SQL                                                     14550000
145600         CLOSE AGREEMENT_CSR                                      14560000
145700     END-EXEC.                                                    14570000
145800                                                                  14580000
145900     EVALUATE TRUE                                                14590000
146000         WHEN SQLCODE = ZERO                                      14600000
146100             CONTINUE                                             14610000
146200                                                                  14620000
146300         WHEN SQLWARN0 NOT = SPACES                               14630000
146400         WHEN SQLCODE  NOT = ZERO                                 14640000
146500             MOVE 'X600-CLOSE-AGREEMENT-CSR'                      14650000
146600                                 TO AA-PARAGRAPH-NAME             14660000
146700             MOVE 'UNSUCCESSFUL CLOSE ON AGREEMENT_CSR'           14670000
146800                                 TO AA-DB2-OPERATION              14680000
146900             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                14690000
147000             MOVE '       '      TO AA-DB2-TABLE-2                14700000
147100             MOVE '       '      TO AA-DB2-TABLE-3                14710000
147200             MOVE '       '      TO AA-DB2-TABLE-4                14720000
147300             MOVE '       '      TO AA-DB2-TABLE-5                14730000
147400             PERFORM Z999-DB2-ABEND                               14740000
147500       END-EVALUATE.                                              14750000
147600                                                                  14760000
147836                                                                  14783600
147837 Z998-GENERAL-ABEND.                                              14783700
147838*----------------------------------------------------------------*14783800
147839*    ABEND ROUTINE                                               *14783900
147840*----------------------------------------------------------------*14784000
147850                                                                  14785000
147860     CLOSE EXTRACT-FILE.                                          14786000
147870                                                                  14787000
147880     DISPLAY AA-ABEND-LIT.                                        14788000
147890     DISPLAY AA-PROGRAM-LIT.                                      14789000
147900     DISPLAY AA-PARAGRAPH-LIT.                                    14790000
148000     DISPLAY AA-MESSAGE-LINE-1.                                   14800000
148100     DISPLAY AA-MESSAGE-LINE-2.                                   14810000
148200     CALL 'ILBOABN0' USING ABEND-CODE.                            14820000
148300                                                                  14830000
148400*----------------------------------------------------------------*14840000
148500*    DB2 ABEND ROUTINE                                           *14850000
148600*----------------------------------------------------------------*14860000
148700 Z999-DB2-ABEND.                                                  14870000
148800                                                                  14880000
148900     CLOSE EXTRACT-FILE.                                          14890000
149000                                                                  14900000
149100     DISPLAY AA-ABEND-LIT.                                        14910000
149200     DISPLAY AA-MESSAGE-LINE-1.                                   14920000
149300     DISPLAY AA-MESSAGE-LINE-2.                                   14930000
149400     DISPLAY AA-DB2-ERROR-LIT.                                    14940000
149500     DISPLAY AA-PROGRAM-LIT.                                      14950000
149600     DISPLAY AA-PARAGRAPH-LIT.                                    14960000
149700     DISPLAY AA-DB2-OPERATION-LIT.                                14970000
149800     DISPLAY AA-DB2-TABLE-1.                                      14980000
149900     DISPLAY AA-DB2-TABLE-2.                                      14990000
150000     DISPLAY AA-DB2-TABLE-3.                                      15000000
150100     DISPLAY AA-DB2-TABLE-4.                                      15010000
150200     DISPLAY AA-DB2-TABLE-5.                                      15020000
150300*    DISPLAY AA-DB2-TABLE-6.                                      15030000
150400     SET AC-DB2-ERROR TO TRUE.                                    15040000
150500                                                                  15050000
150600     COPY DPPD004.                                                15060000
150700                                                                  15070000
150800     CALL 'ILBOABN0' USING ABEND-CODE.                            15080000
