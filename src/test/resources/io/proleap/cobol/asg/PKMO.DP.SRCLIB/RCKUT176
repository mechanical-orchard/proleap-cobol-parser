000100 IDENTIFICATION DIVISION.                                         00010019
000200 PROGRAM-ID.         RCKUT176.                                    00020019
000300 AUTHOR.             German Banda.                                00030019
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040019
000500 DATE-WRITTEN.       May, 2021                                    00050019
000510******************************************************************00051019
000520******************************************************************00052019
000530*        Build Sku Sort Detail Information XML                    00053019
000540* This program will take in a Sku Sort PO informaton and generate 00054019
000550* xml that will be MFT'd to DC server                             00055019
000560******************************************************************00056019
000570*  CHANGE LOG                                                     00057019
000580*  DATE       CHANGED BY      DESC                                00058019
000590*  ---------- -------------   ------------------------------------00059019
000600*  07/01/2021 German Banda    Initial implementation.             00060019
000700*                                                                 00070019
000800******************************************************************00080019
000900******************************************************************00090019
001000 ENVIRONMENT DIVISION.                                            00100019
001100 CONFIGURATION SECTION.                                           00110019
001200 SOURCE-COMPUTER.    IBM-3090.                                    00120019
001300 OBJECT-COMPUTER.    IBM-3090.                                    00130019
001400                                                                  00140019
001500 INPUT-OUTPUT SECTION.                                            00150019
001600 FILE-CONTROL.                                                    00160019
001700                                                                  00170019
001800     SELECT SKU-SORT-FILE-IN                                      00180019
001900         ASSIGN TO INP01.                                         00190019
002000                                                                  00200019
002100     SELECT VARIABLE-FILE-01                                      00210019
002200         ASSIGN TO OUT01.                                         00220019
002300                                                                  00230019
002400******************************************************************00240019
002500 DATA DIVISION.                                                   00250019
002600 FILE SECTION.                                                    00260019
002700                                                                  00270019
002800 FD  SKU-SORT-FILE-IN                                             00280019
002900     RECORDING MODE IS F                                          00290019
003000     LABEL RECORDS ARE STANDARD                                   00300019
003100     BLOCK CONTAINS 0 RECORDS.                                    00310019
003110                                                                  00311019
003120 01  SK-SORT-RECORD-IN                  PIC  X(100).              00312019
003130                                                                  00313019
003140 FD  VARIABLE-FILE-01                                             00314019
003141     RECORDING MODE IS V                                          00314119
003142     RECORD IS VARYING IN SIZE                                    00314219
003143     FROM 1 TO 32000 CHARACTERS                                   00314319
003144     DEPENDING ON PV-BYTE-COUNT                                   00314419
003145     LABEL RECORDS ARE STANDARD                                   00314519
003146     DATA RECORD IS VARIABLE-RECORD-01.                           00314619
003147                                                                  00314719
003148 01  VARIABLE-RECORD-01.                                          00314819
003149     05 VARIABLE-BYTE              PIC X(01)                      00314919
003150                                   OCCURS 1 TO 32000 TIMES        00315019
003151                                   DEPENDING ON PV-BYTE-COUNT.    00315119
003152                                                                  00315219
003153******************************************************************00315319
003154 WORKING-STORAGE SECTION.                                         00315419
003155******************************************************************00315519
003156 01  PS-PROGRAM-SWITCHES.                                         00315619
003157     05  PS-END-OF-SKU-SORT-REC      PIC X(01) VALUE 'N'.         00315719
003158         88  PS-END-OF-SKU-SORT-REC-Y          VALUE 'Y'.         00315819
003159         88  PS-END-OF-SKU-SORT-REC-N          VALUE 'N'.         00315919
003160     05  PS-DC-CHANGE-SW             PIC X(01) VALUE SPACES.      00316019
003170         88  PS-DC-CHANGE-YES                  VALUE 'Y'.         00317019
003180         88  PS-DC-CHANGE-NO                   VALUE 'N'.         00318019
003190     05  PS-PO-CHANGE-SW             PIC X(01) VALUE SPACES.      00319019
003200         88  PS-PO-CHANGE-YES                  VALUE 'Y'.         00320019
003300         88  PS-PO-CHANGE-NO                   VALUE 'N'.         00330019
003400     05  PS-PO-HEADER-TAG-SW         PIC X(01) VALUE SPACES.      00340019
003500         88  PS-PO-HEADER-WRITN-YES            VALUE 'Y'.         00350019
003510         88  PS-PO-HEADER-WRITN-NO             VALUE 'N'.         00351019
003520                                                                  00352019
003530                                                                  00353019
003540 01 PV-PROGRAM-VARIABLES.                                         00354019
003550    05  PV-BYTE-COUNT              PIC 9(05) VALUE ZERO.          00355019
003560    05  PV-SPACE                   PIC X(01).                     00356019
003570                                                                  00357019
003580    05  PV-VARIABLE-OUTPUT-FIELD.                                 00358019
003590        10  PV-BIT-VARIABLE        PIC  X(01)                     00359019
003600                                   VALUE SPACES                   00360019
003700                                   OCCURS 32000 TIMES             00370019
003800                                   INDEXED BY                     00380019
003900                                       PV-BIT-IDX                 00390019
004000                                       PV-STR-IDX                 00400019
004100                                       PV-EOF-IDX.                00410019
004110*                                                                 00411019
004120     05  PV-UPC-NBR-X                PIC  X(15).                  00412019
004130     05  PV-PO-NUMBER                PIC S9(09)  VALUE 0 COMP.    00413019
004131     05  PV-PO-NUMBER-HLD            PIC S9(09)  VALUE 0 COMP.    00413119
004132     05  PV-PO-VEND                  PIC S9(09)  VALUE 0 COMP.    00413219
004133     05  PV-SEQ-NUMBER               PIC S9(04) VALUE 0 COMP.     00413319
004134     05  PV-SKU-NBR                  PIC S9(08) VALUE 0 COMP.     00413419
004135     05  PV-DC-NUMBER                PIC S9(04) VALUE 0 COMP.     00413519
004136     05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.      00413619
004137     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            00413719
004138     05  PV-XML-LENGTH-X             PIC 9(9)    COMP.            00413819
004139     05  PV-XML-LENGTH               PIC 9(9)    COMP.            00413919
004140     05  PV-XML-LENGTH-NEW           PIC 9(9)    COMP.            00414038
004141     05  PV-XML-LENGTH-BEG           PIC 9(9)    COMP.            00414152
004142     05  PV-XML-LENGTH-END           PIC 9(9)    COMP.            00414252
004143     05  PV-LAST-50-BYTES            PIC x(99).                   00414352
004144     05  PV-CHAR-COUNT               PIC S9(04)  VALUE ZEROS.     00414452
004145     05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                   00414552
004146     05  PV-MSGBUFFER-1.                                          00414652
004147         10  PV-MSGBUFFER-BANNER     PIC X(39) VALUE SPACES.      00414752
004148         10  PV-MSGBUFFER-ship       PIC X(10) VALUE SPACES.      00414852
004149         10  PV-MSGBUFFER-data-1     PIC X(99999) VALUE SPACES.   00414952
004150     05  PV-MSGBUFFER.                                            00415052
004151         10  PV-MSGBUFFER-DATA       PIC X(999999) VALUE SPACES.  00415152
004152                                                                  00415252
004153     05  PV-COUNTER                  PIC 9(05) VALUE ZEROES.      00415352
004154     05  PV-PO-COUNT                 PIC 9(05) VALUE ZEROES.      00415452
004155     05  PV-DC-COUNT                 PIC 9(05) VALUE ZEROES.      00415552
004156     05  PV-SKU-COUNT                PIC 9(05) VALUE ZEROES.      00415652
004157     05  PV-UPC-COUNT                PIC 9(05) VALUE ZEROES.      00415752
004158     05  PV-PO-DETAILS-GENERATED     PIC 9(05) VALUE ZEROES.      00415852
004159     05  PV-CURRENT-TIMESTAMP        PIC X(26) VALUE SPACES.      00415952
004160     05  PV-CURRENT-TMST REDEFINES PV-CURRENT-TIMESTAMP.          00416052
004161         10  PV-CURR-YYYY            PIC X(04).                   00416152
004162         10  FILLER                  PIC X(01).                   00416252
004163         10  PV-CURR-MM              PIC X(02).                   00416352
004170         10  FILLER                  PIC X(01).                   00417019
004180         10  PV-CURR-DD              PIC X(02).                   00418019
004190         10  FILLER                  PIC X(01).                   00419019
004200         10  PV-CURR-HH              PIC X(02).                   00420019
004300         10  FILLER                  PIC X(01).                   00430019
004310         10  PV-CURR-MI              PIC X(02).                   00431019
004320         10  FILLER                  PIC X(01).                   00432019
004330         10  PV-CURR-SS              PIC X(02).                   00433019
004340         10  FILLER                  PIC X(07).                   00434019
004350     05  PV-XML-DATE-TIME.                                        00435019
004360         10  PV-XML-YYYY             PIC X(04) VALUE SPACES.      00436019
004370         10  PV-XML-MM               PIC X(02) VALUE SPACES.      00437019
004380         10  PV-XML-DD               PIC X(02) VALUE SPACES.      00438019
004390         10  PV-XML-HH               PIC X(02) VALUE SPACES.      00439019
004400         10  PV-XML-MI               PIC X(02) VALUE SPACES.      00440019
004500         10  PV-XML-SS               PIC X(02) VALUE SPACES.      00450019
004510                                                                  00451019
004511     05  PV-COMBINED-PO-DC.                                       00451119
004512         10 PV-PO-NUMBER-CONC        PIC 9(09).                   00451219
004513         10 FILLER                   PIC X(01) VALUE '-'.         00451319
004514         10 PV-DC-NUMBER-CONC        PIC 9(04).                   00451419
004515                                                                  00451519
004516     05  PV-XML-BANNER               PIC X(39) VALUE              00451619
004517         '<?xml version="1.0" encoding="UTF-8" ?>'.               00451719
004518     05  PV-XML-SHIP                 PIC X(10) VALUE              00451819
004519         '<Shipment>'.                                            00451919
004520     05  PV-XML-SHIP-END             PIC X(11) VALUE              00452019
004521         '</Shipment>'.                                           00452119
004522     05  PV-XML-RDCDETAIL-END        PIC X(12) VALUE              00452219
004523         '</RDCDetail>'.                                          00452319
004524     05  PV-XML-poinfo-end           PIC X(09) VALUE              00452419
004525         '</POInfo>'.                                             00452519
004526     05  PV-XML-dc-details-end       PIC X(12) VALUE              00452619
004527         '</DCDetails>'.                                          00452719
004528     05  PV-HEADER-SOURCE            PIC X(18) VALUE              00452819
004529         'MAINFRAME'.                                             00452919
004530     05  PV-HEADER-DEST              PIC X(06) VALUE              00453019
004531         'RDCWMS'.                                                00453119
004532     05  PV-XML-RDC-HEADER.                                       00453219
004533         10 PV-XML-RDC               PIC X(11) VALUE              00453319
004534            '<RDCDetail>'.                                        00453419
004535     05  PV-XML-PO-HEADER.                                        00453519
004536         10 PV-XML-PO                PIC X(19) VALUE              00453619
004537            '<POInfo PoNumber= "'.                                00453719
004538         10 PV-XML-PO-nbr            PIC X(08).                   00453819
004539         10 PV-XML-PO-end-qte        PIC X(01)                    00453919
004540            value '"'.                                            00454019
004541         10 PV-XML-PO-Vend           PIC X(14) Value              00454119
004542            ' VendorPONbr="'.                                     00454219
004543         10 PV-XML-VEND-PO-NBR       PIC X(08).                   00454319
004544         10 PV-XML-PO-end-vend       PIC X(01)                    00454419
004545            value '"'.                                            00454519
004546         10 PV-XML-DEPT              PIC X(13) VALUE              00454619
004547            ' DeptNumber="'.                                      00454719
004548         10 PV-XML-DEPT-NBR          PIC 9(04).                   00454819
004549         10 PV-XML-close             PIC X(02) VALUE              00454919
004550            '">'.                                                 00455019
004551         10 PV-XML-dcdetail-open     PIC X(11) value              00455119
004552            '<DCDetails>'.                                        00455219
004553     05 Header.                                                   00455319
004554       10 HEADER_SOURCE                        PIC X(09).         00455419
004555       10 HEADER_DESTINATION                   PIC X(06).         00455519
004556       10 HEADER_CREATIONTIME                  PIC X(14).         00455619
004557 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.00455719
004558 01  PV-HOLD-MSGBUFFER.                                           00455819
004559     05  PV-MSGBUFFER-CHAR OCCURS    500000 TIMES                 00455919
004560                                     PIC X(01).                   00456019
004570 01  PV-ABEND-VARIABLES.                                          00457019
004580     05  PV-SQLCODE                  PIC S9(9).                   00458019
004590     05  PV-DISPLAY-SQLCODE          PIC -------999.              00459019
004600     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'RCKUT176'.  00460019
004700     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      00470019
004800     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      00480019
004810     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      00481019
004820     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      00482019
004830     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.00483019
004840                                                                  00484019
004850***************************************************************** 00485019
004860*    SAVE AREA FOR DETAIL INFORMATION TO CREATE XML             * 00486019
004870***************************************************************** 00487019
004880 01  PD-IDX                          PIC 9(03).                   00488019
004890 01  DC-IDX                          PIC 9(03).                   00489019
004900 01  SK-IDX                          PIC 9(03).                   00490019
005000 01  UP-IDX                          PIC 9(03).                   00500019
005100 01  PO-DTL                          PIC S9(09) COMP.             00510019
005200 01  DC-DTL                          PIC S9(09) COMP.             00520019
005300 01  SK-DTL                          PIC S9(09) COMP.             00530019
005400 01  UP-DTL                          PIC S9(09) COMP.             00540019
005500 01  PO-COUNT-NEW                    PIC 9(05)  VALUE 0.          00550019
005600 01  PD-MAX                          PIC 9(08)  VALUE 0.          00560019
005700 01  DC-MAX                          PIC 9(08)  VALUE 0.          00570019
005800 01  SK-MAX                          PIC 9(08)  VALUE 0.          00580019
005900 01  UP-MAX                          PIC 9(08)  VALUE 0.          00590019
006000 01  PD-DETAIL-AREA.                                              00600019
006100     05  PO-DTL-ENTRIES OCCURS 10  TIMES.                         00610019
006200       10  PD-PO-NBR               PIC 9(08) VALUE ZERO.          00620019
006300       10  PD-PO-VND               PIC 9(08) VALUE ZERO.          00630019
006400       10  PD-DEPT-NBR             PIC 9(04) VALUE ZERO.          00640019
006500       10 DC-DTL-ENTRIES OCCURS 9 TIMES.                          00650019
006600          15  PD-DC-NBR               PIC 9(4) VALUE ZERO.        00660019
006700          15  PD-SEQ-NBR              PIC X(4).                   00670019
006800          15 SK-DTL-ENTRIES OCCURS 300 TIMES.                     00680019
006900             20  PD-SKU-NBR           PIC 9(8) VALUE ZERO.        00690019
007000             20 UP-DTL-ENTRIES OCCURS 6 TIMES.                    00700019
007100                35 PD-UPC-NBR         PIC X(20) VALUE SPACE.      00710019
007200             20  PD-UNT-QTY           PIC 9(5)  VALUE ZERO.       00720019
007300***************************************************************** 00730019
007400*    RECORD PURPOSE: SKUSORT Extract (for XML conversion)         00740019
007500***************************************************************** 00750019
007600                                                                  00760019
007700 01  PV-XML                      PIC X(500000)    VALUE SPACES.   00770019
007800 01  PV-DISPLAY                  PIC X(132)      VALUE SPACES.    00780019
007900 01  XML-LENGTH                  PIC 9(9)    COMP.                00790019
008000                                                                  00800019
008100     COPY ISWS007.                                                00810019
008200     COPY ISWS008.                                                00820019
008300     COPY ISWS009.                                                00830019
008400                                                                  00840019
008500******************************************************************00850019
008600*  INPUT FILE                                                     00860019
008700******************************************************************00870019
008800     COPY RCRD104.                                                00880019
008900                                                                  00890019
009000******************************************************************00900019
009100*  OUTPUT FILE                                                    00910019
009200******************************************************************00920019
009300     COPY RCRD105.                                                00930019
009400                                                                  00940019
009500******************************************************************00950019
009600*  COMMUNICATIONS AREA FOR DB2                                    00960019
009700******************************************************************00970019
009800 01  PC-PROGRAM-CONSTANTS.                                        00980019
009900     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'RCKUT176'.  00990019
010000     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   01000019
010100     05  PC-READY                    PIC X(06) VALUE 'READY '.    01010019
010200     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    01020019
010300     05  PC-END-TAG                  PIC X(01) VALUE '>'.         01030019
010400*                                                                 01040019
010500*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       01050019
010600*                                                                 01060019
010700     COPY DPWS004.                                                01070019
010800                                                                  01080019
010900*                                                                 01090019
011000*                                                                 01100019
011100*  COMMUNICATION AREAS FOR DB2                                    01110019
011200*                                                                 01120019
011300     EXEC SQL                                                     01130019
011400         INCLUDE SQLCA                                            01140019
011500     END-EXEC.                                                    01150019
011600                                                                  01160019
011700****************************************************************  01170019
011800 PROCEDURE DIVISION.                                              01180019
011900*                                                                 01190019
012000 0000-MAINLINE.                                                   01200019
012100     DISPLAY '************ START OF RCKUT176 ***************'     01210019
012200                                                                  01220019
012300     MOVE ZEROES TO PV-COUNTER                                    01230019
012400                                                                  01240019
012500     PERFORM 1000-INITIALIZE.                                     01250019
012600                                                                  01260019
012700     IF PS-END-OF-SKU-SORT-REC-N                                  01270019
012800        PERFORM 1100-BUILD-XML-HEADER                             01280019
012900     END-IF                                                       01290019
013000                                                                  01300019
013100     PERFORM 2000-PROCESS-SKU-SORT-RECORDS                        01310019
013200       UNTIL PS-END-OF-SKU-SORT-REC-Y.                            01320019
013300                                                                  01330019
013400     IF PV-COUNTER > 0                                            01340019
013500        PERFORM 8900-WRITE-CLOSE-TAGS                             01350019
013600     END-IF                                                       01360019
013700                                                                  01370019
013800* END OF JOB ROUTINE.                                             01380019
013900     PERFORM 9000-EOJ-ROUTINE.                                    01390019
014000                                                                  01400019
014100     DISPLAY '************  END OF RCKUT176  ***************'     01410019
014200     STOP RUN.                                                    01420019
014300                                                                  01430019
014400******************************************************************01440019
014500*           INITIALIZATION                                        01450019
014600******************************************************************01460019
014700 1000-INITIALIZE.                                                 01470019
014800                                                                  01480019
014900     DISPLAY '1000-INITIALIZE'                                    01490019
015000     OPEN  INPUT  SKU-SORT-FILE-IN                                01500019
015100           OUTPUT VARIABLE-FILE-01.                               01510019
015200     SET PS-END-OF-SKU-SORT-REC-N TO TRUE.                        01520019
015300     PERFORM 8000-READ-INPUT-FILE.                                01530019
015400                                                                  01540019
015500******************************************************************01550019
015600*  BUILD AND WRITE XML Header                                     01560019
015700*   <?xml version="1.0" encoding="UTF-8"?>                        01570019
015800*   <Shipment>                                                    01580019
015900*   <Header>                                                      01590019
016000*       <HEADER_SOURCE>MAINFRAME</HEADER_SOURCE>                  01600019
016100*       <HEADER_DESTINATION>RDCWMS</HEADER_DESTINATION>           01610019
016200*       <HEADER_CREATIONTIME>yyyymmddhhmmss</HEADER_CREATIONTIME> 01620019
016300*   </Header>                                                     01630019
016400******************************************************************01640019
016500 1100-BUILD-XML-HEADER.                                           01650019
016600*    DISPLAY '1100-BUILD-XML-HEADER'                              01660019
016700                                                                  01670019
016800     INITIALIZE PV-PO-NUMBER                                      01680019
016900                PV-DC-NUMBER                                      01690019
017000                PV-SEQ-NUMBER                                     01700019
017100                PV-SKU-NBR.                                       01710019
017200                                                                  01720019
017300     MOVE +1   TO PV-PO-COUNT                                     01730019
017400     PERFORM 2100-BUILD-XML-TME.                                  01740019
017500     PERFORM 2300-MOVE-HEADER.                                    01750019
017600     PERFORM 3800-CREATE-HDR-MESSAGE.                             01760019
017700     MOVE SPACES                   TO VARIABLE-RECORD-01          01770019
017800                                                                  01780019
017900     MOVE PV-MSG-LENGTH            TO PV-BYTE-COUNT               01790019
018000     MOVE PV-MSGBUFFER-1           TO PV-VARIABLE-OUTPUT-FIELD    01800019
018100                                                                  01810019
018200     MOVE PV-VARIABLE-OUTPUT-FIELD TO VARIABLE-RECORD-01          01820019
018300     WRITE VARIABLE-RECORD-01.                                    01830019
018400**************************************************                01840019
018500* <RDCDetail>                                                     01850019
018600**************************************************                01860019
018700                                                                  01870019
018800     MOVE   11 TO   PV-MSG-LENGTH                                 01880019
018900     MOVE PV-XML-RDC-HEADER TO PV-MSGBUFFER                       01890019
019000                                                                  01900019
019100     PERFORM 6000-WRITE-VARIABLE-REC                              01910019
019200                                                                  01920019
019300     MOVE 0 TO PD-COUNT.                                          01930019
019400     MOVE 0 TO DC-COUNT.                                          01940019
019500     MOVE 0 TO SK-COUNT.                                          01950019
019600     MOVE 0 TO UP-COUNT.                                          01960019
019700     MOVE 0 TO PO-DTL.                                            01970019
019800     MOVE 0 TO DC-DTL.                                            01980019
019900     MOVE 0 TO SK-DTL.                                            01990019
020000     MOVE 0 TO UP-DTL.                                            02000019
020100                                                                  02010019
020200     PERFORM 3000-BUILD-PO-DETAIL                                 02020019
020300     PERFORM 3200-BUILD-DC-DETAIL                                 02030019
020400     PERFORM 3400-BUILD-SK-DETAIL                                 02040019
020401     PERFORM 3600-BUILD-UP-DETAIL                                 02040119
020402     PERFORM 8000-READ-INPUT-FILE.                                02040219
020403     MOVE RC104-KOHLS-ORD-NBR TO PV-PO-NUMBER                     02040319
020404     MOVE RC104-DC-NBR        TO PV-DC-NUMBER                     02040419
020405     MOVE RC104-SKU-NBR       TO PV-SKU-NBR.                      02040519
020406******************************************************************02040619
020407*     PROCESS SKU DETAILS                                         02040719
020408******************************************************************02040819
020409 2000-PROCESS-SKU-SORT-RECORDS.                                   02040919
020410                                                                  02041019
020411*    DISPLAY '2000-PROCESS-SKU-SORT-RECORDS'                      02041119
020412                                                                  02041219
020413     PERFORM 2020-FORMAT-INPUT.                                   02041319
020414                                                                  02041419
020415     PERFORM 8000-READ-INPUT-FILE.                                02041519
020416                                                                  02041619
020417     IF PS-END-OF-SKU-SORT-REC-Y and PV-COUNTER  > 0              02041719
020418         PERFORM 5000-PROCESS-FOR-XML                             02041819
020419     END-IF.                                                      02041919
020420                                                                  02042019
020421******************************************************************02042119
020430* PROCESS INPUT FILE, GENERATE XML AND WRITE TO FILE FOR EACH     02043019
020440* DC WITHIN A PURCHASE ORDER                                      02044019
020450* BUILD PO/DC/SKU/UPC DETAILS TO TABLE. ON CHANGE OF PO OR CHANGE 02045019
020460* OF DC WITHIN A PO, CALL 5000- PARA TO FORMAT THE DATA FOR THE   02046019
020470* PREVIOUS DC READ AND GENERATE THE XML.                          02047019
020480******************************************************************02048019
020490 2020-FORMAT-INPUT.                                               02049019
020500                                                                  02050019
020600     IF RC104-KOHLS-ORD-NBR = PV-PO-NUMBER                        02060019
020700        IF RC104-DC-NBR =   PV-DC-NUMBER                          02070019
020800           IF RC104-SKU-NBR  = PV-SKU-NBR                         02080019
020900              PERFORM 3600-BUILD-UP-DETAIL                        02090019
021000           ELSE                                                   02100019
021100              MOVE +0  TO UP-DTL                                  02110019
021200              MOVE +0  TO UP-COUNT                                02120019
021300              PERFORM 3400-BUILD-SK-DETAIL                        02130019
021400              PERFORM 3600-BUILD-UP-DETAIL                        02140019
021500              MOVE RC104-SKU-NBR  TO PV-SKU-NBR                   02150019
021600           END-IF                                                 02160019
021700        ELSE                                                      02170019
021710             IF PV-DC-COUNT = 0                                   02171019
021720                SET PS-PO-HEADER-WRITN-NO TO TRUE                 02172019
021730             END-IF                                               02173019
021740             ADD +1  TO PV-DC-COUNT                               02174019
021750             SET PS-DC-CHANGE-YES TO TRUE                         02175019
021760             PERFORM 5000-PROCESS-FOR-XML                         02176019
021770             PERFORM 3200-BUILD-DC-DETAIL                         02177019
021780             MOVE +0  TO SK-DTL                                   02178019
021790             MOVE +0  TO SK-COUNT                                 02179019
021800             MOVE +0  TO UP-DTL                                   02180019
021900             MOVE +0  TO UP-COUNT                                 02190019
022000             PERFORM 3400-BUILD-SK-DETAIL                         02200019
022100             PERFORM 3600-BUILD-UP-DETAIL                         02210019
022200             MOVE RC104-DC-NBR        TO PV-DC-NUMBER             02220019
022300             MOVE RC104-SEQ-NBR       TO PV-SEQ-NUMBER            02230019
022400             MOVE RC104-KOHLS-ORD-NBR TO PV-PO-NUMBER             02240019
022500             MOVE RC104-SKU-NBR       TO PV-SKU-NBR               02250019
022600        END-IF                                                    02260019
022700     ELSE                                                         02270019
022800             ADD +1   TO PV-PO-COUNT                              02280019
022900             IF RC104-DC-NBR =   PV-DC-NUMBER                     02290019
023000                CONTINUE                                          02300019
023100             ELSE                                                 02310019
023200                SET PS-PO-HEADER-WRITN-NO TO  TRUE                02320019
023300                SET PS-PO-CHANGE-NO  TO TRUE                      02330019
023400             END-IF                                               02340019
023500                                                                  02350019
023600             PERFORM 5000-PROCESS-FOR-XML                         02360019
023700             MOVE +0  TO PO-DTL                                   02370019
023800             MOVE +0  TO PD-COUNT                                 02380019
023900             MOVE +0  TO DC-DTL                                   02390019
024000             MOVE +0  TO DC-COUNT                                 02400019
024100             MOVE +0  TO SK-DTL                                   02410019
024200             MOVE +0  TO UP-DTL                                   02420019
024300             MOVE +0  TO UP-COUNT                                 02430019
024400             MOVE +0  TO PV-DC-COUNT                              02440019
024500        PERFORM 3000-BUILD-PO-DETAIL                              02450019
024600        PERFORM 3200-BUILD-DC-DETAIL                              02460019
024700        PERFORM 3400-BUILD-SK-DETAIL                              02470019
024710        PERFORM 3600-BUILD-UP-DETAIL                              02471019
024711        MOVE RC104-KOHLS-ORD-NBR TO PV-PO-NUMBER                  02471119
024712        MOVE RC104-DC-NBR        TO PV-DC-NUMBER                  02471219
024713        MOVE RC104-SEQ-NBR       TO PV-SEQ-NUMBER                 02471319
024714        MOVE RC104-SKU-NBR       TO PV-SKU-NBR                    02471419
024715     END-IF.                                                      02471519
024716                                                                  02471619
024717 2100-BUILD-XML-TME.                                              02471719
024718                                                                  02471819
024719     PERFORM 2200-GET-CURRENT-TIMESTAMP.                          02471919
024720                                                                  02472019
024730     MOVE PV-CURR-YYYY            TO  PV-XML-YYYY.                02473019
024740     MOVE PV-CURR-MM              TO  PV-XML-MM.                  02474019
024750     MOVE PV-CURR-DD              TO  PV-XML-DD.                  02475019
024760     MOVE PV-CURR-HH              TO  PV-XML-HH.                  02476019
024770     MOVE PV-CURR-MI              TO  PV-XML-MI.                  02477019
024780     MOVE PV-CURR-SS              TO  PV-XML-SS.                  02478019
024790                                                                  02479019
024800     MOVE PV-XML-DATE-TIME        TO  HEADER_CREATIONTIME.        02480019
024900                                                                  02490019
025000******************************************************************02500019
025100*  GET THE CURRENT TIMESTAMP FROM DB2                             02510019
025200******************************************************************02520019
025300 2200-GET-CURRENT-TIMESTAMP.                                      02530019
025400                                                                  02540019
025500     EXEC SQL                                                     02550019
025600          SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           02560019
025700     END-EXEC.                                                    02570019
025800                                                                  02580019
025900     IF SQLCODE = 0                                               02590019
026000         CONTINUE                                                 02600019
026100     ELSE                                                         02610019
026200         MOVE '2100-GET-CURRENT-TIMESTAMP' TO PV-ABEND-PARAGRAPH  02620019
026300         MOVE 'ERROR ON GET OF TIMESTAMP'  TO PV-ABEND-OPERATION  02630019
026400         PERFORM 9900-DB2-ABEND                                   02640019
026500     END-IF.                                                      02650019
026600******************************************************************02660019
026700*POPULATE HEADER FIELDS                                           02670019
026800******************************************************************02680019
026900 2300-MOVE-HEADER.                                                02690019
027000                                                                  02700019
027100     MOVE PV-HEADER-SOURCE        TO HEADER_SOURCE.               02710019
027200     MOVE PV-HEADER-DEST          TO HEADER_DESTINATION.          02720019
027300     MOVE PV-XML-DATE-TIME        TO HEADER_CREATIONTIME.         02730019
027400                                                                  02740019
027500                                                                  02750019
027600 3000-BUILD-PO-DETAIL.                                            02760019
027700                                                                  02770019
027800*    DISPLAY '3000-BUILD-PO-DETAIL'                               02780019
027900                                                                  02790019
028000     ADD 1 TO PO-DTL                                              02800019
028010              PD-COUNT.                                           02801019
028011                                                                  02801119
028012     MOVE RC104-KOHLS-ORD-NBR    TO PD-PO-NBR (PO-DTL).           02801219
028013     MOVE RC104-VENDR-ORD-NBR    TO PD-PO-VND (PO-DTL).           02801319
028014     MOVE RC104-DEPT-NBR         TO PD-DEPT-NBR (PO-DTL).         02801419
028015                                                                  02801519
028016 3100-MOVE-DETAIL.                                                02801619
028017                                                                  02801719
028018      MOVE PO-DTL TO PD-IDX.                                      02801819
028019                                                                  02801919
028020      MOVE PD-PO-NBR (PO-DTL)    TO PoNumber (PD-IDX).            02802019
028030      MOVE PD-PO-VND (PO-DTL)    TO VendorPONbr (PD-IDX).         02803019
028040      MOVE PD-DEPT-NBR (PO-DTL)  TO DeptNumber (PD-IDX).          02804019
028050                                                                  02805019
028060                                                                  02806019
028070 3200-BUILD-DC-DETAIL.                                            02807019
028080     ADD 1 TO DC-DTL                                              02808019
028090              DC-COUNT.                                           02809019
028100     MOVE RC104-DC-NBR           TO PD-DC-NBR (PO-DTL DC-DTL).    02810019
028200     MOVE RC104-SEQ-NBR          TO PD-SEQ-NBR(PO-DTL DC-DTL).    02820019
028300*                                                                 02830019
028400 3300-MOVE-DC-DETAIL.                                             02840019
028500     MOVE DC-DTL TO DC-IDX                                        02850019
028600                                                                  02860019
028700     MOVE PD-DC-NBR (PO-DTL DC-DTL)         TO                    02870019
028800          DcNumber  (PD-COUNT DC-IDX)                             02880019
028900     MOVE PD-SEQ-NBR (PO-DTL DC-DTL)       TO                     02890019
029000          DeliveryNbr (PD-COUNT DC-IDX).                          02900019
029100                                                                  02910019
029200 3400-BUILD-SK-DETAIL.                                            02920019
029300     ADD 1 TO SK-DTL                                              02930019
029400              SK-COUNT.                                           02940019
029500     MOVE RC104-SKU-NBR          TO PD-SKU-NBR                    02950019
029600                                    (PO-DTL DC-DTL SK-DTL ).      02960019
029700 3500-MOVE-SK-DETAIL.                                             02970019
029800     MOVE SK-DTL TO SK-IDX.                                       02980019
029900                                                                  02990019
030000     MOVE PD-SKU-NBR (PO-DTL DC-DTL SK-DTL )   TO                 03000019
030100          SKUNumber (PD-COUNT DC-COUNT  SK-IDX).                  03010019
030200                                                                  03020019
030300     MOVE PD-UNT-QTY (PO-DTL DC-DTL SK-DTL) TO                    03030019
030400          UnitQuantity (PD-COUNT DC-COUNT  SK-IDX).               03040019
030500*                                                                 03050019
030600 3600-BUILD-UP-DETAIL.                                            03060019
030700     ADD 1 TO UP-DTL                                              03070019
030800              UP-COUNT.                                           03080019
030900                                                                  03090019
031000     move  RC104-UPC-NBR         to PV-UPC-NBR-X                  03100019
031100     MOVE PV-UPC-NBR-X           TO PD-UPC-NBR                    03110019
031200                                    (PO-DTL DC-DTL SK-DTL UP-DTL).03120019
031300     MOVE RC104-SHIP-QTY         TO PD-UNT-QTY                    03130019
031400                                    (PO-DTL DC-DTL SK-DTL).       03140019
031500*                                                                 03150019
031600 3700-MOVE-UP-DETAIL.                                             03160019
031700     ADD 1 TO UP-COUNT.                                           03170019
031800                                                                  03180019
031900     MOVE PD-UPC-NBR (PO-DTL DC-DTL SK-DTL UP-DTL) TO             03190019
032000          UPCNumber (PD-COUNT DC-COUNT SK-COUNT UP-COUNT).        03200019
032100                                                                  03210019
032200 3800-CREATE-HDR-MESSAGE.                                         03220019
032300                                                                  03230019
032400     MOVE SPACES TO PV-XML.                                       03240019
032500                                                                  03250019
032600     XML GENERATE PV-XML                                          03260019
032700         FROM Header                                              03270019
032800         COUNT IN XML-LENGTH                                      03280019
032900         WITH ATTRIBUTES                                          03290019
033000         ON EXCEPTION                                             03300019
033100             DISPLAY Header ' PV=' PV-XML                         03310019
033200             PERFORM 4110-XML-ERROR                               03320019
033300         NOT ON EXCEPTION                                         03330019
033400             CONTINUE                                             03340019
033500     END-XML.                                                     03350019
033600                                                                  03360019
033700     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      03370019
033800     MOVE PV-XML-SHIP                TO PV-MSGBUFFER-ship.        03380019
033900     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      03390019
034000**   display pv-msgbuffer-banner.                                 03400019
034100***  display pv-msgbuffer-data-1                                  03410019
034200     display 'XML-LENGTH'  XML-LENGTH                             03420019
034300     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           03430019
034400                           + LENGTH OF PV-XML-BANNER              03440019
034500                           + LENGTH OF PV-XML-SHIP                03450019
034510     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    03451019
034520     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 03452019
034530                                                                  03453019
034540                                                                  03454019
034541 3900-CREATE-PO-HEADER.                                           03454119
034542     DISPLAY '3900-CREATE-PO-HEADER  '                            03454219
034543                                                                  03454319
034544     MOVE SPACES TO PV-XML.                                       03454419
034545                                                                  03454519
034546     XML GENERATE PV-XML                                          03454619
034547         FROM Header                                              03454719
034548         COUNT IN XML-LENGTH                                      03454819
034549         WITH ATTRIBUTES                                          03454919
034550         ON EXCEPTION                                             03455019
034551             DISPLAY Header ' PV=' PV-XML                         03455119
034552             PERFORM 4110-XML-ERROR                               03455219
034553         NOT ON EXCEPTION                                         03455319
034554             CONTINUE                                             03455419
034555     END-XML.                                                     03455519
034556                                                                  03455619
034557     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      03455719
034558     MOVE PV-XML-SHIP                TO PV-MSGBUFFER-ship.        03455819
034559     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      03455919
034560**   display pv-msgbuffer-banner.                                 03456019
034561***  display pv-msgbuffer-data-1                                  03456119
034562     display 'XML-LENGTH'  XML-LENGTH                             03456219
034563     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           03456319
034564                           + LENGTH OF PV-XML-BANNER              03456419
034565                           + LENGTH OF PV-XML-SHIP                03456519
034566     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    03456619
034567     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 03456719
034568                                                                  03456819
034569****************************************************************  03456919
034570* CREATE XML FOR RDC AND OUTPUT TO VB File                        03457019
034571****************************************************************  03457119
034572 4000-CREATE-MSGS.                                                03457219
034573                                                                  03457319
034574     PERFORM 4100-GENERATE-XML.                                   03457419
034575     ADD +1 TO PV-PO-DETAILS-GENERATED.                           03457519
034576                                                                  03457619
034577     MOVE SPACE                      TO PV-MSGBUFFER-BANNER.      03457719
034578     MOVE PV-XML(1:XML-LENGTH)       TO PV-MSGBUFFER-data.        03457819
034579**   display pv-msgbuffer-banner.                                 03457919
034580***  display pv-msgbuffer-data.                                   03458019
034581*    display 'XML-LENGTH'  XML-LENGTH                             03458119
034582     Move XML-LENGTH    to PV-MSG-LENGTH                          03458219
034583     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH ' '                03458319
034584                                 PV-COMBINED-PO-DC                03458419
034585     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 03458519
034586                                                                  03458619
034587                                                                  03458719
034588**********************************Detail  *********************   03458819
034589 4100-GENERATE-XML.                                               03458919
034590     DISPLAY '4100-GENERATE-XML'                                  03459019
034591                                                                  03459119
034592     MOVE SPACES TO PV-XML.                                       03459219
034593                                                                  03459319
034594     XML GENERATE PV-XML                                          03459419
034595         FROM DCLocationDetails (PD-IDX DC-IDX )                  03459523
034596         COUNT IN XML-LENGTH                                      03459619
034597         WITH ATTRIBUTES                                          03459719
034598         ON EXCEPTION                                             03459819
034599             DISPLAY DCLocationDetails (PD-IDX DC-IDX )           03459923
034600                                        ' PV=' PV-XML             03460019
034700             PERFORM 4110-XML-ERROR                               03470019
034800         NOT ON EXCEPTION                                         03480019
034900             CONTINUE                                             03490019
035000     END-XML.                                                     03500019
035100                                                                  03510019
035200**********************************Detail  *********************   03520019
035300***************************************************************   03530019
035400 4110-XML-ERROR.                                                  03540019
035500     DISPLAY '4110-XML-ERROR'                                     03550019
035600     DISPLAY 'XML-CODE' XML-CODE                                  03560019
035700     PERFORM 9000-EXPLAIN-XML-RESPONSE                            03570019
035800     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    03580019
035900                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           03590019
036000     END-PERFORM.                                                 03600019
036100     MOVE +4018         TO ABEND-CODE.                            03610019
036200     CALL 'ILBOABN0' USING ABEND-CODE.                            03620019
036300                                                                  03630019
036400     COPY ISPD007.                                                03640019
036500     COPY ISPD008.                                                03650019
036600     COPY ISPD009.                                                03660019
036700                                                                  03670019
036800***************************************************************   03680019
036900*  Load data to XML layout                                    *   03690019
037000***************************************************************   03700019
037100***************************************************************   03710019
037200 5000-PROCESS-FOR-XML.                                            03720019
037300                                                                  03730019
037400        MOVE PD-COUNT TO PD-MAX.                                  03740019
037500        MOVE DC-COUNT TO DC-MAX.                                  03750019
037600        MOVE SK-COUNT TO SK-MAX.                                  03760019
037610        MOVE +4 TO UP-COUNT                                       03761085
037700        MOVE UP-COUNT TO UP-MAX.                                  03770019
037800                                                                  03780019
037900        PERFORM VARYING PO-DTL FROM 1 BY 1                        03790019
038000                            UNTIL PO-DTL > PD-MAX                 03800019
038100            MOVE PO-DTL TO PD-IDX                                 03810019
038200                                                                  03820019
038300            MOVE PD-PO-NBR (PO-DTL)    TO PoNumber (PD-IDX)       03830019
038400                                          PV-PO-NUMBER-CONC       03840019
038500            MOVE PD-PO-VND (PO-DTL)    TO VendorPONbr (PD-IDX)    03850019
038600                                                                  03860019
038610            MOVE PD-DEPT-NBR (PO-DTL)  TO DeptNumber (PD-IDX)     03861019
038620                                                                  03862019
038630          PERFORM VARYING DC-DTL FROM 1 BY 1                      03863019
038640                            UNTIL DC-DTL > DC-MAX                 03864019
038650            MOVE DC-DTL TO DC-IDX                                 03865019
038660            MOVE PD-DC-NBR (PO-DTL DC-DTL)         TO             03866019
038670                 DcNumber  (PD-IDX DC-IDX)                        03867019
038680                 PV-DC-NUMBER-CONC                                03868019
038690            MOVE space                            TO              03869019
038700                 DeliveryNbr (PD-IDX DC-IDX)                      03870019
038800**          MOVE PD-SEQ-NBR (PO-DTL DC-DTL)       TO              03880019
038900**               DeliveryNbr (PD-IDX DC-IDX)                      03890019
039000                                                                  03900019
039100           PERFORM VARYING SK-DTL FROM 1 BY 1                     03910019
039200                              UNTIL SK-DTL > SK-MAX               03920019
039300              MOVE SK-DTL TO SK-IDX                               03930019
039400              MOVE PD-SKU-NBR (PO-DTL DC-DTL SK-DTL )   TO        03940019
039401                  SKUNumber (PD-IDX DC-IDX SK-IDX)                03940119
039402                                                                  03940219
039403              MOVE PD-UNT-QTY (PO-DTL DC-DTL SK-DTL) TO           03940319
039404                  UnitQuantity (PD-IDX DC-IDX SK-IDX)             03940419
039405                                                                  03940519
039406              PERFORM VARYING UP-DTL FROM 1 BY 1                  03940619
039407                                  UNTIL UP-DTL > UP-MAX           03940719
039408                 MOVE UP-DTL TO UP-IDX                            03940819
039409                 IF   PD-UPC-NBR (PO-DTL DC-DTL SK-DTL UP-DTL) =  03940986
039410                                          spaces                  03941020
039411                      MOVE 'X' TO                                 03941186
039412                          UPCNumber (PD-IDX DC-IDX SK-IDX UP-IDX )03941220
039413                 ELSE                                             03941386
039414                  MOVE PD-UPC-NBR (PO-DTL DC-DTL SK-DTL UP-DTL) TO03941486
039415                        UPCNumber (PD-IDX DC-IDX SK-IDX UP-IDX)   03941586
039416                 END-IF                                           03941686
039420              END-PERFORM                                         03942019
039430           END-PERFORM                                            03943019
039440          END-PERFORM                                             03944019
039450        END-PERFORM.                                              03945019
039460                                                                  03946019
039470        IF PV-DC-COUNT  =  0                                      03947019
039480           SET PS-PO-CHANGE-YES TO TRUE                           03948019
039490        END-IF                                                    03949019
039500        PERFORM 5010-FORMAT-TAGS                                  03950019
039510*                                                                 03951019
039520        MOVE PD-COUNT TO PO-DTL.                                  03952019
039530        MOVE 0 TO DC-COUNT                                        03953019
039540                  SK-COUNT                                        03954019
039550       MOVE 0 TO  DC-DTL.                                         03955019
039551                                                                  03955119
039552 5010-FORMAT-TAGS.                                                03955219
039553                                                                  03955319
039554        IF PS-PO-CHANGE-YES                                       03955419
039555           MOVE +0    TO PV-DC-COUNT                              03955519
039556           SET PS-PO-CHANGE-NO  TO TRUE                           03955619
039557           MOVE PD-PO-NBR (1)    TO PV-XML-PO-NBR                 03955719
039558           MOVE PD-PO-VND (1)    TO PV-XML-VEND-PO-NBR            03955819
039559           MOVE PD-DEPT-NBR (1)  TO PV-XML-DEPT-NBR               03955919
039560                                                                  03956019
039570           MOVE  100 TO   PV-MSG-LENGTH                           03957019
039571           MOVE PV-XML-PO-HEADER TO PV-MSGBUFFER                  03957119
039572                                                                  03957219
039573           PERFORM 6000-WRITE-VARIABLE-REC                        03957319
039574                                                                  03957419
039575           PERFORM 4000-CREATE-MSGS                               03957519
039576           PERFORM 6000-WRITE-VARIABLE-REC                        03957619
039577                                                                  03957719
039578           MOVE   12 TO   PV-MSG-LENGTH                           03957819
039579           MOVE PV-XML-DC-DETAILS-END TO PV-MSGBUFFER             03957919
039580                                                                  03958019
039590                                                                  03959019
039600           PERFORM 6000-WRITE-VARIABLE-REC                        03960019
039610           MOVE    9 TO   PV-MSG-LENGTH                           03961019
039620           MOVE PV-XML-POINFO-END TO PV-MSGBUFFER                 03962019
039621                                                                  03962119
039622           PERFORM 6000-WRITE-VARIABLE-REC                        03962219
039623           SET PS-PO-HEADER-WRITN-NO TO TRUE                      03962319
039624        ELSE                                                      03962419
039625           IF PS-DC-CHANGE-YES                                    03962519
039626              SET PS-DC-CHANGE-NO TO TRUE                         03962619
039627              IF PS-PO-HEADER-WRITN-NO                            03962719
039628                 SET PS-PO-HEADER-WRITN-YES TO TRUE               03962819
039629                 MOVE PD-PO-NBR (1) TO PV-XML-PO-NBR              03962919
039630                 MOVE PD-PO-VND (1) To PV-XML-VEND-PO-NBR         03963019
039631                 MOVE PD-DEPT-NBR (1)  TO PV-XML-DEPT-NBR         03963119
039632                                                                  03963219
039633                 MOVE  100 TO   PV-MSG-LENGTH                     03963319
039634                 MOVE PV-XML-PO-HEADER TO PV-MSGBUFFER            03963419
039635                                                                  03963519
039636                 PERFORM 6000-WRITE-VARIABLE-REC                  03963619
039637                 PERFORM 4000-CREATE-MSGS                         03963719
039638                 PERFORM 6000-WRITE-VARIABLE-REC                  03963819
039639              ELSE                                                03963919
039640                 PERFORM 4000-CREATE-MSGS                         03964019
039650                 PERFORM 6000-WRITE-VARIABLE-REC                  03965019
039651             END-IF                                               03965119
039652           ELSE                                                   03965219
039653               PERFORM 4000-CREATE-MSGS                           03965319
039654               PERFORM 6000-WRITE-VARIABLE-REC                    03965419
039655*                                                                 03965519
039656               MOVE   12 TO   PV-MSG-LENGTH                       03965619
039657               MOVE PV-XML-DC-DETAILS-END TO PV-MSGBUFFER         03965719
039658                                                                  03965819
039659                                                                  03965919
039660               PERFORM 6000-WRITE-VARIABLE-REC                    03966019
039661               MOVE    9 TO   PV-MSG-LENGTH                       03966119
039662               MOVE PV-XML-POINFO-END TO PV-MSGBUFFER             03966219
039663                                                                  03966319
039664               PERFORM 6000-WRITE-VARIABLE-REC                    03966419
039665*                                                                 03966519
039666           END-IF                                                 03966619
039667        END-IF.                                                   03966719
039668                                                                  03966819
039669***************************************************************   03966919
039670*  File length max set to 32000. If record is longer , the write  03967019
039671*  needs to be split to 2 rows. Also, cannot be split in the      03967119
039672*  middle of a tag or value.  Inspect for PC-END-TAG '>' in the   03967219
039673*  last 50 bytes and then calculate the first and second write    03967319
039674***************************************************************   03967419
039679 6000-WRITE-VARIABLE-REC.                                         03967919
039680     MOVE SPACES           TO VARIABLE-RECORD-01                  03968019
039685                                                                  03968519
039686     IF XML-LENGTH    >  32000                                    03968619
039687        DISPLAY 'Record XML EXCEEDS 32000'                        03968781
039688        MOVE XML-LENGTH  TO PV-XML-LENGTH-NEW                     03968839
039689                                                                  03968939
039690        MOVE +0 TO  PV-CHAR-COUNT                                 03969019
039692                                                                  03969219
039693        MOVE PV-MSGBUFFER(31950:32000) to PV-LAST-50-BYTES        03969319
039694        INSPECT PV-LAST-50-BYTES TALLYING PV-CHAR-COUNT FOR       03969419
039695                 CHARACTERS BEFORE PC-END-TAG                     03969519
039696        COMPUTE PV-XML-LENGTH-X = 31950 + PV-CHAR-COUNT           03969619
039697                                                                  03969719
039698        MOVE PV-XML-LENGTH-X  TO PV-BYTE-COUNT                    03969819
039699        MOVE PV-MSGBUFFER(1:PV-XML-LENGTH-X)    TO                03969919
039700                                 PV-VARIABLE-OUTPUT-FIELD         03970019
039701                                                                  03970181
039702        INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL            03970233
039703        '<UPCData UPCNumber="X"></UPCData>' BY                    03970386
039704        '                                 '                       03970450
039705        Compute PV-XML-LENGTH-NEW = PV-XML-LENGTH-NEW             03970540
039706                                   - PV-XML-LENGTH-X              03970640
039708                                                                  03970840
039711        MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01     03971166
039712        WRITE VARIABLE-RECORD-01                                  03971266
039713                                                                  03971379
039714        IF PV-XML-LENGTH-NEW   >  32000                           03971479
039715           PERFORM 6005-FORMAT-VARIABLE-REC                       03971579
039768        ELSE                                                      03976875
039769          MOVE SPACES           TO VARIABLE-RECORD-01             03976984
039770                                   PV-VARIABLE-OUTPUT-FIELD       03977084
039771          MOVE PV-XML-LENGTH-NEW    TO PV-BYTE-COUNT              03977175
039772          Add +1                    to PV-XML-LENGTH-X            03977282
039773          MOVE PV-MSGBUFFER(PV-XML-LENGTH-X:XML-LENGTH) TO        03977383
039774                                   PV-VARIABLE-OUTPUT-FIELD       03977475
039775          INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL          03977575
039776          '<UPCData UPCNumber="X"></UPCData>' BY                  03977686
039777          '                                 '                     03977775
039778                                                                  03977875
039779          MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01   03977975
039780          WRITE VARIABLE-RECORD-01                                03978075
039781        MOVE +0                      TO PV-XML-LENGTH             03978184
039782                                        PV-XML-LENGTH-X           03978284
039783                                        XML-LENGTH                03978384
039784        END-IF                                                    03978475
039785     ELSE                                                         03978575
039786        MOVE PV-MSG-LENGTH    TO PV-BYTE-COUNT                    03978675
039787        MOVE PV-MSGBUFFER     TO PV-VARIABLE-OUTPUT-FIELD         03978775
039788        INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL            03978875
039789        '<UPCData UPCNumber="X"></UPCData>' BY                    03978986
039790        '                                 '                       03979075
039791        MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01     03979175
039792        WRITE VARIABLE-RECORD-01                                  03979275
039793        MOVE +0                      TO PV-XML-LENGTH             03979379
039794                                        PV-XML-LENGTH-X           03979479
039795                                        XML-LENGTH                03979579
039796     END-IF.                                                      03979679
039797                                                                  03979775
039798***************************************************************   03979881
039799*  PV-XML-LENGTH-NEW   =  orignal xml length less the             03979981
039800*   record already written                                        03980081
039801*  Paragraph only performed if record >  64000                    03980186
039802***************************************************************   03980281
039803 6005-FORMAT-VARIABLE-REC.                                        03980381
039804        DISPLAY 'Record XML EXCEEDS 64000'                        03980481
039805        MOVE SPACES TO PV-VARIABLE-OUTPUT-FIELD                   03980579
039806                       VARIABLE-RECORD-01                         03980679
039807        MOVE +0 TO  PV-CHAR-COUNT                                 03980779
039808                                                                  03980881
039809        COMPUTE PV-XML-LENGTH  = PV-XML-LENGTH-NEW -              03980979
039810                                      PV-XML-LENGTH-X             03981079
039811        ADD +1  TO PV-XML-LENGTH-X                                03981179
039812        COMPUTE PV-XML-LENGTH-BEG = PV-XML-LENGTH-X + 31950       03981279
039813        COMPUTE PV-XML-LENGTH-END = PV-XML-LENGTH-X + 32000       03981379
039814                                                                  03981479
039815        MOVE PV-MSGBUFFER(PV-XML-LENGTH-BEG:PV-XML-LENGTH-END)    03981579
039816                                     to PV-LAST-50-BYTES          03981679
039817        INSPECT PV-LAST-50-BYTES TALLYING PV-CHAR-COUNT FOR       03981779
039818                 CHARACTERS BEFORE PC-END-TAG                     03981879
039819        COMPUTE PV-XML-LENGTH-END = PV-XML-LENGTH-BEG             03981979
039820                                        + PV-CHAR-COUNT           03982079
039821        COMPUTE PV-BYTE-COUNT = PV-XML-LENGTH-END  -              03982179
039822                                PV-XML-LENGTH-X                   03982279
039823        Add +1 to PV-BYTE-COUNT                                   03982379
039824        MOVE PV-MSGBUFFER(PV-XML-LENGTH-X:PV-XML-LENGTH-END)      03982479
039825                            TO   PV-VARIABLE-OUTPUT-FIELD         03982579
039826        INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL            03982679
039827        '<UPCData UPCNumber="X"></UPCData>' BY                    03982786
039828        '                                 '                       03982879
039829      MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01       03982979
039830      WRITE VARIABLE-RECORD-01                                    03983079
039831                                                                  03983179
039832      MOVE SPACES           TO VARIABLE-RECORD-01                 03983279
039833                               PV-VARIABLE-OUTPUT-FIELD           03983379
039834      COMPUTE PV-XML-LENGTH-BEG = PV-XML-LENGTH-END + 1           03983479
039835      COMPUTE PV-XML-LENGTH-END = PV-XML-LENGTH-BEG +             03983579
039836                                  PV-XML-LENGTH                   03983679
039837      MOVE PV-XML-LENGTH  to PV-BYTE-COUNT                        03983779
039838      MOVE PV-MSGBUFFER(PV-XML-LENGTH-BEG:PV-XML-LENGTH-END)      03983879
039839                                TO  PV-VARIABLE-OUTPUT-FIELD      03983979
039840                                                                  03984079
039841      INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL              03984179
039842      '<UPCData UPCNumber="X"></UPCData>' BY                      03984286
039843      '                                 '                         03984379
039844                                                                  03984479
039845      MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01       03984579
039846      WRITE VARIABLE-RECORD-01                                    03984679
039847      MOVE +0                      TO PV-XML-LENGTH               03984779
039848                                      PV-XML-LENGTH-X             03984879
039849                                      XML-LENGTH.                 03984979
039850******************************************************************03985075
039851                                                                  03985175
039852 8000-READ-INPUT-FILE.                                            03985275
039853**   DISPLAY '8000-READ-INPUT-FILE'                               03985375
039854     READ SKU-SORT-FILE-IN INTO RC104-SKU-SORT-DTL-REC            03985475
039855          AT END SET PS-END-OF-SKU-SORT-REC-Y TO TRUE.            03985575
039856                                                                  03985675
039857     IF PS-END-OF-SKU-SORT-REC-N                                  03985775
039858        ADD +1   TO PV-COUNTER                                    03985875
039859     END-IF.                                                      03985975
039860******************************************************************03986075
039861 8900-WRITE-CLOSE-TAGS.                                           03986175
039862                                                                  03986275
039863     MOVE 12                   TO PV-BYTE-COUNT                   03986375
039864     MOVE PV-XML-RDCDETAIL-END          to                        03986475
039865                                  PV-VARIABLE-OUTPUT-FIELD        03986575
039866     MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01        03986675
039867     WRITE VARIABLE-RECORD-01.                                    03986775
039868                                                                  03986875
039869     MOVE 11                   TO PV-BYTE-COUNT                   03986975
039870     MOVE PV-XML-SHIP-END               to                        03987075
039871                                  PV-VARIABLE-OUTPUT-FIELD        03987175
039872     MOVE PV-VARIABLE-OUTPUT-FIELD   TO VARIABLE-RECORD-01        03987275
039873     WRITE VARIABLE-RECORD-01.                                    03987375
039874******************************************************************03987475
039875* DISPLAY STATISTICS FOR THE PROGRAM                              03987575
039876******************************************************************03987675
039877 9000-EOJ-ROUTINE.                                                03987775
039878                                                                  03987875
039879     CLOSE SKU-SORT-FILE-IN                                       03987975
039880           VARIABLE-FILE-01.                                      03988075
039881     DISPLAY ' '                                                  03988175
039882     DISPLAY ' ********************************************'      03988275
039883     DISPLAY '     * RCKUT176 SUMMARY STATISTICS *         '      03988375
039884     DISPLAY '       ---------------------------           '      03988475
039885     DISPLAY '        SKU SORT XML GENERATOR               '      03988575
039886     DISPLAY '       ---------------------------           '      03988675
039887     DISPLAY '   TOTAL RECORDS READ ........:'                    03988775
039888                                    PV-COUNTER                    03988875
039889     DISPLAY '   TOTAL PO DETAILS WRITTEN...:'                    03988975
039890                                    PV-PO-DETAILS-GENERATED       03989075
039891     DISPLAY '   TOTAL Purchase Orders......:'                    03989175
039892                                    PV-PO-COUNT                   03989219
039900     DISPLAY ' ********************************************'.     03990019
040000                                                                  04000019
040100****************************************************************  04010019
040200******************************************************************04020019
040300* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      04030019
040400* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 04040019
040500******************************************************************04050019
040510 9900-DB2-ABEND.                                                  04051019
040520                                                                  04052019
040530     MOVE SQLCODE    TO PV-SQLCODE.                               04053019
040540     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       04054019
040550     DISPLAY '*** DB2 ERROR ***'.                                 04055019
040560     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               04056019
040570     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04057019
040580     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04058019
040590     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04059019
040600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04060019
040700     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             04070019
040800                                                                  04080019
040900******************************************************************04090019
041000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04100019
041100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04110019
041200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04120019
041300* FORMAT.                                                         04130019
041400******************************************************************04140019
041500     COPY DPPD004.                                                04150019
041600                                                                  04160019
041700     IF SQLCODE NOT = -911                                        04170019
041800         EXEC SQL                                                 04180019
041900             ROLLBACK                                             04190019
042000         END-EXEC                                                 04200019
042100     END-IF.                                                      04210019
042200                                                                  04220019
042300     MOVE +4013         TO PV-ABEND-CODE.                         04230019
042400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04240019
042500******************************************************************04250019
042600******************************************************************04260019
